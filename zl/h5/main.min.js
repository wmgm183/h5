var cdnurl='https://cdn.jsdelivr.net/gh/wmgm183/h5@master/zl/h5/';function decArray(t,e){if(flavorConfig&&flavorConfig.array){var i=flavorConfig.array[e];if(i){var n=t[e];n=n.filter(function(t,e){return i.indexOf(e)>=0}),t[e]=n}}}function modifyChild(t){if(flavorConfig&&flavorConfig.inject){var e=t.prototype.childrenCreated;t.prototype.childrenCreated=function(){e.call(this);var t=flavorConfig.inject[this.__class__];if(t)for(var i in t)alien.Utils.injectProp(this[i],t[i])}}}function modifyChildren(t){if(flavorConfig&&flavorConfig.injectChildren){var e=t.prototype.childrenCreated;t.prototype.childrenCreated=function(){e.call(this);var t=flavorConfig.injectChildren[this.__class__];if(t)for(var i in t){var n=t[i],r=void 0;for(var o in n)r=isNaN(o)?this[i].getChildByName(o):this[i].getChildAt(parseInt(o)),alien.Utils.injectProp(r,n[o])}}}}function modifyEnabled(t,e){if(flavorConfig&&flavorConfig.enabled){var i=flavorConfig.enabled[e];void 0!==i&&(t[e]=i)}}function preprocessing(){var t=Base64.decode(egret.getOption("option")),e=t.length>0?JSON.parse(t):{},i=alien.Utils.combineProp(GameConfig.defaultOption,e);alien.Utils.injectProp(GameConfig,i);var n,r=egret.getOption("query");if(r){n=alien.Utils.parseQuery(Base64.decode(r));var o=n.logotype,s=n.loading_bg_type,a=n.login_bg_type,c=n.nickname;GameConfig.logoType=o,GameConfig.loadingBgType=s,GameConfig.loginBgType=a,GameConfig.defaultNickname=c}GameConfig.params=n,Bridge.init(n),Analytics.logEvent("launch")}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{c(n.next(t))}catch(e){o(e)}}function a(t){try{c(n["throw"](t))}catch(e){o(e)}}function c(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}c((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){c.label=i[1];break}if(6===i[0]&&c.label<s[1]){c.label=s[1],s=i;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(i);break}s[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__decorate=this&&this.__decorate||function(t,e,i,n){var r,o=arguments.length,s=3>o?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(3>o?r(s):o>3?r(e,i,s):r(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},__assign=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;n>i;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},alien;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"eventGroupName",{get:function(){return this.__class__+"_"+this.hashCode},enumerable:!0,configurable:!0}),i.prototype.registerEvent=function(e,i,n,r,o){void 0===o&&(o=0),t.EventManager.instance.register(this.eventGroupName,e,i,n,r,o)},i.prototype.enableEvents=function(){t.EventManager.instance.enable(this.eventGroupName)},i.prototype.disableEvents=function(){t.EventManager.instance.disable(this.eventGroupName)},i.prototype.commitProperties=function(){var t=this.$Component[4];e.prototype.commitProperties.call(this),t&&wsy.Utils.updateAllImages(this)},i}(eui.Component);t.EventComponent=e,__reflect(e.prototype,"alien.EventComponent");var i=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemovedFromStage,e),e}return __extends(e,t),e.prototype.onAddedToStage=function(t){this.enableEvents()},e.prototype.onRemovedFromStage=function(t){this.disableEvents()},e}(e);t.VisualEventComponent=i,__reflect(i.prototype,"alien.VisualEventComponent");var n=function(e){function i(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddedToStage,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.onRemovedFromStage,t),t}return __extends(i,e),Object.defineProperty(i.prototype,"eventGroupName",{get:function(){return this.__class__+"_"+this.hashCode},enumerable:!0,configurable:!0}),i.prototype.registerEvent=function(e,i,n,r,o){void 0===o&&(o=0),t.EventManager.instance.register(this.eventGroupName,e,i,n,r,o)},i.prototype.enableEvents=function(){t.EventManager.instance.enable(this.eventGroupName)},i.prototype.disableEvents=function(){t.EventManager.instance.disable(this.eventGroupName)},i.prototype.onAddedToStage=function(t){this.enableEvents()},i.prototype.onRemovedFromStage=function(t){this.disableEvents()},i}(eui.ItemRenderer);t.VisualEventItemRenderer=n,__reflect(n.prototype,"alien.VisualEventItemRenderer")}(alien||(alien={}));var alien;!function(t){var e=function(e){function i(i,n,r,o,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=!1);var a=e.call(this)||this;return a._excludeActionsClose=[],a.dealAction=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),a._callback&&a._callback(t||"close",e),a._excludeActionsClose.indexOf(t)<0&&(a.close(),a._callback=null)},a.showEffect=i||t.popupEffect.None,a.showEffectParams=n,a.closeEffect=r||t.popupEffect.None,a.closeEffectParams=o,a.popupShowBanner=s,a._excludeActionsClose=[],a.init(),a}return __extends(i,e),i.prototype.init=function(){},i.prototype.getResGroupNames=function(){return null},i.prototype.onBeginLoadResGroups=function(){},i.prototype.onEndLoadResGroups=function(){},i.prototype.getSkinName=function(){return null},i.prototype.addExcludeForClose=function(t){this._excludeActionsClose=this._excludeActionsClose.concat(t)},i.prototype.popup=function(e,i,n){return void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var r,o;return __generator(this,function(s){switch(s.label){case 0:return r=this.getResGroupNames(),r&&r.length>0&&t.ResGroupsLoader.instance.checkNeedLoad(r)?(this.onBeginLoadResGroups(),[4,t.ResGroupsLoader.instance.loadResGroups(r)]):[3,2];case 1:return s.sent(),this.onEndLoadResGroups(),[3,3];case 2:this.onEndLoadResGroups(),s.label=3;case 3:return this.skinName||(o=this.getSkinName(),o&&(this.skinName=o)),this._popup(e,i,n),[2]}})})},i.prototype._popup=function(e,i,n){void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=null),t.PopUpManager.addPopUp(this,this.showEffect,this.showEffectParams,e,i,n),wsy.Utils.updateAllImages(this)},i.prototype.close=function(){t.PopUpManager.removePopUp(this,this.closeEffect,this.closeEffectParams)},i.prototype.active=function(){this.enableEvents()},i.prototype.inactive=function(){this.disableEvents();var t=this.getResGroupNames();t&&t.forEach(function(t){RES.destroyRes(t,!1)})},i}(t.EventComponent);t.PopupBase=e,__reflect(e.prototype,"alien.PopupBase")}(alien||(alien={}));var NavigatorViewBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.percentWidth=this.percentHeight=100},e.prototype.getResGroupNames=function(){return null},e.prototype.getSkinName=function(){return null},e.prototype.onBeginLoadResGroups=function(){},e.prototype.onEndLoadResGroups=function(){},e.prototype.active=function(){this.enableEvents()},e.prototype.inactive=function(){this.disableEvents()},e.prototype.onWillMount=function(t,e,i){var n=this,r=this.getResGroupNames(),o=ResourceLoader.load(r,this.onBeginLoadResGroups,this.onEndLoadResGroups);return o.then(function(){if(n.skinName)n.onSkinOn();else{var t=n.getSkinName();t&&(n.skinName=t)}})},e.prototype.onWillUnMount=function(t,e,i){return Promise.resolve()},e.prototype.onSkinOn=function(){wsy.Utils.updateAllImages(this)},e.prototype.onAddView=function(){return!0},e.prototype.onWillEnter=function(t,e,i){return this.active(),Promise.resolve()},e.prototype.onDidEnter=function(t,e,i){},e.prototype.onWillLeave=function(t,e,i){return this.inactive(),Promise.resolve()},e.prototype.onDidLeave=function(t,e,i){if(this.parent&&this.parent.removeChild(this),e!=alien.NavigatorAction.Push){var n=this.getResGroupNames();n&&n.forEach(function(t){RES.destroyRes(t,!1)})}},e}(alien.EventComponent);__reflect(NavigatorViewBase.prototype,"NavigatorViewBase",["alien.INavigatorViewBase"]);var PanelBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.active=function(){t.prototype.active.call(this),this.dispatchGuidePoint("show")},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.dispatchGuidePoint("close")},e.prototype.dispatchGuidePoint=function(t){var e=this.__class__;if("PanelDialog"!=e){var i=t+"_panel_"+this.__class__;alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:i})}},e}(alien.PopupBase);__reflect(PanelBase.prototype,"PanelBase");var Service=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){},Object.defineProperty(e.prototype,"eventGroupName",{get:function(){return this.__class__+"_"+this.hashCode},enumerable:!0,configurable:!0}),e.prototype.registerEvent=function(t,e,i,n,r){void 0===r&&(r=0),EventManager.instance.register(this.eventGroupName,t,e,i,n,r)},e.prototype.start=function(){return EventManager.instance.enable(this.eventGroupName),Promise.resolve()},e.prototype.stop=function(){return EventManager.instance.disable(this.eventGroupName),Promise.resolve()},e}(egret.EventDispatcher);__reflect(Service.prototype,"Service");var flavorConfigs={develop:{enabled:{showServerLog:!0,logGuidePoint:!0}},release:{array:{},inject:{LoadingLayer:{grpGameNotice:{visible:!1}}},enabled:{antiAddictionEnabled:!1},injectChildren:{LobbyCapital:{grpButtons:[{},{},{},{visible:!1}],grpTapBroad:[{},{},{},{visible:!1}]}}},appstore:{array:{shopTabs:[0,1,2],lobby_bottom_bar:[1,2,3,4],lobby_top_bar:[2],panelChatTabs:[0]},inject:{SceneLogin:{btnSwitch:{visible:!1}},PanelSetting:{btnExchange:{visible:!1},btnLogout:{visible:!1}},LoadingLayer:{grpGameNotice:{visible:!1}},SceneLobby:{},NicknameWithVip:{imgVip:{visible:!1}},GoldWithVip:{btnAdd:{visible:!1}}},injectChildren:{LobbyCapital:{grpButtons:[{},{visible:!1},{},{visible:!1}],grpTapBroad:[{},{visible:!1},{},{visible:!1}]}},enabled:{guideEnabled:!1,manqing12diEnabled:!1}},examine:{array:{shopTabs:[0,1],lobby_bottom_bar:[2,3],lobby_top_bar:[0],arenaHistoryTabs:[0],panelChatTabs:[0],panelRankTabs:[0,1]},inject:{PanelSetting:{btnExchange:{visible:!1}},SceneLobby:{btnNavLeft:{visible:!1},btnNavRight:{visible:!1},taskBar:{visible:!1}},NicknameWithVip:{imgVip:{visible:!1}},GoldWithVip:{btnAdd:{visible:!1}},PanelCashGiftShop:{btnRefresh:{visible:!1}},SceneArena:{btnHelp:{visible:!1}},ScenePrincessParty:{btnHelp:{visible:!1},cashGift:{visible:!1}}},injectChildren:{LobbyCapital:{grpButtons:[{visible:!1},{visible:!1},{visible:!1}],grpTapBroad:[{visible:!1},{visible:!1},{visible:!1}]},LobbyMain:{grpButtons:[{},{visible:!1}],grpTapBroad:[{},{visible:!1}]}},enabled:{examineEnabled:!0,guideEnabled:!1,antiAddictionEnabled:!0,manqing12diEnabled:!1,princessFilters:[200009,200010,200011,200012,200013,200014,200015,200016,200017]}}},currentFlavor=egret.getOption("flavor");currentFlavor&&0!=currentFlavor.length||(currentFlavor="release");var flavorConfig=flavorConfigs[currentFlavor],SceneBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"tweenEnter",{get:function(){return this["enter"+(this.currentState?"_"+this.currentState:"")]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tweenLeave",{get:function(){return this["leave"+(this.currentState?"_"+this.currentState:"")]},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this);var i;this.tweenEnter?this.registerEvent(this.tweenEnter,egret.Event.COMPLETE,this.onTweenEnterComplete,this):this.skin.states.forEach(function(t){(i=e["enter_"+t.name])&&e.registerEvent(i,egret.Event.COMPLETE,e.onTweenEnterComplete,e)}),this.tweenLeave?this.registerEvent(this.tweenLeave,egret.Event.COMPLETE,this.onTweenEnterComplete,this):this.skin.states.forEach(function(t){(i=e["leave_"+t.name])&&e.registerEvent(i,egret.Event.COMPLETE,e.onTweenLeaveComplete,e)})},e.prototype.getEnterProps=function(t,e,i){return{}},e.prototype.getLeaveProps=function(t,e,i){return{}},e.prototype.onBeginLoadResGroups=function(){MainStage.instance.showLoading(!0)},e.prototype.onEndLoadResGroups=function(){MainStage.instance.showLoading(!1)},e.prototype.onWillUnMount=function(t,e,i){return ResourceLoader.watchLoaded()},e.prototype.onWillEnter=function(e,i,n){return __awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(o){switch(o.label){case 0:return this.initScene(n),egret.setTimeout(function(){r.tweenEnter&&r.tweenEnter.play(0),r.onPlayEnter()},this,400),[4,t.prototype.onWillEnter.call(this,e,i,n)];case 1:return o.sent(),[4,MainStage.instance.hideBlackLayer()];case 2:return o.sent(),[4,this.waitingForEnter()];case 3:return o.sent(),[2]}})})},e.prototype.waitingForEnter=function(){var t=this;return new Promise(function(e){t.tweenEnter&&t.resolveEnter===!1?t.resolveEnter=e:e()})},e.prototype.onWillLeave=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.tweenLeave&&this.tweenLeave.play(0),this.onPlayLeave(),[4,t.prototype.onWillLeave.call(this,e,i,n)];case 1:return r.sent(),[4,MainStage.instance.showBlackLayer()];case 2:return r.sent(),[4,this.waitingForLeave()];case 3:return r.sent(),[2]}})})},e.prototype.waitingForLeave=function(){var t=this;return new Promise(function(e){t.tweenLeave&&t.resolveLeave===!1?t.resolveLeave=e:e()})},e.prototype.onTweenEnterComplete=function(t){"function"==typeof this.resolveEnter&&this.resolveEnter(),this.resolveEnter=!0},e.prototype.onTweenLeaveComplete=function(t){"function"==typeof this.resolveLeave&&this.resolveLeave(),this.resolveLeave=!0},e.prototype.onPlayEnter=function(){},e.prototype.onPlayLeave=function(){},e.prototype.initScene=function(t){},e.prototype["goto"]=function(t,e){void 0===e&&(e=null),SceneController["goto"](t,e)},e.prototype.back=function(t){void 0===t&&(t=null),SceneController.back(t)},e}(NavigatorViewBase);__reflect(SceneBase.prototype,"SceneBase");var StackView=function(t){function e(){var e=t.call(this)||this;return e.percentWidth=e.percentHeight=100,e}return __extends(e,t),e.prototype.active=function(t){this.enableEvents(),wsy.Utils.updateAllImages(this)},e.prototype.inactive=function(){this.disableEvents()},e}(alien.EventComponent);__reflect(StackView.prototype,"StackView");var alien;!function(t){var e=function(e){function i(t,i){void 0===i&&(i={});var n=e.call(this)||this;return n._touchPoints=[],n._target=t,n._configuration=i,n.setup(),n}return __extends(i,e),i.prototype.setup=function(){this._id="Gesture_"+i.ID_INK++;var e=t.EventManager.instance;e.register(this._id,this._target,egret.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),e.register(this._id,this._target,egret.TouchEvent.TOUCH_TAP,this._onTouchTap,this),e.register(this._id,t.StageProxy.stage,egret.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),e.register(this._id,t.StageProxy.stage,egret.TouchEvent.TOUCH_END,this._onTouchEnd,this)},i.prototype.getTouchPoint=function(t){var e=null;return this._touchPoints.some(function(i){return i.id==t?(e=i,!0):void 0}),e},i.prototype.addTouchPoint=function(t){var e={id:t.touchPointID,beginPoint:{x:t.stageX,y:t.stageY},point:{x:t.stageX,y:t.stageY},delta:{x:0,y:0,time:0},lastTime:Date.now()};return this._touchPoints.push(e),e},i.prototype.removeTouchPoint=function(t){var e=this;this._touchPoints.some(function(i,n){return i.id==t?(e._touchPoints.splice(n,1),!0):void 0})},i.prototype._onTouchBegin=function(t){this.onTouchBegin(this.addTouchPoint(t),t)},i.prototype.onTouchBegin=function(t,e){},i.prototype._onTouchTap=function(t){this.onTouchTap(this.getTouchPoint(t.touchPointID),t)},i.prototype.onTouchTap=function(t,e){},i.prototype._onTouchMove=function(t){var e=this.getTouchPoint(t.touchPointID);e&&(e.point.x=t.stageX,e.point.y=t.stageY,this.updateDelta(e,t),this.onTouchMove(e,t))},i.prototype.onTouchMove=function(t,e){},i.prototype._onTouchEnd=function(t){var e=this.getTouchPoint(t.touchPointID);e&&(this.updateDelta(e,t),this.onTouchEnd(e,t),this.removeTouchPoint(t.touchPointID))},i.prototype.onTouchEnd=function(t,e){},i.prototype.updateDelta=function(t,e){t.delta.x=e.stageX-t.beginPoint.x,t.delta.y=e.stageY-t.beginPoint.y,t.delta.time=Date.now()-t.lastTime,t.lastTime=Date.now()},Object.defineProperty(i.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),i.prototype.active=function(){t.EventManager.instance.enable(this._id)},i.prototype.inactive=function(){t.EventManager.instance.disable(this._id)},i.prototype.cancel=function(){this._touchPoints.splice(0)},i.ID_INK=0,i}(egret.EventDispatcher);t.Gesture=e,__reflect(e.prototype,"alien.Gesture")}(alien||(alien={}));var Entity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._onInject=function(t,i,n){e.onInject(t,i,n)},e}return __extends(e,t),e.prototype.inject=function(t){alien.Utils.injectProp(this,t,this._onInject)},e.prototype.onInject=function(t,e,i){t[e]=i},e}(egret.EventDispatcher);__reflect(Entity.prototype,"Entity");var PanelDialog=function(t){function e(e){void 0===e&&(e=0);var i=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;switch(i._skinType=e,i._skinType){case 0:i.skinName=panels.PanelContainerSkin;break;case 1:i.skinName=panels.PanelContainer2Skin;break;case 2:i.skinName=panels.PanelContainer3Skin;break;case 3:i.skinName=panels.PanelContainer4Skin;break;default:i.skinName=panels.PanelContainerSkin}return i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.onBtnCloseTap,this)},e.prototype.onBtnCloseTap=function(t){this.dealAction()},Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(t){this._content!=t&&(this._content=t,this.container.removeChildren(),t&&(this.container.addChild(t),t.verticalCenter=0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(t){this._title!=t&&(this._title=t,this.labTitle.text=t),this.grpTitle.visible=!!this._title},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasCloseButton",{get:function(){return this._hasCloseButton},set:function(t){this._hasCloseButton!=t&&(this._hasCloseButton=t,this.btnClose.visible=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"callback",{get:function(){return this._callback},set:function(t){this._callback=t},enumerable:!0,configurable:!0}),e.prototype.popup=function(e,i,n){return void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.popup.call(this,e,i,n)];case 1:return r.sent(),this.content.onShow(),[2]}})})},e.prototype.close=function(){t.prototype.close.call(this),this.content.onClose()},e.prototype.active=function(){t.prototype.active.call(this),this._content&&this._content.active()},e.prototype.inactive=function(){t.prototype.inactive.call(this),this._content&&this._content.inactive()},e}(PanelBase);__reflect(PanelDialog.prototype,"PanelDialog");var CommonPanelBase=function(t){function e(){var e=t.call(this)||this;return e._skinType=0,e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.getResGroupNames=function(){return null},e.prototype.onBeginLoadResGroups=function(){},e.prototype.onEndLoadResGroups=function(){},e.prototype.getSkinName=function(){return null},e.prototype.popup=function(t,e,i,n){return void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var r,o;return __generator(this,function(s){switch(s.label){case 0:return r=this.getResGroupNames(),r&&r.length>0&&alien.ResGroupsLoader.instance.checkNeedLoad(r)?(this.onBeginLoadResGroups(),[4,alien.ResGroupsLoader.instance.loadResGroups(r)]):[3,2];case 1:return s.sent(),this.onEndLoadResGroups(),[3,3];case 2:this.onEndLoadResGroups(),s.label=3;case 3:return this.skinName||(o=this.getSkinName(),o&&(this.skinName=o)),this.container||(this.container=new PanelDialog(this._skinType)),this.container.callback=t,this.container.content=this,this.container.title=this._title,this.container.hasCloseButton=this._hasCloseButton,[4,this.container.popup(e,i,n)];case 4:return s.sent(),[2]}})})},e.prototype.close=function(){this.container&&this.container.close()},e.prototype.dealAction=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.container&&this.container.dealAction(t,e)},Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t,this.container&&(this.container.title=this._title)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasCloseButton",{get:function(){return this._hasCloseButton},set:function(t){this._hasCloseButton=t,this.container&&(this.container.hasCloseButton=this._hasCloseButton)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skinType",{set:function(t){this._skinType=t},enumerable:!0,configurable:!0}),e.prototype.onShow=function(){},e.prototype.onClose=function(){},e.prototype.active=function(){this.enableEvents(),this.dispatchGuidePoint("show")},e.prototype.inactive=function(){this.disableEvents(),this.dispatchGuidePoint("close");var t=this.getResGroupNames();t&&t.forEach(function(t){RES.destroyRes(t,!1)})},e.prototype.dispatchGuidePoint=function(t){var e=t+"_panel_"+this.__class__;alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:e})},e}(alien.EventComponent);__reflect(CommonPanelBase.prototype,"CommonPanelBase");var MessageEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.senderLIneId=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e),this.content=Base64.decode(this.content);var i=lang.formatHtml(this.content);if(1==i.length)return void(JSON.parse(i[0].text).activity&&(this.activity=JSON.parse(i[0].text).activity,this.activity.type=parseInt(this.activity.type),this.activity.begin_time=parseInt(this.activity.beginTime),this.activity.end_time=parseInt(this.activity.endTime)));if(this.icon=parseInt(i[1].text),this.content=i[0].text,i[2]){var n=JSON.parse(i[2].text).party;n&&(this.partyId=n.id);var r=JSON.parse(i[2].text).union;r&&(this.unionName=r.name)}},e.ChatType={TYPE_WORLD:3,TYPE_UNION:5},e}(Entity);__reflect(MessageEntity.prototype,"MessageEntity");var alien;!function(t){var e=function(){function e(){this.conflictPercent=.5,this.effectChannelMap={}}return Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.setMusic=function(t){this.musicRes=t},e.prototype.playMusic=function(t,e){var i=this;void 0===t&&(t=null);var n=void 0===e?{}:e,r=n.goon,o=void 0===r?!1:r,s=n.volume,a=void 0===s?1:s;if(this.musicRes!=t||this.musicMute){var c=o?this.musicVolume||1:a;o||(this.musicRes=t),this.musicMute||(this.musicPlaying=!0,RES.getRes(this.musicRes)?this._playMusic(RES.getRes(this.musicRes),c):RES.getResAsync(this.musicRes,function(t){i._playMusic(t,c)},this))}},e.prototype._playMusic=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.musicVolume=e,t?this.musicChannel?[4,this._channelFade(this.musicChannel,0)]:[3,2]:[3,4];case 1:i.sent(),i.label=2;case 2:return this.musicChannel=t.play(),this.musicChannel.volume=0,[4,this._channelFade(this.musicChannel,e,2e3)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},e.prototype._channelFade=function(e,i,n){return void 0===n&&(n=500),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return 0!=n?[3,1]:(0==i&&(egret.Tween.removeTweens(e),e.stop()),[3,3]);case 1:return[4,t.EgretUtils.getTweenPromise(egret.Tween.get(e,null,null,!0).to({volume:i},n))];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.stopMusic=function(t){void 0===t&&(t=!1),this.musicPlaying=!1,t||(this.musicRes=null),this.musicChannel&&(this._channelFade(this.musicChannel,0,0),this.musicChannel=null)},e.prototype.switchMusic=function(){this.musicRes&&(this.musicMute?this.stopMusic(!0):this.musicPlaying||this.playMusic(null,{goon:!0,volume:this.musicVolume}))},Object.defineProperty(e.prototype,"musicMute",{get:function(){return!dataCenterService.getSettingItem("music")},set:function(t){dataCenterService.setSettingItem("music",!t)},enumerable:!0,configurable:!0}),e.prototype.playEffect=function(t,e){var i=this;void 0===t&&(t=null);var n=void 0===e?{}:e,r=n.loop,o=void 0===r?1:r,s=n.conflict,a=void 0===s?!1:s,c=n.force,l=void 0===c?!1:c;if(t&&(this.effectRes=t),!l&&this.effectMute)return Promise.resolve();var p,h=new Promise(function(t){p=t});return RES.getRes(t)?this._playEffect(t,RES.getRes(t),o,a,p):RES.getResAsync(t,function(e){i._playEffect(t,e,o,a,p)},this),h},e.prototype._playEffect=function(t,e,i,n,r){var o=this;if(e){e.type=egret.Sound.EFFECT;var s=e.play(0,i);this.effectChannelMap[t]=s,s.once(egret.Event.SOUND_COMPLETE,function(e){o.onEffectComplete({res:t,conflict:n}),r()},this)}else r()},e.prototype.stopEffect=function(t,e){var i=this,n=(void 0===e?{}:e).fade,r=void 0===n?!1:n,o=this.effectChannelMap[t];return o?r?new Promise(function(e){egret.Tween.get(o,null,null,!0).to({volume:.1},300).call(function(){i._stopEffect(t),e()})}):(this._stopEffect(t),Promise.resolve()):Promise.resolve()},e.prototype._stopEffect=function(t){var e=this.effectChannelMap[t];e&&e.stop(),delete this.effectChannelMap[t]},e.prototype.onEffectComplete=function(t){var e=t.res,i=t.conflict;i&&this.musicChannel&&!this.musicMute&&egret.Tween.get(this.musicChannel,null,null,!0).to({volume:this.musicVolume},200),delete this.effectChannelMap[e]},e.prototype.switchEffect=function(){if(this.effectMute)for(var t in this.effectChannelMap){var e=this.effectChannelMap[t];e.stop()}},Object.defineProperty(e.prototype,"effectMute",{get:function(){return!dataCenterService.getSettingItem("effect")},set:function(t){dataCenterService.setSettingItem("effect",!t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMute",{get:function(){return this.musicMute},enumerable:!0,configurable:!0}),e.prototype.switchAll=function(){this.switchEffect(),this.switchMusic()},e.prototype.vibrate=function(){this.vibrateMute},Object.defineProperty(e.prototype,"vibrateMute",{get:function(){var e=t.LocalStorage.getItem("vibrateMute");return e?"1"==e:!1},set:function(e){t.LocalStorage.setItem("vibrateMute",e?"1":"0")},enumerable:!0,configurable:!0}),e.prototype.switchVibrate=function(){this.vibrateMute=!this.vibrateMute},e}();t.SoundManager=e,__reflect(e.prototype,"alien.SoundManager")}(alien||(alien={}));var alien;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.onTouchBegin=function(t,e){this.downTarget=e.target},i.prototype.onTouchMove=function(t,e){this._configuration.dispatchCancelEvent&&(e.isDefaultPrevented()||(this.touchMoved||(this.touchMoved=!0,this.dispatchCancelEvent(e)),e.preventDefault()))},i.prototype.onTouchEnd=function(e,n){this.touchMoved=!1;var r=this._configuration.threshold,o=void 0===r?300:r,s=Math.abs(e.delta.x);if(e.delta.time<30&&s>50||s>o){var a=t.MathUtils.sign(e.delta.x);this.dispatchEventWith(i.SLIDE,!1,{dir:a})}},i.prototype.dispatchCancelEvent=function(t){var e=egret.Event.create(egret.TouchEvent,egret.TouchEvent.TOUCH_CANCEL,t.bubbles,t.cancelable);e.$initTo(t.$stageX,t.$stageY,t.touchPointID);var i=this.downTarget;e.$setTarget(i);for(var n=this._target.$getPropagationList(i),r=n.length,o=.5*n.length,s=-1,a=0;r>a;a++)if(n[a]===this._target){s=a;break}n.splice(0,s+1-2),n.splice(n.length-1-s+2,s+1-2),o-=s+1,this._target.$dispatchPropagationEvent(e,n,o),egret.Event.release(e)},i.SLIDE="SLIDE",i}(t.Gesture);t.SlideGesture=e,__reflect(e.prototype,"alien.SlideGesture")}(alien||(alien={}));var alien;!function(t){var e=function(){function t(){}return t.getTweenPromise=function(t){return new Promise(function(e){t.call(e)})},t.waitPromise=function(t){var e=this;return new Promise(function(i){egret.setTimeout(i,e,t)})},t.callLater=function(t,e){var i=this;void 0===e&&(e=1),e--,egret.callLater(function(){e>0?i.callLater(t,e):t()},this)},t}();t.EgretUtils=e,__reflect(e.prototype,"alien.EgretUtils");var i=function(){function t(t){this._onUpdate=t}return t.prototype.init=function(t){this._posArr=t,this.factor=0},Object.defineProperty(t.prototype,"factor",{get:function(){return 0},set:function(t){var e=this._posArr,i=(1-t)*(1-t)*e[0].x+2*t*(1-t)*e[1].x+t*t*e[2].x,n=(1-t)*(1-t)*e[0].y+2*t*(1-t)*e[1].y+t*t*e[2].y;this._onUpdate({x:i,y:n})},enumerable:!0,configurable:!0}),t}();t.Bezier=i,__reflect(i.prototype,"alien.Bezier")}(alien||(alien={}));var ConstantNames=function(){function t(){}return t.SCENE_LOGIN="SCENE_LOGIN",t.SCENE_STORY="SCENE_STORY",t.SCENE_CREATE_PLAYER="SCENE_CREATE_PLAYER",t.SCENE_LOBBY="SCENE_LOBBY",t.SCENE_THRONE="SCENE_THRONE",t.SCENE_PRINCESS_HOUSE="SCENE_PRINCESS_HOUSE",t.SCENE_PRINCESS="SCENE_PRINCESS",t.SCENE_PRINCESS_POSITION="SCENE_PRINCESS_POSITION",t.SCENE_PRINCESS_WORK="SCENE_PRINCESS_WORK",t.SCENE_PRINCESS_RITE="SCENE_PRINCESS_RITE",t.SCENE_PRINCESS_PARTY="SCENE_PRINCESS_PARTY",t.SCENE_GARDEN_HOUSE="SCENE_GARDEN_HOUSE",t.SCENE_GARDEN_FLOWER="SCENE_GARDEN_FLOWER",t.SCENE_INTERIOR="SCENE_INTERIOR",t.SCENE_MINISTER="SCENE_MINISTER",t.SCENE_OFFICE="SCENE_OFFICE",t.SCENE_MINISTER_INFO="SCENE_MINISTER_INFO",t.SCENE_PRINCESS_INFO="SCENE_PRINCESS_INFO",t.SCENE_WORLD_MAP="SCENE_WORLD_MAP",t.SCENE_BATTLE="SCENE_BATTLE",t.SCENE_WAREHOUSE="SCENE_WAREHOUSE",t.SCENE_ARENA="SCENE_ARENA",t.SCENE_ARENA_BATTLE="SCENE_ARENA_BATTLE",t.SCENE_TECHNOLOGY="SCENE_TECHNOLOGY",t.SCENE_PRINCE="SCENE_PRINCE",t.SCENE_VISIT="SCENE_VISIT",t.SCENE_TREASURE="SCENE_TREASURE",t.SCENE_PRISON="SCENE_PRISON",t.SCENE_UNION="SCENE_UNION",t.SCENE_DUPLICATE="SCENE_DUPLICATE",t.SCENE_WORLD_BOSS="SCENE_WORLD_BOSS",t.SCENE_BURN_INCENSE="SCENE_BURN_INCENSE",t.LOBBY_MAIN="lobby_main",t.LOBBY_CAPITAL="lobby_capital",t.LOBBY_HAREM="lobby_harem",t
}();__reflect(ConstantNames.prototype,"ConstantNames");var GameConfig=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"authorizeByChannel",{get:function(){return this.params&&this.params.abc},enumerable:!0,configurable:!0}),e.init=function(){var t=new alien.ColorMatrix;t.adjustBrightness(-50),this.darkFilter=new egret.ColorMatrixFilter(t.toArray()),t=new alien.ColorMatrix,t.adjustSaturation(-100),this.greyFilter=new egret.ColorMatrixFilter(t.toArray());var e=[.7,0,0,0,60,0,.5,0,0,0,0,0,.5,0,0,0,0,0,1,0];this.redFilter=new egret.ColorMatrixFilter(e),this.guide=RES.getRes("guide");var i=RES.getRes("metas");this.items=i.items,this.countries=i.countries,this.ministers=i.ministers,this.exps=i.exps,this.positions=i.positions,this.skills=i.skills,this.buffers=i.buffers,this.strongholds=i.strongholds,this.memorials=i.memorials,this.peerages=i.peerages,this.princesses=i.princesses,this.flowers=i.flowers,this.techs=i.techs,this.battleBuffers=i.battleBuffers,this.randomNames=i.randomNames,this.fates=i.fates,this.classes=i.classes,this.shop=i.shop,this.giftPacks=i.giftPacks,this.cities=i.cities,this.visit=i.visit,this.tasks=i.tasks,this.chest=i.chest,this.rankReward=i.rankReward,this.exchange=i.exchange,this.unionExp=i.unionExp,this.vip=i.vip,this.boss=i.boss,this.dialogue=i.dialogue,this.event=i.event,this.ministerArray=alien.Utils.objectValues(this.ministers),this.strongholdIds=Object.keys(this.strongholds),this.randomNames.arr0=this.randomNames.arr0.split(","),this.randomNames.arr1=this.randomNames.arr1.split(","),this.replaceString(this.items,["name","intro","origin"]),this.replaceString(this.countries,["name"]),this.replaceString(this.positions,["name"]),this.replaceString(this.buffers,["intro"]),this.replaceString(this.memorials,["intro"]),this.replaceString(this.ministers,["name","intro"]),this.replaceString(this.skills,["name"]),this.replaceString(this.peerages,["name"]),this.replaceString(this.princesses,["name"]),this.replaceString(this.techs,["name"]),this.replaceString(this.battleBuffers,["name"]),this.replaceString(this.fates,["name"]),this.replaceString(this.cities,["name"]),this.replaceString(this.tasks,["name","desc"]),this.replaceString(this.boss,["name"]),this.manqing12diEnabled||delete this.fates[4001];for(var n in this.peerages){var r=this.peerages[n];r.condition=r.condition.map(function(t){return{id:t,count:1}})}this.items[1]={id:1,name:"黄金",intro:"黄金",icon:1,quality:4,sub_type:0,type:0,usable:0,max:9999},this.items[2]={id:2,name:"银两",intro:"银两",icon:2,quality:4,sub_type:0,type:0,usable:0,max:9999},this.items[3]={id:3,name:"矿石",intro:"矿石",icon:3,quality:4,sub_type:0,type:0,usable:0,max:9999},this.items[4]={id:4,name:"疆土",intro:"疆土",icon:4,quality:4,sub_type:0,type:0,usable:0,max:9999},this.items[5]={id:5,name:"增幅丹",intro:"增幅丹",icon:5,quality:4,sub_type:0,type:0,usable:0,max:9999},this.items[6]={id:6,name:"兵力",intro:"兵力",icon:6,quality:4,sub_type:0,type:0,usable:0,max:9999},this.items[7]={id:7,name:"礼金",intro:"礼金",icon:7,quality:4,sub_type:0,type:0,usable:0,max:9999}},e.replaceString=function(t,e){var i=this;if(Array.isArray(t))t.forEach(function(t){i.replaceLine(t,e)});else for(var n in t)this.replaceLine(t[n],e)},e.replaceLine=function(t,e){e.forEach(function(e){t[e]=lang.string[t[e]]})},e.getLogoUrl=function(){return this.logoType?"-1"==this.logoType?null:this.EXTRA_ASSETS_URL+"/logo/"+this.logoType+".png":"login_logo"},e.getLoadingBgUrl=function(){return this.loadingBgType?this.EXTRA_ASSETS_URL+"/loading-bg/"+this.loadingBgType+".jpg":"loading_bg"},e.getLoginBgUrl=function(){return this.loginBgType?this.EXTRA_ASSETS_URL+"/login-bg/"+this.loginBgType+".jpg":"login_bg"},e.getCountryMeta=function(t){return this.countries[t]},e.getItemMeta=function(t){return this.items[t]},e.getItemMetaByExport=function(t){var e=null;for(var i in this.items)if(this.items[i]["export"]==t){e=this.items[i];break}return e},e.getItemLevelMeta=function(t,e){return this.getItemMeta(t).levels[e]},e.getCombinableItemMetas=function(){return alien.Utils.objectValues(this.items).filter(function(t){return!!t.material})},e.getMinisterMeta=function(t){return this.ministers[t]},e.getMinisterByQuality=function(t){var e=[];return this.ministerArray.forEach(function(i){i.quality==t&&e.push(i)}),e},e.getPositionMeta=function(t){return this.positions[t]},e.getOfficePositionsMetaByGroup=function(t){var e,i=1;MinisterService.positionGroup.some(function(n){return n.index==t?(e=n,!0):void(i+=n.count)});for(var n=[],r=i;r<i+e.count;r++)n.push(this.positions[r]);return n},e.getExpMeta=function(t,e){var i=this.exps[t];return alien.Utils.findArr(i,function(t){return t.level==e})},e.getSkillMeta=function(t){return this.skills[t]},e.transSkills=function(t){return t.map(function(t){var i=e.getSkillMeta(t.id);return i?i.name+"Lv."+t.level:void 0}).filter(function(t){return!!t}).join(" ")||lang.nothing},e.getSkillBuffers=function(t){return t.buffers.filter(function(t){return t>0}).map(function(t){return e.getBufferMeta(t)})},e.getSkillEffectStrs=function(t,e){var i=this.getSkillLevelMeta(t,e),n=[];return i&&this.getSkillBuffers(i).forEach(function(t){n.push(alien.StringUtils.format(t.intro,Math.abs(t.value)))}),n},e.getSkillEffectValue=function(t,i,n){var r=0,o=e.getSkillLevelMeta(t,i);return this.getSkillBuffers(o).forEach(function(t){t.type==n&&(r+=t.value)}),r},e.getSkillLevelMeta=function(t,e){var i=this.getSkillMeta(t);return i?alien.Utils.findArr(i.levels,function(t){return t.level==e}):null},e.getBufferMeta=function(t){return this.buffers[t]},e.getMemorialMeta=function(t){return this.memorials[t]},e.getStrongholdMeta=function(t){return this.strongholds[t]},e.getNextStrongholdId=function(t){var e=this.strongholdIds.indexOf(t+"");return this.strongholdIds[e+1]},e.getPeerageMeta=function(t){return this.peerages[t]},e.getPeerageMetaByLevel=function(t){var e=null;for(var i in this.peerages){var n=this.peerages[i];t>=n.level&&(e=n)}return e},e.getPrincessMeta=function(t){return this.princesses[t]},e.getFlowerMeta=function(t){return this.flowers[t]},e.getTechMeta=function(t){return this.techs[t]},e.getBattleBufferMeta=function(t){return this.battleBuffers[t]},e.getTechsByType=function(t){var e=[];for(var i in this.techs){var n=this.techs[i];n.type==t&&e.push(n)}return e},e.getTechNextId=function(t){for(var e in this.techs){var i=this.techs[e];if(i.levels[i.levels.length-1].next_id==t)return i}},e.getTechNextLevel=function(t,e){var i=this.techs[t],n=0;return i.levels.some(function(t){return t.next_id==e?(n=t.level,!0):void 0}),n},e.getTechLevelMeta=function(t,e){var i=this.techs[t].levels,n=null;return i.some(function(t){return t.level==e?(n=t,!0):void 0}),n},e.getClassMeta=function(t){return this.classes[t]},e.getShopItemMeta=function(t){return this.shop[t]},e.getShopByType=function(t){var e=[];for(var i in this.shop){var n=this.shop[i];n.shop_type==t&&e.push(n)}return e},e.getGiftPackMeta=function(t){return this.giftPacks[t]},e.getCityMeta=function(t){return this.cities[t]},e.getVisitMeta=function(t){return this.visit[t]},e.getVisitLevelMeta=function(t,e){var i=this.visit[t].levels,n=null;return i.some(function(t){return t.level==e?(n=t,!0):void 0}),n},e.getCityMaxLevel=function(t){var e=this.visit[t].levels,i=0;return e.forEach(function(t){t.level>=i&&(i=t.level)}),i},e.getTaskMeta=function(t){return this.tasks[t]},e.getTaskMetaByType=function(t){var e=[];for(var i in this.tasks){var n=this.tasks[i];n.type==t&&e.push(n)}return e},e.getNextTaskMeta=function(t){var e=null;for(var i in this.tasks){var n=this.tasks[i];if(n.next_id==t){e=n;break}}return e},e.getChestMeta=function(t){return this.chest[t]},e.getRankRewardMeta=function(t){return this.rankReward[t]},e.getRankRewardByRank=function(t){for(var e in this.rankReward){var i=this.rankReward[e];if(i.rank_min<=t&&i.rank_max>=t)return i.reward}},e.getExchangeByType=function(t){var e=[];for(var i in this.exchange){var n=this.exchange[i];n.type==t&&e.push(n)}return e},e.getExchangeMeta=function(t){return this.exchange[t]},e.getUnionExpMeta=function(t){return this.unionExp[t]},e.getVipMeta=function(t){return this.vip[t]},e.getBossMeta=function(t){return this.boss[t]},e.getDialogueMeta=function(t){return this.dialogue[t]},e.getEventMeta=function(t){return this.event[t]},e.getEventMetaByNextId=function(t){var e=null,i=function(i){var r=n.event[i];return r.options.some(function(i){return i.next_dialogue_id==t?(e=r,!0):void 0}),e?"break":void 0},n=this;for(var r in this.event){var o=i(r);if("break"===o)break}return e},e.judgeString=function(t){var e=/^[\w\u4e00-\u9fa5]+$/gi;return e.test(t)},e.princeRandomName=function(){var t=alien.MathUtils.getRandomFromArray(this.randomNames.arr0),e=alien.MathUtils.getRandomFromArray(this.randomNames.arr1);return t+e},e.getFateLevel=function(t){var e=0,i=0;return t.ids.forEach(function(t){ministerService.getByMetaId(t)&&i++}),1==t.type?i==t.ids.length&&(e=1,MinisterEntity.fateLevelUp.some(function(i){var n=!1;return t.ids.some(function(t){var e=ministerService.getByMetaId(t);return e.level<i?(n=!0,!0):void 0}),0==n?(e=i/50,!0):void 0})):e=i,e},e.goGoal=function(t){var e=!0;switch(t){case 1:case 15:case 16:case 17:case 57:e=SceneController["goto"](ConstantNames.SCENE_INTERIOR,{tab:1});break;case 2:e=SceneController["goto"](ConstantNames.SCENE_THRONE);break;case 3:case 48:case 49:case 50:e=SceneController["goto"](ConstantNames.SCENE_INTERIOR);break;case 4:case 39:case 40:case 42:case 51:e=SceneController["goto"](ConstantNames.SCENE_VISIT);break;case 5:case 26:case 52:if(!openService.getOpenStatus({name:"turn_card"}))return!1;SceneController["goto"](ConstantNames.SCENE_PRINCESS_HOUSE),alien.EgretUtils.callLater(function(){PanelPrincessTurnCard.instance.show()},10);break;case 6:case 10:case 30:case 31:case 32:case 36:case 53:case 54:case 55:e=SceneController["goto"](ConstantNames.SCENE_MINISTER);break;case 7:case 69:e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_RITE);break;case 8:case 70:e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_WORK);break;case 9:case 71:e=SceneController["goto"](ConstantNames.SCENE_GARDEN_FLOWER);break;case 11:case 47:e=SceneController["goto"](ConstantNames.SCENE_ARENA);break;case 12:case 44:case 63:e=SceneController["goto"](ConstantNames.SCENE_PRINCE);break;case 45:e=SceneController["goto"](ConstantNames.SCENE_PRINCE,{tab:1});break;case 13:case 18:case 23:case 28:e=SceneController["goto"](ConstantNames.SCENE_WORLD_MAP);break;case 14:case 19:case 21:case 22:PanelNationalPower.instance.show();break;case 20:case 27:PanelShop.instance.show();break;case 24:case 33:if(!openService.getOpenStatus({name:"minister_hire"}))return!1;SceneController["goto"](ConstantNames.SCENE_MINISTER,{tab:1});break;case 25:case 38:case 41:case 43:e=SceneController["goto"](ConstantNames.SCENE_PRINCESS);break;case 29:case 34:e=SceneController["goto"](ConstantNames.SCENE_TECHNOLOGY);break;case 35:case 68:e=SceneController["goto"](ConstantNames.SCENE_OFFICE);break;case 37:e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_POSITION);break;case 46:e=SceneController["goto"](ConstantNames.SCENE_OFFICE,{tab:1});break;case 56:e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_PARTY);break;case 58:case 59:case 60:var i={58:110007,59:110008,60:110009},n=ministerService.getByMetaId(i[t]);n&&(e=SceneController["goto"](ConstantNames.SCENE_MINISTER_INFO,{minister:n}));break;case 61:case 62:case 67:e=SceneController["goto"](ConstantNames.SCENE_TECHNOLOGY,{tab:2});break;case 64:e=SceneController["goto"](ConstantNames.SCENE_WORLD_MAP,{tab:1});break;case 65:e=SceneController["goto"](ConstantNames.SCENE_TECHNOLOGY,{tab:1});break;case 66:if(!openService.getOpenStatus({name:OpenService.OpenNames.RANK}))return!1;PanelRank.instance.show()}return e},e.defaultOption={WEB_SERVICE_URL:"http://192.168.1.131:3000",EXTRA_ASSETS_URL:"http://192.168.1.131/extra-assets"},e.channel="1",e.groupNumber="4836164",e.platform="bytz_"+currentFlavor,e.DEBUG=!0,e.logGuidePoint=!1,e.showServerLog=!1,e.examineEnabled=!1,e.guideEnabled=!0,e.antiAddictionEnabled=!1,e.manqing12diEnabled=!0,e.princessFilters=[],e.QUALITY_COLORS=[16777215,6010641,2796799,13921535,16746268],e.MINISTER_QUALITY_COLORS=[16777215,3641147,4547771,8409511,13072168],e.MINISTER_QUALITY_COLORS_2=[16777215,10682214,6729215,13860095,16751943],e.COLORS={red:15872285,green:6010641},e.OPEN_COLORS=[9145227,16746268],e.INTERIOR_COLORS=[11528448,2009320,15665417],e.currencyUnits=[{gold:1e8,unit:"亿"},{gold:1e4,unit:"万"}],e.PRINCESS_FIELD_COLORS={luck:16758837,charm:16758837,rite:7658272,culture:4370175,battle:16758837,position:16758837,all_round_ability:7658272},e.itemEffectMap={5:"exploit"},e.otherBodyOffset={100001:{x:205,y:405},100002:{x:168,y:400},100003:{x:175,y:355},100004:{x:305,y:370}},e.treasureTypes=[11,12,13],e.packListTypes=[[1,2,3,4,5,7,8,9,10,14,15,16,17],[6,11,12,13,18]],e.upgradeItemSourceTypes=[11,12,13,18],e.qualificationBooks={politics:600005,knowledge:600006,command:600007},e.shopTabs=[{icon:"item"},{icon:"gift"},{icon:"gold"},{icon:"vip",badgeId:"21340"}],e.lobby_bottom_bar=[{name:"activity",label:"活动",badgeId:"21111,21112,21113,21114,21115,21116,21120",state:"dynamic",width:142},{name:"mission",label:"任务",badgeId:"21210,21220,21230"},{name:"shop",label:"商城",badgeId:"21340"},{name:"warehouse",label:"国库",badgeId:"21400,21420"},{name:"battle",label:"开疆拓土",badgeId:"21520",state:"dynamic",width:233}],e.lobby_top_bar=[{name:"rank",label:"",badgeId:"24210,24220,24230,24240",activityTypeList:[]},{name:"prison",label:"",badgeId:"",activityTypeList:[6]},{name:"preferential",label:"",showGlow:!0,badgeId:"",activityTypeList:[11,12,13,14]},{name:"limit",label:"",showGlow:!0,badgeId:"21601,21602,21603,21604,21605,21606,21607,21608,21609,21610,21611,21612,21613,21614,21615,21616,21617,21618,21619",activityTypeList:[15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]},{name:"boss",label:"",showGlow:!0,badgeId:"",activityTypeList:[],startTime:[20,0,0,0],endTime:[20,30,0,0]},{name:"burnIncense",label:"",showGlow:!0,badgeId:"",activityTypeList:[35]}],e.arenaHistoryTabs=[{label:"来访信息"},{label:"仇人"}],e.panelChatTabs=[{label:"世界",badgeId:"12100"},{label:"联盟",badgeId:"12200"}],e.panelRankTabs=[{label:"国力榜",badgeId:"24210"},{label:"大臣榜",badgeId:"24220"},{label:"妃子榜",badgeId:"24230"},{label:"疆土榜",badgeId:"24240"}],e.hireConfigs=[null,null,{value:function(){return mainService.playerInfo.national_power},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.getClassifySum("trade")},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.getClassifySum("industry")},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.getClassifySum("military")},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.playerInfo.area},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.playerInfo.harem},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.playerInfo.silver},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.playerInfo.mineral},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.playerInfo.vip},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return packService.getCountByMetaId(600100)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(371,0)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return princessService.princesses.length},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return battleService.country.id},progress:function(t,e){return{total:1,value:t}},judgeReach:function(t,e){return t>e}},{value:function(){return mainService.playerInfo.gold},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(370,0)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(370,1)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(370,2)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(353,5)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(351,0)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(370,3)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(370,4)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return ministerService.getHireCondition(351,2)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return mainService.playerInfo.gold},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}},{value:function(){return packService.getCountByMetaId(600111)},progress:function(t,e){return{total:e,value:t}},judgeReach:function(t,e){return t>=e}}],__decorate([modifyEnabled],e,"logGuidePoint",void 0),__decorate([modifyEnabled],e,"showServerLog",void 0),__decorate([modifyEnabled],e,"examineEnabled",void 0),__decorate([modifyEnabled],e,"guideEnabled",void 0),__decorate([modifyEnabled],e,"antiAddictionEnabled",void 0),__decorate([modifyEnabled],e,"manqing12diEnabled",void 0),__decorate([modifyEnabled],e,"princessFilters",void 0),__decorate([decArray],e,"shopTabs",void 0),__decorate([decArray],e,"lobby_bottom_bar",void 0),__decorate([decArray],e,"lobby_top_bar",void 0),__decorate([decArray],e,"arenaHistoryTabs",void 0),__decorate([decArray],e,"panelChatTabs",void 0),__decorate([decArray],e,"panelRankTabs",void 0),e}(egret.HashObject);__reflect(GameConfig.prototype,"GameConfig");var LanguagePack=function(){function t(){}return t}();__reflect(LanguagePack.prototype,"LanguagePack");var LanguageIds=function(){function t(){this.year="year",this.month="month",this.day="day",this.sky="sky",this.hour="hour",this.minutes="minutes",this.second="second",this.format_y_m_d="format_y_m_d",this.confirm="confirm",this.cancel="cancel",this.sorry="sorry",this.zh_num="zh_num",this.nothing="nothing",this.value="value",this.unit="unit",this.score="score",this.time="time",this.exp="exp",this.impose="impose",this.cost="cost",this.ten_thousand="ten_thousand",this.hundred_million="hundred_million",this.upgrade="upgrade",this.area="area",this.area_close="area_close",this.select_server="select_server",this.waiting="waiting",this.alert_select_server="alert_select_server",this.server_closed="server_closed",this.server_pending="server_pending",this.title_symbol="title_symbol",this.area_states="area_states",this.area_state_colors="area_state_colors",this.count_fraction="count_fraction",this.count="count",this.count_brackets="count_brackets",this.success_rate="success_rate",this.complete="complete",this.notice="notice",this.in_verify="in_verify",this.in_login="in_login",this.loginouting="loginouting",this.register_success="register_success",this.register_failed="register_failed",this.agree_tos="agree_tos",this.recharging="recharging",this.recharge_failed="recharge_failed",this.recharge_success="recharge_success",this.reconnect_tips="reconnect_tips",this.account_server_connect_tips="account_server_connect_tips",this.input_error="input_error",this.full_level="full_level",this.too_many_material="too_many_material",this.closed="closed",this.setting_game_items="setting_game_items",this.setting_notify_items="setting_notify_items",this.tips="tips",this.verify_errors="verify_errors",this.response_error="response_error",this.api_error="api_error",this.item_type="item_type",this.open_tip="open_tip",this.item_treasure_intro="item_treasure_intro",this.dispatching="dispatching",this.develop="develop",this.lv="lv",this.level="level",this.quality="quality",this.qualification="qualification",this.no_position="no_position",this.skill="skill",this.stronghold="stronghold",this.level_up="level_up",this.peerage="peerage",this.level_max="level_max",this.level_upper="level_upper",this.qualification_addition="qualification_addition",this.skill_level="skill_level",this.tech_condition="tech_condition",this.tech_condition_details="tech_condition_details",this.vip_condition="vip_condition",this.sum_troops="sum_troops",this.warehouse="warehouse",this.interior="interior",this.minister="minister",this.arena="arena",this.throne="throne",this.technology="technology",this.prince="prince",this.princess="princess",this.princess_position="princess_position",this.princess_house="princess_house",this.princess_work="princess_work",this.princess_rite="princess_rite",this.princess_party="princess_party",this.garden_house="garden_house",this.garden_flower="garden_flower",this.private_visit="private_visit",this.office="office",this.setting="setting",this.world_map="world_map",this.national_power="national_power",this.minister_info="minister_info",this.princess_info="princess_info",this.minister_details="minister_details",this.minister_skill="minister_skill",this.treasure="treasure",this.prison="prison",this.union="union",this.burn_incense="burn_incense",this.panel_use_item="panel_use_item",this.panel_buy_item="panel_buy_item",this.panel_combine_item="panel_combine_item",this.panel_give_normal_item="panel_give_normal_item",this.panel_select_minister="panel_select_minister",this.panel_select_rite_minister="panel_select_rite_minister",this.panel_dispatch_minister="panel_dispatch_minister",this.panel_item_details="panel_item_details",this.panel_peerage="panel_peerage",this.panel_alert="panel_alert",this.panel_princess_skill="panel_princess_skill",this.panel_rule_intro="panel_rule_intro",this.panel_princess_manager="panel_princess_manager",this.panel_select_princess="panel_select_princess",this.panel_arena_history="panel_arena_history",this.panel_arena_ranking="panel_arena_ranking",this.panel_select_flower="panel_select_flower",this.panel_tech_info="panel_tech_info",this.panel_prince_appoint="panel_prince_appoint",this.panel_prince_exile="panel_prince_exile",this.panel_prince_open="panel_prince_open",this.panel_prince_rename="panel_prince_rename",this.panel_anti_addiction="panel_anti_addiction",this.panel_add_buffer="panel_add_buffer",this.panel_email="panel_email",this.panel_develop_city="panel_develop_city",this.panel_city_info="panel_city_info",this.panel_chat="panel_chat",this.panel_season_award="panel_season_award",this.panel_change_icon="panel_change_icon",this.panel_cash_gift_shop="panel_cash_gift_shop",this.panel_speed="panel_speed",this.panel_join_union="panel_join_union",this.panel_build_union="panel_build_union",this.panel_union_welfare="panel_union_welfare",this.panel_union_info="panel_union_info",this.panel_union_rank="panel_union_rank",this.panel_union_tech="panel_union_tech",this.panel_union_contribute="panel_union_contribute",this.panel_union_shop="panel_union_shop",this.panel_item_upgrade="panel_item_upgrade",this.panel_union_duplicate="panel_union_duplicate",this.panel_union_log="panel_union_log",this.panel_player_info="panel_player_info",this.panel_score_exchange="panel_score_exchange",this.panel_activity_shop="panel_activity_shop",this.development_addition="development_addition",this.capture="capture",this.item_use_tips="item_use_tips",this.combine_success="combine_success",this.minister_info_fields="minister_info_fields",this.minister_state="minister_state",this.minister_specialty_type="minister_specialty_type",this.minister_give_treasure="minister_give_treasure",this.upgrade_treasure_tip="upgrade_treasure_tip",this.princess_info_fields="princess_info_fields",this.princess_state="princess_state",this.country_info_fields="country_info_fields",this.player_info_fields="player_info_fields",this.country_props="country_props",this.country_props_fields="country_props_fields",this.develop_desc="develop_desc",this.development_finish_content="development_finish_content",this.impose_props="impose_props",this.national_power_props="national_power_props",this.national_strength="national_strength",this.lobby_icon_name="lobby_icon_name",this.troops="troops",this.critical="critical",this.fight_value="fight_value",this.arena_troops="arena_troops",this.minister_count="minister_count",this.login_account_errors="login_account_errors",this.minister_level_up_condition="minister_level_up_condition",this.minister_ability_fields="minister_ability_fields",this.minister_quality_name="minister_quality_name",this.minister_all_ability="minister_all_ability",this.hire_condition="hire_condition",this.hire_progress="hire_progress",this.minister_hire_conditions="minister_hire_conditions",this.hire_minister_alert="hire_minister_alert",this.minister_upgrade_failed="minister_upgrade_failed",this.minister_fate_effects="minister_fate_effects",this.minister_fate_type="minister_fate_type",this.minister_fate_condition="minister_fate_condition",this.minister_fate_un_active="minister_fate_un_active",this.minister_fate_coming_soon="minister_fate_coming_soon",this.minister_class_condition="minister_class_condition",this.minister_full_ability="minister_full_ability",this.minister_office_class="minister_office_class",this.minister_skill_upgrade_success="minister_skill_upgrade_success",this.minister_skill_upgrade_failed="minister_skill_upgrade_failed",this.minister_give_equipment="minister_give_equipment",this.minister_remove_equipment="minister_remove_equipment",this.go_world_map="go_world_map",this.battle_no_master_general="battle_no_master_general",this.battle_reward_content="battle_reward_content",this.battle_fail_upgrade_ways="battle_fail_upgrade_ways",this.queue_count="queue_count",this.battle_playing_notice="battle_playing_notice",this.memorial_effects="memorial_effects",this.no_more_memorial="no_more_memorial",this.princess_hire_ways="princess_hire_ways",this.princess_hire_go="princess_hire_go",this.hire_princess_condition="hire_princess_condition",this.luck_alert_content="luck_alert_content",this.skill_open_condition="skill_open_condition",this.skill_upgrade_condition="skill_upgrade_condition",this.help="help",this.princess_positions="princess_positions",this.please_select_teacher="please_select_teacher",this.can_not_switch_teacher="can_not_switch_teacher",this.rite_alert_content="rite_alert_content",this.rite_speed_up_alert_content="rite_speed_up_alert_content",this.energy="energy",this.unhappy_alert_content="unhappy_alert_content",this.speed_alert_content="speed_alert_content",this.speed_success="speed_success",this.princess_work_btn_fields="princess_work_btn_fields",this.princess_work_state_fields="princess_work_state_fields",this.princess_work_reward_content="princess_work_reward_content",this.arena_battle_order="arena_battle_order",this.arena_minister_words="arena_minister_words",this.arena_score="arena_score",this.arena_result_notice="arena_result_notice",this.arena_no_more_all_value="arena_no_more_all_value",this.arena_history_title="arena_history_title",this.arena_history_content="arena_history_content",this.arena_history_result="arena_history_result",this.arena_history_national_power="arena_history_national_power",this.arena_addition_field="arena_addition_field",this.arena_global_history_content="arena_global_history_content",this.arena_result_success="arena_result_success",this.arena_result_failed="arena_result_failed",this.arena_abandon="arena_abandon",this.flower_alert_content="flower_alert_content",this.arena_no_more_chances="arena_no_more_chances",this.arena_no_available_minister="arena_no_available_minister",this.arena_countdown="arena_countdown",this.wait_select="wait_select",this.alert_do_challenge="alert_do_challenge",this.alert_add_challenge_item="alert_add_challenge_item",this.alert_add_challenge_gold="alert_add_challenge_gold",this.season_name="season_name",this.season_award_title="season_award_title",this.prince_teacher_notice="prince_teacher_notice",this.prince_exile_notice="prince_exile_notice",this.prince_teacher_tip="prince_teacher_tip",this.prince_info_fields="prince_info_fields",this.prince_btn_label="prince_btn_label",this.prince_tribute="prince_tribute",this.prince_seat="prince_seat",this.prince_rename="prince_rename",this.prince_seat_alert_content="prince_seat_alert_content",this.prince_quality="prince_quality",this.prince_peerage="prince_peerage",this.prince_none="prince_none",this.prince_rename_success="prince_rename_success",this.anti_addiction_content="anti_addiction_content",this.tech_queue="tech_queue",this.tech_full_level="tech_full_level",this.tech_knowledge_needs="tech_knowledge_needs",this.tech_mineral_needs="tech_mineral_needs",this.tech_have="tech_have",this.shop_limit="shop_limit",this.shop_yuan="shop_yuan",this.shop_get_everyday="shop_get_everyday",this.shop_gold_get="shop_gold_get",this.shop_last_day="shop_last_day",this.shop_original="shop_original",this.shop_success="shop_success",this.vip_desc="vip_desc",this.vip_need_content="vip_need_content",this.visit_output="visit_output",this.visit_like_value="visit_like_value",this.visit_current="visit_current",this.visit_walking="visit_walking",this.visit_goal="visit_goal",this.visit_luck="visit_luck",this.visit_not_in_city="visit_not_in_city",this.visit_princess_like_contents="visit_princess_like_contents",this.visit_princess_state="visit_princess_state",this.visit_treasure_level="visit_treasure_level",this.visit_treasure_alert_content="visit_treasure_alert_content",this.visit_people_alert_content="visit_people_alert_content",this.task_state="task_state",this.task_button_label="task_button_label",this.task_type="task_type",this.chat_type="chat_type",this.chat_union_tip="chat_union_tip",this.chat_time="chat_time",this.sign_month="sign_month",this.sign_total_day="sign_total_day",this.sign_day="sign_day",this.party_join_tip="party_join_tip",this.party_theme="party_theme",this.princess_party_rank_content="princess_party_rank_content",this.princess_party_log="princess_party_log",this.party_skill_desc="party_skill_desc",this.party_skill="party_skill",this.refresh_gift_shop_notice="refresh_gift_shop_notice",this.party_invite="party_invite",this.party_start_notice="party_start_notice",this.party_invite_notice="party_invite_notice",this.cash_shop_alert_content="cash_shop_alert_content",this.treasure_buy_alert_content="treasure_buy_alert_content",this.treasure_buy_rule="treasure_buy_rule",this.rank_worship_content="rank_worship_content",this.activity_none="activity_none",this.activity_effective_time="activity_effective_time",this.activity_rank_time="activity_rank_time",this.activity_rank_none="activity_rank_none",this.activity_desc="activity_desc",this.activity_tabBar_name="activity_tabBar_name",this.activity_btn_name="activity_btn_name",this.activity_name="activity_name",this.activity_preferential_title="activity_preferential_title",this.activity_charge_title="activity_charge_title",this.activity_sum_charge_title="activity_sum_charge_title",this.activity_sum_charge_now="activity_sum_charge_now",this.activity_prison_state="activity_prison_state",this.activity_test_content="activity_test_content",this.prison_tip="prison_tip",this.activity_limit_reward_title="activity_limit_reward_title",this.activity_interval_time="activity_interval_time",this.copy_success="copy_success",this.union_build_error="union_build_error",this.union_join_tip="union_join_tip",this.union_notice="union_notice",this.union_tech_point="union_tech_point",this.union_tech="union_tech",this.union_position="union_position",this.union_time="union_time",this.union_apply_tip="union_apply_tip",this.union_contribute_name="union_contribute_name",this.union_need_level="union_need_level",this.union_contribute="union_contribute",this.union_shop_alert_content="union_shop_alert_content",this.union_apply_join_tip="union_apply_join_tip",this.union_online_state="union_online_state",this.union_log_format="union_log_format",this.union_shop_tip="union_shop_tip",this.union_shop_condition="union_shop_condition",this.union_leave_alert_content="union_leave_alert_content",this.union_dismiss_alert_content="union_dismiss_alert_content",this.union_transfer_alert_content="union_transfer_alert_content",this.union_kick_alert_content="union_kick_alert_content",this.union_position_full_tip="union_position_full_tip",this.union_contribute_success="union_contribute_success",this.union_tech_upgrade_success="union_tech_upgrade_success",this.union_kick_success="union_kick_success",this.union_duplicate_rules="union_duplicate_rules",this.union_duplicate_rank_label="union_duplicate_rank_label",this.duplicate_use_skill_alert="duplicate_use_skill_alert",this.duplicate_end="duplicate_end",this.duplicate_close="duplicate_close",this.duplicate_skill_success="duplicate_skill_success",this.boss_killed_box="boss_killed_box",this.open_name="open_name",this.new_open_panel_btn="new_open_panel_btn",this.task_type_no_brackets="task_type_no_brackets",this.finish_tips="finish_tips",this.boss_name="boss_name",this.world_boss_rules="world_boss_rules",this.burn_incense_time="burn_incense_time",this.burn_popular="burn_popular",this.incense_rank_reward="incense_rank_reward",this.notice_format="notice_format"
}return t}();__reflect(LanguageIds.prototype,"LanguageIds");var alien;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.recyclerImage=[],e._dataFormat=egret.HttpResponseType.TEXT,e}return __extends(e,t),e.prototype.getRes=function(t){var e=this.fileDic[t];return e},e.prototype.onLoadFinish=function(t){var e=t.target,i=this.resItemDic[e.$hashCode];delete this.resItemDic[e.hashCode];var n=i.item,r=i.func;if(n.loaded=t.type==egret.Event.COMPLETE,n.loaded)if(i.type){switch(i.type){case"texPng":var o=new egret.Texture;o.bitmapData=e.data,i.tex.png=o,this.recyclerImage.push(e),n.loaded=this.check(i);break;case"texJson":i.tex.json=JSON.parse(e.response),this.recycler.push(e),n.loaded=this.check(i)}if(!n.loaded)return}else{n.loaded=!1;var s=this.analyzeConfig(n,e.response);if(s)return i.tex={},this.loadImage(s,i),this.loadJson(s,i),void this.recycler.push(e)}r.call(i.thisObject,n)},e.prototype.check=function(t){var e=t.tex,i=e.png&&e.json;return i&&dragonBones.EgretFactory.factory.parseTextureAtlasData(e.json,e.png),i},e.prototype.analyzeConfig=function(t,e){var i,n="";try{var r=e;i=JSON.parse(r)}catch(o){egret.$warn(1017,t.url,e)}return i&&(dragonBones.EgretFactory.factory.parseDragonBonesData(i),n=this.getRelativePath(t.url,i.name)),n},e.prototype.getRelativePath=function(t,e){t=t.split("\\").join("/");var i=t.match(/#.*|\?.*/),n="";i&&(n=i[0]);var r=t.lastIndexOf("/");return t=-1!=r?t.substring(0,r+1):e,t+n},e.prototype.destroyRes=function(t){return dragonBones.EgretFactory.factory.removeTextureAtlasData(t,!0),!0},e.prototype.loadImage=function(t,e){var i=this.getImageLoader();this.resItemDic[i.hashCode]={func:e.func,item:e.item,thisObject:e.thisObject,type:"texPng",tex:e.tex},i.load(RES.$getVirtualUrl(t+"tex.png"))},e.prototype.getRequestEx=function(){var t=this.recycler.pop();return t||(t=new egret.HttpRequest,t.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t.responseType=this._dataFormat,t},e.prototype.loadJson=function(t,e){var i=this.getRequestEx();this.resItemDic[i.hashCode]={func:e.func,item:e.item,thisObject:e.thisObject,type:"texJson",tex:e.tex},i.open(RES.$getVirtualUrl(t+"tex.json")),i.send()},e.prototype.getImageLoader=function(){var t=this.recyclerImage.pop();return t||(t=new egret.ImageLoader,t.addEventListener(egret.Event.COMPLETE,this.onLoadFinish,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadFinish,this)),t},e.prototype.onResourceDestroy=function(t){t&&t.dispose()},e}(RES.BinAnalyzer);t.DGBAnalyzer=e,__reflect(e.prototype,"alien.DGBAnalyzer")}(alien||(alien={}));var alien;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._dataFormat=egret.HttpResponseType.ARRAY_BUFFER,t}return __extends(i,e),i.prototype.getRes=function(t){var e=this.fileDic[t];if(!e){var i=RES.AnalyzerBase.getStringPrefix(t);if(e=this.fileDic[i]){var n=RES.AnalyzerBase.getStringTail(t);e=e.getTexture(n)}}return e},i.prototype.onLoadFinish=function(t){var e=this,i=t.target,n=this.resItemDic[i.$hashCode];delete this.resItemDic[i.hashCode];var r=n.item,o=n.func;return r.loaded=t.type==egret.Event.COMPLETE,r.loaded?(r.loaded=!1,void this.parseEMC(r,i.response).then(function(){r.loaded=!0,e.recycler.push(i),o.call(n.thisObject,r)})):(this.recycler.push(i),void o.call(n.thisObject,r))},i.prototype.parseEMC=function(e,i){return t.MovieClipDataFactory.instance.addData(e.name,i)},i.prototype.destroyRes=function(e){return t.MovieClipDataFactory.instance.destroyData(e)},i.prototype.onResourceDestroy=function(t){t&&t.dispose()},i}(RES.BinAnalyzer);t.EMCAnalyzer=e,__reflect(e.prototype,"alien.EMCAnalyzer")}(alien||(alien={}));var Server=function(t){function e(){var e=t.call(this)||this;return e.showLog=GameConfig.showServerLog,e.logFilterReg=/\b((?!HeartBeat)\w)+\b/,e.init(),e}return __extends(e,t),e.prototype.init=function(){this._protocol=CommonProtocol.instance;var t=this._protocol;t.nameToMessageId(protocols.MSG_CONNECTED,256),t.nameToMessageId(protocols.MSG_AUTHED,256),this._socket=new egret.WebSocket,this._socket.type=egret.WebSocket.TYPE_BINARY,this._socket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this._socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketData,this)},e.prototype.addEventListener=function(e,i,n,r,o){var s=e;"object"==typeof e&&(this._protocol.nameToMessageId(e,256),s=e.name),t.prototype.addEventListener.call(this,s,i,n,r,o)},e.prototype.removeEventListener=function(e,i,n,r){t.prototype.removeEventListener.call(this,e.name,i,n,r)},Object.defineProperty(e.prototype,"lastMessage",{get:function(){return this._lastMessage},enumerable:!0,configurable:!0}),e.prototype.connect=function(){this.connected?this.onConnect():(this._socket.connectByUrl(this._serverUrl),this.showLog&&console.log("try connect to "+this._serverUrl))},e.prototype.close=function(){this.connected&&(this._closeBySelf=!0,this._socket.close())},Object.defineProperty(e.prototype,"connected",{get:function(){return this._socket.connected},enumerable:!0,configurable:!0}),e.prototype.onConnect=function(t){void 0===t&&(t=null),this.showLog&&console.log("onConnect"),this.connectToServer(),this.dispatchEventWith(EventNames.SOCKET_CONNECTED)},e.prototype.onClose=function(t){this.showLog&&console.log("closed"),this.dispatchEventWith(EventNames.SOCKET_CLOSED),this._closeBySelf=!1},e.prototype.onError=function(t){this.showLog&&console.log("error"),this.dispatchEventWith(EventNames.SOCKET_ERROR)},e.prototype.logFilter=function(t){return t.match(this.logFilterReg)},e.prototype.onSocketData=function(t){var e=ByteArray.create();this._socket.readBytes(e);var i=this._protocol.decode({bytes:e});i&&(this.showLog&&this.logFilter(i.name)&&(EgretBridge.isNative?console.log("get:"+i.name+" "+JSON.stringify(i.body)):console.log("%cget:","color: #d0c400",i.name,i.body)),this._lastMessage={name:i.name,body:i.body},this.dealMessage(i),this.dispatchEventWith(i.name,!1,i.body))},e.prototype.dealMessage=function(t){switch(t.body.error>0&&alien.Dispatcher.dispatch(EventNames.HIDE_WAITING),t.name){case"MSG_CONNECTED":this.send(protocols.MSG_AUTH,{clientId:t.body.clientId,clientType:0},0,102008e3)}},e.prototype.send=function(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=0/0),this._lastMessage={name:t,body:e},this.showLog&&this.logFilter(t.name)&&(EgretBridge.isNative?console.log("send:"+t.name+" "+JSON.stringify(e)):console.log("%csend:","color: #00b909",t.name,e));var r=this._protocol.encode({message:t,data:e,serverType:i,id:n||dataCenterService.accountId});this._socket.writeBytes(r)},e.prototype.connectToServer=function(){this.send(protocols.MSG_CONNECT,null,0,102008e3)},e.SERVER_TYPE={NONE:0,CLIENT:1,REMOTESERVER:2,ZONESERVER:3,ACCOUNTSERVER:4,WORLDSERVER:5,GATESERVER:6,GAMESERVER:7,REGAMESERVER:8,DATAAGENT:9,LOGSERVER:10,CHATSERVER:13},e}(egret.EventDispatcher);__reflect(Server.prototype,"Server");var WebService=function(){function t(){this._cache={}}return t.prototype.callApi=function(t,e,i,n,r){var o=this;void 0===i&&(i=null),void 0===n&&(n="post"),void 0===r&&(r=!0),i||(i={});var s=GameConfig.WEB_SERVICE_URL+"/"+t+"/"+e,a=n+">"+s;if(!r&&this._cache[a])return Promise.resolve(this._cache[a]);var c="post"==n?alien.Ajax.POST:alien.Ajax.GET;return c.call(alien.Ajax,s,i).then(function(t){var e=JSON.parse(t);return e.code>0?(GameConfig.DEBUG&&console.log(s,e.code,e.msg),Promise.reject(e.code)):(r||(o._cache[a]=e.data),e.data)},function(t){return GameConfig.DEBUG&&console.log(t),Promise.reject(t)})},t.prototype.authorize=function(t,e){return this.callApi("user","authorize",{account:t,password:e})},t.prototype.saveLastServer=function(t){return this.callApi("user","save-last-server",{accountId:dataCenterService.accountId,id:t})},t.prototype.authorizeByChannel=function(t){return this.callApi("user","authorize-by-channel",{code:t,channel:GameConfig.channel})},t.prototype.register=function(t,e){return this.callApi("user","register",{account:t,password:e})},t.prototype.getServerList=function(){return this.callApi("game","server-list",{channel:GameConfig.channel},"get",!1)},t.prototype.getNoticeList=function(){return this.callApi("game","notice-list",{channel:GameConfig.channel},"get",!1)},t.prototype.getRechargeConfig=function(){return this.callApi("game","recharge-list",null,"get",!1)},t.prototype.exchangeCodeGift=function(t){return this.callApi("game","exchange-code-gift",{code:t,token:dataCenterService.token,player_id:dataCenterService.pid},"post")},t.prototype.createOrder=function(t,e,i){return this.callApi("game","create-order",{sid:e,channel:i,pid:t,uid:dataCenterService.pid},"post")},t.prototype.logEvent=function(t,e,i,n){void 0===e&&(e=null);var r={name:t,data:JSON.stringify(e),id:Tools.uuid,cid:GameConfig.channel,aid:i,pid:n};return this.callApi("analytics","log-event",r,"post")},t.prototype.sendError=function(t,e){return this.callApi("game","error-track",{env:t,content:e})},t}();__reflect(WebService.prototype,"WebService");var RankService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rankActivityTime=385,e.rankList=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,ProtocolConfigs.WC_OPENTOP_RESPONSE,this.onOpenTopResponse,this),this.registerEvent(gameServer,ProtocolConfigs.WC_UPTOP_RESPONSE,this.onUpTopResponse,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this)},e.prototype.onOpenTopResponse=function(t){this.rankList=t.data.rankList,t.data.self.length>0&&(this.self=t.data.self[0])},e.prototype.onUpTopResponse=function(t){},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24210,count:this.getBadgeCount(e.RankType.TYPE_POWER_NATIONAL)}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24220,count:this.getBadgeCount(e.RankType.TYPE_MINISTER)}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24230,count:this.getBadgeCount(e.RankType.TYPE_PRINCESS)}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24240,count:this.getBadgeCount(e.RankType.TYPE_ARENA)})},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":this.updateBadge();break;default:this.rankActivityTime==t.data.activityTime.id&&(this.dispatchEventWith(EventNames.UPDATE_RANK_WORSHIP),this.updateBadge())}},e.prototype.getBadgeCount=function(t){var e=0;return this.getWorshipStateByType(t)&&(e=1),e},e.prototype.getWorshipStateByType=function(t){var i=!0,n=activityTimeService.getById(this.rankActivityTime);if(n){var r=0;switch(t){case e.RankType.TYPE_POWER_NATIONAL:r=255&n["int"];break;case e.RankType.TYPE_MINISTER:r=n["int"]>>8&255;break;case e.RankType.TYPE_PRINCESS:r=n["int"]>>16&255;break;case e.RankType.TYPE_ARENA:r=n["int"]>>24&255}r>0&&(i=!1)}return i},e.prototype.openTop=function(t){gameServer.send(protocols.CW_OPENTOP_REQUEST,{type:t})},e.prototype.upTop=function(t){gameServer.send(protocols.CW_UPTOP_REQUEST,{type:t})},e.RankType={TYPE_POWER_NATIONAL:2,TYPE_MINISTER:3,TYPE_PRINCESS:4,TYPE_ARENA:5,TYPE_POWER_NATIONAL_UP:6,TYPE_MINISTER_UP:7,TYPE_PRINCESS_UP:8,TYPE_ARENA_UP:9,TYPE_BURN_PERSON:10,TYPE_BURN_UNION:11},e}(Service);__reflect(RankService.prototype,"RankService");var TopSceneBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);try{this.addChildAt(this.topSceneContainer=new TopSceneContainer,0),this.topSceneContainer.currentState=this.showFrame()?"frame":"pure";var e=this.topSceneContainer,i=e.grpTop,n=e.labTitle,r=e.grpTopRight,o=e.btnClose,s=e.btnHelp;this.btnClose=o,this.btnHelp=s,this.addChild(i),this.addHelpBtn(),this.topSceneContainer.percentWidth=this.topSceneContainer.percentHeight=100;var a=this.getCloseButtonSkin();a&&(this.btnClose.skinName=a),this.btnClose.visible=!!a,n.text=this.getTitle(),this.registerEvent(r,egret.TouchEvent.TOUCH_TAP,this.onGrpTopRightTap,this)}catch(c){console.log(c)}},e.prototype.onPlayEnter=function(){this.topSceneContainer.onPlayEnter()},e.prototype.onPlayLeave=function(){this.topSceneContainer.onPlayLeave()},e.prototype.addHelpBtn=function(){this.btnHelp.visible=!!this.getHelp()},e.prototype.onGrpTopRightTap=function(t){switch(t.target.name){case"close":this.onClose();break;case"help":this.onBtnHelpTap()}},e.prototype.getBackParameters=function(){return null},e.prototype.showFrame=function(){return!0},e.prototype.getTitle=function(){return""},e.prototype.getHelp=function(){return""},e.prototype.getCloseButtonSkin=function(){return ui.CloseButtonSkin},e.prototype.active=function(){t.prototype.active.call(this),this.topSceneContainer.enableEvents()},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.topSceneContainer.disableEvents()},e.prototype.onBtnHelpTap=function(){var t=this.getHelp();PanelRuleIntro.instance.show({contents:lang.help[t]})},e.prototype.onClose=function(){this.back(this.getBackParameters())},e}(SceneBase);__reflect(TopSceneBase.prototype,"TopSceneBase");var TopSceneContainer=function(t){function e(){var e=t.call(this)||this;return e.skinName=scenes.SceneContainerSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onPlayEnter=function(){this.enter&&this.enter.play(0)},e.prototype.onPlayLeave=function(){this.leave&&this.leave.play(0)},e}(alien.EventComponent);__reflect(TopSceneContainer.prototype,"TopSceneContainer");var EffectItemView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.showEffect=function(t){var e=GameConfig.getItemMeta(t),i=1e3+e.quality;RES.getResAsync("item_effect_"+i,function(){this.effect.aniName=i.toString()},this)},e.prototype.setData=function(t){this.itemView.setData(t),this.showEffect(t.id)},e}(alien.EventComponent);__reflect(EffectItemView.prototype,"EffectItemView");var PlayerPropView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPropsModified,this),this.btnAdd&&this.registerEvent(this.btnAdd,egret.TouchEvent.TOUCH_TAP,this.onBtnAddTap,this),this.updateField(),this.update()},e.prototype.getWave=function(){return this._wave||(this._wave=new alien.Wave(this.btnAdd,2e3,alien.Wave.zoom.bind(null,.05),0,!1)),this._wave},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this.update()},e.prototype.onBtnAddTap=function(t){this.dispatchEventWith(EventNames.PROPVIEW_TAP_ADD)},e.prototype.update=function(){this.onPropsModified()},e.prototype.playNotice=function(){this.getWave().play()},e.prototype.stopNotice=function(){this.getWave().stop()},Object.defineProperty(e.prototype,"field",{get:function(){return this._field},set:function(t){this._field=t,this.updateField()},enumerable:!0,configurable:!0}),e.prototype.updateField=function(){this.imgIcon&&(this.imgIcon.source="icon_"+this._field)},e.prototype.updateValue=function(t){Array.isArray(t)?this.labValue.textFlow=t:this.labValue.text=wsy.Utils.shortCurrency(t)},e.prototype.onPropsModified=function(t){void 0===t&&(t=null);var e,i;t&&t.data?(e=t.data.field,i=t.data.value,Array.isArray(this._field)?this._field.indexOf(e)>=0&&this.updateValue(i):this._field==e&&this.updateValue(i)):this._field&&(Array.isArray(this._field)?this.updateValue(0):(i=mainService.playerInfo[this._field],isNaN(i)||this.updateValue(i)))},e}(alien.VisualEventComponent);__reflect(PlayerPropView.prototype,"PlayerPropView");var alien;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._pupUpStack=[],t}return __extends(i,e),Object.defineProperty(i,"instance",{get:function(){return void 0==i._instance&&(i._instance=new i),i._instance},enumerable:!0,configurable:!0}),i.addPopUp=function(t,e,n,r,o,s){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=!0),void 0===s&&(s=null),i.instance.addPopUp(t,e,n,r,o,s)},i.removePopUp=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null),i.instance.removePopUp(t,e,n)},i.removeTopPupUp=function(){return i.instance.removeTopPupUp()},i.removeAllPupUp=function(){i.instance.removeAllPupUp()},i.prototype.init=function(e){this._popLayer=e,this._popLayer.width=t.StageProxy.width,this._popLayer.height=t.StageProxy.height,t.StageProxy.stage.addEventListener(egret.Event.RESIZE,this.onStageResize,this)},i.prototype.onStageResize=function(e){void 0===e&&(e=null),this._modalMask&&(this._modalMask.width=t.StageProxy.stage.stageWidth,this._modalMask.height=t.StageProxy.stage.stageHeight)},i.prototype.addPopUp=function(e,n,r,o,s,a){if(void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=!0),void 0===a&&(a=null),!e.parent){var c=0==this._pupUpStack.length,l=this.topPupUp;l&&l.inactive&&l.inactive(),this.modalConfig=t.Utils.combineProp(i.defaultModalConfig,a),this._pupUpStack.unshift({target:e,modalTouchFun:o,modal:s}),this.updateModalMask(this._pupUpStack[0]);var p=this.createEffectInstance(n);p.show(e,this._popLayer,function(){e.active&&e.active()},this,r),c&&this.dispatchEventWith(i.POPUP_SHOW)}},i.prototype.removePopUp=function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=null),t.parent&&this.getInStack(t,!0)){var r;this._pupUpStack.some(function(t){return t.modal?(r=t,!0):void 0}),r?this.updateModalMask(r):this.setModalMaskVisible(!1);var o=this.createEffectInstance(e);o.hide(t,this._popLayer,function(){t.inactive&&t.inactive();var e=this.topPupUp;e&&e.active&&e.active()},this,n);var s=0==this._pupUpStack.length;s&&this.dispatchEventWith(i.POPUP_HIDE)}},Object.defineProperty(i.prototype,"topPupUp",{get:function(){return this._pupUpStack.length>0?this._pupUpStack[this._pupUpStack.length-1]:null},enumerable:!0,configurable:!0}),i.prototype.removeTopPupUp=function(){var t=this.topPupUp;return t?(t.close&&t.close(),!0):!1},i.prototype.removeAllPupUp=function(){var e=this;t.Utils.enumChildren(this._popLayer,function(t){t!=e._modalMask&&t.close()})},i.prototype.getInStack=function(t,e){void 0===e&&(e=!1);var i;return this._pupUpStack.some(function(e,n){return e.target==t?(i={item:e,index:n},!0):void 0}),i&&e&&this._pupUpStack.splice(i.index,1),i},i.prototype.createEffectInstance=function(e){void 0===e&&(e=null);var i;return i=e?new e:new t.popupEffect.None},i.prototype.onModalMaskTap=function(t){var e=this._pupUpStack[0];e&&e.modal&&e.modalTouchFun&&e.modalTouchFun()},i.prototype.updateModalMask=function(t){var e=this._popLayer.getChildIndex(this._modalMask),i=this._popLayer.getChildIndex(t.target);e!=i-1&&this.setModalMaskVisible(t.modal,i)},i.prototype.setModalMaskVisible=function(t,e){void 0===e&&(e=-1),t?(this.modalMask.fillColor=this.modalConfig.color,this.modalMask.fillAlpha=this.modalConfig.alpha,e>=0?(this.setModalMaskVisible(!0),this._popLayer.addChildAt(this.modalMask,e)):this._popLayer.addChild(this.modalMask),egret.Tween.get(this.modalMask,null,null,!0).to({alpha:1},this.modalConfig.duration)):this.modalMask.parent&&egret.Tween.get(this.modalMask,null,null,!0).to({alpha:0},this.modalConfig.duration).call(function(t){this._popLayer.removeChild(t)},this,[this.modalMask])},Object.defineProperty(i.prototype,"modalMask",{get:function(){return this._modalMask||(this._modalMask=new eui.Rect,this._modalMask.width=t.StageProxy.width,this._modalMask.height=t.StageProxy.height,this._modalMask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onModalMaskTap,this)),this._modalMask},enumerable:!0,configurable:!0}),i.defaultModalConfig={color:0,alpha:.7,duration:200},i.POPUP_SHOW="POPUP_SHOW",i.POPUP_HIDE="POPUP_HIDE",i}(egret.EventDispatcher);t.PopUpManager=e,__reflect(e.prototype,"alien.PopUpManager")}(alien||(alien={}));var ActDetailsBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(activityService,EventNames.UPDATE_ACTIVITY,this.onUpdateActivity,this),this.registerEvent(this.bannerItem,egret.TouchEvent.TOUCH_TAP,this.onBannerItemTap,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this._type=e.type,this._type<1e3&&activityService.getActivity(this._type));var i=activityService.getActivityByType(this._type);this.bannerItem.setData(i)},e.prototype.update=function(){},e.prototype.onUpdateActivity=function(t){this.update()},e.prototype.onBannerItemTap=function(t){alien.Dispatcher.dispatch(EventNames.BACK_ACTIVITY)},e}(StackView);__reflect(ActDetailsBase.prototype,"ActDetailsBase");var CountDown=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._playOne=function(){e.playOne(),--e.value<0&&e._stop()},e}return __extends(e,t),e.prototype.start=function(t){this.value=t,this.timer&&this.stop(),this.timer=egret.setInterval(this._playOne,this,1e3),this._playOne()},e.prototype.stop=function(){this._stop()},e.prototype._stop=function(){egret.clearInterval(this.timer),this.timer=null},e.prototype.playOne=function(){},e}(alien.EventComponent);__reflect(CountDown.prototype,"CountDown");var ItemRenderer=eui.ItemRenderer,InteriorImpose=function(t){function e(){var e=t.call(this)||this;return e.skinName=interior.InteriorImposeSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=["silver","troops","mineral"],i=["trade","military","industry"];this.listProps.itemRenderer=IRProps,this.listProps.dataProvider=this._dataProviderProps=new eui.ArrayCollection(e),this.listImpose.itemRenderer=IRImposeItem,this.listImpose.dataProvider=this._dataProviderImpose=new eui.ArrayCollection(i),this.registerEvent(gameServer,protocols.WC_IMPOSE_Response,this.onImposeResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.updateUI()},e.prototype.onImposeResponse=function(t){if(0==t.data.error){this._dataProviderProps.refresh(),this._dataProviderImpose.itemUpdated(this.listImpose.selectedIndex);var e=0;switch(t.data.type){case 0:e=0;break;case 1:e=2;break;case 2:e=1}var i=this.listImpose.getChildAt(e),n=interiorService.nationalProps[t.data.type];alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.player_info_fields[n]+"+"+t.data.value,component:i}),SoundManager.instance.playEffect("sound_impose_"+n)}},e.prototype.updateUI=function(){this._dataProviderProps.refresh(),this._dataProviderImpose.refresh()},e}(StackView);__reflect(InteriorImpose.prototype,"InteriorImpose");var IRImposeItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.button,egret.TouchEvent.TOUCH_TAP,this.onButtonTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.imgCover.source="interior_impose_item_cover_"+e,this.labName.text=lang.impose_props[e],this.imgIcon.source="icon_"+e,this.labConnect.text="+"+interiorService.getDevelopmentSpeed(e)},e.prototype.onButtonTap=function(t){var e=interiorService.getImposeValue();return 0>=e?void Toast.show({text:lang.response_error[93]}):void interiorService.impose(interiorService.developmentNames.indexOf(this.data))},e}(alien.VisualEventItemRenderer);__reflect(IRImposeItem.prototype,"IRImposeItem");var LobbyPageBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getEnterProps=function(t,e,i){return{}},e.prototype.getLeaveProps=function(t,e,i){return{}},e.prototype.onWillEnter=function(e,i,n){var r=this;return this.initScene(),t.prototype.onWillEnter.call(this,e,i,n).then(function(){return new Promise(function(t,o){var s=r.getEnterProps(e,i,n),a=s.props,c=s.duration,l=void 0===c?300:c,p=s.ease,h=void 0===p?egret.Ease.cubicOut:p;egret.Tween.get(r,null,null,!0).to(a,l,h).call(function(){t()})})})},e.prototype.onWillLeave=function(e,i,n){var r=this;return t.prototype.onWillLeave.call(this,e,i,n).then(function(){return new Promise(function(t,o){var s=r.getLeaveProps(e,i,n),a=s.props,c=s.duration,l=void 0===c?300:c,p=s.ease,h=void 0===p?egret.Ease.cubicOut:p;egret.Tween.get(r,null,null,!0).to(a,l,h).call(function(){t()})})})},e.prototype.onDidLeave=function(t,e,i){this.parent&&this.parent.removeChild(this)},e.prototype.initScene=function(){},e.prototype["goto"]=function(t,e){void 0===e&&(e=null),LobbyPageController.instance.navigator.push(t,e)},e.prototype.back=function(){LobbyPageController.instance.navigator.pop()},e}(NavigatorViewBase);__reflect(LobbyPageBase.prototype,"LobbyPageBase");var ErrorTrack=function(){function t(){var t=this;this.badgeData=[],this.onWindowError=function(e,i,n,r,o){t.sendErrorObject(o)}}return Object.defineProperty(t,"instance",{get:function(){return void 0==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=egret.Capabilities,e=t.language,i=t.isMobile,n=t.os,r=t.runtimeType,o=t.supportVersion,s=t.engineVersion,a=t.renderMode;this.env=JSON.stringify({language:e,isMobile:i,os:n,runtimeType:r,supportVersion:o,engineVersion:s,renderMode:a}),egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&(window.onerror=this.onWindowError)},t.prototype.sendErrorContent=function(t){webService.sendError(this.env,t)},t.prototype.sendErrorObject=function(t){this.sendErrorContent(JSON.stringify({aid:dataCenterService.accountId,pid:dataCenterService.pid,lastMessage:gameServer.lastMessage,stack:t.stack}))},t}();__reflect(ErrorTrack.prototype,"ErrorTrack");var FloatNotification=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onTimer=function(){var t=e.queue.shift();if(t){var i=t.x,n=void 0===i?alien.StageProxy.width/2:i,r=t.y,o=void 0===r?300:r,s=t.component,a=t.distance,c=void 0===a?200:a,l=new FloatText;if(s){var p=s.localToGlobal(s.width/2,s.height/2+.5*c);l.x=p.x,l.y=p.y}else l.x=n,l.y=o;e.addChild(l),l.play(t)}else egret.clearInterval(e.timer),e.timer=null},e.onImgTimer=function(){var t=e.imgQueue.shift();if(t){var i=t.x,n=void 0===i?alien.StageProxy.width/2:i,r=t.y,o=void 0===r?300:r,s=t.component,a=t.distance,c=void 0===a?0:a,l=new FloatImage;if(s){var p=s.localToGlobal(s.width/2,s.height/2+.5*c);l.x=p.x,l.y=p.y}else l.x=n,l.y=o;e.addChild(l),l.play(t)}else egret.clearInterval(e.timer),e.timer=null},e.onItemTimer=function(){var t=e.itemQueue.shift();if(t){var i=t.x,n=void 0===i?alien.StageProxy.width/2:i,r=t.y,o=void 0===r?300:r,s=t.component,a=t.distance,c=void 0===a?0:a,l=new FloatItem;if(s){var p=s.localToGlobal(s.width/2,s.height/2+.5*c);l.x=p.x,l.y=p.y}else l.x=n,l.y=o;e.addChild(l),l.play(t)}else egret.clearInterval(e.timer),e.timer=null},e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.queue=[],this.imgQueue=[],this.itemQueue=[],this.touchEnabled=!1,this.touchChildren=!1,this.enableEvents()},e.prototype.play=function(t){this.queue.push(t),this.timer||(this.timer=egret.setInterval(this.onTimer,this,300))},e.prototype.clean=function(){this.queue.splice(0),this.imgQueue.splice(0),this.itemQueue.splice(0)},e.prototype.playImage=function(t){this.imgQueue.push(t),this.timer||(this.timer=egret.setInterval(this.onImgTimer,this,300))},e.prototype.playItem=function(t){this.itemQueue.push(t),this.timer||(this.timer=egret.setInterval(this.onItemTimer,this,300))},e}(alien.VisualEventComponent);__reflect(FloatNotification.prototype,"FloatNotification");var FloatText=function(t){function e(){var e=t.call(this)||this;return e.addChild(e.textField=new egret.BitmapText),e}return __extends(e,t),e.prototype.play=function(t){var e=t.text,i=t.distance,n=void 0===i?200:i,r=t.color,o=void 0===r?"red":r,s=this.textField;s.font=RES.getRes("red"==o?ResNames.xingkai_yellow_orange:ResNames.xingkai_blue_deepblue),s.text=e,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.alpha=0,egret.Tween.get(s).to({scaleX:1,scaleY:1,alpha:1},200,egret.Ease.cubicOut).wait(200).to({alpha:0},700),egret.Tween.get(this).to({y:this.y-n},1500,egret.Ease.cubicOut).call(function(){this.parent.removeChild(this)})},e}(egret.DisplayObjectContainer);__reflect(FloatText.prototype,"FloatText");var FloatImage=function(t){function e(){var e=t.call(this)||this;return e.addChild(e.grp=new eui.Group),e.grp.addChild(e.img=new eui.Image),e.grp.addChild(e.label=new eui.Label),e.grp.width=e.grp.height=50,e.img.width=e.img.height=50,e}return __extends(e,t),e.prototype.play=function(t){var e=t.id,i=t.value,n=t.distance,r=void 0===n?200:n,o=GameConfig.getItemMeta(e);1e3>e?this.img.source="item_"+o.icon+"_small":this.img.source="item_"+o.icon,this.label.text="+"+i,this.label.x=this.img.x+this.img.width,this.label.verticalCenter=0,egret.Tween.get(this.grp).to({scaleX:1,scaleY:1,alpha:1},200,egret.Ease.cubicOut).wait(200).to({alpha:0},700),egret.Tween.get(this).to({y:this.y-r},1500,egret.Ease.cubicOut).call(function(){this.parent.removeChild(this)})},e}(egret.DisplayObjectContainer);__reflect(FloatImage.prototype,"FloatImage");var FloatItem=function(t){function e(){var e=t.call(this)||this;return e.item=new ItemView,e.item.skinName=components.ItemViewSkin,e.item.scaleY=.7,e.item.scaleX=.7,e.addChild(e.item),e}return __extends(e,t),e.prototype.play=function(t){var e=t.id,i=t.value,n=t.distance,r=void 0===n?300:n;this.item.metaId=e,this.item.hideCount=!0,this.item.count=i,alien.Utils.anchorCenter(this.item),egret.Tween.get(this.item).to({scaleX:.7,scaleY:.7,alpha:1},200,egret.Ease.cubicOut).wait(200).to({scaleX:.5,scaleY:.5,alpha:0},700),egret.Tween.get(this).to({y:this.y-r},1500,egret.Ease.cubicOut).call(function(){this.parent.removeChild(this)})},e}(egret.DisplayObjectContainer);__reflect(FloatItem.prototype,"FloatItem");var alien;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._dicCall={},t.nativeCall=function(e){console.log("nativeCall:"+e);var i=JSON.parse(e),n=i.id,r=i.method;t.dispatchEventWith(r,!1,i);var o=t._dicCall[n];o&&(o(i.args),delete t._dicCall[n])},egret.ExternalInterface.addCallback("nativeCall",t.nativeCall),t}return __extends(i,e),Object.defineProperty(i,"instance",{get:function(){return void 0==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),i.call=function(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this.instance.call(t,e,i,n)},Object.defineProperty(i.prototype,"platform",{get:function(){var t;return t=i.isNative?egret.Capabilities.os:"web"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"platformId",{get:function(){return i.isNative?"iOS"==egret.Capabilities.os?2:3:4},enumerable:!0,configurable:!0}),Object.defineProperty(i,"isNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),i.prototype.call=function(e,i,n,r){void 0===n&&(n=null),void 0===r&&(r=null),n=n||{};var o={module:e,method:i,args:n};r&&(o.id=t.StringUtils.makeRandomIntString(10),this._dicCall[o.id]=r),egret.ExternalInterface.call("egretCall",JSON.stringify(o))},i.getDeviceUUID=function(e,n,r){if(void 0===r&&(r=!1),i.isNative)i.call("util","getDeviceUUID",{makeNew:r},e);else{var o=t.LocalStorage.getItem("uuid",n);(r||!o)&&(o=t.StringUtils.makeRandomString(32),t.LocalStorage.setItem("uuid",o,n)),e({uuid:o})}},i.navigateToUrl=function(t,e){void 0===e&&(e=!0),i.isNative?i.call("util","navigateToUrl",{url:t}):e?window.open(t):location.href=t},i.closeApp=function(){i.call("util","closeApp")},i.showBanner=function(){i.isNative&&i.call("ads","showBanner")},i.hideBanner=function(){i.isNative&&i.call("ads","hideBanner")},i.showInterstitial=function(){i.isNative&&i.call("ads","showInterstitial")
},i.jumpApp=function(t){i.isNative?i.call("util","jumpApp",t):this.navigateToUrl(t.android_apk_url)},i.openAppMarket=function(){i.isNative&&i.call("util","openAppMarket",{})},i.shareSystem=function(t,e,n){i.isNative&&i.call("util","shareSystem",{title:t,description:e})},i.setScreenName=function(t){i.isNative&&i.call("analyse","setScreenName",{name:t})},i.sendEvent=function(t,e,n,r){i.isNative&&i.call("analyse","sendEvent",{category:t,action:e,label:n,value:r})},i.uploadImageFromDevice=function(t,e,n){i.isNative&&i.call("util","uploadImageFromDevice",{title:t,uploadUrl:e},n)},i.vibrate=function(){i.isNative&&i.call("util","vibrate")},i.addWebView=function(t){i.isNative&&i.call("util","addWebView",{url:t})},i.removeWebView=function(){i.isNative&&i.call("util","removeWebView")},i.alert=function(t,e,n,r){void 0===r&&(r=null),i.isNative?i.call("util","alert",{title:t,message:e,buttons:n},r):(alert(e),r({index:0}))},i}(egret.EventDispatcher);t.EgretBridge=e,__reflect(e.prototype,"alien.EgretBridge")}(alien||(alien={}));var alien;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.autoPlay=!0,e.armatureName="body",e.actionName="idle",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype._load=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return this._dbName?(t=this._armature=dragonBones.EgretFactory.factory.buildArmatureDisplay(this.armatureName,this._dbName),this.removeChildren(),this.addChild(t),this.dealAutoPlay(),[2]):[2]})})},Object.defineProperty(e.prototype,"dbName",{get:function(){return this._dbName},set:function(t){this._dbName!=t&&(this._dbName=t,this._load())},enumerable:!0,configurable:!0}),e.prototype.dealAutoPlay=function(){this.autoPlay&&this._armature&&this._armature.animation.play(this.actionName)},e}(t.EventComponent);t.DBView=e,__reflect(e.prototype,"alien.DBView")}(alien||(alien={}));var alien;!function(t){var e=function(){function e(){this._groups={}}return Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.register=function(e,n,r,o,s,a){void 0===a&&(a=0),n||console.error("target is empty");var c=new i;t.Utils.injectProp(c,{target:n,eventName:r,callback:o,thisObj:s,priority:a},null,!1);var l=this._groups[e];l||(l=this._groups[e]={enable:!1,items:[]}),l.items.push(c),l.enable&&this.addEventListener(c)},e.prototype.registerOn=function(t,e,i,n,r,o){void 0===o&&(o=0),this.register(t.__class__,e,i,n,r,o)},e.prototype.enable=function(t){var e=this._groups[t];e||(e=this._groups[t]={enable:!1,items:[]}),e.enable||(e.enable=!0,e.items.forEach(this.addEventListener))},e.prototype.addEventListener=function(t){t.target.addEventListener(t.eventName,t.callback,t.thisObj,!1,t.priority)},e.prototype.enableOn=function(t){this.enable(t.__class__)},e.prototype.disable=function(t){var e=this._groups[t];e&&e.enable&&(e.enable=!1,e.items.forEach(this.removeEventListener))},e.prototype.removeEventListener=function(t){t.target.removeEventListener(t.eventName,t.callback,t.thisObj)},e.prototype.disableOn=function(t){this.disable(t.__class__)},e.prototype.dump=function(t){void 0===t&&(t=null);for(var e in this._groups){var i=this._groups[e];console.log(e+"["+i.items.length+"]: "+(i.enable?"● enable":"○ disable")),console.log(i.items.map(function(t){return t.eventName}).join(","))}},e}();t.EventManager=e,__reflect(e.prototype,"alien.EventManager");var i=function(){function t(){}return t}();t.RegisterItem=i,__reflect(i.prototype,"alien.RegisterItem")}(alien||(alien={}));var PanelDecreeContainer=function(t){function e(){var e=t.call(this,alien.popupEffect.None,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e.playing=!1,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new PanelDialog),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this),this.skinName=panels.PanelDecreeContainerSkin},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grpAll.mask=this.contentMask,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){this.dealAction()},e.prototype.playSeal=function(){var t=this,e=this.imgSeal;e.visible=!0,e.alpha=0,e.scaleX=e.scaleY=10,egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},600,egret.Ease.cubicIn).call(function(){t.playing=!1,SoundManager.instance.playEffect(ResNames.sound_take_seal)})},Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(t){this._content!=t&&(this._content=t,t?this.grpContent.addChild(t):this.grpContent.removeChildren())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(t){this._title!=t&&(this._title=t,this.imgTitle.source=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"callback",{get:function(){return this._callback},set:function(t){this._callback=t},enumerable:!0,configurable:!0}),e.prototype.popup=function(e,i,n){return void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.popup.call(this,e,i,n)];case 1:return r.sent(),this.content.onShow(),[2]}})})},e.prototype.play=function(t){this.playing=!0,this.contentMask.x=323.5,this.contentMask.width=0,this.imgLeft.x=320,this.imgRight.x=344,this.imgSeal.visible=!1,this.imgTitle.horizontalCenter=-1e3,this.grpContent.alpha=0,egret.Tween.get(this.contentMask).to({x:0,width:647},1e3,egret.Ease.cubicInOut).call(this.playTitle,this),egret.Tween.get(this.imgLeft).to({x:0},1e3,egret.Ease.cubicInOut),egret.Tween.get(this.imgRight).to({x:666},1e3,egret.Ease.cubicInOut)},e.prototype.playTitle=function(){var t=this;egret.Tween.get(this.imgTitle).to({horizontalCenter:27},500,egret.Ease.backIn).call(function(){t.playEffect(),t.playSeal()}),egret.Tween.get(this.grpContent).to({alpha:1},500,egret.Ease.sineIn)},e.prototype.playEffect=function(){this.effect.movieClip.gotoAndPlay(1,1)},e.prototype.close=function(){this.playing||(t.prototype.close.call(this),this.content.onClose())},e.prototype.active=function(){t.prototype.active.call(this),this._content&&this._content.active()},e.prototype.inactive=function(){t.prototype.inactive.call(this),this._content&&this._content.inactive()},e}(PanelBase);__reflect(PanelDecreeContainer.prototype,"PanelDecreeContainer");var PanelDecreeBase=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.popup=function(t,e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.container||(this.container=new PanelDecreeContainer,this.container.content=this,this.container.title=this._title),this.container.callback=e,[4,this.container.popup(this.dealAction)];case 1:return i.sent(),this.render(t),this.container.play(t),[2]}})})},e.prototype.close=function(){this.container&&this.container.close()},e.prototype.dealAction=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.container&&this.container.dealAction(t,e)},Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t,this.container&&(this.container.title=this._title)},enumerable:!0,configurable:!0}),e.prototype.onShow=function(){},e.prototype.onClose=function(){},e.prototype.active=function(){this.enableEvents()},e.prototype.inactive=function(){this.disableEvents()},e.prototype.render=function(t){},e}(alien.EventComponent);__reflect(PanelDecreeBase.prototype,"PanelDecreeBase");var PanelDispatchMinister=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.title=lang.panel_dispatch_minister},e.prototype.getSkinName=function(){return panels.PanelDispatchMinisterSkin},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup(e)];case 1:return t.sent(),[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_MINISTER,this.updateInfo,this)},e.prototype.updateInfo=function(t){void 0===t&&(t=null),this.selectMinister.selectedMinister=t.data.minister,this.dealAction("select",this.getData())},e.prototype.getData=function(){return{minister:this.selectMinister.selectedMinister}},e.prototype.onBtnConfirmTap=function(t){this.dealAction("select",this.getData())},e.prototype.active=function(){t.prototype.active.call(this)},e}(CommonPanelBase);__reflect(PanelDispatchMinister.prototype,"PanelDispatchMinister");var PanelDispatchMinister2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.title=lang.panel_dispatch_minister},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelDispatchMinisterSkin),this.skinType=3,[4,this.popup(e)];case 1:return t.sent(),[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_MINISTER,this.updateInfo,this)},e.prototype.updateInfo=function(t){void 0===t&&(t=null),this.selectMinister2.selectedMinister=t.data.minister,this.dealAction("select",this.getData())},e.prototype.getData=function(){return{minister:this.selectMinister2.selectedMinister}},e.prototype.onBtnConfirmTap=function(t){this.dealAction("select",this.getData())},e.prototype.active=function(){t.prototype.active.call(this)},e}(CommonPanelBase);__reflect(PanelDispatchMinister2.prototype,"PanelDispatchMinister2");var alien;!function(t){var e=function(){function t(){}return t.init=function(t){this.ID=t},t.getName=function(t,e){return void 0===e&&(e=null),(e||!this.ID||""==this.ID?e:this.ID)+"_"+t},t.getItem=function(t,e){return void 0===e&&(e=null),egret.localStorage.getItem(this.getName(t,e))},t.setItem=function(t,e,i){return void 0===i&&(i=null),egret.localStorage.setItem(this.getName(t,i),e)},t.getItemObj=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);var n;try{n=JSON.parse(this.getItem(t,i))}catch(r){}return n||(n=e),n},t.setItemObj=function(t,e,i){return void 0===i&&(i=null),this.setItem(t,JSON.stringify(e),i)},t}();t.LocalStorage=e,__reflect(e.prototype,"alien.LocalStorage")}(alien||(alien={}));var MinisterList=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabOrder.selectedIndex=dataCenterService.ministerOrder,this.order(!1),this.list.itemRenderer=IRMinister,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(ministerService.ministers),this.registerEvent(ministerService,EventNames.UPDATE_MINSTER,this.onUpdateMinister,this),this.registerEvent(alien.Dispatcher,EventNames.TAP_UPGRADE_MINISTER,this.onUpgradeMinister,this),this.registerEvent(this.tabOrder,egret.Event.CHANGE,this.onSelectOrder,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectMinister,this)},e.prototype.order=function(t){void 0===t&&(t=!0);var e=this.tabOrder.dataProvider.getItemAt(dataCenterService.ministerOrder).field;this.labCount.text=lang.format(lang.minister_count,ministerService.ministers.length,ministerService.getMinisterSeat()),ministerService.order(e),t&&this._dataProvider.refresh()},e.prototype.onSelectOrder=function(t){dataCenterService.ministerOrder=this.tabOrder.selectedIndex,this.order()},e.prototype.onUpdateMinister=function(t){t.data&&t.data.minister?(t.data.minister.upgrade=!0,this._dataProvider.itemUpdated(t.data.minister)):this._dataProvider.refresh()},e.prototype.onSelectMinister=function(t){t.preventDefault(),SceneController["goto"](ConstantNames.SCENE_MINISTER_INFO,{minister:this.list.selectedItem})},e.prototype.onUpgradeMinister=function(t){var e=t.data.minister;ministerService.upgrade(e,this.cb10.selected?10:1)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.order()},e}(StackView);__reflect(MinisterList.prototype,"MinisterList");var IRMinister=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.grp.mask=this.bodyMask},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.meta;switch(this.labName.text=i.name,this.labLevel.text="Lv."+e.level,this.qualityColor.fillColor=GameConfig.MINISTER_QUALITY_COLORS[i.quality],this.imgBody.source=e.bodyUrl,this.imgBody.x=this.grp.width/2-.6*i.body_offset.x,this.imgBody.y=100-.6*i.body_offset.y,this.imgPeerage.visible=e.peerage>0,e.peerage>0&&(this.imgPeerage.source="minister_peerage_"+e.peerage),e.peerage){case 0:case 1:case 2:this.imgBorder.source=ResNames.minister_border_1;break;case 3:case 4:this.imgBorder.source=ResNames.minister_border_2;break;case 5:case 6:this.imgBorder.source=ResNames.minister_border_3}},e}(eui.ItemRenderer);__reflect(IRMinister.prototype,"IRMinister");var alien;!function(t){var e=function(){function t(){}return t.validateName=function(t){return!!t.match(/^[\u4e00-\u9fa5]{2,4}$/)},t.has2BChar=function(t){return t.match(/[^\x00-\xff]/)},t.validateIdCard=function(t){var e=!1,i=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;if(i.test(t)&&18==t.length){for(var n=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],r=[1,0,10,9,8,7,6,5,4,3,2],o=0,s=0;17>s;s++)o+=t.substring(s,s+1)*n[s];var a=o%11,c=t.substring(17);e=2==a?"X"==c||"x"==c:c==r[a]}return e},t.filterEmoji=function(t){return t.replace(/\ud83c[\udf00-\udfff]|\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g,"")},t}();t.RegUtils=e,__reflect(e.prototype,"alien.RegUtils")}(alien||(alien={}));var alien;!function(t){var e=function(){function t(){}return t.prototype.checkNeedLoad=function(t){for(var e=!1,i=0,n=t.length;n>i;i++)if(!RES.isGroupLoaded(t[i])){e=!0;break}return e},t.prototype.loadResGroups=function(t,e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var i,n,i,n;return __generator(this,function(r){switch(r.label){case 0:for(this._progressCallback=e,this._total=0,this._loaded=0,i=0,n=t.length;n>i;i++)if(!RES.isGroupLoaded(t[i])){this._total+=RES.getGroupByName(t[i]).length;break}i=0,n=t.length,r.label=1;case 1:return n>i?RES.isGroupLoaded(t[i])?[3,3]:[4,this.loadResGroup(t[i])]:[3,4];case 2:r.sent(),r.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},t.prototype.loadResGroup=function(t){var e=this;return new Promise(function(i,n){var r=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,r,e),i()},o=function(t){RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,o,e),n("Group:"+t.groupName+" has failed to load")},s=function(t){e._loaded++,e._progressCallback&&e._progressCallback(e._loaded,e._total)};RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,r,e),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,o,e),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,s,e),RES.loadGroup(t)})},Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t)},enumerable:!0,configurable:!0}),t}();t.ResGroupsLoader=e,__reflect(e.prototype,"alien.ResGroupsLoader")}(alien||(alien={}));var alien;!function(t){var e=function(){function e(){}return e.makeRandomString=function(e){for(var i="",n=this.chars.length,r=0;e>r;r++)i+=this.chars.charAt(t.MathUtils.makeRandomInt(n));return i},e.makeRandomIntString=function(e){for(var i="",n=0;e>n;n++)i+=t.MathUtils.makeRandomInt(10);return i},e.stringCut=function(t,e,i){void 0===i&&(i="...");var n=t;return t.length>e&&(n=t.substr(0,e)+i),n},e.supplement=function(t,e){var i=e-t.toString().length-1;return 0>i?t.toString():this.zeros[i]+t},e.format=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this.formatApply(t,e)},e.formatApply=function(t,e){for(var i=t,n=0,r=e.length;r>n;n++){var o=new RegExp("\\{"+n+"\\}","g");i=i.replace(o,e[n])}return i},e.splitBySize=function(t,e){for(var i=[],n=0,r=Math.ceil(t.length/e);r>n;n++)i.push(t.substr(n*e,e));return i},e.repeat=function(t,e){for(var i="",n=0;e>n;n++)i+=t;return i},e.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},e.join=function(t,e,i){if(void 0===i&&(i=0),t&&t.length>0){if(i>0){for(var n="",r=0,o=t.length;o>r;r++)n+=t[r]+(o-1>r?(r+1)%i==0?"\n":e:"");return n}return t.join(e)}return null},e.chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e.zeros=["0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000"],e}();t.StringUtils=e,__reflect(e.prototype,"alien.StringUtils")}(alien||(alien={}));var alien;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this.timer=null,this.onRender=t,this.onComplete=e}return t.prototype.startWithSecond=function(t){this.time=t,this.type=0,this.start(1e3)},t.prototype.startWithMillisecond=function(t){this.time=t,this.type=1,this.start(1e3/60)},t.prototype.stop=function(){this.timer&&(egret.clearInterval(this.timer),this.timer=null)},t.prototype.start=function(t){var e=this;this.stop(),this.timer=egret.setInterval(function(){e.time--,e.onRender&&e.onRender(e.time),e.time<=0&&(e.stop(),e.onComplete&&e.onComplete())},this,t)},t}();t.TimeCountDown=e,__reflect(e.prototype,"alien.TimeCountDown")}(alien||(alien={}));var alien;!function(t){function e(t,e,i,n,r){void 0===i&&(i=-1),void 0===n&&(n=null),void 0===r&&(r=!1);for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];var a=0;r&&(a++,t.apply(null,o));var c=egret.setInterval(function(){return i>0&&a>=i?(egret.clearInterval(c),void(n&&n())):(t.apply(null,o),void a++)},this,e);return c}t.repeat=e;var i=function(){function e(){}return e.timeFormat=function(e,i,n,r){void 0===i&&(i="{1}:{0}"),void 0===n&&(n=!0),void 0===r&&(r=!1);var o=e%60,s=Math.floor(e/60)%60,a=Math.floor(e/3600)%24,c=Math.floor(e/3600/24);if(n&&(o=t.StringUtils.supplement(o,2),s=t.StringUtils.supplement(s,2),a=t.StringUtils.supplement(a,2),c=t.StringUtils.supplement(c,2)),r){var l="";return[c,a,s,o].forEach(function(t,e){}),l}return t.StringUtils.format(i,o,s,a,c)},e.parseFromString=function(t){return new Date(t.replace("T"," ").replace(/-/g,"/"))},e.parseFromStringScope=function(t){var e=this;return t.map(function(t){return e.parseFromString(t)})},e.dateTimeToString=function(t){return this.dateToString(t,"{0}年{1}月{2}日")+" "+this.dateToTimeString(t,"{2}:{1}")},e.tsToDate=function(t){var e=new Date;return e.setTime(1e3*t),e},e.parseTime=function(t){var e=t.split(":");return 3600*parseInt(e[0])+60*parseInt(e[1])+parseInt(e[2])},e.tsToDateString=function(t,e){return void 0===e&&(e="{0}/{1}/{2}"),this.dateToString(this.tsToDate(t),e)},e.dateToString=function(e,i){return void 0===i&&(i="{0}/{1}/{2}"),t.StringUtils.format(i,e.getFullYear(),t.StringUtils.supplement(e.getMonth()+1,2),t.StringUtils.supplement(e.getDate(),2))},e.dateToTimeString=function(e,i){return void 0===i&&(i="{2}:{1}:{0}"),t.StringUtils.format(i,t.StringUtils.supplement(e.getSeconds(),2),t.StringUtils.supplement(e.getMinutes(),2),t.StringUtils.supplement(e.getHours(),2))},e.dateToTs=function(t){return Math.floor(t.valueOf()/1e3)},e.dateCut=function(t){var e=t.getHours(),i=t.getMinutes(),n=t.getSeconds();return this.tsToDate(this.dateToTs(t)-3600*e-60*i-n)},e.tsToMonthDayString=function(e){var i=this.tsToDate(e);return t.StringUtils.format("{0}月{1}日",t.StringUtils.supplement(i.getMonth()+1,2),t.StringUtils.supplement(i.getDate(),2))},e.scopeToDateString=function(t,e){return this.dateToString(t[0],e)+"-"+this.dateToString(t[1],e)},e.scopeToTimeString=function(t,e){var i=this.dateToTimeString(t[0],e),n=this.dateToTimeString(t[1],e);return i+"-"+n},e.scopeToDateTimeString=function(t,e,i,n){void 0===n&&(n=!1);var r=t[0],o=t[1];return n&&r.getDate()==o.getDate()?this.dateToString(r,e)+" "+this.dateToTimeString(r,i)+"-"+this.dateToTimeString(o,i):this.dateTimeToString(r)+" - "+this.dateTimeToString(o)},e.remainDays=function(t,e,i){void 0===i&&(i=!1);var n,r;return t instanceof Date?n=this.dateToTs(t):"string"==typeof t&&(n=this.parseFromString(t)),e instanceof Date?r=this.dateToTs(e):"string"==typeof e&&(r=this.parseFromString(e)),(n-r+(i?1:0))/24/3600},e.compareScope=function(t,e){var i=this.dateToTs(t[0]),n=this.dateToTs(t[1]);return i>e?e-i:e>=i&&n>=e?0:e-n},e.getWeekIndex=function(t){var e=this.tsToDate(t),i=this.getFirstWeekBegDay(e.getFullYear());i>e&&(i=this.getFirstWeekBegDay(e.getFullYear()-1));var n=Math.floor((e.valueOf()-i.valueOf())/864e5);return Math.floor(n/7)+1},e.getFirstWeekBegDay=function(t){var e=new Date(t,0,1),i=e.getDay();if(1==i)return e;i=0==i?7:i;var n=e.setDate(e.getDate()+(8-i));return new Date(n)},e.timeLang=["sky","hour","minutes","second"],e}();t.TimeUtils=i,__reflect(i.prototype,"alien.TimeUtils")}(alien||(alien={}));var alien;!function(t){var e=function(){function e(){}return e.injectProp=function(t,e,i,n,r){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=!0),void 0===r&&(r=!0),!t||!e)return!1;var o=!0;for(var s in e){var a=e[s];n&&"function"==typeof a||r&&null==a||(i?i(t,s,a):t[s]=a)}return o},e.getDirtyData=function(t,e){var i;for(var n in e)t[n]!=e[n]&&(i||(i={}),i[n]=e[n]);return i},e.combineProp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i={};return t.forEach(function(t){if(t)for(var e in t)null!==t[e]&&void 0!==t[e]&&""!==t[e]&&(i[e]=t[e])}),i},e.enumChildren=function(t,e){for(var i=0,n=t.numChildren;n>i&&!e(t.getChildAt(i),i);i++);},e.removeChildren=function(t,e){for(var i=0;t.numChildren>0;)e(t.removeChildAt(0),i),i++},e.getDisplayPath=function(t){var e=[],i=t;do e.unshift(i.parent.getChildIndex(i));while((i=i.parent)&&i.parent);return e},e.getTargetByPath=function(e){for(var i=t.StageProxy.stage,n=0,r=e.length;r>n;n++)try{i=i.getChildAt(e[n])}catch(o){return null}return i},e.clone=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=!0);var n=e?new e:{};return this.injectProp(n,t,null,i),n},e.arrToIntArr=function(t){for(var e=0,i=t.length;i>e;e++)t[e]=parseInt(t[e]);return t},e.getUrlParams=function(){var t={},e=window.location.href,i=e.indexOf("?");return 0>i?t:t=this.parseQuery(e.substr(i+1))},e.parseQuery=function(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");e[r[0]]=r[1]}return e},e.getUrlBase=function(){var t=window.location.href,e=t.indexOf("?");return t.substring(0,0>e?t.length:e)},e.anchorCenter=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=!0),this.anchorRate(t,.5,.5,e,i,n)},e.anchorRate=function(t,e,i,n,r,o){void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=!0),0==n&&(n=t.width),0==r&&(r=t.height),o&&(0==e&&(t.x-=t.anchorOffsetX),0==i&&(t.y-=t.anchorOffsetY)),t.anchorOffsetX=n*e,t.anchorOffsetY=r*i,o&&(e>0&&(t.x+=t.anchorOffsetX),i>0&&(t.y+=t.anchorOffsetY))},e.obj2query=function(t){if(!t)return"";var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")},e.parseColorTextFlow=function(t){for(var e,i=t.split(/\[.*?\]/g),n=t.match(/\[.*?\]/g),r=[],o=0,s=i.length-1;s>o;o++){e=i[o],e&&r.push({text:e});var a=n[o];a=a.substr(1,a.length-2);var c={},l=a.split("|");1==l.length?c.style={textColor:parseInt(l[0],16)}:(c.text=l[0],c.style={textColor:parseInt(l[1],16)}),r.push(c)}return e=i[o],e&&r.push({text:e}),r},e.parseHtmlText=function(t){return this.parser.parser(t)},e.scrollTo=function(t,e,i){return void 0===i&&(i=0),(e+i)*t},e.getByteLen=function(t){return t.replace(/[^\x00-\xff]/g,"__").length},e.findArr=function(t,e){var i=null;return t.some(function(t){return e(t)?(i=t,!0):void 0}),i},e.objectValues=function(t){var e=[];for(var i in t)e.push(t[i]);return e},e.getFileName=function(t){return t.substr(0,t.indexOf("."))},e.parser=new egret.HtmlTextParser,e}();t.Utils=e,__reflect(e.prototype,"alien.Utils")}(alien||(alien={}));var alien;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.setXY(t,e)}return t.prototype.setXY=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.zero=function(){return this.x=0,this.y=0,this},Object.defineProperty(t.prototype,"isZero",{get:function(){return 0==this.x&&0==this.y},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){var t=this.length;return 0==t?(this.x=1,this):(this.x/=t,this.y/=t,this)},Object.defineProperty(t.prototype,"isNormalized",{get:function(){return 1==this.length},enumerable:!0,configurable:!0}),t.prototype.truncate=function(t){return this.length=Math.min(t,this.length),this},t.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.dotProd=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProd=function(t){return this.x*t.y-this.y*t.x},t.prototype.distSQ=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},t.prototype.distance=function(t){return Math.sqrt(this.distSQ(t))},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t.prototype.divide=function(t){return this.x/=t,this.y/=t,this},Object.defineProperty(t.prototype,"angle",{get:function(){return 180*this.radian/Math.PI},set:function(t){this.radian=t*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radian",{get:function(){return Math.atan2(this.y,this.x)},set:function(t){var e=this.length;this.setXY(Math.cos(t)*e,Math.sin(t)*e)},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSQ)},set:function(t){var e=this.radian;this.setXY(Math.cos(e)*t,Math.sin(e)*t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSQ",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slope",{get:function(){return this.y/this.x},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return"[Vector2D (x:"+this.x+", y:"+this.y+")]"},t.corner=function(t,e){return Math.acos(t.dotProd(e)/(t.length*e.length))},t}();t.Vector2D=e,__reflect(e.prototype,"alien.Vector2D")}(alien||(alien={}));var alien;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.thumbAdditional=null,e._additional=0,e}return __extends(e,t),e.prototype.partAdded=function(e,i){var n=this;switch(t.prototype.partAdded.call(this,e,i),e){case"thumbAdditional":this.thumbAdditional.scrollRect=this._additionalRect=new egret.Rectangle,egret.callLater(function(){n._additionalRect.height=n.thumbAdditional.height,n.thumbAdditional.scrollRect=n._additionalRect},this)}},e.prototype.updateSkinDisplayList=function(){t.prototype.updateSkinDisplayList.call(this),this.thumbAdditional&&this.renderAdditional()},e.prototype.renderAdditional=function(){this._additionalRect.width=this.thumbAdditional.width*this._additional/this.maximum,this.thumbAdditional.scrollRect=this._additionalRect},Object.defineProperty(e.prototype,"additional",{get:function(){return this._additional},set:function(t){this._additional=Math.max(Math.min(t+this.value,this.maximum),this.value),this.thumbAdditional&&this.invalidateDisplayList()},enumerable:!0,configurable:!0}),e}(eui.ProgressBar);t.AdditionalProgressBar=e,__reflect(e.prototype,"alien.AdditionalProgressBar")}(alien||(alien={}));var alien;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.speedX=-.5,t.speedY=0,t.repeatedImage="",t.init(),t}return __extends(i,e),i.prototype.init=function(){this.scrollEnabled=!0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddedToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedToStage,this)},i.prototype.onAddedToStage=function(e){this._playing&&t.TickerManager.register(this)},i.prototype.onRemovedToStage=function(e){t.TickerManager.unregister(this)},i.prototype.createChildren=function(){e.prototype.createChildren.call(this);var t=this._bmp=new eui.Image;this.addChild(t),t.source=this.repeatedImage,this._orgWidth=t.width,t.fillMode=egret.BitmapFillMode.REPEAT,t.width*=2,this.play()},i.prototype.play=function(){this._playing||(this._playing=!0,t.TickerManager.register(this))},i.prototype.stop=function(){this._playing&&(this._playing=!1,t.TickerManager.unregister(this))},i.prototype.update=function(){this.scrollH-=this.speedX,this.speedX<0&&this.scrollH>this._orgWidth&&(this.scrollH-=this._orgWidth),this.speedX>0&&this.scrollH<0&&(this.scrollH+=this._orgWidth)},i}(eui.Group);t.ScrollImage=e,__reflect(e.prototype,"alien.ScrollImage",["alien.ITicker"])}(alien||(alien={}));var alien;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._shape=new egret.Shape,e.addChild(e._shape),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.onResize(),this.registerEvent(this,egret.Event.RESIZE,this.onResize,this)},e.prototype.onResize=function(t){void 0===t&&(t=null);var e=this._shape.graphics;this.redraw(e)},e.prototype.redraw=function(t){},e}(t.VisualEventComponent);t.Shape=e,__reflect(e.prototype,"alien.Shape")}(alien||(alien={}));var alien;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._selectedIndex=-1,e.views=[],e}return __extends(e,t),e.prototype.setup=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._viewDefs=t},Object.defineProperty(e.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(t){this.setSelectedIndex(t)},enumerable:!0,configurable:!0}),e.prototype.setSelectedIndex=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=!1),this._selectedIndex!=t&&this._hideView(this._selectedIndex),(i||this._selectedIndex!=t)&&(this._selectedIndex=t,this._viewDefs&&this._selectedIndex>=0&&this._selectedIndex<this._viewDefs.length&&this._showView(this._selectedIndex,e))},Object.defineProperty(e.prototype,"selectedChild",{get:function(){return 0==this.numChildren?null:this.getChildAt(0)},enumerable:!0,configurable:!0}),e.prototype._hideView=function(t){var e=this.views[t];e&&e.inactive&&e.inactive()},e.prototype.createView=function(t){var e=this._viewDefs[t],i=e.def,n=e.params,r=this.views[t]=new i;return r.initData&&r.initData(n),r},e.prototype._showView=function(t,e){void 0===e&&(e=null),this._lastParams=e;var i=this.views[t];i||(i=this.createView(t)),this.removeChildren(),this.addChild(i),i.active&&i.active(e)},Object.defineProperty(e.prototype,"currentView",{get:function(){return this.numChildren>0?this.getChildAt(0):null},enumerable:!0,configurable:!0}),e.prototype.enableEvents=function(){t.prototype.enableEvents.call(this);var e=this.currentView;e&&e.active&&e.active(this._lastParams)},e.prototype.disableEvents=function(){t.prototype.disableEvents.call(this);var e=this.currentView;e&&e.inactive&&e.inactive()},e}(t.VisualEventComponent);t.ViewStack=e,__reflect(e.prototype,"alien.ViewStack")}(alien||(alien={}));var version="$VERSION$",EventNames=function(){function t(){}return t.SOCKET_CONNECTED="SOCKET_CONNECTED",t.SOCKET_CLOSED="SOCKET_CLOSED",t.SOCKET_ERROR="SOCKET_ERROR",t.SERVER_CONNECTED="SERVER_CONNECTED",t.LOGIN_ACCOUNT_RESULT="LOGIN_ACCOUNT_RESULT",t.LOGIN_GAME="LOGIN_GAME",t.SETTING_CHANGED="SETTING_CHANGED",t.GUIDE_POINT="GUIDE_POINT",t.SHOW_WAITING="SHOW_WAITING",t.HIDE_WAITING="HIDE_WAITING",t.SHOW_TOAST="SHOW_TOAST",t.HIDE_TOAST="HIDE_TOAST",t.SHOW_BOTTOM_NOTIFICATION="SHOW_BOTTOM_NOTIFICATION",t.SHOW_FLOAT_NOTIFICATION="SHOW_FLOAT_NOTIFICATION",t.CLEAN_FLOAT_NOTIFICATION="CLEAN_FLOAT_NOTIFICATION",t.SHOW_FLOAT_NOTIFICATION_IMAGE="SHOW_FLOAT_NOTIFICATION_IMAGE",t.SHOW_FLOAT_NOTIFICATION_ITEM="SHOW_FLOAT_NOTIFICATION_ITEM",t.SHOW_FINISH_NOTIFICATION="SHOW_FINISH_NOTIFICATION",t.CLEAN_FINISH_NOTIFICATION="CLEAN_FINISH_NOTIFICATION",t.BADGE_DATA_MODIFY="BADGE_DATA_MODIFY",t.BADGE_DATA_CHANGE="BADGE_DATA_CHANGE",t.ACTIVITY_TIME_CHANGE="ACTIVITY_TIME_CHANGE",t.PLAYER_PROPS_MODIFIED="PLAYER_PROPS_MODIFIED",t.SELECT_MINISTER="SELECT_MINISTER",t.SELECT_PRINCESS="SELECT_PRINCESS",t.SELECT_FLOWER="SELECT_FLOWER",t.SELECT_ITEM="SELECT_ITEM",t.UPDATE_ITEM="UPDATE_ITEM",t.COMBINE_ITEM="COMBINE_ITEM",t.PROPVIEW_TAP_ADD="PROPVIEW_TAP_ADD",t.REFRESH_DEVELOPMENT_QUEUE="REFRESH_DEVELOPMENT_QUEUE",t.UPDATE_MINSTER="UPDATE_MINSTER",t.UPDATE_MINISTER_POSITION="UPDATE_MINISTER_POSITION",t.TAP_UPGRADE_MINISTER="TAP_UPGRADE_MINISTER",t.TAP_MINISTER_AVATAR="TAP_MINISTER_AVATAR",t.MINISTER_HIRE="MINISTER_HIRE",t.MINISTER_GROW_BREAK="MINISTER_GROW_BREAK",t.UPDATE_PRINCESS="UPDATE_PRINCESS",t.MINISTER_PROPS_MODIFIED="MINISTER_PROPS_MODIFIED",t.PRINCESS_PROPS_MODIFIED="PRINCESS_PROPS_MODIFIED",t.GIVE_ITEM="GIVE_ITEM",t.GIVE_EQUIPMENT="GIVE_EQUIPMENT",t.REFRESH_IMPOSE="REFRESH_IMPOSE",t.REFRESH_LEARN_RITE_QUEUE="REFRESH_LEARN_RITE_QUEUE",t.REFRESH_LEARN_RITE_TEACHER="REFRESH_LEARN_RITE_TEACHER",t.REFRESH_WORK_DATA="REFRESH_WORK_DATA",t.REFRESH_FLOWER_DATA="REFRESH_FLOWER_DATA",t.REFRESH_TURN_CARD_DATA="REFRESH_TURN_CARD_DATA",t.REFRESH_CASH_GIFT_SHOP="REFRESH_CASH_GIFT_SHOP",t.REFRESH_CHARGE="REFRESH_CHARGE",t.TAP_FLOWERPOT="TAP_FLOWERPOT",t.UPDATE_TECHNOLOGY="UPDATE_TECHNOLOGY",t.REFRESH_TECHNOLOGY="REFRESH_TECHNOLOGY",t.UPDATE_PRINCE="UPDATE_PRINCE",t.ADD_PRINCE="ADD_PRINCE",t.PRINCE_OPEN="PRINCE_OPEN",t.SELECT_PRINCE="SELECT_PRINCE",t.PRINCE_TEACHER_APPOINT="PRINCE_TEACHER_APPOINT",t.ADD_POWER="ADD_POWER",t.UPDATE_EMAIL="UPDATE_EMAIL",t.UPDATE_VISIT="UPDATE_VISIT",t.UPDATE_CITY="UPDATE_CITY",t.UPDATE_VISIT_ENERGY="UPDATE_VISIT_ENERGY",t.SELECT_DICE="SELECT_DICE",t.UPDATE_TASK="UPDATE_TASK",t.UPDATE_CHAT="UPDATE_CHAT",t.UPDATE_SUPPRESS="UPDATE_SUPPRESS",t.PARTY_START="PARTY_START",t.PARTY_TURN_START="PARTY_TURN_START",t.UPDATE_ACTIVITY="UPDATE_ACTIVITY",t.BACK_ACTIVITY="BACK_ACTIVITY",t.JOIN_PARTY="JOIN_PARTY",t.FINISH_DEVELOPMENT="FINISH_DEVELOPMENT",t.UPDATE_RANK_WORSHIP="UPDATE_RANK_WORSHIP",t.PRINCESS_SKILL_UPGRADE_GO="PRINCESS_SKILL_UPGRADE_GO",t.CHOOSE_TREASURE_BOX="CHOOSE_TREASURE_BOX",t.SELECT_BANNER="SELECT_BANNER",t.UPDATE_PRISON="UPDATE_PRISON",t.UPDATE_PREFERENTIAL="UPDATE_PREFERENTIAL",t.UPDATE_SUM_CHARGE="UPDATE_SUM_CHARGE",t.UPDATE_FIRST_CHARGE="UPDATE_FIRST_CHARGE",t.REFRESH_PRISON_TOKEN="REFRESH_PRISON_TOKEN",t.UPDATE_UNION_MEMBER="UPDATE_UNION_MEMBER",t.UPDATE_UNION_TECH="UPDATE_UNION_TECH",t.UPDATE_UNION_APPLY_PLAYER="UPDATE_UNION_APPLY_PLAYER",t.UPDATE_UNION_INFO="UPDATE_UNION_INFO",t.UPDATE_UNION_LOG="UPDATE_UNION_LOG",t.UPDATE_UNION_GIFT="UPDATE_UNION_GIFT",t.UPDATE_BOSS_INFO="UPDATE_BOSS_INFO",t.BOSS_SELECT_NOTIFY="BOSS_SELECT_NOTIFY",t.UPDATE_INCENSE_SCORE_NOTIFY="UPDATE_INCENSE_SCORE_NOTIFY",t.BUY_INCENSE_ITEM="BUY_INCENSE_ITEM",t
}();__reflect(EventNames.prototype,"EventNames");var alien;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemovedFromStage,e),e}return __extends(e,t),e.prototype.onAddedToStage=function(t){this.addEventListener(egret.Event.RESIZE,this.onResize,this)},e.prototype.onRemovedFromStage=function(t){this.removeEventListener(egret.Event.RESIZE,this.onResize,this)},e.prototype.onResize=function(t){this.numChildren>0&&this.updateChild(this.getChildAt(0))},e.prototype.updateChild=function(t){var e;e=this.width/this.height>t.width/t.height?this.width/t.width:this.height/t.height,t.scaleX=t.scaleY=e},e}(eui.Group);t.FullChild=e,__reflect(e.prototype,"alien.FullChild")}(alien||(alien={}));var Language=function(t){function e(){var e=t.call(this)||this;return e.ids=new LanguageIds,e.htmlParser=new egret.HtmlTextParser,e}return __extends(e,t),e.prototype.initData=function(){alien.Utils.injectProp(this,RES.getRes("lang")),this.string=RES.getRes("string")},e.prototype.format=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return alien.StringUtils.formatApply(t,e)},e.prototype.formatHtml=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return this.htmlParser.parse(alien.StringUtils.formatApply(t,e))},e}(LanguagePack);__reflect(Language.prototype,"Language");var alien;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"knockoutGrid",{get:function(){return this.$knockoutGrid},set:function(t){this.$knockoutGrid=t,this.$invalidateContentBounds(),this.invalidateDisplayList()},enumerable:!0,configurable:!0}),e.prototype.$render=function(){var t=egret.sys,e=this.$Bitmap[0];if(e){var i=this.$UIComponent,n=i[10],r=i[11],o=this.$Bitmap,s=this.scale9Grid||o[0].scale9Grid;s&&this.$knockoutGrid?this.update(this.$renderNode,o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],n,r,o[13],o[14],this.scale9Grid||o[0].scale9Grid,this.fillMode,o[10]):t.BitmapNode.$updateTextureData(this.$renderNode,o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],n,r,o[13],o[14],this.scale9Grid||o[0].scale9Grid,this.fillMode,o[10])}},e.prototype.update=function(t,e,i,n,r,o,s,a,c,l,p,h,u,_,d,f,m){if(e){var g=egret.$TextureScaleFactor;t.smoothing=m,t.image=e,t.imageWidth=u,t.imageHeight=_;var v=r,y=o;p-=c-r*g,h-=l-o*g;var E=d.x-s,S=d.y-a,b=E/g,I=S/g,C=d.width/g,T=d.height/g;0==T&&(T=1,I>=y&&I--),0==C&&(C=1,b>=v&&b--);var P=i,R=P+b,w=R+C,N=v-b-C,A=n,k=A+I,x=k+T,O=y-I-T,B=N*g,M=O*g;if((b+N)*g>p||(I+O)*g>h)return void t.drawImage(i,n,r,o,s,a,p,h);var D=this.$knockoutGrid,U=D.x,L=D.y,G=D.width,F=D.height,W=s,V=W+U,H=V+G;E=U;var Y=G;B=p-H;var j=a,q=j+L,Q=q+F;S=L;var X=F;M=h-Q,I>0&&(b>0&&t.drawImage(P,A,b,I,W,j,E,S),C>0&&t.drawImage(R,A,C,I,V,j,Y,S),N>0&&t.drawImage(w,A,N,I,H,j,B,S)),T>0&&(b>0&&t.drawImage(P,k,b,T,W,q,E,X),C>0&&t.drawImage(R,k,C,T,V,q,Y,X),N>0&&t.drawImage(w,k,N,T,H,q,B,X)),O>0&&(b>0&&t.drawImage(P,x,b,O,W,Q,E,M),C>0&&t.drawImage(R,x,C,O,V,Q,Y,M),N>0&&t.drawImage(w,x,N,O,H,Q,B,M))}},e.prototype.$hitTest=function(t,e){var i=this.parent.globalToLocal(t,e),n=this.getBounds().containsPoint(i)?this:null;return n&&this.pixelHitTest&&(n=this.hitTestPixel2(t,e)),n},e.prototype.hitTestPixel2=function(t,e){var i=this.parent.globalToLocal(t,e);return this.$knockoutGrid.containsPoint(i)?null:this},e}(eui.Image);t.Image=e,__reflect(e.prototype,"alien.Image"),eui.registerProperty(e,"knockoutGrid","egret.Rectangle")}(alien||(alien={}));var ProtoIDs=function(){function t(){}return t.getMap=function(){var t={};return t[1001]="Joystick",t.Joystick=1001,t[1002]="GameInfo",t.GameInfo=1002,t[1003]="GameOn",t.GameOn=1003,t[1004]="GameOff",t.GameOff=1004,t[1005]="GameReady",t.GameReady=1005,t[1006]="JoystickOn",t.JoystickOn=1006,t[1007]="JoystickOff",t.JoystickOff=1007,t[1008]="JoystickReady",t.JoystickReady=1008,t},t}();__reflect(ProtoIDs.prototype,"ProtoIDs");var ProtoNames=function(){function t(){}return t.Joystick="Joystick",t.GameInfo="GameInfo",t.GameOn="GameOn",t.GameOff="GameOff",t.GameReady="GameReady",t.JoystickOn="JoystickOn",t.JoystickOff="JoystickOff",t.JoystickReady="JoystickReady",t}();__reflect(ProtoNames.prototype,"ProtoNames");var ResNames=function(){function t(){}return t.sheet_loading="sheet_loading",t.sheet_battle="sheet_battle",t.sheet_item="sheet_item",t.sheet_common="sheet_common",t.sheet_icon="sheet_icon",t.sheet_text="sheet_text",t.sheet_ui="sheet_ui",t.tab_label="tab_label",t.scene_title="scene_title",t.sheet_interior="sheet_interior",t.sheet_minister_avatar="sheet_minister_avatar",t.info_box_title="info_box_title",t.sheet_minister="sheet_minister",t.minister_name="minister_name",t.panel_title="panel_title",t.sheet_skill="sheet_skill",t.lang="lang",t.string="string",t.sheet_warehouse="sheet_warehouse",t.throne_bg="throne_bg",t.sheet_throne="sheet_throne",t.animation_7001_json="animation_7001_json",t.animation_7001_png="animation_7001_png",t.animation_0_json="animation_0_json",t.animation_0_png="animation_0_png",t.metas="metas",t.sheet_lobby="sheet_lobby",t.kaiti_yellow_deepred="kaiti_yellow_deepred",t.lobby_main_bg="lobby_main_bg",t.animation_7002_json="animation_7002_json",t.animation_7002_png="animation_7002_png",t.world_map="world_map",t.sheet_memorial="sheet_memorial",t.battle_bg_1="battle_bg_1",t.battle_bg_2="battle_bg_2",t.battle_bg_3="battle_bg_3",t.battle_bg_4="battle_bg_4",t.battle_bg_5="battle_bg_5",t.sheet_office="sheet_office",t.hanyixuejunti_yellow_deepred="hanyixuejunti_yellow_deepred",t.heiti_jianhuang_heibian="heiti_jianhuang_heibian",t.sheet_map="sheet_map",t.world_map_names="world_map_names",t.lobby_harem_bg="lobby_harem_bg",t.sheet_princess="sheet_princess",t.princess_bg="princess_bg",t.sheet_princess_house="sheet_princess_house",t.princess_name="princess_name",t.sheet_princess_position="sheet_princess_position",t.sheet_princess_choose="sheet_princess_choose",t.turncard_bg="turncard_bg",t.sheet_princess_work="sheet_princess_work",t.sheet_princess_rite="sheet_princess_rite",t.princess_rite_bg="princess_rite_bg",t.arena_bg="arena_bg",t.sheet_arena="sheet_arena",t.xingkai_yellow_orange="xingkai_yellow_orange",t.xingkai_blue_deepblue="xingkai_blue_deepblue",t.lobby_world_bg="lobby_world_bg",t.color_star_json="color_star_json",t.orange_star_png="orange_star_png",t.red_star_png="red_star_png",t.blue_star_png="blue_star_png",t.green_star_png="green_star_png",t.garden_house_bg="garden_house_bg",t.flower_bg="flower_bg",t.sheet_garden_house="sheet_garden_house",t.sheet_garden_flower="sheet_garden_flower",t.sheet_technology="sheet_technology",t.sheet_prince="sheet_prince",t.flag_emc="flag_emc",t.arena_cd="arena_cd",t.effect_enter_throne="effect_enter_throne",t.effect_leave_throne="effect_leave_throne",t.effect_back="effect_back",t.effect_enter_scene="effect_enter_scene",t.effect_princess_greet="effect_princess_greet",t.effect_princess_thanks="effect_princess_thanks",t.effect_princess_confirm="effect_princess_confirm",t.effect_memorial_1="effect_memorial_1",t.effect_memorial_2="effect_memorial_2",t.effect_minister_hire_1="effect_minister_hire_1",t.effect_minister_hire_2="effect_minister_hire_2",t.effect_minister_thanks_1="effect_minister_thanks_1",t.effect_minister_thanks_2="effect_minister_thanks_2",t.effect_prince_greet_1="effect_prince_greet_1",t.effect_prince_greet_2="effect_prince_greet_2",t.effect_minister_confirm_1="effect_minister_confirm_1",t.effect_minister_confirm_2="effect_minister_confirm_2",t.login_bg="login_bg",t.sheet_login="sheet_login",t.battle_beat="battle_beat",t.lobby_emc="lobby_emc",t.harem_emc="harem_emc",t.building_name="building_name",t.sheet_shop="sheet_shop",t.shop_bg="shop_bg",t.shop_price="shop_price",t.minister_emc="minister_emc",t.arena_emc="arena_emc",t.sheet_email="sheet_email",t.sheet_minister_info="sheet_minister_info",t.sheet_visit="sheet_visit",t.visit_map="visit_map",t.visit_emc="visit_emc",t.loading_bg="loading_bg",t.sheet_common_c="sheet_common_c",t.sheet_ui_c="sheet_ui_c",t.tips="tips",t.sheet_task="sheet_task",t.lishu_title="lishu_title",t.arena_season_rank="arena_season_rank",t.text_effect_emc="text_effect_emc",t.arena_battle_emc="arena_battle_emc",t.national_power_value="national_power_value",t.sheet_create_player="sheet_create_player",t.create_player_bg="create_player_bg",t.sign_month="sign_month",t.sign_bg="sign_bg",t.princess_party_bg="princess_party_bg",t.sheet_princess_party="sheet_princess_party",t.capital_emc="capital_emc",t.party_theme="party_theme",t.treasure_emc="treasure_emc",t.treasure_bg="treasure_bg",t.sheet_treasure="sheet_treasure",t.rank_bg="rank_bg",t.sheet_rank="sheet_rank",t.sheet_guide="sheet_guide",t.guide="guide",t.activity_bg="activity_bg",t.princess_emc="princess_emc",t.preferential_bg="preferential_bg",t.sheet_preferential="sheet_preferential",t.privacy_clause_txt="privacy_clause_txt",t.tos_txt="tos_txt",t.prison_bg="prison_bg",t.sheet_prison="sheet_prison",t.sheet_minister_avatar_grey="sheet_minister_avatar_grey",t.heiti_quse_heibian="heiti_quse_heibian",t.prison_emc="prison_emc",t.sound_minister_110001_1="sound_minister_110001_1",t.sound_minister_110001_2="sound_minister_110001_2",t.sound_minister_110002_1="sound_minister_110002_1",t.sound_minister_110002_2="sound_minister_110002_2",t.sound_minister_110003_1="sound_minister_110003_1",t.sound_minister_110003_2="sound_minister_110003_2",t.sound_minister_110004_1="sound_minister_110004_1",t.sound_minister_110004_2="sound_minister_110004_2",t.sound_minister_110005_1="sound_minister_110005_1",t.sound_minister_110005_2="sound_minister_110005_2",t.sound_minister_110006_1="sound_minister_110006_1",t.sound_minister_110006_2="sound_minister_110006_2",t.sound_minister_110007_1="sound_minister_110007_1",t.sound_minister_110007_2="sound_minister_110007_2",t.sound_minister_110008_1="sound_minister_110008_1",t.sound_minister_110008_2="sound_minister_110008_2",t.sound_minister_110009_1="sound_minister_110009_1",t.sound_minister_110009_2="sound_minister_110009_2",t.sound_minister_120001_1="sound_minister_120001_1",t.sound_minister_120001_2="sound_minister_120001_2",t.sound_minister_120002_1="sound_minister_120002_1",t.sound_minister_120002_2="sound_minister_120002_2",t.sound_minister_120003_1="sound_minister_120003_1",t.sound_minister_120003_2="sound_minister_120003_2",t.sound_minister_120004_1="sound_minister_120004_1",t.sound_minister_120004_2="sound_minister_120004_2",t.sound_minister_120005_1="sound_minister_120005_1",t.sound_minister_120005_2="sound_minister_120005_2",t.sound_minister_120006_1="sound_minister_120006_1",t.sound_minister_120006_2="sound_minister_120006_2",t.sound_minister_120007_1="sound_minister_120007_1",t.sound_minister_120007_2="sound_minister_120007_2",t.sound_minister_120008_1="sound_minister_120008_1",t.sound_minister_120008_2="sound_minister_120008_2",t.sound_minister_120009_1="sound_minister_120009_1",t.sound_minister_120009_2="sound_minister_120009_2",t.sound_minister_120010_1="sound_minister_120010_1",t.sound_minister_120010_2="sound_minister_120010_2",t.sound_minister_120011_1="sound_minister_120011_1",t.sound_minister_120011_2="sound_minister_120011_2",t.sound_minister_120012_1="sound_minister_120012_1",t.sound_minister_120012_2="sound_minister_120012_2",t.sound_minister_130001_1="sound_minister_130001_1",t.sound_minister_130001_2="sound_minister_130001_2",t.sound_minister_130002_1="sound_minister_130002_1",t.sound_minister_130002_2="sound_minister_130002_2",t.sound_minister_130003_1="sound_minister_130003_1",t.sound_minister_130003_2="sound_minister_130003_2",t.sound_minister_130004_1="sound_minister_130004_1",t.sound_minister_130004_2="sound_minister_130004_2",t.sound_minister_130005_1="sound_minister_130005_1",t.sound_minister_130005_2="sound_minister_130005_2",t.sound_minister_130006_1="sound_minister_130006_1",t.sound_minister_130006_2="sound_minister_130006_2",t.sound_minister_130007_1="sound_minister_130007_1",t.sound_minister_130007_2="sound_minister_130007_2",t.sound_minister_130008_1="sound_minister_130008_1",t.sound_minister_130008_2="sound_minister_130008_2",t.sound_minister_130009_1="sound_minister_130009_1",t.sound_minister_130009_2="sound_minister_130009_2",t.sound_minister_130010_1="sound_minister_130010_1",t.sound_minister_130010_2="sound_minister_130010_2",t.sound_minister_130011_1="sound_minister_130011_1",t.sound_minister_130011_2="sound_minister_130011_2",t.sound_minister_130012_1="sound_minister_130012_1",t.sound_minister_130012_2="sound_minister_130012_2",t.sound_minister_140001_1="sound_minister_140001_1",t.sound_minister_140001_2="sound_minister_140001_2",t.sound_minister_140002_1="sound_minister_140002_1",t.sound_minister_140002_2="sound_minister_140002_2",t.sound_minister_140003_1="sound_minister_140003_1",t.sound_minister_140003_2="sound_minister_140003_2",t.sound_minister_140004_1="sound_minister_140004_1",t.sound_minister_140004_2="sound_minister_140004_2",t.sound_princess_200001_1="sound_princess_200001_1",t.sound_princess_200001_2="sound_princess_200001_2",t.sound_princess_200002_1="sound_princess_200002_1",t.sound_princess_200002_2="sound_princess_200002_2",t.sound_princess_200003_1="sound_princess_200003_1",t.sound_princess_200003_2="sound_princess_200003_2",t.sound_princess_200004_1="sound_princess_200004_1",t.sound_princess_200004_2="sound_princess_200004_2",t.sound_princess_200005_1="sound_princess_200005_1",t.sound_princess_200005_2="sound_princess_200005_2",t.sound_princess_200006_1="sound_princess_200006_1",t.sound_princess_200006_2="sound_princess_200006_2",t.sound_princess_200007_1="sound_princess_200007_1",t.sound_princess_200007_2="sound_princess_200007_2",t.sound_princess_200008_1="sound_princess_200008_1",t.sound_princess_200008_2="sound_princess_200008_2",t.sound_princess_200009_1="sound_princess_200009_1",t.sound_princess_200009_2="sound_princess_200009_2",t.sound_princess_200010_1="sound_princess_200010_1",t.sound_princess_200010_2="sound_princess_200010_2",t.sound_princess_200011_1="sound_princess_200011_1",t.sound_princess_200011_2="sound_princess_200011_2",t.sound_princess_200012_1="sound_princess_200012_1",t.sound_princess_200012_2="sound_princess_200012_2",t.sound_princess_200013_1="sound_princess_200013_1",t.sound_princess_200013_2="sound_princess_200013_2",t.sound_princess_200014_1="sound_princess_200014_1",t.sound_princess_200014_2="sound_princess_200014_2",t.sound_princess_200015_1="sound_princess_200015_1",t.sound_princess_200015_2="sound_princess_200015_2",t.sound_princess_200016_1="sound_princess_200016_1",t.sound_princess_200016_2="sound_princess_200016_2",t.sound_princess_200017_1="sound_princess_200017_1",t.sound_princess_200017_2="sound_princess_200017_2",t.sound_princess_200018_1="sound_princess_200018_1",t.sound_princess_200018_2="sound_princess_200018_2",t.sheet_union="sheet_union",t.union_info="union_info",t.union_level="union_level",t.union_bg="union_bg",t.activity_grade="activity_grade",t.activity_name="activity_name",t.activity_type="activity_type",t.sheet_activity="sheet_activity",t.notice_bg="notice_bg",t.create_player_boy="create_player_boy",t.create_player_girl="create_player_girl",t.sheet_union_c="sheet_union_c",t.sheet_activity_c="sheet_activity_c",t.sheet_shop_c="sheet_shop_c",t.sheet_task_c="sheet_task_c",t.sheet_prison_c="sheet_prison_c",t.sheet_chat_c="sheet_chat_c",t.sheet_face="sheet_face",t.sheet_item_upgrade="sheet_item_upgrade",t.duplicate_bg="duplicate_bg",t.sheet_duplicate_c="sheet_duplicate_c",t.sheet_duplicate="sheet_duplicate",t.boss_hp="boss_hp",t.boss_name="boss_name",t.sheet_buffer_icon="sheet_buffer_icon",t.panel_title_2="panel_title_2",t.princess_name_2="princess_name_2",t.sound_arena_injured="sound_arena_injured",t.sound_arena_select_all="sound_arena_select_all",t.sound_arena_select_command="sound_arena_select_command",t.sound_arena_select_knowledge="sound_arena_select_knowledge",t.sound_arena_select_politics="sound_arena_select_politics",t.sound_arena_start="sound_arena_start",t.sound_close="sound_close",t.sound_gain_items="sound_gain_items",t.sound_impose_mineral="sound_impose_mineral",t.sound_impose_silver="sound_impose_silver",t.sound_impose_troops="sound_impose_troops",t.sound_minister_upgrade="sound_minister_upgrade",t.sound_shangchao="sound_shangchao",t.sound_start_game="sound_start_game",t.sound_tab_select="sound_tab_select",t.sound_take_seal="sound_take_seal",t.sound_tap_button="sound_tap_button",t.common_emc="common_emc",t.preferential_emc="preferential_emc",t.item_effect_1001="item_effect_1001",t.item_effect_1002="item_effect_1002",t.item_effect_1003="item_effect_1003",t.item_effect_1004="item_effect_1004",t.item_effect_600100="item_effect_600100",t.item_effect_611006="item_effect_611006",t.item_effect_611007="item_effect_611007",t.item_effect_611008="item_effect_611008",t.item_effect_611009="item_effect_611009",t.item_effect_611010="item_effect_611010",t.item_effect_612006="item_effect_612006",t.item_effect_612007="item_effect_612007",t.item_effect_612008="item_effect_612008",t.item_effect_612009="item_effect_612009",t.item_effect_612010="item_effect_612010",t.item_effect_613006="item_effect_613006",t.item_effect_613007="item_effect_613007",t.item_effect_613008="item_effect_613008",t.item_effect_613009="item_effect_613009",t.item_effect_613010="item_effect_613010",t.sheet_open="sheet_open",t.ani_princess_200001="ani_princess_200001",t.ani_princess_200002="ani_princess_200002",t.ani_princess_200003="ani_princess_200003",t.ani_princess_200004="ani_princess_200004",t.ani_princess_200005="ani_princess_200005",t.ani_princess_200006="ani_princess_200006",t.ani_princess_200007="ani_princess_200007",t.ani_princess_200008="ani_princess_200008",t.ani_princess_200009="ani_princess_200009",t.ani_princess_200010="ani_princess_200010",t.ani_princess_200011="ani_princess_200011",t.ani_princess_200012="ani_princess_200012",t.ani_princess_200013="ani_princess_200013",t.ani_princess_200014="ani_princess_200014",t.ani_princess_200015="ani_princess_200015",t.ani_princess_200016="ani_princess_200016",t.ani_princess_200017="ani_princess_200017",t.ani_princess_200018="ani_princess_200018",t.bottom_bar_activity="bottom_bar_activity",t.bottom_bar_battle="bottom_bar_battle",t.music_battle="music_battle",t.music_lobby_capital="music_lobby_capital",t.music_lobby_harem="music_lobby_harem",t.music_lobby_main="music_lobby_main",t.city_name="city_name",t.sheet_main_stage="sheet_main_stage",t.sheet_visit_c="sheet_visit_c",t.sheet_world_boss="sheet_world_boss",t.story_bg_2001="story_bg_2001",t.story_bg_2002="story_bg_2002",t.story_bg_2003="story_bg_2003",t.story_bg_2004="story_bg_2004",t.story_bg_2005="story_bg_2005",t.story_bg_2006="story_bg_2006",t.world_boss_emc="world_boss_emc",t.first_charge_bg="first_charge_bg",t.first_charge_emc="first_charge_emc",t.loading_icon_point="loading_icon_point",t.loading_icon_point_2="loading_icon_point_2",t.loading_logo="loading_logo",t.loading_thumb_bar="loading_thumb_bar",t.loading_thumb_part="loading_thumb_part",t.loading_track="loading_track",t.battle_avatar_blue_bg="battle_avatar_blue_bg",t.battle_avatar_red_bg="battle_avatar_red_bg",t.battle_avatar_silver_border="battle_avatar_silver_border",t.battle_button_world_map="battle_button_world_map",t.battle_country_name_bg="battle_country_name_bg",t.battle_icon_master="battle_icon_master",t.battle_icon_slave="battle_icon_slave",t.battle_info_bg="battle_info_bg",t.battle_info_blue_bg="battle_info_blue_bg",t.battle_info_red_bg="battle_info_red_bg",t.battle_panel_bg_0="battle_panel_bg_0",t.battle_panel_bg_1="battle_panel_bg_1",t.battle_panel_reward_bg="battle_panel_reward_bg",t.battle_panel_reward_title="battle_panel_reward_title",t.battle_panel_title="battle_panel_title",t.battle_point_attack="battle_point_attack",t.battle_progress_blue_thumb="battle_progress_blue_thumb",t.battle_progress_red_thumb="battle_progress_red_thumb",t.battle_progress_track="battle_progress_track",t.battle_start_battle="battle_start_battle",t.battle_start_battle_bg="battle_start_battle_bg",t.battle_text_bg="battle_text_bg",t.item_1="item_1",t.item_1_small="item_1_small",t.item_2="item_2",t.item_2_small="item_2_small",t.item_3="item_3",t.item_3_small="item_3_small",t.item_4="item_4",t.item_4_small="item_4_small",t.item_5_small="item_5_small",t.item_6="item_6",t.item_600001="item_600001",t.item_600002="item_600002",t.item_600003="item_600003",t.item_600004="item_600004",t.item_600005="item_600005",t.item_600006="item_600006",t.item_600007="item_600007",t.item_600008="item_600008",t.item_600009="item_600009",t.item_600010="item_600010",t.item_600011="item_600011",t.item_600012="item_600012",t.item_600013="item_600013",t.item_600014="item_600014",t.item_600015="item_600015",t.item_600016="item_600016",t.item_600017="item_600017",t.item_600018="item_600018",t.item_600019="item_600019",t.item_600020="item_600020",t.item_600021="item_600021",t.item_600022="item_600022",t.item_600023="item_600023",t.item_600024="item_600024",t.item_600025="item_600025",t.item_600026="item_600026",t.item_600027="item_600027",t.item_600028="item_600028",t.item_600029="item_600029",t.item_600030="item_600030",t.item_600031="item_600031",t.item_600032="item_600032",t.item_600033="item_600033",t.item_600034="item_600034",t.item_600035="item_600035",t.item_600036="item_600036",t.item_600037="item_600037",t.item_600038="item_600038",t.item_600039="item_600039",t.item_600040="item_600040",t.item_600041="item_600041",t.item_600042="item_600042",t.item_600043="item_600043",t.item_600044="item_600044",t.item_600045="item_600045",t.item_600046="item_600046",t.item_600047="item_600047",t.item_600048="item_600048",t.item_600049="item_600049",t.item_600050="item_600050",t.item_600051="item_600051",t.item_600052="item_600052",t.item_600053="item_600053",t.item_600054="item_600054",t.item_600055="item_600055",t.item_600056="item_600056",t.item_600057="item_600057",t.item_600058="item_600058",t.item_600059="item_600059",t.item_600060="item_600060",t.item_600061="item_600061",t.item_600062="item_600062",t.item_600063="item_600063",t.item_600064="item_600064",t.item_600065="item_600065",t.item_600066="item_600066",t.item_600067="item_600067",t.item_600068="item_600068",t.item_600069="item_600069",t.item_600070="item_600070",t.item_600071="item_600071",t.item_600072="item_600072",t.item_600073="item_600073",t.item_600074="item_600074",t.item_600075="item_600075",t.item_600077="item_600077",t.item_600078="item_600078",t.item_600079="item_600079",t.item_600080="item_600080",t.item_600081="item_600081",t.item_600082="item_600082",t.item_600083="item_600083",t.item_600084="item_600084",t.item_600085="item_600085",t.item_600086="item_600086",t.item_600087="item_600087",t.item_600088="item_600088",t.item_600089="item_600089",t.item_600090="item_600090",t.item_600091="item_600091",t.item_600092="item_600092",t.item_600093="item_600093",t.item_600100="item_600100",t.item_600101="item_600101",t.item_600102="item_600102",t.item_600103="item_600103",t.item_600104="item_600104",t.item_600105="item_600105",t.item_600106="item_600106",t.item_600107="item_600107",t.item_600108="item_600108",t.item_600109="item_600109",t.item_600110="item_600110",t.item_600111="item_600111",t.item_600112="item_600112",t.item_600113="item_600113",t.item_600114="item_600114",t.item_600115="item_600115",t.item_600116="item_600116",t.item_600117="item_600117",t.item_600118="item_600118",t.item_611001="item_611001",t.item_611002="item_611002",t.item_611003="item_611003",t.item_611004="item_611004",t.item_611005="item_611005",t.item_611006="item_611006",t.item_611007="item_611007",t.item_611008="item_611008",t.item_611009="item_611009",t.item_611010="item_611010",t.item_612001="item_612001",t.item_612002="item_612002",t.item_612003="item_612003",t.item_612004="item_612004",t.item_612005="item_612005",t.item_612006="item_612006",t.item_612007="item_612007",t.item_612008="item_612008",t.item_612009="item_612009",t.item_612010="item_612010",t.item_613001="item_613001",t.item_613002="item_613002",t.item_613003="item_613003",t.item_613004="item_613004",t.item_613005="item_613005",t.item_613006="item_613006",t.item_613007="item_613007",t.item_613008="item_613008",t.item_613009="item_613009",t.item_613010="item_613010",t.item_620001="item_620001",t.item_620002="item_620002",t.item_620003="item_620003",t.item_620004="item_620004",t.item_620005="item_620005",t.item_620006="item_620006",t.item_620007="item_620007",t.item_620011="item_620011",t.item_620012="item_620012",t.item_620013="item_620013",t.item_620014="item_620014",t.item_620015="item_620015",t.item_620017="item_620017",t.item_6_small="item_6_small",t.item_7="item_7",t.item_7_small="item_7_small",t.item_command="item_command",t.item_knowledge="item_knowledge",t.item_politics="item_politics",t.common_avatar_bg="common_avatar_bg",t.common_avatar_bg_grey="common_avatar_bg_grey",t.common_avatar_top="common_avatar_top",t.common_avatar_top_grey="common_avatar_top_grey",t.common_bar_bg="common_bar_bg",t.common_button_help="common_button_help",t.common_button_skip_story="common_button_skip_story",t.common_cd_bg="common_cd_bg",t.common_decree_panel_bg="common_decree_panel_bg",t.common_decree_panel_bg_left="common_decree_panel_bg_left",t.common_decree_panel_bg_right="common_decree_panel_bg_right",t.common_dialog_bg="common_dialog_bg",t.common_icon_button_bg="common_icon_button_bg",t.common_image_2="common_image_2",t.common_image_dragon="common_image_dragon",t.common_img_2="common_img_2",t.common_img_4="common_img_4",t.common_img_5="common_img_5",t.common_img_industry="common_img_industry",t.common_img_military="common_img_military",t.common_img_small_dragon="common_img_small_dragon",t.common_img_trade="common_img_trade",t.common_item_bg="common_item_bg",t.common_item_cell_bg="common_item_cell_bg",t.common_item_cell_bg_gap="common_item_cell_bg_gap",t.common_item_quality_0="common_item_quality_0",t.common_item_quality_1="common_item_quality_1",t.common_item_quality_2="common_item_quality_2",t.common_item_quality_3="common_item_quality_3",t.common_item_quality_4="common_item_quality_4",t.common_item_quality_5="common_item_quality_5",t.common_item_selector="common_item_selector",t.common_light="common_light",t.common_luck="common_luck",t.common_minister_appoint="common_minister_appoint",t.common_minister_body_mask="common_minister_body_mask",t.common_minister_name_bg="common_minister_name_bg",t.common_minister_quality_black_layer_small="common_minister_quality_black_layer_small",t.common_minister_question="common_minister_question",t.common_panel_bg_2="common_panel_bg_2",t.common_panel_info_blue_bg="common_panel_info_blue_bg",t.common_panel_info_blue_field_bg="common_panel_info_blue_field_bg",t.common_panel_info_blue_name_bg="common_panel_info_blue_name_bg",t.common_panel_info_red_bg="common_panel_info_red_bg",t.common_panel_info_red_field_bg="common_panel_info_red_field_bg",t.common_panel_info_red_name_bg="common_panel_info_red_name_bg",t.common_panel_result_blue_part_0="common_panel_result_blue_part_0",t.common_panel_result_blue_title="common_panel_result_blue_title",t.common_panel_result_red_part_0="common_panel_result_red_part_0",t.common_panel_result_red_title="common_panel_result_red_title",t.common_panel_title_bg="common_panel_title_bg",t.common_panel_title_bg_2="common_panel_title_bg_2",t.common_ranking_num_1="common_ranking_num_1",t.common_ranking_num_2="common_ranking_num_2",t.common_ranking_num_3="common_ranking_num_3",t.common_scene_top="common_scene_top",t.common_scene_top_bg="common_scene_top_bg",t.common_seal="common_seal",t.common_select_bg="common_select_bg",t.common_sign_get="common_sign_get",t.common_skill_bg="common_skill_bg",t.common_skill_level_bg="common_skill_level_bg",t.common_skill_outline="common_skill_outline",t.common_title_bg_1="common_title_bg_1",t.common_title_bg_3="common_title_bg_3",t.common_title_bg_4="common_title_bg_4",t.common_title_complete="common_title_complete",t.common_title_get_items="common_title_get_items",t.common_treasure_box_close="common_treasure_box_close",t.common_treasure_box_open="common_treasure_box_open",t.common_unselect_bg="common_unselect_bg",t.icon_area="icon_area",t.icon_attack="icon_attack",t.icon_cash_gift="icon_cash_gift",t.icon_chat="icon_chat",t.icon_critical="icon_critical",t.icon_emerald="icon_emerald",t.icon_gold="icon_gold",t.icon_gold_single="icon_gold_single",t.icon_hp="icon_hp",t.icon_impose="icon_impose",t.icon_industry="icon_industry",t.icon_mail="icon_mail",t.icon_military="icon_military",t.icon_mineral="icon_mineral",t.icon_name_icon_1="icon_name_icon_1",t.icon_name_icon_2="icon_name_icon_2",t.icon_name_icon_3="icon_name_icon_3",t.icon_name_icon_4="icon_name_icon_4",t.icon_silver="icon_silver",t.icon_tip_point="icon_tip_point",t.icon_trade="icon_trade",t.icon_troops="icon_troops",t.icon_visit_energy="icon_visit_energy",t.icon_visit_seal="icon_visit_seal",t.text_country_propties="text_country_propties",t.text_development_queue="text_development_queue",t.text_industry="text_industry",t.text_military="text_military",t.text_trade="text_trade",t.text_treasure_advance="text_treasure_advance",t.text_treasure_command="text_treasure_command",t.text_treasure_knowledge="text_treasure_knowledge",t.text_treasure_politics="text_treasure_politics",t.ui_button_add_h="ui_button_add_h",t.ui_button_add_n="ui_button_add_n",t.ui_button_attend_h="ui_button_attend_h",t.ui_button_attend_n="ui_button_attend_n",t.ui_button_back_h="ui_button_back_h",t.ui_button_back_n="ui_button_back_n",t.ui_button_blue_h="ui_button_blue_h",t.ui_button_blue_n="ui_button_blue_n",t.ui_button_change_h="ui_button_change_h",t.ui_button_change_n="ui_button_change_n",t.ui_button_close_h="ui_button_close_h",t.ui_button_close_n="ui_button_close_n",t.ui_button_color_d="ui_button_color_d",t.ui_button_cyan_h="ui_button_cyan_h",t.ui_button_cyan_n="ui_button_cyan_n",t.ui_button_decrease="ui_button_decrease",t.ui_button_green_h="ui_button_green_h",t.ui_button_green_n="ui_button_green_n",t.ui_button_icon_close_h="ui_button_icon_close_h",t.ui_button_icon_close_n="ui_button_icon_close_n",t.ui_button_increase="ui_button_increase",t.ui_button_orange_h="ui_button_orange_h",t.ui_button_orange_n="ui_button_orange_n",t.ui_button_red_h="ui_button_red_h",t.ui_button_red_n="ui_button_red_n",t.ui_button_refresh_h="ui_button_refresh_h",t.ui_button_refresh_n="ui_button_refresh_n",t.ui_change="ui_change",t.ui_checkbox_flag="ui_checkbox_flag",t.ui_panel_button_close_h="ui_panel_button_close_h",t.ui_panel_button_close_n="ui_panel_button_close_n",t.ui_progress_3_track="ui_progress_3_track",t.ui_radio_bg="ui_radio_bg",t.ui_radio_bg_2="ui_radio_bg_2",t.ui_radio_flag="ui_radio_flag",t.ui_radio_flag_2="ui_radio_flag_2",t.ui_slider_thumb="ui_slider_thumb",t.ui_switch_off="ui_switch_off",t.ui_switch_on="ui_switch_on",t.ui_tab_button2_h="ui_tab_button2_h",t.ui_tab_button2_n="ui_tab_button2_n",t.ui_tab_button4_h="ui_tab_button4_h",t.ui_tab_button4_n="ui_tab_button4_n",t.ui_tab_button_h="ui_tab_button_h",t.ui_tab_button_n="ui_tab_button_n",t.interior_choose_minister="interior_choose_minister",t.interior_develop_bg="interior_develop_bg",t.interior_img_0="interior_img_0",t.interior_impose_img_0="interior_impose_img_0",t.interior_impose_item_cover_industry="interior_impose_item_cover_industry",t.interior_impose_item_cover_military="interior_impose_item_cover_military",t.interior_impose_item_cover_trade="interior_impose_item_cover_trade",t.interior_lock="interior_lock",t.interior_minister_default="interior_minister_default",t.interior_national_props="interior_national_props",t.interior_program_bg="interior_program_bg",t.interior_scroll="interior_scroll",t.interior_scroll_business="interior_scroll_business",t.interior_scroll_industry="interior_scroll_industry",t.interior_scroll_military="interior_scroll_military",t.interior_send="interior_send",t.interior_state_developing="interior_state_developing",t.interior_state_finish="interior_state_finish",t.minister_avatar_110001="minister_avatar_110001",t.minister_avatar_110002="minister_avatar_110002",t.minister_avatar_110003="minister_avatar_110003",t.minister_avatar_110004="minister_avatar_110004",t.minister_avatar_110005="minister_avatar_110005",t.minister_avatar_110006="minister_avatar_110006",t.minister_avatar_110007="minister_avatar_110007",t.minister_avatar_110008="minister_avatar_110008",t.minister_avatar_110009="minister_avatar_110009",t.minister_avatar_120001="minister_avatar_120001",t.minister_avatar_120002="minister_avatar_120002",t.minister_avatar_120003="minister_avatar_120003",t.minister_avatar_120004="minister_avatar_120004",t.minister_avatar_120005="minister_avatar_120005",t.minister_avatar_120006="minister_avatar_120006",t.minister_avatar_120007="minister_avatar_120007",t.minister_avatar_120008="minister_avatar_120008",t.minister_avatar_120009="minister_avatar_120009",t.minister_avatar_120010="minister_avatar_120010",t.minister_avatar_120011="minister_avatar_120011",t.minister_avatar_120012="minister_avatar_120012",t.minister_avatar_130001="minister_avatar_130001",t.minister_avatar_130002="minister_avatar_130002",t.minister_avatar_130003="minister_avatar_130003",t.minister_avatar_130004="minister_avatar_130004",t.minister_avatar_130005="minister_avatar_130005",t.minister_avatar_130006="minister_avatar_130006",t.minister_avatar_130007="minister_avatar_130007",t.minister_avatar_130008="minister_avatar_130008",t.minister_avatar_130009="minister_avatar_130009",t.minister_avatar_130010="minister_avatar_130010",t.minister_avatar_130011="minister_avatar_130011",t.minister_avatar_130012="minister_avatar_130012",t.minister_avatar_140001="minister_avatar_140001",t.minister_avatar_140002="minister_avatar_140002",t.minister_avatar_140003="minister_avatar_140003",t.minister_avatar_140004="minister_avatar_140004",t.minister_avatar_7001="minister_avatar_7001",t.minister_avatar_7002="minister_avatar_7002",t.minister_avatar_block_1001="minister_avatar_block_1001",t.minister_avatar_block_1002="minister_avatar_block_1002",t.minister_avatar_block_1003="minister_avatar_block_1003",t.minister_avatar_block_1004="minister_avatar_block_1004",t.minister_avatar_block_1005="minister_avatar_block_1005",t.minister_avatar_block_110001="minister_avatar_block_110001",t.minister_avatar_block_110002="minister_avatar_block_110002",t.minister_avatar_block_110003="minister_avatar_block_110003",t.minister_avatar_block_110004="minister_avatar_block_110004",t.minister_avatar_block_110005="minister_avatar_block_110005",t.minister_avatar_block_110006="minister_avatar_block_110006",t.minister_avatar_block_110007="minister_avatar_block_110007",t.minister_avatar_block_110008="minister_avatar_block_110008",t.minister_avatar_block_110009="minister_avatar_block_110009",t.minister_avatar_block_120001="minister_avatar_block_120001",t.minister_avatar_block_120002="minister_avatar_block_120002",t.minister_avatar_block_120003="minister_avatar_block_120003",t.minister_avatar_block_120004="minister_avatar_block_120004",t.minister_avatar_block_120005="minister_avatar_block_120005",t.minister_avatar_block_120006="minister_avatar_block_120006",t.minister_avatar_block_120007="minister_avatar_block_120007",t.minister_avatar_block_120008="minister_avatar_block_120008",t.minister_avatar_block_120009="minister_avatar_block_120009",t.minister_avatar_block_120010="minister_avatar_block_120010",t.minister_avatar_block_120011="minister_avatar_block_120011",t.minister_avatar_block_120012="minister_avatar_block_120012",t.minister_avatar_block_130001="minister_avatar_block_130001",t.minister_avatar_block_130002="minister_avatar_block_130002",t.minister_avatar_block_130003="minister_avatar_block_130003",t.minister_avatar_block_130004="minister_avatar_block_130004",t.minister_avatar_block_130005="minister_avatar_block_130005",t.minister_avatar_block_130006="minister_avatar_block_130006",t.minister_avatar_block_130007="minister_avatar_block_130007",t.minister_avatar_block_130008="minister_avatar_block_130008",t.minister_avatar_block_130009="minister_avatar_block_130009",t.minister_avatar_block_130010="minister_avatar_block_130010",t.minister_avatar_block_130011="minister_avatar_block_130011",t.minister_avatar_block_130012="minister_avatar_block_130012",t.minister_avatar_block_140001="minister_avatar_block_140001",t.minister_avatar_block_140002="minister_avatar_block_140002",t.minister_avatar_block_140003="minister_avatar_block_140003",t.minister_avatar_block_140004="minister_avatar_block_140004",t.minister_avatar_block_200001="minister_avatar_block_200001",t.minister_avatar_block_200002="minister_avatar_block_200002",t.minister_avatar_block_200003="minister_avatar_block_200003",t.minister_avatar_block_200004="minister_avatar_block_200004",t.minister_avatar_block_200005="minister_avatar_block_200005",t.minister_avatar_block_200006="minister_avatar_block_200006",t.minister_avatar_block_200007="minister_avatar_block_200007",t.minister_avatar_block_200008="minister_avatar_block_200008",t.minister_avatar_block_200009="minister_avatar_block_200009",t.minister_avatar_block_200010="minister_avatar_block_200010",t.minister_avatar_block_200011="minister_avatar_block_200011",t.minister_avatar_block_200012="minister_avatar_block_200012",t.minister_avatar_block_200013="minister_avatar_block_200013",t.minister_avatar_block_200014="minister_avatar_block_200014",t.minister_avatar_block_200015="minister_avatar_block_200015",t.minister_avatar_block_200016="minister_avatar_block_200016",t.minister_avatar_block_200017="minister_avatar_block_200017",t.minister_avatar_block_200018="minister_avatar_block_200018",t.minister_avatar_block_2001="minister_avatar_block_2001",t.minister_avatar_block_2002="minister_avatar_block_2002",t.minister_avatar_block_2003="minister_avatar_block_2003",t.minister_avatar_block_2004="minister_avatar_block_2004",t.minister_avatar_block_2005="minister_avatar_block_2005",t.minister_avatar_block_5="minister_avatar_block_5",t.minister_avatar_block_6="minister_avatar_block_6",t.minister_avatar_block_7="minister_avatar_block_7",t.minister_avatar_block_8="minister_avatar_block_8",t.minister_border_1="minister_border_1",t.minister_border_2="minister_border_2",t.minister_border_3="minister_border_3",t.minister_hire_button_hire="minister_hire_button_hire",t.minister_hire_button_hire_d="minister_hire_button_hire_d",t.minister_hire_hired="minister_hire_hired",t.minister_hire_inner_shadow="minister_hire_inner_shadow",t.minister_hire_item_bg="minister_hire_item_bg",t.minister_hire_panel_bg="minister_hire_panel_bg",t.minister_hire_panel_field_bg="minister_hire_panel_field_bg",t.minister_hire_panel_name_bg="minister_hire_panel_name_bg",t.minister_level_bg="minister_level_bg",t.minister_luck_bg="minister_luck_bg",t.minister_luck_title_bg="minister_luck_title_bg",t.minister_peerage_1="minister_peerage_1",t.minister_peerage_2="minister_peerage_2",t.minister_peerage_3="minister_peerage_3",t.minister_peerage_4="minister_peerage_4",t.minister_peerage_5="minister_peerage_5",t.minister_peerage_6="minister_peerage_6",t.minister_picture_info_bg="minister_picture_info_bg",t.minister_picture_item_bg="minister_picture_item_bg",t.minister_picture_quality_0="minister_picture_quality_0",t.minister_picture_quality_1="minister_picture_quality_1",t.minister_picture_quality_2="minister_picture_quality_2",t.minister_picture_quality_3="minister_picture_quality_3",t.minister_quality_black_layer="minister_quality_black_layer",t.minister_quality_flag_1="minister_quality_flag_1",t.minister_quality_flag_2="minister_quality_flag_2",t.minister_quality_flag_3="minister_quality_flag_3",t.minister_quality_flag_4="minister_quality_flag_4",t.skill_50001="skill_50001",t.skill_50002="skill_50002",t.skill_50003="skill_50003",t.skill_50004="skill_50004",t.skill_50005="skill_50005",t.skill_50006="skill_50006",t.skill_50007="skill_50007",t.skill_50008="skill_50008",t.skill_50009="skill_50009",t.skill_bg="skill_bg",t.skill_name_50001="skill_name_50001",t.skill_name_50002="skill_name_50002",t.skill_name_50003="skill_name_50003",t.skill_name_50004="skill_name_50004",t.skill_name_50005="skill_name_50005",t.skill_name_50006="skill_name_50006",t.skill_name_50007="skill_name_50007",t.skill_name_50008="skill_name_50008",t.skill_name_50009="skill_name_50009",t.warehouse_item_cell_combine_bg="warehouse_item_cell_combine_bg",t.throne_bottom_button_bg="throne_bottom_button_bg",t.throne_button_back_h="throne_button_back_h",t.throne_button_back_n="throne_button_back_n",t.throne_icon_interior="throne_icon_interior",t.throne_icon_memorial="throne_icon_memorial",t.throne_icon_office="throne_icon_office",t.throne_label_interior="throne_label_interior",t.throne_label_memorial="throne_label_memorial",t.throne_label_office="throne_label_office",t.lobby_arrow_left="lobby_arrow_left",t.lobby_arrow_right="lobby_arrow_right",t.lobby_bottom_bar_bg="lobby_bottom_bar_bg",t.lobby_building_name_bg="lobby_building_name_bg",t.lobby_building_name_bg_pink="lobby_building_name_bg_pink",t.lobby_capital_sail_big="lobby_capital_sail_big",t.lobby_capital_sail_small="lobby_capital_sail_small",t.lobby_capital_ship="lobby_capital_ship",t.lobby_cloud_0="lobby_cloud_0",t.lobby_cloud_1="lobby_cloud_1",t.lobby_cloud_2="lobby_cloud_2",t.lobby_flower_0="lobby_flower_0",t.lobby_flower_1="lobby_flower_1",t.lobby_flower_2="lobby_flower_2",t.lobby_flower_3="lobby_flower_3",t.lobby_flower_4="lobby_flower_4",t.lobby_glow_bug_body="lobby_glow_bug_body",t.lobby_glow_bug_glow="lobby_glow_bug_glow",t.lobby_head_1001="lobby_head_1001",t.lobby_head_1002="lobby_head_1002",t.lobby_head_1003="lobby_head_1003",t.lobby_head_1004="lobby_head_1004",t.lobby_head_1005="lobby_head_1005",t.lobby_head_2001="lobby_head_2001",t.lobby_head_2002="lobby_head_2002",t.lobby_head_2003="lobby_head_2003",t.lobby_head_2004="lobby_head_2004",t.lobby_head_2005="lobby_head_2005",t.lobby_head_bg="lobby_head_bg",t.lobby_icon_activity="lobby_icon_activity",t.lobby_icon_battle="lobby_icon_battle",t.lobby_icon_boss="lobby_icon_boss",t.lobby_icon_chat="lobby_icon_chat",t.lobby_icon_firstCharge="lobby_icon_firstCharge",t.lobby_icon_glow_down="lobby_icon_glow_down",t.lobby_icon_glow_up="lobby_icon_glow_up",t.lobby_icon_limit="lobby_icon_limit",t.lobby_icon_mission="lobby_icon_mission",t.lobby_icon_preferential="lobby_icon_preferential",t.lobby_icon_prison="lobby_icon_prison",t.lobby_icon_rank="lobby_icon_rank",t.lobby_icon_shop="lobby_icon_shop",t.lobby_icon_warehouse="lobby_icon_warehouse",t.lobby_main_mask="lobby_main_mask",t.lobby_national_power_bg="lobby_national_power_bg",t.lobby_national_power_label="lobby_national_power_label",t.lobby_resource_bg="lobby_resource_bg",t.lobby_small_icon_bg="lobby_small_icon_bg",t.lobby_task_finish="lobby_task_finish",t.lobby_task_go="lobby_task_go",t.lobby_top_bar_bg="lobby_top_bar_bg",t.lobby_vip_0="lobby_vip_0",t.lobby_vip_1="lobby_vip_1",t.lobby_vip_10="lobby_vip_10",t.lobby_vip_11="lobby_vip_11",t.lobby_vip_12="lobby_vip_12",t.lobby_vip_2="lobby_vip_2",t.lobby_vip_3="lobby_vip_3",t.lobby_vip_4="lobby_vip_4",t.lobby_vip_5="lobby_vip_5",t.lobby_vip_6="lobby_vip_6",t.lobby_vip_7="lobby_vip_7",t.lobby_vip_8="lobby_vip_8",t.lobby_vip_9="lobby_vip_9",t.lobby_vip_bg_0="lobby_vip_bg_0",t.lobby_vip_bg_1="lobby_vip_bg_1",t.lobby_vip_bg_2="lobby_vip_bg_2",t.lobby_vip_bg_3="lobby_vip_bg_3",t.memorial_bg="memorial_bg",t.memorial_option_1="memorial_option_1",t.memorial_option_2="memorial_option_2",t.office_avatar_bg="office_avatar_bg",t.office_class_1="office_class_1",t.office_class_2="office_class_2",t.office_class_3="office_class_3",t.office_class_4="office_class_4",t.office_class_5="office_class_5",t.office_class_6="office_class_6",t.office_class_7="office_class_7",t.office_class_8="office_class_8",t.office_class_9="office_class_9",t.office_class_degree_detail="office_class_degree_detail",t.office_class_degree_title="office_class_degree_title",t.office_group_0="office_group_0",t.office_group_1="office_group_1",t.office_group_2="office_group_2",t.office_group_3="office_group_3",t.office_group_4="office_group_4",t.office_group_5="office_group_5",t.map_7001="map_7001",t.map_7002="map_7002",t.map_7003="map_7003",t.map_7004="map_7004",t.map_7005="map_7005",t.map_7006="map_7006",t.map_7007="map_7007",t.map_7008="map_7008",t.map_7009="map_7009",t.map_7010="map_7010",t.map_7011="map_7011",t.map_7012="map_7012",t.map_7013="map_7013",t.map_7014="map_7014",t.map_7015="map_7015",t.map_7016="map_7016",t.map_7017="map_7017",t.map_7018="map_7018",t.map_7019="map_7019",t.map_7020="map_7020",t.map_7021="map_7021",t.map_7022="map_7022",t.map_7023="map_7023",t.map_7024="map_7024",t.map_7025="map_7025",t.map_7026="map_7026",t.map_7027="map_7027",t.map_7028="map_7028",t.map_7029="map_7029",t.map_7030="map_7030",t.map_7031="map_7031",t.map_7032="map_7032",t.map_7033="map_7033",t.map_7034="map_7034",t.map_7035="map_7035",t.map_7036="map_7036",t.map_8024="map_8024",t.princess_avatar_bg="princess_avatar_bg",t.princess_avatar_mask="princess_avatar_mask",t.princess_button_select="princess_button_select",t.princess_charm="princess_charm",t.princess_name_bg="princess_name_bg",t.princess_position_1="princess_position_1",t.princess_position_2="princess_position_2",t.princess_position_3="princess_position_3",t.princess_position_4="princess_position_4",t.princess_position_5="princess_position_5",t.princess_position_6="princess_position_6",t.princess_position_7="princess_position_7",t.princess_position_8="princess_position_8",t.princess_house_icon_position="princess_house_icon_position",t.princess_house_icon_princess="princess_house_icon_princess",t.princess_house_icon_turn="princess_house_icon_turn",t.princess_house_label_position="princess_house_label_position",t.princess_house_label_princess="princess_house_label_princess",t.princess_house_label_turn="princess_house_label_turn",t.princess_position_btn_fall="princess_position_btn_fall",t.princess_position_btn_rise="princess_position_btn_rise",t.princess_position_decree_content="princess_position_decree_content",t.princess_position_decree_title="princess_position_decree_title",t.princess_position_group_0="princess_position_group_0",t.princess_position_group_1="princess_position_group_1",t.princess_position_group_2="princess_position_group_2",t.princess_position_group_3="princess_position_group_3",t.princess_position_group_4="princess_position_group_4",t.princess_position_group_5="princess_position_group_5",t.princess_position_group_6="princess_position_group_6",t.princess_position_group_7="princess_position_group_7",t.princess_position_group_8="princess_position_group_8",t.princess_position_group_bg="princess_position_group_bg",t.princess_position_txt_tips="princess_position_txt_tips",t.princess_choose_decree_bg="princess_choose_decree_bg",t.princess_choose_decree_left="princess_choose_decree_left",t.princess_choose_decree_right="princess_choose_decree_right",t.princess_choose_power_bg="princess_choose_power_bg",t.princess_choose_prince="princess_choose_prince",t.princess_choose_quality_1="princess_choose_quality_1",t.princess_choose_quality_2="princess_choose_quality_2",t.princess_choose_quality_3="princess_choose_quality_3",t.princess_choose_quality_4="princess_choose_quality_4",t.princess_choose_quality_bg="princess_choose_quality_bg",t.princess_choose_tip="princess_choose_tip",t.princess_choose_title="princess_choose_title",t.princess_choose_turn_after="princess_choose_turn_after",t.princess_choose_turn_before="princess_choose_turn_before",t.princess_choose_turn_title="princess_choose_turn_title",t.princess_work_1_bg="princess_work_1_bg",t.princess_work_2_bg="princess_work_2_bg",t.princess_work_3_bg="princess_work_3_bg",t.princess_work_4_bg="princess_work_4_bg",t.princess_work_button_send="princess_work_button_send",t.princess_work_name_bg="princess_work_name_bg",t.princess_rite_teacher_default="princess_rite_teacher_default",t.princess_rite_txt_open="princess_rite_txt_open",t.princess_rite_txt_select_princess="princess_rite_txt_select_princess",t.princess_rite_txt_select_teacher="princess_rite_txt_select_teacher",t.arena_battle_blue_field_bg="arena_battle_blue_field_bg",t.arena_battle_blue_info_bg="arena_battle_blue_info_bg",t.arena_battle_blue_name_bg="arena_battle_blue_name_bg",t.arena_battle_blue_progress_track="arena_battle_blue_progress_track",t.arena_battle_button_abandon="arena_battle_button_abandon",t.arena_battle_button_buffer="arena_battle_button_buffer",t.arena_battle_controller_bg="arena_battle_controller_bg",t.arena_battle_controller_button_command_h="arena_battle_controller_button_command_h",t.arena_battle_controller_button_command_n="arena_battle_controller_button_command_n",t.arena_battle_controller_button_knowledge_h="arena_battle_controller_button_knowledge_h",t.arena_battle_controller_button_knowledge_n="arena_battle_controller_button_knowledge_n",t.arena_battle_controller_button_politics_h="arena_battle_controller_button_politics_h",t.arena_battle_controller_button_politics_n="arena_battle_controller_button_politics_n",t.arena_battle_controller_light="arena_battle_controller_light",t.arena_battle_controller_part_1="arena_battle_controller_part_1",t.arena_battle_controller_power_bg="arena_battle_controller_power_bg",t.arena_battle_controller_power_label="arena_battle_controller_power_label",t.arena_battle_controller_power_light="arena_battle_controller_power_light",t.arena_battle_controller_power_liquid="arena_battle_controller_power_liquid",t.arena_battle_controller_power_mask="arena_battle_controller_power_mask",t.arena_battle_img_tips="arena_battle_img_tips",t.arena_battle_num_1="arena_battle_num_1",t.arena_battle_num_2="arena_battle_num_2",t.arena_battle_num_3="arena_battle_num_3",t.arena_battle_panel_buffer_used="arena_battle_panel_buffer_used",t.arena_battle_progress_bg="arena_battle_progress_bg",t.arena_battle_progress_thumb="arena_battle_progress_thumb",t.arena_battle_red_field_bg="arena_battle_red_field_bg",t.arena_battle_red_info_bg="arena_battle_red_info_bg",t.arena_battle_red_name_bg="arena_battle_red_name_bg",t.arena_battle_red_progress_track="arena_battle_red_progress_track",t.arena_battle_skip="arena_battle_skip",t.arena_battle_txt_vs="arena_battle_txt_vs",t.arena_battle_vs_bg="arena_battle_vs_bg",t.arena_button_help_h="arena_button_help_h",t.arena_button_help_n="arena_button_help_n",t.arena_button_show_more_h="arena_button_show_more_h",t.arena_button_show_more_n="arena_button_show_more_n",t.arena_button_start="arena_button_start",t.arena_icon_history="arena_icon_history",t.arena_icon_ranking="arena_icon_ranking",t.arena_icon_season="arena_icon_season",t.arena_vs="arena_vs",t.garden_house_icon_flower="garden_house_icon_flower",t.garden_house_label_flower="garden_house_label_flower",t.garden_flower_button_buy_h="garden_flower_button_buy_h",t.garden_flower_button_buy_n="garden_flower_button_buy_n",t.garden_flower_content_bg="garden_flower_content_bg",t.garden_flower_flowerpot="garden_flower_flowerpot",t.garden_flower_flowerpot_shadow="garden_flower_flowerpot_shadow",t.garden_flower_title="garden_flower_title",t.garden_flower_word_1="garden_flower_word_1",t.garden_flower_word_2="garden_flower_word_2",t.garden_flower_word_3="garden_flower_word_3",t.garden_flower_word_4="garden_flower_word_4",t.technology_choose_minister="technology_choose_minister",t.technology_connect="technology_connect",t.technology_icon_401001="technology_icon_401001",t.technology_icon_401002="technology_icon_401002",t.technology_icon_401003="technology_icon_401003",t.technology_icon_401004="technology_icon_401004",t.technology_icon_401005="technology_icon_401005",t.technology_icon_401006="technology_icon_401006",t.technology_icon_401007="technology_icon_401007",t.technology_icon_401008="technology_icon_401008",t.technology_icon_401009="technology_icon_401009",t.technology_icon_401010="technology_icon_401010",t.technology_icon_401011="technology_icon_401011",t.technology_icon_401012="technology_icon_401012",t.technology_icon_401013="technology_icon_401013",t.technology_icon_401014="technology_icon_401014",t.technology_icon_401015="technology_icon_401015",t.technology_icon_402001="technology_icon_402001",t.technology_icon_402002="technology_icon_402002",t.technology_icon_402003="technology_icon_402003",t.technology_icon_402004="technology_icon_402004",t.technology_icon_402005="technology_icon_402005",t.technology_icon_402006="technology_icon_402006",t.technology_icon_402007="technology_icon_402007",t.technology_icon_402008="technology_icon_402008",t.technology_icon_402009="technology_icon_402009",t.technology_icon_402010="technology_icon_402010",t.technology_icon_402011="technology_icon_402011",t.technology_icon_402012="technology_icon_402012",t.technology_icon_402013="technology_icon_402013",t.technology_icon_402014="technology_icon_402014",t.technology_icon_402015="technology_icon_402015",t.technology_icon_403001="technology_icon_403001",t.technology_icon_403002="technology_icon_403002",t.technology_icon_403003="technology_icon_403003",t.technology_icon_403004="technology_icon_403004",t.technology_icon_403005="technology_icon_403005",t.technology_icon_403006="technology_icon_403006",t.technology_icon_403007="technology_icon_403007",t.technology_icon_403008="technology_icon_403008",t.technology_icon_403009="technology_icon_403009",t.technology_icon_403010="technology_icon_403010",t.technology_icon_403011="technology_icon_403011",t.technology_icon_403012="technology_icon_403012",t.technology_icon_403013="technology_icon_403013",t.technology_icon_403014="technology_icon_403014",t.technology_icon_403015="technology_icon_403015",t.technology_icon_lock="technology_icon_lock",t.technology_level_up_icon="technology_level_up_icon",t.technology_mask="technology_mask",t.technology_name_401001="technology_name_401001",t.technology_name_401002="technology_name_401002",t.technology_name_401003="technology_name_401003",t.technology_name_401004="technology_name_401004",t.technology_name_401005="technology_name_401005",t.technology_name_401006="technology_name_401006",t.technology_name_401007="technology_name_401007",t.technology_name_401008="technology_name_401008",t.technology_name_401009="technology_name_401009",t.technology_name_401010="technology_name_401010",t.technology_name_401011="technology_name_401011",t.technology_name_401012="technology_name_401012",t.technology_name_401013="technology_name_401013",t.technology_name_401014="technology_name_401014",t.technology_name_401015="technology_name_401015",t.technology_name_402001="technology_name_402001",t.technology_name_402002="technology_name_402002",t.technology_name_402003="technology_name_402003",t.technology_name_402004="technology_name_402004",t.technology_name_402005="technology_name_402005",t.technology_name_402006="technology_name_402006",t.technology_name_402007="technology_name_402007",t.technology_name_402008="technology_name_402008",t.technology_name_402009="technology_name_402009",t.technology_name_402010="technology_name_402010",t.technology_name_402011="technology_name_402011",t.technology_name_402012="technology_name_402012",t.technology_name_402013="technology_name_402013",t.technology_name_402014="technology_name_402014",t.technology_name_402015="technology_name_402015",t.technology_name_403001="technology_name_403001",t.technology_name_403002="technology_name_403002",t.technology_name_403003="technology_name_403003",t.technology_name_403004="technology_name_403004",t.technology_name_403005="technology_name_403005",t.technology_name_403006="technology_name_403006",t.technology_name_403007="technology_name_403007",t.technology_name_403008="technology_name_403008",t.technology_name_403009="technology_name_403009",t.technology_name_403010="technology_name_403010",t.technology_name_403011="technology_name_403011",t.technology_name_403012="technology_name_403012",t.technology_name_403013="technology_name_403013",t.technology_name_403014="technology_name_403014",t.technology_name_403015="technology_name_403015",t.prince_act_bg="prince_act_bg",t.prince_act_icon="prince_act_icon",t.prince_decree_nobles="prince_decree_nobles",t.prince_decree_open="prince_decree_open",t.prince_default="prince_default",t.prince_dice="prince_dice",t.prince_icon_open="prince_icon_open",t.prince_info_bg="prince_info_bg",t.prince_peerage_1="prince_peerage_1",t.prince_peerage_2="prince_peerage_2",t.prince_peerage_3="prince_peerage_3",t.prince_peerage_4="prince_peerage_4",t.prince_peerage_5="prince_peerage_5",t.prince_peerage_6="prince_peerage_6",t.prince_peerage_7="prince_peerage_7",t.prince_prince_bg="prince_prince_bg",t.prince_shadow="prince_shadow",t.prince_title_nobles="prince_title_nobles",t.prince_title_open="prince_title_open",t.prince_title_open_cost="prince_title_open_cost",t.login_button_select_h="login_button_select_h",t.login_button_select_n="login_button_select_n",t.login_button_start_h="login_button_start_h",t.login_button_start_n="login_button_start_n",t.login_division_line="login_division_line",t.login_head_login="login_head_login",t.login_head_server="login_head_server",t.login_label_account="login_label_account",t.login_label_passwad="login_label_passwad",t.login_label_start="login_label_start",t.login_logo="login_logo",t.login_select_server_bg="login_select_server_bg",t.login_server_bg="login_server_bg",t.login_server_frame_bg="login_server_frame_bg",t.login_server_small_bg="login_server_small_bg",t.login_small_bg="login_small_bg",t.login_swap_server="login_swap_server",t.login_switch_account="login_switch_account",t.login_title_login="login_title_login",t.login_title_register="login_title_register",t.login_title_server="login_title_server",t.shop_arrow="shop_arrow",t.shop_first_double="shop_first_double",t.shop_give="shop_give",t.shop_item_bg="shop_item_bg",t.shop_item_name_bg="shop_item_name_bg",t.shop_label_charge="shop_label_charge",t.shop_label_forever="shop_label_forever",t.shop_label_special="shop_label_special",t.shop_recharge_item_1="shop_recharge_item_1",t.shop_recharge_item_2="shop_recharge_item_2",t.shop_recharge_item_3="shop_recharge_item_3",t.shop_recharge_item_4="shop_recharge_item_4",t.shop_recharge_item_5="shop_recharge_item_5",t.shop_recharge_item_6="shop_recharge_item_6",t.shop_recharge_item_7="shop_recharge_item_7",t.shop_recharge_item_8="shop_recharge_item_8",t.shop_recharge_item_bg="shop_recharge_item_bg",t.shop_resource_bg="shop_resource_bg",t.shop_sales_bg="shop_sales_bg",t.shop_sales_type_1="shop_sales_type_1",t.shop_sales_type_2="shop_sales_type_2",t.shop_sales_type_3="shop_sales_type_3",t.shop_sales_type_4="shop_sales_type_4",t.shop_tab_h="shop_tab_h",t.shop_tab_label_gift_h="shop_tab_label_gift_h",t.shop_tab_label_gift_n="shop_tab_label_gift_n",t.shop_tab_label_gold_h="shop_tab_label_gold_h",t.shop_tab_label_gold_n="shop_tab_label_gold_n",t.shop_tab_label_item_h="shop_tab_label_item_h",t.shop_tab_label_item_n="shop_tab_label_item_n",t.shop_tab_label_vip_h="shop_tab_label_vip_h",t.shop_tab_label_vip_n="shop_tab_label_vip_n",t.shop_tab_n="shop_tab_n",t.shop_title_label="shop_title_label",t.shop_toad="shop_toad",t.shop_vip_1="shop_vip_1",t.shop_vip_10="shop_vip_10",t.shop_vip_11="shop_vip_11",t.shop_vip_12="shop_vip_12",t.shop_vip_2="shop_vip_2",t.shop_vip_3="shop_vip_3",t.shop_vip_4="shop_vip_4",t.shop_vip_5="shop_vip_5",t.shop_vip_6="shop_vip_6",t.shop_vip_7="shop_vip_7",t.shop_vip_8="shop_vip_8",t.shop_vip_9="shop_vip_9",t.shop_vip_desc_point="shop_vip_desc_point",t.shop_vip_desc_title="shop_vip_desc_title",t.shop_yuan="shop_yuan",t.email_icon_looked="email_icon_looked",t.email_icon_receive="email_icon_receive",t.email_icon_un_look="email_icon_un_look",t.minister_info_button_details="minister_info_button_details",t.minister_info_cover="minister_info_cover",t.minister_info_icon_command="minister_info_icon_command",t.minister_info_icon_knowledge="minister_info_icon_knowledge",t.minister_info_icon_politics="minister_info_icon_politics",t.minister_info_info_box="minister_info_info_box",t.minister_info_item_bg="minister_info_item_bg",t.minister_info_peerage_decree_content="minister_info_peerage_decree_content",t.minister_info_peerage_decree_title="minister_info_peerage_decree_title",t.minister_info_treasure_ball_command="minister_info_treasure_ball_command",t.minister_info_treasure_ball_knowledge="minister_info_treasure_ball_knowledge",t.minister_info_treasure_ball_politics="minister_info_treasure_ball_politics",t.minister_info_treasure_bg="minister_info_treasure_bg",t.minister_info_treasure_equip_bg_11="minister_info_treasure_equip_bg_11",t.minister_info_treasure_equip_bg_12="minister_info_treasure_equip_bg_12",t.minister_info_treasure_equip_bg_13="minister_info_treasure_equip_bg_13",t.minister_info_treasure_equip_label="minister_info_treasure_equip_label",t.visit_btn_bg="visit_btn_bg",t.visit_city_level_1="visit_city_level_1",t.visit_city_level_2="visit_city_level_2",t.visit_city_level_7="visit_city_level_7",t.visit_city_level_8="visit_city_level_8",t.visit_city_level_9="visit_city_level_9",t.visit_city_name_bg="visit_city_name_bg",t.visit_dice_result_1="visit_dice_result_1",t.visit_dice_result_2="visit_dice_result_2",t.visit_dice_result_3="visit_dice_result_3",t.visit_dice_result_4="visit_dice_result_4",t.visit_dice_result_5="visit_dice_result_5",t.visit_dice_result_6="visit_dice_result_6",t.visit_finish="visit_finish",t.visit_icon_carriage="visit_icon_carriage",t.visit_icon_shovel="visit_icon_shovel",t.visit_item_bg="visit_item_bg",t.visit_king="visit_king",t.visit_label_princess="visit_label_princess",t.visit_panel_name_bg="visit_panel_name_bg",t.visit_princess_bg="visit_princess_bg",t.visit_select_bg="visit_select_bg",t.visit_select_dice_bg="visit_select_dice_bg",t.visit_talk_bg="visit_talk_bg",t.visit_title_develop_cost="visit_title_develop_cost",t.visit_treasure_line="visit_treasure_line",t.common_chat_bg="common_chat_bg",t.common_frame_bg_1="common_frame_bg_1",t.common_frame_bg_2="common_frame_bg_2",t.common_frame_bg_3="common_frame_bg_3",t.common_frame_bg_4="common_frame_bg_4",t.common_frame_bg_5="common_frame_bg_5",t.common_frame_bg_6="common_frame_bg_6",t.common_gift_title_bg="common_gift_title_bg",t.common_image_1="common_image_1",t.common_image_3="common_image_3",t.common_image_4="common_image_4",t.common_img_1="common_img_1",t.common_img_3="common_img_3",t.common_info_box="common_info_box",t.common_line="common_line",t.common_line_down="common_line_down",t.common_line_up="common_line_up",t.common_list_header_bg="common_list_header_bg",t.common_name_bg_0="common_name_bg_0",t.common_name_bg_1="common_name_bg_1",t.common_name_bg_2="common_name_bg_2",t.common_name_bg_3="common_name_bg_3",t.common_name_bg_4="common_name_bg_4",t.common_name_bg_5="common_name_bg_5",t.common_national_power_bg="common_national_power_bg",t.common_panel_bg="common_panel_bg",t.common_panel_bg_3="common_panel_bg_3",t.common_panel_bg_4="common_panel_bg_4",t.common_panel_bg_5="common_panel_bg_5",t.common_panel_dialog_bg="common_panel_dialog_bg",t.common_panel_result_blue_bg="common_panel_result_blue_bg",t.common_panel_result_blue_content_bg="common_panel_result_blue_content_bg",t.common_panel_result_red_bg="common_panel_result_red_bg",t.common_panel_result_red_content_bg="common_panel_result_red_content_bg",t.common_scene_bg_1="common_scene_bg_1",t.common_scene_bg_2="common_scene_bg_2",t.common_scene_bg_3="common_scene_bg_3",t.common_scene_bg_4="common_scene_bg_4",t.common_season_item_bg="common_season_item_bg",t.common_season_my_bg="common_season_my_bg",t.common_task_bg="common_task_bg",t.common_toast_bg="common_toast_bg",t.common_top_value_bg="common_top_value_bg",t.ui_checkbox_bg="ui_checkbox_bg",t.ui_progress_2_thumb="ui_progress_2_thumb",t.ui_progress_2_track="ui_progress_2_track",t.ui_progress_3_thumb="ui_progress_3_thumb",t.ui_progress_4_thumb="ui_progress_4_thumb",t.ui_progress_5_thumb="ui_progress_5_thumb",t.ui_progress_thumb="ui_progress_thumb",t.ui_progress_track="ui_progress_track",t.ui_slider_track="ui_slider_track",t.ui_slider_track_highlight="ui_slider_track_highlight",t.ui_switch_bg="ui_switch_bg",t.ui_tab_button3_h="ui_tab_button3_h",t.ui_tab_button3_n="ui_tab_button3_n",t.ui_textarea_bg="ui_textarea_bg",t.ui_textinput_bg="ui_textinput_bg",t.task_finish="task_finish",t.task_panel_bg_down="task_panel_bg_down",t.task_panel_bg_left="task_panel_bg_left",t.task_panel_bg_up="task_panel_bg_up",t.create_player_face_title="create_player_face_title",t.create_player_king_1001="create_player_king_1001",t.create_player_king_1002="create_player_king_1002",t.create_player_king_1003="create_player_king_1003",t.create_player_king_1004="create_player_king_1004",t.create_player_king_1005="create_player_king_1005",t.create_player_king_2001="create_player_king_2001",t.create_player_king_2002="create_player_king_2002",t.create_player_king_2003="create_player_king_2003",t.create_player_king_2004="create_player_king_2004",t.create_player_king_2005="create_player_king_2005",t.create_player_select="create_player_select",t.create_player_tab_boy_h="create_player_tab_boy_h",t.create_player_tab_boy_n="create_player_tab_boy_n",t.create_player_tab_girl_h="create_player_tab_girl_h",t.create_player_tab_girl_n="create_player_tab_girl_n",t.create_player_title="create_player_title",t.princess_party_icon_gift="princess_party_icon_gift",t.princess_party_info="princess_party_info",t.princess_party_rank_bg="princess_party_rank_bg",t.princess_party_seat_arrow="princess_party_seat_arrow",t.princess_party_theme_bg="princess_party_theme_bg",t.treasure_banner="treasure_banner",t.treasure_box_gold_close="treasure_box_gold_close",t.treasure_box_gold_open="treasure_box_gold_open",t.treasure_box_light="treasure_box_light",t.treasure_box_silver_close="treasure_box_silver_close",t.treasure_box_silver_open="treasure_box_silver_open",t.treasure_conquer="treasure_conquer",t.treasure_dragon="treasure_dragon",t.rank_light="rank_light",t.guide_black_layer="guide_black_layer",t.guide_blink="guide_blink",t.guide_btn_skip="guide_btn_skip",t.guide_circle="guide_circle",t.guide_hand="guide_hand",t.guide_knockout="guide_knockout",t.guide_txt_next="guide_txt_next",t.preferential_dragon_1="preferential_dragon_1",t.preferential_dragon_2="preferential_dragon_2",t.preferential_dragon_3="preferential_dragon_3",t.preferential_independent_1="preferential_independent_1",t.preferential_independent_2="preferential_independent_2",t.preferential_independent_3="preferential_independent_3",t.preferential_tab_dragon="preferential_tab_dragon",t.preferential_tab_independent="preferential_tab_independent",t.prison_icon_token="prison_icon_token",t.prison_icon_whip="prison_icon_whip",t.prison_talk_bg="prison_talk_bg",t.minister_avatar_grey_block_110001="minister_avatar_grey_block_110001",t.minister_avatar_grey_block_110002="minister_avatar_grey_block_110002",t.minister_avatar_grey_block_110003="minister_avatar_grey_block_110003",t.minister_avatar_grey_block_110004="minister_avatar_grey_block_110004",t.minister_avatar_grey_block_110005="minister_avatar_grey_block_110005",t.minister_avatar_grey_block_110006="minister_avatar_grey_block_110006",t.minister_avatar_grey_block_110007="minister_avatar_grey_block_110007",t.minister_avatar_grey_block_110008="minister_avatar_grey_block_110008",t.minister_avatar_grey_block_110009="minister_avatar_grey_block_110009",t.minister_avatar_grey_block_120001="minister_avatar_grey_block_120001",t.minister_avatar_grey_block_120002="minister_avatar_grey_block_120002",t.minister_avatar_grey_block_120003="minister_avatar_grey_block_120003",t.minister_avatar_grey_block_120004="minister_avatar_grey_block_120004",t.minister_avatar_grey_block_120005="minister_avatar_grey_block_120005",t.minister_avatar_grey_block_120006="minister_avatar_grey_block_120006",t.minister_avatar_grey_block_120007="minister_avatar_grey_block_120007",t.minister_avatar_grey_block_120008="minister_avatar_grey_block_120008",t.minister_avatar_grey_block_120009="minister_avatar_grey_block_120009",t.minister_avatar_grey_block_120010="minister_avatar_grey_block_120010",t.minister_avatar_grey_block_120011="minister_avatar_grey_block_120011",t.minister_avatar_grey_block_120012="minister_avatar_grey_block_120012",t.minister_avatar_grey_block_130001="minister_avatar_grey_block_130001",t.minister_avatar_grey_block_130002="minister_avatar_grey_block_130002",t.minister_avatar_grey_block_130003="minister_avatar_grey_block_130003",t.minister_avatar_grey_block_130004="minister_avatar_grey_block_130004",t.minister_avatar_grey_block_130005="minister_avatar_grey_block_130005",t.minister_avatar_grey_block_130006="minister_avatar_grey_block_130006",t.minister_avatar_grey_block_130007="minister_avatar_grey_block_130007",t.minister_avatar_grey_block_130008="minister_avatar_grey_block_130008",t.minister_avatar_grey_block_130009="minister_avatar_grey_block_130009",t.minister_avatar_grey_block_130010="minister_avatar_grey_block_130010",t.minister_avatar_grey_block_130011="minister_avatar_grey_block_130011",t.minister_avatar_grey_block_130012="minister_avatar_grey_block_130012",t.minister_avatar_grey_block_140001="minister_avatar_grey_block_140001",t.minister_avatar_grey_block_140002="minister_avatar_grey_block_140002",t.minister_avatar_grey_block_140003="minister_avatar_grey_block_140003",t.minister_avatar_grey_block_140004="minister_avatar_grey_block_140004",t.union_duplicate_icon_101="union_duplicate_icon_101",t.union_duplicate_icon_102="union_duplicate_icon_102",t.union_duplicate_icon_103="union_duplicate_icon_103",t.union_duplicate_icon_104="union_duplicate_icon_104",t.union_duplicate_icon_105="union_duplicate_icon_105",t.union_duplicate_icon_106="union_duplicate_icon_106",t.union_duplicate_icon_107="union_duplicate_icon_107",t.union_duplicate_icon_108="union_duplicate_icon_108",t.union_duplicate_icon_109="union_duplicate_icon_109",t.union_gift_bg="union_gift_bg",t.union_glass="union_glass",t.union_icon_contribute="union_icon_contribute",t.union_icon_duplicate="union_icon_duplicate",t.union_icon_info="union_icon_info",t.union_icon_log="union_icon_log",t.union_icon_notice="union_icon_notice",t.union_icon_rank="union_icon_rank",t.union_icon_shop="union_icon_shop",t.union_icon_tech="union_icon_tech",t.union_icon_treasure="union_icon_treasure",t.union_info_bg="union_info_bg",t.union_label_gift="union_label_gift",t.union_label_level="union_label_level",t.union_label_log="union_label_log",t.union_label_notice="union_label_notice",t.union_treasure_open="union_treasure_open",t.activity_class_bg="activity_class_bg",t.activity_desc="activity_desc",t.activity_limit_info_bg="activity_limit_info_bg",t.activity_receive="activity_receive",t.union_frame_bg="union_frame_bg",t.union_item_bg="union_item_bg",t.activity_info_bg="activity_info_bg",t.activity_reward_bg="activity_reward_bg",t.activity_reward_bg_2="activity_reward_bg_2",t.shop_gift_bg="shop_gift_bg",t.shop_vip_bg_h="shop_vip_bg_h",t.shop_vip_bg_n="shop_vip_bg_n",t.task_item_bg="task_item_bg",t.task_panel_bg="task_panel_bg",t.prison_info_bg="prison_info_bg",t.chat_message_bg="chat_message_bg",t.face_1001="face_1001",t.face_1002="face_1002",t.face_1003="face_1003",t.face_1004="face_1004",t.face_1005="face_1005",t.face_2001="face_2001",t.face_2002="face_2002",t.face_2003="face_2003",t.face_2004="face_2004",t.face_2005="face_2005",t.item_upgrade_txt_resource="item_upgrade_txt_resource",t.duplicate_progress_10_thumb="duplicate_progress_10_thumb",t.duplicate_progress_1_thumb="duplicate_progress_1_thumb",t.duplicate_progress_2_thumb="duplicate_progress_2_thumb",t.duplicate_progress_3_thumb="duplicate_progress_3_thumb",t.duplicate_progress_4_thumb="duplicate_progress_4_thumb",t.duplicate_progress_5_thumb="duplicate_progress_5_thumb",t.duplicate_progress_6_thumb="duplicate_progress_6_thumb",t.duplicate_progress_7_thumb="duplicate_progress_7_thumb",t.duplicate_progress_8_thumb="duplicate_progress_8_thumb",t.duplicate_progress_9_thumb="duplicate_progress_9_thumb",t.duplicate_select_minister_bg="duplicate_select_minister_bg",t.duplicate_add="duplicate_add",t.duplicate_btn_exit="duplicate_btn_exit",t.duplicate_fight_bg="duplicate_fight_bg",t.duplicate_help="duplicate_help",t.duplicate_label_fight="duplicate_label_fight",t.duplicate_name_bg="duplicate_name_bg",t.duplicate_progress_track="duplicate_progress_track",t.duplicate_recover="duplicate_recover",t.duplicate_select_bg="duplicate_select_bg",t.duplicate_skill_1="duplicate_skill_1",t.duplicate_skill_2="duplicate_skill_2",t.duplicate_type_bg="duplicate_type_bg",t.duplicate_unload="duplicate_unload",t.buffer_icon_1="buffer_icon_1",t.buffer_icon_2="buffer_icon_2",t.buffer_icon_3="buffer_icon_3",t.buffer_icon_4="buffer_icon_4",t.buffer_icon_5="buffer_icon_5",t.open_bg="open_bg",t.open_icon_10001="open_icon_10001",t.open_icon_10002="open_icon_10002",t.open_icon_10003="open_icon_10003",t.open_icon_10004="open_icon_10004",t.open_icon_10005="open_icon_10005",t.open_icon_10006="open_icon_10006",t.open_icon_10007="open_icon_10007",t.open_icon_10008="open_icon_10008",t.open_icon_10009="open_icon_10009",t.open_icon_10010="open_icon_10010",t.open_icon_10011="open_icon_10011",t.open_icon_10012="open_icon_10012",t.open_icon_10013="open_icon_10013",t.open_icon_10014="open_icon_10014",t.open_icon_10015="open_icon_10015",t.open_icon_10016="open_icon_10016",t.open_icon_10017="open_icon_10017",t.open_icon_10018="open_icon_10018",t.open_icon_bg="open_icon_bg",t.open_name_bg="open_name_bg",t.open_title="open_title",t.open_up="open_up",t.main_stage_finish_tip_bg="main_stage_finish_tip_bg",t.main_stage_national_power_up_bg="main_stage_national_power_up_bg",t.main_stage_national_power_up_title="main_stage_national_power_up_title",t.visit_line="visit_line",t.visit_panel_bg="visit_panel_bg",t.visit_tab_down="visit_tab_down",t.visit_tab_up="visit_tab_up",t.world_boss_button_auto_fight_h="world_boss_button_auto_fight_h",t.world_boss_button_auto_fight_n="world_boss_button_auto_fight_n",t.world_boss_button_speed_h="world_boss_button_speed_h",t.world_boss_button_speed_n="world_boss_button_speed_n",t.world_boss_button_start_fight="world_boss_button_start_fight",t.world_boss_button_start_fight_bg="world_boss_button_start_fight_bg",t.world_boss_button_start_fight_d="world_boss_button_start_fight_d",t.world_boss_button_switch="world_boss_button_switch",t.world_boss_fight="world_boss_fight",t.world_boss_hurt_1="world_boss_hurt_1",t.world_boss_hurt_2="world_boss_hurt_2",t.world_boss_hurt_3="world_boss_hurt_3",t.world_boss_hurt_bg="world_boss_hurt_bg",t.world_boss_minister_grey="world_boss_minister_grey",t.world_boss_prop_bg="world_boss_prop_bg",t
}();__reflect(ResNames.prototype,"ResNames");var ActivityEntity=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.inject=function(e){var i=this;t.prototype.inject.call(this,e),this["extends"]&&(this.reward=null,this.ids.forEach(function(t,e){if(null!=t&&void 0!=t&&i.counts[e]){var n={id:t.id,count:i.counts[e].count};i.getExtendIndex(e,n)}}))},e.prototype.getExtendIndex=function(t,e){var i=this;this.reward||(this.reward={"extends":this["extends"],items:[]});var n=GameConfig.getItemMeta(e.id),r=GameConfig.getGiftPackMeta(n["export"]);r?r.items.forEach(function(t){var n={id:t.id,count:t.count*e.count};i.reward.items.push(n)}):this.reward.items.push(e)},e.getActivityConfigByType=function(t){var i=null;return e.StateList.some(function(e){return t==e.type?(i=e,!0):void 0}),i},e.ACTIVITY={TYPE_CHARGE_6:0,TYPE_CHARGE_30:1,TYPE_CHARGE_68:2,TYPE_CHARGE_198:3,TYPE_CHARGE_328:4,TYPE_CHARGE_648:5,TYPE_OFFICE:6,TYPE_NATIONAl:7,TYPE_MINISTER:8,TYPE_PRINCESS:9,TYPE_ARENA:10,TYPE_CHARGE_8:11,TYPE_CHARGE_12:12,TYPE_CHARGE_88:13,TYPE_CHARGE_128:14,TYPE_GOLD:15,TYPE_SILVER:16,TYPE_MILITARY:17,TYPE_TROOP:18,TYPE_LOGIN:19,TYPE_PARTY:20,TYPE_IMPOSE:21,TYPE_MEMORIAL:22,TYPE_ITEM1:23,TYPE_ITEM2:24,TYPE_ITEM3:25,TYPE_ITEM4:26,TYPE_FLOWER:27,TYPE_TURN_CARD:28,TYPE_PRINCESS_RITE:29,TYPE_VISIT_CITY:30,TYPE_PRINCESS_WORK:31,TYPE_PVP:32,TYPE_PRINCE:33,TYPE_SUM_CHARGE:34,TYPE_BURN_INCENSE:35,TYPE_PRIVATE_TEST:36,TYPE_BUG:37},e.StateList=[{type:e.ACTIVITY.TYPE_CHARGE_6,currentState:"left",index:4,btnState:"double",badgeId:21111},{type:e.ACTIVITY.TYPE_CHARGE_30,currentState:"left",index:4,btnState:"double",badgeId:21112},{type:e.ACTIVITY.TYPE_CHARGE_68,currentState:"left",index:4,btnState:"double",badgeId:21113},{type:e.ACTIVITY.TYPE_CHARGE_198,currentState:"left",index:4,btnState:"double",badgeId:21114},{type:e.ACTIVITY.TYPE_CHARGE_328,currentState:"left",index:4,btnState:"double",badgeId:21115},{type:e.ACTIVITY.TYPE_CHARGE_648,currentState:"left",index:4,btnState:"double",badgeId:21116},{type:e.ACTIVITY.TYPE_NATIONAl,currentState:"left",index:0,btnState:"double"},{type:e.ACTIVITY.TYPE_MINISTER,currentState:"center",index:1,btnState:"double"},{type:e.ACTIVITY.TYPE_PRINCESS,currentState:"right",index:2,btnState:"double"},{type:e.ACTIVITY.TYPE_ARENA,currentState:"center",index:3,btnState:"double"},{type:e.ACTIVITY.TYPE_PRIVATE_TEST,currentState:"single",index:5,btnState:"single"},{type:e.ACTIVITY.TYPE_BUG,currentState:"single",index:6,btnState:"double"},{type:e.ACTIVITY.TYPE_CHARGE_8,currentState:"left"},{type:e.ACTIVITY.TYPE_CHARGE_12,currentState:"left"},{type:e.ACTIVITY.TYPE_CHARGE_88,currentState:"left"},{type:e.ACTIVITY.TYPE_CHARGE_128,currentState:"left"},{type:e.ACTIVITY.TYPE_GOLD,index:0,btnState:"single",badgeId:21601,activityTimeId:515},{type:e.ACTIVITY.TYPE_SILVER,index:1,btnState:"single",badgeId:21602,activityTimeId:516},{type:e.ACTIVITY.TYPE_MILITARY,index:2,btnState:"single",badgeId:21603,activityTimeId:517},{type:e.ACTIVITY.TYPE_TROOP,index:3,btnState:"single",badgeId:21604,activityTimeId:518},{type:e.ACTIVITY.TYPE_LOGIN,index:4,btnState:"single",badgeId:21605,activityTimeId:519},{type:e.ACTIVITY.TYPE_PARTY,index:5,btnState:"single",badgeId:21606,activityTimeId:520},{type:e.ACTIVITY.TYPE_IMPOSE,index:6,btnState:"single",badgeId:21607,activityTimeId:521},{type:e.ACTIVITY.TYPE_MEMORIAL,index:7,btnState:"single",badgeId:21608,activityTimeId:522},{type:e.ACTIVITY.TYPE_ITEM1,index:8,btnState:"single",badgeId:21609,activityTimeId:523},{type:e.ACTIVITY.TYPE_ITEM2,index:9,btnState:"single",badgeId:21610,activityTimeId:524},{type:e.ACTIVITY.TYPE_ITEM3,index:10,btnState:"single",badgeId:21611,activityTimeId:525},{type:e.ACTIVITY.TYPE_ITEM4,index:11,btnState:"single",badgeId:21612,activityTimeId:526},{type:e.ACTIVITY.TYPE_FLOWER,index:12,btnState:"single",badgeId:21613,activityTimeId:527},{type:e.ACTIVITY.TYPE_TURN_CARD,index:13,btnState:"single",badgeId:21614,activityTimeId:528},{type:e.ACTIVITY.TYPE_PRINCESS_RITE,index:14,btnState:"single",badgeId:21615,activityTimeId:529},{type:e.ACTIVITY.TYPE_VISIT_CITY,index:15,btnState:"single",badgeId:21616,activityTimeId:530},{type:e.ACTIVITY.TYPE_PRINCESS_WORK,index:16,btnState:"single",badgeId:21617,activityTimeId:531},{type:e.ACTIVITY.TYPE_PVP,index:17,btnState:"single",badgeId:21618,activityTimeId:532},{type:e.ACTIVITY.TYPE_PRINCE,index:18,btnState:"single",badgeId:21619,activityTimeId:533},{type:e.ACTIVITY.TYPE_BURN_INCENSE,index:19,btnState:"single",badgeId:21120,activityTimeId:534},{type:e.ACTIVITY.TYPE_SUM_CHARGE,index:7,btnState:"single",badgeId:21120,activityTimeId:534}],e}(Entity);__reflect(ActivityEntity.prototype,"ActivityEntity");var ActivityTimeEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.str=null,e["int"]=0,e.timestamp=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(ActivityTimeEntity.prototype,"ActivityTimeEntity");var BossEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=-1,e.fightStatus=!1,e.openStatus=!1,e.boss=[],e.ranks=[],e.unionRanks=[],e.ministers=[],e.rounds=[],e.hp=0,e.type=0,e.endTime=0,e.roundTime=0,e.pos=-1,e.damage=-1,e.buffer1Time=0,e.buffer2Time=0,e}return __extends(e,t),e.prototype.inject=function(e){var i=this.getMyBossRank(),n=this.ministers,r=i?i.hp:0;if(t.prototype.inject.call(this,e),this.boss[0]?(this.hp=this.boss[0].hp,this.type=this.boss[0].type,this.endTime=this.boss[0].endTime,this.hp>0&&this.endTime>mainService.tsServer?this.openStatus=!0:this.openStatus=!1,this.ministers=this.ministers[0]?this.ministers:n):(this.openStatus=!1,this.hp=0,this.type=0,this.endTime=0),this.rounds[0]){var o=this.pos>=0?2:-1;this.pos=this.rounds[0].pos-1>=0?this.rounds[0].pos-1:o,this.roundTime=this.rounds[0].roundTime}this.ranks=this.ranks.sort(function(t,e){return e.hp-t.hp}),this.ranks.forEach(function(t,e){t.rank=e+1}),this.setUnionBossRanks(),this.setBossRanks(),i=this.getMyBossRank();var s=i?i.hp:0;this.damage=s-r,this.meta=GameConfig.getBossMeta(this.id)},e.prototype.setBossRanks=function(){this.ranks=this.ranks.filter(function(t){return t.rank<=100||t.name==mainService.playerBaseInfo.name})},e.prototype.setUnionBossRanks=function(){var t=this;this.unionRanks.splice(0),this.ranks.forEach(function(e){var i=!1;t.unionRanks.some(function(t){return e.unionName==t.name&&""!=e.unionName?(i=!0,t.hp=t.hp.add(e.hp),!0):void 0}),i||""==e.unionName||t.unionRanks.push({name:e.unionName,hp:e.hp})}),this.unionRanks.sort(function(t,e){return e.hp-t.hp}),this.unionRanks.forEach(function(t,e){t.rank=e+1}),this.unionRanks=this.unionRanks.filter(function(t){return t.rank<=100})},e.prototype.getMyBossRank=function(){var t=null;return this.ranks.some(function(e){return e.name==mainService.playerBaseInfo.name?(t=e,!0):void 0}),t},e.parseBossBodyUrl=function(t){return cdnurl+"resource/assets/singles/boss/"+t+".png"},e.prototype.getBodyUrl=function(){return e.parseBossBodyUrl(this.id)},e.prototype.getMyDamageRatio=function(){var t=1e8*this.meta.blood,e=this.getMyBossRank().hp;return parseFloat((e/t).toFixed(4))},e.BOSS_TYPE={UNION:0,WORLD:1},e.BUFFER_TYPE={NORMAL:0,ADVANCE:1},e.EMAIL_SENDER_ID={UNION:1e5,WORLD_BOSS:2e5},e.WORLD_BOSS_ID=300,e}(Entity);__reflect(BossEntity.prototype,"BossEntity");var CityEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.level=0,e.likeValue=0,e.developFlag=0,e.fieldsModified=[],e}return __extends(e,t),e.prototype.inject=function(e){this.fieldsModified.splice(0),t.prototype.inject.call(this,e),this.cityMeta=GameConfig.getCityMeta(this.id),this.visitMeta=GameConfig.getVisitMeta(this.id)},e.prototype.onInject=function(e,i,n){var r=this[i];t.prototype.onInject.call(this,e,i,n),n!=r&&this.fieldsModified.push({field:i,value:n,oldValue:r})},e.prototype.getOutput=function(){var t=GameConfig.getVisitLevelMeta(this.id,this.level).output_value,i=e.additionFields[this.visitMeta.output_type-1],n={id:0,count:0};return n.count=Math.floor(t*(mainService.playerInfo[i]/1e6+1)),n.id=e.outputIds[this.visitMeta.output_type-1],n},e.prototype.getCityIcon=function(){var t=this.level>6?this.level:Math.floor((this.level-1)/3)+1;return"visit_city_level_"+t},e.prototype.getCityBanner=function(){var t=alien.MathUtils.makeRandomInt(1,1);return cdnurl+"resource/assets/singles/city/banner/"+t+".png"},e.getPeopleBg=function(t){return cdnurl+"resource/assets/singles/city/people/"+t+".jpg"},e.prototype.getTreasureMap=function(){var t=this.getTreasureConfig(),e=t.map;return cdnurl+"resource/assets/singles/city/map/"+e+".png"},e.prototype.getTreasureGreyMap=function(){var t=this.getTreasureConfig(),e=t.map;return cdnurl+"resource/assets/singles/city/map/grey/"+e+".png"},e.prototype.getTreasureConfig=function(){var t=this,i=null;return e.treasureConfig.some(function(e){return e.levels.indexOf(t.level)>=0?(i=e,!0):void 0}),i},e.cityFields=["level","likeValue","developFlag"],e.outputFields=["silver","mineral","troops"],e.outputIds=[2,3,6],e.additionFields=["trade","industry","military"],e.treasureConfig=[{levels:[1,2],treasureLevel:1,row:1,columns:1,map:1,freeCount:1},{levels:[3,4],treasureLevel:2,row:2,columns:1,map:1,freeCount:1},{levels:[5,6],treasureLevel:3,row:2,columns:2,map:2,freeCount:1},{levels:[7,8],treasureLevel:4,row:3,columns:2,map:2,freeCount:1},{levels:[9],treasureLevel:5,row:3,columns:3,map:3,freeCount:1}],e}(Entity);__reflect(CityEntity.prototype,"CityEntity");var EmailEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.timestamp=0,e.senderId=0,e.isRead=!1,e.senderName="",e.receiverName="",e.title="",e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(EmailEntity.prototype,"EmailEntity");var alien;!function(t){var e=function(){function t(t){this._target=t}return t.prototype.fadeIn=function(t){void 0===t&&(t=200),this._duration=t,this._targetAlpha=1,this._target.alpha=0,this._target.visible=!0,this.play()},t.prototype.fadeOut=function(t){void 0===t&&(t=200),this._duration=t,this._targetAlpha=0,this._target.alpha=1,this.play()},t.prototype.play=function(){this._tween=egret.Tween.get(this._target).to({alpha:this._targetAlpha},this._duration).set({visible:this._targetAlpha>0})},t.prototype.stop=function(){this._tween&&egret.Tween.removeTweens(this._target)},t}();t.Fade=e,__reflect(e.prototype,"alien.Fade",["alien.IAnimation"])}(alien||(alien={}));var ItemEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="",e.metaId=0,e.count=0,e.level=0,e.exp=0,e.fieldsModified=[],e}return __extends(e,t),e.prototype.inject=function(e){this.fieldsModified.splice(0),t.prototype.inject.call(this,e),this.meta=GameConfig.getItemMeta(this.metaId)},e.prototype.onInject=function(e,i,n){var r=this[i];t.prototype.onInject.call(this,e,i,n),n!=r&&this.fieldsModified.push({field:i,value:n,oldValue:r})},e}(Entity);__reflect(ItemEntity.prototype,"ItemEntity");var alien;!function(t){var e;!function(e){var i=function(){function t(){}return t.centerPopUp=function(t){t.horizontalCenter=t.verticalCenter=0},t.centerHorizontal=function(t){t.horizontalCenter=0},t.centerVertical=function(t){t.verticalCenter=0},t.notCenterPopUp=function(t){t.horizontalCenter=t.verticalCenter=0/0},t.getCenterPos=function(t){var e=0,i=0,n=t.parent;return n&&(e=.5*(n.width-t.width),i=.5*(n.height-t.height)),{x:e,y:i}},t.transDirection=function(t){var e;switch(t){case"up":e=0;break;case"right":e=1;break;case"bottom":e=2;break;case"left":e=3}return e},t}();e.Utils=i,__reflect(i.prototype,"alien.popupEffect.Utils");var n=function(){function t(){}return t.prototype.show=function(t,e,n,r,o){t.scaleX=t.scaleY=t.alpha=1,e.addChild(t),i.centerPopUp(t),n.call(r)},t.prototype.hide=function(t,e,i,n,r){e.removeChild(t),i.call(n)},t}();e.None=n,__reflect(n.prototype,"alien.popupEffect.None",["alien.popupEffect.IDialogEffect"]);var r=function(){function t(){}return t.prototype.show=function(e,n,r,o,s){e.alpha=0,n.addChild(e),i.centerPopUp(e);var a=s&&s.duration||t.DEFAULT_DURATION;egret.Tween.get(e).to({alpha:1},a).call(r,o)},t.prototype.hide=function(e,i,n,r,o){var s=o&&o.duration||t.DEFAULT_DURATION;egret.Tween.get(e).to({alpha:0},s).call(function(){i.removeChild(e),n()},this)},t.DEFAULT_DURATION=200,t}();e.Fade=r,__reflect(r.prototype,"alien.popupEffect.Fade",["alien.popupEffect.IDialogEffect"]);var o=function(){function e(){}return e.prototype.show=function(n,r,o,s,a){e.outPos||(e.outPos=[{x:0,y:-t.StageProxy.height},{x:t.StageProxy.width,y:0},{x:0,y:t.StageProxy.height},{x:-t.StageProxy.width,y:0}]),r.addChild(n),i.notCenterPopUp(n);var c=a.startPos||e.outPos[i.transDirection(a.direction)],l=a.endPos||i.getCenterPos(n);n.x=c.x||l.x,n.y=c.y||l.y;var p=a&&a.duration||e.DEFAULT_DURATION,h={x:l.x,y:l.y};egret.Tween.get(n).to(h,p,a?a.ease:null).call(o,s),a&&a.withFade&&egret.Tween.get(n).to({alpha:1},p)},e.prototype.hide=function(t,n,r,o,s){var a=e.outPos[i.transDirection(s.direction)],c=s.endPos||i.getCenterPos(t),l=s&&s.duration||e.DEFAULT_DURATION,p={x:a.x||c.x,y:a.y||c.y};egret.Tween.get(t).to(p,l,s?s.ease:null).call(function(){n.removeChild(t),i.centerPopUp(t),r()},this),s&&s.withFade&&egret.Tween.get(t).to({alpha:0},l)},e.DEFAULT_DURATION=300,e}();e.Flew=o,__reflect(o.prototype,"alien.popupEffect.Flew",["alien.popupEffect.IDialogEffect"]);var s=function(){function t(){}return t.prototype.show=function(e,n,r,o,s){var a=s&&s.duration||t.DEFAULT_DURATION;e.scaleX=e.scaleY=0;var c={scaleX:1,scaleY:1};n.addChild(e),i.centerPopUp(e),egret.Tween.get(e).to(c,a,s?s.ease:null).call(r,o),s&&s.withFade&&egret.Tween.get(e).to({alpha:1},a)},t.prototype.hide=function(e,i,n,r,o){var s=o&&o.duration||t.DEFAULT_DURATION;e.scaleX=e.scaleY=1;var a={scaleX:0,scaleY:0};egret.Tween.get(e).to(a,s,o?o.ease:null).call(function(){i.removeChild(e),e.scaleX=e.scaleY=1,n()},this),o&&o.withFade&&egret.Tween.get(e).to({alpha:0},s)},t.DEFAULT_DURATION=200,t}();e.Scale=s,__reflect(s.prototype,"alien.popupEffect.Scale",["alien.popupEffect.IDialogEffect"])}(e=t.popupEffect||(t.popupEffect={}))}(alien||(alien={}));var MinisterEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.metaId=0,e.level=0,e.quality=0,e.politics=0,e.politicsGrow=0,e.knowledge=0,e.knowledgeGrow=0,e.command=0,e.commandGrow=0,e.exploit=0,e.grade=0,e.peerage=0,e.battleValue=0,e.skill_ids=[],e.skills=[],e.equips=[],e.politics_items=[],e.knowledge_items=[],e.command_items=[],e.fieldsModified=[],e}return __extends(e,t),e.prototype.inject=function(e){var i=this;this.fieldsModified.splice(0),t.prototype.inject.call(this,e),this.grade=10-this.grade,this.meta=GameConfig.getMinisterMeta(this.metaId),this.battleValue=this.politics+this.knowledge+this.command;var n,r,o;this.skill_ids.forEach(function(t){n=Math.floor(t/1e3),r=t%1e3,o=i.getSkillByIndex(n-50001),o.inject({id:n,level:r,metaId:n})});for(var s=0;9>s;s++)this.skills[s]||(n=5e4+s+1,r=0,o=this.getSkillByIndex(s),o.inject({id:n,level:r,metaId:n}));this.skills.forEach(function(t){t.level>0&&(i.battleValue+=GameConfig.getSkillLevelMeta(t.id,t.level).battle_value)})},e.prototype.onInject=function(e,i,n){var r=this[i];t.prototype.onInject.call(this,e,i,n),n!=r&&("grade"==i&&(n=10-n),this.fieldsModified.push({field:i,value:n,oldValue:r}),this.dispatchEventWith(EventNames.MINISTER_PROPS_MODIFIED,!1,{field:i,value:n,oldValue:r}))},Object.defineProperty(e.prototype,"position",{get:function(){var t=this,e=0;return ministerService.positions.some(function(i,n){return i.ministerId==t.id?(e=i.id,!0):void 0}),e},enumerable:!0,configurable:!0}),e.prototype.getSkillByIndex=function(t){var e=this.skills[t];return e||(e=this.skills[t]=new SkillEntity),e},Object.defineProperty(e.prototype,"bodyUrl",{get:function(){return e.parseBodyUrl(this.meta.icon)},enumerable:!0,configurable:!0}),e.parseBodyUrl=function(t){return cdnurl+"resource/assets/singles/ministers/"+t+".png"},e.parseAniBodyUrl=function(t){return cdnurl+"resource/assets/animations/minister/"+t+"/"},Object.defineProperty(e.prototype,"soundUrl",{get:function(){return e.parseSoundUrl(this.meta.id)},enumerable:!0,configurable:!0}),e.getGreyAvatarUrl=function(t){return"minister_avatar_grey_block_"+t},e.parseSoundUrl=function(t){return"sound_minister_"+t+"_"+alien.MathUtils.makeRandomInt(3,1)},Object.defineProperty(e.prototype,"qualification",{get:function(){return this.politicsGrow+this.knowledgeGrow+this.commandGrow},enumerable:!0,configurable:!0}),e.prototype.getCurrentGrow=function(t){return this[t+"Grow"]},e.prototype.getQualification=function(t){return this.getCurrentGrow(t)+(this.peerage>0?GameConfig.getPeerageMeta(this.peerage).qualification:0)},e.prototype.getInitQualification=function(t){var e=this.meta["init_"+t+"_grow"];return e},e.prototype.getQualificationColor=function(t){return 20>=t?GameConfig.MINISTER_QUALITY_COLORS[1]:45>=t?GameConfig.MINISTER_QUALITY_COLORS[2]:70>=t?GameConfig.MINISTER_QUALITY_COLORS[3]:GameConfig.MINISTER_QUALITY_COLORS[4]},e.prototype.getNextExploit=function(t){return Math.floor(10*this.meta.quality*(this.getCurrentGrow(t)+1)*(1+this.getTechExploit()/100))},e.prototype.getTechExploit=function(){var t=0,i=e.techs.exploit;return i.forEach(function(e){t+=technologyService.getSkillAddition(e)}),t},e.prototype.getNextSuccessRate=function(t){var e=this.meta["init_"+t+"_grow"];return Math.ceil(e/(e+2*(this.getCurrentGrow(t)-e))*100)+this.getGrowFailCountByField(t)},e.prototype.getGiveCount=function(t,i){return this[e.abilityClassifyFields[t]+"_items"][i]},e.prototype.getEquipment=function(t){var e=this.equips[t];return e.length>0?packService.getItemById(e):null},e.prototype.getSkillsText=function(t){var i=this,n=this.skills.filter(function(n){return e.developmentSkills[t].indexOf(n.id)>=0&&n.level+i.getAdditionSkillLevel(n.id)>0}).map(function(t){return GameConfig.getSkillMeta(t.metaId).name+"Lv."+(t.level+i.getAdditionSkillLevel(t.id))}).join(" ");return n?n:lang.nothing},e.prototype.getSkill=function(t){var e=null;return this.skills.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getSkillLevel=function(t){var e=0;return this.skills.some(function(i){return i.id==t?(e=i.level,!0):void 0}),e},e.prototype.getSkillEffect=function(t,e){var i=0,n=this.getSkill(t),r=this.getAdditionSkillLevel(t);return n&&n.level+r>0&&(i=GameConfig.getSkillEffectValue(n.metaId,n.level+r,e)),i},e.prototype.getNextLevelCondition=function(){var t=0,e=GameConfig.getExpMeta(this.meta.quality,this.level),i=technologyService.getSkillAddition(402002),n=ministerService.getPositionAddition(2,this.id,34);return t=Math.floor(e.condition*(1+.01*(i+n)))},e.prototype.getTreasureAbility=function(t){return this[t+"_items"].reduce(function(t,i,n){return t+e.treasureValues[n]*i},0)},e.prototype.getEquipAbility=function(t){var i=e.equipBuffersType[t],n=0;return this.equips.forEach(function(t){var e=packService.getItemById(t);if(e){var r=GameConfig.getSkillLevelMeta(e.meta.skill_id,e.level+1),o=GameConfig.getSkillBuffers(r);o.forEach(function(t){t.type==i&&(n+=t.value)})}}),n},e.prototype.getAllAbility=function(){var t=this,i=0;return e.abilityClassifyFields.forEach(function(e){i+=t.getClassifyAbility(e)}),i},e.prototype.getClassifyAbility=function(t){return this.getInitAbility(t)+this.getTreasureAbility(t)+this.getOfficeAbility(t)+this.getFateAbility(t)+this.getTechAbility(t)+this.getEquipAbility(t)+this.getUnionAbility(t)},e.prototype.getFateAbility=function(t){var i=this,n=0;return alien.Utils.objectValues(GameConfig.fates).forEach(function(r){var o=!1;if(r.ids.some(function(t){return t==i.metaId?(o=!0,!0):void 0}),o){var s=GameConfig.getFateLevel(r);4==r.addition_type?n+=s*r.addition_value:e.abilityClassifyFields[r.addition_type-1]==t&&(n+=s*r.addition_value)}}),Math.floor(this.getInitAbility(t)*n*.01)},e.prototype.getOfficeAbility=function(t){var e=GameConfig.getClassMeta(this.grade),i=0;return e&&(i=e.addition_value),i},e.prototype.getTechAbility=function(t){var i=0,n=e.techs[t];return n.forEach(function(t){i+=technologyService.getSkillAddition(t)}),Math.floor(this.getInitAbility(t)*i/100)},e.prototype.getInitAbility=function(t){var i=e.abilityClassifyFields[this.meta.specialty_type-1]==t?2:1,n=this.getQualification(t)*(this.level-1)*i;return this.meta["init_"+t]+n},e.prototype.getUnionAbility=function(t){var i=0;if(mainService.playerInfo.union_id<=0||!unionService.union)return i;var n=e.unionTechs[t];return n.forEach(function(t){i+=unionService.getTechAddition(t)}),Math.floor(this.getInitAbility(t)*i/100)},e.prototype.getAbility=function(t,e){switch(e){case"init":return this.getInitAbility(t);case"treasure":return this.getTreasureAbility(t)+this.getEquipAbility(t);case"office":return this.getOfficeAbility(t);case"tech":return this.getTechAbility(t);case"union":return this.getUnionAbility(t);case"fate":return this.getFateAbility(t)}},e.prototype.isEquipedItem=function(t){return this.equips.indexOf(t)>=0},e.prototype.getMemorialEffectValue=function(t){switch(t){case 1:return Math.floor(.01*this.politics);case 2:return Math.floor(.01*this.knowledge);case 3:return Math.floor(.01*this.command);case 4:return 100*this.politics;case 5:return this.command;case 6:return 10*this.command;case 7:return 300001;case 8:return this.level+200}},e.prototype.getMemorialEffectStr=function(t){return lang.format(lang.memorial_effects[t],this.getMemorialEffectValue(t))},e.prototype.getAdditionSkillLevel=function(t){var i=0;return this.equips.forEach(function(n){var r=packService.getItemById(n);if(r){var o=GameConfig.getSkillLevelMeta(r.meta.skill_id,r.level+1),s=GameConfig.getSkillBuffers(o);s.forEach(function(n){e.skillBuffer[t].indexOf(n.id)>=0&&(i+=n.value)})}}),i},e.prototype.getGrowFailCountByField=function(t){var e=0;switch(t){case"politics":e=127&this.grow_fail;break;case"knowledge":e=this.grow_fail>>7&127;break;case"command":e=this.grow_fail>>14&127}return 2*e},e.prototype.getSkillFailCountBySkillId=function(t){var e=0,i=t%10-1;return 3>=i?e=this.skill_fail.low>>7*i&127:4==i?e=this.skill_fail.low>>28|(7&this.skill_fail.high)<<4:i>4&&(e=this.skill_fail.high>>3+7*(i-5)&127),5*e},Object.defineProperty(e.prototype,"state",{get:function(){return ministerService.getMinisterStateById(this.id)},enumerable:!0,configurable:!0}),e.treasureValues=[25,50,75,100],e.abilityClassifyFields=["politics","knowledge","command"],e.treasures=[[600011,600015,600019],[600010,600014,600018],[600009,600013,600017],[600008,600012,600016]],e.developmentSkills={trade:[50001,50002],industry:[50006,50002],military:[50007,50002],battle:[50008,50009],politics:[50001],knowledge:[50005],command:[50007],rite:[50004],tech:[50005,50006],arena:[50002,50004]},e.techs={politics:[401010,401008],knowledge:[402011,402008],command:[403012,403006],exploit:[402015]},e.unionTechs={politics:[404002],knowledge:[404003],command:[404004],exploit:[]},e.equipBuffersType={politics:28,knowledge:29,command:30},e.abilityFields=["init","treasure","office","tech","union","fate"],e.quality=[4,3,2,1],e.fateLevelUp=[400,350,300,250,200,150,100],e.skillBuffer={50001:[501901,501902,501903,501904,501905],50002:[502001,502002,502003,502004,502005],50003:[502101,502102,502103,502104,502105],50004:[502201,502202,502203,502204,502205],50005:[502301,502302,502303,502304,502305],50006:[502401,502402,502403,502404,502405],50007:[502501,502502,502503,502504,502505],50008:[502601,502602,502603,502604,502605],50009:[502701,502702,502703,502704,502705]},e}(Entity);__reflect(MinisterEntity.prototype,"MinisterEntity");var partyEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.state=0,e.round=0,e.type=-1,e.startTime=0,e.players=[],e.roundInfo=[],e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e),this.players.length>0&&0==this.players[0].id&&(this.state=0,this.id=0)},e.TYPE={RITE:0,CULTURE:1,BATTLE:2},e}(Entity);__reflect(partyEntity.prototype,"partyEntity");var PlayerEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.locked=!0,e.oldNationalPower=0,e}return __extends(e,t),e.prototype.inject=function(e){0!=this.oldNationalPower&&this.oldNationalPower<mainService.getAllSum()&&(this.oldNationalPower=mainService.getAllSum()),t.prototype.inject.call(this,e),this.locked&&(this.locked=!1),this.national_icon=0==this.national_icon?1001:this.national_icon,this.chat_icon=0==this.chat_icon?1001:this.chat_icon},e.prototype.onInject=function(e,i,n){var r=this[i];t.prototype.onInject.call(this,e,i,n),n!=r&&this.dispatchEventWith(EventNames.PLAYER_PROPS_MODIFIED,!1,{locked:this.locked,field:i,value:n,oldValue:r})},e.prototype.getNationalIcon=function(){var t=0==this.national_icon?1001:this.national_icon;return"lobby_head_"+t},Object.defineProperty(e.prototype,"vip",{get:function(){var t=this,e=alien.Utils.objectValues(GameConfig.vip),i=0;return e.some(function(e){return t.charge<e.charge?!0:void(i=e.level)}),i},enumerable:!0,configurable:!0}),e.getMaxVip=function(){var t=12;return t},e}(Entity);__reflect(PlayerEntity.prototype,"PlayerEntity");var PrinceEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id="",e.princessId="",e.ministerId="",e.quality=0,e.level=0,e.exp=0,e.politics=0,e.knowledge=0,e.command=0,e.openTime=0,e.peerage=0,e.activity=0,e.openFlag=0,e.timestamp=0,e.fieldsModified=[],e}return __extends(e,t),e.prototype.inject=function(e){this.fieldsModified.splice(0),t.prototype.inject.call(this,e)},e.prototype.onInject=function(e,i,n){var r=this[i];t.prototype.onInject.call(this,e,i,n),n!=r&&this.fieldsModified.push({field:i,value:n,oldValue:r})},e.prototype.getMaxLevel=function(){switch(this.quality){case 1:return 25;case 2:return 50;case 3:return 75;case 4:return 100}},e.prototype.getNowMaxExp=function(){return Math.ceil(this.level/10)},Object.defineProperty(e.prototype,"type",{get:function(){var t=0;return t=this.level>=1&&this.level<=10?1:this.level>10&&this.level<25?1:2},enumerable:!0,configurable:!0}),e.prototype.getIconId=function(){var t=0;return t=this.level<25?0:4,t+=this.quality},e.prototype.getIconUrl=function(){var t=this.getIconId(),e= cdnurl+"resource/assets/singles/princes/"+t+".png";return e},e.prototype.getOpenCost=function(){var t=this,i=e.openCost[0];return e.openCost.some(function(e){return t.peerage==e.peerage?(i=e,!0):void 0}),i},e.prototype.getAbility=function(){return this.politics+this.knowledge+this.command},e.parseAniBodyUrl=function(t){return cdnurl+"resource/assets/animations/prince/"+t+"/"},e.fields=["politics","knowledge","command"],e.openCost=[{peerage:1,gold:100,openOrder:1},{peerage:2,gold:200,openOrder:2},{peerage:3,gold:300,openOrder:3},{peerage:4,gold:400,openOrder:4},{peerage:5,gold:500,openOrder:5},{peerage:6,gold:600,openOrder:6},{peerage:7,gold:700,openOrder:7}],e}(Entity);__reflect(PrinceEntity.prototype,"PrinceEntity");var PrincessEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.metaId=0,e.luck=0,e.luck_timestamp=0,e.luck_count=0,e.charm=0,e.rite=0,e.culture=0,e.battle=0,e.position=0,e.skill_ids=[],e.skills=[],e.son_count=0,e.fieldsModified=[],e}return __extends(e,t),e.prototype.inject=function(e){var i=this;this.fieldsModified.splice(0),t.prototype.inject.call(this,e),this.meta=GameConfig.getPrincessMeta(this.metaId);var n,r,o;this.skill_ids.forEach(function(t){n=Math.floor(t/1e3),r=t%1e3,o=i.getSkillById(n),o.inject({id:n,level:r,metaId:n})})},e.prototype.onInject=function(e,i,n){var r=this[i];t.prototype.onInject.call(this,e,i,n),n!=r&&(this.fieldsModified.push({field:i,value:n,oldValue:r}),this.dispatchEventWith(EventNames.PRINCESS_PROPS_MODIFIED,!1,{field:i,value:n,oldValue:r}))},e.prototype.getSkillById=function(t){var e;return this.skills.forEach(function(i){i.id==t&&(e=i)}),e||this.skills.push(e=new SkillEntity),e},Object.defineProperty(e.prototype,"luckCondition",{get:function(){return 5*(this.luck+1)},enumerable:!0,configurable:!0}),e.prototype.getSkillEffect=function(t,e){var i=GameConfig.getSkillMeta(t.metaId),n=i.levels[e];if(0==n.buffers[0])return"";var r=GameConfig.getBufferMeta(n.buffers[0]);return alien.StringUtils.format(r.intro,r.value)},Object.defineProperty(e.prototype,"bodyUrl",{get:function(){return e.parseBodyUrl(this.meta.icon)},enumerable:!0,configurable:!0}),e.prototype.getAllRounAbility=function(){return 100*this.charm+this.culture+this.battle+this.luck+this.rite},e.parseAniBodyUrl=function(t){return cdnurl+"resource/assets/animations/princess/"+t+"/"},e.parseBodyUrl=function(t){return cdnurl+"resource/assets/singles/princesses/"+t+".png"},e.parseNoClothesUrl=function(t){return 200001==t||200004==t||200006==t? cdnurl+"resource/assets/singles/princesses/"+t+".png":cdnurl+"resource/assets/singles/princesses/u"+t+".png"},e.parseBgUrl=function(t){var e=t%6+1;return cdnurl+"resource/assets/singles/princessesBg/"+e+".png"},Object.defineProperty(e.prototype,"soundUrl",{get:function(){return e.parseSoundUrl(this.meta.id)},enumerable:!0,configurable:!0}),e.parseSoundUrl=function(t){return"sound_princess_"+t+"_"+alien.MathUtils.makeRandomInt(3,1)},Object.defineProperty(e.prototype,"state",{get:function(){return princessService.getPrincessStateById(this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateContent",{get:function(){return lang.princess_state[this.state]},enumerable:!0,configurable:!0}),e.treasureValues=[2,1,2,1],e.abilityClassifyFields=["luck","charm"],e.skillUpgradeItemMap={2001:"rite",2002:"battle",2003:"culture"},e.treasures=[[600065,600067],[600066,600068]],e}(Entity);__reflect(PrincessEntity.prototype,"PrincessEntity");var SkillEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.metaId=0,e.level=0,e}return __extends(e,t),e.prototype.getNextSkillId=function(){return 1e3*this.id+this.level+1},e}(Entity);__reflect(SkillEntity.prototype,"SkillEntity");var TaskEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.value=0,e.flag=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e),this.meta=GameConfig.getTaskMeta(this.id)},e}(Entity);__reflect(TaskEntity.prototype,"TaskEntity");var TechnologyEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.level=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e),this.meta=GameConfig.getTechMeta(this.id)},e}(Entity);__reflect(TechnologyEntity.prototype,"TechnologyEntity");var UnionEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.members=[],e.techs=[],e.applyPlayers=[],e.logs=[],e.gifts=[],e}return __extends(e,t),e.prototype.inject=function(t){this.info||(this.info=new UnionInfoEntity),this.info.inject(t.info)},e.getLogTextFlow=function(t){switch(t.optType){case e.LOG_TYPE.LOG_NONE:case e.LOG_TYPE.LOG_JOIN:case e.LOG_TYPE.LOG_APPLY:case e.LOG_TYPE.LOG_LEAVE:case e.LOG_TYPE.LOG_BUY_GIFT:case e.LOG_TYPE.LOG_CHANGE_NOTICE:case e.LOG_TYPE.LOG_OPEN_DUPLICATE:return lang.formatHtml(lang.union_log_format[t.optType].content,t.sourceName);case e.LOG_TYPE.LOG_AGREE_APPLY:case e.LOG_TYPE.LOG_REFUSE_APPLY:case e.LOG_TYPE.LOG_KICK:case e.LOG_TYPE.LOG_TRANSFER:return lang.formatHtml(lang.union_log_format[t.optType].content,t.sourceName,t.targetName);case e.LOG_TYPE.LOG_DONATE:var i=unionService.getDonateItemByType(t.val1);return lang.formatHtml(lang.union_log_format[t.optType].content,t.sourceName,i.name);case e.LOG_TYPE.LOG_MEMBER_POSITION:var n=lang.union_position[t.val1];return lang.formatHtml(lang.union_log_format[t.optType].content,t.sourceName,t.targetName,n);case e.LOG_TYPE.LOG_TECH:var r=GameConfig.getTechMeta(t.val1);return lang.formatHtml(lang.union_log_format[t.optType].content,t.sourceName,r.name);case e.LOG_TYPE.LOG_BUY_ITEM:var o=GameConfig.getExchangeMeta(t.val1),s=GameConfig.getItemMeta(o.item_id);return lang.formatHtml(lang.union_log_format[t.optType].content,t.sourceName,s.name)}},e.POSITION={LEADER:3,VICE:2,ELITE:1,COMMON:0},e.LOG_TYPE={LOG_NONE:0,LOG_JOIN:1,LOG_APPLY:2,LOG_AGREE_APPLY:3,LOG_REFUSE_APPLY:4,LOG_LEAVE:5,LOG_KICK:6,LOG_DONATE:7,LOG_MEMBER_POSITION:8,LOG_TRANSFER:9,LOG_TECH:10,LOG_BUY_ITEM:11,LOG_BUY_GIFT:12,LOG_CHANGE_NOTICE:13,LOG_OPEN_DUPLICATE:14},e.MAX_LEVEL=59,e
}(Entity);__reflect(UnionEntity.prototype,"UnionEntity");var UnionInfoEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.level=0,e.exp=0,e.techPoint=0,e.leaderId=0,e.transferTime=0,e.fightValue=0,e.playerNum=0,e.maxPlayerNum=0,e.maxEliteNum=0,e.bossCount=0,e.bossTime=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(UnionInfoEntity.prototype,"UnionInfoEntity");var UnionMemberEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.contribute=0,e.giftExp=0,e.status=0,e.position=0,e.battleValue=0,e.vip=0,e.icon=0,e.leaveTime=0,e.offlineTime=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e),this.id==unionService.union.info.leaderId?this.position=UnionEntity.POSITION.LEADER:this.position==UnionEntity.POSITION.LEADER&&(this.position=UnionEntity.POSITION.COMMON)},e}(Entity);__reflect(UnionMemberEntity.prototype,"UnionMemberEntity");var UnionTechEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.level=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(UnionTechEntity.prototype,"UnionTechEntity");var UnionApplyEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.fightValue=0,e.applyTime=0,e.vip=0,e.icon=0,e.onlineState=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(UnionApplyEntity.prototype,"UnionApplyEntity");var UnionLogEntity=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.time=0,e}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(UnionLogEntity.prototype,"UnionLogEntity");var UnionGiftEntity=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.inject=function(e){t.prototype.inject.call(this,e)},e}(Entity);__reflect(UnionGiftEntity.prototype,"UnionGiftEntity");var Analytics=function(){function t(){}return t.logEvent=function(t,e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var i,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return i=dataCenterService?dataCenterService.accountId:null,n=dataCenterService?dataCenterService.pid:null,egret.Capabilities.runtimeType!=egret.RuntimeType.NATIVE?[3,2]:[4,new Promise(function(i,n){EgretBridge.call(r.moduleName,"log_event",{name:t,params:e},function(t){console.log(JSON.stringify(t)),0==t.code?i(t.data):n(t.code)})})];case 1:return[2,o.sent()];case 2:this.sendToParent(t,e,i,n),webService.logEvent(t,e,i,n),o.label=3;case 3:return[2]}})})},t.sendToParent=function(t,e,i,n){Bridge.callDynamic("analytics","log_event",[t,e,i,n])},t.moduleName="analytics",t}();__reflect(Analytics.prototype,"Analytics");var Authorize=function(){function t(){}return t.authorizeByWeixin=function(){var t=this;return new Promise(function(e,i){EgretBridge.call(t.moduleName,"authorizeByWeixin",null,function(t){0==t.code?e(t.data):i(t.code)})})},t.authorizeByChannel=function(t){var e=this;return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE?new Promise(function(t,i){EgretBridge.call(e.moduleName,"authorizeByChannel",null,function(e){0==e.code?t(e.data):i(e.code)})}):webService.authorizeByChannel(t)},t.switchUser=function(){Bridge.callDynamic("user","switchUser")},t.moduleName="authorize",t}();__reflect(Authorize.prototype,"Authorize");var Bridge=function(){function t(){}return t.init=function(t){try{var e=parent.bridge;e.init(t)}catch(i){}},t.startLoad=function(){try{window.onStartLoad()}catch(t){}},t.callDynamic=function(t,e,i){void 0===i&&(i=null);try{var n=parent.bridge,r=n[t][e];r.apply(null,i)}catch(o){}},t.moduleName="init",t}();__reflect(Bridge.prototype,"Bridge");var Recharge=function(){function t(){}return t.pay=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n=this;return __generator(this,function(r){switch(r.label){case 0:return e=mainService.getLastServer(),[4,webService.createOrder(t.id,e.id,GameConfig.channel)];case 1:return i=r.sent().tid,egret.Capabilities.runtimeType!=egret.RuntimeType.NATIVE?[3,3]:[4,new Promise(function(e,i){EgretBridge.call(n.moduleName,"pay",{item:t},function(t){console.log(JSON.stringify(t)),0==t.code?e(t.data):i(t.code)})})];case 2:return[2,r.sent()];case 3:return[4,new Promise(function(n,r){Bridge.callDynamic("recharge","pay",[{tid:i,item:t,amount:1,server:e,aid:dataCenterService.accountId,pid:dataCenterService.pid,nickname:mainService.playerBaseInfo.name,vip:mainService.playerInfo.vip},function(t){n()}])})];case 4:return[2,r.sent()]}})})},t.moduleName="recharge",t}();__reflect(Recharge.prototype,"Recharge");var Tools=function(){function t(){}return Object.defineProperty(t,"uuid",{get:function(){var t=LocalStorage.getItem("uuid",GameConfig.platform);return t||(t=alien.StringUtils.makeRandomString(32),LocalStorage.setItem("uuid",t,GameConfig.platform)),t},enumerable:!0,configurable:!0}),t.moduleName="tools",t}();__reflect(Tools.prototype,"Tools");var UserLifeCycle=function(){function t(){}return t.onLogin=function(){EgretBridge.call(this.moduleName,"onLogin",{id:dataCenterService.pid.toString()})},t.onLogout=function(){EgretBridge.call(this.moduleName,"onLogout",{id:dataCenterService.pid.toString()})},t.moduleName="user_life_cycle",t}();__reflect(UserLifeCycle.prototype,"UserLifeCycle");var AccountServer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this);var e=this._protocol;e.nameToMessageId(protocols.CLIENT_ACCOUNT_LoginResponse,256)},e.prototype.dealMessage=function(e){switch(t.prototype.dealMessage.call(this,e),e.name){case"MSG_AUTHED":this.send(protocols.CLIENT_ACCOUNT_LoginRequest,{buildNumber:"1,5,1,1",token:this._tempToken});break;case"CLIENT_ACCOUNT_LoginResponse":var i=e.body,n=i.error,r=(i.ip,i.port),o=i.uid,s=i.accountId;if(0==n){dataCenterService.lastServer=this._serverConfig.id,dataCenterService.setAccount(o,s,this._tempToken);var a=this._serverUrl.replace(/(.*[\/|:])\d+$/,"$1"+r);gameServer.start(a),this.close()}else dataCenterService.cleanToken(),Toast.show({text:lang.login_account_errors[n]});this.dispatchEventWith(EventNames.LOGIN_ACCOUNT_RESULT,!1,{error:n})}},e.prototype.start=function(t){var e=t.token,i=t.serverConfig;this._serverConfig=i,this._serverUrl=i.url,this._tempToken=e,alien.Dispatcher.dispatch(EventNames.SHOW_WAITING,{content:lang.in_login}),this.connect()},e.prototype.onError=function(e){t.prototype.onError.call(this,e),alien.Dispatcher.dispatch(EventNames.HIDE_WAITING)},e.prototype.onClose=function(e){t.prototype.onClose.call(this,e)},e}(Server);__reflect(AccountServer.prototype,"AccountServer");var GameServer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this);var e=this._protocol;e.nameToMessageId(protocols.CLIENT_GATE_LoginResponse,256)},e.prototype.dealMessage=function(e){switch(t.prototype.dealMessage.call(this,e),e.name){case"MSG_AUTHED":this.send(protocols.CLIENT_GATE_LoginRequest,{protocolVersion:1,uid:dataCenterService.uid,flag:!1},Server.SERVER_TYPE.GATESERVER);break;case"CLIENT_GATE_LoginResponse":this.send(protocols.CLIENT_WORLD_SelectPlayerRequest,{uid:dataCenterService.uid}),alien.Dispatcher.dispatch(EventNames.HIDE_WAITING)}e.body.error>0&&Toast.show({text:lang.response_error[e.body.error]})},e.prototype.start=function(t){this._serverUrl=t,this.connect()},e.prototype.onClose=function(e){this._closeBySelf||ServerDisconnect.instance.show(lang.reconnect_tips,function(){MainStage.instance.initSceneToLogin()}),t.prototype.onClose.call(this,e)},e.prototype.send=function(e,i,n,r){void 0===i&&(i=null),void 0===n&&(n=Server.SERVER_TYPE.WORLDSERVER),void 0===r&&(r=0/0),t.prototype.send.call(this,e,i,n,r)},e}(Server);__reflect(GameServer.prototype,"GameServer");var PopUpManager=alien.PopUpManager,LocalStorage=alien.LocalStorage,EventManager=alien.EventManager,SoundManager=alien.SoundManager,EgretBridge=alien.EgretBridge,ArrayCollection=eui.ArrayCollection,EMCAnalyzer=alien.EMCAnalyzer,DGBAnalyzer=alien.DGBAnalyzer;ErrorTrack.instance.start();var webService;webService=new WebService;var Main=function(t){function e(){var e=t.call(this)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,preprocessing(),e.once(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e}return __extends(e,t),e.prototype.onAddedToStage=function(){this.stage.scaleMode=egret.Capabilities.isMobile?egret.StageScaleMode.FIXED_WIDTH:egret.StageScaleMode.SHOW_ALL,this.stage.orientation=egret.Capabilities.isMobile?egret.OrientationMode.PORTRAIT:egret.OrientationMode.AUTO},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.registerAnalyzer("emc",EMCAnalyzer),RES.registerAnalyzer("dgb",DGBAnalyzer),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(cdnurl+"resource/default.res.json",cdnurl+"resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme(cdnurl+"resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene(),RES.loadGroup("loading")},e.prototype.onResourceLoadComplete=function(t){"loading"==t.groupName?(Bridge.startLoad(),this.loadingLayer=new LoadingLayer,this.addChild(this.loadingLayer),RES.loadGroup("preload")):"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){this.loadingLayer&&this.loadingLayer.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){alien.StageProxy.init(this.stage,this);var t=MainStage.instance;t.initData({loadingLayer:this.loadingLayer}),this.addChildAt(t,0)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var alien;!function(t){var e=function(){function t(){}return t.init=function(){t.eventDispatcher=new egret.EventDispatcher},t.dispatch=function(e,i){void 0===i&&(i=null),i?t.eventDispatcher.dispatchEventWith(e,!1,i):t.eventDispatcher.dispatchEvent(new egret.Event(e))},t.addEventListener=function(e,i,n){t.eventDispatcher.addEventListener(e,i,n)},t.removeEventListener=function(e,i,n){t.eventDispatcher.removeEventListener(e,i,n)},t}();t.Dispatcher=e,__reflect(e.prototype,"alien.Dispatcher")}(alien||(alien={}));var ByteArray=function(){function t(){}return t.create=function(){var t=new egret.ByteArray;return t.endian=egret.Endian.LITTLE_ENDIAN,t},t}();__reflect(ByteArray.prototype,"ByteArray");var CommonProtocol=function(){function t(){this.STX=39,this.CKX=114,this.cryptBuffer=[],this.cryptCache={},this.prepareCryptBuffer()}return Object.defineProperty(t,"instance",{get:function(){return void 0==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.prepareCryptBuffer=function(){for(var t=1048577,e=0;256>e;e++)for(var i=e,n=0;5>n;n++,i+=256){var r=void 0,o=void 0;t=(125*t+3)%2796203,r=(65535&t)<<16,t=(125*t+3)%2796203,o=65535&t,this.cryptBuffer[i]=r|o}},t.prototype.nameToMessageId=function(t,e){t||console.log(),t.name||console.log();var i=t.name.toUpperCase(),n=this.cryptCache[i];if(!n){for(var r=2146271213,o=4008636142,s=void 0,a=0;a<i.length;a++)s=i.charCodeAt(a),0!=s&&(r=this.cryptBuffer[e+s]^r+o,o=s+r+o+(o<<5)+3);n=this.cryptCache[t.name]=r,this.cryptCache[r]=t}return n},t.prototype.messageIdToName=function(t){return this.cryptCache[t]},t.prototype.getByteFunc=function(t){var e;switch(t){case"bool":e="Byte";break;case"int8":e="Byte";break;case"int16":e="Short";break;case"int32":e="Int";break;case"uint8":e="UnsignedByte";break;case"uint16":e="UnsignedShort";break;case"uint32":e="UnsignedInt";break;case"int64":e="Long";break;case"float32":e="Float";break;case"float64":e="Double";break;case"string":e="UTF"}return e},t.prototype.transWriteValue=function(t,e){switch(t){case"bool":return e?1:0;default:return e}},t.prototype.transReadValue=function(t,e){switch(t){case"bool":return 0!=e;default:return e}},t.prototype.ready=function(t){},t.prototype.encode=function(t){var e=t.message,i=t.data,n=t.serverType,r=t.id,o=ByteArray.create();o.endian=egret.Endian.LITTLE_ENDIAN,o.writeByte(this.STX),o.writeByte(0),o.writeByte(n),o.writeByte(this.CKX);var s=this.nameToMessageId(e,256);if(o.writeInt(s),o.writeInt(0),o.writeInt(0),o.writeInt(r),i){var a=ByteArray.create(),c=e;c&&c.length>0&&this.encodeProtocol(c,a,i),o.writeInt(a.length),o.writeInt(a.length),o.writeBytes(a)}else o.writeInt(0),o.writeInt(0);return o},t.prototype.decode=function(t){var e=t.bytes,i=(e.readByte(),e.readByte()),n=e.readByte(),r=(e.readByte(),e.readInt()),o=e.readInt(),s=e.readInt(),a=e.readInt(),c=(e.readInt(),e.readInt(),this.messageIdToName(r));if(!c)return console.warn("no messages mapped to",r),null;var l={},p=0;if(c.name.match(/response$/i)&&(p=e.readShort()),0==p){var h=c;if(h&&h.length>0){"WC_INIT_DATA_NOTIFY"==c.name&&console.log();try{l=this.decodeProtocol(h,e)}catch(u){console.log("decode ",c.name,"failed:",u)}}}return l.error=p,{name:c.name,messageId:r,lineServerId:i,destServerType:n,srcZoneId:o,destZoneId:s,id:a,body:l}},t.prototype.encodeProtocol=function(t,e,i){var n=this;"string"==typeof t?this.writeValue(e,t,i):t.forEach(function(t){var r=Object.keys(t)[0],o=t[r],s=i[r];switch(o){case"repeated":e.writeUnsignedShort(s.length),s.forEach(function(i){var r=void 0!==i&&null!==i;e.writeByte(r?1:0),r&&n.encodeProtocol(t.def,e,i)});break;case"object":i[r]=n.encodeProtocol(t.def,e,s);break;default:n.writeValue(e,o,s)}})},t.prototype.writeValue=function(t,e,i){var n=this.getByteFunc(e);n?t["write"+n](this.transWriteValue(e,i)):console.error("unknown type: "+e)},t.prototype.decodeProtocol=function(t,e){var i=this;if("string"==typeof t)return this.readValue(e,t);var n={};return t.forEach(function(t){var r=Object.keys(t)[0],o=t[r];switch(o){case"repeated":for(var s=n[r]=[],a=e.readUnsignedShort(),c=0;a>c;c++){var l=e.readByte();if(1==l){var p=i.decodeProtocol(t.def,e);t.ignoreSize?s.push(p):s[c]=p}else t.ignoreSize||(s[c]=null)}break;case"object":n[r]=i.decodeProtocol(t.def,e);break;default:Array.isArray(o)?n[r]=i.decodeProtocol(o,e):n[r]=i.readValue(e,o)}}),n},t.prototype.readValue=function(t,e){var i=this.getByteFunc(e);if(i){var n=void 0;return n="Long"==i?new dcodeIO.Long(t.readInt(),t.readInt()):t["read"+i](),this.transReadValue(e,n)}console.error("unknown type: "+e)},t}();__reflect(CommonProtocol.prototype,"CommonProtocol",["IProtocol"]);var ProtocolConfigs=function(){function t(){}return t.getConfig=function(t){return this[t]},t.init=function(){for(var t in this)"object"!=typeof this[t]||this[t].name||(this[t].name=t)},t.MSG_CONNECT=[],t.MSG_CONNECTED=[{clientId:"int32"}],t.MSG_AUTH=[{clientId:"int32"},{clientType:"bool"}],t.MSG_AUTHED=[],t.CLIENT_ACCOUNT_LoginRequest=[{buildNumber:"string"},{token:"string"}],t.CLIENT_ACCOUNT_LoginResponse=[{uid:"int32"},{accountId:"int32"},{lineSize:"int8"},{lineId:"int8"},{gateSize:"int8"},{gateId:"int16"},{ipAddress:"int32"},{ip:"string"},{port:"uint16"},{linePlayerCount:"int32"}],t.CLIENT_GATE_LoginRequest=[{protocolVersion:"int32"},{uid:"int32"},{flag:"bool"}],t.CLIENT_GATE_LoginResponse=[],t.CLIENT_WORLD_SelectPlayerRequest=[{uid:"int32"}],t.CLIENT_WORLD_SelectPlayerResponse=[{players:"repeated",def:[{id:"int32"},{name:"string"},{gold:"int32"}]}],t.CLIENT_WORLD_CreatePlayerRequest=[{uid:"int32"},{name:"string"},{national_icon:"int32"},{chat_icon:"int32"}],t.CLIENT_WORLD_CreatePlayerResponse=[{uid:"int32"},{playerId:"int32"}],t.CLIENT_GAME_LoginRequest=[{uid:"int32"},{playerId:"int32"}],t.CLIENT_GAME_LoginResponse=[{timestamp:"int32"}],t.CLIENT_GAME_LogoutRequest=[],t.WC_INIT_PLAYERINFO_NOTIFY=[{trade:"int32"},{military:"int32"},{industry:"int32"},{gold:"int32"},{silver:"int64"},{mineral:"int64"},{troops:"int64"},{attack:"int32"},{hp:"int32"},{area:"int32"},{national_power:"int32"},{charge:"int32"},{learnRiteMax:"int8"},{plantMax:"int8"},{ministerDevMax:"int8"},{pveScore:"int32"},{emerald:"int32"},{harem:"int32"},{cash_gift:"int32"},{conquest:"int32"},{union_id:"int32"},{national_property:"repeated",def:[{trade:"int32"},{military:"int32"},{industry:"int32"}]},{national_icon:"int32"},{chat_icon:"int32"}],t.WC_UPDATE_PLAYERINFO_NOTIFY=t.WC_INIT_PLAYERINFO_NOTIFY.concat(),t.WC_INIT_DATA_NOTIFY=[{pveType:"int8"},{guide_store:"int32"}],t.ACTIVITY_ENTITY=[{id:"int16"},{str:"string"},{"int":"int32"},{timestamp:"int32"}],t.WC_INIT_TIME_NOTIFY=[{time:"repeated",ignoreSize:!0,def:t.ACTIVITY_ENTITY}],t.WC_UPDATE_TIME_NOTIFY=t.ACTIVITY_ENTITY.concat(),t.CW_ADVANCETIME_Request=[{id:"int16"}],t.WC_ADVANCETIME_Response=[],t.CW_ITEM_USEACCCARD_REQUEST=[{itemId:"string"},{count:"int32"},{actTimeId:"int16"}],t.WC_ITEM_USEACCCARD_RESPONSE=[],t.WC_RECHARGE_SUCESSS_NOTIFY=[{id:"int32"}],t.WC_UPDATE_ITEM_Notify=[{id:"string"},{metaId:"int32"},{count:"int16"},{level:"int8"},{exp:"int32"}],t.WC_INIT_ITEM_Notify=[{items:"repeated",def:t.WC_UPDATE_ITEM_Notify}],t.CW_ITEM_USE_Request=[{id:"string"},{count:"int16"},{targetId:"string"}],t.WC_ITEM_USE_Response=[],t.CW_ITEM_COMPOSE_Request=[{combineId:"int8"}],t.WC_ITEM_COMPOSE_Response=[],t.MINISTER=[{id:"string"},{metaId:"int32"},{level:"int16"},{exploit:"int32"},{grade:"int8"},{peerage:"int8"},{politics:"int32"},{knowledge:"int32"},{command:"int32"},{politicsGrow:"int16"},{knowledgeGrow:"int16"},{commandGrow:"int16"},{equips:"repeated",def:"string"},{skill_ids:"repeated",ignoreSize:!0,def:"int32"},{politics_items:"repeated",def:"int16"},{knowledge_items:"repeated",def:"int16"},{command_items:"repeated",def:"int16"},{skill_fail:"int64"},{grow_fail:"int32"}],t.WC_INIT_CARD_NOTIFY=[{ministers:"repeated",def:t.MINISTER}],t.WC_UPDATE_CARD_NOTIFY=t.MINISTER.concat(),t.CW_CARD_ADDABILITY_Request=[{ministerId:"string"},{pos:"int8"},{count:"int8"}],t.WC_CARD_ADDABILITY_Response=[],t.CW_EquipStrengthen_REQUEST=[{item_id:"string"},{minister_id:"string"},{material:"repeated",def:"string"}],t.WC_EquipStrengthen_Response=[{item_id:"string"}],t.CW_CARD_ADDEQUIP_Request=[{ministerId:"string"},{itemId:"string"}],t.WC_CARD_ADDEQUIP_Response=[],t.CW_CARD_REMOVEEQUIP_REQUEST=[{ministerId:"string"},{index:"int32"}],t.WC_CARD_REMOVEEQUIP_Response=[],t.CW_CARD_ADDSKILL_Request=[{ministerId:"string"},{skillId:"int32"}],t.WC_CARD_ADDSKILL_Response=[{skillId:"int32"},{result:"bool"}],t.CW_CARD_HIRE_Request=[{metaId:"int32"}],t.WC_CARD_HIRE_Response=[{metaId:"int32"}],t.CW_CARD_ADDLEVEL_Request=[{ministerId:"string"},{level:"int16"}],t.WC_CARD_ADDLEVEL_Response=[],t.CW_CARD_ADDGROW_Request=[{ministerId:"string"},{type:"int8"}],t.WC_CARD_ADDGROW_Response=[{type:"int8"},{value:"int32"}],t.CW_CARD_UPLVLIMIT_Request=[{ministerId:"string"}],t.WC_CARD_UPLVLIMIT_Response=[],t.CW_CARD_DISPATCH_Request=[{ministerId:"string"},{type:"int8"}],t.WC_CARD_DISPATCH_Response=[],t.CW_DISPATCH_CARD_REQUEST=[{timeId:"int16"}],t.WC_DISPATCH_CARD_RESPONSE=[{value:"int32"},{doubleFlag:"bool"}],t.CW_IMPOSE_Request=[{type:"int8"}],t.WC_IMPOSE_Response=[{type:"int8"},{value:"int32"}],t.CW_READ_APPLY_Request=[{id:"int32"},{access:"bool"}],t.WC_READ_APPLY_Response=[],t.WC_INIT_OFFICER_NOTIFY=[{positions:"repeated",def:[{id:"int8"},{ministerId:"string"}]}],t.CW_DESIGNATE_OFFICER_Request=[{id:"int8"},{ministerId:"string"}],t.WC_DESIGNATE_OFFICER_Response=[{id:"int8"},{ministerId:"string"}],t.CW_REVOKE_OFFICER_Request=[{id:"int8"}],t.WC_REVOKE_OFFICER_Response=[{id:"int8"}],t.CW_ADD_CARD_OFFICALRANK_REQUEST=[{ministerId:"string"}],t.WC_ADD_CARD_OFFICALRANK_RESPONSE=[],t.CW_BATTLE_INFO_Request=[],t.WC_BATTLE_INFO_Response=[{strongholdId:"int32"},{troops:"int64"},{hp:"int32"},{attack:"int32"},{critical:"int32"}],t.CW_BATTLE_SETSTORY_REQUEST=[{countryId:"int32"}],t.WC_BATTLE_SETSTORY_Response=[{result:"int32"}],t.CW_BATTLE_COMBAT_Request=[{stronghold:"int32"},{generals:"repeated",def:"string"}],t.WC_BATTLE_COMBAT_Response=[{data:"repeated",def:[{troops:"int32"}]}],t.CW_BATTLE_COMBAT_EX_REQUEST=[{countryId:"int32"},{generals:"repeated",def:"string"}],t.PRINCESS=[{id:"string"},{metaId:"int32"},{luck:"int32"},{luck_timestamp:"int32"},{luck_count:"int32"},{charm:"int32"},{rite:"int32"},{culture:"int32"},{battle:"int32"},{position:"int32"},{skill_ids:"repeated",def:"int32"},{son_count:"int8"}],t.WC_INIT_PRINCESS_NOTIFY=[{princesses:"repeated",def:t.PRINCESS}],t.WC_UPDATE_PRINCESS_NOTIFY=t.PRINCESS.concat(),t.CW_SUPPORT_PRINCESS_Request=[{princessId:"string"}],t.WC_SUPPORT_PRINCESS_Response=[],t.CW_AWARD_PRINCESS_Request=[{princessId:"string"},{itemId:"int32"}],t.WC_AWARD_PRINCESS_Response=[],t.CW_BESTOWED_PRINCESS_Request=[{princessId:"string"},{position:"int8"}],t.WC_BESTOWED_PRINCESS_Response=[{curPosition:"int8"},{prvPosition:"int8"},{princessId:"string"}],t.CW_TURNCARD_PRINCESS_Request=[],t.WC_TURNCARD_PRINCESS_Response=[{id:"string"}],t.CW_CHOOSE_PRINCESS_Request=[{type:"int8"}],t.WC_CHOOSE_PRINCESS_Response=[],t.CW_LEARNRITE_PRINCESS_Request=[{ministerId:"string"},{princessId:"string"},{pos:"int8"}],t.WC_LEARNRITE_PRINCESS_Response=[],t.CW_ADDMAXSLOT_PRINCESS_Request=[{type:"int8"}],t.WC_ADDMAXSLOT_PRINCESS_Response=[{type:"int8"}],t.CW_FINISH_PRINCESS_Request=[{type:"int8"},{slot:"int8"}],t.WC_FINISH_PRINCESS_Response=[{type:"int8"},{preValue:"int32"},{aftValue:"int32"}],t.CW_DISPATCH_PRINCESS_Request=[{id:"string"},{type:"int8"}],t.WC_DISPATCH_PRINCESS_Response=[],t.CW_PLANTFLOWER_PRINCESS_Request=[{id:"string"},{flowerId:"int32"},{pos:"int8"}],t.WC_PLANTFLOWER_PRINCESS_Response=[],t.ARENA_MINISTER=[{metaId:"int32"},{level:"int16"},{politics:"int32"},{knowledge:"int32"},{command:"int32"},{hp:"int32"},{hpMax:"int32"},{all:"int32"},{attack:"int32"},{battleValue:"int32"},{politics_base:"int32"},{knowledge_base:"int32"},{command_base:"int32"},{hp_base:"int32"},{battleValue_base:"int32"}],t.CW_OPEN_PVE_REQUEST=[{type:"int8"}],t.WC_OPEN_PVE_RESPONSE=[{status:"int8"},{type:"int8"},{total:"int8"},{current:"int8"},{buffer_ids:"repeated",def:"int8"},{buffer_status:"repeated",def:"int8"},{sites:"repeated",def:[{accountName:"string"},{score:"int32"},{minister:t.ARENA_MINISTER}]}],t.CW_PVE_READY_REQUEST=[{type:"int8"}],t.WC_PVE_READY_RESPONSE=[],t.CW_PVE_BEGIN_REQUEST=[{type:"int8"}],t.WC_PVE_BEGIN_RESPONSE=[],t.CW_PVE_BATTLE_REQUEST=[{action:"int8"},{type:"int8"}],t.WC_PVE_BATTLE_RESPONSE=[],t.WC_UPDATE_PVE_NOTIFY=[{sites:"repeated",def:[{hp:"int32"},{all:"int32"},{action:"int8"}]}],t.WC_END_PVE_NOTIFY=[{score:"int32"},{winCount:"int32"},{exploit:"int32"},{finished:"int8"}],t.WC_PVP_WIN3_NOTIFY=[{itemId:"int32"},{itemCount:"int32"}],t.ARENA_HISTORY_ITEM=[{playerId:"int32"},{playerName:"string"},{type:"int8"},{beatCount:"int8"},{score:"int32"},{scoreChange:"int32"},{nationalPower:"int32"},{timestamp:"int32"}],t.WC_INIT_PVEQUE_NOTIFY=[{history:"repeated",def:t.ARENA_HISTORY_ITEM}],t.WC_UPDATE_PVEQUE_NOTIFY=[{history:"repeated",def:t.ARENA_HISTORY_ITEM}],t.WC_DELETE_PVEQUE_NOTIFY=[{playerId:"int32"}],t.GLOBAL_ARENA_HISTORY_ITEM=[{winnerName:"string"},{winnerId:"int32"},{timestamp:"int32"},{beatCount:"int32"},{loserName:"string"}],t.CW_OPENTOPPVEWIN_REQUEST=[],t.WC_OPENTOPPVEWIN_RESPONSE=[{list:"repeated",def:t.GLOBAL_ARENA_HISTORY_ITEM}],t.CW_PVE_AVENGE_REQUEST=[{ministerId:"string"},{playerId:"int32"},{type:"int8"}],t.WC_PVE_AVENGE_RESPONSE=[{type:"int8"}],t.ARENA_RANKING_ITEM=[{name:"string"},{num:"int32"},{score:"int32"}],t.CW_OPENTOPPVE_REQUEST=[],t.WC_OPENTOPPVE_RESPONSE=[{self:"repeated",ignoreSize:!0,def:t.ARENA_RANKING_ITEM},{list:"repeated",ignoreSize:!0,def:t.ARENA_RANKING_ITEM}],t.CW_PVE_ADDBUFF_REQUEST=[{id:"int8"},{type:"int8"}],t.WC_PVE_ADDBUFF_RESPONSE=[{id:"int8"},{sites:"repeated",def:t.ARENA_MINISTER}],t.CW_PVE_END_REQUEST=[{type:"int8"}],t.WC_PVE_END_RESPONSE=[],t.CW_ITEM_USEBATTLECARD_REQUEST=[{id:"string"},{count:"int32"}],t.WC_ITEM_USEBATTLECARD_RESPONSE=[],t.CW_PVE_SETJUMPBATTLE_REQUEST=[{jumpBattle:"int8"},{type:"int8"}],t.WC_PVE_SETJUMPBATTLE_RESPONSE=[],t.TECHNOLOGY=[{id:"int32"},{level:"int32"}],t.WC_INIT_TECHNOLOGY_NOTIFY=[{technology:"repeated",def:t.TECHNOLOGY}],t.WC_UPDATE_TECHNOLOGYNOTIFY=t.TECHNOLOGY.concat(),t.CW_TECHNOLOGY_LEVELUP_REQUEST=[{id:"int32"},{ministerId:"string"}],t.WC_TECHNOLOGY_LEVELUP_RESPONSE=[],t.PRINCE=[{id:"string"},{princessId:"string"},{ministerId:"string"},{name:"string"},{quality:"int8"},{level:"int32"},{exp:"int32"},{politics:"int32"},{knowledge:"int32"},{command:"int32"},{openTime:"int32"},{peerage:"int8"},{activity:"int8"},{openFlag:"int8"},{timestamp:"int32"}],t.WC_INIT_PRINCE_NOTIFY=[{princes:"repeated",def:t.PRINCE}],t.WC_UPDATE_PRINCE_NOTIFY=t.PRINCE.concat(),t.CW_PRICESS_ADDACTIVITY_REQUEST=[{princeId:"string"},{itemId:"int32"}],t.WC_PRICESS_ADDACTIVITY_RESPONSE=[],t.CW_PRICESS_TRAIN_REQUEST=[{ministerId:"string"},{princeId:"string"}],t.WC_PRICESS_TRAIN_RESPONSE=[],t.CW_PRICESS_RENAME_REQUEST=[{princeId:"string"},{name:"string"}],t.WC_PRICESS_RENAME_RESPONSE=[],t.CW_PRICESS_OPENHOURSE_REQUEST=[{princeId:"string"},{type:"int8"}],t.WC_PRICESS_OPENHOURSE_RESPONSE=[],t.CW_PRICESS_AWARDITEM_REQUEST=[{princeId:"string"}],t.WC_PRICESS_AWARDITEM_RESPONSE=[{items:"repeated",def:[{id:"int32"},{count:"int32"}]}],t.CW_PRICESS_DELETE_REQUEST=[{princeId:"string"}],t.WC_PRICESS_DELETE_RESPONSE=[],t.CW_PRICESS_ADDMAXSLOT_REQUEST=[],t.WC_PRICESS_ADDMAXSLOT_RESPONSE=[],t.EMAIL=[{id:"int32"},{timestamp:"int32"},{senderId:"int32"},{isRead:"bool"},{senderName:"string"},{receiverName:"string"},{title:"string"}],t.CW_MailListRequest=[],t.WC_MailListResponse=[{emails:"repeated",def:t.EMAIL}],t.CW_ReadMailRequest=[{id:"int32"}],t.WC_ReadMailResponse=[{id:"int32"},{timestamp:"int32"},{senderId:"int32"},{isRead:"bool"},{senderName:"string"},{receiverName:"string"},{title:"string"},{items:"repeated",def:[{id:"int32"},{count:"int16"}]},{content:"string"}],t.CW_GetMailItemRequest=[{id:"int32"}],t.WC_GetMailItemsResponse=[{items:"repeated",def:[{id:"int32"},{count:"int16"}]},{id:"int32"}],t.WC_DeleteMailResponse=[{id:"int32"}],t.WC_MailRecvResponse=[{id:"int32"},{timestamp:"int32"},{senderId:"int32"},{isRead:"bool"},{senderName:"string"},{receiverName:"string"},{title:"string"}],t.CW_ITEM_BUY_REQUEST=[{shopId:"int8"},{count:"int8"}],t.WC_ITEM_BUY_RESPONSE=[],t.CITY=[{id:"int16"},{level:"int8"},{likeValue:"int16"},{developFlag:"int8"}],t.WC_INIT_CITY_NOTIFY=[{cities:"repeated",def:t.CITY}],t.WC_UPDATE_CITY_NOTIFY=t.CITY.concat(),t.CW_ROLLDICE_REQUEST=[],t.WC_ROLLDICE_RESPONSE=[],t.CW_ROLLFIXEDDICE_REQUEST=[{value:"int8"}],t.WC_ROLLFIXEDDICE_RESPONSE=[],t.CW_DEVELOPCITY_REQUEST=[{type:"int8"}],t.WC_DEVELOPCITY_RESPONSE=[],t.CW_INSPECT_REQUEST=[],t.WC_INSPECT_RESPONSE=[{eventId:"int32"}],t.CW_INSPECT_AORB_REQUEST=[{itemId:"int32"}],t.WC_INSPECT_AORB_RESPONSE=[{itemId:"int32"},{itemCount:"int32"}],t.CW_DIG_REQUEST=[{index:"int32"}],t.WC_DIG_RESPONSE=[{itemId:"int32"},{itemCount:"int32"}],t.TASK=[{id:"int32"},{value:"int32"},{flag:"int32"}],t.WC_INIT_TASK_NOTIFY=[{tasks:"repeated",def:t.TASK}],t.WC_UPDATE_TASK_NOTIFY=t.TASK.concat(),t.CW_FINISHTIME_REQUEST=[{id:"int32"}],t.WC_FINISHTIME_RESPONSE=[],t.CHAT_MESSAGE=[{sender:"int32"},{receiver:"int32"},{senderLineId:"int32"},{type:"int8"},{senderName:"string"},{receiverName:"string"},{content:"string"},{privilegeType:"int8"}],t.CLIENT_CHAT_SendMessageRequest=t.CHAT_MESSAGE.concat(),t.CLIENT_CHAT_SendMessageResponse_Notify=[],t.SERVER_CHAT_SendMessage_NOTIFY=t.CHAT_MESSAGE.concat(),t.CW_SETFACE_REQUEST=[{id:"int32"}],t.WC_SETFACE_RESPONSE=[],t.WC_DINNERINFO_Notify=[{id:"int32"},{state:"int8"},{round:"int8"},{type:"int8"},{startTime:"int32"},{players:"repeated",def:[{id:"int32"},{name:"string"},{princessId:"int32"},{type:"int8"},{sumScore:"int32"},{info:[{rite:"int32"},{culture:"int32"},{battle:"int32"},{charm:"int32"}]}]},{roundInfo:"repeated",def:[{info:"repeated",def:[{princessSkill:"int8"},{score:"int32"}]}]}],t.CW_JOIN_DINNER_REQUEST=[{type:"int32"},{princessId:"string"}],t.WC_JOIN_DINNER_RESPONSE=[],t.CW_OPEN_DINNER_REQUEST=[{playerId:"int32"}],t.CW_BUY_RANDOMSHOP_REQUEST=[{index:"int8"}],t.WC_BUY_RANDOMSHOP_RESPONSE=[],t.CW_OPEN_RANDOMSHOP_REQUEST=[],t.WC_OPEN_RANDOMSHOP_RESPONSE=[],t.CW_REFLASH_RANDOMSHOP_REQUEST=[],t.WC_REFLASH_RANDOMSHOP_RESPONSE=[],t.CW_DRAWITEM_REQUEST=[{type:"int8"}],t.WC_DRAWITEM_RESPONSE=[{rewards:"repeated",def:[{id:"int32"},{count:"int32"}]}],t.RANKING_ITEM=[{name:"string"},{num:"int32"},{score:"int32"},{flag1:"int32"},{flag2:"int32"},{unionName:"string"}],t.CW_OPENTOP_REQUEST=[{type:"int16"}],t.WC_OPENTOP_RESPONSE=[{self:"repeated",ignoreSize:!0,def:t.ARENA_RANKING_ITEM},{rankList:"repeated",def:t.RANKING_ITEM}],t.CW_UPTOP_REQUEST=[{type:"int8"}],t.WC_UPTOP_RESPONSE=[{icon:"int32"},{name:"string"}],t.ACTIVITY_ITEM=[{type:"int32"},{begin_time:"int32"},{end_time:"int32"}],t.ACTIVITY_DETAILS=[{id:"int32"},{type:"int32"},{name:"string"},{desc:"string"},{begin_time:"int32"},{end_time:"int32"},{ids:"repeated",def:[{id:"int32"}]},{counts:"repeated",def:[{count:"int32"}]},{"extends":"repeated",def:[{extend:"int32"}]}],t.WC_INIT_ACTIVITY_NOTIFY=[{activityList:"repeated",def:t.ACTIVITY_ITEM}],t.CW_ACTIVITY_Request=[{type:"int8"}],t.WC_ACTIVITY_Response=[{activityList:"repeated",def:t.ACTIVITY_DETAILS}],t.CW_DATANGUAN_Request=[{type:"int8"},{value:"int8"},{count:"int8"}],t.WC_DATANGUAN_Response=[],t.CW_SETPLAYERFLAG_REQUEST=[{guideIndex:"int8"}],t.WC_SETPLAYERFLAG_RESPONSE=[{guideIndex:"int8"}],t.UNION_INFO=[{id:"int32"},{level:"int8"},{exp:"int32"},{techPoint:"int32"},{name:"string"},{qqGroup:"string"},{msg:"string"},{memo:"string"},{leaderId:"int32"},{autoAcceptJoin:"bool"},{transferTime:"int32"},{fightValue:"int32"},{playerNum:"int32"},{maxPlayerNum:"int32"},{maxEliteNum:"int32"},{bossCount:"int8"},{bossTimes:"int32"}],t.UNION_SIMPLE=[{id:"int32"},{level:"int32"},{name:"string"},{leaderName:"string"},{leaderId:"int32"},{fightValue:"int32"},{playerNum:"int16"},{maxPlayerNum:"int16"},{autoAcceptJoin:"bool"},{memo:"string"}],t.UNION_MEMBER=[{id:"int32"},{name:"string"},{contribute:"int32"},{giftExp:"int32"},{position:"int32"},{status:"int32"},{battleValue:"int32"},{vip:"int32"},{icon:"int32"},{leaveTime:"int32"},{offlineTime:"int32"}],t.UNION_TECH=[{id:"int32"},{level:"int16"}],t.UNION_APPLY=[{id:"int32"},{name:"string"},{fightValue:"int32"},{applyTime:"int32"},{vip:"int32"},{icon:"int32"},{onlineState:"int8"}],t.UNION_LOG=[{time:"int32"},{sourceName:"string"},{targetName:"string"},{optType:"int32"},{val1:"int32"},{val2:"int8"}],t.UNION_GIFT=[{id:"string"},{metaId:"int32"},{playerName:"string"}],t.WC_ORG_INIT_NOTIFY=[{info:t.UNION_INFO},{members:"repeated",def:t.UNION_MEMBER},{techs:"repeated",def:t.UNION_TECH},{applyPlayers:"repeated",def:t.UNION_APPLY},{logs:"repeated",def:t.UNION_LOG},{gifts:"repeated",def:t.UNION_GIFT}],t.WC_UPDATE_ORG_MEMBER_NOTIFY=[{member:t.UNION_MEMBER}],t.WC_UPDATE_ORG_SKILL_NOTIFY=[{tech:t.UNION_TECH}],t.WC_UPDATE_ORG_APPLY_NOTIFY=[{applyPlayer:t.UNION_APPLY}],t.WC_UPDATE_ORG_LOG_NOTIFY=[{log:t.UNION_LOG}],t.WC_UPDATE_ORG_NOTIFY=[{info:t.UNION_INFO}],t.WC_UPDATE_ORG_GIFT_NOTIFY=[{gift:t.UNION_GIFT}],t.WC_DELETE_ORG_APPLY_NOTIFY=[{id:"int32"}],t.WC_DELETE_ORG_MEMBER_NOTIFY=[{id:"int32"}],t.CW_CreateOrg_Request=[{name:"string"},{qq:"string"},{memo:"string"},{isAutoJoin:"bool"}],t.WC_CreateOrg_Response=[],t.CW_ApplyOrg_Request=[{id:"int32"}],t.WC_ApplyOrg_Response=[],t.CW_JoinOrg_Request=[{id:"int32"},{playerId:"int32"},{optType:"bool"}],t.WC_JoinOrg_Response=[],t.CW_LeaveOrg_Request=[{id:"int32"}],t.WC_LeaveOrg_Response=[],t.CW_FireMemberOrg_Request=[{id:"int32"},{playerId:"int32"}],t.WC_FireMemberOrg_Response=[],t.CW_DonateOrg_Request=[{id:"int32"},{type:"int8"}],t.WC_DonateOrg_Response=[],t.CW_SetOrgMasterLevel_Request=[{id:"int32"},{playerId:"int32"},{position:"int8"}],t.WC_SetOrgMasterLevel_Response=[],t.CW_TransferOrgMaster_Request=[{id:"int32"},{playerId:"int32"}],t.WC_TransferOrgMaster_Response=[],t.CW_LeaveUpSkill_Request=[{id:"int32"},{techId:"int32"}],t.WC_LeaveUpSkill_Response=[],t.CW_DisbandOrg_Request=[{id:"int32"}],t.WC_DisbandOrg_Response=[],t.CW_SearchOrg_Request=[],t.WC_SearchOrg_Response=[{unions:"repeated",def:t.UNION_SIMPLE}],t.CW_SearchTopOrg_Request=[],t.WC_SearchOrgTop_Response=[{unions:"repeated",def:t.UNION_SIMPLE}],t.CW_BuyOrgItem_Request=[{id:"int32"},{shopId:"int32"},{count:"int32"}],t.WC_BuyOrgItem_Response=[],t.CW_BuyOrgGift_Request=[{id:"int32"}],t.WC_BuyOrgGift_Response=[],t.CW_SearchOrgSimple_Request=[{key:"string"}],t.WC_SearchOrgSimple_Response=[{union:t.UNION_SIMPLE}],t.CW_ChangeOrg_Request=[{id:"int32"},{qq:"string"},{memo:"string"},{msg:"string"},{autoAcceptJoin:"int8"}],t.WC_ChangeOrg_Response=[],t.CW_GetOrgGift_Request=[{unionId:"int32"},{giftId:"string"}],t.WC_GetOrgGift_Response=[{giftId:"string"}],t.CW_Boss_OpenOrg_Request=[{unionId:"int32"},{bossId:"int32"}],t.WC_Boss_OpenOrg_Response=[],t.CW_Boss_BuyBuff_Request=[{bossId:"int32"},{type:"int32"}],t.WC_Boss_BuyBuff_Response=[],t.CW_BossInfo_Request=[{unionId:"int32"}],t.WC_BossInfo_Response=[{id:"int32"},{fightStatus:"bool"},{buffer1Time:"int32"},{buffer2Time:"int32"},{boss:"repeated",def:[{type:"int32"},{endTime:"int32"},{hp:"int64"}]},{ranks:"repeated",def:[{name:"string"},{unionName:"string"},{hp:"int64"}]},{ministers:"repeated",def:[{id:"string"}]},{rounds:"repeated",def:[{pos:"int32"},{roundTime:"int32"}]}],t.CW_Boss_Battle_Request=[{bossId:"int32"},{ministerId1:"string"},{ministerId2:"string"},{ministerId3:"string"}],t.WC_Boss_Battle_Response=[],t.CW_Boss_Select_Request=[{bossId:"int32"},{ministerId1:"string"},{ministerId2:"string"},{ministerId3:"string"}],t.WC_Boss_Select_Response=[],t.WC_Boss_RandomSelect_NOTIFY=[{ministers:"repeated",def:[{id:"string"}]}],t.CW_Boss_BuyCD_Request=[{bossId:"int32"}],t.WC_Boss_BuyCd_Response=[],t.CW_VIP_GIFT_REQUEST=[{giftId:"int32"}],t.WC_VIP_GIFT_RESPONSE=[],t.CW_RECHARGE_FIRST_ITEM_REQUEST=[],t.WC_RECHARGE_FIRST_ITEM_RESPONSE=[],t.CW_BURNINCENSE_REQUEST=[{id:"string"}],t.WC_BURNINCENSE_RESPONSE=[{id:"int32"},{count:"int32"}],t.CW_INCENSEDRAWREWARD_REQUEST=[{level:"int32"}],t.WC_INCENSEDRAWREWARD_RESPONSE=[],t.WC_INCENSESCORE_MSG_NOTIFY=[{score:"int32"}],t.CW_BURNEXCHANGE_REQUEST=[{seq:"int32"},{count:"int32"}],t.WC_BURNEXCHANGE_RESPONSE=[],t
}();__reflect(ProtocolConfigs.prototype,"ProtocolConfigs");var protocols=ProtocolConfigs;protocols.init();var ActivityService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activityList=[],e.tabBarList=[{index:0,typeList:[7,8,9,10],label:"",seq:2},{index:1,typeList:[36,37],label:"",seq:3},{index:2,typeList:[0,34],label:"",seq:1,badgeId:"21111,21112,21113,21114,21115,21116,21120"},{index:3,typeList:[],label:"",seq:4}],e.prisonScoreActivityTimeId=500,e.prisonCDActivityTimeId=501,e.preferentialActTimeIds=[502,503,504,505],e.sumChargeActTimeId=534,e.limitActTypeList=[15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33],e.firstChargeActTimeId=841,e.incenseActTimeId=843,e.incenseScore=0,e.incenseConfig=[{level:1,scoreMin:1,scoreMax:1e3,reward:[]},{level:2,scoreMin:1001,scoreMax:2e3,reward:[{id:600002,count:5},{id:600003,count:3},{id:600114,count:3}]},{level:3,scoreMin:2001,scoreMax:5e3,reward:[{id:600003,count:10},{id:600004,count:10},{id:600114,count:6}]},{level:4,scoreMin:5001,scoreMax:1e4,reward:[{id:600003,count:15},{id:600004,count:15},{id:600114,count:10}]},{level:5,scoreMin:10001,scoreMax:2e4,reward:[{id:600003,count:20},{id:600004,count:20},{id:600115,count:5}]},{level:6,scoreMin:20001,scoreMax:3e4,reward:[{id:600003,count:25},{id:600004,count:25},{id:600115,count:10}]},{level:7,scoreMin:30001,scoreMax:5e4,reward:[{id:600003,count:30},{id:600004,count:30},{id:600115,count:15}]},{level:8,scoreMin:50001,scoreMax:1e5,reward:[{id:600003,count:35},{id:600004,count:35},{id:600116,count:5}]},{level:9,scoreMin:100001,scoreMax:1e9,reward:[{id:600003,count:40},{id:600004,count:40},{id:600116,count:10}]}],e}return __extends(e,t),e.prototype.init=function(){this.iconList=GameConfig.lobby_top_bar,this.registerEvent(gameServer,ProtocolConfigs.WC_INIT_ACTIVITY_NOTIFY,this.onInitActivityNotify,this),this.registerEvent(gameServer,ProtocolConfigs.WC_ACTIVITY_Response,this.onActivityResponse,this),this.registerEvent(gameServer,ProtocolConfigs.WC_DATANGUAN_Response,this.onBeatWomanResponse,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(gameServer,ProtocolConfigs.WC_BURNINCENSE_RESPONSE,this.onBurnIncenseResponse,this),this.registerEvent(gameServer,ProtocolConfigs.WC_INCENSESCORE_MSG_NOTIFY,this.onIncenseScoreNotify,this),this.registerEvent(gameServer,ProtocolConfigs.WC_INCENSEDRAWREWARD_RESPONSE,this.onIncensedRawRewardResponse,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.activityList.splice(0)})},e.prototype.onInitActivityNotify=function(t){var e=this;this.initActivityList(),t.data.activityList.forEach(function(t){return e.add(t)})},e.prototype.onActivityResponse=function(t){var e=this;t.data.error>0||(t.data.activityList.forEach(function(t){e.updateActivity(t)||e.add(t)}),this.dispatchEventWith(EventNames.UPDATE_ACTIVITY,!1,null))},e.prototype.addActivity=function(t){this.add(t),this.dispatchEventWith(EventNames.UPDATE_ACTIVITY,!1,null)},e.prototype.onBeatWomanResponse=function(t){},e.prototype.onActivityTimeChange=function(t){"init"!=t.data.type&&t.data.activityTime.id==this.prisonScoreActivityTimeId?this.dispatchEventWith(EventNames.UPDATE_PRISON):"init"!=t.data.type&&t.data.activityTime.id==this.prisonCDActivityTimeId?this.dispatchEventWith(EventNames.UPDATE_PRISON):"init"!=t.data.type&&this.preferentialActTimeIds.indexOf(t.data.activityTime.id)>=0?this.dispatchEventWith(EventNames.UPDATE_PREFERENTIAL):"init"!=t.data.type&&t.data.activityTime.id==this.sumChargeActTimeId?this.dispatchEventWith(EventNames.UPDATE_SUM_CHARGE):"init"!=t.data.type&&t.data.activityTime.id==this.firstChargeActTimeId?this.dispatchEventWith(EventNames.UPDATE_FIRST_CHARGE):"init"!=t.data.type&&t.data.activityTime.id==this.incenseActTimeId&&this.dispatchEventWith(EventNames.UPDATE_INCENSE_SCORE_NOTIFY)},e.prototype.updateActivity=function(t){var e=!1;return this.activityList.some(function(i){return!i.id&&i.type==t.type||i.id==t.id?(i.inject(t),e=!0,!0):void 0}),e},e.prototype.onBurnIncenseResponse=function(t){},e.prototype.onIncenseScoreNotify=function(t){var e=t.data,i=e.error,n=e.score;0==i&&(this.incenseScore=n,this.dispatchEventWith(EventNames.UPDATE_INCENSE_SCORE_NOTIFY))},e.prototype.onIncensedRawRewardResponse=function(t){},e.prototype.add=function(t){var e=new ActivityEntity;return e.inject(t),this.activityList.push(e),e},e.prototype.getActivityByType=function(t){var e;return this.activityList.some(function(i){return i.type==t&&(mainService.tsServer>=i.begin_time&&mainService.tsServer<=i.end_time||-1==i.begin_time&&-1==i.end_time)?(e=i,!0):void 0}),e},e.prototype.getById=function(t){var e=null;this.activityList.some(function(i){return i.id==t&&(mainService.tsServer>=i.begin_time&&mainService.tsServer<=i.end_time||-1==i.begin_time&&-1==i.end_time)?(e=i,!0):void 0})},e.prototype.getActivityByTypeList=function(t){var e=this,i=[];return t.forEach(function(t){var n=e.getActivityByType(t);n&&i.push(n)}),i},e.prototype.updateBadge=function(){this.activityList.forEach(function(t){if(t.type>=ActivityEntity.ACTIVITY.TYPE_CHARGE_6&&t.type<=ActivityEntity.ACTIVITY.TYPE_SUM_CHARGE){var e=ActivityEntity.getActivityConfigByType(t.type);e&&e.badgeId&&alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:e.badgeId,count:emailService.getEmailsBySenderId(t.type).length})}})},e.prototype.deleteActListByType=function(t){for(var e=0;e<this.activityList.length;++e)this.activityList[e].type==t&&(this.activityList.splice(e,1),e--)},e.prototype.getActivityListByType=function(t){var e=[];return this.activityList.forEach(function(i){i.type==t&&i.id&&mainService.tsServer>=i.begin_time&&mainService.tsServer<=i.end_time&&e.push(i)}),e.sort(function(t,e){return t.reward["extends"][0]&e.reward["extends"][0]?t.reward["extends"][0].extend-e.reward["extends"][0].extend:e.id-t.id})},e.prototype.getTabBarList=function(){var t=this,e=[];return this.tabBarList.forEach(function(i){var n=[];2==i.index?(n=t.getActivityByTypeList(i.typeList.concat([1,2,3,4,5])),n.some(function(t){return[0,1,2,3,4,5].indexOf(t.type)>=0?(i.typeList[0]=t.type,!0):void 0})):n=t.getActivityByTypeList(i.typeList),n.length>0&&(i.label=lang.activity_tabBar_name[i.index],e.push(i))}),e.sort(function(t,e){return t.seq-e.seq})},e.prototype.initActivityList=function(){this.activityList.splice(0);for(var t=ActivityEntity.ACTIVITY.TYPE_PRIVATE_TEST;t<=ActivityEntity.ACTIVITY.TYPE_BUG;++t){var e=new ActivityEntity;e.inject({type:t,begin_time:-1,end_time:-1,name:lang.activity_test_content[t].title,desc:lang.activity_test_content[t].content}),this.activityList.push(e)}},e.prototype.getNowResource=function(){var t=0,e=activityTimeService.getById(this.prisonScoreActivityTimeId);return e&&(t=e["int"]),t},e.prototype.getSumResource=function(){var t=0,e=this.getActivityByType(6);return e&&e["extends"][0]&&(t=e["extends"][0].extend),t},e.prototype.getSingleResource=function(){var t=0,e=this.getActivityByType(6);return e&&e["extends"][1]&&(t=e["extends"][1].extend),t},e.prototype.getResourceId=function(){var t=0,e=this.getActivityByType(6);return e&&e["extends"][2]&&(t=e["extends"][2].extend),t},e.prototype.getEndTime=function(){var t=0,e=activityTimeService.getById(this.prisonCDActivityTimeId);return e&&(t=e.timestamp),t},e.prototype.getUseTime=function(){var t=0,e=activityTimeService.getById(this.prisonCDActivityTimeId);return e&&(t=e.timestamp-1800),t},e.prototype.getPrisonType=function(){var t=0,e=this.getEndTime(),i=this.getUseTime();return i-mainService.tsServer>0?t=1:e-mainService.tsServer>0&&(t=0),t},e.prototype.getIconList=function(){var t=this,e=[];return this.iconList.forEach(function(i){switch(i.name){case"rank":openService.getOpenStatus({name:OpenService.OpenNames.RANK,showTip:!1})&&(i.label=lang.lobby_icon_name[i.name],e.push(i));break;case"boss":i.label=lang.lobby_icon_name[i.name],e.push(i);break;case"firstCharge":var n=activityTimeService.getById(t.firstChargeActTimeId);n&&0!=n["int"]||(i.label=lang.lobby_icon_name[i.name],e.push(i));break;default:t.getActivityByTypeList(i.activityTypeList).length>0&&(i.label=lang.lobby_icon_name[i.name],e.push(i))}}),e},e.prototype.getMinActEndTime=function(){var t=0;return this.activityList.forEach(function(e){GameConfig.lobby_top_bar.forEach(function(i){var n=i.activityTypeList;n.indexOf(e.type)>=0&&e.end_time>mainService.tsServer&&(0==t||e.end_time<t)&&(t=e.end_time)})}),t},e.prototype.getPreferentialState=function(t){var e=0,i=[];switch(t){case ActivityEntity.ACTIVITY.TYPE_CHARGE_8:case ActivityEntity.ACTIVITY.TYPE_CHARGE_12:i=[502,503];break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_88:case ActivityEntity.ACTIVITY.TYPE_CHARGE_128:i=[504,505]}var n=activityTimeService.getActivityTimesByIds(i);return n.length>0&&(e=1),e},e.prototype.getActTime=function(t){var e=t-mainService.tsServer;return 0>=e?lang.formatHtml(lang.activity_interval_time[0]):60>e?lang.formatHtml(lang.activity_interval_time[1],e):3600>e?lang.formatHtml(lang.activity_interval_time[2],Math.floor(e/60)):86400>e?lang.formatHtml(lang.activity_interval_time[3],Math.floor(e/60/60)):lang.formatHtml(lang.activity_interval_time[4],Math.floor(e/60/60/24))},e.prototype.getLimitActProgressType=function(t){var e="0",i=ActivityEntity.getActivityConfigByType(t);if(i.activityTimeId){var n=activityTimeService.getById(i.activityTimeId);n&&(e=n.str)}return e},e.prototype.getIncenseConfigByLevel=function(t){var e=null;return this.incenseConfig.some(function(i){return i.level==t?(e=i,!0):void 0}),e},e.prototype.getIncenseLevel=function(){var t=this,e=0;return this.incenseConfig.some(function(i){return t.incenseScore<=i.scoreMax&&t.incenseScore>=i.scoreMin?(e=i.level,!0):void 0}),e},e.prototype.getIncenseState=function(t){var e=0;if(1>=t)return 0;var i=activityTimeService.getById(this.incenseActTimeId),n=this.getIncenseConfigByLevel(t),r=activityService.incenseScore;if(!i&&r>=n.scoreMin)return 1;if(!i&&r<n.scoreMin)return 0;var o=i["int"]>>t-2&1;return 0==o&&r>=n.scoreMin?e=1:0==o&&r<n.scoreMin?e=0:1==o&&(e=2),e},e.prototype.getActivity=function(t){gameServer.send(protocols.CW_ACTIVITY_Request,{type:t},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.beatWoman=function(t,e,i){gameServer.send(protocols.CW_DATANGUAN_Request,{type:t,value:e,count:i},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.burnIncense=function(t){gameServer.send(protocols.CW_BURNINCENSE_REQUEST,{id:t},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.getIncenseReward=function(t){gameServer.send(protocols.CW_INCENSEDRAWREWARD_REQUEST,{level:t},Server.SERVER_TYPE.WORLDSERVER)},e}(Service);__reflect(ActivityService.prototype,"ActivityService");var ActivityTimeService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activityTimes=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_INIT_TIME_NOTIFY,this.onInitTimeNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_TIME_NOTIFY,this.onUpdateTimeNotify,this),this.registerEvent(gameServer,protocols.WC_ADVANCETIME_Response,this.onAdvanceTimeResponse,this),this.registerEvent(gameServer,ProtocolConfigs.WC_ITEM_USEACCCARD_RESPONSE,this.onItemUseAcCardResponse,this)},e.prototype.onInitTimeNotify=function(t){var e=this;this.activityTimes.splice(0),t.data.time.forEach(function(t){return e.add(t)}),this.dispatchEventWith(EventNames.ACTIVITY_TIME_CHANGE,!1,{type:"init"})},e.prototype.onUpdateTimeNotify=function(t){var e,i=t.data;i.timestamp<0?(e=this.remove(i),e&&this.dispatchEventWith(EventNames.ACTIVITY_TIME_CHANGE,!1,{type:"remove",activityTime:e})):(e=this.getById(t.data.id),e?(e.inject(t.data),this.dispatchEventWith(EventNames.ACTIVITY_TIME_CHANGE,!1,{type:"update",activityTime:e})):(e=this.add(t.data),this.dispatchEventWith(EventNames.ACTIVITY_TIME_CHANGE,!1,{type:"add",activityTime:e})))},e.prototype.onAdvanceTimeResponse=function(t){0==t.data.error&&Toast.show({text:lang.speed_success})},e.prototype.onItemUseAcCardResponse=function(t){0==t.data.error&&Toast.show({text:lang.speed_success})},e.prototype.add=function(t){var e=new ActivityTimeEntity;return e.inject(t),this.activityTimes.push(e),e},e.prototype.remove=function(t){var e=this,i=null;return this.activityTimes.some(function(n,r){return n.id==t.id?(i=e.activityTimes.splice(r,1)[0],!0):void 0}),i},e.prototype.getById=function(t){var e=null;return this.activityTimes.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getActivityTimesByIds=function(t,e){var i=this;void 0===e&&(e=!0);var n=[];return t.forEach(function(t){var r=i.getById(t);(r||!e)&&n.push(r)}),n},e.prototype.advanceTime=function(t){gameServer.send(protocols.CW_ADVANCETIME_Request,{id:t})},e.prototype.itemUseAcCard=function(t,e,i){gameServer.send(protocols.CW_ITEM_USEACCCARD_REQUEST,{itemId:t,count:e,actTimeId:i})},e}(Service);__reflect(ActivityTimeService.prototype,"ActivityTimeService");var ArenaService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actionMap=["politics","knowledge","command","all"],e.bufferMap=["politics","knowledge","command","hp","poison"],e.allValue=0,e.winCount=0,e.autoShowAddBuffer=!0,e.jumpFlag=!1,e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_INIT_PVEQUE_NOTIFY,this.onInitBattleHistoryNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PVEQUE_NOTIFY,this.onUpdateBattleHistoryNotify,this),this.registerEvent(gameServer,protocols.WC_DELETE_PVEQUE_NOTIFY,this.onDeleteBattleHistoryNotify,this),this.registerEvent(gameServer,protocols.WC_OPEN_PVE_RESPONSE,this.onBattleInfoResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_READY_RESPONSE,this.onReadyResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_BEGIN_RESPONSE,this.onBeginResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_BATTLE_RESPONSE,this.onBattleCommandResponse,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PVE_NOTIFY,this.onBattleResultNotify,this),this.registerEvent(gameServer,protocols.WC_END_PVE_NOTIFY,this.onBattleEndNotify,this),this.registerEvent(gameServer,protocols.WC_PVE_AVENGE_RESPONSE,this.onAvengeResponse,this),this.registerEvent(gameServer,protocols.WC_OPENTOPPVE_RESPONSE,this.onArenaRanking,this),this.registerEvent(gameServer,protocols.WC_PVE_ADDBUFF_RESPONSE,this.onAddBufferResponse,this),this.registerEvent(gameServer,protocols.WC_OPENTOPPVEWIN_RESPONSE,this.onGlobalHistoryResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_END_RESPONSE,this.onPveEndResponse,this),this.registerEvent(gameServer,protocols.WC_PVP_WIN3_NOTIFY,this.onWin3Notify,this),this.registerEvent(gameServer,protocols.WC_ITEM_USEBATTLECARD_RESPONSE,this.onItemBattleCardResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_SETJUMPBATTLE_RESPONSE,this.onPveSetJumpBattleResponse,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this)},e.prototype.onInitBattleHistoryNotify=function(t){this.history=t.data.history},e.prototype.onUpdateBattleHistoryNotify=function(t){},e.prototype.onDeleteBattleHistoryNotify=function(t){var e=this;this.history.some(function(i,n){return i.playerId==t.data.playerId?(e.history.splice(n,1),!0):void 0})},e.prototype.onBattleInfoResponse=function(t){if(!(t.data.error>0||4==t.data.status)){var e=t.data,i=e.type,n=e.sites,r=e.buffer_ids,o=e.buffer_status;this.battleInfo=t.data,this.type=i,this.finished=!1,this.resultData=null,this.allValue=n[0].minister.all,this.buffers=r.map(function(t,e){return{id:t,status:o[e]}}),this.win3Data=null,this.isWin=!1}},e.prototype.onReadyResponse=function(t){},e.prototype.onBeginResponse=function(t){0==t.data.error&&PanelArenaBattleInfo.instance.close()},e.prototype.onBattleCommandResponse=function(t){},e.prototype.onBattleResultNotify=function(t){var e=t.data.sites;this.allValue=e[0].all,e[0].hpOffset=e[0].hp-this.battleInfo.sites[0].minister.hp,e[1].hpOffset=e[1].hp-this.battleInfo.sites[1].minister.hp,this.battleInfo.sites[0].minister.hp=e[0].hp,this.battleInfo.sites[1].minister.hp=e[1].hp},e.prototype.onBattleEndNotify=function(t){switch(t.data.finished){case 0:this.finished=!1;break;case 1:this.finished=!0;break;case 2:this.finished=!0}this.resultData=t.data,this.isWin=t.data.score>0,this.winCount=t.data.winCount,this.finished&&(this.type=2,this.autoShowAddBuffer=!0)},e.prototype.onAvengeResponse=function(t){},e.prototype.onArenaRanking=function(t){this.rankingSelf=t.data.self.length>0?t.data.self[0]:null;var e=this.rankingList=t.data.list;e.sort(function(t,e){return t.num-e.num})},e.prototype.onAddBufferResponse=function(t){var e=t.data,i=e.id,n=e.error,r=e.sites;0==n&&(this.buffers.some(function(t){return t.id==i?(t.status=1,!0):void 0}),this.battleInfo.sites[0].minister=r[0],this.battleInfo.sites[1].minister=r[1])},e.prototype.onGlobalHistoryResponse=function(t){t.data.list.length>0&&(this.globalHistory=t.data.list.sort(function(t,e){return e.timestamp-t.timestamp}),this.globalHistory.forEach(function(t,e){t.index=e}))},e.prototype.onWin3Notify=function(t){this.win3Data=t.data},e.prototype.onPveEndResponse=function(t){},e.prototype.onItemBattleCardResponse=function(t){},e.prototype.onPveSetJumpBattleResponse=function(t){0==t.data.error&&(this.jumpFlag=!0)},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":this.updateBadge();break;case"add":case"remove":if(571!=t.data.activityTime.id&&570!=t.data.activityTime.id)break;this.updateBadge()}},e.prototype.onLoginGame=function(t){this.updateBadge()},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22500,count:this.getBadgeCount()})},e.prototype.getBadgeCount=function(){var t=0;if(!ministerService.getArenaValiable())return t;var e=activityTimeService.getById(570);if(e&&e.timestamp>mainService.tsServer)return t;var i=activityTimeService.getById(571);return i&&i["int"]&&(t=i["int"]),t},e.prototype.getHistory=function(t){var e=this.history.filter(function(e){return e.type==t});return e.forEach(function(t,e){t.index=e}),e},e.prototype.getBufferByField=function(t){var e,i=this;return this.buffers.some(function(n){if(1==n.status){var r=GameConfig.getBattleBufferMeta(n.id),o=i.bufferMap[r.icon-1];if(o==t)return e=GameConfig.getBufferMeta(r.effect),!0}}),e},e.prototype.requestBattleInfo=function(t){gameServer.send(protocols.CW_OPEN_PVE_REQUEST,{type:t})},e.prototype.readyBattle=function(){gameServer.send(protocols.CW_PVE_READY_REQUEST,{type:this.type})},e.prototype.beginBattle=function(){gameServer.send(protocols.CW_PVE_BEGIN_REQUEST,{type:this.type})},e.prototype.battleCommand=function(t){gameServer.send(protocols.CW_PVE_BATTLE_REQUEST,{action:t,type:this.type})},e.prototype.avenge=function(t,e,i){gameServer.send(protocols.CW_PVE_AVENGE_REQUEST,{ministerId:t,playerId:e})},e.prototype.getArenaRanking=function(){gameServer.send(protocols.CW_OPENTOPPVE_REQUEST)},e.prototype.addBuffer=function(t){gameServer.send(protocols.CW_PVE_ADDBUFF_REQUEST,{id:t,type:this.type})},e.prototype.requestBattleGlobalHistory=function(){gameServer.send(protocols.CW_OPENTOPPVEWIN_REQUEST)},e.prototype.pveEnd=function(){gameServer.send(protocols.CW_PVE_END_REQUEST,{type:this.type})},e.prototype.itemUseBattle=function(t,e){gameServer.send(protocols.CW_ITEM_USEBATTLECARD_REQUEST,{id:t,count:e})},e.prototype.jumpBattle=function(){gameServer.send(protocols.CW_PVE_SETJUMPBATTLE_REQUEST,{jumpBattle:1,type:this.type})},e}(Service);__reflect(ArenaService.prototype,"ArenaService");var BadgeService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.badgeData=[],e}return __extends(e,t),e.prototype.start=function(){return this.badgeData.splice(0),t.prototype.start.call(this)},e.prototype.init=function(){this.registerEvent(alien.Dispatcher,EventNames.BADGE_DATA_MODIFY,this.onModifyBadgeData,this)},e.prototype.onModifyBadgeData=function(t){var e=t.data,i=e.id,n=e.count;openService.getOpenStatusByBadgeId(i)||(n=0),this.badgeData[i]={count:n},alien.Dispatcher.dispatch(EventNames.BADGE_DATA_CHANGE,t.data)},e.prototype.getBadgeData=function(t){var e=this;return Array.isArray(t)?{count:0==t.length?0:t.reduce(function(t,i){var n=e.getBadgeData(i);return t+(n?n.count:0)},0)}:this.badgeData[t]},e}(Service);__reflect(BadgeService.prototype,"BadgeService");var BattleService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.techs=[{id:403005,level:1},{id:403007,level:1},{id:403011,level:1}],e.suppressActivityIds=[61,62,63,64,65,66,67],e.conquerActId=20,e.onDialogEnd=function(){SceneController["goto"](ConstantNames.SCENE_BATTLE,{country:battleService.country,stronghold:battleService.stronghold,type:0})},e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this),this.registerEvent(gameServer,protocols.WC_BATTLE_INFO_Response,this.onBattleInfoResponse,this),this.registerEvent(gameServer,protocols.WC_BATTLE_COMBAT_Response,this.onBattleCombatResponse,this),this.registerEvent(gameServer,protocols.WC_BATTLE_SETSTORY_Response,this.onBattleSetStoryResponse,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.country={}})},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21520,count:this.getSuppressCount()})},e.prototype.getSuppressCount=function(){var t=this.getSuppressCountries();return t.length},e.prototype.getSuppressCountries=function(){var t=activityTimeService.getActivityTimesByIds(this.suppressActivityIds),e=[];return t.forEach(function(t){var i=GameConfig.getCountryMeta(t["int"]);i&&e.push(i)}),e},e.prototype.onLoginGame=function(t){var e=this;this.generals=dataCenterService.battleGenerals,this.generals.forEach(function(t,i){ministerService.getMinisterById(t)||(e.generals[i]=null)}),dataCenterService.battleGenerals=this.generals,this.getBattleInfo()},e.prototype.onBattleInfoResponse=function(t){var e=t.data,i=e.strongholdId;e.ministers,e.equipOn;this.battleInfo=t.data,this.setStrongholdId(i),openService.updateBadge()},e.prototype.setStrongholdId=function(t){t=-1==t?activityTimeService.getById(this.conquerActId)["int"]:t,this.stronghold=GameConfig.getStrongholdMeta(t),this.country=GameConfig.getCountryMeta(this.stronghold.country_id),this.totalCount=this.country.count,this.gotCount=t%1e4,this.conquerCount=this.stronghold.country_id-7e3-1,ministerService.updateBadge()},e.prototype.onBattleSetStoryResponse=function(t){this.country.id!=t.data.result?MainStage.instance.storySection.play([this.country.id],2002,this.onDialogEnd):SceneController["goto"](ConstantNames.SCENE_BATTLE,{country:battleService.country,stronghold:battleService.stronghold,type:0})},e.prototype.onBattleCombatResponse=function(t){if(!(t.data.error>0)){var e,i=t.data.data,n=i.length,r=i[n-2],o=i[n-1];r.troops<0?e="red":o.troops<0?e="blue":n>=12&&(e="red"),this.currentWinGroup=e}},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":this.updateBadge();break;case"add":case"remove":if(!(this.suppressActivityIds.indexOf(t.data.activityTime.id)>=0))break;this.updateBadge(),this.dispatchEventWith(EventNames.UPDATE_SUPPRESS,!1,null)}},e.prototype.gotoNextStronghold=function(){this.setStrongholdId(GameConfig.getNextStrongholdId(this.stronghold.id))},e.prototype.oneKeySetup=function(){var t=this,e=4-this.getOpenGeneralsTech(),i=0,n=0;ministerService.getGenerals().some(function(r){return 0==ministerService.getMinisterStateById(r.id)&&(t.generals[i++]=r.id,n++,n>=e)?!0:void 0}),dataCenterService.battleGenerals=this.generals},e.prototype.checkInitGeneral=function(){alien.MathUtils.isNullArray(this.generals)&&this.oneKeySetup()},e.prototype.getBattleInfo=function(){gameServer.send(protocols.CW_BATTLE_INFO_Request,null)},e.prototype.getGenerals=function(){for(var t=[],e=this.getOpenGeneralsTech(),i=4-e;4>i;i++)t[i]={field:"tech"};for(var i=0;4>i;i++)if(!t[i]){var n=ministerService.getMinisterById(this.generals[i]);t[i]={minister:n}}return t.forEach(function(t,e){t.index=e}),t},e.prototype.getOpenGeneralsTech=function(){return 3-this.techs.filter(function(t){var e=technologyService.getById(t.id);return e&&e.level>=t.level}).length},e.prototype.getMasterGeneral=function(){return ministerService.getMinisterById(this.generals[0])},e.prototype.getSetupGeneralCount=function(){return this.generals.filter(function(t){return!!t}).length},e.prototype.setGeneral=function(t,e){var i=this.generals.indexOf(e);i>=0&&(this.generals[i]=this.generals[t]),this.generals[t]=e,dataCenterService.battleGenerals=this.generals},e.prototype.getInitBattleInfo=function(){var t={};for(var i in e.skillIds){var n=e.skillIds[i],r=e.skillEffectType[i],o=this.getSkillEffect(n,r),s=mainService.playerInfo[i]||0,a=this.getUnionTechEffect(e.unionTechIds[i]);switch(i){case"attack":case"hp":t[i]=Math.ceil(s*(o+100)*.01)+a;break;case"critical":t[i]=o+this.getTechEffect(e.techIds[i])+this.getPositionEffect(e.positions[i])}}var c=0;return this.generals.forEach(function(t,e){if(t){var i=ministerService.getMinisterById(t);c+=i.command*(0==e?20:10)}}),c=Math.floor(c),t.troops=Math.min(mainService.playerInfo.troops,c),t},e.prototype.getSkillEffect=function(t,e){var i=0;return this.generals.forEach(function(n,r){if(n){var o=ministerService.getMinisterById(n);i+=o.getSkillEffect(t,e)}}),i},e.prototype.getTechEffect=function(t){var e=0;return t.forEach(function(t){e+=technologyService.getSkillAddition(t)}),e},e.prototype.getUnionTechEffect=function(t){var e=0;return mainService.playerInfo.union_id<=0||!unionService.union?e:(t.forEach(function(t){e+=unionService.getTechAddition(t)}),e)},e.prototype.getPositionEffect=function(t){var e=0;return t.forEach(function(t){ministerService.ministers.forEach(function(i){e+=ministerService.getPositionAddition(t.id,i.id,t.type)})}),e},e.prototype.setStory=function(){return gameServer.send(protocols.CW_BATTLE_SETSTORY_REQUEST,{countryId:this.country.id}),!0},e.prototype.startBattle=function(){return this.generals[0]?(gameServer.send(protocols.CW_BATTLE_COMBAT_Request,{stronghold:this.stronghold.id,generals:this.generals}),!0):!1},e.prototype.suppress=function(t){return this.generals[0]?(gameServer.send(protocols.CW_BATTLE_COMBAT_EX_REQUEST,{countryId:t,generals:this.generals}),!0):!1},e.skillIds={attack:50008,critical:50008,hp:50009},e.skillEffectType={attack:15,critical:16,hp:17},e.techIds={attack:[0],critical:[403013],hp:[0]},e.unionTechIds={attack:[404010],critical:[0],hp:[404009]},e.positions={attack:[{id:0,type:0}],critical:[{id:5,type:16}],hp:[{id:0,type:0}]},e}(Service);__reflect(BattleService.prototype,"BattleService");var BossService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ministersQueue=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_Boss_OpenOrg_Response,this.onBossOpenOrgResponse,this),this.registerEvent(gameServer,protocols.WC_Boss_BuyBuff_Response,this.onBossBuyBuffResponse,this),this.registerEvent(gameServer,protocols.WC_BossInfo_Response,this.onBossInfoResponse,this),this.registerEvent(gameServer,protocols.WC_Boss_Battle_Response,this.onBossBattleResponse,this),this.registerEvent(gameServer,protocols.WC_Boss_RandomSelect_NOTIFY,this.onBossRandomSelectNotify,this),this.registerEvent(gameServer,protocols.WC_Boss_Select_Response,this.onBossSelectResponse,this),this.registerEvent(gameServer,protocols.WC_Boss_BuyCd_Response,this.onBuyCDResponse,this)},e.prototype.start=function(){return t.prototype.start.call(this).then(function(){})},e.prototype.onBossOpenOrgResponse=function(t){},e.prototype.onBossBuyBuffResponse=function(t){},e.prototype.onBossInfoResponse=function(t){0==t.data.error&&(this.boss||(this.boss=new BossEntity),this.boss.inject(t.data),this.dispatchEventWith(EventNames.UPDATE_BOSS_INFO))},e.prototype.onBossBattleResponse=function(t){},e.prototype.onBossRandomSelectNotify=function(t){0==t.data.error&&(this.ministersQueue=t.data.ministers,dataCenterService.bossAutoFight&&this.boss&&bossService.selectMinister(BossEntity.BOSS_TYPE.WORLD,bossService.getMinisters()),this.dispatchEventWith(EventNames.BOSS_SELECT_NOTIFY))},e.prototype.onBossSelectResponse=function(t){},e.prototype.onBuyCDResponse=function(t){},e.prototype.getBossInfoByType=function(t){},e.prototype.getBossSumHpById=function(t){var e=0,i=GameConfig.getBossMeta(bossService.boss.id);return e=i?1e8*i.blood:this.getWorldBossSumHp()},e.prototype.getWorldBossSumHp=function(){var t=this.boss.hp;return this.boss.ranks.forEach(function(e){t=e.hp.add(t)}),t},e.prototype.getBufferIcon=function(t){var e=ministerService.getById(t),i=1;return i=e.politics>=e.knowledge&&e.politics>=e.command?1:e.command>=e.knowledge?3:2},e.prototype.getDamageByMinisterId=function(t){var e=this,i=["command","politics","knowledge"],n=["politics","knowledge","command"],r=["knowledge","command","politics"],o=[1,1.5,.75,2],s=0;return t.forEach(function(t){var o=ministerService.getById(t),a=o[i[e.boss.type]]*(1+o.getQualification(i[e.boss.type])/100)*2+o[n[e.boss.type]]*(1+o.getQualification(n[e.boss.type])/100)+o[r[e.boss.type]]*(1+o.getQualification(r[e.boss.type])/100)*.5;s+=a}),Math.floor(s*o[this.getDamagePercent(t)])},e.prototype.getBuffAdd=function(){var t=1;return this.boss.buffer1Time-mainService.tsServer>90&&(t+=.15),this.boss.buffer2Time-mainService.tsServer>0&&(t+=.5),t},e.prototype.getDamagePercent=function(t){var e=this,i=[];t.forEach(function(t){t&&i.push(e.getBufferIcon(t))});for(var n=1,r=0;r<i.length;++r){for(var o=1,s=r+1;s<i.length;++s)i[r]==i[s]&&o++;n=Math.max(o,n)}return n},e.prototype.getMinisters=function(){var t=(new Date).getTime();console.log("before",t);for(var e=this.ministersQueue.slice(),i=[],n=e.length,r=0;3>r;r++){var o=~~(Math.random()*n)+r;i[r]=e[o],e[o]=e[r],n--}var s=[];return i.forEach(function(t){s.push(t.id)}),console.log((new Date).getTime()-t),s},e.prototype.openBoss=function(t){gameServer.send(protocols.CW_Boss_OpenOrg_Request,{unionId:mainService.playerInfo.union_id,bossId:t})},e.prototype.useBuffer=function(t,e){var i=0;switch(t){case BossEntity.BOSS_TYPE.UNION:i=mainService.playerInfo.union_id;break;case BossEntity.BOSS_TYPE.WORLD:i=BossEntity.WORLD_BOSS_ID}gameServer.send(protocols.CW_Boss_BuyBuff_Request,{bossId:i,type:e})},e.prototype.getBossInfo=function(t){switch(t){case BossEntity.BOSS_TYPE.UNION:gameServer.send(protocols.CW_BossInfo_Request,{unionId:mainService.playerInfo.union_id});break;case BossEntity.BOSS_TYPE.WORLD:gameServer.send(protocols.CW_BossInfo_Request,{unionId:BossEntity.WORLD_BOSS_ID})}},e.prototype.startFight=function(t,e){var i=0;switch(t){case BossEntity.BOSS_TYPE.UNION:i=mainService.playerInfo.union_id;break;case BossEntity.BOSS_TYPE.WORLD:i=BossEntity.WORLD_BOSS_ID}gameServer.send(protocols.CW_Boss_Battle_Request,{bossId:i,ministerId1:e[0].id,ministerId2:e[1].id,ministerId3:e[2].id})},e.prototype.selectMinister=function(t,e){var i=0;switch(t){case BossEntity.BOSS_TYPE.UNION:i=mainService.playerInfo.union_id;break;case BossEntity.BOSS_TYPE.WORLD:i=BossEntity.WORLD_BOSS_ID}gameServer.send(protocols.CW_Boss_Select_Request,{bossId:i,ministerId1:e[0],ministerId2:e[1],ministerId3:e[2]})},e.prototype.buyCD=function(t){gameServer.send(protocols.CW_Boss_BuyCD_Request,{bossId:t})},e}(Service);__reflect(BossService.prototype,"BossService");var ChatService=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this._messageSlots=[],this._newMsgNum=[];for(var t=0;10>t;t++)this._messageSlots.push([]),this._newMsgNum.push(0);this.registerEvent(gameServer,protocols.CLIENT_CHAT_SendMessageResponse_Notify,this.onSendMessageResponse,this),this.registerEvent(gameServer,protocols.SERVER_CHAT_SendMessage_NOTIFY,this.onChatSendMessageNotify,this),this.registerEvent(gameServer,protocols.WC_SETFACE_RESPONSE,this.onSetFaceResponse,this)
},e.prototype.onSendMessageResponse=function(t){},e.prototype.onChatSendMessageNotify=function(t){if(!(t.data.error>0)){var e=new MessageEntity;if(e.inject(t.data),e.activity)return void activityService.addActivity(e.activity);var i=this._messageSlots[e.type];i.push(e),i.length>15&&i.shift(),this._newMsgNum[e.type]++,this.dispatchEventWith(EventNames.UPDATE_CHAT,!0,{type:e.type,message:e},!1),this.updateBadge()}},e.prototype.onSetFaceResponse=function(t){},e.prototype.getMessageSlot=function(t){return this._messageSlots[t]},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:12100,count:this._newMsgNum[MessageEntity.ChatType.TYPE_WORLD]}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:12200,count:this._newMsgNum[MessageEntity.ChatType.TYPE_UNION]})},e.prototype.setNewMsgNum=function(t,e){this._newMsgNum[t]=e,this.updateBadge()},e.prototype.sendMessage=function(t,e,i,n,r){void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=""),gameServer.send(protocols.CLIENT_CHAT_SendMessageRequest,{sender:dataCenterService.pid,receiver:i,senderLineId:0,type:e,senderName:n,receiverName:r,content:Base64.encode(t),privilegeType:mainService.playerInfo.vip},Server.SERVER_TYPE.CHATSERVER,dataCenterService.pid)},e.prototype.changIcon=function(t){gameServer.send(protocols.CW_SETFACE_REQUEST,{id:t})},e}(Service);__reflect(ChatService.prototype,"ChatService");var CountDownService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._items=[],e._ids=0,e.onTimer=function(){if(0!=e._items.length){var t=[];e._items.forEach(function(e,i){var n=e.end-mainService.tsServer,r=e.onSecond;if(r&&r(Math.max(0,n)),0>=n){t.push(i);var o=e.onComplete;o&&o()}}),t.forEach(function(t){e._items.splice(t,1)})}},e}return __extends(e,t),e.prototype.start=function(){return this._items.splice(0),this._timer=egret.setInterval(this.onTimer,this,1e3),t.prototype.start.call(this)},e.prototype.stop=function(){return this._timer>0&&(egret.clearInterval(this._timer),this._timer=0),t.prototype.stop.call(this)},e.prototype.register=function(t,e,i){void 0===i&&(i=null);var n=++this._ids;return this._items.push({id:n,end:t,onSecond:e,onComplete:i}),e&&e(t-mainService.tsServer),n},e.prototype.unregister=function(t){var e=this;this._items.some(function(i,n){return i.id==t?(e._items.splice(n,1),!0):void 0})},e}(Service);__reflect(CountDownService.prototype,"CountDownService");var DataCenterService=function(t){function e(){var e=t.call(this)||this,i=LocalStorage.getItem("id",GameConfig.platform);return i&&e.setID(i),e}return __extends(e,t),e.prototype.start=function(){return this.load(),t.prototype.start.call(this)},e.prototype.load=function(t){void 0===t&&(t=!1),this.store=LocalStorage.getItemObj("store",{}),t?delete this.store.lastServer:this._lastServer=this.store.lastServer},e.prototype.save=function(){LocalStorage.setItemObj("store",this.store)},e.prototype.clean=function(t){if(void 0===t&&(t=null),t)for(var e in this.store)t.indexOf(e)<0&&this.store.hasOwnProperty(e)&&delete this.store[e];else this.store={};this.save(),this._initialized=!1},Object.defineProperty(e.prototype,"token",{get:function(){return this.store.token},enumerable:!0,configurable:!0}),e.prototype.cleanToken=function(){delete this.store.token,this.save()},Object.defineProperty(e.prototype,"ministerOrder",{get:function(){return this.store.ministerOrder||0},set:function(t){this.store.ministerOrder=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastServer",{get:function(){return(this._initialized?this.store.lastServer:this._lastServer)||-1},set:function(t){this._initialized&&(this.store.lastServer=t),this._lastServer=t},enumerable:!0,configurable:!0}),e.prototype.setAccount=function(t,e,i){this._uid=t,this._accountId=e,this._token=i,this.setID(this._accountId),this.load(!0),this.store.id=this._accountId,this.store.token=this._token,this.store.lastServer=this._lastServer,this.save()},e.prototype.setPlayer=function(t){this._pid=t.id},e.prototype.setID=function(t){LocalStorage.setItem("id",t,GameConfig.platform),LocalStorage.init(GameConfig.platform+"_"+t),this._initialized=!0},Object.defineProperty(e.prototype,"battleGenerals",{get:function(){return this.store.generals||[null,null,null,null]},set:function(t){this.store.generals=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visitPeopleStep",{get:function(){return this.store.step||0},set:function(t){this.store.step=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bossAutoFight",{get:function(){return this.store.bossFight},set:function(t){this.store.bossFight=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"battleCbSkip",{get:function(){return this.store.cbSkip||!1},set:function(t){this.store.cbSkip=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pid",{get:function(){return this._pid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accountId",{get:function(){return this._accountId},set:function(t){this._accountId=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAdult",{get:function(){return this.store.isAdult},set:function(t){this.store.isAdult=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"account",{get:function(){return LocalStorage.getItem("account",GameConfig.platform)},set:function(t){LocalStorage.setItem("account",t,GameConfig.platform)},enumerable:!0,configurable:!0}),e.prototype.getSettingItem=function(t){return this.store.setting?void 0===this.store.setting[t]?!0:this.store.setting[t]:!0},e.prototype.setSettingItem=function(t,e,i){void 0===i&&(i=!0);var n=this.store.setting;n||(n=this.store.setting={}),n[t]=e,this.save(),i&&this.dispatchEventWith(EventNames.SETTING_CHANGED,!1,{field:t,value:e})},e.prototype.switchSettingItem=function(t,e){void 0===e&&(e=!0),this.setSettingItem(t,!this.getSettingItem(t),e)},e}(Service);__reflect(DataCenterService.prototype,"DataCenterService");var EmailService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.emails=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_MailListResponse,this.onMailListResponse,this),this.registerEvent(gameServer,protocols.WC_ReadMailResponse,this.onReadMailResponse,this),this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this),this.registerEvent(gameServer,protocols.WC_DeleteMailResponse,this.onDeleteMailResponse,this)},e.prototype.onMailListResponse=function(t){var e=this;this.emails.splice(0),t.data.emails.forEach(function(t){return e.add(t)}),this.dispatchEventWith(EventNames.UPDATE_EMAIL,!1,null),this.updateBadge(),activityService.updateBadge()},e.prototype.onReadMailResponse=function(t){0==t.data.error&&(this.update(t.data),this.updateBadge())},e.prototype.onGetMailItemResponse=function(t){this.updateBadge()},e.prototype.onMailRecvResponse=function(t){var e=this.getById(t.data.id);e?e.inject(t.data):this.add(t.data),this.updateBadge(),activityService.updateBadge()},e.prototype.onDeleteMailResponse=function(t){this["delete"](t.data.id),activityService.updateBadge()},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:11e3,count:this.getEmailCount()})},e.prototype.getEmailCount=function(){var t=0;return this.emails.forEach(function(e){var i=activityService.getActivityByType(Math.floor(e.senderId/100)-1);i||e.isRead||t++}),t},e.prototype.getById=function(t){var e=null;return this.emails.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getBySenderId=function(t,e){void 0===e&&(e=0);var i=null,n=activityService.getActivityByType(t);return this.emails.some(function(r){return r.senderId==100*(t+1)+e&&n&&r.timestamp>=n.begin_time&&r.timestamp<=n.end_time&&0!=r.senderId?(i=r,!0):void 0}),i},e.prototype.getEmailsBySenderId=function(t){var e=[],i=activityService.getActivityByType(t);return this.emails.some(function(n){return Math.floor(n.senderId/100)-1==t&&i&&n.timestamp>=i.begin_time&&n.timestamp<=i.end_time&&0!=n.senderId?(e.push(n),!0):void 0}),e},e.prototype.getEmails=function(){var t=[];return this.emails.forEach(function(e){var i=activityService.getActivityByType(Math.floor(e.senderId/100)-1);(!i||e.timestamp<i.begin_time||e.timestamp>i.end_time||0==e.senderId)&&t.push(e)}),t},e.prototype.add=function(t){var e=new EmailEntity;return e.inject(t),this.emails.push(e),e},e.prototype.update=function(t){this.emails.some(function(e){return e.id==t.id?(e.inject(t),!0):void 0})},e.prototype["delete"]=function(t){var e=this;this.emails.some(function(i,n){return i.id==t?(e.emails.splice(n,1),e.dispatchEventWith(EventNames.UPDATE_EMAIL,!1,null),!0):void 0})},e.prototype.getReadEmailNum=function(){var t=0;return this.emails.forEach(function(e){e.isRead&&t++}),t},e.prototype.getMailList=function(){gameServer.send(protocols.CW_MailListRequest,{},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.readMail=function(t){gameServer.send(protocols.CW_ReadMailRequest,{id:t},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.getMailItem=function(t){gameServer.send(protocols.CW_GetMailItemRequest,{id:t},Server.SERVER_TYPE.WORLDSERVER)},e}(Service);__reflect(EmailService.prototype,"EmailService");var FinishService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.finishConfigs=[{id:10001,actTimeIds:[70,71,72],type:"remove"},{id:10002,actTimeIds:[1,2,3,4,5,6]},{id:10003,actTimeIds:[31,32,33,34],type:"update"},{id:10004,actTimeIds:[41,42,43,44],type:"update"},{id:10005,actTimeIds:[45,46,47,48],type:"update"},{id:10006,actTimeIds:[]},{id:10007,actTimeIds:[]},{id:10008,actTimeIds:[570],type:"remove"}],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(taskService,EventNames.UPDATE_TASK,this.onUpdateTask,this),this.registerEvent(princessService,EventNames.PARTY_TURN_START,this.onPartyStart,this)},e.goGoalScene=function(t){switch(t){case 10001:SceneController.jump(ConstantNames.SCENE_TECHNOLOGY);break;case 10002:SceneController.jump(ConstantNames.SCENE_INTERIOR,{tab:1});break;case 10003:SceneController.jump(ConstantNames.SCENE_PRINCESS_WORK);break;case 10004:SceneController.jump(ConstantNames.SCENE_PRINCESS_RITE);break;case 10005:SceneController.jump(ConstantNames.SCENE_GARDEN_FLOWER);break;case 10006:SceneController.jump(ConstantNames.SCENE_PRINCESS_PARTY);break;case 10007:PanelTask.instance.show();break;case 10008:SceneController.jump(ConstantNames.SCENE_ARENA)}},e.prototype.getConfigByActId=function(t,e){void 0===e&&(e=null);var i=null;return this.finishConfigs.some(function(n){return n.actTimeIds.indexOf(t)>=0&&null==e?(i=n,!0):n.actTimeIds.indexOf(t)>=0&&n.type==e?(i=n,!0):void 0}),i},e.prototype.getContentById=function(t,e){void 0===e&&(e=null);var i=null;switch(t){case 10001:var n=GameConfig.getTechMeta(e["int"]);i=n.name;break;case 10002:var r=["trade","industry","military"];i=lang.country_props[r[e["int"]]];break;default:i=""}return lang.format(lang.finish_tips[t],i)},e.prototype.onActivityTimeChange=function(t){var e=t.data.activityTime,i=null;switch(t.data.type){case"init":break;case"remove":i=this.getConfigByActId(e.id,"remove");break;case"update":var n=[70,71,72];e["int"]<=mainService.tsServer&&n.indexOf(e.id)<0&&(i=this.getConfigByActId(e.id))}if(i){var r=this.getContentById(i.id,e);alien.Dispatcher.dispatch(EventNames.SHOW_FINISH_NOTIFICATION,{content:r,id:i.id})}},e.prototype.onUpdateTask=function(t){var e=t.data.task;if(!(e.flag>=1)&&this.getTaskFinishStatus(e)){var i=lang.format(lang.finish_tips[10007],lang.task_type_no_brackets[e.meta.type],e.meta.name);alien.Dispatcher.dispatch(EventNames.SHOW_FINISH_NOTIFICATION,{content:i,id:10007})}},e.prototype.getTaskFinishStatus=function(t){var e=!1;switch(t.meta.finish_type){case 68:e=t.value==t.meta.finish_value&&t.value>0;break;default:e=t.value==t.meta.finish_value}return e},e.prototype.onPartyStart=function(t){if(2==princessService.partyData.state){var e=lang.finish_tips[10006];alien.Dispatcher.dispatch(EventNames.SHOW_FINISH_NOTIFICATION,{content:e,id:10006})}},e}(Service);__reflect(FinishService.prototype,"FinishService");var InteriorService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activityItemIds=[1,2,3,4,5,6],e.queue=[],e.initSiteCount=2,e.nationalProps=["silver","mineral","troops"],e.developmentNames=["trade","industry","military"],e.developmentSkills={trade:50001,industry:50006,military:50007},e.developmentEffectTypes={trade:1,industry:11,military:13},e.developmentTech={trade:[401002,401011,401014],industry:[401003,401012,401014],military:[403001,403010,401014]},e.developmentUnionTech={trade:[404011],industry:[404012],military:[404013]},e.addImposeItemId=600071,e}return __extends(e,t),Object.defineProperty(e.prototype,"activityTimes",{get:function(){return activityTimeService.getActivityTimesByIds(this.activityItemIds)},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(gameServer,protocols.WC_IMPOSE_Response,this.onImposeResponse,this),this.registerEvent(gameServer,protocols.WC_DISPATCH_CARD_RESPONSE,this.onDispatchCardResponse,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this)},e.prototype.onActivityTimeChange=function(t){this.queue=this.activityTimes.map(function(t){return{minister:ministerService.getMinisterById(t.str),activityTime:{id:t.id,type:t["int"],ministerId:t.str,timestamp:t.timestamp-31104e3}}}),"init"!=t.data.type&&this.activityItemIds.indexOf(t.data.activityTime.id)>=0&&(this.dispatchEventWith(EventNames.REFRESH_DEVELOPMENT_QUEUE),this.updateBadge()),"init"!=t.data.type&&10==t.data.activityTime.id&&(this.dispatchEventWith(EventNames.REFRESH_IMPOSE,!1,null),this.updateBadge())},e.prototype.onImposeResponse=function(t){0==t.data.error&&this.updateBadge()},e.prototype.onDispatchCardResponse=function(t){},e.prototype.onLoginGame=function(t){this.updateBadge()},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22112,count:this.getImposeValue()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22111,count:this.getDevelopCount()})},e.prototype.getDevelopCount=function(){var t=this.getTotalCount()-this.getInUseCount(),e=ministerService.getFreeMinisters(),i=this.queue.filter(function(t){return!!t&&t.activityTime.timestamp-mainService.tsServer<=0}).length;return t=e.length>0?t:0,Math.max(t,i)},e.prototype.getDevelopmentAddition=function(t,e){var i=this.developmentSkills[e],n=.01*t.getSkillEffect(i,this.developmentEffectTypes[e]),r=mainService.playerInfo[e];return Math.floor(.01*t.politics*(1+n+0)*(2-r/(r+1e5)))},e.prototype.getQueue=function(){for(var t=[],e=4,i=[401004,401007],n=0,r=e;r>n;n++){var o=this.queue[n];o?t.push(o):n<this.getTotalCount()?t.push(null):t.push({lock:!0,techId:i[n-2]})}return t},e.prototype.getInUseCount=function(){return this.queue.filter(function(t){return!!t&&t.activityTime.timestamp-mainService.tsServer>0}).length},e.prototype.getTotalCount=function(){var t=2,e=[401004,401007];return e.forEach(function(e){var i=technologyService.getSkillAddition(e);t+=i}),t},e.prototype.getDevelopmentField=function(t){return this.developmentNames[t]},e.prototype.getDevelopmentSpeed=function(t){var e=mainService.getClassifySum(t)+mainService.playerInfo.area,i=0,n=interiorService.developmentTech[t];if(n.forEach(function(t){var e=technologyService.getById(t);if(e){var n=GameConfig.getBufferMeta(e.meta.levels[e.level].effect);n&&(i+=n.value)}}),mainService.playerInfo.union_id>0&&unionService.union){var r=interiorService.developmentUnionTech[t];r.forEach(function(t){i+=unionService.getTechAddition(t)})}var o=.01;switch(t){case"trade":o=1;break;case"military":o=.1;break;case"industry":o=.01}var s=GameConfig.getVipMeta(mainService.playerInfo.vip);return s&&(i+=s.impose_addition),Math.floor(e*(1+i/100)*o)},e.prototype.isMinisterInQueue=function(t){var e=!1;return this.queue.some(function(i){return i&&i.minister==t?(e=!0,!0):void 0}),e},e.prototype.getImposeValue=function(){var t=0,e=activityTimeService.getById(10);return e&&(t=e["int"]),t},e.prototype.getMaxImposeValue=function(){var t=10,e=activityTimeService.getById(14);return e&&(t=e["int"]),t},e.prototype.getSumValue=function(t){var e=this;return this.queue.reduce(function(i,n){return i+(n&&n.minister?e.getDevelopmentAddition(n.minister,t):0)},0)},e.prototype.dispatch=function(t,e){gameServer.send(protocols.CW_CARD_DISPATCH_Request,{ministerId:t.id,type:e})},e.prototype.finish=function(t){gameServer.send(protocols.CW_DISPATCH_CARD_REQUEST,{timeId:t})},e.prototype.impose=function(t){gameServer.send(protocols.CW_IMPOSE_Request,{type:t})},e}(Service);__reflect(InteriorService.prototype,"InteriorService");var MainService=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){return this.guideStoreArr=[],t.prototype.start.call(this)},e.prototype.stop=function(){return this.playerInfo.locked=!0,t.prototype.stop.call(this)},e.prototype.init=function(){this._playerInfo=new PlayerEntity,this.registerEvent(gameServer,protocols.CLIENT_WORLD_SelectPlayerResponse,this.onGotPlayerList,this),this.registerEvent(gameServer,protocols.CLIENT_GAME_LoginResponse,this.onLoginGameResponse,this),this.registerEvent(gameServer,protocols.CLIENT_WORLD_CreatePlayerResponse,this.onCreatePlayerResponse,this),this.registerEvent(gameServer,protocols.WC_INIT_DATA_NOTIFY,this.onInitDataNotify,this),this.registerEvent(gameServer,protocols.WC_INIT_ITEM_Notify,this.onInitItemNotify,this),this.registerEvent(gameServer,protocols.WC_INIT_PLAYERINFO_NOTIFY,this.onUpdatePlayerInfoNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PLAYERINFO_NOTIFY,this.onUpdatePlayerInfoNotify,this),this.registerEvent(gameServer,protocols.WC_SETPLAYERFLAG_RESPONSE,this.onAddGuideFlagResponse,this),this.registerEvent(this._playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPlayerPropsModified,this)},Object.defineProperty(e.prototype,"playerInfo",{get:function(){return this._playerInfo},set:function(t){this._playerInfo=t},enumerable:!0,configurable:!0}),e.prototype.setPlayerBaseInfo=function(t){this.playerBaseInfo=t,dataCenterService.setPlayer(this.playerBaseInfo),this._playerInfo.inject({nickname:t.name}),Analytics.logEvent("select_player",{player:t})},e.prototype.onGotPlayerList=function(t){var e=t.data.players;if(0==e.length)SceneController["goto"](ConstantNames.SCENE_CREATE_PLAYER);else{var i=e[0];i.level=1,this.setPlayerBaseInfo(i),gameServer.send(protocols.CLIENT_GAME_LoginRequest,{uid:dataCenterService.uid,playerId:this.playerBaseInfo.id})}},e.prototype.onCreatePlayerResponse=function(t){var e=t.data,i=e.error,n=e.playerId;if(0==i){var r={id:n,name:this._tempName,level:1,gold:0};Analytics.logEvent("create_player",{player:r}),this.setPlayerBaseInfo(r),SceneController.popAll(ConstantNames.SCENE_STORY)}},e.prototype.onLoginGameResponse=function(t){Analytics.logEvent("enter_game",{}),SceneController.instance.navigator.currentName!==ConstantNames.SCENE_LOBBY&&SceneController.popAll(ConstantNames.SCENE_LOBBY),UserLifeCycle.onLogin(),this.tsOffset=Math.floor(.001*Date.now())-t.data.timestamp,egret.setTimeout(function(){GameConfig.antiAddictionEnabled&&!dataCenterService.isAdult&&PanelAntiAddiction.instance.show()},this,500),this.playerInfo.oldNationalPower=this.getAllSum(),this.dispatchEventWith(EventNames.LOGIN_GAME,!1,null)},e.prototype.onInitDataNotify=function(t){this.arenaContinueType=t.data.pveType;var e=t.data.guide_store,i=e.toString(2);this.guideStoreArr=i.split("").map(function(t){return 1==t})},e.prototype.onInitItemNotify=function(t){packService.setSource(t.data.items),packService.updateBadge()},e.prototype.onUpdatePlayerInfoNotify=function(t){this.playerInfo.inject(t.data);var e=this.playerInfo.oldNationalPower,i=this.getAllSum();i>e&&e>0&&NationalPowerUp.instance.show({oldValue:e,value:i})},e.prototype.onPlayerPropsModified=function(t){t.data.locked},Object.defineProperty(e.prototype,"tsServer",{get:function(){return Math.floor(.001*Date.now())-this.tsOffset},enumerable:!0,configurable:!0}),e.prototype.getAllSum=function(){var t=this;return e.nationalPowerClassify.reduce(function(e,i){return e+t.getClassifySum(i)},0)+this.playerInfo.area+this.playerInfo.harem},e.prototype.getClassifySum=function(t){var i=this;return e.nationalPowerFields.reduce(function(e,n){return e+i.getNationPowerField(n,t)},0)},e.prototype.getNationPowerField=function(t,e){switch(t){case"minister":return this.playerInfo.national_property[0][e];case"princess":return this.playerInfo.national_property[2][e];case"interior":return this.playerInfo[e];case"prince":return this.playerInfo.national_property[1][e];case"office":return this.playerInfo.national_property[3][e]}},e.prototype.createPlayer=function(t,e,i){this._tempName=t,this.nationalIcon=e,gameServer.send(protocols.CLIENT_WORLD_CreatePlayerRequest,{uid:dataCenterService.uid,name:t,national_icon:e,chat_icon:i})},e.prototype.getServerGroups=function(){return this._serverGroups},e.prototype.getServerById=function(t){return alien.Utils.findArr(this._servers,function(e){return e.id==t})},e.prototype.getRecommendServer=function(){var t=this.getServerById(dataCenterService.lastServer);return t||(t=alien.Utils.findArr(this._servers,function(t){return 2==t.status})),t},e.prototype.getLastServer=function(){return this.getServerById(dataCenterService.lastServer)},e.prototype.loadServerGroups=function(){var t=this;return this._serverGroups?Promise.resolve(this._serverGroups):webService.getServerList().then(function(e){t._servers=e;for(var i=e.concat(),n=[],r=0,o=i.length/10;o>r;r++)n.push({index:r,servers:i.splice(10*r,10)});return t._serverGroups=n})},e.prototype.logout=function(){gameServer.send(protocols.CLIENT_GAME_LogoutRequest,{},Server.SERVER_TYPE.WORLDSERVER,dataCenterService.accountId)},e.prototype.addGuideFlag=function(t){this.guideStoreArr[t]=!0,gameServer.send(protocols.CW_SETPLAYERFLAG_REQUEST,{guideIndex:t})},e.prototype.onAddGuideFlagResponse=function(t){0==t.data.code&&(this.guideStoreArr[t.data.guideIndex]=!0)},e.prototype.isGuideDone=function(t){return this.guideStoreArr[t]},e.prototype.completeGuide=function(t){Analytics.logEvent("guide_complete",{index:t})},e.nationalPowerClassify=["trade","industry","military"],e.nationalPowerFields=["minister","princess","interior","prince","office"],e.nationalPowerWarehouse=["gold","silver","mineral"],e.nationalPowerMilitary=["troops","hp","attack"],e}(Service);__reflect(MainService.prototype,"MainService");var MemorialService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activityItemIds=[21,22,23,24,25,26,690,691,692,693,694,695,696,697,698,699],e}return __extends(e,t),Object.defineProperty(e.prototype,"memorials",{get:function(){return activityTimeService.getActivityTimesByIds(this.activityItemIds)},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(gameServer,protocols.WC_READ_APPLY_Response,this.onOperateResponse,this)},e.prototype.onActivityTimeChange=function(t){("init"==t.data.type||this.activityItemIds.indexOf(t.data.activityTime.id)>=0)&&this.updateBadge()},e.prototype.onOperateResponse=function(t){0==t.data.error&&this.updateBadge()},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22120,count:this.memorials.length})},e.prototype.getOne=function(){return this.memorials.length>0?this.currentMemorial=this.memorials[0]:null},e.prototype.operate=function(t,e){gameServer.send(protocols.CW_READ_APPLY_Request,{id:t,access:e})},e}(Service);__reflect(MemorialService.prototype,"MemorialService");var MinisterService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ministers=[],e.positions=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_INIT_CARD_NOTIFY,this.onInitMinsterNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_CARD_NOTIFY,this.onUpdateMinsterNotify,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDABILITY_Response,this.onGiveItemResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDEQUIP_Response,this.onEquipResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDSKILL_Response,this.onLearnSkillResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_HIRE_Response,this.onHireMinisterResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDLEVEL_Response,this.onUpgradeResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDGROW_Response,this.onGrowBreakResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_UPLVLIMIT_Response,this.onPeerageResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDEQUIP_Response,this.onGiveEquipmentResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_REMOVEEQUIP_Response,this.onRemoveEquipmentResponse,this),this.registerEvent(gameServer,protocols.WC_INIT_OFFICER_NOTIFY,this.onInitOfficerNotify,this),this.registerEvent(gameServer,protocols.WC_DESIGNATE_OFFICER_Response,this.onDesignateResponse,this),this.registerEvent(gameServer,protocols.WC_REVOKE_OFFICER_Response,this.onRevokeResponse,this),this.registerEvent(gameServer,protocols.WC_ADD_CARD_OFFICALRANK_RESPONSE,this.onAddOfficialRankResponse,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.ministers.splice(0),e.positions.splice(0)})},e.prototype.onInitMinsterNotify=function(t){var e=this;this.ministers.splice(0),t.data.ministers.forEach(function(t){return e.add(t)})},e.prototype.onLoginGame=function(t){battleService.country.id&&this.updateBadge()},e.prototype.add=function(t){var e=new MinisterEntity;return e.inject(t),this.ministers.push(e),e},e.prototype.onUpdateMinsterNotify=function(t){var e=this.getById(t.data.id),i=!princess;e?e.inject(t.data):(e=this.add(t.data),this.updateBadge()),this.dispatchEventWith(EventNames.UPDATE_MINSTER,!1,{minister:e,added:i}),i&&alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"minister_add_"+e.metaId})},e.prototype.onGiveItemResponse=function(t){},e.prototype.onEquipResponse=function(t){},e.prototype.onLearnSkillResponse=function(t){if(0==t.data.error){var e=t.data.skillId;Math.floor(e/1e3)}},e.prototype.onHireMinisterResponse=function(t){this.updateBadge()},e.prototype.onUpgradeResponse=function(t){},e.prototype.onGrowBreakResponse=function(t){},e.prototype.onPeerageResponse=function(t){},e.prototype.onGiveEquipmentResponse=function(t){},e.prototype.onRemoveEquipmentResponse=function(t){},e.prototype.onInitOfficerNotify=function(t){var e=this;this.positions.splice(0),t.data.positions.forEach(function(t){e.positions.push(t)}),this.sortPosition()},e.prototype.onDesignateResponse=function(t){var e=t.data,i=e.error,n=e.id,r=e.ministerId;if(0==i){var o=this.getPositionDataById(n);o?o.ministerId=r:(o={id:n,ministerId:r},this.positions.push(o),this.sortPosition()),this.dispatchEventWith(EventNames.UPDATE_MINISTER_POSITION,!1,{type:0,posData:t.data}),this.updateBadge()}},e.prototype.onRevokeResponse=function(t){var e=t.data,i=e.error,n=e.id;0==i&&(this.removePositionData(n),this.dispatchEventWith(EventNames.UPDATE_MINISTER_POSITION,!1,{type:1,posData:t.data}),this.updateBadge())},e.prototype.onAddOfficialRankResponse=function(t){},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22130,count:this.getPositionCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22210,count:this.getHireMinisterCount()})},e.prototype.sortPosition=function(){this.positions.sort(function(t,e){return t.id-e.id})},e.prototype.getTopGroup=function(){var t=5;if(this.positions.length>0){var e=this.positions[0].id;t=this.getRenderPos(e).group}return t},e.prototype.getRenderPos=function(t){var i,n,r=t;return e.positionGroup.some(function(t,e){return r-=t.count,0>=r?(i=t,n=e,!0):void 0}),{group:n,index:r+i.count-1}},e.prototype.getPositionDataById=function(t){var e;return this.positions.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.removePositionData=function(t){var e=this;this.positions.some(function(i,n){return i.id==t?(e.positions.splice(n,1),!0):void 0})},e.prototype.getHireMinisterCount=function(){var t=this,e=0,i=this.getHireMinisterMetas(!1);return i.forEach(function(i){if(!t.checkHire(i.id)){var n=GameConfig.hireConfigs[i.hire_type];if(n){var r=n.value();n.judgeReach(r,i.hire_cost)&&e++}}}),e},e.prototype.checkHire=function(t){return this.ministers.filter(function(e){return e.metaId==t}).length>0},e.prototype.getMinisterById=function(t){return alien.Utils.findArr(this.ministers,function(e){return e.id==t})},e.prototype.getMinisterByEquipId=function(t){var e=null;return this.ministers.some(function(i){var n=!1;return i.equips.some(function(e){return e==t?(n=!0,!0):void 0}),n?(e=i,!0):void 0}),e},e.prototype.order=function(t){this.ministers.sort(function(t,e){return e.meta.quality-t.meta.quality!=0?e.meta.quality-t.meta.quality:e.level-t.level!=0?e.level-t.level:e.metaId-t.metaId})},e.prototype.getById=function(t){var e=null;return this.ministers.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getByMetaId=function(t){var e=null;return this.ministers.some(function(i){return i.metaId==t?(e=i,!0):void 0}),e},e.prototype.getUnHireMinisterMetas=function(){var t=this;return GameConfig.ministerArray.filter(function(e){return 0!=e.hire_type&&1!=e.hire_type&&!t.checkHire(e.id)}).sort(function(t,e){var i=GameConfig.hireConfigs[t.hire_type],n=i.value(),r=i.judgeReach(n,t.hire_cost)?1:0,o=GameConfig.hireConfigs[e.hire_type],s=o.value(),a=o.judgeReach(s,e.hire_cost)?1:0;return a==r?e.id-t.id:a-r})},e.prototype.getHireMinisterMetas=function(t){var e=this;void 0===t&&(t=!0);var i=GameConfig.ministerArray.filter(function(t){return 0!=t.hire_type});return t&&(i=i.sort(function(t,i){var n=e.checkHire(t.id)?1:0,r=e.checkHire(i.id)?1:0;if(1==n||1==r)return n-r;var o=GameConfig.hireConfigs[t.hire_type],s=GameConfig.hireConfigs[i.hire_type],a=o.value(),c=o.judgeReach(a,t.hire_cost)?1:0,l=s.value(),p=s.judgeReach(l,i.hire_cost)?1:0;return p==c?i.id-t.id:p-c})),i},e.prototype.getGenerals=function(){return this.ministers.concat().sort(function(t,e){return e.command-t.command})},e.prototype.getMinisterByGrade=function(t){var e=[];return this.ministers.forEach(function(i){i.grade==t&&e.push(i)}),e},e.prototype.getClassOpenCost=function(t){var e={id:0,level:0};return 3>=t?(e.id=402012,e.level=4-t):6>=t?(e.id=402009,e.level=7-t):9>=t&&(e.id=402003,e.level=10-t),e},e.prototype.getArenaValiable=function(){return this.ministers.filter(function(t){return t.level>=50}).length>=6},e.prototype.getPositionAddition=function(t,e,i){var n=0,r=this.getPositionDataById(t);if(r&&e==r.ministerId){var o=GameConfig.getPositionMeta(r.id).skill;n=GameConfig.getSkillEffectValue(o,1,i)}return n},e.prototype.getMinisterSeat=function(){var t=20,e=[402001,402007];return e.forEach(function(e){t+=technologyService.getSkillAddition(e)}),t},e.prototype.getPositionCount=function(){var t=0,e=function(e){var n=GameConfig.positions[e],r=i.getPositionDataById(n.id);if(!r){var o=i.ministers,s=MinisterEntity.abilityClassifyFields[n.condition_type-1];o=o.filter(function(t){return t[s]>=n.condition_value&&0==t.position}),o.length&&t++}},i=this;for(var n in GameConfig.positions)e(n);
return t},e.prototype.getHireCondition=function(t,e){var i=activityTimeService.getById(t);if(!i)return 0;for(var n=Base64.decode(i.str),r=[],o=0;o<n.length/4;++o){var s=n.slice(4*o,4*o+4);r.push(s)}for(var a=0,o=0;o<r[e].length;++o){var c=r[e].charCodeAt(o);a+=c*Math.pow(256,o)}return a},e.prototype.getMinisterStateById=function(t){var e=0;if(battleService.getGenerals().some(function(i){return i.minister&&t==i.minister.id?(e=4,!0):void 0}),e)return e;var i=[[1,2,3,4,5,6],[70,71,72]];return i.some(function(i,n){var r=activityTimeService.getActivityTimesByIds(i),o=!1;return r.some(function(e){return e.str==t?(o=!0,!0):void 0}),o?(e=n+1,!0):void 0}),e},e.prototype.getFreeMinisters=function(){var t=this,e=[];return this.ministers.forEach(function(i){0==t.getMinisterStateById(i.id)&&e.push(i)}),e},e.prototype.getSumValue=function(t){return this.ministers.reduce(function(e,i){return e+i[t]},0)},e.prototype.hire=function(t){gameServer.send(protocols.CW_CARD_HIRE_Request,{metaId:t})},e.prototype.giveItem=function(t,e,i,n){var r=4*e+i;gameServer.send(protocols.CW_CARD_ADDABILITY_Request,{ministerId:t.id,pos:r,count:n})},e.prototype.giveEquipment=function(t,e){gameServer.send(protocols.CW_CARD_ADDEQUIP_Request,{ministerId:t.id,itemId:e})},e.prototype.removeEquipment=function(t,e){gameServer.send(protocols.CW_CARD_REMOVEEQUIP_REQUEST,{ministerId:t.id,index:e})},e.prototype.learnSkill=function(t,e){var i=e.getNextSkillId();gameServer.send(protocols.CW_CARD_ADDSKILL_Request,{ministerId:t.id,skillId:i})},e.prototype.upgrade=function(t,e){gameServer.send(protocols.CW_CARD_ADDLEVEL_Request,{ministerId:t.id,level:e})},e.prototype.growBreak=function(t,e){gameServer.send(protocols.CW_CARD_ADDGROW_Request,{ministerId:t.id,type:e})},e.prototype.peerage=function(t){gameServer.send(protocols.CW_CARD_UPLVLIMIT_Request,{ministerId:t.id})},e.prototype.appointment=function(t,e){gameServer.send(protocols.CW_DESIGNATE_OFFICER_Request,{ministerId:t.id,id:e})},e.prototype.recall=function(t){gameServer.send(protocols.CW_REVOKE_OFFICER_Request,{id:t})},e.prototype.addCardOfficialRank=function(t){gameServer.send(protocols.CW_ADD_CARD_OFFICALRANK_REQUEST,{ministerId:t})},e.positionGroup=[{index:0,count:3},{index:1,count:6},{index:2,count:6},{index:3,count:3},{index:4,count:3},{index:5,count:3}],e}(Service);__reflect(MinisterService.prototype,"MinisterService");var OpenService=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i.openConfig=[{id:10001,name:e.OpenNames.MINISTER_HIRE,target:7001,type:0,badgeIds:[22210]},{id:10002,name:ConstantNames.SCENE_TECHNOLOGY,target:7001,type:0,badgeIds:[22300]},{id:10003,name:ConstantNames.SCENE_TREASURE,target:7001,type:0,badgeIds:[24300]},{id:10004,name:e.OpenNames.TURN_CARD,target:7002,type:0,badgeIds:[23110]},{id:10005,name:ConstantNames.SCENE_PRINCE,target:7002,type:0,badgeIds:[22410,22420]},{id:10006,name:ConstantNames.SCENE_OFFICE,target:7002,type:0,badgeIds:[22130]},{id:10007,name:ConstantNames.SCENE_PRINCESS_WORK,target:7003,type:0,badgeIds:[23200]},{id:10008,name:ConstantNames.SCENE_PRINCESS_RITE,target:7003,type:0,badgeIds:[23300]},{id:10009,name:ConstantNames.SCENE_GARDEN_HOUSE,target:7003,type:0,badgeIds:[23410]},{id:10009,name:ConstantNames.SCENE_GARDEN_FLOWER,target:7003,type:0,badgeIds:[23410]},{id:10010,name:ConstantNames.SCENE_PRINCESS_POSITION,target:200,type:1,badgeIds:[]},{id:10011,name:ConstantNames.SCENE_ARENA,target:6,type:2,badgeIds:[22500]},{id:10012,name:ConstantNames.SCENE_VISIT,target:7004,type:0,badgeIds:[24100]},{id:10013,name:ConstantNames.SCENE_PRINCESS_PARTY,target:7005,type:0,badgeIds:[]},{id:10014,name:e.OpenNames.SUPPRESS,target:7006,type:0,badgeIds:[21520]},{id:10015,name:e.OpenNames.RANK,target:7007,type:0,badgeIds:[24210,24220,24230,24240]},{id:10016,name:e.OpenNames.CHAT,target:7008,type:0,badgeIds:[]},{id:10017,name:ConstantNames.SCENE_UNION,target:7009,type:0,badgeIds:[24413,24420,24430,24440]},{id:10018,name:ConstantNames.SCENE_WORLD_BOSS,target:7010,type:0,badgeIds:[]}],i}return __extends(e,t),e.prototype.getOpenStatus=function(t,i){var n=t.name,r=t.showTip,o=void 0===r?!0:r;void 0===i&&(i=null);var s=this.getConfig(n),a=!1,c="",l=2;if(!s)return!0;switch(s.type){case e.OpenType.WORLD_MAP:var p=battleService.country;a=p.id>s.target,c=GameConfig.getCountryMeta(s.target).name;break;case e.OpenType.PRINCESS_RITE:a=this.getPrincessCondition(s.target),c=s.target,l=0;break;case e.OpenType.MINISTER_NUM:l=0,a=ministerService.getArenaValiable()}if(!a&&o){var h=lang.format(lang.open_tip[s.type],c);Alert.show(h,l,function(t){"go"==t.name&&(PanelTask.instance.openState&&PanelTask.instance.close(),i&&i(),SceneController.jump(ConstantNames.SCENE_WORLD_MAP))})}return a},e.prototype.getPrincessCondition=function(t){var e=!1;return princessService.princesses.some(function(i){return i.rite>=t?(e=!0,!0):void 0}),e},e.prototype.getConfig=function(t){var e=null;return this.openConfig.some(function(i){return i.name==t?(e=i,!0):void 0}),e},e.prototype.updateBadge=function(){ministerService.updateBadge(),princessService.updateBadge(),princeService.updateBadge(),technologyService.updateBadge(),visitService.updateBadge(),shopService.updateBadge(),rankService.updateBadge(),unionService.updateBadge(),battleService.updateBadge()},e.prototype.getOpenStatusByBadgeId=function(t){var e=this.getConfigByBadgeId(t),i=!1;if(!e)return!0;switch(e.type){case 0:var n=battleService.country;i=n.id>e.target;break;case 1:i=this.getPrincessCondition(e.target);break;case 2:i=ministerService.getArenaValiable()}return i},e.prototype.getConfigByBadgeId=function(t){var e=null;return this.openConfig.some(function(i){return i.badgeIds.indexOf(t)>=0?(e=i,!0):void 0}),e},e.prototype.getConfigsByType=function(t,e){return this.openConfig.filter(function(i){return i.target==e&&i.type==t&&i.name!=ConstantNames.SCENE_GARDEN_FLOWER})},e.prototype.goGoal=function(t){switch(t.id){case 10001:SceneController.replace(ConstantNames.SCENE_MINISTER,{tab:1});break;case 10004:SceneController.replace(ConstantNames.SCENE_PRINCESS_HOUSE),alien.EgretUtils.callLater(function(){PanelPrincessTurnCard.instance.show()},10);break;case 10014:SceneController["goto"](ConstantNames.SCENE_WORLD_MAP,{tab:1});break;case 10015:PanelRank.instance.show();break;case 10016:PanelChat.instance.show();break;default:SceneController.replace(t.name)}},e.OpenNames={MINISTER_HIRE:"minister_hire",TURN_CARD:"turn_card",RANK:"rank",CHAT:"chat",SUPPRESS:"suppress"},e.OpenType={WORLD_MAP:0,PRINCESS_RITE:1,MINISTER_NUM:2},e}(Service);__reflect(OpenService.prototype,"OpenService");var PackService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.nowItem={metaId:0,count:0,targetId:""},e.newItemValue=0,e.newTreasure=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_UPDATE_ITEM_Notify,this.onUpdateItemNotify,this),this.registerEvent(gameServer,protocols.WC_ITEM_USE_Response,this.onItemUseResponse,this),this.registerEvent(gameServer,protocols.WC_ITEM_COMPOSE_Response,this.onItemComposeResponse,this),this.registerEvent(gameServer,protocols.WC_EquipStrengthen_Response,this.onItemUpgradeResponse,this)},e.prototype.onUpdateItemNotify=function(t){packService.updateItem(t.data),this.updateBadge(),shopService.updateBadge()},e.prototype.onItemUseResponse=function(t){},e.prototype.onItemComposeResponse=function(t){this.updateBadge()},e.prototype.onItemUpgradeResponse=function(t){},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21400,count:this.newItemValue}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21420,count:this.getCombinableCount()})},e.prototype.getCombinableCount=function(){var t=this,e=0;return this.getCombinableItems().forEach(function(i){t.checkCombine(i.metaId)&&e++}),e},e.prototype.setSource=function(t){var e=this;this.itemList.splice(0),t.forEach(function(t){e.addItem(t)}),this.itemList.forEach(function(t){t.inject({id:t.id,metaId:t.metaId,count:t.count})})},e.prototype.getList=function(t){return void 0===t&&(t=null),t?this.itemList.filter(t):this.itemList},e.prototype.getItemsByType=function(t){var e=this;return this.getList(function(i){return i.meta.type==t&&!e.isEquiped(i.id)})},e.prototype.getItemsByTypes=function(t,e){var i=this;return void 0===e&&(e=null),this.getList(function(n){return t.indexOf(n.meta.type)>=0&&!i.isEquiped(n.id,e)})},e.prototype.isEquiped=function(t,e){void 0===e&&(e=null);var i=!1;return ministerService.ministers.some(function(n){return n!=e&&n.isEquipedItem(t)?(i=!0,!0):void 0}),i},e.prototype.getCombinableItems=function(){var t=this;return GameConfig.getCombinableItemMetas().map(function(e){var i=t.getItemByMetaId(e.id);return i&&i.count>0?i:(i=new ItemEntity,i.inject({metaId:e.id,count:0}),i)})},e.prototype.getItemById=function(t){var e=null;return this.itemList.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getItemByMetaId=function(t){var e=null;return this.itemList.some(function(i){return i.meta&&i.meta.id==t?(e=i,!0):void 0}),e},e.prototype.getItemArrByMetaId=function(t){var e=[];return this.itemList.forEach(function(i){i.meta&&i.meta.id==t&&e.push(i)}),e},e.prototype.getCountByMetaId=function(t){switch(t){case 1:return mainService.playerInfo.gold;case 2:return mainService.playerInfo.silver;case 3:return mainService.playerInfo.mineral;case 4:return mainService.playerInfo.area;case 5:return mainService.playerInfo.emerald;case 6:return mainService.playerInfo.troops;default:var e=0;return this.itemList.forEach(function(i){i.meta&&i.meta.id==t&&(e+=i.count)}),e}},e.prototype.getAddItemByType=function(t){var e=this,i=this.getItemsByType(t),n=[];return i.forEach(function(t){var i={id:t.meta.id,count:0};t&&t.meta.max>1?t.fieldsModified.some(function(t){return"count"==t.field&&t.value>t.oldValue?(i.count+=t.value-t.oldValue,t.oldValue=t.value,!0):void 0}):t&&1==t.meta.max&&e.newTreasure.forEach(function(t){t.metaId==i.id&&i.count++}),i.count>0&&n.push(i)}),n},e.prototype.addItem=function(t){var e=new ItemEntity;return e.inject(t),this.itemList.push(e),e},e.prototype.deleteItem=function(t){var e=this;this.itemList.some(function(i,n){return i.id==t?(i.count=0,e.itemList.splice(n,1),!0):void 0})},e.prototype.updateItem=function(t){var e=t.id,i=t.count,n={};if(0==i)this.deleteItem(e),n.type=0;else{var r=this.getItemById(e);r?(n.type=1,r.inject(t)):(r=this.addItem(t),n.type=2,this.newItemValue++,1==r.meta.max&&this.newTreasure.push(r),this.updateBadge()),n.item=r}this.dispatchEventWith(EventNames.UPDATE_ITEM,!1,n)},e.prototype.checkCombine=function(t){var e=this,i=!0,n=GameConfig.getItemMeta(t);return n.material.items.some(function(t){var n=t.id,r=t.count;return e.getCountByMetaId(n)<r?(i=!1,!0):void 0}),i},e.prototype.combineItem=function(t){if(this.checkCombine(t)){var e=GameConfig.getItemMeta(t);gameServer.send(protocols.CW_ITEM_COMPOSE_Request,{combineId:e.material.id})}},e.prototype.getItemEffect=function(t,e,i){void 0===i&&(i="\n");var n=GameConfig.getItemMeta(t),r=GameConfig.getSkillLevelMeta(n.skill_id,e);if(r){var o=r.buffers.filter(function(t){return t>0}).map(function(t){var e=GameConfig.getBufferMeta(t);return alien.StringUtils.format(e.intro,Math.abs(e.value))});return i?o.join(i):o}return null},e.prototype.getAddItem=function(t){var e={id:t,count:0},i=this.getItemArrByMetaId(t),n=GameConfig.getItemMeta(t);return n.max>1?i.forEach(function(t){t.fieldsModified.some(function(t){"count"==t.field&&t.value>t.oldValue&&(e.count+=t.value-t.oldValue,t.oldValue=t.value)})}):1==n.max&&this.newTreasure.forEach(function(t){t.metaId==e.id&&e.count++}),e},e.prototype.getRandomAddItems=function(t){var e=this,i=[],n=GameConfig.getChestMeta(t);return n.items.forEach(function(t){var n=e.getAddItem(t.id);if(n.count){var r=GameConfig.getItemMeta(n.id);if(1==r.max)for(var o=0;o<n.count;++o)i.push({id:n.id,count:1});else i.push(n)}}),i},e.prototype.setNowItem=function(t,e,i){this.nowItem.metaId=t,this.nowItem.count=e,this.nowItem.targetId=i},e.prototype.useItem=function(t,e,i){void 0===i&&(i=""),gameServer.send(protocols.CW_ITEM_USE_Request,{id:t,count:e,targetId:i})},e.prototype.itemUpgrade=function(t,e,i){gameServer.send(protocols.CW_EquipStrengthen_REQUEST,{item_id:t,minister_id:e,material:i})},e}(Service);__reflect(PackService.prototype,"PackService");var PrinceService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.princes=[],e.awardRequestNum=1,e.awardResponseNum=0,e.awards=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_INIT_PRINCE_NOTIFY,this.onInitPrinceNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PRINCE_NOTIFY,this.onUpdatePrinceNotify,this),this.registerEvent(gameServer,protocols.WC_PRICESS_ADDACTIVITY_RESPONSE,this.onAddActivityResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_TRAIN_RESPONSE,this.onTrainResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_RENAME_RESPONSE,this.onRenameResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_OPENHOURSE_RESPONSE,this.onOpenHouseResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_AWARDITEM_RESPONSE,this.onAwardItemResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_DELETE_RESPONSE,this.onDeleteResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_ADDMAXSLOT_RESPONSE,this.onAddMaxSlotResponse,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.princes.splice(0)})},e.prototype.onInitPrinceNotify=function(t){var e=this;this.princes.splice(0),t.data.princes.forEach(function(t){t&&e.add(t)}),this.sort(),this.updateBadge()},e.prototype.onUpdatePrinceNotify=function(t){var e=this.getById(t.data.id),i=!princess;e?e.inject(t.data):(e=this.add(t.data),this.dispatchEventWith(EventNames.ADD_PRINCE,!1,{prince:e})),this.updateBadge(),this.dispatchEventWith(EventNames.UPDATE_PRINCE,!1,{prince:e,added:i}),i&&alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"prince_add"})},e.prototype.onAddActivityResponse=function(t){},e.prototype.onTrainResponse=function(t){},e.prototype.onRenameResponse=function(t){},e.prototype.onOpenHouseResponse=function(t){},e.prototype.onAwardItemResponse=function(t){var e=this;this.awardResponseNum++,0==t.data.error&&t.data.items.forEach(function(t){var i=e.getAwardById(t.id);i?e.updateAward(t):t.count>0&&e.awards.push(t)}),this.awardResponseNum==this.awardRequestNum&&(this.awardResponseNum=0,this.awardRequestNum=1,this.awards.length>0&&PanelWorkFinish.instance.show({type:2,reward:this.awards,princess:null},function(){e.awards.splice(0)}))},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22410,count:this.getTrainCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22420,count:this.getAwardPrinces().length})},e.prototype.getTrainCount=function(){var t=0;return this.getNoblesPrinces().forEach(function(e){e.activity>0&&t++}),t},e.prototype.getAwardById=function(t){var e=null;return this.awards.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.updateAward=function(t){this.awards.some(function(e){return t.id==e.id?(e.count+=t.count,!0):void 0})},e.prototype.onDeleteResponse=function(t){},e.prototype.onAddMaxSlotResponse=function(t){},e.prototype.onLoginGame=function(t){this.updateBadge()},e.prototype.getById=function(t){var e=null;return this.princes.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getByMinisterId=function(t){var e=null;return this.princes.some(function(i){return i.ministerId==t?(e=i,!0):void 0}),e},e.prototype.deleteLocalPrince=function(t){var e=this;this.princes.some(function(i,n){return i.id==t?(e.princes.splice(n,1),!0):void 0})},e.prototype.getAwardPrinces=function(){var t=[];return this.getOpenPrinces().forEach(function(e){e.openTime-mainService.tsServer<=0&&e.peerage>0&&t.push(e)}),t},e.prototype.sort=function(){this.princes.sort(function(t,e){return e.level-t.level})},e.prototype.add=function(t){var e=new PrinceEntity;return e.inject(t),this.princes.push(e),e},e.prototype.getOpenPrinces=function(){var t=[];return this.princes.forEach(function(e){e.openFlag>0&&t.push(e)}),t},e.prototype.getNoblesPrinces=function(){var t=[];return this.princes.forEach(function(e){e.openFlag<=0&&t.push(e)}),t},e.prototype.getPrinceSeat=function(){var t=0,e=technologyService.getById(402013),i=0;if(e){var n=GameConfig.getBufferMeta(e.meta.levels[e.level].effect);n&&(i=n.value)}t=2+i;var r=activityTimeService.getById(55);r&&(t+=r["int"]);var o=GameConfig.getVipMeta(mainService.playerInfo.vip);return o&&(t+=o.prince_seats),t},e.prototype.getMaxEnergy=function(){var t=3,e=GameConfig.getVipMeta(mainService.playerInfo.vip);return e&&(t+=e.activity_limit),t},e.prototype.addActivity=function(t,e){gameServer.send(protocols.CW_PRICESS_ADDACTIVITY_REQUEST,{princeId:t,itemId:e})},e.prototype.train=function(t,e){gameServer.send(protocols.CW_PRICESS_TRAIN_REQUEST,{ministerId:t,princeId:e})},e.prototype.rename=function(t,e){gameServer.send(protocols.CW_PRICESS_RENAME_REQUEST,{princeId:t,name:e})},e.prototype.openHouse=function(t,e){gameServer.send(protocols.CW_PRICESS_OPENHOURSE_REQUEST,{princeId:t,type:e})},e.prototype.awardItem=function(t){gameServer.send(protocols.CW_PRICESS_AWARDITEM_REQUEST,{princeId:t})},e.prototype.deletePrince=function(t){gameServer.send(protocols.CW_PRICESS_DELETE_REQUEST,{princeId:t})},e.prototype.addMaxSlot=function(){gameServer.send(protocols.CW_PRICESS_ADDMAXSLOT_REQUEST,{})},e}(Service);__reflect(PrinceService.prototype,"PrinceService");var PrincessService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.riteActivityTime=[41,42,43,44],e.riteMax=4,e.princesses=[],e.workData=[{id:31,charm:20,type:0,princessId:null,timestamp:0,count:1,needTime:60},{id:32,charm:50,type:1,princessId:null,timestamp:0,count:2,needTime:120},{id:33,charm:100,type:2,princessId:null,timestamp:0,count:3,needTime:180},{id:34,charm:200,type:3,princessId:null,timestamp:0,count:4,needTime:240}],e.flowerMax=4,e.flowerData=[{id:45,flowerId:0,princessId:null,timestamp:0,pos:0},{id:46,flowerId:0,princessId:null,timestamp:0,pos:1},{id:47,flowerId:0,princessId:null,timestamp:0,pos:2},{id:48,flowerId:0,princessId:null,timestamp:0,pos:3}],e.energyId=30,e.cashGiftActivityIds=[380,381],e.partyActivityIds=[],e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(gameServer,protocols.WC_INIT_PRINCESS_NOTIFY,this.onInitPrincessNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PRINCESS_NOTIFY,this.onUpdatePrincessNotify,this),this.registerEvent(gameServer,protocols.WC_SUPPORT_PRINCESS_Response,this.onLuckResponse,this),this.registerEvent(gameServer,protocols.WC_AWARD_PRINCESS_Response,this.onGiveItemResponse,this),this.registerEvent(gameServer,protocols.WC_BESTOWED_PRINCESS_Response,this.onPrincessManageResponse,this),this.registerEvent(gameServer,protocols.WC_TURNCARD_PRINCESS_Response,this.onTurnCardResponse,this),this.registerEvent(gameServer,protocols.WC_CHOOSE_PRINCESS_Response,this.onChoosePrincessResponse,this),this.registerEvent(gameServer,protocols.WC_LEARNRITE_PRINCESS_Response,this.onLearnRiteResponse,this),this.registerEvent(gameServer,protocols.WC_ADDMAXSLOT_PRINCESS_Response,this.onAddMaxSlotResponse,this),this.registerEvent(gameServer,protocols.WC_DISPATCH_PRINCESS_Response,this.onDispatchPrincessResponse,this),this.registerEvent(gameServer,protocols.WC_FINISH_PRINCESS_Response,this.onFinishPrincessResponse,this),this.registerEvent(gameServer,protocols.WC_PLANTFLOWER_PRINCESS_Response,this.onPlantFlowerPrincessResponse,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this),this.registerEvent(gameServer,protocols.WC_DINNERINFO_Notify,this.onDinnerInfoNotify,this),this.registerEvent(gameServer,protocols.WC_JOIN_DINNER_RESPONSE,this.onJoinDinnerResponse,this),this.registerEvent(gameServer,protocols.WC_BUY_RANDOMSHOP_RESPONSE,this.onBuyRandomShopResponse,this),this.registerEvent(gameServer,protocols.WC_OPEN_RANDOMSHOP_RESPONSE,this.onOpenRandomShopResponse,this),this.registerEvent(gameServer,protocols.WC_REFLASH_RANDOMSHOP_RESPONSE,this.onRefreshRandomShopResponse,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.partyData=new partyEntity,e.partyActivityIds.splice(0);for(var t=601;680>=t;++t)e.partyActivityIds.push(t)})},e.prototype.onInitPrincessNotify=function(t){var e=this;this.princesses.splice(0),t.data.princesses.forEach(function(t){return e.add(t)}),this.sort()},e.prototype.onUpdatePrincessNotify=function(t){var e=this.getById(t.data.id),i=!e;e?e.inject(t.data):e=this.add(t.data),this.dispatchEventWith(EventNames.UPDATE_PRINCESS,!1,{princess:e,added:i}),i&&alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"princess_add_"+e.metaId})},e.prototype.onDinnerInfoNotify=function(t){this.partyData||(this.partyData=new partyEntity),this.partyData.inject(t.data),0==this.partyData.round&&1==this.partyData.state&&(this.isInPartyList()||(this.partyData=new partyEntity),this.dispatchEventWith(EventNames.PARTY_START)),this.dispatchEventWith(EventNames.PARTY_TURN_START)},e.prototype.onLuckResponse=function(t){},e.prototype.onGiveItemResponse=function(t){},e.prototype.onPrincessManageResponse=function(t){},e.prototype.onTurnCardResponse=function(t){},e.prototype.onChoosePrincessResponse=function(t){},e.prototype.onLearnRiteResponse=function(t){},e.prototype.onAddMaxSlotResponse=function(t){switch(t.data.type){case 0:this.dispatchEventWith(EventNames.REFRESH_LEARN_RITE_QUEUE);break;case 1:this.dispatchEventWith(EventNames.REFRESH_FLOWER_DATA)}},e.prototype.onDispatchPrincessResponse=function(t){},e.prototype.onFinishPrincessResponse=function(t){switch(t.data.type){case 1:}},e.prototype.onPlantFlowerPrincessResponse=function(t){},e.prototype.onLoginGame=function(t){this.updateBadge()},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":var e=activityTimeService.getActivityTimesByIds([40])[0];e&&(this.riteTeacher=ministerService.getMinisterById(e.str));break;case"add":break;case"remove":if(40==t.data.activityTime.id)this.riteTeacher=null,this.dispatchEventWith(EventNames.REFRESH_LEARN_RITE_TEACHER);else{if(!(this.cashGiftActivityIds.indexOf(t.data.activityTime.id)>=0))break;this.openRandomShop()}}"init"!=t.data.type&&this.riteActivityTime.indexOf(t.data.activityTime.id)>=0?(this.dispatchEventWith(EventNames.REFRESH_LEARN_RITE_QUEUE),this.updateBadge()):"init"!=t.data.type&&this.energyId==t.data.activityTime.id?(this.dispatchEventWith(EventNames.REFRESH_TURN_CARD_DATA),this.updateBadge()):"init"!=t.data.type&&this.cashGiftActivityIds.indexOf(t.data.activityTime.id)>=0&&this.dispatchEventWith(EventNames.REFRESH_CASH_GIFT_SHOP),this.workDataUpdate(t.data),this.flowerDataUpdate(t.data)},e.prototype.onJoinDinnerResponse=function(t){},e.prototype.onBuyRandomShopResponse=function(t){},e.prototype.onOpenRandomShopResponse=function(t){},e.prototype.onRefreshRandomShopResponse=function(t){},e.prototype.workDataUpdate=function(t){var e=this;"init"==t.type?this.workData.forEach(function(t){var e=activityTimeService.getById(t.id);e?(t.princessId=e.str,t.timestamp=e["int"]):(t.princessId=null,t.timestamp=0)}):"remove"==t.type?this.workData.some(function(i){return i.id==t.activityTime.id?(i.princessId=null,i.timestamp=0,e.updateBadge(),e.dispatchEventWith(EventNames.REFRESH_WORK_DATA),!0):void 0}):this.workData.some(function(i){return i.id==t.activityTime.id?(i.princessId=t.activityTime.str,i.timestamp=t.activityTime["int"],e.updateBadge(),e.dispatchEventWith(EventNames.REFRESH_WORK_DATA),!0):void 0})},e.prototype.flowerDataUpdate=function(t){var e=this,i=activityTimeService.getActivityTimesByIds([49])[0];i&&this.flowerData.forEach(function(t,e){var n=6e5+(i["int"]>>8*e&255);t.flowerId=n>6e5?n:t.flowerId}),"init"==t.type?this.flowerData.forEach(function(t){var e=activityTimeService.getById(t.id);e?(t.princessId=e.str,t.timestamp=e["int"]):(t.flowerId=0,t.princessId=null,t.timestamp=0)}):"remove"==t.type?this.flowerData.some(function(i){return i.id==t.activityTime.id?(i.princessId=null,i.flowerId=0,i.timestamp=0,e.dispatchEventWith(EventNames.REFRESH_FLOWER_DATA),e.updateBadge(),!0):void 0}):this.flowerData.some(function(i){return i.id==t.activityTime.id?(i.princessId=t.activityTime.str,i.timestamp=t.activityTime["int"],e.dispatchEventWith(EventNames.REFRESH_FLOWER_DATA),e.updateBadge(),!0):void 0})},e.prototype.getPrincessByMetaId=function(t){var e=null;return this.princesses.some(function(i){return i.meta.id==t?(e=i,!0):void 0}),e},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:23110,count:this.getTurnCardEnergy()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:23200,count:this.getWorkBadgeCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:23300,count:this.getRiteBadgeCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:23410,count:this.getFlowerBadgeCount()})},e.prototype.getTurnCardEnergy=function(){var t=0,e=activityTimeService.getById(this.energyId);return e&&(t=e["int"]),t},e.prototype.getMaxEnergy=function(){var t=5,e=GameConfig.getVipMeta(mainService.playerInfo.vip);return e&&(t+=e.energy_limit),t},e.prototype.getWorkBadgeCount=function(){var t=this,e=0,i=this.getFreePrincess();return this.workData.forEach(function(n){var r=i.filter(function(t){return t.charm>=n.charm&&t.state<=0});r=r.filter(function(e){var i=!0;return t.workData.some(function(t){return t.princessId==e.id?(i=!1,!0):void 0}),i}),(null==n.princessId&&r.length>0||n.timestamp>0&&n.timestamp-mainService.tsServer<=0)&&e++}),e},e.prototype.getRiteBadgeCount=function(){var t=0,e=this.getFreePrincess();return this.getRiteQueue().forEach(function(i){i&&(!i.princess&&e.length>0||i.activityTime&&i.activityTime.timestamp-mainService.tsServer<=0)&&t++}),t},e.prototype.getFlowerBadgeCount=function(){var t=0,e=this.getFreePrincess();return this.getFlower().forEach(function(i){i&&(null==i.princessId&&e.length>0||i.timestamp>0&&i.timestamp-mainService.tsServer<=0)&&t++}),t},e.prototype.getById=function(t){var e=null;return this.princesses.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getByMetaId=function(t){var e=null;return this.princesses.some(function(i){return i.meta.id==t?(e=i,!0):void 0}),e},e.prototype.sort=function(){this.princesses.sort(function(t,e){return e.luck+e.charm-(t.luck+t.charm)})},e.prototype.add=function(t){var e=new PrincessEntity;return e.inject(t),this.princesses.push(e),e},e.prototype.getUnHirePrincessMetas=function(){var t=this;return alien.Utils.objectValues(GameConfig.princesses).filter(function(e){return GameConfig.princessFilters.indexOf(e.id)<0&&0!=e.hire_type&&1!=e.hire_type&&!t.checkHire(e.id)})},e.prototype.checkHire=function(t){return this.princesses.filter(function(e){return e.metaId==t}).length>0},e.prototype.getPositionGroup=function(t){for(var i=e.positionGroup[t],n=this.princesses.filter(function(t){return t.position==i.index}).map(function(t){return{princess:t,group:i}}),r=n.length;r<i.count;r++)n.push({princess:null,group:i});return(1==i.index||2==i.index||3==i.index)&&n.push({princess:null,group:i}),n},e.prototype.getTopGroup=function(){var t=this.princesses.reduce(function(t,e){return e.position>0?Math.max(t,e.position):t},-1);return 0>t&&(t=8),8-t},e.prototype.getPositionManageSource=function(t){var e=t.index;return this.princesses.filter(function(e){return e.rite>=t.condition&&e.position<=t.index}).sort(function(t,i){var n=t.position==e,r=i.position==e;return n&&!r?-1:!n&&r?1:i.rite-t.rite})},e.prototype.getPositionIsFull=function(t){var e=0;return this.princesses.forEach(function(i){i.position==t.index&&e++}),e<t.count||0==t.count?!1:!0},e.prototype.getRiteQueue=function(){for(var t=[],e=activityTimeService.getActivityTimesByIds(this.riteActivityTime,!1),i=mainService.playerInfo.learnRiteMax,n=0;i>n;n++){var r=e[n];t.push(r?{princess:this.getById(r.str),activityTime:{id:r.id,timestamp:r["int"]}}:{})}return i<this.riteMax&&t.push(null),t},Object.defineProperty(e.prototype,"canSwitchTeacher",{get:function(){return 0==activityTimeService.getActivityTimesByIds(this.riteActivityTime).length},enumerable:!0,configurable:!0}),e.prototype.selectFlower=function(t){var e=t.id,i=t.flowerId;this.flowerData.some(function(t){return t.id==e?(t.flowerId=i,!0):void 0})},e.prototype.getFlower=function(){for(var t=[],e=mainService.playerInfo.plantMax,i=0;e>i;++i)t.push(this.flowerData[i]);return e<this.flowerMax&&t.push(null),t},e.prototype.getPartyMessages=function(){for(var t=[],e=[],i=0;i<this.partyData.players.length;++i)if(this.partyData.players[i].id){var n=this.partyData.players[i].id==dataCenterService.pid?"418C04":"FC1A0A",r="dispatch_"+(0==i?"hold":"join"),o=GameConfig.getPrincessMeta(this.partyData.players[i].princessId),s=lang.formatHtml(lang.princess_party_log[r],n,this.partyData.players[i].name,o.name);e.push(s)}t.push(e);for(var i=1;i<=this.partyData.round;i++){for(var a=[lang.formatHtml(lang.princess_party_log.round,i)],c=0;c<this.partyData.players.length;++c){var n=this.partyData.players[c].id==dataCenterService.pid?"418C04":"FC1A0A",o=GameConfig.getPrincessMeta(this.partyData.players[c].princessId),l=this.partyData.roundInfo[c].info[i-1].score,p=l>0?"+"+l:l+"",s=lang.formatHtml(lang.princess_party_log.score,n,this.partyData.players[c].name,o.name,p,this.getNowScore(c,i));a.push(s)}for(var c=0;c<this.partyData.players.length;++c){var n=this.partyData.players[c].id==dataCenterService.pid?"418C04":"FC1A0A",o=GameConfig.getPrincessMeta(this.partyData.players[c].princessId),h=this.partyData.roundInfo[c].info[i-1].princessSkill>>4&15,u=15&this.partyData.roundInfo[c].info[i-1].princessSkill;if(!(0>=h)){var _=void 0;switch(h){case 1:_=lang.party_theme[this.partyData.type];break;case 2:case 8:_=this.partyData.players[u].name;break;default:_=""}var s=lang.formatHtml(lang.princess_party_log.skill+lang.party_skill_desc[h],n,this.partyData.players[c].name,o.name,_);a.push(s)}}t.push(a)}return t},e.prototype.getCashGiftList=function(){var t=[],e=activityTimeService.getActivityTimesByIds(this.cashGiftActivityIds);return e.forEach(function(e){for(var i=Base64.decode(e.str),n=[],r=0;r<i.length/4;++r){var o=i.slice(4*r,4*r+4);n.push(o)}n.forEach(function(e){for(var i=0,n={id:0,buyTime:0},r=0;r<e.length;++r){var o=e.charCodeAt(r);i+=o*Math.pow(256,r)}n.id=i>>16&65535,n.buyTime=65535&i,n.id>0&&t.push(n)})}),t},e.prototype.getNowScore=function(t,e){void 0===e&&(e=this.partyData.round);var i=0;return this.partyData.roundInfo[t].info.some(function(t,n){return n+1>e?!0:void(t&&t.score&&(i+=t.score))}),i},e.prototype.getSeqList=function(){var t=this,e=[];return this.partyData.players.forEach(function(i,n){var r={id:i.id,name:i.name,score:t.getNowScore(n)};e.push(r)}),e.sort(function(t,e){return e.score-t.score})},e.prototype.getSeq=function(t){var e=0,i=this.getSeqList();return i.some(function(i,n){return i.id==t?(e=n,!0):void 0}),e},e.prototype.getScoreById=function(t){var e=0;return this.partyData.players.some(function(i,n){return i.id==t?(e=n,!0):void 0}),this.getNowScore(e)},e.prototype.getPartyRewards=function(){var t=[{id:7,count:0},{id:600096,count:0}],e=0;this.partyData.players.some(function(t){return t.id==dataCenterService.pid?(e=t.type,!0):void 0}),t[0].count+=0==e?500:50,t[1].count+=0==e?10:2;var i=[100,80,60,40,20];return t[0].count+=i[this.getSeq(dataCenterService.pid)]*(0==e?5:1),t},e.prototype.isInPartyList=function(){var t=!1;return this.partyData.players.some(function(e){return e.id==dataCenterService.pid?(t=!0,!0):void 0}),t},e.prototype.isJoinedParty=function(t){var e=!1,i=activityTimeService.getActivityTimesByIds(this.partyActivityIds);return i.some(function(i){return i["int"]==t?(e=!0,!0):void 0
}),e},e.prototype.getPrincessIdInParty=function(){var t=0,e=princessService.partyData;return e&&2!=e.state&&e.players.some(function(e){return e.id==dataCenterService.pid?(t=e.princessId,!0):void 0}),t},e.prototype.getPrincessStateById=function(t){var e=0,i=this.getPrincessByMetaId(this.getPrincessIdInParty());if(i&&t==i.id)return 4;var n=[[41,42,43,44],[45,46,47,48],[31,32,33,34]];return n.some(function(i,n){var r=activityTimeService.getActivityTimesByIds(i),o=!1;return r.some(function(e){return e.str==t?(o=!0,!0):void 0}),o?(e=n+1,!0):void 0}),e},e.prototype.getFreePrincess=function(){var t=this,e=[];return this.princesses.forEach(function(i){0==t.getPrincessStateById(i.id)&&e.push(i)}),e},e.prototype.luck=function(t){gameServer.send(protocols.CW_SUPPORT_PRINCESS_Request,{princessId:t.id})},e.prototype.giveItem=function(t,e){gameServer.send(protocols.CW_AWARD_PRINCESS_Request,{princessId:t.id,itemId:e})},e.prototype.positionManage=function(t,e){gameServer.send(protocols.CW_BESTOWED_PRINCESS_Request,{princessId:t.id,position:e})},e.prototype.turnCard=function(){gameServer.send(protocols.CW_TURNCARD_PRINCESS_Request,null)},e.prototype.choosePrincess=function(t){gameServer.send(protocols.CW_CHOOSE_PRINCESS_Request,{type:t})},e.prototype.learnRite=function(t,e,i){gameServer.send(protocols.CW_LEARNRITE_PRINCESS_Request,{ministerId:t.id,princessId:e.id,pos:i})},e.prototype.addMaxSlot=function(t){gameServer.send(protocols.CW_ADDMAXSLOT_PRINCESS_Request,{type:t})},e.prototype.dispatchPrincess=function(t,e){gameServer.send(protocols.CW_DISPATCH_PRINCESS_Request,{id:t,type:e})},e.prototype.finishPrincess=function(t,e){gameServer.send(protocols.CW_FINISH_PRINCESS_Request,{type:t,slot:e})},e.prototype.plantFlower=function(t,e,i){gameServer.send(protocols.CW_PLANTFLOWER_PRINCESS_Request,{id:t,flowerId:e,pos:i})},e.prototype.joinParty=function(t,e){gameServer.send(protocols.CW_JOIN_DINNER_REQUEST,{type:t,princessId:e})},e.prototype.reqPartyInfo=function(){gameServer.send(protocols.CW_OPEN_DINNER_REQUEST,{playerId:dataCenterService.pid})},e.prototype.buyRandomShop=function(t){gameServer.send(protocols.CW_BUY_RANDOMSHOP_REQUEST,{index:t})},e.prototype.openRandomShop=function(){gameServer.send(protocols.CW_OPEN_RANDOMSHOP_REQUEST,{})},e.prototype.refreshRandomShop=function(){gameServer.send(protocols.CW_REFLASH_RANDOMSHOP_REQUEST,{})},e.positionGroup=[{index:8,count:1,condition:2e5,effect:500},{index:7,count:1,condition:1e5,effect:250},{index:6,count:2,condition:5e4,effect:150},{index:5,count:3,condition:2e4,effect:100},{index:4,count:6,condition:1e4,effect:50},{index:3,count:0,condition:5e3,effect:25},{index:2,count:0,condition:1e3,effect:10},{index:1,count:0,condition:200,effect:5}],e}(Service);__reflect(PrincessService.prototype,"PrincessService");var alien;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.useCount=0,t._textureCache=[],new egret.MovieClipDataFactory(null,null).generateMovieClipData(),t}return __extends(i,e),i.prototype.setupMCData=function(e){if(!e)return void console.warn("empty mcData");this.setupTime=Date.now();var i=this._baseData=e,n=i.meta,r=i.frames,o=i.spriteSheet,s=i.sheetConfig;this._meta=n,n.combine&&(r=t.Utils.objectValues(s.frames)),this._frames=r,this.spriteSheet=o,this.mcData={frames:r,frameRate:this._meta.frameRate,labels:this._meta.labels||[],events:this._meta.events||[]}},i.prototype.$getOffsetByFrame=function(t,e){if(this._frames){var i=this._frames[t-1];e.setTo((this._meta.hasOwnProperty("anchorOffsetX")?-this._meta.anchorOffsetX:0)+(i.offX||0),(this._meta.hasOwnProperty("anchorOffsetY")?-this._meta.anchorOffsetY:0)+(i.offY||0))}},i.prototype.$isTextureValid=function(){return!0},i.prototype.getTextureByFrame=function(t){var e;if(this._frames)if(this._meta.combine){if(this.spriteSheet&&(e=this._textureCache[t],!e)){var i=this._frames[t-1];e=this._textureCache[t]=this.spriteSheet.createTexture(t-1+"",i.x,i.y,i.w,i.h)}}else e=this._frames[t-1];return e},i.prototype.dispose=function(){this._frames=null,this.spriteSheet&&(this.spriteSheet.dispose(),this.spriteSheet=null)},i}(egret.MovieClipData);t.MovieClipData=e,__reflect(e.prototype,"alien.MovieClipData")}(alien||(alien={}));var alien;!function(t){var e=function(){function e(){this.generateQueueMap={},this.generateMap={},this._zipCache={},this._sourceCache={},this._queueMap={},this._metaMap={},this._movieClipDataCache={}}return Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.loadAnimation=function(t,e,i){if(i.combine)return Promise.all([t.file(e+".png").async("arraybuffer").then(function(i){return t.remove(e+".png"),new Promise(function(t){egret.BitmapData.create("arraybuffer",i,function(e){var i=new egret.Texture;i.bitmapData=e,t(i)})})}),t.file(e+".json").async("text").then(function(i){return t.remove(e+".json"),i})]).then(function(t){var n=JSON.parse(t[1]);return{name:e,meta:i,spriteSheet:new egret.SpriteSheet(t[0]),sheetConfig:n}});for(var n=[],r=0;r<i.totalFrame;r++)n.push(Promise.resolve(r).then(function(i){var n=e+"/"+i+".png";return t.file(n).async("arraybuffer").then(function(e){return t.remove(n),new Promise(function(t){egret.BitmapData.create("arraybuffer",e,function(e){t({index:i,bitmapData:e})})})})}));return Promise.all(n).then(function(t){return{name:e,meta:i,frames:t.sort(function(t,e){return t.index-e.index}).map(function(t){var e=new egret.Texture;return e.bitmapData=t.bitmapData,e})}})},e.prototype.promise=function(t,e){if(!e)return Promise.reject("data is empty");if(this._zipCache[t])return Promise.resolve();var i=this._queueMap[t];return i?new Promise(function(t){i.push(t)}):(i=this._queueMap[t]=[],this.addBin(t,e))},e.prototype.resolve=function(t){var e=this._queueMap[t];e.forEach(function(t){t()}),delete this._queueMap[t]},e.prototype.addBin=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(r){switch(r.label){case 0:return i=new JSZip,this._zipCache[t]=i,[4,i.loadAsync(e)];case 1:return r.sent(),[4,i.file("meta.json").async("text")];case 2:return n=r.sent(),this._metaMap[t]=JSON.parse(n),this.resolve(t),[2]}})})},e.prototype.getFileName=function(t){return t.substr(0,t.indexOf("/")>=0?t.indexOf("/"):t.indexOf("."))},e.prototype._generate=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,o,s;return __generator(this,function(a){switch(a.label){case 0:if(this._sourceCache[t])return[3,2];e=void 0;for(i in this._zipCache){n=this._zipCache[i];for(r in n.files)if(this.getFileName(r)==t){e=i;break}if(e)break}return o=this._sourceCache,s=t,[4,this.loadAnimation(this._zipCache[e],t,this._metaMap[e][t])];case 1:o[s]=a.sent(),a.label=2;case 2:return[2,this._sourceCache[t]]}})})},e.prototype.addData=function(t,e){return this.promise(t,e)},e.prototype.destroyData=function(t){var e=this._metaMap[t],i=!!e;if(i){for(var n in e)this.destroyMovieClipData(n);delete this._zipCache[t],delete this._metaMap[t]}return i},e.prototype.destroyMovieClipData=function(t){var e=this._movieClipDataCache[t];e&&(e.dispose(),delete this._movieClipDataCache[t],delete this._sourceCache[t])},e.prototype.waitForGenerate=function(t){var e=this.generateQueueMap[t];return e||(e=this.generateQueueMap[t]=[]),new Promise(function(t){e.push(t)})},e.prototype.generateMovieClipData=function(e){return __awaiter(this,void 0,void 0,function(){var i,n,r;return __generator(this,function(o){switch(o.label){case 0:return i=this._movieClipDataCache[e],i?[3,4]:this.generateMap[e]?[4,this.waitForGenerate(e)]:[3,2];case 1:return o.sent(),i=this._movieClipDataCache[e],[3,4];case 2:return this.generateMap[e]=!0,i=new t.MovieClipData,r=(n=i).setupMCData,[4,this._generate(e)];case 3:r.apply(n,[o.sent()]),this._movieClipDataCache[e]=i,delete this.generateMap[e],this.generateQueueMap[e]&&this.generateQueueMap[e].forEach(function(t){t()}),delete this.generateQueueMap[e],o.label=4;case 4:return[2,i]}})})},e.prototype.checkGC=function(){for(var t in this._movieClipDataCache){var e=this._movieClipDataCache[t];0==e.useCount&&Date.now()-e.setupTime>1e4&&this.destroyMovieClipData(t)}},e}();t.MovieClipDataFactory=e,__reflect(e.prototype,"alien.MovieClipDataFactory")}(alien||(alien={}));var ShopService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shopActivityTime=[],e.incenseShopActTime=[],e.vipFlags=[],e.chargeActivityTime=[701,702,703,704,705,706],e.vipActTime=550,e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_ITEM_BUY_RESPONSE,this.onItemBuyResponse,this),this.registerEvent(gameServer,protocols.WC_RECHARGE_SUCESSS_NOTIFY,this.onRechargeSuccessNotify,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(gameServer,protocols.WC_DRAWITEM_RESPONSE,this.onDrawItemResponse,this),this.registerEvent(gameServer,protocols.WC_VIP_GIFT_RESPONSE,this.onVipGiftResponse,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onUpdatePlayerInfo,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this),this.registerEvent(gameServer,protocols.WC_RECHARGE_FIRST_ITEM_RESPONSE,this.onRechargeFirstItemResponse,this),this.registerEvent(gameServer,ProtocolConfigs.WC_BURNEXCHANGE_RESPONSE,this.onBurnExchangeResponse,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.shopActivityTime.splice(0),e.incenseShopActTime.splice(0);for(var t=200;219>=t;++t)e.shopActivityTime.push(t);for(var t=845;864>=t;++t)e.incenseShopActTime.push(t);return webService.getRechargeConfig().then(function(t){e._rechargeConfig=t})})},e.prototype.onItemBuyResponse=function(t){},e.prototype.onRechargeSuccessNotify=function(t){t.data.id;alien.Dispatcher.dispatch(EventNames.HIDE_WAITING),Alert.show(lang.recharge_success)},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":break;case"add":case"remove":this.shopActivityTime.indexOf(t.data.activityTime.id)>=0||this.chargeActivityTime.indexOf(t.data.activityTime.id)>=0&&this.dispatchEventWith(EventNames.REFRESH_CHARGE)}"init"!=t.data.type&&t.data.activityTime.id==this.vipActTime&&this.updateBadge()},e.prototype.onDrawItemResponse=function(t){},e.prototype.onVipGiftResponse=function(t){},e.prototype.onUpdatePlayerInfo=function(t){var e=t.data.field;"conquest"==e&&this.updateBadge()},e.prototype.onLoginGame=function(t){this.updateBadge()},e.prototype.onRechargeFirstItemResponse=function(t){},e.prototype.onBurnExchangeResponse=function(t){},e.prototype.getBuyCnt=function(t){var e=0,i=activityTimeService.getActivityTimesByIds(this.shopActivityTime);return i.some(function(i){return i["int"]==t?(e=parseInt(i.str),!0):void 0}),e},e.prototype.updateVipFlag=function(t,e){var i=this;0==t?this.vipFlags.some(function(t,n){return t==e?(i.vipFlags.splice(n,1),!0):void 0}):this.vipFlags.push(e)},e.prototype.getVipFlag=function(t){var e=!1;return this.vipFlags.some(function(i){return t==i?(e=!0,!0):void 0}),e},e.prototype.clearVipFlag=function(){this.vipFlags.splice(0)},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24300,count:this.getTreasureCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21340,count:this.getVipCount()})},e.prototype.getTreasureCount=function(){var t=0,e=1e3,i=packService.getCountByMetaId(600103),n=packService.getCountByMetaId(600104);return mainService.playerInfo.conquest>=e&&t++,t+=i+n},e.prototype.getVipCount=function(){var t=activityTimeService.getById(this.vipActTime),e=alien.Utils.objectValues(GameConfig.vip),i=0;return t?e.forEach(function(e){(t["int"]>>e.level-1&1)<=0&&mainService.playerInfo.vip>=e.level&&i++}):i=mainService.playerInfo.vip,i},e.prototype.getVipGiftState=function(t){var e=activityTimeService.getById(this.vipActTime),i=0;return e&&(i=e["int"]>>t-1&1),i},e.prototype.isFirstCharge=function(t){var e=activityTimeService.getById(this.chargeActivityTime[t-3]);return e?!1:!0},e.prototype.getRechargeList=function(t){return void 0===t&&(t=0),this._rechargeConfig.filter(function(e){return e.type==t})},e.prototype.getRechargeById=function(t){var e=null;return this._rechargeConfig.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getIncenseUsedCnt=function(t){var e=0,i=t+770,n=activityTimeService.getById(i);return n&&(e=n["int"]),e},e.prototype.buyItem=function(t,e){gameServer.send(protocols.CW_ITEM_BUY_REQUEST,{shopId:t,count:e},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.recharge=function(t){var e=alien.Utils.findArr(this._rechargeConfig,function(e){return e.id===t});e&&Recharge.pay(e).then(function(t){},function(t){Toast.show({text:lang.recharge_failed})})},e.prototype.drawItem=function(t){gameServer.send(protocols.CW_DRAWITEM_REQUEST,{type:t})},e.prototype.getVipGift=function(t){gameServer.send(protocols.CW_VIP_GIFT_REQUEST,{giftId:t})},e.prototype.getFirstChargeGift=function(){gameServer.send(protocols.CW_RECHARGE_FIRST_ITEM_REQUEST,{})},e.prototype.burnExchange=function(t,e){gameServer.send(protocols.CW_BURNEXCHANGE_REQUEST,{seq:t,count:e})},e.Treasure={TYPE_DRAGON_ONE:1,TYPE_DRAGON_TEN:2,TYPE_CONQUER_ONE:3,TYPE_CONQUER_FIVE:4},e.Shop={TYPE_ITEM:1,TYPE_GIFT:2,TYPE_INCENSE:3},e.Exchange={TYPE_UNION:2,TYPE_INCENSE:3},e}(Service);__reflect(ShopService.prototype,"ShopService");var TaskService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tasks=[],e.finishId=0,e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_INIT_TASK_NOTIFY,this.onInitTaskNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_TASK_NOTIFY,this.onUpdateTaskNotify,this),this.registerEvent(gameServer,protocols.WC_FINISHTIME_RESPONSE,this.onFinishTimeResponse,this)},e.prototype.onInitTaskNotify=function(t){var e=this;this.tasks.splice(0),t.data.tasks.forEach(function(t){return e.add(t)}),this.updateBadge()},e.prototype.onUpdateTaskNotify=function(t){var e=this.getById(t.data.id);e?e.inject(t.data):e=this.add(t.data),this.dispatchEventWith(EventNames.UPDATE_TASK,!1,{task:e}),this.updateBadge()},e.prototype.onFinishTimeResponse=function(t){},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21210,count:this.getFinishTaskCountByType(1)}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21220,count:this.getFinishTaskCountByType(2)}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:21230,count:this.getFinishTaskCountByType(3)})},e.prototype.getFinishTaskCount=function(){var t=0;return this.tasks.forEach(function(e){e.value>=e.meta.finish_value&&0==e.flag&&t++}),t},e.prototype.getFinishTaskCountByType=function(t){var e=0;return this.tasks.forEach(function(i){i.value>=i.meta.finish_value&&0==i.flag&&i.meta.type==t&&e++}),e},e.prototype.getById=function(t){var e=null;return this.tasks.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.add=function(t){var e=new TaskEntity;return e.inject(t),this.tasks.push(e),e},e.prototype.getTasksByType=function(t){var e=[];this.tasks.forEach(function(i){3==t?i.meta.type!=t||0!=i.flag&&0!=i.meta.next_id||e.push(i):i.meta.type==t&&e.push(i)});var i=[],n=[],r=[];return e.forEach(function(t){1==t.flag?n.push(t):t.value>=t.meta.finish_value?i.push(t):r.push(t)}),r.sort(function(t,e){return t.id-e.id}),e.splice(0),e=i.concat(r).concat(n)},e.prototype.getLobbyTask=function(){var t=[],e=null;return this.tasks.forEach(function(e){0==e.flag&&e.value>=e.meta.finish_value&&t.push(e)}),t.sort(function(t,e){return t.id-e.id}),0==t.length?(this.tasks.some(function(t){return 1==t.meta.type&&0==t.flag?(e=t,!0):void 0}),e||this.tasks.some(function(t){return 0==t.flag&&(e=t),!0})):e=t[0],e},e.prototype.getTaskFinishStatus=function(t){var e=!1;switch(t.meta.finish_type){case 68:e=t.value<=t.meta.finish_value&&t.value>0;break;default:e=t.value>=t.meta.finish_value}return e},e.prototype.finishTime=function(t){this.finishId=t,gameServer.send(protocols.CW_FINISHTIME_REQUEST,{id:t},Server.SERVER_TYPE.WORLDSERVER)},e}(Service);__reflect(TaskService.prototype,"TaskService");var TechnologyService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.technology=[],e.techActivityTime=[70,71,72],e.needValue=0,e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_INIT_TECHNOLOGY_NOTIFY,this.onInitTechnologyNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_TECHNOLOGYNOTIFY,this.onUpdateTechnologyNotify,this),this.registerEvent(gameServer,protocols.WC_TECHNOLOGY_LEVELUP_RESPONSE,this.onTechnologyLevelUpResponse,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(mainService,EventNames.LOGIN_GAME,this.onLoginGame,this)},e.prototype.onInitTechnologyNotify=function(t){var e=this;this.technology.splice(0),t.data.technology.forEach(function(t){return e.add(t)})},e.prototype.onUpdateTechnologyNotify=function(t){var e=this.getById(t.data.id);e?e.inject(t.data):e=this.add(t.data),this.dispatchEventWith(EventNames.UPDATE_TECHNOLOGY,!1,{technology:e})},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":break;case"add":case"remove":case"update":if(!(this.techActivityTime.indexOf(t.data.activityTime.id)>=0))break;var e=this.getById(t.data.activityTime["int"]);this.updateBadge(),this.dispatchEventWith(EventNames.REFRESH_TECHNOLOGY,!1,{technology:e})}},e.prototype.onLoginGame=function(t){this.updateBadge()},e.prototype.onTechnologyLevelUpResponse=function(t){},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:22300,count:this.getDevelopCount()})},e.prototype.getDevelopCount=function(){var t=0,e=ministerService.getFreeMinisters();return t=e.length>0?this.getMaxQueue()-this.getDevelopingQueue():0},e.prototype.getById=function(t){var e=null;return this.technology.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.getSkillAddition=function(t){var e=0,i=this.getById(t);if(i&&i.level>0){var n=GameConfig.getTechLevelMeta(t,i.level),r=GameConfig.getBufferMeta(n.effect);e=r.value}return e},e.prototype.add=function(t){var e=new TechnologyEntity;return e.inject(t),this.technology.push(e),e},e.prototype.getMaxQueue=function(){var t=1,e=[402004,402010];return this.technology.forEach(function(i){e.some(function(e){if(i.id==e&&i.level>0){var n=GameConfig.getTechLevelMeta(e,i.level),r=GameConfig.getBufferMeta(n.effect);return t+=r.value,!0}})}),t},e.prototype.getDevelopingQueue=function(){var t=activityTimeService.getActivityTimesByIds(this.techActivityTime);return t.length},e.prototype.getTimestamp=function(t){var e=null,i=activityTimeService.getActivityTimesByIds(this.techActivityTime);return i.some(function(i){return t==i["int"]?(e=i,!0):void 0}),e},e.prototype.technologyLeveUp=function(t,e){gameServer.send(protocols.CW_TECHNOLOGY_LEVELUP_REQUEST,{id:t,ministerId:e},Server.SERVER_TYPE.WORLDSERVER)},e}(Service);__reflect(TechnologyService.prototype,"TechnologyService");var UnionService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.contributeList=[{name:lang.union_contribute_name[0].name,costId:1,count:10,effect:lang.union_contribute_name[0].desc,type:0,textColor:769803,contribution:1},{name:lang.union_contribute_name[1].name,costId:1,count:50,effect:lang.union_contribute_name[1].desc,type:1,textColor:29679,contribution:5},{name:lang.union_contribute_name[2].name,costId:1,count:200,effect:lang.union_contribute_name[2].desc,type:2,textColor:8409511,contribution:2e3},{name:lang.union_contribute_name[3].name,costId:600112,count:1,effect:lang.union_contribute_name[3].desc,type:3,textColor:8409511,contribution:4e3},{name:lang.union_contribute_name[4].name,costId:600113,count:1,effect:lang.union_contribute_name[4].desc,type:4,textColor:16219675,contribution:1e4}],e.awardRequestNum=1,e.awardResponseNum=0,e.giftAwards=[],e.deleteGiftIds=[],e.donateActId=390,e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(gameServer,protocols.WC_ORG_INIT_NOTIFY,this.onOrgInitNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_ORG_MEMBER_NOTIFY,this.onUpdateOrgMemberNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_ORG_SKILL_NOTIFY,this.onUpdateOrgSkillNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_ORG_APPLY_NOTIFY,this.onUpdateOrgApplyNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_ORG_LOG_NOTIFY,this.onUpdateOrgLogNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_ORG_NOTIFY,this.onUpdateOrgNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_ORG_GIFT_NOTIFY,this.onUpdateOrgGiftNotify,this),this.registerEvent(gameServer,protocols.WC_DELETE_ORG_APPLY_NOTIFY,this.OnDeleteOrgApplyNotify,this),this.registerEvent(gameServer,protocols.WC_DELETE_ORG_MEMBER_NOTIFY,this.onDeleteOrgMemberNotify,this),this.registerEvent(gameServer,protocols.WC_CreateOrg_Response,this.onCreateOrgResponse,this),this.registerEvent(gameServer,protocols.WC_ApplyOrg_Response,this.onApplyOrgResponse,this),this.registerEvent(gameServer,protocols.WC_JoinOrg_Response,this.onJoinOrgResponse,this),this.registerEvent(gameServer,protocols.WC_LeaveOrg_Response,this.onLeaveOrgResponse,this),this.registerEvent(gameServer,protocols.WC_FireMemberOrg_Response,this.onFireMemberOrgResponse,this),this.registerEvent(gameServer,protocols.WC_DonateOrg_Response,this.onDonateOrgResponse,this),this.registerEvent(gameServer,protocols.WC_SetOrgMasterLevel_Response,this.onSetOrgMasterLevelResponse,this),this.registerEvent(gameServer,protocols.WC_TransferOrgMaster_Response,this.onTransferOrgMasterResponse,this),this.registerEvent(gameServer,protocols.WC_LeaveUpSkill_Response,this.onLeaveUpSkillResponse,this),this.registerEvent(gameServer,protocols.WC_DisbandOrg_Response,this.onDisbandOrgResponse,this),this.registerEvent(gameServer,protocols.WC_SearchOrg_Response,this.onSearchOrgResponse,this),this.registerEvent(gameServer,protocols.WC_SearchOrgTop_Response,this.onSearchOrgTopResponse,this),this.registerEvent(gameServer,protocols.WC_BuyOrgItem_Response,this.onBuyOrgItemResponse,this),this.registerEvent(gameServer,protocols.WC_BuyOrgGift_Response,this.onBuyOrgGiftResponse,this),this.registerEvent(gameServer,protocols.WC_SearchOrgSimple_Response,this.onSearchOrgSimpleResponse,this),this.registerEvent(gameServer,protocols.WC_ChangeOrg_Response,this.onChangeOrgResponse,this),this.registerEvent(gameServer,protocols.WC_GetOrgGift_Response,this.onGetOrgGiftResponse,this),this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPlayerPropsModified,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.union=null})},e.prototype.onOrgInitNotify=function(t){var e=this;this.union||(this.union=new UnionEntity),this.union.members.splice(0),this.union.techs.splice(0),this.union.applyPlayers.splice(0),this.union.gifts.splice(0),this.union.info=null,this.union.inject(t.data),t.data.members.forEach(function(t){return e.addMember(t)}),t.data.techs.forEach(function(t){return e.addTech(t)}),t.data.applyPlayers.forEach(function(t){return e.addApplyPlayer(t)}),t.data.logs.forEach(function(t){return e.addLog(t)}),t.data.gifts.forEach(function(t){return e.addGift(t)}),this.updateBadge()},e.prototype.onUpdateOrgMemberNotify=function(t){var e=this.getMemberById(t.data.member.id);e||(e=this.addMember(t.data.member)),e.inject(t.data.member),this.dispatchEventWith(EventNames.UPDATE_UNION_MEMBER,!1,{optType:0,member:e}),this.updateBadge()},e.prototype.onUpdateOrgSkillNotify=function(t){var e=this.getTechById(t.data.tech.id);e||(e=this.addTech(t.data.tech)),e.inject(t.data.tech),this.dispatchEventWith(EventNames.UPDATE_UNION_TECH,!1,{tech:e})},e.prototype.onUpdateOrgApplyNotify=function(t){var e=this.getApplyPlayerById(t.data.applyPlayer.playerId);e||(e=this.addApplyPlayer(t.data.applyPlayer)),e.inject(t.data.applyPlayer),this.dispatchEventWith(EventNames.UPDATE_UNION_APPLY_PLAYER,!1,{applyPlayer:e}),this.updateBadge()},e.prototype.onUpdateOrgLogNotify=function(t){this.addLog(t.data.log),this.dispatchEventWith(EventNames.UPDATE_UNION_LOG)},e.prototype.onUpdateOrgNotify=function(t){var e=!1;this.union.info.leaderId!=t.data.info.leaderId&&(e=!0),this.union.info.inject(t.data.info),e&&this.union.members.forEach(function(t){t.inject(t)}),this.dispatchEventWith(EventNames.UPDATE_UNION_INFO,!1,{}),this.updateBadge()},e.prototype.onUpdateOrgGiftNotify=function(t){var e=this.getApplyPlayerById(t.data.gift.id);e||(e=this.addGift(t.data.gift)),e.inject(t.data.gift),this.dispatchEventWith(EventNames.UPDATE_UNION_GIFT,!1,null),this.updateBadge()},e.prototype.OnDeleteOrgApplyNotify=function(t){this.deleteApplyPlayer(t.data.id),this.dispatchEventWith(EventNames.UPDATE_UNION_APPLY_PLAYER,!1,{}),this.updateBadge()},e.prototype.onDeleteOrgMemberNotify=function(t){this.deleteMember(t.data.id),this.dispatchEventWith(EventNames.UPDATE_UNION_MEMBER,!1,{optType:1,member:null}),this.updateBadge()},e.prototype.onCreateOrgResponse=function(t){},e.prototype.onApplyOrgResponse=function(t){},e.prototype.onJoinOrgResponse=function(t){},e.prototype.onLeaveOrgResponse=function(t){},e.prototype.onFireMemberOrgResponse=function(t){},e.prototype.onDonateOrgResponse=function(t){},e.prototype.onSetOrgMasterLevelResponse=function(t){},e.prototype.onTransferOrgMasterResponse=function(t){},e.prototype.onLeaveUpSkillResponse=function(t){},e.prototype.onDisbandOrgResponse=function(t){},e.prototype.onSearchOrgResponse=function(t){},e.prototype.onSearchOrgTopResponse=function(t){},e.prototype.onBuyOrgItemResponse=function(t){},e.prototype.onBuyOrgGiftResponse=function(t){},e.prototype.onSearchOrgSimpleResponse=function(t){},e.prototype.onChangeOrgResponse=function(t){},e.prototype.onGetOrgGiftResponse=function(t){var e=this;if(this.awardResponseNum++,0==t.data.error){this.getGiftById(t.data.giftId);this.deleteGiftIds.push(t.data.giftId)}this.awardResponseNum==this.awardRequestNum&&(this.awardResponseNum=0,this.awardRequestNum=1,this.deleteGiftIds.forEach(function(t,i){e.deleteGift(t)}),this.deleteGiftIds.splice(0),this.updateBadge(),this.dispatchEventWith(EventNames.UPDATE_UNION_GIFT,!1,{reward:this.giftAwards}))},e.prototype.onActivityTimeChange=function(t){"init"!=t.data.type&&t.data.activityTime.id==this.donateActId&&this.updateBadge()},e.prototype.onPlayerPropsModified=function(t){var e=t.data.field;if("union_id"==e){var i=t.data,n=i.value,r=i.oldValue;n>r&&this.updateBadge()}},e.prototype.getAwardById=function(t){var e=null;return this.giftAwards.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.updateAward=function(t){this.giftAwards.some(function(e){return t.id==e.id?(e.count+=t.count,!0):void 0})},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24413,count:this.getApplyCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24420,count:this.getDonateCount()}),alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24430,count:this.getGiftCount()})},e.prototype.getApplyCount=function(){return 0==mainService.playerInfo.union_id?0:this.getMyUnionInfo().position<UnionEntity.POSITION.VICE?0:this.union.applyPlayers.length},e.prototype.getGiftCount=function(){var t=0;return 0==mainService.playerInfo.union_id?t:(t+=this.union.gifts.length,t+=this.getMyUnionInfo().giftExp>=this.getBaseGiftExp()?1:0)},e.prototype.getBossCount=function(){},e.prototype.getDonateCount=function(){var t=0;if(0==mainService.playerInfo.union_id)return t;var e=activityTimeService.getById(this.donateActId);return!e&&mainService.playerInfo.gold>=10&&t++,t+=packService.getCountByMetaId(600112),t+=packService.getCountByMetaId(600113)},e.prototype.getMemberById=function(t){var e=null;return this.union.members.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.addMember=function(t){var e=new UnionMemberEntity;return e.inject(t),this.union.members.push(e),e},e.prototype.getTechById=function(t){var e=null;return this.union&&this.union.techs.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.addTech=function(t){var e=new UnionTechEntity;return e.inject(t),this.union.techs.push(e),e},e.prototype.getApplyPlayerById=function(t){var e=null;return this.union.applyPlayers.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.addApplyPlayer=function(t){var e=new UnionApplyEntity;return e.inject(t),this.union.applyPlayers.push(e),e},e.prototype.getGiftById=function(t){var e=null;return this.union.gifts.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.addGift=function(t){var e=new UnionGiftEntity;return e.inject(t),this.union.gifts.push(e),e},e.prototype.addLog=function(t){var e=new UnionLogEntity;return e.inject(t),this.union.logs.push(e),e},e.prototype.deleteApplyPlayer=function(t){var e=this;this.union.applyPlayers.some(function(i,n){return i.id==t?(e.union.applyPlayers.splice(n,1),!0):void 0})},e.prototype.deleteMember=function(t){var e=this;this.union.members.some(function(i,n){return i.id==t?(e.union.members.splice(n,1),!0):void 0})},e.prototype.deleteGift=function(t){var e=this;this.union.gifts.some(function(i,n){return i.id==t?(e.union.gifts.splice(n,1),!0):void 0})},e.prototype.getMyUnionInfo=function(){var t=null;return this.union.members.some(function(e){return e.id==dataCenterService.pid?(t=e,!0):void 0}),t},e.prototype.getLeaderInfo=function(){var t=this,e=null;return this.union.members.some(function(i){return i.id==t.union.info.leaderId?(e=i,!0):void 0}),e},e.prototype.getUnionValueByField=function(t){return"leader"==t?this.getLeaderInfo().name:this.union.info[t]},e.prototype.getPlayerIsOnline=function(t){return 2&t?!1:!0},e.prototype.getIntervalTime=function(t){var e=mainService.tsServer-t;return 0>=t?lang.formatHtml(lang.union_time[0]):60>e?lang.formatHtml(lang.union_time[2],e):3600>e?lang.formatHtml(lang.union_time[3],Math.floor(e/60)):86400>e?lang.formatHtml(lang.union_time[4],Math.floor(e/60/60)):lang.formatHtml(lang.union_time[5],Math.floor(e/60/60/24))},e.prototype.getDonateItemByType=function(t){var e=null;return this.contributeList.some(function(i){return i.type==parseInt(t)?(e=i,!0):void 0}),e},e.prototype.getSevenContributionValue=function(t){var e=this,i=0;return this.union.logs.forEach(function(n){n.sourceName==t&&7==n.optType&&(mainService.tsServer-n.time)/60/60/24<=7&&(i+=e.contributeList[n.val1].contribution)}),i},e.prototype.getPosCount=function(t){var e=0;return this.union.members.forEach(function(i){i.position==t&&e++}),e},e.prototype.getMaxNumByPos=function(t){switch(t){case UnionEntity.POSITION.LEADER:return 1;case UnionEntity.POSITION.VICE:return Math.floor(this.union.info.level/20)+1;case UnionEntity.POSITION.ELITE:return this.union.info.maxEliteNum}return 0},e.prototype.getBaseGiftExp=function(){var t=1e4;return t},e.prototype.getTechAddition=function(t){var e=0,i=this.getTechById(t);if(i&&i.level>0){var n=GameConfig.getTechLevelMeta(t,i.level),r=GameConfig.getBufferMeta(n.effect);e=r.value}return e},e.prototype.buildUnion=function(t,e,i,n){void 0===e&&(e=""),void 0===i&&(i=""),gameServer.send(protocols.CW_CreateOrg_Request,{name:t,qq:e,memo:i,isAutoJoin:n})},e.prototype.applyUnion=function(t){gameServer.send(protocols.CW_ApplyOrg_Request,{id:t})},e.prototype.joinUnion=function(t,e,i){gameServer.send(protocols.CW_JoinOrg_Request,{id:t,playerId:e,optType:i})},e.prototype.leaveUnion=function(t){gameServer.send(protocols.CW_LeaveOrg_Request,{id:t})},e.prototype.frieMember=function(t,e){gameServer.send(protocols.CW_FireMemberOrg_Request,{id:t,playerId:e})},e.prototype.donate=function(t,e){gameServer.send(protocols.CW_DonateOrg_Request,{id:t,type:e})},e.prototype.setPosition=function(t,e,i){gameServer.send(protocols.CW_SetOrgMasterLevel_Request,{id:t,playerId:e,position:i})
},e.prototype.transferLeader=function(t,e){gameServer.send(protocols.CW_TransferOrgMaster_Request,{id:t,playerId:e})},e.prototype.levelUpTech=function(t,e){gameServer.send(protocols.CW_LeaveUpSkill_Request,{id:t,techId:e})},e.prototype.disbandOrg=function(t){gameServer.send(protocols.CW_DisbandOrg_Request,{id:t})},e.prototype.searchUnion=function(){gameServer.send(protocols.CW_SearchOrg_Request,{})},e.prototype.searchTopUnion=function(){gameServer.send(protocols.CW_SearchTopOrg_Request,{})},e.prototype.buyUnionItem=function(t,e,i){gameServer.send(protocols.CW_BuyOrgItem_Request,{id:t,shopId:e,count:i})},e.prototype.buyUnionGift=function(t){gameServer.send(protocols.CW_BuyOrgGift_Request,{id:t})},e.prototype.searchUnionSimple=function(t){gameServer.send(protocols.CW_SearchOrgSimple_Request,{key:t})},e.prototype.changeUnion=function(t,e,i,n,r){gameServer.send(protocols.CW_ChangeOrg_Request,{id:t,qq:e,memo:i,msg:n,autoAcceptJoin:r})},e.prototype.getGift=function(t){gameServer.send(protocols.CW_GetOrgGift_Request,{unionId:this.union.info.id,giftId:t})},e}(Service);__reflect(UnionService.prototype,"UnionService");var VisitService=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cities=[],e.firstFlag=!0,e.eventActTimeId=821,e.cityTreasureActTimeId=830,e.treasureCntActTimeId=825,e}return __extends(e,t),e.prototype.init=function(){this.registerEvent(activityTimeService,EventNames.ACTIVITY_TIME_CHANGE,this.onActivityTimeChange,this),this.registerEvent(gameServer,protocols.WC_INIT_CITY_NOTIFY,this.onInitCityNotify,this),this.registerEvent(gameServer,protocols.WC_UPDATE_CITY_NOTIFY,this.onUpdateCityNotify,this),this.registerEvent(gameServer,protocols.WC_ROLLDICE_RESPONSE,this.onRollDiceResponse,this),this.registerEvent(gameServer,protocols.WC_ROLLFIXEDDICE_RESPONSE,this.onRollFixedDiceResponse,this),this.registerEvent(gameServer,protocols.WC_DEVELOPCITY_RESPONSE,this.onDevelopCityResponse,this),this.registerEvent(gameServer,protocols.WC_INSPECT_RESPONSE,this.onInspectResponse,this),this.registerEvent(gameServer,protocols.WC_INSPECT_AORB_RESPONSE,this.onInspectChooseResponse,this),this.registerEvent(gameServer,protocols.WC_DIG_RESPONSE,this.onDigResponse,this)},e.prototype.start=function(){var e=this;return t.prototype.start.call(this).then(function(){e.cities.splice(0),alien.Utils.objectValues(GameConfig.cities).forEach(function(t){var i=new CityEntity;i.inject({id:t.id,level:1,likeValue:0,developFlag:0}),e.cities.push(i)})})},e.prototype.onInitCityNotify=function(t){var e=this;this.firstFlag=0==t.data.cities.length,t.data.cities.forEach(function(t){var i=e.getById(t.id);i?i.inject(t):i=e.add(t)})},e.prototype.onUpdateCityNotify=function(t){var e=this.getById(t.data.id);e?e.inject(t.data):e=this.add(t.data),this.firstFlag=!1,this.dispatchEventWith(EventNames.UPDATE_CITY,!1,{city:e})},e.prototype.onRollDiceResponse=function(t){},e.prototype.onRollFixedDiceResponse=function(t){},e.prototype.onDevelopCityResponse=function(t){},e.prototype.onInspectResponse=function(t){},e.prototype.onInspectChooseResponse=function(t){},e.prototype.onDigResponse=function(t){},e.prototype.onActivityTimeChange=function(t){switch(t.data.type){case"init":this.updateBadge();break;case"add":case"remove":case"update":75==t.data.activityTime.id||76==t.data.activityTime.id&&(this.dispatchEventWith(EventNames.UPDATE_VISIT_ENERGY),this.updateBadge())}},e.prototype.updateBadge=function(){alien.Dispatcher.dispatch(EventNames.BADGE_DATA_MODIFY,{id:24100,count:this.getEnergy()})},e.prototype.getById=function(t){var e=null;return this.cities.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.add=function(t){var e=new CityEntity;return e.inject(t),this.cities.push(e),e},e.prototype.getKingCity=function(){var t=8001,e=activityTimeService.getById(75);return e&&(t=e["int"]),t},e.prototype.getEnergy=function(){var t=0,e=activityTimeService.getById(76);return e&&(t=e["int"]),t},e.prototype.getCarriageCount=function(){var t=0,e=packService.getItemByMetaId(600093);return e&&(t=e.count),t},e.prototype.getMaxEnergy=function(){var t=5,e=GameConfig.getVipMeta(mainService.playerInfo.vip);return e&&(t+=e.strength_limit),t},e.prototype.getCityCanLevelUp=function(t){var e=this.getById(t);return this.getKingCity()!=t||e.developFlag||e.level>=e.visitMeta.levels[e.visitMeta.levels.length-1].level?!1:!0},e.prototype.getCityTreasuresByCityId=function(t){for(var e=[],i=activityTimeService.getById(this.cityTreasureActTimeId),n=this.getById(t),r=n.getTreasureConfig(),o=(r.row+1)*(r.columns+1),s=0;o>s;++s){var a=0;i&&(a=i["int"]>>s&1),e.push(a)}return e},e.prototype.getTreasureCountByCityId=function(t){var e={sum:0,freeCnt:0},i=this.getById(t),n=i.getTreasureConfig(),r=activityTimeService.getById(this.treasureCntActTimeId);return e.sum=(n.row+1)*(n.columns+1)-r["int"],e.freeCnt=Math.max(n.freeCount-r["int"],0),e},e.prototype.rollDice=function(){gameServer.send(protocols.CW_ROLLDICE_REQUEST,{},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.rollFixedDice=function(t){gameServer.send(protocols.CW_ROLLFIXEDDICE_REQUEST,{value:t},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.developCity=function(t){gameServer.send(protocols.CW_DEVELOPCITY_REQUEST,{type:t},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.inspect=function(){gameServer.send(protocols.CW_INSPECT_REQUEST,{},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.inspectChoose=function(t){gameServer.send(protocols.CW_INSPECT_AORB_REQUEST,{itemId:t},Server.SERVER_TYPE.WORLDSERVER)},e.prototype.dig=function(t){gameServer.send(protocols.CW_DIG_REQUEST,{index:t},Server.SERVER_TYPE.WORLDSERVER)},e}(Service);__reflect(VisitService.prototype,"VisitService");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i,n){function r(n){e.call(i,n,t)}if(void 0===n&&(n=RES.ResourceItem.TYPE_IMAGE),RES.hasRes(t)){var o=RES.getRes(t);o?r(o):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,n)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var lang,accountServer,gameServer,dataCenterService,mainService,packService,activityTimeService,ministerService,princessService,battleService,interiorService,countDownService,badgeService,memorialService,arenaService,princeService,technologyService,emailService,shopService,visitService,taskService,chatService,rankService,activityService,unionService,bossService,openService,finishService,MainStage=function(t){function e(){var e=t.call(this)||this;return e.keeps=["id","isAdult","setting"],e.init(),e.percentWidth=100,e.percentHeight=100,e.skinName=components.MainStageSkin,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){egret.Capabilities.isMobile&&(egret.lifecycle.onPause=function(){egret.ticker.pause(),SoundManager.instance.stopMusic(!0)},egret.lifecycle.onResume=function(){egret.ticker.resume(),SoundManager.instance.playMusic(null,{goon:!0})}),lang=new Language,lang.initData(),accountServer=new AccountServer,gameServer=new GameServer,this.services=[dataCenterService=new DataCenterService,mainService=new MainService,packService=new PackService,activityTimeService=new ActivityTimeService,battleService=new BattleService,ministerService=new MinisterService,princessService=new PrincessService,interiorService=new InteriorService,countDownService=new CountDownService,badgeService=new BadgeService,memorialService=new MemorialService,arenaService=new ArenaService,princeService=new PrinceService,technologyService=new TechnologyService,emailService=new EmailService,shopService=new ShopService,visitService=new VisitService,taskService=new TaskService,chatService=new ChatService,rankService=new RankService,activityService=new ActivityService,unionService=new UnionService,openService=new OpenService,finishService=new FinishService,bossService=new BossService],alien.SoundManager.instance.musicVolume=.2,alien.TickerManager.activate(),alien.Dispatcher.init(),GameConfig.init(),CommonProtocol.instance.ready(null),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){var e=t.target;e.skinName==ui.BackButtonSkin||"ui.BackButtonSkin"==e.skinName?SoundManager.instance.playEffect(ResNames.effect_back):e.skinName==ui.StartGameButtonSkin||"ui.StartGameButtonSkin"==e.skinName?SoundManager.instance.playEffect(ResNames.sound_start_game,{force:!0}):e.skinName==ui.CloseButtonSkin||"ui.CloseButtonSkin"==e.skinName||e.skinName==ui.ShopCloseButtonSkin||"ui.ShopCloseButtonSkin"==e.skinName?SoundManager.instance.playEffect(ResNames.sound_close):e instanceof eui.Button&&e.skinName!=ui.BackButton2Skin&&"ui.BackButton2Skin"!=e.skinName&&SoundManager.instance.playEffect(ResNames.sound_tap_button)},e.prototype.initData=function(t){var e=t.loadingLayer;this.loadingLayer=e,this.addChild(this.loadingLayer)},e.prototype.childrenCreated=function(){this.labVersion.visible=!1,t.prototype.createChildren.call(this),this.labVersion.text="v:"+version,alien.PopUpManager.instance.init(this.popLayer),SceneController.instance.configure(this.sceneContainer),this.start(),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this)},e.prototype.start=function(t){var e=this;return void 0===t&&(t=null),Promise.all(this.services.map(function(t){return t.start()})).then(function(i){e.initSceneToLogin(t)},function(t){})},e.prototype.stop=function(){return Promise.all(this.services.map(function(t){return t.stop()})).then(function(t){accountServer.close(),gameServer.close()},function(t){})},e.prototype.initSceneToLogin=function(t){void 0===t&&(t=null),PopUpManager.removeAllPupUp(),SceneController.popAll(ConstantNames.SCENE_LOGIN,t),GuideLayer.instance.hide()},e.prototype.restart=function(t){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.waitingLayer.show(lang.loginouting),[4,this.stop()];case 1:return e.sent(),[4,this.start(t)];case 2:return e.sent(),this.waitingLayer.hide(),[2]}})})},e.prototype.logout=function(t){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return mainService.logout(),UserLifeCycle.onLogout(),t&&t.selectServer||dataCenterService.clean(this.keeps),Analytics.logEvent("leave_game",{player:mainService.playerBaseInfo}),SoundManager.instance.stopMusic(),this.restart(t),[2]})})},e.prototype.showLoading=function(t){t?(this.loadingLayer.setProgress(0,1),alien.Dispatcher.dispatch(EventNames.SHOW_WAITING,{content:lang.waiting})):alien.Dispatcher.dispatch(EventNames.HIDE_WAITING)},e.prototype.showBlackLayer=function(){var t=this.loadingLayer;return alien.Dispatcher.dispatch(EventNames.CLEAN_FLOAT_NOTIFICATION),Toast.clean(),this.addChildAt(t,1),new Promise(function(e,i){egret.Tween.get(t).to({alpha:1},300).call(function(){e()})})},e.prototype.hideBlackLayer=function(){var t=this,e=this.loadingLayer;return this.contains(e)?new Promise(function(i,n){egret.setTimeout(function(){egret.Tween.get(e).to({alpha:0},300).call(function(){t.contains(e)&&t.removeChild(e),i()})},t,400)}):Promise.resolve()},e.prototype.onResourceProgress=function(t){this.loadingLayer.setProgress(t.itemsLoaded,t.itemsTotal)},e}(eui.Component);__reflect(MainStage.prototype,"MainStage");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var BadgeButton=function(t){function e(){var e=t.call(this)||this;return e.bid="",e.showCount=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.badgeView.bid=this.bid,this.badgeView.showCount=this.showCount},e}(eui.Button);__reflect(BadgeButton.prototype,"BadgeButton");var BadgeView=function(t){function e(){var e=t.call(this)||this;return e._bid=[],e.showCount=!1,e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.update(),this.registerEvent(alien.Dispatcher,EventNames.BADGE_DATA_CHANGE,this.onTipDataChange,this)},e.prototype.onTipDataChange=function(t){var e=t.data.id;this._bid.indexOf(e)>=0&&this.update()},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this.update()},Object.defineProperty(e.prototype,"bid",{get:function(){return this._bid.join()},set:function(t){"string"==typeof t?this._bid.join()!=t&&(this._bid=t.split(",").map(function(t){return parseInt(t)}),this.update()):this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.lab){var t=this.showCount,e=badgeService.getBadgeData(this._bid);if(e){var i=e.count;this.visible=i>0,this.lab.text=i.toString()}else this.visible=!1;this.lab.visible=t,t||(this.lab.text="")}},e}(alien.VisualEventComponent);__reflect(BadgeView.prototype,"BadgeView");var DBBody=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id!=t&&(this._id=t,this.updateID())},enumerable:!0,configurable:!0}),e.prototype.updateID=function(){var t=this,e=this.getResName();RES.getResAsync(e,function(){t.dbName=e},this)},e.prototype.getResName=function(){return""},e}(alien.DBView);__reflect(DBBody.prototype,"DBBody");var MinisterBody=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getResName=function(){return"ani_minister_"+this._id},e}(DBBody);__reflect(MinisterBody.prototype,"MinisterBody");var PrincessBody=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getResName=function(){return"ani_princess_"+this._id},e}(DBBody);__reflect(PrincessBody.prototype,"PrincessBody");var PrinceBody=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getResName=function(){return"ani_prince_"+this._id},e}(DBBody);__reflect(PrinceBody.prototype,"PrinceBody");var alien;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._autoPlay=!1,t.loop=-1,t.movieClip=new egret.MovieClip,t}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.addChild(this.movieClip)},Object.defineProperty(i.prototype,"aniName",{get:function(){return this._aniName},set:function(t){this.setAniName(t)},enumerable:!0,configurable:!0}),i.prototype.setAniName=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._aniName=t,[4,this.updateAniName()];case 1:return e.sent(),[2]}})})},Object.defineProperty(i.prototype,"autoPlay",{get:function(){return this._autoPlay},set:function(t){this._autoPlay=t},enumerable:!0,configurable:!0}),i.prototype.updateAniName=function(){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(n){switch(n.label){case 0:return this._aniName?(e=this.movieClip,[4,t.MovieClipDataFactory.instance.generateMovieClipData(this._aniName)]):[3,2];case 1:e.movieClipData=n.sent(),this.dispatchEventWith(egret.Event.COMPLETE),egret.callLater(function(){i.dealAutoPlay()},this),n.label=2;case 2:return[2]}})})},i.prototype.dealAutoPlay=function(){this._autoPlay&&this.movieClip.play(this.loop)},i}(eui.Component);t.MovieClipView=e,__reflect(e.prototype,"alien.MovieClipView")}(alien||(alien={}));var FinishTip=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._queue=[],e._itemY=0,e.onTimer=function(){var t=e._queue.shift();if(t){var i=new FinishTipItem;i.y=e._itemY,e.addChild(i),e._itemY+=i.height+10,i.play(t)}else egret.clearInterval(e._timer),e._timer=null,e._itemY=0},e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this._queue=[],this.touchEnabled=!1,this._itemY=0,this.enableEvents(),this.registerEvent(alien.Dispatcher,EventNames.SHOW_FINISH_NOTIFICATION,this.onShow,this),this.registerEvent(alien.Dispatcher,EventNames.CLEAN_FINISH_NOTIFICATION,this.onClean,this)},e.prototype.onShow=function(t){GuideLayer.instance.visible||(this.skinName||(this.skinName=components.FinishTipSkin),this.play(t.data))},e.prototype.onClean=function(t){this.clean()},e.prototype.play=function(t){this._queue.push(t),this._timer||(this._timer=egret.setInterval(this.onTimer,this,300))},e.prototype.clean=function(){this._queue.splice(0),this._itemY=0},e}(alien.VisualEventComponent);__reflect(FinishTip.prototype,"FinishTip");var FinishTipItem=function(t){function e(){var e=t.call(this)||this;return e._data=null,e.skinName=components.FinishTipItemSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.play=function(t){var e=this;this._data=t,this.labContent.text=t.content,this.x=-this.width,egret.Tween.get(this).to({x:0},200,egret.Ease.cubicOut).wait(2e3).to({x:-this.width},200,egret.Ease.cubicIn).call(function(){e.parent&&e.parent.removeChild(e)})},e.prototype.onTap=function(t){FinishService.goGoalScene(this._data.id)},e}(alien.VisualEventComponent);__reflect(FinishTipItem.prototype,"FinishTipItem");var GlowBugs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);for(var e=0;3>e;e++){var i=new GlowBug;this.addChild(i)}},e.prototype.update=function(){alien.Utils.enumChildren(this,function(t){t.update()})},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),alien.TickerManager.register(this),alien.Utils.enumChildren(this,function(t){t.active()})},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),alien.TickerManager.unregister(this),alien.Utils.enumChildren(this,function(t){t.inactive()})},e}(alien.VisualEventComponent);__reflect(GlowBugs.prototype,"GlowBugs",["alien.ITicker"]);var GlowBug=function(t){function e(){var e=t.call(this)||this;e.params=[],e.fade=function(t){return{alpha:.5*(Math.sin(t+e._delay)+1)}},e.t=Math.random()*Math.PI,e._delay=Math.random()*Math.PI;for(var i=0;6>i;i++)e.params.push(2*Math.random()+.5);var n=new egret.Bitmap(RES.getRes(ResNames.lobby_glow_bug_glow));n.x=-n.width/2,n.y=-n.height/2,e.addChild(n);var r=new egret.Bitmap(RES.getRes(ResNames.lobby_glow_bug_body));return r.x=-r.width/2,r.y=-r.height/2,e.addChild(r),e._wave=new alien.Wave(n,1e3,e.fade,0,!1),e}return __extends(e,t),e.prototype.active=function(){this._wave.play()},e.prototype.inactive=function(){this._wave.stop()},e.prototype.update=function(){var t=this.t+=.004,e=this.params;this.x=Math.sin(t*e[0])*Math.sin(t*e[1])*Math.sin(t*e[2])*50,this.y=Math.cos(t*e[3])*Math.cos(t*e[4])*Math.cos(t*e[5])*50},e}(egret.DisplayObjectContainer);__reflect(GlowBug.prototype,"GlowBug");var GoldWithVip=function(t){function e(){var e=t.call(this)||this;return e._field="gold",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onBtnAddTap=function(){PanelShop.instance.show(2)},e=__decorate([modifyChild],e)}(PlayerPropView);__reflect(GoldWithVip.prototype,"GoldWithVip");var IRProps=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.imgIcon.source="icon_"+e,this.labValue.text=wsy.Utils.shortCurrency(mainService.playerInfo[e])},e}(ItemRenderer);__reflect(IRProps.prototype,"IRProps");var IRReward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=GameConfig.getItemMeta(this.data.id);this.item.setData(this.data),this.labContent.text=e.name},e}(eui.ItemRenderer);__reflect(IRReward.prototype,"IRReward");var IRTabButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.badgeView.bid=this.data.badgeId},e}(eui.ItemRenderer);__reflect(IRTabButton.prototype,"IRTabButton");var IRWithItemView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.item.setData(this.data)},e.prototype.commitProperties=function(){var e=this.$Component[4];t.prototype.commitProperties.call(this);try{e&&this.item.stateChanged(this.currentState)}catch(i){}},e}(eui.ItemRenderer);__reflect(IRWithItemView.prototype,"IRWithItemView");var ItemDetails=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSelectTarget=function(t,i){if(i&&i.minister){var n=i.minister;PanelUseItem.instance.show({itemData:e._selectedItem,target:n})}},e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this.btnUse,egret.TouchEvent.TOUCH_TAP,this.onBtnUseTap,this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_ITEM,this.onSelectItem,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this)},e.prototype.onUpdateItem=function(t){t.data.item||PanelSelectMinister.instance.close()},e.prototype.onSelectItem=function(t){var e=t.data.item;this._selectedItem=e,this.scroller.viewport.scrollV=0,this.itemView.setItemData(e),this.labItemName.text=e.meta.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[e.meta.quality],this.labCount.text=lang.format(lang.count_brackets,e.count);var i=GameConfig.treasureTypes.indexOf(e.meta.type)>=0;this.labIntro.text=e.meta.intro,this.labOrigin.text=e.meta.origin,1==e.meta.usable?(this._useType=1,this.currentState="use"):i?(this._useType=2,this.currentState="upgrade",this.labIntro.text=lang.item_treasure_intro+packService.getItemEffect(e.metaId,e.level+1,", ")):this.currentState="read_only",(14==e.meta.type||19==e.meta.type)&&(this.currentState="read_only")},e.prototype.onBtnUseTap=function(t){switch(this._useType){case 1:var e=this._selectedItem.meta;switch(e.target){case 0:PanelUseItem.instance.show({itemData:this._selectedItem});break;case 1:PanelSelectMinister.instance.show({type:GameConfig.itemEffectMap[e.type],itemData:this._selectedItem},this.onSelectTarget);break;case 2:break;case 3:SceneController["goto"](ConstantNames.SCENE_PRINCE)}break;case 2:PanelItemUpgrade.instance.show({item:this._selectedItem},null)}},e.prototype.clean=function(){this.itemView.clean(),this.currentState="empty",this._selectedItem=null},e}(alien.EventComponent);__reflect(ItemDetails.prototype,"ItemDetails");var ItemListView=function(t){function e(){var e=t.call(this)||this;return e.skinName=components.ItemListSkin,e}return __extends(e,t),e.prototype.initData=function(t){this.type=t.type},e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),this.list.itemRenderer=IRItem,this.list.dataProvider=this.dataProvider=new eui.ArrayCollection,this.itemDetails.clean(),this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectItem,this),egret.setTimeout(function(){e.grpList.minHeight=e.scroller.height},this,100)},e.prototype.onSelectItem=function(t){alien.Dispatcher.dispatch(EventNames.SELECT_ITEM,{item:this.list.selectedItem})},e.prototype.autoSelectItem=function(){this.itemDetails.clean(),this.dataProvider.source.length>0&&(this.list.selectedIndex=0,alien.Dispatcher.dispatch(EventNames.SELECT_ITEM,{item:this.list.selectedItem}))},e.prototype.active=function(e){t.prototype.active.call(this,e),this.itemDetails.enableEvents(),this.setSource(),this.autoSelectItem()},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.itemDetails.disableEvents()},e.prototype.setSource=function(){var t=this,e=packService.getItemsByTypes(GameConfig.packListTypes[this.type]);switch(this.type){case 0:e.sort(function(t,e){return e.meta.order-t.meta.order});break;case 1:e.sort(function(t,e){return t.meta.order==e.meta.order?e.level-t.level:e.meta.order-t.meta.order})}this.dataProvider.source=e,alien.EgretUtils.callLater(function(){var e=t.scroller.viewport,i=t.scroller.viewport.scrollV;e.scrollV=Math.min(e.contentHeight-e.height,i),e.scrollV=Math.max(e.scrollV,0)},10)},e.prototype.update=function(t){void 0===t&&(t=null),t&&1==t.type?this.dataProvider.itemUpdated(t.item):(this.setSource(),this.itemDetails.clean()),this.autoSelectItem()},e}(StackView);__reflect(ItemListView.prototype,"ItemListView");var GoodsCombineListView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRCombineItem,this.currentState="no_details",this.registerEvent(alien.Dispatcher,EventNames.COMBINE_ITEM,this.onCombineItem,this)},e.prototype.onSelectItem=function(t){},e.prototype.setSource=function(){this.dataProvider.source=packService.getCombinableItems()},e.prototype.onCombineItem=function(t){PanelCombineItem.instance.show(t.data)},e.prototype.update=function(t){var e=this;if(void 0===t&&(t=null),t&&1==t.type){var i=this.scroller.viewport.scrollV;this.dataProvider.refresh(),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=i})}else this.setSource(),this.itemDetails.clean();this.autoSelectItem()},e}(ItemListView);__reflect(GoodsCombineListView.prototype,"GoodsCombineListView");var IRItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.itemView.setItemData(this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRItem.prototype,"IRItem");var IRCombineItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labName.text=this.data.meta.name,this.labName.textColor=GameConfig.QUALITY_COLORS[this.data.meta.quality],this.badgeItem.visible=packService.checkCombine(this.data.meta.id),this.registerEvent(this.btnCombine,egret.TouchEvent.TOUCH_TAP,this.onBtnCombineTap,this)},e.prototype.onBtnCombineTap=function(t){alien.Dispatcher.dispatch(EventNames.COMBINE_ITEM,{meta:this.data.meta})},e}(IRItem);__reflect(IRCombineItem.prototype,"IRCombineItem");var ItemView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._alwaysShowCount=!1,e._hideCount=!1,e._showEffect=!0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.count=0,this.imgIcon.mask=this.rectMask,this.updateLevel()},Object.defineProperty(e.prototype,"alwaysShowCount",{get:function(){return this._alwaysShowCount},set:function(t){this._alwaysShowCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hideCount",{get:function(){return this._hideCount},set:function(t){this._hideCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showEffect",{get:function(){return this._showEffect},set:function(t){this._showEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},set:function(t){this._count!=t&&(this._count=t);var e=GameConfig.getItemMeta(this.metaId);return e?((this._count>0||!this._hideCount&&this._alwaysShowCount&&e.max>1)&&(this.labCount.text=wsy.Utils.shortCurrency(this._count)+""),void(this.labCount.visible=!this._hideCount&&(this._alwaysShowCount||this._count>0)&&(e.max>1||this.count>1))):void(this.labCount.visible=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metaId",{get:function(){return this._meta?this._meta.id:0},set:function(t){0==t?(this._meta=null,this.imgIcon.source="",this.imgQuality.source=""):this._meta&&this._meta.id==t||(this._meta=GameConfig.getItemMeta(t),this._showEffect&&this._meta.has_effect?RES.getResAsync("item_effect_"+this._meta.id,this.onLoadEffect,this):this.effect&&this.contains(this.effect)&&(this.removeChild(this.effect),this.effect=null),this.icon=this._meta.icon,this.quality=this._meta.quality)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{set:function(t){this.imgIcon.source=e.getIconUrl(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{set:function(t){this.imgQuality.source="common_item_quality_"+t},enumerable:!0,configurable:!0}),e.getIconUrl=function(t,e){return void 0===e&&(e=!1),"item_"+t+(e?"_small":"")},e.prototype.update=function(){this.metaId=this._itemData.metaId,this.count=this._itemData.count,this.updateLevel()},e.prototype.updateLevel=function(){this._meta&&GameConfig.treasureTypes.indexOf(this._meta.type)>=0&&this._itemData&&this._itemData.level>0?(this.labAddition.text="+"+this._itemData.level,this.labAddition.visible=!0):this.labAddition.visible=!1},e.prototype.setItemData=function(t){this._itemData=t,this.update()},e.prototype.clean=function(){this.count=0,this.metaId=0},e.prototype.setData=function(t){this.metaId=t.id,this.count=t.count},Object.defineProperty(e.prototype,"movieClip",{get:function(){return this.effect||(this.effect=new egret.MovieClip,this.effect.x=this.width-140>>1,this.effect.y=this.height-140>>1,this.addChildAt(this.effect,this.numChildren-2)),this.effect},enumerable:!0,configurable:!0}),e.prototype.onLoadEffect=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:t=this._meta.id,n.label=1;case 1:return n.trys.push([1,3,,4]),e=this.movieClip,[4,alien.MovieClipDataFactory.instance.generateMovieClipData(t)];case 2:return e.movieClipData=n.sent(),this.movieClip.gotoAndPlay(1,-1),[3,4];case 3:return i=n.sent(),this.effect&&this.contains(this.effect)&&this.removeChild(this.effect),[3,4];case 4:return[2]}})})},e}(eui.Component);__reflect(ItemView.prototype,"ItemView");var LoadingLayer=function(t){function e(){var e=t.call(this)||this;return e._tips=RES.getRes(ResNames.tips),e.percentWidth=100,e.percentHeight=100,e.skinName=components.LoadingSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBg.source=GameConfig.getLoadingBgUrl(),this.imgLogo.source=GameConfig.getLogoUrl(),this.showTips(),this.progressBar.setValue(0,!1)},e.prototype.setProgress=function(t,e){this.progressBar.setValue(t/e,!1),this.labelDisplay.text="正在加载资源 ("+t+"/"+e+")"},e.prototype.setState=function(t){this.currentState=t,"loading"==t&&this.showTips()},e.prototype.showTips=function(){this.labTips.text="小贴士: "+alien.MathUtils.getRandomFromArray(this._tips)},e=__decorate([modifyChild],e)}(alien.VisualEventComponent);__reflect(LoadingLayer.prototype,"LoadingLayer");var LoadingProgressBar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.thumb.mask=this.rectMask},e.prototype.setValue=function(t,e){void 0===e&&(e=!0);var i=-this.thumb.width*(1-t)+this.rectMask.x;e?egret.Tween.get(this.thumb,null,null,!0).to({x:i},.1*Math.abs(this.thumb.x-i),egret.Ease.cubicInOut):this.thumb.x=i,this.thumbPart.x=this.thumb.x+this.thumb.width-this.thumbPart.width/2},e}(eui.Component);__reflect(LoadingProgressBar.prototype,"LoadingProgressBar");var MaterialItemView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)
},e.prototype.setData=function(t){var e=t.id,i=t.count;this.id=e,this.count=i;var n=GameConfig.getItemMeta(e);this.setMeta(n);var r=packService.getCountByMetaId(n.id);this.labCount.textFlow=wsy.Utils.makeColorFraction("{0}",lang.count_fraction,r,i)},e.prototype.setMeta=function(t){this.itemView.metaId=t.id},e.prototype.onTap=function(t){PanelItemDetails.instance.show({id:this.id})},e}(alien.VisualEventComponent);__reflect(MaterialItemView.prototype,"MaterialItemView");var NationalPowerUp=function(t){function e(){var i=t.call(this)||this;return i._playFlag=!1,i.start=function(){if(i._queue.length<=0)return void i.end();i._playFlag=!0;var t=i._queue.shift();i.rollNum(i.labValue,t.oldValue,t.value,i.start)},i.end=function(){i._playFlag=!1,egret.Tween.get(i).to({alpha:0},500).call(function(){i.visible=!1,i.alpha=1})},e._instance=i,i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._queue=[]},e.prototype.show=function(t){var i=t.oldValue,n=t.value;this.skinName||(this.skinName=components.NationalPowerUpSkin),e.hideSceneNames.indexOf(SceneController.instance.navigator.currentName)>=0||(this.visible=!0,egret.Tween.removeTweens(this),this.alpha=1,this._queue.push({oldValue:i,value:n}),this._queue=this.getMinValue(),this._playFlag||this.start())},e.prototype.rollNum=function(t,e,i,n){return void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var r,o,s,a,c;return __generator(this,function(l){switch(l.label){case 0:t.text=e,r=t.y,o=r-5,s=r+5,a=function(){var n;return __generator(this,function(a){switch(a.label){case 0:return n=-1,[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(t).to({y:o,scaleY:.9},20).call(function(){var r=alien.MathUtils.makeRandomInt((i-e)/2,0)+1;n=(i-e)/r,i>e?(e+=r,t.text=e+""):e>=i&&(t.text=i+"")}).to({y:s,scaleY:.9},20).to({y:r,scaleY:.8},10).wait(n))];case 1:return a.sent(),e>=i?(t.y=r,[2,"break"]):[2]}})},l.label=1;case 1:return[5,a()];case 2:return c=l.sent(),"break"===c?[3,3]:[3,1];case 3:return n&&n(),[2]}})})},e.prototype.getMinValue=function(){return[{oldValue:this._queue[0].oldValue,value:this._queue[this._queue.length-1].value}]},e.hideSceneNames=[ConstantNames.SCENE_BATTLE],e}(alien.VisualEventComponent);__reflect(NationalPowerUp.prototype,"NationalPowerUp");var NicknameWithVip=function(t){function e(){var e=t.call(this)||this;return e._field=["vip","nickname"],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateValue=function(t){this.labNickname.text=mainService.playerBaseInfo.name},e=__decorate([modifyChild],e)}(PlayerPropView);__reflect(NicknameWithVip.prototype,"NicknameWithVip");var ParticleView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=[],e.texture="",e.config="",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.ps=new particle.GravityParticleSystem(RES.getRes(this.texture),RES.getRes(this.config)),this.addChild(this.ps)},e.prototype.playParticle=function(t){var e=this;return new Promise(function(i){e.pos=t,e.ps.start(),e.tween=egret.Tween.get(e,null,null,!0).to({factor:1},500).wait(200).call(function(){e.ps.stop(),i()})})},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){var e=this.pos,i=(1-t)*(1-t)*e[0].x+2*t*(1-t)*e[1].x+t*t*e[2].x,n=(1-t)*(1-t)*e[0].y+2*t*(1-t)*e[1].y+t*t*e[2].y;this.ps.emitterX=i,this.ps.emitterY=n},enumerable:!0,configurable:!0}),e}(alien.EventComponent);__reflect(ParticleView.prototype,"ParticleView");var alien;!function(t){var e=function(){function t(t){this._count=0,this._oldPos={},this._target=t}return t.prototype.play=function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=10),void 0===n&&(n=300),this._callback=t,this._size=i,this._perDuration=n/8,this._count=e,this._playOnce()},t.prototype._playOnce=function(){var t=this,e=this._target,i=e.x,n=e.y;this._oldPos={x:i,y:n};var r=this._size,o=[[0,-r],[r,-r],[r,0],[0,0],[-r,0],[-r,r],[0,r],[0,0]],s=this._tween=egret.Tween.get(this._target,null,null,!0);o.forEach(function(e){s.to({x:i+e[0],y:n+e[1]},t._perDuration)}),s.call(function(){t._count>0?(t._count--,t._playOnce()):t._onFinished()})},t.prototype._onFinished=function(){this._callback&&this._callback()},t.prototype.stop=function(){this._tween&&egret.Tween.get(this._target,null,null,!0).to(this._oldPos,10)},t}();t.Shake=e,__reflect(e.prototype,"alien.Shake")}(alien||(alien={}));var SelectMinister=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRMinisterForDispatch,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.labEmpty.visible=!1},e.prototype.refresh=function(t,e,i){IRMinisterForDispatch.field=e,IRMinisterForDispatch.skillType=t;var n=i(ministerService.ministers);this.labEmpty.visible=0==n.length,this._dataProvider.source=n},e}(alien.VisualEventComponent);__reflect(SelectMinister.prototype,"SelectMinister");var IRMinisterForDispatch=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSelect,egret.TouchEvent.TOUCH_TAP,this.onBtnSelectClick,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=i.meta;if(this.avatar.id=n.icon,this.labName.text=n.name+("exploit"==e.skillType&&i.grade<10?"·"+lang.minister_office_class[i.grade]:""),this.imgNameIcon.source="icon_name_icon_"+n.quality,this.labName.textColor=GameConfig.QUALITY_COLORS[n.quality],"grade"==e.field?this.labPolitics.text=lang.minister_info_fields[e.field]+": "+lang.minister_office_class[i[e.field]]:this.labPolitics.text=lang.minister_info_fields[e.field]+": "+i[e.field],MinisterEntity.developmentSkills[e.skillType]?this.labSkill.text=lang.skill+": "+i.getSkillsText(e.skillType):this.labSkill.text=lang.minister_info_fields[e.skillType]+": "+i[e.skillType],technologyService.needValue){this.btnSelect.enabled=i[e.field]>=technologyService.needValue;var r=i[e.field]>technologyService.needValue?"00ff00":"F70707";this.labPolitics.textFlow=lang.formatHtml(lang.tech_have,lang.minister_info_fields[e.field],r,i[e.field],technologyService.needValue)}},e.prototype.onBtnSelectClick=function(t){var e=this.data;alien.Dispatcher.dispatch(EventNames.SELECT_MINISTER,{minister:e})},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterForDispatch.prototype,"IRMinisterForDispatch");var SelectMinister2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRMinisterForDispatch2,this._dataProvider||(this.list.dataProvider=this._dataProvider=new eui.ArrayCollection),this.labEmpty.visible=!1},e.prototype.refresh=function(t,e,i){IRMinisterForDispatch2.fields=e,IRMinisterForDispatch2.skillType=t;var n=i(ministerService.ministers);this.labEmpty.visible=0==n.length,this._dataProvider||(this.list.dataProvider=this._dataProvider=new eui.ArrayCollection),this._dataProvider.source=n},e}(alien.VisualEventComponent);__reflect(SelectMinister2.prototype,"SelectMinister2");var IRMinisterForDispatch2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSelect,egret.TouchEvent.TOUCH_TAP,this.onBtnSelectClick,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data,n=i.meta;this.avatar.id=n.icon,this.labName.text=n.name+" Lv."+i.level,this.imgNameIcon.source="icon_name_icon_"+n.quality,this.labName.textColor=GameConfig.QUALITY_COLORS[n.quality],this.lab1.text=lang.minister_info_fields[e.fields[0]]+": "+i[e.fields[0]],this.lab2.text=lang.minister_info_fields[e.fields[1]]+": "+i[e.fields[1]],this.lab3.text=lang.minister_info_fields[e.fields[2]]+": "+i[e.fields[2]]},e.prototype.onBtnSelectClick=function(t){var e=this.data;alien.Dispatcher.dispatch(EventNames.SELECT_MINISTER,{minister:e})},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterForDispatch2.prototype,"IRMinisterForDispatch2");var ServerDisconnect=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){e._instance=this,t.prototype.createChildren.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){this.callback&&(this.callback(),this.close())},e.prototype.show=function(t,e){this.visible=!0,this.labContent.text=t,this.callback=e,wsy.Utils.updateAllImages(this)},e.prototype.close=function(){this.visible=!1},e}(alien.VisualEventComponent);__reflect(ServerDisconnect.prototype,"ServerDisconnect");var SignItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setData=function(t){var e=t.content,i=t.item;this.labDay=e,this.itemView.setData(i)},e}(eui.Component);__reflect(SignItem.prototype,"SignItem");var SourceItemList=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.setItems=function(t){this._dataProvider.source=t},e}(alien.EventComponent);__reflect(SourceItemList.prototype,"SourceItemList");var alien;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._autoPlay=!0,t._duration=1e3,t._max=1,t._min=0,t._loop=0,t}return __extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.resetWave(),this._autoPlay&&this.play()},i.prototype.resetWave=function(){this._wave&&this._wave.stop(),this._wave=new t.Wave(this,this._duration,this.wave.bind(null,this._max,this._min),this._loop,!1)},i.prototype.wave=function(t,e,i){return{alpha:(Math.sin(i)/2+.5)*(t-e)+e}},i.prototype.play=function(){this._wave.play()},i.prototype.stop=function(){this._wave.stop()},Object.defineProperty(i.prototype,"autoPlay",{get:function(){return this._autoPlay},set:function(t){this._autoPlay!=t&&(this._autoPlay=t,this.resetWave())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration!=t&&(this._duration=t,this.resetWave())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"max",{get:function(){return this._max},set:function(t){this._max!=t&&(this._max=t,this.resetWave())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"min",{get:function(){return this._min},set:function(t){this._min!=t&&(this._min=t,this.resetWave())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop!=t&&(this._loop=t,this.resetWave())},enumerable:!0,configurable:!0}),i}(eui.Image);t.TwinkleImage=e,__reflect(e.prototype,"alien.TwinkleImage")}(alien||(alien={}));var StorySection=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this),this._ani=new alien.Wave(this.imgTapNext,1e3,alien.Wave.fade.bind(null,.5),0,!0)},e.prototype.onTap=function(t){t.target==this.btnSkip?this.onFinished():this._timerDialog?this.speedUp():this._stepIndex<this._dialog.contents.length?this.playStep():this._play()},e.prototype.updateFace=function(){var t=mainService.nationalIcon||mainService.playerInfo.national_icon;this.faceBody.setFace(t),this.faceBody.changeSex(Math.floor(t/1e3)-1)},e.prototype.play=function(t,e,i){this._dialogIds=t,this._bgId=e,this._onFinished=i,this._dialogIndex=0,this.visible=!0,this.updateFace(),alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"story_start"}),this._play()},e.prototype._loadBg=function(t,e,i){var n=this;this.blackLayer.alpha=0,egret.Tween.get(this.blackLayer,null,null,!0).to({alpha:1},200).call(function(){e(),RES.getResAsync("story_bg_"+t,function(t){this.imgBg.source=t,egret.Tween.get(this.blackLayer,null,null,!0).to({alpha:0},500).call(i)},n)})},e.prototype._play=function(){var t=this._dialogIds[this._dialogIndex++];return t?(this._stepIndex=0,this._dialog=GameConfig.getDialogueMeta(t),void(this._bgId<0?this.loadBg(t):0==this._bgId?(this.imgBg.source=null,this.playStep()):this.loadBg(this._bgId))):void this.onFinished()},e.prototype.loadBg=function(t){var e=this;this.touchEnabled=this.touchChildren=!1,this._loadBg(t,function(){e.playStep()},function(){e.touchEnabled=e.touchChildren=!0})},e.prototype.playStep=function(){var t=(this._step=this._dialog.contents[this._stepIndex++]).icon,e=this.imgBodyRight;switch(t){case 0:this.currentState="empty";break;case 1:this.currentState="me";break;case 2:this.currentState="other",e.source=PrincessEntity.parseBodyUrl(t);break;default:var i=MinisterEntity.parseBodyUrl(t);e.source!=i&&(e.source=null,e.source=i),this.currentState="other",e.y=alien.StageProxy.height-620,e.anchorOffsetX=11e4>=t?GameConfig.otherBodyOffset[t].x:GameConfig.getMinisterMeta(t).body_offset.x,e.anchorOffsetY=11e4>=t?GameConfig.otherBodyOffset[t].y:GameConfig.getMinisterMeta(t).body_offset.y}this.playDialog()},e.prototype.playDialog=function(){var t=this,e=this._step.content,i=0;this.labDialog.text="",this._timerDialog=egret.setInterval(function(){t.labDialog.appendText(e.charAt(i++)),i>=e.length&&t.onDialogFinished()},this,50)},e.prototype.speedUp=function(){this.stopDialog(),this.labDialog.text=this._step.content},e.prototype.stopDialog=function(){egret.clearInterval(this._timerDialog),this._timerDialog=null},e.prototype.onDialogFinished=function(){this.stopDialog()},e.prototype.onFinished=function(){this.visible=!1,this._onFinished&&this._onFinished(),alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"story_finish"})},e}(alien.VisualEventComponent);__reflect(StorySection.prototype,"StorySection");var TopValueBox=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.updateField(),this.updateValue()},Object.defineProperty(e.prototype,"field",{get:function(){return this._field},set:function(t){this._field=t,this.updateField()},enumerable:!0,configurable:!0}),e.prototype.updateField=function(){this.labelField&&(this.labelField.text=this._field)},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this.updateValue()},enumerable:!0,configurable:!0}),e.prototype.updateValue=function(){this.labValue&&(this.labValue.text=wsy.Utils.shortCurrency(this._value))},e}(alien.EventComponent);__reflect(TopValueBox.prototype,"TopValueBox");var TreasureBoxListView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.setup=function(t){void 0===t&&(t=3),this.removeChildren(),this.width=e.boxWidth*(t-1)-50;for(var i=0;t>i;i++){var n=new egret.Bitmap(RES.getRes(ResNames.common_treasure_box_close));n.anchorOffsetX=n.width/2,n.x=this.width/2+(i-1)*e.boxWidth,n.y=30,n.name=i.toString(),n.touchEnabled=!0,this.addChild(n)}},e.prototype.choose=function(t){var e=this;alien.Utils.enumChildren(this,function(i,n){n==t?egret.Tween.get(i,null,null,!0).wait(200).to({x:e.width/2},400,egret.Ease.cubicOut).call(function(){}).wait(200).to({alpha:0},300).call(function(){alien.Dispatcher.dispatch(EventNames.CHOOSE_TREASURE_BOX,{index:t})}):egret.Tween.get(i,null,null,!0).to({alpha:0},300)})},e.prototype.onTap=function(t){var e=parseInt(t.target.name);this.choose(e)},e.boxWidth=200,e}(alien.VisualEventComponent);__reflect(TreasureBoxListView.prototype,"TreasureBoxListView");var VipItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},Object.defineProperty(e.prototype,"vip",{set:function(t){this.imgVip.source="lobby_vip_"+t,this.imgVipBg.source="lobby_vip_bg_"+Math.floor((0>t-1?0:t-1)/3)},enumerable:!0,configurable:!0}),e}(alien.EventComponent);__reflect(VipItem.prototype,"VipItem");var Waiting=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._count=8,e.R=50,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.addChild(this._container=new egret.DisplayObjectContainer);for(var e=2*Math.PI/this._count,i=0;i<this._count;i++){var n=new LoadingItem;n.play(e*(this._count-i-1)),this._container.addChild(n),n.x=Math.cos(e*i)*this.R,n.y=Math.sin(e*i)*this.R}},e.prototype.play=function(){alien.TickerManager.register(this)},e.prototype.stop=function(){alien.TickerManager.unregister(this)},e.prototype.update=function(){alien.Utils.enumChildren(this._container,function(t){t.update()})},e}(eui.Group);__reflect(Waiting.prototype,"Waiting",["alien.ITicker"]);var LoadingItem=function(t){function e(){var e=t.call(this,RES.getRes(ResNames.loading_icon_point))||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.anchorOffsetX=this.anchorOffsetY=this.width/2},e.prototype.update=function(){this._radius+=.08,this.alpha=this.scaleX=this.scaleY=(Math.sin(this._radius+this._offset)+1)/2},e.prototype.play=function(t){this._offset=t,this._radius=0},e}(egret.Bitmap);__reflect(LoadingItem.prototype,"LoadingItem");var WaitingLayer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(alien.Dispatcher,EventNames.SHOW_WAITING,this.onShow,this),this.registerEvent(alien.Dispatcher,EventNames.HIDE_WAITING,this.onHide,this),this.enableEvents()},e.prototype.onShow=function(t){var e=(t.data||{content:""}).content;this.show(e)},e.prototype.onHide=function(t){this.hide()},e.prototype.show=function(t){void 0===t&&(t=null),t&&(this.labelWaiting.text=t),this.labelWaiting.visible=!!t,this.waiting.play(),this.visible=!0,egret.Tween.get(this,null,null,!0).to({alpha:1},500)},e.prototype.hide=function(t){var e=this;void 0===t&&(t=!0),t?egret.Tween.get(this,null,null,!0).to({alpha:0},500).call(function(){e.waiting.stop(),e.visible=!1}):(this.waiting.stop(),this.visible=!1)},e}(alien.EventComponent);__reflect(WaitingLayer.prototype,"WaitingLayer");var WorldBossRank=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.height=65,this.grpPerson.height=65,this.grpPerson.y=0,this.blackLayer.alpha=0,this.blackLayer.visible=!1,this.visible=!0,this.currentState="mini",this.list.itemRenderer=IRDuplicateRank,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.listUnion.itemRenderer=IRDuplicateRank,this.listUnion.dataProvider=this._unionDataProvider=new eui.ArrayCollection,this.registerEvent(this.blackLayer,egret.TouchEvent.TOUCH_TAP,this.onBlackLayerTap,this),this.registerEvent(this.btnShowMoreUnion,egret.TouchEvent.TOUCH_TAP,this.onBtnShowMoreTap,this),this.registerEvent(this.btnShowMore,egret.TouchEvent.TOUCH_TAP,this.onBtnShowMoreTap,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this),this.registerEvent(this.btnSwitch,egret.TouchEvent.TOUCH_TAP,this.onBtnSwitchTap,this)},e.prototype.onBlackLayerTap=function(t){this.switchState()},e.prototype.onBtnShowMoreTap=function(t){this.switchState()},e.prototype.onBtnSwitchTap=function(t){this.switchRank()},e.prototype.onUpdateBossInfo=function(t){this.update()},e.prototype.update=function(){var t=bossService.boss.getMyBossRank();t?(this.labRank.text=lang.union_duplicate_rank_label[1]+t.rank,this.labDamage.text=lang.union_duplicate_rank_label[0]+wsy.Utils.shortCurrency(t.hp)):(this.labRank.text=lang.union_duplicate_rank_label[1]+lang.activity_rank_none,this.labDamage.text=lang.union_duplicate_rank_label[0]+0),this._dataProvider.source=bossService.boss.ranks,this._unionDataProvider.source=bossService.boss.unionRanks},e.prototype.switchState=function(){var t=this;"max"==this.currentState&&this.setDefault();var e="mini"==this.currentState?"max":"mini",i="mini"==e?65:842,n="mini"==e?0:.5,r="mini"==e?65:806;"max"==e&&(this.blackLayer.visible=!0),egret.Tween.get(this.grp,null,null,!0).to({height:i},500,egret.Ease.cubicInOut),egret.Tween.get(this.grpPerson,null,null,!0).to({height:r},500,egret.Ease.cubicInOut),egret.Tween.get(this.blackLayer,null,null,!0).to({alpha:n},500).call(function(){t.currentState=e,t.blackLayer.visible="max"==e,t.grpPerson.y="mini"==e?0:36,alien.EgretUtils.callLater(function(){"max"==e&&(t._dataProvider.source=bossService.boss.ranks,t._unionDataProvider.source=bossService.boss.unionRanks)},10)}),alien.EgretUtils.callLater(function(){var e=t.scroller.viewport;egret.Tween.get(t.scroller.viewport).to({scrollV:Math.max(e.contentHeight-i-120,0)},500,egret.Ease.cubicInOut)})},e.prototype.switchRank=function(){var t=this,e=this.grp.getChildAt(0),i=this.grp.getChildAt(1),n={x:e.x,y:e.y},r={x:i.x,y:i.y};this.btnSwitch.enabled=!1,e.touchChildren=i.touchChildren=!1,this.blackLayer.touchEnabled=!1,egret.Tween.get(e,null,null,!0).to({scaleX:.8,scaleY:.8,x:n.x+200},300),egret.Tween.get(i,null,null,!0).to({scaleX:.8,scaleY:.8,x:r.x-200,alpha:.3},300).call(function(){t.grp.setChildIndex(i,0),egret.Tween.get(e).to({scaleX:1,scaleY:1,x:r.x,y:r.y},300),egret.Tween.get(i).to({scaleX:1,scaleY:1,x:n.x,y:n.y,alpha:1},300).wait(100).call(function(){t.btnSwitch.enabled=!0,e.touchChildren=i.touchChildren=!0,t.blackLayer.touchEnabled=!0})})},e.prototype.setDefault=function(){var t=this.grp.getChildAt(0),e=this.grp.getChildAt(1);if("union"!=t.name&&e){var i={x:t.x,y:t.y},n={x:e.x,y:e.y};t.x=n.x,t.y=n.y,e.x=i.x,e.y=i.y,this.grp.setChildIndex(e,0)}},e}(alien.VisualEventItemRenderer);__reflect(WorldBossRank.prototype,"WorldBossRank");var WorldMap=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showPointAttack=!0,e.autoFixed=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this.attackFlag,egret.TouchEvent.TOUCH_TAP,this.onAttackFlagTap,this)},e.prototype.update=function(){for(var t=battleService.country,e=activityTimeService.getById(battleService.conquerActId),i=e&&e["int"]==parseInt(GameConfig.strongholdIds[GameConfig.strongholdIds.length-1])?t.id+1:t.id,n=7e3;7036>=n;n++)this.getImgCountry(n).visible=n>=i;if(this.autoFixed){var r=this.width/this.container.width;this.container.scaleX=this.container.scaleY=r}this.container.scrollEnabled=!this.autoFixed,this.imgNames.visible=!this.autoFixed,this.attackFlag.visible=this.showPointAttack&&i==t.id},e.prototype.getImgCountry=function(t){return this.container.getChildByName(t.toString())},e.prototype.onAttackFlagTap=function(t){SceneController["goto"](ConstantNames.SCENE_BATTLE,{country:battleService.country,stronghold:battleService.stronghold,type:0})},Object.defineProperty(e.prototype,"countryId",{set:function(t){var e=this.getImgCountry(t),i=e.x+e.width/2,n=e.y+e.height/2;this.showPointAttack&&(this.attackFlag.x=i,this.attackFlag.y=n);var r=i-this.width/2,o=n-this.height/2;this.container.scrollH=Math.max(Math.min(r,this.imgBg.width-this.width),0),this.container.scrollV=Math.max(Math.min(o,this.imgBg.height-this.height),0)},enumerable:!0,configurable:!0}),e}(alien.VisualEventComponent);__reflect(WorldMap.prototype,"WorldMap");var ActBannerList=function(t){function e(){var e=t.call(this)||this;return e.skinName=activity.ActBannerListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this)},e.prototype.active=function(e){if(t.prototype.active.call(this,e),e){if(!this._dataProvider)return;this._dataProvider.source=activityService.getActivityByTypeList(e)}},e.prototype.onSelectItem=function(t){t.preventDefault();var e=this.list.selectedItem;e.index=this.list.selectedIndex,alien.Dispatcher.dispatch(EventNames.SELECT_BANNER,e)},e}(StackView);__reflect(ActBannerList.prototype,"ActBannerList");var ActBannerItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(activityService,EventNames.UPDATE_SUM_CHARGE,this.onUpdateSumCharge,this)},e.prototype.setData=function(t){this.data=t;var e=t;if(e){var i=ActivityEntity.getActivityConfigByType(e.type);if(null!=i){i.badgeId&&(this.badgeView.bid=i.badgeId+"");var n=e.type<=ActivityEntity.ACTIVITY.TYPE_CHARGE_648?0:e.type;if(this.imgBanner.source=cdnurl+"resource/assets/singles/activityBanner/"+n+".png",this.currentState=i.currentState,1001==e.type)return this.labLastTime.text="",void(this.labDate.text=lang.activity_effective_time[1]);if(1002==e.type)return this.labLastTime.text="",void(this.labDate.text=lang.activity_effective_time[0]);if(this.labExtra.visible=!1,e.type==ActivityEntity.ACTIVITY.TYPE_SUM_CHARGE){this.labExtra.visible=!0;var r="0",o=activityTimeService.getById(i.activityTimeId);o&&(r=o.str),this.labExtra.textFlow=lang.formatHtml(lang.activity_sum_charge_now,r)}this.setLastTime(e.end_time);var s=new Date(1e3*e.begin_time),a=new Date(1e3*e.end_time),c=alien.TimeUtils.dateToString(s,"{0}.{1}.{2}")+" "+alien.TimeUtils.dateToTimeString(s,"{2}:{1}"),l=alien.TimeUtils.dateToString(a,"{0}.{1}.{2}")+" "+alien.TimeUtils.dateToTimeString(a,"{2}:{1}");this.labDate.textFlow=lang.formatHtml(lang.activity_rank_time[1],c,l)}}},e.prototype.setLastTime=function(t){var e=mainService.tsServer,i=Math.floor((t-e)/60/60/24),n=Math.floor((t-e)/60/60%24),r=Math.floor((t-e)/60%60);this.labLastTime.textFlow=lang.formatHtml(lang.activity_rank_time[0],i,n,r)},e.prototype.onUpdateSumCharge=function(t){var e=this.data;if(e&&e.type==ActivityEntity.ACTIVITY.TYPE_SUM_CHARGE){var i=ActivityEntity.getActivityConfigByType(e.type);this.labExtra.visible=!0;var n="0",r=activityTimeService.getById(i.activityTimeId);r&&(n=r.str),this.labExtra.text=lang.format(lang.activity_sum_charge_now,n)}},e}(alien.VisualEventItemRenderer);__reflect(ActBannerItem.prototype,"ActBannerItem");var ActChargeRewardList=function(t){function e(){var e=t.call(this)||this;return e._reward=[],e.skinName=activity.ActChargeRewardListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e);var i=ActivityEntity.ACTIVITY.TYPE_CHARGE_6,n=egret.setInterval(function(){activityService.getActivity(i),i++,i>ActivityEntity.ACTIVITY.TYPE_CHARGE_648&&egret.clearInterval(n)},this,20)},e.prototype.update=function(){t.prototype.update.call(this),this._reward.splice(0);for(var e=ActivityEntity.ACTIVITY.TYPE_CHARGE_6;e<=ActivityEntity.ACTIVITY.TYPE_CHARGE_648;++e){var i=activityService.getActivityByType(e);if(i&&i.reward){this.labDesc.text=i.desc,this.scroller.top=this.grpDesc.top+this.grpDesc.height+15;var n={extend:e,items:i.reward.items};this._reward.push(n)}}this._dataProvider&&(this._dataProvider.source=this._reward.sort(function(t,e){return t.extend-e.extend}))},e.prototype.onGetMailItemResponse=function(t){if(!(t.data.error>0)){var e=[],i=emailService.getById(t.data.id);emailService["delete"](t.data.id),t.data.items.forEach(function(t){if(t.id>0){var i=GameConfig.getItemMeta(t.id),n=GameConfig.getGiftPackMeta(i["export"]);if(n){var r=packService.getItemByMetaId(t.id);r&&(packService.useItem(r.id,t.count),n.items.forEach(function(i){var n={id:i.id,count:i.count*t.count};e.push(n)}))}else e.push(t)}}),PanelWorkFinish.instance.show({type:2,reward:e},null),i?this._dataProvider.itemUpdated(this.getItemById(i.senderId)):this._dataProvider.refresh()}},e.prototype.onMailRecvResponse=function(t){t.data.error>0||this._dataProvider.refresh()},e.prototype.getItemById=function(t){var e=null;return this._reward.some(function(i){return i.extend==Math.floor(t/100)-1?(e=i,!0):void 0}),e},e}(ActDetailsBase);__reflect(ActChargeRewardList.prototype,"ActChargeRewardList");var ActReward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this)},e.prototype.setData=function(t){this.data=t;var e=[6,30,68,198,328,648];this.labTitle.text=lang.format(lang.activity_charge_title,e[t.extend]),this._dataProvider.source=t.items,this.btnReceive.enabled=!!emailService.getBySenderId(t.extend)},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e.prototype.onBtnReceiveTap=function(t){var e=emailService.getBySenderId(this.data.extend);e&&emailService.getMailItem(e.id)},e}(alien.VisualEventItemRenderer);__reflect(ActReward.prototype,"ActReward");var ActDesc=function(t){function e(){var e=t.call(this)||this;return e.skinName=activity.ActDescSkin,e}return __extends(e,t),e.prototype.active=function(e){t.prototype.active.call(this,e),this.update()},e.prototype.update=function(){t.prototype.update.call(this);var e=activityService.getActivityByType(this._type);this.labTitle.textFlow=lang.formatHtml(e.name),this.labContent.textFlow=lang.formatHtml(e.desc,GameConfig.groupNumber)},e}(ActDetailsBase);__reflect(ActDesc.prototype,"ActDesc");var alien;!function(t){var e=function(){function e(){}return e.init=function(e,i){this.stage=e,this.root=i,e.addEventListener(egret.TouchEvent.TOUCH_END,function(t){this.lastTouchPos.x=t.stageX,this.lastTouchPos.y=t.stageY},this),this.autoAdjustTargets=[],t.StageProxy.stage.addEventListener(egret.Event.RESIZE,this.onStageResize,this)},e.onStageResize=function(t){var e=this;void 0===t&&(t=null),this.autoAdjustTargets.forEach(function(t){t.width=e.width,t.height=e.height})},Object.defineProperty(e,"width",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e,"height",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e,"center",{get:function(){return{x:this.width/2,y:this.height/2}},enumerable:!0,configurable:!0}),e.registerAutoAdjust=function(t){var e=this.autoAdjustTargets.indexOf(t);0>e&&this.autoAdjustTargets.push(t),this.onStageResize()},e.unregisterAutoAdjust=function(t){var e=this.autoAdjustTargets.indexOf(t);e>=0&&this.autoAdjustTargets.splice(e,1)},e.lastTouchPos={},e}();t.StageProxy=e,__reflect(e.prototype,"alien.StageProxy")}(alien||(alien={}));var ActLimitRewardList=function(t){function e(){var e=t.call(this)||this;
return e._type=0,e.skinName=activity.ActLimitRewardListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(activityService,EventNames.UPDATE_ACTIVITY,this.onUpdateActivity,this),this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this._type=e.type,this._type<1e3&&activityService.getActivity(this._type))},e.prototype.update=function(){var t=this,e=activityService.getActivityListByType(this._type),i=e.sort(function(t,e){var i=0,n=0;return t.reward["extends"][1]&&(i=t.reward["extends"][1].extend),e.reward["extends"][1]&&(n=e.reward["extends"][1].extend),i-n}),n=0;i.some(function(t,e){var i=parseInt(activityService.getLimitActProgressType(t.type)),r=0;return t.reward["extends"][0]&&(r=t.reward["extends"][0].extend),i>=r&&!emailService.getBySenderId(t.type,e)?void(n=e):!0}),this._dataProvider&&(this._dataProvider.source=i,alien.EgretUtils.callLater(function(){t.scroller.stopAnimation(),t.list.validateNow();var e=t.scroller.viewport,i=t.scroller.viewport.scrollV;e.scrollV=Math.max(277*n,i)}))},e.prototype.onUpdateActivity=function(t){this.update()},e.prototype.onGetMailItemResponse=function(t){var e=this;if(!(t.data.error>0)){var i=[];emailService.getById(t.data.id);emailService["delete"](t.data.id),t.data.items.forEach(function(t){if(t.id>0){var e=GameConfig.getItemMeta(t.id),n=GameConfig.getGiftPackMeta(e["export"]);if(n){var r=packService.getItemByMetaId(t.id);r&&(packService.useItem(r.id,t.count),n.items.forEach(function(e){var n={id:e.id,count:e.count*t.count};i.push(n)}))}else i.push(t)}}),PanelWorkFinish.instance.show({type:2,reward:i},null);var n=this.scroller.viewport.scrollV;this._dataProvider.refresh(),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=n})}},e.prototype.onMailRecvResponse=function(t){t.data.error>0||this._dataProvider.refresh()},e}(StackView);__reflect(ActLimitRewardList.prototype,"ActLimitRewardList");var ActLimitReward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.listReceived.itemRenderer=IRWithItemView,this.listReceived.dataProvider=this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectedItem,this)},e.prototype.setData=function(t){this.data=t;var e=t,i=0;e.reward["extends"][0]&&(i=e.reward["extends"][0].extend);var n=parseInt(activityService.getLimitActProgressType(e.type));this.labConStr.text=lang.activity_name[e.type],this.labCondition.text="("+wsy.Utils.shortCurrency(n)+"/"+wsy.Utils.shortCurrency(i)+")",this.labCondition.textColor=i>n?16711680:1088262,this._dataProvider.source=t.reward.items;var r=0;e.reward["extends"][1]&&(r=e.reward["extends"][1].extend),this.labTitle.text=lang.format(lang.activity_limit_reward_title,r+1),emailService.getBySenderId(t.type,r)?this.currentState="normal":n>=i?this.currentState="received":this.currentState="unReceive"},e.prototype.onBtnReceiveTap=function(t){var e=0;this.data.reward["extends"][1]&&(e=this.data.reward["extends"][1].extend);var i=emailService.getBySenderId(this.data.type,e);i&&emailService.getMailItem(i.id)},e.prototype.onSelectedItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e}(alien.VisualEventItemRenderer);__reflect(ActLimitReward.prototype,"ActLimitReward");var ActPhone=function(t){function e(){var e=t.call(this)||this;return e.skinName=activity.ActPhoneSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnCode,egret.TouchEvent.TOUCH_TAP,this.onBtnCodeTap,this),this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this._type=e.type,activityService.getActivity(this._type))},e.prototype.onBtnCodeTap=function(t){},e.prototype.onBtnConfirmTap=function(t){},e}(StackView);__reflect(ActPhone.prototype,"ActPhone");var ActPreferentialReward=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._rechargeId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnBuy,egret.TouchEvent.TOUCH_TAP,this.onBtnBuyTap,this),this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectedItem,this)},e.prototype.setData=function(t){this.data=t;var e=t;switch(t){case ActivityEntity.ACTIVITY.TYPE_CHARGE_8:this._rechargeId=9;break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_12:this._rechargeId=10;break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_88:this._rechargeId=11;break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_128:this._rechargeId=12}var i=activityService.getActivityByType(e);this.labTitle.text=lang.activity_preferential_title[e];var n=[];i&&i.reward&&i.reward.items.forEach(function(t){n.push(t)});var r=emailService.getBySenderId(e);r?this.currentState="receive":this.currentState=0==activityService.getPreferentialState(e)?"buy":"unBuy",this._dataProvider.source=n},e.prototype.onBtnBuyTap=function(t){shopService.recharge(this._rechargeId)},e.prototype.onBtnReceiveTap=function(t){var e=emailService.getBySenderId(this.data);e&&emailService.getMailItem(e.id)},e.prototype.onSelectedItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e}(alien.VisualEventItemRenderer);__reflect(ActPreferentialReward.prototype,"ActPreferentialReward");var ActRankRewardList=function(t){function e(){var e=t.call(this)||this;return e.skinName=activity.ActRankRewardListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.active=function(e){t.prototype.active.call(this,e)},e.prototype.update=function(){t.prototype.update.call(this);var e=activityService.getActivityListByType(this._type);this.labDesc.text=e[0].desc,this.scroller.top=this.grpDesc.top+this.grpDesc.height+15,this._dataProvider&&(this._dataProvider.source=e.sort(function(t,e){var i=0;t.reward["extends"][0]&&(i=t.reward["extends"][0].extend);var n=0;return e.reward["extends"][0]&&(n=e.reward["extends"][0].extend),i-n}))},e}(ActDetailsBase);__reflect(ActRankRewardList.prototype,"ActRankRewardList");var ActRankReward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this)},e.prototype.setData=function(t){var e=t,i=0;e.reward["extends"][0]&&(i=e.reward["extends"][0].extend);var n=i;e.reward["extends"][1].extend&&(n=e.reward["extends"][1].extend),i==n?this.labTitle.text=lang.format(lang.season_award_title[i],i):n>=999?this.labTitle.text=lang.format(lang.season_award_title[4],i-1):this.labTitle.text=lang.format(lang.season_award_title[0],i+"-"+n),this._dataProvider.source=e.reward.items},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e}(alien.VisualEventItemRenderer);__reflect(ActRankReward.prototype,"ActRankReward");var ActSumChargeRewardList=function(t){function e(){var e=t.call(this)||this;return e._reward=[],e.skinName=activity.ActSumChargeRewardListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e)},e.prototype.update=function(){var e=this;t.prototype.update.call(this);var i=activityService.getActivityListByType(this._type);i[0]&&(this.labDesc.text=i[0].desc,this.scroller.top=this.grpDesc.top+this.grpDesc.height+15);var n=i.sort(function(t,e){var i=0,n=0;return t.reward["extends"][1]&&(i=t.reward["extends"][1].extend),e.reward["extends"][1]&&(n=e.reward["extends"][1].extend),i-n}),r=0;n.some(function(t,e){var i=parseInt(activityService.getLimitActProgressType(t.type)),n=0;return t.reward["extends"][0]&&(n=t.reward["extends"][0].extend),i>=n&&emailService.getBySenderId(t.type,e)?(r=e,!0):void 0}),this._dataProvider&&(this._dataProvider.source=n,alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport,i=e.scroller.viewport.scrollV;t.scrollV=Math.max(277*r,i)}))},e.prototype.onGetMailItemResponse=function(t){var e=this;if(!(t.data.error>0)){var i=[];emailService.getById(t.data.id);emailService["delete"](t.data.id),t.data.items.forEach(function(t){if(t.id>0){var e=GameConfig.getItemMeta(t.id),n=GameConfig.getGiftPackMeta(e["export"]);if(n){var r=packService.getItemByMetaId(t.id);r&&(packService.useItem(r.id,t.count),n.items.forEach(function(e){var n={id:e.id,count:e.count*t.count};i.push(n)}))}else i.push(t)}}),PanelWorkFinish.instance.show({type:2,reward:i},null);var n=this.scroller.viewport.scrollV;this._dataProvider.refresh(),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=n})}},e.prototype.onMailRecvResponse=function(t){t.data.error>0||this._dataProvider.refresh()},e}(ActDetailsBase);__reflect(ActSumChargeRewardList.prototype,"ActSumChargeRewardList");var ActSumReward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this)},e.prototype.setData=function(e){t.prototype.dataChanged.call(this),this.data=e;var i=this.data,n=0;i.reward["extends"][0]&&(n=i.reward["extends"][0].extend);var r=0;i.reward["extends"][1]&&(r=i.reward["extends"][1].extend),this.labTitle.text=lang.format(lang.activity_sum_charge_title,n),this._dataProvider.source=this.data.reward.items,this.btnReceive.enabled=!!emailService.getBySenderId(this.data.type,r)},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e.prototype.onBtnReceiveTap=function(t){var e=0;this.data.reward["extends"][1]&&(e=this.data.reward["extends"][1].extend);var i=emailService.getBySenderId(this.data.type,e);i&&emailService.getMailItem(i.id)},e}(alien.VisualEventItemRenderer);__reflect(ActSumReward.prototype,"ActSumReward");var ArenaBattleController=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.blueFields=["politics","knowledge","command"],e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.allButton.value=0,this.registerEvent(this.effect,egret.Event.COMPLETE,this.onLoaded,this),this.registerEvent(this.effect.movieClip,egret.Event.COMPLETE,this.onPlayEnd,this),this.effect.visible=!1,egret.Tween.get(this.imgLight,{loop:!0},null,!0).to({rotation:-90}).to({rotation:180},1e3).wait(4e3)},e.prototype.onLoaded=function(t){this._playAllEffect&&this.playAllEffect(!0)},e.prototype.playAllEffect=function(t){void 0===t&&(t=!1),this.effect.visible=!0,t?this.onPlayEnd():"loop"!=this._currentLabel&&this.effect.movieClip.movieClipData&&this.effect.movieClip.gotoAndPlay(this._currentLabel="grow",1)},e.prototype.stopAllEffect=function(){this.effect.visible=!1,this.effect.movieClip.stop(),this._currentLabel=null},e.prototype.onPlayEnd=function(t){void 0===t&&(t=null),this.effect.movieClip.gotoAndPlay(this._currentLabel="loop",-1)},e.prototype.setDate=function(t){var e=this,i=t.minister;this.blueFields.forEach(function(t){var n=e.getChildByName(t);n.label=i[t]}),this.setChange(i)},e.prototype.setChange=function(t){var e=this;this.allButton.playValue(t.all/100).then(function(){(e._playAllEffect=t.all>=100)?e.playAllEffect():e.stopAllEffect()})},e.prototype.setLock=function(t){this.touchEnabled=this.touchChildren=!t},e}(alien.VisualEventComponent);__reflect(ArenaBattleController.prototype,"ArenaBattleController");var ArenaBattleInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=this.imgBody;e.mask=this.bodyMask},e.prototype.setData=function(t,i){void 0===i&&(i=null);var n=t.accountName,r=t.score,o=t.minister,s=o.metaId,a=o.hp,c=o.hpMax,l=GameConfig.getMinisterMeta(s);this.labName.text=n+"（"+lang.score+": "+r+"）",this.labMinisterName.text=l.name,this.labMinisterName.lineSpacing=10*(4-l.name.length)+5;var p=this.imgBody;p.source=MinisterEntity.parseBodyUrl(l.icon),p.anchorOffsetX=l.body_offset.x;var h;switch(this.currentState){case"red":h=e.redFields;break;case"blue":h=e.blueFields,this.prgHp.slideDuration=0,this.prgHp.maximum=c,this.prgHp.value=a}alien.Utils.enumChildren(this.grpFields,function(e,n){var r,o,s=e.getChildAt(1),a=h[n],c=0;switch(a){case"battleValue":case"politics":case"knowledge":case"command":o=t.minister[a+"_base"],c=t.minister[a]-o;break;case"order":var l=i.total,p=i.current;o=p+1+"/"+l;break;default:o=t.minister[a]}switch(a){case"order":r=lang.arena_battle_order;break;default:r=lang.minister_info_fields[a]}0!=c?s.textFlow=lang.formatHtml(lang.arena_addition_field,r,o,(0>c?GameConfig.COLORS.red:GameConfig.COLORS.green).toString(16),(c>=0?"+":"")+Math.ceil(c)):s.text=r+": "+o})},e.redFields=["level","battleValue","order"],e.blueFields=["level","politics","knowledge","command"],e}(alien.EventComponent);__reflect(ArenaBattleInfo.prototype,"ArenaBattleInfo");var ArenaBattlePowerButton=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.slideDuration=300,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.value=0},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this.thumb.bottom=-this.height*(1-t)},enumerable:!0,configurable:!0}),e.prototype.playValue=function(t){var e=this;return new Promise(function(i){e._tween=egret.Tween.get(e,null,null,!0).to({value:t},e.slideDuration).call(function(){e._tween=null,i()})})},e}(alien.EventComponent);__reflect(ArenaBattlePowerButton.prototype,"ArenaBattlePowerButton");var ArenaBattleSite=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=this.imgBody;e.mask=this.bodyMask,this.labHp.visible=!1},e.prototype.setData=function(t){var e=t.minister,i=e.metaId,n=e.hp,r=e.hpMax,o=GameConfig.getMinisterMeta(i);this.labMinisterName.text=o.name+"("+lang.level+": "+t.minister.level+")";var s=this.imgBody;switch(s.source=MinisterEntity.parseBodyUrl(o.icon),s.anchorOffsetX=o.body_offset.x,this.prgHp.slideDuration=0,this.prgHp.maximum=r,this.prgHp.value=n,this.prgHp.slideDuration=500,this.currentState){case"red":break;case"blue":}},e.prototype.playCompare=function(t,e,i){var n=this;return new Promise(function(r){var o=(t.hp,t.action);n.mcEffect.aniName=arenaService.actionMap[o]+(0==e||i?"_win":"_lose"),n.mcEffect.movieClip.once(egret.Event.COMPLETE,r,n)})},e.prototype.playChange=function(t,e,i){var n=this,r=t.hp,o=t.hpOffset,s=this.imgBody;return s.filters=[GameConfig.redFilter],this.mcEffect.aniName=3==i?"all_receive":"receive"+(e?"_win":"_lose"),Promise.all([new Promise(function(t){n.mcEffect.movieClip.once(egret.Event.COMPLETE,function(){t()},n)}).then(function(){n.prgHp.value=r;var t=n.labHp;return t.text=o.toString(),t.visible=!0,t.y=400,t.anchorOffsetX=t.width/2,new Promise(function(e){egret.Tween.get(t,null,null,!0).to({y:200},1e3).call(function(){t.visible=!1,e()})})}),new Promise(function(t){var e="red"==n.currentState?-1:1;egret.Tween.get(s,null,null,!0).to({scaleX:.7*e,scaleY:.7},500,egret.Ease.cubicOut).to({scaleX:.8*e,scaleY:.8},400,egret.Ease.backOut).call(function(){t()})})]).then(function(){s.filters=[]})},e.prototype.playAll=function(){var t=this;return new Promise(function(e){t.mcEffect.aniName=arenaService.actionMap[3]+"_send",t.mcEffect.movieClip.once(egret.Event.COMPLETE,function(){e()},t)})},e}(alien.EventComponent);__reflect(ArenaBattleSite.prototype,"ArenaBattleSite");var ArenaCompare=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.updateSites=function(t,e){this.leftBody.setData(t),this.rightBody.setData(e),this.stop()},e.prototype.play=function(t,e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.visible=!0,this.background.movieClip.gotoAndPlay(1,1),[4,Promise.all([this.leftBody.play(t,2==i),this.rightBody.play(e,1==i)])];case 1:return n.sent(),SoundManager.instance.playEffect(ResNames.sound_arena_injured),[4,Promise.all([this.leftBody.disappear(),this.rightBody.disappear()])];case 2:return n.sent(),this.visible=!1,[2]}})})},e.prototype.stop=function(){this.visible=!1,this.background.movieClip.stop(),this.leftBody.stop(),this.rightBody.stop()},e}(alien.EventComponent);__reflect(ArenaCompare.prototype,"ArenaCompare");var ArenaCompareSite=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.imgBody.mask=this.maskBody,this.registerEvent(this.mcv.movieClip,egret.Event.COMPLETE,this.onComplete,this)},e.prototype.onComplete=function(t){"appear"==this.mcv.movieClip.currentLabel?this.win||3==this.action?this.playEndResolve():this.mcv.movieClip.gotoAndPlay("break",1):this.playEndResolve()},e.prototype.setData=function(t){var e=GameConfig.getMinisterMeta(t.minister.metaId);this.imgBody.source=MinisterEntity.parseBodyUrl(e.icon),this.imgBody.anchorOffsetX=e.body_offset.x,this.imgBody.anchorOffsetY=e.body_offset.y-150},e.prototype.play=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,o=this;return __generator(this,function(s){switch(s.label){case 0:return this.win=e,i=this.action=t.action,n=this.currentState,this[n]=-200,this.alpha=.5,r={alpha:1},r[n]=0,[4,this.mcv.setAniName(arenaService.actionMap[i])];case 1:return s.sent(),this.mcv.movieClip.gotoAndPlay("appear",1),this.alpha=1,egret.Tween.get(this,null,null,!0).to(r,300),[4,new Promise(function(t){o.playEndResolve=t})];case 2:return s.sent(),[2]}})})},e.prototype.disappear=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){egret.Tween.get(t,null,null,!0).to({alpha:0},300).call(e)})];case 1:return e.sent(),[2]}})})},e.prototype.stop=function(){this.mcv.movieClip.stop()},e}(alien.VisualEventComponent);__reflect(ArenaCompareSite.prototype,"ArenaCompareSite");var ArenaGlobalHistory=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSelectMinister=function(t,i){"select"==t&&i&&i.minister&&(arenaService.avenge(i.minister.id,e._selectedData.playerId,0),e.switchState())},e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.height=150,this.blackLayer.alpha=0,this.blackLayer.visible=!1,this.visible=!0,this.list.itemRenderer=IRArenaGlobalHistory,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.blackLayer,egret.TouchEvent.TOUCH_TAP,this.onBlackLayerTap,this),this.registerEvent(this.btnShowMore,egret.TouchEvent.TOUCH_TAP,this.onBtnShowMoreTap,this),this.registerEvent(alien.Dispatcher,IRArenaGlobalHistory.CHALLENGE,this.onChallenge,this),this.registerEvent(gameServer,protocols.WC_OPENTOPPVEWIN_RESPONSE,this.onGlobalHistoryResponse,this)},e.prototype.onBlackLayerTap=function(t){this.switchState()},e.prototype.onBtnShowMoreTap=function(t){this.switchState()},e.prototype.onChallenge=function(t){this._selectedData=t.data,PanelDispatchForArena.instance.show(null,this.onSelectMinister)},e.prototype.onGlobalHistoryResponse=function(t){arenaService.globalHistory&&arenaService.globalHistory.length>0?(this._dataProvider.source=arenaService.globalHistory,this.renderLastItem(arenaService.globalHistory[0]),this.currentState="mini"):this.currentState="empty"},e.prototype.renderLastItem=function(t){if(t){var e=t.winnerName,i=t.beatCount,n=t.loserName;this.labTitle.text=e,this.labContent.textFlow=lang.formatHtml(lang.arena_global_history_content,n,i)}else this.labTitle.text="",this.labContent.text=""},e.prototype.switchState=function(){var t=this,e="mini"==this.currentState?"max":"mini",i="mini"==e?150:1e3,n="mini"==e?0:.5;"max"==e&&(this.blackLayer.visible=!0),egret.Tween.get(this.grp,null,null,!0).to({height:i},500,egret.Ease.cubicInOut),egret.Tween.get(this.blackLayer,null,null,!0).to({alpha:n},500).call(function(){t.currentState=e,t.blackLayer.visible="max"==e})},e}(alien.VisualEventComponent);__reflect(ArenaGlobalHistory.prototype,"ArenaGlobalHistory");var IRArenaGlobalHistory=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.button,egret.TouchEvent.TOUCH_TAP,this.onButtonTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.index,n=e.winnerName,r=e.timestamp,o=e.beatCount,s=e.loserName,a=e.winnerId;this.labNum.text=(i+1).toString(),this.labTitle.text=n,this.labContent.textFlow=lang.formatHtml(lang.arena_global_history_content,s,o),this.labTime.text=lang.time+": "+alien.TimeUtils.dateToString(alien.TimeUtils.tsToDate(r),"{0}/{1}/{2}")+" "+alien.TimeUtils.dateToTimeString(alien.TimeUtils.tsToDate(r),"{2}:{1}"),this.button.visible=a!=mainService.playerBaseInfo.id},e.prototype.onButtonTap=function(t){var i=this.data.winnerId;alien.Dispatcher.dispatch(e.CHALLENGE,{playerId:i})},e.CHALLENGE="CHALLENGE",e}(alien.VisualEventItemRenderer);__reflect(IRArenaGlobalHistory.prototype,"IRArenaGlobalHistory");var BattleInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.progress.minimum=0,this.progress.labelFunction=e.progressLabelFunction},e.prototype.initData=function(t,e,i){this.labName.text=e,this.imgAvatar.source=MinisterAvatar.getAvatarUrl(t),this.progress.maximum=i.troops,this.labHp.text=lang.country_info_fields.hp+":"+i.hp,this.labAttack.text=lang.country_info_fields.attack+":"+i.attack,this.labCritical&&(this.labCritical.text=lang.critical+":"+i.critical+"%"),this.progress.slideDuration=100,this.progress.value=i.troops},e.prototype.setData=function(t){this.progress.slideDuration=1e3,this.progress.value=t.troops},e.progressLabelFunction=function(t,e){return lang.troops+":"+t},e}(alien.EventComponent);__reflect(BattleInfo.prototype,"BattleInfo");var BattleStage=function(t){function e(){var i=t.call(this)||this;return i.troopsMap={},i.troopsPerCount={},i.gap={x:45,y:27},i.playing=!1,e.instance=i,i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.groups={},alien.TickerManager.register(this)},e.prototype.setBgId=function(t){var e=this;RES.getResAsync("battle_bg_"+t,function(t){e.bg.source=t},this)},e.prototype.getGroup=function(t){var e=this.groups[t];return e||(e=this.groups[t]=[]),e},e.prototype.getEnemyGroup=function(t){var e={};for(var i in this.groups)i!=t&&(e[i]=this.groups[i]);return e},e.prototype.addSoldier=function(t,e,i,n,r){var o=this.getGroup(t),s=new Soldier(t);s.x=n,s.y=r,s.dirTo(i),this.container.addChild(s),s.initData({res:e}).then(function(t){}),o.push(s)},e.prototype.transAniTroops=function(t,e){return Math.ceil(t/this.troopsPerCount[e])},e.prototype.initData=function(t,e){this.container.removeChildren(),this.troopsPerCount.blue=35e4>=t?1e4:t/35,this.troopsPerCount.red=35e4>=e?1e4:e/35,this.troopsMap.blue=this.transAniTroops(t,"blue"),this.troopsMap.red=this.transAniTroops(e,"red");var i,n,r=Math.ceil(this.troopsMap.blue/7),o=0;this.getGroup("blue").splice(0);for(var s=0;r>s;s++)for(var a=0;7>a&&(i=s,n=3+(a%2?-1:1)*Math.ceil(a/2),this.addSoldier("blue",0,1,50+n*this.gap.x+i*-this.gap.x,400+n*this.gap.y+i*this.gap.y),o++,!(o>=this.troopsMap.blue));a++);r=Math.ceil(this.troopsMap.red/7),o=0,this.getGroup("red").splice(0);for(var s=0;r>s;s++)for(var a=0;7>a&&(i=s,n=3+(a%2?-1:1)*Math.ceil(a/2),this.addSoldier("red",7001,-1,350+n*this.gap.x+i*this.gap.x,230+n*this.gap.y+i*-this.gap.y),o++,!(o>=this.troopsMap.red));a++);this.sort()},e.prototype.start=function(){this.playing=!0},e.prototype.stop=function(t,e){var i=this;egret.setTimeout(function(){i.playing=!1,e()},this,t)},e.prototype.clean=function(){this.removeChildren()},e.prototype.setTroops=function(t,e){for(var i=this.troopsMap[t],n=this.troopsMap[t]=this.transAniTroops(0>e?0:e,t),r=i-n,o=this.getGroup(t);r>0&&o.length>0;){var s=alien.MathUtils.getRandomFromArray(o,!0);s.status!=SoldierStatus.dead&&(s.dead(),r--)}},e.prototype.update=function(){this.playing&&this.container&&(alien.Utils.enumChildren(this.container,function(t,e){t.update()}),this.sort())},e.prototype.sort=function(){this.container.$children.sort(function(t,e){return t.y-e.y})},e}(alien.VisualEventComponent);__reflect(BattleStage.prototype,"BattleStage",["alien.ITicker"]);var Conquer=function(t){function e(){var e=t.call(this)||this;return e.skinName=battle.ConquerSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=IRWithItemView,this.rewardList.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.rewardList,egret.Event.CHANGING,this.onSelectReward,this),this.registerEvent(gameServer,protocols.WC_BATTLE_INFO_Response,this.onBattleInfoResponse,this),this.registerEvent(this.btnBattle,egret.TouchEvent.TOUCH_TAP,this.onBtnBattleTap,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.renderInfo()},e.prototype.renderInfo=function(){this.btnBattle.touchEnabled=!0;var t=battleService.country,e=battleService.gotCount,i=battleService.totalCount;if(t){var n=activityTimeService.getById(battleService.conquerActId);this.currentState=n&&n["int"]==parseInt(GameConfig.strongholdIds[GameConfig.strongholdIds.length-1])?"full":"normal",this.labCountryName.text=t.name,this.labArea.text=t.area.toString(),this.labTroops.text=wsy.Utils.shortCurrency(t.troops),this.labStrongholds.text=e+"/"+i,this._dataProvider.source=t.reward}},e.prototype.onBattleInfoResponse=function(t){this.renderInfo()},e.prototype.onSelectReward=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.rewardList.selectedItem.id})},e.prototype.onBtnBattleTap=function(t){this.btnBattle.touchEnabled=!1,battleService.setStory()},e}(StackView);__reflect(Conquer.prototype,"Conquer");var GeneralSite=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=0==t.index?this.masterAvatar:this.slaveAvatar;if(t.hasOwnProperty("minister")){this.currentState=0==t.index?"master":"slave";var i=t.minister;i?(e.id=i.metaId,this.labTitle.text=i.meta.name):(e.id=null,this.labTitle.text="")}else switch(this.currentState="closed",e.id=null,t.field){case"tech":this.labCondition.text=lang.format(lang.tech_condition);break;case"vip":this.labCondition.text=lang.format(lang.vip_condition,t.vip)}},e}(alien.EventComponent);__reflect(GeneralSite.prototype,"GeneralSite");var MCDFCache=function(){function t(){this.caches={}}return Object.defineProperty(t,"instance",{get:function(){return void 0==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getMovieClipData=function(t){var e=this.caches[t];return e||(e=this.caches[t]={callbacks:[]}),e.data?Promise.resolve(e.data):e.loading?new Promise(function(t,i){e.callbacks.push(t)}):(e.loading=!0,this.loadMCDF(t).then(function(t){return e.loading=!1,e.data=t,e.callbacks.forEach(function(e){e(t)}),delete e.callbacks,t}))},t.prototype.loadMCDF=function(t){var e=this;return new Promise(function(i,n){function r(){o&&s&&i(new egret.MovieClipDataFactory(o,s))}var o,s;RES.getResAsync("animation_"+t+"_json",function(t,e){o=t,r()},e),RES.getResAsync("animation_"+t+"_png",function(t,e){s=t,r()},e)})},t}();__reflect(MCDFCache.prototype,"MCDFCache");var SoldierStatus;!function(t){t[t.none=0]="none",t[t.created=1]="created",t[t.idle=2]="idle",t[t.walk=3]="walk",t[t.attack=4]="attack",t[t.dead=5]="dead"}(SoldierStatus||(SoldierStatus={}));var Soldier=function(t){function e(e){var i=t.call(this)||this;return i.attackDis=70,i.groupName=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=this.mc=new egret.MovieClip;this.addChild(t)},e.prototype.initData=function(t){var e=this,i=t.res;return this.speed=Math.random()+2,this.status=SoldierStatus.none,MCDFCache.instance.getMovieClipData(i).then(function(t){e.mc.movieClipData=t.generateMovieClipData(i),e.mc.frameRate=8,e.status=SoldierStatus.created,e.idle()})},e.prototype.update=function(){if(this.status!=SoldierStatus.dead&&this.status!=SoldierStatus.none){if(this.target)this.target.status==SoldierStatus.dead&&(this.target=null,this.idle());else switch(this.status){case SoldierStatus.idle:case SoldierStatus.walk:this.target=this.findEnemy()}this.target?this.distanceToOther(this.target)<this.attackDis?this.attack(this.target):this.walkTo(this.target):this.idle()}},e.prototype.dirTo=function(t){this.scaleX=alien.MathUtils.sign(t)},e.prototype.findEnemy=function(){var t=null,e=(Number.MAX_VALUE,BattleStage.instance.getEnemyGroup(this.groupName));for(var i in e){var n=e[i];t=alien.MathUtils.getRandomFromArray(n)}return t},e.prototype.walkTo=function(t){this.walk();var e=Math.atan2(t.y-this.y,t.x-this.x),i=Math.cos(e)*this.speed;this.x+=i,this.y+=Math.sin(e)*this.speed,this.dirTo(i)},e.prototype.idle=function(){this.status!=SoldierStatus.idle&&(this.status=SoldierStatus.idle,this.mc.gotoAndPlay("idle",-1))},e.prototype.walk=function(){this.status!=SoldierStatus.walk&&(this.status=SoldierStatus.walk,this.mc.gotoAndPlay("walk",-1))},e.prototype.attack=function(t){this.dirTo(t.x-this.x),this.status!=SoldierStatus.attack&&(this.status=SoldierStatus.attack,this.mc.gotoAndPlay("attack",-1))},e.prototype.dead=function(){var t=this;this.status!=SoldierStatus.dead&&(this.status=SoldierStatus.dead,this.mc.stop(),egret.Tween.get(this,null,null,!0).to({alpha:0},200).call(function(){t.parent.removeChild(t)}))},e.prototype.distanceToOther=function(t){var e=this.x-t.x,i=2*(this.y-t.y);return Math.sqrt(e*e+i*i)},e}(egret.DisplayObjectContainer);__reflect(Soldier.prototype,"Soldier");var Suppress=function(t){function e(){var e=t.call(this)||this;return e.skinName=battle.SuppressSkin,e
}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRSuppressCountry,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectItem,this),this.registerEvent(this.btnSuppress,egret.TouchEvent.TOUCH_TAP,this.onBtnSuppressTap,this),this.registerEvent(battleService,EventNames.UPDATE_SUPPRESS,this.onUpdateSuppress,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.update()},e.prototype.update=function(){var t=battleService.getSuppressCountries();t.length>0&&(this._dataProvider.source=t),this.currentState=t.length>0?"normal":battleService.country.id>7006?"empty":"no_open"},e.prototype.onSelectItem=function(t){t.preventDefault()},e.prototype.onBtnSuppressTap=function(t){var e=this.list.selectedItem;if(e){var i={troops:e.suppress_troops,hp:e.hp,attack:e.attack,bg:alien.MathUtils.makeRandomInt(5,1),reward:e.suppressReward};SceneController["goto"](ConstantNames.SCENE_BATTLE,{country:e,stronghold:i,type:1})}},e.prototype.onUpdateSuppress=function(t){this.update()},e}(StackView);__reflect(Suppress.prototype,"Suppress");var IRSuppressCountry=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labName.text=e.name,this.labFightValue.text=lang.fight_value+":"+wsy.Utils.shortCurrency(e.suppress_troops*(5*e.attack+e.hp)),this.labTroops.textFlow=lang.formatHtml(lang.arena_troops,e.suppress_troops)},e}(alien.VisualEventItemRenderer);__reflect(IRSuppressCountry.prototype,"IRSuppressCountry");var IncenseRankReward=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._rank=1e3,e.skinName=incense.IncenseRankRewardSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.registerEvent(gameServer,ProtocolConfigs.WC_OPENTOP_RESPONSE,this.onOpenTopResponse,this),this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.listRank.itemRenderer=IRIncenseRankAward,this.listRank.dataProvider=this._dataProviderRank=new eui.ArrayCollection},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this._type=e.type),rankService.openTop(this._type)},e.prototype.update=function(){var t=this;this.currentState=this._type==RankService.RankType.TYPE_BURN_PERSON?"person":"union";var e=activityService.getActivityListByType(ActivityEntity.ACTIVITY.TYPE_BURN_INCENSE),i=[],n=[];this._dataProviderRank&&(e.forEach(function(e){var r={reward:{items:[],"extends":[]}};t._type==RankService.RankType.TYPE_BURN_PERSON?(r.reward.items=e.reward.items.slice(0,4),r.reward["extends"]=e.reward["extends"].slice(0,2)):(r.reward.items=e.reward.items.slice(4),r.reward["extends"]=e.reward["extends"].slice(2)),t._rank>=r.reward["extends"][0].extend&&t._rank<=r.reward["extends"][1].extend&&(n=r.reward.items),i.push(r)}),this._dataProviderRank.source=i.sort(function(t,e){var i=0;t.reward["extends"][0]&&(i=t.reward["extends"][0].extend);var n=0;return e.reward["extends"][0]&&(n=e.reward["extends"][0].extend),i-n}),this._dataProvider.source=n)},e.prototype.onOpenTopResponse=function(t){if(t.data.error>0)return void this.update();t.data.self.length>0?(this.labRank.text=t.data.self[0].num+1+"",this._rank=t.data.self[0].num+1):(this.labRank.text=lang.nothing,this._rank=1e3),this.update()},e}(StackView);__reflect(IncenseRankReward.prototype,"IncenseRankReward");var IRIncenseRankAward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=0;e.reward["extends"][0]&&(i=e.reward["extends"][0].extend);var n=i;e.reward["extends"][1].extend&&(n=e.reward["extends"][1].extend),i==n?this.labTitle.text=lang.format(lang.season_award_title[i],i):n>=999?this.labTitle.text=lang.format(lang.season_award_title[4],i-1):this.labTitle.text=lang.format(lang.season_award_title[0],i+"-"+n),this._dataProvider.source=e.reward.items},e.prototype.onSelectItem=function(t){t.preventDefault();var e=this.list.selectedItem;PanelItemDetails.instance.show({id:e.id})},e}(alien.VisualEventItemRenderer);__reflect(IRIncenseRankAward.prototype,"IRIncenseRankAward");var IncenseShopItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnBuy,egret.TouchEvent.TOUCH_TAP,this.onBtnBuyTap,this),this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this)},e.prototype.setData=function(t){this._data=t,this.item.metaId=t.id;var e=GameConfig.getItemMeta(t.id),i=packService.getCountByMetaId(e.id);if(this.labName.text=e.name,this.labName.textColor=GameConfig.QUALITY_COLORS[e.quality],this.labDesc.text=e.intro,this.labCnt.text=i+"",-1==t.sequence)return void(this.currentState="go");switch(this.currentState="buy",t.sale_type){case 1:this.imgPrice.source="icon_gold_single";break;case 4:this.imgPrice.source="icon_silver"}this.labPrice.text=t.price+"";var n=t.limit_count-shopService.getBuyCnt(t.sequence);this.labLimit.text=lang.shop_limit+":"+n},e.prototype.onBtnBuyTap=function(t){var e=this;PanelShopBuyItem.instance.show({shopItem:this._data},function(t,i){"confirm"==t&&alien.Dispatcher.dispatch(EventNames.BUY_INCENSE_ITEM,{seq:e._data.sequence,count:i.count})})},e.prototype.onBtnGoTap=function(t){PanelActivity.instance.show()},e}(alien.VisualEventComponent);__reflect(IncenseShopItem.prototype,"IncenseShopItem");var ChatMessage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setData=function(t){this._chatData=t,t.privilegeType>=0?(this.vipItem.visible=!0,this.vipItem.vip=t.privilegeType):this.vipItem.visible=!1,this.labName.text=t.senderName+(t.unionName?lang.format(lang.title_symbol,t.unionName):""),this.labContent.text=t.content,t.sender==dataCenterService.pid?this.labName.textColor=35085:this.labName.textColor=29656,this.currentState=t.partyId>0?"party":"normal",this.vipItem.x=this.grpName.width+this.grpName.x+15,this.playerIcon.setPlayer(t.icon)},e}(alien.EventComponent);__reflect(ChatMessage.prototype,"ChatMessage");var ChatMessageList=function(t){function e(){var e=t.call(this)||this;return e._type=0,e.skinName=chat.ChatMessageListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(chatService,EventNames.UPDATE_CHAT,this.onUpdateChat,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this)},e.prototype.active=function(i){t.prototype.active.call(this,i),i&&i.hasOwnProperty("type")&&(this._type=e.chatTapMap[i.type]),this.onUpdateChat()},e.prototype.onUpdateChat=function(t){if(void 0===t&&(t=null),t){var e=t.data.type;this._type==e&&this.renderList()}else this.renderList()},e.prototype.onSelectItem=function(t){t.preventDefault(),this.list.selectedItem.partyId&&alien.Dispatcher.dispatch(EventNames.JOIN_PARTY,{partyId:this.list.selectedItem.partyId})},e.prototype.renderList=function(){var t=this;this._dataProvider.source=chatService.getMessageSlot(this._type),alien.EgretUtils.callLater(function(){t.scroller.stopAnimation(),t.list.validateNow();var e=t.scroller.viewport,i=t.scroller.viewport.scrollV;e.scrollV=Math.max(e.contentHeight-e.height,i),chatService.setNewMsgNum(t._type,0)})},e.chatTapMap=[MessageEntity.ChatType.TYPE_WORLD,MessageEntity.ChatType.TYPE_UNION],e}(StackView);__reflect(ChatMessageList.prototype,"ChatMessageList");var alien;!function(t){var e=function(){function t(t){void 0===t&&(t=1),this._playing=!1,this._all=[],this.interval=t}return Object.defineProperty(t,"instance",{get:function(){return void 0==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interval",{get:function(){return this._interval},set:function(t){this._interval!=t&&(this._interval=t)},enumerable:!0,configurable:!0}),t.prototype.register=function(t){this._all.indexOf(t)<0&&this._all.push(t)},t.prototype.unregister=function(t){var e=this._all.indexOf(t);e>=0&&this._all.splice(e,1)},t.prototype.activate=function(){this._intervalCount=0,this._playing||(this._playing=!0,egret.startTick(this.onTicker,this))},t.prototype.sleep=function(){this._playing&&(this._playing=!1,egret.stopTick(this.onTicker,this))},t.prototype.onTicker=function(t){this._intervalCount++,this._intervalCount<this._interval||(this._intervalCount=0,this._all.forEach(function(t){t.update()}))},Object.defineProperty(t,"interval",{get:function(){return this.instance.interval},set:function(t){this.instance.interval=t},enumerable:!0,configurable:!0}),t.register=function(t){this.instance.register(t)},t.unregister=function(t){this.instance.unregister(t)},t.activate=function(){this.instance.activate()},t.sleep=function(){this.instance.sleep()},t}();t.TickerManager=e,__reflect(e.prototype,"alien.TickerManager")}(alien||(alien={}));var CountDownImage=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.res="",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=this.img=new eui.Image;alien.Utils.anchorCenter(e),this.addChild(e)},e.prototype.playOne=function(){var t=this.res+"_"+this.value,e=this.img;this.value>0?(alien.Utils.injectProp(e,{source:t,scaleX:.5,scaleY:.5}),egret.Tween.get(e).to({scaleX:1,scaleY:1},300,egret.Ease.backOut)):egret.Tween.get(e).to({scaleX:0,scaleY:0},200,egret.Ease.cubicOut)},e}(CountDown);__reflect(CountDownImage.prototype,"CountDownImage");var CountDownNumber=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.font="",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=this.lab=new eui.BitmapLabel;e.horizontalCenter=0,e.font=this.font,e.y=80,this.addChild(e)},e.prototype.playOne=function(){var t=this.lab;t.text=this.value.toString()},e.prototype.start=function(e){t.prototype.start.call(this,e),this.visible=!0},e.prototype.stop=function(){t.prototype.stop.call(this),this.visible=!1},e}(CountDown);__reflect(CountDownNumber.prototype,"CountDownNumber");var ProgressBar=eui.ProgressBar,DuplicateHPItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._value=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.progress.labelDisplay.visible=!1},e.prototype.onUpdateBoss=function(){this.update()},e.prototype.update=function(){var t=bossService.boss;if(!t||t.id<0)return void(this.progress.value=0);this.imgType.source="buffer_icon_"+(t.type+1);var e=bossService.getBossSumHpById(t.id);this._value=e-t.hp,this._value>e&&(this._value=e);var i=Math.floor(e/10);this.labCount.text="X"+Math.ceil((e-this._value)/i),this.progress.maximum=i;var n=this._value>0?Math.max(1,Math.ceil(this._value/i)):1;n=Math.min(n,10),0!=this._value&&this._value%i==0&&this._value!=e?(this.progress.value=100,n++,n=Math.min(n,10),this.progress.setThumbSource(n)):this._value==e?this.progress.value=0:(this.progress.value=this._value>0?i-this._value%i:i,this.progress.setSource(n)),this.labProgress.text=t.id>0?t.hp+"/"+e:t.hp+""},e}(alien.VisualEventComponent);__reflect(DuplicateHPItem.prototype,"DuplicateHPItem");var HPProgressBar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setSource=function(t){t+1>10?this.track.visible=!1:(this.track.visible=!0,this.track.source="duplicate_progress_"+(t+1)+"_thumb"),this.thumb.source="duplicate_progress_"+t+"_thumb"},e.prototype.setThumbSource=function(t){this.thumb.source="duplicate_progress_"+t+"_thumb"},e}(ProgressBar);__reflect(HPProgressBar.prototype,"HPProgressBar");var DuplicateMinister=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.grp.mask=this.bodyMask},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){if(this.currentState=t?"normal":"add",t&&this._id!=t){this._id=t;var e=ministerService.getById(t);if(e){var i=e.meta;switch(this.labName.text=i.name,this.qualityColor.fillColor=GameConfig.MINISTER_QUALITY_COLORS[i.quality],this.imgBody.source=e.bodyUrl,this.imgBody.x=this.grp.width/2-.6*i.body_offset.x,this.imgBody.y=100-.6*i.body_offset.y,this.labFight.text=lang.minister_info_fields.battleValue+":"+e.battleValue,this.imgType.source="buffer_icon_"+bossService.getBufferIcon(e.id),e.peerage){case 0:case 1:case 2:this.imgBorder.source=ResNames.minister_border_1;break;case 3:case 4:this.imgBorder.source=ResNames.minister_border_2;break;case 5:case 6:this.imgBorder.source=ResNames.minister_border_3}}}},enumerable:!0,configurable:!0}),e}(alien.VisualEventComponent);__reflect(DuplicateMinister.prototype,"DuplicateMinister");var DuplicateRank=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.height=65,this.blackLayer.alpha=0,this.blackLayer.visible=!1,this.visible=!0,this.currentState="mini",this.list.itemRenderer=IRDuplicateRank,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.blackLayer,egret.TouchEvent.TOUCH_TAP,this.onBlackLayerTap,this),this.registerEvent(this.btnShowMore,egret.TouchEvent.TOUCH_TAP,this.onBtnShowMoreTap,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this)},e.prototype.onBlackLayerTap=function(t){this.switchState()},e.prototype.onBtnShowMoreTap=function(t){this.switchState()},e.prototype.onUpdateBossInfo=function(t){this.update()},e.prototype.update=function(){var t=bossService.boss.getMyBossRank();t?(this.labRank.text=lang.union_duplicate_rank_label[1]+t.rank,this.labDamage.text=lang.union_duplicate_rank_label[0]+wsy.Utils.shortCurrency(t.hp)):(this.labRank.text=lang.union_duplicate_rank_label[1]+lang.activity_rank_none,this.labDamage.text=lang.union_duplicate_rank_label[0]+0),this._dataProvider.source=bossService.boss.ranks},e.prototype.switchState=function(){var t=this,e="mini"==this.currentState?"max":"mini",i="mini"==e?65:806,n="mini"==e?0:.5;"max"==e&&(this.blackLayer.visible=!0,this._dataProvider.source=bossService.boss.ranks),egret.Tween.get(this.grp,null,null,!0).to({height:i},500,egret.Ease.cubicInOut),egret.Tween.get(this.blackLayer,null,null,!0).to({alpha:n},500).call(function(){t.currentState=e,t.blackLayer.visible="max"==e}),alien.EgretUtils.callLater(function(){var e=t.scroller.viewport;egret.Tween.get(t.scroller.viewport).to({scrollV:Math.max(e.contentHeight-i-120,0)},500,egret.Ease.cubicInOut)})},e}(alien.VisualEventComponent);__reflect(DuplicateRank.prototype,"DuplicateRank");var IRDuplicateRank=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labName.text=this.data.name,this.labRank.text=this.data.rank,this.labDamage.text=wsy.Utils.shortCurrency(this.data.hp)},e}(alien.VisualEventItemRenderer);__reflect(IRDuplicateRank.prototype,"IRDuplicateRank");var DuplicateSkillItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sumTime=180,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this)},e.prototype.onUpdateBossInfo=function(t){var e=0;switch(this.name){case"normal":e=bossService.boss.buffer1Time,this._sumTime=180;break;case"advance":e=bossService.boss.buffer2Time,this._sumTime=0}e>mainService.tsServer?(this._cdId>0&&countDownService.unregister(this._cdId),this._cdId=countDownService.register(e,this.onSecond.bind(this))):(this.labTime.text="",this.labEffectTime.text=lang.minister_fate_un_active)},e.prototype.onSecond=function(t){if(0>=t)return countDownService.unregister(this._cdId),this._cdId=0,this.labTime.text="",void(this.labEffectTime.text=lang.minister_fate_un_active);switch(this.name){case"normal":this.labTime.text=alien.TimeUtils.timeFormat(t,"{1}:{0}"),this.drawCircle(t),t-90>=0&&(this.labEffectTime.text=alien.TimeUtils.timeFormat(t-90,"{1}:{0}"));break;case"advance":this.labTime.text="",this.labEffectTime.text=alien.TimeUtils.timeFormat(t,"{1}:{0}")}},e.prototype.drawCircle=function(t){var e=this.grp.getChildByName("shape");e||(e=new egret.Shape,e.x=this.grp.width/2,e.y=this.grp.height/2,e.alpha=.5,this.grp.addChild(e),e.name="shape"),this.drawArc(e,t)},e.prototype.drawArc=function(t,e){var i=2*Math.PI/this._sumTime*(this._sumTime-e),n=54.5;t.graphics.clear(),t.graphics.beginFill(0),t.graphics.drawArc(0,0,n,3*Math.PI/2+i/2,3*Math.PI/2-i/2),i+=2*Math.PI/e,t.graphics.endFill(),i>2*Math.PI&&this.grp.removeChild(this.grp.getChildByName("shape"))},e.prototype.onRemovedFromStage=function(e){if(t.prototype.onRemovedFromStage.call(this,e),this._cdId>0){countDownService.unregister(this._cdId),this._cdId=0;var i=this.grp.getChildByName("shape");i&&this.grp.removeChild(i),this.labTime.text=""}},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this.onUpdateBossInfo(null)},e}(alien.VisualEventComponent);__reflect(DuplicateSkillItem.prototype,"DuplicateSkillItem");var GuideHand=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.circleInitProps={scaleX:1,scaleY:1,alpha:0},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reset()},e.prototype.reset=function(){alien.Utils.injectProp(this.imgCircle0,this.circleInitProps),alien.Utils.injectProp(this.imgCircle1,this.circleInitProps)},e.prototype.play=function(){egret.Tween.get(this.imgHand,{loop:!0},null,!0).wait(500).to({rotation:-20},300,egret.Ease.cubicInOut).call(this.playCircle,this).to({rotation:0},300,egret.Ease.cubicInOut)},e.prototype.playCircle=function(){this.reset(),egret.Tween.get(this.imgCircle0,null,null,!0).to({alpha:1}).to({scaleX:3,scaleY:3,alpha:0},500),egret.Tween.get(this.imgCircle1,null,null,!0).wait(200).to({alpha:1}).to({scaleX:3,scaleY:3,alpha:0},500)},e.prototype.stop=function(){egret.Tween.removeTweens(this.imgHand),egret.Tween.removeTweens(this.imgCircle0),egret.Tween.removeTweens(this.imgCircle1),this.imgHand.rotation=0,this.reset()},e}(eui.Component);__reflect(GuideHand.prototype,"GuideHand");var error=egret.error,GuideLayer=function(t){function e(){var i=t.call(this)||this;return i._blinkPadding=12,i._padding=5,i.blink=function(t){return{alpha:.5*(Math.sin(t)+1)*.5+.5}},i.onKnockBoxMove=function(){i.guideBlackLayer.updateKnockout()},e._instance=i,i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(MainStage.instance,egret.TouchEvent.TOUCH_TAP,this.onStageTap,this),this.registerEvent(MainStage.instance,egret.TouchEvent.TOUCH_BEGIN,this.onStageTouchBegin,this),this.registerEvent(alien.Dispatcher,EventNames.GUIDE_POINT,this.onGuidePoint,this)},e.prototype.setup=function(){this.skinName=guide.GuideLayerSkin,this._ani=new alien.Wave(this.imgTapNext,1e3,alien.Wave.fade.bind(null,.5),0,!1),this.imgBody.source=PrincessEntity.parseBodyUrl(200006),this._blink=new alien.Wave(this.imgBlink,1e3,this.blink,0,!1,!0),this._knockoutBox=this.guideBlackLayer.knockout=new egret.Rectangle,this.guideBlackLayer.hitPadding=-this._padding},e.prototype.hide=function(){this.visible=!1},e.prototype.transTapPoint=function(t){return"tap"},e.prototype.onStageTouchBegin=function(t){var e=alien.Utils.getDisplayPath(t.target).join("");GameConfig.logGuidePoint&&t.target!=this.guideBlackLayer&&console.log(this.transTapPoint(t.target),"path:",e)},e.prototype.onStageTap=function(t){if(this._tapForWait&&(this._tapForWait(),this._tapForWait=null),t.target==this.btnSkip)this._playing=!1,this.hide();else{var e=!1;this._currentStep&&this._pointForWait&&"tap"==this._currentStep.type&&(e=this._currentTarget==MainStage.instance||t&&this._currentTarget==t.target),e&&("tap"!=this._currentStep.point&&(this.shield.visible=!0),this.resolvePointForWait(this.transTapPoint(t.target)))}},e.prototype.resolvePointForWait=function(t){this._currentStep&&this._pointForWait&&this._currentStep.point==t&&(this._pointForWait(),this._pointForWait=null)},e.prototype.getGuideID=function(t){var e=-1;for(var i in GameConfig.guide){var n=parseInt(i),r=GameConfig.guide[n];r&&r.point==t&&(e=n)}return e},e.prototype.onGuidePoint=function(t){var e=t.data.point;if(GameConfig.logGuidePoint&&console.log(e),this._playing)this.resolvePointForWait(e);else{var i=this.getGuideID(e);i>=0&&this.playGuide(i)}},e.prototype.playGuide=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:if(!GameConfig.guideEnabled||mainService.isGuideDone(t))return[2];mainService.addGuideFlag(t),e=GameConfig.guide[t],this.visible=!0,this._playing=!0,this._lastStepType=null,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._playGuide(e.steps)];case 2:return n.sent(),[3,4];case 3:return i=n.sent(),[3,4];case 4:return this._playing=!1,mainService.completeGuide(t),this.hide(),[2]}})})},e.prototype._playGuide=function(t,e){return void 0===e&&(e=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return e<t.length?[4,this.playGuideStep(t[e])]:[3,3];case 1:return i.sent(),[4,this._playGuide(t,++e)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.waitForTap=function(){var t=this;return new Promise(function(e){t._tapForWait=e})},e.prototype.waitForPoint=function(){var t=this;return new Promise(function(e){t._pointForWait=e})},e.prototype.waitForDelay=function(t){return alien.EgretUtils.waitPromise(t)},e.prototype.playGuideStep=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:switch(this._currentStep=t,this._blink.stop(),e=t.type){case"dialog":return[3,1];case"tap":return[3,3];case"wait":return[3,7]}return[3,14];case 1:return this.shield.visible=!0,[4,this.playDialog(t)];case 2:return i.sent(),[3,14];case 3:return this.shield.visible=!0,[4,alien.EgretUtils.waitPromise(50)];case 4:return i.sent(),[4,this.playTap(t)];case 5:return i.sent(),this.shield.visible=!1,[4,this.waitForPoint()];case 6:return i.sent(),this.shield.visible="tap"!==this._currentStep.point,this.guideHand.stop(),[3,14];case 7:return[4,alien.EgretUtils.waitPromise(50)];case 8:return i.sent(),[4,this.playWait(t)];case 9:return i.sent(),"string"!=typeof t.point?[3,11]:[4,this.waitForPoint()];case 10:return i.sent(),[3,13];case 11:return[4,this.waitForDelay(t.point)];case 12:i.sent(),i.label=13;case 13:return[3,14];case 14:return this._lastStepType=t.type,[2]}})})},e.prototype.showDialog=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,o;return __generator(this,function(s){return e={alpha:0,x:-600},i={alpha:1,x:-260},n={bottom:-262},r={bottom:0},o=egret.Tween.get(this.imgBody,null,null,!0).to(t?e:i).to(t?i:e,400,egret.Ease.cubicOut),egret.Tween.get(this.grpDialog,null,null,!0).to(t?n:r).to(t?r:n,200,egret.Ease.cubicOut),[2,alien.EgretUtils.getTweenPromise(o)]})})},e.prototype.playDialog=function(t,e){return void 0===e&&(e=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return e<t.contents.length?(this.labDialog.text="　　"+t.contents[e],0!=e?[3,2]:(this.currentState="dialog",this._ani.play(),[4,this.showDialog(!0)])):[3,5];case 1:i.sent(),i.label=2;case 2:return[4,this.waitForTap()];case 3:return i.sent(),[4,this.playDialog(t,++e)];case 4:return i.sent(),[3,7];case 5:return[4,this.showDialog(!1)];case 6:i.sent(),this._ani.stop(),i.label=7;case 7:return[2]}})})},e.prototype.playTap=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,o,s,a,c,l,p,h,u,_,d,f,m,g,v=this;return __generator(this,function(y){switch(y.label){case 0:if(this.currentState="tap",e=t.path,i=t.text,n=this._currentTarget=alien.Utils.getTargetByPath(e),!n)throw error("path["+e+"] can not be found.");return r=n.parent.localToGlobal(n.x,n.y),o=r.x,s=r.y,a=n.width,c=n.height,l=n.scaleX,p=n.scaleY,h=this._blinkPadding,u=this._padding,o-=u,s-=u,a*=l,c*=p,a+=2*u,c+=2*u,_={x:o,y:s,width:a,height:c},d={x:o-h,y:s-h,width:a+2*h,height:c+2*h},f={x:o+a/2,y:s+c/2},this._lastStepType&&"tap"==this._lastStepType?[3,1]:(this._knockoutBox.setTo(o,s,a,c),this.onKnockBoxMove(),alien.Utils.injectProp(this.imgKnockout,_),alien.Utils.injectProp(this.imgBlink,d),alien.Utils.injectProp(this.guideHand,f),this.playTip(i,_),this.guideHand.play(),[3,3]);case 1:return this.labTip.visible=!1,m=400,g=egret.Ease.cubicInOut,egret.Tween.get(this._knockoutBox,{onChange:this.onKnockBoxMove},null,!0).to(_,m,g),egret.Tween.get(this.imgKnockout,null,null,!0).to(_,m,g),egret.Tween.get(this.imgBlink,null,null,!0).to(d,m,g),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(this.guideHand,null,null,!0).to(f,m+100,g).call(function(){v.guideHand.play(),v.playTip(i,_)}))];case 2:y.sent(),y.label=3;case 3:return this._blink.play(),[2]}})})},e.prototype.playWait=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.currentState="wait",[2]})})},e.prototype.playTip=function(t,e){var i=e.x,n=e.y,r=e.width,o=e.height;this.labTip.text=t;var s=i+r/2-this.labTip.width/2;this.labTip.x=alien.MathUtils.valueRange(s,5,alien.StageProxy.width-this.labTip.width-5);var a=n+o+20;this.labTip.y=a>alien.StageProxy.height-this.labTip.height?n-50:a,this.labTip.visible=!0},e}(alien.VisualEventComponent);__reflect(GuideLayer.prototype,"GuideLayer");var KnockoutBlackLayer=function(t){function e(){var e=t.call(this)||this;return e.$knockout=null,e.$hitPadding=0,e.$fillColor=0,e.$fillAlpha=1,e.$graphics=new egret.Graphics,e.$graphics.$setTarget(e),e}return __extends(e,t),e.prototype.$measureContentBounds=function(e){t.prototype.$measureContentBounds.call(this,e),e.setTo(0,0,this.width,this.height)},e.prototype.updateDisplayList=function(e,i){t.prototype.updateDisplayList.call(this,e,i);var n=this.$graphics;if(n.clear(),n.beginFill(this.$fillColor,this.$fillAlpha),this.$knockout){var r=this.$knockout;this.drawRect(n,0,0,this.width,r.y),this.drawRect(n,0,r.y,r.left,r.height),this.drawRect(n,r.right,r.y,Math.max(this.width-r.right,0),r.height),this.drawRect(n,0,r.bottom,this.width,Math.max(this.height-r.bottom,0))}else n.drawRect(0,0,this.width,this.height);n.endFill(),this.$hitBox||(this.$hitBox=new egret.Rectangle),this.$hitBox.copyFrom(this.$knockout),this.$hitBox.x-=this.$hitPadding,this.$hitBox.y-=this.$hitPadding,this.$hitBox.width-=2*this.$hitPadding,this.$hitBox.height-=2*this.$hitPadding,this.$invalidateContentBounds()},e.prototype.drawRect=function(t,e,i,n,r){0>=n||0>=r||t.drawRect(e,i,n,r)},e.prototype.$hitTest=function(t,e){var i=this.parent.globalToLocal(t,e),n=this.getBounds().containsPoint(i)?this:null;return n&&(n=this.hitTestPixel(t,e)),n},e.prototype.hitTestPixel=function(t,e){var i=this.parent.globalToLocal(t,e);return this.$hitBox.containsPoint(i)?null:this},Object.defineProperty(e.prototype,"fillColor",{get:function(){return this.$fillColor},set:function(t){void 0!=t&&this.$fillColor!=t&&(this.$fillColor=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillAlpha",{get:function(){return this.$fillAlpha},set:function(t){this.$fillAlpha!=t&&(this.$fillAlpha=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"knockout",{get:function(){return this.$knockout},set:function(t){this.$knockout!=t&&(this.$knockout=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitPadding",{get:function(){return this.$hitPadding},set:function(t){this.$hitPadding!=t&&(this.$hitPadding=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),e.prototype.updateKnockout=function(){this.invalidateDisplayList()},e}(eui.Component);__reflect(KnockoutBlackLayer.prototype,"KnockoutBlackLayer");var InteriorDevelopment=function(t){function e(){var e=t.call(this)||this;return e.fields=["trade","industry","military"],e.skinName=interior.InteriorDevelopmentSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.listProps.itemRenderer=IRCountryProps,this.listProps.dataProvider=this._propsProvider=new eui.ArrayCollection(this.fields),this.listMinister.itemRenderer=IRWithItemView,this.listMinister.dataProvider=this._ministerProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_CARD_DISPATCH_Response,this.onDispatchResponse,this),this.registerEvent(gameServer,protocols.WC_DISPATCH_CARD_RESPONSE,this.onDispatchCardResponse,this),this.registerEvent(interiorService,EventNames.REFRESH_DEVELOPMENT_QUEUE,this.onRefreshDevelopmentQueue,this),this.registerEvent(alien.Dispatcher,EventNames.FINISH_DEVELOPMENT,this.onFinishDevelopment,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.updateUI()},e.prototype.updateUI=function(){this._propsProvider.refresh(),this._ministerProvider.source=interiorService.getQueue()},e.prototype.onDispatchResponse=function(t){0==t.data.error&&this.updateUI()},e.prototype.onRefreshDevelopmentQueue=function(t){this.updateUI()},e.prototype.onDispatchCardResponse=function(t){if(!(t.data.error>0)){var e=t.data.doubleFlag?4:1,i=interiorService.getDevelopmentField(this._developData.activityTime.type),n=this._developData.minister.meta,r=ministerService.getById(this._developData.activityTime.ministerId),o=0;r.fieldsModified.some(function(t){var e=t.field,i=t.value,n=t.oldValue;return"exploit"==e&&i>n?(o=i-n,!0):void 0});var s=lang.formatHtml(lang.development_finish_content[0],GameConfig.INTERIOR_COLORS[this._developData.activityTime.type],lang.country_props[i],t.data.value),a=lang.formatHtml(lang.development_finish_content[1],GameConfig.MINISTER_QUALITY_COLORS_2[n.quality],n.name,o),c=[s,a];PanelWorkFinish.instance.show({type:e,reward:null,contents:c})}},e.prototype.onFinishDevelopment=function(t){this._developData=t.data.developData,interiorService.finish(this._developData.activityTime.id)},e}(StackView);__reflect(InteriorDevelopment.prototype,"InteriorDevelopment");var IRCountryProps=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=mainService.playerInfo[e];this.imgType.source="common_img_"+e,this.labValue.text="+"+wsy.Utils.shortCurrency(i)},e}(eui.ItemRenderer);__reflect(IRCountryProps.prototype,"IRCountryProps");var alien;!function(t){var e=function(){function t(e,i,n,r,o,s,a,c){void 0===n&&(n=null),void 0===r&&(r=0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===a&&(a=0),void 0===c&&(c=0),this._oldProperties={},this._t=0,this.target=e,this._calProps=n?n:t.round,this.duration=i,this.loop=r,this.reverse=s,this.delay=a,this.offset=c,this.updateRegisterPos(),o&&this.play()
}return t.prototype.updateRegisterPos=function(){this._oldProperties.x=this.target.x,this._oldProperties.y=this.target.y,this._oldProperties.scaleX=this.target.scaleX,this._oldProperties.scaleY=this.target.scaleY,this._oldProperties.skewX=this.target.skewX,this._oldProperties.skewY=this.target.skewY,this._oldProperties.rotation=this.target.rotation,this._oldProperties.alpha=this.target.alpha},t.prototype.play=function(){return this._tween?this._tween:(this._count=0,this._playStep())},t.prototype._playStep=function(){return this.loop>0&&this._count>=this.loop?void this.stop():(this._count++,this.t=this.reverse?2*Math.PI:0,this._tween=egret.Tween.get(this),this._tween.wait(this.delay).to({t:this.reverse?0:2*Math.PI},this.duration).call(this._playStep,this),this._tween)},Object.defineProperty(t.prototype,"t",{get:function(){return this._t},set:function(t){if(this.target.stage){this._t=t;var e=this._calProps.call(this,this._t+this.offset);e.hasOwnProperty("x")&&(this.target.x=(e.x||0)+this._oldProperties.x),e.hasOwnProperty("y")&&(this.target.y=(e.y||0)+this._oldProperties.y),e.hasOwnProperty("sx")&&(this.target.scaleX=e.sx),e.hasOwnProperty("sy")&&(this.target.scaleY=e.sy),e.hasOwnProperty("skewX")&&(this.target.skewX=e.skewX),e.hasOwnProperty("skewY")&&(this.target.skewY=e.skewY),e.hasOwnProperty("r")&&(this.target.rotation=e.r),e.hasOwnProperty("alpha")&&(this.target.alpha=e.alpha)}},enumerable:!0,configurable:!0}),t.prototype.stop=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=1e3),this._tween&&(egret.Tween.removeTweens(this),t&&egret.Tween.get(this.target).to(this._oldProperties,i),this._tween=null)},Object.defineProperty(t.prototype,"playing",{get:function(){return null!=this._tween},enumerable:!0,configurable:!0}),t.round=function(t,e){return{x:Math.cos(e)*t,y:Math.sin(e)*t}},t.cos=function(t,e){return{x:Math.cos(e)*t,y:0}},t.sin=function(t,e){return t=t||1,{x:0,y:Math.sin(e)*t}},t.rotate=function(t){return{r:360*t/Math.PI/2}},t.shake=function(t,e,i){return{r:Math.sin(i*e)*t}},t.breath=function(t,e){return{sx:Math.sin(e)*t+1,sy:-Math.sin(e+Math.PI/4)*t+1}},t.zoom=function(t,e){return t=t||.1,{sx:Math.sin(e)*t+1,sy:Math.sin(e)*t+1}},t.fade=function(t,e){return{alpha:.5*(Math.sin(e)+1)+t}},t}();t.Wave=e,__reflect(e.prototype,"alien.Wave",["alien.IAnimation"])}(alien||(alien={}));var MinisterDevelopmentItem=function(t){function e(){var e=t.call(this)||this;return e.onSelectMinisterResult=function(t,e){"select"==t&&interiorService.dispatch(e.minister,e.type)},e.onSecond=function(t){0>=t&&e.setData(e._data),e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")},e.once(egret.Event.REMOVED_FROM_STAGE,e.onRemovedToStage,e),e}return __extends(e,t),e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.imgBody.scaleX=.65,this.imgBody.scaleY=.65,this.imgBody.mask=this.bodyMask,this.registerEvent(this.grpSend,egret.TouchEvent.TOUCH_TAP,this.onGroupTap,this),this.registerEvent(this.button,egret.TouchEvent.TOUCH_TAP,this.onButtonTap,this),this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this),this.enableEvents()},e.prototype.onGroupTap=function(t){switch(this.currentState){case"closed":break;case"available":PanelDevelopSelect.instance.show(this.onSelectMinisterResult.bind(this));break;case"in_use":}},e.prototype.onButtonTap=function(t){this._data&&alien.Dispatcher.dispatch(EventNames.FINISH_DEVELOPMENT,{developData:this._data})},e.prototype.onBtnGoTap=function(t){SceneController.jump(ConstantNames.SCENE_TECHNOLOGY)},e.prototype.setData=function(t){if(!t)return void(this.currentState="available");if(t.lock){this.grp.filters=[GameConfig.greyFilter],this.currentState="lock";var e=GameConfig.getTechMeta(t.techId);return void(e&&(this.labCondition.text=lang.format(lang.tech_condition_details,e.name)))}if(this.grp.filters=[],this._data=t,this.setInfo(t),t.hasOwnProperty("minister")&&t.activityTime.timestamp-mainService.tsServer>0){this.currentState="in_use";var i=t.activityTime;this.cdId=countDownService.register(i.timestamp,this.onSecond)}else t.activityTime.timestamp-mainService.tsServer<=0&&(this.currentState="finish");wsy.Utils.updateAllImages(this)},e.prototype.setInfo=function(t){var e=t.minister,i=e.meta,n=t.activityTime,r=interiorService.getDevelopmentField(n.type),o=this.typeName=lang.country_props[r];this.imgBody.source=MinisterEntity.parseBodyUrl(i.icon),this.imgBody.x=180-.65*i.body_offset.x,this.imgBody.y=120-.65*i.body_offset.y,this.labType.text=this.typeName+lang.develop,this.labType.textColor=GameConfig.INTERIOR_COLORS[n.type],this.labFinishType.text=this.typeName+lang.develop,this.labFinishType.textColor=GameConfig.INTERIOR_COLORS[n.type],this.labEffect.text=o+"+"+interiorService.getDevelopmentAddition(e,r)},e}(alien.EventComponent);__reflect(MinisterDevelopmentItem.prototype,"MinisterDevelopmentItem");var CapitalEffectLayer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.birdsConfigs=[{init:{scaleX:.8,scaleY:.8},animation:{x:0,y:0,radius:50,offRadians:0}},{init:{},animation:{x:20,y:20,radius:60,offRadians:Math.PI}}],e.sail=function(t){return{sx:.07*Math.sin(t)+1}},e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.animations=[],alien.Utils.enumChildren(this.birdsContainer,function(t,i){e.animations.push(new CapitalBird(t,e.birdsConfigs[i]))}),this.animations.push(new alien.Wave(this.shipSailSmall,4e3,this.sail,0,!1,!1,3e3)),this.animations.push(new alien.Wave(this.shipSailBig,4e3,this.sail,0,!1,!1,3e3)),this.play()},e.prototype.play=function(){this.animations.forEach(function(t){t.play()})},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this.animations&&this.play()},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this.animations.forEach(function(t){t.stop()})},e}(alien.VisualEventComponent);__reflect(CapitalEffectLayer.prototype,"CapitalEffectLayer");var CapitalBird=function(){function t(t,e){var i=this;this.fly=function(t){var e=i.config.animation;return{x:Math.cos(t+e.offRadians)*e.radius+e.x,y:Math.sin(t+e.offRadians)*e.radius*.3+e.y}},this.config=e,alien.Utils.injectProp(t,e.init),this.wave=new alien.Wave(t,8e3,this.fly,0,!1)}return t.prototype.play=function(){this.wave.play()},t.prototype.stop=function(){this.wave.stop()},t}();__reflect(CapitalBird.prototype,"CapitalBird");var HaremEffectLayer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),alien.TickerManager.register(this),this.playGroup()},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),alien.TickerManager.unregister(this),this.flowerContainer.removeChildren(),egret.clearTimeout(this.timer)},e.prototype.playGroup=function(){for(var t=0,e=alien.MathUtils.makeRandomInt(8,3);e>t;t++)this.flowerContainer.addChild(new Flower);this.timer=egret.setTimeout(this.playGroup,this,1e3*alien.MathUtils.makeRandomInt(12,8))},e.prototype.update=function(){alien.Utils.enumChildren(this.flowerContainer,function(t){t.update()})},e}(alien.VisualEventComponent);__reflect(HaremEffectLayer.prototype,"HaremEffectLayer",["alien.ITicker"]);var Flower=function(t){function e(){var e=t.call(this,RES.getRes("lobby_flower_"+alien.MathUtils.makeRandomInt(5)))||this;return e._t=0,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.rotateSpeed=3*Math.random()+1,e.pos=new alien.Vector2D(-50,500*Math.random()+200),e.velocity=new alien.Vector2D(2*Math.random()+2,1*Math.random()+1),e.delay=200*Math.random(),e.updatePosition(),e}return __extends(e,t),e.prototype.update=function(){this._t++,this._t<this.delay||(this.pos.add(this.velocity),this.rotation+=this.rotateSpeed,this.updatePosition())},e.prototype.updatePosition=function(){this.x=this.pos.x,this.y=this.pos.y},e}(egret.Bitmap);__reflect(Flower.prototype,"Flower");var LobbyBarItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=t.name,i=t.label,n=t.badgeId,r=t.state,o=t.showGlow,s=t.startTime,a=t.endTime;if(s&&a){var c=new Date((new Date).setHours(s[0],s[1],s[2],s[3])).getTime()/1e3,l=new Date((new Date).setHours(a[0],a[1],a[2],a[3])).getTime()/1e3;o=mainService.tsServer-c>0&&mainService.tsServer-l<0?!0:!1}switch(r&&(this.currentState=r),this.state=r,this.labelDisplay.text=i,this.badgeView.bid=n,this.glow.visible=o,o?this.glow.play():this.glow.stop(),r){case"dynamic":this.ani.dbName="bottom_bar_"+e,this.width=t.width;break;default:this.iconDisplay.source="lobby_icon_"+e}},e.prototype.stateChanged=function(t){var e;switch(this.state){case"dynamic":e=this.ani;break;default:e=this.iconDisplay}switch(t){case"up":e.verticalCenter=0;break;case"down":e.verticalCenter=-10}},e}(eui.Component);__reflect(LobbyBarItem.prototype,"LobbyBarItem");var LobbyCapital=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.LOBBY_CAPITAL,e.x=alien.StageProxy.width,e}return __extends(e,t),e.prototype.getSkinName=function(){return lobby.LobbyCapitalSkin},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.grpTapBroad,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.grpTapBroad,egret.TouchEvent.TOUCH_CANCEL,this.onGrpButtonsCancel,this),this.registerEvent(this,egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this._animations=[],alien.Utils.enumChildren(this.grpButtons,function(t){e._animations.push(new alien.Wave(t,2e3,alien.Wave.sin.bind(null,5),0,!1,!1,0,Math.random()*Math.PI*2))})},e.prototype.onWillEnter=function(e,i,n){return this._animations.forEach(function(t){t.play()}),this.setBtnState(),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.onAddToStage=function(t){this.setBtnState()},e.prototype.setBtnState=function(){alien.Utils.enumChildren(this.grpButtons,function(t){openService.getOpenStatus({name:t.name,showTip:!1})?t.filters=null:t.filters=[GameConfig.greyFilter]})},e.prototype.getEnterProps=function(t,e,i){return{props:{x:0}}},e.prototype.getLeaveProps=function(t,e,i){return this._animations.forEach(function(t){t.stop()}),{props:{x:alien.StageProxy.width}}},e.prototype.onGrpButtonsTap=function(t){if(this._touchCancel)return void(this._touchCancel=!1);var e=!1;switch(t.target.name){case"SCENE_VISIT":e=SceneController["goto"](ConstantNames.SCENE_VISIT);break;case"SCENE_TREASURE":e=SceneController["goto"](ConstantNames.SCENE_TREASURE);break;case"rank":PanelRank.instance.show();break;case"SCENE_UNION":e=SceneController["goto"](ConstantNames.SCENE_UNION);break;default:Toast.show({text:lang.closed})}e&&SoundManager.instance.playEffect(ResNames.effect_enter_scene)},e.prototype.onGrpButtonsCancel=function(t){this._touchCancel=!0},e=__decorate([modifyChildren],e)}(LobbyPageBase);__reflect(LobbyCapital.prototype,"LobbyCapital");var LobbyChatBar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.registerEvent(chatService,EventNames.UPDATE_CHAT,this.update,this)},e.prototype.update=function(t){var e=t.data,i=e.type,n=e.message;this.labType.text="["+lang.chat_type[i]+"]",this.labContent.width=this.width-this.labContent.x-210;for(var r=n.content,o=new eui.Label(n.senderName+": "+r);o.textWidth>this.labContent.width;)r=r.slice(0,r.length-1),o.text=r;r!=n.content&&(r+="..."),this.labContent.textFlow=[{text:n.senderName+": ",style:{textColor:16771584}},{text:r,style:{textColor:16777215}}]},e.prototype.onTap=function(t){PanelChat.instance.show()},e}(alien.VisualEventComponent);__reflect(LobbyChatBar.prototype,"LobbyChatBar");var LobbyEffectLayer=function(t){function e(){var e=t.call(this)||this;return e.birds=new egret.MovieClip,e}return __extends(e,t),e.prototype.childrenCreated=function(){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return t.prototype.childrenCreated.call(this),this.container.mask=this.imgMask,e=this.birds,this.container.addChild(e),i=e,[4,alien.MovieClipDataFactory.instance.generateMovieClipData("birds")];case 1:return i.movieClipData=n.sent(),e.play(-1),[2]}})})},e.prototype.playBirds=function(){egret.Tween.get(this.birds,{loop:!0}).to({x:0,y:300,scaleX:.5,scaleY:.5}).wait(3e3*Math.random()+3e3).to({x:500,y:0,scaleX:1,scaleY:1},3e4)},e.prototype.stopBirds=function(){egret.Tween.removeTweens(this.birds),this.birds.x=0},e.prototype.enableEvents=function(){t.prototype.enableEvents.call(this),this.playBirds()},e.prototype.disableEvents=function(){t.prototype.disableEvents.call(this),this.stopBirds()},e}(alien.VisualEventComponent);__reflect(LobbyEffectLayer.prototype,"LobbyEffectLayer");var LobbyHarem=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.LOBBY_HAREM,e.x=-alien.StageProxy.width,e}return __extends(e,t),e.prototype.getSkinName=function(){return lobby.LobbyHaremSkin},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.grpTapBroad,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.grpTapBroad,egret.TouchEvent.TOUCH_CANCEL,this.onGrpButtonsCancel,this),this.registerEvent(this,egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this._animations=[],alien.Utils.enumChildren(this.grpButtons,function(t){e._animations.push(new alien.Wave(t,2e3,alien.Wave.sin.bind(null,5),0,!1,!1,0,Math.random()*Math.PI*2))})},e.prototype.onWillEnter=function(e,i,n){return this._animations.forEach(function(t){t.play()}),this.setBtnState(),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.onAddToStage=function(t){this.setBtnState()},e.prototype.setBtnState=function(){alien.Utils.enumChildren(this.grpButtons,function(t){openService.getOpenStatus({name:t.name,showTip:!1})?t.filters=null:t.filters=[GameConfig.greyFilter]})},e.prototype.getEnterProps=function(t,e,i){return{props:{x:0}}},e.prototype.getLeaveProps=function(t,e,i){return{props:{x:-alien.StageProxy.width}}},e.prototype.onGrpButtonsTap=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:if(this._touchCancel)return this._touchCancel=!1,[2];switch(e=!0,i=t.target.name){case"SCENE_PRINCESS_HOUSE":e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_HOUSE);break;case"SCENE_PRINCESS_WORK":e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_WORK);break;case"SCENE_PRINCESS_RITE":e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_RITE);break;case"SCENE_GARDEN_HOUSE":e=SceneController["goto"](ConstantNames.SCENE_GARDEN_HOUSE);break;case"SCENE_PRINCESS_PARTY":e=SceneController["goto"](ConstantNames.SCENE_PRINCESS_PARTY)}return e?[4,SoundManager.instance.playEffect(ResNames.effect_enter_scene)]:[3,3];case 1:return n.sent(),"princess"!=i?[3,3]:[4,SoundManager.instance.playEffect(ResNames.effect_princess_greet)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onGrpButtonsCancel=function(t){this._touchCancel=!0},e}(LobbyPageBase);__reflect(LobbyHarem.prototype,"LobbyHarem");var LobbyIconGlow=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anis=[],e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.anis.push(new alien.Wave(this.imgDown,1500,alien.Wave.rotate,0,!1),new alien.Wave(this.imgUp,500,alien.Wave.rotate,0,!1))},e.prototype.play=function(){this.anis.forEach(function(t){t.play()})},e.prototype.stop=function(){this.anis.forEach(function(t){t.stop()})},e}(alien.EventComponent);__reflect(LobbyIconGlow.prototype,"LobbyIconGlow");var LobbyMain=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.LOBBY_MAIN,e}return __extends(e,t),e.prototype.getSkinName=function(){return lobby.LobbyMainSkin},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.grpTapBroad,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.grpTapBroad,egret.TouchEvent.TOUCH_CANCEL,this.onGrpButtonsCancel,this),this.registerEvent(this,egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this._animations=[],alien.Utils.enumChildren(this.grpButtons,function(t){e._animations.push(new alien.Wave(t,2e3,alien.Wave.sin.bind(null,5),0,!1,!1,0,Math.random()*Math.PI*2))})},e.prototype.onWillEnter=function(e,i,n){return this._animations.forEach(function(t){t.play()}),this.setBtnState(),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.onAddToStage=function(t){this.setBtnState()},e.prototype.setBtnState=function(){alien.Utils.enumChildren(this.grpButtons,function(t){openService.getOpenStatus({name:t.name,showTip:!1})?t.filters=null:t.filters=[GameConfig.greyFilter]})},e.prototype.getEnterProps=function(t,e,i){return{props:{x:0}}},e.prototype.getLeaveProps=function(t,e,i){return this._animations.forEach(function(t){t.stop()}),{props:{x:(t==ConstantNames.LOBBY_HAREM?1:-1)*alien.StageProxy.width}}},e.prototype.onGrpButtonsTap=function(t){if(this._touchCancel)return void(this._touchCancel=!1);var e=!0;switch(t.target.name){case"SCENE_THRONE":e=!1,SceneController["goto"](ConstantNames.SCENE_THRONE);break;case"SCENE_MINISTER":e=SceneController["goto"](ConstantNames.SCENE_MINISTER);break;case"SCENE_ARENA":e=SceneController["goto"](ConstantNames.SCENE_ARENA);break;case"SCENE_TECHNOLOGY":e=SceneController["goto"](ConstantNames.SCENE_TECHNOLOGY);break;case"SCENE_PRINCE":e=SceneController["goto"](ConstantNames.SCENE_PRINCE)}e&&SoundManager.instance.playEffect(ResNames.effect_enter_scene)},e.prototype.onGrpButtonsCancel=function(t){this._touchCancel=!0},e=__decorate([modifyChildren],e)}(LobbyPageBase);__reflect(LobbyMain.prototype,"LobbyMain");var alien;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"knockoutGrid",{get:function(){return this.$knockoutGrid},set:function(t){this.$knockoutGrid=t,this.$invalidateContentBounds()},enumerable:!0,configurable:!0}),e.prototype.$render=function(){var t=egret.sys,e=this.$Bitmap;if(e[1]){var i=isNaN(e[11])?e[8]:e[11],n=isNaN(e[12])?e[9]:e[12],r=this.scale9Grid||e[0].scale9Grid;r&&this.$knockoutGrid?this.update(this.$renderNode,e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],i,n,e[13],e[14],this.scale9Grid||e[0].scale9Grid,this.fillMode,e[10]):t.BitmapNode.$updateTextureData(this.$renderNode,e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],i,n,e[13],e[14],this.scale9Grid||e[0].scale9Grid,this.fillMode,e[10])}},e.prototype.update=function(t,e,i,n,r,o,s,a,c,l,p,h,u,_,d,f,m){if(e){var g=egret.$TextureScaleFactor;t.smoothing=m,t.image=e,t.imageWidth=u,t.imageHeight=_;var v=r,y=o;p-=c-r*g,h-=l-o*g;var E=d.x-s,S=d.y-a,b=E/g,I=S/g,C=d.width/g,T=d.height/g;0==T&&(T=1,I>=y&&I--),0==C&&(C=1,b>=v&&b--);var P=i,R=P+b,w=R+C,N=v-b-C,A=n,k=A+I,x=k+T,O=y-I-T,B=N*g,M=O*g;if((b+N)*g>p||(I+O)*g>h)return void t.drawImage(i,n,r,o,s,a,p,h);var D=this.$knockoutGrid,U=D.x,L=D.y,G=D.width,F=D.height,W=s,V=W+U,H=V+G;E=U;var Y=G;B=p-H;var j=a,q=j+L,Q=q+F;S=L;var X=F;M=h-Q,I>0&&(b>0&&t.drawImage(P,A,b,I,W,j,E,S),C>0&&t.drawImage(R,A,C,I,V,j,Y,S),N>0&&t.drawImage(w,A,N,I,H,j,B,S)),T>0&&(b>0&&t.drawImage(P,k,b,T,W,q,E,X),C>0&&t.drawImage(R,k,C,T,V,q,Y,X),N>0&&t.drawImage(w,k,N,T,H,q,B,X)),O>0&&(b>0&&t.drawImage(P,x,b,O,W,Q,E,M),C>0&&t.drawImage(R,x,C,O,V,Q,Y,M),N>0&&t.drawImage(w,x,N,O,H,Q,B,M))}},e.prototype.$hitTest=function(e,i){var n=t.prototype.$hitTest.call(this,e,i);return n&&this.pixelHitTest&&(n=this.hitTestPixel2(e,i)),n},e.prototype.hitTestPixel2=function(t,e){var i=this.parent.globalToLocal(t,e);return this.$knockoutGrid.containsPoint(i)?null:this},e}(egret.Bitmap);t.Bitmap=e,__reflect(e.prototype,"alien.Bitmap")}(alien||(alien={}));var LobbyPageController=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return void 0==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this._navigator=new TNavigator(t),this._navigator.addEventListener(alien.Navigator.SCENE_DID_ENTER,this.onDidEnterPage,this),this._navigator.register(ConstantNames.LOBBY_MAIN,LobbyMain),this._navigator.register(ConstantNames.LOBBY_CAPITAL,LobbyCapital),this._navigator.register(ConstantNames.LOBBY_HAREM,LobbyHarem)},Object.defineProperty(t.prototype,"navigator",{get:function(){return this._navigator},enumerable:!0,configurable:!0}),t.prototype.active=function(){var t=this._navigator.currentView;t.active()},t.prototype.inactive=function(){var t=this._navigator.currentView;t.inactive()},t.prototype.onDidEnterPage=function(t){var e="enter_page_"+t.data.name;alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:e}),this.playMusic()},t.prototype.playMusic=function(){var t="music_"+this._navigator.currentName;SoundManager.instance.playMusic(t,{volume:.2})},t}();__reflect(LobbyPageController.prototype,"LobbyPageController");var LobbySideBar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this._isActive=!0,this.btnControl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnControlTap,this)},e.prototype.onBtnControlTap=function(t){this.active=!this.active},e.prototype.applyActive=function(t){void 0===t&&(t=!0),this.btnControl.label=this._isActive?">":"<";var e=this._isActive?0:-this.width;t?egret.Tween.get(this,null,null,!0).to({right:e},200,egret.Ease.cubicOut):this.right=e},Object.defineProperty(e.prototype,"active",{get:function(){return this._isActive},set:function(t){this._isActive=t,this.applyActive()},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(LobbySideBar.prototype,"LobbySideBar");var LobbyTaskBar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.registerEvent(gameServer,protocols.WC_FINISHTIME_RESPONSE,this.onFinishTimeResponse,this),this.registerEvent(taskService,EventNames.UPDATE_TASK,this.update,this),this.animation=new alien.Wave(this.imgFlag,2e3,alien.Wave.zoom.bind(null,.05),0,!1,!1,0,Math.random()*Math.PI*2),this.update()},e.prototype.update=function(){return GameConfig.examineEnabled?void(this.visible=!1):(this.task=taskService.getLobbyTask(),this.task?(this.visible=!0,taskService.getTaskFinishStatus(this.task)?this.currentState="finish":this.currentState="go",void(this.labName.text=lang.task_type[this.task.meta.type]+this.task.meta.desc)):void(this.visible=!1))},e.prototype.onTap=function(t){PanelTask.instance.show(this.task.meta.type-1)},e.prototype.onFinishTimeResponse=function(t){if(0==t.data.error){var e=taskService.getById(taskService.finishId);PanelWorkFinish.instance.show({type:2,reward:e.meta.reward,princessEffect:null})}},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this.animation.stop()},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this.animation.play()},e}(alien.VisualEventComponent);__reflect(LobbyTaskBar.prototype,"LobbyTaskBar");var LoginServerItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){if(t){var e=t.num,i=t.alias,n=t.status;this.labNum.text=lang.format(lang.area_close,e),this.labName.text=i,this.labState.text=lang.area_states[n],this.labState.textColor=parseInt(lang.area_state_colors[n],16)}else this.labNum.text="",this.labName.text=lang.select_server,this.labState.text=""},e.prototype.clean=function(){this.labNum.text="",this.labName.text="",this.labState.text=""},e}(alien.EventComponent);__reflect(LoginServerItem.prototype,"LoginServerItem");var MinisterAvatar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.mask=this.bodyMask},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){if(this._id!=t)if(this._id=t,this._id){var i=GameConfig.getMinisterMeta(this._id);this.qualityColor.fillColor=GameConfig.MINISTER_QUALITY_COLORS[i.quality];var n=e.getBlockAvatarUrl(this._id);RES.getRes(n)&&this.setUrl(n)}else this.setUrl(null);this.qualityColor.visible=!!this._id,this.imgMask.visible=!!this._id},enumerable:!0,configurable:!0}),e.prototype.setUrl=function(t){this.imgAvatar&&(this.imgAvatar.source=t)},e.prototype.setGray=function(t){this.imgBg.filters=t,this.imgFrame.filters=t,this.imgMask.filters=t,this.imgAvatar.filters=t,this.qualityColor.visible=!t},e.prototype.setPrince=function(t){this.setUrl(e.getBlockAvatarUrl(t.getIconId())),this.qualityColor.fillColor=GameConfig.MINISTER_QUALITY_COLORS[t.quality]},e.prototype.setPlayer=function(t){this.setUrl(e.getBlockAvatarUrl(t))},e.getBlockAvatarUrl=function(t){return"minister_avatar_block_"+t},e.getAvatarUrl=function(t){return"minister_avatar_"+t},e}(alien.EventComponent);__reflect(MinisterAvatar.prototype,"MinisterAvatar");var MinisterFate=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterFateSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRMinisterFateGroup,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(alien.Utils.objectValues(GameConfig.fates)),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectMinister,this),this.labCount.text=lang.format(lang.minister_count,ministerService.ministers.length,GameConfig.ministerArray.length)},e.prototype.onSelectMinister=function(t){t.preventDefault()},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.refresh()},e}(StackView);__reflect(MinisterFate.prototype,"MinisterFate");var IRMinisterFateGroup=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRMinisterHead,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.ids.map(function(t){return GameConfig.getMinisterMeta(t)});this._dataProvider.source=e,this.labTitle.text=this.data.name;var i=GameConfig.getFateLevel(this.data);i>0?(400>50*(i+1)?1==this.data.type?this.labMethod.text=lang.minister_fate_condition.level_up+" : "+lang.format(lang.minister_fate_type[3],50*(i+1)):this.labMethod.text=lang.minister_fate_condition.level_up+" : "+lang.format(lang.minister_fate_type[4],i+1):this.labMethod.text=lang.full_level,this.labEffect.text=lang.minister_fate_condition.fate_effect+" : "+lang.format(lang.minister_fate_effects[this.data.addition_type],this.data.addition_value*i),this.labState.text=i+lang.lv,this.labState.textColor=5184512):(this.labMethod.text=lang.minister_fate_condition.active+" : "+lang.minister_fate_type[this.data.type],this.labEffect.text=lang.minister_fate_condition.fate_effect+" : "+lang.format(lang.minister_fate_effects[this.data.addition_type],this.data.addition_value),this.labState.text=lang.minister_fate_un_active,this.labState.textColor=6579300)},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterFateGroup.prototype,"IRMinisterFateGroup");var MinisterHire=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterHireSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.update(),this.registerEvent(alien.Dispatcher,EventNames.MINISTER_HIRE,this.onHireMinister,this),this.registerEvent(gameServer,protocols.WC_CARD_HIRE_Response,this.onHireMinisterResponse,this)},e.prototype.update=function(){this._dataProvider.source=ministerService.getHireMinisterMetas()},e.prototype.onHireMinister=function(t){var e=t.data.meta;Alert.show(lang.formatHtml(lang.hire_minister_alert,GameConfig.MINISTER_QUALITY_COLORS[e.quality],e.name),1,function(t){"confirm"==t.name&&ministerService.hire(e.id)})},e.prototype.active=function(e){t.prototype.active.call(this,e),this.update()},e.prototype.onHireMinisterResponse=function(t){if(0==t.data.error){this.update();var e=GameConfig.getMinisterMeta(t.data.metaId);PanelMinisterHireSuccess.instance.show({meta:e}),SoundManager.instance.playEffect("effect_minister_hire_"+e.type)}},e}(StackView);__reflect(MinisterHire.prototype,"MinisterHire");var MinisterHireItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.registerEvent(this.btnHire,egret.TouchEvent.TOUCH_TAP,this.onBtnHireTap,this),this.registerEvent(this.imgBody,egret.TouchEvent.TOUCH_TAP,this.onBodyTap,this),this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this)},e.prototype.setData=function(t){this.meta=t;var e=ministerService.checkHire(t.id);if(this.currentState=e?"in_hire":11==t.hire_type?"go":"out_of_hire",!e){var i=GameConfig.hireConfigs[t.hire_type];if(i){var n=i.value();if(this.btnHire.visible=i.judgeReach(n,t.hire_cost),14==t.hire_type){var r=GameConfig.getCountryMeta(t.hire_cost),o=GameConfig.getCountryMeta(n);this.labCondition.text=lang.hire_condition+": "+lang.format(lang.minister_hire_conditions[t.hire_type],r.name,o.name,r.name)}else if(25==t.hire_type){var s=GameConfig.getItemMeta(600111);this.labCondition.text=lang.hire_condition+": "+lang.format(lang.minister_hire_conditions[t.hire_type],wsy.Utils.shortCurrency(t.hire_cost),s.name,wsy.Utils.shortCurrency(n),wsy.Utils.shortCurrency(t.hire_cost))}else this.labCondition.text=lang.hire_condition+": "+lang.format(lang.minister_hire_conditions[t.hire_type],wsy.Utils.shortCurrency(t.hire_cost),wsy.Utils.shortCurrency(n),wsy.Utils.shortCurrency(t.hire_cost))}}this.labName.text=t.name,this.labName.lineSpacing=10*(4-t.name.length)+5,this.imgBody.source=MinisterEntity.parseBodyUrl(t.icon),this.imgBody.x=180-.65*t.body_offset.x,this.imgBody.y=90-.65*t.body_offset.y,this.imgQualityFlag.source="minister_quality_flag_"+t.quality},e.prototype.onBtnHireTap=function(t){alien.Dispatcher.dispatch(EventNames.MINISTER_HIRE,{meta:this.meta})},e.prototype.onBodyTap=function(t){PanelMinisterInfo.instance.show({meta:this.meta})},e.prototype.onBtnGoTap=function(t){SceneController.jump(ConstantNames.SCENE_TREASURE)},e}(alien.VisualEventComponent);__reflect(MinisterHireItem.prototype,"MinisterHireItem");var alien;!function(t){var e=function(e){function i(t,i){void 0===i&&(i=null);var n=e.call(this,t,i)||this;return n._beginScale=1,n._scale=1,n._container=i.container,n}return __extends(i,e),i.prototype.onTouchBegin=function(e){2==this._touchPoints.length&&(this._beginDistance=t.MathUtils.distancePoint(this._touchPoints[0].point,this._touchPoints[1].point),this.adjustAnchor())},i.prototype.onTouchMove=function(e){var i=this._touchPoints.length;switch(i){case 2:var n=t.MathUtils.distancePoint(this._touchPoints[0].point,this._touchPoints[1].point);this.adjustAnchor();var r=n-this._beginDistance;this._target.scaleX=this._target.scaleY=this._beginScale+.001*r
}},i.prototype.onTouchEnd=function(t){this._beginScale=this._target.scaleX},i.prototype.adjustAnchor=function(){var e=this._target;this._centerPoint=t.MathUtils.centerPoint(this._touchPoints[0].point,this._touchPoints[1].point);var i=e.parent.globalToLocal(this._centerPoint.x,this._centerPoint.y);e.x=e.anchorOffsetX=i.x*this._beginScale,e.y=e.anchorOffsetY=i.y*this._beginScale,console.log(this._centerPoint,i)},i}(t.Gesture);t.ZoomGesture=e,__reflect(e.prototype,"alien.ZoomGesture")}(alien||(alien={}));var MinisterPicture=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterPictureSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRMinisterGroup,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(MinisterEntity.quality),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectMinister,this),this.labCount.text=lang.format(lang.minister_count,ministerService.ministers.length,GameConfig.ministerArray.length)},e.prototype.onSelectMinister=function(t){t.preventDefault()},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.refresh()},e}(StackView);__reflect(MinisterPicture.prototype,"MinisterPicture");var IRMinisterGroup=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRMinisterHead,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.imgQuality.source="minister_picture_quality_"+(e-1),this._dataProvider.source=GameConfig.getMinisterByQuality(e)},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterGroup.prototype,"IRMinisterGroup");var IRMinisterHead=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.ministerAvatar,egret.TouchEvent.TOUCH_TAP,this.onMinisterTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;return this.ministerAvatar.currentState="normal",this.currentState="normal",e?(this.ministerAvatar.id=e.id,this.labName.text=e.name,void(null==ministerService.getByMetaId(e.id)&&(this.ministerAvatar.currentState="grey",this.currentState="grey",this.ministerAvatar.setUrl(MinisterEntity.getGreyAvatarUrl(e.icon))))):(this.ministerAvatar.currentState="no_quality",void(this.labName.text=lang.minister_fate_coming_soon))},e.prototype.onMinisterTap=function(t){this.data&&PanelMinisterInfo.instance.show({meta:this.data})},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterHead.prototype,"IRMinisterHead");var MinisterQualification=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterQualificationSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRQualification,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this._source=[]),this.registerEvent(alien.Dispatcher,EventNames.MINISTER_GROW_BREAK,this.onMinisterGrowBreak,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDGROW_Response,this.onGrowBreakResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_UPLVLIMIT_Response,this.onPeerageResponse,this)},e.prototype.active=function(e){var i=this;if(t.prototype.active.call(this,e),e){var n=e.minister;this.minister=n,this._source.splice(0),MinisterEntity.abilityClassifyFields.forEach(function(t){i._source.push({type:t,minister:n})}),this._dataProvider.refresh()}},e.prototype.onMinisterGrowBreak=function(t){var e=t.data,i=e.minister,n=e.type;ministerService.growBreak(i,MinisterEntity.abilityClassifyFields.indexOf(n))},e.prototype.onGrowBreakResponse=function(t){var e=this;if(0==t.data.error){var i=this.scroller.viewport.scrollV;this._dataProvider.refresh();var n=t.data,r=n.type,o=n.value,s=this.list.getChildAt(r),a={component:s.getNotificationComponent(),distance:100};if(o>0){var c=MinisterEntity.abilityClassifyFields[r];a.text=lang.minister_info_fields[c]+lang.qualification+"+"+o}else a.text=lang.minister_upgrade_failed,a.color="blue";alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,a),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=Math.max(0,i)})}},e.prototype.onPeerageResponse=function(t){0==t.data.error&&this._dataProvider.refresh()},e.fields=["politics","knowledge","command"],e}(StackView);__reflect(MinisterQualification.prototype,"MinisterQualification");var IRQualification=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.minister,n=e.type,r=i.getQualification(n),o=r-i.getInitQualification(n);this.labQualification.text=lang.minister_info_fields[n]+lang.qualification+":"+r+"(+"+Math.abs(o)+")",this.labQualification.textColor=i.getQualificationColor(r),this.imgIcon.source="minister_info_icon_"+n;var s=GameConfig.getItemMeta(GameConfig.qualificationBooks[n]),a=packService.getCountByMetaId(s.id);this.labItem.textFlow=wsy.Utils.makeColorFraction(s.name+" {0}",lang.count_fraction,a,i.meta.quality),this.labExploit.textFlow=wsy.Utils.makeColorFraction(lang.minister_info_fields.exploit+" {0}",lang.count,i.exploit,i.getNextExploit(n),!1),this.labSuccessRate.text=lang.format(lang.success_rate,Math.min(i.getNextSuccessRate(n),100)),this.button.enabled=a>=i.meta.quality&&i.exploit>=i.getNextExploit(n)},e.prototype.onButtonTap=function(t){alien.Dispatcher.dispatch(EventNames.MINISTER_GROW_BREAK,{minister:this.data.minister,type:this.data.type})},e.prototype.getNotificationComponent=function(){return this.button},e}(eui.ItemRenderer);__reflect(IRQualification.prototype,"IRQualification");var is=egret.is,MinisterSkill=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterSkillSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.setSkillPosition(),this.registerEvent(gameServer,protocols.WC_CARD_ADDSKILL_Response,this.onLearnSkillResponse,this),this.registerEvent(this.grpSkill,egret.TouchEvent.TOUCH_TAP,this.onSkillIconTab,this)},e.prototype.onSkillIconTab=function(t){var e=t.target,i=e.metaId,n=this.getSkillById(i);n&&PanelMinisterSkill.instance.show({skill:n,minister:this.minister})},e.prototype.getSkillById=function(t){var e=null;return this.minister.skills.some(function(i){return i.id==t?(e=i,!0):void 0}),e},e.prototype.onLearnSkillResponse=function(t){0==t.data.error&&this.updateUI(),Toast.show({text:0==t.data.error?lang.minister_skill_upgrade_success:lang.minister_skill_upgrade_failed})},e.prototype.updateUI=function(){var t=this;this.minister.skills.forEach(function(e,i){var n=t.grpSkill.getChildByName("skillIcon"+(4>i?i:12-i));n.metaId=e.id,n.level=e.level+t.minister.getAdditionSkillLevel(e.id)})},e.prototype.setSkillPosition=function(){this.parent.validateNow();for(var t=this.imgBg.width/2,e=this.imgBg.height/2,i=t-55,n=0;8>n;++n){var r=-(2*Math.PI/8*n-7*Math.PI/8);this.addSkillIcon(i*Math.cos(r)+t+this.imgBg.x,i*Math.sin(r)+e+this.imgBg.y,n)}this.addSkillIcon(t+this.imgBg.x,e+this.imgBg.y,8)},e.prototype.addSkillIcon=function(t,e,i){var n=new SkillIcon(t,e,i,!0);this.grpSkill.addChild(n)},e.prototype.active=function(e){if(t.prototype.active.call(this,e),e){var i=e.minister;this.minister=i,this.updateUI()}},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.disableEvents()},e}(StackView);__reflect(MinisterSkill.prototype,"MinisterSkill");var MinisterTreasure=function(t){function e(){var e=t.call(this)||this;return e.skinName=minister.MinisterTreasureSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.listNormal.itemRenderer=IRWithItemView,this.listNormal.dataProvider=this._normalData=new eui.ArrayCollection([0,1,2]),this.listEquipment.itemRenderer=IRWithItemView,this.listEquipment.dataProvider=this._equipmentData=new eui.ArrayCollection([0,1,2]),this.registerEvent(this.listNormal,egret.Event.CHANGING,this.onSelectNormal,this),this.registerEvent(this.listEquipment,egret.Event.CHANGING,this.onSelectEquipment,this),this.registerEvent(alien.Dispatcher,EventNames.GIVE_ITEM,this.onGiveItem,this),this.registerEvent(alien.Dispatcher,EventNames.GIVE_EQUIPMENT,this.onGiveEquipment,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDABILITY_Response,this.onGiveItemResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDEQUIP_Response,this.onGiveEquipmentResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_REMOVEEQUIP_Response,this.onRemoveEquipmentResponse,this),this.registerEvent(gameServer,protocols.WC_EquipStrengthen_Response,this.onItemUpgradeResponse,this)},e.prototype.active=function(e){if(t.prototype.active.call(this,e),e){var i=e.minister;EquipmentItemView.currentMinister=TreasureItemView.currentMinister=this.minister=i,this._normalData.refresh(),this._equipmentData.refresh()}},e.prototype.playThank=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._soundPlaying?[3,2]:(this._soundPlaying=!0,[4,SoundManager.instance.playEffect("effect_minister_thanks_"+this.minister.meta.type)]);case 1:t.sent(),this._soundPlaying=!1,t.label=2;case 2:return[2]}})})},e.prototype.onSelectNormal=function(t){t.preventDefault();var e=this.listNormal.selectedIndex;PanelGiveNormalItem.instance.show({types:[e],target:this.minister,items:MinisterEntity.treasures})},e.prototype.onSelectEquipment=function(t){t.preventDefault();var e=this.listEquipment.selectedItem;PanelGiveEquipment.instance.show({types:[e+11],target:this.minister})},e.prototype.onGiveItemResponse=function(t){0==t.data.error&&(this._normalData.refresh(),PanelGiveNormalItem.instance.updateUI(),SoundManager.instance.stopEffect(this.minister.soundUrl),this.playThank())},e.prototype.onGiveEquipmentResponse=function(t){0==t.data.error&&(this._equipmentData.refresh(),this.playThank())},e.prototype.onRemoveEquipmentResponse=function(t){0==t.data.error&&this._equipmentData.refresh()},e.prototype.onItemUpgradeResponse=function(t){0==t.data.error&&this._equipmentData.refresh()},e.prototype.onGiveItem=function(t){var e=t.data.treasure,i=e.index,n=e.target,r=e.type,o=t.data.count;ministerService.giveItem(n,r,i,o)},e.prototype.onGiveEquipment=function(t){var e=t.data,i=e.item,n=e.target,r=e.equip,o=e.index;r?ministerService.giveEquipment(n,i.id):ministerService.removeEquipment(n,o)},e}(StackView);__reflect(MinisterTreasure.prototype,"MinisterTreasure");var TreasureItemView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setData=function(t){var i=e.currentMinister,n=t,r=MinisterEntity.abilityClassifyFields[n];this.imgName.source="text_treasure_"+r,this.effect.aniName=r+"_ball",this.itemView.icon=r,this.itemView.quality=5,this.labAddValue.text=lang.minister_info_fields[r]+" +"+i.getTreasureAbility(r)},e}(alien.EventComponent);__reflect(TreasureItemView.prototype,"TreasureItemView");var EquipmentItemView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setData=function(t){var e=TreasureItemView.currentMinister,i=t,n=i+11,r=e.getEquipment(i);this.itemView.visible=!!r,r?this.itemView.setItemData(r):this.bg.source="minister_info_treasure_equip_bg_"+n},e}(alien.EventComponent);__reflect(EquipmentItemView.prototype,"EquipmentItemView");var SkillIcon=function(t){function e(e,i,n,r){void 0===r&&(r=!1);var o=t.call(this)||this;return o.skinName=minister.SkillIconSkin,o._anchorCenter=r,o.touchChildren=!1,o.x=e,o.y=i,o.name="skillIcon"+n,o}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._anchorCenter&&(this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2)},Object.defineProperty(e.prototype,"metaId",{get:function(){return this._metaId},set:function(t){if(this._metaId!=t){this._metaId=t;var e=GameConfig.getSkillMeta(this._metaId);this.imgIcon.source="skill_"+e.icon,this.imgName.source="skill_name_"+e.icon}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(t){this._level!=t&&(this._level=t),this.grpLevel.visible=!0,this.labLevel.text=this._level.toString(),this._level>0?(this.labLevel.textColor=16763702,this.imgIcon.filters=null):(this.imgIcon.filters=[GameConfig.greyFilter],this.labLevel.textColor=16777215)},enumerable:!0,configurable:!0}),e}(alien.EventComponent);__reflect(SkillIcon.prototype,"SkillIcon");var BottomNotification=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=EventManager.instance;e.registerOn(this,alien.Dispatcher,EventNames.SHOW_BOTTOM_NOTIFICATION,this.onShow,this),e.enableOn(this),this.bottom=-this.height},e.prototype.onShow=function(t){var e=t.data,i=e.title,n=void 0===i?lang.notice:i,r=e.content,o=e.duration,s=void 0===o?3e3:o;this.labTitle.text=n,this.labContent.text=r,egret.Tween.get(this,null,null,!0).to({bottom:0},300,egret.Ease.cubicOut).wait(s).to({bottom:-this.height},300,egret.Ease.cubicOut)},e}(eui.Component);__reflect(BottomNotification.prototype,"BottomNotification");var alien;!function(t){var e=function(){function e(){}return e.callNet=function(e,i,n,r,o,s){var a=this;return void 0===i&&(i=null),void 0===n&&(n=egret.HttpMethod.GET),void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),new Promise(function(c,l){var p=o?o():e,h=new egret.HttpRequest;h.responseType=egret.HttpResponseType.TEXT,h.addEventListener(egret.Event.COMPLETE,function(t){c(h.response)},a),h.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){l("request error.")},a),h.open(p,n);for(var u in r)h.setRequestHeader(u,r[u]);var _=null;s?_=s():(h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),_=t.Utils.obj2query(i));try{_?h.send(_):h.send()}catch(d){l(d)}})},e.GET=function(e,i,n){return void 0===i&&(i=null),void 0===n&&(n=null),this.callNet(e,i,egret.HttpMethod.GET,n,function(){if(i){var n=t.Utils.obj2query(i);e+=(n.length>0&&e.indexOf("?")<0?"?":"")+n}return e},function(){return null})},e.POST=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this.callNet(t,e,egret.HttpMethod.POST,i)},e.POSTDirectory=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this.callNet(t,e,egret.HttpMethod.POST,i,null,function(){return e})},e}();t.Ajax=e,__reflect(e.prototype,"alien.Ajax")}(alien||(alien={}));var MainFloatNotification=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(alien.Dispatcher,EventNames.SHOW_FLOAT_NOTIFICATION,this.onShow,this),this.registerEvent(alien.Dispatcher,EventNames.CLEAN_FLOAT_NOTIFICATION,this.onClean,this),this.registerEvent(alien.Dispatcher,EventNames.SHOW_FLOAT_NOTIFICATION_IMAGE,this.onShowImage,this),this.registerEvent(alien.Dispatcher,EventNames.SHOW_FLOAT_NOTIFICATION_ITEM,this.onDropItem,this)},e.prototype.onShow=function(t){this.play(t.data)},e.prototype.onClean=function(t){this.clean()},e.prototype.onShowImage=function(t){this.playImage(t.data)},e.prototype.onDropItem=function(t){this.playItem(t.data)},e}(FloatNotification);__reflect(MainFloatNotification.prototype,"MainFloatNotification");var Notice=function(t){function e(){var i=t.call(this)||this;return i._playFlag=!1,i.start=function(){var t=i.queue.shift();if(i._playFlag=!!t,t){var e=new RollText;i.grp.addChild(e),e.x=i.grp.width,e.height=i.grp.height,e.play(i.width,t,i.start,i.end)}},i.end=function(){2==i.grp.numChildren&&(i._playFlag=!1,0==i.queue.length?egret.Tween.get(i.img).to({height:0},400,egret.Ease.cubicOut).call(function(){i.visible=!1}):i.start())},e._instance=i,i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.queue=[],this.touchEnabled=!1,this.touchChildren=!1,this.grp.mask=this.rect,this.enableEvents()},e.show=function(t){e._instance.play(t)},e.prototype.play=function(t){0==this.visible&&(this.visible=!0,egret.Tween.get(this.img).to({height:42},400,egret.Ease.cubicOut)),this.queue.push(t),this._playFlag||this.start()},e.prototype.clean=function(){this.queue.splice(0)},e}(alien.VisualEventComponent);__reflect(Notice.prototype,"Notice");var RollText=function(t){function e(){var e=t.call(this)||this;return e.addChild(e.lab=new eui.Label),e.lab.size=25,e.verticalCenter=0,e.lab.verticalCenter=0,e}return __extends(e,t),e.prototype.play=function(t,e,i,n){var r=this;this.lab.textFlow=lang.formatHtml.apply(lang,[e.textFormat].concat(e.values));var o=(this.width+10)/100*800;egret.Tween.get(this).to({x:t-this.width-10},o).call(function(){i()}).to({x:-this.width},(t-10)/100*800).call(function(){r.parent.removeChild(r),n()})},e}(eui.Component);__reflect(RollText.prototype,"RollText");var Toast=function(t){function e(){var i=t.call(this)||this;return e._instance=i,i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.alpha=0,this._queue=[],this.registerEvent(alien.Dispatcher,EventNames.SHOW_TOAST,this.onShow,this),this.registerEvent(alien.Dispatcher,EventNames.HIDE_TOAST,this.onClean,this)},e.prototype.addAndPlayOne=function(t){var e=this;if(void 0===t&&(t=null),t&&0==this._queue.length&&!this._tween?this._queue.push(t):t&&this._queue.length>0&&t.text!=this._queue[this._queue.length-1].text&&this._queue.push(t),0!=this._queue.length&&!this._tween){var i=this._queue.shift(),n=i.text,r=i.color,o=void 0===r?16773587:r,s=i.duration,a=void 0===s?1e3:s;this.labContent.text=n,this.labContent.textColor=o,this._tween=egret.Tween.get(this.grp,null,null,!0).to({alpha:1},300).wait(a).to({alpha:0},200).call(function(){e._tween=null,e.addAndPlayOne()})}},e.prototype.clean=function(){this._queue.splice(0)},e.prototype.onShow=function(t){this.addAndPlayOne(t.data)},e.prototype.onClean=function(t){this.clean(),egret.Tween.get(this.grp,null,null,!0).to({alpha:0},200)},e.show=function(t){e._instance.addAndPlayOne(t)},e.clean=function(){e._instance.clean()},e}(alien.VisualEventComponent);__reflect(Toast.prototype,"Toast");var OfficeClass=function(t){function e(){var e=t.call(this)||this;return e.groupY=0,e.skinName=office.OfficeClassSkin,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),alien.Utils.enumChildren(this.grp,function(t,i){t.index=i,t.y=e.groupY,e.groupY=t.y+t.height+20}),this.registerEvent(ministerService,EventNames.UPDATE_MINSTER,this.onUpdateMinister,this),this.registerEvent(gameServer,protocols.WC_ADD_CARD_OFFICALRANK_RESPONSE,this.onAddOfficialRankResponse,this)},e.prototype.active=function(e){var i=this;t.prototype.active.call(this,e);var n=(ministerService.getTopGroup(),this.grp.getChildAt(this.grp.numChildren-1)),r=null;this.groupY=0,alien.Utils.enumChildren(this.grp,function(t,e){t.update(),t.y=i.groupY,i.groupY=t.y+t.height+20;var o=alien.Utils.objectValues(GameConfig.classes)[e],s=ministerService.getClassOpenCost(o.id),a=technologyService.getById(s.id);if(a&&a.level>=s.level&&n.y>t.y){var c=ministerService.getMinisterByGrade(o.id+1>9?0:o.id+1);c.length>0&&(n=t)}(!a||a.level<s.level)&&(r=t)}),r&&r.setState(),alien.EgretUtils.callLater(function(){i.scroller.stopAnimation();var t=i.scroller.viewport;egret.Tween.get(t).to({scrollV:Math.min(t.contentHeight-t.height,n.y)},200,egret.Ease.cubicOut)},2)},e.prototype.onUpdateMinister=function(t){var e=t.data.minister;e.fieldsModified.forEach(function(t){var i=t.field,n=t.value,r=t.oldValue;"grade"==i&&r>n&&PanelDecreeOfficeClass.instance.show({minister:e})})},e.prototype.onAddOfficialRankResponse=function(t){var e=this;this.groupY=0;var i=this.scroller.viewport.scrollV;alien.Utils.enumChildren(this.grp,function(t,i){t.update(),t.y=e.groupY,e.groupY=t.y+t.height+20}),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation();var t=e.scroller.viewport;egret.Tween.get(t).to({scrollV:Math.min(t.contentHeight-t.height,i)},200,egret.Ease.cubicOut)},2)},e}(StackView);__reflect(OfficeClass.prototype,"OfficeClass");var OfficeClassGroup=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.index=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IROfficeHead,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this)},e.prototype.update=function(){var t=alien.Utils.objectValues(GameConfig.classes)[this.index],e=ministerService.getClassOpenCost(t.id),i=technologyService.getById(e.id);if(this.imgTitle.source="office_class_"+t.id,i&&i.level>=e.level){this.currentState="open",this.labCost.text=t.cost_meritorious,this.labEffect.text=lang.minister_full_ability+"+"+t.addition_value;var n=ministerService.getMinisterByGrade(t.id),r=ministerService.getMinisterByGrade(t.id+1);r.length>0&&n.push(t),this._dataProvider.source=n,0==n.length?this.list.height=0:this.list.height=165*Math.ceil(n.length/3),this.grpInfo.y=this.list.y+this.list.height+20}else{var o=GameConfig.getTechMeta(e.id);this.currentState="close",this.labCondition.text=lang.format(lang.minister_class_condition,o.name,e.level)}},e.prototype.setState=function(){this.currentState="go"},e.prototype.onBtnGoTap=function(t){SceneController.jump(ConstantNames.SCENE_TECHNOLOGY,{tab:1})},e}(alien.VisualEventComponent);__reflect(OfficeClassGroup.prototype,"OfficeClassGroup");var IROfficeHead=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSelectMinister=function(t,e){"select"==t&&e.minister&&ministerService.addCardOfficialRank(e.minister.id)},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.ministerAvatar,egret.TouchEvent.TOUCH_TAP,this.onMinisterTap,this)},e.prototype.dataChanged=function(){var t=this.data;t.meta?(this.ministerAvatar.currentState="normal",this.ministerAvatar.id=t.metaId,this.grpName.visible=!0,this.labName.text=t.meta.name):(this.ministerAvatar.currentState="add",this.grpName.visible=!1,this.ministerAvatar.id=null)},e.prototype.onMinisterTap=function(t){this.ministerAvatar.id?PanelMinisterDetails.instance.show({minister:this.data}):PanelDispatchForClass.instance.show(this.data.id,this.onSelectMinister)},e}(alien.VisualEventItemRenderer);__reflect(IROfficeHead.prototype,"IROfficeHead");var OfficePositionGroup=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.index=0,e.onSelectMinister=function(t,i){"select"==t&&i.minister&&ministerService.appointment(i.minister,e._positionId),e.list.selectedIndex=-1},e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IROffsetPositionItem,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectPosition,this)},e.prototype.onSelectPosition=function(t){this._positionId=this.list.selectedItem.id,PanelDispatchForOffice.instance.show({position:this.list.selectedItem},this.onSelectMinister)},e.prototype.update=function(){this.imgTitle.source="office_group_"+this.index,0==this._dataProvider.source.length?this._dataProvider.source=GameConfig.getOfficePositionsMetaByGroup(this.index):this._dataProvider.refresh()},e}(alien.VisualEventComponent);__reflect(OfficePositionGroup.prototype,"OfficePositionGroup");var IROffsetPositionItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labName.text=e.name;var i=ministerService.getPositionDataById(e.id);this.avatar.id=i?ministerService.getMinisterById(i.ministerId).meta.icon:null},e}(eui.ItemRenderer);__reflect(IROffsetPositionItem.prototype,"IROffsetPositionItem");var OffsetPosition=function(t){function e(){var e=t.call(this)||this;return e.skinName=office.OfficePositionSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),alien.Utils.enumChildren(this.grp,function(t,e){t.index=e}),this.registerEvent(ministerService,EventNames.UPDATE_MINISTER_POSITION,this.onUpdateMinisterPosition,this)},e.prototype.onAppointment=function(t){0==t.data.error&&this.update(t.data)},e.prototype.onRecall=function(t){0==t.data.error&&this.update(t.data)},e.prototype.onUpdateMinisterPosition=function(t){var e=t.data.type;if(0==e){var i=GameConfig.getPositionMeta(t.data.posData.id);GameConfig.getSkillEffectStrs(i.skill,1).forEach(function(t){alien.Dispatcher.dispatch(EventNames.SHOW_TOAST,{text:t})})}this.update(t.data.posData)},e.prototype.update=function(t){var e=t.id,i=ministerService.getRenderPos(e),n=this.grp.getChildAt(i.group);n.update()},e.prototype.active=function(e){var i=this;t.prototype.active.call(this,e);var n=ministerService.getTopGroup(),r=null;alien.Utils.enumChildren(this.grp,function(t,e){t.update(),n==e&&(r=t)}),alien.EgretUtils.callLater(function(){i.scroller.stopAnimation();var t=i.scroller.viewport;egret.Tween.get(t).to({scrollV:Math.min(t.contentHeight-t.height,r.y)},200,egret.Ease.cubicOut)},2)},e}(StackView);__reflect(OffsetPosition.prototype,"OffsetPosition");var PreferentialView=function(t){function e(){var e=t.call(this)||this;return e.skinName=preferential.PreferentialViewSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(activityService,EventNames.UPDATE_ACTIVITY,this.onUpdateActivity,this),this.registerEvent(activityService,EventNames.UPDATE_PREFERENTIAL,this.onUpdatePreferential,this),this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&e.hasOwnProperty("type")&&(this._type=e.type),this.update()},e.prototype.update=function(){var t="preferential_independent_3",e=0,i=0;0==this._type?(t="preferential_independent_3",e=ActivityEntity.ACTIVITY.TYPE_CHARGE_8,i=ActivityEntity.ACTIVITY.TYPE_CHARGE_12):(t="preferential_dragon_3",e=ActivityEntity.ACTIVITY.TYPE_CHARGE_88,i=ActivityEntity.ACTIVITY.TYPE_CHARGE_128);var n=[e,i];this._dataProvider.source=n,this.imgDesc.source=t;var r=activityService.getActivityByType(e);this.bannerItem.setData(r),this.labDesc.text=r.desc},e.prototype.onUpdateActivity=function(t){this.update()},e.prototype.onUpdatePreferential=function(t){this.update()},e.prototype.onGetMailItemResponse=function(t){var e=[];emailService["delete"](t.data.id),t.data.items.forEach(function(t){if(t.id>0){var i=GameConfig.getItemMeta(t.id),n=GameConfig.getGiftPackMeta(i["export"]);if(n){var r=packService.getItemByMetaId(t.id);r&&(packService.useItem(r.id,t.count),e=e.concat(n.items))}else e.push(t)}}),PanelWorkFinish.instance.show({type:2,reward:e},null),this._dataProvider.refresh()},e.prototype.onMailRecvResponse=function(t){this._dataProvider.refresh()},e}(StackView);__reflect(PreferentialView.prototype,"PreferentialView");var PreferentialItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._rechargeId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnBuy,egret.TouchEvent.TOUCH_TAP,this.onBtnBuyTap,this),this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectedItem,this)},e.prototype.setData=function(t){this.data=t;var e=t;switch(t){case ActivityEntity.ACTIVITY.TYPE_CHARGE_8:this._rechargeId=9;break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_12:this._rechargeId=10;break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_88:this._rechargeId=11;break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_128:this._rechargeId=12}var i=activityService.getActivityByType(e);this.labTitle.text=lang.activity_preferential_title[e];var n=[];i&&i.reward&&i.reward.items.forEach(function(t){n.push(t)});var r=emailService.getBySenderId(e);r?this.currentState="receive":this.currentState=0==activityService.getPreferentialState(e)?"buy":"unBuy",this._dataProvider.source=n},e.prototype.onBtnBuyTap=function(t){shopService.recharge(this._rechargeId)},e.prototype.onBtnReceiveTap=function(t){var e=emailService.getBySenderId(this.data);e&&emailService.getMailItem(e.id)},e.prototype.onSelectedItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e}(alien.VisualEventItemRenderer);__reflect(PreferentialItem.prototype,"PreferentialItem");var PrinceInfo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cdId=0,e._type=0,e.onSecond=function(t){return 0>=t?(e.cdId=0,void e.setInfo(e._type,e._prince)):void(e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setInfo=function(t,e){this._type=t,this._prince=e," "==e.name||""==e.name?this.btnName.label=lang.prince_rename:this.btnName.label=e.name,this.btnCommon.visible=!0,this.btnCommon.enabled=!0,this.btnCommon.x=(this.width-this.btnCommon.width*this.btnCommon.scaleX)/2,this.labLast.x=this.labLeader.x,countDownService.unregister(this.cdId),0==t?(this.grpTime.visible=!1,this.btnExile.visible=!1,this.btnCommon.label=lang.prince_btn_label.training,e.level>=e.getMaxLevel()?this.labLast.text=lang.prince_info_fields.peerages+":   "+lang.prince_peerage[e.peerage]:(this.labLast.x=28,this.labLast.text=lang.prince_info_fields.ability+":   "+e.getAbility()),e.level>=e.getMaxLevel()&&0==e.openFlag?(this.btnExile.visible=!0,this.btnCommon.label=lang.prince_btn_label.open,this.btnCommon.x=this.btnExile.x+this.btnExile.width*this.btnExile.scaleX+10):e.level>=e.getMaxLevel()&&1==e.openFlag?this.btnCommon.visible=!1:e.activity<=0&&(this.btnCommon.label=lang.prince_btn_label.recover)):1==t&&(this.btnExile.visible=!1,this.btnCommon.label=lang.prince_btn_label.pay,this.labLast.text=lang.prince_info_fields.peerages+":   "+lang.prince_peerage[e.peerage],e.openTime-mainService.tsServer>0?(this.cdId=countDownService.register(e.openTime,this.onSecond.bind(this)),this.btnCommon.enabled=!1,this.grpTime.visible=!0):this.grpTime.visible=!1),this.labFirstDesc.text=lang.prince_info_fields.quality+":   ",this.labFirst.text=lang.prince_quality[e.quality-1],this.labFirst.textColor=GameConfig.QUALITY_COLORS[e.quality],this.labPolitics.text=lang.prince_info_fields.politics+":   "+e.politics,this.labKnowledge.text=lang.prince_info_fields.knowledge+":   "+e.knowledge,this.labLeader.text=lang.prince_info_fields.command+":   "+e.command,this.labLevel.text=e.level+"/"+e.getMaxLevel(),e.level>=e.getMaxLevel()?this.labLevel.textColor=16771584:this.labLevel.textColor=16777215
},e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e.playGreet=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._greetPlaying?[3,2]:(this._greetPlaying=!0,[4,SoundManager.instance.playEffect("effect_prince_greet_"+t.type)]);case 1:e.sent(),this._greetPlaying=!1,e.label=2;case 2:return[2]}})})},e}(alien.EventComponent);__reflect(PrinceInfo.prototype,"PrinceInfo");var PrinceNoblesList=function(t){function e(){var e=t.call(this)||this;return e.onExtendResult=function(t){"confirm"==t&&princeService.addMaxSlot()},e.skinName=prince.PrinceNoblesListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPrinceNobles,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnExtend,egret.TouchEvent.TOUCH_TAP,this.onBtnExtendClick,this),this.registerEvent(this.btnTrain,egret.TouchEvent.TOUCH_TAP,this.onBtnTrainClick,this),this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectPrince,this),this.registerEvent(princeService,EventNames.UPDATE_PRINCE,this.update,this),this.registerEvent(gameServer,protocols.WC_PRICESS_ADDMAXSLOT_RESPONSE,this.onAddMaxSlotResponse,this),this.registerEvent(gameServer,protocols.WC_PRICESS_OPENHOURSE_RESPONSE,this.onOpenHouseResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.source=princeService.getNoblesPrinces(),this.labNum.text=lang.prince_seat+":"+princeService.getNoblesPrinces().length+"/"+princeService.getPrinceSeat(),this.showBtns()},e.prototype.onOpenHouseResponse=function(t){this._dataProvider.source=princeService.getNoblesPrinces(),this.list.selectedIndex=0,this.list.selectedItem=this._dataProvider.source[0];var e=this.list.selectedItem;alien.Dispatcher.dispatch(EventNames.SELECT_PRINCE,{prince:e})},e.prototype.init=function(){this._dataProvider.source=princeService.getNoblesPrinces(),this.list.selectedIndex=0,this.list.selectedItem=this._dataProvider.source[0];var t=this.list.selectedItem;alien.Dispatcher.dispatch(EventNames.SELECT_PRINCE,{prince:t}),this.labNum.text=lang.prince_seat+":"+princeService.getNoblesPrinces().length+"/"+princeService.getPrinceSeat(),this.showBtns()},e.prototype.showBtns=function(){0==this._dataProvider.source.length?(this.btnTrain.visible=!1,this.btnExtend.right=20):(this.btnTrain.visible=!0,this.btnExtend.right=180)},e.prototype.getSelectedIndex=function(){return this.list.selectedIndex>0?this.list.selectedIndex:0},e.prototype.getSelectedItem=function(){return this.list.selectedItem},e.prototype.onSelectPrince=function(t){var e=this.list.selectedItem;alien.Dispatcher.dispatch(EventNames.SELECT_PRINCE,{prince:e})},e.prototype.update=function(t){void 0===t&&(t=null),t&&this._dataProvider.source.length==princeService.getNoblesPrinces().length&&t&&t.data&&this._dataProvider.itemUpdated(t.data.prince),this.labNum.text=lang.prince_seat+":"+princeService.getNoblesPrinces().length+"/"+princeService.getPrinceSeat(),this.showBtns()},e.prototype.onAddMaxSlotResponse=function(t){t.data.error>0||(this.labNum.text=lang.prince_seat+":"+princeService.getNoblesPrinces().length+"/"+princeService.getPrinceSeat())},e.prototype.onBtnExtendClick=function(t){var e=technologyService.getById(402013),i=0;if(e&&e.level>0){var n=GameConfig.getBufferMeta(e.meta.levels[e.level].effect);i=n.value}var r=princeService.getPrinceSeat(),o=100*(r-2-i+1);PanelUseThingAlert.instance.show({content:lang.prince_seat_alert_content,id:1,count:o},this.onExtendResult.bind(this))},e.prototype.onBtnTrainClick=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:t=!1,e=0,n.label=1;case 1:return e<princeService.princes.length?(i=princeService.princes[e],i.activity>0&&i.level<i.getMaxLevel()&&" "!=i.ministerId&&""!=i.ministerId?(t=!0,[4,this.onePrinceTrain(i)]):[3,3]):[3,4];case 2:n.sent(),n.label=3;case 3:return++e,[3,1];case 4:return t||Toast.show({text:lang.prince_teacher_tip}),[2]}})})},e.prototype.onePrinceTrain=function(t){var e=this,i=t.activity,n=0;return new Promise(function(r){var o=egret.setInterval(function(){n++,princeService.train(t.ministerId,t.id),n==i&&(egret.clearInterval(o),r())},e,20)})},e}(StackView);__reflect(PrinceNoblesList.prototype,"PrinceNoblesList");var IRPrinceNobles=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){PrinceInfo.playGreet(this.data)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labName.text=e.name,this.labName.textColor=GameConfig.QUALITY_COLORS[e.quality],this.labLevel.text=lang.prince_info_fields.level+":"+e.level+"/"+e.getMaxLevel(),e.peerage<=0?this.labEnergy.text=lang.prince_info_fields.activity+":"+e.activity+"/"+princeService.getMaxEnergy():this.labEnergy.text=lang.prince_peerage[e.peerage],e.level>=e.getMaxLevel()?this.labLevel.textColor=16771584:this.labLevel.textColor=16777215},e}(alien.VisualEventItemRenderer);__reflect(IRPrinceNobles.prototype,"IRPrinceNobles");var PrinceOpenList=function(t){function e(){var e=t.call(this)||this;return e.skinName=prince.PrinceOpenListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPrinceOpen,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnTribute,egret.TouchEvent.TOUCH_TAP,this.onBtnTributeTap,this),this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectPrince,this),this.registerEvent(princeService,EventNames.UPDATE_PRINCE,this.update,this),this.registerEvent(gameServer,protocols.WC_PRICESS_OPENHOURSE_RESPONSE,this.onOpenHouseResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.source=princeService.getOpenPrinces(),this.currentState=this._dataProvider.length>0?"normal":"empty"},e.prototype.onOpenHouseResponse=function(t){this._dataProvider.source=princeService.getNoblesPrinces(),this.currentState=this._dataProvider.length>0?"normal":"empty",this.list.selectedIndex=0,this.list.selectedItem=this._dataProvider.source[0];var e=this.list.selectedItem;alien.Dispatcher.dispatch(EventNames.SELECT_PRINCE,{prince:e})},e.prototype.update=function(t){void 0===t&&(t=null);t&&this._dataProvider.source.length==princeService.getOpenPrinces().length&&t.data&&this._dataProvider.itemUpdated(t.data.prince)},e.prototype.onBtnTributeTap=function(t){var e=princeService.getAwardPrinces();if(princeService.awardRequestNum=e.length>1?e.length:1,princeService.awardResponseNum=0,e.length<=0)return void Toast.show({text:lang.prince_none});var i=0,n=egret.setInterval(function(){var t=e[i];i++,princeService.awardItem(t.id),i==e.length&&egret.clearInterval(n)},this,20)},e.prototype.onSelectPrince=function(t){var e=this.list.selectedItem;alien.Dispatcher.dispatch(EventNames.SELECT_PRINCE,{prince:e})},e.prototype.getSelectedIndex=function(){return this.list.selectedIndex>0?this.list.selectedIndex:0},e.prototype.getSelectedItem=function(){return this.list.selectedItem},e}(StackView);__reflect(PrinceOpenList.prototype,"PrinceOpenList");var IRPrinceOpen=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cdId=0,e.onSecond=function(t){return 0>=t?(e.cdId=0,void e.dataChanged()):void(e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){PrinceInfo.playGreet(this.data)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),countDownService.unregister(this.cdId);var e=this.data;this.labName.text=e.name,this.labName.textColor=GameConfig.QUALITY_COLORS[e.quality],this.labPosition.text=lang.prince_peerage[e.peerage],e.openTime-mainService.tsServer>0?this.cdId=countDownService.register(e.openTime,this.onSecond.bind(this)):this.labTime.text=lang.prince_tribute},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e}(alien.VisualEventItemRenderer);__reflect(IRPrinceOpen.prototype,"IRPrinceOpen");var PrincessAvatar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.imgAvatar.mask=this.avatarMask},Object.defineProperty(e.prototype,"metaId",{get:function(){return this._metaId},set:function(t){if(this._metaId!=t)if(this._metaId=t,this._metaId){this._mata=GameConfig.getPrincessMeta(this._metaId);var i=e.getAvatarUrl(this._mata.icon);this.setUrl(i)}else this.setUrl(null)},enumerable:!0,configurable:!0}),e.prototype.setUrl=function(t){var e=this.imgAvatar;e&&(e.source=t,e.anchorOffsetX=this._mata.avatar_offset.x,e.anchorOffsetY=this._mata.avatar_offset.y)},e.getAvatarUrl=function(t){return PrincessEntity.parseBodyUrl(t)},e}(alien.EventComponent);__reflect(PrincessAvatar.prototype,"PrincessAvatar");var PrincessHire=function(t){function e(){var e=t.call(this)||this;return e.skinName=princess.PrincessHireSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRPrincessHire,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.update()},e.prototype.update=function(){this._dataProvider.source=princessService.getUnHirePrincessMetas()},e.prototype.active=function(e){t.prototype.active.call(this,e),this.update()},e}(StackView);__reflect(PrincessHire.prototype,"PrincessHire");var IRPrincessHire=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgBg.source=PrincessEntity.parseBgUrl(this.itemIndex);var e=this.data;this.btnGo.label=lang.princess_hire_go[e.hire_type],this.labName.text=e.name,this.imgBody.source=PrincessEntity.parseBodyUrl(e.icon),this.imgBody.x=220-.7*e.body_offset.x,this.imgBody.y=20-.7*e.body_offset.y;var i="";if(3==e.hire_type){var n=GameConfig.getStrongholdMeta(e.hire_value).country_id;i=GameConfig.getCountryMeta(n).name}this.labCondition.textFlow=lang.formatHtml(lang.hire_princess_condition+" : "+lang.princess_hire_ways[e.hire_type],i)},e.prototype.onBtnGoTap=function(t){switch(this.data.hire_type){case 2:SceneController.jump(ConstantNames.SCENE_VISIT);break;case 3:SceneController.jump(ConstantNames.SCENE_WORLD_MAP)}},e}(alien.VisualEventItemRenderer);__reflect(IRPrincessHire.prototype,"IRPrincessHire");var PrincessList=function(t){function e(){var e=t.call(this)||this;return e.skinName=princess.PrincessListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRPrincess,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(princessService.princesses),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectPrincess,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),princessService.sort(),this._dataProvider.refresh()},e.prototype.onSelectPrincess=function(t){var e=this.list.selectedItem;t.preventDefault(),SceneController["goto"](ConstantNames.SCENE_PRINCESS_INFO,{princess:e})},e}(StackView);__reflect(PrincessList.prototype,"PrincessList");var IRPrincess=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgBg.source=PrincessEntity.parseBgUrl(this.itemIndex);var e=this.data,i=e.meta,n=this.imgBody;this.labName.text=i.name,n.source=e.bodyUrl,n.x=220-i.body_offset.x*n.scaleX,n.y=20-i.body_offset.y*n.scaleY,this.imgBody.mask=this.bodyMask,this.labLuck.text=e.luck.toString(),this.labCharm.text=e.charm.toString(),(this.imgPosition.visible=e.position>0)&&(this.imgPosition.source="princess_position_"+e.position)},e}(eui.ItemRenderer);__reflect(IRPrincess.prototype,"IRPrincess");var PrincessPartyInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.height=250,this.blackLayer.alpha=0,this.blackLayer.visible=!1,this.visible=!0,this.list.itemRenderer=IRPrincessParty,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.blackLayer,egret.TouchEvent.TOUCH_TAP,this.onBlackLayerTap,this),this.registerEvent(this.btnShowMore,egret.TouchEvent.TOUCH_TAP,this.onBtnShowMoreTap,this),this.registerEvent(princessService,EventNames.PARTY_TURN_START,this.onInitParty,this)},e.prototype.onBlackLayerTap=function(t){this.switchState()},e.prototype.onBtnShowMoreTap=function(t){this.switchState()},e.prototype.onInitParty=function(t){this.update()},e.prototype.update=function(){this._dataProvider.source=princessService.getPartyMessages(),this.scrollToBottom()},e.prototype.scrollToBottom=function(){var t=this;alien.EgretUtils.callLater(function(){t.scroller.stopAnimation(),t.list.validateNow();var e=t.scroller.viewport;t.scroller.viewport.scrollV;e.scrollV=Math.max(e.contentHeight-e.height-20,0)})},e.prototype.switchState=function(){var t=this,e="mini"==this.currentState?"max":"mini",i="mini"==e?250:1e3,n="mini"==e?0:.5;"max"==e&&(this.blackLayer.visible=!0),egret.Tween.get(this.grp,null,null,!0).to({height:i},500,egret.Ease.cubicInOut),egret.Tween.get(this.blackLayer,null,null,!0).to({alpha:n},500).call(function(){t.currentState=e,t.blackLayer.visible="max"==e}),alien.EgretUtils.callLater(function(){var e=t.scroller.viewport;egret.Tween.get(t.scroller.viewport).to({scrollV:Math.max(e.contentHeight-i-120,0)},500,egret.Ease.cubicInOut).call(function(){t.scrollToBottom()})})},e}(alien.VisualEventComponent);__reflect(PrincessPartyInfo.prototype,"PrincessPartyInfo");var IRPrincessParty=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPartyLog,this.list.dataProvider=this._dataProvider=new ArrayCollection},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this._dataProvider.source=this.data},e}(alien.VisualEventItemRenderer);__reflect(IRPrincessParty.prototype,"IRPrincessParty");var IRPartyLog=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labContent.textFlow=this.data},e}(alien.VisualEventItemRenderer);__reflect(IRPartyLog.prototype,"IRPartyLog");var PrincessPartyItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._animation=new alien.Wave(this.btnArrow,2e3,alien.Wave.sin.bind(null,5),0,!1,!1,0,Math.random()*Math.PI*2)},e.prototype.setData=function(t){var e=princessService.partyData,i=e.players[t];this._playerId=i.id;var n=i.princessId,r=GameConfig.getPrincessMeta(n);if(i&&i.id&&r){this.visible=!0,this.currentState="normal",this.avatar.metaId=r.id,this.labName.text=r.name,this.labIntegrate.text=i.sumScore+"",this.labPlayerName.text=i.name,i.id==dataCenterService.pid?this.labPlayerName.textColor=522511:this.labPlayerName.textColor=16749106,this.labRank.text=princessService.getSeq(i.id)+1+"",this._animation.stop();var o=e.roundInfo[t].info[e.round-1<0?0:e.round-1].princessSkill>>4&15;if(0==o)this.mcvPartySkill.movieClip.stop(),this.mcvPartySkill.visible=!1;else{this.mcvPartySkill.visible=!0,this.mcvPartySkill.movieClip.gotoAndPlay(0,1);var s=this.labPlayerName;alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.party_skill[o],component:s})}}else princessService.isInPartyList()?this.visible=!1:this.visible=!0,this.currentState="none",this.avatar.metaId=null,this._animation.play(),this.mcvPartySkill.movieClip.stop(),this.mcvPartySkill.visible=!1},Object.defineProperty(e.prototype,"playerId",{get:function(){return this._playerId},enumerable:!0,configurable:!0}),e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),"none"==this.currentState&&this._animation.play()},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this._animation.stop(),this.currentState="none"},e}(alien.VisualEventComponent);__reflect(PrincessPartyItem.prototype,"PrincessPartyItem");var PrincessPartyStartEffectLayer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.count=30,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.perR=2*Math.PI/this.count,this.butterflyContainer.visible=!1;for(var e=0;e<this.count;e++)this.butterflyContainer.addChild(new Butterfly);this.stop()},e.prototype.play=function(){var t=this;this.visible=!0,this.mcvPartyStart.visible=!0,-this.mcvPartyStart.movieClip.gotoAndStop(1),egret.setTimeout(function(){t.mcvPartyStart.movieClip.play(1),t.butterflyContainer.visible=!0,alien.Utils.enumChildren(t.butterflyContainer,function(e,i){e.playAnimation(i*t.perR)})},this,300),this.mcvPartyStart.horizontalCenter=-alien.StageProxy.width,egret.Tween.get(this.mcvPartyStart,null,null,!0).to({horizontalCenter:0},1e3,egret.Ease.cubicOut).call(function(){t.mcvPartyStart.visible=!1})},e.prototype.stop=function(){this.visible=!1,alien.Utils.enumChildren(this.butterflyContainer,function(t,e){t.stopAnimation()})},e}(alien.EventComponent);__reflect(PrincessPartyStartEffectLayer.prototype,"PrincessPartyStartEffectLayer");var Butterfly=function(t){function e(){var e=t.call(this)||this;return e.setup(),e}return __extends(e,t),e.prototype.setup=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this,[4,alien.MovieClipDataFactory.instance.generateMovieClipData("butterfly")];case 1:return t.movieClipData=e.sent(),[2]}})})},e.prototype.playAnimation=function(t){this.x=0,this.y=0;var e={x:Math.cos(t)*(200*Math.random()+100),y:Math.sin(t)*(200*Math.random()+100)};this.visible=!0,this.gotoAndPlay(alien.MathUtils.makeRandomInt(12),-1),egret.Tween.get(this,null,null,!0).to(e,500*Math.random()+1500).call(this.stopAnimation,this)},e.prototype.stopAnimation=function(){this.stop(),this.visible=!1},e}(egret.MovieClip);__reflect(Butterfly.prototype,"Butterfly");var PrincessPositionGroup=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.index=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectPosition,this)},e.prototype.onSelectPosition=function(t){this._positionId=this.list.selectedItem.id,PanelPrincessManager.instance.show({groupConfig:this.list.selectedItem.group}),t.preventDefault()},e.prototype.update=function(){var t=PrincessService.positionGroup[this.index],e=princessService.getPositionGroup(this.index);this.imgTitle.source="princess_position_group_"+t.index,this.labCondition.text=wsy.Utils.shortCurrency(t.condition),this.labEffect.text=lang.princess_info_fields.charm+"+"+t.effect,this._dataProvider.source=e},e}(alien.VisualEventComponent);__reflect(PrincessPositionGroup.prototype,"PrincessPositionGroup");var PrincessPositionItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){this.currentState=8==t.group.index||7==t.group.index?"big":6==t.group.index?"middle":"small";var e=t.princess;e?(this.labName.text=e.meta.name,this.avatar.metaId=e.meta.id):(this.labName.text="",this.avatar.metaId=null),this.imgTips.visible=!e},e}(alien.EventComponent);__reflect(PrincessPositionItem.prototype,"PrincessPositionItem");var TeacherAvatar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.imgBody.mask=this.bodyMask},e.prototype.update=function(){var t=princessService.riteTeacher;this.currentState=t?"in_set":"default",this.imgBody.source=t?t.bodyUrl:ResNames.princess_rite_teacher_default,t&&(this.imgBody.y=160-t.meta.body_offset.y*this.imgBody.scaleY,this.labName.text=t.meta.name)},e}(alien.VisualEventComponent);__reflect(TeacherAvatar.prototype,"TeacherAvatar");var RankList=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._states=["power_national","minister","princess","arena"],e.skinName=rank.RankListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,ProtocolConfigs.WC_OPENTOP_RESPONSE,this.onOpenTopResponse,this)},e.prototype.active=function(i){t.prototype.active.call(this,i),i&&i.hasOwnProperty("type")&&(this._type=e.RankTypeMap[i.type],this.currentState=this._states[i.type]),rankService.openTop(this._type)},e.prototype.onOpenTopResponse=function(t){if(!(t.data.error>0)){var e=[];t.data.rankList.forEach(function(t){t&&e.push(t)}),this._dataProvider.source=e,t.data.self.length>0&&(this.labRank.text=t.data.self[0].num+1+"",this.labScore.text=t.data.self[0].score+"")}},e.RankTypeMap=[RankService.RankType.TYPE_POWER_NATIONAL,RankService.RankType.TYPE_MINISTER,RankService.RankType.TYPE_PRINCESS,RankService.RankType.TYPE_ARENA],e}(StackView);__reflect(RankList.prototype,"RankList");var RankItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=t.name,i=t.num,n=t.score,r=t.flag1,o=(t.flag2,t.unionName);this.currentState=3>=i?"num_"+i:"other",this.labNickname.text=e,this.labNum.text=i.toString(),this.labScore.text=n.toString();var s=GameConfig.getMinisterMeta(r);s||(s=GameConfig.getPrincessMeta(r)),s?this.labThirdName.text=s.name:this.labThirdName.text=o},e}(alien.EventComponent);__reflect(RankItem.prototype,"RankItem");var ShopGiftList=function(t){function e(){var e=t.call(this)||this;return e.skinName=shop.ShopGiftListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRShopGift,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(GameConfig.getShopByType(ShopService.Shop.TYPE_GIFT)),this.registerEvent(gameServer,protocols.WC_ITEM_BUY_RESPONSE,this.onItemBuyResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.refresh()},e.prototype.onItemBuyResponse=function(t){this._dataProvider.itemUpdated(this.list.selectedItem),0==t.data.error&&PanelWorkFinish.instance.show({type:2,reward:[{id:this.list.selectedItem.id,count:1}],princessEffect:null},null)},e}(StackView);__reflect(ShopGiftList.prototype,"ShopGiftList");var IRShopGift=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(this.btnBuy,egret.TouchEvent.TOUCH_TAP,this.onBtnBuyTap,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=GameConfig.getItemMeta(this.data.id);this.labName.text=e.name,this.labPrice.text=this.data.price.toString(),this.data.limit_count>0?(this.labLimit.text=lang.shop_limit+":"+(this.data.limit_count-shopService.getBuyCnt(this.data.sequence)),this.btnBuy.enabled=this.data.limit_count>shopService.getBuyCnt(this.data.sequence)):(this.labLimit.text="",this.btnBuy.enabled=!0);var i=GameConfig.getGiftPackMeta(e["export"]).items;this._dataProvider.source=i},e.prototype.onBtnBuyTap=function(t){shopService.buyItem(this.data.sequence,1)},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e}(alien.VisualEventItemRenderer);__reflect(IRShopGift.prototype,"IRShopGift");var ShopGold=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.setData=function(t){var i=t.id,n=t.price,r=t.output_id,o=t.output_count;switch(this.currentState="normal",this.imgIcon.source="shop_recharge_item_"+i,r){case 600094:this.currentState="time",this.labTime.text=lang.format(lang.shop_last_day,30),this.labGold.text=lang.shop_get_everyday+e.cardBuffer[r];break;case 600095:this.currentState="forever",this.labGold.text=lang.shop_get_everyday+e.cardBuffer[r];break;default:this.currentState=shopService.isFirstCharge(i)?"double":"normal",this.labGold.text=lang.shop_gold_get+o}this.labPrice.text=n+lang.shop_yuan},e.cardBuffer={600094:100,600095:100},e}(alien.EventComponent);__reflect(ShopGold.prototype,"ShopGold");var ShopGoldList=function(t){function e(){var e=t.call(this)||this;return e.skinName=shop.ShopGoldListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(shopService.getRechargeList()),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(shopService,EventNames.REFRESH_CHARGE,this.onRefreshCharge,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.refresh()},e.prototype.onSelectItem=function(t){t.preventDefault();var e=this.list.selectedItem;shopService.recharge(e.id)},e.prototype.onRefreshCharge=function(t){this._dataProvider.refresh()},e}(StackView);__reflect(ShopGoldList.prototype,"ShopGoldList");var ShopItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._id=0,e._colors=[16777215,6284039,6666239,13599743,16751616],e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id!=t&&(this._id=t),this.imgUnit.source="icon_gold";var e=GameConfig.getShopItemMeta(t),i=GameConfig.getItemMeta(t);switch(this.labName.text=i.name,this.labName.textColor=this._colors[i.quality],this.imgIcon.source="item_"+i.icon,this.labPrice.text=Math.floor(e.price*(e.discount_value>0?e.discount_value:10)/10)+"",e.discount_type){case 0:this.currentState="normal";break;case 1:this.currentState="discount",this.labDiscount.text=e.discount_value+"",this.labOriginally.text=lang.shop_original+":"+e.price;break;case 2:this.currentState="new";break;case 3:this.currentState="hot";break;case 4:this.currentState="recommend"}var n=e.limit_count-shopService.getBuyCnt(e.sequence);e.limit_count>0?(this.labLimit.visible=!0,this.labLimit.text=lang.shop_limit+":"+n):this.labLimit.visible=!1},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this.labLimit.visible=!1,this.imgUnit.source="icon_cash_gift",this.currentState="normal";var e=GameConfig.getExchangeMeta(t.id),i=GameConfig.getItemMeta(e.item_id);this.labName.text=i.name,this.labName.textColor=this._colors[i.quality],this.imgIcon.source="item_"+i.icon,this.labPrice.text=e.price+"",t.buyTime>0?this.filters=[GameConfig.greyFilter]:this.filters=[]},e.prototype.setUnionData=function(t){this.labLimit.visible=!1,this.currentState="union";var e=t,i=GameConfig.getItemMeta(e.item_id);this.labName.text=i.name,this.labName.textColor=this._colors[i.quality],this.imgIcon.source="item_"+i.icon,this.labPrice.text=e.price+lang.union_contribute,this.labCondition.textFlow=lang.formatHtml(lang.union_shop_condition,e.chance),this.grpCondition.visible=unionService.union.info.level<e.chance,unionService.union.info.level<e.chance?this.filters=[GameConfig.greyFilter]:this.filters=[]},e.prototype.setIncenseData=function(t){this.currentState="incense";var e=t,i=GameConfig.getItemMeta(e.item_id);if(this.labName.text=i.name,this.labName.textColor=this._colors[i.quality],this.imgIcon.source="item_"+i.icon,this.labPrice.text=e.price+lang.score,this.labLimit.visible=e.chance>0,e.chance>0){var n=e.chance-shopService.getIncenseUsedCnt(e.id);this.labLimit.text=lang.shop_limit+":"+n}},e}(alien.EventComponent);__reflect(ShopItem.prototype,"ShopItem");var ShopItemList=function(t){function e(){var e=t.call(this)||this;return e.skinName=shop.ShopItemListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRShopItem,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(GameConfig.getShopByType(ShopService.Shop.TYPE_ITEM)),this.registerEvent(this.list,egret.TouchEvent.TOUCH_TAP,this.onSelectItem,this),this.registerEvent(gameServer,protocols.WC_ITEM_BUY_RESPONSE,this.onItemBuyResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.refresh()},e.prototype.onSelectItem=function(t){return this.list.selectedItem.limit_count>0&&this.list.selectedItem.limit_count-shopService.getBuyCnt(this.list.selectedItem.sequence)<=0?void Toast.show({text:lang.response_error[69]}):void PanelShopBuyItem.instance.show({shopItem:this.list.selectedItem},this.buyResult.bind(this))},e.prototype.buyResult=function(t,e){"confirm"==t&&(this.data=e,shopService.buyItem(e.seq,e.count))},e.prototype.onItemBuyResponse=function(t){this._dataProvider.itemUpdated(this.list.selectedItem),0==t.data.error&&this.data&&PanelWorkFinish.instance.show({type:2,reward:[{id:this.list.selectedItem.id,count:this.data.count}],princessEffect:null},null)},e}(StackView);__reflect(ShopItemList.prototype,"ShopItemList");var IRShopItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.shopItem.id=this.data.id},e}(alien.VisualEventItemRenderer);__reflect(IRShopItem.prototype,"IRShopItem");var ShopVip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.listItem.itemRenderer=IRWithItemView,this.listPrivilege.itemRenderer=IRVipPrivilege,this.listItem.dataProvider=this._itemDataProvider=new ArrayCollection,this.listPrivilege.dataProvider=this._privilegeDataProvider=new ArrayCollection,this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this),this.registerEvent(this.grpArrow,egret.TouchEvent.TOUCH_TAP,this.onGrpArrowTap,this),this.registerEvent(this.listItem,egret.Event.CHANGING,this.onSelectItem,this)},Object.defineProperty(e.prototype,"vip",{get:function(){return this._vip},set:function(t){this._vip!=t&&(this._vip=t);var e=this._vip.level;shopService.getVipFlag(e)?this.currentState="display":this.currentState="normal",this.imgVip.source="shop_vip_"+e,this.labPrice.text=this._vip.charge/10+"",this.imgPrice.x=this.labPrice.x+27*this.labPrice.text.length+5;var i=shopService.getVipGiftState(e);mainService.playerInfo.vip<e?this.btnReceive.enabled=!1:this.btnReceive.enabled=!0,this.labReceive.visible=i>0,this.btnReceive.visible=0>=i;
var n=GameConfig.getItemMeta(this._vip.giftId),r=GameConfig.getGiftPackMeta(n["export"]);r&&(this._itemDataProvider.source=r.items);var o=[];for(var s in this._vip){var a=void 0;if("level"!=s&&"charge"!=s&&"giftId"!=s&&0!=this._vip[s]){if("fight"==s){var c=s+"_"+this._vip[s];a=lang.formatHtml(lang.vip_desc[c])}else a=lang.formatHtml(lang.vip_desc[s],this._vip[s]);o.push(a)}}this._privilegeDataProvider.source=o},enumerable:!0,configurable:!0}),e.prototype.onBtnReceiveTap=function(t){shopService.getVipGift(this._vip.giftId)},e.prototype.onGrpArrowTap=function(t){this.currentState="normal"==this.currentState||""==this.currentState?"display":"normal",shopService.updateVipFlag("normal"==this.currentState||""==this.currentState?0:1,this._vip)},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.listItem.selectedItem.id})},e}(alien.VisualEventComponent);__reflect(ShopVip.prototype,"ShopVip");var IRVipPrivilege=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labDesc.textFlow=this.data},e}(alien.VisualEventItemRenderer);__reflect(IRVipPrivilege.prototype,"IRVipPrivilege");var ShopVipList=function(t){function e(){var e=t.call(this)||this;return e.skinName=shop.ShopVipListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRShopVip,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(alien.Utils.objectValues(GameConfig.vip)),this.registerEvent(gameServer,protocols.WC_VIP_GIFT_RESPONSE,this.onVipGiftResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),shopService.clearVipFlag(),this._dataProvider.refresh()},e.prototype.onVipGiftResponse=function(t){this._dataProvider.itemUpdated(this.list.selectedItem);var e=GameConfig.getItemMeta(this.list.selectedItem.giftId),i=GameConfig.getGiftPackMeta(e["export"]),n=packService.getItemByMetaId(e.id);n&&packService.useItem(n.id,1),0==t.data.error&&PanelWorkFinish.instance.show({type:2,reward:i.items,princessEffect:null},null)},e}(StackView);__reflect(ShopVipList.prototype,"ShopVipList");var IRShopVip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.shopVip.vip=this.data},e}(alien.VisualEventItemRenderer);__reflect(IRShopVip.prototype,"IRShopVip");var TaskItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._id=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(this.btn,egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this),this.registerEvent(gameServer,protocols.WC_FINISHTIME_RESPONSE,this.onFinishTimeResponse,this)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id!=t&&(this._id=t);var e=taskService.getById(this._id);this.labName.text=lang.task_type[e.meta.type]+e.meta.name;var i=16012320;this.grp.filters=null,this.imgFinish.visible=!1,this.btn.visible=!0,this.labState.visible=!0,this.touchChildren=!0;var n=e.meta.finish_value,r=e.value>e.meta.finish_value?e.meta.finish_value:e.value;switch(e.meta.finish_type){case 28:case 36:case 37:case 46:n=1,r=e.value>=e.meta.finish_value?1:0;break;case 68:n=1,r=e.value<=e.meta.finish_value&&e.value>0?1:0}r>=n?(this.labState.text=lang.task_state[1],i=9615406,this.btn.skinName=ui.GreenButtonSkin,this.btn.label=lang.task_button_label[1],e.flag&&(this.grp.filters=[GameConfig.greyFilter],this.imgFinish.visible=!0,this.btn.visible=!1,this.labState.visible=!1,this.touchChildren=!1)):(this.labState.text=lang.task_state[0],i=16012320,this.btn.skinName=ui.BlueButtonSkin,this.btn.label=lang.task_button_label[0]),this.labState.textColor=i,this.labDesc.textFlow=[{text:e.meta.desc+"(",style:{textColor:10046235}},{text:wsy.Utils.shortCurrency(r),style:{textColor:i}},{text:"/"+wsy.Utils.shortCurrency(n)+")",style:{textColor:10046235}}],this._dataProvider.source=e.meta.reward},enumerable:!0,configurable:!0}),e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e.prototype.onBtnTap=function(t){var e=taskService.getById(this._id);taskService.getTaskFinishStatus(e)?taskService.finishTime(this._id):GameConfig.goGoal(e.meta.finish_type)&&PanelTask.instance.close()},e.prototype.onFinishTimeResponse=function(t){if(0==t.data.error){var e=taskService.getById(taskService.finishId);PanelWorkFinish.instance.show({type:0,reward:e.meta.reward,princessEffect:null})}},e}(alien.VisualEventComponent);__reflect(TaskItem.prototype,"TaskItem");var TaskItemList=function(t){function e(){var e=t.call(this)||this;return e._type=1,e.skinName=task.TaskItemListSkin,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRTaskItem,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(taskService,EventNames.UPDATE_TASK,this.onUpdateTask,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&e.type&&(this._type=e.type),this._dataProvider.source=taskService.getTasksByType(this._type)},e.prototype.onUpdateTask=function(t){t.data.task.meta.type==this._type&&(this._dataProvider.source=taskService.getTasksByType(this._type))},e}(StackView);__reflect(TaskItemList.prototype,"TaskItemList");var IRTaskItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.taskItem.id=this.data.id},e}(alien.VisualEventItemRenderer);__reflect(IRTaskItem.prototype,"IRTaskItem");var AffairTecList=function(t){function e(){var e=t.call(this)||this;return e.skinName=technology.TechnologyListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRTechnology,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this._dataProvider.source=GameConfig.getTechsByType(3),this.registerEvent(technologyService,EventNames.UPDATE_TECHNOLOGY,this.update,this),this.registerEvent(technologyService,EventNames.REFRESH_TECHNOLOGY,this.update,this)},e.prototype.update=function(t){var e=t.data;null==e?this._dataProvider.refresh():e&&e.technology&&3==GameConfig.getTechMeta(e.technology.id).type?this._dataProvider.itemUpdated(GameConfig.getTechMeta(e.technology.id)):null==e.technology&&this._dataProvider.itemUpdated(this.list.selectedItem)},e}(StackView);__reflect(AffairTecList.prototype,"AffairTecList");var CultureTecList=function(t){function e(){var e=t.call(this)||this;return e.skinName=technology.TechnologyListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRTechnology,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this._dataProvider.source=GameConfig.getTechsByType(2),this.registerEvent(technologyService,EventNames.UPDATE_TECHNOLOGY,this.update,this),this.registerEvent(technologyService,EventNames.REFRESH_TECHNOLOGY,this.update,this)},e.prototype.update=function(t){var e=t.data;null==e?this._dataProvider.refresh():e&&e.technology&&2==GameConfig.getTechMeta(e.technology.id).type?this._dataProvider.itemUpdated(GameConfig.getTechMeta(e.technology.id)):null==e.technology&&this._dataProvider.itemUpdated(this.list.selectedItem)},e}(StackView);__reflect(CultureTecList.prototype,"CultureTecList");var InternalTecList=function(t){function e(){var e=t.call(this)||this;return e.skinName=technology.TechnologyListSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRTechnology,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this._dataProvider.source=GameConfig.getTechsByType(1),this.registerEvent(technologyService,EventNames.UPDATE_TECHNOLOGY,this.update,this),this.registerEvent(technologyService,EventNames.REFRESH_TECHNOLOGY,this.update,this)},e.prototype.update=function(t){var e=t.data;null==e?this._dataProvider.refresh():e&&e.technology&&1==GameConfig.getTechMeta(e.technology.id).type?this._dataProvider.itemUpdated(GameConfig.getTechMeta(e.technology.id)):null==e.technology&&this._dataProvider.itemUpdated(this.list.selectedItem)},e}(StackView);__reflect(InternalTecList.prototype,"InternalTecList");var IRTechnology=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.technologyItem,egret.TouchEvent.TOUCH_TAP,this.onTechnologyClick,this),this.registerEvent(this,egret.Event.REMOVED_FROM_STAGE,this.onRemovedToStage,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.technologyItem.technologyInfo=this.data,this.itemIndex/3<4?this.imgConnect.visible=!0:this.imgConnect.visible=!1},e.prototype.onRemovedToStage=function(t){this.technologyItem.onRemovedToStage(t)},e.prototype.onTechnologyClick=function(t){var e=t.currentTarget,i=this.data.levels[this.data.levels.length-1].level;if("normal"==e.currentState){var n=technologyService.getById(this.data.id);n&&n.level>=i?PanelTechInfo.instance.show(this.data):PanelDispatchForTechnology.instance.show(this.data,this.onSelectMinisterResult.bind(this))}else"levelUp"==e.currentState?PanelTechSpeed.instance.show(this.data,this.onSpeedResult.bind(this)):"lock"==e.currentState&&PanelTechInfo.instance.show(this.data)},e.prototype.onSelectMinisterResult=function(t,e){"select"==t&&e&&technologyService.technologyLeveUp(this.data.id,e.minister.id)},e.prototype.onSpeedResult=function(t,e){if("confirm"==t){var i=e.techData,n=e.speedData,r=technologyService.getTimestamp(i.id);if(0==n.type)activityTimeService.advanceTime(r.id);else{var o=n.item;if(!o)return;activityTimeService.itemUseAcCard(o.id,o.count,r.id)}}},e}(alien.VisualEventItemRenderer);__reflect(IRTechnology.prototype,"IRTechnology");var TechnologyIcon=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cdId=0,e.onSecond=function(t){return 0>=t?(e.cdId=0,void(e.technologyInfo=e._techData)):void(t>86400?e.labTime.text=alien.TimeUtils.timeFormat(t,"{3}:{2}:{1}:{0}"):e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},Object.defineProperty(e.prototype,"technologyiInfo",{get:function(){return this._techData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"technologyInfo",{set:function(t){if(countDownService.unregister(this.cdId),this._techData=t,this.imgName.source="technology_name_"+t.id,this.imgIcon.source="technology_icon_"+t.id,technologyService.getById(t.id)){this.currentState="normal";var e=technologyService.getById(t.id);e?(this.labLevel.text=e.level.toString(),this.labLevel.textColor=e.level>=e.meta.levels[e.meta.levels.length-1].level?16763702:16777215):(this.labLevel.text="0",this.labLevel.textColor=16777215)}else this.currentState="lock";var i=technologyService.getTimestamp(t.id);i&&i.timestamp-mainService.tsServer>0&&(this.currentState="levelUp",this.cdId=countDownService.register(i.timestamp,this.onSecond.bind(this)))},enumerable:!0,configurable:!0}),e.prototype.setDetailIcon=function(t){if(this.currentState="info",this._techData=t,this.imgName.source="technology_name_"+t.id,this.imgIcon.source="technology_icon_"+t.id,!GameConfig.getTechNextId(t.id)){this.currentState="normal";var e=technologyService.getById(t.id);e?this.labLevel.text=e.level.toString():this.labLevel.text="0"}},e}(alien.EventComponent);__reflect(TechnologyIcon.prototype,"TechnologyIcon");var UnionFunction=function(t){function e(){var e=t.call(this)||this;return e.skinName=union.UnionFunctionSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionFunctionButton,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this)},e.prototype.onSelectItem=function(t){switch(t.preventDefault(),this.list.selectedItem.name){case"info":PanelUnionInfo.instance.show();break;case"contribute":PanelUnionContribute.instance.show();break;case"tech":PanelUnionTech.instance.show();break;case"shop":PanelUnionShop.instance.show();break;case"treasure":PanelUnionWelfare.instance.show();break;case"rank":PanelUnionRank.instance.show();break;case"duplicate":bossService.getBossInfo(BossEntity.BOSS_TYPE.UNION)}},e.prototype.active=function(e){t.prototype.active.call(this,e)},e.prototype.onUpdateBossInfo=function(t){unionService.getMyUnionInfo().position<UnionEntity.POSITION.VICE?bossService.boss.openStatus&&bossService.boss.id>0&&bossService.boss.id!=BossEntity.WORLD_BOSS_ID?SceneController["goto"](ConstantNames.SCENE_DUPLICATE,{type:BossEntity.BOSS_TYPE.UNION}):Toast.show({text:lang.duplicate_close}):bossService.boss.openStatus&&bossService.boss.id!=BossEntity.WORLD_BOSS_ID?SceneController["goto"](ConstantNames.SCENE_DUPLICATE,{type:BossEntity.BOSS_TYPE.UNION}):PanelDuplicate.instance.show()},e}(StackView);__reflect(UnionFunction.prototype,"UnionFunction");var IRUnionFunctionButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="union_icon_"+this.data.name,this.labelDisplay.text=this.data.label,this.badgeView.bid=this.data.badgeId},e}(eui.ItemRenderer);__reflect(IRUnionFunctionButton.prototype,"IRUnionFunctionButton");var UnionInfoApply=function(t){function e(){var e=t.call(this)||this;return e.skinName=union.UnionInfoApplySkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionInfoApply,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(unionService,EventNames.UPDATE_UNION_APPLY_PLAYER,this.onUpdateUnionApplyPlayer,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.source=unionService.union.applyPlayers},e.prototype.onUpdateUnionApplyPlayer=function(t){this._dataProvider.source=unionService.union.applyPlayers},e}(StackView);__reflect(UnionInfoApply.prototype,"UnionInfoApply");var IRUnionInfoApply=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnAgree,egret.TouchEvent.TOUCH_TAP,this.onBtnAgreeTap,this),this.registerEvent(this.btnRefuse,egret.TouchEvent.TOUCH_TAP,this.onBtnRefuseTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.player.setPlayer(e.icon),this.labName.text=e.name,this.labNationalPower.text=e.fightValue,this.labApplyTime.textFlow=unionService.getIntervalTime(e.applyTime),this.labState.text=lang.union_online_state[e.onlineState],this.vipItem.vip=e.vip},e.prototype.onBtnAgreeTap=function(t){unionService.joinUnion(unionService.union.info.id,this.data.id,!0)},e.prototype.onBtnRefuseTap=function(t){unionService.joinUnion(unionService.union.info.id,this.data.id,!1)},e}(alien.VisualEventItemRenderer);__reflect(IRUnionInfoApply.prototype,"IRUnionInfoApply");var UnionInfoMember=function(t){function e(){var e=t.call(this)||this;return e.skinName=union.UnionInfoMemberSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(unionService,EventNames.UPDATE_UNION_MEMBER,this.onUpdateUnionMember,this),this.registerEvent(gameServer,protocols.WC_FireMemberOrg_Response,this.onFireMemberOrgResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this._dataProvider.source=this.getMembers()},e.prototype.getMembers=function(){return unionService.union.members.sort(function(t,e){var i=unionService.getPlayerIsOnline(t.status)?0:mainService.tsServer-t.offlineTime,n=unionService.getPlayerIsOnline(e.status)?0:mainService.tsServer-e.offlineTime;return i-n?i-n:unionService.getSevenContributionValue(e.name)-unionService.getSevenContributionValue(t.name)})},e.prototype.onUpdateUnionMember=function(t){var e=t.data,i=e.optType,n=e.member;0==i?this._dataProvider.itemUpdated(n):this._dataProvider.source=this.getMembers()},e.prototype.onFireMemberOrgResponse=function(t){0==t.data.error&&Toast.show({text:lang.union_kick_success})},e}(StackView);__reflect(UnionInfoMember.prototype,"UnionInfoMember");var UnionInfoMsg=function(t){function e(){var e=t.call(this)||this;return e.skinName=union.UnionInfoMsgSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionInfoMsg,this.list.dataProvider=this._dataProvider,this.registerEvent(this.btnExit,egret.TouchEvent.TOUCH_TAP,this.onBtnExitTap,this),this.registerEvent(this.btnDismiss,egret.TouchEvent.TOUCH_TAP,this.onBtnDismissTap,this),this.registerEvent(this.btnTransfer,egret.TouchEvent.TOUCH_TAP,this.onBtnTransferTap,this),this.registerEvent(unionService,EventNames.UPDATE_UNION_INFO,this.onUpdateUnionInfo,this),this.registerEvent(gameServer,ProtocolConfigs.WC_TransferOrgMaster_Response,this.onTransferOrgMasterResponse,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.update()},e.prototype.inactive=function(){t.prototype.inactive.call(this);var e=unionService.union.info;if(this.toggle.selected!=e.autoAcceptJoin||this.tiNotice.text.length>0&&this.tiNotice.text!=e.msg||this.tiDeclaration.text.length>0&&this.tiDeclaration.text!=e.memo){var i=this.tiDeclaration.text.length>0?this.tiDeclaration.text:e.memo,n=this.tiNotice.text.length>0?this.tiNotice.text:e.msg,r=this.toggle.selected?1:0;unionService.changeUnion(e.id,e.qqGroup,i,n,r)}},e.prototype.update=function(){var t=unionService.union.info;this.tiNotice.prompt=t.msg,this.tiDeclaration.prompt=t.memo;var e=unionService.getMyUnionInfo();this.currentState=e.position==UnionEntity.POSITION.LEADER?"leader":e.position==UnionEntity.POSITION.VICE?"vice":"normal",this.toggle.selected=t.autoAcceptJoin,this._dataProvider.refresh()},e.prototype.onBtnExitTap=function(t){Alert.show(lang.union_leave_alert_content,1,function(t){"confirm"==t.name&&unionService.leaveUnion(unionService.union.info.id)})},e.prototype.onBtnDismissTap=function(t){Alert.show(lang.union_dismiss_alert_content,1,function(t){"confirm"==t.name&&unionService.disbandOrg(unionService.union.info.id)})},e.prototype.onBtnTransferTap=function(t){PanelTransfer.instance.show()},e.prototype.onUpdateUnionInfo=function(t){this.update()},e.prototype.onRemovedFromStage=function(t){var e=unionService.union.info;if(!this.toggle.selected!=e.autoAcceptJoin||this.tiNotice.text.length>0&&this.tiNotice.text!=e.msg||this.tiDeclaration.text.length>0&&this.tiDeclaration.text!=e.memo){var i=this.tiDeclaration.text.length>0?this.tiDeclaration.text:e.memo,n=this.tiNotice.text.length>0?this.tiNotice.text:e.msg,r=this.toggle.selected?0:1;unionService.changeUnion(e.id,e.qqGroup,i,n,r)}},e.prototype.onTransferOrgMasterResponse=function(t){this.update()},e}(StackView);__reflect(UnionInfoMsg.prototype,"UnionInfoMsg");var IRUnionInfoMsg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnChange,egret.TouchEvent.TOUCH_TAP,this.onBtnChangeTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labContent.text=unionService.getUnionValueByField(this.data.field),this.currentState=unionService.getMyUnionInfo().position>=UnionEntity.POSITION.VICE?this.data.state:"normal"},e.prototype.onBtnChangeTap=function(t){PanelUnionRename.instance.show(this.data.field)},e}(alien.VisualEventItemRenderer);__reflect(IRUnionInfoMsg.prototype,"IRUnionInfoMsg");var UnionItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnJoin,egret.TouchEvent.TOUCH_TAP,this.onBtnJoinTap,this)},e.prototype.setData=function(t){this.data=t,this.labName.text=t.name,this.labLevel.text=t.level,this.labCount.text=t.playerNum+"/"+t.maxPlayerNum,this.labNotice.textFlow=lang.formatHtml(lang.union_notice,t.memo),t.playerNum>=t.maxPlayerNum?this.currentState="full":t.autoAcceptJoin?this.currentState="noVerify":this.currentState="needVerify"},e.prototype.onBtnJoinTap=function(t){unionService.applyUnion(this.data.id)},e}(alien.VisualEventItemRenderer);__reflect(UnionItem.prototype,"UnionItem");var UnionLog=function(t){function e(){var e=t.call(this)||this;return e.skinName=union.UnionLogSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRLogItem,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(unionService,EventNames.UPDATE_UNION_LOG,this.onUpdateUnionLog,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),this.update()},e.prototype.update=function(){mainService.playerInfo.union_id&&(this._dataProvider.source=unionService.union.logs.sort(function(t,e){return e.time-t.time}))},e.prototype.onUpdateUnionLog=function(t){this.update()},e}(StackView);__reflect(UnionLog.prototype,"UnionLog");var UnionMemberItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnKick,egret.TouchEvent.TOUCH_TAP,this.onBtnKickTap,this),this.registerEvent(this.btnManager,egret.TouchEvent.TOUCH_TAP,this.onBtnManagerTap,this),this.registerEvent(this.btnTransfer,egret.TouchEvent.TOUCH_TAP,this.onBtnTransferTap,this)},e.prototype.setData=function(t){this.data=t;var e=this.data;this.setMemberInfo(e);var i=unionService.getMyUnionInfo();switch(e.position){case UnionEntity.POSITION.LEADER:this.currentState="normal";break;case UnionEntity.POSITION.VICE:i.position==UnionEntity.POSITION.LEADER?this.currentState="manager":this.currentState="normal";break;case UnionEntity.POSITION.ELITE:case UnionEntity.POSITION.COMMON:i.position==UnionEntity.POSITION.LEADER?this.currentState="manager":i.position==UnionEntity.POSITION.VICE?this.currentState="tick":this.currentState="normal"}},e.prototype.setMemberInfo=function(t){this.labName.text=t.name,this.labName.textColor=t.id==dataCenterService.pid?3916032:16742400,this.labPosition.text=lang.union_position[t.position],this.labContribute.text=unionService.getSevenContributionValue(t.name)+"",this.player.setPlayer(t.icon),this.vipItem.vip=t.vip,unionService.getPlayerIsOnline(t.status)?this.labTime.textFlow=lang.formatHtml(lang.union_time[0]):this.labTime.textFlow=unionService.getIntervalTime(t.offlineTime)},e.prototype.setTransferData=function(t){this.currentState="transfer",this.data=t;var e=this.data;this.setMemberInfo(e)},e.prototype.onBtnKickTap=function(t){var e=this;Alert.show(lang.formatHtml(lang.union_kick_alert_content,this.data.name),1,function(t){"confirm"==t.name&&unionService.frieMember(unionService.union.info.id,e.data.id)})},e.prototype.onBtnManagerTap=function(t){PanelUnionPosManager.instance.show(this.data)},e.prototype.onBtnTransferTap=function(t){var e=this;Alert.show(lang.formatHtml(lang.union_transfer_alert_content,this.data.name),1,function(t){"confirm"==t.name&&unionService.transferLeader(unionService.union.info.id,e.data.id)})},e}(alien.VisualEventItemRenderer);__reflect(UnionMemberItem.prototype,"UnionMemberItem");var UnionNotice=function(t){function e(){var e=t.call(this)||this;return e.skinName=union.UnionNoticeSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.active=function(e){t.prototype.active.call(this,e),mainService.playerInfo.union_id&&(this.currentState=" "!=unionService.union.info.msg?"normal":"none","normal"==this.currentState&&(this.labContent.text=unionService.union.info.msg))},e}(StackView);__reflect(UnionNotice.prototype,"UnionNotice");var UnionRankItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnJoin,egret.TouchEvent.TOUCH_TAP,this.onBtnJoinTap,this)},e.prototype.setData=function(t){this.data=t,this.topItem.setData(t),this.labName.text=t.leaderName,this.labFightValue.text=wsy.Utils.shortCurrency(t.fightValue),mainService.playerInfo.union_id?this.currentState="noBtn":t.playerNum>=t.maxPlayerNum?this.currentState="full":t.autoAcceptJoin?this.currentState="noVerify":this.currentState="needVerify"},e.prototype.onBtnJoinTap=function(t){unionService.applyUnion(this.data.id)},e}(alien.VisualEventItemRenderer);__reflect(UnionRankItem.prototype,"UnionRankItem");var UnionRankTop=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=t.name,i=t.level,n=t.rank,r=t.maxPlayerNum,o=t.playerNum;this.currentState=3>=n?"num_"+n:"other",this.labName.text=e,this.labLevel.text=i.toString(),this.labCount.text=o+"/"+r,this.labNum.text=n},e}(alien.EventComponent);__reflect(UnionRankTop.prototype,"UnionRankTop");var VisitCarriage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.mask=this.rect,this.list.itemRenderer=IRCarriage},e.prototype.showCarriage=function(t){var e=this;this.visible=!0,this.rect.width=0,this.rect.x=this.width,egret.Tween.get(this.rect).to({width:this.width},500,egret.Ease.backOut).call(function(){e.grp.mask=null})},e.prototype.hideCarriage=function(){var t=this;this.grp.mask=this.rect,egret.Tween.get(this.rect).to({width:0},500,egret.Ease.backIn).call(function(){t.visible=!1})},e}(alien.VisualEventComponent);__reflect(VisitCarriage.prototype,"VisitCarriage");var IRCarriage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btn,egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this)},e.prototype.dataChanged=function(){this.btn.icon="visit_dice_result_"+this.data.icon},e.prototype.onBtnTap=function(t){alien.Dispatcher.dispatch(EventNames.SELECT_DICE,{value:parseInt(this.data.icon)})},e}(alien.VisualEventItemRenderer);__reflect(IRCarriage.prototype,"IRCarriage");var VisitCity=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},Object.defineProperty(e.prototype,"city",{get:function(){return this._city},set:function(t){this._city=t,8001!=this._city.id?this.imgLevel.source=this._city.getCityIcon():this.imgLevel.source=this._city.getCityIcon(),this.labLevel.visible=!0,this.labLevel.text=this.city.level+"",this.labName.text=this.city.cityMeta.name},enumerable:!0,configurable:!0}),e.prototype.hideLevel=function(){this.grpName.visible=!1},e.prototype.onAddedToStage=function(t){this.buildEffect||(this.buildEffect=new alien.MovieClipView,this.addChild(this.buildEffect),this.buildEffect.x=this.width/2-20,this.buildEffect.y=this.height/2,this.buildEffect.autoPlay=!1,this.buildEffect.aniName="build",this.buildEffect.movieClip.once(egret.Event.COMPLETE,this.onComplete,this)),this.buildEffect.movieClip.stop(),this.buildEffect.visible=!1},e.prototype.playBuilding=function(){this.buildEffect.visible=!0,this.buildEffect.movieClip.stop(),this.buildEffect.movieClip.gotoAndPlay(0,1)},e.prototype.stopBuilding=function(){},e.prototype.onComplete=function(t){this.buildEffect.movieClip.stop(),this.buildEffect.visible=!1},e}(alien.VisualEventComponent);__reflect(VisitCity.prototype,"VisitCity");var VisitCityInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName=visit.VisitCityInfoSkin,e}return __extends(e,t),e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this._cityId=e.cityId,this.update())},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRCityOutput,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(visitService,EventNames.UPDATE_CITY,this.onUpdateCity,this)},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.princessAvatar.metaId=null},e.prototype.update=function(){var t,e=visitService.getById(this._cityId),i=[];e.cityMeta.rewards.forEach(function(e){var n=GameConfig.getItemMeta(e.id);n?i.push(e):t=e}),this._dataProvider.source=i,t?(this.grpPrincess.visible=!0,this.list.top=this.grpPrincess.top+this.grpPrincess.height+6,this.setPrincessInfo(t)):(this.grpPrincess.visible=!1,this.list.top=this.grpPrincess.top)},e.prototype.setPrincessInfo=function(t){var e=visitService.getById(this._cityId),i=GameConfig.getPrincessMeta(t.id),n=GameConfig.getPrincessMeta(t.id),r=princessService.getByMetaId(t.id);r?(this.grpLike.visible=!1,this.grpLuck.visible=!0,this.labLuck.text=r.luck+""):(this.grpLike.visible=!0,this.grpLuck.visible=!1),this.princessAvatar.metaId=t.id,this.labType.text=lang.princess,this.labPrincessName.textColor=14905139,this.labCondition.text="Lv."+t.level,this.labPrincessName.text=i.name,this.labNeedValue.text=n.hire_value,this.labNowValue.text=e.likeValue+""},e.prototype.onUpdateCity=function(t){this.update()},e}(StackView);__reflect(VisitCityInfo.prototype,"VisitCityInfo");var IRCityOutput=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.registerEvent(this.itemView,egret.TouchEvent.TOUCH_TAP,this.onItemTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=GameConfig.getItemMeta(this.data.id);e&&(this.itemView.visible=!0,this.itemView.metaId=this.data.id,this.labType.text=lang.item_type[e.type],this.labName.textColor=GameConfig.QUALITY_COLORS[e.quality]),this.labCondition.text="Lv."+this.data.level,this.labName.text=e.name},e.prototype.onItemTap=function(t){var e=GameConfig.getItemMeta(this.data.id);e&&PanelItemDetails.instance.show({id:this.data.id})},e}(alien.VisualEventItemRenderer);__reflect(IRCityOutput.prototype,"IRCityOutput");var VisitDevelop=function(t){function e(){var e=t.call(this)||this;return e._metaIdList=[2,3],e._itemList=[],e.skinName=visit.VisitDevelopSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRCityItemUse,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.TouchEvent.TOUCH_TAP,this.onSelectItem,this),this.registerEvent(visitService,EventNames.UPDATE_CITY,this.onUpdateCity,this)},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this.cityId=e.cityId,this.setItemList(),this.update())},e.prototype.setItemList=function(){var t=this;this._itemList.splice(0,this._itemList.length),this._metaIdList.forEach(function(e){var i=new ItemEntity,n="";
packService.getItemByMetaId(e)&&(n=packService.getItemByMetaId(e).id),i.inject({metaId:e,count:packService.getCountByMetaId(e),id:n});var r=0,o=visitService.getById(t.cityId);r=2==i.metaId?o.visitMeta.levels[o.level>=9?8:o.level].develop_silver:o.visitMeta.levels[o.level>=9?8:o.level].develop_mineral;var s={item:i,cost:1e4*r,cityId:t.cityId};t._itemList.push(s)})},e.prototype.update=function(){var t=visitService.getById(this.cityId);this._dataProvider.source=this._itemList,this.labName.text=t.cityMeta.name+"Lv."+t.level,this.city.city=t,this.city.hideLevel()},e.prototype.onSelectItem=function(t){"btnUse"==t.target.name&&(2==this.list.selectedItem.item.meta.id?visitService.developCity(0):3==this.list.selectedItem.item.meta.id&&visitService.developCity(1))},e.prototype.onUpdateCity=function(t){var e=this;this.update();var i=t.data.city;i.id==this.cityId&&i.fieldsModified.forEach(function(t){var i=t.field,n=t.value,r=t.oldValue;i==CityEntity.cityFields[0]&&n>r&&e.city.playBuilding()})},e}(StackView);__reflect(VisitDevelop.prototype,"VisitDevelop");var IRCityItemUse=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.item,i=this.data.cost,n=this.data.item.meta;this.itemView.metaId=e.metaId,this.itemView.hideCount=!0,this.labName.text=n.name,this.labName.textColor=GameConfig.QUALITY_COLORS[n.quality],e.count<i||!visitService.getCityCanLevelUp(this.data.cityId)?this.btnUse.enabled=!1:this.btnUse.enabled=!0,this.labCost.text=wsy.Utils.shortCurrency(i),this.labCount.text=wsy.Utils.shortCurrency(e.count)},e}(alien.VisualEventItemRenderer);__reflect(IRCityItemUse.prototype,"IRCityItemUse");var VisitItemGetTip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"icon",{set:function(t){var e=GameConfig.getItemMeta(t.itemId);if(e)this.labContent.text=e.name;else{var i=princessService.getByMetaId(t.princessId);this.labContent.text=lang.format(lang.visit_princess_like_contents[i?t.itemCount>0?3:2:t.itemCount>0?1:0],GameConfig.getPrincessMeta(t.princessId).name)}this.labValue.text="+"+t.itemCount,this.imgIcon.source=e?"item_"+e.icon:"common_luck"},enumerable:!0,configurable:!0}),e}(alien.VisualEventComponent);__reflect(VisitItemGetTip.prototype,"VisitItemGetTip");var VisitKingFlag=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e)},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e)},e.prototype.addEffect=function(){this.kingEffect?this.playEffect():(this.kingEffect=new alien.MovieClipView,this.kingEffect.aniName="flag",this.addChild(this.kingEffect),this.kingEffect.x=this.width/2,this.kingEffect.y=this.height/2,this.kingEffect.autoPlay=!1)},e.prototype.playEffect=function(){this.kingEffect.visible=!0,this.kingEffect.movieClip.stop(),this.kingEffect.movieClip.gotoAndPlay(0,-1)},e.prototype.stopEffect=function(){this.kingEffect.movieClip.stop(),this.kingEffect.visible=!1},e.prototype.move=function(t){return this._moveConfig={goal:{x:t.goalX,y:t.goalY},location:{x:this.x,y:this.y},centerLocation:{x:this.x+(t.goalX-this.x)/4*3,y:this.y+(t.goalY-this.y)/4}},console.log("move",t,this._moveConfig),egret.Tween.get(this).to({factor:1},500)},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(t){this.x=(1-t)*(1-t)*this._moveConfig.location.x+2*t*(1-t)*this._moveConfig.centerLocation.x+t*t*this._moveConfig.goal.x,this.y=(1-t)*(1-t)*this._moveConfig.location.y+2*t*(1-t)*this._moveConfig.centerLocation.y+t*t*this._moveConfig.goal.y,console.log("factor",this._moveConfig,this.x,this.y,t)},enumerable:!0,configurable:!0}),e}(alien.VisualEventComponent);__reflect(VisitKingFlag.prototype,"VisitKingFlag");var VisitMap=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._id=0,e._nowId=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.touchEnabled=this.touchChildren=!0,this._animations=[]},e.prototype.init=function(){var t=this;this._id=visitService.getKingCity(),this.setKingPosition(this._id),visitService.cities.forEach(function(e){var i=t.container.getChildByName("city_"+e.id);i.city=e})},e.prototype.onUpdateCity=function(t){var e=this.getCity(t.id);e.city=t},e.prototype.playBuildEffect=function(t){var e=this.getCity(t.id);e.playBuilding()},e.prototype.getCity=function(t){return this.container.getChildByName("city_"+t)},Object.defineProperty(e.prototype,"cityId",{get:function(){return this._nowId},set:function(t){this._id!=t&&(this._id=t,0==this._nowId?this.setKingPosition(this._id):(this._nowId++,this._nowId>8020&&(this._nowId=this._nowId-20),this.moveKing(this._nowId)))},enumerable:!0,configurable:!0}),e.prototype.setKingPosition=function(t){var e=this.getCity(t),i=e.x,n=e.y,r=i-this.width/2,o=n-this.height/2;this.kingFlag.x=i,this.kingFlag.y=n,this.container.scrollH=Math.max(Math.min(r,this.imgBg.width-this.width),0),this.container.scrollV=Math.max(Math.min(o,this.imgBg.height-this.height),0),this._nowId=t},e.prototype.moveKing=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r=this;return __generator(this,function(o){return e=this.getCity(t),i=e.x,n=e.y,egret.Tween.get(this.kingFlag).to({x:i,y:n},500,egret.Ease.sineOut).call(function(){var e=i-r.width/2,o=n-r.height/2;egret.Tween.get(r.container).to({scrollH:Math.max(Math.min(e,r.imgBg.width-r.width),0),scrollV:Math.max(Math.min(o,r.imgBg.height-r.height),0)},500,egret.Ease.cubicOut).call(function(){if(t!=r._id)r._nowId++,r._nowId>8020&&(r._nowId=r._nowId-20),r.moveKing(r._nowId);else{if(0==r._nowId)return void(r._nowId=r._id);r._nowId=r._id,alien.Dispatcher.dispatch(EventNames.UPDATE_VISIT,{cityId:r._id})}},r)},this),[2]})})},e.prototype.isGoal=function(){return this._id==this._nowId},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this._animations.forEach(function(t){t.play()})},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),egret.Tween.removeTweens(this.container),egret.Tween.removeTweens(this.kingFlag),this.setKingPosition(this._id),this._animations.forEach(function(t){t.stop()})},e}(alien.VisualEventComponent);__reflect(VisitMap.prototype,"VisitMap");var VisitPeople=function(t){function e(){var e=t.call(this)||this;return e._step=0,e._princess=null,e.skinName=visit.VisitPeopleSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.king.mask=this.rect1,this.imgBody.mask=this.rect,this.list.itemRenderer=IRVisitChoose,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.grpContent,egret.TouchEvent.TOUCH_TAP,this.onGrpContent,this),this.registerEvent(this.btnAgain,egret.TouchEvent.TOUCH_TAP,this.onBtnAgainTap,this),this.registerEvent(gameServer,protocols.WC_INSPECT_RESPONSE,this.onInspectResponse,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(gameServer,protocols.WC_INSPECT_AORB_RESPONSE,this.onInspectChooseResponse,this),this.registerEvent(princessService,EventNames.UPDATE_PRINCESS,this.onUpdatePrincess,this),this.animation=new alien.Wave(this.btnNext,2e3,alien.Wave.zoom.bind(null,.05),0,!1,!1,0,Math.random()*Math.PI*2)},e.prototype.active=function(e){t.prototype.active.call(this,e);var i=activityTimeService.getById(visitService.eventActTimeId);this._step=dataCenterService.visitPeopleStep,i||(visitService.inspect(),this._step=0),e&&(this._cityId=e.cityId,this.update()),this.animation.play(),this._princess=null},e.prototype.inactive=function(){dataCenterService.visitPeopleStep=this._step,this.animation.stop(),t.prototype.inactive.call(this)},e.prototype.update=function(){this.princessLikeValue.visible=!1,this.princessLikeValue.princess=this._cityId,this.setSelfBody(),this.setContent()},e.prototype.setPeopleBody=function(t){var e="";switch(t){case 0:case 1:return;case 2:var i,n=visitService.getById(this._cityId);if(n.cityMeta.rewards.some(function(t){var e=GameConfig.getItemMeta(t.id);return e?void 0:(i=t,!0)}),!i)return;var r=GameConfig.getPrincessMeta(i.id);e=PrincessEntity.parseBodyUrl(r.icon),this.imgBody.scaleX=.7,this.imgBody.scaleY=.7,this.imgBody.x=160-r.body_offset.x*this.imgBody.scaleX,this.imgBody.y=180-r.body_offset.y*this.imgBody.scaleY;break;default:this.imgBody.scaleX=.8,this.imgBody.scaleY=.8,this.imgBody.x=0,11e4>=t?(this.imgBody.y=0,this.imgBody.x=0):(this.imgBody.y=133,this.imgBody.x=-60),e=MinisterEntity.parseBodyUrl(t)}this.imgBody.source!=e&&(this.imgBody.source=e)},e.prototype.setSelfBody=function(){var t=mainService.playerInfo.national_icon,e=[[1001,1002,1003,1004,1005],[2001,2002,2003,2004,2005]],i=0;e[0].indexOf(t)>=0?i=0:e[1].indexOf(t)>=0?i=1:(t=1001,i=0),this.king.changeSex(i),this.king.setFace(t)},e.prototype.setContent=function(){var t=this,i=activityTimeService.getById(visitService.eventActTimeId);if(i){var n,r;parseInt(i.str)==this._cityId?(r=GameConfig.getEventMeta(i["int"]),n=GameConfig.getDialogueMeta(r.dialogue_id)):(r=GameConfig.getEventMetaByNextId(i["int"]),n=GameConfig.getDialogueMeta(i["int"])),this._step=this._step>=n.contents.length?n.contents.length-1:this._step;var o=CityEntity.getPeopleBg(r.bg);if(o!=this.imgBg.source&&(this.imgBg.source=o),this.setPeopleBody(n.contents[this._step].icon),this.imgFinish.visible=!1,this.btnAgain.enabled=!1,this.princessLikeValue.visible=!1,this.btnNext.visible=!0,999==n.contents[this._step].seq)this.currentState="choose",this._dataProvider.source=r.options;else{var s=n.contents[this._step].icon>2?2:n.contents[this._step].icon;this.currentState=e.states[s],this.labContent.text=n.contents[this._step].content,n.contents.length-1<=this._step&&(this.btnAgain.enabled=!0,this.princessLikeValue.visible=r.type>=3,this.btnNext.visible=!1,this._chooseData?(this.tipItem.icon=this._chooseData,this.tipItem.alpha=0,this.tipItem.visible=!0,egret.Tween.get(this.tipItem,null,null,!0).to({alpha:1,bottom:220},500,egret.Ease.cubicOut).wait(200).to({alpha:0},300).call(function(){t.tipItem.visible=!1,t.tipItem.bottom=98,t._chooseData=null}),this.playFinish()):this.imgFinish.visible=!0,this._princess&&PanelVisitPrincess.instance.show({princess:this._princess},function(){t._princess=null},2))}}},e.prototype.onGrpContent=function(t){this.imgFinish.visible||(this._step++,this.setContent())},e.prototype.onBtnAgainTap=function(t){visitService.inspect()},e.prototype.onInspectResponse=function(t){this._step=0,this.setSelfBody(),this.setContent()},e.prototype.onInspectChooseResponse=function(t){0==t.data.error&&(this._chooseData=t.data.itemId>0?t.data:{itemId:0,itemCount:this._selectItem.effect,princessId:this.princessLikeValue.princess},this.princessLikeValue.princess=this._cityId,this._step=0,this.setContent())},e.prototype.onUpdatePrincess=function(t){t.data.added&&(this._princess=t.data.princess)},e.prototype.onSelectItem=function(t){t.preventDefault(),this._selectItem=this.list.selectedItem,visitService.inspectChoose(this.list.selectedItem.effect)},e.prototype.playFinish=function(){var t=this.imgFinish;t.visible=!0,t.alpha=0,t.scaleX=t.scaleY=10,egret.Tween.get(t).to({scaleX:1,scaleY:1,alpha:1},600,egret.Ease.cubicIn)},e.states=["none","self","other","choose"],e}(StackView);__reflect(VisitPeople.prototype,"VisitPeople");var IRVisitChoose=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labContent.text=lang.string[this.data.content];var e=1,i="common_luck";switch(parseInt(this.data.type)){case 1:var n=GameConfig.getItemMeta(this.data.effect);i="item_"+n.icon;break;case 2:i="item_620011";break;case 3:this.imgIcon.source="common_luck",e=this.data.effect}this.labValue.text="+"+e,this.imgIcon.source=i},e}(alien.VisualEventItemRenderer);__reflect(IRVisitChoose.prototype,"IRVisitChoose");var VisitPrincessLikeValue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"princess",{get:function(){return this.metaId},set:function(t){var e,i=visitService.getById(t);if(i.cityMeta.rewards.some(function(t){var i=GameConfig.getItemMeta(t.id);return i?void 0:(e=t,!0)}),e){var n=GameConfig.getPrincessMeta(e.id);this.metaId=e.id;var r=princessService.getByMetaId(e.id);this.currentState=r?"luck":"like",this.progress.maximum=n.hire_value,this.progress.value=i.likeValue,this.labState.text=r?lang.visit_princess_state[5]:lang.visit_princess_state[Math.floor(i.likeValue/Math.floor(n.hire_value/5))],this.labValue.textFlow=r?lang.formatHtml(lang.visit_luck,r.luck):lang.formatHtml(lang.visit_goal,n.hire_value)}},enumerable:!0,configurable:!0}),e}(alien.VisualEventComponent);__reflect(VisitPrincessLikeValue.prototype,"VisitPrincessLikeValue");var VisitTreasure=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._reward=[],e._isPlaying=!1,e.skinName=visit.VisitTreasureSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.grpMap,egret.TouchEvent.TOUCH_TAP,this.onGrpMapTap,this),this.registerEvent(gameServer,protocols.WC_DIG_RESPONSE,this.onDigResponse,this),this.listRect.itemRenderer=IRVisitTreasure,this.listRect.dataProvider=this._rectDataProvider=new eui.ArrayCollection,this.listColumns.dataProvider=this._columnsDataProvider=new eui.ArrayCollection,this.listRow.dataProvider=this._rowDataProvider=new eui.ArrayCollection,this.imgGreyMap.mask=this.listRect},e.prototype.active=function(e){t.prototype.active.call(this,e),e&&(this._cityId=e.cityId,this.update()),this.initEffect()},e.prototype.update=function(){var t=visitService.getById(this._cityId);this._config=t.getTreasureConfig(),this.imgMap.source=t.getTreasureMap(),this.imgGreyMap.source=t.getTreasureGreyMap(),this.setList(),this.updateMap()},e.prototype.updateMap=function(){var t=visitService.getTreasureCountByCityId(this._cityId);this.labCount.text=t.sum+"",this.labLevel.text=lang.visit_treasure_level[this._config.treasureLevel],this.labItemCnt.text="X"+t.freeCnt},e.prototype.setList=function(){this._columnsDataProvider.source=new Array(this._config.columns),this._rowDataProvider.source=new Array(this._config.row),this.listColumns.layout.gap=this.grpMap.width/(this._config.columns+1),this.listRow.layout.gap=this.grpMap.height/(this._config.row+1),this.setGrey()},e.prototype.setGrey=function(){var t=this,e=[];visitService.getCityTreasuresByCityId(this._cityId).forEach(function(i){e.push({height:t.grpMap.height/(t._config.row+1),width:t.grpMap.width/(t._config.columns+1),state:i})}),this._rectDataProvider.source=e,this.listRect.layout.requestedColumnCount=this._config.columns+1},e.prototype.onGrpMapTap=function(t){var e=this;this._index=this.getIndex(t.localX,t.localY);var i=visitService.getCityTreasuresByCityId(this._cityId);i[this._index]||this._isPlaying||(visitService.getTreasureCountByCityId(this._cityId).freeCnt<=0?PanelUseThingAlert.instance.show({content:lang.visit_treasure_alert_content,id:600118,count:1},function(t){"confirm"==t&&visitService.dig(e._index+1)}):visitService.dig(this._index+1))},e.prototype.onDigResponse=function(t){0==t.data.error&&(this.playDig(this._index),this.updateMap(),this._reward=[{id:t.data.itemId,count:t.data.itemCount}])},e.prototype.getIndex=function(t,e){var i=this.grpMap.width/(this._config.columns+1),n=this.grpMap.height/(this._config.row+1),r=Math.floor(t/i)+Math.floor(e/n)*(this._config.columns+1);return r},e.prototype.initEffect=function(){this.digEffect||(this.digEffect=new alien.MovieClipView,this.grpMap.addChild(this.digEffect),this.digEffect.x=this.width/2-20,this.digEffect.y=this.height/2,this.digEffect.autoPlay=!1,this.digEffect.aniName="treasure",this.registerEvent(this.digEffect.movieClip,egret.Event.COMPLETE,this.onComplete,this)),this.digEffect.movieClip.stop(),this.digEffect.visible=!1,this._isPlaying=!1},e.prototype.playDig=function(t){this.digEffect.x=this.getEffectLocation(t).x,this.digEffect.y=this.getEffectLocation(t).y,this.digEffect.visible=!0,this.digEffect.movieClip.stop(),this.digEffect.movieClip.gotoAndPlay(0,2),this._isPlaying=!0},e.prototype.getEffectLocation=function(t){var e=visitService.getById(this._cityId),i=e.getTreasureConfig(),n=this.grpMap.width/(i.columns+1),r=this.grpMap.height/(i.row+1),o={x:t%(i.columns+1)*n+n/2,y:Math.floor(t/(i.columns+1))*r+r/2};return o},e.prototype.stopBuilding=function(){},e.prototype.onComplete=function(t){var e=this;this.digEffect.movieClip.stop(),this.digEffect.visible=!1,this.setGrey(),this._isPlaying=!1,this._reward.length>0&&PanelWorkFinish.instance.show({type:2,reward:this._reward},function(){e._reward.splice(0)})},e}(StackView);__reflect(VisitTreasure.prototype,"VisitTreasure");var IRVisitTreasure=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.width=this.data.width,this.height=this.data.height,this.rect.width=this.data.state>0?this.data.width:0,this.rect.height=this.data.state>0?this.data.height:0},e}(alien.VisualEventItemRenderer);__reflect(IRVisitTreasure.prototype,"IRVisitTreasure");var alien;!function(t){var e="\n		attribute vec2 aVertexPosition;\n		attribute vec2 aTextureCoord;\n		attribute vec2 aColor;\n		uniform vec2 projectionVector;\n		varying vec2 vTextureCoord;\n		varying vec4 vColor;\n		const vec2 center = vec2(-1.0, 1.0);\n		\n		void main(void) {\n			gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n			vTextureCoord = aTextureCoord;\n			vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n		}",i="\n		precision lowp float;\n		varying vec2 vTextureCoord;\n		varying vec4 vColor;\n		uniform sampler2D uSampler;\n		uniform vec4 uReplace;\n		uniform float threshold;\n		\n		void main(void) {\n			vec4 fg = texture2D(uSampler, vTextureCoord);\n			if(fg.a >= threshold){\n				fg = uReplace * fg.a;\n			}\n			gl_FragColor = fg * vColor;\n		}",n=function(n){function r(t,r){void 0===t&&(t=0/0),void 0===r&&(r=1);var o=n.call(this,e,i,{uReplace:{},threshold:r})||this;return o._color=-1,o._threshold=1,o._rgb={},o.color=t,o.threshold=r,o}return __extends(r,n),Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(e){if(e&&this._color!=e){this._color=e;var i=t.ColorUtils.valueToRgb(this._color).map(function(t){return t/255});this._rgb.x=i[0],this._rgb.y=i[1],this._rgb.z=i[2],this._rgb.w=1,this.uniforms.uReplace=this._rgb}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"threshold",{get:function(){return this._threshold},set:function(t){this._threshold!=t&&(this._threshold=t,this.uniforms.threshold=this._threshold)},enumerable:!0,configurable:!0}),r}(egret.CustomFilter);t.ColorFilter=n,__reflect(n.prototype,"alien.ColorFilter")}(alien||(alien={}));var ResourceLoader=function(){function t(){}return t.load=function(t,e,i){var n,r=this,o=!0;return t&&t.length>0&&alien.ResGroupsLoader.instance.checkNeedLoad(t)?(e(),n=alien.ResGroupsLoader.instance.loadResGroups(t).then(function(){o=!1,i()})):(o=!1,i(),n=Promise.resolve()),n.then(function(){r.watchPromise&&r.watchPromise()})},t.watchLoaded=function(){var t=this;return new Promise(function(e){t.watchPromise=e})},t}();__reflect(ResourceLoader.prototype,"ResourceLoader");var TNavigator=function(t){function e(e){var i=t.call(this)||this;return i._rootView=e,i}return __extends(e,t),e.prototype.addView=function(t,e){e?this._rootView.addChildAt(t,0):this._rootView.addChild(t)},e.prototype.onEnter=function(e,i,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return this._rootView.touchThrough=!0,[4,t.prototype.onEnter.call(this,e,i,n,r)];case 1:return o.sent(),this._rootView.touchThrough=!1,[2]}})})},e.prototype.onLeave=function(e,i,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return[4,t.prototype.onLeave.call(this,e,i,n,r)];case 1:return o.sent(),[2]}})})},e.prototype.onError=function(t){ErrorTrack.instance.sendErrorObject(t)},e}(alien.Navigator);__reflect(TNavigator.prototype,"TNavigator");var PanelActivity=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._type=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["activity"]},e.prototype.getSkinName=function(){return panels.PanelActivitySkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(this.btnLeft,egret.TouchEvent.TOUCH_TAP,this.onBtnLeftTap,this),this.registerEvent(this.btnRight,egret.TouchEvent.TOUCH_TAP,this.onBtnRightTap,this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_BANNER,this.onSelectRankBanner,this),this.registerEvent(alien.Dispatcher,EventNames.BACK_ACTIVITY,this.onBackActivity,this),this.tabBar.dataProvider=this._dataProvider=new ArrayCollection,this.vs.setup({def:ActBannerList},{def:ActBannerList},{def:ActBannerList},{def:ActBannerList}),this.vsDetails.setup({def:ActRankRewardList},{def:ActRankRewardList},{def:ActRankRewardList},{def:ActRankRewardList},{def:ActChargeRewardList},{def:ActDesc},{def:ActDesc},{def:ActSumChargeRewardList})},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){var t=this;return this.currentState="normal",this._dataProvider.source=activityService.getTabBarList(),this.tabBar.selectedIndex=0,this._dataProvider.source.length>4?(this.btnRight.visible=!1,this.btnLeft.visible=!1):(this.btnRight.visible=!1,this.btnLeft.visible=!1),0==this._dataProvider.source.length?void(this.currentState="none"):void alien.EgretUtils.callLater(function(){t.vs.setSelectedIndex(t.tabBar.selectedItem.index,t.tabBar.selectedItem.typeList)})},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.onTabSelect=function(t){this.vs.setSelectedIndex(this.tabBar.selectedItem.index,this.tabBar.selectedItem.typeList),this.currentState="normal"},e.prototype.onBtnLeftTap=function(t){this.scroller.viewport.scrollH=0},e.prototype.onBtnRightTap=function(t){var e=this.scroller.viewport;this.scroller.viewport.scrollH=Math.max(e.contentWidth-e.width)},e.prototype.onGrpButtonsTap=function(t){switch(t.target.name){case"back":this.currentState="normal";break;case"common":this.onCommonBtnTap()}},e.prototype.onCommonBtnTap=function(){switch(this._type){case ActivityEntity.ACTIVITY.TYPE_ARENA:case ActivityEntity.ACTIVITY.TYPE_NATIONAl:case ActivityEntity.ACTIVITY.TYPE_MINISTER:case ActivityEntity.ACTIVITY.TYPE_PRINCESS:PanelActivityRank.instance.show({type:this._type});break;case ActivityEntity.ACTIVITY.TYPE_CHARGE_6:case ActivityEntity.ACTIVITY.TYPE_CHARGE_30:case ActivityEntity.ACTIVITY.TYPE_CHARGE_198:case ActivityEntity.ACTIVITY.TYPE_CHARGE_68:case ActivityEntity.ACTIVITY.TYPE_CHARGE_328:case ActivityEntity.ACTIVITY.TYPE_CHARGE_648:PanelShop.instance.show(2),this.close();break;case ActivityEntity.ACTIVITY.TYPE_BUG:this.copy(GameConfig.groupNumber)}},e.prototype.copy=function(t){if(document){var e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),e.setSelectionRange(0,e.value.length),document.execCommand("Copy"),document.body.removeChild(e),Toast.show({text:lang.copy_success})}},e.prototype.onSelectRankBanner=function(t){this._type=t.data.type;var e=ActivityEntity.getActivityConfigByType(this._type).btnState;this.currentState=e,this.btnCommon.label=lang.activity_btn_name[this._type];var i=ActivityEntity.getActivityConfigByType(this._type).index;this.vsDetails.setSelectedIndex(i,{type:t.data.type})},e.prototype.onBackActivity=function(t){this.currentState="normal"},e}(PanelBase);__reflect(PanelActivity.prototype,"PanelActivity");var PanelActivityRank=function(t){function e(){var e=t.call(this)||this;return e._states=["power_national","minister","princess","arena"],e._type=0,e._dataProvider=new eui.ArrayCollection,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider,this.registerEvent(gameServer,ProtocolConfigs.WC_OPENTOP_RESPONSE,this.onOpenTopResponse,this)},e.prototype.init=function(){this.title=lang.panel_arena_ranking},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelActivityRankSkin),this.skinType=1,[4,this.popup()];case 1:return e.sent(),this._type=t.type,this.currentState=this._states[this._type-7],[2]}})})},e.prototype.active=function(){t.prototype.active.call(this);var e=RankService.RankType.TYPE_POWER_NATIONAL_UP;switch(this._type){case ActivityEntity.ACTIVITY.TYPE_NATIONAl:e=RankService.RankType.TYPE_POWER_NATIONAL_UP;break;case ActivityEntity.ACTIVITY.TYPE_MINISTER:e=RankService.RankType.TYPE_MINISTER_UP;break;case ActivityEntity.ACTIVITY.TYPE_PRINCESS:e=RankService.RankType.TYPE_PRINCESS_UP;break;case ActivityEntity.ACTIVITY.TYPE_ARENA:e=RankService.RankType.TYPE_ARENA_UP}rankService.openTop(e)},e.prototype.onOpenTopResponse=function(t){if(!(t.data.error>0)){var e=[];t.data.rankList.forEach(function(t){t&&e.push(t)}),this._dataProvider.source=e,t.data.self.length>0?(this.labNum.text=t.data.self[0].num+1+"",this.labScore.text=t.data.self[0].score+""):(this.labNum.text=lang.activity_rank_none,this.labScore.text=""),this.labNickname.text=mainService.playerBaseInfo.name}},e}(CommonPanelBase);__reflect(PanelActivityRank.prototype,"PanelActivityRank");var PanelAddPower=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._metaIdList=[],e._itemList=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(gameServer,protocols.WC_ITEM_USE_Response,this.onItemUseResponse,this),this.list.itemRenderer=IRAddPower,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this._itemList),this.registerEvent(alien.Dispatcher,EventNames.ADD_POWER,this.onAddPower,this),this.registerEvent(gameServer,protocols.WC_PRICESS_ADDACTIVITY_RESPONSE,this.onItemUseResponse,this)},e.prototype.setItemList=function(){this._itemList.splice(0,this._itemList.length);for(var t=0;t<this._metaIdList.length;++t){var e=new ItemEntity,i="";packService.getItemByMetaId(this._metaIdList[t])&&(i=packService.getItemByMetaId(this._metaIdList[t]).id),e.inject({metaId:this._metaIdList[t],count:packService.getCountByMetaId(this._metaIdList[t]),id:i}),this._itemList.push(e)}},e.prototype.onItemUseResponse=function(t){t.data.error>0||(this.setItemList(),this._dataProvider.source=this._itemList)},e.prototype.init=function(){this.title=lang.panel_use_item},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelAddPowerSkin),this._data=e,this._metaIdList.splice(0,this._metaIdList.length),this._metaIdList=t,this.setItemList(),this._dataProvider&&(this._dataProvider.source=this._itemList),this.skinType=1,[4,this.popup()];case 1:return i.sent(),[2]}})})},e.prototype.onAddPower=function(t){var e=t.data;this._data?princeService.addActivity(this._data.id,e.meta.id):packService.useItem(e.id,1)},e}(CommonPanelBase);__reflect(PanelAddPower.prototype,"PanelAddPower");var IRAddPower=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnUse,egret.TouchEvent.TOUCH_TAP,this.onBtnUseClick,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=this.data.meta;this.itemView.metaId=e.metaId,this.itemView.hideCount=!0,this.labItemName.text=i.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[i.quality],this.labCnt.text=e.count+"",this.labEffect.text=i.intro,e.count<=0?this.btnUse.enabled=!1:this.btnUse.enabled=!0},e.prototype.onBtnUseClick=function(t){alien.Dispatcher.dispatch(EventNames.ADD_POWER,this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRAddPower.prototype,"IRAddPower");var PanelAlert=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.buttons.itemRenderer=IRAlertButton,this.buttons.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.buttons,egret.Event.CHANGING,this.onTapButton,this)},e.prototype.onTapButton=function(t){t.preventDefault(),this.dealAction(this.buttons.selectedItem)},e.prototype.init=function(){},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n;return __generator(this,function(r){switch(r.label){case 0:return this.skinName||(this.skinName=panels.PanelAlertSkin),e=t.content,i=t.buttons,n=t.callback,this.skinType=2,[4,this.popup(n,this.dealAction)];case 1:return r.sent(),"object"==typeof e?this.labContent.textFlow=e:this.labContent.text=e,this._dataProvider.source=i,[2]}})})},e}(CommonPanelBase);__reflect(PanelAlert.prototype,"PanelAlert");var IRAlertButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.button.skinName=ui[(this.data.color||"Orange")+"ButtonSkin"],this.button.label=this.data.label},e}(eui.ItemRenderer);__reflect(IRAlertButton.prototype,"IRAlertButton");var Alert=function(){function t(){}return t.show=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=null);var n=[{name:"confirm",label:lang.confirm}];switch(e){case 1:n.unshift({name:"cancel",color:"Red",label:lang.cancel});break;case 2:n[0].label=lang.go_world_map,n[0].name="go"}PanelAlert.instance.show({content:t,buttons:n,callback:i})},t}();__reflect(Alert.prototype,"Alert");var PanelAntiAddiction=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_anti_addiction},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelAntiAddictionSkin),[4,this.popup()];case 1:return t.sent(),this.labContent.textFlow=lang.htmlParser.parse(lang.anti_addiction_content),[2]
}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tiName.text="",this.tiID.text="",this.btnConfirm.enabled=!1,this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(this.tiName,egret.Event.CHANGE,this.deal,this),this.registerEvent(this.tiID,egret.Event.CHANGE,this.deal,this)},e.prototype.deal=function(t){var e=alien.RegUtils.validateName(this.tiName.text),i=alien.RegUtils.validateIdCard(this.tiID.text);this.btnConfirm.enabled=e&&i},e.prototype.onBtnConfirmTap=function(t){dataCenterService.isAdult=!0,this.dealAction()},e}(CommonPanelBase);__reflect(PanelAntiAddiction.prototype,"PanelAntiAddiction");var PanelBattleResult=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.listReward.itemRenderer=IRBattleReward,this.listReward.dataProvider=this._rewardDataProvider=new eui.ArrayCollection,this.listMinister.itemRenderer=IRBattleMinister,this.listMinister.dataProvider=this._ministerDataProvider=new eui.ArrayCollection,this.listWay.itemRenderer=IRUpgradeWay,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){this.dealAction()},e.prototype.updateUI=function(t){var e="blue"==battleService.currentWinGroup;if(this.currentState=e?"success":"failed",e)if(0==t.type){var i=battleService.generals,n=battleService.stronghold;this._rewardDataProvider.source=n.reward;var r=Math.floor(n.reward_exploit/battleService.getSetupGeneralCount()),o=[];i.forEach(function(t){if(t){var e=ministerService.getMinisterById(t),i=100+e.getSkillEffect(50003,5)+technologyService.getSkillAddition(401009);o.push({ministerId:t,exploit:Math.ceil(r*i*.01)})}}),this._ministerDataProvider.source=o}else this._rewardDataProvider.source=t.reward,this._ministerDataProvider.source=[]},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelBattleResultSkin),this._callback=e,[4,this.popup(this.dealAction)];case 1:return i.sent(),this.updateUI(t),[2]}})})},e}(PanelBase);__reflect(PanelBattleResult.prototype,"PanelBattleResult");var IRBattleReward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=GameConfig.getItemMeta(this.data.item);this.itemView.metaId=e.id,this.labContent.text=e.name+"+"+this.data.count},e}(eui.ItemRenderer);__reflect(IRBattleReward.prototype,"IRBattleReward");var IRBattleMinister=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=ministerService.getMinisterById(this.data.ministerId).meta;this.labName.text=e.name,this.labName.textColor=GameConfig.QUALITY_COLORS[e.quality],this.labReward.text=lang.minister_info_fields.exploit+"+"+this.data.exploit},e}(eui.ItemRenderer);__reflect(IRBattleMinister.prototype,"IRBattleMinister");var IRUpgradeWay=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labContent.text=lang.battle_fail_upgrade_ways[this.data.type]},e.prototype.onBtnGoTap=function(t){var e=parseInt(this.data.type);switch(e){case 0:SceneController["goto"](ConstantNames.SCENE_TECHNOLOGY,{tab:2});break;case 1:SceneController["goto"](ConstantNames.SCENE_MINISTER_INFO,{minister:battleService.getMasterGeneral()});break;case 2:SceneController["goto"](ConstantNames.SCENE_MINISTER_INFO,{minister:battleService.getMasterGeneral(),tab:1});break;case 3:SceneController["goto"](ConstantNames.SCENE_MINISTER_INFO,{minister:battleService.getMasterGeneral(),tab:2})}},e}(alien.VisualEventItemRenderer);__reflect(IRUpgradeWay.prototype,"IRUpgradeWay");var PanelBossSelectMinister=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._ministers=[null,null,null],e._openState=!1,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRMinisterProp,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this._ministers),alien.Utils.anchorCenter(this.btnStart),this._wave=new alien.Wave(this.btnStart,4e3,alien.Wave.zoom.bind(null,.05)),this.registerEvent(this.btnAutoFight,egret.TouchEvent.TOUCH_TAP,this.onBtnAutoFightTap,this),this.registerEvent(this.btnStart,egret.TouchEvent.TOUCH_TAP,this.onBtnStartFightTap,this),this.registerEvent(this.grpMinister,egret.TouchEvent.TOUCH_TAP,this.onGrpMinisterTap,this),this.registerEvent(gameServer,protocols.WC_Boss_Select_Response,this.onBossSelectResponse,this),this.registerEvent(bossService,EventNames.BOSS_SELECT_NOTIFY,this.onBossSelectNotify,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this)},e.prototype.getSkinName=function(){return panels.PanelBossSelectMinisterSkin},e.prototype.inactive=function(){this._wave.stop(),this._openState=!1,t.prototype.inactive.call(this)},e.prototype.getOpenState=function(){return this._openState},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this._openState=!0,this.update(),[2]}})})},e.prototype.update=function(){alien.Utils.enumChildren(this.grpMinister,function(t,e){bossService.ministersQueue[e]&&(t.id=bossService.ministersQueue[e].id)}),this.updateDamage(),this._dataProvider.source=this._ministers},e.prototype.updateDamage=function(){var t=0,e=0;this._ministers.forEach(function(t){t&&e++}),e>=3?(this.imgHurt.visible=!0,this.labHurt.visible=!0,this.imgHurt.source="world_boss_hurt_"+bossService.getDamagePercent(this._ministers),t=bossService.getDamageByMinisterId(this._ministers),this.labHurt.text=t+""):(this.imgHurt.visible=!1,this.labHurt.visible=!1),this.btnStart.enabled=e>=3,e>=3?this._wave.play():this._wave.stop()},e.prototype.onBtnAutoFightTap=function(t){dataCenterService.bossAutoFight=!0,bossService.selectMinister(BossEntity.BOSS_TYPE.WORLD,bossService.getMinisters()),this.close()},e.prototype.onBtnStartFightTap=function(t){bossService.selectMinister(BossEntity.BOSS_TYPE.WORLD,this._ministers)},e.prototype.onGrpMinisterTap=function(t){var e=this;if(console.log(t.target.constructor.name),"minister"==t.target.name){var i=t.target;if("selected"==i.currentState){var n=this._ministers.indexOf(t.target.id);this._ministers[n]=null,i.currentState="normal"}else this._ministers.some(function(t,n){return t?void 0:(e._ministers[n]=i.id,i.currentState="selected",!0)});this._dataProvider.source=this._ministers,this.updateDamage()}},e.prototype.onBossSelectResponse=function(t){0==t.data.error&&this.close()},e.prototype.onBossSelectNotify=function(t){this._ministers=[null,null,null],this._dataProvider.source=this._ministers,this.update()},e.prototype.onUpdateBossInfo=function(t){this.close()},e.prototype.close=function(){this._ministers=[null,null,null],t.prototype.close.call(this)},e}(PanelBase);__reflect(PanelBossSelectMinister.prototype,"PanelBossSelectMinister");var IRMinisterProp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){var e=bossService.getBufferIcon(this.data);this.imgProp.source="buffer_icon_"+e}this.currentState=this.data?"normal":"none"},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterProp.prototype,"IRMinisterProp");var PanelCashGiftShop=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cdId=0,e}return __extends(e,t),i=e,Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),e.prototype.getSkinName=function(){return panels.PanelCashGiftShopSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnRefresh,egret.TouchEvent.TOUCH_TAP,this.onBtnRefreshTap,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(princessService,EventNames.REFRESH_CASH_GIFT_SHOP,this.onRefreshCashGift,this),this.registerEvent(gameServer,protocols.WC_BUY_RANDOMSHOP_RESPONSE,this.onBuyRandomShopResponse,this)},e.prototype.init=function(){this.title=lang.panel_cash_gift_shop},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),princessService.openRandomShop()},e.prototype.update=function(){this.labCashGift.text=mainService.playerInfo.cash_gift+"";var t=princessService.getCashGiftList();this._dataProvider.source=t,this.timeRefresh()},e.prototype.timeRefresh=function(){var t=new Date(new Date(1e3*mainService.tsServer).toLocaleDateString()).getTime()+864e5,e=Math.floor(t/1e3)-mainService.tsServer;e>=0&&(this._cdId=countDownService.register(t,this.onSecond.bind(this)))},e.prototype.onBtnRefreshTap=function(t){Alert.show(lang.formatHtml(lang.refresh_gift_shop_notice,20),1,function(t){"confirm"==t.name&&princessService.refreshRandomShop()})},e.prototype.onSelectItem=function(t){if(t.preventDefault(),!(this.list.selectedItem.buyTime>0)){this._selectItem=this.list.selectedItem;var e=this.list.selectedIndex,i=GameConfig.getExchangeMeta(this._selectItem.id);GameConfig.getItemMeta(i.item_id);PanelShopBuyItem.instance.show({shopItem:i,type:PanelShopBuyItem.BUY_TYPE.CASH_SHOP},function(t){"confirm"==t&&princessService.buyRandomShop(e)})}},e.prototype.onRefreshCashGift=function(t){this.update()},e.prototype.onBuyRandomShopResponse=function(t){if(!(t.data.error>0)&&this._selectItem){var e=GameConfig.getExchangeMeta(this._selectItem.id);PanelWorkFinish.instance.show({type:2,reward:[{id:e.item_id,count:e.item_count}],princessEffect:null})}},e.prototype.onSecond=function(t){return 0>=t&&this._cdId>0?(countDownService.unregister(this._cdId),this._cdId=0,void this.timeRefresh()):void(this.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e.prototype.onRemovedToStage=function(t){this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0)},e=i=__decorate([modifyChild],e);var i}(CommonPanelBase);__reflect(PanelCashGiftShop.prototype,"PanelCashGiftShop");var PanelCDKey=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSure,egret.TouchEvent.TOUCH_TAP,this.onBtnSureTap,this)},e.prototype.init=function(){},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelCDKeySkin),[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.onBtnSureTap=function(t){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:if(t=alien.StringUtils.trim(this.tiCDKey.text),!(t.length>0))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,webService.exchangeCodeGift(t)];case 2:return e=n.sent(),PanelWorkFinish.instance.show({type:2,reward:e}),[3,4];case 3:return i=n.sent(),Alert.show(lang.api_error[i]),[3,4];case 4:return[2]}})})},e}(CommonPanelBase);__reflect(PanelCDKey.prototype,"PanelCDKey");var PanelChangeIcon=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPlayerIcon,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(this.btnSure,egret.TouchEvent.TOUCH_TAP,this.onBtnSureTap,this),this.registerEvent(gameServer,protocols.WC_SETFACE_RESPONSE,this.onSetFaceResponse,this)},e.prototype.init=function(){this.title=lang.panel_change_icon},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelChangeIconSkin),this.skinType=1,[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){for(var t=[],e=1001;1006>e;++e)e!=mainService.playerInfo.chat_icon&&t.push(e);for(var e=2001;2006>e;++e)e!=mainService.playerInfo.chat_icon&&t.push(e);ministerService.ministers.forEach(function(e){e.meta.id!=mainService.playerInfo.chat_icon&&t.push(e.meta.id)}),princessService.princesses.forEach(function(e){e.meta.id!=mainService.playerInfo.chat_icon&&t.push(e.meta.id)}),this._dataProvider.source=t,this.list.selectedIndex=0},e.prototype.onBtnSureTap=function(t){chatService.changIcon(this.list.selectedItem)},e.prototype.onSetFaceResponse=function(t){t.data.error>0||this.close()},e}(CommonPanelBase);__reflect(PanelChangeIcon.prototype,"PanelChangeIcon");var IRPlayerIcon=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.playerIcon.setPlayer(this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRPlayerIcon.prototype,"IRPlayerIcon");var PanelChat=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["chat"]},e.prototype.getSkinName=function(){return panels.PanelChatSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabBar.dataProvider=new eui.ArrayCollection(GameConfig.panelChatTabs),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.tabBar,egret.Event.CHANGING,this.onTabChanging,this),this.registerEvent(this.editableText,egret.Event.CHANGE,this.onEditChange,this),this.registerEvent(this.btnSend,egret.TouchEvent.TOUCH_TAP,this.onBtnSendTap,this),this.registerEvent(gameServer,protocols.CLIENT_CHAT_SendMessageResponse_Notify,this.onSendMessageResponse,this),this.registerEvent(alien.Dispatcher,EventNames.JOIN_PARTY,this.onJoinParty,this),this.vs.setup({def:ChatMessageList},{def:ChatMessageList}),this.vs.setSelectedIndex(0,{type:0})},e.prototype.init=function(){this.title=lang.panel_chat},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.active=function(){t.prototype.active.call(this),this.editableText.text="",this.labSum.text=this.editableText.text.length+"/"+this.editableText.maxChars,this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this.tabBar.selectedIndex},!1)},e.prototype.onTabSelect=function(t){this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this.tabBar.selectedIndex},!1)},e.prototype.onTabChanging=function(t){mainService.playerInfo.union_id<=0&&(t.preventDefault(),Toast.show({text:lang.chat_union_tip}))},e.prototype.onEditChange=function(t){this.editableText.text=alien.RegUtils.filterEmoji(this.editableText.text),this.labSum.text=this.editableText.text.length+"/"+this.editableText.maxChars},e.prototype.onBtnSendTap=function(t){var e=this;if(!(this.editableText.text.length<=0)&&openService.getOpenStatus({name:"chat"},function(){e.close()})){var i=ChatMessageList.chatTapMap[this.tabBar.selectedIndex],n="<headIcon>"+mainService.playerInfo.chat_icon+"</headIcon>",r="";mainService.playerInfo.union_id&&i==MessageEntity.ChatType.TYPE_WORLD&&(r='<unionName>{"union": {"name":"'+unionService.union.info.name+'" }}</unionName>'),chatService.sendMessage(this.editableText.text+n+r,i),this._content=this.editableText.text,this.editableText.text="",this.labSum.text=this.editableText.text.length+"/"+this.editableText.maxChars}},e.prototype.onSendMessageResponse=function(t){Toast.show({text:lang.response_error[63]}),this.editableText.text=this._content,this.labSum.text=this.editableText.text.length+"/"+this.editableText.maxChars},e.prototype.onJoinParty=function(t){var e=this;openService.getOpenStatus({name:ConstantNames.SCENE_PRINCESS_PARTY},function(){e.close()})&&(this.close(),SceneController["goto"](ConstantNames.SCENE_PRINCESS_PARTY))},e}(CommonPanelBase);__reflect(PanelChat.prototype,"PanelChat");var PanelCombineItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.title=lang.panel_combine_item,this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelCombineItemSkin),[4,this.popup()];case 1:return i.sent(),e=t.meta,this.meta=e,this.updateUI(),[2]}})})},e.prototype.onUpdateItem=function(t){this.updateUI()},e.prototype.updateUI=function(){var t=this.meta;this.itemView.metaId=t.id,this.labItemName.text=t.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[t.quality],this.labIntro.text=t.intro,this.sourceItemList.setItems(t.material.items),this.btnConfirm.enabled=packService.checkCombine(t.id)},e.prototype.onBtnConfirmTap=function(t){packService.combineItem(this.meta.id)},e}(CommonPanelBase);__reflect(PanelCombineItem.prototype,"PanelCombineItem");var PanelDevelopSelect=function(t){function e(){return t.call(this,alien.popupEffect.None,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRDevelopItem,this.registerEvent(this.list,egret.TouchEvent.TOUCH_TAP,this.onSelectType,this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelDevelopSelectSkin),this._callback=t,[4,this.popup(this.dealAction)];case 1:return e.sent(),[2]}})})},e.prototype.onSelectType=function(t){var e=this.list.selectedIndex;PanelDispatchForInterior.instance.show(e,this._callback),this.close()},e}(PanelBase);__reflect(PanelDevelopSelect.prototype,"PanelDevelopSelect");var IRDevelopItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.grpContent.mask=this.contentMask},e.prototype.onAddedToStage=function(e){t.prototype.onAddedToStage.call(this,e),this.play()},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgIcon.source="interior_scroll_"+this.data.name,this.labDesc.text=lang.develop_desc[this.data.name]},e.prototype.play=function(){var t=this;this.contentMask.y=0,this.contentMask.height=0,this.imgDown.y=0,this.labDesc.alpha=0,egret.Tween.get(this.contentMask).to({y:0,height:407},1e3,egret.Ease.cubicInOut),egret.Tween.get(this.imgDown).to({y:376.5},1e3,egret.Ease.cubicInOut).call(function(){t.labDesc.alpha=1})},e}(alien.VisualEventItemRenderer);__reflect(IRDevelopItem.prototype,"IRDevelopItem");var PanelDuplicate=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_union_duplicate},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRDuplicate,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(gameServer,protocols.WC_Boss_OpenOrg_Response,this.onOpenOrgResponse,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this)},e.prototype.onSelectItem=function(t){},e.prototype.onUpdateBossInfo=function(t){SceneController["goto"](ConstantNames.SCENE_DUPLICATE,{type:BossEntity.BOSS_TYPE.UNION}),this.close()},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelDuplicateSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.labCount.text=unionService.union.info.bossCount+"/3",this._dataProvider.length<=0?this._dataProvider.source=alien.Utils.objectValues(GameConfig.boss):this._dataProvider.refresh()},e.prototype.onOpenOrgResponse=function(t){0==t.data.error&&bossService.getBossInfo(BossEntity.BOSS_TYPE.UNION)},e}(CommonPanelBase);__reflect(PanelDuplicate.prototype,"PanelDuplicate");var IRDuplicate=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnOpen,egret.TouchEvent.TOUCH_TAP,this.onBtnOpenTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.currentState="normal",this.imgIcon.filters=[];var e=unionService.union.info,i=this.data;this.labName.text=i.name,this.imgIcon.source="union_duplicate_icon_"+i.id,this.labCondition.textFlow=lang.formatHtml(lang.union_need_level,i.open_level),this.labBlood.text=i.blood+lang.hundred_million,this.labTechCost.text=wsy.Utils.shortCurrency(e.techPoint)+"/"+wsy.Utils.shortCurrency(i.open_tech),e.level<i.open_level&&(this.currentState="level",this.imgIcon.filters=[GameConfig.greyFilter]),e.techPoint<parseInt(i.open_tech)&&(this.currentState="tech",this.imgIcon.filters=[GameConfig.greyFilter])},e.prototype.onBtnOpenTap=function(t){bossService.openBoss(this.data.id)},e}(alien.VisualEventItemRenderer);__reflect(IRDuplicate.prototype,"IRDuplicate");var PanelEmail=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.items=[],e._reqNum=0,e._resNum=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["email"]},e.prototype.getSkinName=function(){return panels.PanelEmailSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IREmail,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectEmail,this),this.registerEvent(emailService,EventNames.UPDATE_EMAIL,this.onUpdateEmail,this),this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this)},e.prototype.onSelectEmail=function(t){t.preventDefault(),PanelEmailDetails.instance.show({email:this.list.selectedItem},this.onReadEmailResult.bind(this))},e.prototype.init=function(){this.title=lang.panel_email},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),this.initOneGetConfig(),emailService.getMailList()},e.prototype.onUpdateEmail=function(t){this._dataProvider.source=emailService.getEmails(),0==this._dataProvider.source.length?this.labEmpty.visible=!0:this.labEmpty.visible=!1;var e=emailService.getReadEmailNum();this.labCount.text=e+"/"+(emailService.emails.length-e)},e.prototype.onReadEmailResult=function(){var t=emailService.getReadEmailNum();this.labCount.text=t+"/"+(emailService.emails.length-t),this._dataProvider.source=emailService.getEmails()},e.prototype.oneBtnReq=function(){var t=this;this._reqNum=0,this._resNum=0;var e=emailService.getEmails(),i=egret.setInterval(function(){emailService.getMailItem(e[t._reqNum].id),t._reqNum++,t._reqNum>=e.length&&egret.clearInterval(i)},this,20)},e.prototype.onGetMailItemResponse=function(t){var e=this;this._reqNum<=0||(this._resNum++,0==t.data.error&&(t.data.items.forEach(function(t){if(t.id>0){var i=GameConfig.getItemMeta(t.id),n=GameConfig.getGiftPackMeta(i["export"]);if(n){var r=packService.getItemByMetaId(t.id);n.items.forEach(function(i){var n={id:i.id,count:i.count*t.count};e.updateItem(n)}),r&&packService.useItem(r.id,t.count)}else e.updateItem(t)}}),this.items.length>0&&this._resNum>=this._reqNum&&PanelWorkFinish.instance.show({type:2,reward:this.items},function(){e.initOneGetConfig()})))},e.prototype.initOneGetConfig=function(){this._resNum=0,this._reqNum=0,this.items.splice(0)},e.prototype.updateItem=function(t){var e=!1;this.items.some(function(i){return i.id==t.id?(i.count+=t.count,e=!0,!0):void 0}),!e&&t.count>0&&this.items.push(t)},e}(CommonPanelBase);__reflect(PanelEmail.prototype,"PanelEmail");var IREmail=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labTitle.text=e.title,this.labTime.text=alien.TimeUtils.dateTimeToString(alien.TimeUtils.tsToDate(e.timestamp)),e.isRead?this.imgIcon.source="email_icon_looked":this.imgIcon.source="email_icon_un_look"},e}(alien.VisualEventItemRenderer);__reflect(IREmail.prototype,"IREmail");var PanelEmailDetails=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e.items=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.dealAction,this),this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceive,this),this.registerEvent(gameServer,protocols.WC_ReadMailResponse,this.onReadMailResponse,this),this.registerEvent(gameServer,protocols.WC_GetMailItemsResponse,this.onGetMailItemResponse,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectedItem,this),this.registerEvent(this.btnDelete,egret.TouchEvent.TOUCH_TAP,this.onBtnDeleteTap,this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new ArrayCollection},e.prototype.show=function(t,e){var i=t.email;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.email=i,this.skinName||(this.skinName=panels.PanelEmailDetailsSkin),this._callback=e,[4,this.popup()];case 1:return t.sent(),this.updateUI(),[2]}})})},e.prototype.updateUI=function(){this.labTitle.text=this.email.title,this.labTime.text=alien.TimeUtils.dateTimeToString(alien.TimeUtils.tsToDate(this.email.timestamp))},e.prototype.active=function(){t.prototype.active.call(this),emailService.readMail(this.email.id)},e.prototype.inactive=function(){this._dataProvider.source=[],t.prototype.inactive.call(this)},e.prototype.onBtnReceive=function(t){emailService.getMailItem(this.email.id)},e.prototype.onReadMailResponse=function(t){var e=this;if(!(t.data.error>0)){var i=t.data;this.labDetails.text=i.content,this.items=[],i.items.forEach(function(t){if(t.id>0){var i=GameConfig.getItemMeta(t.id),n=GameConfig.getGiftPackMeta(i["export"]);n?n.items.forEach(function(i){var n={id:i.id,count:i.count*t.count};e.items.push(n)}):e.items.push(t)}}),this._dataProvider.source=this.items,this.currentState=this.items.length>0?"normal":"no_item"}},e.prototype.onGetMailItemResponse=function(t){t.data.items.forEach(function(t){if(t.id>0){var e=GameConfig.getItemMeta(t.id),i=GameConfig.getGiftPackMeta(e["export"]);if(i){var n=packService.getItemByMetaId(t.id);n&&packService.useItem(n.id,t.count)}}}),this.items.length>0&&PanelWorkFinish.instance.show({type:2,reward:this.items},null),this.dealAction()},e.prototype.onSelectedItem=function(t){t.preventDefault();var e=this.list.selectedItem;PanelItemDetails.instance.show({id:e.id})},e.prototype.onBtnDeleteTap=function(t){emailService.getMailItem(this.email.id)},e}(PanelBase);__reflect(PanelEmailDetails.prototype,"PanelEmailDetails");var PanelFirstCharge=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemId=620101,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this.getItems()),this.registerEvent(this.btn,egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(gameServer,protocols.WC_RECHARGE_FIRST_ITEM_RESPONSE,this.onRechargeFirstItemResponse,this),this.registerEvent(activityService,EventNames.UPDATE_FIRST_CHARGE,this.update,this)},e.prototype.getSkinName=function(){return panels.PanelFirstChargeSkin},e.prototype.getResGroupNames=function(){return["first_charge"]},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){var t=activityTimeService.getById(activityService.firstChargeActTimeId);t?(this.currentState="finish",this.btn.enabled=0==t["int"]):this.currentState="normal"},e.prototype.getItems=function(){var t=GameConfig.getItemMeta(this.itemId),e=t["export"],i=GameConfig.getGiftPackMeta(e);return i.items},e.prototype.onBtnTap=function(t){switch(this.currentState){case"normal":this.close(),PanelShop.instance.show(2);
break;case"finish":shopService.getFirstChargeGift()}},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e.prototype.onRechargeFirstItemResponse=function(t){if(0==t.data.error){var e=packService.getItemByMetaId(this.itemId);e&&packService.useItem(e.id,1),PanelWorkFinish.instance.show({type:2,reward:this.getItems()})}},e}(PanelBase);__reflect(PanelFirstCharge.prototype,"PanelFirstCharge");var PanelGiveEquipment=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._types=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRGiveEquipment,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_CARD_ADDEQUIP_Response,this.onGiveEquipmentResponse,this),this.registerEvent(gameServer,protocols.WC_CARD_REMOVEEQUIP_Response,this.onRemoveEquipmentResponse,this),this.registerEvent(gameServer,protocols.WC_EquipStrengthen_Response,this.onItemUpgradeResponse,this)},e.prototype.init=function(){this.title=lang.panel_give_normal_item},e.prototype.getSkinName=function(){return panels.PanelGiveEquipmentSkin},e.prototype.show=function(t){var e=t.types,i=t.target;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return this._target=i,this._types=e,[4,this.popup()];case 1:return n.sent(),t=this.getSource(),this.currentState=t.length>0?"normal":"empty",this._dataProvider.source=t,this.updateUI(),[2]}})})},e.prototype.onItemUpgradeResponse=function(t){this.updateUI()},e.prototype.updateUI=function(){this._dataProvider.source=this.getSource(),this._dataProvider.source.sort(function(t,e){var i=t.isEquiped?1:0,n=e.isEquiped?1:0,r=t.item,o=e.item;return n==i?o.meta.quality==r.meta.quality?o.level-r.level:o.meta.quality-r.meta.quality:n-i})},e.prototype.getSource=function(){var t=this,e=[];return this._types.forEach(function(i){var n=packService.getItemsByTypes([i],t._target);n.forEach(function(n,r){e.push({item:n,type:i,isEquiped:t._target.isEquipedItem(n.id),target:t._target})})}),e},e.prototype.onGiveEquipmentResponse=function(t){0==t.data.error&&this.dealAction()},e.prototype.onRemoveEquipmentResponse=function(t){0==t.data.error&&(this.updateUI(),this.dealAction())},e}(CommonPanelBase);__reflect(PanelGiveEquipment.prototype,"PanelGiveEquipment");var IRGiveEquipment=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(this.btnUpgrade,egret.TouchEvent.TOUCH_TAP,this.onBtnUpgradeTap,this)},e.prototype.onBtnConfirmTap=function(t){var e=this.data.type;alien.Dispatcher.dispatch(EventNames.GIVE_EQUIPMENT,__assign({},this.data,{equip:!this.isEquiped,index:e-11}))},e.prototype.onBtnUpgradeTap=function(t){var e=this.data.item;PanelItemUpgrade.instance.show({item:e},null)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.item,n=e.isEquiped,r=e.type,o=r-11,s=GameConfig.getItemMeta(i.metaId);this.isEquiped=n,this.itemView.setItemData(i),this.labItemName.text=s.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[s.quality],this.labType.text=lang.minister_info_fields[MinisterEntity.abilityClassifyFields[o]],this.labEffect.text=packService.getItemEffect(i.metaId,i.level+1),this.btnConfirm.skinName=this.isEquiped?ui.RedButtonSkin:ui.OrangeButtonSkin,this.btnConfirm.label=this.isEquiped?lang.minister_remove_equipment:lang.minister_give_equipment},e}(alien.VisualEventItemRenderer);__reflect(IRGiveEquipment.prototype,"IRGiveEquipment");var PanelGiveNormalItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRGiveItem,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.init=function(){this.title=lang.panel_give_normal_item},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this.btnGet,egret.TouchEvent.TOUCH_TAP,this.onBtnGetTap,this)},e.prototype.show=function(t){var e=t.types,i=t.target,n=t.items;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return this.skinName||(this.skinName=panels.PanelGiveNormalItemSkin),[4,this.popup()];case 1:return r.sent(),t=[],e.forEach(function(e){n.forEach(function(n,r){if(i.meta.hasOwnProperty("quality")){var o=GameConfig.getItemMeta(n[e]);o.quality<=i.meta.quality&&t.push({metaId:n[e],index:r,type:e,target:i})}else t.push({metaId:n[e],index:r,type:e,target:i})})}),this._dataProvider.source=t.reverse(),this.updateUI(),[2]}})})},e.prototype.updateUI=function(){this._dataProvider.refresh()},e.prototype.onBtnGetTap=function(t){SceneController.jump(ConstantNames.SCENE_TREASURE),this.close()},e}(CommonPanelBase);__reflect(PanelGiveNormalItem.prototype,"PanelGiveNormalItem");var IRGiveItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(this.btnGiveTen,egret.TouchEvent.TOUCH_TAP,this.onBtnGiveTenTap,this)},e.prototype.onBtnConfirmTap=function(t){alien.Dispatcher.dispatch(EventNames.GIVE_ITEM,{treasure:this.data,count:1})},e.prototype.onBtnGiveTenTap=function(t){alien.Dispatcher.dispatch(EventNames.GIVE_ITEM,{treasure:this.data,count:10})},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.metaId,n=e.index,r=e.target,o=e.type,s=GameConfig.getItemMeta(i),a=r instanceof MinisterEntity;this.currentState=a?"minister":"princess";var c=a?MinisterEntity:PrincessEntity,l=a?lang.minister_info_fields:lang.princess_info_fields,p=c.abilityClassifyFields[o],h=packService.getCountByMetaId(i);if(this.itemView.metaId=i,this.labItemName.text=s.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[s.quality],this.labTotal.text=h.toString(),this.labEffect.text=l[p]+"+"+c.treasureValues[n],this.btnConfirm.enabled=h>0,this.btnGiveTen.enabled=h>=10,this.labCount.visible=a,this.labCountField.visible=a,a){var u=r.getGiveCount(o,n),_=MinisterEntity.abilityClassifyFields[r.meta.specialty_type-1]==p?2:1,d=_*r.level;this.labCount.text=u+"/"+d,this.btnConfirm.enabled=d>u&&h>0,this.btnGiveTen.enabled=d-10>=u&&h>=10}},e}(alien.VisualEventItemRenderer);__reflect(IRGiveItem.prototype,"IRGiveItem");var PanelItemDetails=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_item_details},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return this.skinName||(this.skinName=panels.PanelItemDetailsSkin),this.skinType=1,[4,this.popup()];case 1:return n.sent(),e=t.id,i=GameConfig.getItemMeta(e),this.itemView.metaId=e,this.labItemName.text=i.name,i.name.length>=6?this.labItemName.size=23:this.labItemName.size=25,this.labItemName.textColor=GameConfig.QUALITY_COLORS[i.quality],this.labIntro.text=i.intro,this.scroller.viewport.scrollV=0,[2]}})})},e}(CommonPanelBase);__reflect(PanelItemDetails.prototype,"PanelItemDetails");var PanelItemUpgrade=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ministerId="",e.materialLimit=100,e.pf=function(t,i){return e.nextLevel?e.item.exp+e.addition+"/"+i:lang.full_level},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_item_upgrade},e.prototype.getResGroupNames=function(){return["item_upgrade"]},e.prototype.getSkinName=function(){return panels.PanelItemUpgradeSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.progressBar.labelFunction=this.pf,this.list.dataProvider=this.dataProvider=new eui.ArrayCollection,this.list.itemRenderer=IRItemUpgrade,this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectItemChange,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItemChanging,this),this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(this.grpQuickSelect,egret.TouchEvent.TOUCH_TAP,this.onGrpQuickSelect,this),this.registerEvent(gameServer,protocols.WC_EquipStrengthen_Response,this.onItemUpgradeResponse,this),this.btnConfirm.enabled=!1},e.prototype.updateUI=function(t){var e=this;void 0===t&&(t=!0);var i=this.item,n=packService.getItemsByTypes(GameConfig.upgradeItemSourceTypes);n=n.filter(function(t){return t.id!=e.item.id}).sort(function(t,e){var i=18==t.meta.type?1:0,n=18==e.meta.type?1:0;return i==n?t.meta.quality==e.meta.quality?e.level==t.level?e.meta.order-t.meta.order:t.level-e.level:t.meta.quality-e.meta.quality:n-i}),this.dataProvider.source=n,this.list.selectedIndices=[],this.addition=0;var r;if(this.additionLevel>0)return r=(this.progressBar.maximum-this.progressBar.value)/this.progressBar.maximum*1e3,this.progressBar.slideDuration=r,this.progressBar.value=this.progressBar.maximum,void egret.setTimeout(function(){this.progressBar.slideDuration=0,this.progressBar.value=0,this.additionLevel=0,this.updateUI()},this,r);this.itemView.setItemData(i),this.labItemName.text=i.meta.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[i.meta.quality];var o=this.nextLevel=GameConfig.getItemLevelMeta(i.meta.id,i.level+1);o?(this.progressBar.maximum=o.exp_cost,this.progressBar.slideDuration=t?(this.progressBar.maximum-this.progressBar.value)/this.progressBar.maximum*1e3:0,this.progressBar.value=i.exp):(this.progressBar.slideDuration=0,this.progressBar.value=this.progressBar.maximum=100),this.labLevel.text=i.level+"/10",this.lebEffect.text=alien.StringUtils.join(packService.getItemEffect(i.metaId,i.level+1,null),",",2),alien.Utils.enumChildren(this.grpQuickSelect,function(t){t.selected=!1}),this.updateAddition()},e.prototype.onItemUpgradeResponse=function(t){this.updateUI()},e.prototype.onSelectItemChange=function(t){void 0===t&&(t=null),this.addition=this.list.selectedItems.reduce(function(t,e){return t+GameConfig.getItemLevelMeta(e.meta.id,e.level).exp_export},0),this.updateAddition()},e.prototype.onSelectItemChanging=function(t){this.list.selectedItems.length>100&&(t.preventDefault(),this.showTooManyMeterial())},e.prototype.onBtnConfirmTap=function(t){var e=this;if(this.addition>0){var i=GameConfig.getItemLevelMeta(this.item.meta.id,this.item.level+2);this.item.exp+this.addition>this.progressBar.maximum&&!i?Alert.show(lang.upgrade_treasure_tip,1,function(t){"confirm"==t.name&&packService.itemUpgrade(e.item.id,e.ministerId,e.list.selectedItems.map(function(t){return t.id}))}):packService.itemUpgrade(this.item.id,this.ministerId,this.list.selectedItems.map(function(t){return t.id}))}},e.prototype.onGrpQuickSelect=function(t){var e=this,i=[];alien.Utils.enumChildren(this.grpQuickSelect,function(t){t.selected&&i.push(parseInt(t.name))});var n=[],r=this.dataProvider.source;r.some(function(t,r){return n.length>=e.materialLimit?!0:void(i.indexOf(t.meta.quality)>=0&&n.push(r))}),this.list.selectedIndices=n,this.onSelectItemChange()},e.prototype.updateAddition=function(){this.labSelectCount.text=this.list.selectedItems.length+"/"+this.materialLimit;for(var t=this.item,e=t.meta.levels,i=0,n=this.item.exp+this.addition,r=t.level+1,o=e.length;o>r;r++){var s=e[r];if(!(n>=s.exp_cost))break;i++,n-=s.exp_cost}this.labAddLevel.text=0==i?"":"(+"+i+")",this.lebEffectNext.text=alien.StringUtils.join(packService.getItemEffect(t.metaId,t.level+1+(0==i?1:i),null),",",2)||lang.full_level,this.progressBar.additional=this.addition?this.addition:0,this.btnConfirm.enabled=this.nextLevel&&this.addition>0,this.additionLevel=i},e.prototype.showTooManyMeterial=function(){Toast.show({text:lang.too_many_material})},e.prototype.show=function(t,e){var i=t.item;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.item=i,t=ministerService.getMinisterByEquipId(i.id),this.ministerId=t?t.id:"",[4,this.popup()];case 1:return e.sent(),this.updateUI(!1),[2]}})})},e}(CommonPanelBase);__reflect(PanelItemUpgrade.prototype,"PanelItemUpgrade");var IRItemUpgrade=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.itemView.setItemData(e)},e}(alien.VisualEventItemRenderer);__reflect(IRItemUpgrade.prototype,"IRItemUpgrade");var PanelLimitActivity=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._type=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["activity"]},e.prototype.getSkinName=function(){return panels.PanelLimitActivitySkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(alien.Dispatcher,EventNames.BACK_ACTIVITY,this.onBackActivity,this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_BANNER,this.onSelectBanner,this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.vsDetails.setup({def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList},{def:ActLimitRewardList})},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this._dataProvider.source=activityService.getActivityByTypeList(activityService.limitActTypeList)},e.prototype.close=function(){t.prototype.close.call(this),this.currentState="normal",this.switchState()},e.prototype.onSelectBanner=function(t){this._type=t.data.type;var e=ActivityEntity.getActivityConfigByType(this._type).btnState;this.currentState=e,this.btnCommon.label=lang.activity_btn_name[this._type];var i=ActivityEntity.getActivityConfigByType(this._type).index;this.vsDetails.setSelectedIndex(i,{type:t.data.type}),this.switchState()},e.prototype.onGrpButtonsTap=function(t){switch(t.target.name){case"back":this.currentState="normal",this.switchState()}},e.prototype.onBackActivity=function(t){this.currentState="normal",this.switchState()},e.prototype.switchState=function(){"normal"==this.currentState?(this.grpDesc.visible=!0,this.grpDetails.visible=!1):(this.grpDetails.visible=!0,this.grpDesc.visible=!1);var t=activityService.getActivityByType(this._type);t&&(this.labName.text=lang.activity_name[t.type],this.labTime.textFlow=activityService.getActTime(t.end_time))},e}(PanelBase);__reflect(PanelLimitActivity.prototype,"PanelLimitActivity");var ActLimitItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cdId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnEnter,egret.TouchEvent.TOUCH_TAP,this.onBtnEnterTap,this)},e.prototype.setData=function(t){this.data=t;var e=t,i=ActivityEntity.getActivityConfigByType(this.data.type);this.badgeView.bid=i.badgeId+"",this.labTitle.text=lang.activity_name[e.type];var n=new Date(1e3*e.begin_time),r=new Date(1e3*e.end_time);this.labDate.text=alien.TimeUtils.dateToString(n,"{1}月{2}日")+"~"+alien.TimeUtils.dateToString(r,"{1}月{2}日"),e.end_time-mainService.tsServer>0&&(this._cdId&&countDownService.unregister(this._cdId),this._cdId=countDownService.register(e.end_time,this.onSecond.bind(this)))},e.prototype.onBtnEnterTap=function(t){alien.Dispatcher.dispatch(EventNames.SELECT_BANNER,this.data)},e.prototype.onSecond=function(t){return 0>=t?(this.btnEnter.enabled=!1,countDownService.unregister(this._cdId),this._cdId=0,void(this.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))):void(t>86400?this.labTime.text=alien.TimeUtils.timeFormat(t,"{3}:{2}:{1}:{0}"):this.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this._cdId&&countDownService.unregister(this._cdId)},e}(alien.VisualEventItemRenderer);__reflect(ActLimitItem.prototype,"ActLimitItem");var PanelMemorial=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._reward=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.imgBody.mask=this.bodyMask,this.list.itemRenderer=IRMemorialOption,this.list.dataProvider=this._optionDataProvider=new eui.ArrayCollection,this.listContent0.dataProvider=this._content0=new eui.ArrayCollection,this.listContent1.dataProvider=this._content1=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectOption,this),this.registerEvent(gameServer,protocols.WC_READ_APPLY_Response,this.onOperateResponse,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r,o;return __generator(this,function(s){switch(s.label){case 0:return this.skinName||(this.skinName=panels.PanelMemorialSkin),[4,this.popup()];case 1:return s.sent(),this.imgSeal.visible=!1,this.list.visible=!0,this.memorial=t,e=GameConfig.getMemorialMeta(t["int"]),i=e.intro.split(","),this._content0.source=alien.StringUtils.splitBySize(i[0],7),this._content1.source=alien.StringUtils.splitBySize(i[1],7),n=ministerService.getMinisterById(t.str),r=n.meta,this.labMinisterName.text=r.name,this.labMinisterName.textColor=GameConfig.QUALITY_COLORS[r.quality],this.imgBody.source=n.bodyUrl,o=150,this.imgBody.x=o-.8*n.meta.body_offset.x,this.imgBody.y=150-.8*n.meta.body_offset.y,packService.newTreasure.splice(0),this._optionDataProvider.source=[{operate:1,effect:e.effects[0],minister:n},{operate:2,effect:e.effects[1],minister:n}],SoundManager.instance.playEffect("effect_memorial_"+r.type),[2]}})})},e.prototype.playSeal=function(){var t=this,e=this.imgSeal;e.visible=!0,e.alpha=0,e.scaleX=e.scaleY=10,egret.Tween.get(e).to({scaleX:1,scaleY:1,alpha:1},600,egret.Ease.backIn).call(function(){SoundManager.instance.playEffect(ResNames.sound_take_seal)}).wait(1e3).call(function(){var e=ministerService.getMinisterById(t.memorial.str),i=GameConfig.getMemorialMeta(t.memorial["int"]),n=i.effects[t.operate-1];7!==n?(alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:e.getMemorialEffectStr(n),y:600}),alien.EgretUtils.callLater(t.dealAction,20)):PanelWorkFinish.instance.show({type:2,reward:t._reward,princessEffect:null},function(){packService.newTreasure.splice(0),t._reward.splice(0),t.dealAction()})})},e.prototype.onSelectOption=function(t){switch(t.preventDefault(),this.list.selectedItem.operate){case 0:this.dealAction();break;case 1:memorialService.operate(this.memorial.id,!0);break;case 2:memorialService.operate(this.memorial.id,!1)}this.operate=this.list.selectedItem.operate},e.prototype.onOperateResponse=function(t){0==t.data.error&&(this.list.visible=!1,this.playSeal())},e.prototype.onUpdateItem=function(t){var e=t.data.item,i={id:e.meta.id,count:0};e.fieldsModified.some(function(t){return"count"==t.field&&t.value>t.oldValue?(i.count+=t.value-t.oldValue,t.oldValue=t.value,!0):void 0}),this._reward.push(i)},e}(PanelBase);__reflect(PanelMemorial.prototype,"PanelMemorial");var IRMemorialOption=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var i=this.data.operate;if(0==i);else{var n=this.data,r=n.effect,o=n.minister;this.label.textColor=e.colors[i],this.imgOption.source="memorial_option_"+i,this.label.text=o.getMemorialEffectStr(r)}},e.colors=[GameConfig.QUALITY_COLORS[0],GameConfig.QUALITY_COLORS[1],GameConfig.QUALITY_COLORS[4]],e}(eui.ItemRenderer);__reflect(IRMemorialOption.prototype,"IRMemorialOption");var PanelNationalPower=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.title=lang.national_power},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelNationalPowerSkin),[4,this.popup()];case 1:return t.sent(),this.labArea.text=mainService.playerInfo.area+"",this._dataProvider.source=MainService.nationalPowerClassify,this.labAll.text=lang.national_strength+":"+mainService.getAllSum(),this.label.text=mainService.playerInfo.harem,this._warehouseDataProvider.refresh(),this._militaryDataProvider.refresh(),[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRNationalPropsClassify,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.listWarehouse.itemRenderer=IRNaitonalPowerProps,this.listWarehouse.dataProvider=this._warehouseDataProvider=new eui.ArrayCollection(MainService.nationalPowerWarehouse),this.listMilitary.itemRenderer=IRNaitonalPowerProps,this.listMilitary.dataProvider=this._militaryDataProvider=new eui.ArrayCollection(MainService.nationalPowerMilitary)},e}(CommonPanelBase);__reflect(PanelNationalPower.prototype,"PanelNationalPower");var IRNationalPropsClassify=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRNationalPropsField,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.dataChanged=function(){var e=this;t.prototype.dataChanged.call(this),this.label.text=mainService.getClassifySum(this.data).toString(),this.imgIcon.source="icon_"+this.data,this.imgType.source="common_img_"+this.data,this.labSpeed.text=interiorService.getDevelopmentSpeed(this.data)+"/"+lang.impose;var i=MainService.nationalPowerFields.map(function(t){return{field:t,classify:e.data}});this._dataProvider.source=i},e}(eui.ItemRenderer);__reflect(IRNationalPropsClassify.prototype,"IRNationalPropsClassify");var IRNationalPropsField=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.field,n=e.classify,r=lang.country_props_fields[i];if("minister"==i){var o=MinisterEntity.abilityClassifyFields[MainService.nationalPowerClassify.indexOf(n)];r+=lang.minister_info_fields[o]}else if("prince"==i){var s=PrinceEntity.fields[MainService.nationalPowerClassify.indexOf(n)];r+=lang.minister_info_fields[s]}this.label.text=r+":"+mainService.getNationPowerField(i,n)},e}(eui.ItemRenderer);__reflect(IRNationalPropsField.prototype,"IRNationalPropsField");var IRNaitonalPowerProps=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.imgIcon.source="icon_"+e,this.labName.text=lang.national_power_props[e]+":",this.labValue.text=mainService.playerInfo[e]},e}(eui.ItemRenderer);__reflect(IRNaitonalPowerProps.prototype,"IRNaitonalPowerProps");var PanelNewOpen=function(t){function e(){var e=t.call(this,alien.popupEffect.None,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e.playing=!1,e._configs=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grpAll.mask=this.contentMask,this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this),this.list.itemRenderer=IRNewOpen,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.onTap=function(t){this.dealAction()},e.prototype.onBtnGoTap=function(t){this._hasGuide?(!this._callback&&this._configs[0]&&openService.goGoal(this._configs[0]),this.dealAction("goto")):this.dealAction()},e.prototype.getResGroupNames=function(){return["open"]},e.prototype.getSkinName=function(){this.skinName=panels.PanelNewOpenSkin},e.prototype.show=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this._callback=e,this._configs=t,this._countryId=i,[4,this.popup()];case 1:return n.sent(),this.update(),this.play(),[2]}})})},e.prototype.update=function(){var t=this._hasGuide=GuideLayer.instance.getGuideID("country_get_"+this._countryId)>=0;this.btnGo.label=lang.new_open_panel_btn[t?1:0],this._dataProvider.source=this._configs,this.labDesc.text=this._configs.map(function(t){return lang.open_name[t.id].desc}).join("\n")},e.prototype.play=function(){this.playing=!0,this.contentMask.y=5,this.contentMask.height=0,this.contentMask.visible=!1,this.imgDown.bottom=341,this.btnGo.touchEnabled=!1,this.imgTitle.horizontalCenter=-1e3,this.grpContent.alpha=0,egret.Tween.get(this.contentMask).to({y:0,height:364},1e3,egret.Ease.cubicInOut).call(this.playTitle,this),egret.Tween.get(this.imgDown).to({bottom:0},1e3,egret.Ease.cubicInOut)},e.prototype.playTitle=function(){var t=this;egret.Tween.get(this.imgTitle).to({horizontalCenter:0},500,egret.Ease.backIn).call(function(){t.playEffect(),t.playing=!1,t.contentMask.visible=!0,t.btnGo.touchEnabled=!0,alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"country_get_"+t._countryId})}),egret.Tween.get(this.grpContent).to({alpha:1},500,egret.Ease.sineIn)},e.prototype.playEffect=function(){this.effect.movieClip.gotoAndPlay(1,1)},e.prototype.close=function(){this.playing||t.prototype.close.call(this)},e}(PanelBase);__reflect(PanelNewOpen.prototype,"PanelNewOpen");var IRNewOpen=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.imgIcon.source="open_icon_"+e.id,this.labName.text=lang.open_name[e.id].name},e}(alien.VisualEventItemRenderer);__reflect(IRNewOpen.prototype,"IRNewOpen");var IROpenDesc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labDesc.text=lang.open_name[e.id].desc},e}(alien.VisualEventItemRenderer);__reflect(IROpenDesc.prototype,"IROpenDesc");var PanelNotice=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["notice"]},e.prototype.getSkinName=function(){return panels.PanelNoticeSkin},e.prototype.init=function(){},e.prototype._show=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return i=t.list,this.listData=i,[4,this.popup(this.dealAction)];case 1:return n.sent(),this.tabScroller.viewport.scrollH=0,this.contentScroller.viewport.scrollH=0,this.tabProvider.source=i,this.tabBar.selectedIndex=e,this.showIndex(e),[2]}})})},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.tabBar.itemRenderer=IRNoticeTab,this.tabBar.dataProvider=this.tabProvider=new eui.ArrayCollection,this.list.itemRenderer=IRNoticeContent,this.list.dataProvider=this.dataProvider=new eui.ArrayCollection,this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabChange,this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.onTabChange=function(t){this.showIndex(this.tabBar.selectedIndex)},e.prototype.showIndex=function(t){var e=this.listData[t].notices;this.currentState=e.length>0?"normal":"empty",e.length>0&&(this.dataProvider.source=e)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,webService.getNoticeList()];case 1:return t=i.sent(),e=-1,t.list.some(function(t,i){return t.notices.length>0?(e=i,!0):void 0}),e>=0&&this._show(t,e),[2]}})})},e}(alien.PopupBase);__reflect(PanelNotice.prototype,"PanelNotice");var IRNoticeTab=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labelDisplay.text=this.data.name},e}(eui.ItemRenderer);__reflect(IRNoticeTab.prototype,"IRNoticeTab");var IRNoticeContent=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.title,n=e.content;this.labTitle.text="【"+i+"】",this.labContent.textFlow=alien.Utils.parseHtmlText(n)},e}(eui.ItemRenderer);__reflect(IRNoticeContent.prototype,"IRNoticeContent");var PanelPeerage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(gameServer,protocols.WC_CARD_UPLVLIMIT_Response,this.onPeerageResponse,this)},e.prototype.init=function(){this.title=lang.panel_peerage},e.prototype.show=function(t,e){var i=t.minister;return __awaiter(this,void 0,void 0,function(){var t,n,r,o;return __generator(this,function(s){switch(s.label){case 0:return this.skinName||(this.skinName=panels.PanelPeerageSkin),this.minister=i,[4,this.popup(e)];
case 1:return s.sent(),t=i.meta,n=i.level,r=GameConfig.getPeerageMetaByLevel(n),o=n>100?r.qualification-GameConfig.getPeerageMetaByLevel(n-1).qualification:r.qualification,this.avatar.id=t.icon,this.labName.text=t.name,this.labName.textColor=GameConfig.QUALITY_COLORS[t.quality],this.labPeerage.text=r.name,this.sourceItemList.setItems(r.condition),this.labEffect.text=lang.format(lang.level_upper,r.level+50)+"\n"+lang.format(lang.qualification_addition,o),[2]}})})},e.prototype.onBtnConfirmTap=function(t){ministerService.peerage(this.minister)},e.prototype.onPeerageResponse=function(t){0==t.data.error&&this.dealAction("success")},e}(CommonPanelBase);__reflect(PanelPeerage.prototype,"PanelPeerage");var PanelPlayerInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPlayerInfo,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.init=function(){this.title=lang.panel_player_info},e.prototype.getSkinName=function(){return panels.PanelPlayerInfoSkin},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){},e}(CommonPanelBase);__reflect(PanelPlayerInfo.prototype,"PanelPlayerInfo");var IRPlayerInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this)},e}(eui.ItemRenderer);__reflect(IRPlayerInfo.prototype,"IRPlayerInfo");var PanelPreferential=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["preferential","activity"]},e.prototype.getSkinName=function(){return panels.PanelPreferentialSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onSelectTab,this),this.vs.setup({def:PreferentialView},{def:PreferentialView})},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=ActivityEntity.ACTIVITY.TYPE_CHARGE_8,e=egret.setInterval(function(){activityService.getActivity(t),t++,t>ActivityEntity.ACTIVITY.TYPE_CHARGE_128&&egret.clearInterval(e)},this,20),[4,this.popup()];case 1:return i.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.tabBar.selectedIndex=0,this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this.tabBar.selectedIndex},!1)},e.prototype.onSelectTab=function(t){this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this.tabBar.selectedIndex},!1)},e}(alien.PopupBase);__reflect(PanelPreferential.prototype,"PanelPreferential");var IRPreferentialTab=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!1},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="preferential_tab_"+this.data.icon,this.ani.aniName="preferential_tab_"+this.itemIndex},e.prototype.commitProperties=function(){var e=this.$Component[4];t.prototype.commitProperties.call(this);try{e&&wsy.Utils.updateAllImages(this)}catch(i){}},e}(alien.VisualEventItemRenderer);__reflect(IRPreferentialTab.prototype,"IRPreferentialTab");var PanelPrinceBorn=function(t){function e(){var e=t.call(this,alien.popupEffect.None,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._flag=!1,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.prototype.init.call(this)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this.btnSure,egret.TouchEvent.TOUCH_TAP,this.onBtnSureTap,this),this.registerEvent(this.btnDice,egret.TouchEvent.TOUCH_TAP,this.onBtnDiceTap,this),this.registerEvent(this,egret.Event.REMOVED_FROM_STAGE,this.onRemoveStage,this),this.registerEvent(gameServer,protocols.WC_PRICESS_RENAME_RESPONSE,this.onRenameResponse,this),this.registerEvent(this.btnWatch,egret.TouchEvent.TOUCH_TAP,this.onBtnWatchTap,this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.show=function(t){var e=t.prince;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelPrinceBornSkin),this.grpContent.mask=this.contentMask,[4,this.popup()];case 1:return i.sent(),this.prince=e,t=princessService.getById(this.prince.princessId),this.labName.text=t.meta.name,this.tiName.text=GameConfig.princeRandomName(),this.imgQuality.source="princess_choose_quality_"+e.quality,this._flag=!1,this.currentState="normal",[2]}})})},e.prototype.popup=function(e,i,n){return void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.popup.call(this,e,i,n)];case 1:return r.sent(),this.play(),[2]}})})},e.prototype.onRemoveStage=function(t){this.tiName.text=""},e.prototype.onBtnSureTap=function(t){var e=GameConfig.judgeString(this.tiName.text);e?princeService.rename(this.prince.id,this.tiName.text):Toast.show({text:lang.input_error})},e.prototype.onBtnWatchTap=function(t){PanelPrincessTurnCard.instance.close(),PanelPrincessImage.instance.close(),SceneController.replace(ConstantNames.SCENE_PRINCE),this.close()},e.prototype.onTap=function(t){return this._flag?void this.close():void 0},e.prototype.onRenameResponse=function(t){0==t.data.error&&(this._flag=!0,Toast.show({text:lang.prince_rename_success}),this.currentState="go")},e.prototype.onBtnDiceTap=function(t){this.tiName.text=GameConfig.princeRandomName()},e.prototype.play=function(){this.contentMask.width=0,this.imgRight.x=0,egret.Tween.get(this.contentMask).to({width:649},1e3,egret.Ease.cubicInOut).call(function(){this.grpContent.mask=null},this),egret.Tween.get(this.imgRight).to({x:670.76},1e3,egret.Ease.cubicInOut)},e}(PanelBase);__reflect(PanelPrinceBorn.prototype,"PanelPrinceBorn");var PanelQuickMemorial=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.listReward.itemRenderer=IRWithItemView,this.listReward.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){this.dealAction()},e.prototype.show=function(t,e){var i=t.text,n=t.reward,r=void 0===n?null:n;return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelQuickMemorialSkin),this._callback=e,[4,this.popup(this.dealAction)];case 1:return t.sent(),this.currentState=r?"with_reward":"normal","string"==typeof i?this.labContent.text=i:this.labContent.textFlow=i,r&&(this._dataProvider.source=r),[2]}})})},e}(PanelBase);__reflect(PanelQuickMemorial.prototype,"PanelQuickMemorial");var PanelRank=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getResGroupNames=function(){return["rank"]},e.prototype.getSkinName=function(){return panels.PanelRankSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabBar.dataProvider=new eui.ArrayCollection(GameConfig.panelRankTabs),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(this.btnWorship,egret.TouchEvent.TOUCH_TAP,this.onBtnWorshipTap,this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelected,this),this.registerEvent(rankService,EventNames.UPDATE_RANK_WORSHIP,this.onUpdateRankWorship,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPlayerPropsModified,this),this.registerEvent(gameServer,protocols.WC_UPTOP_RESPONSE,this.onUpTopResponse,this),this.vs.setup({def:RankList,param:{type:0}},{def:RankList,param:{type:1}},{def:RankList,param:{type:2}},{def:RankList,param:{type:3}})},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),this.tabBar.selectedIndex=0,this.vs.setSelectedIndex(0,{type:this.tabBar.selectedIndex},!0);var e=RankList.RankTypeMap[this.tabBar.selectedIndex];this.btnWorship.enabled=rankService.getWorshipStateByType(e)},e.prototype.onBtnWorshipTap=function(t){var e=RankList.RankTypeMap[this.tabBar.selectedIndex];rankService.upTop(e)},e.prototype.onTabSelected=function(t){this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this.tabBar.selectedIndex},!0);var e=RankList.RankTypeMap[this.tabBar.selectedIndex];this.btnWorship.enabled=rankService.getWorshipStateByType(e)},e.prototype.onUpdateRankWorship=function(t){var e=RankList.RankTypeMap[this.tabBar.selectedIndex];this.btnWorship.enabled=rankService.getWorshipStateByType(e)},e.prototype.onPlayerPropsModified=function(t){var e=(this.btnWorship,t.data),i=e.field,n=e.value,r=e.oldValue;"gold"==i&&n>r&&PanelRankWorship.instance.show({count:n-r,icon:this._worshipData.icon,name:this._worshipData.name})},e.prototype.onUpTopResponse=function(t){0==t.data.error&&(this._worshipData=t.data)},e}(PanelBase);__reflect(PanelRank.prototype,"PanelRank");var PanelRankWorship=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._timer=0,e.onTimer=function(){e.labContent.text=lang.rank_worship_content.substring(0,e.labContent.text.length+1),e.labContent.text.length>=lang.rank_worship_content.length&&(egret.clearInterval(e._timer),e._timer=0)},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.show=function(t){var e=t.count,i=t.icon,n=t.name;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._count=e,this.skinName||(this.skinName=panels.PanelRankWorshipSkin),this.update(i,n),[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.update=function(t,e){var i=[[1001,1002,1003,1004,1005],[2001,2002,2003,2004,2005]],n=0;i[0].indexOf(t)>=0?n=0:i[1].indexOf(t)>=0?n=1:(t=1001,n=0),this.faceBody.changeSex(n),this.faceBody.setFace(t),this.labName.text=e},e.prototype.active=function(){t.prototype.active.call(this),this._timer=egret.setInterval(this.onTimer,this,200)},e.prototype.close=function(){t.prototype.close.call(this),this.labContent.text="",this.grpGold.visible=!1,egret.Tween.removeTweens(this.grpGold)},e.prototype.onTap=function(t){if(this._timer)this.labContent.text=lang.rank_worship_content,egret.clearInterval(this._timer),this._timer=0;else if(this.grpGold.visible)this.close();else{var e=this.grpName;alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION_IMAGE,{id:1,value:this._count,component:e}),this.grpGold.alpha=0,this.grpGold.visible=!0,this.labGold.text="+"+this._count,egret.Tween.get(this.grpGold).to({alpha:1},200)}},e}(PanelBase);__reflect(PanelRankWorship.prototype,"PanelRankWorship");var PanelRuleIntro=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRRoleIntro,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.init=function(){this.title=lang.panel_rule_intro},e.prototype.getSkinName=function(){return panels.PanelRuleIntroSkin},e.prototype.show=function(t){var e=t.contents;t.type;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this._dataProvider.source=e,[2]}})})},e}(CommonPanelBase);__reflect(PanelRuleIntro.prototype,"PanelRuleIntro");var IRRoleIntro=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data.title?(this.currentState="title",this.labTitle.text=this.data.title+":"):this.currentState="normal",this.labContent.text=this.data.content},e}(eui.ItemRenderer);__reflect(IRRoleIntro.prototype,"IRRoleIntro");var PanelRuleIntro2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRRoleIntro,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.init=function(){this.title=lang.panel_rule_intro},e.prototype.getSkinName=function(){return panels.PanelRuleIntro2Skin},e.prototype.show=function(t){var e=t.contents;t.type;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinType=3,[4,this.popup()];case 1:return t.sent(),this._dataProvider.source=e,[2]}})})},e}(CommonPanelBase);__reflect(PanelRuleIntro2.prototype,"PanelRuleIntro2");var PanelSelectFlower=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._flowerList=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRSelectFlower;for(var e in GameConfig.flowers)this._flowerList.push(GameConfig.getFlowerMeta(e));this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this._flowerList),this.registerEvent(alien.Dispatcher,EventNames.SELECT_FLOWER,this.onSelectFlower,this)},e.prototype.init=function(){this.title=lang.panel_select_flower},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelSelectFlowerSkin),[4,this.popup(t)];case 1:return e.sent(),this.update(),[2]}})})},e.prototype.update=function(){this._dataProvider.refresh()},e.prototype.onSelectFlower=function(t){this.dealAction("select",t.data)},e}(CommonPanelBase);__reflect(PanelSelectFlower.prototype,"PanelSelectFlower");var IRSelectFlower=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSelect,egret.TouchEvent.TOUCH_TAP,this.onBtnSelectClick,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=GameConfig.getItemMeta(this.data.id);this.itemView.metaId=e.id,this.itemView.hideCount=!0,this.labFlowerName.text=i.name,this.labFlowerName.textColor=GameConfig.QUALITY_COLORS[i.quality],this.labCharm.text=e.need_charm+"",this.labTime.text=e.cost_time+lang.minutes,this.labCount.text=packService.getCountByMetaId(i.id)+""},e.prototype.onBtnSelectClick=function(t){alien.Dispatcher.dispatch(EventNames.SELECT_FLOWER,{flower:this.data})},e}(alien.VisualEventItemRenderer);__reflect(IRSelectFlower.prototype,"IRSelectFlower");var PanelSelectItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRGiveItem,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.init=function(){this.title=lang.panel_give_normal_item},e.prototype.show=function(t){var e=t.types,i=t.target,n=t.items;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return this.skinName||(this.skinName=panels.PanelSelectItemSkin),[4,this.popup()];case 1:return r.sent(),t=[],e.forEach(function(e){n.forEach(function(n,r){t.push({metaId:n[e],index:r,type:e,target:i})})}),this._dataProvider.source=t.reverse(),this.updateUI(),[2]}})})},e.prototype.updateUI=function(){this._dataProvider.refresh()},e}(CommonPanelBase);__reflect(PanelSelectItem.prototype,"PanelSelectItem");var PanelSelectPrincess=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRSelectPrincess,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(alien.Dispatcher,EventNames.SELECT_PRINCESS,this.onSelectPrincess,this)},e.prototype.onSelectPrincess=function(t){this.dealAction("select",t.data),SoundManager.instance.playEffect(ResNames.effect_princess_confirm)},e.prototype.init=function(){this.title=lang.panel_select_princess},e.prototype.updateUI=function(){var t=this._filter?princessService.princesses.filter(this._filter):princessService.princesses;this.currentState=t.length>0?"normal":"empty",t.length>0&&(this._dataProvider.source=t)},e.prototype.show=function(t,i){var n=t.filter,r=t.field;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelSelectPrincessSkin),[4,this.popup(i)];case 1:return t.sent(),this._filter=n,e.field=r,this.updateUI(),[2]}})})},e.prototype.onClose=function(){t.prototype.onClose.call(this)},e}(CommonPanelBase);__reflect(PanelSelectPrincess.prototype,"PanelSelectPrincess");var IRSelectPrincess=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.registerEvent(this.btnOperate,egret.TouchEvent.TOUCH_TAP,this.onBtnOperateTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgBg.source=PrincessEntity.parseBgUrl(this.itemIndex);var e=this.data,i=e.meta,n=PanelSelectPrincess.field,r=this.imgBody;this.labName.text=i.name,r.source=e.bodyUrl,r.x=220-i.body_offset.x*r.scaleX,r.y=20-i.body_offset.y*r.scaleY,"all_round_ability"==n?this.labProp.text=lang.princess_info_fields[n]+":"+e.getAllRounAbility():this.labProp.text=lang.princess_info_fields[n]+":"+e[n],this.labProp.textColor=GameConfig.PRINCESS_FIELD_COLORS[n]},e.prototype.onBtnOperateTap=function(t){alien.Dispatcher.dispatch(EventNames.SELECT_PRINCESS,{princess:this.data})},e}(alien.VisualEventItemRenderer);__reflect(IRSelectPrincess.prototype,"IRSelectPrincess");var PanelServerList=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listGroup.itemRenderer=IRGroup,this.listServer.itemRenderer=IRWithItemView,this.listGroup.dataProvider=this.groupDataProvider=new eui.ArrayCollection,this.listServer.dataProvider=this.serverDataProvider=new eui.ArrayCollection,this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(this.lastServerItem,egret.TouchEvent.TOUCH_TAP,this.onLastServerItemTap,this),this.registerEvent(this.listGroup,egret.Event.CHANGE,this.onGroupSelect,this),this.registerEvent(this.listServer,egret.Event.CHANGING,this.onServerSelect,this)},e.prototype.init=function(){},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelServerListSkin),this._callback=e,[4,this.popup()];case 1:return t.sent(),this.lastServer=mainService.getServerById(dataCenterService.lastServer),this.lastServer?this.lastServerItem.setData(this.lastServer):this.lastServerItem.clean(),this.groupDataProvider.source=mainService.getServerGroups(),this.selectGroup(this.listGroup.selectedIndex=0),[2]}})})},e.prototype.selectGroup=function(t){var e=this.groupDataProvider.source[t];this.serverDataProvider.source=e.servers},e.prototype.onGroupSelect=function(t){this.selectGroup(this.listGroup.selectedIndex)},e.prototype.onServerSelect=function(t){t.preventDefault();var e=this.listServer.selectedItem;this.dealServer(e)},e.prototype.onLastServerItemTap=function(t){this.lastServer&&this.dealServer(this.lastServer)},e.prototype.dealServer=function(t){t.status>1&&this.dealAction("select",{server:t})},e}(PanelBase);__reflect(PanelServerList.prototype,"PanelServerList");var IRGroup=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.index;this.label.text=10*e+1+"-"+(10*e+10)+lang.area},e}(eui.ItemRenderer);__reflect(IRGroup.prototype,"IRGroup");var PanelSetting=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),i=e,Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new i),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnLogout.visible=GameConfig.params?GameConfig.params.switchUserBtn:!1,this.settingsGame.itemRenderer=IRSettingItem,this.settingsGame.dataProvider=this._dataSettingGame=new eui.ArrayCollection(lang.setting_game_items),this.settingsNotify.itemRenderer=IRSettingItem,this.settingsNotify.dataProvider=this._dataSettingNotify=new eui.ArrayCollection(lang.setting_notify_items),this.registerEvent(this.btnSwitch,egret.TouchEvent.TOUCH_TAP,this.onBtnSwitchTap,this),this.registerEvent(this.btnLogout,egret.TouchEvent.TOUCH_TAP,this.onBtnLogoutTap,this),this.registerEvent(dataCenterService,EventNames.SETTING_CHANGED,this.onSettingChanged,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPropsModified,this),this.registerEvent(this.btnExchange,egret.TouchEvent.TOUCH_TAP,this.onBtnExchangeTap,this)},e.prototype.init=function(){this.title=lang.setting},e.prototype.updateUI=function(){this._dataSettingGame.refresh(),this._dataSettingNotify.refresh(),this.labName.text=mainService.playerBaseInfo.name,this.labId.text=mainService.playerBaseInfo.id+"";var t=mainService.getLastServer(),e=t.num,i=t.alias;this.labArea.text=lang.format(lang.area_close,e)+" "+i,this.playerIcon.setPlayer(mainService.playerInfo.chat_icon),this.labVersion.text="v:"+version},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelSettingSkin),[4,this.popup()];case 1:return t.sent(),this.updateUI(),[2]}})})},e.prototype.onBtnSwitchTap=function(t){MainStage.instance.logout({selectServer:!0}),this.dealAction()},e.prototype.onBtnLogoutTap=function(t){MainStage.instance.logout(),this.dealAction()},e.prototype.onSettingChanged=function(t){switch(t.data.field){case"music":SoundManager.instance.switchMusic();break;case"effect":SoundManager.instance.switchEffect()}},e.prototype.onPlayerIconTap=function(t){PanelChangeIcon.instance.show()},e.prototype.onPropsModified=function(t){this.playerIcon.setPlayer(mainService.playerInfo.chat_icon)},e.prototype.onBtnExchangeTap=function(t){PanelCDKey.instance.show()},e=i=__decorate([modifyChild],e);var i}(CommonPanelBase);__reflect(PanelSetting.prototype,"PanelSetting");var IRSettingItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.toggle,egret.Event.CHANGE,this.onChange,this)},e.prototype.onChange=function(t){var e=this.data,i=e.field;e.value;dataCenterService.switchSettingItem(i)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.name,n=e.field;e.value;this.labName.text=i,this.toggle.selected=!dataCenterService.getSettingItem(n)},e}(alien.VisualEventItemRenderer);__reflect(IRSettingItem.prototype,"IRSettingItem");var PanelShop=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._tabBar=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.getSkinName=function(){return panels.PanelShopSkin},e.prototype.getResGroupNames=function(){return["shop"]},e.prototype.show=function(t){return void 0===t&&(t=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this._tabBar=t,[4,this.popup()];case 1:return e.sent(),[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabBar.itemRenderer=IRShopTabButton,this.tabBar.dataProvider=new eui.ArrayCollection(GameConfig.shopTabs),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PLAYERINFO_NOTIFY,this.onUpdatePlayerInfoNotify,this),this.registerEvent(this.btnCharge,egret.TouchEvent.TOUCH_TAP,this.onBtnChargeTap,this),this.vs.setup({def:ShopItemList,param:{type:0}},{def:ShopGiftList,param:{type:0}},{def:ShopGoldList,param:{type:0}},{def:ShopVipList,param:{type:1}})},e.prototype.active=function(){t.prototype.active.call(this),this.tabBar.selectedIndex=this._tabBar,this.vs.setSelectedIndex(this._tabBar,null,!0),this.setTopGroup(),this.update()},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex,this.setTopGroup()},e.prototype.setTopGroup=function(){this.tabBar.selectedIndex<3?(this.grpGold.visible=!0,this.grpVip.visible=!1,this.vs.top=161):(this.grpGold.visible=!1,this.grpVip.visible=!0,this.vs.top=195)},e.prototype.onUpdatePlayerInfoNotify=function(t){this.update()},e.prototype.onBtnChargeTap=function(t){this.tabBar.selectedIndex=2,this.vs.setSelectedIndex(2,null,!0),this.setTopGroup()},e.prototype.update=function(){var t=mainService.playerInfo;this.labGold.text=t.gold.toString(),this.labSilver.text=t.silver.toString(),this.imgVip.source="lobby_vip_"+t.vip;var e=t.vip+1>PlayerEntity.getMaxVip()?PlayerEntity.getMaxVip():t.vip+1,i=GameConfig.getVipMeta(e);this.labNext.textFlow=lang.formatHtml(lang.vip_need_content,i.charge-t.charge,e),this.labNext.visible=e<PlayerEntity.getMaxVip(),this.progressBar.maximum=i.charge,this.progressBar.value=t.charge},e}(PanelBase);__reflect(PanelShop.prototype,"PanelShop");var IRShopTabButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.touchEnabled=!1,this.imgLabel.source=this.imgUp,this.badgeView.bid=this.data.badgeId},Object.defineProperty(e.prototype,"imgUp",{get:function(){return this.data?"shop_tab_label_"+this.data.icon+"_n":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imgDown",{get:function(){return this.data?"shop_tab_label_"+this.data.icon+"_h":""},enumerable:!0,configurable:!0}),e}(eui.ItemRenderer);__reflect(IRShopTabButton.prototype,"IRShopTabButton");var PanelShopBuyItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._type=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.title=lang.panel_buy_item,this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(this.slider,egret.Event.CHANGE,this.onChangeBuyCount,this),this.registerEvent(this.grpControl,egret.TouchEvent.TOUCH_TAP,this.onGrpControlTap,this)},e.prototype.onChangeBuyCount=function(t){switch(void 0===t&&(t=null),this._type){case e.BUY_TYPE.DEFAULT_SHOP:this.onChangeShop();break;case e.BUY_TYPE.CASH_SHOP:this.onChangCashGift();break;case e.BUY_TYPE.UNION_SHOP:this.onChangeUnionShop();break;case e.BUY_TYPE.INCENSE_EXCHANGE:this.onChangeIncenseExchange()}},e.prototype.onChangeShop=function(){var t=mainService.playerInfo.gold;switch(this.shopItem.sale_type){case 1:t=mainService.playerInfo.gold;break;case 4:t=mainService.playerInfo.silver}var e=Math.floor(t/this.shopItem.price)>100?100:Math.floor(t/this.shopItem.price),i=this.shopItem.limit_count>0?this.shopItem.limit_count-shopService.getBuyCnt(this.shopItem.sequence):e;this.slider.value>i&&(this.slider.value=i),this.slider.value<1&&(this.slider.value=this.slider.maximum<=0?0:1),this.labCount.text=this.slider.value+"/"+i,this.labCost.text=this.slider.value*this.shopItem.price*(this.shopItem.discount_value>0?this.shopItem.discount_value:10)/10+""},e.prototype.onBtnConfirmTap=function(t){this.dealAction("confirm",{seq:this.shopItem.sequence,id:this.shopItem.id,count:this.slider.value})},e.prototype.onGrpControlTap=function(t){var e=0;switch(t.target.name){case"increase":e=1;break;case"decrease":e=-1}this.slider.value+=e,this.onChangeBuyCount()},e.prototype.updateUI=function(){this.currentState="normal";var t=mainService.playerInfo.gold;switch(this.shopItem.sale_type){case 1:t=mainService.playerInfo.gold,this.imgIcon.source="icon_gold";break;case 4:t=mainService.playerInfo.silver,this.imgIcon.source="icon_silver"
}var e=Math.floor(t/this.shopItem.price)>100?100:Math.floor(t/this.shopItem.price),i=this.shopItem.limit_count>0?this.shopItem.limit_count-shopService.getBuyCnt(this.shopItem.sequence):e,n=GameConfig.getItemMeta(this.shopItem.id);this.itemView.metaId=n.id,this.slider.maximum=i,this.slider.minimum=0,this.slider.value=this.slider.maximum<=0?0:1,this.labItemName.text=n.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[n.quality],this.onChangeBuyCount(),this.labIntro.text=n.intro},e.prototype.updateCashGift=function(){this.currentState="normal",this.imgIcon.source="icon_cash_gift";var t=GameConfig.getItemMeta(this.shopItem.item_id);this.itemView.metaId=t.id,this.slider.maximum=this.shopItem.item_count,this.slider.minimum=0,this.slider.value=this.slider.maximum<=0?0:1,this.labItemName.text=t.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[t.quality],this.onChangeBuyCount(),this.labIntro.text=t.intro},e.prototype.onChangCashGift=function(){this.slider.value=this.slider.maximum,this.labCount.text=this.slider.value+"",this.labCost.text=this.slider.value*this.shopItem.price+""},e.prototype.updateUnionShop=function(){this.currentState="union";var t=Math.floor(unionService.getMyUnionInfo().contribute/this.shopItem.price)>100?100:Math.floor(unionService.getMyUnionInfo().contribute/this.shopItem.price),e=GameConfig.getItemMeta(this.shopItem.item_id);this.itemView.metaId=e.id,this.slider.maximum=t,this.slider.minimum=0,this.slider.value=this.slider.maximum<=0?0:1,this.labItemName.text=e.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[e.quality],this.onChangeBuyCount(),this.labIntro.text=e.intro},e.prototype.onChangeUnionShop=function(){var t=Math.floor(unionService.getMyUnionInfo().contribute/this.shopItem.price)>100?100:Math.floor(unionService.getMyUnionInfo().contribute/this.shopItem.price);this.slider.value>t&&(this.slider.value=t),this.slider.value<1&&(this.slider.value=this.slider.maximum<=0?0:1),this.labCount.text=this.slider.value+"/"+t,this.labCost.text=this.slider.value*this.shopItem.price+""},e.prototype.updateIncenseExchange=function(){this.currentState="incense";var t=Math.floor(mainService.playerInfo.incense_score/this.shopItem.price)>100?100:Math.floor(mainService.playerInfo.incense_score/this.shopItem.price);if(this.shopItem.chance>0){var e=this.shopItem.chance-shopService.getIncenseUsedCnt(this.shopItem.id);t=Math.min(e,t)}var i=GameConfig.getItemMeta(this.shopItem.item_id);this.itemView.metaId=i.id,this.slider.maximum=t,this.slider.minimum=0,this.slider.value=this.slider.maximum<=0?0:1,this.labItemName.text=i.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[i.quality],this.onChangeBuyCount(),this.labIntro.text=i.intro},e.prototype.onChangeIncenseExchange=function(){var t=Math.floor(mainService.playerInfo.incense_score/this.shopItem.price)>100?100:Math.floor(mainService.playerInfo.incense_score/this.shopItem.price);if(this.shopItem.chance>0){var e=this.shopItem.chance-shopService.getIncenseUsedCnt(this.shopItem.id);t=Math.min(e,t)}this.slider.value>t&&(this.slider.value=t),this.slider.value<1&&(this.slider.value=this.slider.maximum<=0?0:1),this.labCount.text=this.slider.value+"/"+t,this.labCost.text=this.slider.value*this.shopItem.price+""},e.prototype.show=function(i,n){var r=i.shopItem,o=i.type,s=void 0===o?0:o;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelShopBuyItemSkin),[4,t.prototype.popup.call(this,n)];case 1:switch(i.sent(),this.shopItem=r,this._type=s,this._type){case e.BUY_TYPE.DEFAULT_SHOP:this.updateUI();break;case e.BUY_TYPE.CASH_SHOP:this.updateCashGift();break;case e.BUY_TYPE.UNION_SHOP:this.updateUnionShop();break;case e.BUY_TYPE.INCENSE_EXCHANGE:this.updateIncenseExchange()}return[2]}})})},e.BUY_TYPE={DEFAULT_SHOP:0,CASH_SHOP:1,UNION_SHOP:2,INCENSE_EXCHANGE:3},e}(CommonPanelBase);__reflect(PanelShopBuyItem.prototype,"PanelShopBuyItem");var PanelSign=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listDay.itemRenderer=IRWithItemView,this.listDay.dataProvider=this._dayDataProvider=new ArrayCollection,this.listTotal.itemRenderer=IRWithItemView,this.listTotal.dataProvider=this._totalDataProvider=new ArrayCollection,this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.onBtnCloseTap,this),this.registerEvent(this.listDay,egret.Event.CHANGING,this.onSelectDayItem,this),this.registerEvent(this.listTotal,egret.Event.CHANGING,this.onSelectTotalItem,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelSignSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){var t=12,e=24;t>10?this.labMonth.text=lang.format(lang.sign_month,lang.zh_num.charAt(10)+lang.zh_num.charAt(t-10)):this.labMonth.text=lang.format(lang.sign_month,lang.zh_num.charAt(t)),this.labTotalDay.textFlow=lang.formatHtml(lang.sign_total_day,e)},e.prototype.onBtnCloseTap=function(t){this.close()},e.prototype.onSelectDayItem=function(t){t.preventDefault();var e=this.listDay.selectedItem,i=(e.content,e.item);PanelItemDetails.instance.show(i)},e.prototype.onSelectTotalItem=function(t){t.preventDefault();var e=this.listDay.selectedItem,i=(e.content,e.item);PanelItemDetails.instance.show(i)},e}(PanelBase);__reflect(PanelSign.prototype,"PanelSign");var PanelSimpleContent=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelSimpleContentSkin),[4,this.popup()];case 1:return e.sent(),this.loadContent(t),[2]}})})},e.prototype.onGrpButtonsTap=function(t){switch(t.target.name){case"close":this.dealAction()}},e.prototype.loadContent=function(t){var e=this;this.currentState="pending";var i=egret.getImplementation("eui.IAssetAdapter");i.getAsset(t,function(t){e.renderContent(t)},this,RES.ResourceItem.TYPE_TEXT)},e.prototype.renderContent=function(t){this.currentState="normal";var e=t.indexOf("\n"),i=t.substring(0,e),n=t.substr(e+1);this.labTitle.text=i,this.labContent.text=n},e}(CommonPanelBase);__reflect(PanelSimpleContent.prototype,"PanelSimpleContent");var PanelSpeed=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cdId=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRSpeedItem,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(this.btnGoldUse,egret.TouchEvent.TOUCH_TAP,this.onBtnGoldUseTap,this),this.registerEvent(this.btnItemUse,egret.TouchEvent.TOUCH_TAP,this.onBtnItemUseTap,this),this.registerEvent(this.list,egret.Event.CHANGE,this.onItemSelect,this),this.registerEvent(this.grpControl,egret.TouchEvent.TOUCH_TAP,this.onGrpControlTap,this),this.registerEvent(this.slider,egret.Event.CHANGE,this.onChangeUseCount,this),this.itemGold.metaId=1},e.prototype.init=function(){this.title=lang.panel_speed},e.prototype.show=function(t,e){var i=t.timeStamp,n=t.data,r=void 0===n?null:n;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._timeStamp=i,this._data=r,this.skinName||(this.skinName=panels.PanelSpeedSkin),[4,this.popup(e)];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.list.selectedIndex=0,this.labGoldHave.text=packService.getCountByMetaId(1),this.labGoldNeed.text=Math.ceil((this._timeStamp-mainService.tsServer)/60)+"",this._cdId&&countDownService.unregister(this._cdId),this._timeStamp-mainService.tsServer>0&&(this._cdId=countDownService.register(this._timeStamp,this.onSecond.bind(this))),this._dataProvider.source=this.getSpeedItem(),this.setSlider()},e.prototype.getSpeedItem=function(){var t=[600106,600107,600108,600109],e=[];return t.forEach(function(t){var i={id:t,count:packService.getCountByMetaId(t)};e.push(i)}),e},e.prototype.onSecond=function(t){return 0>=t?(this.update(),void(this._cdId=0)):(t>86400?this.labLastTime.text=alien.TimeUtils.timeFormat(t,"{3}:{2}:{1}:{0}"):this.labLastTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"),void(this.labGoldNeed.text=Math.ceil((this._timeStamp-mainService.tsServer)/60)+""))},e.prototype.setSlider=function(){var t=this.list.selectedItem,e=Math.max(Math.ceil((this._timeStamp-mainService.tsServer)/this.getSpeedTimeByMetaId(t.id)),0);this.slider.maximum=Math.min(t.count,e),this.slider.minimum=0==t.count?0:1,this.slider.value=0==t.count?0:1,this.labCount.text=this.slider.value+"",this.labSpeedTime.text="00:00:00",this.changeSlider()},e.prototype.getSpeedTimeByMetaId=function(t){switch(t){case 600106:return 300;case 600107:return 1800;case 600108:return 3600;case 600109:return 14400}},e.prototype.changeSlider=function(){this.slider.value>this.slider.maximum&&(this.slider.value=this.slider.maximum),this.slider.value<this.slider.minimum&&(this.slider.value=this.slider.minimum),this.labCount.text=this.slider.value+"";var t=this.list.selectedItem,e=this.getSpeedTimeByMetaId(t.id)*this.slider.value;e>86400?this.labSpeedTime.text=alien.TimeUtils.timeFormat(e,"{3}:{2}:{1}:{0}"):this.labSpeedTime.text=alien.TimeUtils.timeFormat(e,"{2}:{1}:{0}")},e.prototype.onItemSelect=function(t){t.preventDefault(),this.setSlider()},e.prototype.onGrpControlTap=function(t){var e=0;switch(t.target.name){case"increase":e=1;break;case"decrease":e=-1}this.slider.value+=e,this.changeSlider()},e.prototype.onBtnGoldUseTap=function(t){this.dealAction("confirm",{type:0,data:this._data})},e.prototype.onBtnItemUseTap=function(t){var e=packService.getItemByMetaId(this.list.selectedItem.id),i=e?{id:packService.getItemByMetaId(this.list.selectedItem.id).id,count:this.slider.value}:null;this.dealAction("confirm",{type:1,item:i,data:this._data})},e.prototype.onChangeUseCount=function(t){void 0===t&&(t=null),this.changeSlider()},e}(CommonPanelBase);__reflect(PanelSpeed.prototype,"PanelSpeed");var IRSpeedItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.item.alwaysShowCount=!0,this.item.setData(this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRSpeedItem.prototype,"IRSpeedItem");var PanelTask=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e.openState=!0,e._tab=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.getResGroupNames=function(){return["task"]},e.prototype.getSkinName=function(){return panels.PanelTaskSkin},e.prototype.show=function(t){return void 0===t&&(t=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.popup()];case 1:return e.sent(),this.openState=!0,this._tab=t,[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.vs.setup({def:TaskItemList},{def:TaskItemList},{def:TaskItemList})},e.prototype.active=function(){t.prototype.active.call(this),this.tabBar.selectedIndex=this._tab,this.vs.setSelectedIndex(this._tab,{type:this.tabBar.selectedIndex+1},!0)},e.prototype.close=function(){this.openState=!1,t.prototype.close.call(this)},e.prototype.onTabSelect=function(t){this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this.tabBar.selectedIndex+1},!0)},e}(PanelBase);__reflect(PanelTask.prototype,"PanelTask");var PanelTechInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.title=lang.panel_tech_info},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelTechInfoSkin),[4,this.popup()];case 1:return e.sent(),this.initUi(t),[2]}})})},e.prototype.initUi=function(t){this.technologyItem.technologyInfo=t;var e=GameConfig.getTechNextId(t.id),i="";e&&(i=" "+e.name+GameConfig.getTechNextLevel(e.id,t.id)+lang.lv);var n=technologyService.getById(t.id),r=t.levels[t.levels.length-1].level,o=0;if(n&&(o=n.level),0==o)this.labNowEffect.text=lang.nothing;else{var s=GameConfig.getTechLevelMeta(t.id,o),a=GameConfig.getBufferMeta(s.effect);a&&(this.labNowEffect.text=lang.format(a.intro,Math.abs(a.value)))}var c=o+1,l=null;if(o>=r)this.labNextEffect.text=lang.nothing,c=r,l=GameConfig.getTechLevelMeta(t.id,c);else{l=GameConfig.getTechLevelMeta(t.id,c);var p=GameConfig.getBufferMeta(l.effect);this.labNextEffect.text=lang.format(p.intro,Math.abs(p.value))}r>o?this.labLevel.text=o+"/"+r+lang.lv:this.labLevel.text=lang.tech_full_level,this.labNeeds.text=lang.minister_info_fields.knowledge+l.cost_knowledge+i,this.labUse.text=lang.player_info_fields.mineral+l.cost_mineral,this.labTime.text=l.cost_time+lang.minutes},e}(CommonPanelBase);__reflect(PanelTechInfo.prototype,"PanelTechInfo");var PanelTechSpeed=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cdId=0,e.onSecond=function(t){return 0>=t?(e.cdId=0,void e.close()):void(t>86400?e.labTime.text=alien.TimeUtils.timeFormat(t,"{3}:{2}:{1}:{0}"):e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSpeed,egret.TouchEvent.TOUCH_TAP,this.onBtnSpeedClick,this)},e.prototype.init=function(){this.title=lang.panel_tech_info},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelTechSpeedSkin),this._techData=t,[4,this.popup(e)];case 1:return i.sent(),this.initUi(t),[2]}})})},e.prototype.initUi=function(t){countDownService.unregister(this.cdId),this._techData=t,this.technologyItem.setDetailIcon(t);var e=technologyService.getById(t.id),i=0,n=t.levels[t.levels.length-1].level;e&&(i=e.level),this.labLevel.text=i.toString();var r=GameConfig.getTechLevelMeta(this._techData.id,i),o=GameConfig.getBufferMeta(r.effect);o?this.labNowEffect.text=lang.format(o.intro,Math.abs(o.value)):this.labNowEffect.text=lang.nothing;var s=i+1;i>=n&&(s=i);var a=GameConfig.getTechLevelMeta(this._techData.id,s),c=GameConfig.getBufferMeta(a.effect);this.labNextEffect.text=lang.format(c.intro,Math.abs(c.value));var l=technologyService.getTimestamp(t.id),p=ministerService.getById(l.str);p&&(this.labMinister.text=p.meta.name);var h=0;l&&l.timestamp-mainService.tsServer>0&&(h=Math.ceil((l.timestamp-mainService.tsServer)/60),this.cdId=countDownService.register(l.timestamp,this.onSecond.bind(this))),this.labCost.text="X"+h},e.prototype.onBtnSpeedClick=function(t){var e=technologyService.getTimestamp(this._techData.id),i=0;e&&e.timestamp-mainService.tsServer>0&&(i=Math.ceil((e.timestamp-mainService.tsServer)/60)),PanelSpeed.instance.show({timeStamp:e.timestamp},this.onSpeedResult.bind(this))},e.prototype.onSpeedResult=function(t,e){"confirm"==t&&this.dealAction(t,{techData:this._techData,speedData:e})},e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e}(CommonPanelBase);__reflect(PanelTechSpeed.prototype,"PanelTechSpeed");var Bezier=alien.Bezier,PanelTreasureBox=function(t){function e(){var e=t.call(this,alien.popupEffect.Fade,null,alien.popupEffect.Fade,null)||this;return e.onTap=function(t){void 0===t&&(t=null);var i=t&&t.target instanceof TreasureBoxItemView;if(i){var n=e.itemContainer.getChildIndex(t.target);PanelItemDetails.instance.show(e.data.rewards[n])}e.tapResolve?(e.tapResolve(),e.tapResolve=null):!i&&e.closable&&e.cancelResolve&&e.cancelResolve(),e.playing&&(e.fastMode=!0)},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),alien.Utils.enumChildren(this.itemContainer,function(t){t.touchChildren=!1,t.recordPosition()}),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this),alien.Utils.anchorCenter(this.imgLight,750,750),alien.Utils.anchorCenter(this.imgLightStatic,750,750),alien.Utils.anchorCenter(this.imgBox,750,750),this.shake=new alien.Wave(this.imgBox,500,alien.Wave.shake.bind(null,5,3),0,!1,!0,1e3)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelTreasureBoxSkin),[4,this.popup(this.onTap,!0,{alpha:.8})];case 1:return e.sent(),this.data=t,this.play(),[2]}})})},e.prototype.getStartPos=function(){var t=this.grpBox.localToGlobal(this.imgBox.x,this.imgBox.y);return this.itemContainer.globalToLocal(t.x,t.y)},e.prototype.getEndPos=function(){var t=this.localToGlobal(this.grpWarehouse.x,this.grpWarehouse.y);return t=this.itemContainer.globalToLocal(t.x,t.y),{x:t.x+40,y:t.y+40}},e.prototype.play=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,r,o,s,a,c,l,p,h,u,p,h,_,d=this;return __generator(this,function(f){switch(f.label){case 0:return this.closable=!1,this.fastMode=!1,this.grpWarehouse.visible=!1,t=this.imgLight,e=this.imgLightStatic,i=this.imgBox,n=this.grpBox,r=this.data,o=r.rewards,s=r.field,alien.Utils.enumChildren(this.itemContainer,function(t){t.visible=!1,t.scaleX=t.scaleY=1,t.stopWave()}),i.source="treasure_box_"+s+"_close",i.x=375,i.y=375,t.visible=!1,e.visible=!1,n.y=-1e3,n.scaleX=.9,n.scaleY=1.1,[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(n,null,null,!0).to({y:alien.StageProxy.height-600},1e3,egret.Ease.cubicIn))];case 1:return f.sent(),this.shake.play(),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(n,null,null,!0).to({scaleX:1,scaleY:1},800,egret.Ease.elasticOut))];case 2:return f.sent(),[4,new Promise(function(t){d.tapResolve=t})];case 3:return f.sent(),this.playing=!0,this.shake.stop(),i.source="treasure_box_"+s+"_open",i.x=390,i.y=360,t.visible=!0,e.visible=!0,egret.Tween.get(e).to({scaleX:.1,scaleY:.1},0).to({scaleX:1,scaleY:1},500,egret.Ease.cubicIn),egret.Tween.get(t).to({scaleX:.1,scaleY:.1},0).to({scaleX:1,scaleY:1},500,egret.Ease.cubicIn),egret.Tween.get(t,{loop:!0}).to({rotation:360},4e3),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(i,null,null,!0).to({scaleX:1,scaleY:1},800,egret.Ease.elasticOut))];case 4:return f.sent(),a=this.getStartPos(),alien.Utils.enumChildren(this.itemContainer,function(t){t.resetPosition(a)}),c=o.length,0!=c?[3,6]:[4,this.playItem(0,o[0])];case 5:return f.sent(),[3,10];case 6:l=alien.MathUtils.makeOrderIntArray(c-1),alien.MathUtils.mixArray(l),p=0,f.label=7;case 7:return c>p?(h=l[p],[4,this.playItem(h,o[h],this.fastMode)]):[3,10];case 8:f.sent(),f.label=9;case 9:return p++,[3,7];case 10:return this.playing=!1,this.closable=!0,[4,new Promise(function(t){d.cancelResolve=t})];case 11:f.sent(),this.grpWarehouse.visible=!0,u=this.getEndPos(),p=0,f.label=12;case 12:return c>p?(h=l[p],_=this.itemContainer.getChildAt(h),c-1>p?(u.scaleX=.5,u.scaleY=.5,_.collect(u,400*Math.random()),[3,15]):[3,13]):[3,16];case 13:return[4,_.collect(u,500)];case 14:f.sent(),f.label=15;case 15:return p++,[3,12];case 16:return[4,alien.EgretUtils.waitPromise(300)];case 17:return f.sent(),this.dealAction(),[2]}})})},e.prototype.playItem=function(t,e,i){return void 0===i&&(i=!1),__awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=this.itemContainer.getChildAt(t),n.visible=!0,[4,n.fly(e,i?1:500)];case 1:return r.sent(),[2]}})})},e}(PanelBase);__reflect(PanelTreasureBox.prototype,"PanelTreasureBox");var TreasureBoxItemView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onUpdate=function(t){e.x=t.x,e.y=t.y},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._bezier=new Bezier(this.onUpdate)},e.prototype.recordPosition=function(){this._originPos={x:this.x,y:this.y},this._wave=new alien.Wave(this,2e3,alien.Wave.sin.bind(null,5),0,!1,!1,0,Math.random()*Math.PI*2)},e.prototype.playWave=function(){this._wave.play()},e.prototype.stopWave=function(){this._wave.stop()},e.prototype.resetPosition=function(t){this.x=t.x,this.y=t.y},e.prototype.fly=function(t,e){return void 0===e&&(e=500),__awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return this._bezier.init([{x:this.x,y:this.y},{x:this.x,y:this._originPos.y},this._originPos]),i=GameConfig.getItemMeta(t.id),this.showEffect(t.id),this.itemView.setData(t),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(this._bezier,null,null,!0).to({factor:1},e,egret.Ease.cubicOut))];case 1:return n.sent(),4==i.quality&&SoundManager.instance.vibrate(),this.playWave(),[2]}})})},e.prototype.collect=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(n){switch(n.label){case 0:return this.stopWave(),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(this,null,null,!0).wait(e).to(t,400,egret.Ease.cubicIn).call(function(){i.visible=!1}))];case 1:return n.sent(),[2]}})})},e}(EffectItemView);__reflect(TreasureBoxItemView.prototype,"TreasureBoxItemView");var PanelTreasureIntro=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRTreasureIntro,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.init=function(){this.title=lang.panel_rule_intro},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelTreasureIntroSkin),[4,this.popup()];case 1:return e.sent(),this._dataProvider.source=t,[2]}})})},e}(CommonPanelBase);__reflect(PanelTreasureIntro.prototype,"PanelTreasureIntro");var IRTreasureIntro=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),"object"==typeof this.data.content?this.labContent.textFlow=this.data.content:this.labContent.text=this.data.content},e}(eui.ItemRenderer);__reflect(IRTreasureIntro.prototype,"IRTreasureIntro");var PanelUseItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.title=lang.panel_use_item,this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.slider,egret.Event.CHANGE,this.onChangeUseCount,this),this.registerEvent(this.grpControl,egret.TouchEvent.TOUCH_TAP,this.onGrpControlTap,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this)},e.prototype.onUpdateItem=function(t){t.data.item?this.updateUI():this.dealAction()},e.prototype.onChangeUseCount=function(t){void 0===t&&(t=null),this.slider.value<1&&(this.slider.value=this.slider.maximum<=0?0:1),this.labCount.text=this.slider.value+"/"+this.itemData.count},e.prototype.onGrpButtonsTap=function(t){switch(t.target.name){case"confirm":this.itemData.id?(packService.setNowItem(this.itemData.metaId,this.slider.value,this.target?this.target.id:""),packService.useItem(this.itemData.id,this.slider.value,this.target?this.target.id:"")):Toast.show({text:lang.response_error[6]})}this.dealAction()},e.prototype.onGrpControlTap=function(t){var e=0;switch(t.target.name){case"increase":e=1;break;case"decrease":e=-1}var i=this.slider.value+e;i=1>i?1:i>this.itemData.count?this.itemData.count:i,this.slider.value=i,this.onChangeUseCount()},e.prototype.updateUI=function(){this.itemView.setItemData(this.itemData),this.slider.maximum=this.itemData.count,this.slider.minimum=0,this.slider.value=this.slider.maximum,this.labItemName.text=this.itemData.meta.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[this.itemData.meta.quality],this.labIntro.text=this.itemData.meta.intro,this.onChangeUseCount()},e.prototype.show=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelUseItemSkin),[4,t.prototype.popup.call(this)];case 1:return i.sent(),this.itemData=e.itemData,this.target=e.target,this.updateUI(),[2]}})})},e}(CommonPanelBase);__reflect(PanelUseItem.prototype,"PanelUseItem");var PanelUseThingAlert=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this)},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,o,s,a;return __generator(this,function(c){switch(c.label){case 0:return this.skinName||(this.skinName=panels.PanelUseThingAlertSkin),i=this._data=t,n=i.content,r=i.id,o=i.count,this.skinType=2,[4,this.popup(e)];case 1:return c.sent(),s=1e3>r,this.currentState=s?"prop":"item",this.label0.text=n[0],this.label1.text=n[1]+"?",a=GameConfig.getItemMeta(r),s?(this.imgIcon.source=ItemView.getIconUrl(a.icon,!0),this.labCount.text=o.toString()):(this.labItemName.text=a.name,this.labItemName.textColor=GameConfig.QUALITY_COLORS[a.quality],this.labCount.text=o+lang.unit),[2]}})})},e.prototype.onGrpButtonsTap=function(t){this.dealAction(t.target.name,this._data)},e}(CommonPanelBase);__reflect(PanelUseThingAlert.prototype,"PanelUseThingAlert");var PanelWorkFinish=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e._states=["work","rite","email","success","success2"],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.getSkinName=function(){return panels.PanelWorkFinishSkin},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this._HorizontalLayout=new eui.HorizontalLayout,this._TileLayout=new eui.TileLayout,this._TileLayout.requestedColumnCount=4,this.listReward.itemRenderer=IRReward,this.listReward.dataProvider=this._rewardDataProvider=new eui.ArrayCollection,this.listPrincess.itemRenderer=IRWorkPrincess,this.listPrincess.dataProvider=this._PrincessDataProvider=new eui.ArrayCollection,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){this.dealAction()},e.prototype.updateUI=function(t){var e=this,i=t.type,n=t.reward,r=t.princessEffect,o=t.partySeqInfo,s=t.contents;this.currentState=this._states[i];var a;a=n&&"string"==typeof n?wsy.Utils.parseItems(n):n||[],a=a.sort(function(t,e){return GameConfig.getItemMeta(e.id).quality-GameConfig.getItemMeta(t.id).quality}),this._rewardDataProvider.source=a;var c=[];r?r.forEach(function(t){var e=t.princessId,i=t.field,n=t.count,r=princessService.getById(e).meta,o=lang.formatHtml(lang.princess_work_reward_content,r.name,lang.princess_info_fields[i],n);c.push(o)}):o?o.forEach(function(t,e){var i=t.id,n=t.name,r=t.score,o=i==dataCenterService.pid?"07F90F":"FF9D47",s=lang.formatHtml(lang.princess_party_rank_content,lang.zh_num[e+1],o,n,r);c.push(s)}):s&&(c=s),this._PrincessDataProvider.source=c,alien.EgretUtils.callLater(function(){e._rewardDataProvider.source.length<=4?e.listReward.layout=e._HorizontalLayout:e.listReward.layout=e._TileLayout})},e.prototype.show=function(t,e){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return SoundManager.instance.playEffect(ResNames.sound_gain_items),this._callback=e,[4,this.popup(this.dealAction)];case 1:return i.sent(),this.updateUI(t),[2]}})})},e}(PanelBase);__reflect(PanelWorkFinish.prototype,"PanelWorkFinish");var IRWorkPrincess=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labContent.textFlow=this.data},e}(eui.ItemRenderer);__reflect(IRWorkPrincess.prototype,"IRWorkPrincess");var PanelWorldMap=function(t){function e(){var e=t.call(this,alien.popupEffect.None,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return e.startOffset=58,e.endOffset=-8,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.grp.mask=this.rectMask,this.worldMap.showPointAttack=!1,this.worldMap.autoFixed=!0,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=!this.skinName,this.skinName||(this.skinName=panels.PanelWorldMapSkin),[4,this.popup(this.dealAction)];case 1:return i.sent(),t&&this.worldMap.update(),e=battleService.conquerCount,this.labConquerCount.text=e.toString(),this.labArea.text=mainService.playerInfo.area.toString(),this.playOpen(),[2]}})})},e.prototype.onTap=function(t){this.dealAction()},e.prototype.playOpen=function(){var t=this;this.grpInfo.alpha=0,this.rectMask.height=this.startOffset,this.bgPart1.y=this.startOffset,egret.Tween.get(this.rectMask).to({height:this.bgPart0.height},1e3,egret.Ease.cubicInOut),egret.Tween.get(this.bgPart1).to({y:this.bgPart0.height+this.endOffset},1e3,egret.Ease.cubicInOut).call(function(){egret.Tween.get(t.grpInfo).to({alpha:1},100)
})},e}(PanelBase);__reflect(PanelWorldMap.prototype,"PanelWorldMap");var PanelAddBuffer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.props=["gold","emerald"],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listProps.itemRenderer=IRProps,this.listProps.dataProvider=this._dataProviderProps=new eui.ArrayCollection(this.props),this.list.itemRenderer=IRAddBuffer,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_PVE_ADDBUFF_RESPONSE,this.onAddBufferResponse,this),this.registerEvent(this.cbAuto,egret.TouchEvent.TOUCH_TAP,this.onCbAutoTap,this)},e.prototype.init=function(){this.title=lang.panel_add_buffer},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelAddBufferSkin),[4,this.popup(e)];case 1:return t.sent(),this.onAddBufferResponse(),this.cbAuto.selected=arenaService.autoShowAddBuffer,[2]}})})},e.prototype.onAddBufferResponse=function(t){void 0===t&&(t=null),this._dataProvider.source=arenaService.buffers,this._dataProviderProps.refresh()},e.prototype.onCbAutoTap=function(t){arenaService.autoShowAddBuffer=this.cbAuto.selected},e}(CommonPanelBase);__reflect(PanelAddBuffer.prototype,"PanelAddBuffer");var IRAddBuffer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.button,egret.TouchEvent.TOUCH_TAP,this.onButtonTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.id,n=e.status,r=GameConfig.getBattleBufferMeta(i),o=GameConfig.getBufferMeta(r.effect);this.imgIcon.source="buffer_icon_"+r.icon,this.labName.text=r.name,this.labEffect.text=alien.StringUtils.format(o.intro,Math.abs(o.value)),this.imgCostIcon.source=ItemView.getIconUrl(r.cost.id,!0),this.labCostCount.text=r.cost.count,this.imgUsed.visible=1==n,this.button.visible=0==n,this.button.visible&&(this.button.enabled=packService.getCountByMetaId(r.cost.id)>=r.cost.count)},e.prototype.onButtonTap=function(t){var e=this.data.id;arenaService.addBuffer(e)},e}(alien.VisualEventItemRenderer);__reflect(IRAddBuffer.prototype,"IRAddBuffer");var PanelArenaBattleInfo=function(t){function e(){var e=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.None,{withFade:!0,ease:egret.Ease.backIn})||this;return e.onPanelAddBufferResult=function(){e.updateUI()},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.getSkinName=function(){return arena.PanelArenaBattleInfoSkin},e.prototype.createChildren=function(){alien.Utils.anchorCenter(this.btnStart),this._wave=new alien.Wave(this.btnStart,4e3,alien.Wave.zoom.bind(null,.05)),this.registerEvent(this.grpStart,egret.TouchEvent.TOUCH_TAP,this.onBtnStartTap,this),this.registerEvent(this.btnAddBuffer,egret.TouchEvent.TOUCH_TAP,this.onBtnAddBufferTap,this),this.registerEvent(this.btnAbandon,egret.TouchEvent.TOUCH_TAP,this.onBtnAbandonTap,this),this.registerEvent(gameServer,protocols.WC_PVE_END_RESPONSE,this.onPveEndResponse,this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t.prototype.createChildren.call(this),this._callback=i,[4,this.popup()];case 1:return e.sent(),this.updateUI(),[2]}})})},e.prototype.active=function(){return arenaService.autoShowAddBuffer&&PanelAddBuffer.instance.show(null,this.onPanelAddBufferResult),t.prototype.active.call(this)},e.prototype.updateUI=function(){var t=arenaService.battleInfo.sites;this.battleInfoBlue.setData(t[0]),this.battleInfoRed.setData(t[1],arenaService.battleInfo)},e.prototype.onBtnStartTap=function(t){SoundManager.instance.playEffect(ResNames.sound_arena_start),arenaService.beginBattle(),this.dealAction()},e.prototype.onBtnAddBufferTap=function(t){PanelAddBuffer.instance.show(null,this.onPanelAddBufferResult)},e.prototype.onBtnAbandonTap=function(t){Alert.show(lang.arena_abandon,1,function(t){"confirm"==t.name&&arenaService.pveEnd()})},e.prototype.onPveEndResponse=function(t){if(0==t.data.error){var e=GameConfig.getMinisterMeta(arenaService.battleInfo.sites[0].minister.metaId),i=arenaService.battleInfo.sites[1].accountName,n=0==arenaService.winCount?0:1;PanelQuickMemorial.instance.show({text:lang.formatHtml(lang.arena_result_failed[n],GameConfig.MINISTER_QUALITY_COLORS[e.quality],e.name,i,arenaService.winCount)},function(){arenaService.requestBattleInfo(2)}),this.close()}},e}(PanelBase);__reflect(PanelArenaBattleInfo.prototype,"PanelArenaBattleInfo");var PanelArenaBattleResult=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.listReward.itemRenderer=IRReward,this.listReward.dataProvider=this._rewardDataProvider=new eui.ArrayCollection,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.registerEvent(alien.Dispatcher,EventNames.CHOOSE_TREASURE_BOX,this.onChooseTreasureBox,this)},e.prototype.onTap=function(t){arenaService.win3Data?this.canTouch&&this.dealAction(this.currentState):this.dealAction(this.currentState)},e.prototype.onChooseTreasureBox=function(t){this.canTouch=!0;var e=arenaService.win3Data,i=e.itemId,n=e.itemCount;this._rewardDataProvider.source=[{id:i,count:n}],this.listReward.visible=!0},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,r;return __generator(this,function(o){switch(o.label){case 0:return this.skinName||(this.skinName=panels.PanelArenaBattleResultSkin),this._callback=e,[4,this.popup()];case 1:return o.sent(),this.canTouch=!1,this.listReward.visible=!1,t=arenaService.resultData,i=t.score,n=t.exploit,arenaService.win3Data?(this.currentState="success3",this.treasureBoxListView.setup()):(r=arenaService.resultData.winCount,this.currentState=i>=0?"success":"failed",this.labNotice.text=lang.format(lang.arena_result_notice,r%3)),this.labReward.text=lang.arena_score+(i>0?"+":"")+i+(i>0?"  "+lang.minister_info_fields.exploit+"+"+n:""),[2]}})})},e}(PanelBase);__reflect(PanelArenaBattleResult.prototype,"PanelArenaBattleResult");var PanelArenaHistory=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSelectMinister=function(t,i){"select"==t&&i&&i.minister&&e.dealAction("avenge",{ministerId:i.minister.id,playerId:e._selectedData.playerId})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.tab.dataProvider=new eui.ArrayCollection(GameConfig.arenaHistoryTabs),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.tab,egret.Event.CHANGE,this.onTabChange,this),this.registerEvent(alien.Dispatcher,ArenaHistoryItem.DO_AVENGE,this.onDoAvenge,this)},e.prototype.onTabChange=function(t){this.setTab(this.tab.selectedIndex)},e.prototype.onDoAvenge=function(t){this._selectedData=t.data,PanelDispatchForArena.instance.show(null,this.onSelectMinister)},e.prototype.setTab=function(t){var e=arenaService.getHistory(t);e.length>0&&(this.scroller.viewport.scrollV=0,this._dataProvider.source=e),this.scroller.visible=e.length>0,this.labNotice.visible=0==e.length},e.prototype.init=function(){this.title=lang.panel_arena_history},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=arena.PanelArenaHistorySkin),[4,this.popup(e)];case 1:return t.sent(),this.setTab(this.tab.selectedIndex=0),[2]}})})},e}(CommonPanelBase);__reflect(PanelArenaHistory.prototype,"PanelArenaHistory");var ArenaHistoryItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.button,egret.TouchEvent.TOUCH_TAP,this.onButtonTap,this)},e.prototype.setData=function(t){this.data=t;var e=t.index,i=t.playerName,n=t.score,r=t.scoreChange,o=t.beatCount,s=t.type,a=t.nationalPower,c=t.timestamp;this.currentState=0==s?"history":"enemy",this.labNum.text=(e+1).toString(),this.labTitle.text=lang.format(lang.arena_history_title,i,n),this.labContent.text=0==s?lang.format(lang.arena_history_content,o):lang.format(lang.arena_history_national_power,a),this.labBattleInfo.text=lang.format(lang.arena_history_result,r),this.labTime.text=lang.time+": "+alien.TimeUtils.tsToDate(c).toLocaleString()},e.prototype.onButtonTap=function(t){alien.Dispatcher.dispatch(e.DO_AVENGE,this.data)},e.DO_AVENGE="DO_AVENGE",e}(alien.VisualEventComponent);__reflect(ArenaHistoryItem.prototype,"ArenaHistoryItem");var PanelArenaRanking=function(t){function e(){var e=t.call(this)||this;return e._dataProvider=new eui.ArrayCollection,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider,this.registerEvent(gameServer,protocols.WC_OPENTOPPVE_RESPONSE,this.onArenaRanking,this)},e.prototype.init=function(){this.title=lang.panel_arena_ranking},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=arena.PanelArenaRankingSkin),[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),arenaService.getArenaRanking()},e.prototype.onArenaRanking=function(t){if(0==t.data.error){if(this.currentState=arenaService.rankingSelf?"int":"out",arenaService.rankingSelf){var e=arenaService.rankingSelf,i=e.name,n=e.num,r=e.score;this.labNickname.text=i,n++,this.labNum.text=n.toString(),this.labScore.text=r.toString()}this._dataProvider.source=arenaService.rankingList}},e}(CommonPanelBase);__reflect(PanelArenaRanking.prototype,"PanelArenaRanking");var ArenaRankingItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setData=function(t){var e=t.name,i=t.num,n=t.score;this.currentState=3>=i?"num_"+i:"other",this.labNickname.text=e,this.labNum.text=i.toString(),this.labScore.text=n.toString()},e}(alien.EventComponent);__reflect(ArenaRankingItem.prototype,"ArenaRankingItem");var PanelSeasonAward=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cdId=0,e.onSecond=function(t){if(0>t)return void(e._cdId=0);if(t>86400){var i=Math.floor(t/3600/24);e.labTime.text=i+lang.sky+alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")}else e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.listRank.itemRenderer=IRRankAward,this.listRank.dataProvider=this._dataProviderRank=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(gameServer,protocols.WC_OPENTOPPVE_RESPONSE,this.onArenaRanking,this)},e.prototype.init=function(){this.title=lang.panel_season_award},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=arena.PanelSeasonAwardSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),arenaService.getArenaRanking()},e.prototype.update=function(){this.labSeason.text=lang.format(lang.season_name,1),this._dataProviderRank.source=alien.Utils.objectValues(GameConfig.rankReward),this._cdId&&(countDownService.unregister(this._cdId),this._cdId=0),this._cdId=countDownService.register(this.getTimesWeeknight(),this.onSecond.bind(this))},e.prototype.getTimesWeeknight=function(){var t=new Date(1e3*mainService.tsServer),e=6-t.getDay();return t.setHours(24,0,0,0),Math.floor(t.getTime()/1e3)+24*e*60*60},e.prototype.onSelectItem=function(t){t.preventDefault();var e=this.list.selectedItem;PanelItemDetails.instance.show({id:e.id})},e.prototype.onArenaRanking=function(t){if(0==t.data.error)if(arenaService.rankingSelf){var e=arenaService.rankingSelf,i=(e.name,e.num);e.score;i++,this.labRank.text=i.toString(),this._dataProvider.source=GameConfig.getRankRewardByRank(i)}else this.labRank.text="无",this._dataProvider.source=[]},e}(CommonPanelBase);__reflect(PanelSeasonAward.prototype,"PanelSeasonAward");var IRRankAward=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;e.rank_min==e.rank_max?this.labTitle.text=lang.season_award_title[e.rank_min]:1001!=e.rank_min?this.labTitle.text=lang.format(lang.season_award_title[0],e.rank_min+"-"+e.rank_max):this.labTitle.text=lang.format(lang.season_award_title[4],e.rank_min),this._dataProvider.source=e.reward},e.prototype.onSelectItem=function(t){t.preventDefault();var e=this.list.selectedItem;PanelItemDetails.instance.show({id:e.id})},e}(alien.VisualEventItemRenderer);__reflect(IRRankAward.prototype,"IRRankAward");var alien;!function(t){var e=function(){function t(e){void 0===e&&(e=null),this._source=[],e=t.fixMatrix(e),this.copyMatrix(e.length==t.LENGTH?e:t.IDENTITY_MATRIX)}return t.prototype.reset=function(){for(var e=0;e<t.LENGTH;e++)this._source[e]=t.IDENTITY_MATRIX[e]},t.prototype.adjustColor=function(t,e,i,n){this.adjustHue(n),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)},t.prototype.adjustBrightness=function(e){e=t.cleanValue(e,100),0==e||isNaN(e)||this.multiplyMatrix([1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])},t.prototype.adjustContrast=function(e){if(e=t.cleanValue(e,100),0!=e&&!isNaN(e)){var i;0>e?i=127+e/100*127:(i=e%1,i=0==i?t.DELTA_INDEX[e]:t.DELTA_INDEX[e<<0]*(1-i)+t.DELTA_INDEX[(e<<0)+1]*i,i=127*i+127),this.multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1])}},t.prototype.adjustSaturation=function(e){if(e=t.cleanValue(e,100),0!=e&&!isNaN(e)){var i=1+(e>0?3*e/100:e/100),n=.3086,r=.6094,o=.082;this.multiplyMatrix([n*(1-i)+i,r*(1-i),o*(1-i),0,0,n*(1-i),r*(1-i)+i,o*(1-i),0,0,n*(1-i),r*(1-i),o*(1-i)+i,0,0,0,0,0,1,0,0,0,0,0,1])}},t.prototype.adjustHue=function(e){if(e=t.cleanValue(e,180)/180*Math.PI,0!=e&&!isNaN(e)){var i=Math.cos(e),n=Math.sin(e),r=.213,o=.715,s=.072;this.multiplyMatrix([r+i*(1-r)+n*-r,o+i*-o+n*-o,s+i*-s+n*(1-s),0,0,r+i*-r+.143*n,o+i*(1-o)+.14*n,s+i*-s+n*-.283,0,0,r+i*-r+n*-(1-r),o+i*-o+n*o,s+i*(1-s)+n*s,0,0,0,0,0,1,0,0,0,0,0,1])}},t.prototype.concat=function(e){return e=t.fixMatrix(e),e.length==t.LENGTH?(this.multiplyMatrix(e),this._source):void 0},t.prototype.clone=function(){return new t(this._source)},t.prototype.toString=function(){return"ColorMatrix [ "+this._source.join(" , ")+" ]"},t.prototype.toArray=function(){return this._source.slice(0,20)},t.prototype.copyMatrix=function(e){for(var i=t.LENGTH,n=0;i>n;n++)this._source[n]=e[n]},t.prototype.multiplyMatrix=function(t){for(var e=[],i=0;5>i;i++){for(var n=0;5>n;n++)e[n]=this._source[n+5*i];for(var n=0;5>n;n++){for(var r=0,o=0;5>o;o++)r+=t[n+5*o]*e[o];this._source[n+5*i]=r}}},t.cleanValue=function(t,e){return Math.min(e,Math.max(-e,t))},t.fixMatrix=function(e){void 0===e&&(e=null);var i;return null==e?t.IDENTITY_MATRIX:(e instanceof t&&(i=e.slice(0)),e.length<t.LENGTH?i=e.slice(0,e.length).concat(t.IDENTITY_MATRIX.slice(e.length,t.LENGTH)):e.length>t.LENGTH&&(i=e.slice(0,t.LENGTH)),e)},t.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],t.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],t.LENGTH=t.IDENTITY_MATRIX.length,t}();t.ColorMatrix=e,__reflect(e.prototype,"alien.ColorMatrix")}(alien||(alien={}));var alien;!function(t){var e=function(){function t(){}return t.rgbToValue=function(t,e,i){return(t<<16)+(e<<8)+i},t.valueToRgb=function(t){return[t>>16,(t>>8)%256,t%256]},t.hslToValue=function(t,e,i){return this.rgbToValue.apply(this,this.hslToRgb(t,e,i))},t.valueToHsl=function(t){return this.rgbToHsl.apply(this,this.valueToRgb(t))},t.hue2rgb=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t},t.hslToRgb=function(t,e,i){var n,r,o,s,a;return t/=240,e/=240,i/=240,0==e?n=r=o=i:(a=.5>i?i*(e+1):i+e-i*e,s=2*i-a,n=this.hue2rgb(s,a,t+1/3),r=this.hue2rgb(s,a,t),o=this.hue2rgb(s,a,t-1/3)),[Math.round(255*n),Math.round(255*r),Math.round(255*o)]},t.rgbToHsl=function(t,e,i){t/=255,e/=255,i/=255;var n,r,o=Math.max(t,e,i),s=Math.min(t,e,i),a=(o+s)/2;if(o==s)n=r=0;else{var c=o-s;switch(r=a>.5?c/(2-o-s):c/(o+s),o){case t:n=(e-i)/c+(i>e?6:0);break;case e:n=(i-t)/c+2;break;case i:n=(t-e)/c+4}n/=6}return[n,r,a]},t}();t.ColorUtils=e,__reflect(e.prototype,"alien.ColorUtils")}(alien||(alien={}));var PanelActShop=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getSkinName=function(){return panels.PanelActShopSkin},e.prototype.init=function(){this.title=lang.panel_activity_shop},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this.getShopItems()),this.registerEvent(gameServer,protocols.WC_ITEM_BUY_RESPONSE,this.onItemBuyResponse,this),this.registerEvent(alien.Dispatcher,EventNames.BUY_INCENSE_ITEM,this.onBuyIncenseItem,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.update=function(){},e.prototype.getShopItems=function(){var t=GameConfig.getShopByType(ShopService.Shop.TYPE_INCENSE),e=[{sequence:-1,id:600121},{sequence:-1,id:600122}];return t=t.concat(e)},e.prototype.onBuyIncenseItem=function(t){this._data=t.data,shopService.buyItem(this._data.seq,this._data.count)},e.prototype.onItemBuyResponse=function(t){this._dataProvider.itemUpdated(this.list.selectedItem),0==t.data.error&&this._data&&PanelWorkFinish.instance.show({type:2,reward:[{id:this.list.selectedItem.id,count:this._data.count}],princessEffect:null},null)},e}(CommonPanelBase);__reflect(PanelActShop.prototype,"PanelActShop");var PanelIncenseExchange=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRIncenseExchange,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onItemSelected,this),this.registerEvent(gameServer,ProtocolConfigs.WC_BURNEXCHANGE_RESPONSE,this.onBurnExchangeResponse,this)},e.prototype.init=function(){this.title=lang.panel_score_exchange},e.prototype.getSkinName=function(){return panels.PanelIncenseExchangeSkin},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.labScore.text=mainService.playerInfo.incense_score+"",this._dataProvider.source=GameConfig.getExchangeByType(ShopService.Exchange.TYPE_INCENSE)},e.prototype.onItemSelected=function(t){var e=this;t.preventDefault();var i=this.list.selectedItem;GameConfig.getItemMeta(i.item_id);PanelShopBuyItem.instance.show({shopItem:i,type:PanelShopBuyItem.BUY_TYPE.INCENSE_EXCHANGE},function(t,n){if("confirm"==t){if(mainService.playerInfo.incense_score<i.price)return void Toast.show({text:lang.response_error[106]});e._selectItem={meta:i,count:n.count},shopService.burnExchange(n.id,n.count)}})},e.prototype.onBurnExchangeResponse=function(t){var e=this;if(!(t.data.error>0)&&this._selectItem){var i=this.scroller.viewport.scrollV;this._dataProvider.refresh(),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=Math.max(0,i)}),this.labScore.text=mainService.playerInfo.incense_score+"",PanelWorkFinish.instance.show({type:2,reward:[{id:this._selectItem.meta.item_id,count:this._selectItem.meta.item_count*this._selectItem.count}],princessEffect:null})}},e}(CommonPanelBase);__reflect(PanelIncenseExchange.prototype,"PanelIncenseExchange");var IRIncenseExchange=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.item.setIncenseData(this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRIncenseExchange.prototype,"IRIncenseExchange");var PanelIncenseRankReward=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._types=[RankService.RankType.TYPE_BURN_PERSON,RankService.RankType.TYPE_BURN_UNION],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getSkinName=function(){return panels.PanelIncenseRankRewardSkin},e.prototype.init=function(){this.title=lang.incense_rank_reward},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabBarTap,this),this.vs.setup({def:IncenseRankReward,param:{type:this._types[0]}},{def:IncenseRankReward,param:{type:this._types[1]}})},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.vs.setSelectedIndex(0,{type:this._types[0]}),[2]}})})},e.prototype.onTabBarTap=function(t){this.vs.setSelectedIndex(this.tabBar.selectedIndex,{type:this._types[this.tabBar.selectedIndex]})},e}(CommonPanelBase);__reflect(PanelIncenseRankReward.prototype,"PanelIncenseRankReward");var PanelPopular=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getSkinName=function(){return panels.PanelPopularSkin},e.prototype.getResGroupNames=function(){return["task"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this.getConfigs()),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(gameServer,ProtocolConfigs.WC_INCENSEDRAWREWARD_RESPONSE,this.onIncensedRawRewardResponse,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this._dataProvider.refresh()},e.prototype.onIncensedRawRewardResponse=function(t){var e=this;if(0==t.data.error){PanelWorkFinish.instance.show({type:2,reward:this.list.selectedItem.reward});var i=this.scroller.viewport.scrollV;this._dataProvider.refresh(),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=Math.max(0,i)})}},e.prototype.getConfigs=function(){var t=activityService.incenseConfig.slice();return t.shift(),t},e}(PanelBase);__reflect(PanelPopular.prototype,"PanelPopular");var PopularItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._level=0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(this.btn,egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this)},e.prototype.setData=function(t){this._level=t.level;var e=t;this.labName.text=lang.format(lang.burn_popular.title,this._level);var i=16012320;this.grp.filters=null,this.imgFinish.visible=!1,this.btn.visible=!0,this.labState.visible=!0,this.touchChildren=!0;var n=e.scoreMin,r=activityService.incenseScore>n?n:activityService.incenseScore,o=activityService.getIncenseState(this._level);this.btn.visible=1==o,r>=n?(this.labState.text=lang.task_state[1],i=9615406,this.btn.skinName=ui.GreenButtonSkin,this.btn.label=lang.task_button_label[1],2==o&&(this.grp.filters=[GameConfig.greyFilter],this.imgFinish.visible=!0,this.labState.visible=!1,this.touchChildren=!1)):(this.labState.text=lang.task_state[0],i=16012320),this.labState.textColor=i,this.labDesc.textFlow=lang.formatHtml(lang.burn_popular.value,i,r,n),this._dataProvider.source=e.reward},e.prototype.onSelectItem=function(t){t.preventDefault(),PanelItemDetails.instance.show({id:this.list.selectedItem.id})},e.prototype.onBtnTap=function(t){activityService.getIncenseReward(this._level)},e}(alien.VisualEventComponent);__reflect(PopularItem.prototype,"PopularItem");var wsy;!function(t){var e=function(){function t(){}return t.makeColorFraction=function(t,e,i,n,r){void 0===r&&(r=!0);var o=n>i?GameConfig.COLORS.red:GameConfig.COLORS.green;return lang.htmlParser.parse(alien.StringUtils.format(t,lang.format(e,o.toString(16),r?i:n,n)))},t.makeNotificationText=function(t,e,i,n){var r=i-n,o=r>=0?65280:16711680,s=r>=0?"+":"",a=t[e]+s+r;return{color:o,text:a}},t.parseItems=function(t){return t.split("|").filter(function(t){return t.length>0}).map(function(t){var e=t.split(":");return{id:parseInt(e[0]),count:parseInt(e[1])}})},t.updateAllImages=function(t){var e=this;alien.Utils.enumChildren(t,function(t){t instanceof eui.Image||t instanceof alien.Image?t.texture&&t.texture.bitmapData||t.parseSource():t instanceof eui.BitmapLabel?t.$parseFont():t instanceof alien.MovieClipView?t.updateAniName():t instanceof egret.DisplayObjectContainer&&e.updateAllImages(t)})},t.shortCurrency=function(t,e){for(var i=t+"",n=e||GameConfig.currencyUnits,r=0,o=n.length;o>r;r++){var s=n[r];if(t>=s.gold){var a=alien.MathUtils.fixed(t/s.gold,2);a=a.indexOf(".00")<0?a:a.substr(0,a.length-3),i=a+s.unit;break}}return i},t}();t.Utils=e,__reflect(e.prototype,"wsy.Utils")}(wsy||(wsy={}));var PanelDecreeOfficeClass=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=ResNames.office_class_degree_title},e.prototype.show=function(t){this.skinName||(this.skinName=decrees.PanelDecreeOfficeClassSkin),this.popup(t)},e.prototype.render=function(t){var e=t.minister;this.labMinisterName.text=e.meta.name,this.labOfficeClass.text=lang.minister_office_class[e.grade]},e}(PanelDecreeBase);__reflect(PanelDecreeOfficeClass.prototype,"PanelDecreeOfficeClass");var PanelDecreePeerage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=ResNames.minister_info_peerage_decree_title},e.prototype.show=function(t){this.skinName||(this.skinName=decrees.PanelDecreePeerageSkin),this.popup(t)},e.prototype.render=function(t){var e=t.minister,i=GameConfig.getPeerageMetaByLevel(e.level);this.labMinisterName.text=e.meta.name,this.labMinisterName.textColor=GameConfig.QUALITY_COLORS[e.meta.quality],this.labPeerage.text=i.name},e}(PanelDecreeBase);__reflect(PanelDecreePeerage.prototype,"PanelDecreePeerage");var PanelDecreePrinceNobles=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=ResNames.prince_title_nobles},e.prototype.show=function(t){this.skinName||(this.skinName=decrees.PanelDecreePrinceNoblesSkin),this.popup(t)},e.prototype.render=function(t){this.labPrinceName.text=t.name,this.labPrinceName.textColor=GameConfig.QUALITY_COLORS[t.quality],this.labPeerage.text=lang.prince_peerage[t.peerage]},e}(PanelDecreeBase);__reflect(PanelDecreePrinceNobles.prototype,"PanelDecreePrinceNobles");var PanelDecreePrinceOpen=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=ResNames.prince_title_open},e.prototype.show=function(t){this.skinName||(this.skinName=decrees.PanelDecreePrinceOpenSkin),this.popup(t)},e.prototype.render=function(t){this.labPrinceName.text=t.name,this.labPrinceName.textColor=GameConfig.QUALITY_COLORS[t.quality],this.labPeerage.text=lang.prince_peerage[t.peerage]},e}(PanelDecreeBase);__reflect(PanelDecreePrinceOpen.prototype,"PanelDecreePrinceOpen");var PanelDecreeRise=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=ResNames.princess_position_decree_title},e.prototype.show=function(t){this.skinName||(this.skinName=decrees.PanelDecreeRiseSkin),this.popup(t)},e.prototype.render=function(t){var e=t.princess;
this.labName.text=e.meta.name,this.labPosition.text=lang.princess_positions[e.position]},e}(PanelDecreeBase);__reflect(PanelDecreeRise.prototype,"PanelDecreeRise");var PanelDispatchForArena=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterMinister=function(t){return t.filter(function(t){return t.level>=50}).sort(function(t,e){return e.battleValue-t.battleValue>0?e.battleValue-t.battleValue:e.meta.quality-t.meta.quality})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.active=function(){this.selectMinister.refresh("arena","battleValue",this.filterMinister),t.prototype.active.call(this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.currentState="arena",[2]}})})},e}(PanelDispatchMinister);__reflect(PanelDispatchForArena.prototype,"PanelDispatchForArena");var PanelDispatchForBattle=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterMinister=function(t){return t.filter(function(t){return t.state<=0}).sort(function(t,e){return e.command-t.command})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.active=function(){this.selectMinister.refresh("battle","command",this.filterMinister),t.prototype.active.call(this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.currentState="battle",[2]}})})},e}(PanelDispatchMinister);__reflect(PanelDispatchForBattle.prototype,"PanelDispatchForBattle");var PanelDispatchForClass=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.filterMinister=function(t){return t.filter(function(t){var i=GameConfig.getClassMeta(e.id);return t.exploit<i.cost_meritorious?!1:e.id+1==t.grade?!0:!1})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateInfo=function(e){void 0===e&&(e=null),t.prototype.updateInfo.call(this,e);var i=this.selectMinister.selectedMinister},e.prototype.getData=function(){var e=t.prototype.getData.call(this);return e},e.prototype.active=function(){this.selectMinister.refresh("exploit","grade",this.filterMinister),t.prototype.active.call(this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.id=e,this.currentState="class",[2]}})})},e}(PanelDispatchMinister);__reflect(PanelDispatchForClass.prototype,"PanelDispatchForClass");var PanelDispatchForDuplicate=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._type=0,e.filterMinister=function(t){var i=[];switch(t.forEach(function(t){var e=!1;bossService.boss.ministers.some(function(i){return i&&i.id==t.id?(e=!0,!0):void 0}),e||i.push(t)}),e._type){case 0:return i.sort(function(t,e){return e.level-t.level!=0?e.level-t.level:e.meta.quality-t.meta.quality});case 1:return i.sort(function(t,e){return e.politics-t.politics!=0?e.politics-t.politics:e.meta.quality-t.meta.quality});case 2:return i.sort(function(t,e){return e.knowledge-t.knowledge!=0?e.knowledge-t.knowledge:e.meta.quality-t.meta.quality});case 3:return i.sort(function(t,e){return e.command-t.command!=0?e.command-t.command:e.meta.quality-t.meta.quality})}},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=new eui.RadioButtonGroup;this.btnLevel.group=e,this.btnKnowledge.group=e,this.btnCommand.group=e,this.btnPolitics.group=e,this.registerEvent(e,eui.UIEvent.CHANGE,this.onGroupChange,this)},e.prototype.init=function(){this.title=lang.panel_select_minister},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.currentState="duplicate",[2]}})})},e.prototype.active=function(){this.ministerRefresh(),t.prototype.active.call(this)},e.prototype.ministerRefresh=function(){this.selectMinister2.refresh("tech",["politics","knowledge","command"],this.filterMinister)},e.prototype.onGroupChange=function(t){this._type=parseInt(t.target.selectedValue),this.ministerRefresh()},e}(PanelDispatchMinister2);__reflect(PanelDispatchForDuplicate.prototype,"PanelDispatchForDuplicate");var PanelDispatchForInterior=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=0,e.types=["trade","industry","military"],e.filterMinister=function(t){return t=t.filter(function(t){return t.state<=0}),t.sort(function(t,e){return e.politics-t.politics})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateInfo=function(e){void 0===e&&(e=null),t.prototype.updateInfo.call(this,e);var i=this.selectMinister.selectedMinister},e.prototype.getData=function(){var e=t.prototype.getData.call(this);return e.type=this.type,e},e.prototype.active=function(){this.selectMinister.refresh(this.types[this.type],"politics",this.filterMinister),t.prototype.active.call(this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.type=e,this.currentState="interior",[2]}})})},e}(PanelDispatchMinister);__reflect(PanelDispatchForInterior.prototype,"PanelDispatchForInterior");var PanelDispatchForOffice=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterMinister=function(t){return t.filter(function(t){return t[e.field]>=e.position.condition_value&&0==t.position})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnRecall,egret.TouchEvent.TOUCH_TAP,this.onBtnRecallTap,this),this.registerEvent(ministerService,EventNames.UPDATE_MINISTER_POSITION,this.onUpdateMinisterPosition,this)},e.prototype.onUpdateMinisterPosition=function(t){this.updateUI()},e.prototype.onBtnRecallTap=function(t){ministerService.recall(this.position.id)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.position=e.position,this.currentState="office",[2]}})})},e.prototype.updateUI=function(){var t,e=this.position,i=ministerService.getPositionDataById(e.id);i&&(t=ministerService.getMinisterById(i.ministerId)),this.labPositionName.text=e.name,this.labNeeds.text=lang.minister_info_fields[MinisterEntity.abilityClassifyFields[e.condition_type-1]]+" "+e.condition_value,this.labUse.text=GameConfig.getSkillEffectStrs(e.skill,1).join("\n"),this.labLevel.text=t?t.meta.name:lang.nothing,this.labLevel.textColor=t?GameConfig.QUALITY_COLORS[t.meta.quality]:6102788,this.btnRecall.visible=i,this.avatar.id=t?t.meta.icon:null,this.selectMinister.refresh(this.field,this.field,this.filterMinister)},e.prototype.active=function(){this.field=MinisterEntity.abilityClassifyFields[this.position.condition_type-1],this.selectMinister.refresh(this.field,this.field,this.filterMinister),t.prototype.active.call(this),this.updateUI()},e}(PanelDispatchMinister);__reflect(PanelDispatchForOffice.prototype,"PanelDispatchForOffice");var PanelDispatchForRite=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterMinister=function(t){return t.sort(function(t,e){return e.knowledge-t.knowledge})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_select_rite_minister},e.prototype.active=function(){this.selectMinister.refresh("rite","knowledge",this.filterMinister),t.prototype.active.call(this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.currentState="rite",[2]}})})},e}(PanelDispatchMinister);__reflect(PanelDispatchForRite.prototype,"PanelDispatchForRite");var PanelDispatchForTechnology=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._type=0,e.filterMinister=function(t){var i=[];activityTimeService.getActivityTimesByIds(technologyService.techActivityTime);switch(t.forEach(function(t,e){t.state<=0&&i.push(t)}),e._type){case 0:return i.sort(function(t,e){return e.knowledge-t.knowledge!=0?e.knowledge-t.knowledge:e.meta.quality-t.meta.quality});case 1:var n=MinisterEntity.developmentSkills.tech;return i.sort(function(t,e){return e.getSkillLevel(n[0])-t.getSkillLevel(n[0])!=0?e.getSkillLevel(n[0])-t.getSkillLevel(n[0]):e.getSkillLevel(n[1])-t.getSkillLevel(n[1])!=0?e.getSkillLevel(n[1])-t.getSkillLevel(n[1]):e.knowledge-t.knowledge})}},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnRaise,egret.TouchEvent.TOUCH_TAP,this.onBtnRaiseTap,this),this.registerEvent(this.btnMore,egret.TouchEvent.TOUCH_TAP,this.onBtnMoreTap,this);var e=new eui.RadioButtonGroup;this.btnLevel.group=e,this.btnKnowledge.group=e,this.registerEvent(e,eui.UIEvent.CHANGE,this.onGroupChange,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this._techData=e,this.currentState="technology",this.updateUI(),[2]}})})},e.prototype.updateUI=function(){this.technologyItem.technologyInfo=this._techData;var t=technologyService.getById(this._techData.id),e=0;if(t&&(e=t.level),0==e)this.labTechEffect.text=lang.nothing;else{var i=GameConfig.getTechLevelMeta(t.id,e),n=GameConfig.getBufferMeta(i.effect);n&&(this.labTechEffect.text=lang.format(n.intro,Math.abs(n.value)))}var r=e+1,o=GameConfig.getTechLevelMeta(t.id,r),s=GameConfig.getBufferMeta(o.effect);this.labNextEffect.text=lang.format(s.intro,Math.abs(s.value)),this.labLevel.text=e+"/"+this._techData.levels[this._techData.levels.length-1].level+lang.lv,this.labNeeds.text=lang.tech_knowledge_needs+this._techData.levels[r].cost_knowledge;var a=mainService.playerInfo.mineral<this._techData.levels[r].cost_mineral?"ff0000":"49AD01";this.labUse.textFlow=lang.formatHtml(lang.tech_mineral_needs,a,wsy.Utils.shortCurrency(mainService.playerInfo.mineral),wsy.Utils.shortCurrency(this._techData.levels[r].cost_mineral)),this.labTime.text=this._techData.levels[r].cost_time+lang.minutes},e.prototype.active=function(){this.ministerRefresh(),t.prototype.active.call(this),this.updateUI()},e.prototype.onBtnRaiseTap=function(t){this.dealAction(),SceneController["goto"](ConstantNames.SCENE_MINISTER)},e.prototype.onBtnMoreTap=function(t){this.dealAction(),SceneController["goto"](ConstantNames.SCENE_INTERIOR)},e.prototype.ministerRefresh=function(){var t=technologyService.getById(this._techData.id),e=0;t&&(e=t.level),e++,technologyService.needValue=this._techData.levels[e].cost_knowledge,this.selectMinister.refresh("tech","knowledge",this.filterMinister)},e.prototype.onGroupChange=function(t){this._type=parseInt(t.target.selectedValue),this.ministerRefresh()},e.prototype.onRemovedFromStage=function(t){technologyService.needValue=0},e}(PanelDispatchMinister);__reflect(PanelDispatchForTechnology.prototype,"PanelDispatchForTechnology");var alien;!function(t){var e=function(){function t(){this.clear()}return t.prototype.containsKey=function(t){return t in this.obj},t.prototype.containsValue=function(t){for(var e in this.obj)if(this.obj[e]==t)return!0;return!1},t.prototype.put=function(t,e){this.containsKey(t)||(this.obj[t]=e,this._length++)},t.prototype.get=function(t){return this.containsKey(t)?this.obj[t]:null},t.prototype.remove=function(t){if(this.containsKey(t)){var e=this.obj;return delete this.obj[t],this._length--,e}return null},t.prototype.foreach=function(t,e){for(var i in this.obj)if(!t.call(e,i,this.obj[i]))break},t.prototype.randomGet=function(){var t=this.valueSet;return t[Math.floor(Math.random()*t.length)]},Object.defineProperty(t.prototype,"keySet",{get:function(){var t=[];for(var e in this.obj)t.push(e);return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueSet",{get:function(){var t=[];for(var e in this.obj)t.push(this.obj[e]);return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._length},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._length=0,this.obj={}},t}();t.HashMap=e,__reflect(e.prototype,"alien.HashMap")}(alien||(alien={}));var PanelSelectMinister=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterMinister=function(t){return t.sort(function(t,e){return e.level-t.level})},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_select_minister},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(ministerService,EventNames.UPDATE_MINSTER,this.onUpdateMinister,this)},e.prototype.updateInfo=function(t){void 0===t&&(t=null),this.selectMinister.selectedMinister=t.data.minister;var e=this.selectMinister.selectedMinister;if(e){var i=e;PanelUseItem.instance.show({itemData:this._itemData,target:i})}},e.prototype.active=function(){this.selectMinister.refresh(this.type,"level",this.filterMinister),t.prototype.active.call(this)},e.prototype.show=function(e,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,t.prototype.show.call(this,e,i)];case 1:return n.sent(),this.type=e.type,this.currentState="select",this._itemData=e.itemData,[2]}})})},e.prototype.onUpdateMinister=function(t){this.active()},e}(PanelDispatchMinister);__reflect(PanelSelectMinister.prototype,"PanelSelectMinister");var PanelMinisterDetails=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.minister_details},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelMinisterDetailsSkin),[4,this.popup()];case 1:return i.sent(),e.minister=t.minister,this._dataProvider.source=MinisterEntity.abilityClassifyFields,this.labAll.text=lang.minister_all_ability+":"+t.minister.getAllAbility(),[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRAbilityClassify,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e}(CommonPanelBase);__reflect(PanelMinisterDetails.prototype,"PanelMinisterDetails");var IRAbilityClassify=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRAbilityField,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection},e.prototype.dataChanged=function(){var e=this;t.prototype.dataChanged.call(this);var i=PanelMinisterDetails.minister;this.label.text=lang.minister_info_fields[this.data]+":"+i.getClassifyAbility(this.data);var n=MinisterEntity.abilityFields.map(function(t){return{field:t,classify:e.data}});this._dataProvider.source=n},e}(eui.ItemRenderer);__reflect(IRAbilityClassify.prototype,"IRAbilityClassify");var IRAbilityField=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=PanelMinisterDetails.minister;this.label.text=lang.minister_ability_fields[this.data.field]+":"+e.getAbility(this.data.classify,this.data.field)},e}(eui.ItemRenderer);__reflect(IRAbilityField.prototype,"IRAbilityField");var PanelMinisterHireSuccess=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.show=function(t){var e=t.meta;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelMinisterHireSuccessSkin),[4,this.popup(this.dealAction)];case 1:return t.sent(),this.labName.text=e.name,this.labPolitics.text=e.init_politics_grow.toString(),this.labKnowledge.text=e.init_knowledge_grow.toString(),this.labCommand.text=e.init_command_grow.toString(),this.imgBody.source=MinisterEntity.parseBodyUrl(e.icon),this.labQuality.text=lang.minister_quality_name[e.quality],this.labQuality.textColor=GameConfig.MINISTER_QUALITY_COLORS_2[e.quality],this.labSum.text=e.init_command_grow+e.init_knowledge_grow+e.init_politics_grow,[2]}})})},e.prototype.onTap=function(t){this.dealAction()},e}(PanelBase);__reflect(PanelMinisterHireSuccess.prototype,"PanelMinisterHireSuccess");var PanelMinisterInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgMinister.mask=this.mask,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.show=function(t){var e=t.meta;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelMinisterInfoSkin),[4,this.popup()];case 1:return t.sent(),this.imgMinister.source=MinisterEntity.parseBodyUrl(e.icon),this.imgMinister.x=180-.8*e.body_offset.x,this.imgMinister.y=.8*e.body_offset.y,this.labName.text=e.name,this.labName.textColor=GameConfig.QUALITY_COLORS[e.quality],this.labIntro.text=e.intro,this.labQuality.text=lang.minister_quality_name[e.quality],this.labQuality.textColor=GameConfig.MINISTER_QUALITY_COLORS_2[e.quality],this.labPolitics.text=e.init_politics_grow.toString(),this.labKnowledge.text=e.init_knowledge_grow.toString(),this.labCommand.text=e.init_command_grow.toString(),this.labSum.text=e.init_command_grow+e.init_knowledge_grow+e.init_politics_grow,[2]}})})},e}(PanelBase);__reflect(PanelMinisterInfo.prototype,"PanelMinisterInfo");var PanelMinisterSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.minister_skill},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.listCurrent.itemRenderer=IRSkillEffect,this.listNext.itemRenderer=IRNextSkillEffect,this.listCurrent.dataProvider=this._currentData=new eui.ArrayCollection,this.listNext.dataProvider=this._nextData=new eui.ArrayCollection,this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDSKILL_Response,this.updateUI,this)},e.prototype.onBtnConfirmTap=function(t){ministerService.learnSkill(this.minister,this.skill)},e.prototype.updateUI=function(t){void 0===t&&(t=null);var e=this.skill,i=this.minister.getAdditionSkillLevel(e.id),n=this.minister,r=GameConfig.getSkillMeta(e.metaId),o=(GameConfig.getSkillLevelMeta(e.id,e.level),GameConfig.getSkillLevelMeta(e.id,e.level+1)),s=GameConfig.getSkillLevelMeta(e.id,e.level+i),a=GameConfig.getSkillLevelMeta(e.id,e.level+1+i),c=o&&o.success_rate>0;this.icon.metaId=r.id;var l=i>0?"(+"+i+")":"";this.labLevel.text=lang.skill_level+" : "+e.level+l,this._currentData.source=s?s.buffers.filter(function(t){return t>0}):[0],this._nextData.source=a?a.buffers.filter(function(t){return t>0}):[0],this.labSuccessRate.text=o?lang.format(lang.success_rate,o.success_rate+n.getSkillFailCountBySkillId(e.id)):"",this.btnConfirm.enabled=c,this._dataProvider.source=c?o.condition:[],this.labNotice.visible=!c},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return this.skinName||(this.skinName=panels.PanelMinisterSkillSkin),[4,this.popup()];case 1:return n.sent(),e=t.skill,i=t.minister,this.skill=e,this.minister=i,this.updateUI(),[2]}})})},e.prototype.onClose=function(){t.prototype.onClose.call(this),Toast.clean()},e}(CommonPanelBase);__reflect(PanelMinisterSkill.prototype,"PanelMinisterSkill");var IRSkillEffect=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),0==this.data)this.label.text=lang.nothing;else{var e=GameConfig.getBufferMeta(this.data);this.render(e)}},e.prototype.render=function(t){this.label.text=lang.format(t.intro,Math.abs(t.value))},e}(eui.ItemRenderer);__reflect(IRSkillEffect.prototype,"IRSkillEffect");var IRNextSkillEffect=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.render=function(t){this.label.textFlow=wsy.Utils.makeColorFraction(t.intro,lang.count,Math.abs(t.value),0)},e}(IRSkillEffect);__reflect(IRNextSkillEffect.prototype,"IRNextSkillEffect");var PanelPrinceAppoint=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ministerList=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_prince_appoint},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return this.skinName||(this.skinName=panels.PanelPrinceAppointSkin),this.filterMinister(),this.princeData=t,[4,this.popup(e)];case 1:return i.sent(),this._dataProvider.source=this.ministerList,this.ministerList.length>0?(this.labEmpty.visible=!1,this.selectedMinister=this._dataProvider.source[0]):this.labEmpty.visible=!0,[2]}})})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRMinisterForAppoint,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(alien.Dispatcher,EventNames.PRINCE_TEACHER_APPOINT,this.onSelectMinister,this)},e.prototype.updateInfo=function(t){void 0===t&&(t=null)},e.prototype.filterMinister=function(){var t=this;this.ministerList.splice(0),ministerService.ministers.forEach(function(e){var i=princeService.getByMinisterId(e.id);i&&1!=i.openFlag||t.ministerList.push(e)}),this.ministerList.sort(function(t,e){return e.meta.quality-t.meta.quality})},e.prototype.onSelectMinister=function(t){this.selectedMinister=t.data.minister,this.dealAction("select",this.getData())},e.prototype.getData=function(){return{prince:this.princeData,minister:this.selectedMinister}},e.prototype.onBtnAppointTap=function(t){this.dealAction("select",this.getData())},e.prototype.active=function(){t.prototype.active.call(this)},e}(CommonPanelBase);__reflect(PanelPrinceAppoint.prototype,"PanelPrinceAppoint");var IRMinisterForAppoint=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSelect,egret.TouchEvent.TOUCH_TAP,this.onBtnSelectTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.meta;this.avatar.id=i.icon,this.labName.text=i.name,this.imgNameIcon.source="icon_name_icon_"+i.quality,this.labName.textColor=GameConfig.QUALITY_COLORS[i.quality],this.labPolitics.text=e.politics.toString(),this.labKnowledge.text=e.knowledge.toString(),this.labLeader.text=e.command.toString()},e.prototype.onBtnSelectTap=function(t){var e=this.data;alien.Dispatcher.dispatch(EventNames.PRINCE_TEACHER_APPOINT,{minister:e})},e}(alien.VisualEventItemRenderer);__reflect(IRMinisterForAppoint.prototype,"IRMinisterForAppoint");var PanelPrinceNotice=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this)},e.prototype.init=function(){},e.prototype.show=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,r,o;return __generator(this,function(s){switch(s.label){case 0:return this.skinName||(this.skinName=panels.PanelPrinceNoticeSkin),this.skinType=2,[4,this.popup(e)];case 1:return s.sent(),i=this._data=t,n=i.prince,r=i.minister,o=i.content,o?this.labContent.text=o:r?this.labContent.textFlow=[{text:lang.prince_teacher_notice[0],style:{textColor:5184512}},{text:r.meta.name,style:{textColor:GameConfig.MINISTER_QUALITY_COLORS[r.meta.quality]}},{text:lang.prince_teacher_notice[1],style:{textColor:5184512}},{text:n.name,style:{textColor:GameConfig.QUALITY_COLORS[n.quality]}},{text:lang.prince_teacher_notice[2],style:{textColor:5184512}}]:this.labContent.textFlow=[{text:lang.prince_exile_notice[0],style:{textColor:5184512}},{text:n.name,style:{textColor:GameConfig.QUALITY_COLORS[n.quality]}},{text:lang.prince_exile_notice[1],style:{textColor:5184512}},{text:lang.player_info_fields.silver+1e3*n.politics+","+lang.player_info_fields.mineral+10*n.knowledge+","+lang.player_info_fields.troops+10*n.command,style:{textColor:GameConfig.COLORS.green}}],[2]}})})},e.prototype.onGrpButtonsTap=function(t){this.dealAction(t.target.name,this._data)},e}(CommonPanelBase);__reflect(PanelPrinceNotice.prototype,"PanelPrinceNotice");var PanelPrinceOpen=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._metaIdList=[1,600089],e._itemList=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRItemUse,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.TouchEvent.TOUCH_TAP,this.onSelectItem,this)},e.prototype.init=function(){this.title=lang.panel_prince_open},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelPrinceOpenSkin),this.prince=t,this.setItemList(),[4,this.popup()];case 1:return e.sent(),this.update(),[2]}})})},e.prototype.setItemList=function(){var t=this;this._itemList.splice(0,this._itemList.length),this._metaIdList.forEach(function(e){var i=new ItemEntity,n="";packService.getItemByMetaId(e)&&(n=packService.getItemByMetaId(e).id),i.inject({metaId:e,count:packService.getCountByMetaId(e),id:n});var r=0;r=1==i.metaId?t.prince.getOpenCost().gold:t.prince.getOpenCost().openOrder;var o={item:i,cost:r};t._itemList.push(o)})},e.prototype.update=function(){this._dataProvider.source=this._itemList,this.labName.text=this.prince.name,this.labName.textColor=GameConfig.QUALITY_COLORS[this.prince.quality],this.ministerItem.setPrince(this.prince)},e.prototype.onSelectItem=function(t){if("btnUse"==t.target.name){var e=this.list.selectedItem.item,i=0;i=1==e.metaId?0:1,princeService.openHouse(this.prince.id,i),this.close()}},e}(CommonPanelBase);__reflect(PanelPrinceOpen.prototype,"PanelPrinceOpen");var IRItemUse=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.item,i=this.data.cost,n=this.data.item.meta;this.itemView.metaId=e.metaId,this.itemView.hideCount=!0,this.labName.text=n.name,this.labName.textColor=GameConfig.QUALITY_COLORS[n.quality],e.count<i?this.btnUse.enabled=!1:this.btnUse.enabled=!0,this.labCost.text=wsy.Utils.shortCurrency(i),this.labCount.text=wsy.Utils.shortCurrency(e.count)},e}(alien.VisualEventItemRenderer);__reflect(IRItemUse.prototype,"IRItemUse");var PanelPrincePeerage=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelPrincePeerageSkin),[4,this.popup()];case 1:return e.sent(),this.update(t),[2]}})})},e.prototype.update=function(t){this.imgPrince.source=t.getIconUrl(),this.imgPeerage.source="prince_peerage_"+t.peerage,this.labName.text=t.name,this.labName.textColor=GameConfig.MINISTER_QUALITY_COLORS_2[t.quality],this.labPrincess.text=princessService.getById(t.princessId).meta.name,this.labProperty.text=t.politics+t.knowledge+t.command+"",this.labPolitics.text=t.politics+"",this.labKnowledge.text=t.knowledge+"",this.labCommand.text=t.command+""},e}(PanelBase);__reflect(PanelPrincePeerage.prototype,"PanelPrincePeerage");var PanelPrinceRename=function(t){function e(){return null!==t&&t.apply(this,arguments)||this
}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSure,egret.TouchEvent.TOUCH_TAP,this.onBtnSureClick,this),this.registerEvent(this.btnDice,egret.TouchEvent.TOUCH_TAP,this.onBtnDiceClick,this),this.registerEvent(this,egret.Event.REMOVED_FROM_STAGE,this.onRemoveStage,this),this.registerEvent(gameServer,protocols.WC_PRICESS_RENAME_RESPONSE,this.onRenameResponse,this)},e.prototype.init=function(){this.title=lang.panel_prince_rename},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelPrinceRenameSkin),this.prince=t,[4,this.popup()];case 1:return e.sent(),this.labCost.text="X10",this.tiName.text=GameConfig.princeRandomName(),[2]}})})},e.prototype.onRemoveStage=function(t){this.tiName.text=""},e.prototype.onBtnSureClick=function(t){var e=GameConfig.judgeString(this.tiName.text);e?princeService.rename(this.prince.id,this.tiName.text):Toast.show({text:lang.input_error})},e.prototype.onBtnDiceClick=function(t){this.tiName.text=GameConfig.princeRandomName()},e.prototype.onRenameResponse=function(t){t.data.error>0||this.close()},e}(CommonPanelBase);__reflect(PanelPrinceRename.prototype,"PanelPrinceRename");var PanelPrincessImage=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prince=null,e._type=0,e._playing=!0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=egret.MainContext.instance.stage;this.height=e.stageHeight,this.width=e.stageWidth,this.imgBody.mask=this.bodyMask,this.registerEvent(princessService,EventNames.UPDATE_PRINCESS,this.onUpdatePrincess,this),this.registerEvent(princeService,EventNames.ADD_PRINCE,this.onAddPrince,this),this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.close,this)},e.prototype.show=function(t){var e=t.princess,i=t.type,n=void 0===i?0:i;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.princess=e,this._type=n,this._playing=!0,this.skinName||(this.skinName=panels.PanelPrincessImageSkin),[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),0==this._type?princessService.choosePrincess(PanelPrincessTurnCard.PRINCESS_CHOOSE_TYPE.AGREE):princessService.luck(this.princess)},e.prototype.close=function(){this._playing||(this.imgBody.source="",this.imgBody.alpha=0,t.prototype.close.call(this))},e.prototype.onUpdatePrincess=function(t){var e=t.data.princess;this.play(e)},e.prototype.play=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n=this;return __generator(this,function(r){switch(r.label){case 0:return e=this.princess.meta,i=this.imgBody,i.alpha=0,this.labName.text=e.name,i.source=PrincessEntity.parseBodyUrl(e.icon),i.x=490-e.body_offset.x*i.scaleX,i.y=200-e.body_offset.y*i.scaleY,[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(i).to({alpha:1},500,egret.Ease.circInOut))];case 1:return r.sent(),[4,egret.Tween.get(i).call(function(){var e=n.rect;t.fieldsModified.forEach(function(t){t.value>t.oldValue&&lang.princess_info_fields[t.field]&&alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.princess_info_fields[t.field]+"+"+(t.value-t.oldValue),component:e})})}).wait(300).call(function(){n.prince&&(PanelPrinceBorn.instance.show({prince:n.prince}),n.prince=null),n._playing=!1})];case 2:return r.sent(),[2]}})})},e.prototype.animationEnd=function(t){var e=this.rect;t.fieldsModified.forEach(function(t){t.value>t.oldValue&&lang.princess_info_fields[t.field]&&alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.princess_info_fields[t.field]+"+"+(t.value-t.oldValue),component:e})})},e.prototype.onAddPrince=function(t){this.prince=t.data.prince},e}(PanelBase);__reflect(PanelPrincessImage.prototype,"PanelPrincessImage");var PanelPrincessManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPrincessManager,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_BESTOWED_PRINCESS_Response,this.onPrincessManageResponse,this)},e.prototype.onPrincessManageResponse=function(t){if(0==t.data.error){this.updateUI();var e=t.data,i=e.prvPosition,n=e.curPosition,r=e.princessId;n>i&&(this.dealAction(),PanelDecreeRise.instance.show({princess:princessService.getById(r)}))}},e.prototype.init=function(){this.title=lang.panel_princess_manager},e.prototype.updateUI=function(){var t=princessService.getPositionManageSource(e.groupConfig);this.currentState=t.length>0?"normal":"empty",t.length>0&&(this._dataProvider.source=t)},e.prototype.show=function(t){var i=t.groupConfig;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelPrincessManagerSkin),[4,this.popup()];case 1:return t.sent(),e.groupConfig=i,this.updateUI(),[2]}})})},e}(CommonPanelBase);__reflect(PanelPrincessManager.prototype,"PanelPrincessManager");var IRPrincessManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.registerEvent(this.btnOperate,egret.TouchEvent.TOUCH_TAP,this.onBtnOperateTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgBg.source=PrincessEntity.parseBgUrl(this.itemIndex);var e=this.data,i=e.meta,n=this.imgBody;this.labName.text=i.name,n.source=e.bodyUrl,n.x=220-i.body_offset.x*n.scaleX,n.y=20-i.body_offset.y*n.scaleY,this.labRite.text=lang.princess_info_fields.rite+":"+e.rite.toString(),this.btnOperate.skinName=this.isOn?ui.FallButtonSkin:ui.RiseButtonSkin},Object.defineProperty(e.prototype,"isOn",{get:function(){var t=this.data,e=PanelPrincessManager.groupConfig;return t.position==e.index},enumerable:!0,configurable:!0}),e.prototype.onBtnOperateTap=function(t){var e=PanelPrincessManager.groupConfig;return!this.isOn&&princessService.getPositionIsFull(e)?void Toast.show({text:lang.response_error[40]}):void princessService.positionManage(this.data,this.isOn?0:e.index)},e}(alien.VisualEventItemRenderer);__reflect(IRPrincessManager.prototype,"IRPrincessManager");var PanelPrincessPartyDispatch=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.second=30,e._cdId=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){},e.prototype.getSkinName=function(){return panels.PanelPrincessPartyDispatchSkin},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinType=2,[4,this.popup()];case 1:return t.sent(),this.container.btnClose.visible=!1,this.update(),[2]}})})},e.prototype.update=function(){var t=this;this.second=30,this.labTime.text=this.second+"",this._cdId=egret.setInterval(function(){t.second--,t.labTime.text=t.second+"",t.second<=0&&egret.clearInterval(t._cdId)},this,1e3)},e.prototype.inactive=function(){t.prototype.inactive.call(this),egret.clearInterval(this._cdId)},e}(CommonPanelBase);__reflect(PanelPrincessPartyDispatch.prototype,"PanelPrincessPartyDispatch");var PanelPrincessSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(alien.Dispatcher,EventNames.PRINCESS_SKILL_UPGRADE_GO,this.goGoal,this)},e.prototype.init=function(){this.title=lang.panel_princess_skill},e.prototype.show=function(t){var i=t.princess;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelPrincessSkillSkin),e.princess=i,[4,this.popup()];case 1:return t.sent(),this._dataProvider.source=i.skills,[2]}})})},e.prototype.goGoal=function(t){var e=t.data.field;switch(e){case"rite":SceneController.jump(ConstantNames.SCENE_PRINCESS_RITE);break;case"culture":SceneController.jump(ConstantNames.SCENE_GARDEN_FLOWER);break;case"battle":SceneController.jump(ConstantNames.SCENE_PRINCESS_WORK);break;case"luck":break;case"charm":break;case"position":}this.close()},e}(CommonPanelBase);__reflect(PanelPrincessSkill.prototype,"PanelPrincessSkill");var IRPrincessSkill=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this)},e.prototype.setData=function(t){this.data=t;var e=PanelPrincessSkill.princess,i=GameConfig.getSkillMeta(t.metaId),n=i.levels[t.level+1];this.currentState=0==t.level?"level0":n?"level1":"levelMax",this.labLevel.text=i.name+" Lv."+(n?t.level:"MAX"),this.labLevel.textColor=GameConfig.OPEN_COLORS[0==t.level?0:1];var r=t.level>0?"upgrade":"open";if(this.btnGo.visible=!!n,n){var o=PrincessEntity.skillUpgradeItemMap[n.condition[0].id];this.labCondition.textFlow=lang.formatHtml(lang["skill_"+r+"_condition"],lang.princess_info_fields[o],n.condition[0].count),this.labNextEffect.text=e.getSkillEffect(t,t.level+1),this.btnGo.label=lang.upgrade+lang.princess_info_fields[o]}else this.labCondition.text=lang.level_max;this.labEffect.text=e.getSkillEffect(t,t.level)},e.prototype.onBtnGoTap=function(t){var e=GameConfig.getSkillMeta(this.data.metaId),i=e.levels[this.data.level+1],n=PrincessEntity.skillUpgradeItemMap[i.condition[0].id];alien.Dispatcher.dispatch(EventNames.PRINCESS_SKILL_UPGRADE_GO,{field:n})},e}(alien.VisualEventItemRenderer);__reflect(IRPrincessSkill.prototype,"IRPrincessSkill");var PanelPrincessTurnCard=function(t){function e(){var i=t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this;return i.changeCnt=0,i.canSelect=!0,i._princesses=[],i._selectedIndex=-1,i.cdId=0,i.onUnhappyResult=function(t){if("confirm"==t){if(1==i.canSelect)return;princessService.choosePrincess(e.PRINCESS_CHOOSE_TYPE.REFUSE)}},i.onSecond=function(t){if(0>=t)return i.cdId=0,void i.onRefresh();var e=princessService.getTurnCardEnergy();i.labEnergy.textFlow=lang.formatHtml(lang.energy+e+"/"+princessService.getMaxEnergy()+" <font color='#A2FF66'>("+alien.TimeUtils.timeFormat(t,"{1}:{0}")+")</font> "),i.btnAdd.x=i.labEnergy.x+i.labEnergy.width+i.btnAdd.width/2+10},i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=egret.MainContext.instance.stage;this.height=e.stageHeight,this.width=e.stageWidth,this.list.itemRenderer=IRPriChoose,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectPrincess,this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.close,this),this.registerEvent(this.btnAdd,egret.TouchEvent.TOUCH_TAP,this.onBtnAddClick,this),this.registerEvent(gameServer,protocols.WC_TURNCARD_PRINCESS_Response,this.onTurnCardResponse,this),this.registerEvent(gameServer,protocols.WC_CHOOSE_PRINCESS_Response,this.onChoosePrincessResponse,this),this.registerEvent(princessService,EventNames.REFRESH_TURN_CARD_DATA,this.onRefresh,this),this.registerEvent(this.btnHelp,egret.TouchEvent.TOUCH_TAP,this.onBtnHelpTap,this),this._wave=new alien.Wave(this.btnAdd,2e3,alien.Wave.zoom.bind(null,.05),0,!1,!1,0,Math.random()*Math.PI)},e.prototype.setPrincessDefault=function(){this.changeCnt=0,this.btnChange.enabled=!0,this._princesses=[];for(var t=0;6>t;++t)this._princesses.push(null);1==this.canSelect?(this.grpTip.visible=!0,this.grpBtn.visible=!1):(this.grpTip.visible=!1,this.grpBtn.visible=!0),this._dataProvider.source=this._princesses},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelPrincessTurnCardSkin),this._dataProvider&&(this.canSelect=!0,this.setPrincessDefault()),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.setPrincessDefault(),this.onRefresh()},e.prototype.inactive=function(){t.prototype.inactive.call(this),this._wave.stop()},e.prototype.close=function(){0!=this.canSelect&&(this.setPrincessDefault(),this.grpTip.visible=!0,this.labCost.text="(        "+5*(1+this.changeCnt)+")",t.prototype.close.call(this))},e.prototype.onSureBtnClick=function(t){princessService.choosePrincess(e.PRINCESS_CHOOSE_TYPE.AGREE)},e.prototype.onChangeBtnClick=function(t){PanelUseThingAlert.instance.show({content:lang.unhappy_alert_content,id:1,count:5*(1+this.changeCnt)},this.onUnhappyResult)},e.prototype.onBtnAddClick=function(t){PanelAddPower.instance.show([600056,600057,600058],null)},e.prototype.onSelectPrincess=function(t){if(t.preventDefault(),!(princessService.princesses.length<=0)&&0!=this.canSelect){var e=princessService.getTurnCardEnergy();return 0>=e?void Toast.show({text:lang.response_error[37]}):void(this._princesses[this.list.selectedIndex]||(princessService.turnCard(),this.canSelect=!1,this._selectedIndex=this.list.selectedIndex))}},e.prototype.onTurnCardResponse=function(t){t.data.error>0||(this._princesses[this._selectedIndex]=princessService.getById(t.data.id),this._princesses[this._selectedIndex].canRotation=!0,this._dataProvider.source=this._princesses,this.grpTip.visible=!1,this.labCost.text="(        "+5*(1+this.changeCnt)+")")},e.prototype.onRefresh=function(t){void 0===t&&(t=null);var e=princessService.getTurnCardEnergy(),i=activityTimeService.getById(princessService.energyId);this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0),i&&i.timestamp-mainService.tsServer>0&&e<princessService.getMaxEnergy()?this.cdId=countDownService.register(i.timestamp,this.onSecond.bind(this)):this.labEnergy.textFlow=lang.formatHtml(lang.energy+e+"/"+princessService.getMaxEnergy()),0>=e?this._wave.play():this._wave.stop(),this.btnAdd.x=this.labEnergy.x+this.labEnergy.width+this.btnAdd.width/2+10},e.prototype.onBtnHelpTap=function(t){PanelRuleIntro.instance.show({contents:lang.help.princess_turn_card_rules})},e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e.prototype.onChoosePrincessResponse=function(t){this.canSelect=!0,t.data.error>0||this.setPrincessDefault()},e.prototype.initScene=function(){},e.PRINCESS_CHOOSE_TYPE={AGREE:0,REFUSE:1},e}(PanelBase);__reflect(PanelPrincessTurnCard.prototype,"PanelPrincessTurnCard");var IRPriChoose=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.getOver=function(){return this.imgOver.visible},e.prototype.setOver=function(t){this.imgOver.visible=t},e.prototype.setMask=function(t){this.bodyMask.visible=t,t?this.bodyMask.alpha=.5:this.bodyMask.alpha=1},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;if(!e)return this.imgOver.visible=!0,void this.setMask(!1);var i=e.meta;this.labName.text=i.name,this.imgBody.source=PrincessEntity.parseBodyUrl(i.icon),this.imgBody.x=this.grp.width/2-i.body_offset.x*this.imgBody.scaleX,this.imgBody.y=20-i.body_offset.y*this.imgBody.scaleY,this.imgBody.mask=this.bodyMask,e.canRotation&&this.grp.anchorOffsetX!=this.grp.width/2&&(this.grp.anchorOffsetX=this.grp.width/2,this.grp.x=this.grp.x+this.grp.width/2,egret.Tween.get(this.grp).to({scaleX:0},250).call(function(){this.imgOver.visible=!1},this).to({scaleX:1},250).call(function(){this.grp.anchorOffsetX=0,this.grp.x=this.grp.x-this.grp.width/2,e.canRotation=!1,PanelPrincessImage.instance.show({princess:princessService.getById(e.id)})},this))},e}(eui.ItemRenderer);__reflect(IRPriChoose.prototype,"IRPriChoose");var PanelTransfer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRTransfer,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_TransferOrgMaster_Response,this.onTransferOrgMasterResponse,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelTransferSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this._dataProvider.length<=0?this._dataProvider.source=this.getTransferMembers():this._dataProvider.refresh()},e.prototype.getTransferMembers=function(){var t=[];return unionService.union.members.forEach(function(e){e.position!=UnionEntity.POSITION.LEADER&&t.push(e)}),t},e.prototype.onTransferOrgMasterResponse=function(t){t.data.error>0||this.dealAction()},e}(CommonPanelBase);__reflect(PanelTransfer.prototype,"PanelTransfer");var IRTransfer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.item.setTransferData(this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRTransfer.prototype,"IRTransfer");var PanelUnionBuild=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_build_union},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnBuild,egret.TouchEvent.TOUCH_TAP,this.onBtnBuildTap,this),this.registerEvent(gameServer,protocols.WC_CreateOrg_Response,this.onCreateOrgResponse,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionBuildSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.toggle.selected=!1},e.prototype.onCreateOrgResponse=function(t){t.data.error>0||this.dealAction()},e.prototype.onBtnBuildTap=function(t){return this.tiName.text.length<=0?void Toast.show({text:lang.union_build_error}):packService.getCountByMetaId(1)<2e3?void Toast.show({text:lang.response_error[38]}):GameConfig.judgeString(this.tiName)?void Toast.show({text:lang.response_error[79]}):void unionService.buildUnion(this.tiName.text,this.tiQQ.text,this.tiNotice.text,this.toggle.selected)},e}(CommonPanelBase);__reflect(PanelUnionBuild.prototype,"PanelUnionBuild");var PanelUnionContribute=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionContribute,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_DonateOrg_Response,this.onDonateOrgResponse,this)},e.prototype.init=function(){this.title=lang.panel_union_contribute},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionContributeSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.labTech.text=lang.union_tech_point+unionService.union.info.techPoint,this.labContribute.text=unionService.getMyUnionInfo().contribute,this._dataProvider.source=unionService.contributeList},e.prototype.onDonateOrgResponse=function(t){0==t.data.error&&(Toast.show({text:lang.union_contribute_success}),this.update())},e}(CommonPanelBase);__reflect(PanelUnionContribute.prototype,"PanelUnionContribute");var IRUnionContribute=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastTouchTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnContribute,egret.TouchEvent.TOUCH_TAP,this.onBtnContributeTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=GameConfig.getItemMeta(e.costId);this.item.alwaysShowCount=!0,this.item.metaId=e.costId,this.item.count=packService.getCountByMetaId(i.id),this.labCost.text=i.name+"*"+e.count,this.labEffect.text=e.effect,this.labName.text=e.name;var n=activityTimeService.getById(unionService.donateActId);this.btnContribute.enabled=packService.getCountByMetaId(e.costId)>=e.count&&(1==e.costId?!n:!0),this.labName.textColor=e.textColor},e.prototype.onBtnContributeTap=function(t){var e=(new Date).getTime();e-this.lastTouchTime<500||(this.lastTouchTime=e,unionService.donate(unionService.union.info.id,this.data.type))},e}(alien.VisualEventItemRenderer);__reflect(IRUnionContribute.prototype,"IRUnionContribute");var PanelUnionInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onSelectItem,this),this.registerEvent(this.tabBar,egret.Event.CHANGING,this.onChanging,this),this.registerEvent(gameServer,ProtocolConfigs.WC_LeaveOrg_Response,this.onLeaveOrgResponse,this),this.registerEvent(gameServer,ProtocolConfigs.WC_DisbandOrg_Response,this.onDisbandOrgResponse,this),this.vs.setup({def:UnionInfoMsg},{def:UnionInfoMember},{def:UnionInfoApply})},e.prototype.init=function(){this.title=lang.panel_union_info},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionInfoSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.vs.selectedIndex=this.tabBar.selectedIndex=0},e.prototype.onChanging=function(t){2==this.tabBar.selectedIndex&&unionService.getMyUnionInfo().position<UnionEntity.POSITION.VICE&&(Toast.show({text:lang.union_apply_tip}),t.preventDefault())},e.prototype.onSelectItem=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.onLeaveOrgResponse=function(t){this.dealAction()},e.prototype.onDisbandOrgResponse=function(t){this.dealAction()},e}(CommonPanelBase);__reflect(PanelUnionInfo.prototype,"PanelUnionInfo");var PanelUnionJoin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_join_union},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnSearch,egret.TouchEvent.TOUCH_TAP,this.onBtnSearchTap,this),this.registerEvent(gameServer,protocols.WC_SearchOrg_Response,this.onSearchOrgResponse,this),this.registerEvent(gameServer,protocols.WC_ApplyOrg_Response,this.onApplyOrgResponse,this),this.registerEvent(gameServer,protocols.WC_SearchOrgSimple_Response,this.onSearchOrgSimpleResponse,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionJoinSkin),[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),unionService.searchUnion(),this.tiName.text=""},e.prototype.onSearchOrgResponse=function(t){this._dataProvider.source=t.data.unions},e.prototype.onApplyOrgResponse=function(t){return t.data.error>0?void 0:this.list.selectedItem.autoAcceptJoin?void this.dealAction():void Toast.show({text:lang.union_apply_join_tip})},e.prototype.onBtnSearchTap=function(t){this.tiName.text.length>0&&unionService.searchUnionSimple(this.tiName.text)},e.prototype.onSearchOrgSimpleResponse=function(t){t.data.error>0||(this._dataProvider.source=[t.data.union])},e}(CommonPanelBase);__reflect(PanelUnionJoin.prototype,"PanelUnionJoin");var PanelUnionLog=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRLogItem,this.list.dataProvider=this._dataProvider=new ArrayCollection,this.registerEvent(unionService,EventNames.UPDATE_UNION_LOG,this.onUpdateUnionLog,this)},e.prototype.getSkinName=function(){return panels.PanelUnionLogSkin},e.prototype.init=function(){this.title=lang.panel_union_log},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){mainService.playerInfo.union_id&&(this._dataProvider.source=unionService.union.logs.sort(function(t,e){return e.time-t.time}).filter(function(t,e,i){return 100>e}))},e.prototype.onUpdateUnionLog=function(t){this.update()},e}(CommonPanelBase);__reflect(PanelUnionLog.prototype,"PanelUnionLog");var IRLogItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labContent.textFlow=UnionEntity.getLogTextFlow(e),this.labTime.textFlow=unionService.getIntervalTime(e.time),this.labTitle.text=lang.union_log_format[e.optType].title},e}(alien.VisualEventItemRenderer);__reflect(IRLogItem.prototype,"IRLogItem");var PanelUnionNotice=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getSkinName=function(){return panels.PanelUnionNoticeSkin},e.prototype.show=function(t){var e=t.content;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinType=2,[4,this.popup()];case 1:return t.sent(),this.labContent.text=e,[2]}})})},e}(CommonPanelBase);__reflect(PanelUnionNotice.prototype,"PanelUnionNotice");var PanelUnionPosManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPosManager,this.list.dataProvider=this._dataProvider,this.registerEvent(this.btnSure,egret.TouchEvent.TOUCH_TAP,this.onBtnSureTap,this),this.registerEvent(gameServer,protocols.WC_SetOrgMasterLevel_Response,this.onSetOrgMasterLevelResponse,this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionPosManagerSkin),this.skinType=2,[4,this.popup()];case 1:return e.sent(),this._member=t,this.update(),[2]}})})},e.prototype.update=function(){var t=this;this._dataProvider.refresh(),egret.callLater(function(){t.list.selectedIndex=t._member.position},this)},e.prototype.onBtnSureTap=function(t){var e=this.list.selectedItem;e.position==this._member.position?this.dealAction():0!=e.position&&unionService.getPosCount(e.position)>=unionService.getMaxNumByPos(e.position)?Toast.show({text:lang.union_position_full_tip}):unionService.setPosition(unionService.union.info.id,this._member.id,parseInt(e.position))},e.prototype.onSetOrgMasterLevelResponse=function(t){t.data.error>0||this.dealAction()},e}(CommonPanelBase);__reflect(PanelUnionPosManager.prototype,"PanelUnionPosManager");var IRPosManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data.position=parseInt(this.data.position);var e=unionService.getMaxNumByPos(parseInt(this.data.position)),i=unionService.getPosCount(parseInt(this.data.position));this.labPosition.text=this.data.label,0==this.data.position?(this.labCount.text=i+"",this.labCount.textColor=9915137):(this.labCount.text=i+"/"+e,this.labCount.textColor=e>i?9915137:16711680)},e}(alien.VisualEventItemRenderer);__reflect(IRPosManager.prototype,"IRPosManager");var PanelUnionRank=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._unions=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.title=lang.panel_union_rank},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(gameServer,protocols.WC_SearchOrg_Response,this.onSearchOrgResponse,this),this.registerEvent(gameServer,protocols.WC_ApplyOrg_Response,this.onApplyOrgResponse,this)},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionRankSkin),[4,this.popup()];case 1:return t.sent(),[2]}})})},e.prototype.active=function(){t.prototype.active.call(this),unionService.searchTopUnion()},e.prototype.update=function(){if(mainService.playerInfo.union_id){var t=this.getMyUnionRank();t>0?(this.currentState="normal",this.labName.text=unionService.union.info.name,this.labRank.text=t+""):this.currentState="noRank"
}else this.currentState="noUnion"},e.prototype.onSearchOrgResponse=function(t){var e=this;this._unions=[],t.data.unions.forEach(function(t,i){t.rank=i+1,e._unions.push(t)}),this._dataProvider.source=this._unions,this.update()},e.prototype.onApplyOrgResponse=function(t){t.data.error>0||Toast.show({text:lang.union_apply_join_tip})},e.prototype.getMyUnionRank=function(){var t=0;return this._unions.some(function(e){return e.id==unionService.union.info.id?(t=e.rank,!0):void 0}),t},e}(CommonPanelBase);__reflect(PanelUnionRank.prototype,"PanelUnionRank");var PanelUnionRename=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnSure,egret.TouchEvent.TOUCH_TAP,this.onBtnSureTap,this),this.registerEvent(gameServer,protocols.WC_ChangeOrg_Response,this.onChangeOrgResponse,this)},e.prototype.show=function(t){return void 0===t&&(t="name"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionRenameSkin),[4,this.popup()];case 1:return e.sent(),this.currentState=t,[2]}})})},e.prototype.close=function(){this.tiName.text="",t.prototype.close.call(this)},e.prototype.onBtnSureTap=function(t){if(!(this.tiName.text.length<=0))if("name"==this.currentState);else{var e=unionService.union.info,i=e.autoAcceptJoin?1:0;unionService.changeUnion(e.id,this.tiName.text,e.memo,e.msg,i)}},e.prototype.onChangeOrgResponse=function(t){t.data.error>0||this.dealAction()},e}(CommonPanelBase);__reflect(PanelUnionRename.prototype,"PanelUnionRename");var PanelUnionShop=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionShop,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onItemSelected,this),this.registerEvent(gameServer,protocols.WC_BuyOrgItem_Response,this.onBuyOrgItemResponse,this)},e.prototype.init=function(){this.title=lang.panel_union_shop},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionShopSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.labContribute.text=unionService.getMyUnionInfo().contribute+"",this._dataProvider.source=GameConfig.getExchangeByType(ShopService.Exchange.TYPE_UNION)},e.prototype.onItemSelected=function(t){var e=this;t.preventDefault();var i=this.list.selectedItem;GameConfig.getItemMeta(i.item_id);if(unionService.union.info.level<i.chance){var n=lang.formatHtml(lang.union_shop_tip,i.chance);return void Toast.show({text:n[0].text})}PanelShopBuyItem.instance.show({shopItem:i,type:PanelShopBuyItem.BUY_TYPE.UNION_SHOP},function(t,n){if("confirm"==t){if(unionService.getMyUnionInfo().contribute<i.price)return void Toast.show({text:lang.response_error[106]});e._selectItem={meta:i,count:n.count},unionService.buyUnionItem(unionService.union.info.id,i.id,n.count)}})},e.prototype.onBuyOrgItemResponse=function(t){t.data.error>0||!this._selectItem||(this.labContribute.text=unionService.getMyUnionInfo().contribute+"",PanelWorkFinish.instance.show({type:2,reward:[{id:this._selectItem.meta.item_id,count:this._selectItem.meta.item_count*this._selectItem.count}],princessEffect:null}))},e}(CommonPanelBase);__reflect(PanelUnionShop.prototype,"PanelUnionShop");var IRUnionShop=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.item.setUnionData(this.data)},e}(alien.VisualEventItemRenderer);__reflect(IRUnionShop.prototype,"IRUnionShop");var PanelUnionTech=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionTech,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(unionService,EventNames.UPDATE_UNION_TECH,this.onUpdateUnionTech,this),this.registerEvent(gameServer,protocols.WC_LeaveUpSkill_Response,this.onLeaveUpSkillResponse,this)},e.prototype.init=function(){this.title=lang.panel_union_tech},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionTechSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){this.labTech.text=lang.union_tech_point+unionService.union.info.techPoint,this._dataProvider.source=GameConfig.getTechsByType(4)},e.prototype.onUpdateUnionTech=function(t){var e=this,i=(GameConfig.getTechMeta(t.data.tech.id),this.scroller.viewport.scrollV);this._dataProvider.refresh(),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation(),e.list.validateNow();var t=e.scroller.viewport;t.scrollV=Math.max(0,i)}),this.labTech.text=lang.union_tech_point+unionService.union.info.techPoint},e.prototype.onLeaveUpSkillResponse=function(t){0==t.data.error&&Toast.show({text:lang.union_tech_upgrade_success})},e}(CommonPanelBase);__reflect(PanelUnionTech.prototype,"PanelUnionTech");var IRUnionTech=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastTouchTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnCommon,egret.TouchEvent.TOUCH_TAP,this.onBtnCommonTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),unionService.getMyUnionInfo().position>=UnionEntity.POSITION.VICE?this.btnCommon.visible=!0:this.btnCommon.visible=!1;var e=this.data;this.labName.text=e.name;var i=unionService.getTechById(e.id),n=e.levels[e.levels.length-1].level,r=0;if(i&&(r=i.level),0==r)this.labNowEffect.text=lang.nothing;else{var o=GameConfig.getTechLevelMeta(e.id,r),s=GameConfig.getBufferMeta(o.effect);s&&(this.labNowEffect.text=lang.format(s.intro,Math.abs(s.value)))}var a=r+1,c=null;if(r>=n)this.labNextEffect.text=lang.nothing,a=n,c=GameConfig.getTechLevelMeta(e.id,a);else{c=GameConfig.getTechLevelMeta(e.id,a);var l=GameConfig.getBufferMeta(c.effect);this.labNextEffect.text=lang.format(l.intro,Math.abs(l.value))}unionService.union.info.level<c.cost_knowledge?this.currentState="unLevel":unionService.union.info.techPoint<c.cost_mineral?this.currentState="noTech":this.currentState="normal",n>r?this.labLevel.text=r+lang.lv:(this.labLevel.text=lang.tech_full_level,this.currentState="fullLevel"),this.labCost.text=c.cost_mineral+lang.union_tech,this.labState.textFlow=lang.formatHtml(lang.union_need_level,c.cost_knowledge)},e.prototype.onBtnCommonTap=function(t){var e=(new Date).getTime();e-this.lastTouchTime<500||(this.lastTouchTime=e,unionService.levelUpTech(unionService.union.info.id,this.data.id))},e}(alien.VisualEventItemRenderer);__reflect(IRUnionTech.prototype,"IRUnionTech");var PanelUnionWelfare=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRUnionWelfare,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.btnOneReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnOneReceiveTap,this),this.registerEvent(this.btnOpen,egret.TouchEvent.TOUCH_TAP,this.onBtnOpenTap,this),this.registerEvent(gameServer,protocols.WC_BuyOrgGift_Response,this.onBuyOrgGiftResponse,this),this.registerEvent(unionService,EventNames.UPDATE_UNION_GIFT,this.onUpdateUnionGift,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this)},e.prototype.init=function(){this.title=lang.panel_union_welfare},e.prototype.show=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.skinName||(this.skinName=panels.PanelUnionWelfareSkin),[4,this.popup()];case 1:return t.sent(),this.update(),[2]}})})},e.prototype.update=function(){var t=unionService.getMyUnionInfo().giftExp;this._dataProvider.source=unionService.union.gifts,this.currentState=0==this._dataProvider.source.length?"none":"normal",this.labProgress.text=wsy.Utils.shortCurrency(t)+"/"+unionService.getBaseGiftExp(),this.btnOpen.enabled=t>unionService.getBaseGiftExp(),this.btnOneReceive.enabled=unionService.union.gifts.length>0},e.prototype.onUpdateUnionGift=function(t){if(t.data){var e=t.data.reward;e.length>0&&PanelWorkFinish.instance.show({type:2,reward:e,princess:null},function(){unionService.giftAwards.splice(0)})}this.update()},e.prototype.onBtnOneReceiveTap=function(t){unionService.giftAwards.splice(0);var e=0,i=unionService.union.gifts;unionService.awardRequestNum=i.length;var n=egret.setInterval(function(){unionService.getGift(i[e].id),e++,e==i.length&&egret.clearInterval(n)},this,20)},e.prototype.onBtnOpenTap=function(t){unionService.buyUnionGift(unionService.union.info.id)},e.prototype.onBuyOrgGiftResponse=function(t){t.data.error>0||(this.update(),PanelTreasureBox.instance.show({rewards:[{id:1,count:1e3}],field:"gold"}))},e.prototype.onUpdateItem=function(t){var e=t.data.item;if(e){var i={id:e.meta.id,count:0};if(e.fieldsModified.some(function(t){return"count"==t.field&&t.value>t.oldValue?(i.count+=t.value-t.oldValue,t.oldValue=t.value,!0):void 0}),i.count>0){var n=unionService.getAwardById(i.id);n?unionService.updateAward(i):unionService.giftAwards.push(i)}}},e}(CommonPanelBase);__reflect(PanelUnionWelfare.prototype,"PanelUnionWelfare");var IRUnionWelfare=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnReceive,egret.TouchEvent.TOUCH_TAP,this.onBtnReceiveTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=GameConfig.getItemMetaByExport(this.data.metaId);if(e)this.labContent.text=e.name,this.labContent.textColor=GameConfig.QUALITY_COLORS[e.quality],this.imgGift.source="item_"+e.icon,this.labName.text=this.data.playerName;else{this.labContent.text=lang.boss_killed_box,this.imgGift.source="item_620006";var i=GameConfig.getBossMeta(parseInt(this.data.playerName));this.labName.text=i?i.name:this.data.playerName}},e.prototype.onBtnReceiveTap=function(t){unionService.giftAwards.splice(0),unionService.getGift(this.data.id)},e}(alien.VisualEventItemRenderer);__reflect(IRUnionWelfare.prototype,"IRUnionWelfare");var PanelCityInfo=function(t){function e(){return t.call(this,alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backOut},alien.popupEffect.Scale,{withFade:!0,ease:egret.Ease.backIn})||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(visitService,EventNames.UPDATE_CITY,this.onUpdateCity,this),this.registerEvent(this.tabBar,egret.Event.CHANGING,this.onTabBarChanging,this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabBarTap,this),this.registerEvent(this.btnClose,egret.TouchEvent.TOUCH_TAP,this.onBtnCloseTap,this),this.vs.setup({def:VisitDevelop},{def:VisitPeople},{def:VisitTreasure},{def:VisitCityInfo})},e.prototype.inactive=function(){t.prototype.inactive.call(this)},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelCityInfoSkin),this.cityId=t,[4,this.popup()];case 1:return e.sent(),this.tabBar.selectedIndex=0,this.vs.setSelectedIndex(this.tabBar.selectedIndex,{cityId:this.cityId},!0),this.update(),[2]}})})},e.prototype.update=function(){var t=visitService.getById(this.cityId);this.labName.text=t.cityMeta.name,this.imgBanner.source=t.getCityBanner();var e,i=[];t.cityMeta.rewards.forEach(function(t){var n=GameConfig.getItemMeta(t.id);n?i.push(t):e=t})},e.prototype.onUpdateCity=function(t){this.update()},e.prototype.onTabBarChanging=function(t){1!=this.tabBar.selectedIndex&&2!=this.tabBar.selectedIndex||this.cityId==visitService.getKingCity()||(Toast.show({text:lang.visit_not_in_city}),t.preventDefault())},e.prototype.onTabBarTap=function(t){this.vs.setSelectedIndex(this.tabBar.selectedIndex,{cityId:this.cityId})},e.prototype.onBtnCloseTap=function(t){this.close()},e}(PanelBase);__reflect(PanelCityInfo.prototype,"PanelCityInfo");var PanelVisitDevelop=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._metaIdList=[2,3],e._itemList=[],e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRItemUse,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.TouchEvent.TOUCH_TAP,this.onSelectItem,this)},e.prototype.init=function(){this.title=lang.panel_develop_city},e.prototype.show=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.skinName||(this.skinName=panels.PanelVisitDevelopSkin),this.cityId=t,this.setItemList(),[4,this.popup()];case 1:return e.sent(),this.update(),[2]}})})},e.prototype.setItemList=function(){var t=this;this._itemList.splice(0,this._itemList.length),this._metaIdList.forEach(function(e){var i=new ItemEntity,n="";packService.getItemByMetaId(e)&&(n=packService.getItemByMetaId(e).id),i.inject({metaId:e,count:packService.getCountByMetaId(e),id:n});var r=0,o=visitService.getById(t.cityId);r=2==i.metaId?o.visitMeta.levels[o.level>=9?8:o.level].develop_silver:o.visitMeta.levels[o.level>=9?8:o.level].develop_mineral;var s={item:i,cost:1e4*r};t._itemList.push(s)})},e.prototype.update=function(){var t=visitService.getById(this.cityId);this._dataProvider.source=this._itemList,this.labName.text=t.cityMeta.name+"Lv."+t.level,this.city.city=t,this.city.hideLevel()},e.prototype.onSelectItem=function(t){"btnUse"==t.target.name&&(2==this.list.selectedItem.item.meta.id?visitService.developCity(0):3==this.list.selectedItem.item.meta.id&&visitService.developCity(1),this.close())},e}(CommonPanelBase);__reflect(PanelVisitDevelop.prototype,"PanelVisitDevelop");var PanelVisitPrincess=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._princessId=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return void 0==this._instance&&(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.getSkinName=function(){return panels.PanelVisitPrincessSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgPrincess.mask=this.bodyMask,this.registerEvent(this,egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.registerEvent(this.btnWatch,egret.TouchEvent.TOUCH_TAP,this.onBtnWatch,this)},e.prototype.show=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this._callback=e,[4,this.popup(this.dealAction)];case 1:return n.sent(),0==i?this.update(t):1==i?this.battleUpdate(t):this.getUpdate(t),[2]}})})},e.prototype.onTap=function(t){this.imgPrincess.source="",this.dealAction()},e.prototype.update=function(t){var e=t.city,i=t.value,n=GameConfig.getVisitLevelMeta(e.id,e.level).princessId,r=GameConfig.getPrincessMeta(n);return r?(this.setPrincessInfo(n),void(princessService.getByMetaId(r.id)?e.likeValue==r.hire_value?(this.currentState="get",this.labEffect.text=r.name+lang.visit_like_value+"+"+i):(this.currentState="again",this.labEffect.text=r.name+lang.princess_info_fields.luck+"+1"):(this.currentState="meet",this.labLikeValue.text="("+lang.visit_current+e.likeValue+")",this.labEffect.text=r.name+lang.visit_like_value+"+"+i,this.labGoal.text=lang.format(lang.visit_goal,r.hire_value),this.labLikeValue.x=this.labGoal.x+this.labGoal.width))):void this.dealAction()},e.prototype.setPrincessInfo=function(t){var e=GameConfig.getPrincessMeta(t);return e?(this._princessId=t,this.imgPrincess.source=PrincessEntity.parseBodyUrl(e.icon),this.imgPrincess.x=200-.8*e.body_offset.x,this.imgPrincess.y=.8*-e.body_offset.y,void(this.labName.text=e.name)):void this.dealAction()},e.prototype.getUpdate=function(t){var e=t.princess;this.setPrincessInfo(e.meta.id),princessService.getByMetaId(e.meta.id)&&(this.currentState="get",this.labEffect.text="")},e.prototype.battleUpdate=function(t){var e=t.country,i=7001==e.id?200004:200006;this.setPrincessInfo(i),this.currentState="battle_"+e.id,this.btnWatch.visible=GuideLayer.instance.getGuideID("country_get_"+e.id)<0},e.prototype.onBtnWatch=function(t){var e=princessService.getByMetaId(this._princessId);e&&(PanelCityInfo.instance.close(),SceneController.replace(ConstantNames.SCENE_PRINCESS_INFO,{princess:e})),this.close()},e}(PanelBase);__reflect(PanelVisitPrincess.prototype,"PanelVisitPrincess");var SceneArena=function(t){function e(){var e=t.call(this)||this;return e._cdId=0,e.onPanelArenaBattleInfoResult=function(t,e){SceneController["goto"](ConstantNames.SCENE_ARENA_BATTLE)},e.onPanelHistoryResult=function(t,e){"avenge"==t&&arenaService.avenge(e.ministerId,e.playerId,1)},e.name=ConstantNames.SCENE_ARENA,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneArenaSkin},e.prototype.getResGroupNames=function(){return["arena"]},e.prototype.getHelp=function(){return"arena_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.imgBg.mask=this.bgMask,this.buttonBar.itemRenderer=IRArenaIconButton,this.registerEvent(this.btnStart,egret.TouchEvent.TOUCH_TAP,this.onBtnStartTap,this),this.registerEvent(this.buttonBar,egret.Event.CHANGING,this.onTapButtonBar,this),this.registerEvent(gameServer,protocols.WC_OPEN_PVE_RESPONSE,this.onBattleInfoResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_READY_RESPONSE,this.onReadyResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_AVENGE_RESPONSE,this.onAvengeResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_BEGIN_RESPONSE,this.onBeginResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_END_RESPONSE,this.onPveEndResponse,this),this.registerEvent(gameServer,protocols.WC_ITEM_USEBATTLECARD_RESPONSE,this.onItemUseBattleCardResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_SETJUMPBATTLE_RESPONSE,this.onPveSetJumpBattleResponse,this),this.registerEvent(this.btnUse,egret.TouchEvent.TOUCH_TAP,this.onBtnUseTap,this)},e.prototype.onBattleInfoResponse=function(t){switch(t.data.error){case 0:this.useData(t.data);break;case 74:this.currentState="no_more_chances",this.labNotice.text=lang.arena_no_more_chances;break;case 75:this.currentState="countdown",this.labNotice.text=lang.arena_no_available_minister;break;case 76:break;case 77:break;case 110:this.currentState="countdown";var e=activityTimeService.getById(570);e.timestamp-mainService.tsServer>0?(this._cdId>0&&countDownService.unregister(this._cdId),this._cdId=countDownService.register(e.timestamp,this.onSecond.bind(this))):this.labNotice.text=lang.arena_countdown}},e.prototype.onSecond=function(t){0>=t&&(countDownService.unregister(this._cdId),this._cdId=0,this.initScene({type:arenaService.type})),this.labNotice.text=lang.arena_countdown+" "+alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")},e.prototype.useData=function(t){var e=t.status,i=t.type;switch(e){case 0:case 1:switch(i){case 0:case 1:arenaService.readyBattle();break;case 2:this.currentState="available";var n=arenaService.battleInfo.sites[0],r=arenaService.battleInfo.sites[1],o=GameConfig.getMinisterMeta(n.minister.metaId),s=this.imgBody;s.source=MinisterEntity.parseBodyUrl(o.icon),s.anchorOffsetX=o.body_offset.x;var a=GameConfig.QUALITY_COLORS[o.quality].toString(16);this.labDialog.textFlow=lang.formatHtml(lang.arena_minister_words,r.accountName,a,o.name)}break;case 2:this.showPanelArenaBattleInfo();break;case 3:SceneController["goto"](ConstantNames.SCENE_ARENA_BATTLE);break;case 4:}},e.prototype.onReadyResponse=function(t){0==t.data.error&&this.showPanelArenaBattleInfo()},e.prototype.onAvengeResponse=function(t){0==t.data.error&&arenaService.requestBattleInfo(t.data.type)},e.prototype.onBeginResponse=function(t){0==t.data.error&&SceneController["goto"](ConstantNames.SCENE_ARENA_BATTLE)},e.prototype.onPveEndResponse=function(t){0==t.data.error&&this.initScene({type:arenaService.type})},e.prototype.onItemUseBattleCardResponse=function(t){0==t.data.error&&this.initScene({type:arenaService.type})},e.prototype.onPveSetJumpBattleResponse=function(t){0==t.data.error&&this.initScene({type:arenaService.type})},e.prototype.showPanelArenaBattleInfo=function(){this.currentState="clear",PanelArenaBattleInfo.instance.show(arenaService.battleInfo,this.onPanelArenaBattleInfoResult)},e.prototype.onBtnStartTap=function(t){void 0===t&&(t=null),arenaService.readyBattle()},e.prototype.onTapButtonBar=function(t){switch(t.preventDefault(),this.buttonBar.selectedItem.name){case"history":PanelArenaHistory.instance.show(null,this.onPanelHistoryResult);break;case"ranking":PanelArenaRanking.instance.show();break;case"season":PanelSeasonAward.instance.show()}},e.prototype.onBtnUseTap=function(t){PanelUseThingAlert.instance.show({content:lang.alert_add_challenge_item,id:600069,count:1},function(t){if("confirm"==t){var e=packService.getItemByMetaId(600069);e?arenaService.itemUseBattle(e.id,1):Toast.show({text:lang.response_error[6]})}})},e.prototype.getTitle=function(){return lang.arena},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.initScene=function(t){var e=t&&t.hasOwnProperty("type")?t.type:2;arenaService.requestBattleInfo(e),arenaService.requestBattleGlobalHistory()},e.prototype.inactive=function(){t.prototype.inactive.call(this),this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0)},e=__decorate([modifyChild],e)}(TopSceneBase);__reflect(SceneArena.prototype,"SceneArena");var IRArenaIconButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="arena_icon_"+this.data.name,this.labelDisplay.text=this.data.label},e}(eui.ItemRenderer);__reflect(IRArenaIconButton.prototype,"IRArenaIconButton");var SceneArenaBattle=function(t){function e(){var e=t.call(this)||this;return e.onPanelArenaBattleResult=function(){if(arenaService.finished){e.back({type:arenaService.type});var t=GameConfig.getMinisterMeta(arenaService.battleInfo.sites[0].minister.metaId),i=arenaService.battleInfo.sites[1].accountName,n=0==arenaService.winCount?0:1;PanelQuickMemorial.instance.show({text:lang.formatHtml(arenaService.isWin?lang.arena_result_success:lang.arena_result_failed[n],GameConfig.MINISTER_QUALITY_COLORS[t.quality],t.name,i,arenaService.winCount)})}else arenaService.requestBattleInfo(arenaService.type)},e.onPanelArenaBattleInfoResult=function(t,i){e.updateSiteInfo()},e.name=ConstantNames.SCENE_ARENA_BATTLE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneArenaBattleSkin},e.prototype.getResGroupNames=function(){return["arena_battle"]},e.prototype.partAdded=function(e,i){switch(t.prototype.partAdded.call(this,e,i),e){case"controller":this.registerEvent(this.controller,egret.TouchEvent.TOUCH_TAP,this.onTap,this)}},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(gameServer,protocols.WC_UPDATE_PVE_NOTIFY,this.onBattleResultNotify,this),this.registerEvent(gameServer,protocols.WC_OPEN_PVE_RESPONSE,this.onBattleInfoResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_BEGIN_RESPONSE,this.onBeginResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_END_RESPONSE,this.onPveEndResponse,this),this.registerEvent(gameServer,protocols.WC_PVE_SETJUMPBATTLE_RESPONSE,this.onPveSetJumpBattleResponse,this),this.registerEvent(this.btnSkip,egret.TouchEvent.TOUCH_TAP,this.onBtnSkipTap,this),this.registerEvent(gameServer,protocols.WC_END_PVE_NOTIFY,this.onBattleEndNotify,this)},e.prototype.onTap=function(t){var e=arenaService.actionMap.indexOf(t.target.name);e>=0&&(3==e&&arenaService.allValue<100?Toast.show({text:lang.arena_no_more_all_value}):(arenaService.battleCommand(e),this.controller.setLock(!0)))},e.prototype.onWillEnter=function(e,i,n){return t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.playParticle=function(t){var e=[],i=t.localToGlobal(t.width/2,t.height/2);e[0]=i,e[2]={x:180,y:alien.StageProxy.height-230},e[1]={x:(i.x-e[2].x)/2,y:i.y-50};var n=this["ps_"+t.name];return n.playParticle(e)},e.prototype.onBattleInfoResponse=function(t){0==t.data.error&&(this.currentState="clear",PanelArenaBattleInfo.instance.show(arenaService.battleInfo,this.onPanelArenaBattleInfoResult))},e.prototype.onBeginResponse=function(t){0==t.data.error&&(this.currentState="battle",this.updateSiteInfo(),this.startCD(),this.controller.setLock(!1))},e.prototype.onPveEndResponse=function(t){0==t.data.error&&this.back({type:arenaService.type})},e.prototype.onBattleEndNotify=function(t){0==t.data.error&&arenaService.jumpFlag&&arenaService.resultData&&(PanelArenaBattleResult.instance.show(arenaService.resultData,this.onPanelArenaBattleResult),arenaService.jumpFlag=!1)},e.prototype.onPveSetJumpBattleResponse=function(t){0==t.data.error},e.prototype.onBtnSkipTap=function(t){arenaService.jumpBattle(),this.stopCD(),this.controller.setLock(!0)},e.prototype.playMinisterSound=function(){SoundManager.instance.playEffect(MinisterEntity.parseSoundUrl(arenaService.battleInfo.sites[0].minister.metaId))},e.prototype.onBattleResultNotify=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n;return __generator(this,function(r){switch(r.label){case 0:return e=t.data.sites,i=arenaService.actionMap[e[0].action],this.controller.setChange(e[0]),this.stopCD(),SoundManager.instance.playEffect("sound_arena_select_"+i),[4,this.playParticle(this.controller.getChildByName(i))];case 1:return r.sent(),n=this.compareAction(e[0].action,e[1].action),2==n&&this.playMinisterSound(),3==e[0].action&&this.playMinisterSound(),[4,this.compare.play(e[0],e[1],n)];case 2:return r.sent(),[4,this.playAll(e)];case 3:return r.sent(),this.battleInfoBlue.playChange(e[0],1==n,e[1].action),[4,this.battleInfoRed.playChange(e[1],2==n,e[0].action)];case 4:return r.sent(),arenaService.resultData&&PanelArenaBattleResult.instance.show(arenaService.resultData,this.onPanelArenaBattleResult),(e[0].hp>0||e[1].hp>0)&&(this.startCD(),this.controller.setLock(!1)),[2]}})})},e.prototype.playAll=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){return e=[],3==t[0].action&&e.push(this.battleInfoBlue.playAll()),3==t[1].action&&e.push(this.battleInfoRed.playAll()),[2,Promise.all(e)]})})},e.prototype.compareAction=function(t,e){return 0==t&&1==e||1==t&&2==e||2==t&&0==e?2:1==t&&0==e||2==t&&1==e||0==t&&2==e?1:0},e.prototype.startCD=function(){this.countDown.start(15)},e.prototype.stopCD=function(){this.countDown.stop()},e.prototype.initScene=function(){this.controller.setLock(!1),this.currentState="battle",this.updateSiteInfo(),this.startCD()},e.prototype.updateSiteInfo=function(){var t=arenaService.battleInfo.sites;this.compare.updateSites(t[0],t[1]),this.battleInfoBlue.setData(t[0]),this.battleInfoRed.setData(t[1]),this.controller.setDate(t[0])},e}(SceneBase);__reflect(SceneArenaBattle.prototype,"SceneArenaBattle");var alien;!function(t){var e=function(){function e(){}return e.distancePoint=function(t,e){return this.distance(t.x,t.y,e.x,e.y)},e.distance=function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))},e.centerPoint=function(t,e){return{x:Math.min(t.x,e.x)+Math.abs(t.x-e.x)/2,y:Math.min(t.y,e.y)+Math.abs(t.y-e.y)/2}},e.radian=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},e.angle=function(t,e){return this.radiusToAngle(this.radian(t,e))},e.makeRandomInt=function(t,e){return void 0===e&&(e=0),Math.floor(Math.random()*(t-e))+e},e.makeRandomFloat=function(t,e){return void 0===e&&(e=0),Math.random()*(t-e)+e},e.makeRandomByRange=function(t,e){return t+(Math.random()*e*2-e)},e.makeRandomIntArr=function(t,e,i){void 0===i&&(i=0);for(var n=[],r=0;t>r;r++)n.push(this.makeRandomInt(e));return n},e.makeOrderIntArray=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=1);for(var n=[],r=e;t>=r;r+=i)n.push(r);return n},e.mixArray=function(t){for(var e=0,i=Math.round(t.length/2);i>e;e++){var n=this.makeRandomInt(t.length),r=this.makeRandomInt(t.length),o=t[n];t[n]=t[r],t[r]=o}return t},e.mixArray2=function(t){for(var e,i,n=t[0].length,r=t.length,o=0,s=Math.round(n*r/2);s>o;o++){e=[this.makeRandomInt(n),this.makeRandomInt(r)],i=[this.makeRandomInt(n),this.makeRandomInt(r)];var a=t[e[0]][e[1]];t[e[0]][e[1]]=t[i[0]][i[1]],t[i[0]][i[1]]=a}return t},e.getRandomFromArray=function(t,e){void 0===e&&(e=!1);var i=this.makeRandomInt(t.length),n=t[i];return e&&t.splice(i,1),n},e.fixRange=function(t,e,i){return e>t?t=e:t>i&&(t=i),t},e.roundFix=function(t,e,i){return void 0===i&&(i=0),i>t?t+=e-i:t>=e&&(t-=e-i),t},e.radiusToAngle=function(t){return 180*t/Math.PI},e.angleToRadius=function(t){return t*Math.PI/180},e.turnRight=function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push([]);for(var r=0,o=t.length;o>r;r++)for(var s=0,a=t[r].length;a>s;s++)e[r][s]=t[a-s-1][r];return e},e.turnLeft=function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push([]);for(var r=0,o=t.length;o>r;r++)for(var s=0,a=t[r].length;a>s;s++)e[r][s]=t[s][a-r-1];return e},e.calDir=function(t,e,i,n){if(t==i&&e==n)return-1;var r,o=Math.atan2(n-e,i-t);return r=Math.abs(o)<Math.PI/4?0:Math.abs(o)>Math.PI/4*3?2:o>0?1:3},e.sign=function(t){return 0==t?0:t>0?1:-1},e.split=function(t,e){for(var i=[],n=0;e>n;n++)i[n]=0;for(var n=0;t>n;n++)i[this.makeRandomInt(e)]++;return i},e.getBezier=function(t,e){for(var i,n={x:0,y:0},r=t.length-1,o=0;r>=o;o++)i=Math.pow(1-e,r-o)*Math.pow(e,o)*(0==o||o==r?1:r),n.x+=t[o].x*i,n.y+=t[o].y*i;return n},e.pointInPolygon=function(t,e){var i,n=t.length,r=n-1,o=!1,s=e.x,a=e.y;for(i=0;n>i;i++){var c=t[i].x,l=t[i].y,p=t[r].x,h=t[r].y;(a>l&&h>=a||a>h&&l>=a)&&(s>=c||s>=p)&&s>c+(a-l)/(h-l)*(p-c)&&(o=!o),r=i}return o},e.intersectToPolygon=function(t,e){for(var i,n,r=e[0],o=e[1],s=!1,a=0,c=t.length;c>a;a++)if(i=t[a],n=a==c-1?t[0]:t[a+1],this.intersectToIntersect(r,o,i,n)){s=!0;break}return s},e.intersectToIntersect=function(t,e,i,n){function r(t,e,i,n){return t*i-e*n}var o=r(e.x-t.x,i.x-n.x,e.y-t.y,i.y-n.y);if(1e-6>=o&&o>=-1e-6)return!1;var s=r(i.x-t.x,i.x-n.x,i.y-t.y,i.y-n.y)/o;if(s>1||0>s)return!1;var a=r(e.x-t.x,i.x-t.x,e.y-t.y,i.y-t.y)/o;return a>1||0>a?!1:!0},e.segmentsIntr=function(t,e,i,n){var r=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),o=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x);if(r*o>=0)return!1;var s=(i.x-t.x)*(n.y-t.y)-(i.y-t.y)*(n.x-t.x),a=s+r-o;if(s*a>=0)return!1;
var c=s/(o-r),l=c*(e.x-t.x),p=c*(e.y-t.y);return{x:t.x+l,y:t.y+p}},e.isNullArray=function(t){var e=!0;return t.some(function(t){return void 0!==t&&null!==t?(e=!1,!0):void 0}),e},e.fixed=function(e,i){var n=Math.pow(10,i),r=((Math.floor(e)*n+Math.floor(e*n%n)/n*n)/n).toString(),o=r.indexOf(".");return r+(0>o?".00":t.StringUtils.repeat("0",i-(r.length-o-1)))},e.valueRange=function(t,e,i){return Math.min(Math.max(t,e),i)},e}();t.MathUtils=e,__reflect(e.prototype,"alien.MathUtils")}(alien||(alien={}));var SceneBattle=function(t){function e(){var e=t.call(this)||this;return e._reward=[],e.onSelectMinisterResult=function(t,i){if("select"==t){var n=e.listGeneral.selectedIndex,r=e._dataProvider.getItemAt(n);r.minister=i.minister,battleService.setGeneral(n,i.minister.id),e.updateUI()}e.listGeneral.selectedIndex=-1},e.onPanelBattleResultResult=function(t){e.grpBattleButton.touchEnabled=!0,alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"battle_finish"}),e.grpBattleButton.horizontalCenter=alien.StageProxy.width,egret.Tween.get(e.grpBattleButton).to({horizontalCenter:0},500,egret.Ease.cubicOut);var i="blue"==battleService.currentWinGroup;if(i){var n=battleService.totalCount,r=battleService.gotCount,o=battleService.country;0==e._data.type?(battleService.gotoNextStronghold(),n==r&&e.back({complete:!0,country:o}),e.updateData()):e.back()}e.updateUI()},e.setBattleData=function(){var t=e.battleData.length,i=e.battleData[2*e.pos],n=e.battleData[2*e.pos+1];e.blueBattleInfo.setData(i),e.redBattleInfo.setData(n),e.battleStage.setTroops("blue",i.troops),e.battleStage.setTroops("red",n.troops),e.pos++,e.pos>=t/2&&(e.stopBattle(),e._shake.stop(),e.battleStage.stop(500,function(){e.onBattleComplete()}))},e.name=ConstantNames.SCENE_BATTLE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneBattleSkin},e.prototype.getHelp=function(){return"battle_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchMask.visible=!1,this.listGeneral.itemRenderer=IRWithItemView,this.listGeneral.dataProvider=this._dataProvider=new eui.ArrayCollection,alien.Utils.anchorCenter(this.btnBattle),this._wave=new alien.Wave(this.btnBattle,4e3,alien.Wave.zoom.bind(null,.05)),this._shake=new alien.Shake(this.grpBattleStage),this.registerEvent(this.listGeneral,egret.Event.CHANGING,this.onSelectGeneralSite,this),this.registerEvent(this.btnOneKey,egret.TouchEvent.TOUCH_TAP,this.onBtnOneKeyTap,this),this.registerEvent(this.grpBattleButton,egret.TouchEvent.TOUCH_TAP,this.onBtnBattleTap,this),this.registerEvent(gameServer,protocols.WC_BATTLE_COMBAT_Response,this.onBattleCombatResponse,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this),this.registerEvent(this.cbSkip,egret.Event.CHANGE,this.onCbSkipChange,this)},e.prototype.onClose=function(){this.isPlaying?Alert.show(lang.battle_playing_notice):t.prototype.onClose.call(this)},e.prototype.getTitle=function(){return lang.world_map},e.prototype.initScene=function(){battleService.checkInitGeneral(),this.cbSkip.enabled=mainService.playerInfo.vip>=3,this.updateUI(),this.initBtnBattle()},e.prototype.onWillEnter=function(e,i,n){return n&&(this._data=n),1!=this._data.type||n||this.back(),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.initBtnBattle=function(){this.grpBattleButton.touchEnabled=!0,this.grpBattleButton.horizontalCenter=alien.StageProxy.width,egret.Tween.get(this.grpBattleButton).to({horizontalCenter:0},500,egret.Ease.cubicOut)},e.prototype.onBtnOneKeyTap=function(t){battleService.oneKeySetup(),this.updateUI()},e.prototype.updateUI=function(){this._dataProvider.source=battleService.getGenerals();var t=this._data.stronghold;this.battleStage.setBgId(t.bg),this.cbSkip.selected=mainService.playerInfo.vip>=3?dataCenterService.battleCbSkip:!1,this.updateTopInfo(),this.updateBattleInfo(),this._reward.splice(0)},e.prototype.onBtnBattleTap=function(t){this.grpBattleButton.touchEnabled=!1,alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:"battle_start"}),0==this._data.type?battleService.startBattle()||Alert.show(lang.battle_no_master_general):battleService.suppress(this._data.country.id)||Alert.show(lang.battle_no_master_general)},e.prototype.onSelectGeneralSite=function(t){this.listGeneral.selectedItem.hasOwnProperty("minister")&&PanelDispatchForBattle.instance.show(null,this.onSelectMinisterResult)},e.prototype.updateTopInfo=function(){this._data.country;if(0==this._data.type){var t=battleService.gotCount,e=battleService.totalCount;this.grpStronghold.visible=!0,this.labStronghold.text=lang.stronghold+":"+t+"/"+e}else this.grpStronghold.visible=!1;this.labTroops.text=lang.sum_troops+":"+wsy.Utils.shortCurrency(mainService.playerInfo.troops)},e.prototype.updateBattleInfo=function(){var t=this._data,e=t.country,i=t.stronghold,n=battleService.getMasterGeneral(),r=battleService.getInitBattleInfo();this.blueBattleInfo.initData(n.metaId,n.meta.name,r),this.redBattleInfo.initData(e.icon,e.name,{troops:i.troops,hp:i.hp,attack:i.attack}),this.battleStage.initData(r.troops,i.troops)},e.prototype.onBattleCombatResponse=function(t){if(t.data.error>0)return void(this.grpBattleButton.touchEnabled=!0);var e=t.data.data;egret.Tween.get(this.grpBattleButton).to({horizontalCenter:-alien.StageProxy.width},500,egret.Ease.cubicOut),this.cbSkip.selected?this.onBattleComplete():this.playBattle(e)},e.prototype.onUpdateItem=function(t){var e=t.data.item,i={item:e.meta.id,count:0};e.fieldsModified.some(function(t){"count"==t.field&&t.value>t.oldValue&&(i.count+=t.value-t.oldValue,t.oldValue=t.value)}),this._reward.push(i)},e.prototype.onCbSkipChange=function(t){dataCenterService.battleCbSkip=this.cbSkip.selected},e.prototype.updateData=function(){this._data.country=battleService.country,this._data.stronghold=battleService.stronghold},e.prototype.onBattleComplete=function(){var t=this;this._data.reward=this._reward,egret.setTimeout(function(){PanelBattleResult.instance.show(t._data,t.onPanelBattleResultResult)},this,500),this.isPlaying=!1,this.touchMask.visible=!1},e.prototype.playBattle=function(t){var e=this;this.battleData=t,this.battleStage.start(),this.touchMask.visible=!0,this.isPlaying=!0,this.pos=0,egret.setTimeout(function(){e.battleTimer=egret.setInterval(e.setBattleData,e,500),e._shake.play(null,100)},this,1500)},e.prototype.stopBattle=function(){this.battleTimer&&egret.clearInterval(this.battleTimer)},e}(TopSceneBase);__reflect(SceneBattle.prototype,"SceneBattle");var SceneBurnIncense=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneBurnIncenseSkin},e.prototype.getTitle=function(){return lang.burn_incense},e.prototype.getCloseButtonSkin=function(){return ui.CloseButtonSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRBurnIcon,this._wave=new alien.Wave(this.imgComeIn,4e3,alien.Wave.zoom.bind(null,.05)),this.listIncense.itemRenderer=IRIncenseItem,this.registerEvent(gameServer,ProtocolConfigs.WC_BURNINCENSE_RESPONSE,this.onBurnIncenseResponse,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(this.grpJoin,egret.TouchEvent.TOUCH_TAP,this.onGrpJoinTap,this),this.registerEvent(activityService,EventNames.UPDATE_INCENSE_SCORE_NOTIFY,this.onUpdateIncenseScoreNotify,this),this.registerEvent(this.listIncense,egret.Event.CHANGING,this.onIncenseChoose,this)},e.prototype.initScene=function(e){t.prototype.initScene.call(this,e),activityService.getActivity(ActivityEntity.ACTIVITY.TYPE_BURN_INCENSE),this._wave.play(),this.update()},e.prototype.back=function(e){"burn"==this.currentState?this.switchState():t.prototype.back.call(this,e)},e.prototype.inactive=function(){this._cdId&&(countDownService.unregister(this._cdId),this._cdId=0),this._wave.stop(),t.prototype.inactive.call(this)},e.prototype.update=function(){this.setTime(),this.currentState="normal"},e.prototype.setTime=function(){var t=activityService.getActivityByType(ActivityEntity.ACTIVITY.TYPE_BURN_INCENSE),e=new Date(1e3*t.begin_time),i=new Date(1e3*t.end_time);this.labTime.text=alien.TimeUtils.dateToString(e,lang.burn_incense_time[0])+alien.TimeUtils.dateToTimeString(e,lang.burn_incense_time[1])+"-"+alien.TimeUtils.dateToString(i,lang.burn_incense_time[0])+alien.TimeUtils.dateToTimeString(i,lang.burn_incense_time[1])},e.prototype.onBurnIncenseResponse=function(t){0==t.data.error&&(this._dataProvider.refresh(),PanelWorkFinish.instance.show({type:2,reward:[{id:t.data.id,count:t.data.count}]}))},e.prototype.onSelectItem=function(t){switch(t.preventDefault(),this.list.selectedItem.name){case"popularity":PanelPopular.instance.show();break;case"rank":PanelIncenseRankReward.instance.show();break;case"exchange":PanelIncenseExchange.instance.show();break;case"shop":PanelActShop.instance.show()}},e.prototype.onIncenseChoose=function(t){t.preventDefault();var e=packService.getItemByMetaId(this.listIncense.selectedItem.itemId);e?activityService.burnIncense(e.id):Toast.show({text:lang.response_error[6]})},e.prototype.onBurn=function(t){var e=packService.getItemByMetaId(this.list.selectedItem.id);return!e||e.count<=0?void Toast.show({text:lang.response_error[6]}):void activityService.burnIncense(e.id)},e.prototype.onGrpJoinTap=function(t){this.switchState()},e.prototype.onUpdateIncenseScoreNotify=function(t){},e.prototype.switchState=function(){this.currentState="normal"==this.currentState?"burn":"normal","normal"==this.currentState?this.enter_normal.play(0):(this._dataProvider.refresh(),this.enter_burn.play(0))},e}(TopSceneBase);__reflect(SceneBurnIncense.prototype,"SceneBurnIncense");var IRBurnIcon=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="burn_incense_icon_"+this.data.name,this.labelDisplay.text=this.data.label,this.badgeView.bid=this.data.badgeId},e}(eui.ItemRenderer);__reflect(IRBurnIcon.prototype,"IRBurnIcon");var IRIncenseItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=GameConfig.getItemMeta(this.data.itemId),i=packService.getCountByMetaId(this.data.itemId);this.btn.icon="burn_incense_icon_"+this.data.itemId,this.btn.label=e.name,this.filters=0==i?[GameConfig.greyFilter]:null},e}(eui.ItemRenderer);__reflect(IRIncenseItem.prototype,"IRIncenseItem");var SceneController=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return void 0==this._instance&&(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.configure=function(t){this._configured||(this._configured=!0,this._navigator=new TNavigator(t),this._navigator.addEventListener(alien.Navigator.SCENE_DID_ENTER,this.onDidEnterScene,this),this.register(ConstantNames.SCENE_LOGIN,SceneLogin),this.register(ConstantNames.SCENE_CREATE_PLAYER,SceneCreatePlayer),this.register(ConstantNames.SCENE_LOBBY,SceneLobby),this.register(ConstantNames.SCENE_STORY,SceneStory),this.register(ConstantNames.SCENE_THRONE,SceneThrone),this.register(ConstantNames.SCENE_INTERIOR,SceneInterior),this.register(ConstantNames.SCENE_MINISTER,SceneMinister),this.register(ConstantNames.SCENE_MINISTER_INFO,SceneMinisterInfo),this.register(ConstantNames.SCENE_WORLD_MAP,SceneWorldMap),this.register(ConstantNames.SCENE_BATTLE,SceneBattle),this.register(ConstantNames.SCENE_WAREHOUSE,SceneWarehouse),this.register(ConstantNames.SCENE_OFFICE,SceneOffice),this.register(ConstantNames.SCENE_PRINCESS_HOUSE,ScenePrincessHouse),this.register(ConstantNames.SCENE_PRINCESS,ScenePrincess),this.register(ConstantNames.SCENE_PRINCESS_INFO,ScenePrincessInfo),this.register(ConstantNames.SCENE_PRINCESS_POSITION,ScenePrincessPosition),this.register(ConstantNames.SCENE_PRINCESS_WORK,ScenePrincessWork),this.register(ConstantNames.SCENE_PRINCESS_RITE,ScenePrincessRite),this.register(ConstantNames.SCENE_PRINCESS_PARTY,ScenePrincessParty),this.register(ConstantNames.SCENE_ARENA,SceneArena),this.register(ConstantNames.SCENE_ARENA_BATTLE,SceneArenaBattle),this.register(ConstantNames.SCENE_GARDEN_HOUSE,SceneGardenHouse),this.register(ConstantNames.SCENE_GARDEN_FLOWER,SceneGardenFlower),this.register(ConstantNames.SCENE_TECHNOLOGY,SceneTechnology),this.register(ConstantNames.SCENE_PRINCE,ScenePrince),this.register(ConstantNames.SCENE_VISIT,SceneVisit),this.register(ConstantNames.SCENE_TREASURE,SceneTreasure),this.register(ConstantNames.SCENE_PRISON,ScenePrison),this.register(ConstantNames.SCENE_UNION,SceneUnion),this.register(ConstantNames.SCENE_DUPLICATE,SceneDuplicate),this.register(ConstantNames.SCENE_WORLD_BOSS,SceneWorldBoss),this.register(ConstantNames.SCENE_BURN_INCENSE,SceneBurnIncense))},t.prototype.register=function(t,e){this._navigator.register(t,e)},Object.defineProperty(t.prototype,"navigator",{get:function(){return this._navigator},enumerable:!0,configurable:!0}),t.prototype.active=function(){var t=this._navigator.currentView;t.active()},t.prototype.inactive=function(){var t=this._navigator.currentView;t.inactive()},t.prototype.onDidEnterScene=function(t){var e="enter_scene_"+t.data.name;alien.Dispatcher.dispatch(EventNames.GUIDE_POINT,{point:e}),(t.data.name==ConstantNames.SCENE_LOGIN||t.data.name==ConstantNames.SCENE_STORY)&&MainStage.instance.loadingLayer.setState("black")},t.replace=function(e,i){void 0===i&&(i=null),t.instance.navigator.replace(e,i)},t["goto"]=function(e,i){return void 0===i&&(i=null),openService.getOpenStatus({name:e})?(t.instance.navigator.push(e,i),!0):!1},t.back=function(e){void 0===e&&(e=null),t.instance.navigator.pop(e)},t.popAll=function(e,i){void 0===i&&(i=null),t.instance.navigator.popAll(e,i)},t.jump=function(e,i){void 0===i&&(i=null),t.instance.navigator.currentName!=e&&openService.getOpenStatus({name:e})&&t.instance.navigator.jump(e,i)},t}();__reflect(SceneController.prototype,"SceneController");var SceneCreatePlayer=function(t){function e(){var e=t.call(this)||this;return e.counting=0,e.faceIds=[[1001,1002,1003,1004,1005],[2001,2002,2003,2004,2005]],e.name=ConstantNames.SCENE_CREATE_PLAYER,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneCreatePlayerSkin},e.prototype.getResGroupNames=function(){return["create_player"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRKingHead,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.tabBar.itemRenderer=IRCreatePlayerTab,this.registerEvent(this.btnConfirm,egret.TouchEvent.TOUCH_TAP,this.onBtnConfirmTap,this),this.registerEvent(this.btnDice,egret.TouchEvent.TOUCH_TAP,this.onBtnDIceTap,this),this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectHead,this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onSelectTab,this);for(var e=0;2>e;e++){var i=new FaceBody;this.faceBodyContainer.addChild(i)}},e.prototype.initScene=function(){var t=this;this.tiName.text=GameConfig.princeRandomName(),this._dataProvider.source=this.faceIds[this.tabBar.selectedIndex],alien.EgretUtils.callLater(function(){t.list.selectedIndex=2,alien.Utils.enumChildren(t.faceBodyContainer,function(e,i){e.changeSex(t.tabBar.selectedIndex),0==i?e.show(t.list.selectedItem,!0):e.hide(!1)})})},e.prototype.onBtnConfirmTap=function(t){mainService.createPlayer(this.tiName.text,this.list.selectedItem,this.list.selectedItem)},e.prototype.onBtnDIceTap=function(t){this.tiName.text=GameConfig.princeRandomName()},e.prototype.onSelectHead=function(t){var e=this.faceBodyContainer.getChildAt(this.counting%2);e.hide(),this.counting++;var i=this.faceBodyContainer.getChildAt(this.counting%2);i.show(this.list.selectedItem)},e.prototype.onSelectTab=function(t){var e=this,i=this.tabBar.selectedIndex;this._dataProvider.source=this.faceIds[i],alien.EgretUtils.callLater(function(){e.list.selectedIndex=2,alien.Utils.enumChildren(e.faceBodyContainer,function(t,n){0==n?t.show(e.list.selectedItem,!0):t.hide(),t.changeSex(i)})})},e}(SceneBase);__reflect(SceneCreatePlayer.prototype,"SceneCreatePlayer");var IRKingHead=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgHead.source="create_player_king_"+this.data},e}(eui.ItemRenderer);__reflect(IRKingHead.prototype,"IRKingHead");var FaceBody=function(t){function e(){var e=t.call(this)||this;return e.skinName=components.FaceBodySkin,e}return __extends(e,t),e.prototype.show=function(t,e){var i=this;return void 0===e&&(e=!0),e?(this.imgFace.source="face_"+t,this.horizontalCenter=alien.StageProxy.width,this.alpha=0,new Promise(function(t){egret.Tween.get(i,null,null,!0).to({alpha:1,horizontalCenter:0},500,egret.Ease.cubicOut).call(t)})):(this.horizontalCenter=0,this.alpha=1,Promise.resolve())},e.prototype.hide=function(t){var e=this;return void 0===t&&(t=!0),t?new Promise(function(t){egret.Tween.get(e,null,null,!0).to({alpha:0,horizontalCenter:-alien.StageProxy.width},500,egret.Ease.cubicOut).call(t)}):(this.horizontalCenter=0,this.alpha=1,Promise.resolve())},e.prototype.changeSex=function(t){this.imgBody.source=0==t?"create_player_boy":"create_player_girl",0==t?this.imgFace.horizontalCenter=3:this.imgFace.horizontalCenter=16},e.prototype.setFace=function(t){this.imgFace.source="face_"+t},e}(eui.Component);__reflect(FaceBody.prototype,"FaceBody");var IRCreatePlayerTab=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.imgUp.source=this.data.icon+"_n",this.imgDown.source=this.data.icon+"_h"},e}(alien.VisualEventItemRenderer);__reflect(IRCreatePlayerTab.prototype,"IRCreatePlayerTab");var SceneDuplicate=function(t){function e(){var e=t.call(this)||this;return e._cdId=0,e._type=0,e._index=-1,e._emailFlag=!1,e.name=ConstantNames.SCENE_DUPLICATE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneDuplicateSkin},e.prototype.getResGroupNames=function(){return["duplicate"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnExit,egret.TouchEvent.TOUCH_TAP,this.onBtnExitTap,this),this.registerEvent(this.btnHelp,egret.TouchEvent.TOUCH_TAP,this.onBtnHelpTap,this),this.registerEvent(this.grpMinister,egret.TouchEvent.TOUCH_TAP,this.onGrpMinisterTap,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this),this.registerEvent(this.btnFight,egret.TouchEvent.TOUCH_TAP,this.onBtnFightTap,this),this.registerEvent(gameServer,protocols.WC_Boss_Battle_Response,this.onBossBattleResponse,this),this.registerEvent(this.grpSkill,egret.TouchEvent.TOUCH_TAP,this.onGrpSkillTap,this),this.registerEvent(gameServer,protocols.WC_Boss_BuyBuff_Response,this.onBossBuyBuffResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this),this.registerEvent(gameServer,protocols.WC_ReadMailResponse,this.onReadMailResponse,this),this._shake=new alien.Wave(this.imgBoss,500,alien.Wave.shake.bind(null,5,3),0,!1,!0,0)},e.prototype.initScene=function(t){t&&(this._type=t.type),bossService.getBossInfo(this._type),this.labHp.visible=!1,this.hpItem.update(),this.update(),this.imgBoss.source=bossService.boss.getBodyUrl()},e.prototype.inactive=function(){this._cdId&&(countDownService.unregister(this._cdId),this._cdId=0,this._emailFlag=!1),t.prototype.inactive.call(this)},e.prototype.update=function(){if(bossService.boss.hp<=0&&bossService.boss.fightStatus)return void(this._emailFlag||this.back());if(bossService.boss.endTime<mainService.tsServer||bossService.boss.id<=0)return void(this._emailFlag||this.back());if(this.btnFight.visible=!bossService.boss.fightStatus,this._cdId<=0){var t=bossService.boss.endTime;t-mainService.tsServer>0?this._cdId=countDownService.register(t,this.onSecond.bind(this)):this.labTime.text="00:00:00"}this.updateMinister(),this.labName.text=bossService.boss.meta.name},e.prototype.updateMinister=function(){var t=bossService.boss.ministers;alien.Utils.enumChildren(this.grpMinister,function(e,i){e.id=t[i]?t[i].id:null,e.x=134.5+(e.width+20)*i,e.y=150.5});var e=bossService.boss.pos;if(e>=0){var i=this.grpMinister.getChildAt(e);i&&bossService.boss.damage>0?this.play(i):this.hpItem.update()}},e.prototype.onUpdateBossInfo=function(t){this.update()},e.prototype.onBtnFightTap=function(t){var e=!1;return bossService.boss.ministers.some(function(t){return t?void 0:(e=!0,!0)}),e?void Toast.show({text:lang.response_error[113]}):void bossService.startFight(this._type,bossService.boss.ministers)},e.prototype.onBossBattleResponse=function(t){0==t.data.error&&bossService.getBossInfo(this._type)},e.prototype.onSecond=function(t){if(0>=t)return countDownService.unregister(this._cdId),this._cdId=0,void(this._emailFlag||this.back());t>86400?this.labTime.text=alien.TimeUtils.timeFormat(t,"{3}:{2}:{1}:{0}"):this.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}");var e=bossService.boss.roundTime;e<=mainService.tsServer&&bossService.boss.fightStatus&&e>0?bossService.getBossInfo(this._type):bossService.boss.fightStatus||t%10!=0||(bossService.getBossInfo(this._type),this.hpItem.update())},e.prototype.onGrpMinisterTap=function(t){var e=this.grpMinister.getChildIndex(t.target);!bossService.boss.fightStatus&&e>=0&&(this._index=e,PanelDispatchForDuplicate.instance.show({},this.onSelectMinisterResult.bind(this)))},e.prototype.onGrpSkillTap=function(t){var e=this;switch(t.target.name){case"normal":if(bossService.boss.buffer1Time>mainService.tsServer||0==bossService.boss.fightStatus)return;Alert.show(lang.duplicate_use_skill_alert.normal,1,function(t){"confirm"==t.name&&bossService.useBuffer(e._type,BossEntity.BUFFER_TYPE.NORMAL)});break;case"advance":if(0==bossService.boss.fightStatus)return;Alert.show(lang.duplicate_use_skill_alert.advance,1,function(t){"confirm"==t.name&&bossService.useBuffer(e._type,BossEntity.BUFFER_TYPE.ADVANCE)})}},e.prototype.onBossBuyBuffResponse=function(t){0==t.data.error&&(Toast.show({text:lang.duplicate_skill_success}),bossService.getBossInfo(this._type))},e.prototype.onSelectMinisterResult=function(t,e){"select"==t&&e&&(bossService.boss.ministers[this._index]={id:e.minister.id},this.updateMinister(),this._index=-1)},e.prototype.onMailRecvResponse=function(t){0==t.data.error&&t.data.senderId==BossEntity.EMAIL_SENDER_ID.UNION&&(this._emailFlag=!0,emailService.readMail(t.data.id))},e.prototype.onReadMailResponse=function(t){var e=this;0==t.data.error&&Alert.show(t.data.content,0,function(t){bossService.getBossInfo(e._type),SceneController.instance.navigator.currentName==ConstantNames.SCENE_DUPLICATE&&e.back()})},e.prototype.play=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return this.labHp.visible=!0,this.labHp.alpha=0,this.labHp.text="-"+bossService.boss.damage,e=this.grpMinister.getChildIndex(t),i={x:134.5+(t.width+20)*e,y:150.5},this.grpMinister.setChildIndex(t,100),n=this.labHp.localToGlobal(this.labHp.width/2,this.labHp.height/2-t.height/2),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(t).to({scaleX:1.1,scaleY:1.1},400,egret.Ease.circInOut).to({x:this.grpMinister.width/2,y:0,scaleX:1,scaleY:1},200,egret.Ease.sineIn).to({y:-n.y,alpha:0,scaleX:.4,scaleY:.4},500,egret.Ease.backIn))];case 1:return o.sent(),this._shake.play(),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(this.labHp).to({alpha:1},100,egret.Ease.circInOut).to({bottom:260,alpha:0},400,egret.Ease.circInOut))];case 2:return o.sent(),this._shake.stop(),egret.Tween.get(t).to({x:i.x,y:i.y,scaleX:1,scaleY:1}).wait(400).call(function(){t.alpha=1,r.labHp.visible=!1,r.labHp.bottom=115,r.grpMinister.setChildIndex(t,e),r.hpItem.update()}),[2]}})})},e.prototype.onBtnExitTap=function(t){this.back()},e.prototype.onBtnHelpTap=function(t){PanelRuleIntro.instance.show({contents:lang.union_duplicate_rules,type:3})},e}(SceneBase);__reflect(SceneDuplicate.prototype,"SceneDuplicate");var SceneInterior=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e._cdId=0,e.onSecond=function(t){if(0>t)return e._cdId=0,void e.onReFreshImpose();var i=interiorService.getImposeValue(),n=interiorService.getMaxImposeValue();e.impose.updateValue(lang.formatHtml(i.toString()+"/"+n+" <font color='#A2FF66'>("+alien.TimeUtils.timeFormat(t,"{1}:{0}")+")</font> "))},e.name=ConstantNames.SCENE_INTERIOR,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneInteriorSkin},e.prototype.getResGroupNames=function(){return["interior"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(interiorService,EventNames.REFRESH_IMPOSE,this.update,this),this.registerEvent(interiorService,EventNames.REFRESH_IMPOSE,this.onReFreshImpose,this),this.registerEvent(this.impose,EventNames.PROPVIEW_TAP_ADD,this.onPropViewTapAdd,this),this.vs.setup({def:InteriorImpose},{def:InteriorDevelopment}),this.vs.selectedIndex=0},e.prototype.onWillEnter=function(e,i,n){return this._tab=0,n&&n.tab&&(this._tab=n.tab),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.impose.stopNotice(),this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0)},e.prototype.getTitle=function(){return lang.interior},e.prototype.initScene=function(){this.vs.setSelectedIndex(this._tab,null,!0),this.tabBar.selectedIndex=this._tab,this.vs.selectedChild.active(null),this.update(null)},e.prototype.update=function(t){var e=interiorService.getImposeValue(),i=interiorService.getMaxImposeValue();this.impose.updateValue(e+"/"+i);var n=activityTimeService.getById(10);this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0),n&&n.timestamp-mainService.tsServer>0&&i>e&&(this._cdId=countDownService.register(n.timestamp,this.onSecond.bind(this))),0>=e?this.impose.playNotice():this.impose.stopNotice()},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.onPropViewTapAdd=function(t){var e=packService.getItemByMetaId(interiorService.addImposeItemId);e||(e={},e.metaId=interiorService.addImposeItemId,e.meta=GameConfig.getItemMeta(interiorService.addImposeItemId),e.count=0),PanelUseItem.instance.show({itemData:e,target:this})},e.prototype.onReFreshImpose=function(t){void 0===t&&(t=null),this.update(t)},e}(TopSceneBase);__reflect(SceneInterior.prototype,"SceneInterior");var SlideGesture=alien.SlideGesture,SceneLobby=function(t){function e(){var e=t.call(this)||this;return e.animations=[],e._cdId=0,e.name=ConstantNames.SCENE_LOBBY,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneLobbySkin},e.prototype.onAddView=function(){return!0},e.prototype.getResGroupNames=function(){return["lobby"]},e.prototype.getEnterProps=function(t,e,i){return{props:{alpha:1}}},e.prototype.getLeaveProps=function(t,e,i){return{props:{alpha:0}}},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),LobbyPageController.instance.init(this.lobbyPageContainer),this.gesture=new alien.SlideGesture(this.lobbyPageContainer,{dispatchCancelEvent:!1}),this.animations.push(new alien.Wave(this.btnNavLeft,3e3,alien.Wave.fade.bind(null,.3),0,!1)),this.animations.push(new alien.Wave(this.btnNavRight,3e3,alien.Wave.fade.bind(null,.3),0,!1)),this.bottomBar.itemRenderer=IRWithItemView,this.bottomBar.dataProvider=new eui.ArrayCollection(GameConfig.lobby_bottom_bar),this.bottomBar.layout.gap=30*(5-GameConfig.lobby_bottom_bar.length),this.topBar.itemRenderer=IRWithItemView,this.topBar.dataProvider=this._dataProvider=new eui.ArrayCollection(activityService.getIconList()),this.resourceList.itemRenderer=IRResource,this.registerEvent(this.btnNav,egret.TouchEvent.TOUCH_TAP,this.onBtnNavTap,this),this.registerEvent(LobbyPageController.instance.navigator,alien.Navigator.SCENE_WILL_ENTER,this.onNavigatorEnter,this),this.registerEvent(this.grpTop,egret.TouchEvent.TOUCH_TAP,this.onGrpTopTap,this),this.registerEvent(this.bottomBar,egret.Event.CHANGING,this.onTapBottomButton,this),this.registerEvent(this.gesture,SlideGesture.SLIDE,this.onSlide,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPropsModified,this),this.registerEvent(this.topBar,egret.Event.CHANGING,this.onTapTopButton,this),this.registerEvent(activityService,EventNames.UPDATE_ACTIVITY,this.onUpdateActivity,this),this.registerEvent(this.grpRight,egret.TouchEvent.TOUCH_TAP,this.onGrpRightTap,this),this.registerEvent(activityService,EventNames.UPDATE_FIRST_CHARGE,this.onUpdateActivity,this),GuideLayer.instance.setup()},e.prototype.onWillEnter=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return(e==ConstantNames.SCENE_LOGIN||e==ConstantNames.SCENE_STORY)&&(LobbyPageController.instance.navigator.popAll(ConstantNames.LOBBY_MAIN),LobbyPageController.instance.playMusic()),[4,t.prototype.onWillEnter.call(this,e,i,n)];case 1:return r.sent(),[2]}})})},e.prototype.onWillLeave=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.onWillLeave.call(this,e,i,n)];case 1:return r.sent(),[2]}})})},e.prototype.initScene=function(e){t.prototype.initScene.call(this,e),mainService.arenaContinueType>=0&&(this["goto"](ConstantNames.SCENE_ARENA,{type:mainService.arenaContinueType}),mainService.arenaContinueType=-1),this.taskBar.update(),this.update(),this._dataProvider.source=activityService.getIconList(),emailService.getMailList(),e&&e.hasOwnProperty("pageName")&&LobbyPageController.instance.navigator.popAll(e.pageName),this.judgeActEnd()},e.prototype.onBtnNavTap=function(t){this.switchPage(t.target.name)},e.prototype.onPropsModified=function(t){this.update()},e.prototype.update=function(){this.labNationalPower.text=mainService.getAllSum(),this.btnHead.icon=mainService.playerInfo.getNationalIcon(),this.vipItem.vip=mainService.playerInfo.vip},e.prototype.onSlide=function(t){var e=t.data.dir,i=LobbyPageController.instance.navigator;e>0?i.currentView instanceof LobbyHarem||this.switchPage("left"):0>e&&(i.currentView instanceof LobbyCapital||this.switchPage("right"))},e.prototype.switchPage=function(t){if(!GameConfig.examineEnabled){var e=LobbyPageController.instance.navigator,i=e.currentView instanceof LobbyMain;switch(t){case"left":i?LobbyPageController.instance.navigator.push(ConstantNames.LOBBY_HAREM):LobbyPageController.instance.navigator.pop();break;case"right":i?LobbyPageController.instance.navigator.push(ConstantNames.LOBBY_CAPITAL):LobbyPageController.instance.navigator.pop()}}},e.prototype.onNavigatorEnter=function(t){if(!GameConfig.examineEnabled){var e=t.data.name;this.btnNavLeft.visible=e!=ConstantNames.LOBBY_HAREM,this.btnNavRight.visible=e!=ConstantNames.LOBBY_CAPITAL}},e.prototype.onGrpTopTap=function(t){switch(t.target.name){case"national_power":PanelNationalPower.instance.show();break;case"setting":PanelSetting.instance.show();break;case"vip":PanelShop.instance.show(3)}},e.prototype.onGrpRightTap=function(t){switch(t.target.name){case"mail":PanelEmail.instance.show();break;case"chat":PanelChat.instance.show()}},e.prototype.onTapBottomButton=function(t){switch(t.preventDefault(),this.bottomBar.selectedItem.name){case"activity":PanelActivity.instance.show();break;case"battle":this["goto"](ConstantNames.SCENE_WORLD_MAP);break;case"warehouse":this["goto"](ConstantNames.SCENE_WAREHOUSE);break;case"shop":PanelShop.instance.show();break;case"mission":PanelTask.instance.show()}},e.prototype.onTapTopButton=function(t){switch(t.preventDefault(),this.topBar.selectedItem.name){case"rank":openService.getOpenStatus({name:"rank"})&&PanelRank.instance.show();
break;case"prison":SceneController["goto"](ConstantNames.SCENE_PRISON);break;case"preferential":PanelPreferential.instance.show();break;case"limit":PanelLimitActivity.instance.show();break;case"boss":SceneController["goto"](ConstantNames.SCENE_WORLD_BOSS);break;case"firstCharge":PanelFirstCharge.instance.show();break;case"burnIncense":SceneController["goto"](ConstantNames.SCENE_BURN_INCENSE)}},e.prototype.onUpdateActivity=function(){this._dataProvider.source=activityService.getIconList()},e.prototype.active=function(){t.prototype.active.call(this),this.gesture.active(),this.animations.forEach(function(t){t.play()})},e.prototype.inactive=function(){t.prototype.inactive.call(this),this.gesture.inactive(),this.animations.forEach(function(t){t.stop()}),this._cdId&&(countDownService.unregister(this._cdId),this._cdId=0)},e.prototype.judgeActEnd=function(){var t=activityService.getMinActEndTime();t&&(this._cdId&&(countDownService.unregister(this._cdId),this._cdId=0),this._cdId=countDownService.register(t,this.onSecond.bind(this)))},e.prototype.onSecond=function(t){0>=t&&(this._dataProvider.source=activityService.getIconList(),this.judgeActEnd())},e=__decorate([modifyChild],e)}(SceneBase);__reflect(SceneLobby.prototype,"SceneLobby");var IRResource=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.playerPropView,EventNames.PROPVIEW_TAP_ADD,this.onPropViewTapAdd,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.playerPropView.field=this.data.field,this.playerPropView.currentState=this.data.state,this.playerPropView.update()},e.prototype.onPropViewTapAdd=function(t){PanelShop.instance.show(2)},e}(alien.VisualEventItemRenderer);__reflect(IRResource.prototype,"IRResource");var SceneLogin=function(t){function e(){var e=t.call(this)||this;return e.showNotice=!0,e.onPanelServerListResult=function(t,i){if("select"==t){var n=i.server;e.server=n,e.serverItem.setData(n)}},e.name=ConstantNames.SCENE_LOGIN,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneLoginSkin},e.prototype.childrenCreated=function(){this.btnSwitch.visible=GameConfig.params?GameConfig.params.switchUserBtn:!1,this.grpThirdAuth.visible=!1,t.prototype.childrenCreated.call(this),this.imgBg.source=GameConfig.getLoginBgUrl(),this.imgLogo.source=GameConfig.getLogoUrl(),this.registerEvent(this.btnLogin,egret.TouchEvent.TOUCH_TAP,this.onBtnLoginTap,this),this.registerEvent(this.btnRegister,egret.TouchEvent.TOUCH_TAP,this.onBtnRegisterTap,this),this.registerEvent(this.btnBack,egret.TouchEvent.TOUCH_TAP,this.onBtnBackTap,this),this.registerEvent(this.btnStart,egret.TouchEvent.TOUCH_TAP,this.onBtnStartTap,this),this.registerEvent(this.grpServer,egret.TouchEvent.TOUCH_TAP,this.onSwitchServer,this),this.registerEvent(this.btnSwitch,egret.TouchEvent.TOUCH_TAP,this.onBtnSwitch,this),this.registerEvent(this.labTOS,egret.TouchEvent.TOUCH_TAP,this.onLabTOS,this),this.registerEvent(this.grpThirdAuth,egret.TouchEvent.TOUCH_TAP,this.onGrpThirdAuthTap,this),this.registerEvent(accountServer,EventNames.LOGIN_ACCOUNT_RESULT,this.onLoginResult,this)},e.prototype.onWillEnter=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.onWillEnter.call(this,e,i,n)];case 1:return r.sent(),[4,mainService.loadServerGroups()];case 2:return r.sent(),[2]}})})},e.prototype.onDidEnter=function(e,i,n){t.prototype.onDidEnter.call(this,e,i,n),n&&(n.fastReconnect?this.startLogin():n.selectServer?PanelServerList.instance.show(null,this.onPanelServerListResult):this.switchUser()),GameConfig.authorizeByChannel?this.onAuthorizeResult(Authorize.authorizeByChannel(egret.getOption("query"))):dataCenterService.token&&this.showSelectServer(),this.showNotice&&(this.showNotice=!1,PanelNotice.instance.show()),wsy.Utils.updateAllImages(MainStage.instance.toast)},e.prototype.initScene=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return GameConfig.authorizeByChannel?this.currentState="waiting":dataCenterService.token?(this.currentState="select_server",this.serverItem.clean()):(this.showLogin(),dataCenterService.account&&(this.tiAccount.text=dataCenterService.account),this.tiPassword.text=""),[2]})})},e.prototype.getResGroupNames=function(){return["login"]},e.prototype.switchUser=function(){GameConfig.authorizeByChannel?(this.currentState="waiting",Authorize.switchUser()):(this.showLogin(),dataCenterService.account&&(this.tiAccount.text=dataCenterService.account),this.tiPassword.text="")},e.prototype.showSelectServer=function(){this.currentState="select_server",this.server=mainService.getRecommendServer(),this.serverItem.setData(this.server)},e.prototype.startLogin=function(){accountServer.start({token:this.token?this.token:dataCenterService.token,serverConfig:this.server})},e.prototype.onAuthorizeResult=function(t){var e=this;t.then(function(t){alien.Dispatcher.dispatch(EventNames.HIDE_WAITING);var i=t.token,n=t.last_server,r=t.account_id;e.token=i,dataCenterService.lastServer=n,dataCenterService.accountId=r,e.showSelectServer()},function(t){alien.Dispatcher.dispatch(EventNames.HIDE_WAITING),Toast.show({text:lang.verify_errors[t]})})},e.prototype.onBtnLoginTap=function(t){var e=alien.StringUtils.trim(this.tiAccount.text),i=alien.StringUtils.trim(this.tiPassword.text);switch(this.currentState){case"login":this.checkBox.selected&&(dataCenterService.account=e),alien.Dispatcher.dispatch(EventNames.SHOW_WAITING,{content:lang.in_verify}),this.onAuthorizeResult(webService.authorize(e,i));break;case"register":this.checkBox.selected?this.registerAccount(e,i):Alert.show(lang.agree_tos)}},e.prototype.registerAccount=function(t,e){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(n){return webService.register(t,e).then(function(){Alert.show(lang.register_success,0,function(){i.showLogin()})},function(t){Alert.show(lang.register_failed+lang.api_error[t])}),[2]})})},e.prototype.onBtnRegisterTap=function(t){this.currentState="register",this.checkBox.selected=!1},e.prototype.onBtnBackTap=function(t){this.showLogin()},e.prototype.onBtnStartTap=function(t){this.server?0==this.server.status?Alert.show(lang.server_closed):1==this.server.status?Alert.show(lang.server_pending):this.startLogin():Alert.show(lang.alert_select_server)},e.prototype.onSwitchServer=function(t){PanelServerList.instance.show(null,this.onPanelServerListResult)},e.prototype.onBtnSwitch=function(t){this.switchUser()},e.prototype.onLabTOS=function(t){PanelSimpleContent.instance.show(ResNames.tos_txt)},e.prototype.onLoginResult=function(t){var e=t.data.error;0==e?(Analytics.logEvent("select_server",{server:this.server}),webService.saveLastServer(this.server.id)):this.showLogin()},e.prototype.onGrpThirdAuthTap=function(t){var e=parseInt(t.target.name);switch(e){case 1:this.onAuthorizeResult(Authorize.authorizeByWeixin())}},e.prototype.showLogin=function(){GameConfig.authorizeByChannel?this.currentState="waiting":this.currentState="login"},e=__decorate([modifyChild],e)}(SceneBase);__reflect(SceneLogin.prototype,"SceneLogin");var ScenePrince=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e._cdId=0,e.onActivitySecond=function(t){return 0>=t?void(e._cdId=0):void(e.labActTime.text="("+alien.TimeUtils.timeFormat(t,"{1}:{0}")+")")},e.name=ConstantNames.SCENE_PRINCE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrinceSkin},e.prototype.getBackParameters=function(){return{pageName:ConstantNames.LOBBY_MAIN}},e.prototype.getHelp=function(){return"prince_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.vs.setup({def:PrinceNoblesList},{def:PrinceOpenList}),this.progress.value=0,this.progress.labelDisplay.visible=!1,this.actList.itemRenderer=IRAct,this.actList.dataProvider=this._actDataProvider=new eui.ArrayCollection,this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.btnAppoint,egret.TouchEvent.TOUCH_TAP,this.onBtnAppointTap,this),this.registerEvent(this.princeInfo.btnCommon,egret.TouchEvent.TOUCH_TAP,this.onBtnCommonClick,this),this.registerEvent(this.princeInfo.btnExile,egret.TouchEvent.TOUCH_TAP,this.onBtnExileClick,this),this.registerEvent(this.princeInfo.btnName,egret.TouchEvent.TOUCH_TAP,this.onBtnNameClick,this),this.registerEvent(this,egret.Event.REMOVED_FROM_STAGE,this.onRemovedToStage,this),this.registerEvent(gameServer,protocols.WC_PRICESS_DELETE_RESPONSE,this.onDeleteResponse,this),this.registerEvent(princeService,EventNames.UPDATE_PRINCE,this.onUpdatePrince,this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_PRINCE,this.onSelectPrince,this),this.registerEvent(this.btnGo,egret.TouchEvent.TOUCH_TAP,this.onBtnGoTap,this),this.imgBody.mask=this.bodyMask,this.createLevelUp()},e.prototype.initScene=function(){if(this.vs.setSelectedIndex(this._tab,null,!0),this.tabBar.selectedIndex=this._tab,this.grpProgress.visible=!0,this.grpAct.visible=!0,0==this._tab){var t=this.vs.selectedChild.getSelectedIndex();this.updateInfo(princeService.getNoblesPrinces()[t])}else{var t=this.vs.selectedChild.getSelectedIndex();this.updateInfo(princeService.getOpenPrinces()[t])}},e.prototype.onWillEnter=function(e,i,n){return this._tab=0,n&&n.tab&&(this._tab=n.tab),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.updateInfo=function(t){if(this.currentState="normal",!t&&1==this.tabBar.selectedIndex)return void this.setView(!1);if(!t&&0==this.tabBar.selectedIndex)return void(this.currentState="empty");(!this.timer||this.timer<=0)&&(this.progress.slideDuration=0,this.progress.value=0),this.setView(!0),this._princeData=t,this.imgBody.source=t.getIconUrl();var e=princessService.getById(t.princessId);this.labMother.text=lang.prince_info_fields.mother+": "+e.meta.name,this.labDote.text=lang.princess_info_fields.luck+": "+e.luck,this.princeInfo.setInfo(this.tabBar.selectedIndex,t),this.progress.visible=!0;var i=ministerService.getById(t.ministerId);i?(this.btnAppoint.visible=!1,this.labTeacher.text=lang.prince_info_fields.teacher+": "+i.meta.name):0==this.tabBar.selectedIndex?(this.btnAppoint.visible=!0,this.labTeacher.text=lang.prince_info_fields.teacher+": "):1==this.tabBar.selectedIndex&&(this.btnAppoint.visible=!1,this.labTeacher.text=""),this.progress.maximum=t.getNowMaxExp(),this.progress.value=t.exp,t.level<t.getMaxLevel()?this.labNextCondition.text=lang.exp+":"+t.exp+"/"+t.getNowMaxExp():(this.progress.value=t.getNowMaxExp(),this.labNextCondition.text=lang.level_max),this.updateAct(t)},e.prototype.setView=function(t){this.princeInfo.visible=t,this.labMother.visible=t,this.labDote.visible=t,this.progress.visible=t,this.labTeacher.visible=t,this.btnAppoint.visible=t,this.imgBody.visible=t,this.labNextCondition.visible=t},e.prototype.updateAct=function(t){if(this.grpAct.visible=t.peerage<=0,!(t.peerage>0)){for(var e=[],i=0;i<princeService.getMaxEnergy();++i)t.activity>=i+1?e.push(1):e.push(0);this._actDataProvider.source=e,this._cdId&&countDownService.unregister(this._cdId),t.timestamp-mainService.tsServer>0&&t.activity<princeService.getMaxEnergy()?this._cdId=countDownService.register(t.timestamp,this.onActivitySecond.bind(this)):this.labActTime.text=""}},e.prototype.getTitle=function(){return lang.prince},e.prototype.getResGroupNames=function(){return["prince"]},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.onTabSelect=function(t){var e=this.tabBar.selectedIndex;if(this.vs.setSelectedIndex(e,null),0==e){var i=this.vs.selectedChild.getSelectedIndex();this.grpProgress.visible=!0,this.labNextCondition.visible=!0,this.grpAct.visible=!0,this.updateInfo(princeService.getNoblesPrinces()[i])}else if(1==e){this.grpProgress.visible=!1,this.labNextCondition.visible=!1,this.grpAct.visible=!1;var i=this.vs.selectedChild.getSelectedIndex();this.updateInfo(princeService.getOpenPrinces()[i])}},e.prototype.onBtnAppointTap=function(t){PanelPrinceAppoint.instance.show(this._princeData,this.onSelectMinister.bind(this))},e.prototype.onSelectMinister=function(t,e){"select"==t&&PanelPrinceNotice.instance.show({prince:e.prince,minister:e.minister},this.onNoticeCallback.bind(this))},e.prototype.onBtnCommonClick=function(t){0==this.tabBar.selectedIndex?this._princeData.level>=this._princeData.getMaxLevel()?PanelPrinceOpen.instance.show(this._princeData):this._princeData.activity<=0?PanelAddPower.instance.show([600062,600063,600064],this._princeData):" "==this._princeData.ministerId||""==this._princeData.ministerId?PanelPrinceAppoint.instance.show(this._princeData,this.onSelectMinister.bind(this)):princeService.train(this._princeData.ministerId,this._princeData.id):1==this.tabBar.selectedIndex&&princeService.awardItem(this._princeData.id)},e.prototype.onBtnExileClick=function(t){PanelPrinceNotice.instance.show({prince:this._princeData,minister:null},this.onNoticeCallback.bind(this))},e.prototype.onBtnNameClick=function(t){PanelPrinceRename.instance.show(this._princeData)},e.prototype.onNoticeCallback=function(t,e){"confirm"==t&&(e.minister?princeService.train(e.minister.id,e.prince.id):princeService.deletePrince(e.prince.id))},e.prototype.onRemovedToStage=function(t){this.princeInfo.onRemovedToStage(t)},e.prototype.onDeleteResponse=function(t){if(0==t.data.error){var e=princeService.getById(this._princeData.id),i=[{id:2,count:1e3*e.politics},{id:3,count:10*e.knowledge},{id:6,count:10*e.command}];princeService.deleteLocalPrince(this._princeData.id),this.vs.selectedChild.init(),PanelWorkFinish.instance.show({type:2,reward:i,princessEffect:null},null)}},e.prototype.onUpdatePrince=function(t){var e=this,i=!1,n=t.data.prince;if(n.id==this._princeData.id){var r=this._princeData.fieldsModified;r.forEach(function(t){var r=t.field,o=t.value,s=t.oldValue,a=e.princeInfo;PrinceEntity.fields.indexOf(r)>=0?alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.prince_info_fields[r]+"+"+(o-s),component:a}):"level"==r&&o>s?(e.playLevelUp(),i=!0):"peerage"==r&&o>s?PanelPrincePeerage.instance.show(n):"openFlag"==r&&o>s&&PanelDecreePrinceOpen.instance.show(n)}),i||this.updateInfo(n)}},e.prototype.onSelectPrince=function(t){var e=t.data.prince;this.updateInfo(e)},e.prototype.onBtnGoTap=function(t){openService.getOpenStatus({name:"turn_card"})&&(SceneController.jump(ConstantNames.SCENE_PRINCESS_HOUSE),alien.EgretUtils.callLater(function(){PanelPrincessTurnCard.instance.show()},10))},e.prototype.createLevelUp=function(){this.levelUpEffect||(this.levelUpEffect=new alien.MovieClipView,this.levelUpEffect.aniName="upgrade",this.levelUpEffect.autoPlay=!1,this.levelUpEffect.x=245,this.levelUpEffect.y=445,this.grpInfo.addChild(this.levelUpEffect))},e.prototype.playLevelUp=function(){var t=this;this.levelUpEffect.visible=!0,this.levelUpEffect.movieClip.stop(),this.levelUpEffect.movieClip.gotoAndPlay(0,1),this.progress.slideDuration=200,this.progress.value=this._princeData.getNowMaxExp(),this.labNextCondition.text=lang.exp+":"+this._princeData.getNowMaxExp()+"/"+this._princeData.getNowMaxExp(),this.timer=egret.setTimeout(function(){t.progress.slideDuration=0,t.updateInfo(t._princeData)},this,200)},e.prototype.inactive=function(){t.prototype.inactive.call(this),this._cdId&&countDownService.unregister(this._cdId)},e}(TopSceneBase);__reflect(ScenePrince.prototype,"ScenePrince");var IRAct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.currentState=this.data?"normal":"none"},e}(alien.VisualEventItemRenderer);__reflect(IRAct.prototype,"IRAct");var ScenePrison=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._count=0,e._nowHp=0,e._metaId=0,e._cdId=0,e._tipTime=0,e._minTime=0,e._touchType=0,e._doubleTimes=0,e.onSecond=function(t){if(0>=t)return e._cdId=0,egret.clearTimeout(e._timer),e.stopAnimation(),e._count=0,void e.back();if(t>86400){var i=Math.floor(t/3600/24);e.labTime.text=i+lang.sky+alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")}else e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")},e.name=ConstantNames.SCENE_PRISON,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrisonSkin},e.prototype.getTitle=function(){return lang.prison},e.prototype.getCloseButtonSkin=function(){return ui.CloseButtonSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(this.list.dataProvider.source),this.registerEvent(this.grpPrison,egret.TouchEvent.TOUCH_BEGIN,this.onGrpPrisonTapBegin,this),this.registerEvent(this.grpPrison,egret.TouchEvent.TOUCH_END,this.onGrpPrisonTapEnd,this),this.registerEvent(this.list,egret.Event.CHANGE,this.onSelectItem,this),this.registerEvent(gameServer,ProtocolConfigs.WC_ACTIVITY_Response,this.onActivityResponse,this),this.registerEvent(activityService,EventNames.UPDATE_PRISON,this.onUpdatePrison,this),this.registerEvent(alien.Dispatcher,EventNames.REFRESH_PRISON_TOKEN,this.onRefreshPrisonToken,this),this.progressBar.labelDisplay.visible=!1,this.progressBar.minimum=0},e.prototype.initScene=function(){activityService.getActivity(6),this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0);var t=activityService.getActivityByType(ActivityEntity.ACTIVITY.TYPE_OFFICE);t.end_time-mainService.tsServer>0&&(this._cdId=countDownService.register(t.end_time,this.onSecond.bind(this))),this._minTime=10},e.prototype.onClose=function(){this._count>0&&this.beatWoman(),egret.clearTimeout(this._timer),this.stopAnimation(),t.prototype.onClose.call(this)},e.prototype.update=function(){var t=activityService.getSumResource();this.progressBar.maximum=t,this._metaId=activityService.getResourceId(),this.imgIcon.source=this.imgNow.source=this.imgSum.source="item_"+GameConfig.getItemMeta(this._metaId).icon+"_small",this._nowHp=activityService.getNowResource(),this.progressBar.value=this.progressBar.maximum-this._nowHp<0?0:this.progressBar.maximum-this._nowHp,this.labSum.text=t+"",this.labNow.text=this._nowHp+"",this._nowHp<t/2?this.imgPrisoner.source=this.getPrisonSource(1):this.imgPrisoner.source=this.getPrisonSource(2),this._dataProvider.refresh(),this.labProgress.text=this.progressBar.maximum-this._nowHp+"/"+this.progressBar.maximum;var e=activityService.getUseTime();this._type=activityService.getPrisonType(),1==this._type&&e-mainService.tsServer<-0&&(this._type=0)},e.prototype.getResGroupNames=function(){return["prison"]},e.prototype.getPrisonSource=function(t){return cdnurl+"resource/assets/singles/prisoners/"+t+".png"},e.prototype.playAnimation=function(){this.mcPrisonSkill.movieClip.stop(),0==this._type?(this.mcPrisonSkill.top=-95,this.mcPrisonSkill.aniName="action_1"):(this.mcPrisonSkill.top=200,this.mcPrisonSkill.aniName="action_2"),this.mcPrisonSkill.visible=!0,this.mcPrisonSkill.movieClip.gotoAndPlay(1,1)},e.prototype.stopAnimation=function(){this.mcPrisonSkill.movieClip.stop(),this.mcPrisonSkill.visible=!1},e.prototype.onGrpPrisonTapBegin=function(t){if(!(this._minTime<10)){this._minTime=0;var e=this.setDoubleTimes(),i=activityService.getActivityByType(ActivityEntity.ACTIVITY.TYPE_OFFICE);if(i){if(i.end_time-mainService.tsServer<=0||this._nowHp>=this.progressBar.maximum)return void(this._count>0&&this.beatWoman());this._nowHp<this.progressBar.maximum/2?this.imgPrisoner.source=this.getPrisonSource("1_beat"):this.imgPrisoner.source=this.getPrisonSource("2_beat"),this.playAnimation(),this._count++;var n=0==this._type?1:10,r=n*activityService.getSingleResource();this._nowHp+=r*e,this._nowHp>this.progressBar.maximum&&(this._nowHp=this.progressBar.maximum,2==e&&(e=1,this._doubleTimes--)),this._count>=10&&this.beatWoman(),this.progressBar.value=this.progressBar.maximum-this._nowHp,this.labNow.text=this._nowHp+"";var o=t.stageX,s=t.stageY;this.setPlayerView(this._metaId,r),alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION_IMAGE,{id:this._metaId,value:r*e,x:o,y:s}),s<this.grpPrison.y?this._touchType=0:this._touchType=1,this.grpContent.visible=!1,this.labProgress.text=this.progressBar.maximum-this._nowHp+"/"+this.progressBar.maximum,this._tipTime=0}}},e.prototype.setPlayerView=function(t,e){var i=0;switch(t){case 2:i=0;break;case 3:i=1;break;case 6:i=2}var n=this.grpPlayerView.getChildAt(i),r=packService.getCountByMetaId(t),o=r.add(e);n.updateValue(o)},e.prototype.onGrpPrisonTapEnd=function(t){var e=this;this._nowHp<this.progressBar.maximum/2?this.imgPrisoner.source=this.getPrisonSource("1"):this.imgPrisoner.source=this.getPrisonSource("2"),this._timer||(this._timer=egret.setInterval(function(){e._tipTime++,e._minTime++,e._tipTime%100==0&&(e._tipTime=0,e.grpContent.visible=!0,0==e._touchType?e.labContent.text=lang.prison_tip[alien.MathUtils.makeRandomInt(3,0)]:e.labContent.text=lang.prison_tip[alien.MathUtils.makeRandomInt(4,1)],egret.clearInterval(e._timer),e._timer=0)},this,10))},e.prototype.onSelectItem=function(t){t.preventDefault();var e=activityService.getUseTime(),i=activityService.getEndTime(),n=parseInt(this.list.selectedItem.type);if(n!=this._type){if(0==this._type){if(i-mainService.tsServer>0)return}else if(e-mainService.tsServer>0)return;this._count>0&&(this.beatWoman(),alien.Dispatcher.dispatch(EventNames.CLEAN_FLOAT_NOTIFICATION)),this._type=this.list.selectedItem.type,activityService.beatWoman(this._type,1,0)}},e.prototype.onActivityResponse=function(t){this.update()},e.prototype.onUpdatePrison=function(t){this.update()},e.prototype.onRefreshPrisonToken=function(t){this._count>0&&(this.beatWoman(),alien.Dispatcher.dispatch(EventNames.CLEAN_FLOAT_NOTIFICATION)),this.update()},e.prototype.beatWoman=function(){activityService.beatWoman(this._type,this._count,this._doubleTimes),this._count=0,this._doubleTimes=0},e.prototype.setDoubleTimes=function(){var t=alien.MathUtils.makeRandomInt(1e3,0);return 1==t?(this._doubleTimes++,2):1},e}(TopSceneBase);__reflect(ScenePrison.prototype,"ScenePrison");var PrisonItem=function(t){function e(){var e=t.call(this)||this;return e._cdId=0,e.onSecond=function(t){if(0>=t)return countDownService.unregister(e._cdId),e._cdId=0,void alien.Dispatcher.dispatch(EventNames.REFRESH_PRISON_TOKEN);var i=activityService.getPrisonType(),n=i==e._data.type?0:1;e.labState.text=lang.activity_prison_state[n]+alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}")},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setData=function(t){this._data=t,this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0),this.imgIcon.source=t.icon;var e=activityService.getPrisonType();if(t.type==e){this.currentState="use",this.labState.text=lang.activity_prison_state[0];var i=activityService.getUseTime();i-mainService.tsServer>0&&(this._cdId=countDownService.register(i,this.onSecond.bind(this)))}else if(0==t.type)this.currentState="normal";else{var n=activityService.getEndTime();n-mainService.tsServer>0?(this.currentState="cd",this.labState.text=lang.activity_prison_state[1],this._cdId=countDownService.register(n,this.onSecond.bind(this))):this.currentState="normal"}},e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0)},e}(alien.VisualEventComponent);__reflect(PrisonItem.prototype,"PrisonItem");var SceneStory=function(t){function e(){var e=t.call(this)||this;return e.onEnd=function(){gameServer.send(protocols.CLIENT_GAME_LoginRequest,{uid:dataCenterService.uid,playerId:mainService.playerBaseInfo.id})},e.name=ConstantNames.SCENE_STORY,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneStorySkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onWillEnter=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return MainStage.instance.storySection.play([2001,2002,2003,2004,2005,2006],-1,this.onEnd),[2,t.prototype.onWillEnter.call(this,e,i,n)]})})},e}(SceneBase);__reflect(SceneStory.prototype,"SceneStory");var SceneTechnology=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e.name=ConstantNames.SCENE_TECHNOLOGY,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneTechnologySkin},e.prototype.getResGroupNames=function(){return["technology"]},e.prototype.getHelp=function(){return"tech_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.vs.setup({def:InternalTecList},{def:CultureTecList},{def:AffairTecList}),this.vs.setSelectedIndex(0,null,!0),this.registerEvent(technologyService,EventNames.REFRESH_TECHNOLOGY,this.update,this)},e.prototype.update=function(){var t=activityTimeService.getActivityTimesByIds(technologyService.techActivityTime),e=0,i=this.vs.selectedChild;t.forEach(function(t){t&&t["int"]&&e++}),i.update({data:null}),this.labQueue.text=lang.tech_queue+":"+e+"/"+technologyService.getMaxQueue()},e.prototype.getTitle=function(){return lang.technology},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex,this.update()},e.prototype.onWillEnter=function(e,i,n){return this._tab=0,n&&n.tab&&(this._tab=n.tab),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.initScene=function(t){this.tabBar.selectedIndex=this._tab,this.vs.setSelectedIndex(this._tab,null,!0),this.update()},e}(TopSceneBase);__reflect(SceneTechnology.prototype,"SceneTechnology");var SceneThrone=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.SCENE_THRONE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneThroneSkin},e.prototype.getResGroupNames=function(){return["throne"]},e.prototype.showFrame=function(){return!1},e.prototype.getTitle=function(){return lang.throne},e.prototype.getHelp=function(){return"throne_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bottomBar.itemRenderer=IRThroneBottomButton,this.registerEvent(this.bottomBar,egret.Event.CHANGING,this.onBottomBarTap,this)},e.prototype.onWillEnter=function(e,i,n){return i==alien.NavigatorAction.Push&&(SoundManager.instance.stopEffect(ResNames.effect_leave_throne),SoundManager.instance.playEffect(ResNames.effect_enter_throne)),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.onDidLeave=function(e,i,n){i==alien.NavigatorAction.Pop&&(SoundManager.instance.stopEffect(ResNames.effect_enter_throne),SoundManager.instance.playEffect(ResNames.effect_leave_throne)),t.prototype.onDidLeave.call(this,e,i,n)},e.prototype.initScene=function(){},e.prototype.onBottomBarTap=function(t){switch(t.preventDefault(),this.bottomBar.selectedItem.field){case"interior":this["goto"](ConstantNames.SCENE_INTERIOR);break;case"memorial":packService.newTreasure.splice(0);var e=memorialService.getOne();e?PanelMemorial.instance.show(e):Toast.show({text:lang.no_more_memorial});break;case"office":this["goto"](ConstantNames.SCENE_OFFICE)}},e}(TopSceneBase);__reflect(SceneThrone.prototype,"SceneThrone");var IRThroneBottomButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="throne_icon_"+this.data.field,this.iconDisplay.horizontalCenter=this.data.offsetX,this.labelDisplay.source="throne_label_"+this.data.field,this.badgeView.showCount="true"==this.data.showCount?!0:!1,this.badgeView.bid=this.data.badgeId},e}(eui.ItemRenderer);__reflect(IRThroneBottomButton.prototype,"IRThroneBottomButton");var SceneTreasure=function(t){function e(){var e=t.call(this)||this;return e._item={id:0,count:0,component:null},e._price=[0,200,1888,1e3,5e3,1,1],e.name=ConstantNames.SCENE_TREASURE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneTreasureSkin},e.prototype.getResGroupNames=function(){return["treasure"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.registerEvent(this.grpConquer,egret.TouchEvent.TOUCH_TAP,this.onGrpConquerTap,this),this.registerEvent(this.grpDragon,egret.TouchEvent.TOUCH_TAP,this.onGrpDragonTap,this),this.registerEvent(gameServer,protocols.WC_DRAWITEM_RESPONSE,this.onDrawItemResponse,this),this.registerEvent(this.dragonItem,egret.TouchEvent.TOUCH_TAP,this.onDragonItemTap,this),this.dragonItem.metaId=600100},e.prototype.getTitle=function(){return lang.treasure},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.initScene=function(){var t=GameConfig.getPrincessMeta(200006);this.imgBody.source=PrincessEntity.parseBodyUrl(t.icon),this.imgBody.x=220-t.body_offset.x*this.imgBody.scaleX,this.imgBody.y=-15-t.body_offset.y*this.imgBody.scaleY,this.update()},e.prototype.update=function(){this.labConquer.text=wsy.Utils.shortCurrency(mainService.playerInfo.conquest)+"/"+wsy.Utils.shortCurrency(Math.floor(.05*mainService.playerInfo.area));var t=packService.getCountByMetaId(600103),e=packService.getCountByMetaId(600104);if(t>0){this.grpGoldOne.visible=!1,this.grpDragonOne.visible=!0;var i=GameConfig.getItemMeta(600103);this.labDragonOne.text=i.name+":"+t}else this.grpDragonOne.visible=!1,this.grpGoldOne.visible=!0;if(e>0){this.grpGoldTen.visible=!1,this.grpDragonTen.visible=!0;var i=GameConfig.getItemMeta(600104);this.labDragonTen.text=i.name+":"+e}else this.grpGoldTen.visible=!0,this.grpDragonTen.visible=!1;mainService.playerInfo.gold<this._price[ShopService.Treasure.TYPE_DRAGON_ONE]?(this.labGoldOne.textColor=15208464,this.labGoldTen.textColor=15208464):mainService.playerInfo.gold<this._price[ShopService.Treasure.TYPE_DRAGON_TEN]?(this.labGoldOne.textColor=16777215,this.labGoldTen.textColor=15208464):(this.labGoldOne.textColor=16777215,this.labGoldTen.textColor=16777215),mainService.playerInfo.conquest<this._price[ShopService.Treasure.TYPE_CONQUER_ONE]?(this.labConquerOne.textColor=15208464,this.labConquerFive.textColor=15208464):mainService.playerInfo.conquest<this._price[ShopService.Treasure.TYPE_CONQUER_FIVE]?(this.labConquerOne.textColor=16777215,this.labConquerFive.textColor=15208464):(this.labConquerOne.textColor=16777215,this.labConquerFive.textColor=16777215)},e.prototype.onGrpConquerTap=function(t){switch(t.target.name){case"btnOne":this._item.count=1,this.buyTreasure(ShopService.Treasure.TYPE_CONQUER_ONE);break;case"btnFive":this._item.count=5,this.buyTreasure(ShopService.Treasure.TYPE_CONQUER_FIVE);break;case"grpHelp":PanelTreasureIntro.instance.show([{content:lang.formatHtml(lang.treasure_buy_rule[1])}])}this._field="silver",this._item.id=600090,this._item.component=t.target},e.prototype.onGrpDragonTap=function(t){switch(t.target.name){case"btnOne":this._item.count=1,this.buyTreasure(ShopService.Treasure.TYPE_DRAGON_ONE);break;case"btnTen":this._item.count=10,this.buyTreasure(ShopService.Treasure.TYPE_DRAGON_TEN);break;case"grpHelp":PanelTreasureIntro.instance.show([{content:lang.formatHtml(lang.treasure_buy_rule[0])}])}this._field="gold",this._item.id=600091,this._item.component=t.target},e.prototype.buyTreasure=function(t){var e=lang.treasure_buy_alert_content[t],i=this._price[t];switch(t){case ShopService.Treasure.TYPE_DRAGON_ONE:var n=packService.getCountByMetaId(600103);if(n>0)e=lang.treasure_buy_alert_content[5],i=this._price[5];else if(mainService.playerInfo.gold<i)return void Toast.show({text:lang.response_error[38]});break;case ShopService.Treasure.TYPE_DRAGON_TEN:var r=packService.getCountByMetaId(600104);if(r>0)e=lang.treasure_buy_alert_content[6],i=this._price[6];else if(mainService.playerInfo.gold<i)return void Toast.show({text:lang.response_error[38]});break;case ShopService.Treasure.TYPE_CONQUER_ONE:case ShopService.Treasure.TYPE_CONQUER_FIVE:if(mainService.playerInfo.conquest<i)return void Toast.show({text:lang.response_error[89]})
}Alert.show(lang.formatHtml(e,i),1,function(e){"confirm"==e.name&&shopService.drawItem(t)})},e.prototype.onDrawItemResponse=function(t){if(!(t.data.error>0)){this.update();var e=this._item.component;alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION_IMAGE,{id:this._item.id,value:this._item.count,component:e}),PanelTreasureBox.instance.show({rewards:t.data.rewards,field:this._field})}},e.prototype.onDragonItemTap=function(t){PanelItemDetails.instance.show({id:600100})},e.prototype.playAnimation=function(t){},e}(TopSceneBase);__reflect(SceneTreasure.prototype,"SceneTreasure");var SceneUnion=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.SCENE_UNION,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneUnionSkin},e.prototype.getTitle=function(){return lang.union},e.prototype.getCloseButtonSkin=function(){return ui.CloseButtonSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBody.mask=this.bodyMask,this.list.itemRenderer=IRUnionFunctionButton,this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(this.tabBar,egret.TouchEvent.CHANGE,this.onTabBarTap,this),this.registerEvent(gameServer,protocols.WC_ORG_INIT_NOTIFY,this.onOrgInitNotify,this),this.registerEvent(unionService,EventNames.UPDATE_UNION_INFO,this.onUpdateUnionInfo,this),this.registerEvent(unionService,EventNames.UPDATE_UNION_MEMBER,this.onUpdateMember,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPlayerPropsModified,this),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this);var e=GameConfig.getMinisterMeta(110005);this.imgBody.source=MinisterEntity.parseBodyUrl(e.icon),this.imgBody.anchorOffsetX=e.body_offset.x,this.labContent.textFlow=lang.formatHtml(lang.union_join_tip),this.vs.setup({def:UnionFunction})},e.prototype.initScene=function(){this.tabBar.selectedIndex=0,this.vs.selectedIndex=0,this.update()},e.prototype.update=function(){if(this.currentState=mainService.playerInfo.union_id?"my_union":"no_union",mainService.playerInfo.union_id){var t=unionService.union.info,e=t.level>UnionEntity.MAX_LEVEL?UnionEntity.MAX_LEVEL:t.level;this.progress.maximum=GameConfig.getUnionExpMeta(e).upgrade_exp,this.progress.value=t.exp,this.labName.text=t.name,this.labLevel.text=t.level+"",this.labCount.text=t.playerNum+"/"+t.maxPlayerNum,this.labId.text=t.id+"";var i=unionService.getMyUnionInfo();i&&(this.contribute.value=i.contribute,this.position.value=lang.union_position[i.position])}},e.prototype.onGrpButtonsTap=function(t){switch(t.target.name){case"build":PanelUnionBuild.instance.show();break;case"join":PanelUnionJoin.instance.show();break;case"rank":PanelUnionRank.instance.show()}},e.prototype.onSelectItem=function(t){switch(t.preventDefault(),this.list.selectedItem.name){case"notice":PanelUnionNotice.instance.show({content:unionService.union.info.msg});break;case"log":PanelUnionLog.instance.show()}},e.prototype.onTabBarTap=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.onOrgInitNotify=function(t){this.update()},e.prototype.onUpdateUnionInfo=function(t){this.update()},e.prototype.onUpdateMember=function(t){var e=t.data,i=e.optType,n=e.member;0==i&&n.id==dataCenterService.pid&&(this.contribute.value=n.contribute,this.position.value=lang.union_position[n.position])},e.prototype.onPlayerPropsModified=function(t){var e=t.data.field;if("union_id"==e){var i=t.data,n=i.value,r=i.oldValue;n>r?(this.update(),this.enter_my_union.play(0)):r>n&&(this.update(),this.enter_no_union.play(0))}},e}(TopSceneBase);__reflect(SceneUnion.prototype,"SceneUnion");var SceneVisit=function(t){function e(){var e=t.call(this)||this;return e.awards=[],e.likeValue=0,e.doFlag=!0,e._cdId=0,e.onSecond=function(t){return 0>t?(e._cdId=0,void e.onUpdateEnergy()):void e.energy.updateValue(lang.formatHtml(visitService.getEnergy()+"/"+visitService.getMaxEnergy()+" <font color='#A2FF66'>("+alien.TimeUtils.timeFormat(t,"{1}:{0}")+")</font> "))},e.name=ConstantNames.SCENE_VISIT,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneVisitSkin},e.prototype.getResGroupNames=function(){return["visit"]},e.prototype.getHelp=function(){return"visit_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.map.touchEnabled=!0,this.diceEffect.autoPlay=!1,this.registerEvent(this.grpBtn,egret.TouchEvent.TOUCH_TAP,this.onGrpBtnTap,this),this.registerEvent(this.energy,EventNames.PROPVIEW_TAP_ADD,this.onBtnAddTap,this),this.registerEvent(alien.Dispatcher,EventNames.UPDATE_VISIT,this.update,this),this.registerEvent(this.map,egret.TouchEvent.TOUCH_TAP,this.onMapTap,this),this.registerEvent(alien.Dispatcher,EventNames.SELECT_DICE,this.onSelectDice,this),this.registerEvent(gameServer,protocols.WC_ROLLDICE_RESPONSE,this.onRollDiceResponse,this),this.registerEvent(gameServer,protocols.WC_ROLLFIXEDDICE_RESPONSE,this.onRollFixedDiceResponse,this),this.registerEvent(visitService,EventNames.UPDATE_CITY,this.onUpdateCity,this),this.registerEvent(visitService,EventNames.UPDATE_VISIT_ENERGY,this.onUpdateEnergy,this),this.registerEvent(this.diceEffect.movieClip,egret.Event.COMPLETE,this.showDice,this),this.registerEvent(alien.Dispatcher,EventNames.UPDATE_VISIT,this.update,this),this.registerEvent(mainService.playerInfo,EventNames.PLAYER_PROPS_MODIFIED,this.onPlayerPropsModified,this)},e.prototype.onWillEnter=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,t.prototype.onWillEnter.call(this,e,i,n)];case 1:return r.sent(),[4,this.diceEffect.setAniName("dice")];case 2:return r.sent(),[2]}})})},e.prototype.getTitle=function(){return lang.private_visit},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.initScene=function(){var t=visitService.getKingCity();this.seat.updateValue(visitService.getCarriageCount()),this.onUpdateEnergy(),this.doFlag=!0,this.map.init();visitService.getById(t);visitService.getEnergy()<=0?this.energy.playNotice():this.energy.stopNotice(),this.awards.splice(0)},e.prototype.inactive=function(){t.prototype.active.call(this),this.energy.stopNotice(),this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0)},e.prototype.onGrpBtnTap=function(t){if(1==this.visitCarriage.visible)return void this.visitCarriage.hideCarriage();if(this.doFlag&&this.map.isGoal())switch(t.target.name){case"carriage":this.visitCarriage.showCarriage(this.grpBtn.y);break;case"develop":PanelVisitDevelop.instance.show(visitService.getKingCity());break;case"visit":this.doFlag=!1,visitService.rollDice()}},e.prototype.showCarriage=function(){this.visitCarriage.visible=!0;var t=this.grpBtn.y-this.visitCarriage.height-10;egret.Tween.get(this.visitCarriage).to({y:t},500,egret.Ease.sineIn)},e.prototype.onBtnAddTap=function(t){PanelAddPower.instance.show([600059,600060,600061],null)},e.prototype.onMapTap=function(t){var e=t.target.name.split("_")[1];e&&this.map.isGoal()&&PanelCityInfo.instance.show(e)},e.prototype.onSelectDice=function(t){var e=t.data.value;this.doFlag=!1,visitService.rollFixedDice(e),this.visitCarriage.hideCarriage()},e.prototype.update=function(t){var e=this,i=t.data.cityId;visitService.getById(i);PanelWorkFinish.instance.show({type:2,reward:this.awards,princessEffect:null},function(){e.likeValue=0,e.awards.splice(0),PanelCityInfo.instance.show(i)}),this.doFlag=!0},e.prototype.showPrincess=function(){},e.prototype.onRollDiceResponse=function(t){return 0!=t.data.error?void(this.doFlag=!0):void this.playDice()},e.prototype.onRollFixedDiceResponse=function(t){if(0!=t.data.error)return void(this.doFlag=!0);this.seat.updateValue(visitService.getCarriageCount());var e=visitService.getKingCity(),i=e-this.map.cityId;i=i>=0?i:20+i,this.map.cityId=e},e.prototype.onPlayerPropsModified=function(t){if(!t.data.locked){var e=t.data,i=e.field,n=e.value,r=e.oldValue,o=n-r;if(o>0)switch(this.awards.splice(0),i){case"troops":this.awards.push({id:6,count:o});break;case"silver":this.awards.push({id:2,count:o});break;case"mineral":this.awards.push({id:3,count:o})}}},e.prototype.onUpdateCity=function(t){var e=this;this.likeValue=0;var i=t.data.city;this.map.onUpdateCity(i),i.fieldsModified.forEach(function(t){var n=t.field,r=t.value,o=t.oldValue;n==CityEntity.cityFields[1]?r>o&&(e.likeValue=r-o):n==CityEntity.cityFields[0]&&r>o&&e.map.playBuildEffect(i)})},e.prototype.onUpdateEnergy=function(t){void 0===t&&(t=null);var e=activityTimeService.getById(76);this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0),e&&e.timestamp-mainService.tsServer>0&&visitService.getEnergy()<visitService.getMaxEnergy()?this._cdId=countDownService.register(e.timestamp,this.onSecond.bind(this)):this.energy.updateValue(visitService.getEnergy()+"/"+visitService.getMaxEnergy()),visitService.getEnergy()<=0?this.energy.playNotice():this.energy.stopNotice()},e.prototype.playDice=function(){this.diceEffect.visible=!0,this.diceEffect.movieClip.stop(),this.diceEffect.movieClip.gotoAndPlay(0,5)},e.prototype.showDice=function(t){this.diceEffect.visible=!1;var e=visitService.getKingCity(),i=e-this.map.cityId;i=i>0?i:20+i,this.btnVisit.icon="visit_dice_result_"+i,this.map.cityId=e},e.prototype.onClose=function(){t.prototype.onClose.call(this),this.diceEffect.movieClip.stop(),this.diceEffect.visible=!1,egret.Tween.removeTweens(this.imgDice)},e}(TopSceneBase);__reflect(SceneVisit.prototype,"SceneVisit");var SceneWarehouse=function(t){function e(){var e=t.call(this)||this;return e._reward=[],e.name=ConstantNames.SCENE_WAREHOUSE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneWarehouseSkin},e.prototype.getResGroupNames=function(){return["warehouse"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.vs.setup({def:ItemListView,params:{type:0}},{def:GoodsCombineListView,params:{type:0}},{def:ItemListView,params:{type:1}}),this.vs.selectedIndex=0,this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this),this.registerEvent(gameServer,protocols.WC_ITEM_USE_Response,this.onItemUseResponse,this),this.registerEvent(gameServer,protocols.WC_ITEM_COMPOSE_Response,this.onItemComposeResponse,this)},e.prototype.getTitle=function(){return lang.warehouse},e.prototype.initScene=function(){packService.newTreasure.splice(0)},e.prototype.onClose=function(){t.prototype.onClose.call(this),packService.newItemValue=0,packService.updateBadge()},e.prototype.getBackParameters=function(){return{pageName:ConstantNames.LOBBY_MAIN}},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.onUpdateItem=function(t){var e=this.vs.selectedChild,i=t.data.item;if(i){e.type==i.meta.subtype&&e.update(t.data);var n={id:i.meta.id,count:0};i.fieldsModified.some(function(t){return"count"==t.field&&t.value>t.oldValue?(n.count+=t.value-t.oldValue,t.oldValue=t.value,!0):void 0}),n.count>0&&this._reward.push(n)}else e.update()},e.prototype.onItemComposeResponse=function(t){t.data.error>0||(Toast.show({text:lang.combine_success}),this.clearTreasure())},e.prototype.onItemUseResponse=function(t){var e=packService.nowItem;if(0!=e.metaId){var i=GameConfig.getItemMeta(e.metaId);switch(i.type){case 1:case 2:case 3:PanelWorkFinish.instance.show({type:2,reward:[{id:i.type,count:i["export"]*e.count}],princessEffect:null},this.clearTreasure.bind(this));break;case 4:PanelWorkFinish.instance.show({type:2,reward:[{id:6,count:i["export"]*e.count}],princessEffect:null},this.clearTreasure.bind(this));break;case 5:var n=ministerService.getById(e.targetId),r="";n&&(r=n.meta.name),Toast.show({text:lang.format(r+lang.item_use_tips.exploit,i["export"]*e.count)});break;case 9:Toast.show({text:lang.format(lang.item_use_tips.energy,i["export"]*e.count)});break;case 10:Toast.show({text:lang.format(lang.item_use_tips.strength,i["export"]*e.count)});break;case 15:Toast.show({text:lang.format(lang.item_use_tips.impose,10*e.count)});break;case 16:this._reward.length>0&&PanelWorkFinish.instance.show({type:2,reward:this._reward,princessEffect:null},this.clearTreasure.bind(this));break;case 17:var o=[];GameConfig.getGiftPackMeta(i["export"]).items.forEach(function(t){var i={id:t.id,count:t.count*e.count};o.push(i)}),o.length>0&&PanelWorkFinish.instance.show({type:2,reward:o,princessEffect:null},this.clearTreasure.bind(this))}packService.setNowItem(0,0,"")}},e.prototype.clearTreasure=function(){packService.newTreasure.splice(0),this._reward.splice(0)},e}(TopSceneBase);__reflect(SceneWarehouse.prototype,"SceneWarehouse");var SceneWorldBoss=function(t){function e(){var e=t.call(this)||this;return e._cdId=0,e._emailFlag=!1,e._reward=[],e.lastTouchTime=0,e.name=ConstantNames.SCENE_WORLD_BOSS,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneWorldBossSkin},e.prototype.getResGroupNames=function(){return["world_boss","duplicate"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnExit,egret.TouchEvent.TOUCH_TAP,this.onBtnExitTap,this),this.registerEvent(this.btnHelp,egret.TouchEvent.TOUCH_TAP,this.onBtnHelpTap,this),this.registerEvent(bossService,EventNames.UPDATE_BOSS_INFO,this.onUpdateBossInfo,this),this.registerEvent(this.grpFight,egret.TouchEvent.TOUCH_TAP,this.onBtnFightTap,this),this.registerEvent(this.btnSpeed,egret.TouchEvent.TOUCH_TAP,this.onBtnSpeedTap,this),this.registerEvent(gameServer,protocols.WC_Boss_Battle_Response,this.onBossBattleResponse,this),this.registerEvent(this.grpSkill,egret.TouchEvent.TOUCH_TAP,this.onGrpSkillTap,this),this.registerEvent(gameServer,protocols.WC_Boss_BuyBuff_Response,this.onBossBuyBuffResponse,this),this.registerEvent(gameServer,protocols.WC_MailRecvResponse,this.onMailRecvResponse,this),this.registerEvent(gameServer,protocols.WC_ReadMailResponse,this.onReadMailResponse,this),this.registerEvent(bossService,EventNames.BOSS_SELECT_NOTIFY,this.onBossSelectNotify,this),this.registerEvent(packService,EventNames.UPDATE_ITEM,this.onUpdateItem,this),this.registerEvent(this.btnAutoFight,egret.TouchEvent.TOUCH_TAP,this.onBtnAutoFightTap,this),this.registerEvent(gameServer,protocols.WC_Boss_Select_Response,this.onBossSelectResponse,this),this._shake=new alien.Wave(this.imgBoss,500,alien.Wave.shake.bind(null,5,2),0,!1,!0,0),this._wave=new alien.Wave(this.btnFight,4e3,alien.Wave.zoom.bind(null,.05))},e.prototype.initScene=function(t){this.initBoss(),bossService.getBossInfo(BossEntity.BOSS_TYPE.WORLD),this._reward=[],this.effect.visible=dataCenterService.bossAutoFight,this._wave.play()},e.prototype.inactive=function(){this._cdId&&(countDownService.unregister(this._cdId),this._cdId=0,this._emailFlag=!1),PanelBossSelectMinister.instance.close(),this._wave.stop(),t.prototype.inactive.call(this)},e.prototype.initBoss=function(){this.labHp.visible=!1,this.hpItem.update(),this.imgBoss.source=BossEntity.parseBossBodyUrl(BossEntity.WORLD_BOSS_ID),this.labName.text=lang.boss_name},e.prototype.update=function(){if(bossService.boss.hp<=0&&bossService.boss.fightStatus)return void(this.currentState="unOpen");if(bossService.boss.endTime<mainService.tsServer||bossService.boss.id<0)return void(this.currentState="unOpen");if(this.currentState=bossService.boss.fightStatus?"wait":"ready",this._cdId<=0){var t=bossService.boss.endTime;t-mainService.tsServer>0?this._cdId=countDownService.register(t,this.onSecond.bind(this)):this.labTime.text="00:00:00"}this.updateMinister()},e.prototype.updateMinister=function(){var t=bossService.boss.ministers;alien.Utils.enumChildren(this.grpMinister,function(e,i){e.id=t[i]?t[i].id:null,e.x=134.5+(e.width+20)*i,e.y=150.5}),bossService.boss.damage>0&&this._reward.length>0?(this.currentState="fight",this.play()):this.hpItem.update()},e.prototype.onUpdateBossInfo=function(t){this.update()},e.prototype.onBtnFightTap=function(t){bossService.startFight(BossEntity.BOSS_TYPE.WORLD,[{id:""},{id:""},{id:""}])},e.prototype.onBtnAutoFightTap=function(t){dataCenterService.bossAutoFight=!dataCenterService.bossAutoFight,this.effect.visible=dataCenterService.bossAutoFight},e.prototype.onBossSelectResponse=function(t){this.effect.visible=dataCenterService.bossAutoFight,0==t.data.error&&bossService.getBossInfo(BossEntity.BOSS_TYPE.WORLD)},e.prototype.onBtnSpeedTap=function(t){var e=(new Date).getTime();e-this.lastTouchTime<1e3||(this.lastTouchTime=e,bossService.buyCD(BossEntity.WORLD_BOSS_ID))},e.prototype.onBossBattleResponse=function(t){0==t.data.error&&bossService.getBossInfo(BossEntity.BOSS_TYPE.WORLD)},e.prototype.onSecond=function(t){if(0>=t)return countDownService.unregister(this._cdId),this._cdId=0,void(this._emailFlag||this.back());t>86400?this.labTime.text=alien.TimeUtils.timeFormat(t,"{3}:{2}:{1}:{0}"):this.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}");var e=bossService.boss.roundTime;e>=mainService.tsServer&&bossService.boss.fightStatus?(this.labCountDown.text=e-mainService.tsServer+"",this.labCost.text="X"+2*Math.ceil((e-mainService.tsServer)/5)):bossService.boss.fightStatus||t%10!=0||(bossService.getBossInfo(BossEntity.BOSS_TYPE.WORLD),this.hpItem.update())},e.prototype.onGrpSkillTap=function(t){switch(t.target.name){case"normal":if(bossService.boss.buffer1Time>mainService.tsServer||0==bossService.boss.fightStatus)return;Alert.show(lang.duplicate_use_skill_alert.normal,1,function(t){"confirm"==t.name&&bossService.useBuffer(BossEntity.BOSS_TYPE.WORLD,BossEntity.BUFFER_TYPE.NORMAL)});break;case"advance":if(0==bossService.boss.fightStatus)return;Alert.show(lang.duplicate_use_skill_alert.advance,1,function(t){"confirm"==t.name&&bossService.useBuffer(BossEntity.BOSS_TYPE.WORLD,BossEntity.BUFFER_TYPE.ADVANCE)})}},e.prototype.onBossBuyBuffResponse=function(t){0==t.data.error&&(Toast.show({text:lang.duplicate_skill_success}),bossService.getBossInfo(BossEntity.BOSS_TYPE.WORLD))},e.prototype.onMailRecvResponse=function(t){0==t.data.error&&t.data.senderId==BossEntity.EMAIL_SENDER_ID.WORLD_BOSS&&(this._emailFlag=!0,emailService.readMail(t.data.id))},e.prototype.onReadMailResponse=function(t){var e=this;0==t.data.error&&Alert.show(t.data.content,0,function(t){bossService.getBossInfo(BossEntity.BOSS_TYPE.WORLD),SceneController.instance.navigator.currentName==ConstantNames.SCENE_WORLD_BOSS&&e.back()})},e.prototype.onBossSelectNotify=function(t){PanelBossSelectMinister.instance.getOpenState()&&this._reward.splice(0),dataCenterService.bossAutoFight||PanelBossSelectMinister.instance.show()},e.prototype.play=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(n){switch(n.label){case 0:return this.labHp.visible=!0,this.labHp.alpha=0,this.labHp.text="-"+bossService.boss.damage,t={x:this.grpMinister.x,y:this.grpMinister.y},e=this.labHp.localToGlobal(this.labHp.width/2,this.labHp.height/2-this.grpMinister.height/2),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(this.grpMinister).wait(1e3).to({bottom:550,alpha:0,scaleX:.4,scaleY:.4},500,egret.Ease.backIn))];case 1:return n.sent(),this._shake.play(),[4,alien.EgretUtils.getTweenPromise(egret.Tween.get(this.labHp).to({alpha:1},100,egret.Ease.circInOut).to({bottom:260,alpha:0},800,egret.Ease.circInOut).call(function(){if(i._reward.length>0){var t=i._reward.slice();t.forEach(function(t){var e=i.grpBoss;alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION_ITEM,{id:t.id,value:t.count,component:e})})}}).wait(300).call(function(){i.labHp.visible=!1,i.labHp.bottom=115,i.hpItem.update(),i.currentState="wait",i.grpMinister.alpha=1,i._reward.splice(0),alien.EgretUtils.callLater(function(){i.grpMinister.bottom=115,i.grpMinister.alpha=1,i.grpMinister.scaleX=1,i.grpMinister.scaleY=1,i._shake.stop()})}))];case 2:return n.sent(),[2]}})})},e.prototype.onBtnExitTap=function(t){this.back()},e.prototype.onBtnHelpTap=function(t){PanelRuleIntro2.instance.show({contents:lang.world_boss_rules,type:3})},e.prototype.onUpdateItem=function(t){var e=t.data.item;if(e){var i={id:e.meta.id,count:0};e.fieldsModified.some(function(t){return"count"==t.field&&t.value>t.oldValue?(i.count+=t.value-t.oldValue,t.oldValue=t.value,!0):void 0}),i.count>0&&(this._reward.splice(0),this._reward.push(i))}},e}(SceneBase);__reflect(SceneWorldBoss.prototype,"SceneWorldBoss");var SceneWorldMap=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e.dispatchGuidePoint=function(t){e.getOpenConfigs(t)},e.onPanelNewOpenClose=function(t){"goto"==t&&e.back({pageName:ConstantNames.LOBBY_MAIN})},e.name=ConstantNames.SCENE_WORLD_MAP,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneWorldMapSkin},e.prototype.getHelp=function(){return"battle_rules"},e.prototype.getResGroupNames=function(){return["battle"]},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnWorldMap,egret.TouchEvent.TOUCH_TAP,this.onBtnWorldMapTap,this),this.registerEvent(gameServer,protocols.WC_BATTLE_INFO_Response,this.onBattleInfoResponse,this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.vs.setup({def:Conquer},{def:Suppress})},e.prototype.onWillEnter=function(e,i,n){var r=this;if(n&&n.complete){var o=n.country;egret.setTimeout(function(){PanelQuickMemorial.instance.show({text:lang.formatHtml(lang.battle_reward_content,o.name),reward:o.reward},function(){7001==o.id||7002==o.id?PanelVisitPrincess.instance.show({country:o},r.dispatchGuidePoint.bind(r,o.id),1):r.dispatchGuidePoint(o.id)})},this,500)}return n&&n.tab&&(this._tab=n.tab),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.onDidEnter=function(e,i,n){t.prototype.onDidEnter.call(this,e,i,n),SoundManager.instance.playMusic(ResNames.music_battle,{volume:.2})},e.prototype.onWillLeave=function(e,i,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return i==alien.NavigatorAction.Pop&&LobbyPageController.instance.playMusic(),[2,t.prototype.onWillLeave.call(this,e,i,n)]})})},e.prototype.getOpenConfigs=function(t){var e=openService.getConfigsByType(OpenService.OpenType.WORLD_MAP,t);e.length>0&&PanelNewOpen.instance.show(e,this.onPanelNewOpenClose,t)},e.prototype.getBackParameters=function(){return{pageName:ConstantNames.LOBBY_MAIN}},e.prototype.getTitle=function(){return lang.world_map},e.prototype.initScene=function(){battleService.getBattleInfo(),this.updateTopInfo(),this.tabBar.selectedIndex=this._tab,this.vs.selectedIndex=this._tab},e.prototype.updateTopInfo=function(){var t=mainService.playerInfo;this.troops.value=t.troops,this.hp.value=t.hp,this.attack.value=t.attack},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex,this._tab=this.tabBar.selectedIndex},e.prototype.onBtnWorldMapTap=function(t){PanelWorldMap.instance.show()},e.prototype.renderInfo=function(){var t=this,e=battleService.country;battleService.gotCount,battleService.totalCount;e&&(this.worldMap.update(),alien.EgretUtils.callLater(function(){t.worldMap.countryId=e.id},2))},e.prototype.onBattleInfoResponse=function(t){this.renderInfo()},e}(TopSceneBase);__reflect(SceneWorldMap.prototype,"SceneWorldMap");var alien;!function(t){var e=function(){function t(){}return t.registerPool=function(t,e,i){void 0===i&&(i=null),this.createMethods[t]=e,this.initMethods[t]=i,this.pools[t]=[]},t.getObject=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.pools[t];if(!n)return console.warn(t+"没有注册在对象池中。"),null;var r;if(n.length>0)r=n.shift();else{var o=this.createMethods[t];r=o.apply(null,e)}var s=this.initMethods[t];return s&&(e.unshift(r),s.apply(null,e)),this.debug(),r},t.recycleObject=function(t,e){if(e){var i=this.pools[t];if(!i)return void console.warn(t+"没有注册在对象池中。");i.indexOf(e)<0&&i.length<=this.MAX&&i.push(e),this.debug()}},t.debug=function(){var t="";for(var e in this.pools){var i=this.pools[e];t+=e+":"+i.length+"\n"}},t.MAX=20,t.createMethods={},t.initMethods={},t.pools={},t}();t.ObjectPool=e,__reflect(e.prototype,"alien.ObjectPool")}(alien||(alien={}));var SceneMinister=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e.name=ConstantNames.SCENE_MINISTER,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneMinisterSkin},e.prototype.getResGroupNames=function(){return["minister"]},e.prototype.getHelp=function(){return"minister_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.tabBar,egret.Event.CHANGING,this.onTabChanging,this),this.vs.setup({def:MinisterList},{def:MinisterHire},{def:MinisterPicture},{def:MinisterFate}),this.vs.setSelectedIndex(0,null,!0)},e.prototype.onWillEnter=function(e,i,n){return this._tab=0,n&&n.tab&&(this._tab=n.tab),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.getTitle=function(){return lang.minister},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.onTabChanging=function(t){1!=this.tabBar.selectedIndex||openService.getOpenStatus({name:"minister_hire"})||t.preventDefault()},e.prototype.initScene=function(){this.tabBar.selectedIndex=this.vs.selectedIndex=this._tab},e}(TopSceneBase);__reflect(SceneMinister.prototype,"SceneMinister");var SceneMinisterInfo=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e.onPeerageResult=function(t,i){"success"==t&&(e.updateInfo(),PanelDecreePeerage.instance.show({minister:e.minister}))},e.name=ConstantNames.SCENE_MINISTER_INFO,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneMinisterInfoSkin},e.prototype.getResGroupNames=function(){return["minister_info"]},e.prototype.getHelp=function(){return"minister_info_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.vs.setup({def:MinisterQualification},{def:MinisterSkill},{def:MinisterTreasure}),this.progress.value=0,this.progress.labelDisplay.visible=!1,this.listInfo.itemRenderer=IRMinisterInfo,this.listInfo.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.registerEvent(this.btnShowDetails,egret.TouchEvent.TOUCH_TAP,this.onBtnShowDetailsTap,this),this.registerEvent(this.btnLevelUp,egret.TouchEvent.TOUCH_TAP,this.onBtnLevelUpTap,this),this.registerEvent(gameServer,protocols.WC_UPDATE_CARD_NOTIFY,this.onUpdateMinisterNotify,this),this.registerEvent(gameServer,protocols.WC_CARD_ADDLEVEL_Response,this.onUpgradeResponse,this),this.imgBody.mask=this.bodyMask},e.prototype.onWillEnter=function(e,i,n){return n&&n.minister&&(this.minister=n.minister,this._tab=0),n&&n.tab&&(this._tab=n.tab),SoundManager.instance.playEffect(this.sound=this.minister.soundUrl),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.onWillLeave=function(e,i,n){return SoundManager.instance.stopEffect(this.sound),t.prototype.onWillLeave.call(this,e,i,n)},e.prototype.initScene=function(){this.updateInfo(),this.vs.setSelectedIndex(this._tab,{minister:this.minister},!0),this.tabBar.selectedIndex=this._tab},e.prototype.updateInfo=function(){var t=this.minister,e=t.meta,i=[],n=0;for(var r in lang.minister_info_fields){var o=t[r];"position"==r?o=o?GameConfig.getPositionMeta(o).name:lang.nothing:"grade"==r?o=lang.minister_office_class[o]:"specialty"==r?o=lang.minister_specialty_type[t.meta.specialty_type]:"state"==r&&(o=lang.minister_state[t.state]),i.push({index:n,field:lang.minister_info_fields[r],value:o}),n++}this._dataProvider.source=i,this.labName.text=e.name,this.labName.lineSpacing=10*(4-e.name.length)+5,this.imgBody.source=t.bodyUrl,this.imgBody.x=200-e.body_offset.x,this.imgBody.y=200-e.body_offset.y;var s=(GameConfig.getExpMeta(e.quality,t.level),GameConfig.getPeerageMeta(t.peerage)),a=s?s.level+50:100,c=this.canLevelUp=t.level<a;this.labNextCondition.text=c?lang.format(lang.minister_level_up_condition,t.getNextLevelCondition()):lang.level_max,s&&6==s.id&&!c?(this.btnLevelUp.visible=!1,this.checkBox.visible=!1):(this.btnLevelUp.visible=!0,this.checkBox.visible=!0,this.btnLevelUp.skinName=c?ui.OrangeButtonSkin:ui.BlueButtonSkin,this.btnLevelUp.label=c?lang.level_up:lang.peerage)},e.prototype.getTitle=function(){return lang.minister_info},e.prototype.onTabSelect=function(t){this._tab=this.tabBar.selectedIndex,this.vs.setSelectedIndex(this._tab,{minister:this.minister})},e.prototype.onBtnShowDetailsTap=function(t){PanelMinisterDetails.instance.show({minister:this.minister})},e.prototype.onBtnLevelUpTap=function(t){var e=this;if(this.canLevelUp)var i=this.checkBox.selected?this.getCanMaxLevel():1,n=0,r=egret.setInterval(function(){n++,ministerService.upgrade(e.minister,1),n==i&&egret.clearInterval(r)},this,20);else PanelPeerage.instance.show({minister:this.minister},this.onPeerageResult)},e.prototype.getCanMaxLevel=function(){var t=GameConfig.getPeerageMeta(this.minister.peerage),e=t?t.level+50:100;return e-this.minister.level>10?10:e-this.minister.level},e.prototype.onUpdateMinisterNotify=function(t){var e=this;if(this.updateInfo(),t.data.id==this.minister.id){var i=this.minister.fieldsModified;i.forEach(function(t){var i=t.field,n=t.value,r=t.oldValue,o=n-r;if(o>0&&MinisterQualification.fields.indexOf(i)>=0){var s=e.listInfo;alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.minister_info_fields[i]+"+"+o,component:s})}})}},e.prototype.onUpgradeResponse=function(t){0==t.data.error&&(this.updateInfo(),this.playLevelUp(),SoundManager.instance.playEffect(ResNames.sound_minister_upgrade))},e.prototype.playLevelUp=function(){var t=this;this.levelUpEffect.visible=!0,this.levelUpEffect.movieClip.stop(),this.levelUpEffect.movieClip.gotoAndPlay(0,1),this.progress.slideDuration=0,this.progress.value=0,this.progress.slideDuration=200,this.progress.value=100,this.timer&&(egret.clearTimeout(this.timer),this.timer=null),this.timer=egret.setTimeout(function(){t.progress.slideDuration=0,t.progress.value=0},this,200)},e}(TopSceneBase);__reflect(SceneMinisterInfo.prototype,"SceneMinisterInfo");var IRMinisterInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.label.text=this.data.field+" : "+wsy.Utils.shortCurrency(this.data.value),this.label.textColor=this.data.index>=5?16777215:16746268},e}(eui.ItemRenderer);__reflect(IRMinisterInfo.prototype,"IRMinisterInfo");var SceneOffice=function(t){function e(){var e=t.call(this)||this;return e._tab=0,e.name=ConstantNames.SCENE_MINISTER,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneOfficeSkin},e.prototype.getResGroupNames=function(){return["office"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.vs.setup({def:OffsetPosition},{def:OfficeClass}),this.vs.setSelectedIndex(0,null,!0)},e.prototype.onWillEnter=function(e,i,n){return this._tab=0,n&&n.tab&&(this._tab=n.tab),t.prototype.onWillEnter.call(this,e,i,n)},e.prototype.getTitle=function(){return lang.office},e.prototype.getCloseButtonSkin=function(){return ui.CloseButtonSkin},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.initScene=function(){this.tabBar.selectedIndex=this._tab,this.vs.setSelectedIndex(this._tab,null,!0)},e}(TopSceneBase);__reflect(SceneOffice.prototype,"SceneOffice");var SceneGardenFlower=function(t){function e(){var e=t.call(this)||this;return e._selectPrincessId=0,e._selectFlowerId=0,e.awardIds=[600003,600096],e.name=ConstantNames.SCENE_GARDEN_FLOWER,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneGardenFlowerSkin},e.prototype.getResGroupNames=function(){return["garden_flower"]
},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRFlower,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(princessService,EventNames.REFRESH_FLOWER_DATA,this.updateUI,this),this.registerEvent(gameServer,protocols.WC_FINISH_PRINCESS_Response,this.onFinishPrincessResponse,this),this.registerEvent(alien.Dispatcher,EventNames.TAP_FLOWERPOT,this.onTapFlowerPot,this)},e.prototype.initScene=function(){this._dataProvider.source=princessService.getFlower()},e.prototype.getTitle=function(){return lang.garden_flower},e.prototype.getHelp=function(){return"princess_flower_rules"},e.prototype.updateUI=function(){this._dataProvider.source=princessService.getFlower()},e.prototype.onTapFlowerPot=function(t){if(this._flowerData=t.data.flowerData,this._selectPrincessId=t.data.flowerData.princessId,this._selectFlowerId=t.data.flowerData.flowerId,null==this._flowerData.princessId)PanelSelectPrincess.instance.show({filter:this.selectFilter.bind(this),field:"culture"},this.onSelectResult.bind(this));else if(this._flowerData.princessId&&this._flowerData.timestamp-mainService.tsServer>0){Math.ceil((this._flowerData.timestamp-mainService.tsServer)/60);PanelSpeed.instance.show({timeStamp:this._flowerData.timestamp},this.onSpeedResult.bind(this))}else this._flowerData.princessId&&this._flowerData.timestamp-mainService.tsServer<=0&&princessService.finishPrincess(2,this._flowerData.pos)},e.prototype.selectFilter=function(t){var e=!0;return princessService.flowerData.some(function(i){return i.princessId==t.id?(e=!1,!0):void 0}),GameConfig.getFlowerMeta(this._flowerData.flowerId).need_charm>t.charm&&(e=!1),t.state>0&&(e=!1),e},e.prototype.onSelectResult=function(t,e){"select"==t&&princessService.plantFlower(e.princess.id,this._flowerData.flowerId,this._flowerData.pos)},e.prototype.onSpeedResult=function(t,e){if("confirm"==t)if(0==e.type)activityTimeService.advanceTime(this._flowerData.id);else{var i=e.item;if(!i)return;activityTimeService.itemUseAcCard(i.id,i.count,this._flowerData.id)}},e.prototype.onFinishPrincessResponse=function(t){if(!(t.data.error>0)&&2==t.data.type){var e=0;princessService.getById(this._selectPrincessId).skills.forEach(function(t){if(50043==t.id||50044==t.id||50045==t.id){var i=GameConfig.getSkillLevelMeta(t.id,t.level).buffers;i.forEach(function(t){var i=GameConfig.getBufferMeta(t);i&&(e+=i.value)})}});var i=Math.floor(GameConfig.getFlowerMeta(this._selectFlowerId).cost_time*(1+.01*e)),n=0,r=packService.getAddItem(this._selectFlowerId);r.count>=5&&(i=Math.floor(1.5*i),n=3);var o=[];o.push(r),this.awardIds.forEach(function(t){var e=packService.getAddItem(t);e.count>0&&o.push(e)}),PanelWorkFinish.instance.show({type:n,reward:o,princessEffect:[{princessId:this._selectPrincessId,field:"culture",count:i}]},null)}},e}(TopSceneBase);__reflect(SceneGardenFlower.prototype,"SceneGardenFlower");var Flowerpot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initData=function(t){return 0==t.flowerId?(this.currentState="empty",void this.doTween()):(this.stopTween(),this.currentState="normal",void(this.imgFlower.source="item_"+GameConfig.getItemMeta(t.flowerId).icon))},e.prototype.doTween=function(){this.stopTween();var t=55,e=48,i=55,n=48;egret.Tween.get(this.imgWord1,{loop:!0}).to({y:t-5},1e3).to({y:t},1e3),egret.Tween.get(this.imgWord2,{loop:!0}).to({y:e+5},1e3).to({y:e},1e3),egret.Tween.get(this.imgWord3,{loop:!0}).to({y:i-5},1e3).to({y:i},1e3),egret.Tween.get(this.imgWord4,{loop:!0}).to({y:n+5},1e3).to({y:n},1e3)},e.prototype.stopTween=function(){this.imgWord1.y=this.imgWord3.y=55,this.imgWord2.y=this.imgWord4.y=48,egret.Tween.removeTweens(this.imgWord1),egret.Tween.removeTweens(this.imgWord2),egret.Tween.removeTweens(this.imgWord3),egret.Tween.removeTweens(this.imgWord4)},e}(alien.VisualEventComponent);__reflect(Flowerpot.prototype,"Flowerpot");var FlowerItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cdId=0,e._flowerData=null,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.registerEvent(this.button,egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this),this.registerEvent(this,egret.Event.REMOVED_FROM_STAGE,this.onRemovedToStage,this)},e.prototype.initData=function(t){if(this._flowerData=t,0==t.flowerId)return void(this.currentState="empty");this.currentState="normal";var e=GameConfig.getItemMeta(t.flowerId);countDownService.unregister(this.cdId),null==t.princessId?(this.button.skinName="ui.GreenButtonSkin",this.button.label=lang.princess_work_btn_fields.send,this.labName.text=e.name,this.labPrincess.text=lang.wait_select,this.labTime.text=GameConfig.getFlowerMeta(t.flowerId).cost_time+lang.minutes):t.princessId&&t.timestamp-mainService.tsServer>0?(this.button.skinName="ui.OrangeButtonSkin",this.button.label=lang.princess_work_btn_fields.speed,this.labName.text=e.name,this.labPrincess.text=princessService.getById(t.princessId).meta.name,this.cdId=countDownService.register(t.timestamp,this.onSecond.bind(this))):t.princessId&&t.timestamp-mainService.tsServer<=0&&(this.button.skinName="ui.BlueButtonSkin",this.button.label=lang.princess_work_btn_fields.finish,this.labName.text=e.name,this.labPrincess.text=princessService.getById(t.princessId).meta.name,this.labTime.text="00:00:00")},e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e.prototype.onButtonClick=function(t){alien.Dispatcher.dispatch(EventNames.TAP_FLOWERPOT,{flowerData:this._flowerData})},e.prototype.onSecond=function(t){return 0>=t?(this.initData(this._flowerData),void(this.cdId=0)):void(this.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e}(alien.VisualEventComponent);__reflect(FlowerItem.prototype,"FlowerItem");var IRFlower=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.btnBuy,egret.TouchEvent.TOUCH_TAP,this.onBtnBuyClick,this),this.registerEvent(this.flowerpot,egret.TouchEvent.TOUCH_TAP,this.onSelectFlower,this)},e.prototype.dataChanged=function(){return t.prototype.dataChanged.call(this),this.data?(this.currentState="normal",void("normal"==this.currentState&&(this.flowerpot.initData(this.data),this.flowerItem.initData(this.data)))):void(this.currentState="empty")},e.prototype.onBtnBuyClick=function(t){var e=100*mainService.playerInfo.plantMax;PanelUseThingAlert.instance.show({content:lang.flower_alert_content,id:1,count:e},this.onBuyResult)},e.prototype.onBuyResult=function(t){"confirm"==t&&princessService.addMaxSlot(1)},e.prototype.onSelectFlower=function(t){this.data.princessId||PanelSelectFlower.instance.show(this.selectFlowerResult.bind(this))},e.prototype.selectFlowerResult=function(t,e){"select"==t&&(princessService.selectFlower({id:this.data.id,flowerId:e.flower.id}),this.data.flowerId=e.flower.id,this.flowerpot.initData(this.data),this.flowerItem.initData(this.data))},e}(alien.VisualEventItemRenderer);__reflect(IRFlower.prototype,"IRFlower");var SceneGardenHouse=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.SCENE_GARDEN_HOUSE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.SceneGardenHouseSkin},e.prototype.getResGroupNames=function(){return["garden_house"]},e.prototype.showFrame=function(){return!1},e.prototype.getTitle=function(){return lang.garden_house},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bottomBar.itemRenderer=IRGardenBottomButton,this.registerEvent(this.bottomBar,egret.Event.CHANGING,this.onBottomBarTap,this)},e.prototype.initScene=function(){},e.prototype.onBottomBarTap=function(t){switch(t.preventDefault(),this.bottomBar.selectedItem.field){case"flower":this["goto"](ConstantNames.SCENE_GARDEN_FLOWER);break;case"horse":break;case"medicine":}},e}(TopSceneBase);__reflect(SceneGardenHouse.prototype,"SceneGardenHouse");var IRGardenBottomButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="garden_house_icon_"+this.data.field,this.iconDisplay.horizontalCenter=this.data.offsetX||0,this.iconDisplay.verticalCenter=this.data.offsetY||0,this.labelDisplay.source="garden_house_label_"+this.data.field,this.badgeView.bid=this.data.badgeId},e}(eui.ItemRenderer);__reflect(IRGardenBottomButton.prototype,"IRGardenBottomButton");var ScenePrincess=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.SCENE_PRINCESS,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessSkin},e.prototype.getResGroupNames=function(){return["princess"]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this.tabBar,egret.Event.CHANGE,this.onTabSelect,this),this.vs.setup({def:PrincessList},{def:PrincessHire}),this.vs.setSelectedIndex(0,null,!0)},e.prototype.getTitle=function(){return lang.princess},e.prototype.onTabSelect=function(t){this.vs.selectedIndex=this.tabBar.selectedIndex},e.prototype.initScene=function(){this.vs.setSelectedIndex(0,null,!0),this.tabBar.selectedIndex=0},e}(TopSceneBase);__reflect(ScenePrincess.prototype,"ScenePrincess");var ScenePrincessHouse=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.SCENE_PRINCESS_HOUSE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessHouseSkin},e.prototype.getResGroupNames=function(){return["princess_house","princess_choose"]},e.prototype.getTitle=function(){return lang.princess_house},e.prototype.showFrame=function(){return!1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bottomBar.itemRenderer=IRPrincessBottomButton,this.registerEvent(this.bottomBar,egret.Event.CHANGING,this.onBottomBarTap,this)},e.prototype.onWillLeave=function(e,i,n){return SoundManager.instance.stopEffect(ResNames.effect_enter_scene)["catch"](function(){}),t.prototype.onWillLeave.call(this,e,i,n)},e.prototype.initScene=function(){var t=alien.MathUtils.getRandomFromArray(princessService.princesses),e=this.aniBody;e.id=t.meta.icon},e.prototype.onBottomBarTap=function(t){switch(t.preventDefault(),this.bottomBar.selectedItem.field){case"turn":openService.getOpenStatus({name:"turn_card"})&&PanelPrincessTurnCard.instance.show();break;case"princess":this["goto"](ConstantNames.SCENE_PRINCESS);break;case"position":this["goto"](ConstantNames.SCENE_PRINCESS_POSITION)}},e}(TopSceneBase);__reflect(ScenePrincessHouse.prototype,"ScenePrincessHouse");var IRPrincessBottomButton=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.iconDisplay.source="princess_house_icon_"+this.data.field,this.iconDisplay.horizontalCenter=this.data.offsetX||0,this.iconDisplay.verticalCenter=this.data.offsetY||0,this.labelDisplay.source="princess_house_label_"+this.data.field,this.badgeView.bid=this.data.badgeId},e}(eui.ItemRenderer);__reflect(IRPrincessBottomButton.prototype,"IRPrincessBottomButton");var ScenePrincessInfo=function(t){function e(){var e=t.call(this)||this;return e.luckFlag=!1,e.onPanelLuckResult=function(t){if("confirm"==t){if(packService.getCountByMetaId(1)<e.princess.luckCondition)return void Toast.show({text:lang.response_error[38]});e.luckFlag=!0,PanelPrincessImage.instance.show({princess:e.princess,type:1})}},e.name=ConstantNames.SCENE_PRINCESS_INFO,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessInfoSkin},e.prototype.getHelp=function(){return"princess_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBg.mask=this.bgMask,this.aniBody.mask=this.bodyMask,this.listProps.itemRenderer=IRPrincessProps,this.listProps.dataProvider=this._dataProvider=new eui.ArrayCollection(e.fields),this.registerEvent(this.grpButtons,egret.TouchEvent.TOUCH_TAP,this.onGrpButtonsTap,this),this.registerEvent(gameServer,protocols.WC_SUPPORT_PRINCESS_Response,this.onLuckResponse,this),this.registerEvent(gameServer,protocols.WC_UPDATE_PRINCESS_NOTIFY,this.onUpdatePrincessNotify,this),this.registerEvent(alien.Dispatcher,EventNames.GIVE_ITEM,this.onGiveItem,this),this.registerEvent(gameServer,protocols.WC_AWARD_PRINCESS_Response,this.onGiveItemResponse,this)},e.prototype.onWillEnter=function(i,n,r){return r&&r.princess&&(this.princess=e.princess=r.princess,SoundManager.instance.playEffect(this.princess.soundUrl)),t.prototype.onWillEnter.call(this,i,n,r)},e.prototype.onWillLeave=function(e,i,n){return SoundManager.instance.stopEffect(this.princess.soundUrl),t.prototype.onWillLeave.call(this,e,i,n)},e.prototype.initScene=function(){this.updateInfo()},e.prototype.updateInfo=function(){var t=this.princess,e=t.meta;this.labName.text=e.name;var i=this.aniBody;i.id=e.icon,(this.imgPosition.visible=t.position>0)&&(this.imgPosition.source="princess_position_"+t.position),this._dataProvider.refresh()},e.prototype.getTitle=function(){return lang.princess_info},e.prototype.playThank=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._soundPlaying?[3,2]:(this._soundPlaying=!0,[4,SoundManager.instance.playEffect(ResNames.effect_princess_thanks)]);case 1:t.sent(),this._soundPlaying=!1,t.label=2;case 2:return[2]}})})},e.prototype.onGrpButtonsTap=function(t){switch(t.target.name){case"charm":PanelUseThingAlert.instance.show({content:lang.luck_alert_content,id:1,count:this.princess.luckCondition},this.onPanelLuckResult);break;case"give":PanelGiveNormalItem.instance.show({types:[0,1],target:this.princess,items:PrincessEntity.treasures});break;case"gift":PanelPrincessSkill.instance.show({princess:this.princess})}},e.prototype.onLuckResponse=function(t){this.luckFlag=!1,0==t.data.error&&this._dataProvider.refresh()},e.prototype.onUpdatePrincessNotify=function(t){var i=this;if(!this.luckFlag&&t.data.id==this.princess.id){var n=this.princess.fieldsModified;n.forEach(function(t){var n=t.field,r=t.value,o=t.oldValue;if(e.fields.indexOf(n)>=0){var s=i.listProps;alien.Dispatcher.dispatch(EventNames.SHOW_FLOAT_NOTIFICATION,{text:lang.princess_info_fields[n]+"+"+(r-o),component:s})}})}},e.prototype.onGiveItem=function(t){var e=t.data.treasure,i=e.index,n=e.target,r=e.type,o=PrincessEntity.treasures[i][r];princessService.giveItem(n,o)},e.prototype.onGiveItemResponse=function(t){0==t.data.error&&(this._dataProvider.refresh(),PanelGiveNormalItem.instance.updateUI(),SoundManager.instance.stopEffect(this.princess.soundUrl),this.playThank())},e.prototype.onAddPrince=function(t){t.data.prince&&PanelPrinceBorn.instance.show({prince:t.data.prince})},e.fields=["luck","charm","rite","culture","battle","state"],e}(TopSceneBase);__reflect(ScenePrincessInfo.prototype,"ScenePrincessInfo");var IRPrincessProps=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.labName.text=lang.princess_info_fields[e]+" : ","state"==e?this.labValue.text=ScenePrincessInfo.princess.stateContent:this.labValue.text=ScenePrincessInfo.princess[e].toString()},e}(eui.ItemRenderer);__reflect(IRPrincessProps.prototype,"IRPrincessProps");var Panel=eui.Panel,ScenePrincessParty=function(t){function e(){var e=t.call(this)||this;return e._states=["hold","waiting","start","finish"],e._cdId=0,e._type=0,e.onSecond=function(t){return 0>=t?(e.update(),void(e._cdId=0)):void(e.labTime.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e.name=ConstantNames.SCENE_PRINCESS_PARTY,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessPartySkin},e.prototype.getResGroupNames=function(){return["princess_party"]},e.prototype.getHelp=function(){return"party_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBg.mask=this.bgMask,this.registerEvent(this.grpBtn,egret.TouchEvent.TOUCH_TAP,this.onGrpBtnTap,this),this.registerEvent(this.btnFinish,egret.TouchEvent.TOUCH_TAP,this.onBtnFinishTap,this),this.registerEvent(this.btnLeave,egret.TouchEvent.TOUCH_TAP,this.onBtnLeaveTap,this),this.registerEvent(this.grpPrincess,egret.TouchEvent.TOUCH_TAP,this.onGrpPrincessTap,this),this.registerEvent(princessService,EventNames.PARTY_START,this.onPartyStart,this),this.registerEvent(princessService,EventNames.PARTY_TURN_START,this.onPartyTurnStart,this),this.registerEvent(this.btnInvite,egret.TouchEvent.TOUCH_TAP,this.onBtnInviteTap,this),this.registerEvent(chatService,EventNames.UPDATE_CHAT,this.onUpdateChat,this),this.registerEvent(this.btnGift,egret.TouchEvent.TOUCH_TAP,this.onBtnGiftTap,this),this.registerEvent(gameServer,protocols.WC_JOIN_DINNER_RESPONSE,this.onJoinDinnerResponse,this)},e.prototype.getTitle=function(){return lang.princess_party},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.initScene=function(){this.update(),"mini"!=this.princessPartyInfo.currentState&&this.princessPartyInfo.switchState(),princessService.partyData.id>0&&princessService.reqPartyInfo()},e.prototype.update=function(){var t=this,e=princessService.partyData;e.id>0?(this.currentState=this._states[princessService.partyData.state+1],PanelPrincessPartyDispatch.instance.close()):this.initPartyInfo(),e.players.length>0&&(this.btnInvite.visible=e.players[0].id==dataCenterService.pid),this.labPartyId.text=princessService.partyData.id+"",this.labTheme.text=lang.party_theme[3]+(e.type>=0?lang.party_theme[e.type]:"");var i=activityTimeService.getById(382);this.labFreeCount.visible=!i;var n=GameConfig.getItemMeta(600101),r=packService.getCountByMetaId(n.id);this.labInvitationCard.visible=!!i&&r>0,this.grpNormalGold.visible=!!i&&0>=r;var o=e.startTime-mainService.tsServer+7200;o>=0&&(this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0),this._cdId=countDownService.register(e.startTime+7200,this.onSecond.bind(this))),alien.EgretUtils.callLater(function(){alien.Utils.enumChildren(t.grpPrincess,function(t,e){t.setData(e)})},10)},e.prototype.initPartyInfo=function(){this.currentState=this._states[0];var t=GameConfig.getItemMeta(600102),e=packService.getCountByMetaId(t.id);e>0?(this.grpGold.visible=!1,this.grpCard.visible=!0,this.labCard.text=t.name+":"+e):(this.grpGold.visible=!0,this.grpCard.visible=!1)},e.prototype.onGrpBtnTap=function(t){switch(t.target.name){case"hold":PanelSelectPrincess.instance.show({filter:this.selectFilter.bind(this),field:"all_round_ability"},this.onSelectResult.bind(this)),this._type=0;break;case"join":PanelSelectPrincess.instance.show({filter:this.selectFilter.bind(this),field:"all_round_ability"},this.onSelectResult.bind(this)),this._type=1;break;case"exchange":PanelCashGiftShop.instance.show()}},e.prototype.onBtnFinishTap=function(t){var e=this,i=princessService.getPartyRewards();PanelWorkFinish.instance.show({type:0,reward:i,princessEffect:null,partySeqInfo:princessService.getSeqList()},function(){princessService.partyData=new partyEntity,e.update(),e.princessPartyInfo.update()})},e.prototype.onBtnLeaveTap=function(t){princessService.isInPartyList()||(princessService.partyData=new partyEntity,this.update(),this.princessPartyInfo.update())},e.prototype.onBtnInviteTap=function(t){},e.prototype.invite=function(){var t=ChatMessageList.chatTapMap[0],e="<headIcon>"+mainService.playerInfo.chat_icon+"</headIcon>",i='<partyBtn>{"party": {"id":10000 }}</partyBtn>';chatService.sendMessage(lang.party_invite+e+i,t)},e.prototype.onGrpPrincessTap=function(t){var e=this,i=t.target;if(!i.playerId&&!princessService.isInPartyList()){var n=activityTimeService.getById(382),r=GameConfig.getItemMeta(600101),o=packService.getCountByMetaId(r.id);n&&o>0?Alert.show(lang.formatHtml(lang.party_join_tip[1],r.name),1,function(t){"confirm"==t.name&&e.joinParty()}):n?Alert.show(lang.formatHtml(lang.party_join_tip[0],100),1,function(t){"confirm"==t.name&&e.joinParty()}):this.joinParty()}},e.prototype.joinParty=function(){PanelSelectPrincess.instance.show({filter:this.selectFilter.bind(this),field:"all_round_ability"},function(t,e){"select"==t&&princessService.joinParty(princessService.partyData.id,e.princess.id)})},e.prototype.onPartyStart=function(t){this.partyStartEffectLayer.play()},e.prototype.onPartyTurnStart=function(t){this.update()},e.prototype.onJoinDinnerResponse=function(t){0==t.data.error&&(PanelPrincessPartyDispatch.instance.show(),this.invite())},e.prototype.selectFilter=function(t){var e=!princessService.isJoinedParty(t.meta.id);return t.state>0&&(e=!1),e},e.prototype.onSelectResult=function(t,e){"select"==t&&princessService.joinParty(this._type,e.princess.id)},e.prototype.onUpdateChat=function(t){if(!(t.data.error>0)){var e=t.data,i=e.type,n=e.message;i==MessageEntity.ChatType.TYPE_WORLD&&n.partyId==princessService.partyData.id&&Toast.show({text:lang.party_invite_notice})}},e.prototype.onBtnGiftTap=function(t){PanelCashGiftShop.instance.show()},e.prototype.onRemovedToStage=function(t){this._cdId>0&&(countDownService.unregister(this._cdId),this._cdId=0)},e=__decorate([modifyChild,modifyChildren],e)}(TopSceneBase);__reflect(ScenePrincessParty.prototype,"ScenePrincessParty");var ScenePrincessPosition=function(t){function e(){var e=t.call(this)||this;return e.name=ConstantNames.SCENE_PRINCESS_POSITION,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessPositionSkin},e.prototype.getResGroupNames=function(){return["princess_position"]},e.prototype.getTitle=function(){return lang.princess_position},e.prototype.getHelp=function(){return"princess_position_rules"},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),alien.Utils.enumChildren(this.grp,function(t,e){t.index=e}),this.registerEvent(gameServer,protocols.WC_BESTOWED_PRINCESS_Response,this.onPrincessManageResponse,this)},e.prototype.onPrincessManageResponse=function(t){0==t.data.error&&alien.Utils.enumChildren(this.grp,function(t,e){t.update()})},e.prototype.active=function(){var e=this;t.prototype.active.call(this);var i=princessService.getTopGroup(),n=null;alien.Utils.enumChildren(this.grp,function(t,e){t.update(),i==e&&(n=t)}),alien.EgretUtils.callLater(function(){e.scroller.stopAnimation();var t=e.scroller.viewport;egret.Tween.get(t).to({scrollV:Math.min(t.contentHeight-t.height,n.y)},200,egret.Ease.cubicOut)},2)},e}(TopSceneBase);__reflect(ScenePrincessPosition.prototype,"ScenePrincessPosition");var ScenePrincessRite=function(t){function e(){var e=t.call(this)||this;return e.awardIds=[600002,600096],e.filter=function(t){var i=!1;return e._dataProvider.source.some(function(e){return e&&e.princess&&e.princess.id==t.id?(i=!0,!0):void 0}),t.state>0&&(i=!0),!i},e.onSelectPrincess=function(t,i){"select"==t&&princessService.learnRite(princessService.riteTeacher,i.princess,e._selectedSiteId)},e.onSelectTeacher=function(t,i){"select"==t&&(princessService.riteTeacher=i.minister,e.updateTeacher())},e.onAddSiteResult=function(t){"confirm"==t&&princessService.addMaxSlot(0)},e.onSpeedUpResult=function(t,e){if("confirm"==t){var i=e.data;if(0==e.type)activityTimeService.advanceTime(i.activityTime.id);else{var n=e.item;if(!n)return;activityTimeService.itemUseAcCard(n.id,n.count,i.activityTime.id)}}},e.name=ConstantNames.SCENE_PRINCESS_RITE,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessRiteSkin},e.prototype.getHelp=function(){return"princess_rite_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.imgBg.mask=this.bgMask,this.list.itemRenderer=IRWithItemView,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection,this.registerEvent(this.list,egret.Event.CHANGING,this.onTapSite,this),this.registerEvent(this.teacherAvatar,egret.TouchEvent.TOUCH_TAP,this.onGrpTeacherTap,this),this.registerEvent(princessService,EventNames.REFRESH_LEARN_RITE_QUEUE,this.onRefreshLearnRiteQueue,this),this.registerEvent(princessService,EventNames.REFRESH_LEARN_RITE_TEACHER,this.onRefreshLearnRiteTeacher,this),this.registerEvent(gameServer,protocols.WC_ADVANCETIME_Response,this.onAdvanceTimeResponse,this),this.registerEvent(gameServer,protocols.WC_FINISH_PRINCESS_Response,this.onFinishPrincessResponse,this)},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.initScene=function(){var t=this;egret.callLater(function(){t.updateInfo()},this)},e.prototype.updateInfo=function(){this.updateTeacher(),this._dataProvider.source=princessService.getRiteQueue()},e.prototype.getTitle=function(){return lang.princess_rite},e.prototype.onGrpTeacherTap=function(t){princessService.canSwitchTeacher?PanelDispatchForRite.instance.show({},this.onSelectTeacher):Alert.show(lang.can_not_switch_teacher)},e.prototype.onTapSite=function(t){var e=this;t.preventDefault();var i=this.list.selectedItem;if(this._selectedSiteId=this.list.selectedIndex,i)if(i.princess){var n=activityTimeService.getById(i.activityTime.id);if(n["int"]-mainService.tsServer<=0)this._selectedPrincess=i.princess,princessService.finishPrincess(1,i.activityTime.id-41);else{var r=Math.ceil((n["int"]-mainService.tsServer)/60);PanelSpeed.instance.show({timeStamp:n["int"],data:i},this.onSpeedUpResult.bind(this))}}else princessService.riteTeacher?PanelSelectPrincess.instance.show({field:"rite",filter:this.filter},this.onSelectPrincess):Alert.show(lang.please_select_teacher,0,function(){PanelDispatchForRite.instance.show({},e.onSelectTeacher)});else{var r=100*mainService.playerInfo.learnRiteMax;PanelUseThingAlert.instance.show({content:lang.rite_alert_content,id:1,count:r},this.onAddSiteResult)}},e.prototype.updateTeacher=function(){this.teacherAvatar.update()},e.prototype.onRefreshLearnRiteQueue=function(t){void 0===t&&(t=null),this._dataProvider.source=princessService.getRiteQueue()},e.prototype.onRefreshLearnRiteTeacher=function(t){void 0===t&&(t=null),this.updateTeacher()},e.prototype.onAdvanceTimeResponse=function(t){this.onRefreshLearnRiteQueue()},e.prototype.onFinishPrincessResponse=function(t){var e=t.data,i=e.type,n=e.preValue,r=e.aftValue;if(1==i){var o=[];this.awardIds.forEach(function(t){var e=packService.getAddItem(t);e.count>0&&o.push(e)}),PanelWorkFinish.instance.show({type:0,reward:o,princessEffect:[{princessId:this._selectedPrincess.id,field:"rite",count:r-n}]},null)}},e}(TopSceneBase);__reflect(ScenePrincessRite.prototype,"ScenePrincessRite");var PrincessRiteItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onSecond=function(t){t>0?e.labStatus.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"):e.labStatus.text=lang.complete,e.labStatus.textColor=t>0?16746268:7658272},e}return __extends(e,t),e.prototype.onRemovedFromStage=function(e){t.prototype.onRemovedFromStage.call(this,e),this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e.prototype.setData=function(t){if(countDownService.unregister(this.cdId),t)if(t.princess){this.currentState="in_use";var e=t.princess.meta;this.avatar.metaId=e.id,this.labName.text=e.name,this.cdId=countDownService.register(t.activityTime.timestamp,this.onSecond)}else this.currentState="available",this.avatar.metaId=null;else this.currentState="closed",this.avatar.metaId=null},e}(alien.VisualEventComponent);__reflect(PrincessRiteItem.prototype,"PrincessRiteItem");var ScenePrincessWork=function(t){function e(){var e=t.call(this)||this;return e._selectPrincessId=0,e.awardIds=[600004,600096],e.onPanelSpeedResult=function(t,i){if("confirm"==t)if(0==i.type)activityTimeService.advanceTime(e._selectData.id);else{var n=i.item;if(!n)return;activityTimeService.itemUseAcCard(n.id,n.count,e._selectData.id)}},e.onSendResult=function(t,i){"select"==t&&princessService.dispatchPrincess(i.princess.id,e._selectData.type)},e.name=ConstantNames.SCENE_PRINCESS_WORK,e}return __extends(e,t),e.prototype.getSkinName=function(){return scenes.ScenePrincessWorkSkin},e.prototype.getResGroupNames=function(){return["princess_work"]},e.prototype.getHelp=function(){return"princess_work_rules"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=IRPriWork,this.list.dataProvider=this._dataProvider=new eui.ArrayCollection(princessService.workData),this.registerEvent(this.list,egret.Event.CHANGING,this.onSelectItem,this),this.registerEvent(princessService,EventNames.REFRESH_WORK_DATA,this.updateWorkData,this),this.registerEvent(gameServer,protocols.WC_FINISH_PRINCESS_Response,this.onFinishPrincessResponse,this)},e.prototype.updateWorkData=function(){this._dataProvider.source=princessService.workData},e.prototype.getTitle=function(){return lang.princess_work},e.prototype.getCloseButtonSkin=function(){return ui.BackButtonSkin},e.prototype.initScene=function(){this._dataProvider.source=princessService.workData},e.prototype.onSelectItem=function(t){if(t.preventDefault(),this._selectData=this.list.selectedItem,this._selectPrincessId=this._selectData.princessId,this._selectData.princessId&&this._selectData.timestamp-mainService.tsServer>0){Math.ceil((this._selectData.timestamp-mainService.tsServer)/60);PanelSpeed.instance.show({timeStamp:this._selectData.timestamp},this.onPanelSpeedResult.bind(this))}else null==this._selectData.princessId?PanelSelectPrincess.instance.show({filter:this.selectFilter.bind(this),field:"battle"},this.onSendResult):this._selectData.princessId&&this._selectData.timestamp-mainService.tsServer<=0&&princessService.finishPrincess(0,this._selectData.type)},e.prototype.selectFilter=function(t){var e=!0;return princessService.workData.some(function(i){return i.princessId==t.id?(e=!1,!0):void 0}),this._selectData.charm>t.charm&&(e=!1),t.state>0&&(e=!1),e},e.prototype.onFinishPrincessResponse=function(t){if(!(t.data.error>0)&&0==t.data.type){var e=[];this.awardIds.forEach(function(t){var i=packService.getAddItem(t);i.count>0&&e.push(i)}),PanelWorkFinish.instance.show({type:0,reward:e,princessEffect:[{princessId:this._selectPrincessId,field:"battle",count:t.data.aftValue-t.data.preValue}]},null)}},e}(TopSceneBase);__reflect(ScenePrincessWork.prototype,"ScenePrincessWork");var IRPriWork=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cdId=0,e.onSecond=function(t){return 0>=t?(e.dataChanged(),void(e.cdId=0)):void(e.labState.text=alien.TimeUtils.timeFormat(t,"{2}:{1}:{0}"))},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.registerEvent(this,egret.Event.REMOVED_FROM_STAGE,this.onRemovedToStage,this)},e.prototype.onRemovedToStage=function(t){this.cdId>0&&(countDownService.unregister(this.cdId),this.cdId=0)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;if(this.imgBg.source="princess_work_"+(e.type+1)+"_bg",countDownService.unregister(this.cdId),e.princessId){var i=princessService.getById(e.princessId);this.grpName.visible=!0,this.labName.text=i.meta.name,this.grpCharm.visible=!1}else this.grpName.visible=!1,this.grpCharm.visible=!0,this.labCharm.text=e.charm.toString();e.princessId&&e.timestamp-mainService.tsServer>0?(this.button.label=lang.princess_work_btn_fields.speed,this.button.currentState="orange",this.cdId=countDownService.register(e.timestamp,this.onSecond.bind(this))):e.princessId&&e.timestamp-mainService.tsServer<=0?(this.button.label=lang.princess_work_btn_fields.finish,this.button.currentState="green_light",this.labState.text="00:00:00"):e.princessId||(this.button.label=lang.princess_work_btn_fields.send,this.button.currentState="blue",this.labState.text=lang.princess_work_state_fields.waiting+":"+e.needTime+lang.minutes)},e}(alien.VisualEventItemRenderer);__reflect(IRPriWork.prototype,"IRPriWork");