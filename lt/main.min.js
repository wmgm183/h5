var cdnurl='https://cdn.jsdelivr.net/gh/wmgm183/h5@master/lt/';function post(t,e,i){var s=i.value,n=t.constructor.name+MessageCenter.splite+e,o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=s.call.apply(s,[this].concat(t));return("boolean"!=typeof i||i)&&MessageCenter.ins().dispatch(n,i),i};return o.funcallname=n,i.value=o,i}function callLater(t,e,i){var s=i.value,n="$"+e+"CL",o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];delete this[n],s.call.apply(s,[this].concat(t))},a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this[n]||(egret.callLater.apply(egret,[o,this].concat(t)),this[n]=!0)};return i.value=a,i}function callDelay(t){var e=function(e,i,s){var n=s.value,o="$isDelay"+i,a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this[o]=!1,n.call.apply(n,[this].concat(t))},r=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this[o]||(this[o]=!0,egret.setTimeout.apply(egret,[a,this,t].concat(e)))};return s.value=r,s};return e}function shareCallback(){UserTips.ins().showTips("分享成功"),PfActivity.ins().sendWeiXinInviteGift(),ViewManager.ins().close(YqWin)}function isFocusCallback(t){PfActivity.ins().postGuanZhu(+t)}function isShareCallback(t){PfActivity.ins().postShare(+t)}function gm(t){var e=GameLogic.ins().getBytes(0);e.writeString(t),GameLogic.ins().sendToServer(e)}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__decorate=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=3>o?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(3>o?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},BaseClass=function(){function t(){}return t.ins=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this;if(!i._instance){var s=t.length;0==s?i._instance=new i:1==s?i._instance=new i(t[0]):2==s?i._instance=new i(t[0],t[1]):3==s?i._instance=new i(t[0],t[1],t[2]):4==s?i._instance=new i(t[0],t[1],t[2],t[3]):5==s&&(i._instance=new i(t[0],t[1],t[2],t[3],t[4]))}return i._instance},t}();__reflect(BaseClass.prototype,"BaseClass");var BaseItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.ItemRenderer);__reflect(BaseItemRender.prototype,"BaseItemRender");var BaseView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.observe=function(t,e,i){void 0===i&&(i=void 0),MessageCenter.addListener(t,e,this,i)},e.prototype.removeObserve=function(){MessageCenter.ins().removeAll(this)},e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.addTouchEndEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_END,t,e)},e.prototype.addChangeEvent=function(t,e){var i=this;t&&t instanceof eui.TabBar?this.addEvent(egret.TouchEvent.CHANGE,t,function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];SoundUtil.ins().playEffect(SoundUtil.WINDOW),e.call.apply(e,[i].concat(t))}):this.addEvent(egret.TouchEvent.CHANGE,t,e)},e.prototype.addChangingEvent=function(t,e){this.addEvent(egret.TouchEvent.CHANGING,t,e)},e.prototype.addEvent=function(t,e,i){return e?void e.addEventListener(t,i,this):void console.error("不存在绑定对象")},e.prototype.removeTouchEvent=function(t,e){t&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this)},e.prototype.$onClose=function(){var t=function(i){for(var s=0;s<i.numChildren;s++){var n=i.getChildAt(s);n instanceof e?n.$onClose():n instanceof egret.DisplayObjectContainer&&t(n)}};t(this),this.removeObserve()},e}(eui.Component);__reflect(BaseView.prototype,"BaseView");var MessageCenter=function(t){function e(e){var i=t.call(this)||this;return i.flag=0,i.type=e,i.dict={},i.eVec=[],0==i.type&&egret.startTick(i.run,i),i}return __extends(e,t),e.ins=function(){return t.ins.call(this,0)},e.prototype.clear=function(){this.dict={},this.eVec.splice(0)},e.prototype.addListener=function(t,e,i){var s=this.dict[t];s?0!=this.flag&&(this.dict[t]=s=s.concat()):this.dict[t]=s=[];for(var n=0,o=s;n<o.length;n++){var a=o[n];if(a[0]==e&&a[1]==i)return}s.push([e,i])},e.prototype.removeListener=function(t,e,i){var s=this.dict[t];if(s){0!=this.flag&&(this.dict[t]=s=s.concat());for(var n=s.length,o=0;n>o;o++)if(s[o][0]==e&&s[o][1]==i){s.splice(o,1);break}0==s.length&&(this.dict[t]=null,delete this.dict[t])}},e.prototype.removeAll=function(t){for(var e=Object.keys(this.dict),i=0,s=e;i<s.length;i++){var n=s[i],o=this.dict[n];0!=this.flag&&(this.dict[n]=o=o.concat());for(var a=o.length,r=a-1;r>=0;r--)o[r][1]==t&&o.splice(r,1);0==o.length&&(this.dict[n]=null,delete this.dict[n])}},e.prototype.dispatch=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=ObjectPool.pop("MessageVo");s.type=t,s.param=e,0==this.type?this.eVec.push(s):1==this.type?this.dealMsg(s):Log.trace("MessageCenter未实现的类型")},e.prototype.run=function(t){for(var e=egret.getTimer();this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););return!1},e.prototype.dealMsg=function(t){var e=this.dict[t.type];if(e){var i=e.length;if(0!=i){this.flag++;for(var s=0,n=e;s<n.length;s++){var o=n[s];o[0].apply(o[1],t.param)}this.flag--,t.dispose(),ObjectPool.push(t)}}},e.setFunction=function(t,i,s,n){if(0==s.indexOf(n)&&"function"==typeof i[s]){var o=egret.getQualifiedClassName(i)+e.splite+s+e.msgIndex;e.msgIndex+=1;var a=i[s],r=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var n;i.length;return n=t?a.call.apply(a,[this].concat(i)):a.apply(void 0,i),("boolean"!=typeof n||n)&&e.ins().dispatch(o,n),n};return r.funcallname=o,i[s]=r,!0}return!1},e.compile=function(t,i){void 0===i&&(i="post");var s=t.prototype;for(var n in s)e.setFunction(!0,s,n,i)},e.addListener=function(t,i,s,n){return void 0===n&&(n=void 0),t.funcallname?(e.ins().addListener(t.funcallname,i,s),n&&t.call(n),!0):(debug.log("MessageCenter.addListener error:"+egret.getQualifiedClassName(s)),!1)},e}(BaseClass);MessageCenter.splite=".",MessageCenter.msgIndex=1,__reflect(MessageCenter.prototype,"MessageCenter");var MessageVo=function(){function t(){}return t.prototype.dispose=function(){this.type=null,this.param=null},t}();__reflect(MessageVo.prototype,"MessageVo");var CharEnum;!function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(CharEnum||(CharEnum={}));var CharMcOrder;!function(t){t[t.BODY=1]="BODY",t[t.WEAPON=2]="WEAPON",t[t.WING=3]="WING",t[t.FOUR=4]="FOUR",t[t.MEDAL=5]="MEDAL",t[t.HEIR=6]="HEIR",t[t.SOUL=7]="SOUL",t[t.ZHANLING=8]="ZHANLING"}(CharMcOrder||(CharMcOrder={}));var EffectModel=function(){function t(){this.dir=4,this.team=Team.NotAtk}return t}();__reflect(EffectModel.prototype,"EffectModel");var EntityAction=function(){function t(){}return t}();EntityAction.ATTACK="a",EntityAction.CAST="c",EntityAction.STAND="s",EntityAction.RUN="r",EntityAction.DIE="d",EntityAction.HIT="h",__reflect(EntityAction.prototype,"EntityAction");var CharEffect=function(t){function e(){var e=t.call(this)||this;return e.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT,e.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE,e._dir=4,e._state=EntityAction.STAND,e.hasDir=[CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.WING,CharMcOrder.SOUL,CharMcOrder.ZHANLING],e._disOrder={},e._mcFileName={},e._bodyContainer=new egret.DisplayObjectContainer,e.addChild(e._bodyContainer),e._body=ObjectPool.pop("MovieClip"),e._bodyContainer.addChild(e._body),e._disOrder[CharMcOrder.BODY]=e._body,e.titleCantainer=new egret.DisplayObjectContainer,e.titleCantainer.anchorOffsetY=e.myHeight,e.addChild(e.titleCantainer),e}return __extends(e,t),e.prototype.setBodyScale=function(t){this._bodyContainer.scaleX=this._bodyContainer.scaleY=t,this.myHeight=this.myHeight*t,this.typeface*=t,this.titleCantainer.anchorOffsetY=Math.floor(this.myHeight)},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.setConfig=function(t){var e=GlobalConfig.MonstershpConfig[t];e?(this.myHeight=e.hp,this.typeface=e.hp):(this.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT,this.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE),this.titleCantainer.anchorOffsetY=Math.floor(this.myHeight)},e.prototype.updateModel=function(){},Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},set:function(t){this._dir!=t&&(this._dir=t,this.loadBody())},enumerable:!0,configurable:!0}),e.prototype.getResDir=function(t){var e=2*(this._dir-4);return 0>e&&(e=0),this._dir-e},e.prototype.playAction=function(t,e){this._state=t,this.playComplete=e,this._body.clearComFun(),this.loadBody()},e.prototype.loadBody=function(){this._body.stop(),this._body.addEventListener(egret.Event.CHANGE,this.playBody,this),this.hasDir.indexOf(CharMcOrder.BODY)>=0?this.loadFile(this._body,this.getFileName(CharMcOrder.BODY),CharMcOrder.BODY):this.playFile(this._body,this.getFileName(CharMcOrder.BODY))},e.prototype.loadOther=function(t){var e=this.getMc(t);e&&(e.stop(),e.addEventListener(egret.Event.CHANGE,this.syncFrame,this),this.loadFile(e,this.getFileName(t),t))},e.prototype.loadNoDir=function(t){var e=this.getMc(t);this.playFile(e,this.getFileName(t))},e.prototype.getFileName=function(t){return this._mcFileName[t]},e.prototype.playFile=function(t,e){t.playFile(e,-1,null,!1)},e.prototype.loadFile=function(t,i,s){if(i&&!(e.ACTION_ODER[s]&&e.ACTION_ODER[s].indexOf(this._state)<0)){var n=this.getResDir(s);t.scaleX=this._dir>4?-1:1;var o=i+"_"+n+this._state;t.playFile(o,this.playCount(),t==this._body?this.playComplete:null,!1)}},e.prototype.playBody=function(t){var e=1;this._body.gotoAndPlay(e,this.playCount()),this.removeBodyEvent(this._body);for(var i in this._disOrder){var s=this._disOrder[i];s!=this._body&&this.hasDir.indexOf(+i)>=0&&s instanceof MovieClip&&this.loadOther(+i)}this.sortEffect()},e.prototype.syncFrame=function(t){this.removeMcEvent(t.currentTarget),t.currentTarget.gotoAndPlay(this._body.currentFrame,this.playCount())},e.prototype.removeBodyEvent=function(t){t.removeEventListener(egret.Event.CHANGE,this.playBody,this)},e.prototype.removeMcEvent=function(t){t.removeEventListener(egret.Event.CHANGE,this.syncFrame,this)},e.prototype.onImgLoaded=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.COMPLETE,this.onImgLoaded,this),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2},e.prototype.playCount=function(){return-1},e.prototype.addMc=function(t,e,i){if(void 0===i&&(i=0),this._mcFileName[t]!=e){this._mcFileName[t]=e;var s=this._disOrder[t];return s||(s=0==i?ObjectPool.pop("MovieClip"):new eui.Image,this._bodyContainer.addChild(s),this._disOrder[t]=s),s instanceof MovieClip?this.hasDir.indexOf(t)>=0?s==this._body?this.loadBody():this.loadOther(t):this.loadNoDir(t):(s.addEventListener(egret.Event.COMPLETE,this.onImgLoaded,this),s.source=e),this.sortEffect(),s}},e.prototype.removeMc=function(t){if(t!=CharMcOrder.BODY){var e=this._disOrder[t];e&&(e instanceof MovieClip?(this.removeMcEvent(e),e.destroy()):DisplayUtils.removeFromParent(e),delete this._mcFileName[t],delete this._disOrder[t])}},e.prototype.getMc=function(t){return this._disOrder[t]},e.prototype.removeAll=function(){for(var t in this._disOrder){var e=this._disOrder[t];e!=this._body&&(e instanceof MovieClip?(this.removeMcEvent(e),e.destroy()):DisplayUtils.removeFromParent(e),delete this._mcFileName[t],delete this._disOrder[t])}this._body.dispose(),this.removeBodyEvent(this._body),delete this._mcFileName[CharMcOrder.BODY]},e.prototype.addShadow=function(){this.shadow||(this.shadow=new eui.Image(RES_DIR+"yingzi.png"),this.addChildAt(this.shadow,0),this.shadow.anchorOffsetX=28,this.shadow.anchorOffsetY=18)},e.prototype.removeShadow=function(){this.shadow&&(this.shadow.parent.removeChild(this.shadow),this.shadow=null)},e.prototype.sortEffect=function(){for(var t=e.FRAME_ODER[this._dir],i=t.length,s=0,n=0;i>n;n++){var o=t[n];this._disOrder[o]&&this._disOrder[o].parent&&(this._bodyContainer.addChildAt(this._disOrder[o],s),s+=1)}},Object.defineProperty(e.prototype,"weight",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"team",{get:function(){return this.infoModel.team},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.removeAll()},e}(egret.DisplayObjectContainer);CharEffect.FRAME_ODER=[[CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.BODY,CharMcOrder.WING,CharMcOrder.ZHANLING],[CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.WING,CharMcOrder.ZHANLING],[CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING],[CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING],[CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING],[CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING],[CharMcOrder.WING,CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.ZHANLING],[CharMcOrder.BODY,CharMcOrder.WEAPON,CharMcOrder.SOUL,CharMcOrder.WING,CharMcOrder.ZHANLING]],CharEffect.ACTION_ODER={8:[EntityAction.STAND,EntityAction.RUN,EntityAction.ATTACK]},__reflect(CharEffect.prototype,"CharEffect");var GuildWarMemberHeadRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberHeadSkin",e.clickEffc=new MovieClip,e.clickEffc.x=52,e.clickEffc.y=37,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.haveGuildName(!1),isNaN(this.data))this.data instanceof SelectInfoData&&(this.currentState="panel",this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+"份"),this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name),this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex);else{this.currentState="war";var t=EntityManager.ins().getEntityBymasterhHandle(this.data);if(t){var e=t.infoModel,i=e.guildName?"\n<font color='#6495ed'>"+e.guildName+"</font>":"",s=DevildomSys.ins().isDevildomBattle&&i?e.name+i:e.getNameWithServer2();s.indexOf("\n")>-1&&this.haveGuildName(!0),this.roleName.textFlow=(new egret.HtmlTextParser).parser(s),this.roleHead.source="yuanhead"+e.job+e.sex,GuildWar.ins().getModel().attHandle&&GuildWar.ins().getModel().attHandle==this.data&&this.addAttEffect()}else this.roleName.textFlow=(new egret.HtmlTextParser).parser("已死亡")}},e.prototype.addAttEffect=function(){this.attEffect||(this.attEffect=new MovieClip,this.attEffect.x=49,this.attEffect.y=28),this.attEffect.playFile(RES_DIR_EFF+"FightingEff",-1),this.addChild(this.attEffect)},e.prototype.removeAttEffect=function(){this.attEffect&&(this.attEffect.stop(),this.attEffect.destroy(),this.attEffect=null)},e.prototype.showEffect=function(){this.clickEffc.playFile(RES_DIR_EFF+"tapCircle",1),this.addChild(this.clickEffc)},e.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.clickEffc),DisplayUtils.removeFromParent(this.attEffect)},e.prototype.haveGuildName=function(t){t?(this.namebg.height=45,this.height=110):(this.namebg.height=26,this.height=98)},e}(BaseItemRender);__reflect(GuildWarMemberHeadRender.prototype,"GuildWarMemberHeadRender");var BaseEuiLayer=function(t){function e(){var e=t.call(this)||this;return e.percentWidth=100,e.percentHeight=100,e.touchEnabled=!1,e}return __extends(e,t),e}(eui.Group);__reflect(BaseEuiLayer.prototype,"BaseEuiLayer");var BaseSystem=function(t){function e(){var e=t.call(this)||this;return MessageCenter.compile(egret.getDefinitionByName(egret.getQualifiedClassName(e))),e.observe(GameApp.ins().postLoginInit,e.initLogin),e.observe(GameApp.ins().postZeroInit,e.initZero),e}return __extends(e,t),e.prototype.regNetMsg=function(t,e){GameSocket.ins().registerSTCFunc(this.sysId,t,e,this)},e.prototype.initLogin=function(){},e.prototype.initZero=function(){},e.prototype.getGameByteArray=function(){return GameSocket.ins().getBytes()},e.prototype.getBytes=function(t){var e=this.getGameByteArray();return e.writeCmd(this.sysId,t),e},e.prototype.sendBaseProto=function(t){var e=this.getGameByteArray();e.writeCmd(this.sysId,t),this.sendToServer(e)},e.prototype.sendToServer=function(t){GameSocket.ins().sendToServer(t)},e.prototype.observe=function(t,e){MessageCenter.addListener(t,e,this)},e.prototype.removeObserve=function(){MessageCenter.ins().removeAll(this)},e.prototype.associated=function(t){for(var e=this,i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];for(var n=!1,o=function(){n=!1,t.call(e)},a=function(){n||(n=!0,TimerManager.ins().doTimer(60,1,o,e))},r=0,h=i;r<h.length;r++){var l=h[r];this.observe(l,a)}},e}(BaseClass);__reflect(BaseSystem.prototype,"BaseSystem"),MessageCenter.compile(BaseSystem);var NpcModel=function(t){function e(){var e=t.call(this)||this;return e.type=EntityType.Npc,e}return __extends(e,t),Object.defineProperty(e.prototype,"avatarString",{get:function(){var t=GlobalConfig.NpcBaseConfig[this.configID];return t?t.avatar:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarFileName",{get:function(){var t=this.npcConfig;return 1==t.actType?RES_DIR_BODY+"body"+t.avatar:RES_DIR_MONSTER+"monster"+t.avatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weaponFileName",{get:function(){var t=this.npcConfig;return t.weapon?RES_DIR_WEAPON+"weapon"+t.weapon:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"npcConfig",{get:function(){return GlobalConfig.NpcBaseConfig[this.configID]},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){var e=egret.getQualifiedClassName(this);t=t||ObjectPool.pop(e);for(var i in this)"function"!=typeof this[i]&&"__class__"!=i&&"__types__"!=i&&(t[i]=this[i]);return t},e}(EffectModel);__reflect(NpcModel.prototype,"NpcModel");var ActivityBaseData=function(){function t(t){}return t.prototype.init=function(t,e){},t.prototype.update=function(t){},t.prototype.canReward=function(){return!1},t.prototype.isOpenActivity=function(){return!1},Object.defineProperty(t.prototype,"rewardState",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype.specialState=function(){return!0},t.prototype.getHide=function(){return!1},t}();__reflect(ActivityBaseData.prototype,"ActivityBaseData");var ActivityType;!function(t){t[t.Normal=0]="Normal",t[t.Personal=1]="Personal",t[t.Nesting=2]="Nesting"}(ActivityType||(ActivityType={}));var BaseEuiView=function(t){function e(){var e=t.call(this)||this;return e._resources=null,e.isTopLevel=!1,e.exclusionWins=[],e._isInit=!1,e.percentHeight=100,e.percentWidth=100,e}return __extends(e,t),e.prototype.addExclusionWin=function(t){-1==this.exclusionWins.indexOf(t)&&this.exclusionWins.push(t)},e.prototype.isInit=function(){return this._isInit},e.prototype.isShow=function(){return null!=this.stage&&this.visible},e.prototype.addToParent=function(t){t.addChild(this),TimerManager.ins().remove(this.destoryView,this)},e.prototype.removeFromParent=function(){this.parent;DisplayUtils.removeFromParent(this),this.destoryView()},e.prototype.initUI=function(){this._isInit=!0},e.prototype.initData=function(){},e.prototype.destroy=function(){},e.prototype.destoryView=function(t){void 0===t&&(t=!0),TimerManager.ins().removeAll(this),ViewManager.ins().destroy(this.hashCode),t&&ResourceMgr.ins().destroyWin()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.loadResource=function(t,e){this._resources&&this._resources.length>0?(ResourceUtils.ins().loadResource(this._resources,[],t,null,this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,e,this)):(t(),e())},e.prototype.setVisible=function(t){this.visible=t},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.anigroup&&UIAnimation.setAnimation(this.anigroup,UIAnimation.ANITYPE_IN_SCALE_VER,{time:200})},e.prototype.closeEx=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.parent==LayerManager.UI_Popup&&this.anigroup?UIAnimation.setAnimation(this.anigroup,UIAnimation.ANITYPE_OUT_SCALE_VER,{time:200,func:i,ease:egret.Ease.sineIn}):i()},e}(BaseView);__reflect(BaseEuiView.prototype,"BaseEuiView",["IBaseView"]);var CharMonster=function(t){function e(){var e=t.call(this)||this;return e.AI_STATE=AI_State.Stand,e.filterDic={},e.publicCD=0,e.nextPatrolTick=0,e.myKill=!1,e.isShowBody=!0,e.canMove=!1,e.moveRange=-1,e.moveLimTime=-1,e.moveMaxTime=-1,e.touchEnabled=!0,e.touchChildren=!1,e.buffList={},e.buffEff={},e.damageOverTimeList={},e.createTweenObj(),e.effs={},e.addShadow(),e._hpBar=new eui.ProgressBar,e._hpBar.skinName="bloodBarSkin",e._hpBar.anchorOffsetY=0,e._hpBar.labelDisplay.size=14,e._hpBar.visible=!1,e._hpBar.labelDisplay.visible=!1,e._hpBar.labelFunction=function(){return""},e.titleCantainer.addChild(e._hpBar),e._hpBar.anchorOffsetX=e._hpBar.width>>1,e._nameGroup=new eui.Group,e._nameGroup.touchEnabled=!1,e._nameGroup.height=30,e._nameGroup.width=260,e._nameGroup.anchorOffsetY=Math.floor(e._nameGroup.height+2),e._nameGroup.anchorOffsetX=Math.floor(e._nameGroup.width>>1),e.titleCantainer.addChild(e._nameGroup),e._nameTxt=new eui.Label,e._nameTxt.textAlign="center",e._nameTxt.size=14,e._nameTxt.stroke=1,e._nameTxt.strokeColor=0,e._nameTxt.textColor=15589033,e._nameTxt.bottom=0,e._nameTxt.horizontalCenter=0,e._nameGroup.addChild(e._nameTxt),e._nameGroup.visible=!1,e}return __extends(e,t),e.prototype.createTweenObj=function(){var t=this;this.dieTweenObj={set alpha(e){t.alpha=e},get alpha(){return t.alpha}},this.moveTweenObj={set x(e){t.x=e>>0},set y(e){t.y=e>>0},get x(){return t.x},get y(){return t.y}}},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t,-1!=GlobalConfig.FlameStamp.monsterId.indexOf(t.configID)?this._lyMark||(this._lyMark=new LyMarkEffect(this._body,t)):this._lyMark&&this.clearLyMark()},enumerable:!0,configurable:!0}),e.prototype.setCharName=function(t){this._nameTxt.textFlow=TextFlowMaker.generateTextFlow(t)},e.prototype.setNameTxtColor=function(t){this._nameTxt.textColor=t},e.prototype.usedLyMarkSkill=function(){this._lyMark&&this._lyMark.usedLyMarkSkill()},e.prototype.playAction=function(e,i){(this._state!=e||this.isAtkAction())&&(this.hasFilter(EntityFilter.hard)&&e!=EntityAction.DIE||(e!=EntityAction.HIT&&e!=EntityAction.DIE||this.infoModel.type!=EntityType.Monster||!GlobalConfig.MonstersConfig[this.infoModel.configID]||4!=GlobalConfig.MonstersConfig[this.infoModel.configID].type)&&t.prototype.playAction.call(this,e,i))},e.prototype.stopMove=function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.canMove=!1,egret.Tween.removeTweens(this.moveTweenObj)},Object.defineProperty(e.prototype,"dir",{get:function(){if(this.infoModel){var t=this.infoModel.getDir();return 0>t?this._dir:t}return this._dir},set:function(t){this._dir==t||this.hasFilter(EntityFilter.hard)||this._state!=EntityAction.DIE&&(this._dir=t,this.loadBody())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"action",{get:function(){return this._state},set:function(t){this._state!=EntityAction.DIE&&(this._state=t)},enumerable:!0,configurable:!0}),e.prototype.getResDir=function(t){var e=2*(this._dir-4);0>e&&(e=0);var i=this._dir-e;return this.infoModel&&2!=this.infoModel.dirNum?i:2>i?1:3},Object.defineProperty(e.prototype,"moveSpeed",{get:function(){return this.infoModel?this.infoModel.getAtt(AttributeType.atMoveSpeed)/1e3*GameMap.CELL_SIZE:0},enumerable:!0,configurable:!0}),e.prototype.hram=function(t){this._hpBar.value=Math.min(this._hpBar.value-t,this.infoModel.getAtt(AttributeType.atMaxHp))},e.prototype.getHP=function(){return this._hpBar.value},e.prototype.getRealHp=function(){return this.infoModel.getAtt(AttributeType.atHp)},e.prototype.reset=function(){this._state=EntityAction.STAND,this.AI_STATE=AI_State.Stand,this.dir=4,this._hpBar.slideDuration=500,this.myKill=!1,this.removeAllFilters()},e.prototype.destruct=function(){this.destroy(),ObjectPool.push(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.deadDelay(),this.alpha=1,this.AI_STATE=AI_State.Stand,this._nameTxt.textColor=15589033,this.clearLyMark(),this.removeAllEffect(),this.removeAllFilters(),TimerManager.ins().removeAll(this),this.stopMove(),DisplayUtils.removeFromParent(this)},e.prototype.deadDelay=function(){this._hpBar.slideDuration=0,this._hpBar.value=0,this.removeHardStraight();for(var t in this.damageOverTimeList){var e=this.damageOverTimeList[t];this.deleteDamageOverTimer(e)}this.removeAllBuff(),this.atking=!1,this.haloMc&&DisplayUtils.removeFromParent(this.haloMc)},e.prototype.clearLyMark=function(){this._lyMark&&(this._lyMark.destruct(),this._lyMark=null)},e.prototype.addHardStraight=function(t){this.isHardStraight=!0,TimerManager.ins().doTimer(t,1,this.removeHardStraight,this)},e.prototype.removeHardStraight=function(){this.isHardStraight=!1},e.prototype.initBody=function(t){this.addMc(CharMcOrder.BODY,t),ResourceMgr.ins().reloadImg(this.shadow)},Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._body.isPlaying},enumerable:!0,configurable:!0}),e.prototype.isAtkAction=function(){return this._state==EntityAction.ATTACK||this._state==EntityAction.CAST},e.prototype.playBody=function(e){t.prototype.playBody.call(this,e)},e.prototype.loadBody=function(){this.isShowBody&&t.prototype.loadBody.call(this)},e.prototype.loadOther=function(e){this.isShowBody&&t.prototype.loadOther.call(this,e)},e.prototype.loadNoDir=function(e){this.isShowBody&&t.prototype.loadNoDir.call(this,e)},e.prototype.showBodyContainer=function(){if(!this.isShowBody){this.isShowBody=!0,this.addChildAt(this._bodyContainer,1),this.loadBody();for(var t in this._disOrder){var e=+t;this._disOrder[t]instanceof MovieClip&&this.hasDir.indexOf(e)<0&&this.loadNoDir(e)}this.updateTitle(),this._lyMark&&this._lyMark.showBall()}},e.prototype.hideBodyContainer=function(){this.isShowBody&&(this.isShowBody=!1,this.removeChild(this._bodyContainer),this.updateTitle(),this._lyMark&&this._lyMark.hideBall())},e.prototype.getIsShowBody=function(){return this.isShowBody},e.prototype.resetStand=function(){this.isAtkAction()&&this.playAction(EntityAction.STAND)},e.prototype.hasEffById=function(t){return this.effs&&this.effs[t]?!0:!1},e.prototype.updateBlood=function(t){void 0===t&&(t=!1),this.infoModel&&(this._hpBar.maximum=this.infoModel.getAtt(AttributeType.atMaxHp),(t||!(EntityManager.ins().getTeamCount(Team.WillEntity)>0&&0==GameMap.fubenID))&&(this._hpBar.value=this.infoModel.getAtt(AttributeType.atHp)))},e.prototype.updateTitle=function(){var t=this.infoModel,e=GlobalConfig.MonstersConfig[t.configID],i=e&&e.titleId;if(this.removeTitle(),this.getIsShowBody()&&i&&i>0){var s=GlobalConfig.MonsterTitleConf[i];if(s)if(s.img)null==this._title&&(this._title=new eui.Image,this._title.anchorOffsetX=115,this.titleCantainer.addChild(this._title)),s.anchorOffsetY?this._title.anchorOffsetY=s.anchorOffsetY:this._title.anchorOffsetY=100,this._title.source=s.img;else if(s.eff){null==this._titleMc&&(this._titleMc=ObjectPool.pop("MovieClip"),this._titleMc.anchorOffsetX=0,this.titleCantainer.addChild(this._titleMc));var n=RES_DIR_EFF+s.eff;this.playFile(this._titleMc,n),s.anchorOffsetY?this._titleMc.anchorOffsetY=s.anchorOffsetY:this._titleMc.anchorOffsetY=80}}},e.prototype.removeTitle=function(){this._title&&(this._title.source=""),this._titleMc&&(this._titleMc.destroy(),this._titleMc=null)},e.prototype.onDead=function(t){this.stopMove(),this.showBlood(!1),this.showName(!1),this.removeTitle(),this.playAction(EntityAction.DIE),t&&TimerManager.ins().doTimer(300,1,t,this)},Object.defineProperty(e.prototype,"isCanAddBlood",{get:function(){return this._hpBar.value/this._hpBar.maximum<.8},enumerable:!0,configurable:!0}),e.prototype.damageOverTime=function(t){var e=t instanceof egret.Timer?t:t.currentTarget;e.currentCount==e.repeatCount&&this.deleteDamageOverTimer(e)},e.prototype.deleteDamageOverTimer=function(t){for(var e in this.damageOverTimeList)this.damageOverTimeList[e]==t&&(delete this.damageOverTimeList[e],t.stop(),t.removeEventListener(egret.TimerEvent.TIMER,this.damageOverTime,this))},e.prototype.addEffect=function(t){var e=GlobalConfig.EffectConfig[t];if(e){if(0==e.type){var i=new eui.Image;i.source=e.fileName,this.addChild(i);var s=egret.Tween.get(i);return i.x=i.x-23,void s.to({y:-100},2e3).call(function(){DisplayUtils.removeFromParent(i)})}var n=this.effs[t]||ObjectPool.pop("MovieClip"),o=RES_DIR_SKILLEFF+e.fileName;this.playFile(n,o),this.addChild(n),this.effs[t]=n}},e.prototype.addHalo=function(t){this.haloMc=this.haloMc?this.haloMc:ObjectPool.pop("MovieClip"),this.playFile(this.haloMc,RES_DIR_EFF+t),this.addChildAt(this.haloMc,0)},e.prototype.removeEffect=function(t){var e=GlobalConfig.EffectConfig[t];if(e&&0!=e.type){var i=this.effs[t];i&&(i instanceof MovieClip&&i.destroy(),delete this.effs[t])}},e.prototype.removeAllEffect=function(){for(var t in this.effs){var e=this.effs[t];e&&e instanceof MovieClip&&e.destroy()}this.effs={}},e.prototype.hasBuff=function(t){return!!this.buffList[t]},e.prototype.addBuff=function(t){var e=t.effConfig,i=e.group,s=this.buffList[i];if(s){if(2==s.effConfig.overlayType){var n=s.multRate+1;n>s.effConfig.overMaxCount&&(n=s.effConfig.overMaxCount),t.multRate=n}this.removeBuff(s)}if(this.buffList[i]=t,e.effName){var o=this.buffEff[i]||ObjectPool.pop("MovieClip"),a=RES_DIR_SKILLEFF+e.effName;this.playFile(o,a),this.addChild(o),this.buffEff[i]=o}if(e.effID&&this.addEffect(e.effID),t.effConfig.type==SkillEffType.AdditionalState&&t.effConfig.args&&9==t.effConfig.args.i){var r=t.effConfig.duration;this.addHardStraight(r)}this.addGroup(i)},e.prototype.removeBuff=function(t){var e=t.effConfig,i=e.group;if(this.buffList[i]==t&&(t.dispose(),ObjectPool.push(this.buffList[i]),delete this.buffList[i],this.buffEff[i]&&(DisplayUtils.removeFromParent(this.buffEff[i]),delete this.buffEff[i]),e.effID&&this.removeEffect(e.effID),e.unionBuff)){var s=this.buffList[e.unionBuff];s&&this.removeBuff(s)}this.removeGroup(i)},e.prototype.removeAllBuff=function(){for(var t in this.buffList)this.removeBuff(this.buffList[t])},e.prototype.addPaoPao=function(t){this.paoPao||(this.paoPao=new PaoPaoView,this.addChildAt(this.paoPao,100),this.paoPao.open()),this.paoPao.anchorOffsetY=170,this.paoPao.anchorOffsetX=100;var e=this.infoModel.job;this.paoPao.setSpeak(t,e)},Object.defineProperty(e.prototype,"team",{get:function(){return this._infoModel.team},enumerable:!0,configurable:!0}),e.prototype.startPatrol=function(){if(TimerManager.ins().getCurrTime()>this.nextPatrolTick){var t=this.getPointCanMove();t&&(GameMap.moveEntity(this,t.x,t.y),this.nextPatrolTick=TimerManager.ins().getCurrTime()+MathUtils.limit(this.moveLimTime,this.moveMaxTime))}},e.prototype.setMoveAtt=function(t){this.moveRange=t[0],this.moveLimTime=t[1][0],this.moveMaxTime=t[1][1]},e.prototype.getPointCanMove=function(){for(var t,e=0,i=this.moveRange;100>e;){var s=MathUtils.limit(this.x-i>>0,this.x+i>>0),n=MathUtils.limit(this.y-i>>0,this.y+i>>0);if(GameMap.checkWalkableByPixel(s,n)){t=new egret.Point,t.x=s,t.y=n;break}e++}return t},e.prototype.playCount=function(){return this._state==EntityAction.RUN||this._state==EntityAction.STAND?-1:1},e.prototype.shakeIt=function(){var t=this;(this.action==EntityAction.STAND||this.action==EntityAction.HIT)&&(DisplayUtils.shakeItEntity(this,3,200,1),this.moveSpeed&&this.playAction(EntityAction.HIT,function(){t.playAction(EntityAction.STAND)
}))},e.prototype.showName=function(t){this._nameGroup.visible=t},e.prototype.showBlood=function(t){t&&this.infoModel&&"神兽"==this.infoModel.name||(this._hpBar.visible=t)},Object.defineProperty(e.prototype,"isMy",{get:function(){return this.infoModel.isMy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._infoModel&&this.team==Team.My&&this instanceof CharRole?this.y+32:this.y},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){this.removeAll(),this.parseModel()},e.prototype.parseModel=function(){var t=this,e=this.infoModel;e.team!=Team.My&&(t.updateBlood(!0),t.setCharName(e.name)),t.initBody(RES_DIR_MONSTER+e.avatarFileName),t.setConfig(e.avatar+""),t.updateTitle(),e.avatarEffect&&""!=e.avatarEffect&&t.addHalo(e.avatarEffect),e.movePara&&t.setMoveAtt(e.movePara),t.setBodyScale(e.avatarScale)},e.prototype.addGroup=function(t){var e=EntityFilterUtil.getEntityFilter(t);if(e){this.filterDic[e]=this.filterDic[e]||[];var i=this.filterDic[e].indexOf(t);-1==i&&(this.filterDic[e].push(t),this.updateFilter())}},e.prototype.removeGroup=function(t){var e=EntityFilterUtil.getEntityFilter(t);if(e){var i=this.filterDic[e];if(!i)return;var s=i.indexOf(t);s>=0&&(i.splice(s,1),this.updateFilter())}},e.prototype.updateFilter=function(){var t=EntityFilter.no;this.hasFilter(EntityFilter.hard)?t=EntityFilter.hard:this.hasFilter(EntityFilter.poison)&&(t=EntityFilter.poison),this.curFilter!=t&&this.setFilter(t)},e.prototype.hasFilter=function(t){return!(!this.filterDic[t]||!this.filterDic[t].length)},e.prototype.setFilter=function(t){this.curFilter=t,t?(this.setMcFilter(t),t==EntityFilter.hard?this.setMcFilterPlayOrStop(!1):this.setMcFilterPlayOrStop(!0)):(this.setMcFilter(t),this.setMcFilterPlayOrStop(!0))},e.prototype.setMcFilter=function(t){if("webgl"==egret.Capabilities.renderMode)for(var e in this._disOrder)if(+e!=CharMcOrder.ZHANLING){var i=this._disOrder[e];i.filters=t?EntityFilterUtil.buffFilter[t].filters:null}},e.prototype.setMcFilterPlayOrStop=function(t){for(var e=0,i=this.hasDir;e<i.length;e++){var s=i[e];if(s!=CharMcOrder.ZHANLING){var n=this.getMc(s);n&&(t?n.play():n.stop())}}},e.prototype.removeAllFilters=function(){this.filterDic={},this.curFilter=EntityFilter.no;for(var t in this._disOrder){var e=this._disOrder[t];e.filters=null}},e}(CharEffect);__reflect(CharMonster.prototype,"CharMonster",["IChar"]);var GuideViewBase=function(t){function e(){var e=t.call(this)||this;return e.clickCD=!0,e.otherMc=[],e.rect=new egret.Rectangle(1,1,1,1),e.infoGroup=new eui.Group,e.infoGroup.touchEnabled=!1,e.infoGroup.touchChildren=!1,e.addChild(e.infoGroup),e}return __extends(e,t),e.prototype.drawMask=function(){if(!this.shapeMasks){this.shapeMasks=[];for(var t=0;8>t;t++)this.shapeMasks[t]=new egret.Shape,this.shapeMasks[t].touchEnabled=!0}var e=this.rect,i=e.x,s=e.width,n=StageUtils.ins().getWidth()-e.right,o=e.y,a=e.height,r=StageUtils.ins().getHeight()-e.bottom;this.drawShape(this.shapeMasks[0],new egret.Rectangle(0,0,i,o)),this.drawShape(this.shapeMasks[1],new egret.Rectangle(e.x,0,s,o)),this.drawShape(this.shapeMasks[2],new egret.Rectangle(e.right,0,n,o)),this.drawShape(this.shapeMasks[3],new egret.Rectangle(0,e.topLeft.y,i,a)),this.drawShape(this.shapeMasks[4],new egret.Rectangle(e.bottomRight.x,e.topLeft.y,n,a)),this.drawShape(this.shapeMasks[5],new egret.Rectangle(0,e.bottomRight.y,i,r)),this.drawShape(this.shapeMasks[6],new egret.Rectangle(e.x,e.bottomRight.y,s,r)),this.drawShape(this.shapeMasks[7],new egret.Rectangle(e.right,e.bottomRight.y,n,r))},e.prototype.drawShape=function(t,e){t.graphics.clear(),t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,e.width,e.height),t.graphics.endFill(),this.addChild(t)},e.prototype.onResize=function(){if(this.target){var t=this.target.localToGlobal();return(this.rect.x!=t.x||this.rect.y!=t.y||this.rect.width!=this.target.width||this.rect.height!=this.target.height)&&(this.refurbish(),this.drawMask()),!1}},e.prototype.onClick=function(t){var e=this;if(this.rect.contains(t.stageX,t.stageY)){this.clickCD&&(this.clickCD=!1,TimerManager.ins().doNext(function(){e.dispatchEventWith(egret.Event.CHANGE)},this));for(var i=0;i<this.otherMc.length;i++)egret.Tween.removeTweens(this.otherMc[i]),DisplayUtils.removeFromParent(this.otherMc[i]);this.clicking=!1}else{if(GuideUtils.ins().clickOut(),this.clicking)return;this.clicking=!0,this.otherMc.length=2;for(var s=function(t){n.otherMc[t]||(n.otherMc[t]=new MovieClip),n.otherMc[t].parent||n.addChild(n.otherMc[t]),n.otherMc[t].scaleX=3.3,n.otherMc[t].scaleY=3.3,n.otherMc[t].x=n.infoGroup.x,n.otherMc[t].y=n.infoGroup.y;var e=egret.Tween.get(n.otherMc[t]),i=n;e.wait(240*t).call(function(){i.otherMc[t].playFile(RES_DIR_EFF+"forceguildeff",1,function(){egret.Tween.removeTweens(i.otherMc[t]),DisplayUtils.removeFromParent(i.otherMc[t]),t==i.otherMc.length-1&&(i.clicking=!1)})})},n=this,i=0;i<this.otherMc.length;i++)s(i)}},e.prototype.refurbish=function(){this.show(this.target)},e.prototype.show=function(t){if(null!=t){this.target=t;var e=t.localToGlobal();this.rect.x=e.x,this.rect.y=e.y,this.rect.width=t.width?t.width:60,this.rect.height=t.height?t.height:60,this.drawMask(),this.addChild(this.infoGroup),this.infoGroup.x=e.x+(this.rect.width>>1),this.infoGroup.y=e.y+(this.rect.height>>1);var i=StageUtils.ins().getStage();i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,!0,0),egret.stopTick(this.onResize,this),egret.startTick(this.onResize,this)}},e.prototype.close=function(){this.target=null,this.rect.x=this.rect.y=this.rect.width=this.rect.height=1;var t=StageUtils.ins().getStage();t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,!0),egret.stopTick(this.onResize,this)},e}(egret.DisplayObjectContainer);__reflect(GuideViewBase.prototype,"GuideViewBase");var GameByteArray=function(t){function e(){var e=t.call(this)||this;return e.endian=egret.Endian.LITTLE_ENDIAN,e}return __extends(e,t),e.prototype.readString=function(){var t=this.readUTF();return this.position+=1,t},e.prototype.readNumber=function(){var t=new uint64(this),e=t.toString();return+e},e.prototype.writeNumber=function(t){var e=uint64.stringToUint64(t.toString());this.writeInt64(e)},e.prototype.writeInt64=function(t){this.writeUnsignedInt(t._lowUint),this.writeUnsignedInt(t._highUint)},e.prototype.writeString=function(t){this.writeUTF(t),this.writeByte(0)},e.prototype.writeCmd=function(t,e){this.writeByte(t),this.writeByte(e)},e.prototype.readInts=function(t){for(var e=[],i=0;t>i;i++)e.push(this.readInt());return e},e.prototype.writeInts=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,s=t;i<s.length;i++){var n=s[i];this.writeInt(n)}},e}(egret.ByteArray);__reflect(GameByteArray.prototype,"GameByteArray");var enPropEntity;!function(t){t[t.P_ID=0]="P_ID",t[t.P_POS_X=1]="P_POS_X",t[t.P_POS_Y=2]="P_POS_Y",t[t.P_MODELID=3]="P_MODELID",t[t.P_ICON=4]="P_ICON",t[t.P_DIR=5]="P_DIR",t[t.P_MAX_ENTITY=6]="P_MAX_ENTITY"}(enPropEntity||(enPropEntity={}));var enPropAnimal;!function(t){t[t.P_LEVEL=6]="P_LEVEL",t[t.P_HP=7]="P_HP",t[t.P_MP=8]="P_MP",t[t.P_SPEED=9]="P_SPEED",t[t.P_MAXHP=10]="P_MAXHP",t[t.P_MAXMP=11]="P_MAXMP",t[t.P_OUT_ATTACK=12]="P_OUT_ATTACK",t[t.P_OUT_DEFENCE=13]="P_OUT_DEFENCE",t[t.P_DEFCRITICALSTRIKES=14]="P_DEFCRITICALSTRIKES",t[t.P_ALL_ATTACK=15]="P_ALL_ATTACK",t[t.P_SUB_DEF=16]="P_SUB_DEF",t[t.P_IN_ATTACK=17]="P_IN_ATTACK",t[t.P_IN_DEFENCE=18]="P_IN_DEFENCE",t[t.P_CRITICALSTRIKES=19]="P_CRITICALSTRIKES",t[t.P_DODGERATE=20]="P_DODGERATE",t[t.P_HITRATE=21]="P_HITRATE",t[t.P_ATTACK_ADD=22]="P_ATTACK_ADD",t[t.P_HP_RENEW=23]="P_HP_RENEW",t[t.P_MP_RENEW=24]="P_MP_RENEW",t[t.P_ATTACK_SPEED=25]="P_ATTACK_SPEED",t[t.P_IN_ATTACK_DAMAGE_ADD=26]="P_IN_ATTACK_DAMAGE_ADD",t[t.P_OUT_ATTACK_DAMAGE_ADD=27]="P_OUT_ATTACK_DAMAGE_ADD",t[t.P_THUNDER_ATTACK=28]="P_THUNDER_ATTACK",t[t.P_THUNDER_DEFENCE=29]="P_THUNDER_DEFENCE",t[t.P_POISON_ATTACK=30]="P_POISON_ATTACK",t[t.P_POISON_DEFENCE=31]="P_POISON_DEFENCE",t[t.P_ICE_ATTACK=32]="P_ICE_ATTACK",t[t.P_ICE_DEFENCE=33]="P_ICE_DEFENCE",t[t.P_FIRE_ATTACK=34]="P_FIRE_ATTACK",t[t.P_FIRE_DEFENCE=35]="P_FIRE_DEFENCE",t[t.P_STATE=36]="P_STATE",t[t.P_BASE_MAXHP=37]="P_BASE_MAXHP",t[t.P_BASE_MAXMP=38]="P_BASE_MAXMP",t[t.P_STAND_POINT=39]="P_STAND_POINT",t[t.P_MAX_ANIMAL=40]="P_MAX_ANIMAL"}(enPropAnimal||(enPropAnimal={}));var enPropActor;!function(t){t[t.P_WEAPON=40]="P_WEAPON",t[t.P_MOUNT=41]="P_MOUNT",t[t.P_DIZZY_RATE11=42]="P_DIZZY_RATE11",t[t.P_DIZZY_TIME1=43]="P_DIZZY_TIME1",t[t.P_HP_STORE=44]="P_HP_STORE",t[t.P_MP_STORE=45]="P_MP_STORE",t[t.P_SPIRIT=46]="P_SPIRIT",t[t.P_PK_MOD=47]="P_PK_MOD",t[t.P_STRONG_EFFECT=48]="P_STRONG_EFFECT",t[t.P_WING=49]="P_WING",t[t.P_STAGE_EFFECT=50]="P_STAGE_EFFECT",t[t.P_PET_HP_STORE=51]="P_PET_HP_STORE",t[t.PROP_ACTOR_XIUWEI_RENEW_RATE=52]="PROP_ACTOR_XIUWEI_RENEW_RATE",t[t.P_SEX=53]="P_SEX",t[t.P_VOCATION=54]="P_VOCATION",t[t.P_EXP=55]="P_EXP",t[t.P_PK_VALUE=57]="P_PK_VALUE",t[t.P_BAG_GRID=58]="P_BAG_GRID",t[t.P_WEEK_CHARM=59]="P_WEEK_CHARM",t[t.P_BIND_COIN=60]="P_BIND_COIN",t[t.P_COIN=61]="P_COIN",t[t.P_BIND_YB=62]="P_BIND_YB",t[t.P_YB=63]="P_YB",t[t.P_SHENGWANG=64]="P_SHENGWANG",t[t.P_CHARM=65]="P_CHARM",t[t.P_SPIRIT_SLOT=66]="P_SPIRIT_SLOT",t[t.P_RENOWN=67]="P_RENOWN",t[t.P_GUILD_ID=68]="P_GUILD_ID",t[t.P_TEAM_ID=69]="P_TEAM_ID",t[t.P_SOCIAL=70]="P_SOCIAL",t[t.P_GUILD_EXP=71]="P_GUILD_EXP",t[t.P_LUCKY=72]="P_LUCKY",t[t.P_SYS_OPEN=73]="P_SYS_OPEN",t[t.P_ROOT_EXP_POWER=74]="P_ROOT_EXP_POWER",t[t.P_CHANGE_MODEL=75]="P_CHANGE_MODEL",t[t.PROP_BANGBANGTANG_EXP=76]="PROP_BANGBANGTANG_EXP",t[t.P_GIVE_YB=77]="P_GIVE_YB",t[t.P_CRITICAL_STRIKE=78]="P_CRITICAL_STRIKE",t[t.P_EXP_RATE=79]="P_EXP_RATE",t[t.P_DEPOT_GRID=80]="P_DEPOT_GRID",t[t.P_ANGER=81]="P_ANGER",t[t.P_ROOT_EXP=82]="P_ROOT_EXP",t[t.P_ACHIEVEPOINT=83]="P_ACHIEVEPOINT",t[t.P_ZYCONT=84]="P_ZYCONT",t[t.P_QQ_VIP=85]="P_QQ_VIP",t[t.P_WING_ID=86]="P_WING_ID",t[t.P_WING_SCORE=87]="P_WING_SCORE",t[t.P_PET_SCORE=88]="P_PET_SCORE",t[t.PROP_ACTOR_VIPFLAG=89]="PROP_ACTOR_VIPFLAG",t[t.P_CAMP=90]="P_CAMP",t[t.P_PET_SLOT=91]="P_PET_SLOT",t[t.P_HONOR=92]="P_HONOR",t[t.P_QING_YUAN=93]="P_QING_YUAN",t[t.PROP_ACTOR_DUR_KILLTIMES=94]="PROP_ACTOR_DUR_KILLTIMES",t[t.PROP_ACTOR_BASE_FIGHT=95]="PROP_ACTOR_BASE_FIGHT",t[t.P_FIGHT_VALUE=96]="P_FIGHT_VALUE",t[t.P_MAX_RENOWN=97]="P_MAX_RENOWN",t[t.P_RECHARGE=98]="P_RECHARGE",t[t.P_VIP_LEVEL=99]="P_VIP_LEVEL",t[t.P_BEAST_LEVEL=100]="P_BEAST_LEVEL",t[t.P_FOOT_EFFECT=101]="P_FOOT_EFFECT",t[t.P_EQUIP_SCORE=102]="P_EQUIP_SCORE",t[t.P_HAIR_MODEL=103]="P_HAIR_MODEL",t[t.P_BUBBLE=104]="P_BUBBLE",t[t.P_ACTOR_STATE=105]="P_ACTOR_STATE",t[t.P_JINGJIE_TITLE=106]="P_JINGJIE_TITLE",t[t.P_ZHUMOBI=107]="P_ZHUMOBI",t[t.P_WARSPIRIT=108]="P_WARSPIRIT",t[t.P_GUILDFB_SCORE=109]="P_GUILDFB_SCORE",t[t.P_SYS_OPENEX=110]="P_SYS_OPENEX",t[t.P_MAX_ACTOR=111]="P_MAX_ACTOR"}(enPropActor||(enPropActor={}));var AttributeType;!function(t){t[t.atHp=0]="atHp",t[t.atMp=1]="atMp",t[t.atMaxHp=2]="atMaxHp",t[t.atMaxMp=3]="atMaxMp",t[t.atAttack=4]="atAttack",t[t.atDef=5]="atDef",t[t.atRes=6]="atRes",t[t.atCrit=7]="atCrit",t[t.atTough=8]="atTough",t[t.atMoveSpeed=9]="atMoveSpeed",t[t.atAttackSpeed=10]="atAttackSpeed",t[t.atHpEx=11]="atHpEx",t[t.atAtkEx=12]="atAtkEx",t[t.atStunPower=13]="atStunPower",t[t.atStunRes=14]="atStunRes",t[t.atStunTime=15]="atStunTime",t[t.atDamageReduction=16]="atDamageReduction",t[t.atCritHurt=17]="atCritHurt",t[t.atRegeneration=18]="atRegeneration",t[t.atCritEnhance=19]="atCritEnhance",t[t.atPenetrate=20]="atPenetrate",t[t.atRoleDamageEnhance=21]="atRoleDamageEnhance",t[t.atRoleDamageReduction=22]="atRoleDamageReduction",t[t.atDefEx=23]="atDefEx",t[t.atResEx=24]="atResEx",t[t.cruNeiGong=25]="cruNeiGong",t[t.maxNeiGong=26]="maxNeiGong",t[t.neigongAbsorbHurt=27]="neigongAbsorbHurt",t[t.atJob1HpEx=28]="atJob1HpEx",t[t.atJob2HpEx=29]="atJob2HpEx",t[t.atJob3HpEx=30]="atJob3HpEx",t[t.atNeiGongRestore=31]="atNeiGongRestore",t[t.atVamirePro=32]="atVamirePro",t[t.atVamirePen=33]="atVamirePen",t[t.atVamireCd=34]="atVamireCd",t[t.atCursePro=35]="atCursePro",t[t.atCurseCd=36]="atCurseCd",t[t.atAttAddDamPro=37]="atAttAddDamPro",t[t.atAttAddDamVal=38]="atAttAddDamVal",t[t.atBeAttAddHpPro=39]="atBeAttAddHpPro",t[t.atBeAttAddHpVal=40]="atBeAttAddHpVal",t[t.atAttMbAddDamPen=41]="atAttMbAddDamPen",t[t.atHpLtAddBuff=42]="atHpLtAddBuff",t[t.atAttHpLtPenAddDam=43]="atAttHpLtPenAddDam",t[t.atAttHpLtAddDamPen=44]="atAttHpLtAddDamPen",t[t.atJob1AtkEx=45]="atJob1AtkEx",t[t.atJob2AtkEx=46]="atJob2AtkEx",t[t.atJob3AtkEx=47]="atJob3AtkEx",t[t.atJob1DefEx=48]="atJob1DefEx",t[t.atJob2DefEx=49]="atJob2DefEx",t[t.atJob3DefEx=50]="atJob3DefEx",t[t.atJob1ResEx=51]="atJob1ResEx",t[t.atJob2ResEx=52]="atJob2ResEx",t[t.atJob3ResEx=53]="atJob3ResEx",t[t.atAttPerDamPan=54]="atAttPerDamPan",t[t.atYuPeiDeterDam=55]="atYuPeiDeterDam",t[t.atCritEnhanceResist=56]="atCritEnhanceResist",t[t.atHolyDamege=57]="atHolyDamege",t[t.atHolyMaster=58]="atHolyMaster",t[t.atHolyResist=59]="atHolyResist",t[t.atTogetherHolyDamege=60]="atTogetherHolyDamege",t[t.atTogetherHolyMaster=61]="atTogetherHolyMaster",t[t.atTogetherHolyResist=62]="atTogetherHolyResist",t[t.atZhuiMingPro=63]="atZhuiMingPro",t[t.atZhuiMingVal=64]="atZhuiMingVal",t[t.atHuiXinDamage=65]="atHuiXinDamage",t[t.atNeiGongEx=66]="atNeiGongEx",t[t.atDeadLyPro=67]="atDeadLyPro",t[t.atDeadLyMaster=68]="atDeadLyMaster",t[t.atDeadLyResist=69]="atDeadLyResist",t[t.atAddEnemyHp=70]="atAddEnemyHp",t[t.atHurtMyself=71]="atHurtMyself",t[t.atBladeMailPro=72]="atBladeMailPro",t[t.atBladeMailPer=73]="atBladeMailPer",t[t.atDefPen=74]="atDefPen",t[t.atResPen=75]="atResPen",t[t.atDeadLyHurt=76]="atDeadLyHurt",t[t.atDeadLyHurtResist=77]="atDeadLyHurtResist",t[t.atCritHurtResist=78]="atCritHurtResist",t[t.atHunGuPro=79]="atHunGuPro",t[t.atHunGuHurt=80]="atHunGuHurt",t[t.atHunGuCd=81]="atHunGuCd",t[t.atHearthDamege=82]="atHearthDamege",t[t.atHearthHurt=83]="atHearthHurt",t[t.atHearthCount=84]="atHearthCount",t[t.atCount=85]="atCount"}(AttributeType||(AttributeType={}));var ByteArrayMsg=function(){function t(){this._msgBuffer=new egret.ByteArray}return t.prototype.receive=function(t){t.readBytes(this._msgBuffer);var e=this.decode(this._msgBuffer);e&&MessageCenter.ins().dispatch(e.key,e.body),0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear()},t.prototype.send=function(t,e){var i=this.encode(e);i&&(i.position=0,t.writeBytes(i,0,i.bytesAvailable))},t.prototype.decode=function(t){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},t.prototype.encode=function(t){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},t}();__reflect(ByteArrayMsg.prototype,"ByteArrayMsg",["BaseMsg"]);var EntityModel=function(t){function e(){var e=t.call(this)||this;return e.isElite=!1,e.attributeData=[],e.attributeExData=[],e.killNum=0,e.isMy=!1,e.weaponsId=0,e.isWander=!1,e.lyMarkLv=0,e.lyMarkSkills=[],e.type=EntityType.Monster,e}return __extends(e,t),e.prototype.parser=function(t){if(this.parserBase(t),this.type!=EntityType.CollectionMonst){this.parserAtt(t);for(var e=t.readShort(),i=0;e>i;i++)t.readInt();this.parserLyMark(t)}},e.prototype.parserLyMark=function(t){this.lyMarkLv=t.readShort(),this.lyMarkSkills=[];var e=t.readByte();this.lyMarkSkills.length=e;for(var i=0;e>i;i++)this.lyMarkSkills[i]=t.readShort()},e.prototype.parserBase=function(t){this.type=t.readShort(),this.handle=t.readDouble(),this.configID=t.readInt(),this.masterHandle=t.readDouble(),this.x=t.readInt(),this.y=t.readInt(),this.isMy=this.checkHandleIsMy(this.masterHandle)},e.prototype.checkHandleIsMy=function(t){if(t==Actor.handle)return!0;for(var e=SubRoles.ins().roles,i=0,s=e;i<s.length;i++){var n=s[i];if(n.handle==t)return!0}return!1},e.prototype.parserAtt=function(t,e){void 0===e&&(e=!1);var i=t.readShort();if(e)for(var s=0;i>s;s++){var n=this.attributeData[s];this.attributeData[s]=t.readDouble();var o=this.attributeData[s]-n;if(n!=this.attributeData[s]&&-1==AttributeData.FILTER_BASE_DATA_ID.lastIndexOf(s)){if(0>=o)continue;if(2>s||s>6){var a=o>0?"35e62d":"f3311e",r=new AttributeData(s,o);if(!AttributeData.getAttrStrByType(r.type))continue;var h="|C:0x"+a+"&T:"+AttributeData.getAttStrByType(r,0)+"|";GodWeaponCC.ins().gwshowTips||UserTips.ins().showTips(h);continue}UserTips.ins().showAttrTips(s,o)}}else for(var s=0;i>s;s++)this.attributeData[s]=t.readDouble()},e.prototype.parserExtAtt=function(t,e){void 0===e&&(e=!1);var i=t.readShort();if(e)for(var s=0;i>s;s++){var n=this.attributeExData[s];if(this.attributeExData[s]=t.readInt(),n!=this.attributeExData[s]&&-1==AttributeData.FILTER_EXTDATA_ID.lastIndexOf(s)){var o=this.attributeExData[s]-n;if(0>=o)continue;var a=o>0?"35e62d":"f3311e",r=new AttributeData(s,o),h="|C:0x"+a+"&T:"+AttributeData.getExtAttStrByType(r,0)+"|";UserTips.ins().showTips(h)}}else for(var s=0;i>s;s++)this.attributeData[s]=t.readInt()},e.prototype.parserHeirloom=function(){},e.prototype.getAtt=function(t){return this.attributeData[t]||0},e.prototype.setAtt=function(t,e){this.attributeData[t]=e},e.prototype.getExAtt=function(t){return this.attributeExData[t]||0},Object.defineProperty(e.prototype,"avatarFileName",{get:function(){return"monster"+this.avatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weaponFileName",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatar",{get:function(){return this._avatar||GlobalConfig.MonstersConfig[this.configID].avatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name||GlobalConfig.MonstersConfig[this.configID].name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),e.prototype.getNameWithServer=function(){return this._servId&&KFServerSys.ins().isKF?this.name+("S"+this._servId):this.name},e.prototype.getDir=function(){var t=GlobalConfig.MonstersConfig[this.configID];if(!t)return-1;var e=GlobalConfig.MonstersConfig[this.configID].dir;return isNaN(e)?-1:e},Object.defineProperty(e.prototype,"dirNum",{get:function(){var t=GlobalConfig.MonstersConfig[this.configID];return t&&(this._dirNum=0/0,t.dirNum)?t.dirNum:this._dirNum?this._dirNum:2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarScale",{get:function(){var t=this._scale||GlobalConfig.MonstersConfig[this.configID].scale;return t?t/100:1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarEffect",{get:function(){return GlobalConfig.MonstersConfig[this.configID]&&GlobalConfig.MonstersConfig[this.configID].effect?GlobalConfig.EffectConfig[GlobalConfig.MonstersConfig[this.configID].effect].fileName:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attRange",{get:function(){return GlobalConfig.MonstersConfig[this.configID].attrange?GlobalConfig.MonstersConfig[this.configID].attrange:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movePara",{get:function(){return GlobalConfig.YouDangConfig[this.wandertime]&&this.wanderrange?[this.wanderrange,GlobalConfig.YouDangConfig[this.wandertime].fileName]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lv",{get:function(){return GlobalConfig.MonstersConfig[this.configID].level},set:function(t){this._lv=t},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e){this.x=t,this.y=e},e}(NpcModel);__reflect(EntityModel.prototype,"EntityModel");var RedPointBase=function(t){function e(){var e=t.call(this)||this;return e.initTabs(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initTabs=function(){this.isOpen=!1,this.redpoint=!1,this.tabs={},this.toTabs={},this.sumTabs={},this.observe(this.postRedPoint,this.postOpen)},e.prototype.registerTab=function(t){for(var e=this,i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];this.tabs[t]=!1,this.associated.apply(this,[function(){return e.updateTabRedPoint(t)}].concat(i))},e.prototype.registerSum=function(t,e){this.sumTabs[t]=e;for(var i=0,s=e;i<s.length;i++){var n=s[i];this.toTabs[n]?this.toTabs[n].push(t):this.toTabs[n]=[t]}},e.prototype.registerOpen=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.associated.apply(this,[this.postOpen].concat(t))},e.prototype.postOpen=function(){var t=this.isOpen;if(this.isOpen=this.getIsOpen(),this.isOpen&&t!=this.isOpen)for(var e=Object.keys(this.tabs),i=0;i<e.length;i++){var s=+e[i];this.updateTabRedPoint(s)}return this.isOpen!=t},e.prototype.postRedPoint=function(){if(!this.isOpen)return this.redpoint?(this.redpoint=!1,!0):!1;var t=this.redpoint;return this.redpoint=this.and(),this.redpoint!=t},e.prototype.postTabs=function(t){return t},e.prototype.getRedPoint=function(t){return this.tabs[t]},e.prototype.updateTabRedPoint=function(t){if(this.isOpen){var e=this.tabs[t];this.tabs[t]=this.getTabRedPoint(t),this.tabs[t]!=e&&this.sendTabs(t)}},e.prototype.sendTabs=function(t){this.postTabs(t);var e=this.toTabs[t];if(e)for(var i=0,s=e;i<s.length;i++){var n=s[i],o=this.tabs[n];this.tabs[n]=this.andTabs(this.sumTabs[n]),this.tabs[n]!=o&&this.postTabs(n)}this.postRedPoint()},e.prototype.and=function(){for(var t in this.tabs)if(this.tabs[t])return!0;return!1},e.prototype.andTabs=function(t){for(var e in t)if(this.getRedPoint(t[e]))return!0;return!1},e.prototype.andList=function(t){for(var e in t)if(t[e])return!0;return!1},e.prototype.getTabRedPoint=function(t){return!1},e.prototype.getIsOpen=function(){return!0},e}(BaseSystem);__reflect(RedPointBase.prototype,"RedPointBase");var ActivityType1Config=function(){function t(){}return t}();__reflect(ActivityType1Config.prototype,"ActivityType1Config");var ActivityType9Config=function(){function t(){}return t}();__reflect(ActivityType9Config.prototype,"ActivityType9Config");var ExRing0Config=function(){function t(){this.power=0}return t}();__reflect(ExRing0Config.prototype,"ExRing0Config");var ExRingAttrConfig=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.attrAward=[],this.extAttrAward=[],this.upPower=0,this.addPower=0,this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ExRingAttrConfig.prototype,"ExRingAttrConfig");var ItemBase=function(t){function e(){var e=t.call(this)||this;return e.showSpeicalDetail=!0,e.isOpenSelectImg=!1,e.isCurrency=!1,e.showName=!1,e.skinName="ItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.setSoul=function(t){this.itemIcon.setSoul(t)},e.prototype.setItemImg=function(t){this.itemIcon.imgIcon.source=t},e.prototype.setItemHeirloomBgImg=function(t,e){e&&(this.itemIcon.imgheirloom.source=e+"_png"),this.itemIcon.imgheirloom.visible=t},e.prototype.setDataByConfig=function(t,e){this.itemIcon&&"function"==typeof this.itemIcon.setData&&this.itemIcon.setData(t);var i=ItemConfig.getType(t);if(i!=ItemType.TYPE_0||248==t.descIndex||this.showName)this.nameTxt.text=e?e:t.name,this.nameTxt.textColor=ItemConfig.getQualityColor(t);else{var s=isNaN(t.zsLevel)?(t.level||1)+"级":t.zsLevel+"转";this.nameTxt.text=s,-1!=UserBag.fitleEquip.indexOf(t.id)&&(this.nameTxt.text="无级别",this.nameTxt.textColor=ItemConfig.getQualityColor(t))}void 0!=this.num&&this.setCount(this.num+""),i==ItemType.TYPE_12&&(this.redPoint.visible=this.getGuildGift(t))},e.prototype.dataChanged=function(){this.clear();var t=!1;if(this.redPoint.visible=!1,isNaN(this.data)){if(this.data instanceof ItemData){if(this.itemConfig=this.data.itemConfig,!this.itemConfig)return;this.setDataByConfig(this.itemConfig),this.data.count>1?this.setCount(this.data.count+""):this.setCount(""),t=!0}else if(0==this.data.type){this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(this.data.id);var i=1;switch(this.data.id){case MoneyConst.yuanbao:i=5;break;case MoneyConst.gold:i=0;break;case MoneyConst.soul:case MoneyConst.chip:i=2;break;case MoneyConst.piece:i=2,this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[this.data.id];break;case MoneyConst.godweaponExp:i=2}this.isCurrency=!0,this.itemIcon.imgBg.source="quality"+i,this.nameTxt.text=RewardData.getCurrencyName(this.data.id),this.nameTxt.textColor=e.QUALITY_COLOR[i];var s=this.data.count;void 0!=s&&s>1?this.setCount(s+""):this.setCount("")}else if(1==this.data.type){if(this.itemConfig=GlobalConfig.ItemConfig[this.data.id],!this.itemConfig)return;this.setDataByConfig(this.itemConfig);var s=this.data.count;s>1?this.setCount(s+""):this.setCount("")}else if(6==this.data.type){this.itemConfig=GlobalConfig.ItemConfig[this.data.id],this.setDataByConfig(this.itemConfig);var s=this.data.count;void 0!=s&&s>1?this.setCount(s+""):this.setCount("")}}else this.itemConfig=GlobalConfig.ItemConfig[this.data],this.setDataByConfig(this.itemConfig,this.runeName);if(this.redPoint.visible||(this.redPoint.visible=this.data.canbeUsed),this.showEquipEffect(),t&&this.itemConfig)if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_8){var n=!0;this.itemConfig.id==ItemConst.EXP_ITEM&&(n=Actor.level>=65),this.redPoint.visible=this.data&&this.data.count>0&&n,this.itemConfig.id==ItemConst.LEVELUP_ITEM&&(this.redPoint.visible=!0)}else if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_17)this.redPoint.visible=!0;else if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_20)this.redPoint.visible=this.data.canbeUsed;else if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_25)this.redPoint.visible=!0;else if(this.itemConfig.id==GlobalConfig.TeamFuBenBaseConfig.itemId)this.redPoint.visible=!0;else{var o=GlobalConfig.ItemComposeConfig[this.itemConfig.id];o&&o.srcCount<=this.data.count&&(this.redPoint.visible=!0)}this.setSelect(this.selected),this.dataChangeHandler()},e.prototype.dataChangeHandler=function(){},e.prototype.clear=function(){this.itemConfig=null,this.itemIcon&&"function"==typeof this.itemIcon.setData&&this.itemIcon.setData(null),this.count.text="",this.nameTxt.text="",this.nameTxt.textColor=14668213,DisplayUtils.removeFromParent(this.EquipEffect)},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.isShowJob=function(t){this.itemIcon.imgJob.visible=t},e.prototype.onClick=function(){this.showCurrency(),this.showDetail()},e.prototype.getItemType=function(){return this.itemConfig?ItemConfig.getType(this.itemConfig):-1},e.prototype.showCurrency=function(){if(this.isCurrency)switch(this.data.id){case MoneyConst.yuanbao:case MoneyConst.feat:case MoneyConst.godweaponExp:ViewManager.ins().open(ItemCurrencyWin,this.data.id,this.data.count)}},e.prototype.showDetail=function(){if(this.itemConfig){if(this.itemConfig.id==GlobalConfig.TeamFuBenBaseConfig.itemId)return void ViewManager.ins().open(FlowerUseTipsWin);switch(ItemConfig.getType(this.itemConfig)){case ItemType.TYPE_0:case ItemType.TYPE_4:this.openEquipsTips();break;case ItemType.TYPE_5:ViewManager.ins().open(HejiEquipTipsWin,this.data,!1,!0);break;case ItemType.TYPE_1:this.data.handle&&GlobalConfig.ItemComposeConfig[this.itemConfig.id]?ViewManager.ins().open(ItemUseTipsWin,this.data):this.data.handle&&this.itemConfig.id==GlobalConfig.ShenShouConfig.battleCountItem?ViewManager.ins().open(ShenshouDanUseWin,this.itemConfig):this.data.handle&&this.itemConfig.id==Dress.ins().getIdZhuangBanId(this.itemConfig.id)?ViewManager.ins().open(DressTipsWin,this.itemConfig):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_2:this.data.handle?ViewManager.ins().open(ItemUseTipsWin,this.data):this.data.count?ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id);break;case ItemType.TYPE_6:ViewManager.ins().open(RuneTipsWin,0,this.itemConfig.id,this.desc,this.desc2);break;case ItemType.TYPE_9:ViewManager.ins().open(BookTipsWin,this.itemConfig.id,0,this.data.handle);break;case ItemType.TYPE_10:this.data.handle?ViewManager.ins().open(ItemUseTipsWin,this.data):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id);break;case ItemType.TYPE_8:case ItemType.TYPE_20:if(1==this.data.type)ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);else{var t=+this.count.text;this.showSpeicalDetail=!1;for(var e=this.parent;e&&e.parent;)if(e=e.parent,e instanceof BagWin){this.showSpeicalDetail=!0;break}this.showSpeicalDetail?ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:t}):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,t)}break;case ItemType.TYPE_12:this.data.itemConfig&&this.getGuildGift(this.data)?ViewManager.ins().open(ItemUseTipsWin,this.data):ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count},!0);break;case ItemType.TYPE_11:for(var i in GlobalConfig.HeirloomEquipItemConfig){var s=GlobalConfig.HeirloomEquipItemConfig[i];if(s&&s.item==this.itemConfig.id){ViewManager.ins().open(HeirloomEquipTipsWin,null,s.pos-1);break}}break;case ItemType.TYPE_13:case ItemType.TYPE_14:this.data.type==ItemType.TYPE_1?ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count):ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count});break;case ItemType.TYPE_15:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data?this.data.count:void 0);break;case ItemType.TYPE_16:var n=GlobalConfig.GodWingItemConfig[this.itemConfig.id];ViewManager.ins().open(GodWingTipsWin,n);break;case ItemType.TYPE_17:this.showSpeicalDetail=!1;for(var o=this.parent;o&&o.parent;)if(o=o.parent,o instanceof BagWin){this.showSpeicalDetail=!0;break}ViewManager.ins().open(this.showSpeicalDetail?TreasureChuanshiGiftWin:ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_19:ViewManager.ins().open(ExtremeEquipTipsWin,ItemConfig.getSubType(this.itemConfig));break;case ItemType.TYPE_21:ZhanLing.ins().ZhanLingItemTips(this.itemConfig.id);break;case ItemType.TYPE_22:ViewManager.ins().open(ZhanlingZBTipWin,this.itemConfig.id);break;case ItemType.TYPE_23:ViewManager.ins().open(ShenshouEquipTip,0,0,this.itemConfig.id);break;case ItemType.TYPE_24:ViewManager.ins().open(HunguTipsWin,!1,0,this.itemConfig.id);break;case ItemType.TYPE_25:ViewManager.ins().open(ItemUseTipsWin,this.data);break;default:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id)}}},e.prototype.getGuildGift=function(t){var e=0;if(t instanceof ItemConfig)e=t.level;else if(t instanceof ItemData){var i=GlobalConfig.ItemConfig[t._configID];e=i.level}return Actor.level>=e&&0!=Guild.ins().guildID?!0:!1},e.prototype.setCount=function(t){if(t.length>4){var e=Math.floor(Number(t)/1e3);t=e/10+"万"}this.count.text=t},e.prototype.openEquipsTips=function(){var t=ItemConfig.getSubType(this.itemConfig);t>=EquipPos.HAT&&t<=EquipPos.SHIELD?ViewManager.ins().open(SamsaraEquipTips,this.itemConfig.id):ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data)},e.prototype.isShowName=function(t){this.nameTxt.visible=t},e.prototype.getItemSoure=function(){var t="";return t=0==this.data.type?RewardData.getCurrencyRes(this.data.id):this.itemIcon.config.icon+"_png"},e.prototype.getText=function(){return this.nameTxt.text},e.prototype.getTextColor=function(){return this.nameTxt.textColor},e.prototype.showEquipEffect=function(){var t=ItemConfig.getQuality(this.itemConfig);ItemConfig.getType(this.itemConfig);if(this.itemConfig&&!(3>=t)||this.data.id==MoneyConst.yuanbao){var e="";this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.data.id==MoneyConst.yuanbao?(e="quaeff6",this.EquipEffect.x=44,this.EquipEffect.y=32,this.EquipEffect.scaleX=this.EquipEffect.scaleY=1):4==t?(e="quality_05",this.EquipEffect.x=44,this.EquipEffect.y=36):5==t&&(e="chuanqizbeff",this.EquipEffect.x=44,this.EquipEffect.y=36,this.EquipEffect.scaleX=this.EquipEffect.scaleY=1.1),this.addChild(this.EquipEffect),this.EquipEffect.playFile(RES_DIR_EFF+e,-1)}},e.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.EquipEffect),this.EquipEffect=null},e.prototype.HideImgBg=function(){this.itemIcon.imgBg.visible=!1
},e.prototype.showNum=function(t){this.count.visible=t},e.prototype.setImgBg=function(t){this.itemIcon.imgBg.source="quality"+t},e.prototype.getItemIcon=function(){return this.itemIcon},e.prototype.setSelect=function(t){this.isOpenSelectImg&&(this.selectFrame.visible=t)},e.prototype.hideName=function(){this.nameTxt.visible=!1},e.prototype.setName=function(t){this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1(t)},e.prototype.setImgBg1=function(t){this.itemIcon.setImgBg1(t)},e}(BaseItemRender);ItemBase.QUALITY_COLOR=[14868436,3532333,13779707,16741647,15937822,16767295],ItemBase.additionRange=15,__reflect(ItemBase.prototype,"ItemBase");var Actor=function(t){function e(){var e=t.call(this)||this;return e._power=0,e._gold=0,e._yb=0,e._feats=0,e._togeatter1=-1,e._togeatter2=-1,e._weiWang=0,e._chip=0,e.sysId=PackageID.Default,e.regNetMsg(1,e.postInit),e.regNetMsg(7,e.postExp),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postExp=function(t){var e=this._level;this._level=t.readInt(),this._exp=t.readInt();var i=t.readInt();if(e<this._level){this.postLevelChange(),ReportData.getIns().roleUp();var s=EntityManager.ins().getNoDieRole();if(!s)return;var n=new MovieClip;n.playFile(RES_DIR_EFF+"levelUpEffect",1),s.addChild(n)}return i},e.prototype.postInit=function(t){e.handle=t.readDouble(),e.actorID=t.readInt(),GameServer.serverID=t.readInt(),this.postNameChange(t.readUTFBytes(33)),this._level=t.readInt(),this._exp=t.readInt(),t.readDouble(),this.postGoldChange(t.readNumber()),this.postYbChange(t.readNumber()),UserVip.ins().lv=t.readInt(),this.postSoulChange(t.readNumber()),UserBag.ins().bagNum=t.readInt(),this.postFeatsChange(t.readNumber()),e.runeShatter=t.readNumber(),e.runeExchange=t.readNumber(),this.postUpdateTogeatter(t.readNumber(),1),this.postUpdateTogeatter(t.readNumber(),2),this.postWeiWang(t.readInt()),SysSetting.ins().init(),ReportData.getIns().enterGame()},e.prototype.postNameChange=function(t){this._myName!=t&&(this._myName=t)},e.prototype.postGoldChange=function(t){if(this._gold!=t){if(this._gold>0){var e=t-this._gold;if(e>0){var i="|C:0xffd93f&T:金币  +"+e+"|";UserTips.ins().showTips(i)}}this._gold=t}},e.prototype.postYbChange=function(t){if(this._yb!=t){if(this._yb>0){var e=t-this._yb;if(e>0){var i="|C:0xffd93f&T:元宝  +"+e+"|";UserTips.ins().showTips(i)}}this._yb=t}},e.prototype.postFeatsChange=function(t){if(this._feats!=t){if(this._feats>0){var e=t-this._feats,i=parseInt(e.toString());if(i>0){var s="|C:0xffd93f&T:获得"+i+"功勋|";UserTips.ins().showTips(s)}}this._feats=t}},e.prototype.postZsExpChange=function(t){var e="|C:0x00ff00&T:修为+"+t+"|";UserTips.ins().showTips(e)},e.prototype.postUpdateTogeatter=function(t,e){var i=0;if(i=1==e?this._togeatter1:this._togeatter2,i!=t){if(-1!=i){var s=t-i;if(s>0){var n=1==e?RewardData.getCurrencyName(MoneyConst.punch1):RewardData.getCurrencyName(MoneyConst.punch2),o="|C:0xffd93f&T:获得"+s+n+"|";UserTips.ins().showTips(o)}}i=t}return 1==e?this._togeatter1=i:this._togeatter2=i,{value:t,type:e}},e.prototype.postLevelChange=function(){},e.prototype.postSoulChange=function(t){if(this._soul>0){var e=t-this._soul;if(e>0){var i="获得|C:0xd242fb&T:精炼石 x "+e+"|";UserTips.ins().showTips(i)}}this._soul=t},e.prototype.postPowerChange=function(t){this._power!=t&&(this._power<t&&this._power>0&&UserTips.ins().showBoostPower(t,this._power),this._power=t)},e.prototype.postWeiWang=function(t){this._weiWang>0&&t-this._weiWang>0&&UserTips.ins().showTips("|C:0xff00ff&T:获得"+(t-this._weiWang)+RewardData.getCurrencyName(MoneyConst.weiWang)+"|"),this._weiWang=t},e.prototype.postChip=function(t){this._chip>0&&t-this._chip>0&&UserTips.ins().showTips("|C:0xff00ff&T:获得"+(t-this._chip)+RewardData.getCurrencyName(MoneyConst.chip)+"|"),this._chip=t},e.canZhuanSheng=function(){return this.ins()._level>=this.zhuanShengLv},Object.defineProperty(e,"level",{get:function(){return this.ins()._level},enumerable:!0,configurable:!0}),Object.defineProperty(e,"exp",{get:function(){return this.ins()._exp},enumerable:!0,configurable:!0}),Object.defineProperty(e,"power",{get:function(){return this.ins()._power},enumerable:!0,configurable:!0}),Object.defineProperty(e,"myName",{get:function(){return this.ins()._myName},enumerable:!0,configurable:!0}),Object.defineProperty(e,"gold",{get:function(){return this.ins()._gold},enumerable:!0,configurable:!0}),Object.defineProperty(e,"yb",{get:function(){return this.ins()._yb},enumerable:!0,configurable:!0}),Object.defineProperty(e,"soul",{get:function(){return this.ins()._soul},enumerable:!0,configurable:!0}),Object.defineProperty(e,"feats",{get:function(){return this.ins()._feats},enumerable:!0,configurable:!0}),Object.defineProperty(e,"togeatter1",{get:function(){return this.ins()._togeatter1<0?0:this.ins()._togeatter1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"togeatter2",{get:function(){return this.ins()._togeatter2<0?0:this.ins()._togeatter2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"samsaraLv",{get:function(){var t=SamsaraModel.ins().samsaraInfo;return t?t.lv:0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"weiWang",{get:function(){return this.ins()._weiWang},enumerable:!0,configurable:!0}),Object.defineProperty(e,"chip",{get:function(){return this.ins()._chip},enumerable:!0,configurable:!0}),e}(BaseSystem);Actor.zhuanShengLv=80,Actor.runeShatter=0,Actor.runeExchange=0,__reflect(Actor.prototype,"Actor");var GameSystem;!function(t){t.actor=Actor.ins.bind(Actor)}(GameSystem||(GameSystem={}));var UTFMsg=function(){function t(){}return t.prototype.receive=function(t){var e=t.readUTF(),i=this.decode(e);i&&MessageCenter.ins().dispatch(i.key,i.body)},t.prototype.send=function(t,e){var i=this.encode(e);i&&(t.type=egret.WebSocket.TYPE_STRING,t.writeUTF(i))},t.prototype.decode=function(t){return Log.trace("decode需要子类重写，根据项目的协议结构解析"),null},t.prototype.encode=function(t){return Log.trace("encode需要子类重写，根据项目的协议结构解析"),null},t}();__reflect(UTFMsg.prototype,"UTFMsg",["BaseMsg"]);var ZhanLingPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isAutoUp=!1,this.upBtn.label=this.isAutoUp?"取 消":"一键升星",TimerManager.ins().remove(this.checkUpdate,this),TimerManager.ins().remove(this.autoUpStar,this),this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.openView(t)},e.prototype.openView=function(t){this.addTouchEvent(this.detail,this.onEvent),this.addTouchEvent(this.suit,this.onEvent),this.addTouchEvent(this.huanxing,this.onEvent),this.addTouchEvent(this.upBtn,this.onEvent),this.addTouchEvent(this.upBtnEx,this.onEvent),this.addTouchEvent(this.skillIcon0,this.onEvent),this.addTouchEvent(this.huanhua,this.onEvent),this.addTouchEvent(this.btn0,this.onEvent),this.addTouchEvent(this.btn1,this.onEvent),this.addTouchEvent(this.closeBtn,this.onEvent),this.addTouchEvent(this.checkBoxs,this.updateCost),this.addTouchEvent(this.checkBoxs,this.updateModel),this.addTouchEvent(this.icon,this.showIconTips),this.addTouchEvent(this.help,this.onEvent),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this),this.observe(UserBag.ins().postItemAdd,this.timerUpdate),this.observe(UserBag.ins().postItemDel,this.timerUpdate),this.observe(UserBag.ins().postItemCountChange,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingInfo,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingUpExp,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingDrug,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingWear,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingSkinUpGrade,this.timerUpdate),this.observe(ZhanLing.ins().postZhangLingSkinChange,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingUpgrade,this.stopUpGrade),this.observe(ZhanLing.ins().postZhanLingTalentLvUpGrade,this.TanlentLvUpGrade),this.list.itemRenderer=ZhanLingSkinItem,this.list.useVirtualLayout=!1,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.zlId=t[0]||0,this._tick=0,this.postEvent=Math.floor(150/GlobalConfig.ZhanLingConfig.unitTime);for(var e=0;e<GlobalConfig.ZhanLingBase[this.zlId].skill.length;e++)this.addTouchEvent(this["skillIcon"+(e+1)],this.onSkillEvent);for(var i in GlobalConfig.ZhanLingConfig.upgradeInfo){var s=GlobalConfig.ZhanLingConfig.upgradeInfo[i].sort;this.addTouchEvent(this["up"+s],this.onDrugEvent)}this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange),this.isAutoUp=!1,this.roleSelect.hideRole(),this.init(),TimerManager.ins().doTimer(500,0,this.checkUpdate,this)},e.prototype.checkUpdate=function(){var t=this;this._tick&&this._tick<=this.postEvent&&(this._tick=0,TimerManager.ins().doNext(function(){t.updateUI()},this))},e.prototype.timerUpdate=function(){var t=this;this._tick++,this._tick&&this._tick>this.postEvent&&(this._tick=0,TimerManager.ins().doNext(function(){t.updateUI()},this))},e.prototype.init=function(){this.updateUI(!0)},e.prototype.updateState=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=t?t.level:0,i=CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[this.zlId])-1;this.zlId?e>=i?this.currentState="skin_max":this.currentState="skin_up":e>=i?this.currentState="zl_max":this.currentState="zl_up",this.validateNow()},e.prototype.updateUI=function(t){this.updateState(),this.updateTop(t),this.updateItem(),this.updateSkill(),this.updateValue(),this.updateDown(),this.updateCost(),this.updateRedPoint()},e.prototype.updateTop=function(t){if("skin_up"==this.currentState||"skin_max"==this.currentState){if(this.listData.replaceAll(ZhanLingModel.ins().showZLlist),this.list.validateNow(),this.zlId)for(var e=0;e<this.list.numElements;e++){var i=this.list.getVirtualElementAt(e),s=this.list.dataProvider.getItemAt(e);if(s.id==this.zlId){if(i.setSelect(!0),t){var n=0;e>3&&(this.listScroller.stopAnimation(),n=Math.floor((e+1)/4)*i.height),this.setStartPosition(n)}break}}this.onChange(),this.huanhua.visible=ZhanLingModel.ins().getZhanLingDataById(this.zlId)?!0:!1,this.huanhua.icon=ZhanLingModel.ins().ZhanLingSkinId==this.zlId?"zl_quxiao_btn":"zl_huanhua_btn"}var o=GlobalConfig.ZhanLingConfig;for(var a in o.upgradeInfo){var e=o.upgradeInfo[a].sort;this["up"+e]&&(this["up"+e].icon=GlobalConfig.ItemConfig[a].icon+"_png"),this["redPoint"+e]&&(this["redPoint"+e].visible=ZhanLingModel.ins().getZhanLingDataByDrugUse(this.zlId,Number(a))),this["used"+e]&&(this["used"+e].text=ZhanLingModel.ins().getZhanLingDataByDrug(this.zlId,Number(a)))}var r=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);this.lv.data=GlobalConfig.ZhanLingLevel[this.zlId][r].stageDesc,this.model||(this.model=new MovieClip),this.model.parent||this.zhanling.addChild(this.model),this.updateModel()},e.prototype.updateModel=function(){var t,e=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId);if(this.isAutoUp){var i=ZhanLingModel.ins().getZhanLingDataByStage(this.zlId),s=10*i+1;t=GlobalConfig.ZhanLingLevel[this.zlId][s],t?e=s:t=GlobalConfig.ZhanLingLevel[this.zlId][e]}else t=GlobalConfig.ZhanLingLevel[this.zlId][e];this.zhanlingName.source=GlobalConfig.ZhanLingLevel[this.zlId][e].zlName,this.model.name!=RES_DIR_EFF+t.innerAppearance&&this.model.playFile(RES_DIR_EFF+t.innerAppearance,-1)},e.prototype.updateItem=function(){var t=UserBag.ins().getBagGoodsByType(ItemType.TYPE_21);t&&t.sort(this.sort);for(var e=1;e<=GlobalConfig.ZhanLingConfig.equipPosCount;e++){this["item"+e].name=e.toString();var i=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,e);this["item"+e].data={zlId:this.zlId,id:i,equips:t}}},e.prototype.updateSkill=function(){var t=GlobalConfig.ZhanLingBase[this.zlId];if(t){var e=t.talent,i=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId),s=GlobalConfig.ZhanLingTalent[e][i];s||(s=GlobalConfig.ZhanLingTalent[e][1]),s.talentDesc&&s.talentDesc.icon?this.skillIcon0.source=s.talentDesc.icon:s.passive&&(this.skillIcon0.source=1e3*Math.floor(s.passive[0].id/1e3)+"_png");for(var n=0;n<GlobalConfig.ZhanLingBase[this.zlId].skill.length;n++){var o=GlobalConfig.ZhanLingBase[this.zlId].skill[n].id,a=GlobalConfig.ZhanLingSkill[o];a.desc&&a.desc.icon?this["skillIcon"+(n+1)].source=a.desc.icon:this["skillIcon"+(n+1)].source=1e3*Math.floor(a.passive/1e3)+"_png"}this.blackImg0.visible=i?!1:!0;for(var r=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),n=0;n<GlobalConfig.ZhanLingBase[this.zlId].skill.length;n++){var h=GlobalConfig.ZhanLingBase[this.zlId].skill[n];this["blackImg"+(n+1)].visible=h.open>r?!0:!1}}},e.prototype.updateValue=function(){var t=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),e=GlobalConfig.ZhanLingLevel[this.zlId][t];if(e){var i=ZhanLingModel.ins().getZhanLingPower(this.zlId),s=i[0]?i[0]:0;this.powerPanel.setPower(s),i[1].length||(i[1]=this.getEmptyAttrs(this.zlId)),i[2].length||(i[2]=this.getEmptyAttrs(this.zlId,!0));var n=AttributeData.getAttStr(i[1],0,1,"：")+"\n",o=AttributeData.getAttStr(i[2],0,1,"：")+"\n";this.curAtt.text=n,this.nextAtt.text=o}},e.prototype.getEmptyAttrs=function(t,e){var i=[],s=GlobalConfig.ZhanLingLevel[t][0];if(i=ZhanLingModel.ins().addAttrs(i,s.attrs),!e)for(var n=0;n<i.length;n++)i[n].value=0;return i},e.prototype.updateDown=function(t){if(void 0===t&&(t=0),this.zlId){var e=ZhanLingModel.ins().getZhanLingDataById(this.zlId);if(this.starGroup.visible=this.barGroup.visible=e?!0:!1,!e)return}this.starList||(this.starList=new StarList(10),this.starList.horizontalCenter=0),this.starList.parent||this.starGroup.addChild(this.starList);var i=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),s=Math.floor(i%10);if(i){var n=s;n||(s=10)}this.starList.setStarNum(s,t),this.barbc||(this.barbc=new ProgressBarEff,this.barbc.setWidth(525)),this.barbc.parent||this.barGroup.addChild(this.barbc);var o=ZhanLingModel.ins().getZhanLingDataByExp(this.zlId),a=GlobalConfig.ZhanLingLevel[this.zlId][i];a&&(this.barbc.reset(),this.barbc.setData(o,a.exp))},e.prototype.updateCost=function(){var t=this.getCostValue(),e=t[0],i=t[1],s=e>=i?65280:16711680;this.countLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:"+s+"&T:"+e+"|/"+i),this.upBtn.visible=ZhanLingModel.ins().getZhanLingDataById(this.zlId)?!0:!1,this.upBtnEx.visible=!this.upBtn.visible},e.prototype.getCostValue=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=GlobalConfig.ZhanLingBase[this.zlId];if(this.checkBoxs.visible=!0,this.costType=ItemType.TYPE_1,t||!e.mat){var i=0,s=0,n=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),o=GlobalConfig.ZhanLingLevel[this.zlId][n],a=GlobalConfig.ItemConfig[GlobalConfig.ZhanLingConfig.stageitemid];this.icon.source=a.icon+"_png";var r=UserBag.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid);return i=r?r.count:0,s=o.count,this.checkBoxs.selected&&s>i&&(i=Actor.yb,this.icon.source="szyuanbao",s=GlobalConfig.ZhanLingConfig.unitPrice*o.count,this.costType=MoneyConst.yuanbao),this.costCount=s,[i,s]}var h=GlobalConfig.ItemConfig[e.mat];this.icon.source=h.icon+"_png";var l=UserBag.ins().getBagItemById(e.mat),c=l?l.count:0,u=GlobalConfig.ZhanLingTalent[this.zlId][1],p=u.costCount;return this.checkBoxs.visible=!1,this.costType=ItemType.TYPE_22,this.costCount=p,[c,p]},e.prototype.updateRedPoint=function(){for(var t=0;5>t;t++)this["skillRedPoint"+t]&&(this["skillRedPoint"+t].visible=!1);if(this.hhRedPoint.visible=!1,this.upRedPoint.visible=ZhanLingModel.ins().isUpGradeByStar(this.zlId)||ZhanLingModel.ins().isHintNum(this.zlId),this.skillRedPoint0.visible=ZhanLingModel.ins().isUpGradeByTalent(this.zlId),this.hxRedPoint){for(var e=!1,t=0;t<ZhanLingModel.ins().showZLlist.length;t++){var i=ZhanLingModel.ins().showZLlist[t];if(i.id){var s=ZhanLingModel.ins().isUpGradeByStar(i.id)||ZhanLingModel.ins().isHintNum(i.id);if(s){e=!0;break}var n=ZhanLingModel.ins().isUpGradeByTalent(i.id);if(n){e=!0;break}}}this.hxRedPoint.visible=e}},e.prototype.onSoulClick=function(t){if(t&&t.itemRenderer&&t.item)if("zl_up"==this.currentState||"zl_max"==this.currentState){var e=this.getIndexRule();ViewManager.ins().open(ZhanLingPanelEx,e)}else{var i=t.item;this.zlId=i.id,this.updateUI()}},e.prototype.onSkillEvent=function(t){for(var e=0;e<GlobalConfig.ZhanLingBase[this.zlId].skill.length;e++)if(t.currentTarget==this["skillIcon"+(e+1)]){var i=GlobalConfig.ZhanLingBase[this.zlId].skill[e];ViewManager.ins().open(ZhanLingTips,this.zlId,i.id);break}},e.prototype.onDrugEvent=function(t){for(var e in GlobalConfig.ZhanLingConfig.upgradeInfo){var i=GlobalConfig.ZhanLingConfig.upgradeInfo[e].sort;if(t.currentTarget==this["up"+i]){var s=this.getDrugItemByIndex(i);this["redPoint"+i].visible?ZhanLing.ins().sendZhanLingDrug(this.zlId,s):ViewManager.ins().open(ZhanLingItemTips,this.zlId,s)}}},e.prototype.onEvent=function(t){var e=this,i=420,s=0;switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.detail:break;case this.suit:ViewManager.ins().open(ZhanLingSuitTip,this.zlId);break;case this.huanxing:var n=this.getIndexRule();ViewManager.ins().open(ZhanLingPanelEx,n);break;case this.upBtn:this.sendUpGrade();break;case this.upBtnEx:this.upRedPoint.visible?ZhanLing.ins().sendZhanLingSkinUpGrade(this.zlId):UserTips.ins().showTips("|C:0xff0000&T:材料不足");break;case this.skillIcon0:if(this.skillRedPoint0&&this.skillRedPoint0.visible){var o=ZhanLingModel.ins().getZhanLingDataByTalentId(this.zlId),a=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId),r=GlobalConfig.ZhanLingTalent[o][a+1],h=GlobalConfig.ZhanLingBase[this.zlId],l=GlobalConfig.ItemConfig[h.mat],c=WarnWin.show("是否消耗|C:0x00ff00&T:"+l.name+"皮肤*"+r.costCount+"|升级天赋？",null,null,function(){ZhanLing.ins().sendZhanLingSkinUpGrade(e.zlId)},this);c.setBtnLabel("取消","确定")}else ViewManager.ins().open(ZhanLingTips,this.zlId);break;case this.btn0:s=this.list.scrollV-i,s=84*Math.round(s/84),0>s&&(s=0),this.list.scrollV=s,this.onChange();break;case this.btn1:s=this.list.scrollV+i,s=84*Math.round(s/84),s>this.list.contentHeight-this.listScroller.height&&(s=this.list.contentHeight-this.listScroller.height),this.list.scrollH=s,this.onChange();break;case this.huanhua:if(!ZhanLingModel.ins().getZhanLingDataById(this.zlId))return void UserTips.ins().showTips("|C:0xff0000&T:皮肤未激活");var u=this.zlId;ZhanLingModel.ins().ZhanLingSkinId==u&&(u=0),ZhanLing.ins().sendZhangLingSkinChange(u);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[35].text)}},e.prototype.sendUpGrade=function(){if(this.isAutoUp=!this.isAutoUp,this.isAutoUp){if(!this.checkUpStar())return void(this.isAutoUp=!1);this.updateModel(),TimerManager.ins().doTimer(GlobalConfig.ZhanLingConfig.unitTime,0,this.autoUpStar,this)}else TimerManager.ins().remove(this.autoUpStar,this);this.upBtn.label=this.isAutoUp?"取 消":"一键升星"},e.prototype.stopUpGrade=function(){this.isAutoUp=!1,TimerManager.ins().remove(this.autoUpStar,this),this.upBtn.label=this.isAutoUp?"取 消":"一键升星",this.updateDown(1),this.updateModel();var t=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),e=GlobalConfig.ZhanLingLevel[this.zlId][t];e.activeLv&&this.isTopLevel&&Activationtongyong.show(0,e.zlNameLabel,"",!0,null,"",e.innerAppearance)},e.prototype.TanlentLvUpGrade=function(){var t=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId),e=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),i=GlobalConfig.ZhanLingLevel[this.zlId][e];i&&t&&1!=t&&this.isTopLevel&&Activationtongyong.show(1,t+"级天赋","",!0,null,"",i.innerAppearance)},e.prototype.showIconTips=function(){var t=MoneyConst.yuanbao;switch(this.costType){case MoneyConst.yuanbao:ViewManager.ins().open(ItemCurrencyWin,t,this.costCount);break;case ItemType.TYPE_1:t=GlobalConfig.ZhanLingConfig.stageitemid,ViewManager.ins().open(ItemDetailedWin,0,t,this.costCount);break;case ItemType.TYPE_22:t=GlobalConfig.ZhanLingBase[this.zlId].mat,ViewManager.ins().open(ZhanlingZBTipWin,t)}},e.prototype.autoUpStar=function(){if(this.isAutoUp){var t=this.checkBoxs.selected?1:0;if(!this._tick&&!this.checkUpStar())return this.isAutoUp=!1,void TimerManager.ins().remove(this.autoUpStar,this);ZhanLing.ins().sendZhanLingUpExp(this.zlId,t)}},e.prototype.checkUpStar=function(){if("skin_max"==this.currentState||"zl_max"==this.currentState)return UserTips.ins().showTips("|C:0xff0000&T:已满级"),this.upBtn.label="一键升星",!1;if(!ZhanLingModel.ins().getZhanLingDataById(this.zlId))return UserTips.ins().showTips("|C:0xff0000&T:皮肤未激活"),this.upBtn.label="一键升星",!1;var t=this.checkBoxs.selected?1:0,e=this.getCostValue(),i=e[0],s=e[1];if(!i||s>i){if(!t)return UserTips.ins().showTips("|C:0xff0000&T:战灵进阶丹不足,可勾选自动购买升级"),this.upBtn.label="一键升星",!1;if(i=Actor.yb,s=GlobalConfig.ZhanLingConfig.unitPrice*s,!i||s>i)return UserTips.ins().showTips("|C:0xff0000&T:元宝不足"),this.upBtn.label="一键升星",!1}return this.upBtn.label="取 消",!0},e.prototype.sort=function(t,e){var i=GlobalConfig.ZhanLingEquip[t.configID],s=GlobalConfig.ZhanLingEquip[e.configID];return i.level>s.level?-1:1},e.prototype.getIndexRule=function(){var t=0;ZhanLingModel.ins().updateShowZLlist(),t=ZhanLingModel.ins().showZLlist[0].id;for(var e=0;e<ZhanLingModel.ins().showZLlist.length;e++){var i=ZhanLingModel.ins().isUpGradeByStar(ZhanLingModel.ins().showZLlist[e].id),s=ZhanLingModel.ins().isUpGradeByTalent(ZhanLingModel.ins().showZLlist[e].id);if(i||s){t=ZhanLingModel.ins().showZLlist[e].id;break}var n=ZhanLingModel.ins().getZhanLingDataByLevel(ZhanLingModel.ins().showZLlist[e].id);n||(ZhanLingModel.ins().getZhanLingDataById(GlobalConfig.ZhanLingBase[t].id)?t=ZhanLingModel.ins().showZLlist[e].id:GlobalConfig.ZhanLingBase[t].sort>GlobalConfig.ZhanLingBase[ZhanLingModel.ins().showZLlist[e].id].sort&&(t=ZhanLingModel.ins().showZLlist[e].id))}return t},e.prototype.onChange=function(){this.list.scrollV<39?(this.btn0.visible=!1,this.btn1.visible=!0):this.list.scrollV>=this.list.contentHeight-this.list.height-39?(this.btn0.visible=!0,this.btn1.visible=!1):(this.btn0.visible=!0,this.btn1.visible=!0),this.list.numElements<=4&&(this.btn0.visible=this.btn1.visible=!1),this.rightRed0.visible=this.btn0.visible?this.hxRedPoint.visible:!1,this.rightRed1.visible=this.btn1.visible?this.hxRedPoint.visible:!1},e.prototype.setStartPosition=function(t){if(this.listScroller.height>=this.list.contentHeight)t=0;else{var e=this.list.contentHeight-this.listScroller.height;e=e>0?e:0,t>=e&&(t=e)}this.list.scrollV=t},e.prototype.getDrugItemByIndex=function(t){var e=0,i=GlobalConfig.ZhanLingConfig;for(var s in i.upgradeInfo){var n=i.upgradeInfo[s].sort;if(n==t){e=Number(s);break}}return e},e}(BaseEuiView);__reflect(ZhanLingPanel.prototype,"ZhanLingPanel");var BaseScene=function(){function t(){this._layers=new Array}return t.prototype.onEnter=function(){},t.prototype.onExit=function(){ViewManager.ins().closeAll(),this.removeAllLayer()},t.prototype.addLayer=function(t){t instanceof BaseSpriteLayer?(StageUtils.ins().getStage().addChild(t),this._layers.push(t)):t instanceof BaseEuiLayer&&(StageUtils.ins().getUIStage().addChild(t),this._layers.push(t))},t.prototype.addLayerAt=function(t,e){t instanceof BaseSpriteLayer?(StageUtils.ins().getStage().addChildAt(t,e),this._layers.push(t)):t instanceof BaseEuiLayer&&(StageUtils.ins().getUIStage().addChildAt(t,e),this._layers.push(t))},t.prototype.removeLayer=function(t){t instanceof BaseSpriteLayer?(StageUtils.ins().getStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1)):t instanceof BaseEuiLayer&&(StageUtils.ins().getUIStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1))},t.prototype.layerRemoveAllChild=function(t){t instanceof BaseSpriteLayer?t.removeChildren():t instanceof BaseEuiLayer&&t.removeChildren()},t.prototype.removeAllLayer=function(){for(;this._layers.length;){var t=this._layers[0];this.layerRemoveAllChild(t),this.removeLayer(t)}},t}();__reflect(BaseScene.prototype,"BaseScene");var CharNpc=function(t){function e(){var e=t.call(this)||this;return e.npcHead=new MineNpcHead,e.npcHead.anchorOffsetY=90,e.npcHead.anchorOffsetX=100,e.npcHead.currentState=e.npcHead.states[0],e.titleCantainer.addChild(e.npcHead),e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.playCount=function(){return this._state==EntityAction.RUN||this._state==EntityAction.STAND?-1:1},e.prototype.updateModel=function(){var t=this.infoModel.npcConfig;this.npcHead.nameTxt.text=t.name,this.npcHead.updateModel(this.infoModel),this.x=this.infoModel.x,this.y=this.infoModel.y,this.setConfig(this.infoModel.avatarString),this.dir=this.infoModel.dir,this.playAction(t.action||EntityAction.STAND),this.addMc(CharMcOrder.BODY,this.infoModel.avatarFileName),this.infoModel.weaponFileName&&this.addMc(CharMcOrder.WEAPON,this.infoModel.weaponFileName)},e}(CharEffect);__reflect(CharNpc.prototype,"CharNpc");var LayerManager=function(){function t(){}return t}();LayerManager.Game_Bg=new BaseEuiLayer,LayerManager.Game_Main=new BaseEuiLayer,LayerManager.Main_View=new BaseEuiLayer,LayerManager.UI_Main=new BaseEuiLayer,LayerManager.UI_Main2=new BaseEuiLayer,LayerManager.UI_Popup=new BaseEuiLayer,LayerManager.UI_Message=new BaseEuiLayer,LayerManager.UI_Tips=new BaseEuiLayer,__reflect(LayerManager.prototype,"LayerManager");var BaseSound=function(){function t(){this._cache={},this._loadingCache=new Array,TimerManager.ins().doTimer(6e4,0,this.dealSoundTimer,this)}return t.prototype.dealSoundTimer=function(){for(var t=egret.getTimer(),e=Object.keys(this._cache),i=0,s=e.length;s>i;i++){var n=e[i];this.checkCanClear(n)&&t-this._cache[n]>=SoundManager.CLEAR_TIME&&(delete this._cache[n],RES.destroyRes(n))}},t.prototype.getSound=function(t){var e=RES.getRes(t);if(e)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),RES.getResAsync(t,this.onResourceLoadComplete,this)}return e},t.prototype.onResourceLoadComplete=function(t,e){var i=this._loadingCache.indexOf(e);-1!=i&&(this._loadingCache.splice(i,1),this._cache[e]=egret.getTimer(),this.loadedPlay(e))},t.prototype.loadedPlay=function(t){},t.prototype.checkCanClear=function(t){return!0},t}();__reflect(BaseSound.prototype,"BaseSound");var FilterUtil=function(){function t(){}return Object.defineProperty(t,"grayFilter",{get:function(){return new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"grayFilter1",{get:function(){return new egret.ColorMatrixFilter([.3086,.5,.082,0,0,.3086,.5,.082,0,0,.3086,.5,.082,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ARRAY_GRAY_FILTER",{get:function(){return[t.grayFilter1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"greenFilter",{get:function(){return new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,100,0,0,1,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"greenFilter1",{get:function(){return new egret.ColorMatrixFilter([.1,0,0,0,0,0,.80078125,0,0,20,0,0,-1,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ARRAY_GREEN_FILTER",{get:function(){return[t.greenFilter1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"blurFilter",{get:function(){return new egret.BlurFilter(10,10,2)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ARRAY_BLUR_FILTER",{get:function(){return[t.blurFilter]},enumerable:!0,configurable:!0}),t}();__reflect(FilterUtil.prototype,"FilterUtil");var ActivityType1Data=function(t){function e(e){var i=t.call(this,e)||this;return i.rewardsSum=[],i.hFTotalConsumption=0,i.readReawards(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.record=e.readInt()},e.prototype.readReawards=function(t){this.record=t.readInt(),this.hFTotalConsumption=t.readInt();for(var e=t.readShort(),i=1;e>=i;i++)this.rewardsSum[i]=t.readShort()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:void 0},e.prototype.getConfig=function(){var t;return t=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType1Config:GlobalConfig.ActivityType1Config},e.prototype.getIns=function(){var t;return t=this.activityType==ActivityType.Personal?PActivity.ins():Activity.ins()},e.prototype.getRewardStateById=function(t){var e=this.getConfig()[this.id][t];switch(e.showType){case ShowType.LEVEL:if(Actor.level<e.level||UserZs.ins().lv<e.zslevel)return Activity.NotReached;break;case ShowType.WING:if(WingsData.getWingAllLevel()<e.wingLv)return Activity.NotReached;break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)<e.zzLv)return Activity.NotReached;break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()<e.lhLv)return Activity.NotReached;break;case ShowType.BOOK:var i=Book.ins().getBookPowerNumEx();if(i<e.tjPower)return Activity.NotReached;break;case ShowType.EQUIP:if(UserBag.ins().getEquipsScoreByRolesOfBody()<e.equipPower)return Activity.NotReached;break;case ShowType.XIAOFEI:var s=this.getIns().getActivityDataById(e.Id);if(s.hFTotalConsumption<e.consumeYuanbao)return Activity.NotReached;break;case ShowType.RING:var n=0,o=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(o&&o.level&&(n=o.level),n<e.huoyanRingLv)return Activity.NotReached;break;case ShowType.SAMSARA:if(Actor.samsaraLv<e.lunhLv)return Activity.NotReached;break;case ShowType.ZHANLING:if(ZhanLingModel.ins().getZhanLingDataByLevel(0)<e.zhanlingLv)return Activity.NotReached}var a=Math.floor(this.record/Math.pow(2,e.index))%2;return a?Activity.Geted:Activity.CanGet},e.prototype.checkRedPoint=function(){var t=this.getConfig()[this.id];for(var e in t){var i=t[e],s=this.getRewardStateById(i.index),n=this.rewardsSum[i.index],o=i.total?i.total-n:1;switch(s){case Activity.NotReached:break;case Activity.CanGet:if(o>0)return!0;break;case Activity.Geted:}}return!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;var t=this.record>>1,e=this.getConfig()[this.id],i=Object.keys(e);return t>=Math.pow(2,i.length)-1?(this.isHide=!0,this.isHide):(this.isHide=!1,this.isHide)},e}(ActivityBaseData);__reflect(ActivityType1Data.prototype,"ActivityType1Data");var ShowType;!function(t){t[t.LEVEL=0]="LEVEL",t[t.WING=1]="WING",t[t.ZHUZAO=2]="ZHUZAO",t[t.LONGHUN=3]="LONGHUN",t[t.BOOK=5]="BOOK",t[t.EQUIP=6]="EQUIP",t[t.RING=7]="RING",t[t.SAMSARA=8]="SAMSARA",t[t.ZHANLING=9]="ZHANLING",t[t.XIAOFEI=100]="XIAOFEI"}(ShowType||(ShowType={}));var ActivityType9Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.getIns=function(){var t;return t=this.activityType==ActivityType.Personal?PActivity.ins():Activity.ins()},e.prototype.update=function(t){this.record=t.readInt(),this.count=t.readInt();var e=t.readByte();this.indexs=[];for(var i=0;e>i;i++)this.indexs.push(t.readByte());e=t.readByte(),this.noticeArr=[];for(var i=0;e>i;i++)this.noticeArr.push({name:t.readString(),index:t.readByte()});this.noticeArr.reverse()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return this.getIns().getType9RedPoint(this.id)},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getLastTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3);
return e},e.prototype.getStateByIndex=function(t){var e=this.record>>t&1;return e},e}(ActivityBaseData);__reflect(ActivityType9Data.prototype,"ActivityType9Data");var ActivityPanel=function(t){function e(){var e=t.call(this)||this;return e._activityBtnType=-1,e.activityType=ActivityType.Normal,e}return __extends(e,t),Object.defineProperty(e.prototype,"activityBtnType",{get:function(){return this._activityBtnType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t;var e,i;this.activityType==ActivityType.Normal?(e=GlobalConfig.ActivityConfig[t],i=GlobalConfig.ActivityBtnConfig[t]):this.activityType==ActivityType.Personal&&(e=GlobalConfig.PActivityConfig[t],i=GlobalConfig.PActivityBtnConfig[t]),e&&e.tabName&&(this.name=e.tabName),this._activityBtnType=i.type},enumerable:!0,configurable:!0}),e.create=function(t,e){var i;if(i=e==ActivityType.Normal?GlobalConfig.ActivityConfig[t]:GlobalConfig.PActivityConfig[t],t>1e4){var s=ObjectPool.pop("OSATarget0Panel");return s.activityType=e,s.activityID=t,s}var n;return 1==i.activityType?(n=ObjectPool.pop("OSATarget"+i.activityType+"Panel",t),n.activityType=e,n.activityID=t):(n=ObjectPool.pop("OSATarget"+i.activityType+"Panel"),n.activityType=e,n.activityID=t),n},e.prototype.updateData=function(){},e.getActivityTypeFromId=function(t){var e;return GlobalConfig.ActivityBtnConfig[t]?e=GlobalConfig.ActivityBtnConfig[t]:GlobalConfig.PActivityBtnConfig[t]&&(e=GlobalConfig.PActivityBtnConfig[t]),e?e.activityType:ActivityType.Normal},e}(BaseView);__reflect(ActivityPanel.prototype,"ActivityPanel");var Auction=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Auction,e.regNetMsg(1,e.postListData),e.regNetMsg(2,e.onOpenSuccess),e.regNetMsg(4,e.postAuctionResult),e.regNetMsg(5,e.postBuyResult),e.regNetMsg(6,e.postRecord),e.regNetMsg(7,e.noLimit),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendGetList(0),this.sendGetList(1)},e.prototype.sendGetList=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.postListData=function(t){for(var e=t.readByte(),i=t.readInt(),s=[],n=0;i>n;n++)s.push(new AuctionVo(t));s.length>=2&&s.sort(this.sort),0==e?this.auGuildDatas=s:this.auServerDatas=s},e.prototype.sort=function(t,e){return t.putAwayTime>e.putAwayTime?-1:t.putAwayTime<e.putAwayTime?1:0},e.prototype.sortByAuTime=function(t,e){return t.time>e.time?-1:t.time<e.time?1:0},e.prototype.sendOpenAuBox=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.onOpenSuccess=function(t){ViewManager.ins().open(AuctionItemChoiceWin,t.readInt(),t.readInt())},e.prototype.sendUseAuBox=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendAUction=function(t,e,i){var s=this.getBytes(4);s.writeInt(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.postAuctionResult=function(t){var e=t.readByte();switch(e){case 0:case 1:case 2:var i=new AuctionVo(t),s=this.getVoByID(i.id);1==e?(this.deleteVo(s),UserTips.ins().showTips("物品不存在")):(this.dateChanged(s,i),UserTips.ins().showTips(0==e?"竞拍成功":"商品信息已改变"));break;case 3:UserTips.ins().showTips("还在展示时间");break;case 4:UserTips.ins().showTips("活跃额度不足")}},e.prototype.deleteVo=function(t){if(this.auGuildDatas){var e=this.auGuildDatas.indexOf(t);if(e>=0)return void this.auGuildDatas.splice(e,1)}if(this.auServerDatas){var e=this.auServerDatas.indexOf(t);e>=0&&this.auServerDatas.splice(e,1)}},e.prototype.postUpdate=function(){},e.prototype.getVoByID=function(t){return this.getVo(t,this.auGuildDatas)||this.getVo(t,this.auServerDatas)},e.prototype.getVo=function(t,e){if(!e||e.length<=0)return null;for(var i=e.length,s=0;i>s;s++)if(e[s].id==t)return e[s];return null},e.prototype.sendBuy=function(t,e){var i=this.getBytes(5);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postBuyResult=function(t){var e=t.readByte();switch(e){case 0:case 1:case 2:var i=new AuctionVo(t),s=this.getVoByID(i.id);2!=e?(this.deleteVo(s),UserTips.ins().showTips(1==e?"物品不存在":"购买成功")):(this.dateChanged(s,i),UserTips.ins().showTips("商品信息已改变"));break;case 3:UserTips.ins().showTips("还在展示时间");break;case 4:UserTips.ins().showTips("活跃额度不足")}},e.prototype.dateChanged=function(t,e){t.type!=e.type?(this.deleteVo(t),0==e.type?(this.auGuildDatas.push(e),this.auGuildDatas.length>=2&&this.auGuildDatas.sort(this.sort)):(this.auServerDatas.push(e),this.auServerDatas.length>=2&&this.auServerDatas.sort(this.sort))):(t.putAwayTime=e.putAwayTime,t.endTime=e.endTime,t.myAuPrice=e.myAuPrice,t.auctionTimes=e.auctionTimes,t.aID=e.aID)},e.prototype.getMaxPageByType=function(t,e){var i=t?this.auServerDatas:this.auGuildDatas;return i&&i.length?Math.ceil(i.length/e):1},e.prototype.getDataByPage=function(t,e,i){var s=t?this.auServerDatas:this.auGuildDatas;if(!s||!s.length)return null;var n=(e-1)*i;return s.slice(n,n+i)},e.prototype.isAuctionOpen=function(){return UserZs.ins().lv>=GlobalConfig.AuctionConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.AuctionConfig.openserverday},e.prototype.sendRecord=function(t){var e=this.getBytes(6);e.writeByte(t),this.sendToServer(e)},e.prototype.postRecord=function(t){for(var e,i=t.readByte(),s=t.readShort(),n=[],o=0;s>o;o++)e=new AuctionRecordVo(t),e.type=i,n.push(e);return n.length>1&&n.sort(this.sortByAuTime),{type:i,list:n}},e.prototype.noLimit=function(t){ViewManager.ins().open(AuctionQuotaTipWin,t.readInt(),t.readInt())},e.prototype.checkRed=function(){return this.checkRedByType(0)||this.checkRedByType(1)},e.prototype.checkRedByType=function(t){var e=t?this.auServerDatas:this.auGuildDatas;return e&&e.length>0},e}(BaseSystem);__reflect(Auction.prototype,"Auction");var GameSystem;!function(t){t.auction=Auction.ins.bind(Auction)}(GameSystem||(GameSystem={}));var Book=function(t){function e(){var e=t.call(this)||this;return e.bookPower=0,e.score=-1,e.sysId=PackageID.Book,e.regNetMsg(1,e.postDataChange),e.listBook={},e.itemBook={},e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getSuitIdByBookId=function(t){var e=GlobalConfig.CardConfig[t][0];if(!e)return 0;for(var i in GlobalConfig.SuitConfig)if(-1!=GlobalConfig.SuitConfig[i][1].idList.indexOf(t))return Number(i);return 0},e.prototype.getSuitNum=function(t){for(var e=GlobalConfig.SuitConfig[t][1],i=0,s=0;s<e.idList.length;s++){var n=this.getBookById(e.idList[s]);n.level>-1&&i++}return i},e.prototype.getSuitLevel=function(t){for(var e=this.getSuitNum(t),i=0,s=1;GlobalConfig.SuitConfig[t][s];)GlobalConfig.SuitConfig[t][s].count<=e&&(i=GlobalConfig.SuitConfig[t][s].level),s++;return i},e.prototype.getBookRed=function(){for(var t in GlobalConfig.BookListConfig)for(var e=GlobalConfig.BookListConfig[t].idList,i=0,s=e;i<s.length;i++)for(var n=s[i],o=GlobalConfig.SuitConfig[n][1].idList,a=0,r=o;a<r.length;a++){var h=r[a];if(this.getBookById(h).getState()==BookState.canOpen)return!0}return!1},e.prototype.getBookUpRed=function(){for(var t in GlobalConfig.BookListConfig)for(var e=GlobalConfig.BookListConfig[t].idList,i=0,s=e;i<s.length;i++){var n=s[i];if(this.getBookUpRedByListId(n))return!0}return!1},e.prototype.getBookUpRedByListId=function(t){for(var e=GlobalConfig.SuitConfig[t][1].idList,i=0,s=e;i<s.length;i++){var n=s[i],o=this.getBookById(n),a=o.getNextLevelCost();if(a&&this.score>=a)return!0}},e.prototype.getBookRedById=function(t){return this.getBookById(t).getState()==BookState.canOpen?!0:!1},e.prototype.getBookById=function(t){if(!this.listBook[t]){var e=new BooKData;this.listBook[t]=e,e.id=t}return this.listBook[t]},e.prototype.getBookByItemId=function(t){return this.itemBook[t]||(this.itemBook[t]=[]),this.itemBook[t]},e.prototype.getBookPown=function(){var t=GlobalConfig.CardConfig,i=0;for(var s in this.listBook){var n=this.listBook[s];if(n.level>-1){var o=t[s][n.level];i+=Math.floor(UserBag.getAttrPower(o.attrs))}}var a=[];for(var r in GlobalConfig.BookListConfig){var h=GlobalConfig.BookListConfig[r],l=e.ins().getSuitNum(h.idList[0]);for(var c in GlobalConfig.SuitConfig[h.idList[0]]){var u=GlobalConfig.SuitConfig[h.idList[0]][c];if(!(l>=u.count)){i+=Math.floor(UserBag.getAttrPower(a)),a=[];break}a=u.attrs}a.length>0&&(i+=Math.floor(UserBag.getAttrPower(a)))}return i},e.prototype.getBookPowerNum=function(t,i){var s=SubRoles.ins().subRolesLen;if(i)for(var n in GlobalConfig.SuitConfig)if(-1!=e.jobs.indexOf(Number(n))&&-1!=GlobalConfig.SuitConfig[n][1].idList.indexOf(i)){s=1;break}return t*s},e.prototype.getBookPowerNumEx=function(){return this.bookPower},e.prototype.getUpChipData=function(t){var i=[],s=GlobalConfig.CardConfig,n=s[t.id],o=0;for(var a in n)n[a].level>t.level&&(o+=n[a].cost);var r=GlobalConfig.DecomposeConfig,h=o-t.exp,l=0;for(var a in this.listBook){var c=s[a][1],u=UserBag.ins().getBagGoodsCountById(0,c.itemId),p=r[t.id],d=this.listBook[a];if(d.level>-1&&u>0)for(var g=0;u>g&&!(l>h);g++)if(l+=p.value,i.push(+a),i.length>=12)return i}return i.sort(e.sort),i},e.sort=function(t,e){if(t==e)return 0;var i=GlobalConfig.DecomposeConfig[t],s=GlobalConfig.DecomposeConfig[e];return i.value>s.value?1:i.value<s.value?-1:0},e.prototype.getTitleById=function(t){var e=GlobalConfig.BookListConfig;for(var i in e)if(-1!=e[i].idList.indexOf(t))return e[i].name;return""},e.prototype.getListData=function(){return this.listBook},e.prototype.sendBookData=function(){var t=this.getBytes(1);this.sendToServer(t)},e.prototype.postDataChange=function(t){if(-1==this.score){var e=GlobalConfig.DecomposeConfig;for(var i in e){var s=this.getBookById(+i);this.getBookByItemId(e[i].itemId).push(s)}}for(var n=t.readInt(),o=0;n>o;o++){var i=t.readShort(),s=this.getBookById(i);s.updateData(t)}var a=t.readInt();if(this.score>-1){var r=a-this.score;r>0&&UserTips.ins().showTips("获得|C:0xff700f&T:图鉴经验x"+r+"|")}this.score=a,this.bookPower=t.readDouble()},e.prototype.sendOpen=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.sendDecompose=function(t){var e=this.getBytes(3);e.writeInt(t.length);for(var i=0;i<t.length;i++)e.writeShort(t[i][0]),e.writeShort(t[i][1]);this.sendToServer(e)},e.prototype.sendUp=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.getDecomposeConfigByItemId=function(t){var e=GlobalConfig.DecomposeConfig;if(!this.itemBook[t])return Assert(!1,"图鉴数据未初始化,id="+t+",itemBook keys length="+Object.keys(this.itemBook).length),null;if(this.itemBook[t][0]){var i=this.itemBook[t][0].id;return e[i]}return null},e.prototype.checkResolveRedPoint=function(){var t=UserBag.ins().getBagGoodsByType(ItemType.TYPE_9);if(!t.length)return!1;var e=this.itemBook,i={};for(var s in e)for(var n=0,o=e[s];n<o.length;n++){var a=o[n];if(a.getState()!=BookState.haveOpen){i[s]=!0;break}}for(var r=0,h=t;r<h.length;r++){var a=h[r];if(!i[a.configID])return!0}return!1},e.prototype.getSuitRedPoint=function(t){var i=this,s=GlobalConfig.SuitConfig,n=UserBag.ins().getBagGoodsByType(ItemType.TYPE_9);if(0==n.length)return!1;for(var o={},a=0,r=n;a<r.length;a++){var h=r[a];o[h.configID]=!0}var l=function(t){for(var n=s[t][1],a=n.idList,r=0,h=a;r<h.length;r++){var l=h[r];if(i.listBook[l]&&-1==i.listBook[l].level){var c=e.jobs.indexOf(n.id);if(-1==c){var u=GlobalConfig.DecomposeConfig[l];if(o[u.itemId])return!0}else{for(var p=!1,d=0;d<SubRoles.ins().subRolesLen;d++){var g=SubRoles.ins().getSubRoleByIndex(d);if(g.job==c+1){p=!0;break}}if(!p)continue;var f=GlobalConfig.CardConfig[l][0];if(f&&o[f.itemId])return!0}}}return!1};if(0!=t)return l(t);for(var c in s)if(l(c))return!0;return!1},e.prototype.getHaveBookSuit=function(t){var e=UserBag.ins().getBagGoodsByType(ItemType.TYPE_9),i=GlobalConfig.SuitConfig[t][1];return 0==e.length?{ishave:!1,cur:0,target:i.idList.length}:void 0},e}(BaseSystem);Book.jobs=[6,7,8],__reflect(Book.prototype,"Book");var GameSystem;!function(t){t.book=Book.ins.bind(Book)}(GameSystem||(GameSystem={}));var WorldBossRankItemData=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.roleName=t.readString(),this.value=t.readDouble()},t.prototype.parser1=function(t){this.roleName=t.readString(),this.value=t.readInt()},Object.defineProperty(t.prototype,"name",{get:function(){var t=this.roleName+":"+CommonUtils.overLength(this.value);return t},enumerable:!0,configurable:!0}),t}();__reflect(WorldBossRankItemData.prototype,"WorldBossRankItemData");var WorldBossHeadRender=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isAddEff=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.haveGuildName(!1),this.isAddEff=!1,this.data instanceof CharMonster)this.currentState="war",this.updateChar(this.data);else if(isNaN(this.data))this.data instanceof SelectInfoData&&(this.currentState="panel",this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+"份"),this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name),this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex);else if(this.currentState="war",this.data){var t=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);if(t)this.updateChar(t);else if(KFBossSys.ins().isKFBossBattle&&KFBossSys.ins().flagHandle==this.data){var e=GlobalConfig.MonstersConfig[GlobalConfig.CrossBossBase.flagId];if(e&&this.checkMonHead(e)){var i=KFBossSys.ins().flagCD-egret.getTimer(),s=DateUtils.getFormatBySecond(i/1e3);0>=i?(s="",this.haveGuildName(!1)):this.haveGuildName(!0);var n=e.name+"\n|C:"+ColorUtil.RED+"&T:"+s+"|";this.roleName.textFlow=TextFlowMaker.generateTextFlow1(n),this.roleHead.source="monhead"+e.head+"_png",this.addAttEffect()}}else if(KfArenaSys.ins().isKFArena&&KfArenaSys.ins().flagHandle==this.data){var e=GlobalConfig.MonstersConfig[GlobalConfig.CrossArenaBase.flagBossId];if(e&&this.checkMonHead(e)){var i=KfArenaSys.ins().flagCD-egret.getTimer(),s=DateUtils.getFormatBySecond(i/1e3);0>=i?(s="",this.haveGuildName(!1)):this.haveGuildName(!0);var n=e.name+"\n|C:"+ColorUtil.RED+"&T:"+s+"|";this.roleName.textFlow=TextFlowMaker.generateTextFlow1(n),this.roleHead.source="monhead"+e.head+"_png",this.addAttEffect()}}}else{var o=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];o&&this.checkMonHead(o)&&(this.roleName.textFlow=(new egret.HtmlTextParser).parser(o.name),this.roleHead.source="monhead"+o.head+"_png",this.addAttEffect())}this.isAddEff||this.removeAttEffect()},e.prototype.checkMonHead=function(t){return Assert(t.head,"怪物头像不存在，id:"+t.id+",name:"+t.name)?!1:!0},e.prototype.updateChar=function(t){if(t instanceof CharRole){var e=t.infoModel;if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){var i=e.name;if(e.type==EntityType.LadderPlayer){var s=i.split("\n");i=s[1]?s[1]:s[0],i=StringUtils.replaceStr(i,"0xffffff",this.roleName.textColor+"")}this.roleName.textFlow=TextFlowMaker.generateTextFlow1(i)}else{var n=e.guildName?"\n<font color='#6495ed'>"+e.guildName+"</font>":"",o=DevildomSys.ins().isDevildomBattle&&n?e.name+n:e.getNameWithServer2();o.indexOf("\n")>-1&&this.haveGuildName(!0),this.roleName.textFlow=(new egret.HtmlTextParser).parser(o)}if(Assert(e.job,"任务职业不存在，id:"+e.configID+",name:"+e.name))return;this.roleHead.source="yuanhead"+e.job+e.sex,this.checkIsCurrAttack(e.handle)&&this.addAttEffect()}else{var a=t;if(a.infoModel.type==EntityType.Monster||KFBossSys.ins().isKFBossBattle&&a.infoModel.type==EntityType.CollectionMonst){var r=GlobalConfig.MonstersConfig[a.infoModel.configID];if(Assert(r,"怪物配置找不到 id:"+a.infoModel.configID))return;if(!this.checkMonHead(r))return;this.roleName.textFlow=(new egret.HtmlTextParser).parser(r.name),this.roleHead.source="monhead"+r.head+"_png",this.checkIsCurrAttack(a.infoModel.handle)&&this.addAttEffect()}}},e.prototype.checkIsCurrAttack=function(t){var e=EntityManager.ins().getRootMasterHandle(GameLogic.ins().currAttackHandle);return e==EntityManager.ins().getRootMasterHandle(t)},e.prototype.addAttEffect=function(){t.prototype.addAttEffect.call(this),this.isAddEff=!0},e}(GuildWarMemberHeadRender);__reflect(WorldBossHeadRender.prototype,"WorldBossHeadRender");var ChatDataBase=function(){function t(){}return t}();__reflect(ChatDataBase.prototype,"ChatDataBase");var UserFb=function(t){function e(){var e=t.call(this)||this;return e.fbModel={},e._groupID=1,e._guanqiaID=-1,e.rewards=[],e.eliteRewards=[],e.maxLen=0,e.guanqiaReward=0,e.worldReward=0,e.worldGuanQias=[],e.worldGuanQiaHasReceive=[],e.currentEnergy=0,e.canChallengGuanQia=!0,e.encounterPos=[],e.expMonterCount=0,e.expMonterCountKill=0,e.isQuite=!0,e.guideBossKill=0,e.showAni=!0,e.showAutoPk=-1,e.showAutoPk2=-1,e.firstAutoGuilder=!1,e.fbExpTotal=0,e.tfRoomID=0,e.tfPassID=0,e._tfInviteTime=0,e.showTfRed=!0,e.fbRings={buyTime:0,challengeTime:0,canTakeAward:!1},e.guanqiaMonster=[],e.fbConfig={},e.mijingFingfen=4,e.mijingUseTime=0,e.pkGqboss=!1,e.exp=0,e.fbDataList=[],e.initPos=!0,e.sysId=PackageID.Guanqia,e.regNetMsg(4,e.doRoleAllDie),e.regNetMsg(10,e.postFbInfoInit),e.regNetMsg(11,e.postUpDataInfo),e.regNetMsg(13,e.postFbTime),e.regNetMsg(14,e.doBossBoxNum),e.regNetMsg(16,e.postFbExpInfo),e.regNetMsg(17,e.postFbExpTotal),e.regNetMsg(18,e.doGuideFbAliveTime),e.regNetMsg(21,e.postFbRingInfo),e.regNetMsg(1,e.postGuanqiaInfo),e.regNetMsg(2,e.doWaveData),e.regNetMsg(3,e.doBossResult),e.regNetMsg(5,e.doGuanqiaReward),e.regNetMsg(6,e.doGuanqiaWroldReward),e.regNetMsg(12,e.doOfflineReward),e.regNetMsg(24,e.postGuardLeftTime),e.regNetMsg(25,e.postGuardInfo),e.regNetMsg(27,e.postGuardUseSkill),e.regNetMsg(28,e.postGuardCopyInfo),e.regNetMsg(29,e.postBossDrop),e.regNetMsg(30,e.postCreateTFRoomSuccess),e.regNetMsg(31,e.postEnterTFRoomSuccess),e.regNetMsg(32,e.exitTFRoom),e.regNetMsg(33,e.postFTRoomChange),e.regNetMsg(34,e.postFTRoomPassInfo),e.regNetMsg(35,e.doTeamFuBenEnd),e.regNetMsg(36,e.doTeamFuBenRelive),e.regNetMsg(37,e.postTeamFuBenRank),e.regNetMsg(38,e.postTeamFbFlowarRecords),e.regNetMsg(39,e.teamFbSysInviteInfo),e.regNetMsg(40,e.postGuardWeaponLogs),e.observe(GameLogic.ins().postEnterMap,e.onChangeScene),e.observe(GameLogic.ins().postHpChange,e.recordKill),e}return __extends(e,t),Object.defineProperty(e.prototype,"rCount",{get:function(){return this.fbConfig.rCount||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"goldEff",{get:function(){return this.fbConfig.goldEff||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expEff",{get:function(){return this.fbConfig.expEff||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zyPos",{get:function(){return this.fbConfig.zyPos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energy",{get:function(){return this.fbConfig.energy||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveEnergy",{get:function(){return this.fbConfig.waveEnergy||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveMonsterCount",{get:function(){return this.fbConfig.waveMonsterCount||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveMonsterId",{get:function(){return this.fbConfig.waveMonsterId||[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outPos",{get:function(){return this.fbConfig.outPos||{x:0,y:0,a:0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rPos",{get:function(){return this.fbConfig.rPos||[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eliteMonsterId",{get:function(){return this.fbConfig.eliteMonsterId||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wanderpercent",{get:function(){return void 0==this.fbConfig.wanderpercent?5e3:this.fbConfig.wanderpercent},enumerable:!0,configurable:!0}),e.prototype.getBossDrop=function(t,e){var i=this.getBytes(29);i.writeByte(t),i.writeDouble(e),this.sendToServer(i)},e.prototype.postBossDrop=function(t){for(var e=this,i=t.readByte(),s=t.readDouble(),n=t.readByte(),o=0;n>o;o++){var a=new RewardData;a.type=t.readInt(),a.id=t.readInt(),a.count=t.readInt(),0==a.type&&1!=a.id&&2!=a.id&&a.id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(EntityManager.ins().getNoDieRole().x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(EntityManager.ins().getNoDieRole().y/GameMap.CELL_SIZE),a])}DropHelp.start(),TimerManager.ins().doTimerDelay(500,100,1,function(){e.getBossDrop(i,s)},this)},e.prototype.postGuardLeftTime=function(t){GuardWeaponModel.ins().leftTime=t.readUnsignedInt()},e.prototype.challengeGuard=function(){var t=this.getBytes(24);this.sendToServer(t)},e.prototype.callGuardBoss=function(){var t=this.getBytes(26);this.sendToServer(t)},e.prototype.guardUseSkill=function(t){var e=this.getBytes(27);e.writeByte(t),this.sendToServer(e)},e.prototype.postGuardInfo=function(t){var e=t.readByte();GuardWeaponModel.ins().challengeTimes=e,GuardWeaponModel.ins().isShowSweep=1==t.readByte()},e.prototype.postGuardUseSkill=function(t){return t.readByte()},e.prototype.postGuardCopyInfo=function(t){var e=GuardWeaponModel.ins().guardCopyInfo||new GuardCopyInfo;e.parser(t.readByte(),t.readInt(),t.readByte(),t.readInt(),t.readByte(),t.readInt()),GuardWeaponModel.ins().guardCopyInfo=e},e.prototype.recordKill=function(t){var e=t[0],i=t[1];e instanceof CharRole||0>=i&&(this.expMonterCountKill+=1)},e.prototype.initLogin=function(){if(GlobalConfig.DailyFubenConfig){this.fbDataList.length=0;for(var t in GlobalConfig.DailyFubenConfig){var e=GlobalConfig.DailyFubenConfig[t];e.bossId||this.fbDataList.push(e.id)}}},e.ins=function(){return t.ins.call(this)},e.prototype.onChangeScene=function(){this.rewards=[],this.eliteRewards=[],this.expMonterCountKill=0,this.expMonterCount=0,this.tfRoomID||ViewManager.ins().close(TeamFbRoomWin),ViewManager.ins().close(TeamFbResultWin),GameMap.fbType==e.FB_TEAM?ViewManager.ins().open(TeamFbFightWin):ViewManager.ins().close(TeamFbFightWin)},e.prototype.getFbDataById=function(t){return this.fbModel[t]},e.prototype.autoPk=function(){return GameMap.sceneInMain()?Encounter.ins().isEncounter()?void UserTips.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|"):void(EntityManager.ins().getNoDieRole()&&(RoleAI.ins().stop(),RoleAI.ins().clearAIList(),this.postPlayWarm(1),e.ins().sendPKBoss(),e.ins().pkGqboss=!0)):void 0},e.prototype.postAddEnergy=function(){this.currentEnergy+=Math.ceil(this.waveEnergy/this.waveMonsterCount),this.currentEnergy>e.ins().energy&&(this.currentEnergy=e.ins().energy)},e.prototype.postPlayWarm=function(t){return t},e.prototype.hasCount=function(){if(GlobalConfig.DailyFubenConfig)for(var t in GlobalConfig.DailyFubenConfig){var e=GlobalConfig.DailyFubenConfig[t],i=this.fbModel[e.id];if(i&&!e.bossId){var s=this.fbModel[i.fbID].getCount();if(s>0)return!0;if(DieGuide.ins().dieFbRedPoint(this.fbModel[i.fbID].getResetCount(),e.id))return!0}}return!1},e.prototype.doRoleAllDie=function(t){ResultManager.ins().create(GameMap.fbType,0)},e.prototype.postFbInfoInit=function(t){for(var e,i=t.readShort(),s=0;i>s;s++)e=new FbModel,e.parser(t),this.fbModel[e.fbID]=e},e.prototype.sendCallBossPlay=function(t){var e=this.getBytes(12);e.writeInt(t),this.sendToServer(e)},e.prototype.sendChallenge=function(t){var e=this.getBytes(10);e.writeInt(t),this.sendToServer(e)},e.prototype.postUpDataInfo=function(t){var e=t.readInt();t.position-=4,this.fbModel[e].parser(t)},e.prototype.sendAddCount=function(t,e){void 0===e&&(e=0);var i=this.getBytes(11);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postFbTime=function(t){return this.curFbID=t.readInt(),this.curFbLeftTime=t.readInt(),[this.curFbID,this.curFbLeftTime]},e.prototype.doBossBoxNum=function(t){this.bossCallNum=t.readShort()},e.prototype.postFbExpInfo=function(t){return this.fbExp=this.fbExp||{},this.fbExp.useTime=t.readByte(),this.fbExp.sdTime=t.readByte(),this.fbExp.cid=t.readByte(),this.fbExp.sid=t.readByte(),this.fbExp},e.prototype.postFbExpTotal=function(t){return this.fbExpTotal=t.readInt(),this.fbExpTotal},e.prototype.fbExpRed=function(){return Actor.level>=GlobalConfig.ExpFubenBaseConfig.openLv&&(this.fbExp.useTime<GlobalConfig.ExpFubenBaseConfig.freeCount+(GlobalConfig.ExpFubenBaseConfig.vipCount[UserVip.ins().lv]||0)||this.fbExp.cid||this.fbExp.sid)?!0:!1},e.prototype.sendIntoGuideFb=function(t){var e=this.getBytes(18);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGuideFbAttacker=function(){this.sendBaseProto(19)},e.prototype.sendGuideFbAlive=function(){this.sendBaseProto(20)},e.prototype.doGuideFbAliveTime=function(t){UserBoss.ins().postRemainTime(t)},e.prototype.postFbRingInfo=function(t){this.fbRings.buyTime=t.readShort(),this.fbRings.challengeTime=t.readShort(),this.fbRings.canTakeAward=t.readBoolean()},e.prototype.sendRingSweep=function(t){var e=this.getBytes(41);e.writeShort(t),this.sendToServer(e)},e.prototype.sendShSweep=function(t){var e=this.getBytes(42);e.writeByte(t),this.sendToServer(e)},e.prototype.parser=function(t){var i=t.readInt();this.guanqiaID=i,this.firstAutoGuilder&&this.guanqiaID==e.AUTO_GUANQIA&&(this.firstAutoGuilder=!1,e.ins().setAutoPk2())},e.prototype.parser1=function(t){this.exp=t.readInt();for(var e=t.readInt(),i=0;e>i;i++){var s=new WaveDropData;s.parser(t),this.rewards.push(s)}},Object.defineProperty(e.prototype,"guanqiaID",{get:function(){return this._guanqiaID},set:function(t){if(this._guanqiaID!=t){this._guanqiaID=t,this.bossIsChallenged=!1;for(var e in GlobalConfig.WorldRewardConfig)if(this._guanqiaID<=GlobalConfig.WorldRewardConfig[e].needLevel){this._groupID=GlobalConfig.WorldRewardConfig[e].groupId;break}this.postGuanKaIdChange()}this.encounterPos=[];for(var i in this.zyPos)this.encounterPos.push(parseInt(i))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupID",{get:function(){return this._groupID},enumerable:!0,configurable:!0}),e.prototype.isReceiveBox=function(t){return-1!=this.worldGuanQias.indexOf(t)},e.prototype.isGetReceiveBox=function(t){return-1!=this.worldGuanQiaHasReceive.indexOf(t)},e.prototype.isShowBossPK=function(){return-1!=this.guanqiaID},e.prototype.getRewardsPop=function(){return this.rewards},e.prototype.getMapReward=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){if(!this.isGetReceiveBox(t)&&GlobalConfig.WorldRewardConfig[t].needLevel<e.ins().guanqiaID)return void this.sendGuanqiaWroldReward(t);t++}},e.prototype.getCurrentReward=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var i=GlobalConfig.WorldRewardConfig[t];this.isGetReceiveBox(t),e.ins().guanqiaID;if(!this.isGetReceiveBox(t)&&e.ins().guanqiaID>i.needLevel)return i.rewards;t++}return null},e.prototype.getNextReward=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var i=GlobalConfig.WorldRewardConfig[t];if(e.ins().guanqiaID<=i.needLevel)return i.rewards;t++}return null},e.prototype.getNextNeedChapter=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var i=GlobalConfig.WorldRewardConfig[t];if(e.ins().guanqiaID<=i.needLevel)return i.needLevel-e.ins().guanqiaID+1;t++}return 0},e.prototype.getDiffChapter=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var i=GlobalConfig.WorldRewardConfig[t];if(e.ins().guanqiaID<=i.needLevel){var s=GlobalConfig.WorldRewardConfig[t-1];return i.needLevel-s.needLevel}t++}return 0},e.prototype.getNewChapter=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var i=GlobalConfig.WorldRewardConfig[t];if(e.ins().guanqiaID<=i.needLevel){var s=t-1;return s=s?s:1,GlobalConfig.WorldRewardConfig[s]}t++}return null},e.prototype.getChipByGuanQia=function(){for(var t in GlobalConfig.WorldRewardConfig){var e=GlobalConfig.WorldRewardConfig[t];if(this.guanqiaID<=e.needLevel)return e.rewards[0].id}return 0},e.prototype.postGuanqiaInfo=function(t){var e=this.guanqiaID;this.parser(t),this.goldEffLast=t.readInt(),this.expEffLast=t.readInt(),this.fbConfig=JSON.parse(t.readString()),-1!=e&&this.guanqiaID!=e&&(this.currentEnergy=0,ViewManager.ins().open(EffectivenessTip)),this.guanqiaMonster=JSON.parse(t.readString()),0==GameMap.fubenID&&GameLogic.ins().createGuanqiaMonster()},e.prototype.postGuanKaIdChange=function(){},e.prototype.sendGetReward=function(t){var e=this.getBytes(1);e.writeByte(t?1:0),this.sendToServer(e)},e.prototype.sendPKBoss=function(){var t=this,e=this.getBytes(2),i=EntityManager.ins().getNoDieRole();TimerManager.ins().doTimer(500,1,function(){e.writeInt(Math.floor(i.x)),e.writeInt(Math.floor(i.y)),t.sendToServer(e)},this)},e.prototype.doWaveData=function(t){this.exp=t.readInt();for(var e=t.readInt(),i=[],s=0;e>s;s++){var n=new WaveDropData;n.parser(t),i.push(n)}var o=t.readByte();o>0?(this.eliteRewards.push(i),this.eliteRewards.length>5&&this.eliteRewards.shift(),GameLogic.ins().createGuanqiaMonster(!1,!0)):this.rewards=this.rewards.concat(i)},e.prototype.doBossResult=function(t){for(var i,s=this,n=t.readBoolean(),o=t.readShort(),a=t.readShort(),r=[],h=0;a>h;h++)i=new RewardData,i.parser(t),r.push(i);if(n){for(var l=SubRoles.ins().subRolesLen,c=void 0,u=0;l>u;u++)c=EntityManager.ins().getMainRole(u),c&&c.resetStand();for(var p=0;p<r.length;p++)if(i=r[p],0==i.type&&1!=i.id&&2!=i.id&&i.id!=MoneyConst.rune||o==e.FB_TYPE_GUARD_WEAPON||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(EntityManager.ins().getNoDieRole().x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(EntityManager.ins().getNoDieRole().y/GameMap.CELL_SIZE),i]),1==i.type){var d=GlobalConfig.ItemConfig[i.id],g=ItemConfig.getType(d);if(7==g){var f=new ItemData;f.configID=i.id,UserTips.ins().showGoodEquipTips(f)}}var v=function(){GameMap.fbType!=e.FB_TYPE_EXP&&s.sendGetBossReward();var t=null;if((o==e.FB_TYPE_TIAOZHAN&&SkyLevelModel.ins().getIsopenNext||GameMap.fbType==e.FB_TYPE_PERSONAL)&&(t=function(){e.ins().pkGqboss=!1,GameMap.fbType==e.FB_TYPE_PERSONAL?ViewManager.ins().open(BossWin,0):e.ins().isQuite&&ViewManager.ins().open(FbWin,2)}),o==e.FB_TYPE_GUIDEBOSS&&4e4==GameMap.fubenID){var i=e.ins().guideBossKill,n=void 0,a=void 0,h=void 0,l=void 0;i?(n=Actor.myName,a=SubRoles.ins().roles[0].job,h=SubRoles.ins().roles[0].sex):(n=e.ins().guideBossPlayerName,a=e.ins().guideBossPlayerJob,h=e.ins().guideBossPlayerSex),l="yuanhead"+a+h,ResultManager.ins().create(o,!0,r,"",null,[i,n,l])}else if(GameMap.fbType==e.FB_TYPE_EXP)TimerManager.ins().doTimer(800,1,function(){ViewManager.ins().open(ExpFbResultWin)},s);else if(GameMap.fbType==e.FB_TYPE_LIEYAN)TimerManager.ins().doTimer(800,1,function(){ViewManager.ins().open(FireResultWin)},s);else if(GameMap.fbType==e.FB_TYPE_MIJING||GameMap.fbType==e.FB_TYPE_LABA);else if(o!=e.FB_TYPE_GUANQIABOSS)r.length?TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(o,1,r,"获得奖励如下：",t)},s):(e.ins().pkGqboss=!1,e.ins().sendExitFb());else if(s.outPos.x&&s.outPos.y){var c=s.outPos.x*GameMap.CELL_SIZE,u=s.outPos.y*GameMap.CELL_SIZE;s.outPos.hasOwnProperty("a")&&1==s.outPos.a&&GameLogic.ins().addOutEff(c,u);for(var p=SubRoles.ins().subRolesLen,d=void 0,g=0;p>g;g++)d=EntityManager.ins().getMainRole(g),d&&GameMap.moveEntity(d,c,u);TimerManager.ins().doTimer(1e3,0,s.tempFunc,s)}else s.initPos=!0,e.ins().pkGqboss=!1,e.ins().sendExitFb()};DropHelp.addCompleteFunc(v,this),DropHelp.start()}else e.ins().pkGqboss=!1,GameMap.fbType==e.FB_TYPE_GUANQIABOSS&&PlayFun.ins().closeAuto(),ResultManager.ins().create(o,0);GameMap.fbType==e.FB_TYPE_GUANQIABOSS&&Hint.ins().postKillBossEx(e.ins().guanqiaID)},e.prototype.tempFunc=function(){var t=EntityManager.ins().getNoDieRole();if(!t)return void TimerManager.ins().remove(this.tempFunc,this);var i=Math.floor(t.x/GameMap.CELL_SIZE),s=Math.floor(t.y/GameMap.CELL_SIZE),n=this.outPos.x,o=this.outPos.y;i==n&&s==o&&(TimerManager.ins().remove(this.tempFunc,this),GameLogic.ins().removeOutEff(),this.initPos=!1,e.ins().pkGqboss=!1,e.ins().sendExitFb(),Hint.ins().postSeceneIn())},e.prototype.sendGetBossReward=function(){this.sendBaseProto(3)},e.prototype.sendExitFb=function(){this.sendBaseProto(4)},e.prototype.sendGetAward=function(){this.sendBaseProto(5)
},e.prototype.doGuanqiaReward=function(t){this.guanqiaReward=t.readShort()+1,this.postZhangJieAwardChange(),this.postGuanKaIdChange(),this.postGuanqiaWroldReward()},e.prototype.postZhangJieAwardChange=function(){},e.prototype.sendGuanqiaWroldReward=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.doGuanqiaWroldReward=function(t){var e=t.readInt(),i=0,s=0;this.worldGuanQias=[],this.worldGuanQiaHasReceive=[];for(var n=0;e>n;n++)i=t.readInt(),s=n+1,0==i?this.worldGuanQias.push(s):1==i&&this.worldGuanQiaHasReceive.push(s),(0==i||1==i)&&(this.worldReward=s);this.postGuanqiaWroldReward()},e.prototype.postGuanqiaWroldReward=function(){},e.prototype.doOfflineReward=function(t){var e=[];e[0]=t.readInt(),e[1]=t.readInt(),e[2]=t.readInt(),e[3]=t.readInt(),e[4]=t.readInt();for(var i=t.readInt(),s=[],n=0;i>n;n++){var o=new Object;o.type=t.readInt(),o.exp=t.readInt(),o.gold=t.readInt(),s.push(o)}e[5]=s,i=t.readByte();for(var a=[],n=0;i>n;n++){var r={};r.id=t.readByte(),r.count=t.readInt(),a.push(r)}ViewManager.ins().open(OfflineRewardWin,e,a)},e.prototype.getWorldGuanQia=function(){return this.worldGuanQias.length>0?this.worldGuanQias[this.worldGuanQias.length-1]:0},e.prototype.getWorldGuanQiaBox=function(){var t=this.worldGuanQias.length;if(t>0)for(var i=void 0,s=0;t>s;s++)if(i=this.worldGuanQias[s],e.ins().isReceiveBox(i))return i;return this.worldReward+1},e.prototype.sendKillMonster=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.sendChallengeExpFb=function(){this.sendBaseProto(14)},e.prototype.sendSaodang=function(){var t=this.getBytes(15);this.sendToServer(t)},e.prototype.sendGetAwardMul=function(t,e){var i=this.getBytes(16);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendChallengeFbRing=function(){this.sendBaseProto(22)},e.prototype.sendFbRingTakeAward=function(t){var e=this.getBytes(23);e.writeShort(t),this.sendToServer(e)},e.prototype.checkGuanqiaIconShow=function(){return OpenSystem.ins().checkSysOpen(SystemType.CHALLENGE)},e.prototype.postExpFly=function(t,e,i){return void 0===e&&(e=1),void 0===i&&(i=10),[t,e,i]},e.prototype.getExpFbId=function(){var t=GlobalConfig.ExpFubenConfig,e=Actor.level,i=0;for(var s in t){if(t[s].slv>e)break;i=+s}return i},e.prototype.checkInFB=function(){return GameMap.fbType==e.FB_TYPE_GUANQIABOSS||e.ins().pkGqboss?(UserTips.ins().showCenterTips("|C:0xf3311e&T:当前正在挑战关卡中|"),!0):0==GameMap.fubenID||CityCC.ins().isCity?!1:(UserTips.ins().showCenterTips("|C:0xf3311e&T:正在挑战副本中，请稍后再试|"),!0)},e.prototype.createMonster=function(t){var i=this.guanqiaMonster[t],s=e.createModel(i);return s.name=i.name,s._avatar=+i.avatar,s._scale=i.scale,s.wanderrange=i.wanderrange,s.wandertime=i.wandertime,s.effect=i.effect,s._dirNum=i.dirNum,s},e.createModel=function(t){var e=new EntityModel;return e.type=EntityType.Monster,e.configID=t.id,e.setAtt(AttributeType.atHp,t.hp),e.setAtt(AttributeType.atMaxHp,t.hp),e.setAtt(AttributeType.atAttack,t.atk),e.setAtt(AttributeType.atDef,t.def),e.setAtt(AttributeType.atRes,t.res),e.setAtt(AttributeType.atCrit,t.crit),e.setAtt(AttributeType.atTough,t.tough),e.setAtt(AttributeType.atMoveSpeed,t.ms||1e3),e.setAtt(AttributeType.atAttackSpeed,t.as||1e3),e.setAtt(AttributeType.atPenetrate,t.penetRate||0),e},e.getPersonalBossFbIds=function(){var t=[];for(var e in GlobalConfig.DailyFubenConfig){var i=GlobalConfig.DailyFubenConfig[e];i&&i.bossId&&t.push(i)}return t},e.isCanChallenge=function(){for(var t,i,s=this.getPersonalBossFbIds(),n=s.length,o=0;n>o;o++)if(t=s[o],e.ins().getFbDataById(t.id)&&(i=e.ins().getFbDataById(t.id).getCount(),i>0))if(t.monthcard){if(Recharge.ins().monthDay>0)return!0}else if(t.privilege){if(Recharge.ins().getIsForeve())return!0}else if(t.specialCard){if(Recharge.ins().franchise)return!0}else if(t.zsLevel>0){if(UserZs.ins().lv>=t.zsLevel)return!0}else if(Actor.level>=t.levelLimit)return!0;return!1},e.prototype.setAutoPk=function(){-1==this.showAutoPk&&(this.showAutoPk=0,this.postAutoPk())},e.prototype.postAutoPk=function(){},e.prototype.setAutoPk2=function(){-1==this.showAutoPk2&&(this.showAutoPk2=0,this.postAutoPk2())},e.prototype.postAutoPk2=function(){},e.prototype.sendCreateTFRoom=function(){var t=this.getBytes(30);this.sendToServer(t)},e.prototype.postCreateTFRoomSuccess=function(t){this.tfRoomID=t.readInt();var e=t.readInt();this.tfRoomID?ViewManager.ins().open(TeamFbRoomWin,1,e,this.tfRoomID):ViewManager.ins().close(TeamFbRoomWin)},e.prototype.sendEnterTFRoom=function(t){var e=this.getBytes(31);e.writeInt(t),this.sendToServer(e)},e.prototype.postEnterTFRoomSuccess=function(t){switch(t.readByte()){case 0:var e=t.readInt();this.tfRoomID=t.readInt(),ViewManager.ins().open(TeamFbRoomWin,1,e,this.tfRoomID);break;case 1:UserTips.ins().showTips("每周"+DateUtils.WEEK_CN[GlobalConfig.TeamFuBenBaseConfig.closeTime[0]]+GlobalConfig.TeamFuBenBaseConfig.closeTime[1]+"后不能挑战");break;case 2:UserTips.ins().showTips("在副本内不能进入");break;case 3:UserTips.ins().showTips("已经在别的房间");break;case 4:UserTips.ins().showTips("要进入的房间不存在");break;case 5:UserTips.ins().showTips("当前通关的层级不够");break;case 6:UserTips.ins().showTips("配置错误,不存在该房间配置");break;case 7:UserTips.ins().showTips("房间已经满人")}},e.prototype.sendExitTFRoom=function(){this.sendBaseProto(32)},e.prototype.exitTFRoom=function(t){switch(t.readByte()){case 1:break;case 2:UserTips.ins().showTips("您被队长踢出房间");break;case 3:UserTips.ins().showTips("队长解散了房间")}ViewManager.ins().close(TeamFbRoomWin),this.tfRoomID=0},e.prototype.sendBeginTF=function(){this.sendBaseProto(33)},e.prototype.postFTRoomChange=function(t){this.tfRoomID=t.readInt();var e=t.readByte();this.tfMembers||(this.tfMembers=[]),this.tfMembers.length=e,this.isTFCaptain=!1;for(var i,s=0;e>s;s++)i=this.tfMembers[s],i||(i=new TeamFuBenRoleVo,this.tfMembers[s]=i),i.parse(t),i.roleID==Actor.actorID&&1==i.position&&(this.isTFCaptain=!0)},e.prototype.sendOutTFRoom=function(t){var e=this.getBytes(34);e.writeInt(t),this.sendToServer(e)},e.prototype.sendExitTFFb=function(t){var e=this.getBytes(35);e.writeByte(t),this.sendToServer(e)},e.prototype.postFTRoomPassInfo=function(t){this.tfPassID=t.readInt(),this._tfInviteTime=t.readInt()},e.prototype.getTfInviteCD=function(){return Math.floor((1e3*this._tfInviteTime+1e3*DateUtils.SECOND_2010-GameServer.serverTime)/1e3)},e.prototype.isTeamFBOpen=function(){return UserZs.ins().lv>=GlobalConfig.TeamFuBenBaseConfig.needZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.TeamFuBenBaseConfig.openDay},e.prototype.doTeamFuBenEnd=function(t){var e=t.readInt(),i=t.readByte(),s=t.readByte(),n=[];n.length=s;for(var o,a=0;s>a;a++)o=new TeamFuBenRoleVo,n[a]=o,o.roleID=t.readInt(),o.position=t.readByte(),o.roleName=t.readString(),o.job=t.readByte(),o.sex=t.readByte();ViewManager.ins().open(TeamFbResultWin,e,i,n)},e.prototype.doTeamFuBenRelive=function(t){UserBoss.ins().killerHandler=t.readDouble(),UserBoss.ins().reliveTime=t.readInt(),UserBoss.ins().reliveTime>0?(UserBoss.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.sendTFRank=function(){this.sendBaseProto(36)},e.prototype.postTeamFuBenRank=function(t){this.tfPassRanks=[];for(var e,i,s=t.readByte(),n=0;s>n;n++){e={configID:t.readInt(),members:[]},i=t.readByte();for(var o=0;i>o;o++)e.members.push({position:t.readByte(),roleName:t.readString()});this.tfPassRanks.push(e)}},e.prototype.sendTfFlower=function(t,e){var i=this.getBytes(37);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postTeamFbFlowarRecords=function(t){var e=t.readInt();this.tfFlowerRecords||(this.tfFlowerRecords=[]);for(var i=0;e>i;i++)this.tfFlowerRecords.push({roleName:t.readString(),count:t.readInt()});for(;this.tfFlowerRecords.length>10;)this.tfFlowerRecords.shift()},e.prototype.clearTfFlowerRecords=function(){this.tfFlowerRecords=[]},e.prototype.sendTfSysInvite=function(t){var e=this.getBytes(38);e.writeString(t),this.sendToServer(e)},e.prototype.teamFbSysInviteInfo=function(t){Chat.ins().postSysChatMsg(new ChatSystemData(3,t.readString()))},e.prototype.checkTFRed=function(){return this.isTeamFBOpen()?this.showTfRed:!1},e.prototype.postShowRedChange=function(t){this.showTfRed=t},e.prototype.sendGuardWeaponLogs=function(){this.sendBaseProto(40)},e.prototype.postGuardWeaponLogs=function(t){for(var e=t.readByte(),i=[],s=0;e>s;s++){var n=t.readInt(),o=t.readString(),a=t.readString(),r=t.readString();i.push({noticeId:n,roleName:o,monsterName:a,itemName:r})}return i},e}(BaseSystem);UserFb.FB_TYPE_GUANQIABOSS=1,UserFb.FB_TYPE_CITY=20,UserFb.FB_TYPE_TIAOZHAN=9,UserFb.FB_TYPE_ZHUANSHENGBOSS=10,UserFb.FB_TYPE_ALLHUMENBOSS=7,UserFb.FB_TYPE_PERSONAL=6,UserFb.FB_TYPE_HOMEBOSS=17,UserFb.FB_TYPE_MATERIAL=2,UserFb.FB_TYPE_EXP=16,UserFb.FB_TYPE_GUILD_BOSS=15,UserFb.FB_TYPE_GUILD_WAR=14,UserFb.FB_TYPE_MIJING=21,UserFb.FB_ID_JINGYAN=3005,UserFb.FB_ID_MINE=99999,UserFb.FB_TYPE_GUIDEBOSS=18,UserFb.FB_TYPE_NEW_WORLD_BOSS=19,UserFb.FB_TYPE_LIEYAN=23,UserFb.FB_TYPE_GOD_WEAPON=26,UserFb.FB_TYPE_GOD_WEAPON_TOP=27,UserFb.FB_TYPE_PEAKED=30,UserFb.FB_TYPE_DARK_BOSS=36,UserFb.FB_TYPE_HIDE_BOSS=37,UserFb.FB_TYPE_HUN_SHOU=38,UserFb.FB_TEAM=35,UserFb.FB_TYPE_FIRE_RING=24,UserFb.FB_TYPE_PEAK=30,UserFb.FB_TYPE_GUARD_WEAPON=29,UserFb.FB_TYPE_LABA=31,UserFb.FB_TYPE_KF_BOSS=32,UserFb.FB_TYPE_DEVILDOM_BOSS=39,UserFb.FB_TYPE_KF_ARENA=40,UserFb.AUTO_GUANQIA=20,UserFb.TEAM_FB_WIN_REFLASH_PANEL="TEAM_FB_WIN_REFLASH_PANEL",UserFb.TF_SIMLPE_HEIGHT=149,UserFb.TF_EXPAND_HEIGHT=298,__reflect(UserFb.prototype,"UserFb");var GameSystem;!function(t){t.userfb=UserFb.ins.bind(UserFb)}(GameSystem||(GameSystem={}));var EquipPos;!function(t){t[t.WEAPON=0]="WEAPON",t[t.HEAD=1]="HEAD",t[t.CLOTHES=2]="CLOTHES",t[t.NECKLACE=3]="NECKLACE",t[t.Wrist=4]="Wrist",t[t.BRACELET=5]="BRACELET",t[t.RING=6]="RING",t[t.SHOE=7]="SHOE",t[t.DZI=8]="DZI",t[t.HAT=9]="HAT",t[t.VIZARD=10]="VIZARD",t[t.CLOAK=11]="CLOAK",t[t.SHIELD=12]="SHIELD",t[t.MAX=13]="MAX"}(EquipPos||(EquipPos={}));var FuliActBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActBtnSkin",DisplayUtils.removeFromParent(e.mc),e.mc=null,e}return __extends(e,t),e.prototype.dataChanged=function(){this.iconDisplay.source=this.data.icon;var t=!1;switch(this.data.type){case 1:t=DailyCheckIn.ins().showRedPoint();break;case 2:t=Activity.ins().getSevenDayStast();break;case 3:t=!1;break;case 4:t=Recharge.ins().franchise&&Recharge.ins().franchiseget?!0:!1;break;case 5:t=Activity.ins().checkNoticeRed();break;case 6:t=!1;break;case 7:t=UserVip.ins().getVipGiftRedPoint(this.data.id)}t?(this.mc||(this.mc=new MovieClip,this.mc.x=40,this.mc.y=42),this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1),this.addChild(this.mc)):(DisplayUtils.removeFromParent(this.mc),this.mc=null),this.redPoint.visible=t},e}(BaseItemRender);__reflect(FuliActBtnRenderer.prototype,"FuliActBtnRenderer");var BaseComponent=function(t){function e(){var e=t.call(this)||this;return e.className="@策划@使用此组件必须填写逻辑类名",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data"),this.dataChanged&&this.dataChanged()},enumerable:!0,configurable:!0}),e}(BaseView);BaseComponent.filterKeys=["data"],BaseComponent.copyKeys=["open","close"],__reflect(BaseComponent.prototype,"BaseComponent");var GwFubenView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this._ary=new eui.ArrayCollection,this.checkRank.touchEnabled=!0,this.checkRank.textFlow=(new egret.HtmlTextParser).parser("<u>查看排行</u>")},e.prototype.open=function(){this.addTouchEvent(this.checkRank,this.touchHandler),this.addTouchEvent(this.challenge,this.touchHandler),this.observe(GodWeaponCC.ins().postFubenInfo,this.updateView),this.observe(GodWeaponCC.ins().postRankInfo,this.updateRank),this.observe(UserBag.ins().postItemCountChange,this.useToItem),this.list.dataProvider=this._ary,this.list.itemRenderer=GwFubenGridRender,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),GodWeaponCC.ins().requestFubenInfo()},e.prototype.updateView=function(){GodWeaponCC.ins().requestRanInfo(),this._ary.replaceAll(GodWeaponCC.ins().fubenInfoData.listData);var t=(GlobalConfig.GodWeaponBaseConfig.freeCount,GodWeaponCC.ins().fubenInfoData.hadChallengeNum);this.countText.text="今日剩余次数： "+t,this.list.selectedIndex=0,this._selectData=this.list.selectedItem,GodWeaponCC.ins().fubenInfoData.hadChallengeNum>0?this.rpImg.visible=!0:this.rpImg.visible=!1},e.prototype.updateRank=function(){var t=GodWeaponCC.ins().rankInfoDataAry,e=t.length;0==e?this.rank.visible=!1:this.rank.visible=!0;for(var i,s=0;3>s;s++)i=t[s],i?(this.getRankImg(s+1).visible=!0,this.getPlayName(s+1).visible=!0,this.getPlayRank(s+1).visible=!0,this.getPlayTime(s+1).visible=!0,this.getPlayName(s+1).text=i.nameStr,this.getPlayRank(s+1).text=i.floorNum+"层",this.getPlayTime(s+1).text=i.getgetTimeStr()):(this.getPlayName(s+1).visible=!1,this.getPlayRank(s+1).visible=!1,this.getPlayTime(s+1).visible=!1,this.getRankImg(s+1).visible=!1)},e.prototype.useToItem=function(){this._isUser&&(this._isUser=!1,this._selectData&&GodWeaponCC.ins().joinFuben(this._selectData.gridNum))},e.prototype.getRankImg=function(t){return this["rank"+t+"Img"]},e.prototype.getPlayName=function(t){return this["player"+t+"Name"]},e.prototype.getPlayRank=function(t){return this["player"+t+"Rank"]},e.prototype.getPlayTime=function(t){return this["player"+t+"Time"]},e.prototype.close=function(){this._selectData=null,this.removeTouchEvent(this.checkRank,this.touchHandler),this.removeTouchEvent(this.challenge,this.touchHandler),this.removeObserve(),this.list.dataProvider=null},e.prototype.touchHandler=function(t){if(t.target==this.challenge){if(!this.showTips())return;this._selectData&&GodWeaponCC.ins().joinFuben(this._selectData.gridNum)}else t.target==this.checkRank&&ViewManager.ins().open(GwMijingRankView)},e.prototype.onTouchList=function(t){this._selectData=this.list.selectedItem},e.prototype.showTips=function(){var t=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;if(t>0)return!0;var e="",i=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.GodWeaponBaseConfig.fubenItem);return i?(e="确定使用1个<font color='#FFB82A'>"+i.itemConfig.name+"</font>增加挑战次数？\n",WarnWin.show(e,function(){this._isUser=!0,UserBag.ins().sendUseItem(i.configID,1)},this)):UserTips.ins().showTips("|C:0xf3311e&T:今日剩余次数不足|"),!1},e}(BaseView);__reflect(GwFubenView.prototype,"GwFubenView");var GwFubenGridRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._ary=new eui.ArrayCollection,this.list.dataProvider=this._ary,this.list.itemRenderer=MijingItemBase},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this._thisData=this.data,this.storeyCount.text="第"+this._thisData.gridNum+"层";var e=this._thisData.config.award[1].concat();e=e.concat(this._thisData.config.firstAward.concat());for(var i=[],s=0;s<e.length;s++){var n=new MijinglistData;n.data=e[s],n.index=s+1,n.start=this._thisData.config.award[1].length,n.floorNum=this._thisData.gridNum,i.push(n)}this._ary.replaceAll(i),0!=this._thisData.curPoint?(this.rankImg.visible=!0,this.rankbg.visible=!0,this.rankImg.source="godweapon_rank"+this._thisData.curPoint):(this.rankImg.visible=!1,this.rankbg.visible=!1),this.choose.visible=this.selected,this.rank.visible=!this.selected}},e.prototype.invalidateState=function(){t.prototype.invalidateState.call(this),this.choose.visible=this.selected,this.rank.visible=!this.selected},e}(BaseItemRender);__reflect(GwFubenGridRender.prototype,"GwFubenGridRender");var MijingItemBase=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data)if(this._thisdata=this.data,this.itemIcon.imgJob.visible=!1,0==this._thisdata.data.type){this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(this._thisdata.data.id);var e=1;switch(this._thisdata.data.id){case MoneyConst.yuanbao:e=5;break;case MoneyConst.gold:e=0;break;case MoneyConst.soul:e=2;break;case MoneyConst.piece:e=2,this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[this._thisdata.data.id];break;case MoneyConst.godweaponExp:e=2}var i=this._thisdata.data.count;if(void 0!=i&&i>1?this.setCount(i+""):this.setCount(""),this._thisdata.index<=this._thisdata.start)this.nameTxt.text=RewardData.getCurrencyName(this._thisdata.data.id),this.itemIcon.imgBg.source="quality"+e,this.nameTxt.textColor=ItemBase.QUALITY_COLOR[e];else{this.nameTxt.text="S首通奖励";var s=GodWeaponCC.ins().fubenInfoData;this.getImg.visible=!1;for(var n=0;n<s.listData.length;n++)if(this._thisdata.floorNum==s.listData[n].gridNum){1==s.listData[n].curPoint&&(this.getImg.visible=!0);break}this._thisdata.floorNum<=10?(this.nameTxt.textColor=ItemBase.QUALITY_COLOR[3],this.itemIcon.imgBg.source="quality3"):(this.nameTxt.textColor=ItemBase.QUALITY_COLOR[4],this.itemIcon.imgBg.source="quality4")}}else{if(this.itemConfig=GlobalConfig.ItemConfig[this._thisdata.data.id],!this.itemConfig)return;var e=ItemConfig.getQuality(this.itemConfig);this.nameTxt.textColor=ItemBase.QUALITY_COLOR[e],this.itemIcon.imgBg.source="quality"+e;var i=this._thisdata.data.count;if(i>1?this.setCount(i+""):this.setCount(""),this.itemIcon.imgIcon.source=this.itemConfig.icon+"_png",this._thisdata.index<=this._thisdata.start)this.nameTxt.text=this.itemConfig.name;else{this.nameTxt.text="S首通奖励";var s=GodWeaponCC.ins().fubenInfoData;this.getImg.visible=!1;for(var n=0;n<s.listData.length;n++)if(this._thisdata.floorNum==s.listData[n].gridNum){1==s.listData[n].curPoint&&(this.getImg.visible=!0);break}}}},e.prototype.setCount=function(t){if(t.length>4){var e=Math.floor(Number(t)/1e3);t=e/10+"万"}this.count.text=t},e.prototype.onClick=function(){this.showDetail()},e.prototype.showDetail=function(){0!=this._thisdata.data.type&&ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this._thisdata.data.count)},e}(BaseItemRender);__reflect(MijingItemBase.prototype,"MijingItemBase");var MijinglistData=function(){function t(){}return t}();__reflect(MijinglistData.prototype,"MijinglistData");var ViewManager=function(t){function e(){var e=t.call(this)||this;return e.filters=["TipsView","UIView1_1","GameSceneView","ChatMainUI","PlayFunView"],e.closeTopFilters=[],e._regesterInfo={},e._views={},e._hCode2Key={},e._opens=[],e._constView=["GameSceneView","ChatMainUI","UIView2","TipsView","PlayFunView"],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.clear=function(){this.closeAll(),this._views={}},e.prototype.reg=function(t,e){if(null!=t){var i=egret.getQualifiedClassName(t);this._regesterInfo[i]||(this._regesterInfo[i]=[t,e])}},e.prototype.destroy=function(t){var e=this._hCode2Key[t];delete this._views[e],delete this._hCode2Key[t]},e.prototype.getKey=function(t){var e="";if("string"==typeof t)e=t;else if("function"==typeof t)e=egret.getQualifiedClassName(t);else if(t instanceof BaseEuiView)for(var i=Object.keys(this._views),s=0,n=i.length;n>s;s++){var o=i[s];if(this._views[o]==t){e=o;break}}else debug.log("打开界面只支持类名和类名的字符串形式,关闭界面只支持类名和类名的字符串以及类的实例形式,错误编号:"+t);return e},e.prototype.viewOpenCheck=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=!0,n=this._regesterInfo[t];if(null!=n){var o=n[0],a=o.openCheck;null!=a&&(s=a.apply(void 0,e))}return s},e.prototype.open=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=this.getKey(t);if(!this.viewOpenCheck.apply(this,[s].concat(e)))return null;var n=this.openEasy(s,e);return-1==this.filters.indexOf(s)&&debug.log("开始打开窗口:"+s),n&&(this.checkOpenView(n),this.setUIEff(s)),n},e.prototype.setUIEff=function(t){if(t){var e=this.getView(t);e&&e.playUIEff()}},e.prototype.openEasy=function(t,e){void 0===e&&(e=null);var i=this.getKey(t),s=this._views[i],n=this._regesterInfo[i];if(!s){if(Assert(n,"ViewManager.openEasy class "+i+" is null!!"))return;s=new n[0],this._views[i]=s,this._hCode2Key[s.hashCode]=i}if(null==s)return Log.trace("UI_"+i+"不存在"),null;for(var o=0,a=s.exclusionWins;o<a.length;o++){var r=a[o];this.closeEasy(r)}s.isShow()||s.isInit()?(s.addToParent(n[1]),s.open.apply(s,e)):(EasyLoading.ins().showLoading(),s.loadResource(function(){s.addToParent(n[1]),s.setVisible(!1)}.bind(this),function(){s.initUI(),s.initData(),s.open.apply(s,e),s.setVisible(!0),EasyLoading.ins().hideLoading()}.bind(this)));var h=this._opens.indexOf(i);return h>=0&&this._opens.splice(h,1),this._opens.push(i),s},e.prototype.checkOpenView=function(t){t.isTopLevel&&t.parent!=LayerManager.UI_Popup&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),GameLogic.ins().postViewOpen(1),this.closeEasy(ChatMainUI),this.closeEasy(ChatWin))},e.prototype.close=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=this.getKey(t);this.closeEx(s,e)},e.prototype.closeEx=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t){var s=this.getView(t);if(s){var n=this;s.closeEx(function(){var i=n.closeEasy(t,e);i&&n.checkCloseView()})}}},e.prototype.closeLastTopView=function(){for(var t=this._opens.length,i=t-1;i>=0;i--){var s=this.getView(this._opens[i]);if(s&&s.isTopLevel){var n=e.ins().getView(RoleWin);s instanceof RoleWin&&n.getWingPanelInfo()?n.doOpenHintWin(2):this.close(s);break}}},e.prototype.closeEasy=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this.isShow(t))return null;var s=this.getKey(t),n=this.getView(s);if(n){var o=this._opens.indexOf(s);o>=0&&this._opens.splice(o,1),n.close.apply(n,e),n.$onClose.apply(n),n.removeFromParent()}return n},e.prototype.checkCloseView=function(){for(var t=!1,e=0,i=this._opens;e<i.length;e++){var s=i[e],n=this.getView(s);if(n&&n.isTopLevel){t=!0;break}}t||(SoundUtil.WINDOW_OPEN=!1,GameLogic.ins().postViewOpen(0),SceneManager.ins().getSceneName()==SceneManager.MAIN&&(this.isShow(GameSceneView)||this.openEasy(GameSceneView),this.isShow(ChatMainUI)||this.openEasy(ChatMainUI)))},Object.defineProperty(e,"gamescene",{get:function(){return e.ins().getView(GameSceneView)},enumerable:!0,configurable:!0}),e.prototype.getView=function(t){var e=this.getKey(t);return this._views[e]},e.prototype.closeAll=function(){for(;this._opens.length;)this.closeEasy(this._opens[0],[]);this.destroyAllNotShowView(),this.checkCloseView()},e.prototype.closeTopLevel=function(){var t=this.closeTopFilters;this.closeTopFilters=[];for(var e=this._opens.length-1;e>=0;e--){var i=this._opens[e];if(!(t.indexOf(i)>=0)){var s=this.getView(i),n=1e6;isNaN(parseInt(i))||(n=parseInt(i)),s&&s.isTopLevel&&this.closeEasy(i,[])}}this.checkCloseView()},e.prototype.openNum=function(){return this._opens.length},e.prototype.isShow=function(t){return this._opens.indexOf(this.getKey(t))>=0},e.prototype.hasTopView=function(){for(var t=0,e=this._opens;t<e.length;t++){var i=e[t],s=this.getView(i);if(s&&s.isTopLevel)return!0}return!1},e.prototype.destroyAllNotShowView=function(){for(var t in this._hCode2Key){var e=this._hCode2Key[t];if(-1==this._constView.indexOf(e)&&-1==this._opens.indexOf(e)){var i=this.getView(e);i&&i.destoryView&&i.destoryView(!1)}}},e}(BaseClass);__reflect(ViewManager.prototype,"ViewManager");var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.text=new eui.Label,this.text.text="资源加载中...",this.addChild(this.text)},e.prototype.setProgress=function(t,e){this.text.text="资源加载中..."+t+"/"+e},e}(BaseEuiView);__reflect(LoadingView.prototype,"LoadingView");var RuleIconBase=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this)||this;return s.isShow=!1,s.isDelayUpdateShow=!1,s.isDelayUpdate=!1,s.id=e,s.tar=i,s}return __extends(e,t),e.prototype.getTar=function(){return this.tar?this.tar:this.createTar()},e.prototype.createTar=function(){var t=GlobalConfig.PlayFunConfig[this.id],e="eui.Button"==t.iconCls?eui.Button:egret.getDefinitionByName(t.iconCls),i=new e;if(t.iconSkin&&(i.skinName=t.iconSkin),t.icon&&(i.icon=t.icon),t.iconParam)for(var s in t.iconParam)i[s]=t.iconParam[s];return this.tar=i,i},e.prototype.getConfig=function(){return GlobalConfig.PlayFunConfig[this.id]},e.prototype.delayUpdateShow=function(){this.isDelayUpdateShow||(this.isDelayUpdateShow=!0,TimerManager.ins().doTimer(100,1,this.updateShow,this))},e.prototype.updateShow=function(){this.isDelayUpdateShow=!1,e.updateShow(this)},e.prototype.delayUpdate=function(){this.isDelayUpdate||(this.isDelayUpdate=!0,TimerManager.ins().doTimer(100,1,this.update,this))},e.prototype.update=function(){this.isDelayUpdate=!1,e.update(this)},e.prototype.checkShowIcon=function(){return!0},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return null},e.prototype.tapExecute=function(){},e.prototype.addShowEvents=function(){if(this.showMessage)for(var t=0,e=this.showMessage;t<e.length;t++){var i=e[t];MessageCenter.addListener(i,this.delayUpdateShow,this)}},e.prototype.addRedEvents=function(){if(this.updateMessage)for(var t=0,e=this.updateMessage;t<e.length;t++){var i=e[t];MessageCenter.addListener(i,this.delayUpdate,this)}},e.prototype.removeRedEvents=function(){if(this.updateMessage)for(var t=0,e=this.updateMessage;t<e.length;t++){var i=e[t];MessageCenter.ins().removeListener(i.funcallname,this.delayUpdate,this)}},e.prototype.removeEvents=function(){MessageCenter.ins().removeAll(this)},e}(egret.HashObject);__reflect(RuleIconBase.prototype,"RuleIconBase");var RankDataBase=function(){function t(){}return t.prototype.parser=function(t,e){var i=this;e.forEach(function(e){i[e]=t[RankDataType.readFunc[e]]()})},t}();__reflect(RankDataBase.prototype,"RankDataBase");var ClientSet;!function(t){t[t.guidePart=0]="guidePart",t[t.guideStep=1]="guideStep",t[t.expFirst=2]="expFirst",t[t.headRed=3]="headRed",t[t.diedFirstTime=4]="diedFirstTime",t[t.recharge1=5]="recharge1",t[t.vip=6]="vip",t[t.role=7]="role",t[t.FB=8]="FB",t[t.recharge2=9]="recharge2",t[t.diedFirstTime2=10]="diedFirstTime2",t[t.mijiRedPoint=11]="mijiRedPoint",t[t.firstMonthCard=12]="firstMonthCard",t[t.firstrecharge1=13]="firstrecharge1",t[t.firstClickTreasure=14]="firstClickTreasure",t[t.autoHeji=15]="autoHeji"}(ClientSet||(ClientSet={}));var Setting=function(t){function e(){var e=t.call(this)||this;return e.map={},e.sysId=PackageID.Default,e.regNetMsg(19,e.parser),e}return __extends(e,t),Object.defineProperty(e,"currPart",{get:function(){return e.ins().getValue(ClientSet.guidePart)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"currStep",{get:function(){return e.ins().getValue(ClientSet.guideStep)},enumerable:!0,configurable:!0}),e.ins=function(){return t.ins.call(this)},e.prototype.parser=function(t){for(var e=t.readShort(),i=0;e>i;i++)this.map[t.readInt()]=t.readInt();GuideUtils.ins().init(),this.postInitSetting()},e.prototype.postInitSetting=function(){return!0},e.prototype.sendSave=function(t,e){var i=this.getBytes(19);i.writeInt(t),i.writeInt(e),this.sendToServer(i),this.map[t]=e},e.prototype.setValue=function(t,e){this.sendSave(t,e)},e.prototype.getValue=function(t,e){return void 0===e&&(e=0),void 0==this.map[t]?e:this.map[t]},e}(BaseSystem);__reflect(Setting.prototype,"Setting");var GameSystem;!function(t){t.setting=Setting.ins.bind(Setting)}(GameSystem||(GameSystem={}));var SevenDayItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="act14item",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.LoginRewardsConfig[t],i=(Activity.ins().dayNum,1==(Activity.ins().isAwards>>e.day&1));i?(this.select.visible=!1,this.checkedMask.visible=this.checked.visible=!0):this.checkedMask.visible=this.checked.visible=!1,this.item.data=e.rewards[0]},e.prototype.setSelectImg=function(t){this.select.visible=t},e}(BaseItemRender);__reflect(SevenDayItemRender.prototype,"SevenDayItemRender");var ShenshouEquipItem=function(t){function e(){var e=t.call(this)||this;return e.equipName=["","血瞳","魔躯","妖尾","圣角","鬼爪"],e.qualityName=["白1星","白1星","紫1星","紫1星","紫1星","橙1星","橙1星","橙1星","红3星"],e.qualityObj=[0,0,2,2,2,3,3,3,4],e.touchChildren=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.setPosData=function(t,e){var i=GlobalConfig.ShenShouBase[t].minLevel[e-1];this.imgBg.source="quality0",this.nameTxt.text=this.qualityName[i]+this.equipName[e],this.nameTxt.textColor=ItemBase.QUALITY_COLOR[0],this.imgIcon.source="ss_equip"+(e-1),this.equipLv.text="",this.data=null},e.prototype.dataChanged=function(){if(!isNaN(this.data)&&this.data){this.itemConfig=GlobalConfig.ItemConfig[this.data],this.nameTxt.text=this.itemConfig.name,this.nameTxt.textColor=ItemConfig.getQualityColor(this.itemConfig),this.imgBg.source="quality"+ItemConfig.getQuality(this.itemConfig),this.imgIcon.source=this.itemConfig.icon+"_png";var t=ShenshouModel.ins().getEquipLv(this.itemConfig.id)-1;this.equipLv.text=t>0?"+"+t:""}},e}(BaseItemRender);__reflect(ShenshouEquipItem.prototype,"ShenshouEquipItem");var Shop=function(t){function e(){var e=t.call(this)||this;return e.shopData=new ShopData,e.sysId=PackageID.Shop,e.regNetMsg(1,e.postUpdateShopData),e.regNetMsg(2,e.postBuyResult),e.regNetMsg(3,e.postBuyCount),e.regNetMsg(4,e.refreshGoodsSuccess),e.regNetMsg(5,e.postRefreshIntegrationSucc),e.regNetMsg(6,e.updateMedalMessage),e.regNetMsg(7,e.postUpdateBuyMedal),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendBuy=function(t,e){var i=this.getBytes(2);i.writeInt(t),i.writeInt(e.length),this.shopBuyArr=[];for(var s=0;s<e.length;s++){i.writeInt(e[s][0]),i.writeInt(e[s][1]);var n=GlobalConfig.ItemStoreConfig[e[s][0]];if(n&&n.itemId==ItemConst.GOLD_BRICK){var o={id:ItemConst.GOLD_BRICK,count:e[s][1]};this.shopBuyArr.push(o)}}this.sendToServer(i)},e.prototype.sendRefreshShop=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.postUpdateShopData=function(t){e.ins().shopData.parser(t)},e.prototype.postBuyResult=function(t){var e=t.readInt();return e},e.prototype.postBuyCount=function(t){e.ins().shopData.parserBuyCount(t)},e.prototype.refreshGoodsSuccess=function(t){this.postRefreshGoodsSuccess(!0)},e.prototype.postRefreshGoodsSuccess=function(t){return t},e.prototype.postRefreshIntegrationSucc=function(t){var i=t.readBoolean();t.readInt();return[i,e.ins().shopData.point]},e.prototype.sendIntegrationShop=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.sendMedalMessage=function(){var t=this.getBytes(6);this.sendToServer(t)},e.prototype.updateMedalMessage=function(t){var i=t.readInt();this.medalData=new FeatsStoreData(i,t),e.ins().postRefresMedalMessage()},e.prototype.postRefresMedalMessage=function(){},e.prototype.sendBuyMedal=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postUpdateBuyMedal=function(t){var e=t.readInt(),i=t.readInt();return[e,i]},e.openBuyGoldWin=function(t){void 0===t&&(t=!0);var i=e.ins().shopData.getGoodsIdByItemId(200164);return e.ins().shopData.checkBuyGoodsId(i,t)?(ViewManager.ins().open(BuyWin,i),!0):!1},e}(BaseSystem);__reflect(Shop.prototype,"Shop");var ShopData=function(){function t(){this.shopEquipData=[],this.hadBuyCount=[]}return Object.defineProperty(t.prototype,"refushTime",{get:function(){return this._refushTime},set:function(t){this._refushTime=t,TimerManager.ins().removeAll(this),t>0&&TimerManager.ins().doTimer(1e3,t,this.enterTime,this)},enumerable:!0,configurable:!0}),t.prototype.parser=function(t){this.shopEquipData.length=0,this.refushTime=t.readInt(),this.point=t.readInt(),this.times=t.readInt();
for(var e=t.readInt(),i=0;e>i;i++){var s=new ShopEquipData;s.parser(t),this.shopEquipData.push(s)}},t.prototype.parserBuyCount=function(t){var e=t.readShort();this.hadBuyCount.length=0;for(var i=0;e>i;i++){var s=new ShopHadBuyData;s.parser(t),this.hadBuyCount.push(s)}},t.prototype.enterTime=function(){this._refushTime<=0?this._refushTime=0:this._refushTime--},t.prototype.getHadBuyCountItem=function(t){for(var e=0,i=this.hadBuyCount;e<i.length;e++){var s=i[e];if(s.itemId==t)return s}return null},t.prototype.getHadBuyCount=function(t){var e=this.getHadBuyCountItem(t);return e?e.count:0},t.prototype.getShopEquipDataLength=function(){var t=0;return null!=this.shopEquipData&&(t=this.shopEquipData.length),t},t.prototype.getShopEquipDataByIndex=function(t){var e=null;return null!=this.shopEquipData&&t>=0&&t<this.shopEquipData.length&&(e=this.shopEquipData[t]),e},t.prototype.getShopEquipDataById=function(t){for(var e=0,i=this.shopEquipData;e<i.length;e++){var s=i[e];if(s.id==t)return s}return null},t.prototype.checkBuyGoodsId=function(t,e){void 0===e&&(e=!0);var i=GlobalConfig.ItemStoreConfig[t];if(i){if(i.viplv&&UserVip.ins().lv<i.viplv)return e&&UserTips.ins().showTips("VIP"+i.viplv+"可购买"),!1;if(i.vipLimit){var s=i.vipLimit[UserVip.ins().lv],n=this.getHadBuyCount(i.itemId);if(n>=s)return e&&UserTips.ins().showTips("今日购买次数已用完"),!1}}return!0},t.prototype.getGoodsIdByItemId=function(t){for(var e in GlobalConfig.ItemStoreConfig)if(GlobalConfig.ItemStoreConfig[e].itemId==t)return parseInt(e);return 0},t}();__reflect(ShopData.prototype,"ShopData");var ShopEquipData=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.costType=t.readInt(),this.costNum=t.readInt(),this.discountType=t.readInt(),this.item=new ItemData,this.item.parser(t)},t}();ShopEquipData.discountDic={0:{discount:1,res:""},1:{discount:.8,res:"shangzk8"},2:{discount:.5,res:"shangzk5"}},__reflect(ShopEquipData.prototype,"ShopEquipData");var ShopHadBuyData=function(){function t(){}return t.prototype.parser=function(t){this.itemId=t.readInt(),this.count=t.readInt()},t}();__reflect(ShopHadBuyData.prototype,"ShopHadBuyData");var GameSystem;!function(t){t.shop=Shop.ins.bind(Shop)}(GameSystem||(GameSystem={}));var SpecialRing=function(t){function e(){var e=t.call(this)||this;return e.mainHandler=[],e.ringList=[],e.loginDayCount=0,e.ringActiNum=0,e.specialRingHandler=[],e.ringsConfig=[],e.moneyOpenGrid=0,e.abilityIds=[],e.skillLvDic={},e.sysId=PackageID.Ring,e.regNetMsg(1,e.postRingUpdate),e.regNetMsg(2,e.postActiveRing),e.regNetMsg(3,e.postSpicelRingUpdate),e.regNetMsg(4,e.postGetSpicelRingInfo),e.regNetMsg(5,e.postSRStairUp),e.regNetMsg(6,e.postSRStairUp),e.regNetMsg(7,e.postUnLock),e.regNetMsg(8,e.postSkillInfo),e.regNetMsg(9,e.postRingAbility),e.observe(GameLogic.ins().postEnterMap,e.createRingAvatar),e}return __extends(e,t),e.prototype.postRingAbility=function(t){for(var i=t.readShort(),s=0;i>s;s++){var n=t.readShort(),o=t.readShort();this.abilityIds[n]=o}if(0==GameMap.fbType){var a=this.getSpecialRingDataById(e.FIRE_RING_ID);if(a){var r=this.getRingStair(a.level);r>=2&&(this.specialRingHandler[e.FIRE_RING_ID]>0&&EntityManager.ins().removeByHandle(this.specialRingHandler[e.FIRE_RING_ID]),e.ins().createRingMonster(e.FIRE_RING_ID))}}var h=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID];for(var n in h)if(h[n][1]){var l=UserBag.ins().getBagItemById(h[n][1].itemId);l&&l.setCanbeUsed()}UserBag.ins().postHasItemCanUse()},e.prototype.createRingAvatar=function(){if(0==GameMap.fbType){var t=this.getSpecialRingDataById(e.FIRE_RING_ID);if(t){var i=this.getRingStair(t.level);i>=2&&e.ins().createRingMonster(e.FIRE_RING_ID)}}},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(1);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postRingUpdate=function(t){var e=t.readShort(),i=t.readShort(),s=t.readShort();return SubRoles.ins().getSubRoleByIndex(i).setExRingsData(e,s),!0},e.prototype.sendActiveRing=function(t,e){void 0===e&&(e=0);var i=this.getBytes(2);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postActiveRing=function(t){var i=t.readShort(),s=t.readShort(),n=t.readInt(),o=t.readByte(),a=this.getSpecialRingDataById(i);return a.level=s,a.exp=n,a.fight=o,this.ringActiNum++,i==e.FIRE_RING_ID&&this.updateGrid(),[i,0]},e.prototype.postSRStairUp=function(t){var e=t.readShort(),i=t.readShort(),s=t.readInt(),n=t.readByte(),o=this.getSpecialRingDataById(e);return o.level=i,o.exp=s,o.fight=n,this.createRingAvatar(),this.updateGrid(),[e,0]},e.prototype.sendSpicelRingUpdate=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.postSpicelRingUpdate=function(t){var e=t.readShort(),i=t.readShort(),s=t.readInt(),n=this.getSpecialRingDataById(e),o=0;o=t.readByte();var a=t.readByte();return n.level=i,n.exp=s,n.fight=a,[e,o]},e.prototype.postGetSpicelRingInfo=function(t){this.loginDayCount=t.readInt();var e=t.readShort();this.ringList=[],this.ringActiNum=0;for(var i=0;e>i;i++){var s=new SpecialRingData;s.parser(t),this.ringList.push(s),s.level>0&&this.ringActiNum++}return 0==GameMap.fbType&&GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY),this.createRingAvatar(),!0},e.prototype.isFireRing=function(t){return this.specialRingHandler[e.FIRE_RING_ID]==t},e.prototype.createRingMonster=function(t){if(this.ringList&&!(this.ringList.length<=0)){var i=GlobalConfig.ActorExRingConfig[t],s=this.getSpecialRingDataById(t);if(!(s.level<i.showMonsterLv)){var n=i.monsterId,o=this.getAbilityID();if(o){var a=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID][o][this.abilityIds[o]];a&&(n+=a.monId)}if(!EntityManager.ins().getEntityByHandle(this.specialRingHandler[t])){var r=EntityManager.ins().getNoDieRole();if(r){var h=UserFb.createModel(GlobalConfig.MonstersConfig[n]);h.setAtt(AttributeType.atMoveSpeed,e.FIRE_RING_MOVING_SPEED),h.x=r.x,h.y=r.y,h.masterHandle=Actor.handle,this.specialRingHandler[t]=h.handle=egret.getTimer(),h.lyMarkLv=LyMark.ins().lyMarkLv,h.lyMarkSkills=LyMark.ins().skills;var l=GameLogic.ins().createEntityByModel(h,Team.My);l.AI_STATE=AI_State.Stand}}}}},e.prototype.sendRingLevelUp=function(t){var e=this.getBytes(5);e.writeShort(t),this.sendToServer(e)},e.prototype.sendRingFight=function(t,e){var i=this.getBytes(6);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.checkOperation=function(){var t=this.checkHaveUpRing();return!t&&this.isFireRingFuse()&&(t=this.isCanStudySkill()||this.isCanUpgradeSkill()),t},e.prototype.checkHaveUpRing=function(){if(!e.ins().checkRingOpen())return!1;for(var t=this.ringList.length,i=0;t>i;i++){var s=this.ringList[i],n=this.checkRedPoint(s.id,s.level);if(n)return n}return!1},e.prototype.checkRingOpen=function(){var t=GlobalConfig.ActorExRingCommon.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.checkRedPoint=function(t,e){return e>0?this.checkCanUpdate(t,e):this.checkCanActive(t)},e.prototype.checkCanUpdate=function(t,i){var s=!1;if(t==e.FIRE_RING_ID&&this.isFireRingFuse()){GlobalConfig.ActorExRingConfig[t];if(this.getRingConfigById(t,i+1))if(i%11==0)s=!0;else{var n=this.getRingConfigById(t,i),o=UserBag.ins().getBagGoodsCountById(0,n.costItem);s=n.cost<=o}}return s},e.prototype.checkCanActive=function(t){var i=GlobalConfig.ActorExRingConfig[t],s=!1;if(t==e.FIRE_RING_ID)this.isFireRingActivate()||(s=this.isFireRingCanActivate());else{var n=this.getSpecialRingDataById(t).level;0==n&&(s=e.ins().loginDayCount>=i.openDay&&i.openDay>=0||UserVip.ins().lv>=i.openVip&&i.openVip>=0&&Actor.yb>=i.openYb)}return s},e.prototype.canGradeupRing=function(t){for(var e,i=[!1,!1,!1],s=SubRoles.ins().subRolesLen,n=0,o=0,a=0,r=0;s>r;r++){var h=SubRoles.ins().getSubRoleByIndex(r);n=h.getExRingsData(t),e=GlobalConfig["ExRing"+t+"Config"][n],o=e.cost,o?(a=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.ExRingConfig[t].costItem),i[r]=a>=o):i[r]=!1}return i},e.prototype.getRingConfigById=function(t,e){return 0==this.ringsConfig.length&&this.initConfig(),this.ringsConfig[t]&&this.ringsConfig[t][e]?this.ringsConfig[t][e]:null},e.prototype.initConfig=function(){this.ringsConfig=[];var t=GlobalConfig.ActorExRingConfig;for(var e in t)this.ringsConfig[t[e].id]=GlobalConfig["ActorExRing"+e+"Config"]},e.prototype.getRingStair=function(t){var i=0;return i=Math.ceil(t/(e.perStar+1))},e.prototype.getRingStar=function(t){return 1>t?0:(t-1)%(e.perStar+1)},e.prototype.hasHanlder=function(t){for(var e=0;e<this.mainHandler.length;e++)if(t==this.mainHandler[e])return!0;return this.mainHandler.push(t),!1},e.prototype.delHanlder=function(t){for(var e=0;e<this.mainHandler.length;e++)if(t==this.mainHandler[e])return void this.mainHandler.splice(e,1)},e.prototype.getSpecialRingDataById=function(t){for(var e=0;e<this.ringList.length;e++)if(this.ringList[e].id==t)return this.ringList[e];return null},e.prototype.isFireRingFuse=function(){var t=!1,i=this.getSpecialRingDataById(e.FIRE_RING_ID);return i&&i.level>=1&&(t=!0),t},e.prototype.isFireRingActivate=function(){var t=!1,i=this.getSpecialRingDataById(e.FIRE_RING_ID);return i&&i.isUnLock&&(t=!0),t},e.prototype.isFireRingCanActivate=function(){var t=!1,i=GlobalConfig.ActorExRingConfig[e.FIRE_RING_ID];i.openDay;if(e.ins().loginDayCount>=i.openDay)for(var s=0;s<this.ringList.length;s++)if(t=!0,this.ringList[s].id!=e.FIRE_RING_ID&&0==this.ringList[s].level){t=!1;break}return t},e.prototype.requestDeblock=function(t){var e=this.getBytes(7);e.writeShort(t),this.sendToServer(e)},e.prototype.postUnLock=function(t){for(var e=t.readShort(),i=t.readShort(),s=t.readInt(),n=t.readByte(),o=t.readByte(),a=0;a<this.ringList.length;a++)if(this.ringList[a].id==e){this.ringList[a].level=i,this.ringList[a].exp=s,this.ringList[a].fight=n,this.ringList[a].isUnLock=o;break}return 1==o},e.prototype.requestOpenGrid=function(){var t=this.getBytes(8);this.sendToServer(t)},e.prototype.requestLearnSkill=function(t,e){var i=this.getBytes(9);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.requestUpgradeSkill=function(t){var e=this.getBytes(10);e.writeShort(t),this.sendToServer(e)},e.prototype.postSkillInfo=function(t){this.initSkill(),this.moneyOpenGrid=t.readShort(),this.updateGrid();for(var e=t.readShort(),i=0;e>i;i++){var s=new RingSkillInfo;s.position=t.readShort(),s.skillId=t.readShort(),s.skillLvl=t.readShort(),this.updateSkillInfo(s)}},e.prototype.updateGrid=function(){var t=this.getSpecialRingDataById(e.FIRE_RING_ID),i=0;t.level>0&&(i=this.moneyOpenGrid+this.getRingConfigById(e.FIRE_RING_ID,t.level).freeSkillGrid),this.updateGridOpen(i)},e.prototype.updateGridOpen=function(t){for(var e=1;t>=e;e++){var i=this.skillInfo[e-1];i.isOpen=!0}},e.prototype.updateSkillInfo=function(t){for(var e=this.skillInfo.length,i=0;e>i;i++){var s=this.skillInfo[i];s.position==t.position&&(s.skillId=t.skillId,s.skillLvl=t.skillLvl)}},e.prototype.initSkill=function(){if(!this.skillInfo){this.skillInfo=[];for(var t=1;9>t;t++){var e=new RingSkillInfo;e.position=t,this.skillInfo.push(e)}}},e.prototype.getCanStudyBook=function(){var t=[];if(!this.skillInfo)return t;for(var e=this.skillInfo.length,i=[],s=0;e>s;s++){var n=this.skillInfo[s];n.skillId>0&&i.push(n.skillId)}for(var o=this.getActorExRingBookConfigByLvl(1),a=o.length,r=0;a>r;r++){var h=o[r];if(i.indexOf(h.id)<0){var l=UserBag.ins().getBagGoodsCountById(0,h.itemId);if(l>=h.num){var c=new RewardData;c.id=h.itemId,c.count=l,c.type=1,t.push(c)}}}return t},e.prototype.isBookCanStudy=function(t){for(var e=this.skillInfo.length,i=[],s=0;e>s;s++){var n=this.skillInfo[s];n.skillId>0&&i.push(n.skillId)}for(var o=this.getActorExRingBookConfigByLvl(1),a=o.length,r=0;a>r;r++){var h=o[r];if(h.itemId==t&&i.indexOf(h.id)<0){var l=UserBag.ins().getBagGoodsCountById(0,h.itemId);if(l>=h.num)return!0}}return!1},e.prototype.getStudyBook=function(){for(var t=[],e=this.getActorExRingBookConfigByLvl(1),i=e.length,s=0;i>s;s++){var n=e[s],o=UserBag.ins().getBagGoodsCountById(0,n.itemId),a=new RewardData;a.id=n.itemId,a.count=o,a.type=1,t.push(a)}return t},e.prototype.getFirstStudyBookIndex=function(){for(var t=this.getActorExRingBookConfigByLvl(1),e=t.length,i=0;e>i;i++){var s=t[i];if(this.isBookCanStudy(s.itemId))return i}return 0},e.prototype.isCanStudySkill=function(){var t=this.getCanStudyBook(),e=!1;return void 0!=t&&t.length>0&&this.isHaveFreeGrid()&&(e=!0),e},e.prototype.isHaveFreeGrid=function(){for(var t=this.skillInfo.length,e=0;t>e;e++){var i=this.skillInfo[e];if(0==i.skillId&&i.isOpen)return!0}return!1},e.prototype.isCanUpgradeSkill=function(){if(!this.skillInfo)return!1;for(var t=this.skillInfo.length,e=0;t>e;e++){var i=this.skillInfo[e];if(i.skillId>0&&i.skillLvl<this.getSkillMaxLvl(i.skillId)){var s=this.getActorExRingBookConfig(i.skillId,i.skillLvl),n=UserBag.ins().getBagGoodsCountById(0,s.itemId);if(n>=s.num)return!0}}return!1},e.prototype.fireRingRedPoint=function(){return UserFb.ins().fbRings.challengeTime>0||UserFb.ins().fbRings.canTakeAward},e.prototype.getActorExRingBookConfig=function(t,e){var i;for(var s in GlobalConfig.ActorExRingBookConfig)for(var n in GlobalConfig.ActorExRingBookConfig[s])if(s==t.toString()&&n==e.toString()){i=GlobalConfig.ActorExRingBookConfig[s][n];break}return i},e.prototype.getActorExRingBookConfigByLvl=function(t){var e=[],i=[];for(var s in GlobalConfig.ActorExRingBookConfig)for(var n in GlobalConfig.ActorExRingBookConfig[s])if(n==t.toString()){i.indexOf(GlobalConfig.ActorExRingBookConfig[s][n].itemId)<0&&(i.push(GlobalConfig.ActorExRingBookConfig[s][n].itemId),e.push(GlobalConfig.ActorExRingBookConfig[s][n]));break}return e},e.prototype.getSkillIdByItemId=function(t){var e;for(var i in GlobalConfig.ActorExRingBookConfig)for(var s in GlobalConfig.ActorExRingBookConfig[i])if(GlobalConfig.ActorExRingBookConfig[i][s].itemId==t)return e=parseInt(i);return 0},e.prototype.getSkillMaxLvl=function(t){var e=0;if(void 0!=this.skillLvDic[t])e=this.skillLvDic[t];else{for(var i in GlobalConfig.ActorExRingBookConfig)if(i==t.toString())for(var s in GlobalConfig.ActorExRingBookConfig[i])e++;this.skillLvDic[t]=e}return e},e.prototype.getNextStageSkillName=function(t){var e;for(var i in GlobalConfig.ActorExRingAbilityConfig){var s=GlobalConfig.ActorExRingAbilityConfig[i];if(s&&s.ringLv==t){e=s.abilityName;break}}return e},e.prototype.getUnLockStage=function(t){var e,i=GlobalConfig.ActorExRingAbilityConfig[t],s=i.ringLv;switch(s){case 1:e="一";break;case 5:e="五";break;case 10:e="十";break;case 20:e="二十";break;case 40:e="四十";break;case 60:e="六十";break;case 80:e="八十"}return e},e.prototype.getRingSkill=function(){if(!this.skillInfo)return 0;for(var t=this.skillInfo.length,e=0,i=0;t>i;i++){var s=this.skillInfo[i];if(7==s.skillId){e=s.skillLvl;break}}var n=this.getSpecialRingDataById(7).level,o=this.getRingConfigById(7,n).summonerSkillId;if(e>0&&o){var a=o%10;a+=e,a>9&&(a=9);var r=Math.floor(o/10);o=10*r+a}return o},e.prototype.getCanUpgradeStars=function(t){for(var i=this.getSpecialRingDataById(e.FIRE_RING_ID).level,s=0;;){i++;var n=GlobalConfig.ActorExRing7Config[i];if(!n)return s;if(t-=n.cost,!(t>=0))return s;s++}},e.prototype.getAbilityID=function(t){void 0===t&&(t=0);var e=0;for(var i in this.abilityIds){if(e==t)return+i;e++}return 0},e.prototype.getAbilityIdByItemId=function(t){var i=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID];for(var s in i)if(i[s][1].itemId=t)return+s;return 0},e.prototype.getMaxAbilityLvByItemId=function(t){var i=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID];for(var s in i)if(i[s][1].itemId=t)return CommonUtils.getObjectLength(i[s]);return 0},e.prototype.checkCanUseByItem=function(t){var e=this.getAbilityIdByItemId(t),i=this.getMaxAbilityLvByItemId(t);return e&&this.abilityIds[e]>=i?!1:!0},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);SpecialRing.perStar=10,SpecialRing.FIRE_RING_ID=7,SpecialRing.FIRE_RING_MOVING_SPEED=3750,SpecialRing.GRID_OPEN_LEVEL=20,__reflect(SpecialRing.prototype,"SpecialRing");var GameSystem;!function(t){t.specialRing=SpecialRing.ins.bind(SpecialRing)}(GameSystem||(GameSystem={}));var ItemRenderer=eui.ItemRenderer,FireRingSkillItem=function(t){function e(){var e=t.call(this)||this;return TimerManager.ins().doNext(function(){var t=new egret.Shape;t.graphics.beginFill(65280),t.graphics.drawRoundRect(0,0,e.width,e.height,1,1),t.graphics.endFill(),t.alpha=0,e.addChild(t)},e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this,e=this.data;if(e.isOpen)if(e.skillId){this.currentState="learn";var i=SpecialRing.ins().getActorExRingBookConfig(e.skillId,e.skillLvl);this.skillImg.source=i.skillIcon,this.skillLv.text="Lv"+e.skillLvl,this.skillName.text=i.skillName;var s=UserBag.ins().getBagGoodsCountById(0,i.itemId);this.redpoint.visible=s>=i.num&&e.skillLvl<SpecialRing.ins().getSkillMaxLvl(e.skillId)}else this.currentState="unlearn",this.redpoint.visible=SpecialRing.ins().isCanStudySkill();else{this.currentState="lock";var n=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level,o=SpecialRing.ins().getRingStair(n);if(o<SpecialRing.GRID_OPEN_LEVEL)TimerManager.ins().doNext(function(){t.skillName.text=SpecialRing.GRID_OPEN_LEVEL+"阶解锁"},this),this.price.visible=!1;else{this.price.visible=!0,TimerManager.ins().doNext(function(){t.skillName.text="未解锁"},this);var a=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.price.setPrice(a.skillGridYb)}}this.select.visible=this.selected},e.prototype.setSelect=function(t){this.select.visible=t},e}(ItemRenderer);__reflect(FireRingSkillItem.prototype,"FireRingSkillItem");var TipsItem=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="TipsSkin",e.lab.stroke=1,e.lab.strokeColor=0,e}return __extends(e,t),e.prototype.setIndex=function(t){this.index=t},Object.defineProperty(e.prototype,"labelText",{get:function(){return this._labelText},set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width,this.bg.visible=!1,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1,this.addToEvent||(this.addToEvent=!0,TimerManager.ins().doTimer(1200,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),e.prototype.removeFromParent=function(){this.addToEvent=!1,DisplayUtils.removeFromParent(this),egret.Tween.removeTweens(this),ObjectPool.push(this)},e}(BaseView);__reflect(TipsItem.prototype,"TipsItem");var BattleRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleScoreRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.rank<=3;this.rankImg.source=e?"paihang"+t.rank:null,this.rank.text=e?"":t.rank+"",this.nameLabel.text=t.roleName,this.nameGuild.text=t.unionName,this.score.text=t.score+""},e}(BaseItemRender);__reflect(BattleRankItemRender.prototype,"BattleRankItemRender");var ColorUtil=function(){function t(){}return t.mergeARGB=function(t,e,i,s){return t<<24|e<<16|i<<8|s},t.getChannel=function(t,e){switch(e){case this.ALPHA:return t>>24&255;case this.RED:return t>>16&255;case this.GREEN:return t>>8&255;case this.BLUE:return 255&t}return 0},t.numberToString=function(t,e){return void 0===e&&(e="#"),e+t.toString(16)},t}();ColorUtil.ALPHA=4080082432,ColorUtil.RED=15937822,ColorUtil.GREEN=3532333,ColorUtil.BLUE=255,ColorUtil.NORMAL_COLOR=13746831,ColorUtil.RED_COLOR_N=15937822,ColorUtil.GREEN_COLOR_N=3532333,ColorUtil.GRAY_COLOR2=8618883,ColorUtil.WHITE_COLOR2=13746831,ColorUtil.WHITE_COLOR="#D1C28F",ColorUtil.RED_COLOR="#F3311E",ColorUtil.GREEN_COLOR="#35E62D",ColorUtil.GRAY_COLOR="#8B898B",ColorUtil.COLOR_STR=["白色","绿色","紫色","橙色","红色","金色"],ColorUtil.ROLENAME_COLOR_YELLOW=16764427,ColorUtil.ROLENAME_COLOR_GREEN=3532333,ColorUtil.ROLENAME_COLOR_NORMAL=3532333,ColorUtil.JUEWEI_COLOR=["#e2dfd4","#35e62d","#81adff","#e27dff","#ff9649","#fc5959","#ffd93f","#ffff00"],__reflect(ColorUtil.prototype,"ColorUtil");var CommonUtils=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.addLableStrokeColor=function(t,e,i){t.strokeColor=e,t.stroke=i},e.getObjectLength=function(t){var e=0;for(var i in t)e++;return e},e.getObjectByAttr=function(t,e,i){for(var s in t)if(t[s][e]==i)return t[s];return null},e.getObjectByUnionAttr=function(t,e,i){for(var s in t)if(s==e.toString())for(var n in t[s])if(n==i.toString())return t[s][n];return null},e.copyDataHandler=function(t){var e;if(t instanceof Array)e=[];else{if(!(t instanceof Object))return t;e={}}for(var i=Object.keys(t),s=0,n=i.length;n>s;s++){var o=i[s];e[o]=this.copyDataHandler(t[o])}return e},e.objectToArray=function(t){if(t instanceof Object){t=this.copyDataHandler(t);for(var e=[],i=Object.keys(t),s=0,n=i.length;n>s;s++){var o=i[s];t[o]&&e.push(t[o])}return e}return t},e.lock=function(){StageUtils.ins().getStage().touchEnabled=StageUtils.ins().getStage().touchChildren=!1},e.unlock=function(){StageUtils.ins().getStage().touchEnabled=StageUtils.ins().getStage().touchChildren=!0},e.labelIsOverLenght=function(t,e){t.text=this.overLength(e)},e.overLength=function(t){var e=null;return 1e5>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(10*t)/10,e=t+"亿"):(t/=1e4,t=Math.floor(10*t)/10,e=t+"万"),e},e.overLengthChange=function(t){var e=null;return 1e4>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(10*t)/10,e=t+"亿"):(t/=1e4,t=Math.floor(10*t)/10,e=t+"万"),e},e}(BaseClass);__reflect(CommonUtils.prototype,"CommonUtils");var DateStyle=function(t){function e(e,i,s,n){var o=t.call(this)||this;return o.format=[],o.from=0,o.to=0,o.isFormatNum=!1,o.format=e,o.from=i,o.to=s,o.isFormatNum=n,o}return __extends(e,t),e}(BaseClass);__reflect(DateStyle.prototype,"DateStyle");var DateUtils=function(){function t(){}return t.getFormatTimeByStyle=function(e,i){if(void 0===i&&(i=t.STYLE_1),0>e&&(e=0,debug.log("输入参数有误!时间为负数:"+e)),i.from>i.to)return debug.log("输入参数有误!to参数必须大于等于from参数,请检查style参数的值"),"";e>>=0;for(var s="",n=i.to;n>=i.from;n--){var o=e/this.mul[n],a="";n!=i.to&&(o%=this.mod[n]),a=i.isFormatNum&&10>o?"0"+(o>>0).toString():(o>>0).toString(),s+=a+i.format[n]}return s},t.getFormatTimeByStyle1=function(e,i){return void 0===i&&(i=t.STYLE_1),this.getFormatTimeByStyle(e/this.MS_PER_SECOND)},t.formatMiniDateTime=function(e){return t.MINI_DATE_TIME_BASE+(2147483647&e)*t.MS_PER_SECOND},t.formatServerTime=function(e){return(e-t.MINI_DATE_TIME_BASE)/t.MS_PER_SECOND},t.getFormatBySecond=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=2);var s="",n=1e3*t;switch(e){case this.TIME_FORMAT_1:s=this.format_1(n);break;case this.TIME_FORMAT_2:s=this.format_2(n);break;case this.TIME_FORMAT_3:s=this.format_3(n);break;case this.TIME_FORMAT_4:s=this.format_4(n);break;case this.TIME_FORMAT_5:s=this.format_5(n,i);break;case this.TIME_FORMAT_6:s=this.format_6(n);break;case this.TIME_FORMAT_7:s=this.format_7(n);break;case this.TIME_FORMAT_8:s=this.format_8(n);break;case this.TIME_FORMAT_9:s=this.format_9(n);break;case this.TIME_FORMAT_10:s=this.format_10(n);break;case this.TIME_FORMAT_11:s=this.format_11(n);break;case this.TIME_FORMAT_12:s=this.format_12(n);break;case this.TIME_FORMAT_13:s=this.format_13(n);break;case this.TIME_FORMAT_14:s=this.format_14(n);break;case this.TIME_FORMAT_15:s=this.format_15(n)}return s},t.getRenainSecond=function(e){var i=e?new Date(e):new Date,s=t.getTodayZeroSecond(i)+86400-i.getTime()/1e3;return s.toFixed(0)},t.getTodayPassedSecond=function(){var t=new Date,e=((Date.now()-new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime())/1e3).toFixed(0);return parseInt(e)},t.getTodayZeroSecond=function(t){var e=t?t:new Date;return parseInt((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()/1e3).toFixed(0))},t.showWeekFirstDay=function(){var t=new Date,e=t.getDay();e=e?e:7;var i=new Date(t-864e5*(e-1));return i},t.showWeekLastDay=function(){var e=(new Date,t.showWeekFirstDay()),i=new Date(1e3*(e/1e3+518400));return i},t.calcWeekFirstDay=function(){var t=new Date,e=t.getDay();e=e>0?e:7;var i=7-e,s=t.getHours(),n=t.getMinutes(),o=t.getSeconds(),a=86400*i*1e3+864e5-(3600*s*1e3+60*n*1e3+1e3*o);return new Date(a)},t.format_1=function(e){var i=0,s="##:##:##";return i=Math.floor(e/t.MS_PER_HOUR),s=s.replace("##",t.formatTimeNum(i)),i&&(e-=i*t.MS_PER_HOUR),i=Math.floor(e/t.MS_PER_MINUTE),s=s.replace("##",t.formatTimeNum(i)),i&&(e-=i*t.MS_PER_MINUTE),i=Math.floor(e/1e3),s=s.replace("##",t.formatTimeNum(i))},t.format_2=function(t){var e=new Date(t),i=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),o=e.getHours(),a=e.getMinutes(),r=e.getSeconds();return i+"-"+s+"-"+n+" "+o+":"+a+":"+r},t.format_3=function(t){var e=this.format_1(t),i=e.split(":");return i[1]+":"+i[2]},t.format_4=function(t){return t<this.MS_PER_HOUR?Math.floor(t/this.MS_PER_MINUTE)+"分钟前":t<this.MS_PER_DAY?Math.floor(t/this.MS_PER_HOUR)+"小时前":Math.floor(t/this.MS_PER_DAY)+"天前"},t.format_5=function(t,e){void 0===e&&(e=2);var i="",s=["天","时","分","秒"],n=[],o=Math.floor(t/this.MS_PER_DAY);n.push(o),t-=o*this.MS_PER_DAY;var a=Math.floor(t/this.MS_PER_HOUR);n.push(a),t-=a*this.MS_PER_HOUR;var r=Math.floor(t/this.MS_PER_MINUTE);n.push(r),t-=r*this.MS_PER_MINUTE;var h=Math.floor(t/1e3);n.push(h);for(var l in n)if(n[l]>0&&(i+=this.formatTimeNum(n[l],Number(l))+s[l],e--,0>=e))break;return i},t.format_6=function(t){var e=new Date(t),i=e.getHours(),s=e.getMinutes(),n=e.getSeconds();return this.formatTimeNum(i)+":"+this.formatTimeNum(s)+":"+this.formatTimeNum(n)},t.format_7=function(t){return t<this.MS_PER_HOUR?"<1小时":t<this.MS_PER_DAY?Math.floor(t/this.MS_PER_HOUR)+"小时":Math.floor(t/this.MS_PER_DAY)+"天"},t.format_8=function(t){var e=new Date(t),i=e.getFullYear(),s=e.getMonth()+1,n=e.getDate(),o=e.getHours(),a=e.getMinutes();return i+"-"+s+"-"+n+" "+o+":"+a},t.format_9=function(t){var e=Math.floor(t/this.MS_PER_HOUR);t-=e*this.MS_PER_HOUR;var i=Math.floor(t/this.MS_PER_MINUTE);t-=i*this.MS_PER_MINUTE;var s=Math.floor(t/1e3);return e+"小时"+i+"分钟"+s+"秒"},t.format_10=function(t){var e=Math.floor(t/this.MS_PER_MINUTE);t-=e*this.MS_PER_MINUTE;var i=Math.floor(t/1e3);return e+"分"+i+"秒"},t.format_11=function(t){var e=Math.floor(t/this.MS_PER_HOUR);t-=e*this.MS_PER_HOUR;var i=Math.floor(t/this.MS_PER_MINUTE);t-=i*this.MS_PER_MINUTE;var s=Math.floor(t/1e3);return e+"时"+i+"分"+s+"秒"},t.format_12=function(e){var i=Math.floor(e/this.MS_PER_HOUR);e-=i*this.MS_PER_HOUR;var s=Math.floor(e/this.MS_PER_MINUTE);e-=s*this.MS_PER_MINUTE;var n=Math.floor(e/1e3);return t.formatTimeNum(i)+":"+t.formatTimeNum(s)+":"+t.formatTimeNum(n)},t.format_13=function(e){var i=new Date(e),s=(i.getFullYear(),i.getMonth()+1),n=i.getDay(),o=i.getDate(),a=i.getHours(),r=i.getMinutes();return s+"月"+o+"日(周"+this.WEEK_CN[n]+") "+t.formatTimeNum(a)+":"+t.formatTimeNum(r)},t.format_14=function(t){var e=new Date(t),i=e.getHours(),s=e.getMinutes();return i+"时"+s+"分"},t.format_15=function(e){var i=new Date(e),s=i.getMonth()+1,n=i.getDate(),o=i.getHours(),a=i.getMinutes();return t.formatTimeNum(s)+"-"+t.formatTimeNum(n)+" "+t.formatTimeNum(o)+":"+t.formatTimeNum(a)},t.formatTimeNum=function(t,e){return t>=10?t.toString():0==e?t.toString():"0"+t},t.checkTime=function(t,e){var i=(new Date).getTime(),s=t>i+e*this.MS_PER_DAY;return s},t.formatFullTime=function(t){var e,i,s=new Date(t),n=s.getFullYear(),o=s.getMonth()+1,a=s.getDate(),r=s.getDay(),h=s.getHours();i=10>h?"0"+h:h.toString();var l,c=s.getMinutes();l=10>c?"0"+c:c.toString();var u;switch(r){case 1:u="一";break;case 2:u="二";break;case 3:u="三";break;case 4:u="四";break;case 5:u="五";break;case 6:u="六";break;case 0:u="日"}return e=n+"年"+o+"月"+a+"日（周"+u+"） "+i+":"+l},t.formatStrTimeToMs=function(t){var e=new Date,i=t.split(".");e.setFullYear(i[0]),e.setMonth(+i[1]-1);var s=i[2].split("-");e.setDate(s[0]);var n=s[1].split(":");return e.setHours(n[0]),e.setMinutes(n[1]),e.setSeconds(0),e.getTime()},t}();DateUtils.TIME_FORMAT_1=1,DateUtils.TIME_FORMAT_2=2,DateUtils.TIME_FORMAT_3=3,DateUtils.TIME_FORMAT_4=4,DateUtils.TIME_FORMAT_5=5,DateUtils.TIME_FORMAT_6=6,DateUtils.TIME_FORMAT_7=7,DateUtils.TIME_FORMAT_8=8,DateUtils.TIME_FORMAT_9=9,DateUtils.TIME_FORMAT_10=10,DateUtils.TIME_FORMAT_11=11,DateUtils.TIME_FORMAT_12=12,DateUtils.TIME_FORMAT_13=13,DateUtils.TIME_FORMAT_14=14,DateUtils.TIME_FORMAT_15=15,DateUtils.MS_PER_SECOND=1e3,DateUtils.MS_PER_MINUTE=6e4,DateUtils.MS_PER_HOUR=36e5,DateUtils.MS_PER_DAY=864e5,DateUtils.SECOND_PER_HOUR=3600,DateUtils.SECOND_PER_DAY=86400,DateUtils.SECOND_PER_MONTH=2592e3,DateUtils.SECOND_PER_YEAR=31104e3,DateUtils.DAYS_PER_WEEK=7,DateUtils.YEAR_PER_YEAR=1,DateUtils.MONTH_PER_YEAR=12,DateUtils.DAYS_PER_MONTH=30,DateUtils.HOURS_PER_DAY=24,DateUtils.MUNITE_PER_HOUR=60,DateUtils.SECOND_PER_MUNITE=60,DateUtils.SECOND_PER_SECOND=1,DateUtils.SECOND_2010=1262275200,DateUtils.mod=[DateUtils.SECOND_PER_MUNITE,DateUtils.MUNITE_PER_HOUR,DateUtils.HOURS_PER_DAY,DateUtils.DAYS_PER_MONTH,DateUtils.MONTH_PER_YEAR,DateUtils.YEAR_PER_YEAR],DateUtils.mul=[DateUtils.SECOND_PER_SECOND,DateUtils.SECOND_PER_MUNITE,DateUtils.SECOND_PER_HOUR,DateUtils.SECOND_PER_DAY,DateUtils.SECOND_PER_MONTH,DateUtils.SECOND_PER_YEAR],DateUtils.MINI_DATE_TIME_BASE=Date.UTC(2010,0)+(new Date).getTimezoneOffset()*DateUtils.MS_PER_MINUTE,DateUtils.TIME_ZONE_OFFSET=8*DateUtils.MS_PER_HOUR,DateUtils.TO_SECOND=0,DateUtils.TO_MINUTE=1,DateUtils.TO_HOUR=2,DateUtils.TO_DAY=3,DateUtils.TO_MONTH=4,DateUtils.TO_YEAR=5,DateUtils.FORMAT_1=["秒","分","时","天","月","年"],DateUtils.FORMAT_2=[":",":",":",":",":",":"],DateUtils.WEEK_CN=["日","一","二","三","四","五","六"],DateUtils.STYLE_1=new DateStyle(DateUtils.FORMAT_1,DateUtils.TO_SECOND,DateUtils.TO_HOUR,!1),DateUtils.STYLE_2=new DateStyle(DateUtils.FORMAT_1,DateUtils.TO_SECOND,DateUtils.TO_DAY,!1),DateUtils.STYLE_3=new DateStyle(DateUtils.FORMAT_2,DateUtils.TO_SECOND,DateUtils.TO_HOUR,!0),DateUtils.STYLE_4=new DateStyle(DateUtils.FORMAT_1,DateUtils.TO_SECOND,DateUtils.TO_MINUTE,!0),__reflect(DateUtils.prototype,"DateUtils");var DebugUtils=function(){function t(){}return t.isOpen=function(t){this._isOpen=t},Object.defineProperty(t,"isDebug",{get:function(){return window.isDebug?window.isDebug:!1},enumerable:!0,configurable:!0}),t.log=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t.isDebug&&egret.log(e,i)},t.warn=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t.isDebug&&egret.warn(e,i)},t.error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];egret.error(t,e)},t.start=function(t){this._isOpen&&(this._startTimes[t]=egret.getTimer())},t.stop=function(t){if(!this._isOpen)return 0;if(!this._startTimes[t])return 0;var e=egret.getTimer()-this._startTimes[t];return e>this._threshold&&Log.trace(t+": "+e),e},t.setThreshold=function(t){this._threshold=t},t}();DebugUtils._startTimes={},DebugUtils._threshold=3,__reflect(DebugUtils.prototype,"DebugUtils");var debug={log:DebugUtils.log,warn:DebugUtils.warn,error:DebugUtils.error},DeviceUtils=function(){function t(){}return Object.defineProperty(t,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsIEBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MSIE")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsFirefoxBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Firefox")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsChromeBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Chrome")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsSafariBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Safari")
},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsOperaBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("Opera")},enumerable:!0,configurable:!0}),t}();__reflect(DeviceUtils.prototype,"DeviceUtils");var DirUtil=function(){function t(){}return t.get8DirBy2Point=function(t,e){var i=MathUtils.getAngle(MathUtils.getRadian2(t.x,t.y,e.x,e.y));return this.angle2dir(i)},t.get4DirBy2Point=function(t,e){return t.x<e.x?t.y<e.y?3:1:t.y<e.y?5:7},t.dir2angle=function(t){return t*=45,t-=90},t.angle2dir=function(t){return-90>t&&(t+=360),Math.round((t+90)/45)%8},t.dirOpposit=function(t){return 4>t?t+4:t-4},t.get5DirBy8Dir=function(t){return t-this.isScaleX(t)},t.isScaleX=function(t){var e=2*(t-4);return 0>e&&(e=0),e},t.getGridByDir=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i={x:0,y:0});var s=this.dir2angle(this.dirOpposit(t));return MathUtils.getDirMove(s,e*GameMap.CELL_SIZE,i.x,i.y)},t}();__reflect(DirUtil.prototype,"DirUtil");var DisplayUtils=function(){function t(){}return t.setShakeOn=function(t){this.openShake=t},t.createBitmap=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.createEuiImage=function(t){var e=new eui.Image,i=RES.getRes(t);return e.source=i,e},t.removeFromParent=function(t){t&&null!=t.parent&&t.parent.removeChild(t)},t.shakeIt=function(e,i,s,n,o){if(void 0===n&&(n=1),void 0===o&&(o=function(){return!0}),this.openShake&&e&&!(1>n)&&o()){var a=[{anchorOffsetX:0,anchorOffsetY:-i},{anchorOffsetX:0,anchorOffsetY:+i},{anchorOffsetX:0,anchorOffsetY:0}];egret.Tween.removeTweens(e);var r=s/a.length;egret.Tween.get(e).to(a[0],r).to(a[1],r).to(a[2],r).call(function(){t.shakeIt(e,i,s,--n)},this)}},t.shakeItHeji=function(e,i,s,n,o){if(void 0===n&&(n=1),void 0===o&&(o=function(){return!0}),this.openShake&&e&&!(1>n)&&o()){var a=[{anchorOffsetX:.1*+i,anchorOffsetY:+i},{anchorOffsetX:.1*-i,anchorOffsetY:-i},{anchorOffsetX:.1*+i,anchorOffsetY:+i},{anchorOffsetX:.1*-i,anchorOffsetY:-i},{anchorOffsetX:.1*(+i>>1),anchorOffsetY:+i>>1},{anchorOffsetX:.1*(-i>>1),anchorOffsetY:-i>>1},{anchorOffsetX:.1*(+i>>2),anchorOffsetY:+i>>2},{anchorOffsetX:0,anchorOffsetY:0}];egret.Tween.removeTweens(e);var r=s/a.length;egret.Tween.get(e).to(a[0],r).to(a[1],r).to(a[2],r).to(a[3],r).to(a[4],r).to(a[5],r).to(a[6],r).to(a[7],r).call(function(){t.shakeIt(e,i,s,--n)},this)}},t.shakeItEntity=function(t,e,i,s,n){var o=this;if(void 0===s&&(s=1),void 0===n&&(n=function(){return!0}),this.openShake&&t&&!(1>s)&&n()){var a=[{anchorOffsetX:0,anchorOffsetY:-e},{anchorOffsetX:-e,anchorOffsetY:0},{anchorOffsetX:e,anchorOffsetY:0},{anchorOffsetX:0,anchorOffsetY:e},{anchorOffsetX:0,anchorOffsetY:0}];egret.Tween.removeTweens(t);var r=i/5;egret.Tween.get(t).to(a[0],r).to(a[1],r).to(a[2],r).to(a[3],r).to(a[4],r).call(function(){o.shakeIt(t,e,i,--s)},this)}},t.drawCir=function(t,e,i,s){function n(){t.graphics.clear(),t.graphics.beginFill(65535,1),t.graphics.moveTo(0,0),t.graphics.lineTo(e,0),t.graphics.drawArc(0,0,e,0,i*Math.PI/180,s),t.graphics.lineTo(0,0),t.graphics.endFill()}return null==t&&(t=new egret.Shape),n(),t},t.drawrect=function(t,e,i,s){function n(){t.graphics.clear(),t.graphics.beginFill(65535,1),t.graphics.drawRect(0,0,e,i),t.graphics.endFill()}return null==t&&(t=new egret.Shape),n(),t},t.getEffectPath=function(t){return RES_DIR_EFF+t},t.scrollerToBottom=function(t){t.viewport.validateNow(),t.viewport.contentHeight>t.height&&(t.viewport.scrollV=t.viewport.contentHeight-t.height)},t}();DisplayUtils.openShake=!0,DisplayUtils.shakingList={},__reflect(DisplayUtils.prototype,"DisplayUtils");var load=EXML.load,ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function n(t){e.call(s,t),RES.destroyRes(cdnurl+RES_RESOURCE+"default.thm.json")}function o(e){if(e.resItem.url==t){if(a+=1,Assert(!1,"加载 default.thm.json 失败!! 失败次数："+a+"."),3>a)return void RES.getResByUrl(t,n,r,RES.ResourceItem.TYPE_TEXT);RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),alert("皮肤加载失败，请检查网络重新登录")}}var a=0,r=this;RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var FixUtil=function(){function t(){}return t.fixAll=function(){t.fixEXMLParser(),t.fixLoadThm(),t.fixComponentSkinName(),t.fixRemoveDisplayObject()},t.fixGetResAsync=function(){var t=RES.getResByUrl;RES.getResByUrl=function(e,i,s,n){if(void 0===n&&(n=""),n){var o=RES.getAnalyzer(n),a=o.getRes(e);if(a)return void i.call(s,a,e)}t(e,i,s,n)}},t.fixRemoveDisplayObject=function(){var t=function(t,e){if(e){var i;if(i=e.bitmapData&&e.bitmapData.hashCode?e.bitmapData.hashCode:e.hashCode,i&&egret.BitmapData._displayList[i]){var s=egret.BitmapData._displayList[i],n=s.indexOf(t);n>=0&&s.splice(n,1),0==s.length&&ResourceMgr.ins().disposeResTime(i)}}};egret.BitmapData.$removeDisplayObject=t},t.parseSkinName=function(e){var i=t.exmlsDic;if(i&&i.hasOwnProperty(e)){var s=i[e];delete i[e],EXML.$parseURLContent(s.path,s.content)}},t.fixComponentSkinName=function(){var e=eui.Component.prototype.$parseSkinName;eui.Component.prototype.$parseSkinName=function(){var i=this.skinName;"string"==typeof i&&t.parseSkinName(i),e.call(this)}},t.fixLoadThm=function(){var e=t.exmlsDic={},i=function(t,i){var s=i.match(/ class="([^"]*)"/i);e[s[1]]={path:t,content:i}};eui.Theme.prototype.onConfigLoaded=function(e){var s;if(e&&(s=JSON.parse(e)),!s)return void alert("皮肤加载失败，请检查网络重新登录");if(s&&s.skins)for(var n=this.skinMap,o=s.skins,a=Object.keys(o),r=a.length,h=0;r>h;h++){var l=a[h];n[l]||this.mapSkin(l,o[l])}s.styles&&(this.$styles=s.styles),s.exmls&&0!=s.exmls.length?s.exmls[0].gjs?(s.exmls.forEach(function(t){return EXML.$parseURLContentAsJs(t.path,t.gjs,t.className)}),this.onLoaded()):s.exmls[0].content?(s.exmls.forEach(function(t){return i(t.path,t.content)}),t.preParserExml(),this.onLoaded()):EXML.$loadAll(s.exmls,this.onLoaded,this,!0):this.onLoaded()}},t.preParserExml=function(){for(var e=["skins.ButtonSkin","skins.CheckBoxSkin","skins.HScrollBarSkin","skins.HSliderSkin","skins.ItemRendererSkin","skins.PanelSkin","skins.ProgressBarSkin","skins.RadioButtonSkin","skins.ScrollerSkin","skins.TextInputSkin","skins.ToggleSwitchSkin","skins.VScrollBarSkin","skins.VSliderSkin","PlayFunSkin","UIView2Skin","GameFightSceneSkin"],i=0,s=e;i<s.length;i++){var n=s[i];t.parseSkinName(n)}},t.fixEXMLParser=function(){var t=eui.sys.EXMLParser;t.prototype.getClassNameOfNode1=function(t){if(t.attributes&&t.attributes.className){var e=egret.getDefinitionByName(t.attributes.className);if(e)return t.parent&&"ViewStack"==t.parent.localName&&t.attributes.skinName&&(this.addInitSkin(e,t.attributes.skinName),delete t.attributes.skinName),t.attributes.className}return this.getClassNameOfNode(t)},t.prototype.addInitSkin=function(t,e){var i=t.prototype;if(!i.__skinName_1){i.__skinName_1=e;var s=i.close;s&&(i.close_1=s,i.close=function(){this.skinName&&this.close_1()},s=null);var n=i.open;n&&(i.open_1=n,i.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.$isInitSkin||this.$initSkin(),this.open_1.apply(this,t)},n=null);var o=i.childrenCreated;o&&(i.childrenCreated_1=o,i.childrenCreated=function(){},o=null);i.$initSkin;i.$initSkin=function(){this.skinName=this.__skinName_1,this.$isInitSkin=!0,this.childrenCreated_1()}}},t.prototype.createFuncForNode=function(t){var e=t.localName,i=this.isBasicTypeData(e);if(i)return this.createBasicTypeForNode(t);var s=this.getClassNameOfNode1(t),n=new eui.sys.EXFunction,o="_i",a=t.attributes.id;n.name=a+o,this.currentClass.addFunction(n);var r=new eui.sys.EXCodeBlock;n.codeBlock=r;var h="t";"Object"==e?r.addVar(h,"{}"):r.addVar(h,"new "+s+"()");var l=!!this.currentClass.getVariableByName(a);l&&r.addAssignment("this."+a,h),this.addAttributesToCodeBlock(r,h,t),this.initlizeChildNode(t,r,h);var c=this.delayAssignmentDic[a];if(c)for(var u=c.length,p=0;u>p;p++){var d=c[p];r.concat(d)}return r.addReturn(h),"this."+n.name+"()"};var e=t.prototype.formatValue;t.prototype.formatValue=function(t,i,s){return"itemRendererSkinName"==t?this.formatString(i):e.call(this,t,i,s)};var i=1;t.prototype.parse=function(t){var e=null;e=egret.XML.parse(t);var s=!1,n="";e.attributes["class"]?(n=e.attributes["class"],delete e.attributes["class"],s=!!n):n="$exmlClass_"+i++;var o=this.parseClass(e,n),a=o.toCode(),r=null,h=eval;if(r=h(a),s&&r){egret.registerClass(r,n);for(var l=n.split("."),c=l.length,u=__global,p=0;c-1>p;p++){var d=l[p];u=u[d]||(u[d]={})}u[l[c-1]]||(u[l[c-1]]=r)}return e=void 0,n=void 0,a=void 0,o=void 0,h=void 0,t=void 0,r},t=void 0},t}();__reflect(FixUtil.prototype,"FixUtil");var GlobalFun=function(){function t(){}return t.checkMoney=function(t,e,i,s){switch(void 0===e&&(e=MoneyConst.yuanbao),void 0===i&&(i=""),e){case MoneyConst.gold:if(Actor.gold>=t)return!0;""==i&&(i="金币不足"),UserTips.ins().showTips(i);break;case MoneyConst.yuanbao:if(Actor.yb>=t)return!0;if(""==i&&(i="元宝不足"),UserTips.ins().showTips(i),!KFServerSys.ins().isKF){var n=WarnWin.show("元宝不足，是否前往充值？",null,null,function(){var t=Recharge.ins().getRechargeData(0);t&&2==t.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win),s&&"function"==typeof s&&s()});n.setBtnLabel("取消","前往")}default:return debug.log("检查货币类型不对，请检查=",e),!1}return!1},t}();__reflect(GlobalFun.prototype,"GlobalFun");var KeyboardUtils=function(t){function e(){var e=t.call(this)||this;if(e.key_ups=new Array,e.key_downs=new Array,DeviceUtils.IsHtml5&&LocationProperty.isLocation){var i=e;document.addEventListener("keyup",function(t){for(var e=0,s=i.key_ups.length;s>e;e++){var n=i.key_ups[e][0],o=i.key_ups[e][1];o?n.call(o,t.keyCode):n(t.keyCode)}}),document.addEventListener("keydown",function(t){for(var e=0,s=i.key_downs.length;s>e;e++){var n=i.key_downs[e][0],o=i.key_downs[e][1];o?n.call(o,t.keyCode):n(t.keyCode)}})}return e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.addKeyUp=function(t,e){this.key_ups.push([t,e])},e.prototype.addKeyDown=function(t,e){this.key_downs.push([t,e])},e.prototype.removeKeyUp=function(t,e){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==t&&this.key_ups[i][1]==e&&(this.key_ups.splice(i,1),i--)},e.prototype.removeKeyDown=function(t,e){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==t&&this.key_downs[i][1]==e&&(this.key_downs.splice(i,1),i--)},e}(BaseClass);__reflect(KeyboardUtils.prototype,"KeyboardUtils");var KeyCode=function(){function t(){}return t}();KeyCode.KC_1=49,KeyCode.KC_2=50,KeyCode.KC_3=51,KeyCode.KC_4=52,KeyCode.KC_5=53,KeyCode.KC_6=54,KeyCode.KC_7=55,KeyCode.KC_8=56,KeyCode.KC_9=57,KeyCode.KC_0=48,KeyCode.KC_A=65,KeyCode.KC_B=66,KeyCode.KC_C=67,KeyCode.KC_D=68,KeyCode.KC_E=69,KeyCode.KC_F=70,KeyCode.KC_G=71,KeyCode.KC_H=72,KeyCode.KC_I=73,KeyCode.KC_J=74,KeyCode.KC_K=75,KeyCode.KC_L=76,KeyCode.KC_M=77,KeyCode.KC_N=78,KeyCode.KC_O=79,KeyCode.KC_P=80,KeyCode.KC_Q=81,KeyCode.KC_R=82,KeyCode.KC_S=83,KeyCode.KC_T=84,KeyCode.KC_U=85,KeyCode.KC_V=86,KeyCode.KC_W=87,KeyCode.KC_X=88,KeyCode.KC_Y=89,KeyCode.KC_Z=90,KeyCode.KC_F1=112,KeyCode.KC_F2=113,KeyCode.KC_F3=114,KeyCode.KC_F4=115,KeyCode.KC_F5=116,KeyCode.KC_F6=117,KeyCode.KC_F7=118,KeyCode.KC_F8=119,KeyCode.KC_F9=120,KeyCode.KC_F10=121,KeyCode.KC_F11=122,KeyCode.KC_F12=123,KeyCode.KC_F13=124,KeyCode.KC_F14=125,KeyCode.KC_F15=126,KeyCode.KC_NUMPAD_0=96,KeyCode.KC_NUMPAD_1=97,KeyCode.KC_NUMPAD_2=98,KeyCode.KC_NUMPAD_3=99,KeyCode.KC_NUMPAD_4=100,KeyCode.KC_NUMPAD_5=101,KeyCode.KC_NUMPAD_6=102,KeyCode.KC_NUMPAD_7=103,KeyCode.KC_NUMPAD_8=104,KeyCode.KC_NUMPAD_9=105,KeyCode.KC_NUMPAD_MULTIPLY=106,KeyCode.KC_NUMPAD_ADD=107,KeyCode.KC_NUMPAD_ENTER=108,KeyCode.KC_NUMPAD_SUBTRACT=109,KeyCode.KC_NUMPAD_DECIMAL=110,KeyCode.KC_NUMPAD_DIVIDE=111,KeyCode.KC_BACKSPACE=8,KeyCode.KC_TAB=9,KeyCode.KC_ENTER=13,KeyCode.KC_SHIFT=16,KeyCode.KC_CONTROL=17,KeyCode.KC_ESCAPE=27,KeyCode.KC_SPACE=32,KeyCode.KC_WINDOWS=91,KeyCode.KC_MENU=93,KeyCode.KC_CAPS_LOCK=20,KeyCode.KC_NUM_LOCK=144,KeyCode.KC_SCROLL_LOCK=145,KeyCode.KC_PAUSE=19,KeyCode.KC_PAGE_UP=33,KeyCode.KC_PAGE_DOWN=34,KeyCode.KC_END=35,KeyCode.KC_HOME=36,KeyCode.KC_INSERT=45,KeyCode.KC_DELETE=46,KeyCode.KC_LEFT=37,KeyCode.KC_UP=38,KeyCode.KC_RIGHT=39,KeyCode.KC_DOWN=40,KeyCode.KC_SEMICOLON_COLON=186,KeyCode.KC_EQUAL_PLUS=187,KeyCode.KC_MINUS_UNDERLINE=189,KeyCode.KC_SLASH_QUESTIONMARK=191,KeyCode.KC_SPECIALCOMMA_EARTHWORM=192,KeyCode.KC_LEFT_BRACKET_BRACE=219,KeyCode.KC_BACKSLASH_VERTICALBAR=220,KeyCode.KC_RIGHT_BRACKET_BRACE=221,KeyCode.KC_QUOTE=222,KeyCode.KC_COMMA=188,KeyCode.KC_PERIOD=190,__reflect(KeyCode.prototype,"KeyCode");var LocationProperty=function(){function t(){}return t.init=function(){this.urlParam={};var e=window.paraUrl;if(e){var i=e.indexOf("?");if(-1!=i)for(var s=e.slice(i+1).split("&"),n=void 0,o=0;o<s.length;o++)n=s[o].split("="),this.urlParam[n[0]]=n[1]}var a=t.ver_res;a&&(RES_RESOURCE+=a,RES_DIR+=a,MAP_DIR+=a),RES_RESOURCE+="/",RES_DIR+="/",MAP_DIR+="/"},Object.defineProperty(t,"resAdd",{get:function(){return this.urlParam.hosts||""},set:function(t){this.urlParam.hosts=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"openID",{get:function(){return this.urlParam.user},set:function(t){this.urlParam.user=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"srvid",{get:function(){return parseInt(this.urlParam.srvid)},set:function(t){this.urlParam.srvid=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"serverIP",{get:function(){return this.urlParam.srvaddr},set:function(t){this.urlParam.srvaddr=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"serverPort",{get:function(){return this.urlParam.srvport||9001},set:function(t){this.urlParam.srvport=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"password",{get:function(){return this.urlParam.spverify||"e10adc3949ba59abbe56e057f20f883e"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"openKey",{get:function(){return this.urlParam.openkey},enumerable:!0,configurable:!0}),Object.defineProperty(t,"zoneId",{get:function(){return this.urlParam.zoneid},enumerable:!0,configurable:!0}),Object.defineProperty(t,"serverID",{get:function(){return this.urlParam.serverid},enumerable:!0,configurable:!0}),Object.defineProperty(t,"appid",{get:function(){return this.urlParam.appid||""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"app_openid",{get:function(){return this.urlParam.app_openid||""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isSubscribe",{get:function(){return this.urlParam.isSubscribe},enumerable:!0,configurable:!0}),Object.defineProperty(t,"nickName",{get:function(){var t=this.urlParam.nickName||"";try{return t.length?decodeURIComponent(t):t}catch(e){return t}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"callUrl",{get:function(){var t=this.urlParam.callUrl||"";return t.length?decodeURIComponent(t):t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"gifi",{get:function(){return this.urlParam.gifi},enumerable:!0,configurable:!0}),Object.defineProperty(t,"roleCount",{get:function(){return parseInt(this.urlParam.roleCount)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isnew",{get:function(){return parseInt(this.urlParam.isnew)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"login_ip",{get:function(){return this.urlParam.login_ip},enumerable:!0,configurable:!0}),Object.defineProperty(t,"is_attention",{get:function(){return this.urlParam.is_attention},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isShowShare",{get:function(){return window.isShowShare},enumerable:!0,configurable:!0}),Object.defineProperty(t,"v",{get:function(){return parseInt(this.urlParam.v)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isYelloVip",{get:function(){return parseInt(this.urlParam.isYelloVip)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isYelloYearVip",{get:function(){return parseInt(this.urlParam.isYelloYearVip)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"yelloVipLevel",{get:function(){return parseInt(this.urlParam.yelloVipLevel)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isYelloHighVip",{get:function(){return parseInt(this.urlParam.isYelloHighVip)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"logurl",{get:function(){return decodeURIComponent(this.urlParam.logurl)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isFirstLoad",{get:function(){return!t.isLocation&&0==t.roleCount},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loadurl",{get:function(){return decodeURIComponent(this.urlParam.loadurl)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pfid",{get:function(){return this.urlParam.pfid||""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pf",{get:function(){return this.urlParam.pf||""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ver_res",{get:function(){return this.urlParam.ver_res?parseInt(this.urlParam.ver_res):0},enumerable:!0,configurable:!0}),t.isCanLogin=function(){return null!=this.openID&&null!=this.password&&null!=this.srvid&&null!=this.serverIP&&null!=this.serverPort},Object.defineProperty(t,"isLocation",{get:function(){return location.href.indexOf("192.168.201")>=0||location.href.indexOf("127.0.0.1")>=0||location.href.indexOf("localhost")>=0||location.href.indexOf("cq.api.com")>=0||location.href.indexOf("10.10.1")>=0||location.href.indexOf("10.10.4")>=0},enumerable:!0,configurable:!0}),t.setLoadProgress=function(t,e){GameLoadingUI.GetInstance().setProgress(t,e)},t}();__reflect(LocationProperty.prototype,"LocationProperty");var Log=function(){function t(){}return t.trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DebugUtils.isDebug&&(t[0]="[DebugLog]"+t[0],debug.log.apply(console,t))},t}();__reflect(Log.prototype,"Log");var MathUtils=function(){function t(){}return t.getAngle=function(t){return 180*t/Math.PI},t.getRadian=function(t){return t/180*Math.PI},t.getRadian2=function(t,e,i,s){var n=i-t,o=s-e;return Math.atan2(o,n)},t.getDistance=function(t,e,i,s){var n=i-t,o=s-e,a=n*n+o*o;return Math.sqrt(a)},t.getDistanceByObject=function(t,e){return this.getDistance(t.x,t.y,e.x,e.y)},t.getDistanceX2ByObject=function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},t.getDirMove=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var n=this.getRadian(t),o={x:0,y:0};return o.x=Math.cos(n)*e+i,o.y=Math.sin(n)*e+s,o},t.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var i=e-t;return t+Math.random()*i},t.limitInteger=function(t,e){return Math.round(this.limit(t,e))},t.randomArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},t.toInteger=function(t){return t>>0},t}();__reflect(MathUtils.prototype,"MathUtils");var md5=function(){function t(){}return t.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.any_hmac_md5=function(t,e,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},t.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.rstr_hmac_md5=function(t,e){var i=this.rstr2binl(t);i.length>16&&(i=this.binl_md5(i,8*t.length));for(var s=Array(16),n=Array(16),o=0;16>o;o++)s[o]=909522486^i[o],n[o]=1549556828^i[o];var a=this.binl_md5(s.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(n.concat(a),640))},t.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,s=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",o=0;o<t.length;o++)i=t.charCodeAt(o),n+=s.charAt(i>>>4&15)+s.charAt(15&i);return n},t.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="",n=t.length,o=0;n>o;o+=3)for(var a=t.charCodeAt(o)<<16|(n>o+1?t.charCodeAt(o+1)<<8:0)|(n>o+2?t.charCodeAt(o+2):0),r=0;4>r;r++)s+=8*o+6*r>8*t.length?this.b64pad:i.charAt(a>>>6*(3-r)&63);return s},t.rstr2any=function(t,e){var i,s,n,o,a,r=e.length,h=Array(Math.ceil(t.length/2));for(i=0;i<h.length;i++)h[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);var l=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),c=Array(l);for(s=0;l>s;s++){for(a=Array(),o=0,i=0;i<h.length;i++)o=(o<<16)+h[i],n=Math.floor(o/r),o-=n*r,(a.length>0||n>0)&&(a[a.length]=n);c[s]=o,h=a}var u="";for(i=c.length-1;i>=0;i--)u+=e.charAt(c[i]);return u},t.str2rstr_utf8=function(t){for(var e,i,s="",n=-1;++n<t.length;)e=t.charCodeAt(n),i=n+1<t.length?t.charCodeAt(n+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),n++),127>=e?s+=String.fromCharCode(e):2047>=e?s+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?s+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(s+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return s},t.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},t.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},t.rstr2binl=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e},t.binl2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},t.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,s=-271733879,n=-1732584194,o=271733878,a=0;a<t.length;a+=16){var r=i,h=s,l=n,c=o;i=this.md5_ff(i,s,n,o,t[a+0],7,-680876936),o=this.md5_ff(o,i,s,n,t[a+1],12,-389564586),n=this.md5_ff(n,o,i,s,t[a+2],17,606105819),s=this.md5_ff(s,n,o,i,t[a+3],22,-1044525330),i=this.md5_ff(i,s,n,o,t[a+4],7,-176418897),o=this.md5_ff(o,i,s,n,t[a+5],12,1200080426),n=this.md5_ff(n,o,i,s,t[a+6],17,-1473231341),s=this.md5_ff(s,n,o,i,t[a+7],22,-45705983),i=this.md5_ff(i,s,n,o,t[a+8],7,1770035416),o=this.md5_ff(o,i,s,n,t[a+9],12,-1958414417),n=this.md5_ff(n,o,i,s,t[a+10],17,-42063),s=this.md5_ff(s,n,o,i,t[a+11],22,-1990404162),i=this.md5_ff(i,s,n,o,t[a+12],7,1804603682),o=this.md5_ff(o,i,s,n,t[a+13],12,-40341101),n=this.md5_ff(n,o,i,s,t[a+14],17,-1502002290),s=this.md5_ff(s,n,o,i,t[a+15],22,1236535329),i=this.md5_gg(i,s,n,o,t[a+1],5,-165796510),o=this.md5_gg(o,i,s,n,t[a+6],9,-1069501632),n=this.md5_gg(n,o,i,s,t[a+11],14,643717713),s=this.md5_gg(s,n,o,i,t[a+0],20,-373897302),i=this.md5_gg(i,s,n,o,t[a+5],5,-701558691),o=this.md5_gg(o,i,s,n,t[a+10],9,38016083),n=this.md5_gg(n,o,i,s,t[a+15],14,-660478335),s=this.md5_gg(s,n,o,i,t[a+4],20,-405537848),i=this.md5_gg(i,s,n,o,t[a+9],5,568446438),o=this.md5_gg(o,i,s,n,t[a+14],9,-1019803690),n=this.md5_gg(n,o,i,s,t[a+3],14,-187363961),s=this.md5_gg(s,n,o,i,t[a+8],20,1163531501),i=this.md5_gg(i,s,n,o,t[a+13],5,-1444681467),o=this.md5_gg(o,i,s,n,t[a+2],9,-51403784),n=this.md5_gg(n,o,i,s,t[a+7],14,1735328473),s=this.md5_gg(s,n,o,i,t[a+12],20,-1926607734),i=this.md5_hh(i,s,n,o,t[a+5],4,-378558),o=this.md5_hh(o,i,s,n,t[a+8],11,-2022574463),n=this.md5_hh(n,o,i,s,t[a+11],16,1839030562),s=this.md5_hh(s,n,o,i,t[a+14],23,-35309556),i=this.md5_hh(i,s,n,o,t[a+1],4,-1530992060),o=this.md5_hh(o,i,s,n,t[a+4],11,1272893353),n=this.md5_hh(n,o,i,s,t[a+7],16,-155497632),s=this.md5_hh(s,n,o,i,t[a+10],23,-1094730640),i=this.md5_hh(i,s,n,o,t[a+13],4,681279174),o=this.md5_hh(o,i,s,n,t[a+0],11,-358537222),n=this.md5_hh(n,o,i,s,t[a+3],16,-722521979),s=this.md5_hh(s,n,o,i,t[a+6],23,76029189),i=this.md5_hh(i,s,n,o,t[a+9],4,-640364487),o=this.md5_hh(o,i,s,n,t[a+12],11,-421815835),n=this.md5_hh(n,o,i,s,t[a+15],16,530742520),s=this.md5_hh(s,n,o,i,t[a+2],23,-995338651),i=this.md5_ii(i,s,n,o,t[a+0],6,-198630844),o=this.md5_ii(o,i,s,n,t[a+7],10,1126891415),n=this.md5_ii(n,o,i,s,t[a+14],15,-1416354905),s=this.md5_ii(s,n,o,i,t[a+5],21,-57434055),i=this.md5_ii(i,s,n,o,t[a+12],6,1700485571),o=this.md5_ii(o,i,s,n,t[a+3],10,-1894986606),n=this.md5_ii(n,o,i,s,t[a+10],15,-1051523),s=this.md5_ii(s,n,o,i,t[a+1],21,-2054922799),i=this.md5_ii(i,s,n,o,t[a+8],6,1873313359),o=this.md5_ii(o,i,s,n,t[a+15],10,-30611744),n=this.md5_ii(n,o,i,s,t[a+6],15,-1560198380),s=this.md5_ii(s,n,o,i,t[a+13],21,1309151649),i=this.md5_ii(i,s,n,o,t[a+4],6,-145523070),o=this.md5_ii(o,i,s,n,t[a+11],10,-1120210379),n=this.md5_ii(n,o,i,s,t[a+2],15,718787259),s=this.md5_ii(s,n,o,i,t[a+9],21,-343485551),i=this.safe_add(i,r),s=this.safe_add(s,h),n=this.safe_add(n,l),o=this.safe_add(o,c)}return[i,s,n,o]},t.md5_cmn=function(t,e,i,s,n,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(s,o)),n),i)},t.md5_ff=function(t,e,i,s,n,o,a){return this.md5_cmn(e&i|~e&s,t,e,n,o,a)},t.md5_gg=function(t,e,i,s,n,o,a){return this.md5_cmn(e&s|i&~s,t,e,n,o,a)},t.md5_hh=function(t,e,i,s,n,o,a){return this.md5_cmn(e^i^s,t,e,n,o,a)},t.md5_ii=function(t,e,i,s,n,o,a){return this.md5_cmn(i^(e|~s),t,e,n,o,a)},t.safe_add=function(t,e){var i=(65535&t)+(65535&e),s=(t>>16)+(e>>16)+(i>>16);return s<<16|65535&i},t.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();md5.hexcase=0,md5.b64pad="",__reflect(md5.prototype,"md5");var PageArray=function(){function t(t,e){void 0===e&&(e=20),this.dataSource=t,this.size=e,this.currentPage=0,this.setPageData()}return Object.defineProperty(t.prototype,"length",{get:function(){return this.dataSource.length},enumerable:!0,configurable:!0}),t.prototype.setPageData=function(){this.pageData=[];for(var t=this.currentPage*this.size,e=(this.currentPage+1)*this.size,i=Math.min(this.length,e),s=t;i>s;s++)this.pageData.push(this.dataSource[s])},t.prototype.getDataSource=function(){return this.dataSource},Object.defineProperty(t.prototype,"totalPage",{get:function(){return Math.ceil(this.length/this.size)},enumerable:!0,configurable:!0}),t.prototype.havePre=function(){return 0!=this.currentPage},t.prototype.haveNext=function(){return this.currentPage<this.totalPage-1},t.prototype.prev=function(){this.currentPage--,this.setPageData()},t.prototype.next=function(){this.currentPage++,this.setPageData()},t.prototype.first=function(){this.currentPage=0,this.setPageData()},t.prototype.last=function(){this.currentPage=this.totalPage-1,this.setPageData()},t.prototype.gotoPage=function(t){this.totalPage<t||(this.currentPage=t-1,this.setPageData())},t}();__reflect(PageArray.prototype,"PageArray");var RegExpUtil=function(){function t(){}return t}();RegExpUtil.LINE_BREAK=/\r+/g,RegExpUtil.BLANK_REG=/[\s\\]/g,RegExpUtil.ARGB_COLOR=/[a-fA-F0-9]{8}/,RegExpUtil.HTML=/<[^>]+>/g,RegExpUtil.DELETE_SPACE=/\s/g,RegExpUtil.REPLACE_STRING=/%s/g,RegExpUtil.NumericExp=/^\d+$/,RegExpUtil.NonNumericExp=/\D/,RegExpUtil.ActorNameExp=/^([\u4e00-\u9fa5]?\w?[^>|!@#$%&*\^\?]){1,48}$/,__reflect(RegExpUtil.prototype,"RegExpUtil");var ResourceUtils=function(t){function e(){var e=t.call(this)||this;return e._groupIndex=0,e._configs=new Array,e._groups={},e._urlResorce={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,e.onResourceLoadComplete,e),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,e.onResourceLoadProgress,e),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,e.onResourceLoadError,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.addConfig=function(t,e){this._configs.push([t,e])},e.prototype.loadConfig=function(t,e){this._onConfigComplete=t,this._onConfigCompleteTarget=e,this.loadNextConfig()},e.prototype.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var t=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},e.prototype.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},e.prototype.loadGroup=function(t,e,i,s){this._groups[t]=[e,i,s],RES.loadGroup(t)},e.prototype.loadGroups=function(t,e,i,s,n){RES.createGroup(t,e,!0),this.loadGroup(t,i,s,n)},e.prototype.pilfererLoadGroup=function(t,e){void 0===e&&(e=null);var i="pilferer_"+t;e||(e=[t]),RES.createGroup(i,e,!0),RES.loadGroup(i,-1)},e.prototype.onResourceLoadComplete=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][0],s=this._groups[e][2];null!=i&&i.call(s),this._groups[e]=null,delete this._groups[e]}},e.prototype.onResourceLoadProgress=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][1],s=this._groups[e][2];null!=i&&i.call(s,t.itemsLoaded,t.itemsTotal)}},e.prototype.onResourceLoadError=function(t){return Log.trace(t.groupName+"资源组有资源加载失败"),"preload"==t.groupName?(GameApp.ins().preload_load_count+=1,1==GameApp.ins().preload_load_count&&Assert(!1,t.groupName+" 资源加载失败!!失败次数："+GameApp.ins().preload_load_count),void(GameApp.ins().preload_load_count<3?RES.loadGroup(t.groupName):alert("资源加载失败，请检查网络重新登录"))):void this.onResourceLoadComplete(t)},e.prototype.loadResource=function(t,e,i,s,n){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null);var o=t.concat(e),a="loadGroup"+this._groupIndex++;RES.createGroup(a,o,!0),this._groups[a]=[i,s,n],RES.loadGroup(a)},e.prototype.loadUrlResource=function(t,e,i,s){var n=this;null==this._urlResorce[t]?(this._urlResorce[t]={data:null,compFun:i,thisObj:s},RES.getResByUrl(t,function(e){n._urlResorce[t].data=e,null!=i&&i.apply(n._urlResorce[t].thisObj)},this,e)):null!=i&&i.apply(s)},e.prototype.getUrlResource=function(t){return null==this._urlResorce[t]?(debug.log("资源未加载"),null):this._urlResorce[t].data},e}(BaseClass);__reflect(ResourceUtils.prototype,"ResourceUtils");var StageUtils=function(t){function e(){var i=t.call(this)||this;return null==e._uiStage&&(e._uiStage=new eui.UILayer,e._uiStage.touchEnabled=!1,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,i.getStage().addChild(e._uiStage)),i}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getHeight=function(){return this.getStage().stageHeight},e.prototype.getWidth=function(){return this.getStage().stageWidth},e.prototype.setTouchChildren=function(t){this.getStage().touchChildren=t},e.prototype.setMaxTouches=function(t){this.getStage().maxTouches=t},e.prototype.setFrameRate=function(t){this.getStage().frameRate=t},e.prototype.setScaleMode=function(t){this.getStage().scaleMode=t},e.prototype.getStage=function(){return egret.MainContext.instance.stage},e.prototype.getUIStage=function(){return e._uiStage},e}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var StringUtils=function(){function t(){}return t.trimSpace=function(t){return t.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},t.getStringLength=function(t){for(var e=t.split(""),i=0,s=0;s<e.length;s++){var n=e[s];i+=this.isChinese(n)?2:1}return i},t.isChinese=function(t){var e=/^[\u4E00-\u9FA5]+$/;return e.test(t)?!1:!0},t.strByteLen=function(t){for(var e=0,i=t.length,s=0;i>s;s++)e+=t.charCodeAt(s)>=127?2:1;return e},t.complementByChar=function(e,i,s,n){void 0===s&&(s=" "),void 0===n&&(n=!0);var o=this.strByteLen(n?e.replace(t.HTML,""):e);return e+this.repeatStr(s,i-o)},t.repeatStr=function(t,e){for(var i="",s=0;e>s;s++)i+=t;return i},t.addColor=function(t,e){var i;return"string"==typeof e?i=String(e):"number"==typeof e&&(i=Number(e).toString(10)),'<font color="'+i+'">'+t+"</font>"},t.addColor1=function(t,e){var i=new Object;return i.style=new Object,i.text=t,i.textColor=Number(e).toString(16),i},t.substitute=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];
var s=RegExpUtil.REPLACE_STRING,n=t.match(s);if(n&&n.length)for(var o=n.length,a=0;o>a;a++)t=t.replace(n[a],e[a]);return t},t.replaceStr=function(t,e,i){if(-1==t.indexOf(e))return t;var s=t.split(e);return s[0]+i+s[1]},t.replaceStrColor=function(t,e){for(var i=t.indexOf("0x"),s=i,n="",o="";-1!=s;)n=t.substring(i,i+8),t=t.replace(n,e),i+=8,o=t.substring(i),s=o.indexOf("0x"),i+=s;return t},t.replace=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var s=0;s<e.length;s++)t=t.replace("%s",e[s]+"");return t},t.getStrByRegExp=function(t,e){void 0===e&&(e=/\d+/g);var i=[];t.replace(e,function(){return i.push(arguments[0]),"number"==typeof arguments[0]?arguments[0].toString():arguments[0]});return i},t.ChineseToNumber=function(e){for(var i=0,s=0,n=0,o=!1,a=e.split(""),r=0;r<a.length;r++){var h=t.chnNumCharCN[a[r]];if("undefined"!=typeof h)n=h,r===a.length-1&&(s+=n);else{var l=t.chnNameValueCN[a[r]].value;o=t.chnNameValueCN[a[r]].secUnit,o?(s=(s+n)*l,i+=s,s=0):s+=n*l,n=0}}return i+s},t.NumberToChinese=function(e){var i=0,s="",n="",o=!1,a=t.chnNumChar,r=t.chnUnitSection;if(0===e)return a[0];for(;e>0;){var h=e%1e4;o&&(n=a[0]+n),s=t.SectionToChinese(h),s+=0!==h?r[i]:r[0],n=s+n,o=1e3>h&&h>0,e=Math.floor(e/1e4),i++}return n},t.SectionToChinese=function(e){for(var i="",s="",n=0,o=!0,a=t.chnNumChar,r=t.chnUnitChar;e>0;){var h=e%10;0===h?o||(o=!0,s=a[h]+s):(o=!1,i=a[h],i+=r[n],s=i+s),n++,e=Math.floor(e/10)}return s},t}();StringUtils.HTML=/<[^>]+>/g,StringUtils.chnNumCharCN={"零":0,"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},StringUtils.chnNameValueCN={"十":{value:10,secUnit:!1},"百":{value:100,secUnit:!1},"千":{value:1e3,secUnit:!1},"万":{value:1e4,secUnit:!0},"亿":{value:1e8,secUnit:!0}},StringUtils.chnNumChar=["零","一","二","三","四","五","六","七","八","九"],StringUtils.chnUnitSection=["","万","亿","万亿","亿亿"],StringUtils.chnUnitChar=["","十","百","千"],__reflect(StringUtils.prototype,"StringUtils");var TextFlowMaker=function(){function t(){}return t.generateTextFlow=function(e){if(!e)return(new egret.HtmlTextParser).parser("");for(var i,s=e.split("|"),n="",o=0,a=s.length;a>o;o++)n+=t.getSingleTextFlow1(s[o]);try{i=(new egret.HtmlTextParser).parser(n)}catch(r){return console.log("错误的HTML输入"),(new egret.HtmlTextParser).parser("")}return i},t.generateTextFlow1=function(e){if(!e)return(new egret.HtmlTextParser).parser("");for(var i=e.split("|"),s=[],n=0,o=i.length;o>n;n++){var a=t.getSingleTextFlow(i[n]);a.text&&""!=a.text&&s.push(a)}return s},t.getSingleTextFlow1=function(e){var i=e.split("&T:",2);if(2==i.length){for(var s="<font",n=i[0].split("&"),o=void 0,a=!1,r=0,h=n.length;h>r;r++)switch(o=n[r].split(":"),o[0]){case t.STYLE_SIZE:s+=' size="'+Math.floor(+o[1])+'"';break;case t.STYLE_COLOR:s+=' color="'+Math.floor(+o[1])+'"';break;case t.UNDERLINE_TEXT:a=!0}return s+=a?"><u>"+i[1]+"</u></font>":">"+i[1]+"</font>"}return"<font>"+e+"</font>"},t.getSingleTextFlow=function(e){var i=e.split("&T:",2),s={style:{}};if(2==i.length){for(var n=(i[0],e.split("&")),o=void 0,a=0,r=n.length;r>a;a++)switch(o=n[a].split(":"),o[0]){case t.STYLE_SIZE:s.style.size=+o[1];break;case t.STYLE_COLOR:s.style.textColor=+o[1];break;case t.UNDERLINE_TEXT:s.style.underline=!0;break;case t.EVENT:s.style.href="event:"+o[1]}s.text=i[1]}else s.text=e;return s},t.getCStr=function(e){return t.numberList[e]?t.numberList[e]:""},t}();TextFlowMaker.STYLE_COLOR="C",TextFlowMaker.STYLE_SIZE="S",TextFlowMaker.PROP_TEXT="T",TextFlowMaker.UNDERLINE_TEXT="U",TextFlowMaker.EVENT="E",TextFlowMaker.numberList=["零","一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十"],__reflect(TextFlowMaker.prototype,"TextFlowMaker");var uint64=function(){function t(t){this._lowUint=0,this._highUint=0,this.value=t}return t.prototype.isEqual=function(t){return t?this._lowUint==t._lowUint&&this._highUint==t._highUint:!1},t.prototype.isGreaterThan=function(e){if(e instanceof t)return this._highUint>e._highUint||this._highUint==e._highUint&&this._lowUint>e._lowUint;var i=new t;return"string"==typeof e?(i.value=e,this.isGreaterThanOrEqual(i)):"number"==typeof e?(i.value=e.toString(),this.isGreaterThanOrEqual(i)):void 0},t.prototype.isGreaterThanOrEqual=function(e){if(e instanceof t)return this._highUint>e._highUint||this._highUint==e._highUint&&this._lowUint>=e._lowUint;var i=new t;return"string"==typeof e?(i.value=e,this.isGreaterThanOrEqual(i)):"number"==typeof e?(i.value=e.toString(),this.isGreaterThanOrEqual(i)):void 0},Object.defineProperty(t.prototype,"isZero",{get:function(){return 0==this._lowUint&&0==this._highUint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGreaterThanZero",{get:function(){return this._lowUint>0||this._highUint>0},enumerable:!0,configurable:!0}),t.prototype.writeByte=function(t){t.writeUnsignedInt(this._lowUint),t.writeUnsignedInt(this._highUint)},t.prototype.setValue=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._lowUint=t,this._highUint=e},Object.defineProperty(t.prototype,"value",{set:function(e){e instanceof egret.ByteArray?(this._lowUint=e.readUnsignedInt(),this._highUint=e.readUnsignedInt()):"string"==typeof e&&t.stringToUint64(e,10,this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueByString",{set:function(t){},enumerable:!0,configurable:!0}),t.prototype.leftMove=function(e,i){void 0===i&&(i=null),i=i||this;var s=t.LeftMoveMask[e],n=s&this._lowUint;n>>>=32-e,i._lowUint=this._lowUint<<e,i._highUint=this._highUint<<e,i._highUint=i._highUint|n},t.prototype.add=function(e,i){void 0===i&&(i=null),i=i||this;var s=this._lowUint+e._lowUint;i._highUint=this._highUint+e._highUint,s>=t.MaxLowUint?(i._highUint++,i._lowUint=s-t.MaxLowUint):i._lowUint=s},t.prototype.subtraction=function(e,i){void 0===i&&(i=null),i=i||this;var s=this._lowUint-e._lowUint;i._highUint=this._highUint-e._highUint,0>s?(i._highUint--,i._lowUint=s+t.MaxLowUint):i._lowUint=s},t.prototype.scale=function(e,i){void 0===i&&(i=null),i=i||this;var s=this._lowUint*e;i._highUint=this._highUint*e,i._highUint+=Math.floor(Math.abs(s/t.MaxLowUint)),i._lowUint=s%t.MaxLowUint},t.prototype.toString=function(e){void 0===e&&(e=10);for(var i,s,n,o="",a=this._lowUint,r=this._highUint;0!=r||0!=a;)i=r%e,n=i*t.MaxLowUint+a,s=n%e,o=s+o,r=(r-i)/e,a=(n-s)/e;return o.length?o:"0"},t.stringToUint64=function(e,i,s){void 0===i&&(i=10),void 0===s&&(s=null),s=s||new t;for(var n,o,a=0,r=0,h=e.length,l=0;h>l;l++)o=parseInt(e.charAt(l)),n=a*i+o,r=r*i+Math.floor(n/t.MaxLowUint),a=n%t.MaxLowUint;return s.setValue(a,r),s},t}();uint64.LeftMoveMask=[0,2147483648,1073741824,536870912,268435456,134217728,67108864,33554432,16777216,8388608,4194304,2097152,1048576,524288,262144,131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],uint64.MaxLowUint=4294967296,__reflect(uint64.prototype,"uint64");var WatcherUtil=function(){function t(){}return t.removeFromArrayCollection=function(e){e&&e.source&&e.source.length&&t.removeFromArray(e.source)},t.removeFromArray=function(e){if(e)for(var i=0,s=e;i<s.length;i++){var n=s[i];t.removeFromObject(n)}},t.removeFromObject=function(t){if(t instanceof egret.EventDispatcher){var e=t.$getEventMap(),i=e[eui.PropertyEvent.PROPERTY_CHANGE];if(i)for(var s=i.length-1;s>=0;s--){var n=i[s];n.thisObject instanceof eui.Watcher&&(n.thisObject.unwatch(),i.splice(s,1))}}else{var o=t.__listeners__;if(o&&o.length)for(var a=0;a<o.length;a+=2){var r=o[a+1];r instanceof eui.Watcher&&(r.unwatch(),a-=2)}}},t}();__reflect(WatcherUtil.prototype,"WatcherUtil");var ObjectPool=function(){function t(){this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t._content[e]||(t._content[e]=[]);var n=t._content[e];if(n.length){var o=n.pop();return o}var a=egret.getDefinitionByName(e),r=i.length,h=void 0;return 0==r?h=new a:1==r?h=new a(i[0]):2==r?h=new a(i[0],i[1]):3==r?h=new a(i[0],i[1],i[2]):4==r?h=new a(i[0],i[1],i[2],i[3]):5==r&&(h=new a(i[0],i[1],i[2],i[3],i[4])),h.ObjectPoolKey=e,h},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var s,n=t._content[e];if(n.length)for(var o=0;o<n.length;o++)if(n[o].extraKey==i){s=n[o],n.splice(o,1);break}if(!s){var a=egret.getDefinitionByName(e);s=new a(i),s.extraKey=i,s.ObjectPoolKey=e}return s},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey;return!t._content[i]||t._content[i].indexOf(e)>-1?!1:(t._content[i].push(e),!0)},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var s=t._content[e];s&&s.length;){var n=s.pop();i&&n[i](),n=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var s=t._content[e];if(null!=s){var n=0,o=s.length;for(n;o>n;n++)s[n][i]()}},t}();ObjectPool._content={},__reflect(ObjectPool.prototype,"ObjectPool");var RenderTextureManager=function(t){function e(){var e=t.call(this)||this;return e._pool=[],e._useNum=0,e.isLowerQQBrowser()?e._maxNum=18:e._maxNum=-1,e}return __extends(e,t),e.prototype.isLowerQQBrowser=function(){if(DeviceUtils.IsQQBrowser){for(var t=["2013022","Lenovo A630t","SM-G3818","vivo X3t","GT-I9100"],e=!1,i=0,s=t.length;s>i;i++)if(-1!=navigator.userAgent.indexOf(t[i])){e=!0;break}return e}return!1},e.prototype.pop=function(){var t=this._pool.pop();return t||(-1==this._maxNum||this._useNum<this._maxNum)&&(t=new egret.RenderTexture,this._useNum++),t},e.prototype.push=function(t){for(var e=!1,i=0,s=this._pool.length;s>i;i++)if(this._pool[i]==t){e=!0;break}e||this._pool.push(t)},e}(BaseClass);__reflect(RenderTextureManager.prototype,"RenderTextureManager");var ResultManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.create=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=t?t:GameMap.fbType;switch(s){case UserFb.FB_TYPE_PERSONAL:case UserFb.FB_TYPE_GUARD_WEAPON:(n=ViewManager.ins()).open.apply(n,[PersonalResultWin].concat(e));break;case UserFb.FB_TYPE_TIAOZHAN:(o=ViewManager.ins()).open.apply(o,[TongResultWin].concat(e));break;case UserFb.FB_TYPE_FIRE_RING:case UserFb.FB_TYPE_MATERIAL:s==UserFb.FB_TYPE_FIRE_RING&&void 0!=e&&void 0!=e[0]&&0==e[0]&&Activity.ins().removeEvent(),(a=ViewManager.ins()).open.apply(a,[MaterialResultWin].concat(e));break;case UserFb.FB_TYPE_NEW_WORLD_BOSS:ViewManager.ins().open(NewWorldBossResultPanel);break;case UserFb.FB_TYPE_CITY:ViewManager.ins().open(CityResultWin,e[1],e[4]);break;case UserFb.FB_TYPE_ALLHUMENBOSS:case UserFb.FB_TYPE_ZHUANSHENGBOSS:case UserFb.FB_TYPE_HOMEBOSS:case UserFb.FB_TYPE_LABA:case UserFb.FB_TYPE_DARK_BOSS:case UserFb.FB_TYPE_HIDE_BOSS:ViewManager.ins().open(BossResultWin,e[1],e[4]);break;case UserFb.FB_TYPE_GOD_WEAPON:case UserFb.FB_TYPE_GOD_WEAPON_TOP:break;case UserFb.FB_TYPE_KF_BOSS:ViewManager.ins().open(KFBossResultWin,e[0],e[1]);break;default:(r=ViewManager.ins()).open.apply(r,[ResultWin].concat(e))}var n,o,a,r},e}(BaseClass);__reflect(ResultManager.prototype,"ResultManager");var BaseSpriteView=function(t){function e(e){var i=t.call(this)||this;return i._resources=null,i._myParent=e,i._isInit=!1,StageUtils.ins().getStage().addEventListener(egret.Event.RESIZE,i.onResize,i),i}return __extends(e,t),e.prototype.setResources=function(t){this._resources=t},Object.defineProperty(e.prototype,"myParent",{get:function(){return this._myParent},enumerable:!0,configurable:!0}),e.prototype.isInit=function(){return this._isInit},e.prototype.isShow=function(){return null!=this.stage&&this.visible},e.prototype.addToParent=function(){this._myParent.addChild(this)},e.prototype.removeFromParent=function(){DisplayUtils.removeFromParent(this)},e.prototype.initUI=function(){this._isInit=!0},e.prototype.initData=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.destroy=function(){this._myParent=null,this._resources=null},e.prototype.onResize=function(){},e.prototype.loadResource=function(t,e){this._resources&&this._resources.length>0?ResourceUtils.ins().loadResource(this._resources,[],function(){t(),e()},null,this):(t(),e())},e.prototype.setVisible=function(t){this.visible=t},e.openCheck=function(){return!0},e}(egret.DisplayObjectContainer);__reflect(BaseSpriteView.prototype,"BaseSpriteView",["IBaseView"]);var ResVersionManager=function(t){function e(){var e=t.call(this)||this;return e.res_loadByVersion(),e.resVersionData=window.verData,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.has=function(t){return this.resVersionData.hasOwnProperty(t)},e.prototype.getDir=function(t){return this.resVersionData[t]},e.prototype.hasVer=function(){return!isNaN(LocationProperty.v)},e.prototype.res_loadByVersion=function(){RES.web.Html5VersionController.prototype.getVirtualUrl=function(t){var i=e.ins();if(i.hasVer())if(i.has(t)){var s=i.getDir(t);t=""+LocationProperty.resAdd+s+"/"+t}else t=LocationProperty.resAdd+"0/"+t;else t=""+LocationProperty.resAdd+t;return t}},e.prototype.loadConfig=function(t,e){if(this.complateFunc=t,this.complateFuncTarget=e,this.resVersionData)return void this.complateFunc.call(this.complateFuncTarget);if(this.hasVer()){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.ARRAY_BUFFER;var s=function(t){switch(t.type){case egret.Event.COMPLETE:break;case egret.IOErrorEvent.IO_ERROR:debug.log("respHandler io error")}};return i.once(egret.Event.COMPLETE,s,this),i.once(egret.IOErrorEvent.IO_ERROR,s,this),i.open(""+LocationProperty.resAdd+LocationProperty.v+"/"+LocationProperty.v+".ver",egret.HttpMethod.GET),void i.send()}this.complateFunc.call(this.complateFuncTarget)},e}(BaseClass);__reflect(ResVersionManager.prototype,"ResVersionManager");var AIUtil=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.userSkill=function(t,e,i,s){return void 0===s&&(s=null),t!=e&&(t.dir=DirUtil.get8DirBy2Point(t,e)),i?(GameLogic.ins().playSkillEff(i,t,[e],s),!SoundUtil.WINDOW_OPEN&&i.sound&&t.team==Team.My&&SoundUtil.ins().playEffect(i.sound),!0):!1},e.prototype.hram=function(t,e,i,s){void 0===s&&(s=0),e.hram(s),GameLogic.ins().postEntityHpChange(e,t,i,s),e.getHP()<=0&&this.relive(e)},e.prototype.relive=function(t){if(t instanceof CharRole&&!t.hasBuff(52001)){var e=t.infoModel.attributeExData[ExAttributeType.eatGodBlessProbability],i=Math.random();if(e/1e4>i)return t.reset(),t.removeAllBuff(),i=t.infoModel.getAtt(AttributeType.atMaxHp)*t.infoModel.attributeExData[ExAttributeType.eatGodBlessRate]/1e4,t.hram(i),!0}return!1},e.dead=function(t,e){void 0===e&&(e=null),t.AI_STATE=AI_State.Die;var i=EntityManager.ins();i.removeByHandle(t.infoModel.handle,!1,GameMap.fbType==UserFb.FB_TYPE_EXP),TimerManager.ins().doTimer(5e3,1,function(){DisplayUtils.removeFromParent(t),e&&e()},this)},e}(BaseClass);__reflect(AIUtil.prototype,"AIUtil");var ExSkillAiLogic=function(t){function e(){var e=t.call(this)||this;return e.ZL_SKILL_DEVIL=0,e.ZL_SKILL_EXPLOSION=1,e.ZL_SKILL_KILL=2,e.ZL_SKILL_SACRIFICE=3,e.ZL_SKILL_RELIEF=4,e.ZL_SKILL_ANGER=5,e.ZL_H_SKILL_DETER=6,e.ZL_H_SKILL_ANTICIPATI=7,e.ZL_SKILL_REMEDY=8,e.ZL_SKILL_RENJIA=9,e.MAX=10,e.triggerInterval={},e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkWarSpiritBubbleTrigger=function(){if(ZhanLingModel.ins().ZhanLingOpen())for(var t in GlobalConfig.ZhanLingBase){var e=GlobalConfig.ZhanLingBase[t],i=ZhanLingModel.ins().getZhanLingDataById(e.id);if(i)switch(e.talent){case this.ZL_SKILL_DEVIL:if(!GlobalConfig.ZhanLingLevel[e.id][i.level])break;var s=GlobalConfig.ZhanLingLevel[e.id][i.level].talentLevel,n=GlobalConfig.ZhanLingTalent[e.talent][s];if(n&&GameLogic.triggerValue(n.rate)){UserSkill.ins().postShowSkillWord(n.showWords);for(var o=0;o<SubRoles.ins().subRolesLen;o++){var a=EntityManager.ins().getMainRole(o);if(a){var r=EntityBuff.createBuff(n.effId,a);a.addBuff(r)}}}break;case this.ZL_SKILL_REMEDY:if(s=ZhanLingModel.ins().getZhanLingDataByTalentLv(e.id),n=GlobalConfig.ZhanLingTalent[e.talent][s],GameLogic.triggerValue(n.rate))for(var o=0;o<SubRoles.ins().subRolesLen;o++){var a=EntityManager.ins().getMainRole(o);if(a){var r=EntityBuff.createBuff(n.effId,a);a.addBuff(r)}}}}},e.prototype.checkHJTrigger=function(t,e){if(ZhanLingModel.ins().ZhanLingOpen()){if(!t||!e[0])return;var i=(t.getHP(),t.infoModel.getAtt(AttributeType.atMaxHp),t.infoModel.team==Team.My&&t instanceof CharRole);for(var s in GlobalConfig.ZhanLingBase){var n=GlobalConfig.ZhanLingBase[s],o=ZhanLingModel.ins().getZhanLingDataById(n.id);if(o)switch(n.talent){case this.ZL_H_SKILL_DETER:if(i){var a=ZhanLingModel.ins().getZhanLingDataByTalentLv(n.id),r=GlobalConfig.ZhanLingTalent[n.talent][a];if(!r)break;for(var h=0;h<SubRoles.ins().subRolesLen;h++){var l=EntityManager.ins().getMainRole(h);if(l)for(var c=function(e){if(!e.type||e.type==l.infoModel.job){var i=new SkillData(e.id);u.intervalDoFun(t.infoModel.handle+e.id+n.talent,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},u=this,p=0,d=r.passive;p<d.length;p++){var g=d[p];c(g)}}}break;case this.ZL_H_SKILL_ANTICIPATI:var f=GlobalConfig.ZhanLingTalent[n.talent][1];GameLogic.triggerValue(f.rate)}}}},e.prototype.checkDieTrigger=function(t,e){if(ZhanLingModel.ins().ZhanLingOpen()){if(!t||!e[0])return;var i=(t.getHP(),t.infoModel.getAtt(AttributeType.atMaxHp),t.infoModel.team==Team.My&&t instanceof CharRole);for(var s in GlobalConfig.ZhanLingBase){var n=GlobalConfig.ZhanLingBase[s],o=ZhanLingModel.ins().getZhanLingDataById(n.id);if(o){var a=ZhanLingModel.ins().getZhanLingDataByTalentLv(n.id),r=GlobalConfig.ZhanLingTalent[n.talent][a];if(r)switch(n.talent){case this.ZL_SKILL_KILL:if(i)for(var h=0;h<SubRoles.ins().subRolesLen;h++){var l=EntityManager.ins().getMainRole(h);if(l&&l.infoModel.handle!=t.infoModel.handle)for(var c=function(e){if(!e.type||e.type==l.infoModel.job){var i=new SkillData(e.id);u.intervalDoFun(t.infoModel.handle+e.id+n.id,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},u=this,p=0,d=r.passive;p<d.length;p++){var g=d[p];c(g)}}break;case this.ZL_SKILL_EXPLOSION:if(!i&&e[0]&&e[0].infoModel.team==Team.My)for(var f=0,v=r.passive;f<v.length;f++){var g=v[f];if(!g.type||e[0].infoModel.job==g.type)for(var h=(new SkillData(g.id),0);h<SubRoles.ins().subRolesLen;h++){var l=EntityManager.ins().getMainRole(h);if(!l||l.infoModel.handle==e[0].infoModel.handle)break;var y=new SkillData(g.id);if(y.tarEff&&y.tarEff.length>0)for(var m=0,T=y.tarEff;m<T.length;m++){var b=T[m],C=EntityBuff.createBuff(b,l);l.addBuff(C)}}}break;case this.ZL_SKILL_SACRIFICE:if(!i&&e[0]&&e[0].infoModel.team==Team.My&&e[0].infoModel.job==JobConst.ZhanShi)for(var I=function(e){if(!e.type||e.type==t.infoModel.job){var i=new SkillData(e.id);w.intervalDoFun(t.infoModel.handle+e.id+n.id,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},w=this,_=0,S=r.passive;_<S.length;_++){var g=S[_];I(g)}break;case this.ZL_SKILL_ANGER:if(!i&&e[0]&&e[0].infoModel.team==Team.My&&e[0].infoModel.job==JobConst.FaShi)for(var B=function(e){if(!e.type||e.type==t.infoModel.job){var i=new SkillData(e.id);E.intervalDoFun(t.infoModel.handle+e.id+n.id,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},E=this,x=0,R=r.passive;x<R.length;x++){var g=R[x];B(g)}}}}}},e.prototype.checkHPTrigger=function(t,e){if(ZhanLingModel.ins().ZhanLingOpen()){if(!t||!e)return;var i=t.getHP(),s=t.infoModel.getAtt(AttributeType.atMaxHp),n=t.infoModel.team==Team.My&&t instanceof CharRole,o=function(e){var o=GlobalConfig.ZhanLingBase[e],r=ZhanLingModel.ins().getZhanLingDataById(o.id);if(!r)return"continue";switch(o.talent){case a.ZL_SKILL_RELIEF:break;case a.ZL_SKILL_RENJIA:if(n){var h=0,l=ZhanLingModel.ins().getZhanLingDataBySkill(h),c=ZhanLingModel.ins().getZhanLingDataById(h),u=0;for(var p in l)c.level>=l[p].open&&(1==l[p].id?u=GlobalConfig.ZhanLingSkill[l[p].id].passive:4==l[p].id&&(u=GlobalConfig.ZhanLingSkill[l[p].id].passivePlus));if(u>0){var d=new SkillData(u);i/s<d.config.passive.p1/1e4&&a.intervalDoFun(t.infoModel.handle+u+h,d.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,u,!0)})}}}},a=this;for(var r in GlobalConfig.ZhanLingBase)o(r)}},e.prototype.intervalDoFun=function(t,e,i){void 0==this.triggerInterval[t]&&(this.triggerInterval[t]=egret.getTimer()),egret.getTimer()-this.triggerInterval[t]>=0&&i(),this.triggerInterval[t]=egret.getTimer()+e},e}(BaseClass);__reflect(ExSkillAiLogic.prototype,"ExSkillAiLogic");var RoleAI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aiList={},e.zhanlingTime=0,e.zhanlingdelayTime=0,e.isFindDrop=!1,e.isLog=!1,e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.init=function(){this.stop(),this.skillCD={},this.attrCD={},this.attrValue={},this.inited=!0},e.prototype.start=function(){this.isStartAtk=!1,GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY),this.teamAction={},this.starting||(this.inited||this.init(),this.addAITimer())},e.prototype.togglePause=function(){},e.prototype.stop=function(){this.inited&&this.stopAITimer(),this.skillCD={};for(var t in this.curSkill)this.curSkill[t]&&ObjectPool.push(this.curSkill[t]);this.curSkill={},this.curTarget={},this.lastTarget={},this.skillCastType={},this.skillTargetType={},this.hashHpObj={},this.attrCD={},this.attrValue={}},e.prototype.clearTarget=function(t){if(t&&t.infoModel){var e=t.infoModel.handle;delete this.skillCD[e];var i=this.curSkill[e];i&&ObjectPool.push(i),delete this.curSkill[e],delete this.curTarget[e],delete this.lastTarget[e],delete this.skillCastType[e],delete this.skillTargetType[e];for(var s in this.curTarget)this.curTarget[s]==t&&delete this.curTarget[s];for(var s in this.lastTarget)s+""==e+""&&delete this.lastTarget[s]}},e.prototype.clearAIList=function(){this.aiList={}},e.prototype.clear=function(){this.stop(),this.clearAIList(),this.isFindDrop=!1,TimerManager.ins().removeAll(this)},e.prototype.destruct=function(){this.skillCD={},this.stop()},Object.defineProperty(e.prototype,"starting",{get:function(){return TimerManager.ins().isExists(this.startAI,this)},enumerable:!0,configurable:!0}),e.prototype.canAddToAi=function(){return GameMap.sceneInMain()?!0:!1},e.prototype.add=function(t){this.aiList[t.infoModel.handle]=t},e.prototype.remove=function(t){delete this.aiList[t.infoModel.handle]},e.prototype.getAIList=function(){return this.aiList},e.prototype.startAI=function(){var t=this.aiList,i=["0","战士","法师","道士"],s=EntityManager.ins().getNoDieRole(),n=0;for(var o in t){var a=t[o],r=void 0,h=a instanceof CharRole,l=a.infoModel.handle,c=(h?i[a.infoModel.job]:"",a.buffList),u=!1;for(var p in c){if(a.AI_STATE==AI_State.Die)break;var d=c[p];if((d.effConfig.type==SkillEffType.AddBlood||d.effConfig.type==SkillEffType.AdditionalDamage)&&d.isExecute()){d.step++;var g=this.hramedDie(a,d.value);g&&(a.AI_STATE=AI_State.Die),this.showHram(g,DamageTypes.HIT,a,d.source,d.value,"buff伤害"+d.effConfig.id),d.step>=d.count&&a.removeBuff(d)}d.canRemove()?a.removeBuff(d):d.isCanotHit()&&(u=!0)}if(!u&&a.AI_STATE!=AI_State.Die&&!a.isHardStraight){if(a.infoModel.team==Team.My&&UserSkill.ins().hejiLevel>0&&UserSkill.ins().hejiEnable&&a.infoModel instanceof Role){if(s&&a.infoModel.handle==s.infoModel.handle){r=this.curTarget[l];var f=UserSkill.ins().getHejiSkillId();if(UserSkill.ins().fieldUse&&0!=f.id&&r&&r.team!=Team.My&&r.AI_STATE!=AI_State.Die){var v=EntityManager.ins().screeningTargetByPos(a,!1,f.affectCount,f.castRange,this.aiList);if(v.length){this.useSkill(a,r,f),ExSkillAiLogic.ins().checkHJTrigger(a,[r]),UserSkill.ins().fieldUse=!1;var y=GlobalConfig.EffectsConfig[f.selfEff[0]]?GlobalConfig.EffectsConfig[f.selfEff[0]]:null;if(y)for(var m=SubRoles.ins().subRolesLen,T=0;m>T;T++){var b=EntityManager.ins().getMainRole(T);if(b){var d=ObjectPool.pop("EntityBuff");d.effConfig=y,d.addTime=egret.getTimer(),d.endTime=d.addTime+y.duration,d.count=y.duration/y.interval>>0,d.step=0,d.source=b,b.addBuff(d),b.stopMove(),b!=s&&b.playAction(EntityAction.STAND),b.AI_STATE=AI_State.Stand}}continue}}}}else if(a.infoModel.team==Team.WillEntity&&HejiUseMgr.ins().canUse()){r=this.curTarget[l];var C=HejiUseMgr.ins().getMaster();if(r&&r.team==Team.My&&C==a){var f=HejiUseMgr.ins().getSkillData();if(f&&r.AI_STATE!=AI_State.Die){var v=EntityManager.ins().screeningTargetByPos(a,!1,f.affectCount,f.castRange,this.aiList);if(v.length){this.useSkill(a,r,f),HejiUseMgr.ins().useSuccess();var y=GlobalConfig.EffectsConfig[f.selfEff[0]]?GlobalConfig.EffectsConfig[f.selfEff[0]]:null;if(y)for(var I=HejiUseMgr.ins().getRoles(),m=I.length,w=0;m>w;w++){var b=EntityManager.ins().getEntityByHandle(I[w].handle);if(b){var d=ObjectPool.pop("EntityBuff");d.effConfig=y,d.addTime=egret.getTimer(),d.endTime=d.addTime+y.duration,d.count=y.duration/y.interval>>0,d.step=0,d.source=b,b.addBuff(d),b.stopMove(),b!=C&&b.playAction(EntityAction.STAND),b.AI_STATE=AI_State.Stand}}continue}}}}if(t[l]){if(h){if(a.publicCD&&egret.getTimer()-a.publicCD<=800)continue}else if(a.publicCD&&egret.getTimer()-a.publicCD<=800)continue;if(!e.ins().isFindDrop||a.team!=Team.My||!s||a.infoModel.handle!=s.infoModel.handle)switch(a.AI_STATE){case AI_State.Stand:this.screeningSkill(l);var _=!1,S=!1;if(this.curSkill[l]||(_=!0),!_&&this.checkCanScreeningTarget(a,this.curSkill[l],this.curTarget[l])&&(a.team==Team.WillEntity?this.screeningTarget(a,9):this.screeningTarget(a)),a.team==Team.My&&a!=s&&s&&MathUtils.getDistance(a.x,a.y,s.x,s.y)>250){var B=this.curTarget[s.infoModel.handle];B&&B.AI_STATE!=AI_State.Die&&this.curSkill[l]&&this.curSkill[l].targetType==TargetType.Enemy&&B.team!=Team.My?this.curTarget[l]=B:S=!0}if(_||S){if(a.team==Team.My&&a!=s&&s){var E=s;if(a.infoModel.masterHandle){var x=EntityManager.ins().getEntityByHandle(a.infoModel.masterHandle);x&&(E=x)}var R=EntityManager.ins().getTeamCount(Team.My),M=[1,-1];2==R&&(M=[0]);var D=DirUtil.getGridByDir(E.dir+M[n]!=null?M[n]:0);n+=1,GameMap.moveEntity(a,E.x+D.x,E.y+D.y)}continue}if(!this.curTarget[l])continue;this.tryUseSkill(a)?a.AI_STATE=AI_State.Atk:(a.team==Team.My||a.team==Team.WillEntity||a.team==Team.Faker||this.teamAction[a.team])&&(GameMap.moveEntity(a,this.curTarget[l].x,this.curTarget[l].y),a.AI_STATE=AI_State.Run);break;case AI_State.Run:if(r=this.curTarget[l],a.team==Team.My&&(UserFb.ins().canChallengGuanQia=!0),!r||r.AI_STATE==AI_State.Die){a.stopMove(),a.playAction(EntityAction.STAND),a.AI_STATE=AI_State.Stand,delete this.curTarget[l];continue}if(a.team==Team.Faker){var A=Encounter.ins().wildPersonList[a.infoModel.masterHandle];if(!A)continue;var k=EncounterModel.countKillNumByMarster(a.infoModel.masterHandle),P=MathUtils.getDistance(a.x,a.y,A.backX,A.backY);if(A&&1==A.actionType&&k>=A.killNum){10>P?(EntityManager.ins().removeByHandle(a.infoModel.masterHandle),Encounter.ins().RunAwary(a.infoModel.masterHandle),Encounter.ins().sendCleanWildPeople(A.index)):GameMap.moveEntity(a,A.backX,A.backY);continue}}this.tryUseSkill(a)&&(a.stopMove(),a.AI_STATE=AI_State.Atk),a.action==EntityAction.STAND&&(a.AI_STATE=AI_State.Stand);break;case AI_State.Atk:if(this.isStartAtk||GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK),this.isStartAtk=!0,r=this.curTarget[l],!r||r.AI_STATE==AI_State.Die){a.AI_STATE=AI_State.Stand,delete this.curTarget[l];continue}if(this.teamAction[r.team]=!0,a.atking)continue;var f=this.curSkill[l];if(!f)continue;this.skillCD[l][f.id]=egret.getTimer(),this.skillCastType[l]=f.castType,this.skillTargetType[l]=f.targetType,a.atking=!0,a.team==Team.My&&(UserFb.ins().canChallengGuanQia=!1),a.publicCD=egret.getTimer(),GameLogic.skyBallCheck(a),this.useSkill(a,r,f),delete this.curSkill[l];break;case AI_State.Patrol:var L=a.infoModel.configID,y=UserFb.ins().guanqiaMonster[L];a.infoModel.isWander&&y.attrange?(this.screeningTarget(a,y.attrange),this.curTarget[a.infoModel.handle]?a.AI_STATE=AI_State.Stand:a.startPatrol()):a.startPatrol()}}}}},e.prototype.checkShowZhanling=function(){if(this.zhanlingTime=egret.getTimer(),GameMap.sceneInMain()){var t=ZhanLingModel.ins().ZhanLingSkinId;if(ZhanLingModel.ins().getZhanLingDataById(0)){var e=EntityManager.ins().getNoDieRole();if(e){var i=ZhanLingModel.ins().getZhanLingDataById(0).level;e.showZhanling(t,i),ExSkillAiLogic.ins().checkWarSpiritBubbleTrigger()}}}},e.prototype.checkCanScreeningTarget=function(t,e,i){if(!i||!i.parent||i.AI_STATE==AI_State.Die)return!0;var s=t.infoModel.handle;return void 0==this.skillCastType[s]&&void 0==this.skillTargetType[s]?!0:this.skillCastType[s]!=e.castType||this.skillTargetType[s]!=e.targetType?!0:!1},e.prototype.getTargetMonsterPoint=function(t,e){if(t.x==e.x)return e;var i=(e.y-t.y)/(e.x-t.x),s=e.x,n=e.y,o=60,a=20;return Math.abs(i)<=1?(0>i?n+=Math.floor(o*Math.random()):n-=Math.floor(o*Math.random()),s+=Math.floor(a*Math.random())):(0>i?s+=Math.floor(o*Math.random()):s-=Math.floor(o*Math.random()),n+=Math.floor(a*Math.random())),{x:s,y:n}},e.prototype.useUnitionSkill=function(){},e.prototype.useSkill=function(t,e,i){var s,n,o,a,r=this,h=(i.tarEff?GlobalConfig.EffectsConfig[i.tarEff[0]]:null,i.selfEff?GlobalConfig.EffectsConfig[i.selfEff[0]]:null),l=i.castType==castType.Self?t:e,c=0,u=!1,p=t.infoModel;t.team==Team.My&&(n=Artifact.ins().getReviseBySkill(i.id),n&&(c=n.crit),a=GodWeaponCC.ins().getReviseBySkill(i.id),a&&(o=a[0]),o&&(c=o.crit));var d=i.affectCount;if(n&&n.affectCount&&(d+=n.affectCount),o&&o.affectCount&&(d+=o.affectCount),i.castType==castType.SelfHpLess){s=EntityManager.ins().screeningTargetByPos(t,!0,0,Number.MAX_VALUE,this.aiList);for(var g=0;g<s.length;g++)if(s[g].isCanAddBlood){s[0]=s[g];break}}else s=i.castType!=castType.Other&&i.targetType==TargetType.Enemy?EntityManager.ins().screeningTargetByPos(l,!1,d,i.affectRange,this.aiList):d>1?EntityManager.ins().screeningTargetByPos(l,l.team==e.team,d,i.affectRange,this.aiList):[e],0==s.length&&(s=[e]);i.preId&&GlobalConfig.FlameStamp.skillId.indexOf(i.preId)>=0&&(u=!0);for(var f=!1,v=s.length=Math.min(s.length,d),y=[],m=0;v>m;m++){var T=s[m],b=T.infoModel,C=!1,I=0==m;if(T.team!=t.team){var w=void 0;(GameLogic.triggerAttr(t,AttributeType.atStunPower)||90005==i.id)&&(w=ObjectPool.pop("EntityBuff"),w.effConfig=GlobalConfig.EffectsConfig[51001],w.value=p.getAtt(AttributeType.atStunTime),w.addTime=egret.getTimer(),w.endTime=w.addTime+w.value,T.addBuff(w),T.stopMove(),T.AI_STATE=AI_State.Stand),GameLogic.triggerExAttr(t,ExAttributeType.eatDeathCurseProbability)&&(w=ObjectPool.pop("EntityBuff"),w.effConfig=GlobalConfig.EffectsConfig[52001],w.addTime=egret.getTimer(),w.endTime=w.effConfig.args.d?p.attributeExData[ExAttributeType.eatDeathCurseTime]:w.effConfig.duration,T.addBuff(w),t.addPaoPao(3),C=!0),GameLogic.triggerExAttr(t,ExAttributeType.eatAttackAddHpProbability)}var _=UserSkill.ins().isHejiSkill(i.configID),S=!1,B=!1,E=!1,x=!1,R=!1,M=!1,D=!1,A=void 0,k=void 0,P=0;if(3!=i.calcType&&(x=GameLogic.triggerMiss(t,T)),x)P=0;else{if(P=this.damageBaseCalculation(t,T,i),3!=i.calcType){E=GameLogic.triggerExAttr(t,ExAttributeType.eatMultipleCrit),E&&(P*=p.getExAtt(ExAttributeType.eatMultipleCritCoeff)/1e4,P+=p.getExAtt(ExAttributeType.atMultipleCritHurt),t.addPaoPao(21)),S=GameLogic.triggerCrit(t,T,c);var L=t.hasBuff(SkillConst.EFF_SKY_BALL);L&&(t.addPaoPao(6),S=!0);var G=0,U=1;if(S){f=!0;var F=p.getAtt(AttributeType.atCritEnhance);o&&o.critDamage&&(F+=o.critDamage);var N=p.getExAtt(ExAttributeType.eatCritHpLt);b.getAtt(AttributeType.atHp)/b.getAtt(AttributeType.atMaxHp)<=N/1e4&&(F+=p.getExAtt(ExAttributeType.eatCritHpLtAddDamage)),U+=F/1e4,G+=p.getAtt(AttributeType.atCritHurt)}var O={};O[AttributeType.atDeadLyPro]=GameLogic.calculateRealAttribute(t,AttributeType.atDeadLyPro,t),D=GameLogic.triggerAttr(t,AttributeType.atDeadLyPro,O),D&&(U+=.5+(p.getAtt(AttributeType.atDeadLyMaster)-b.getAtt(AttributeType.atDeadLyResist))/1e4),O={},O[AttributeType.atHunGuPro]=GameLogic.calculateRealAttribute(t,AttributeType.atHunGuPro,t),A=this.tryTriggerHungu(t),A&&(U+=p.getAtt(AttributeType.atHunGuHurt)/1e4),k=this.tryTriggerHeart(t),k&&(U+=p.getAtt(AttributeType.atHearthHurt)/1e4,G+=p.getAtt(AttributeType.atHearthDamege)),P=P*U+G,C&&(P*=1+p.attributeExData[ExAttributeType.eatDeathCurseDamageIncrease]/1e4),I||i.targetType!=TargetType.Enemy||(P*=b.type==EntityType.Role?i.herdPlayerRate/100:i.herdMonRate/100),t.isMy&&p.type==EntityType.Role&&e.infoModel.type==EntityType.Role&&(Encounter.ins().isEncounter()?EncounterFight.ins().getIsWeiShe(t.isMy)&&(R=!0):MineFight.ins().isFighting&&MineFight.ins().getIsWeiShe(t.isMy)&&(R=!0)),P=this.damageBuff(t,T,P),P+=p.getAtt(AttributeType.atHolyDamege)*(1+p.getAtt(AttributeType.atHolyMaster)/1e4-b.getAtt(AttributeType.atHolyResist)/1e4),M=GameLogic.triggerAttr(t,AttributeType.atZhuiMingPro),M&&(P+=p.getAtt(AttributeType.atZhuiMingVal)),P*=1-p.getAtt(AttributeType.neigongAbsorbHurt)/1e4
}P>>=0,t.team==T.team&&P>0&&(P=0)}T instanceof CharRole||T.AI_STATE==AI_State.Patrol&&(T.stopMove(),T.playAction(EntityAction.STAND),T.AI_STATE=AI_State.Stand);var W=this.hramedDie(T,P);W&&(T.AI_STATE=AI_State.Die,ExSkillAiLogic.ins().checkDieTrigger(t,[T]));var H=0;if(t.team==Team.My&&(_?H=DamageTypes.Heji:x?H=DamageTypes.Dodge:(B&&(H|=DamageTypes.Lucky),S&&(H|=DamageTypes.CRIT)),R&&(H|=DamageTypes.Deter),M&&(H|=DamageTypes.ZhuiMing),D&&(H|=DamageTypes.ZhiMing)),t.team!=T.team&&5==i.calcType){for(var V=P/5>>0,q=V*MathUtils.limit(0,.05)>>0,j=V*MathUtils.limit(0,.05)>>0,Y=[V-q,V+q,V-j,V+j,P-4*V],Z=[],K=0;K<Y.length;K++)Z.push({isDie:W,damageType:DamageTypes.Fujia,ttarget:T,hramValue:Y[K]});y.push(Z)}else if(y.push([{isDie:W,damageType:H,ttarget:T,hramValue:P}]),t.team!=T.team&&GameLogic.triggerAttr(t,AttributeType.atAttPerDamPan)){W=this.hramedDie(T,P>>1),t.addPaoPao(20);var z=y[y.length-1];z.push({isDie:W,damageType:DamageTypes.Fujia,ttarget:T,hramValue:P>>1})}T.myKill=T.myKill||t.isMy,(t.isMy||t.team==Team.WillEntity)&&(T.showBlood(!0),T.showName(!0)),T.isMy&&(t.showBlood(!0),t.showName(!0))}var X=GameMap.fbType,J=GameMap.fubenID,Q=0;GameLogic.ins().playSkillEff(i,t,s,function(c){if(GameMap.fbType==X&&J==GameMap.fubenID){var p=0;for(var d in s){var g=s[d],f=(g.infoModel,y[d][y[d].length-1].isDie);l==g&&(p=y[d][0].damageType);for(var v=0,m=0;m<y[d].length;m++){var T=y[d][m];v+=T.hramValue,r.showHram(T.isDie,T.damageType,g,t,T.hramValue,i.name)}if(t.team==Team.My&&g.team==Team.WillEntity&&EncounterFight.ins().willEntityFightTeam!=Team.My){EncounterFight.ins().willEntityFightTeam=Team.My;for(var b=EntityManager.ins().getEntityByTeam(Team.WillEntity),C=0,I=b;C<I.length;C++){var w=I[C];r.curTarget[w.infoModel.handle]=null,r.lastTarget[w.infoModel.handle]=null}}if(g.shakeIt(),!f){var _=i.tarEff;l!=g&&g.infoModel.type==EntityType.Role&&(_=i.otarEff||_);for(var S=0;_&&S<_.length;S++){var B=r.getArgs(_[S],n,o),E=EntityBuff.createBuff(_[S],t,B);g.addBuff(E)}n&&r.addTargetReviseSkillEffect(g,t,n),o&&r.addTargetReviseSkillEffect(g,t,o),a&&a[1]&&r.addTargetReviseSkillEffect(g,t,a[1]),g instanceof CharRole&&r.tryUseWingSkill(g,i,!0),r.tryUsePassiveSkill(t,g,!0,y[d][0].damageType),r.tryUseWeaponSkill(g,i,!0),r.tryTriggerMijiBuqu(g)}r.showBuffHarm(t,g,i,v)}if(h)for(var S=0;i.selfEff&&S<i.selfEff.length;S++){var B=r.getArgs(i.selfEff[S],n,o),E=EntityBuff.createBuff(i.selfEff[S],t,B);t.addBuff(E)}if(n&&r.addSelfReviseSkillEffect(t,n),o&&r.addSelfReviseSkillEffect(t,o),a&&a[1]&&r.addSelfReviseSkillEffect(t,a[1]),t instanceof CharRole&&r.tryUseWingSkill(t,i,!1),r.tryUsePassiveSkill(t,l,!1,p),r.tryTriggerHeirloomSkill(t,s,y),u&&r.tryUseYlPassiveSkill(t,l,i),80002==i.configID&&r.petTryUsePassiveSkill(t,!1),i.otherSkills){var x=i.otherSkills.concat(),R=new SkillData(x[Q]);return R.preId=i.configID,r.useSkill(t,e,R),void(Q+=1)}}}),!SoundUtil.WINDOW_OPEN&&i.sound&&t.team==Team.My&&SoundUtil.ins().playEffect(i.sound),t.AI_STATE=AI_State.Stand,t.atking=!1,f&&p.getExAtt(ExAttributeType.eatMiJiZHDamPer)&&this.checkTriggerAttr(t,1,ExAttributeType.eatMiJiZHTime,1),this.repel(t,e,i)},e.prototype.repel=function(t,e,i){if(i&&i.repelDistance){e.stopMove(),e.playAction(EntityAction.STAND);var s=e.infoModel.handle;delete this.curTarget[s];var n=MathUtils.getAngle(MathUtils.getRadian2(t.x,t.y,e.x,e.y)),o=MathUtils.getDirMove(n,i.repelDistance);o.x=e.x+o.x,o.y=e.y+o.y;var a=BresenhamLine.isAbleToThrough(GameMap.point2Grip(e.x),GameMap.point2Grip(e.y),GameMap.point2Grip(o.x),GameMap.point2Grip(o.y));0==a[0]&&(a[1]>3&&debug.error("通过格子超过3个，检查是否有异常"+a[2]+","+a[3],o),GameMap.point2Grip(e.x)==a[2]&&GameMap.point2Grip(e.y)==a[3]?(o.x=e.x,o.y=e.y):(o.x=GameMap.grip2Point(a[2]),o.y=GameMap.grip2Point(a[3]))),o.x=Math.max(Math.min(o.x,GameMap.MAX_WIDTH),0),o.y=Math.max(Math.min(o.y,GameMap.MAX_HEIGHT),0);var r=o.x-e.x,h=o.y-e.y,l=Math.sqrt(r*r+h*h)/(t.moveSpeed/1e3),c=GlobalConfig.EffectsConfig[i.tarEff[0]].duration;if(e.addHardStraight(c),l>0){var u=egret.Tween.get(e.moveTweenObj);u.to({x:o.x,y:o.y},l)}if(1==i.teleport&&(i&&""!=i.actionType&&t.playAction(i.actionType),t.stopMove(),l>0)){var u=egret.Tween.get(t.moveTweenObj);u.to({x:t.x-(e.x-o.x),y:t.y-(e.y-o.y)},l).call(function(){t.stopMove(),t.resetStand()}),t.addHardStraight(l)}}},e.prototype.checkTriggerAttr=function(t,e,i,s,n){if(void 0===s&&(s=1),void 0===n&&(n=0),Math.random()<s){var o=t.infoModel,a=o.handle,r=this.attrCD[a]=this.attrCD[a]||{},h=e+"_"+i,l=n?n:0==e?o.getAtt(i):o.getExAtt(i),c=r[h]||0,u=egret.getTimer();if(c&&l>u-c)return;r[h]=u;var p=this.attrValue[a]=this.attrValue[a]||{};p[h]=1}},e.prototype.getIsTriggerAttr=function(t,e,i,s){void 0===s&&(s=0);var n=t.infoModel,o=this.attrValue[n.handle];if(o){var a=e+"_"+i,r=o[a];return o[a]=s,r}return 0},e.prototype.addSelfReviseSkillEffect=function(t,e){if(e.selfEff)for(var i in e.selfEff){var s=GlobalConfig.EffectsConfig[e.selfEff[i]]?GlobalConfig.EffectsConfig[e.selfEff[i]]:null;if(s){var n=this.getArgs(e.selfEff[i],e,null),o=EntityBuff.createBuff(e.selfEff[i],t,n);t.addBuff(o)}}},e.prototype.addTargetReviseSkillEffect=function(t,e,i){if(i.targetEff)for(var s in i.targetEff){var n=GlobalConfig.EffectsConfig[i.targetEff[s]]?GlobalConfig.EffectsConfig[i.targetEff[s]]:null;if(n){var o=this.getArgs(i.targetEff[s],i,null),a=EntityBuff.createBuff(i.targetEff[s],e,o);t.addBuff(a)}}},e.prototype.tryUsePassiveSkill=function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=0);var n=i?e:t,o=i?t:e;if(n instanceof CharRole){var a=this.getCanUseSkillList(n,!1);if(!a||0==a.length)return;for(var r=[],h=0,l=a;h<l.length;h++){var c=l[h],u=c.config.passive;if(!(u.p1&&n.infoModel.getAtt(AttributeType.atHp)/n.infoModel.getAtt(AttributeType.atMaxHp)>u.p1/1e4))switch(u.cond){case 0:i||GameLogic.triggerValue(u.rate)&&r.push(c);break;case 1:i&&GameLogic.triggerValue(u.rate)&&r.push(c);break;case 2:i||(s&DamageTypes.CRIT)!=DamageTypes.CRIT||GameLogic.triggerValue(u.rate)&&r.push(c);break;case 3:i&&(s&DamageTypes.CRIT)==DamageTypes.CRIT&&GameLogic.triggerValue(u.rate)&&r.push(c)}}if(!r.length)return;for(var p=0,d=r;p<d.length;p++){var g=d[p],f=void 0;if(g.targetType!=TargetType.Enemy)f=n;else if(o&&o.infoModel.getAtt(AttributeType.atHp)>0)f=o;else{var v=EntityManager.ins().screeningTargetByPos(n,!1,0,g.affectRange,this.aiList);f=v&&v[0]}if(f){var y=n.infoModel.handle;this.skillCD[y]=this.skillCD[y]||{},this.skillCD[y][g.id]=egret.getTimer(),this.useSkill(n,f,g)}}}},e.prototype.tryUseWarSpiritSkill=function(t,e,i){var s=ObjectPool.pop("SkillData");s.configID=e;var n;if(s.targetType!=TargetType.Enemy)n=t;else{var o=EntityManager.ins().screeningTargetByPos(t,!1,0,s.affectRange,this.aiList);n=o[0]}if(n){var a=t.infoModel.handle;this.skillCD[a]=this.skillCD[a]||{},this.skillCD[a][s.id]=egret.getTimer(),this.useSkill(t,n,s)}},e.prototype.tryUseWingSkill=function(t,e,i){var s=this.checkWingEffect(t,e,i);if(s.length)for(var n=0,o=s;n<o.length;n++){var a=o[n],r=ObjectPool.pop("SkillData");r.configID=a;var h=void 0;if(r.targetType!=TargetType.Enemy)h=t;else{var l=EntityManager.ins().screeningTargetByPos(t,!1,0,r.affectRange,this.aiList);h=l[0]}if(h){var c=t.infoModel.handle;this.skillCD[c]=this.skillCD[c]||{},this.skillCD[c][r.id]=egret.getTimer(),this.useSkill(t,h,r)}}},e.prototype.checkWingEffect=function(t,e,i){void 0===i&&(i=!1);var s=t.infoModel.wingSkillData,n=[];if(e.isPassive)return n;for(var o=this.skillCD[t.infoModel.handle],a=0,r=s;a<r.length;a++){var h=r[a],l=ObjectPool.pop("SkillData");l.configID=h,o&&o[l.id]&&egret.getTimer()-o[l.id]<l.cd||(0!=l.config.passive.cond||i?1==l.config.passive.cond&&i&&GameLogic.triggerValue(l.config.passive.rate)&&n.push(h):GameLogic.triggerValue(l.config.passive.rate)&&n.push(h))}return n},e.prototype.tryUseYlPassiveSkill=function(t,e,i){var s=t.infoModel;if(s.lyMarkLv&&s.lyMarkSkills)for(var n=0;n<s.lyMarkSkills.length;n++){var o=s.lyMarkSkills[n]||0;if(o){var a=GlobalConfig.FlameStampEffect[n+1][o];if(a.effId){var r=GlobalConfig.EffectsConfig[a.effId];if(r.probabilityBuff&&GameLogic.triggerValue(r.probabilityBuff)){var h=EntityBuff.createBuff(a.effId,t);e.addBuff(h)}}if(a.selfEffId){var r=GlobalConfig.EffectsConfig[a.selfEffId];if(r.probabilityBuff&&GameLogic.triggerValue(r.probabilityBuff)){var h=EntityBuff.createBuff(a.selfEffId,t);t.addBuff(h)}}}}},e.prototype.tryTriggerHeirloomSkill=function(t,e,i){var s=null,n=80004,o=6666601,a=-1,r=0,h=t.infoModel.handle;for(var l in e){var c=e[l],u=c.infoModel.handle;if(t.team!=c.team&&(-1==a&&(a=0,(!this.skillCD[h]||!this.skillCD[h][o]||egret.getTimer()-this.skillCD[h][o]>=5e3)&&GameLogic.triggerAttr(t,AttributeType.atVamirePro)&&(a=1,this.skillCD[h]=this.skillCD[h]||{},this.skillCD[h][o]=egret.getTimer())),c instanceof CharRole&&!t.hasBuff(n)&&!s&&(!this.skillCD[u]||!this.skillCD[u][n]||egret.getTimer()-this.skillCD[u][n]>=5e3)&&GameLogic.triggerAttr(c,AttributeType.atCursePro))){var p=c.infoModel.heirloom.getInfoBySolt(2).lv,d=[80004,80005,80006,80007][p-1];s=ObjectPool.pop("EntityBuff"),s.effConfig=GlobalConfig.EffectsConfig[d],s.value=s.effConfig.args.a,s.addTime=egret.getTimer(),s.endTime=s.addTime+s.effConfig.duration,t.addBuff(s),c.addPaoPao(13),this.skillCD[u]=this.skillCD[u]||{},this.skillCD[u][n]=egret.getTimer()}}if(1==a){t.addPaoPao(14);for(var g=0,f=i;g<f.length;g++){var v=f[g];0==r&&(r=Math.floor(t.infoModel.getAtt(AttributeType.atVamirePen)/1e4*v[0].hramValue))}this.hramedDie(t,-r),this.showHram(!1,1,t,t,-r)}},e.prototype.tryUseWeaponSkill=function(t,e,i){if(t.AI_STATE!=AI_State.Die&&!(t.getRealHp()<=0)&&i){var s=GameLogic.triggerAttr(t,AttributeType.atBeAttAddHpPro);if(s){t.addPaoPao(16);var n=t.infoModel.getAtt(AttributeType.atBeAttAddHpVal);this.hramedDie(t,-n),this.showHram(!1,1,t,t,-n)}if(t.infoModel.getAtt(AttributeType.atHpLtAddBuff)&&t.infoModel.getAtt(AttributeType.atHp)/t.infoModel.getAtt(AttributeType.atMaxHp)<t.infoModel.getAtt(AttributeType.atHpLtAddBuff)/1e4){var o=this.skillCD[t.infoModel.handle],a=GlobalConfig.EffectsConfig[t.infoModel.getExAtt(ExAttributeType.eatHpLtAddBuffId)];if(o&&o[ExAttributeType.eatHpLtAddBuffId]&&egret.getTimer()-o[ExAttributeType.eatHpLtAddBuffId]<t.infoModel.getExAtt(ExAttributeType.eatHpLtAddBuffCd))return;t.addPaoPao(18);var r=ObjectPool.pop("EntityBuff");r.effConfig=a,r.value=r.effConfig.args.a,r.addTime=egret.getTimer(),r.endTime=r.addTime+r.effConfig.duration,t.addBuff(r),this.skillCD[t.infoModel.handle]=this.skillCD[t.infoModel.handle]||{},this.skillCD[t.infoModel.handle][ExAttributeType.eatHpLtAddBuffId]=egret.getTimer()}}},e.prototype.tryTriggerMijiBuqu=function(t){var e=t.infoModel;if(e.getExAtt(ExAttributeType.eatMiJiBQBuffId)&&e.getAtt(AttributeType.atHp)/e.getAtt(AttributeType.atMaxHp)*1e4<e.getExAtt(ExAttributeType.eatMiJiBQHpPer)){this.checkTriggerAttr(t,1,ExAttributeType.eatMiJiBQHpTime,1);var i=this.getIsTriggerAttr(t,1,ExAttributeType.eatMiJiBQHpTime);if(i){var s=EntityBuff.createBuff(e.getExAtt(ExAttributeType.eatMiJiBQBuffId),t);t.addBuff(s),t.addPaoPao(23)}}},e.prototype.tryTriggerHungu=function(t){var e=t.infoModel,i=e.getAtt(AttributeType.atHunGuPro);if(i){this.checkTriggerAttr(t,0,AttributeType.atHunGuCd,i/1e4);var s=this.getIsTriggerAttr(t,0,AttributeType.atHunGuCd);return s&&BubbleFactory.ins().playBubbleEffect(24),s}},e.prototype.tryTriggerHeart=function(t){var e=t.infoModel;if(e.getAtt(AttributeType.atHearthCount)){this.checkTriggerAttr(t,0,AttributeType.atHearthCount,1,8e3);var i=this.getIsTriggerAttr(t,0,AttributeType.atHearthCount);return i&&BubbleFactory.ins().playBubbleEffect(25),i}},e.prototype.petTryUsePassiveSkill=function(t,e){void 0===e&&(e=!0);var i=t.infoModel.masterHandle,s=EntityManager.ins().getEntityByHandle(i);if(s&&s.infoModel&&s.infoModel.getExAtt(ExAttributeType.eatPetSkillLevel)){for(var n=36e3+s.infoModel.getExAtt(ExAttributeType.eatPetSkillLevel),o=[new SkillData(n)],a=[],r=0,h=o;r<h.length;r++){var l=h[r];0!=l.config.passive.cond||e?1==l.config.passive.cond&&e&&GameLogic.triggerValue(l.config.passive.rate)&&a.push(l):GameLogic.triggerValue(l.config.passive.rate)&&a.push(l)}if(!a.length)return;for(var c=0,u=a;c<u.length;c++){var p=u[c],d=void 0;if(p.targetType!=TargetType.Enemy)d=t;else{var g=EntityManager.ins().screeningTargetByPos(t,!1,0,p.affectRange,this.aiList);d=g[0]}if(d){var f=t.infoModel.handle;this.skillCD[f]=this.skillCD[f]||{},this.skillCD[f][p.id]=egret.getTimer(),this.useSkill(t,d,p)}}}},e.prototype.showBuffHarm=function(t,e,i,s){var n=GameLogic.calculateRealAttribute(e,AttributeType.atAddEnemyHp,t);n>0&&(n=-n,this.hramedDie(t,n),t instanceof CharRole&&this.showHram(!1,DamageTypes.BLANK,t,t,n));var o=GameLogic.calculateRealAttribute(t,AttributeType.atHurtMyself,e);if(o){var a=Math.floor(s*o/1e4),r=this.hramedDie(t,a);this.showHram(r,DamageTypes.BLANK,t,e,a)}},e.prototype.hramedDie=function(t,e){var i=t.infoModel.getAtt(AttributeType.atHp)-e;if(0>e){var s=t.infoModel.getAtt(AttributeType.atMaxHp);i=i>s?s:i}return t.infoModel.setAtt(AttributeType.atHp,i),t.infoModel.getAtt(AttributeType.atHp)<=0?!0:!1},e.prototype.showHram=function(t,i,s,n,o,a){var r=this;if(void 0===a&&(a=""),s&&s.infoModel)if(this.trace(s.infoModel.handle+" -- 受到"+o+", 当前剩余血量:"+s.getHP()+"	--"+a),s.hram(o),GameLogic.ins().postEntityHpChange(s,n,i,o),t){if(s.removeAllFilters(),s.stopMove(),s.playAction(EntityAction.HIT),s.myKill&&!(s instanceof CharRole)){var h=UserTask.ins().taskTrace;if(h){var l=UserTask.ins().getAchieveConfById(h.id);l&&l.type==e.SEND_TASK_TYPE&&UserFb.ins().sendKillMonster(s.infoModel.configID)}}if(!s.hasBuff(52001)&&GameLogic.triggerExAttr(s,ExAttributeType.eatGodBlessProbability)){s.AI_STATE=AI_State.Stand,s.removeAllBuff();var c=s.infoModel.getAtt(AttributeType.atMaxHp)*s.infoModel.attributeExData[ExAttributeType.eatGodBlessRate]/1e4;s.infoModel.setAtt(AttributeType.atHp,c),s.hram(-c),this.trace("复活后剩余血量"+s.getHP()),s.addPaoPao(7)}else if(this.trace(s.infoModel.handle+" -- 死亡，等待删除形象"),n&&n.team==Team.My&&this.checkPlayDieSound(s),TimerManager.ins().doTimer(500,1,function(){if(r.trace(s.infoModel.handle+" -- 删除"),EntityManager.ins().removeByHandle(s.infoModel.handle,!1,s.myKill&&s.infoModel.type==EntityType.Monster),s.infoModel.type==EntityType.Role){var t=EntityManager.ins().getEntityBymasterhHandle(s.infoModel.masterHandle);if(!t){var e=EntityManager.ins().getMasterList(s.infoModel.masterHandle);if(e&&e.length)for(var i=0,o=e;i<o.length;i++){var a=o[i];EntityManager.ins().removeByHandle(a.infoModel.handle)}}}if(delete r.hashHpObj[s.hashCode],s.onDead(function(){s.deadDelay(),r.clearTarget(s);var t=egret.Tween.get(s.dieTweenObj);t.wait(1e3).to({alpha:0},1e3).call(function(){s instanceof CharMonster&&!(s instanceof CharRole)?s.destruct():DisplayUtils.removeFromParent(s)})}),s.team==Team.Monster){var h=EntityManager.ins().getTeamCount(Team.Monster);h<=UserFb.ins().rCount&&GameLogic.ins().createGuanqiaMonster(!1)}r.checkAIend(n,s)},this),s.team==Team.Monster){var u=EntityManager.ins().getTeamCount(Team.Monster);if(u<=UserFb.ins().rCount&&GameLogic.ins().createGuanqiaMonster(!1),n.team==Team.My){var p=EntityManager.ins().getNoDieRole(),d=s.infoModel.configID==UserFb.ins().eliteMonsterId;if(p&&(d||n.infoModel.handle==p.infoModel.handle)&&0==GameMap.fubenID){var g=Math.floor(s.x/GameMap.CELL_SIZE),f=Math.floor(s.y/GameMap.CELL_SIZE),v=void 0;if(d?v=UserFb.ins().eliteRewards.shift():(v=UserFb.ins().getRewardsPop(),UserFb.ins().rewards=[]),v&&v.length>0){for(var y=0;y<v.length&&8>y;y++)Encounter.ins().postCreateDrop(g,f,v[y].drops[0]);var m=function(){UserFb.ins().sendGetReward(d)};DropHelp.addCompleteFunc(m,this),DropHelp.start()}UserFb.ins().exp>0&&(!v||0==v.length)&&(UserFb.ins().sendGetReward(d),UserFb.ins().exp=0)}var T=EntityManager.ins().screeningTargetByPos(n,!1,0,Number.MAX_VALUE,this.aiList);if(!T||0==T.length)for(var b=EntityManager.ins().getEntityByTeam(Team.My),C=0,I=b;C<I.length;C++){var w=I[C];w.playAction(EntityAction.STAND)}}for(var _ in this.curTarget)if(this.curTarget[_]==s){var w=EntityManager.ins().getEntityByHandle(_);w&&w.infoModel&&++w.infoModel.killNum;break}if(n.team==Team.Faker){var S=Encounter.ins().wildPersonList[n.infoModel.masterHandle],B=EncounterModel.countKillNumByMarster(n.infoModel.masterHandle);S&&1==S.actionType&&B>=S.killNum&&GameMap.moveEntity(n,S.backX,S.backY)}}}else s.AI_STATE!=AI_State.Die&&o>0,ExSkillAiLogic.ins().checkHPTrigger(s,n)},e.prototype.checkAIend=function(t,e){var i=EntityManager.ins().getTeamCount(e.team);if(!i){switch(t.team){case Team.My:switch(e.team){case Team.Monster:this.trace("开始捡东西");break;case Team.WillBoss:Encounter.ins().sendResult(!0),this.trace("遭遇boss成功");break;case Team.WillEntity:if(this.trace("遭遇敌人成功"),!EntityManager.ins().getTeamCount(Team.My))return;GameMap.sceneInMine()?MineFight.ins().fightEnd(!0):EncounterFight.ins().sendFightResult(1);break;case Team.Faker:var s=Encounter.ins().wildPersonList[e.infoModel.masterHandle];s&&Encounter.ins().sendWildPeopleResult(s.index,1)}Encounter.ins().isGuiding&&(Encounter.ins().isGuiding=!1,Encounter.ins().postEncounterDataChange()),EntityManager.ins().resetRole();break;case Team.WillBoss:Encounter.ins().sendResult(!1),this.trace("遭遇boss失败");break;case Team.WillEntity:if(this.trace("遭遇敌人失败"),!EntityManager.ins().getTeamCount(Team.WillEntity))return;GameMap.sceneInMine()?MineFight.ins().fightEnd(!1):EncounterFight.ins().sendFightResult(0);break;case Team.Faker:var n=Encounter.ins().wildPersonList[t.infoModel.masterHandle];Encounter.ins().sendWildPeopleResult(n.index,0);break;case Team.Monster:EntityManager.ins().resetRole()}this.getPickAI()}},e.prototype.checkPlayDieSound=function(t){var e,i=t.infoModel?t.infoModel.configID:0;!SoundUtil.WINDOW_OPEN&&i&&(e=UserFb.ins().guanqiaMonster[i],e?e.sound&&SoundUtil.ins().playEffect(e.sound):(e=GlobalConfig.MonstersConfig[i],e&&e.sound&&SoundUtil.ins().playEffect(e.sound)))},e.prototype.getPickAI=function(){this.inited&&!Encounter.ins().isEncounter()&&this.stopAITimer()},e.prototype.getTeamCount=function(t){var e=0;for(var i in this.aiList){var s=this.aiList[i];s.team==t&&(e+=1)}return e},e.prototype.stopAITimer=function(){TimerManager.ins().remove(this.startAI,this),TimerManager.ins().remove(this.startZhanLing,this)},e.prototype.addAITimer=function(){TimerManager.ins().isExists(this.startAI,this)||(TimerManager.ins().doTimer(e.AI_UPDATE_TIME,0,this.startAI,this),this.addZhanLingTimer())},e.prototype.addZhanLingTimer=function(){this.zhanlingTime=egret.getTimer(),this.zhanlingdelayTime=egret.getTimer(),TimerManager.ins().doTimer(1e3,0,this.startZhanLing,this)},e.prototype.getArgs=function(t,e,i){var s=GlobalConfig.EffectsConfig[t],n=0,o=0,a=0;if(e&&e.args)for(var r=0,h=e.args;r<h.length;r++){var l=h[r];8==l.type&&l.vals[0]==s.group&&(n+=l.vals[2]||0,o+=l.vals[4]||0,a+=l.vals[1]||0),6==l.type&&(n+=l.vals[0]||0)}if(i&&i.args)for(var c=0,u=i.args;c<u.length;c++){var l=u[c];8==l.type&&l.vals[0]==s.group&&(n+=l.vals[2]||0,o+=l.vals[4]||0,a+=l.vals[1]||0),6==l.type&&(n+=l.vals[0]||0)}return{a:n,b:0,c:o,time:a}},e.prototype.skillEffValue=function(t,e,i){var s=0,n=0,o=0;if(i&&(n=i.a||0,o=i.c||0),e){if(e.args)switch(e.type){case SkillEffType.AdditionalDamage:s=t.infoModel.getAtt(e.args.b)*(e.args.a+n)+(e.args.c||0)+o;break;case SkillEffType.AddBlood:s=t.infoModel.getAtt(e.args.b)*(e.args.a+n)+(e.args.c||0)+o,s=-s;break;case SkillEffType.AdditionalAttributes:case SkillEffType.HostAddAttributes:s=t.infoModel.getAtt(e.args.b)*(e.args.a+n)+(e.args.c||0)+o;break;case SkillEffType.AdditionalState:if(2==e.args.i)s=t.infoModel.getAtt(e.args.b)*(e.args.a+n)+(e.args.c||0)+o;else{var a=e.args.c?(e.args.c||0)+o:1+o;s=t.infoModel.getAtt(e.args.b)*a}}s>>=0}return s},e.prototype.checkTeamDistan=function(t,e,i){void 0===i&&(i=5);var s=MathUtils.getDistance(t.x,t.y,e.x,e.y);return s<i*GameMap.CELL_SIZE},e.prototype.tryUseSkill=function(t){var e=t.infoModel.handle,i=this.curSkill[e],s=this.curTarget[e];if(!i)return!1;var n=MathUtils.getDistance(t.x,t.y,s.x,s.y);return n<i.castRange*GameMap.CELL_SIZE},e.prototype.screeningSkill=function(t){var e=this.aiList[t];if(this.skillCD[t]=this.skillCD[t]||{},e.team==Team.My){var i=EntityManager.ins().getNoDieRole();if(i&&i!=e&&!this.checkTeamDistan(e,i,10))return void(this.curSkill[t]=null)}var s=this.curSkill[t];if(s&&egret.getTimer()-this.skillCD[t][s.id]<s.cd&&(this.curSkill[t]=null),!this.curSkill[t]){var n=this.getCanUseSkillList(e);if(n){var o,a=0,r=n[a];if(o=r&&r.tarEff?GlobalConfig.EffectsConfig[r.tarEff[0]]:null,o&&o.type==SkillEffType.Summon&&e.hasBuff(o.group)&&(r=n[++a]),o=r&&r.tarEff?GlobalConfig.EffectsConfig[r.tarEff[0]]:null,o&&o.type==SkillEffType.AddBlood&&(EntityManager.ins().checkCanAddBlood(e.team)||(r=n[++a])),r&&25e3==r.id){var h=this.curTarget[e.infoModel.handle];h&&h.AI_STATE!=AI_State.Die||(h=e),(Encounter.ins().isEncounter()||MineFight.ins().isFighting||!EntityManager.ins().checkCount(h,r.affectRange,2,h.team!=e.team))&&(r=n[++a])}r&&13e3==r.id&&(Encounter.ins().isEncounter()||MineFight.ins().isFighting||!EntityManager.ins().checkCount(e,r.affectRange,2))&&(r=n[++a]),this.curSkill[t]=r}}},e.prototype.getCanUseSkillList=function(t,e){void 0===e&&(e=!0);var i=[];if(t instanceof CharRole&&t.infoModel){if(Assert(t.infoModel.skillsData,"角色技能为空，isMy:"+t.isMy+",fbType:"+GameMap.fbType+",fubenId:"+GameMap.fubenID))return;if(i=t.infoModel.skillsData.concat(),t.team==Team.My){var s=GodWeaponCC.ins().getJobGWNewSkill(t.infoModel.job);s&&(i=i.concat(s));var n=t.infoModel.index,o=JadeNew.ins().getJadeDataByID(n);o&&(i=i.concat(o.getSkillList()))}else{var o=t.infoModel.jadeData;o&&(i=i.concat(o.getSkillList()))}i=i.concat(ExtremeEquipModel.ins().getZhiZunSkills(t.infoModel))}else if(t.team==Team.My)if(SpecialRing.ins().isFireRing(t.infoModel.handle)){var a=SpecialRing.ins().getRingSkill();if(a){var r=ObjectPool.pop("SkillData");r.configID=a,i.push(r)}if(a=LyMark.ins().getCurSkillID()){var r=ObjectPool.pop("SkillData");r.specialCD=LyMark.ins().getCurSkillCD(),r.configID=a,i.push(r)}}else{var r=ObjectPool.pop("SkillData");r.configID=80001;var s=GodWeaponCC.ins().getReviseBySkill(35e3);s&&s.length&&(r.configID=80002),i.push(r)}else{var r=ObjectPool.pop("SkillData");r.configID=50001,i.push(r)}if(i&&0!=i.length){var h=t.infoModel.handle;this.skillCD[h]=this.skillCD[h]||{};var l=i.length;if(0!=l){for(var c=[],u=0;l>u;u++)if(i[u].canUse&&e!=i[u].isPassive){var p=0;if(t.team==Team.My){var d=Artifact.ins().getReviseBySkill(i[u].id);d&&d.cd&&(p+=d.cd);var s=GodWeaponCC.ins().getReviseBySkill(i[u].id),g=void 0;s&&(g=s[0]),g&&g.cd&&(p+=g.cd)}egret.getTimer()-this.skillCD[h][i[u].id]<i[u].cd-p||c.push(i[u])}return c.sort(this.sortFunc),c}}},e.prototype.damageBaseCalculation=function(t,e,i){var s,n=0,o=0,a=0,r=JobConst.None,h=(JobConst.None,!1),l=!1,c=t.infoModel,u=0,p=0,d=0,g=0,f=0;if(t.team==Team.My){var v=Artifact.ins().getReviseBySkill(i.id);if(v&&(u=v.a||0,p=v.b||0,g=v.d||0,v.selfEff))for(var y in v.selfEff)s=t.buffList[v.selfEff[y]],s&&3==s.effConfig.type&&(f+=s.value);var m=GodWeaponCC.ins().getReviseBySkill(i.id),T=void 0;if(m&&(T=m[0]),T&&(u+=T.a||0,p+=T.b||0,g+=T.d||0,T.selfEff))for(var y in T.selfEff)s=t.buffList[T.selfEff[y]],s&&3==s.effConfig.type&&(f+=s.value)}if(i.preId&&GlobalConfig.FlameStamp.skillId.indexOf(i.preId)>=0){var b=c.lyMarkLv||0;if(b){var C=GlobalConfig.FlameStampLevel[b];C&&(u+=C.bulletDamage.a,p+=C.bulletDamage.b)}var I=c.lyMarkSkills||[];if(b=I[6]||0){var C=GlobalConfig.FlameStampEffect[7][b];C.bulletDamage&&(u+=C.bulletDamage.a||0,p+=C.bulletDamage.b||0)}}if(h=t instanceof CharRole?!0:!1,l=e instanceof CharRole?!0:!1,n=h&&r?r==JobConst.ZhanShi?GameLogic.calculateRealAttribute(e,AttributeType.atDef,t):GameLogic.calculateRealAttribute(e,AttributeType.atRes,t):GameLogic.calculateRealAttribute(e,AttributeType.atDef,t),o=n*(1-c.getAtt(AttributeType.atPenetrate)/1e4),3==i.calcType){if(i.args){var w=0;if(t.team==Team.My)for(var _=SubRoles.ins().subRolesLen,S=0;_>S;S++){var B=SubRoles.ins().getSubRoleByIndex(S);B&&(w+=B.getAtt(AttributeType.atAttack))}else if(t.team==Team.WillEntity)for(var E=HejiUseMgr.ins().getRoles(),_=E.length,S=0;_>S;S++){var B=E[S];B&&(w+=B.getAtt(AttributeType.atAttack))}w=Math.max(w-o,.05*w);var x=i.args.b?i.args.b+p:0+p;a=w*(i.args.a+u)+x+d,a=Math.max(a,.05*w),a=e instanceof CharRole?Math.floor(a*(1+c.getExAtt(ExAttributeType.eatTogetherHitRoleDamageInc)/1e4)):Math.floor(a*(1+c.getExAtt(ExAttributeType.eatTogetherHitMonDamageInc+g)/1e4)),a=Math.floor(a*(1-c.getExAtt(ExAttributeType.eatTogetherHitFree)/1e4));var R=GameLogic.calculateRealAttribute(t,AttributeType.atRoleDamageEnhance,t);R-=GameLogic.calculateRealAttribute(e,AttributeType.atRoleDamageReduction,t),R-=GameLogic.calculateRealAttribute(e,AttributeType.atDamageReduction,t),a=Math.floor(a*(1+R/1e4)),a+=c.getAtt(AttributeType.atTogetherHolyDamege)*(1+c.getAtt(AttributeType.atTogetherHolyMaster)/1e4-e.infoModel.getAtt(AttributeType.atTogetherHolyResist)/1e4)}}else if(i.targetType==TargetType.Enemy&&i.args){for(var M=0,D=Math.floor(i.id/1e3)%100,S=0;S<skillConst.baseSkillIndex.length;S++)D==skillConst.baseSkillIndex[S]&&(M=c.attributeExData[ExAttributeType.eatBaseSkillExArg]);var w=c.getAtt(AttributeType.atAttack),A=GameLogic.calculateRealAttribute(t,AttributeType.atAttack,t);if(80002==i.configID){var k=this.gePetSkillAdd(t);A+=Math.floor(w*k/1e4)}var P=GameLogic.triggerAttr(t,AttributeType.atAttAddDamPro),L=0;P&&(L=c.getAtt(AttributeType.atAttAddDamVal),t.addPaoPao(15));var G=0;e.hasBuff(51001)&&c.getAtt(AttributeType.atAttMbAddDamPen)&&(G=c.getAtt(AttributeType.atAttMbAddDamPen),t.addPaoPao(17));var U=0;c.getAtt(AttributeType.atAttHpLtPenAddDam)&&e.infoModel.getAtt(AttributeType.atHp)/e.infoModel.getAtt(AttributeType.atMaxHp)<c.getAtt(AttributeType.atAttHpLtPenAddDam)/1e4&&(U=c.getAtt(AttributeType.atAttHpLtAddDamPen),this.hashHpObj[e.hashCode]||(t.addPaoPao(19),this.hashHpObj[e.hashCode]=1));var F=0;c.type==EntityType.Role&&e.infoModel.type==EntityType.Role&&(Encounter.ins().isEncounter()?F=EncounterFight.ins().getWeiSheHurt(t.isMy):MineFight.ins().isFighting&&(F=MineFight.ins().getWeiSheHurt(t.isMy)));var N=0;if(c.getExAtt(ExAttributeType.eatMiJiKNHpPer)){var O=c.getAtt(AttributeType.atHp)/c.getAtt(AttributeType.atMaxHp)*1e4;O<c.getExAtt(ExAttributeType.eatMiJiKNHpPer)&&(N=Math.floor((c.getExAtt(ExAttributeType.eatMiJiKNHpPer)-O)/c.getExAtt(ExAttributeType.eatMiJiKNHpSubPer))*c.getExAtt(ExAttributeType.eatMiJiKNDamPer))}c.getExAtt(ExAttributeType.eatMiJiZHDamPer)&&this.getIsTriggerAttr(t,1,ExAttributeType.eatMiJiZHTime)&&(N+=c.getExAtt(ExAttributeType.eatMiJiZHDamPer));var x=i.args.b?i.args.b+p:0+p;l&&i.args.c&&(d+=i.args.c*e.infoModel.getAtt(AttributeType.atHp)),A=Math.max(A-o,.05*A),a=A*(i.args.a+M+u)+x+d+L,a=Math.floor(a*(1+(g+G+U+F+N)/1e4));var R=GameLogic.calculateRealAttribute(t,AttributeType.atRoleDamageEnhance,t);R-=GameLogic.calculateRealAttribute(e,AttributeType.atRoleDamageReduction,t),R-=GameLogic.calculateRealAttribute(e,AttributeType.atDamageReduction,t),a=Math.floor(a*(1+R/1e4)),a=Math.max(a,.05*w)}var W=(105-10*Math.random())/100;return a*=W,Math.floor(a)},e.prototype.gePetSkillAdd=function(t){var e=t.infoModel.masterHandle,i=EntityManager.ins().getEntityByHandle(e);if(i&&i.infoModel&&i.infoModel.getExAtt(ExAttributeType.eatPetAttackInc)){var s=i.infoModel.getExAtt(ExAttributeType.eatPetAttackInc),n=0,o=EntityManager.ins().getTeamCount(t.team);return t.team==Team.My?n=SubRoles.ins().subRolesLen+1-o:t.team==Team.WillEntity&&(Encounter.ins().isEncounter()?n=EncounterFight.ins().getRoles().length+1-o:MineFight.ins().isFighting&&(n=MineFight.ins().getRoles().length+1-o)),s*n}return 0},e.prototype.damageBuff=function(t,e,i){t instanceof CharMonster&&(t.team==Team.Monster||t.team==Team.WillBoss)&&"神兽"!=t.infoModel.name&&(i=0);var s=e.buffList[19001];if(s){var n=s.effConfig,o=Math.floor(i*n.args.a);s.value-=o,s.value<=0&&e.removeBuff(s),i=i-o+(s.value<0?-s.value:0)}if(s=e.buffList[60002]){var n=s.effConfig,o=Math.floor(i*(n.args.c/1e4));i-=o}if(s=e.buffList[60004],s&&(i=0),e instanceof CharRole&&e.infoModel&&e.infoModel.exRingsData&&1==e.infoModel.exRingsData[1]){var a=e.infoModel.getAtt(AttributeType.atMp);if(a>0){var r=a-i;e.infoModel.setAtt(AttributeType.atMp,r>0?r:0),i=i-a>=0?i-a:0}}return s=e.buffList[80001],s&&i>0&&(i-=s.value,i=i>0?i:0),i},e.prototype.sortFunc=function(t,e){var i=t.job,s=GlobalConfig.SkillsSorderConfig[i];if(!s)return 0;var n=s.skillorder,o=n.length,a=n.length;for(var r in n)n[r]==t.id&&(o=+r),n[r]==e.id&&(a=+r);return o>a?1:a>o?-1:0},e.prototype.screeningTarget=function(t,e,i){void 0===e&&(e=Number.MAX_VALUE),void 0===i&&(i=!1);var s=t.infoModel.handle,n=this.curSkill[s],o=0;if(n&&(o=n.targetType),i||(i=o==TargetType.Friendly),!i&&this.lastTarget[s]){var a=EntityManager.ins().getEntityByHandle(this.lastTarget[s]);if(a&&a.parent&&a.AI_STATE!=AI_State.Die)return void(this.curTarget[s]=a)}var r=EntityManager.ins().screeningTargetByPos(t,i,0,e,this.aiList);switch(t.team){case Team.My:var h=this.checkMySubInList(r,!1,Team.Faker);this.curTarget[s]=h;break;case Team.Faker:var a=this.checkMySubInList(r);this.curTarget[s]=a;break;default:this.curTarget[s]=r?r[0]:null}!i&&this.curTarget[s]&&(this.lastTarget[s]=this.curTarget[s].infoModel.handle)},e.prototype.checkMySubInList=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=Team.My);for(var s=0;s<t.length;s++)if(e){if(t[s].team==i)return t[s]}else if(t[s].team!=i)return t[s];return null},e.prototype.trace=function(t){this.isLog&&console.warn(t)},e.prototype.startZhanLing=function(){this.zhanlingdelayTime&&egret.getTimer()-this.zhanlingdelayTime>GlobalConfig.ZhanLingConfig.delayTime&&(this.zhanlingdelayTime=0,this.checkShowZhanling()),egret.getTimer()-this.zhanlingTime>1e4&&this.checkShowZhanling()},e}(BaseClass);RoleAI.AI_UPDATE_TIME=100,RoleAI.SEND_TASK_TYPE=68,__reflect(RoleAI.prototype,"RoleAI");var Team;!function(t){t[t.My=0]="My",t[t.Monster=1]="Monster",t[t.WillEntity=2]="WillEntity",t[t.WillBoss=3]="WillBoss",t[t.NotAtk=4]="NotAtk",t[t.Faker=5]="Faker"}(Team||(Team={}));var TargetType;!function(t){t[t.Friendly=1]="Friendly",t[t.Enemy=2]="Enemy",t[t.My=3]="My"}(TargetType||(TargetType={}));var AI_State;!function(t){t[t.Stand=0]="Stand",t[t.Run=1]="Run",t[t.Atk=2]="Atk",t[t.Die=3]="Die",t[t.Patrol=4]="Patrol"}(AI_State||(AI_State={}));var AttributeData=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.type=t,this.value=e}return t.AttrAddition=function(e,i){if(!e||e.length<=0)return i?i.concat():null;if(!i||i.length<=0)return e?e.concat():null;for(var s=e.concat(i),n=[],o=s.length,a=new Object,r=0;o>r;r++)void 0==a[s[r].type]&&(a[s[r].type]=0),a[s[r].type]+=s[r].value;for(var h in a)n.push(new t(+h,+a[h]));return n},t.AttrDel=function(e,i){for(var s=[],n=0;n<e.length;n++){var o=new t;o.type=0!=e[n].type?e[n].type:i[n].type,o.value=e[n].value-i[n].value,s.push(o)}return s},t.AttrMultiply=function(e,i){for(var s=[],n=0;n<e.length;n++){var o=new t;o.type=0!=e[n].type?e[n].type:i[n].type,o.value=e[n].value*(1+i[n].value/1e4),s.push(o)}return s},t.transformAttr=function(e){var i=[];for(var s in e){var n=new t;n.type=e[s].type,n.value=e[s].value,i.push(n)}for(var o=0;o<i.length-1;o++)for(var a=0;a<i.length-o-1;a++)if(i[a]<i[a+1]){var r=i[a+1];i[a+1]=i[a],i[a]=r}return i},t.getAttStr=function(e,i,s,n,o,a,r,h){void 0===i&&(i=4),void 0===s&&(s=1),void 0===n&&(n="+"),void 0===o&&(o=!1),void 0===a&&(a=!0);var l="",c=0;if(e instanceof t)return this.getAttStrByType(e,i,n,o,a);if(!(e instanceof Array)){var u=[];for(var p in this.translate)if(!isNaN(e[p])){var d=new t;d.type=parseInt(this.translate[p]),d.value=e[p],u.push(d)}return this.getAttStr(u,i,s,n,o)}for(var g=e,f=g.length-1,v=0;v<g.length;v++)if(0!=g[v].type)if(g[v].type!=AttributeType.atHpEx&&g[v].type!=AttributeType.atAtkEx&&g[v].type!=AttributeType.atDamageReduction&&g[v].type!=AttributeType.atDefEx&&g[v].type!=AttributeType.atResEx){if(l+=this.getAttStrByType(g[v],i,n,o,a),r&&r.attr_add&&(l+="+"+Math.floor(g[v].value*(r.attr_add/100))),h&&(l+=h),f+c>v)for(var y=0;s>y;y++)l+="\n"}else c=-1;if(0>c){var m=l.lastIndexOf("\n");l=l.substring(0,m)}return l},t.getAttStr1=function(t,e){for(var i="",s=0;s<t.length;s++)i+=this.getAttStrByType1(t[s],e),s<t.length-1&&(i+=StringUtils.repeatStr("\n",e.emptyLine+1));
return i},t.getAttStrByType1=function(e,i){var s=t.getAttrStrByType(e.type),n=e.type,o=(i.sign,"");o=n==AttributeType.atCrit?e.value/100+"%":n==AttributeType.atTogetherHolyDamege||n==AttributeType.atHolyDamege?e.value.toString():n>=AttributeType.atHpEx?n==AttributeType.atStunTime?e.value/1e3+"秒":n==AttributeType.atAtkEx?e.value/100+"%":n==AttributeType.atCritHurt?(e.value>>0)+"":(e.value/100>>0)+"%":e.value.toString();var a=StringUtils.addColor(s+i.sign,i.wordColor);i.isShowAttName&&(a=StringUtils.complementByChar(a,i.intervals));var r=a+StringUtils.addColor(o,i.attrColor);return r},t.getAttStrByType=function(e,i,s,n,o){void 0===i&&(i=4),void 0===s&&(s="+"),void 0===n&&(n=!0),void 0===o&&(o=!0);var a="";switch(o&&(a=n?StringUtils.complementByChar(t.getAttrStrByType(e.type),8*i):t.getAttrStrByType(e.type)),e.type){case AttributeType.atCrit:case AttributeType.atZhuiMingPro:a+=s+e.value/100+"%";break;case AttributeType.atStunTime:a+=s+e.value/1e3+"秒";break;case AttributeType.atJob1HpEx:case AttributeType.atJob2HpEx:case AttributeType.atJob3HpEx:case AttributeType.atHp:case AttributeType.atMp:case AttributeType.atMaxHp:case AttributeType.atMaxMp:case AttributeType.atAttack:case AttributeType.atDef:case AttributeType.atRes:case AttributeType.atTough:case AttributeType.atMoveSpeed:case AttributeType.atAttackSpeed:case AttributeType.maxNeiGong:case AttributeType.atNeiGongRestore:case AttributeType.atJob1AtkEx:case AttributeType.atJob2AtkEx:case AttributeType.atJob3AtkEx:case AttributeType.atJob1DefEx:case AttributeType.atJob2DefEx:case AttributeType.atJob3DefEx:case AttributeType.atJob1ResEx:case AttributeType.atJob2ResEx:case AttributeType.atJob3ResEx:case AttributeType.atHolyDamege:case AttributeType.atTogetherHolyDamege:case AttributeType.atZhuiMingVal:case AttributeType.atCritHurt:case AttributeType.atHuiXinDamage:case AttributeType.atDeadLyHurt:case AttributeType.atDeadLyHurtResist:case AttributeType.atCritHurtResist:case AttributeType.atHearthDamege:a+=s+e.value;break;default:a+=s+(e.value/100).toFixed(1)+"%"}return e.type==AttributeType.atYuPeiDeterDam&&(a="|C:0xFF0000&T:"+a+"|"),a},t.getExtAttStrByType=function(e,i,s,n,o){void 0===i&&(i=4),void 0===s&&(s="+"),void 0===n&&(n=!1),void 0===o&&(o=!0);var a="";return o&&(a=StringUtils.complementByChar(t.getExtAttrStrByType(e.type),8*i)),a+=e.type==ExAttributeType.eatGodBlessRate||e.type==ExAttributeType.eatGodBlessProbability||e.type==ExAttributeType.eatAttackAddHpProbability||e.type==ExAttributeType.eatDeathCurseProbability||e.type==ExAttributeType.eatAddWarriorDamageInc||e.type==ExAttributeType.eatAddMageDamageInc||e.type==ExAttributeType.eatAddTaoistDamageInc||e.type==ExAttributeType.eatAddToTaoistDamageInc||e.type==ExAttributeType.eatSubWarriorDamageInc||e.type==ExAttributeType.eatSubMageDamageInc||e.type==ExAttributeType.eatSubTaoistDamageInc||e.type==ExAttributeType.eatTogetherHitFree||e.type==ExAttributeType.eatMiss||e.type==ExAttributeType.eatTogetherHitMonDamageInc||e.type==ExAttributeType.eatTogetherHitRoleDamageInc||e.type==ExAttributeType.eatAddToWarriorDamageInc||e.type==ExAttributeType.eatAddToMageDamageInc||e.type==ExAttributeType.eatAddToMageDamageInc||e.type==ExAttributeType.eatDeathCurseDamageIncrease?s+e.value/100+"%":e.type==ExAttributeType.eatDeathCurseTime?s+e.value/1e3+"秒":e.type==ExAttributeType.eatIgnoreReflect?"":s+e.value},t.inserteBlank=function(t,e,i){void 0===i&&(i=1);for(var s=t.length,n="";e--;)n+=" ";var o="";switch(i){case 0:o=n+t;break;case 1:o=t.slice(0,s/2)+n+t.slice(s/2);break;case 2:o=t+n}return o},t.getAttrInfoByItemData=function(e){var i=GlobalConfig.EquipConfig[e.configID],s="",n=0;for(var o in this.translate)if(!(i[o]<=0))for(var a=0;a<e.att.length;a++)n=e.att[a].type,this.translate[o]==n&&(s+=t.getAttrStrByType(n)+": ",s+=i[o]+" +"+e.att[a].value+"\n");return s},t.getAttrStrByType=function(t){var e="";switch(t){case AttributeType.atHp:e="当前生命";break;case AttributeType.atMp:e="当前魔法";break;case AttributeType.atMaxHp:e="生命";break;case AttributeType.atMaxMp:e="魔法";break;case AttributeType.atAttack:e="攻击";break;case AttributeType.atDef:e="物防";break;case AttributeType.atRes:e="魔防";break;case AttributeType.atCrit:e="暴击";break;case AttributeType.atTough:e="抗暴";break;case AttributeType.atMoveSpeed:e="移速";break;case AttributeType.atAttackSpeed:e="攻速";break;case AttributeType.atHpEx:e="生命加成";break;case AttributeType.atAtkEx:e="攻击加成";break;case AttributeType.atStunPower:e="麻痹几率";break;case AttributeType.atStunRes:e="麻痹抵抗";break;case AttributeType.atStunTime:e="麻痹时间";break;case AttributeType.atDamageReduction:e="伤害减免";break;case AttributeType.atCritHurt:e="暴击伤害";break;case AttributeType.atCritEnhance:e="暴击伤害加强";break;case AttributeType.atRoleDamageEnhance:e="[全怒]对所有职业伤害增加";break;case AttributeType.atRoleDamageReduction:e="[全制]受到所有职业伤害减少";break;case AttributeType.atDefEx:e="物理防御百分比";break;case AttributeType.atResEx:e="魔法防御百分比";break;case AttributeType.atJob1HpEx:e="战士生命";break;case AttributeType.atJob2HpEx:e="法师生命";break;case AttributeType.atJob3HpEx:e="道士生命";break;case AttributeType.atNeiGongRestore:e="间隔3秒恢复内功值";break;case AttributeType.cruNeiGong:e="当前内功值";break;case AttributeType.maxNeiGong:e="内功值";break;case AttributeType.neigongAbsorbHurt:e="伤害吸收";break;case AttributeType.atJob1AtkEx:e="战士攻击";break;case AttributeType.atJob2AtkEx:e="法师攻击";break;case AttributeType.atJob3AtkEx:e="道士攻击";break;case AttributeType.atJob1DefEx:e="战士防御";break;case AttributeType.atJob2DefEx:e="法师防御";break;case AttributeType.atJob3DefEx:e="道士防御";break;case AttributeType.atJob1ResEx:e="战士魔防";break;case AttributeType.atJob2ResEx:e="法师魔防";break;case AttributeType.atJob3ResEx:e="道士魔防";break;case AttributeType.atYuPeiDeterDam:e="威慑";break;case AttributeType.atCritEnhanceResist:e="暴击伤害减免";break;case AttributeType.atHolyDamege:e="神圣伤害";break;case AttributeType.atHolyMaster:e="神圣精通";break;case AttributeType.atTogetherHolyDamege:e="合击神圣伤害";break;case AttributeType.atZhuiMingVal:e="无影伤害";break;case AttributeType.atHuiXinDamage:e="暴击强度";break;case AttributeType.atNeiGongEx:e="内功加成";break;case AttributeType.atDeadLyPro:e="致命一击率";break;case AttributeType.atDeadLyMaster:e="致命一击伤害";break;case AttributeType.atDeadLyResist:e="致命一击伤害减免";break;case AttributeType.atBladeMailPer:e="反伤";break;case AttributeType.atDefPen:e="物防穿透";break;case AttributeType.atResPen:e="魔防穿透";break;case AttributeType.atDeadLyHurt:e="致命一击伤害";break;case AttributeType.atDeadLyHurtResist:e="致命一击减免";break;case AttributeType.atCritHurtResist:e="暴击伤害减免";break;case AttributeType.atHearthDamege:e="夺命追伤"}return e},t.getExtAttrStrByType=function(t){var e="";switch(t){case ExAttributeType.eatReflectProbability:e="反伤概率";break;case ExAttributeType.eatReflectRate:e="反伤比率";break;case ExAttributeType.eatIgnoreReflect:e="攻击无视反伤效果，增加自身2%攻击力";break;case ExAttributeType.eatGodBlessProbability:e="神佑触发 概率";break;case ExAttributeType.eatGodBlessRate:e="神佑复活万分比";break;case ExAttributeType.eatDeathCurseProbability:e="死咒触发概率";break;case ExAttributeType.eatDeathCurseDamageIncrease:e="死咒增加伤害";break;case ExAttributeType.eatDeathCurseTime:e="死咒效果展示时间";break;case ExAttributeType.eatAllCrit:e="暴击率";break;case ExAttributeType.eatAllCritTime:e="AllCrit暴击触发后，持续的时间, 单位:秒";break;case ExAttributeType.eatBeHitTimesDodge:e="受到X次攻击时必定闪避";break;case ExAttributeType.eatAttackTimesCrit:e="攻击X次必定产生暴击（暴击）";break;case ExAttributeType.eatAttackAddHpProbability:e="治疗戒指,攻击时候补血的概率";break;case ExAttributeType.eatAttackAddHpValue:e="治疗戒指,攻击的时候补血数";break;case ExAttributeType.eatAddToWarriorDamageInc:e="[怒战]对战士伤害增加";break;case ExAttributeType.eatAddToMageDamageInc:e="[怒法]对法师伤害增加";break;case ExAttributeType.eatAddToTaoistDamageInc:e="[怒道]对道士伤害增加";break;case ExAttributeType.eatSubWarriorDamageInc:e="[制战]受到战士伤害减少";break;case ExAttributeType.eatSubMageDamageInc:e="[制法]受到法师伤害减少";break;case ExAttributeType.eatSubTaoistDamageInc:e="[制道]受到道士伤害减少";break;case ExAttributeType.eatTogetherHitFree:e="合击受到的伤害减少";break;case ExAttributeType.eatTogetherHitMonDamageInc:e="合击技能对怪物伤害";break;case ExAttributeType.eatTogetherHitRoleDamageInc:e="合击技能对玩家伤害";break;case ExAttributeType.eatTogetherHitCdSub:e="怒气恢复速度";break;case ExAttributeType.eatAdditionalHarm:e="伤害增加固定值";break;case ExAttributeType.eatReductionHarm:e="伤害减免固定值";break;case ExAttributeType.eatMiss:e="闪避";break;case ExAttributeType.eatBaseSkillExArg:e="基础及能额外系数加成";break;case ExAttributeType.eatMultipleCrit:e="多重暴击几率";break;case ExAttributeType.eatMultipleCritCoeff:e="幸运一击的伤害加深";break;case ExAttributeType.atMultipleCritHurt:e="幸运一击的固定伤害加深";break;case ExAttributeType.eatAddWarriorDamageInc:e="战士伤害";break;case ExAttributeType.eatAddMageDamageInc:e="法师伤害";break;case ExAttributeType.eatAddTaoistDamageInc:e="道士伤害";break;case ExAttributeType.eatMultipleCritTime:e="幸运一击的冷却时间";break;case ExAttributeType.eatAttackAddHpTime:e="治疗戒指,攻击的时候补血的冷却时间";break;case ExAttributeType.eatHit:e="命中"}return e},t.getExAttrNameByAttrbute=function(e,i,s,n){void 0===i&&(i=!1),void 0===s&&(s="："),void 0===n&&(n=void 0);var o=t.getExtAttrStrByType(e.type),a="";if(i)switch(e.type){case ExAttributeType.eatAddWarriorDamageInc:case ExAttributeType.eatAddMageDamageInc:case ExAttributeType.eatAddTaoistDamageInc:case ExAttributeType.eatSubWarriorDamageInc:case ExAttributeType.eatSubMageDamageInc:case ExAttributeType.eatSubTaoistDamageInc:case ExAttributeType.eatTogetherHitFree:case ExAttributeType.eatTogetherHitMonDamageInc:case ExAttributeType.eatTogetherHitRoleDamageInc:case ExAttributeType.eatAllCrit:case ExAttributeType.eatHit:case ExAttributeType.eatMiss:a=e.value/100+"%";break;default:a+=e.value}return void 0!=n?o=""+o+s+"|C:"+n+"&T:"+a+"|":o+=s+a,o},t.getEEquipAttrStrByType=function(t){var e="";switch(t){case EquipAddAttrType.EquipSlotType_Weapon:e="武器基础属性";break;case EquipAddAttrType.EquipSlotType_Helmet:e="头盔基础属性";break;case EquipAddAttrType.EquipSlotType_Coat:e="衣服基础属性";break;case EquipAddAttrType.EquipSlotType_Necklace:e="项链基础属性";break;case EquipAddAttrType.EquipSlotType_Accessory1:e="手镯基础属性";break;case EquipAddAttrType.EquipSlotType_Accessory2:e="腰带基础属性";break;case EquipAddAttrType.EquipSlotType_Ring1:e="戒指基础属性";break;case EquipAddAttrType.EquipSlotType_Ring2:e="鞋子基础属性"}return e},t.getAttrStrAdd=function(e,i){var s=[];if(UserVip.ins().lv>=i){var n=GlobalConfig.VipConfig[i].attrAddition.percent;n=n?n:0,e.forEach(function(e){var i=new t;i.type=e.type,i.value=e.value*(100+n)/100>>0,s.push(i)})}else s=e;return s},t.getAttrStarAdd=function(e,i){var s=[];return e.forEach(function(e){var n=new t;n.type=e.type,n.value=e.value*i>>0,s.push(n)}),s},t.getAttrNameByAttrbute=function(e,i,s,n,o){void 0===i&&(i=!1),void 0===s&&(s="："),void 0===n&&(n=!1),void 0===o&&(o=void 0);var a=t.getAttrStrByType(e.type);n&&(a=t.inserteBlank(a,7));var r="";if(i)switch(e.type){case AttributeType.atCrit:case AttributeType.atTough:r=e.value/100+"%";break;default:r=e.value+""}return void 0!=o?a=""+a+s+"|C:"+o+"&T:"+r+"|":a+=s+r,a},t.getPercentAttr=function(e,i){for(var s=[],n=0;n<e.length;n++){var o=new t;o.type=e[n].type,o.value=Math.floor(e[n].value*(1+i)),s.push(o)}return s},t.getPowerBy=function(t){if(!t)return 0;var e=0;return e},t.sortAttribute=function(t,e){return Algorithm.sortAsc(t.type,e.type)},t.copyAttrbute=function(e){var i=new t;return i.type=e.type,i.value=e.value,i},t.addAttrToList=function(e,i){if(!e[i.type]){var s=new t;s.type=i.type,s.value=0,e[i.type]=s}var n=e[i.type];n.value+=i.value},t}();AttributeData.FILTER_EXTDATA_ID=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,35,37,38,39],AttributeData.FILTER_BASE_DATA_ID=[18,20],AttributeData.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough},AttributeData.exRelate={2:AttributeType.atHpEx,4:AttributeType.atAtkEx,5:AttributeType.atDefEx,6:AttributeType.atResEx},__reflect(AttributeData.prototype,"AttributeData");var AttributeFormat=function(){function t(){this.intervals=4,this.emptyLine=0,this.sign="+",this.spaceCount=0,this.isShowAttName=1,this.wordColor=t.DEFAULT_COLOR,this.attrColor=t.DEFAULT_COLOR}return t.getFormat=function(e,i,s,n,o,a,r){void 0===e&&(e=4),void 0===i&&(i=0),void 0===s&&(s="+"),void 0===n&&(n=0),void 0===o&&(o=1),void 0===a&&(a=this.DEFAULT_COLOR),void 0===r&&(r=this.DEFAULT_COLOR);var h=new t;return h.intervals=e,h.emptyLine=i,h.sign=s,h.spaceCount=n,h.isShowAttName=o,h.wordColor=a,h.attrColor=r,h},t.FORMAT_1=function(){return this.getFormat(0,0,"：")},t.FORMAT_2=function(){var t=this.FORMAT_1();return t.attrColor=3532333,t},t}();AttributeFormat.DEFAULT_COLOR=14668213,__reflect(AttributeFormat.prototype,"AttributeFormat");var TimerManager=function(t){function e(){var e=t.call(this)||this;return e.currHandler=null,e._handlers=[],e.nexthandles=null,e._currTime=egret.getTimer(),e._currFrame=0,egret.startTick(e.onEnterFrame,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getFrameId=function(){return this._currFrame},e.prototype.getCurrTime=function(){return this._currTime},e.binFunc=function(t,e){return t.exeTime>e.exeTime?-1:t.exeTime<e.exeTime?1:0},e.DeleteHandle=function(t){t.clear(),ObjectPool.push(t)},e.prototype.onEnterFrame=function(t){this._currFrame++,this._currTime=egret.getTimer();var i=0,s=this.nexthandles;if(this.nexthandles=null,s&&s.length>0){for(var n=0,o=s;n<o.length;n++){var a=o[n];a.method.call(a.methodObj),e.DeleteHandle(a)}s=null}if(this._handlers.length<=0)return!1;for(var r=this._handlers[this._handlers.length-1];r.exeTime<=this._currTime;){this.currHandler=r=this._handlers.pop(),r.method.call(r.methodObj),i=egret.getTimer(),r.exeTime=i+r.delay;var h=r.forever;if(h||(r.repeatCount>1?(r.repeatCount--,h=!0):r.onFinish&&r.onFinish.apply(r.finishObj)),h){var l=Algorithm.binSearch(this._handlers,r,e.binFunc);this._handlers.splice(l,0,r)}else e.DeleteHandle(r);if(i-this._currTime>5)break;if(this._handlers.length<=0)break;r=this._handlers[this._handlers.length-1]}return this.currHandler=null,!1},e.prototype.create=function(t,i,s,n,o,a,r){if(!(0>i||0>s||null==n)){var h=ObjectPool.pop("TimerHandler");h.forever=0==s,h.repeatCount=s,h.delay=i,h.method=n,h.methodObj=o,h.onFinish=a,h.finishObj=r,h.exeTime=t+this._currTime;var l=Algorithm.binSearch(this._handlers,h,e.binFunc);this._handlers.splice(l,0,h)}},e.prototype.doTimer=function(t,e,i,s,n,o){void 0===n&&(n=null),void 0===o&&(o=null),this.create(t,t,e,i,s,n,o)},e.prototype.doTimerDelay=function(t,e,i,s,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(t,e,i,s,n,o,a)},e.prototype.doNext=function(t,e){var i=ObjectPool.pop("TimerHandler");i.method=t,i.methodObj=e,this.nexthandles||(this.nexthandles=[]),this.nexthandles.push(i)},e.prototype.remove=function(t,i){var s=this.currHandler;s&&s.method==t&&s.methodObj==i&&(s.forever=!1,s.repeatCount=0);for(var n=this._handlers.length-1;n>=0;n--){var o=this._handlers[n];o.method==t&&o.methodObj==i&&(this._handlers.splice(n,1),e.DeleteHandle(o))}},e.prototype.removeAll=function(t){var i=this.currHandler;i&&i.methodObj==t&&(i.forever=!1,i.repeatCount=0);for(var s=this._handlers.length-1;s>=0;s--){var n=this._handlers[s];n.methodObj==t&&(this._handlers.splice(s,1),e.DeleteHandle(n))}},e.prototype.isExists=function(t,e){for(var i=0,s=this._handlers;i<s.length;i++){var n=s[i];if(n.method==t&&n.methodObj==e)return!0}return!1},e}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.forever=!1,this.repeatCount=0,this.exeTime=0}return t.prototype.clear=function(){this.method=null,this.methodObj=null,this.onFinish=null,this.finishObj=null,this.forever=!1},t}();__reflect(TimerHandler.prototype,"TimerHandler");var AStar=function(){function t(t){void 0===t&&(t=null),this.m_nMarkTag=0,t&&this.initFromMap(t)}return t.prototype.initFromMap=function(t){var e=0;this.m_ASMapCells?e=this.m_ASMapCells.length:this.m_ASMapCells=[],this.m_nWidth=t.numCols,this.m_nHeight=t.numRows;var i=this.m_nWidth*this.m_nHeight;i>this.m_ASMapCells.length&&(this.m_ASMapCells.length=i);for(var s=e;i>s;++s)this.m_ASMapCells[s]=new ASMapCell;var n,o,a,r;for(a=0,o=0;o<this.m_nHeight;++o)for(n=0;n<this.m_nWidth;++n)r=this.m_ASMapCells[a],r.X=n,r.Y=o,r.CanNotMove=!t.isWalkableTile(n,o),a++},t.prototype.getPatch=function(e,i,s,n){if(e==s&&i==n)return null;(0>e||e>=this.m_nWidth||0>i||i>=this.m_nHeight)&&debug.log("寻路的起始位置参数无效：("+e+", "+i+")"),(0>s||s>=this.m_nWidth||0>n||n>=this.m_nHeight)&&debug.log("寻路的目的位置参数无效：("+s+", "+n+")");var o=this.m_ASMapCells[n*this.m_nWidth+s];if(!o||o.CanNotMove)return null;if(this.reset(e,i),this.pathLine({x:e,y:i},{x:s,y:n}))return[new AStarNode(s,n,DirUtil.get8DirBy2Point({x:e,y:i},{x:s,y:n}))];var a=!1,r=e,h=i,l=this.m_ASMapCells[h*this.m_nWidth+r];l.GCost=0,l.LastX=-1,l.LastY=-1,l.X=r,l.Y=h,l.MarkTag=this.m_nMarkTag,l.HCost=Math.abs(s-e)+10*Math.abs(n-i);for(var c,u,p,d;;){if(r==s&&h==n){a=!0;break}for(l.State!=ASMapCell.CSCLOSE&&this.closeCell(l),c=0;8>c;++c)u=r+t.NEIGHBORPOS_X_VALUES[c],p=h+t.NEIGHBORPOS_Y_VALUES[c],0>u||u>=this.m_nWidth||0>p||p>=this.m_nHeight||(d=this.m_ASMapCells[p*this.m_nWidth+u],d.CanNotMove||(d.MarkTag!=this.m_nMarkTag||d.State==ASMapCell.CSNONE?(d.MarkTag=this.m_nMarkTag,d.LastX=r,d.LastY=h,d.btDir=c,d.GCost=l.GCost+t.AS_MOVECOST[1&c],d.HCost=Math.abs(s-u)+10*Math.abs(n-p),this.openCell(d)):d.State==ASMapCell.CSOPEN&&d.GCost>l.GCost+t.AS_MOVECOST[1&c]&&(d.LastX=r,d.LastY=h,d.btDir=c,d.GCost=l.GCost+t.AS_MOVECOST[1&c],this.reopenCell(d))));if(l=this.m_LastOpenCell,null==l)break;r=l.X,h=l.Y}if(a){for(var g=new Array,f=void 0;;)if(f&&l&&f.nDir==l.btDir||(f=new AStarNode(l.X,l.Y,l.btDir),g.push(f)),l=this.m_ASMapCells[l.LastY*this.m_nWidth+l.LastX],l.LastX<=0&&l.LastY<=0||l.MarkTag!=this.m_nMarkTag)break;return g}return null},t.prototype.pathLine=function(t,e){var i=t,s=0;s=e.x==t.x?1:1*(e.y-t.y)/(e.x-t.x);for(var n=e.y-s*e.x,o=e.x>t.x?1:-1,a=e.y>t.y?1:-1,r=t.x+(o>0?1:0),h=Math.abs(t.x-e.x),l=e,c=0;h>=c;c++,r+=o){if(c!=h&&(l.x=o>0?r:r-1,l.y=Math.floor(s*l.x+n)),i.y!=l.y)for(var u=i.y+a;;u+=a){if(!GameMap.checkWalkable(i.x,u))return!1;if(u==l.y)break}if(c!=h&&!GameMap.checkWalkable(l.x,l.y))return!1;i=l}return!0},t.prototype.reset=function(t,e){var i=this.m_ASMapCells[e*this.m_nWidth+t];i.LastX=0,i.LastY=0,i.HCost=0,i.GCost=0,i.FValue=0,i.State=0,i.Prev=null,i.Next=null,i.btDir=0,this.m_LastOpenCell=null,this.m_nMarkTag=this.m_nMarkTag+1},t.prototype.closeCell=function(t){t.State==ASMapCell.CSOPEN&&(t.Prev&&(t.Prev.Next=t.Next),t.Next&&(t.Next.Prev=t.Prev),t==this.m_LastOpenCell&&(this.m_LastOpenCell=t.Prev)),t.State=ASMapCell.CSCLOSE},t.prototype.openCell=function(t){t.State=ASMapCell.CSOPEN;var e=t.HCost+t.GCost;t.FValue=e;var i=this.m_LastOpenCell;if(i){for(;i.FValue<e;){if(null==i.Prev)return i.Prev=t,t.Prev=null,void(t.Next=i);i=i.Prev}t.Prev=i,i.Next?(t.Next=i.Next,i.Next.Prev=t,i.Next=t):(t.Next=null,i.Next=t,this.m_LastOpenCell=t)}else this.m_LastOpenCell=t,t.Prev=null,t.Next=null},t.prototype.reopenCell=function(t){var e=t.HCost+t.GCost;t.FValue=e;var i=t.Next;if(i&&i.FValue>e){do i=i.Next;while(i&&i.FValue>e);t.Prev&&(t.Prev.Next=t.Next),t.Next&&(t.Next.Prev=t.Prev),i?(t.Next=i,i.Prev?(t.Prev=i.Prev,i.Prev.Next=t):t.Prev=null,i.Prev=t):(t.Prev=this.m_LastOpenCell,t.Next=null,this.m_LastOpenCell.Next=t,this.m_LastOpenCell=t)}},t}();AStar.RMOVECOST=14,AStar.DMOVECOST=10,AStar.AS_MOVECOST=[AStar.DMOVECOST,AStar.RMOVECOST],AStar.NEIGHBORPOS_X_VALUES=[0,1,1,1,0,-1,-1,-1],AStar.NEIGHBORPOS_Y_VALUES=[-1,-1,0,1,1,1,0,-1],__reflect(AStar.prototype,"AStar");var ASMapCell=function(){function t(){}return t}();ASMapCell.CSNONE=0,ASMapCell.CSOPEN=1,ASMapCell.CSCLOSE=2,__reflect(ASMapCell.prototype,"ASMapCell");var Bezier=function(){function t(t,e){this._fromPoint=t,this._toPoint=e}return t.pop=function(e,i){var s=null;return this._pool.length?(s=this._pool.pop(),s.fromPoint=e,s.toPoint=i):s=new t(e,i),s},t.push=function(t){t&&(t.display=null,t.ease=null,t.fromPoint=null,t.toPoint=null,t.centerPoint=null,this._pool.push(t))},Object.defineProperty(t.prototype,"fromPoint",{set:function(t){this._fromPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toPoint",{set:function(t){this._toPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"display",{set:function(t){this._display=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ease",{set:function(t){this._ease=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerPoint",{set:function(t){this._centerPoint=t},enumerable:!0,configurable:!0}),t.prototype.start=function(t,e,i,s){var n=this;void 0===s&&(s=0),egret.Tween.get(this).wait(s).to({factor:1},t,this._ease).call(function(){egret.Tween.removeTweens(n),e&&e.call(i)})},Object.defineProperty(t.prototype,"factor",{get:function(){return 0},set:function(t){this._display.x=(1-t)*(1-t)*this._fromPoint.x+2*t*(1-t)*this._centerPoint.x+t*t*this._toPoint.x,this._display.y=(1-t)*(1-t)*this._fromPoint.y+2*t*(1-t)*this._centerPoint.y+t*t*this._toPoint.y},enumerable:!0,configurable:!0}),t}();Bezier._pool=[],__reflect(Bezier.prototype,"Bezier");var EntityHideBody=function(t){function e(){var e=t.call(this)||this;return e.isOpen=!1,e.isShow=!1,e.showHandles=[],e.showNum=3,e.storageKey="hide_fbtype_",e.lastAtkHandle=0,e.lastFbID=0,e.observe(GameLogic.ins().postRemoveEntity,e.onRemoveEntity),e.observe(GameLogic.ins().postAtkTarget,e.onChangeTarget),e.observe(UserBoss.ins().postRemainTime,e.onRoleDie),e.observe(CityCC.ins().postRemainTime,e.onRoleDie),e.observe(DevildomSys.ins().postRevive,e.onRoleDie),e.observe(KFBossSys.ins().postRevive,e.onRoleDie),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.changeScene=function(){this.lastFbID!=GameMap.fubenID&&(this.lastFbID=GameMap.fubenID,this.isOpen=this.getIsOpen(),this.showHandles.length=0,this.lastAtkHandle=0,this.isOpen&&(this.isShow=!SysSetting.ins().getBool(this.storageKey+GameMap.fbType)),this.isOpen?ViewManager.ins().open(ShieldWin):ViewManager.ins().close(ShieldWin))},e.prototype.onCreateEntity=function(t){this.isOpen&&(t.isMy||t.type!=EntityType.Role||this.updateShowHandles(t.masterHandle,!0)&&this.sendHandlesToServer())},e.prototype.setShowState=function(t){this.isShow=t,this.showOrHideEntitys(this.isShow),this.sendHandlesToServer(),SysSetting.ins().setBool(this.storageKey+GameMap.fbType,!t)},e.prototype.checkIsShowBody=function(t){if(!this.isOpen)return!0;if(!this.isShow)return!1;var e=EntityManager.ins().getRootMasterHandle(t);return e?this.showHandles.indexOf(e)>=0:!0},e.prototype.onRemoveEntity=function(t){var e=(t[0],t[1]);this.isOpen&&!e.isMy&&e instanceof CharRole&&this.updateShowHandles(e.infoModel.masterHandle,!1)&&(this.sendHandlesToServer(),this.searchNewHandle())},e.prototype.updateShowHandles=function(t,e){if(e&&this.showHandles.length>=this.showNum)return!1;var i=this.showHandles.indexOf(t);if(e){if(-1==i)return this.showHandles.push(t),!0}else if(i>=0)return this.showHandles.splice(i,1),!0;return!1},e.prototype.onChangeTarget=function(){if(this.isOpen&&GameLogic.ins().currAttackHandle!=this.lastAtkHandle){var t=GameLogic.ins().currAttackHandle,e=this.lastAtkHandle;if(this.lastAtkHandle=t,this.isShow||(e&&this.hideEntity(e),t&&this.showEntity(t),this.sendHandlesToServer()),t&&!(this.showHandles.indexOf(t)>=0)){if(this.showHandles.length>=this.showNum){var i=this.showHandles.shift();this.hideEntity(i)}this.showHandles.push(t),this.showEntity(t),this.sendHandlesToServer()}}},e.prototype.onRoleDie=function(){if(this.isOpen){var t=this.lastAtkHandle;this.lastAtkHandle=0,this.isShow||t&&(this.hideEntity(t),this.sendHandlesToServer())}},e.prototype.searchNewHandle=function(){var t=EntityManager.ins().getAllEntity();for(var e in t){var i=t[e].infoModel;if(i&&!i.isMy&&i.type==EntityType.Role&&this.updateShowHandles(i.masterHandle,!0)){this.showEntity(i.masterHandle);break}}},e.prototype.showOrHideEntitys=function(t){for(var e=this.showHandles,i=0,s=e;i<s.length;i++){var n=s[i];t?this.showEntity(n):this.hideEntity(n)}},e.prototype.showEntity=function(t){for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,s=e;i<s.length;i++){var n=s[i];n.showBodyContainer()}},e.prototype.hideEntity=function(t){for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,s=e;i<s.length;i++){var n=s[i];n.hideBodyContainer()}},e.prototype.sendHandlesToServer=function(){var t=this.isShow?this.showHandles:this.lastAtkHandle?[this.lastAtkHandle]:[];GameLogic.ins().sendGetOtherAttr(t)},e.prototype.getIsOpen=function(){return!!GlobalConfig.ScenesConfig[GameMap.mapID].hideBodyEff},e}(BaseSystem);__decorate([callDelay(200)],EntityHideBody.prototype,"sendHandlesToServer",null),__reflect(EntityHideBody.prototype,"EntityHideBody");var EntityManager=function(t){function e(){var e=t.call(this)||this;return e.entityList={},e.transferList={},e.mineList={},e._masterList={},e.distances=[],e.listCount=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getAllEntity=function(){return this.entityList},e.prototype.resetRole=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);if(i.name=Actor.myName,this.getEntityByHandle(i.handle)){var s=this.getEntityByHandle(i.handle);s.infoModel.setAtt(AttributeType.atHp,i.getAtt(AttributeType.atMaxHp)),s.infoModel.setAtt(AttributeType.atMp,i.getAtt(AttributeType.atMaxMp)),s.updateBlood(!0)}else i.setPos(DropHelp.tempDropPoint.x*GameMap.CELL_SIZE,DropHelp.tempDropPoint.y*GameMap.CELL_SIZE),debug.log("--------------所有角色重置----------------"),i.setAtt(AttributeType.atHp,i.getAtt(AttributeType.atMaxHp)),i.setAtt(AttributeType.atMp,i.getAtt(AttributeType.atMaxMp)),GameLogic.ins().createEntityByModel(i,Team.My)}},e.prototype.addList=function(t){if(t.infoModel.handle||(t.infoModel.handle=t.hashCode),this.entityList[t.infoModel.handle]!=t){if(this.entityList[t.infoModel.handle]=t,t.infoModel.masterHandle){var e=t.infoModel.masterHandle;this._masterList[e]||(this._masterList[e]=[]),this._masterList[e].push(t)}t.infoModel.type==EntityType.Mine&&(this.mineList[t.infoModel.index]=t);var i=this.listCount[t.team]||0;this.listCount[t.team]=++i}},e.prototype.addTransfer=function(t){this.transferList[t.infoModel.configID]=t,SkillEffPlayer.bottomLayer.addChild(t)},e.prototype.removeTransferById=function(t){var e=this.transferList[t];e&&(delete this.transferList[t],DisplayUtils.removeFromParent(e))},e.prototype.getTransferById=function(t){return this.transferList[t]},e.prototype.getMineByIndex=function(t){return this.mineList[t]},e.prototype.removeMineByIndex=function(t){var e=this.mineList[t];e&&(delete this.mineList[t],e.infoModel&&this.removeByHandle(e.infoModel.handle))},e.prototype.createEntity=function(t,e){switch(t.type){case EntityType.Role:case EntityType.LadderPlayer:var i=t;e&&null!=e[0]?i.team=e[0]:t.masterHandle&&t.masterHandle==Actor.handle?i.team=Team.My:i.team=Team.WillEntity;var s=ObjectPool.pop("CharRole");if(s.reset(),i.masterHandle==Actor.handle){for(var n=void 0,o=SubRoles.ins().subRolesLen,a=0;o>a;a++)if(a==i.configID){n=a;break}SubRoles.ins().getSubRoleByIndex(n)&&(i=SubRoles.ins().getSubRoleByIndex(n).mergeData(i))}s.infoModel=i,s.x=i.x,s.y=i.y,this.addList(s),RoleAI.ins().canAddToAi()&&RoleAI.ins().add(s);var r=!0;if(i.team!=Team.My){if(!EntityShowMgr.ins().checkShowHandle(i.masterHandle))return s.hideBodyContainer(),s.updateModel(),null;r=EntityHideBody.ins().checkIsShowBody(i.masterHandle)}return r?s.showBodyContainer():s.hideBodyContainer(),s.updateModel(),s;case EntityType.Monster:case EntityType.CollectionMonst:e&&null!=e[0]?t.team=e[0]:t.masterHandle&&0!=t.masterHandle?t.isMy?t.team=Team.My:t.team=Team.WillEntity:t.team=Team.Monster;var h=ObjectPool.pop("CharMonster");h.reset(),h.infoModel=t,h.x=t.x,h.y=t.y,this.addList(h),RoleAI.ins().canAddToAi()&&RoleAI.ins().add(h);var r=!0;if(h.team!=Team.My&&t.masterHandle){var l=this.getRootMasterHandle(t.masterHandle),c=this.getMasterList(l);if(c)for(var u=0,p=c;u<p.length;u++){var d=p[u];if(h!=d&&!d.parent)return h.hideBodyContainer(),h.updateModel(),null}t.team==Team.WillEntity&&(r=EntityHideBody.ins().checkIsShowBody(t.masterHandle))}return r?h.showBodyContainer():h.hideBodyContainer(),h.updateModel(),h;case EntityType.DropItem:var g=ObjectPool.pop("CharItem2");return g.setData(t.itemData),g.x=t.x,g.y=t.y,g.infoModel=t,this.addList(g),g.addRoatEffect(),g.addFloatEffect(),g;case EntityType.Transfer:var f=ObjectPool.pop("CharTransfer");return f.infoModel=t,this.addTransfer(f),f.updateModel(),f;case EntityType.Npc:var v=ObjectPool.pop("CharNpc");return v.infoModel=t,this.addList(v),v.updateModel(),v;case EntityType.Mine:var y=ObjectPool.pop("CharMiner");return y.infoModel=t,this.addList(y),y.updateModel(),y}return null},e.prototype.removeAll=function(){for(var t in this.entityList)this.removeByHandle(t);for(var t in this.transferList)this.removeTransferById(t);EncounterFight.ins().stop(),this.entityList={},this._masterList={},this.transferList={},this.listCount=[]},e.prototype.hideOtherEntity=function(t){this.isHideOther=t;for(var e in this.entityList)this.entityList[e].team==Team.WillEntity&&(t?DisplayUtils.removeFromParent(this.entityList[e]):GameLogic.ins().addEntity(this.entityList[e]))},e.prototype.getEntityRelationHandle=function(t){for(var e=this.getRootMasterHandle(t),i=this.getMasterList(e),s=[].concat(i||[]),n=0,o=s;n<o.length;n++){var a=o[n],r=a.infoModel;if(r&&r.job==JobConst.DaoShi){var h=this.getMasterList(r.handle);h&&(s=s.concat(h));break}}return s},e.prototype.removeByHandle=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1);var s=this.entityList[t];if(s){var n=s.infoModel.masterHandle;if(n){for(var o=this._masterList[n],a=0;o&&a<o.length;a++)if(o[a]==s){o.splice(a,1);break}o&&0==o.length&&delete this._masterList[n]}delete this.entityList[t];for(var a in this.entityList)this.entityList[a].infoModel.masterHandle&&this.entityList[a].infoModel.masterHandle==t&&this.removeByHandle(this.entityList[a].infoModel.handle);var r=this.listCount[s.team]||0;return this.listCount[s.team]=--r,s instanceof CharMonster&&(s.stopMove(),s.removeAllFilters()),egret.Tween.removeTweens(s),e&&(DisplayUtils.removeFromParent(s),s instanceof CharMonster&&!(s instanceof CharRole)&&s.destroy()),RoleAI.ins().remove(s),DropHelp.tempDropPoint.x=Math.floor(s.x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y=Math.floor(s.y/GameMap.CELL_SIZE),(GameMap.sceneInMain()||GameMap.fbType==UserFb.FB_TYPE_EXP)&&s.infoModel.type==EntityType.Monster&&i&&GameLogic.ins().postExpMc(s),s.infoModel.type==EntityType.Mine&&(delete this.mineList[s.infoModel.index],s.destruct()),s}},e.prototype.getEntityByHandle=function(t){return this.entityList[t]},e.prototype.getMasterList=function(t){return this._masterList[t]},Object.defineProperty(e.prototype,"masterList",{get:function(){return this._masterList},enumerable:!0,configurable:!0}),e.prototype.getRootMasterHandle=function(t){var i=e.ins().getEntityByHandle(t);return i&&i.infoModel&&i.infoModel.masterHandle>0&&i.infoModel.masterHandle!=t?this.getRootMasterHandle(i.infoModel.masterHandle):t},e.prototype.getMainRole=function(t){return this.getEntityByHandle(SubRoles.ins().getSubRoleByIndex(t).handle)},e.prototype.getJobMainRole=function(t){var e,i=0;for(var s in SubRoles.ins().jobDic){if(i==t){e=SubRoles.ins().jobDic[s];break}i++}return this.getEntityByHandle(e.handle)},e.prototype.getNoDieRoleIndex=function(){for(var t,i=SubRoles.ins().subRolesLen,s=0;i>s;s++)if(t=e.ins().getJobMainRole(s),t&&t.getHP()>0&&t.visible)return s;return-1},e.prototype.getNoDieRole=function(){for(var t,i=SubRoles.ins().subRolesLen,s=0;i>s;s++)if(t=e.ins().getJobMainRole(s),t&&t.getHP()>0&&t.visible)return t;return null},e.prototype.getMyOtherRolePos=function(){var t=this.getNoDieRole(),e=this.getEntityByTeam(Team.My),i=0,s={};for(var n in e){var o=e[n];if(o!=t){var a=e.length,r=[1,-1];2==a&&(r=[0]);var h=DirUtil.getGridByDir(t.dir+r[i]!=null?r[i]:0);i+=1,s[o.infoModel.handle]={x:t.x+h.x,y:t.y+h.y}}}return s[t.infoModel.handle]={x:t.x,y:t.y},s},e.prototype.sortSubRole=function(t,e){return Algorithm.sortAsc(t.infoModel.job,e.infoModel.job)
},e.prototype.getTeamCount=function(t){return MineFight.ins().isFighting||Encounter.ins().isEncounter()?RoleAI.ins().getTeamCount(t):this.listCount[t]||0},e.prototype.checkCount=function(t,e,i,s){void 0===i&&(i=1),void 0===s&&(s=!1);var n=0;for(var o in this.entityList){var a=this.entityList[o];if((!s&&a.team!=t.team||s&&a.team==t.team)&&MathUtils.getDistanceX2ByObject(t,a)<=Math.pow(e*GameMap.CELL_SIZE,2)&&(n++,n>=i))break}return n>=i},e.prototype.checkCanAddBlood=function(t){var e=!1;for(var i in this.entityList)this.entityList[i].team==t&&this.entityList[i].isCanAddBlood&&(e=!0);return e},e.prototype.getEntityBymasterhHandle=function(t){for(var e in this.entityList)if(this.entityList[e].infoModel&&this.entityList[e].infoModel.masterHandle&&this.entityList[e].infoModel.masterHandle==t&&this.entityList[e].infoModel.type!=EntityType.Monster)return this.entityList[e];return null},e.prototype.getEntitysBymasterhHandle=function(t,e){void 0===e&&(e=-1);var i=[];for(var s in this.entityList){if(i.length>=3)return i;this.entityList[s].infoModel&&this.entityList[s].infoModel.masterHandle&&this.entityList[s].infoModel.masterHandle==t&&(-1==e||e==this.entityList[s].infoModel.type)&&i.push(this.entityList[s])}return i},e.prototype.getEntityByTeam=function(t){void 0===t&&(t=Team.My);var e=[];for(var i in this.entityList)this.entityList[i].infoModel&&this.entityList[i].infoModel.team==t&&e.push(this.entityList[i]);return e},e.prototype.getEntityByMonsterId=function(t){var e=[];for(var i in this.entityList)this.entityList[i].infoModel&&this.entityList[i].infoModel.configID==t&&e.push(this.entityList[i]);return e},e.prototype.screeningTargetByMap=function(t,e,i,s){var n;if(ErrorLog.Assert(n,"SkillCastRangeConf no such areaId:"+s))return this.screeningTargetByPos(t,!1,i,Number.MAX_VALUE);var o,a=GameMap.getTargetIndex(t,e,n.width,n.height);n.range[a];if(!o)return this.screeningTargetByPos(t,!1,i,Number.MAX_VALUE);for(var r=[],h=0;h<o.range.length;h++){var l=GameMap.getPoint(o.range[h],o.width,o.height);r.push(l)}r.push(new egret.Point(0,0));var c=GameMap.getIncludeElement(t,r,this.entityList);return this.screeningTargetByPos(t,!1,i,Number.MAX_VALUE,c)},e.prototype.screeningTargetByPos=function(t,e,i,s,n){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===s&&(s=Number.MAX_VALUE),void 0===n&&(n=this.entityList);var o=MathUtils.getDistanceX2ByObject,a=s;s!=Number.MAX_VALUE&&(a=s*GameMap.CELL_SIZE*(s*GameMap.CELL_SIZE)),this.distances.length=0;var r;for(var h in n){var l=n[h];if((!e||l.team==t.team)&&(e||l.team!=t.team)&&(t.team!=Team.My||l.team!=Team.Faker)&&(t.team!=Team.Faker||l.team==Team.Monster||l.team==Team.Faker)&&(l instanceof CharRole||l.team==Team.Monster||l.team==Team.WillBoss)&&l.AI_STATE!=AI_State.Die){if(Encounter.ins().isEncounter())if(Team.My==t.team){if(Team.WillEntity!=l.team||e){if(Team.My!=l.team||!e)continue}else if(!Encounter.ins().checkIsEncounter(EncounterFight.ins().encounterIndex,l.infoModel))continue}else if(Team.WillEntity==t.team)if(e&&Team.WillEntity==l.team);else if(e||EncounterFight.ins().willEntityFightTeam!=l.team)continue;r=o(t,l),r>a||this.distances.push({priority:r,target:l})}}this.distances.sort(this.sortFunc);var c=[],u=0;u=i?Math.min(this.distances.length,i):this.distances.length;for(var p=0;u>p;p++)c[p]=this.distances[p].target;return c},e.prototype.sortFunc=function(t,e){return t.priority>e.priority?1:t.priority<e.priority?-1:0},e}(BaseClass);EntityManager.CHAR_DEFAULT_HEIGHT=118,EntityManager.CHAR_DEFAULT_TYPEFACE=110,__reflect(EntityManager.prototype,"EntityManager");var Keyboard=function(){function t(){}return t}();Keyboard.LEFT=37,Keyboard.UP=38,Keyboard.RIGHT=39,Keyboard.DOWN=40,Keyboard.KC_1=49,Keyboard.KC_2=50,Keyboard.KC_3=51,Keyboard.KC_4=52,Keyboard.KC_5=53,Keyboard.KC_6=54,Keyboard.KC_7=55,Keyboard.KC_8=56,Keyboard.KC_9=57,Keyboard.KC_0=48,Keyboard.A=65,Keyboard.B=66,Keyboard.C=67,Keyboard.D=68,Keyboard.E=69,Keyboard.F=70,Keyboard.G=71,Keyboard.H=72,Keyboard.I=73,Keyboard.J=74,Keyboard.K=75,Keyboard.L=76,Keyboard.M=77,Keyboard.N=78,Keyboard.O=79,Keyboard.P=80,Keyboard.Q=81,Keyboard.R=82,Keyboard.S=83,Keyboard.T=84,Keyboard.U=85,Keyboard.V=86,Keyboard.W=87,Keyboard.X=88,Keyboard.Y=89,Keyboard.Z=90,Keyboard.SPACE=32,Keyboard.BRACE_L=219,Keyboard.BACKSLASH=220,Keyboard.BRACE_R=221,Keyboard.BACK_QUOTE=192,Keyboard.ENTER=13,Keyboard.KC_BACKSPACE=8,Keyboard.KC_TAB=9,Keyboard.KC_ENTER=13,Keyboard.KC_SHIFT=16,Keyboard.KC_CONTROL=17,Keyboard.KC_ESCAPE=27,Keyboard.KC_SPACE=32,Keyboard.KC_WINDOWS=91,Keyboard.KC_MENU=93,__reflect(Keyboard.prototype,"Keyboard");var EntityShowMgr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MAX_SHOW_NUM=3,e.MAX_EFFECT_NUM=3,e.isOpen=!1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.changeScene=function(){this.isOpen=!EntityHideBody.ins().isOpen,GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS?this.MAX_SHOW_NUM=5:this.MAX_SHOW_NUM=3},e.prototype.hideFurtherOtherRole=function(){if(!(this.countShowNum()<this.MAX_SHOW_NUM)){var t=EntityManager.ins().getNoDieRole();if(t){var e,i=0,s=StageUtils.ins().getHeight()>>1,n=s*s,o=EntityManager.ins().getAllEntity();for(var a in o){var r=o[a];if(r.parent&&r.infoModel&&r.team!=Team.My&&r.infoModel.type==EntityType.Role){var h=MathUtils.getDistanceX2ByObject(t,r);if(h>n){e=r.infoModel.handle;break}h>i&&(i=h,e=r.infoModel.handle)}}this.hideByHandle(e)}}},e.prototype.showNearSomeOne=function(){if(this.isOpen&&!(this.countShowNum()>=this.MAX_SHOW_NUM)){var t=EntityManager.ins().getNoDieRole();if(t){var e,i=Number.MAX_VALUE,s=StageUtils.ins().getWidth()>>1,n=s*s,o=EntityManager.ins().getAllEntity();for(var a in o){var r=o[a];if(!r.parent&&r.infoModel&&r.team!=Team.My&&r.infoModel.type==EntityType.Role){var h=MathUtils.getDistanceX2ByObject(t,r);if(n>h){e=r.infoModel.handle;break}i>h&&(i=h,e=r.infoModel.handle)}}this.showByHandle(e)}}},e.prototype.showHideSomeOne=function(t){this.isOpen&&(this.hideFurtherOtherRole(),this.showByHandle(t))},e.prototype.hideByHandle=function(t){if(!(GameLogic.ins().currAttackHandle==t||this.countShowNum()<this.MAX_SHOW_NUM))for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,s=e;i<s.length;i++){var n=s[i];DisplayUtils.removeFromParent(n),n.hideBodyContainer()}},e.prototype.showByHandle=function(t){if(this.isOpen&&!(this.countShowNum()>=this.MAX_SHOW_NUM))for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,s=e;i<s.length;i++){var n=s[i];GameLogic.ins().addEntity(n),n.showBodyContainer()}},e.prototype.checkShowSkillEffect=function(){return this.countShowNum()<this.MAX_EFFECT_NUM?!0:!1},e.prototype.checkShowHandle=function(t){if(!this.isOpen)return!0;var e=EntityManager.ins(),i=e.getRootMasterHandle(t);return i&&this.countShowNum()>=this.MAX_SHOW_NUM?e.masterList[i]&&e.masterList[i].length&&e.masterList[i][0].parent?!0:!1:!0},e.prototype.countShowNum=function(){var t=0;if(EntityHideBody.ins().isOpen)return t;var e=EntityManager.ins().masterList;for(var i in e){var s=e[i];s&&s.length&&s[0].parent&&s[0].team!=Team.My&&s[0].infoModel&&s[0].infoModel.type==EntityType.Role&&(t+=1)}return t},e}(BaseClass);__reflect(EntityShowMgr.prototype,"EntityShowMgr");var EntityType;!function(t){t[t.Actor=0]="Actor",t[t.Role=1]="Role",t[t.Monster=2]="Monster",t[t.Snpc=3]="Snpc",t[t.LadderPlayer=4]="LadderPlayer",t[t.CollectionMonst=5]="CollectionMonst",t[t.DropItem=6]="DropItem",t[t.Npc=100]="Npc",t[t.Transfer=101]="Transfer",t[t.Mine=102]="Mine"}(EntityType||(EntityType={}));var ErrorLog=function(){function t(){this.stackObj={stack:""}}return t.ins=function(){return this._ins=this._ins||new t,this._ins},t.prototype.show=function(t){var e=function(){DisplayUtils.removeFromParent(this),this.removeTouchEvent(this.notBtn,e)},i=new BaseView;i.skinName="ErrorSkin",i.notBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e,i),i.lab.text=t,StageUtils.ins().getUIStage().addChild(i)},t.Assert=function(e,i){return e?!1:(i+=t.ins().getErrorStackInfo(),LocationProperty.isLocation&&t.ins().show(i),t.httpLog&&!LocationProperty.isLocation&&ReportData?ReportData.getIns().report(""+i,ReportData.ERROR):console.log(i),!0)},t.prototype.getErrorStackInfo=function(){var e="";try{Error.captureStackTrace(this.stackObj,t.Assert),e="----"+this.stackObj.stack,this.stackObj.stack=""}catch(i){e=""}return e},t}();ErrorLog.httpLog=!0,__reflect(ErrorLog.prototype,"ErrorLog");var Assert=ErrorLog.Assert;window.onerror=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="",s="";if(t[4]&&t[4].stack){var n=t[4].stack.split("at ");i=n[1].split(" ")[0];for(var o=2;o<n.length;o++){var a=n[o].split("/");s+=a[a.length-1]}}var r="兼容问题无法获取值",h="错误信息："+t[0]+"\n"+("出错位置："+t[2]+"行"+(t[3]?t[3]+"列":r)+"\n")+("出错函数："+i+"\n")+("函数调用："+s);h.indexOf(r)>=0||(alert(h),!LocationProperty.isLocation&&ReportData&&ReportData.getIns().report(""+h,ReportData.ERROR),window.getClientVersion(function(t){var e=parseInt(t)||0;e===LocationProperty.v||0===e||location.reload()}))};var ProgressBarEff=function(t){function e(){var e=t.call(this)||this;return e.isFisrt=!0,e.maxValue=0,e.value=0,e.isPlayMc=!0,e.group=new eui.Group,e.bgmc=new MovieClip,e.xianmc=new MovieClip,e.bordermc=new MovieClip,e.lbvalue=new eui.Label,e.offSetX=23,e.mcWidth=460,e.bgWidth=525,e.bgimg=new eui.Image,e.oldMaxValue=0,e.oldValue=0,e.iniUi(),e}return __extends(e,t),e.prototype.iniUi=function(){this.touchEnabled=this.touchChildren=!1,this.group.x=50,this.group.y=22,this.group.width=0,this.group.height=50,this.group.scrollEnabled=!0,this.bgmc.playFile(RES_DIR_EFF+"jindutiaoeff",-1),this.group.addChild(this.bgmc),this.addChild(this.group),this.xianmc.playFile(RES_DIR_EFF+"jindutiaotoueff",-1),this.xianmc.x=this.group.x+this.group.width-this.offSetX,this.xianmc.y=10,this.xianmc.scrollRect=new egret.Rectangle(0,0,24,39),this.addChild(this.xianmc),this.bgimg.x=14,this.bgimg.y=13,this.bgimg.source="jingyantiao1",this.bgimg.scale9Grid=new egret.Rectangle(54,0,13,37),this.bgimg.width=this.bgWidth,this.addChild(this.bgimg),this.lbvalue.x=this.bgimg.x+(this.bgimg.width-200)/2,this.lbvalue.y=22,this.lbvalue.size=16,this.lbvalue.width=200,this.lbvalue.textAlign="center",this.lbvalue.textColor=16772040,this.lbvalue.fontFamily="黑体",this.addChild(this.lbvalue)},e.prototype.setData=function(t,e){this.value=t,this.maxValue=e,this.setui()},e.prototype.setWidth=function(t){this.bgWidth=t,this.bgimg.width=this.bgWidth,this.lbvalue.x=this.bgimg.x+(this.bgimg.width-200)/2;var i=t/e.DEFAULT_WIDTH;this.bgmc.scaleX=i,this.mcWidth=e.DEFAULT_MC_WIDTH*i},e.prototype.setValue=function(t){this.value=t,this.setui()},e.prototype.getValue=function(){return this.value},e.prototype.getMaxValue=function(){return this.maxValue},e.prototype.reset=function(){this.isFisrt=!0,this.oldValue=this.oldMaxValue=this.value=this.maxValue=0},e.prototype.setMaxValue=function(t){this.maxValue=t,this.setui()},e.prototype.setui=function(){var t=this;egret.Tween.removeTweens(this.group);if(0==this.maxValue?(this.value=100,this.maxValue=100,this.lbvalue.visible=!1):this.lbvalue.visible=!0,(this.maxValue>this.oldMaxValue&&0!=this.oldMaxValue||0==this.maxValue||this.value<this.oldValue)&&!this.isFisrt){var e=this.oldMaxValue/this.oldMaxValue*this.mcWidth,i=(this.value/this.oldMaxValue*this.mcWidth,30),s=this.group.x,n=this.group.width,o=egret.Tween.get(this.group,{onChange:function(){t.group.width>=t.mcWidth-3||t.group.width<3?t.xianmc.visible=!1:t.xianmc.visible=!0,t.xianmc.x=s+n-t.offSetX}});o.to({width:e},150+i).call(function(){var e=egret.Tween.get(t.group),s=t.value/t.maxValue*t.mcWidth;t.group.width=0,t.oldValue=t.value,t.oldMaxValue=t.maxValue,e.to({width:s},150+i).call(function(){t.xianmc.x=t.group.x+s-t.offSetX})})}else{this.oldValue=this.value;var a=0;if(this.value<=0)a=0;else{var r=this.value>this.maxValue?this.maxValue:this.value;a=r/this.maxValue*this.mcWidth}var o=egret.Tween.get(this.group,{onChange:function(){t.group.width>=t.mcWidth-3||t.group.width<3?t.xianmc.visible=!1:t.xianmc.visible=!0,t.xianmc.x=t.group.x+t.group.width-t.offSetX}});o.to({width:a},200).call(function(){t.oldMaxValue=t.maxValue})}return this.lbvalue.text=this.value+"/"+this.maxValue,this.isFisrt?void(this.isFisrt=!1):void 0},e.prototype.max=function(){this.maxValue=0,this.setui(),this.lbvalue.visible=!0,this.lbvalue.text=""},e.prototype.setLbValueText=function(t){this.setui(),this.lbvalue.visible=!0,this.lbvalue.text=t},e}(egret.DisplayObjectContainer);ProgressBarEff.DEFAULT_WIDTH=525,ProgressBarEff.DEFAULT_MC_WIDTH=460,__reflect(ProgressBarEff.prototype,"ProgressBarEff");var BitmapNumber=function(t){function e(){var e=t.call(this)||this;return e._imgPool=[],e._containerPool=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.createNumPic=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var n,o=this.getContainer(),a=t.toString(),r=0;for(r;r<a.length;r++)n=this.getSingleNumPic(a.charAt(r),e),o.addChild(n);return this.repositionNumPic(o,i,s),o},e.prototype.desstroyNumPic=function(t){this.clearContainer(t),t.parent&&t.parent.removeChild(t),this._containerPool.push(t)},e.prototype.changeNum=function(t,e,i,s,n){void 0===s&&(s=0),void 0===n&&(n=0);var o=e.toString();if(t.numChildren>o.length)for(;t.numChildren>o.length;)this.recycleBM(t.getChildAt(t.numChildren-1));var a,r=0;for(r;r<o.length;r++)r>=t.numChildren&&t.addChild(this.getBitmap()),a=o.charAt(r),a="."==a?"dot":a,t.getChildAt(r).texture=this.getTexture(a,i);this.repositionNumPic(t,s,n)},e.prototype.repositionNumPic=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var s,n=0,o=0;for(n;n<t.numChildren;n++)s=t.getChildAt(n),s.x=o-e,o=s.x+s.width},e.prototype.clearContainer=function(t){for(;t.numChildren;)this.recycleBM(t.getChildAt(t.numChildren-1))},e.prototype.recycleBM=function(t){t&&t.parent&&(t.parent.removeChild(t),t.texture=null,this._imgPool.push(t))},e.prototype.getContainer=function(){return this._containerPool.length?this._containerPool.shift():new egret.DisplayObjectContainer},e.prototype.getSingleNumPic=function(t,e){"."==t&&(t="dot");var i=this.getBitmap();return i.texture=this.getTexture(t,e),i},e.prototype.getTexture=function(t,e){return RES.getRes(e+t+"_png")},e.prototype.getBitmap=function(){return this._imgPool.length?this._imgPool.shift():new egret.Bitmap},e}(BaseClass);__reflect(BitmapNumber.prototype,"BitmapNumber");var ResourceMgr=function(t){function e(){var e=t.call(this)||this;return e.isFirstEnter=!0,e.resDisTime={},e.isDelayDestroy=!1,e.observe(GameLogic.ins().postEnterMap,e.destroy),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.start=function(){TimerManager.ins().doTimer(3e5,0,this.destroy,this)},e.prototype.destroy=function(){this.isFirstEnter?(this.isFirstEnter=!1,this.start()):this.destroyRes()},e.prototype.destroyWin=function(){this.destroyUIRes()},e.prototype.disposeResTime=function(t){this.resDisTime[t]=egret.getTimer()},e.prototype.destroyRes=function(){var t=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE),e=t.fileDic,i=egret.getTimer();for(var s in e)if(!(s.indexOf(RES_DIR)<0)){var n=e[s];if(this.checkMcCanDestroy(n.bitmapData)&&this.checkCanDestroy(n)&&RES.destroyRes(s),egret.getTimer()-i>3)break}},e.prototype.destroyUIRes=function(){var t=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE),e=t.fileDic,i=RES.getAnalyzer(RES.ResourceItem.TYPE_JSON),s=i.resourceConfig,n=egret.getTimer();for(var o in e){var a=s.getRawResourceItem(o);if(!(a&&a.url.indexOf("image/public/")>=0||o.indexOf(MAP_DIR)>=0||o.indexOf(RES_DIR)>=0&&o.indexOf(RES_DIR_EFF)<0)){var r=e[o];if(this.checkCanDestroy(r)&&this.checkMcCanDestroy(r.bitmapData)&&RES.destroyRes(o),egret.getTimer()-n>3)break}}},e.prototype.checkBitmapSize=function(){var t=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE),e=t.fileDic,i=0;for(var s in e){var n=t.getRes(s);i+=n.bitmapData.width*n.bitmapData.height*4}return console.log("bit:"+i),i},e.prototype.checkCanDestroy=function(t){var e;if(e=t.bitmapData&&t.bitmapData.hashCode?t.bitmapData.hashCode:t.hashCode,!e)return!1;var i=egret.BitmapData._displayList[e];if(!i||!i.length){if(!this.resDisTime[e])return!0;if(egret.getTimer()-this.resDisTime[e]>2500)return delete egret.BitmapData._displayList[e],delete this.resDisTime[e],!0}return!1},e.prototype.checkMcCanDestroy=function(t){if(!t)return!1;var e=t.hashCode,i=MovieClip.displayList[e];if(!i||!i.length){if(!this.resDisTime[e])return!0;if(egret.getTimer()-this.resDisTime[e]>2500)return delete MovieClip.displayList[e],delete this.resDisTime[e],!0}return!1},e.prototype.reloadContainer=function(t){for(var e=t.numChildren,i=0;e>i;i++){var s=t.getChildAt(i);s instanceof eui.Image?this.reloadImg(s):s instanceof egret.DisplayObjectContainer&&this.reloadContainer(s)}},e.prototype.reloadImg=function(t){var e=t.source;if(e){if(t.bitmapData||t.texture&&t.texture.bitmapData)return;t.source=null,t.source=e}},e}(BaseSystem);__decorate([callDelay(3e3)],ResourceMgr.prototype,"destroyRes",null),__decorate([callDelay(3e3)],ResourceMgr.prototype,"destroyUIRes",null),__reflect(ResourceMgr.prototype,"ResourceMgr");var GameSystem;!function(t){t.resourceMgr=ResourceMgr.ins.bind(ResourceMgr)}(GameSystem||(GameSystem={}));var UIAnimation=function(){function t(){}return t.setAnimation=function(e,i,s){if(!t.checkObj(e))return void(s&&"function"==typeof s.func&&s.func());var n,o=egret.getQualifiedClassName(e);switch(o){case"eui.Button":n=e;break;case"eui.ToggleButton":n=e;break;case"eui.Image":n=e;break;case"eui.Group":n=e;break;case"eui.Rect":n=e;break;case"BaseComponent":n=e;break;case"eui.TabBar":n=e;break;default:n=e}if(n){egret.Tween.removeTweens(n);var a=0/0,r=0/0,h=0/0,l=0/0,c=0/0,u=0/0,p=0/0,d=0/0,g=0/0,f=0/0,v=0/0,y=0/0,m=0/0,T=0/0,b=0/0,C=0/0,I=0/0,w=0/0,_=0/0,S=0/0,B=0/0,E=0/0;switch(i){case t.ANITYPE_FADEIN_LEFT_HOR:isNaN(n.left)||(r=n.left-t.diff,p=n.left),isNaN(n.horizontalCenter)||(h=n.horizontalCenter-t.diff,d=n.horizontalCenter),isNaN(n.right)||(l=n.right+t.diff,g=n.right),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.x)||(a=n.x-t.diff,u=n.x),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_FADEIN_RIGHT_HOR:isNaN(n.left)||(r=n.left+t.diff,p=n.left),isNaN(n.horizontalCenter)||(h=n.horizontalCenter+t.diff,d=n.horizontalCenter),isNaN(n.right)||(l=n.right-t.diff,g=n.right),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.x)||(a=n.x+t.diff,u=n.x),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_FADEIN_UP_VER:isNaN(n.top)||(y=n.top-t.diff,I=n.top),isNaN(n.verticalCenter)||(m=n.verticalCenter-t.diff,w=n.verticalCenter),isNaN(n.bottom)||(T=n.bottom+t.diff,_=n.bottom),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.y)||(v=n.y-t.diff,C=n.y),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_FADEIN_DOWN_VER:isNaN(n.top)||(y=n.top+t.diff,I=n.top),isNaN(n.verticalCenter)||(m=n.verticalCenter+t.diff,w=n.verticalCenter),isNaN(n.bottom)||(T=n.bottom-t.diff,_=n.bottom),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.y)||(v=n.y+t.diff,C=n.y),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_IN_LEFT_HOR:isNaN(n.left)||(r=n.left-n.width,p=n.left),isNaN(n.horizontalCenter)||(h=n.horizontalCenter-n.width,d=n.horizontalCenter),isNaN(n.right)||(l=n.right+n.width,g=n.right),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.x)||(a=n.x-n.width,u=n.x),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_IN_RIGHT_HOR:isNaN(n.left)||(r=n.left+n.width,p=n.left),isNaN(n.horizontalCenter)||(h=n.horizontalCenter+n.width*t.hroWidh,d=n.horizontalCenter),isNaN(n.right)||(l=n.right-n.width*t.hroWidh,g=n.right),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.x)||(a=n.x+n.width*t.hroWidh,u=n.x),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_IN_UP_VER:isNaN(n.top)||(y=n.top-n.height,I=n.top),isNaN(n.verticalCenter)||(m=n.verticalCenter-n.height,w=n.verticalCenter),isNaN(n.bottom)||(T=n.bottom+n.height,_=n.bottom),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.y)||(v=n.y-n.height,C=n.y),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_IN_DOWN_VER:isNaN(n.top)||(y=n.top+n.height,I=n.top),isNaN(n.verticalCenter)||(m=n.verticalCenter+n.height,w=n.verticalCenter),isNaN(n.bottom)||(T=n.bottom-n.height,_=n.bottom),isNaN(n.alpha)||(B=0,E=n.alpha),isNaN(n.y)||(v=n.y+n.height,C=n.y),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_OUT_LEFT_HOR:isNaN(n.left)||(r=n.left,p=n.left-n.width),isNaN(n.horizontalCenter)||(h=n.horizontalCenter,d=n.horizontalCenter-n.width),isNaN(n.right)||(l=n.right,g=n.right+n.width),isNaN(n.alpha)||(B=n.alpha,E=0),isNaN(n.x)||(a=n.x,u=n.x-n.width),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_OUT_RIGHT_HOR:isNaN(n.left)||(r=n.left+n.width,p=n.left),isNaN(n.horizontalCenter)||(h=n.horizontalCenter,d=n.horizontalCenter+n.width*t.hroWidh),isNaN(n.right)||(l=n.right,g=n.right-n.width*t.hroWidh),isNaN(n.alpha)||(B=n.alpha,E=0),isNaN(n.x)||(a=n.x,u=n.x+n.width*t.hroWidh),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_OUT_UP_VER:isNaN(n.top)||(y=n.top,I=n.top-n.height),isNaN(n.verticalCenter)||(m=n.verticalCenter,w=n.verticalCenter-n.height),isNaN(n.bottom)||(T=n.bottom,_=n.bottom+n.height),isNaN(n.alpha)||(B=n.alpha,E=0),isNaN(n.y)||(v=n.y,C=n.y-n.height),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_OUT_DOWN_VER:isNaN(n.top)||(y=n.top,I=n.top+n.height),isNaN(n.verticalCenter)||(m=n.verticalCenter,w=n.verticalCenter+n.height),isNaN(n.bottom)||(T=n.bottom,_=n.bottom-n.height),isNaN(n.alpha)||(B=n.alpha,E=0),isNaN(n.y)||(v=n.y,C=n.y+n.height),isNaN(n.scaleX)||(c=n.scaleX,f=n.scaleX),isNaN(n.scaleY)||(b=n.scaleY,S=n.scaleY);break;case t.ANITYPE_IN_SCALE_VER:isNaN(n.scaleX)||(c=.5,f=n.scaleX),isNaN(n.scaleY)||(b=.5,S=n.scaleY);break;case t.ANITYPE_OUT_SCALE_VER:isNaN(n.scaleX)||(c=n.scaleX,f=0),isNaN(n.scaleY)||(b=n.scaleY,S=0)}a=a?a:n.x,r=r?r:n.left,h=h?h:n.horizontalCenter,l=l?l:n.right,c=c?c:n.scaleX,u=u?u:n.x,p=p?p:n.left,d=d?d:n.horizontalCenter,g=g?g:n.right,f=0==f?f:n.scaleX,v=v?v:n.y,y=y?y:n.top,m=m?m:n.verticalCenter,T=T?T:n.bottom,b=b?b:n.scaleY,C=C?C:n.y,I=I?I:n.top,w=w?w:n.verticalCenter,_=_?_:n.bottom,S=0==S?S:n.scaleY,B=0==B?B:n.alpha,E=0==E?E:1,t.aniStartEUI(n,{sx:a,sxleft:r,sxhro:h,sxright:l,ex:u,exleft:p,exhro:d,exright:g,sy:v,sytop:y,syver:m,sybot:T,ey:C,eytop:I,eyver:w,eybot:_,salpha:B,ealpha:E,sxscaleX:c,exscaleX:f,syscaleY:b,eyscaleY:S},s)}},t.aniStartEUI=function(e,i,s){e.x=i.sx,e.left=i.sxleft,e.horizontalCenter=i.sxhro,e.right=i.sxright,e.y=i.sy,e.top=i.sytop,e.verticalCenter=i.syver,e.bottom=i.sybot,e.alpha=i.salpha,e.scaleX=i.sxscaleX,e.scaleY=i.syscaleY;var n=egret.Tween.get(e),o=s&&s.time?s.time:t.time,a=s&&s.ease?s.ease:t.Egret_Ease;n.to({x:i.ex,left:i.exleft,horizontalCenter:i.exhro,right:i.exright,y:i.ey,top:i.eytop,verticalCenter:i.eyver,bottom:i.eybot,alpha:i.ealpha,scaleX:i.exscaleX,scaleY:i.eyscaleY},o,a).call(function(){e.x=i.ex,e.left=i.exleft,e.horizontalCenter=i.exhro,e.right=i.exright,e.y=i.ey,e.top=i.eytop,e.verticalCenter=i.eyver,e.bottom=i.eybot,e.alpha=i.ealpha,e.scaleX=i.exscaleX,e.scaleY=i.eyscaleY,t.cleanObj(e),egret.Tween.removeTweens(e),s&&"function"==typeof s.func&&s.func()})},t.checkObj=function(e){return t.aniMap[e.hashCode]?!1:(t.aniMap[e.hashCode]=e,!0)},t.cleanObj=function(e){t.aniMap[e.hashCode]&&delete t.aniMap[e.hashCode]},t}();UIAnimation.ANITYPE_FADEIN_LEFT_HOR=1,UIAnimation.ANITYPE_FADEIN_RIGHT_HOR=2,UIAnimation.ANITYPE_FADEIN_UP_VER=3,UIAnimation.ANITYPE_FADEIN_DOWN_VER=4,UIAnimation.ANITYPE_IN_LEFT_HOR=5,UIAnimation.ANITYPE_IN_RIGHT_HOR=6,UIAnimation.ANITYPE_IN_UP_VER=7,UIAnimation.ANITYPE_IN_DOWN_VER=8,UIAnimation.ANITYPE_OUT_LEFT_HOR=9,UIAnimation.ANITYPE_OUT_RIGHT_HOR=10,UIAnimation.ANITYPE_OUT_UP_VER=11,UIAnimation.ANITYPE_OUT_DOWN_VER=12,UIAnimation.ANITYPE_IN_SCALE_VER=13,UIAnimation.ANITYPE_OUT_SCALE_VER=14,UIAnimation.diff=50,UIAnimation.time=200,UIAnimation.Egret_Ease=egret.Ease.backInOut,UIAnimation.aniMap={},UIAnimation.hroWidh=1.5,__reflect(UIAnimation.prototype,"UIAnimation");var ActivityBtnConfig=function(){function t(){}return t}();__reflect(ActivityBtnConfig.prototype,"ActivityBtnConfig");var ActivityType10Config=function(){function t(){}return t}();__reflect(ActivityType10Config.prototype,"ActivityType10Config");var ActivityType11_1Config=function(){function t(){}return t}();__reflect(ActivityType11_1Config.prototype,"ActivityType11_1Config");var ActivityType11_2Config=function(){function t(){this.rate=1}return t}();__reflect(ActivityType11_2Config.prototype,"ActivityType11_2Config");var ActivityType12Config=function(){function t(){}return t}();__reflect(ActivityType12Config.prototype,"ActivityType12Config");var ActivityType19Config=function(){function t(){}return t}();__reflect(ActivityType19Config.prototype,"ActivityType19Config");var HotspotBitmap=function(t){function e(){var e=t.call(this)||this;return e._hotspot=[],e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onTouch,e),e}return __extends(e,t),e.prototype.addHotspotArea=function(t,e,i,s){this._hotspot.push({rect:t,callBack:e,thisObj:i,para:s})},e.prototype.onTouch=function(t){for(var e,i=t.localX,s=t.localY,n=0;n<this._hotspot.length;n++)e=this._hotspot[n],e.rect.contains(i,s)&&(e.para?e.callBack.call(e.thisObj,e.para):e.callBack.call(e.thisObj))},e}(egret.Bitmap);__reflect(HotspotBitmap.prototype,"HotspotBitmap");var ActivityType20Config=function(){function t(){}return t}();__reflect(ActivityType20Config.prototype,"ActivityType20Config");var ActivityType22_1Config=function(){function t(){}return t}();__reflect(ActivityType22_1Config.prototype,"ActivityType22_1Config");var ActivityType22_3Config=function(){function t(){}return t}();__reflect(ActivityType22_3Config.prototype,"ActivityType22_3Config");var ActivityType2Config=function(){function t(){}return t}();__reflect(ActivityType2Config.prototype,"ActivityType2Config");var ActivityType3Config=function(){function t(){this.day=1}return t}();__reflect(ActivityType3Config.prototype,"ActivityType3Config");var ActivityType4Config=function(){function t(){}return t}();__reflect(ActivityType4Config.prototype,"ActivityType4Config");var ActivityType5Config=function(){function t(){}return t}();__reflect(ActivityType5Config.prototype,"ActivityType5Config");var ActivityType6Config=function(){function t(){}return t}();__reflect(ActivityType6Config.prototype,"ActivityType6Config");var ActivityType7Config=function(){function t(){}return t}();__reflect(ActivityType7Config.prototype,"ActivityType7Config");var ActivityType8Config=function(){function t(){}return t}();__reflect(ActivityType8Config.prototype,"ActivityType8Config");var MovieClip=function(t){function e(){var i=t.call(this)||this;return i.rate=1,i.pixelHitTest=!1,i._mcFactory=new egret.MovieClipDataFactory,i.$hitTest=function(t,i){var s=this.$DisplayObject;if(!this.$renderNode||!this.$visible||0==s[0]||0==s[1])return null;var n=this.$getInvertedConcatenatedMatrix();if(0==n.a&&0==n.b&&0==n.c&&0==n.d)return null;var o=this.$getContentBounds(),a=n.a*t+n.c*i+n.tx,r=n.b*t+n.d*i+n.ty;if(o.contains(a,r)){if(!this.$children){var h=this.$scrollRect?this.$scrollRect:this.$maskRect;if(h&&!h.contains(a,r))return null;if(this.$mask&&!this.$mask.$hitTest(t,i))return null;if(this.pixelHitTest&&this instanceof e&&!this.hitTestPoint(t,i,!0))return null}return this}return null},i}return __extends(e,t),e.prototype.playFile=function(t,i,s,n){var o=this;if(void 0===i&&(i=1),void 0===s&&(s=null),void 0===n&&(n=!0),this.time=egret.getTimer(),this._compFun=s,this.playCount=i,this.remove=n,TimerManager.ins().remove(this.playComp,this),this.texture&&null==this.texture.bitmapData);else if(this.name==t)return void this.createBody();this.name=t,this.texture&&e.removeDisplayObject(this,this.texture.bitmapData),this.jsonData=null,this.texture=null,RES.getResByUrl(this.name+".json",function(t,e){o.name+".json"==e&&t&&(o.jsonData=t,o.createBody())},this,RES.ResourceItem.TYPE_JSON),RES.getResByUrl(this.name+".png",function(t,i){o.name+".png"==i&&t&&(o.texture=t,o.stage&&e.addDisplayObject(o,o.texture.bitmapData),o.createBody())},this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.$onAddToStage=function(i,s){t.prototype.$onAddToStage.call(this,i,s),this.texture&&e.addDisplayObject(this,this.texture.bitmapData)},e.prototype.$onRemoveFromStage=function(){t.prototype.$onRemoveFromStage.call(this),this.texture&&e.removeDisplayObject(this,this.texture.bitmapData)},e.prototype.createBody=function(){if(this.jsonData&&this.texture){this._mcFactory.clearCache(),this._mcFactory.mcDataSet=this.jsonData,this._mcFactory.texture=this.texture;var t=this.name.split("/"),i=t.pop();if(this.movieClipData=this._mcFactory.generateMovieClipData(i),this.name in e.originalRate||(e.originalRate[this.name]=this.movieClipData.frameRate),this.frameRate=e.originalRate[this.name]*this.rate>>0,this.gotoAndPlay(1,this.playCount),this.visible=!0,this.playCount>0){var s=egret.getTimer()-this.time;s=this.playTime*this.playCount-s,s>0?TimerManager.ins().doTimer(s,1,this.playComp,this):this.playComp()}this.dispatchEventWith(egret.Event.CHANGE)}},e.prototype.playComp=function(){this.stage&&this._compFun&&this._compFun(),this.remove&&DisplayUtils.removeFromParent(this)},Object.defineProperty(e.prototype,"playTime",{get:function(){return this.movieClipData?1/this.frameRate*this.totalFrames*1e3:0},enumerable:!0,configurable:!0}),e.prototype.clearComFun=function(){this._compFun=null},e.prototype.dispose=function(){this.stop(),this.resetMovieClip(),this.clearComFun(),TimerManager.ins().removeAll(this)},e.prototype.destroy=function(){DisplayUtils.removeFromParent(this),this.dispose(),ObjectPool.push(this)},e.prototype.resetMovieClip=function(){var t=this;t.rotation=0,t.scaleX=1,t.scaleY=1,t.alpha=1,t.anchorOffsetX=0,t.anchorOffsetY=0,t.x=0,t.y=0,t.rate=1,t.$renderNode.cleanBeforeRender(),t._mcFactory.clearCache(),t._mcFactory.mcDataSet=null,t._mcFactory.texture=null,t.name=null,t.jsonData=null,t.filters=null;var i=t.texture;i&&e.removeDisplayObject(t,i.bitmapData),t.texture=null,t.remove=!1,egret.Tween.removeTweens(t)},e.addDisplayObject=function(t,i){if(i){var s=i.hashCode;if(!e.displayList[s])return void(e.displayList[s]=[t]);var n=e.displayList[s];n.indexOf(t)<0&&n.push(t)}},e.removeDisplayObject=function(t,i){if(i){var s=i.hashCode;if(e.displayList[s]){var n=e.displayList[s],o=n.indexOf(t);o>=0&&n.splice(o,1),0==n.length&&(delete e.displayList[s],ResourceMgr.ins().disposeResTime(s))}}},e}(egret.MovieClip);MovieClip.originalRate={},MovieClip.displayList=egret.createMap(),__reflect(MovieClip.prototype,"MovieClip");var ActorExRing2Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing2Config.prototype,"ActorExRing2Config");var ActorExRing3Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing3Config.prototype,"ActorExRing3Config");var ActorExRing4Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing4Config.prototype,"ActorExRing4Config");var ActorExRing5Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""
}return t}();__reflect(ActorExRing5Config.prototype,"ActorExRing5Config");var ActorExRing6Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing6Config.prototype,"ActorExRing6Config");var ActorExRing7Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin="",this.summonerSkillId=0,this.summonerAttr=[]}return t}();__reflect(ActorExRing7Config.prototype,"ActorExRing7Config");var ActorExRingAbilityConfig=function(){function t(){this.id=0,this.ringLv=0,this.abilityName="",this.abilityDesc="",this.abilityIcon=""}return t}();__reflect(ActorExRingAbilityConfig.prototype,"ActorExRingAbilityConfig");var ActorExRingBookConfig=function(){function t(){this.id=0,this.level=0,this.itemId=0,this.num=0,this.attr=[],this.bookAttrPer=[],this.skillName="",this.skillDesc="",this.skillIcon="",this.exPower=0}return t}();__reflect(ActorExRingBookConfig.prototype,"ActorExRingBookConfig");var ActorExRingCommon=function(){function t(){this.MaxOutNum=[],this.actImbaId=0}return t}();__reflect(ActorExRingCommon.prototype,"ActorExRingCommon");var ActorExRingConfig=function(){function t(){this.id=0,this.openDay=0,this.openVip=0,this.openYb=0,this.name="",this.effid=0,this.explain="",this.mtCombat=0,this.needLevel=0,this.needZs=0,this.monsterId=0,this.order=0,this.icon="",this.avatarFileName=0,this.wexplain="",this.useYb=0,this.skillGridYb=0}return t}();__reflect(ActorExRingConfig.prototype,"ActorExRingConfig");var ActorExRingItemConfig=function(){function t(){}return t}();__reflect(ActorExRingItemConfig.prototype,"ActorExRingItemConfig");var AllWorldConfig=function(){function t(){}return t}();__reflect(AllWorldConfig.prototype,"AllWorldConfig");var ArtifactsRankConfig=function(){function t(){}return t}();__reflect(ArtifactsRankConfig.prototype,"ArtifactsRankConfig");var AttrPowerConfig=function(){function t(){}return t}();__reflect(AttrPowerConfig.prototype,"AttrPowerConfig");var AuctionConfig=function(){function t(){}return t}();__reflect(AuctionConfig.prototype,"AuctionConfig");var AuctionItem=function(){function t(){}return t}();__reflect(AuctionItem.prototype,"AuctionItem");var BagBaseConfig=function(){function t(){}return t}();__reflect(BagBaseConfig.prototype,"BagBaseConfig");var BagExpandConfig=function(){function t(){}return t}();__reflect(BagExpandConfig.prototype,"BagExpandConfig");var BookListConfig=function(){function t(){}return t}();__reflect(BookListConfig.prototype,"BookListConfig");var BossHomeConfig=function(){function t(){this.id=0,this.vip=0,this.boss=[],this.icon=[]}return t}();__reflect(BossHomeConfig.prototype,"BossHomeConfig");var BubbleConfig=function(){function t(){this.bubbleid=0,this.news="",this.type=0}return t}();__reflect(BubbleConfig.prototype,"BubbleConfig");var CampBattleConfig=function(){function t(){}return t}();__reflect(CampBattleConfig.prototype,"CampBattleConfig");var CampBattlePersonalAwardConfig=function(){function t(){}return t}();__reflect(CampBattlePersonalAwardConfig.prototype,"CampBattlePersonalAwardConfig");var CampBattlePersonalRankAwardConfig=function(){function t(){}return t}();__reflect(CampBattlePersonalRankAwardConfig.prototype,"CampBattlePersonalRankAwardConfig");var CardConfig=function(){function t(){}return t}();__reflect(CardConfig.prototype,"CardConfig");var ChaptersRewardConfig=function(){function t(){}return t}();__reflect(ChaptersRewardConfig.prototype,"ChaptersRewardConfig");var ChongZhiConfig=function(){function t(){}return t}();__reflect(ChongZhiConfig.prototype,"ChongZhiConfig");var ClientGlobalConfig=function(){function t(){}return t}();__reflect(ClientGlobalConfig.prototype,"ClientGlobalConfig");var KfArenaPeakAwards=function(){function t(){}return t}();__reflect(KfArenaPeakAwards.prototype,"KfArenaPeakAwards");var KfArenaEveryDayAwards=function(){function t(){}return t}();__reflect(KfArenaEveryDayAwards.prototype,"KfArenaEveryDayAwards");var KfArenaFinalAwards=function(){function t(){}return t}();__reflect(KfArenaFinalAwards.prototype,"KfArenaFinalAwards");var KfArenaMailData=function(){function t(){}return t}();__reflect(KfArenaMailData.prototype,"KfArenaMailData");var KfArenaPeakInfo=function(){function t(){}return t}();__reflect(KfArenaPeakInfo.prototype,"KfArenaPeakInfo");var KfArenaRankAwardInfo=function(){function t(){}return t}();__reflect(KfArenaRankAwardInfo.prototype,"KfArenaRankAwardInfo");var DailyAwardConfig=function(){function t(){}return t}();__reflect(DailyAwardConfig.prototype,"DailyAwardConfig");var DailyConfig=function(){function t(){}return t}();__reflect(DailyConfig.prototype,"DailyConfig");var DailyFubenConfig=function(){function t(){this.ybRec=0,this.monthcard=0,this.privilege=0,this.specialCard=0,this.sweepLevel=0}return t}();__reflect(DailyFubenConfig.prototype,"DailyFubenConfig");var DeathgainWayConfig=function(){function t(){}return t}();__reflect(DeathgainWayConfig.prototype,"DeathgainWayConfig");var DeathGuideConfig=function(){function t(){}return t}();__reflect(DeathGuideConfig.prototype,"DeathGuideConfig");var DecomposeConfig=function(){function t(){}return t}();__reflect(DecomposeConfig.prototype,"DecomposeConfig");var DefineEff=function(){function t(){this.effid=0,this.souce=""}return t}();__reflect(DefineEff.prototype,"DefineEff");var EffectConfig=function(){function t(){}return t}();__reflect(EffectConfig.prototype,"EffectConfig");var EffectsConfig=function(){function t(){}return t.isAddBuff=function(t){return t.type==SkillEffType.AdditionalState||t.type==SkillEffType.AdditionalDamage||t.type==SkillEffType.AdditionalAttributes||t.type==SkillEffType.Summon},t}();__reflect(EffectsConfig.prototype,"EffectsConfig");var EnhanceAttrConfig=function(){function t(){}return t}();__reflect(EnhanceAttrConfig.prototype,"EnhanceAttrConfig");var EnhanceCostConfig=function(){function t(){}return t}();__reflect(EnhanceCostConfig.prototype,"EnhanceCostConfig");var EquipConfig=function(){function t(){this.stoneId=0,this.stoneNum=0,this.moneyNum=0,this.equipRate=0,this.moneyType=0,this.exPower=0}return t}();__reflect(EquipConfig.prototype,"EquipConfig");var EquipItemConfig=function(){function t(){}return t}();__reflect(EquipItemConfig.prototype,"EquipItemConfig");var EquipPointBasicConfig=function(){function t(){}return t}();__reflect(EquipPointBasicConfig.prototype,"EquipPointBasicConfig");var EquipPointConstConfig=function(){function t(){}return t}();__reflect(EquipPointConstConfig.prototype,"EquipPointConstConfig");var EquipPointGrowUpConfig=function(){function t(){}return t}();__reflect(EquipPointGrowUpConfig.prototype,"EquipPointGrowUpConfig");var EquipPointRankConfig=function(){function t(){}return t}();__reflect(EquipPointRankConfig.prototype,"EquipPointRankConfig");var EquipPointResolveConfig=function(){function t(){}return t}();__reflect(EquipPointResolveConfig.prototype,"EquipPointResolveConfig");var EquipWithEffConfig=function(){function t(){}return t}();__reflect(EquipWithEffConfig.prototype,"EquipWithEffConfig");var ExpConfig=function(){function t(){}return t}();__reflect(ExpConfig.prototype,"ExpConfig");var SkillEffPlayer=function(){function t(){}return Object.defineProperty(t,"urlSkill",{get:function(){return""+RES_DIR_SKILL},enumerable:!0,configurable:!0}),Object.defineProperty(t,"urlSkillEff",{get:function(){return""+RES_DIR_SKILLEFF},enumerable:!0,configurable:!0}),t.playConfigs=function(e,i){var s=this;if(!this.setTimeout)return void console.warn("SkillEffPlayer.setTimeout未设置");for(var n=function(n){var a=e[n];a=SkillEffConfig.initValue(a),o.setTimeout(a.delay/i.rate,function(){if(a.type>50){var e=s["type"+a.type];return void(e&&e.call(s,i,a))}var n=ObjectPool.pop("MovieClip");n.rate=a.playSpeed*(a.isRate?i.rate:1);var o=t.urlSkillEff+a.effectId+(a.isDir?DirUtil.get5DirBy8Dir(i.initParam.dir):""),r=o+i.append;if(n.playFile(r,a.playCount,function(){s.removeMC(n)}),n.x=a.x,n.y=a.y,i.offset&&(n.x+=i.offset.x,n.y+=i.offset.y),"string"==typeof a.rotation){var h=a.rotation+"",l=h.split("|"),c=+l[0],u=+l[1]-+l[0];n.rotation=Math.random()*u+c}else n.rotation=a.rotation;n.scaleX=a.scaleX*(a.isDir&&DirUtil.isScaleX(i.initParam.dir)?-1:1),n.scaleY=a.scaleY,n.alpha=a.alpha,n.anchorOffsetX=a.cx,n.anchorOffsetY=a.cy;var p=a.layer;if(a.dirPos.length&&a.dirPos[i.initParam.dir]){var d=a.dirPos[i.initParam.dir];isNaN(d.x)||(n.x+=d.x),isNaN(d.y)||(n.y+=d.y),isNaN(d.layer)||(p=d.layer),isNaN(d.rotation)||(n.rotation+=d.rotation),isNaN(d.scaleX)||(n.scaleX=d.scaleX),isNaN(d.scaleY)||(n.scaleY=d.scaleY),isNaN(d.cx)||(n.anchorOffsetX=d.cx),isNaN(d.cy)||(n.anchorOffsetY=d.cy)}if(a.isRot&&i.target){var g=a.isInit?{x:i.initParam.tar[0].x,y:i.initParam.tar[0].y}:i.target[0],f=MathUtils.getAngle(MathUtils.getRadian2(i.source.x,i.source.y,g.x,g.y));n.rotation=f+n.rotation}i.mc=n;var v=s["layer"+p];v&&v.call(s,i);var y=s["type"+a.type];if(y&&y.call(s,i,a),a.tween.length>0)for(var m=egret.Tween.get(n),T=0;T<a.tween.length;T+=2){var b=a.tween[T];m.to(b,a.tween[T+1].time)}},o)},o=this,a=0;a<e.length;a++)n(a)},t.play=function(t,e,i,s,n,o,a){var r=this;void 0===i&&(i=[]),void 0===s&&(s=null),void 0===n&&(n=1),void 0===o&&(o=null),void 0===a&&(a="");var h=""+this.urlRoot+this.urlSkill+t+".json";RES.getResByUrl(h,function(h){if(!h)return void console.log("没有这个技能 -- "+t);var l=new EffParam;l.initParam={dir:e.dir,x:e.x,y:e.y,tar:[]};for(var c=0;i&&c<i.length;c++)l.initParam.tar.push({dir:i[c].dir,x:i[c].x,y:i[c].y});l.source=e,l.target=i,l.hitFun=s,l.rate=n,l.offset=o,l.append=a,r.playConfigs(h,l)},this,RES.ResourceItem.TYPE_JSON)},t.type1=function(t,e){var i=this,s=t.target,n=t.source,o=t.mc,a=t.hitFun,r=e.isInit?{x:t.initParam.tar[0].x,y:t.initParam.tar[0].y}:s[0],h=egret.Tween.get(o),l=e.dis||MathUtils.getDistanceByObject(n,r);e.sDis&&(l+=e.sDis);var c=MathUtils.getAngle(MathUtils.getRadian2(n.x,n.y,r.x,r.y))+e.range;if(e.sDis){var u=MathUtils.getDirMove(c,e.sDis);o.x+=u.x,o.y+=u.y}var p=MathUtils.getDirMove(c,l,o.x,o.y);h.to({x:p.x,y:p.y},l/e.moveSpeed*1e3).call(function(){i.removeMC(o),e.hit&&a&&a(e.probability),e.exEff&&i.play(e.exEff,n,s,a,1,null,t.append)})},t.removeMC=function(t){t.destroy()},t.type96=function(t,e){if(!this.shake)return void console.warn("SkillEffPlayer.shake未设置");var i=t.source;this.shake(i,e.range,e.time,e.playCount,e.probability)},t.type97=function(t,e){var i=t.target,s=t.source;if(0==GameMap.fbType){i[0].stopMove();var n=(i[0]==EntityManager.ins().getNoDieRole(),e.dis||MathUtils.getDistanceByObject(s,i[0])),o=MathUtils.getAngle(MathUtils.getRadian2(s.x,s.y,i[0].x,i[0].y)),a=MathUtils.getDirMove(o,n,i[0].x,i[0].y),r=BresenhamLine.isAbleToThrough(GameMap.point2Grip(i[0].x),GameMap.point2Grip(i[0].y),GameMap.point2Grip(a.x),GameMap.point2Grip(a.y));if(0==r[0]&&(GameMap.point2Grip(i[0].x)==r[2]&&GameMap.point2Grip(i[0].y)==r[3]?(a.x=i[0].x,a.y=i[0].y):(a.x=GameMap.grip2Point(r[2]),a.y=GameMap.grip2Point(r[3]))),a.x=Math.max(Math.min(a.x,GameMap.MAX_WIDTH),0),a.y=Math.max(Math.min(a.y,GameMap.MAX_HEIGHT),0),n=MathUtils.getDistanceByObject(i[0],a),!(0>=n)){var h=egret.Tween.get(i[0].moveTweenObj);h.to({x:a.x,y:a.y},n/e.moveSpeed*1e3)}}},t.type98=function(t,e){var i=t.target,s=t.source;if(0==GameMap.fbType){s.stopMove();var n=(s==EntityManager.ins().getNoDieRole(),e.dis||MathUtils.getDistanceByObject(s,i[0])),o=MathUtils.getAngle(MathUtils.getRadian2(s.x,s.y,i[0].x,i[0].y)),a=MathUtils.getDirMove(o,n,i[0].x,i[0].y),r=BresenhamLine.isAbleToThrough(GameMap.point2Grip(i[0].x),GameMap.point2Grip(i[0].y),GameMap.point2Grip(a.x),GameMap.point2Grip(a.y));if(0==r[0]&&(GameMap.point2Grip(i[0].x)==r[2]&&GameMap.point2Grip(i[0].y)==r[3]?(a.x=i[0].x,a.y=i[0].y):(a.x=GameMap.grip2Point(r[2]),a.y=GameMap.grip2Point(r[3]))),a.x=Math.max(Math.min(a.x,GameMap.MAX_WIDTH),0),a.y=Math.max(Math.min(a.y,GameMap.MAX_HEIGHT),0),n=MathUtils.getDistanceByObject(i[0],a),!(0>=n)){a=MathUtils.getDirMove(o,n,s.x,s.y);var h=egret.Tween.get(s.moveTweenObj);h.to({x:a.x,y:a.y},n/e.moveSpeed*1e3)}}},t.type99=function(t,e){var i=t.hitFun;i&&i(e.probability)},t.layer0=function(t){var e=t.source,i=t.mc;return i.x+=e.x,i.y+=e.y,this.bottomLayer?void this.bottomLayer.addChild(i):void console.warn("SkillEffPlayer.bottomLayer未设置")},t.layer1=function(t){var e=t.source,i=t.mc;e.addChildAt(i,0)},t.layer2=function(t){var e=t.source,i=t.mc;e.addChild(i)},t.layer3=function(t){var e=t.source,i=t.mc;return i.x+=e.x,i.y+=e.y,this.topLayer?void this.topLayer.addChild(i):void console.warn("SkillEffPlayer.topLayer未设置")},t.layer4=function(t){var e=t.target,i=t.mc;return i.x+=e[0].x,i.y+=e[0].y,this.bottomLayer?void this.bottomLayer.addChild(i):void console.warn("SkillEffPlayer.bottomLayer未设置")},t.layer5=function(t){var e=t.target,i=t.mc;e[0].addChildAt(i,0)},t.layer6=function(t){var e=t.target,i=t.mc;e[0].addChild(i)},t.layer7=function(t){var e=t.target,i=t.mc;return i.x+=e[0].x,i.y+=e[0].y,this.topLayer?void this.topLayer.addChild(i):void console.warn("SkillEffPlayer.topLayer未设置")},t.layer8=function(t){return this.fixedLayer?void this.fixedLayer.addChild(t.mc):void console.warn("SkillEffPlayer.topLayer未设置")},t}();SkillEffPlayer.urlRoot="",__reflect(SkillEffPlayer.prototype,"SkillEffPlayer");var EffParam=function(){function t(){this.append="",this.rate=1}return t}();__reflect(EffParam.prototype,"EffParam");var SkillEffConfig=function(){function t(){this.type=0,this.delay=0,this.layer=3,this.x=0,this.y=0,this.effectId=0,this.playSpeed=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.isDir=0,this.moveSpeed=100,this.playCount=1,this.dis=0,this.sDis=0,this.alpha=1,this.isRot=0,this.hit=0,this.cx=0,this.cy=0,this.range=0,this.time=0,this.isRate=0,this.isInit=0,this.probability=1,this.exEff="",this.dirPos=[],this.tween=[]}return t.initValue=function(t){return t.__proto__=this.o,t},t}();SkillEffConfig.o=new SkillEffConfig,__reflect(SkillEffConfig.prototype,"SkillEffConfig");var ExRing1Config=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ExRing0Config);__reflect(ExRing1Config.prototype,"ExRing1Config");var GuideArrow=function(t){function e(){var e=t.call(this)||this;return e.skinName="guideArrowSkin",e}return __extends(e,t),e.prototype.update=function(){var t=GuideUtils.ins().curCfg;if(t){if(!t.tips||""==t.tips)return void(this.visible=!1);egret.Tween.removeTweens(this.parent),this.parent.x=0,this.visible=!0,1==t.direction?(this.currentState="right",egret.Tween.get(this.parent,{loop:!0}).to({x:40},1e3).to({x:0},1e3)):(this.currentState="left",egret.Tween.get(this.parent,{loop:!0}).to({x:-40},1e3).to({x:0},1e3)),this.lab.text=t.tips}},e.prototype.close=function(){this.parent&&egret.Tween.removeTweens(this.parent)},e}(BaseEuiView);__reflect(GuideArrow.prototype,"GuideArrow");var ExRingConfig=function(){function t(){}return t}();__reflect(ExRingConfig.prototype,"ExRingConfig");var ExRingExtendAttrConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.summonerSkillId=0,e.summonerAiId=0,e}return __extends(e,t),e}(ExRingAttrConfig);__reflect(ExRingExtendAttrConfig.prototype,"ExRingExtendAttrConfig");var FbChallengeBaseConfig=function(){function t(){}return t}();__reflect(FbChallengeBaseConfig.prototype,"FbChallengeBaseConfig");var FbChallengeConfig=function(){function t(){this.id=0,this.group=0,this.layer=0,this.zsLevelLimit=0,this.levelLimit=0,this.fbId=0,this.describe="",this.showIcon=0,this.equipPos=0,this.clearReward=[],this.dayReward=[],this.lotteryCount=0}return t}();__reflect(FbChallengeConfig.prototype,"FbChallengeConfig");var FbChallengeLotteryConfig=function(){function t(){this.group=[]}return t}();__reflect(FbChallengeLotteryConfig.prototype,"FbChallengeLotteryConfig");var FbChNameConfig=function(){function t(){this.group=0,this.name=""}return t}();__reflect(FbChNameConfig.prototype,"FbChNameConfig");var FeatsStore=function(){function t(){}return t}();__reflect(FeatsStore.prototype,"FeatsStore");var FieldBossConfig=function(){function t(){}return t}();__reflect(FieldBossConfig.prototype,"FieldBossConfig");var FirstRechargeClientConfig=function(){function t(){}return t}();__reflect(FirstRechargeClientConfig.prototype,"FirstRechargeClientConfig");var FirstRechargeConfig=function(){function t(){}return t}();__reflect(FirstRechargeConfig.prototype,"FirstRechargeConfig");var FlameStamp=function(){function t(){}return t}();__reflect(FlameStamp.prototype,"FlameStamp");var FlameStampEffect=function(){function t(){this.reloadTime=0,this.exPower=0}return t}();__reflect(FlameStampEffect.prototype,"FlameStampEffect");var FlameStampLevel=function(){function t(){}return t}();__reflect(FlameStampLevel.prototype,"FlameStampLevel");var FlameStampMat=function(){function t(){}return t}();__reflect(FlameStampMat.prototype,"FlameStampMat");var ForgeIndexConfig=function(){function t(){}return t}();__reflect(ForgeIndexConfig.prototype,"ForgeIndexConfig");var FriendLimit=function(){function t(){this.sysLv=50,this.chatLv=50,this.friendListLen=50,this.chatsListLen=50,this.applyListLen=50,this.blacklistLen=50,this.contentLimit=50}return t}();__reflect(FriendLimit.prototype,"FriendLimit");var FsFbConfig=function(){function t(){}return t}();__reflect(FsFbConfig.prototype,"FsFbConfig");var FuLiBtnConfig=function(){function t(){}return t}();__reflect(FuLiBtnConfig.prototype,"FuLiBtnConfig");var FuncNoticeConfig=function(){function t(){}return t}();__reflect(FuncNoticeConfig.prototype,"FuncNoticeConfig");var FuwenTreasureConfig=function(){function t(){this.huntOnce=500,this.huntTenth=4980}return t}();__reflect(FuwenTreasureConfig.prototype,"FuwenTreasureConfig");var FuwenTreasureLevelConfig=function(){function t(){}return t}();__reflect(FuwenTreasureLevelConfig.prototype,"FuwenTreasureLevelConfig");var FuwenTreasureRewardConfig=function(){function t(){}return t}();__reflect(FuwenTreasureRewardConfig.prototype,"FuwenTreasureRewardConfig");var GainItemConfig=function(){function t(){}return t}();__reflect(GainItemConfig.prototype,"GainItemConfig");var GainWay=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"gainName",{get:function(){return this[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"winName",{get:function(){return this[1]?this[1]:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"page",{get:function(){return this[2]?this[2]:0},enumerable:!0,configurable:!0}),e}(Array);__reflect(GainWay.prototype,"GainWay");var GGWWaveConf=function(){function t(){}return t}();__reflect(GGWWaveConf.prototype,"GGWWaveConf");var GlobalConfig=function(){function t(){}return t.init=function(){var e=this;if(!e.config){var i=e.config=RES.getRes("config_json");if(i){var s=function(t,e,i){if(0==i)t.__proto__=e;else for(var n in t)s(t[n],e,i-1)},n=function(n){var o=i[n],a=egret.getDefinitionByName(n);if(a){var r="_obj"+n;e[r]=new a;var h="_bool"+n;e[h]=!1;var l="_"+n+"_";Object.defineProperty(e,n,{get:function(){var i=e[l];if(e[h])return i;var o=e[r];return s(i,o,t.keys[n]||0),e[h]=!0,i},set:function(t){e[l]=t}})}e[n]=o};for(var o in i)n(o);RES.destroyRes("config_json")}}},t}();GlobalConfig.keys={InstanceBaseConfig:0,RongLuExpConfig:1,PlayFunConfig:1,HunGuConf:0,HunGuEquip:1,HunYuEquip:2,HunGuSuit:3,ShenShouConfig:0,ShenShouBase:1,ShenShouEquip:1,ShenShouSkill:1,TeamFuBenBaseConfig:0,TeamFuBenConfig:1,FlameStamp:0,CrossBossConfig:1,CrossBossBase:0,ZhanLingConfig:0,ZhanLingBase:1,ZhanLingLevel:2,ZhanLingEquip:1,ZhanLingSuit:1,ZhanLingTalent:2,ZhanLingSkill:1,SDKConfig:0,FlameStampLevel:1,PActivity2Config:2,FlameStampEffect:2,FlameStampMat:1,PActivity3Config:2,PActivityBtnConfig:1,PActivityConfig:1,WeaponSoulItemAttr:1,WeaponSoulBaseConfig:0,PrivilegeData:0,ActivityType10Config:2,PunchEquipMasterConfig:1,PunchEquipConfig:2,ActivityType9Config:2,SuperVipConfig:1,GodWeaponTaskConfig:2,ActorExRingFubenConfig:0,TrainDayAwardConfig:2,ActivityType5Config:2,ItemComposeConfig:1,LoopRechargeConfig:2,MultiDayRechargeConfig:1,CampBattleConfig:0,CampBattlePersonalAwardConfig:1,CampBattlePersonalRankAwardConfig:1,GodWingLevelConfig:2,MonsterTitleConf:1,FbChallengeLotteryConfig:1,LoginActivateConfig:0,GodWingSuitConfig:1,GodWingItemConfig:1,NewWorldBossRankConfig:2,NewWorldBossAttrConfig:1,NewWorldBossBaseConfig:0,MailIdConfig:1,CityBaseConfig:0,CityBossConfig:1,LevelMailConfig:1,LoginDayMailConfig:0,GuildBonFireConfig:1,ActivityType4Config:2,VipGiftConfig:1,ActivityType3Config:2,RechargeDaysAwardsConfig:1,RechargeItemsConfig:1,WeaponSoulSuit:2,WeaponSoulPosConfig:2,WeaponSoulConfig:1,KuangYuanConfig:1,NpcBaseConfig:1,CaiKuangConfig:0,RichManRoundAwardConfig:1,RichManGridConfig:1,RichManBaseConfig:0,FuwenTreasureRewardConfig:1,MonsterSpeakConfig:2,LeadFubenBaseConfig:0,GuanYinAwardConfig:1,MonthCardConfig:0,ItemGiftConfig:1,HeirloomEquipConfig:2,HeirloomEquipItemConfig:1,HeirloomEquipFireConfig:1,HeirloomEquipSetConfig:1,ItemDescConfig:1,DailyRechargeConfig:2,FirstRechargeConfig:1,FirstRechargeClientConfig:1,ExpFubenBaseConfig:0,ExpFubenConfig:1,ExpFbMonsterConfig:1,ImbaSkillReviseConfig:1,HintConfig:1,SkillsSorderConfig:1,SkillsDescConfig:1,ScenesConfig:1,YouDangConfig:1,BossHomeConfig:1,OpenSystemConfig:1,LoongSoulBaseConfig:0,DeathgainWayConfig:1,DeathGuideConfig:1,TrainBaseConfig:0,FbChNameConfig:1,StoneOpenConfig:1,WorldBossKillMsgConfig:1,MonstershpConfig:1,MonthSignVipConfig:1,MonthSignDaysConfig:1,MonthSignBaseConfig:0,MonthSignConfig:1,BookListConfig:1,DecomposeConfig:1,SuitConfig:2,CardConfig:2,MijiBaseConfig:1,TreasureBoxRateConfig:1,TreasureBoxGridConfig:1,TreasureBoxConfig:1,TreasureBoxBaseConfig:0,TianTiConstConfig:0,TianTiDanConfig:2,TianTiRankAwardConfig:1,NeiGongBaseConfig:0,NeiGongStageConfig:2,FuwenTreasureConfig:0,FuwenTreasureLevelConfig:1,FbChallengeConfig:1,RuneConverConfig:1,RuneBaseConfig:1,RuneLockPosConfig:1,RuneNameConfig:1,RuneOtherConfig:0,RuneAttrTypeConfig:1,RuneComposeConfig:1,TogetherHitEquipPageConfig:1,TogetherHitEquipQmConfig:3,TogetherHitEquipExchangeConfig:1,TogetherHitConfig:1,LimitTimeTaskConfig:1,LimitTimeConfig:1,BubbleConfig:1,DefineEff:1,ActorExRingConfig:1,ActorExRingBookConfig:2,ActorExRing2Config:1,ActorExRing3Config:1,ActorExRing4Config:1,ActorExRing5Config:1,ActorExRing6Config:1,ActorExRing7Config:1,ActorExRingAbilityConfig:1,ActorExRingItemConfig:3,MonstersConfig:1,ExpConfig:1,ItemConfig:1,EquipConfig:1,SkillsConfig:1,SkirmishRewardConfig:1,SkirmishBaseConfig:0,EffectsConfig:1,ChaptersRewardConfig:1,WorldRewardConfig:1,WingLevelConfig:1,WingCommonConfig:0,DailyFubenConfig:1,DailyConfig:1,DailyAwardConfig:1,ImbaJigsawConf:1,ImbaConf:1,AchievementTaskConfig:1,ZhuanShengConfig:0,ZhuanShengLevelConfig:1,JingMaiStageConfig:1,JingMaiLevelConfig:1,JingMaiCommonConfig:0,SkillsUpgradeConfig:1,SkillsOpenConfig:1,ZhuanShengExpConfig:1,NewRoleConfig:1,ForgeIndexConfig:1,StoneLevelCostConfig:1,StoneLevelConfig:1,ZhulingAttrConfig:1,ZhulingCostConfig:1,EnhanceAttrConfig:1,EnhanceCostConfig:1,LegendLevelupConfig:1,LegendComposeConfig:1,ExRingConfig:1,ExRing0Config:1,ExRing1Config:1,EquipItemConfig:1,ItemStoreConfig:1,StoreCommonConfig:0,IntegralStore:1,TreasureOverViewConfig:1,EffectConfig:1,VipConfig:1,ShieldConfig:1,ShieldStageConfig:1,LoongSoulConfig:1,LoongSoulStageConfig:1,TreasureHuntConfig:0,TreasureHuntPoolConfig:1,TreasureHuntPoolHefuConfig:1,SkirmishRankConfig:1,GainItemConfig:1,BagBaseConfig:0,BagExpandConfig:1,WorldBossConfig:1,WorldBossBaseConfig:0,ServerTips:1,AttrPowerConfig:1,TrainLevelConfig:1,LoginRewardsConfig:1,ActivityType1Config:2,ActivityType2Config:2,ActivityType6Config:2,ActivityType8Config:2,ActivityType7Config:2,ActivityConfig:1,ActivityBtnConfig:1,SkillPowerConfig:1,KnighthoodConfig:1,KnighthoodBasicConfig:0,ChongZhi1Config:3,ChongZhi2Config:3,FuncNoticeConfig:1,RefinesystemExpConfig:1,VipGridConfig:1,OtherBoss1Config:1,EquipPointConstConfig:0,EquipPointBasicConfig:1,EquipPointGrowUpConfig:2,EquipPointRankConfig:2,EquipPointResolveConfig:1,WanBaGiftbagBasic:1,HelpInfoConfig:1,ClientGlobalConfig:0,CashCowBoxConfig:1,CashCowLimitConfig:1,CashCowBasicConfig:1,CashCowAmplitudeConfig:1,GuildConfig:0,GuildCommonSkillConfig:2,GuildPracticeSkillConfig:2,GuildCreateConfig:1,GuildDonateConfig:1,GuildLevelConfig:2,GuildTaskConfig:1,WelfareConfig:1,OtherBoss2Config:1,MiJiGridConfig:1,MiJiSkillConfig:1,TitleConf:1,TrainLevelAwardConfig:1,TerraceDescConfig:1,WeiXiGuanZhuConst:0,GuildBattleLevel:1,GuildBattleConst:0,GuildBattleDayAward:1,GuildBattleDistributionAward:2,GuildBattlePersonalAward:1,GuildBattlePersonalRankAward:1,GuildStoreConfig:0,FriendLimit:0,ZhuangBanId:1,ZhuangBanConfig:0,FeatsStore:1,GuildBossConfig:0,GuildBossInfoConfig:1,GuildBossHpAwardsConfig:2,GuildBossRankConfig:1,AllWorldConfig:1,GuideConfig:2,TogerherHitBaseConfig:0,ActorExRingCommon:0,HeirloomTreasureConfig:0,HeirloomTreasureRewardConfig:1,OptionalGiftConfig:1,GodweaponItemConfig:1,GodWeaponLineConfig:2,GodWeaponLevelConfig:1,GodWeaponBaseConfig:0,GodWeaponFubenConfig:1,GWSkillReviseConfig:1,MoneyConfig:1,FbChallengeBaseConfig:0,YuPeiConfig:1,YuPeiBasicConfig:0,PassionPointConfig:0,PassionPointAwardConfig:1,RoleConfig:2,NewFuncNoticeConfig:1,ReincarnationBase:0,ReincarnationExchange:1,ReincarnationLevel:1,ReincarnateSpirit:2,ReincarnateSuit:1,ReincarnateEquip:1,EquipWithEffConfig:1,PrestigeBase:0,PrestigeLevel:1,ActivityType11_1Config:2,ActivityType11_2Config:2,ReincarnateEquipCompose:1,SpecialEquipsConfig:1,ReincarnationSoulLevel:3,ReincarnationDemonLevel:2,ReincarnationLinkLevel:3,PeakRaceBase:0,PeakRaceTime:1,PeakRaceCrossTime:1,ActivityType19Config:2,ActivityType18Config:2,HeartMethodStarConfig:1,GuardGodWeaponConf:0,GGWWaveConf:2,JadePlateBaseConfig:0,JadePlateLevelConfig:1,HeartMethodBaseConfig:0,HeartMethodConfig:1,HeartMethodPosConfig:3,HeartMethodLevelConfig:2,HeartMethodStageConfig:2,HeartMethodSuitConfig:2,ZhiZunEquipLevel:2,ZhiZunLinkLevel:3,ZhuangBanLevelUp:2,ActivityType20Config:2,PActivityType1Config:2,PActivityType9Config:2,ActivityType12Config:2,DevilBossBase:0,DevilBossConfig:1,CrossArenaBase:0,CrossArenaScore:1},__reflect(GlobalConfig.prototype,"GlobalConfig");var GodWingItemConfig=function(){function t(){}return t}();__reflect(GodWingItemConfig.prototype,"GodWingItemConfig");var GodWingLevelConfig=function(){function t(){}return t}();__reflect(GodWingLevelConfig.prototype,"GodWingLevelConfig");var GodWingSuitConfig=function(){function t(){}return t}();__reflect(GodWingSuitConfig.prototype,"GodWingSuitConfig");var GuanYinAwardConfig=function(){function t(){this.level=0}return t}();__reflect(GuanYinAwardConfig.prototype,"GuanYinAwardConfig");var GuardGodWeaponConf=function(){function t(){}return t}();__reflect(GuardGodWeaponConf.prototype,"GuardGodWeaponConf");var GuideCondition=function(){function t(){}return t}();__reflect(GuideCondition.prototype,"GuideCondition");var GuildActivityConfig=function(){function t(){}return t}();__reflect(GuildActivityConfig.prototype,"GuildActivityConfig");var GuildBattleConst=function(){function t(){}return t}();__reflect(GuildBattleConst.prototype,"GuildBattleConst");var GuildBattleDayAward=function(){function t(){}return t}();__reflect(GuildBattleDayAward.prototype,"GuildBattleDayAward");var GuildBattleDistributionAward=function(){function t(){}return t}();__reflect(GuildBattleDistributionAward.prototype,"GuildBattleDistributionAward");var GuildBattleLevel=function(){function t(){}return t}();__reflect(GuildBattleLevel.prototype,"GuildBattleLevel");var GuildBattlePersonalAward=function(){function t(){}return t}();__reflect(GuildBattlePersonalAward.prototype,"GuildBattlePersonalAward");var GuildBattlePersonalRankAward=function(){function t(){}return t}();__reflect(GuildBattlePersonalRankAward.prototype,"GuildBattlePersonalRankAward");var GuildBossConfig=function(){function t(){this.dayTimes=0,this.notOpenDayOfWeek=0,this.effid=0,this.radisLv=0}return t}();__reflect(GuildBossConfig.prototype,"GuildBossConfig");var GuildBossHpAwardsConfig=function(){function t(){this.srank=0,this.erank=0,this.mail_head="",this.mail_content=""}return t}();__reflect(GuildBossHpAwardsConfig.prototype,"GuildBossHpAwardsConfig");var GuildBossInfoConfig=function(){function t(){this.id=0,this.fbId=0,this.enterAwards=0}return t}();__reflect(GuildBossInfoConfig.prototype,"GuildBossInfoConfig");var GuildBossRankConfig=function(){function t(){}return t}();__reflect(GuildBossRankConfig.prototype,"GuildBossRankConfig");var GuildCommonSkillConfig=function(){function t(){}return t}();__reflect(GuildCommonSkillConfig.prototype,"GuildCommonSkillConfig");var GuildConfig=function(){function t(){}return t}();__reflect(GuildConfig.prototype,"GuildConfig");var GuildCreateConfig=function(){function t(){}return t}();__reflect(GuildCreateConfig.prototype,"GuildCreateConfig");var GuildDonateConfig=function(){function t(){}return t}();__reflect(GuildDonateConfig.prototype,"GuildDonateConfig");var GuildLevelConfig=function(){function t(){}return t}();__reflect(GuildLevelConfig.prototype,"GuildLevelConfig");var GuildPracticeSkillConfig=function(){function t(){}return t}();__reflect(GuildPracticeSkillConfig.prototype,"GuildPracticeSkillConfig");var GuildStoreConfig=function(){function t(){}return t}();__reflect(GuildStoreConfig.prototype,"GuildStoreConfig");var GuildTaskConfig=function(){function t(){}return t}();__reflect(GuildTaskConfig.prototype,"GuildTaskConfig");var HeartMethodBaseConfig=function(){function t(){this.serverDay=0,this.zsLv=0,this.starMax=0}return t}();__reflect(HeartMethodBaseConfig.prototype,"HeartMethodBaseConfig");var HeartMethodConfig=function(){function t(){this.id=0}return t}();__reflect(HeartMethodConfig.prototype,"HeartMethodConfig");var HeartMethodLevelConfig=function(){function t(){}return t}();__reflect(HeartMethodLevelConfig.prototype,"HeartMethodLevelConfig");var HeartMethodPosConfig=function(){function t(){}return t}();__reflect(HeartMethodPosConfig.prototype,"HeartMethodPosConfig");var HeartMethodStageConfig=function(){function t(){}return t}();__reflect(HeartMethodStageConfig.prototype,"HeartMethodStageConfig");var HeartMethodStarConfig=function(){function t(){}return t}();__reflect(HeartMethodStarConfig.prototype,"HeartMethodStarConfig");var HeartMethodSuitConfig=function(){function t(){}return t}();__reflect(HeartMethodSuitConfig.prototype,"HeartMethodSuitConfig");var HeirloomEquipConfig=function(){function t(){}return t}();__reflect(HeirloomEquipConfig.prototype,"HeirloomEquipConfig");var HeirloomEquipFireConfig=function(){function t(){}return t}();__reflect(HeirloomEquipFireConfig.prototype,"HeirloomEquipFireConfig");var HeirloomEquipItemConfig=function(){function t(){}return t}();__reflect(HeirloomEquipItemConfig.prototype,"HeirloomEquipItemConfig");var HeirloomEquipSetConfig=function(){function t(){}return t}();__reflect(HeirloomEquipSetConfig.prototype,"HeirloomEquipSetConfig");var HeirloomTreasureConfig=function(){function t(){}return t}();__reflect(HeirloomTreasureConfig.prototype,"HeirloomTreasureConfig");var HeirloomTreasureRewardConfig=function(){function t(){}return t}();__reflect(HeirloomTreasureRewardConfig.prototype,"HeirloomTreasureRewardConfig");var HelpInfoConfig=function(){function t(){}return t}();__reflect(HelpInfoConfig.prototype,"HelpInfoConfig");var HintConfig=function(){function t(){}return t}();__reflect(HintConfig.prototype,"HintConfig");var HunGuConf=function(){function t(){this.openzhuanshenglv=0,this.openserverday=0,this.showzhuanshenglv=0,this.equipCount=0,this.hunyuCount=0}return t}();__reflect(HunGuConf.prototype,"HunGuConf");var HunGuEquip=function(){function t(){this.id=0,this.stage=0}return t}();__reflect(HunGuEquip.prototype,"HunGuEquip");var HunGuSuit=function(){function t(){this.id=0,this.count=0,this.stage=0,this.expower=0,this.specialAttrs=0}return t}();__reflect(HunGuSuit.prototype,"HunGuSuit");var HunYuEquip=function(){function t(){this.id=0,this.level=0
}return t}();__reflect(HunYuEquip.prototype,"HunYuEquip");var ImbaConf=function(){function t(){}return t}();__reflect(ImbaConf.prototype,"ImbaConf");var ImbaJigsawConf=function(){function t(){}return t}();__reflect(ImbaJigsawConf.prototype,"ImbaJigsawConf");var ImbaSkillReviseConfig=function(){function t(){this.id=0,this.skill=0,this.imba_id=0,this.a=0,this.b=0,this.cd=0,this.d=0,this.crit=0,this.affectCount=0,this.selfEff=[],this.targetEff=[],this.args={}}return t}();__reflect(ImbaSkillReviseConfig.prototype,"ImbaSkillReviseConfig");var InstanceBaseConfig=function(){function t(){}return t}();__reflect(InstanceBaseConfig.prototype,"InstanceBaseConfig");var InstanceConfig=function(){function t(){this.fbid=0,this.type=0}return t}();__reflect(InstanceConfig.prototype,"InstanceConfig");var IntegralStore=function(){function t(){}return t}();__reflect(IntegralStore.prototype,"IntegralStore");var ItemConfig=function(){function t(){this.bagType=0}return t.calculateBagItemScore=function(t){var e={hp:2,atk:4,def:5,res:6},i=GlobalConfig.EquipConfig[t.itemConfig.id],s=GlobalConfig.AttrPowerConfig,n=0,o=t.att,a=0;if(o){for(var r in e)if(a=0,i[r]){for(var h=0;h<o.length;h++)if(o[h].type==e[r]){a=i[r]+o[h].value;break}n+=(void 0==a?0:a)*s[e[r]].power}}else for(var l in e)if(a=i[l]){var c=Role.getAttrTypeByName(l);n+=a*s[c].power}var u=0;return i.baseAttr1&&(u+=UserBag.getAttrPower([i.baseAttr1])),i.baseAttr2&&(u+=UserBag.getAttrPower([i.baseAttr2])),i.exPower&&(u+=i.exPower),Math.floor(n/100)+Math.floor(u)},t.pointCalNumber=function(e){var i=e.id;if(void 0!=t.itemPoints[i])return t.itemPoints[i];var s={hp:2,atk:4,def:5,res:6},n=GlobalConfig.EquipConfig[i],o=GlobalConfig.AttrPowerConfig,a=0;for(var r in s){var h=s[r],l=n[r];if(l){var c=o[h];a+=(l+Math.floor(l*ItemBase.additionRange/100))*c.power}}return t.itemPoints[i]=Math.floor(a/100),t.itemPoints[i]},t.getBaseAttrData=function(t){var e=GlobalConfig.EquipConfig[t.id],i={hp:2,atk:4,def:5,res:6},s=[AttributeType.atHolyDamege],n=[];for(var o in i)e[o]&&n.push(new AttributeData(i[o],e[o]));return e.baseAttr1&&s.indexOf(e.baseAttr1.type)>=0&&n.push(new AttributeData(e.baseAttr1.type,e.baseAttr1.value)),e.baseAttr2&&s.indexOf(e.baseAttr2.type)>=0&&n.push(new AttributeData(e.baseAttr2.type,e.baseAttr2.value)),n},t.calculateRelatePower=function(e,i){var s=0;if(!e||!i)return s;for(var n=0,o=e;n<o.length;n++){var a=o[n];s+=t.relatePower(a,i)}return s},t.relatePower=function(t,e){var i=0,s=GlobalConfig.AttrPowerConfig,n=s[t.type];if(n&&n.relate_type){var o=e.getAtt(n.relate_type),a=AttributeData.exRelate[n.relate_type];if(a){var r=e.getAtt(a);r&&(o=Math.floor(o/(1+r/1e4)))}i+=Math.floor(t.value*o*n.relate_power/100)}return i},t.getQuality=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].quality:0},t.getQualityColor=function(t){return ItemBase.QUALITY_COLOR[this.getQuality(t)]},t.getType=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].type:0},t.getSubType=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].subType:0},t.getJob=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].job:0},t.isEquip=function(t){var e=this.getType(t);switch(e){case ItemType.TYPE_0:case ItemType.TYPE_4:case ItemType.TYPE_11:return!0}return!1},t}();ItemConfig.itemPoints={},__reflect(ItemConfig.prototype,"ItemConfig");var ItemGiftConfig=function(){function t(){}return t}();__reflect(ItemGiftConfig.prototype,"ItemGiftConfig");var ItemStoreConfig=function(){function t(){}return t.getStoreByItemID=function(t){var e=GlobalConfig.ItemStoreConfig;for(var i in e){var s=e[i];if(s.itemId==t)return s}return null},t}();__reflect(ItemStoreConfig.prototype,"ItemStoreConfig");var JadePlateBaseConfig=function(){function t(){}return t}();__reflect(JadePlateBaseConfig.prototype,"JadePlateBaseConfig");var JadePlateLevelConfig=function(){function t(){}return t}();__reflect(JadePlateLevelConfig.prototype,"JadePlateLevelConfig");var JingMaiCommonConfig=function(){function t(){}return t}();__reflect(JingMaiCommonConfig.prototype,"JingMaiCommonConfig");var JingMaiLevelConfig=function(){function t(){}return t}();__reflect(JingMaiLevelConfig.prototype,"JingMaiLevelConfig");var JingMaiStageConfig=function(){function t(){}return t}();__reflect(JingMaiStageConfig.prototype,"JingMaiStageConfig");var KnighthoodBasicConfig=function(){function t(){this.perLevel=0,this.actImbaId=0}return t}();__reflect(KnighthoodBasicConfig.prototype,"KnighthoodBasicConfig");var KnighthoodConfig=function(){function t(){this.effid=0}return t}();__reflect(KnighthoodConfig.prototype,"KnighthoodConfig");var TaskIdConfig=function(){function t(){this.achieveId=0,this.taskId=0}return t}();__reflect(TaskIdConfig.prototype,"TaskIdConfig");var KnighthoodStageConfig=function(){function t(){this.stage=0,this.type=""}return t}();__reflect(KnighthoodStageConfig.prototype,"KnighthoodStageConfig");var KuangDiTuConfig=function(){function t(){}return t}();__reflect(KuangDiTuConfig.prototype,"KuangDiTuConfig");var LegendComposeConfig=function(){function t(){}return t}();__reflect(LegendComposeConfig.prototype,"LegendComposeConfig");var LegendLevelupConfig=function(){function t(){}return t}();__reflect(LegendLevelupConfig.prototype,"LegendLevelupConfig");var LimitTimeConfig=function(){function t(){this.id=0,this.time=0,this.openLevel=0,this.openZhuan=0}return t}();__reflect(LimitTimeConfig.prototype,"LimitTimeConfig");var LimitTimeTaskConfig=function(){function t(){this.id=0,this.name="",this.desc="",this.target=0,this.control=0}return t}();__reflect(LimitTimeTaskConfig.prototype,"LimitTimeTaskConfig");var LoginActivateConfig=function(){function t(){}return t}();__reflect(LoginActivateConfig.prototype,"LoginActivateConfig");var LoginRewardsConfig=function(){function t(){}return t}();__reflect(LoginRewardsConfig.prototype,"LoginRewardsConfig");var LoongSoulBaseConfig=function(){function t(){this.openlv=0}return t}();__reflect(LoongSoulBaseConfig.prototype,"LoongSoulBaseConfig");var LoongSoulConfig=function(){function t(){}return t}();__reflect(LoongSoulConfig.prototype,"LoongSoulConfig");var LoongSoulStageConfig=function(){function t(){this.stage=0,this.icon="",this.normalCost=0,this.attr=[],this.normalCostTip=0}return t}();__reflect(LoongSoulStageConfig.prototype,"LoongSoulStageConfig");var MijiBaseConfig=function(){function t(){}return t}();__reflect(MijiBaseConfig.prototype,"MijiBaseConfig");var MiJiGridConfig=function(){function t(){}return t}();__reflect(MiJiGridConfig.prototype,"MiJiGridConfig");var MiJiSkillConfig=function(){function t(){}return t.getSkillIDByItem=function(t){var e=GlobalConfig.MiJiSkillConfig;for(var i in e)if(e[i].item==t)return e[i].id;return-1},t}();__reflect(MiJiSkillConfig.prototype,"MiJiSkillConfig");var MoneyConfig=function(){function t(){}return t}();__reflect(MoneyConfig.prototype,"MoneyConfig");var MonstersConfig=function(){function t(){this.attrange=0,this.wanderrange=0,this.dirNum=2}return t}();__reflect(MonstersConfig.prototype,"MonstersConfig");var MonsterType;!function(t){t[t.Monster=0]="Monster",t[t.Boss=1]="Boss",t[t.Summon=3]="Summon",t[t.Ring=4]="Ring"}(MonsterType||(MonsterType={}));var MonstershpConfig=function(){function t(){this.hp=0,this.typeface=0}return t}();__reflect(MonstershpConfig.prototype,"MonstershpConfig");var MonthCardConfig=function(){function t(){this.monthCardMoney=0,this.privilegeMoney=0,this.expFubenPrecent=0,this.neiGongGoldPrecent=0,this.sweepPrecent=0}return t}();__reflect(MonthCardConfig.prototype,"MonthCardConfig");var MonthSignBaseConfig=function(){function t(){this.openLevel=0}return t}();__reflect(MonthSignBaseConfig.prototype,"MonthSignBaseConfig");var MonthSignConfig=function(){function t(){this.month=0,this.day=0,this.rewards=null,this.dayLabel=0,this.vipLabel=0}return t}();__reflect(MonthSignConfig.prototype,"MonthSignConfig");var MonthSignDaysConfig=function(){function t(){this.days=0,this.rewards=null}return t}();__reflect(MonthSignDaysConfig.prototype,"MonthSignDaysConfig");var MonthSignVipConfig=function(){function t(){this.vipLevel=0,this.complementTimes=0}return t}();__reflect(MonthSignVipConfig.prototype,"MonthSignVipConfig");var MorshipConfig=function(){function t(){}return t}();__reflect(MorshipConfig.prototype,"MorshipConfig");var NeiGongBaseConfig=function(){function t(){this.openLevel=10,this.maxLevel=20,this.maxStage=0,this.levelPerStage=0,this.openGuanqia=10}return t}();__reflect(NeiGongBaseConfig.prototype,"NeiGongBaseConfig");var NeiGongStageConfig=function(){function t(){this.stage=0,this.level=0,this.totalExp=0,this.costMoney=0,this.addExp=0,this.attribute=[],this.tips=0}return t}();__reflect(NeiGongStageConfig.prototype,"NeiGongStageConfig");var NewFuncNoticeConfig=function(){function t(){}return t}();__reflect(NewFuncNoticeConfig.prototype,"NewFuncNoticeConfig");var NewRoleConfig=function(){function t(){}return t}();__reflect(NewRoleConfig.prototype,"NewRoleConfig");var OpenSystemConfig=function(){function t(){this.id=0,this.openzs=0,this.openlevel=0,this.opencheck=0}return t}();__reflect(OpenSystemConfig.prototype,"OpenSystemConfig");var OptionalGiftConfig=function(){function t(){}return t}();__reflect(OptionalGiftConfig.prototype,"OptionalGiftConfig");var OtherBoss1Config=function(){function t(){}return t}();__reflect(OtherBoss1Config.prototype,"OtherBoss1Config");var OtherBoss2Config=function(){function t(){}return t}();__reflect(OtherBoss2Config.prototype,"OtherBoss2Config");var PActivity1Config=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ActivityType1Config);__reflect(PActivity1Config.prototype,"PActivity1Config");var PActivity2Config=function(){function t(){}return t}();__reflect(PActivity2Config.prototype,"PActivity2Config");var PActivity3Config=function(){function t(){this.day=1}return t}();__reflect(PActivity3Config.prototype,"PActivity3Config");var PActivity9Config=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ActivityType9Config);__reflect(PActivity9Config.prototype,"PActivity9Config");var PActivityBtnConfig=function(){function t(){}return t}();__reflect(PActivityBtnConfig.prototype,"PActivityBtnConfig");var PActivityConfig=function(){function t(){}return t}();__reflect(PActivityConfig.prototype,"PActivityConfig");var PassionPointAwardConfig=function(){function t(){}return t}();__reflect(PassionPointAwardConfig.prototype,"PassionPointAwardConfig");var PassionPointConfig=function(){function t(){}return t}();__reflect(PassionPointConfig.prototype,"PassionPointConfig");var PayItemsConfig=function(){function t(){}return t}();__reflect(PayItemsConfig.prototype,"PayItemsConfig");var PeakRaceCrossTime=function(){function t(){}return t}();__reflect(PeakRaceCrossTime.prototype,"PeakRaceCrossTime");var PeakRaceTime=function(){function t(){}return t}();__reflect(PeakRaceTime.prototype,"PeakRaceTime");var PlayFunConfig=function(){function t(){this.pos=1,this.iconCls="eui.Button",this.iconSkin="MainButtonSkin"}return t}();__reflect(PlayFunConfig.prototype,"PlayFunConfig");var PrestigeBase=function(){function t(){}return t}();__reflect(PrestigeBase.prototype,"PrestigeBase");var PrestigeLevel=function(){function t(){}return t}();__reflect(PrestigeLevel.prototype,"PrestigeLevel");var PrivilegeData=function(){function t(){this.priviMoney=0,this.priviCardDays=0}return t}();__reflect(PrivilegeData.prototype,"PrivilegeData");var PublicBossBaseConfig=function(){function t(){}return t}();__reflect(PublicBossBaseConfig.prototype,"PublicBossBaseConfig");var PublicBossConfig=function(){function t(){this.rewardsDesc=""}return t}();__reflect(PublicBossConfig.prototype,"PublicBossConfig");var PunchEquipConfig=function(){function t(){}return t}();__reflect(PunchEquipConfig.prototype,"PunchEquipConfig");var PunchEquipMasterConfig=function(){function t(){}return t}();__reflect(PunchEquipMasterConfig.prototype,"PunchEquipMasterConfig");var RefinesystemExpConfig=function(){function t(){}return t}();__reflect(RefinesystemExpConfig.prototype,"RefinesystemExpConfig");var ReincarnateEquip=function(){function t(){}return t}();__reflect(ReincarnateEquip.prototype,"ReincarnateEquip");var ReincarnateEquipCompose=function(){function t(){}return t}();__reflect(ReincarnateEquipCompose.prototype,"ReincarnateEquipCompose");var ReincarnateSpirit=function(){function t(){}return t}();__reflect(ReincarnateSpirit.prototype,"ReincarnateSpirit");var ReincarnateSuit=function(){function t(){}return t}();__reflect(ReincarnateSuit.prototype,"ReincarnateSuit");var ReincarnationBase=function(){function t(){}return t}();__reflect(ReincarnationBase.prototype,"ReincarnationBase");var ReincarnationExchange=function(){function t(){}return t}();__reflect(ReincarnationExchange.prototype,"ReincarnationExchange");var ReincarnationLevel=function(){function t(){}return t}();__reflect(ReincarnationLevel.prototype,"ReincarnationLevel");var RobberfbConfig=function(){function t(){}return t}();__reflect(RobberfbConfig.prototype,"RobberfbConfig");var RoleConfig=function(){function t(){this.level=0,this.job=0,this.hp=0,this.mp=0,this.atk=0,this.def=0,this.res=0,this.crit=0,this.tough=0,this.as=0,this.ms=0,this.acrit=0}return t}();__reflect(RoleConfig.prototype,"RoleConfig");var RongLuExpConfig=function(){function t(){}return t}();__reflect(RongLuExpConfig.prototype,"RongLuExpConfig");var RongLuLevelConfig=function(){function t(){}return t}();__reflect(RongLuLevelConfig.prototype,"RongLuLevelConfig");var RuneAttrTypeConfig=function(){function t(){this.type=0}return t}();__reflect(RuneAttrTypeConfig.prototype,"RuneAttrTypeConfig");var RuneBaseConfig=function(){function t(){this.id=0,this.type=0,this.expend=0,this.gain=0,this.chip=0,this.attr=[],this.equipAttr=[],this.exAttr=[],this.specialAttr=[],this.specialDesc=null,this.power=0}return t}();__reflect(RuneBaseConfig.prototype,"RuneBaseConfig");var RuneComposeConfig=function(){function t(){}return t}();__reflect(RuneComposeConfig.prototype,"RuneComposeConfig");var RuneConverConfig=function(){function t(){this.id=0,this.checkpoint=0,this.conversion=0}return t}();__reflect(RuneConverConfig.prototype,"RuneConverConfig");var RuneLockPosConfig=function(){function t(){this.pos=0,this.lockLv=0}return t}();__reflect(RuneLockPosConfig.prototype,"RuneLockPosConfig");var RuneNameConfig=function(){function t(){this.type=0,this.runeName=""}return t}();__reflect(RuneNameConfig.prototype,"RuneNameConfig");var RuneOtherConfig=function(){function t(){this.zsLevel=0,this.maxEquip=0,this.maxQuality=0,this.maxDecompose=5}return t}();__reflect(RuneOtherConfig.prototype,"RuneOtherConfig");var ScenesConfig=function(){function t(){this.turn=0,this.autoPunch=0}return t}();__reflect(ScenesConfig.prototype,"ScenesConfig");var ServerTips=function(){function t(){}return t}();__reflect(ServerTips.prototype,"ServerTips");var ShenShouBase=function(){function t(){}return t}();__reflect(ShenShouBase.prototype,"ShenShouBase");var ShieldConfig=function(){function t(){}return t}();__reflect(ShieldConfig.prototype,"ShieldConfig");var ShieldStageConfig=function(){function t(){this.stage=0,this.icon="",this.normalCost=0,this.attr=[],this.normalCostTip=0}return t}();__reflect(ShieldStageConfig.prototype,"ShieldStageConfig");var StoreCommonConfig=function(){function t(){}return t}();__reflect(StoreCommonConfig.prototype,"StoreCommonConfig");var SkillPowerConfig=function(){function t(){}return t}();__reflect(SkillPowerConfig.prototype,"SkillPowerConfig");var SkillsOpenConfig=function(){function t(){}return t}();__reflect(SkillsOpenConfig.prototype,"SkillsOpenConfig");var SkillsUpgradeConfig=function(){function t(){}return t}();__reflect(SkillsUpgradeConfig.prototype,"SkillsUpgradeConfig");var SkirmishBaseConfig=function(){function t(){}return t}();__reflect(SkirmishBaseConfig.prototype,"SkirmishBaseConfig");var SkirmishRankConfig=function(){function t(){}return t}();__reflect(SkirmishRankConfig.prototype,"SkirmishRankConfig");var SkirmishRewardConfig=function(){function t(){}return t}();__reflect(SkirmishRewardConfig.prototype,"SkirmishRewardConfig");var SpecialEquipsConfig=function(){function t(){}return t}();__reflect(SpecialEquipsConfig.prototype,"SpecialEquipsConfig");var FitleStyle;!function(t){t[t.fj=1]="fj",t[t.hc=2]="hc"}(FitleStyle||(FitleStyle={}));var StoneLevelConfig=function(){function t(){}return t}();__reflect(StoneLevelConfig.prototype,"StoneLevelConfig");var StoneLevelCostConfig=function(){function t(){}return t}();__reflect(StoneLevelCostConfig.prototype,"StoneLevelCostConfig");var StoneOpenConfig=function(){function t(){}return t}();__reflect(StoneOpenConfig.prototype,"StoneOpenConfig");var SuitConfig=function(){function t(){}return t}();__reflect(SuitConfig.prototype,"SuitConfig");var TeamFuBenBaseConfig=function(){function t(){}return t}();__reflect(TeamFuBenBaseConfig.prototype,"TeamFuBenBaseConfig");var TeamFuBenConfig=function(){function t(){}return t}();__reflect(TeamFuBenConfig.prototype,"TeamFuBenConfig");var TeamFuBenGuideConfig=function(){function t(){}return t}();__reflect(TeamFuBenGuideConfig.prototype,"TeamFuBenGuideConfig");var TianTiConstConfig=function(){function t(){}return t}();__reflect(TianTiConstConfig.prototype,"TianTiConstConfig");var TianTiDanConfig=function(){function t(){}return t}();__reflect(TianTiDanConfig.prototype,"TianTiDanConfig");var TitleConf=function(){function t(){}return t}();__reflect(TitleConf.prototype,"TitleConf");var TogerherHitBaseConfig=function(){function t(){}return t}();__reflect(TogerherHitBaseConfig.prototype,"TogerherHitBaseConfig");var TogetherHitConfig=function(){function t(){this.level=0}return t}();__reflect(TogetherHitConfig.prototype,"TogetherHitConfig");var TogetherHitEquipExchangeConfig=function(){function t(){this.id=0,this.exchangeAmount=0,this.level=0,this.zsLevel=0}return t}();__reflect(TogetherHitEquipExchangeConfig.prototype,"TogetherHitEquipExchangeConfig");var TogetherHitEquipPageConfig=function(){function t(){this.name=0,this.icon=""}return t}();__reflect(TogetherHitEquipPageConfig.prototype,"TogetherHitEquipPageConfig");var TogetherHitEquipQmConfig=function(){function t(){this.num=0,this.lv=0,this.zslv=0,this.desc=""}return t}();__reflect(TogetherHitEquipQmConfig.prototype,"TogetherHitEquipQmConfig");var TrainBaseConfig=function(){function t(){}return t}();__reflect(TrainBaseConfig.prototype,"TrainBaseConfig");var TrainDayAwardConfig=function(){function t(){}return t}();__reflect(TrainDayAwardConfig.prototype,"TrainDayAwardConfig");var TrainLevelAwardConfig=function(){function t(){}return t}();__reflect(TrainLevelAwardConfig.prototype,"TrainLevelAwardConfig");var TrainLevelConfig=function(){function t(){this.trainName="",this.img=""}return t}();__reflect(TrainLevelConfig.prototype,"TrainLevelConfig");var TreasureBoxBaseConfig=function(){function t(){this.moneyCoefficient=3,this.getItemguide=0}return t}();__reflect(TreasureBoxBaseConfig.prototype,"TreasureBoxBaseConfig");var TreasureBoxConfig=function(){function t(){}return t}();__reflect(TreasureBoxConfig.prototype,"TreasureBoxConfig");var TreasureBoxGridConfig=function(){function t(){}return t}();__reflect(TreasureBoxGridConfig.prototype,"TreasureBoxGridConfig");var TreasureHuntConfig=function(){function t(){}return t}();__reflect(TreasureHuntConfig.prototype,"TreasureHuntConfig");var TreasureHuntPoolConfig=function(){function t(){}return t}();__reflect(TreasureHuntPoolConfig.prototype,"TreasureHuntPoolConfig");var TreasureHuntPoolHefuConfig=function(){function t(){}return t}();__reflect(TreasureHuntPoolHefuConfig.prototype,"TreasureHuntPoolHefuConfig");var TupoAttrConfig=function(){function t(){}return t}();__reflect(TupoAttrConfig.prototype,"TupoAttrConfig");var TupoCostConfig=function(){function t(){}return t}();__reflect(TupoCostConfig.prototype,"TupoCostConfig");var UpdateRemindConfig=function(){function t(){}return t}();__reflect(UpdateRemindConfig.prototype,"UpdateRemindConfig");var VipConfig=function(){function t(){this.boss1buy=0,this.boss2buy=0}return t}();__reflect(VipConfig.prototype,"VipConfig");var VipGridConfig=function(){function t(){}return t}();__reflect(VipGridConfig.prototype,"VipGridConfig");var WanBaGiftbagBasic=function(){function t(){}return t}();__reflect(WanBaGiftbagBasic.prototype,"WanBaGiftbagBasic");var WeaponSoulBaseConfig=function(){function t(){this.maxItemNum=0,this.itemid=0}return t}();__reflect(WeaponSoulBaseConfig.prototype,"WeaponSoulBaseConfig");var WeaponSoulConfig=function(){function t(){this.id=1,this.name="",this.actcond=[],this.inside=[],this.outside=[],this.pic=[],this.icon=""}return t}();__reflect(WeaponSoulConfig.prototype,"WeaponSoulConfig");var WeaponSoulItemAttr=function(){function t(){this.id=0,this.attr=[]}return t}();__reflect(WeaponSoulItemAttr.prototype,"WeaponSoulItemAttr");var WeaponSoulPosConfig=function(){function t(){this.id=0,this.level=0,this.costItem=0,this.costNum=0,this.showlv=0}return t}();__reflect(WeaponSoulPosConfig.prototype,"WeaponSoulPosConfig");var WeaponSoulSuit=function(){function t(){this.id=0,this.level=0,this.attr=[],this.ex_attr=[],this.skillname="",this.skillicon="",this.skilldesc=""}return t}();__reflect(WeaponSoulSuit.prototype,"WeaponSoulSuit");var WingCommonConfig=function(){function t(){}return t}();__reflect(WingCommonConfig.prototype,"WingCommonConfig");var WingLevelConfig=function(){function t(){this.exp=0,this.pasSkillId=0}return t}();__reflect(WingLevelConfig.prototype,"WingLevelConfig");var WingStarConfig=function(){function t(){}return t}();__reflect(WingStarConfig.prototype,"WingStarConfig");var WorldBossBaseConfig=function(){function t(){this.refreshHour=0,this.refreshMinute=0,this.levelUpTime=0,this.challengeCd=0,this.convertRate=0,this.maxGold=0,this.clearCdCost=[],this.lotteryTime=0,this.dayCount=[],this.buyCountPrice=[],this.rebornItem=0}return t}();__reflect(WorldBossBaseConfig.prototype,"WorldBossBaseConfig");var WorldBossConfig=function(){function t(){this.zsLevel=0,this.level=0,this.fbid=0,this.bossId=0,this.shield=0,this.joinReward=0,this.shieldReward=0,this.belongReward=0,this.killReward=0,this.vip=0,this.samsaraLv=0}return t}();__reflect(WorldBossConfig.prototype,"WorldBossConfig");var WorldBossKillMsgConfig=function(){function t(){this.msg="",this.id=0}return t}();__reflect(WorldBossKillMsgConfig.prototype,"WorldBossKillMsgConfig");var WorldRewardConfig=function(){function t(){}return t}();__reflect(WorldRewardConfig.prototype,"WorldRewardConfig");var XueyuStageConfig=function(){function t(){this.stage=0,this.icon="",this.normalCost=0,this.attr=[],this.normalCostTip=0}return t}();__reflect(XueyuStageConfig.prototype,"XueyuStageConfig");var YouDangConfig=function(){function t(){}return t}();__reflect(YouDangConfig.prototype,"YouDangConfig");var YuPeiBasicConfig=function(){function t(){}return t}();__reflect(YuPeiBasicConfig.prototype,"YuPeiBasicConfig");var YuPeiConfig=function(){function t(){}return t}();__reflect(YuPeiConfig.prototype,"YuPeiConfig");var ZhanLingBase=function(){function t(){}return t}();__reflect(ZhanLingBase.prototype,"ZhanLingBase");var ZhanLingBox=function(){function t(){}return t}();__reflect(ZhanLingBox.prototype,"ZhanLingBox");var ZhanLingConfig=function(){function t(){}return t}();__reflect(ZhanLingConfig.prototype,"ZhanLingConfig");var ZhanLingEquip=function(){function t(){}return t}();__reflect(ZhanLingEquip.prototype,"ZhanLingEquip");var ZhanLingID=function(){function t(){}return t}();__reflect(ZhanLingID.prototype,"ZhanLingID");var ZhanLingLevel=function(){function t(){}return t}();__reflect(ZhanLingLevel.prototype,"ZhanLingLevel");var ZhanLingSkill=function(){function t(){}return t}();__reflect(ZhanLingSkill.prototype,"ZhanLingSkill");var ZhanLingStage=function(){function t(){}return t}();__reflect(ZhanLingStage.prototype,"ZhanLingStage");var ZhanLingSuit=function(){function t(){}return t}();__reflect(ZhanLingSuit.prototype,"ZhanLingSuit");var ZhanLingTalent=function(){function t(){}return t}();__reflect(ZhanLingTalent.prototype,"ZhanLingTalent");var ZhiZunEquipLevel=function(){function t(){this.ex_power=0}return t}();__reflect(ZhiZunEquipLevel.prototype,"ZhiZunEquipLevel");var ZhiZunLinkLevel=function(){function t(){this.ex_power=0}return t}();__reflect(ZhiZunLinkLevel.prototype,"ZhiZunLinkLevel");var ZhuangBanConfig=function(){function t(){}return t}();__reflect(ZhuangBanConfig.prototype,"ZhuangBanConfig");var ZhuangBanId=function(){function t(){}return t}();__reflect(ZhuangBanId.prototype,"ZhuangBanId");var ZhuanShengConfig=function(){function t(){}return t}();__reflect(ZhuanShengConfig.prototype,"ZhuanShengConfig");var ZhuanShengExpConfig=function(){function t(){}return t}();__reflect(ZhuanShengExpConfig.prototype,"ZhuanShengExpConfig");var ZhuanShengLevelConfig=function(){function t(){}return t}();__reflect(ZhuanShengLevelConfig.prototype,"ZhuanShengLevelConfig");var ZhulingAttrConfig=function(){function t(){}return t}();__reflect(ZhulingAttrConfig.prototype,"ZhulingAttrConfig");var ZhulingCostConfig=function(){function t(){this.level=1,this.itemId=1,this.count=1}return t}();__reflect(ZhulingCostConfig.prototype,"ZhulingCostConfig");var ItemConst;!function(t){t.RENAME=450001,t.EXP_ITEM=200137,t.GUANYIN_ITEM=600005,t.LEVELUP_ITEM=200155,t.GOLD_BRICK=200164,t.TREASURE_ITEM=200165,t.TREASURE_RUNE=200166,t.PUBLICBOSS=200156,t.WORLDBOSS=200157,t.FIRE_FB=202e3,t.GODWING_ITEM=601e3,t.THANKS_ITEM=0,t.SHENYUBOSS=200995,t.WEIWANG_ITEM=200318,t.GODWEAPON_ITEM=200333,t.JINGJIN=200332}(ItemConst||(ItemConst={}));var ItemType;!function(t){t[t.TYPE_0=0]="TYPE_0",t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5",t[t.TYPE_6=6]="TYPE_6",t[t.TYPE_7=7]="TYPE_7",t[t.TYPE_8=8]="TYPE_8",t[t.TYPE_9=9]="TYPE_9",t[t.TYPE_10=10]="TYPE_10",t[t.TYPE_11=11]="TYPE_11",t[t.TYPE_12=12]="TYPE_12",t[t.TYPE_13=13]="TYPE_13",t[t.TYPE_14=14]="TYPE_14",t[t.TYPE_15=15]="TYPE_15",t[t.TYPE_16=16]="TYPE_16",t[t.TYPE_17=17]="TYPE_17",t[t.TYPE_18=18]="TYPE_18",t[t.TYPE_19=19]="TYPE_19",t[t.TYPE_20=20]="TYPE_20",t[t.TYPE_21=21]="TYPE_21",t[t.TYPE_22=22]="TYPE_22",t[t.TYPE_23=23]="TYPE_23",t[t.TYPE_24=24]="TYPE_24",t[t.TYPE_25=25]="TYPE_25"}(ItemType||(ItemType={}));var JobConst;!function(t){t[t.None=0]="None",t[t.ZhanShi=1]="ZhanShi",t[t.FaShi=2]="FaShi",t[t.DaoShi=3]="DaoShi"}(JobConst||(JobConst={}));var MoneyConst;!function(t){t[t.exp=0]="exp",t[t.gold=1]="gold",t[t.yuanbao=2]="yuanbao",t[t.fame=3]="fame",t[t.soul=4]="soul",t[t.wing=5]="wing",t[t.feat=7]="feat",t[t.rune=9]="rune",t[t.piece=10]="piece",t[t.punch1=11]="punch1",t[t.punch2=12]="punch2",t[t.godweaponExp=13]="godweaponExp",t[t.weiWang=14]="weiWang",t[t.chip=15]="chip",t[t.shoushenExp=16]="shoushenExp"}(MoneyConst||(MoneyConst={}));var skillConst=function(){function t(){}return t}();skillConst.baseSkillIndex=[11,21,31],__reflect(skillConst.prototype,"skillConst");var SkillEffNumType;!function(t){t[t.Single=0]="Single",t[t.All=1]="All",t[t.NoEff=2]="NoEff",t[t.SelfAndTarget=3]="SelfAndTarget"}(SkillEffNumType||(SkillEffNumType={}));var castType;!function(t){t[t.Friend=1]="Friend",t[t.Other=2]="Other",t[t.Self=3]="Self",t[t.SelfHpLess=4]="SelfHpLess"}(castType||(castType={}));var SystemType;!function(t){t[t.FIRSTCHARGE=1]="FIRSTCHARGE",t[t.ACTIVITY=2]="ACTIVITY",t[t.RANK=3]="RANK",t[t.MALL=4]="MALL",t[t.FULI=5]="FULI",t[t.MONTHCARD=6]="MONTHCARD",t[t.TREASURE=7]="TREASURE",t[t.WORLDMAP=8]="WORLDMAP",t[t.RING=9]="RING",t[t.MIJI=10]="MIJI",t[t.BOSS=11]="BOSS",t[t.FB=12]="FB",t[t.ONEKEY=13]="ONEKEY",t[t.CHALLENGE=14]="CHALLENGE",t[t.SHENQIGUIDE=15]="SHENQIGUIDE",t[t.BOOK=16]="BOOK",t[t.WEAPONS=17]="WEAPONS",t[t.GUILD=18]="GUILD",t[t.VIPGIFT=19]="VIPGIFT",t[t.LIMITTASK=20]="LIMITTASK",t[t.FOCUS=21]="FOCUS",t[t.SHARE=22]="SHARE",t[t.FENGCE=23]="FENGCE",t[t.DAILYGIFT=24]="DAILYGIFT",t[t.QUICKDROP=25]="QUICKDROP",t[t.MABI=26]="MABI",t[t.NEWEQUIP=27]="NEWEQUIP",t[t.CITYMONSTER=28]="CITYMONSTER",t[t.DOUBLEELEVEN=29]="DOUBLEELEVEN",t[t.GODWEAPON=30]="GODWEAPON",t[t.SUPERVIP=31]="SUPERVIP",t[t.CITY=32]="CITY",t[t.THANKS=33]="THANKS",t[t.HFACTIVITY=34]="HFACTIVITY",t[t.DOUBLE_TWELVE=35]="DOUBLE_TWELVE",t[t.DOUBLE_TWELVE_RECHARGE=36]="DOUBLE_TWELVE_RECHARGE",t[t.BATTLE=37]="BATTLE",t[t.PAODIAN=38]="PAODIAN",t[t.CHRISTMAS=39]="CHRISTMAS",t[t.NEWYEAR=40]="NEWYEAR",t[t.HAPPYSEVENDAY=41]="HAPPYSEVENDAY",t[t.CELEBRATION=42]="CELEBRATION",t[t.CHAT=43]="CHAT",t[t.ZHIZUN=44]="ZHIZUN",t[t.LABA=45]="LABA",t[t.SPRINGBEGIN=46]="SPRINGBEGIN",t[t.ZHANLING=47]="ZHANLING",t[t.XIAONIAN=48]="XIAONIAN",t[t.SPRINGFESTIVAL=49]="SPRINGFESTIVAL",t[t.SPRINGEIGHTDAY=50]="SPRINGEIGHTDAY",t[t.KAIMENHONG=51]="KAIMENHONG",t[t.SANBA=52]="SANBA",t[t.LONGTAITOU=53]="LONGTAITOU",t[t.VERSIONCEL=54]="VERSIONCEL"}(SystemType||(SystemType={}));var BossUIBtnItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="worldBossAtbtn",e}return __extends(e,t),e}(eui.Component);__reflect(BossUIBtnItem.prototype,"BossUIBtnItem");var DefeatItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="DefeatItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);var t="|U&S:"+this.jump.size+"&C:"+this.jump.textColor+"&T:"+this.jump.text+"|";this.jump.textFlow=TextFlowMaker.generateTextFlow1(t)},e.prototype.onClick=function(t){switch(t.target){case this.openRole0:case this.jump:this.showDetail()}},e.prototype.showDetail=function(){this.cfg&&(ViewManager.ins().isShow(MaterialResultWin)?ViewManager.ins().close(MaterialResultWin):ViewManager.ins().isShow(TongResultWin)?ViewManager.ins().close(TongResultWin):ViewManager.ins().isShow(CityResultWin)?ViewManager.ins().close(CityResultWin):ViewManager.ins().isShow(NewWorldBossResultPanel)?ViewManager.ins().close(NewWorldBossResultPanel):ViewManager.ins().isShow(BossResultWin)?ViewManager.ins().close(BossResultWin):ViewManager.ins().isShow(PersonalResultWin)?ViewManager.ins().close(PersonalResultWin):ViewManager.ins().close(ResultWin),"VipWin"==this.cfg.gainWay[1]?ViewManager.ins().open(this.cfg.gainWay[1],UserVip.ins().lv+1):ViewManager.ins().open(this.cfg.gainWay[1],this.cfg.gainWay[2]))},e.prototype.dataChanged=function(){if(!isNaN(this.data)){this.cfg=null;var t=void 0;for(var e in GlobalConfig.DeathgainWayConfig)if(t=GlobalConfig.DeathgainWayConfig[e],t.level==this.data){this.cfg=t;break}if(this.cfg){if(14==this.cfg.level){var i=Recharge.ins().getRechargeData(0);i.num&&2!=i.num&&(this.cfg=GlobalConfig.DeathgainWayConfig[20])}this.icon.source=this.cfg.itemId,this.iconName.text=this.cfg.gainWay[0];this.desc.visible=!1,this.up.visible=this.desc.visible}16==this.data&&(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.jump.parent.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"chargeff1",-1),this.mc.touchEnabled=!1),this.mc.x=this.jump.x+18,this.mc.y=this.jump.y+9,this.mc.scaleX=this.mc.scaleY=.4,this.icon.scaleX=this.icon.scaleY=.55)}},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e}(BaseItemRender);__reflect(DefeatItem.prototype,"DefeatItem");var DropDown=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.touchEnabled=!0,this.currentState="up",this.addChangeEvent(this.list,this.listSelect),this.addTouchEvent(this,this.onTap),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this),this.dataPro=new eui.ArrayCollection,this.list.itemRenderer=DropDownListItem,this.list.dataProvider=this.dataPro},e.prototype.listSelect=function(t){this.value.text=this.list.selectedItem.name},e.prototype.removeStage=function(t){this.stage&&this.removeTouchEvent(this.stage,this.onTap)},e.prototype.onTap=function(t){this.currentState="up"==this.currentState?"down":"up",t.stopPropagation(),this.stage&&("down"==this.currentState?this.addTouchEvent(this.stage,this.onTap):this.removeTouchEvent(this.stage,this.onTap))
},e.prototype.setData=function(t){this.dataPro.replaceAll(t)},e.prototype.setSelectedIndex=function(t){this.list.selectedIndex=t},e.prototype.getSelectedIndex=function(){return this.list.selectedIndex},e.prototype.setLabel=function(t){this.value.text=t},e.prototype.getLabel=function(){return this.value.text},e.prototype.setEnabled=function(t){this.list.touchEnabled=t,this.list.touchChildren=t},e.prototype.getEnabled=function(){return this.list.touchEnabled},e.prototype.destructor=function(){this.list.removeEventListener(egret.Event.CHANGE,this.listSelect,this),this.removeTouchEvent(this,this.onTap),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this),this.removeStage()},e}(BaseComponent);__reflect(DropDown.prototype,"DropDown");var DropDownListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.nameLbl.text=this.data.name},e}(BaseItemRender);__reflect(DropDownListItem.prototype,"DropDownListItem");var EncounterInfoItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuInfoItem",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.nameTxt.text="",this.moneyTxt.text="",this.expTxt.text="",this.soulTxt.text="",this.challengeBtn.touchChildren=!1},e.prototype.updateTime=function(){},e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.currentState="have";var e=t.zsLv>0?1e3*t.zsLv:Math.min(t.lv,80),i=GlobalConfig.SkirmishRewardConfig[e];this.nameTxt.text=""+t.name,this.nameTxt0.text=""+(t.zsLv?t.zsLv+"转":"")+t.lv+"级",this.moneyTxt.text=i.rewards.gold+"",this.expTxt.text=i.rewards.exp+"",this.soulTxt.text=i.rewards.essence+"",this.face.source="head_"+t.subRole[0].job+t.subRole[0].sex,this.headBG.source="touxiangkuang"+t.subRole[0].sex,EncounterFight.ins().encounterIndex!=t.index?this.challengeBtn.label="挑 战":this.challengeBtn.label="挑战中"}else this.currentState="none",this.nameTxt0.text="暂无附近玩家"},e}(BaseItemRender);__reflect(EncounterInfoItem.prototype,"EncounterInfoItem");var EquipTipsBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="UsualEquipTipsSkin",e}return __extends(e,t),e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.func&&this.removeEventListener(egret.TouchEvent.TOUCH_END,this.func,this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.itemType=t[0],this.id=t[1],this.sco=t[2],this.power=t[3],this.desc=t[4],this.attrs=t[5],this.func=t[6],this.func?this.addEventListener(egret.TouchEvent.TOUCH_END,this.func,this):this.setHideButton();var i=GlobalConfig.ItemConfig[this.id];this.itemIcon.setData(i);var s=ItemConfig.getQuality(i);this.quali.source=s>0?"quali"+s:"",this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:"+ItemConfig.getQualityColor(i)+"&T:"+i.name),this.score.text="评分："+this.sco,this.typeName.textFlow=TextFlowMaker.generateTextFlow1(this.desc.left),this.typeValue.textFlow=TextFlowMaker.generateTextFlow1(this.desc.right),this.powerPanel.setPower(this.power);for(var n=0;n<this.attrs.length;n++){var o=new EquipTipsItemBase;o.data={title:this.attrs[n].title,attributeData:this.attrs[n].attr,colorName:this.attrs[n].colorName,colorValue:this.attrs[n].colorValue,others:this.attrs[n].others},this.content.addChild(o)}},e.prototype.setHideButton=function(){this.changeBtn.visible=!1},e}(BaseEuiView);__reflect(EquipTipsBase.prototype,"EquipTipsBase"),ViewManager.ins().reg(EquipTipsBase,LayerManager.UI_Popup);var EquipTipsItemBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="UsualEquipTipsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.title,e=this.data.colorName,i=this.data.colorValue,s=this.data.attributeData,n=this.data.others,o="",a="";n&&n.suitdesc||DisplayUtils.removeFromParent(this.desc1);for(var r=0;r<s.length;r++)o+=AttributeData.getAttrStrByType(s[r].type)+": \n",a+=s[r].type==AttributeType.atMaxHp||s[r].type==AttributeType.atAttack||s[r].type==AttributeType.atDef||s[r].type==AttributeType.atRes?s[r].value:s[r].value/100+"%",a+="\n";if(o){var h=o.lastIndexOf("\n");o=o.substring(0,h)}if(a){var h=a.lastIndexOf("\n");a=a.substring(0,h)}if(n&&n.exdesc){var l=n.exdesc.split("+");o+="\n"+l[0]+":",a+="\n"+l[1]}this.attrType.textFlow=TextFlowMaker.generateTextFlow1(t),this.attrName.textFlow=TextFlowMaker.generateTextFlow1(e?"|C:"+e+"&T:"+o:""+o),this.attrValue.textFlow=TextFlowMaker.generateTextFlow1(i?"|C:"+i+"&T:"+a:""+a),this.desc1&&this.desc1.parent&&(this.suit.textFlow=TextFlowMaker.generateTextFlow1(n.suitdesc))}},e}(BaseItemRender);__reflect(EquipTipsItemBase.prototype,"EquipTipsItemBase");var euiextension;!function(t){var e=function(t){function e(){var e=t.call(this)||this;e.btnBg=new egret.Shape,e.btnBg.touchEnabled=!0,e.btnBg.graphics.beginFill(0),e.btnBg.graphics.drawRect(0,0,480,410),e.btnBg.alpha=.6,e.addChild(e.btnBg);var s=new eui.Label;s.textColor=16777215,s.size=24,s.y=20,s.text="选择服务器地址",e.addChild(s),e.listIP=new eui.List,e.listIP.y=50,e.listIP.itemRenderer=i,e.scrollerIP=new eui.Scroller,e.scrollerIP.y=e.listIP.y,e.scrollerIP.height=400,e.scrollerIP.viewport=e.listIP,e.scrollerIP.bounces=!1,e.addChild(e.scrollerIP);var n=new eui.Label;return n.textColor=16777215,n.size=24,n.x=250,n.y=20,n.text="选择游戏资源地址",e.addChild(n),e.listRES=new eui.List,e.listRES.x=n.x,e.listRES.y=50,e.listRES.itemRenderer=i,e.scrollerRES=new eui.Scroller,e.scrollerRES.x=e.listRES.x,e.scrollerRES.y=e.listRES.y,e.scrollerRES.height=e.scrollerIP.height,e.scrollerRES.viewport=e.listRES,e.scrollerRES.bounces=!1,e.addChild(e.scrollerRES),e.addChangeEvent(e.listIP,e.setSelectIP),e.addChangeEvent(e.listRES,e.setSelectRES),e}return __extends(e,t),e.prototype.setDataIP=function(t){this.listIP.dataProvider=new eui.ArrayCollection(t);var e=parseInt(egret.localStorage.getItem("listIP"))||0;this.listIP.selectedIndex=e>t.length?0:e,this.setSelectIP()},e.prototype.setDataRES=function(t){this.listRES.dataProvider=new eui.ArrayCollection(t);var e=parseInt(egret.localStorage.getItem("listRES"))||0;this.listRES.selectedIndex=e>t.length?0:e,this.setSelectRES()},e.prototype.destructor=function(){this.listIP.removeEventListener(egret.Event.CHANGE,this.setSelectIP,this),this.listRES.removeEventListener(egret.Event.CHANGE,this.setSelectRES,this)},e.prototype.setSelectIP=function(){var t=this.listIP.selectedItem.split("|");LocationProperty.srvid=parseInt(t[1]);var e=t[2].split(":");LocationProperty.serverIP=e[0],LocationProperty.serverPort=parseInt(e[1]),egret.localStorage.setItem("listIP",this.listIP.selectedIndex.toString())},e.prototype.setSelectRES=function(){LocationProperty.resAdd=this.listRES.selectedItem.split("=")[1],egret.localStorage.setItem("listRES",this.listRES.selectedIndex.toString())},e}(BaseView);t.DropDownList=e,__reflect(e.prototype,"euiextension.DropDownList");var i=function(t){function e(){var e=t.call(this)||this,i='<?xml version="1.0" encoding="utf-8" ?><e:Skin xmlns:e="http://ns.egret.com/eui"></e:Skin>';return e.skinName=i,e.label=new eui.Label,e.label.textColor=3532333,e.label.size=12,e.label.y=10,e.addChild(e.label),e.height=23,e}return __extends(e,t),e.prototype.dataChanged=function(){this.label.text=this.data},Object.defineProperty(e.prototype,"selected",{set:function(t){this._selected!=t&&(this._selected=t,this.invalidateState(),t?this.label.textColor=15937822:this.label.textColor=3532333)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(i.prototype,"IPItemRenderer")}(euiextension||(euiextension={}));var FbItem=function(t){function e(){var e=t.call(this)||this;return e.isDouble=0,e.skinName="DailyFbItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.item.isShowName(!1),this.starValue=0},e.prototype.starSaoDang=function(t){void 0===t&&(t=0),this.isDouble=t,TimerManager.ins().doTimer(50,20,this.refushBar,this,this.overPlay,this),this.barGaroup.visible=!0,this.isDouble?(this.doublePrice.visible=!1,this.barGaroup.x=this.doublePrice.x):(this.price.visible=!1,this.barGaroup.x=this.price.x),this.bar.labelFunction=function(){return"扫荡中"}},e.prototype.refushBar=function(){this.isDouble?this.doubleChallengeBtn.enabled=!1:this.challengeBtn.enabled=!1,this.starValue+=7,this.bar.value=this.starValue},e.prototype.overPlay=function(){0!=this.starValue&&(this.barGaroup.visible=!1,this.isDouble?(this.doublePrice.visible=!0,this.doubleChallengeBtn.enabled=!0):(this.price.visible=!0,this.challengeBtn.enabled=!0),this.starValue=0,UserFb.ins().sendAddCount(this.data,this.isDouble))},e.prototype.dataChanged=function(){this.bg.source=this.data+"bg";var t=GlobalConfig.DailyFubenConfig[this.data];if(this.item.data=t.showItem,t.zsLevel>0){var e=t.zsLevel+"转开启",i=UserZs.ins().lv>=t.zsLevel;t.id==GlobalConfig.ZhanLingConfig.fbIndex&&(e="开服"+GlobalConfig.ZhanLingConfig.openserverday+"天并达到"+t.zsLevel+"转开启",i=UserZs.ins().lv>=t.zsLevel&&GameServer.serverOpenDay+1>=GlobalConfig.ZhanLingConfig.openserverday),this.levelRequire.text=i?"":e,this.currentState=i?"canChallenge":"noChallenge"}else this.levelRequire.text=t.levelLimit+"级开启",this.currentState=Actor.level>=t.levelLimit?"canChallenge":"noChallenge";this.levelRequire.visible=!0;var s=UserFb.ins().getFbDataById(this.data),n=s.getCount(),o=n>0?"#40D016":"#DFD1B5";this.redPoint.visible=n>0;var a=s.getResetCount();n>0?this.count.textFlow=(new egret.HtmlTextParser).parser('今日挑战次数：<font color="'+o+'">1次</font>'):(this.count.textFlow=(new egret.HtmlTextParser).parser('今日可扫荡次数：<font color="'+o+'">'+a+"次</font>"),this.redPoint.visible=DieGuide.ins().dieFbRedPoint(a,this.data)),this.price.visible=0==n&&"canChallenge"==this.currentState,Recharge.ins().franchise&&s.isPass?this.challengeBtn.label=n?"快速挑战":"扫  荡":UserZs.ins().lv>=t.sweepLevel&&s.isPass?this.challengeBtn.label=n?"快速挑战":"扫  荡":this.challengeBtn.label=n?"挑  战":"扫  荡",this.challengeBtn.name=n?"":"add",this.challengeBtn.enabled=!0,this.doublePrice.visible=this.doubleChallengeBtn.visible=!1,this.doubleChallengeBtn.name="double";var r=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];this.challengeBtn.filters=[],this.count.verticalCenter=-45,this.count.right=20;var h=s.getNextVip(),l=0,c=0,u=GlobalConfig.MonthCardConfig.sweepPrecent/100,p=Recharge.ins().monthDay>0?1-u:1;if(0==n){if(0>=a)switch(h){case-1:this.count.text="今日扫荡次数已经用完",this.count.verticalCenter=0,this.count.right=50,this.challengeBtn.visible=!1,this.price.visible=!1,this.doublePrice.visible=!1,this.levelRequire.visible=!1;break;default:UserVip.ins().lv<h?(this.count.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("VIP"+h,14942722)+"可额外扫荡1次"),this.challengeBtn.filters=[new egret.ColorMatrixFilter(r)],this.doubleChallengeBtn.enabled=this.challengeBtn.enabled=!1):(this.count.text="VIP"+h+"可额外扫荡1次",this.doubleChallengeBtn.enabled=this.challengeBtn.enabled=!0)}l=Math.floor(t.buyPrice[s.vipBuyCount]*p),this.price.setPrice(l),a>0&&t.buyDoublePrice&&(Actor.level>=t.levelLimit&&(this.doublePrice.visible=this.doubleChallengeBtn.visible=!0),t.buyDoublePrice&&(c=t.buyDoublePrice[s.vipBuyCount]*p,this.doublePrice.setPrice(c)))}else"canChallenge"==this.currentState&&(this.challengeBtn.visible=!0)},e}(BaseItemRender);__reflect(FbItem.prototype,"FbItem");var ForgeZhuItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CastingZBItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.bitmapNum=BitmapNumber.ins().createNumPic(0,"lv_"),this.addChild(this.bitmapNum),this.bitmapNum.x=this.num0.x,this.bitmapNum.y=this.num0.y,this.lockbitmapNum=BitmapNumber.ins().createNumPic(0,"lvk_"),this.unlock1.addChild(this.lockbitmapNum),this.lockbitmapNum.anchorOffsetX=this.lockbitmapNum.width/2,this.lockbitmapNum.anchorOffsetX=this.lockbitmapNum.height/2,this.lockbitmapNum.x=this.unlock1.x,this.lockbitmapNum.y=this.unlock1.y-10,this.unlock.addChild(this.lockbitmapNum),this.itemIcon.imgJob.visible=!1},e.prototype.onClick=function(t){},e.prototype.hideAdd=function(){this.add.visible=!1,this.bitmapNum.visible=!1},e.prototype.updateItem=function(t,e,i,s,n){void 0===n&&(n=!0),this.add.visible=i>0?!0:!1;var o=GlobalConfig.StoneOpenConfig[e];if(Actor.level>=o.openLv){var a=UserForge.ins().getStoneLevelCostConfigByLv(i+1),r=0;a&&(r=a.soulNum);var h=s>=r?!0:!1;this.state.visible=h,i>=80&&(this.state.visible=!1),BitmapNumber.ins().changeNum(this.bitmapNum,i,"lv_"),t?this.setItemImg(t.icon+"_png"):this.setItemImg("xb_"+(e+10).toString()),this.unlock.visible=!1,this.lockbitmapNum.visible=!1}else this.state.visible=!1,this.unlock.visible=!0,this.lockbitmapNum.visible=!0,this.add.visible=!1,this.setItemImg("xb_"+(e+10)),BitmapNumber.ins().changeNum(this.lockbitmapNum,o.openLv,"lvk_"),0!=Math.floor(o.openLv/100)||100==o.openLv?this.lockbitmapNum.x=this.unlock1.x-10:this.lockbitmapNum.x=this.unlock1.x-5;this.bitmapNum.visible=this.add.visible,n||(this.state.visible=!1)},e.prototype.setItemImg=function(t){this.itemIcon.imgIcon.source=t},e.prototype.setItemData=function(t){this.setItemImg(t.icon.toString()+"_png")},e.prototype.dataChanged=function(){this.updateItem(this.data.item,this.data.pos,this.data.lv,this.data.itemNum)},e}(BaseItemRender);__reflect(ForgeZhuItem.prototype,"ForgeZhuItem");var GuanqiaBossHead=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this._isSelect=!1,this._isFrameBig=!1,this.imgSelect.visible=!1,this.imgFrameBig.visible=!1,this.imgFrameLittle.visible=!0},e.prototype.setHeadSource=function(t){this.imgHead.source=t},e.prototype.setGray=function(t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];this.imgHead.filters=t?[new egret.ColorMatrixFilter(e)]:[]},e.prototype.setFrameBig=function(t){t!=this._isFrameBig&&(this._isFrameBig=t,this.imgFrameBig.visible=t,this.imgFrameLittle.visible=!t)},e.prototype.getFrameBig=function(){return this._isFrameBig},e.prototype.setSelect=function(t){t!=this._isSelect&&(this.imgSelect.visible=t,this._isSelect=t)},e.prototype.getSelect=function(){return this._isSelect},e}(BaseComponent);__reflect(GuanqiaBossHead.prototype,"GuanqiaBossHead");var GuanQiaEfficiencyPanel=function(t){function e(){var e=t.call(this)||this;return e.name="世界",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.initMap()},e.prototype.initMap=function(){this.boxs=[],this.maps=[],this.items=[];for(var t=0;t<e.MAP_COUNT;t++)this["item"+t].visible=!1;for(var t=0;t<e.MAP_COUNT;t++){var i=this["item"+t],s=GlobalConfig.WorldRewardConfig[t+1],n=GlobalConfig.WorldRewardConfig[t],o=0==t?0:n.needLevel+1;i.touchChildren=!0,i.visible=void 0!=s,i.nameTxt.text=s?""+s.name:"",i.levelLabel.text=o+"-"+s.needLevel+"章",this.items[t]=i,this.boxs[t]=i.box,this.maps[t]=this["map"+t]}},e.prototype.open=function(){for(var t=0,i=this.boxs;t<i.length;t++){var s=i[t];this.addTouchEvent(s,this.onTouchTap)}this.addTouchEvent(this.leftArrow,this.onTouchArrow),this.addTouchEvent(this.rightArrow,this.onTouchArrow),this.observe(UserFb.ins().postGuanqiaWroldReward,this.upDateGuanqiaWroldReward);var n=UserFb.ins().worldReward>e.MAP_ONE_COUNT-1;this.currentState=n?"map1":"map0",this.rightArrow.visible=n,this.update()},e.prototype.close=function(){for(var t=0,e=this.boxs;t<e.length;t++){var i=e[t];this.removeTouchEvent(i,this.onTouchTap)}this.removeTouchEvent(this.leftArrow,this.onTouchArrow),this.removeTouchEvent(this.rightArrow,this.onTouchArrow),this.removeObserve()},e.prototype.onTouchTap=function(t){var e=this.boxs.indexOf(t.currentTarget)+1;ViewManager.ins().open(GuanQiaWorldRewardWin,e)},e.prototype.onTouchArrow=function(t){this.currentState=t.currentTarget==this.leftArrow?"map0":"map1",this.update()},e.prototype.upDateGuanqiaWroldReward=function(){this.update()},e.prototype.update=function(){for(var t="map0"==this.currentState?0:e.MAP_TWO_COUNT-1,i="map0"==this.currentState?e.MAP_ONE_COUNT:this.items.length,s=UserFb.ins().worldReward;i>t;t++){var n=this.items[t],o=this.maps[t];n&&o&&(n.visible=s>=t,o.visible=s>=t,n.barGroup.visible=!1,n.box.visible=n.levelLabel.visible=n.redPointBox.visible=UserFb.ins().isReceiveBox(t+1))}var a=this.items[s],r=GlobalConfig.WorldRewardConfig[UserFb.ins().worldReward+1],h=GlobalConfig.WorldRewardConfig[UserFb.ins().worldReward];r&&a&&(a.box.visible=!0,a.barGroup.visible=!0,a.levelLabel.visible=!0,a.bar.value=UserFb.ins().guanqiaReward-(h?h.needLevel:0)-1,a.bar.maximum=h?r.needLevel-h.needLevel:r.needLevel)},e}(BaseComponent);GuanQiaEfficiencyPanel.MAP_COUNT=15,GuanQiaEfficiencyPanel.MAP_ONE_COUNT=7,GuanQiaEfficiencyPanel.MAP_TWO_COUNT=8,__reflect(GuanQiaEfficiencyPanel.prototype,"GuanQiaEfficiencyPanel");var GuanQiaMapItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CheckItemSkin",e}return __extends(e,t),e}(BaseComponent);__reflect(GuanQiaMapItem.prototype,"GuanQiaMapItem");var GuanQiaRewardPanel=function(t){function e(){var e=t.call(this)||this;return e.boxPass=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.reward=[];for(var t=0;5>t;t++)this.reward[t]=this["item"+t];var e="<font color='#20A208'><u>查看排行</u></font>";this.seeRank.textFlow=(new egret.HtmlTextParser).parser(e),this.bar.value=0,this.award.visible=!1,this.challengeBtn.visible=!0,this.mapImage.touchEnabled=!0,this.bar.slideDuration=0,this.headGroup.removeChildren()},e.prototype.open=function(){this.addTouchEvent(this.challengeBtn,this.onTouchTap),this.addTouchEvent(this.seeRank,this.onTouchTap),this.addTouchEvent(this.getawardBtn,this.onTouchTap),this.addTouchEvent(this.mapImage,this.onTouchTap),this.observe(GameLogic.ins().postEnterMap,this.upDataGuanqia),this.observe(UserFb.ins().postZhangJieAwardChange,this.upDataGuanqia),this.observe(UserFb.ins().postGuanqiaWroldReward,this.upDateGuanqiaWroldReward),this.observe(Rank.ins().postRankingData,this.updataFirstThree),Rank.ins().sendGetRankingData(RankDataType.TYPE_PASS),this.upDateGuanqiaWroldReward(),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.challengeBtn,this.onTouchTap),this.removeTouchEvent(this.seeRank,this.onTouchTap),this.removeTouchEvent(this.getawardBtn,this.onTouchTap),this.removeTouchEvent(this.mapImage,this.onTouchTap),this.removeObserve()},e.prototype.onTouchTap=function(t){switch(t.currentTarget){case this.challengeBtn:UserFb.ins().autoPk();break;case this.getawardBtn:for(var e=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward],i=e.rewards,s=0,n=0;n<i.length;n++)1==i[n].type&&i[n].id<2e5&&s++;UserBag.ins().getSurplusCount()>=s?UserFb.ins().sendGetAward():UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");break;case this.seeRank:Rank.ins().rankModel[RankDataType.TYPE_PASS]&&Rank.ins().rankModel[RankDataType.TYPE_PASS].getDataList().length>0?ViewManager.ins().open(FbAndLevelsRankWin,RankDataType.TYPE_PASS):UserTips.ins().showTips("|C:0xf3311e&T:排行榜暂时未开放|");break;case this.mapImage:ViewManager.ins().open(GuanQiaWorldRewardWin,UserFb.ins().getWorldGuanQiaBox())}},e.prototype.upDataGuanqia=function(){this.update()},e.prototype.upDateGuanqiaWroldReward=function(){this.boxPass=UserFb.ins().getWorldGuanQia(),this.redPointBox.visible=UserFb.ins().isReceiveBox(this.boxPass)},e.prototype.update=function(){var t=UserFb.ins().guanqiaID,e=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward],i=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward-1];e?(this.bar.maximum=i?e.needLevel-i.needLevel:e.needLevel,this.bar.value=t-(i?i.needLevel:0)-1,this.award.visible=this.bar.value==this.bar.maximum,this.info.visible=!this.award.visible,this.goldTxt0.text=UserFb.ins().goldEff+"/小时",this.expTxt0.text=UserFb.ins().expEff+"/小时",this.goldTxt1.text="",this.expTxt1.text=""):(e=i,this.award.visible=!1,this.info.visible=!0,this.goldTxt0.text="",this.expTxt0.text="",this.goldTxt1.text="",this.expTxt1.text=""),this.mapNameTxt.text="第"+e.id+"章 "+e.name,this.specialItem.data=e.rewards[0],this.specialItem1.data=e.rewards[0],"麻痹碎片"==this.specialItem1.getText()?this.labelInfo.text="麻痹戒指：每次攻击有几率麻痹敌人，使敌人无法攻击":"护身碎片"==this.specialItem1.getText()?this.labelInfo.text="护身戒指：被攻击时优先消耗魔法值抵消伤害":this.labelInfo.text="",this.desc.text="通关 "+e.name+" 所有关卡可获得特戒碎片奖励",this.rewardDesc.text="通关 "+e.name+" 全部关卡奖励",this.updateChallenge(),this.updataFirstThree(Rank.ins().rankModel[RankDataType.TYPE_PASS]),this.showChallengeGuide()},e.prototype.updateChallenge=function(){this.needWave.visible=!1,UserFb.ins().guanqiaID>=UserFb.ins().maxLen&&(this.challengeBtn.visible=!1,this.needWave.visible=!0,this.needWave.text="恭喜通关所有关卡")},e.prototype.showChallengeGuide=function(){UserFb.ins().guanqiaID<=1&&UserFb.ins().isShowBossPK()&&!UserFb.ins().bossIsChallenged},e.prototype.updataFirstThree=function(t){if(!t)return this.name0.text=this.name1.text=this.name2.text="暂无",void(this.harm0.text=this.harm1.text=this.harm2.text="0");if(t.type==RankDataType.TYPE_PASS)for(var e=0;4>e;e++){if(3==e)return this["rank"+e].text=0<t.selfPos&&t.selfPos<=1e3?t.selfPos+"":"未上榜",void(this["harm"+e].text=UserFb.ins().guanqiaID+"关");var i=t.getDataList(e);i?(this["name"+e].text=i[RankDataType.DATA_PLAYER],this["harm"+e].text=i[RankDataType.DATA_COUNT]+"关"):(this["name"+e].text="暂无",this["harm"+e].text="0")}},e}(BaseComponent);__reflect(GuanQiaRewardPanel.prototype,"GuanQiaRewardPanel");var GuildInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.isInit=!1,e.userGuild=Guild.ins(),e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.initUI()},e.prototype.initUI=function(){this.checkJoin.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.checkJoin.text+"</u></a>"),this.checkJoin.touchEnabled=!0,this.list.itemRenderer=GuildMemberItem1Render,this.eff=new MovieClip,this.eff.x=this.checkJoin.x+40,this.eff.y=this.checkJoin.y+10,this.isInit=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isInit||this.initUI(),this.addTouchEvent(this.checkJoin,this.onLinkApply),this.addTouchEvent(this.cityBtn,this.onTap),this.addTouchEvent(this.conBtn,this.onTap),this.addTouchEvent(this.rename,this.onTap),this.observe(Guild.ins().postGuildInfo,this.updateGuild),this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo),this.observe(Guild.ins().postChangeNotice,this.updateGuild),this.observe(Guild.ins().postGuildMoney,this.updateGuild),this.observe(Guild.ins().postApplyInfos,this.updateApplys),this.observe(Guild.ins().postJoinGuild,this.updateApplys),this.observe(Guild.ins().postGuildMembers,this.updateMember),this.updateApplys(),this.updateMyInfo(),this.updateGuild(),this.updateMember()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.conBtn:ViewManager.ins().open(GuildConWin);break;case this.cityBtn:ViewManager.ins().open(GuildNoticeWin);break;case this.rename:ViewManager.ins().open(GuildChangeNameView)}},e.prototype.updateMyInfo=function(){this.myCon.text=this.userGuild.myCon+"",this.checkJoin.visible=this.userGuild.myOffice>=GuildOffice.GUILD_FUBANGZHU,this.cityBtn.visible=this.userGuild.myOffice>=GuildOffice.GUILD_FUBANGZHU},e.prototype.updateGuild=function(){this.guildName.text=this.userGuild.guildName,this.guildLevel.text=this.userGuild.guildLv.toString(),this.guildMoney.text=this.userGuild.money.toString(),this.notice.text=this.userGuild.notice,this.rename.visible=Guild.ins().changeNameNum&&this.userGuild.myOffice>=GuildOffice.GUILD_BANGZHU},e.prototype.updateMember=function(){var t=GlobalConfig.GuildConfig,e=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0,i=e?GlobalConfig.GuildConfig.affairMember[e-1]:0;this.guildMember.text=this.userGuild.getMemberNum()+"/"+(t.maxMember[Guild.ins().guildLv-1]+i),this.list.dataProvider=new eui.ArrayCollection(this.userGuild.getGuildMembers(1))},e.prototype.onLinkApply=function(){ViewManager.ins().open(GuildApplyListWin)},e.prototype.updateApplys=function(){this.userGuild.hasApplys()?(this.checkJoin.parent.addChildAt(this.eff,this.getChildIndex(this.checkJoin)),this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.scaleX=.7,this.eff.scaleY=.7):DisplayUtils.removeFromParent(this.eff)},e}(BaseComponent);__reflect(GuildInfoPanel.prototype,"GuildInfoPanel");var GuildListPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=GuildListItem2Render},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Guild.ins().postGuildList,this.updateList),this.updateList(),this.pageChange(0)},e.prototype.pageChange=function(t){this.curPage!=t&&t>=0&&t<Guild.ins().pageMax&&(this.curPage=t,Guild.ins().sendGuildList(this.curPage,6))},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.ins().guildListInfos)},e}(BaseComponent);__reflect(GuildListPanel.prototype,"GuildListPanel");var GuildManagePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.buildList.itemRenderer=GuildBuildItemRender,this.messageList.itemRenderer=GuildEventItenRender},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||UserTips.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){this.addTouchEvent(this.buildList,this.onListTouch),this.observe(Guild.ins().postUpBuilding,this.updateList),this.observe(Guild.ins().postManageList,this.update),this.observe(Guild.ins().postGuildMoney,this.update),Guild.ins().sendManageList(),this.updateList()},e.prototype.close=function(){this.removeTouchEvent(this.buildList,this.onListTouch),this.removeObserve()},e.prototype.update=function(){this.messageList.dataProvider=new eui.ArrayCollection(Guild.ins().records)},e.prototype.updateList=function(){this.index=this.buildScroller.viewport.scrollV,this.buildList.dataProvider=new eui.ArrayCollection([GuildBuilding.GUILD_HALL,GuildBuilding.GUILD_LIANGONGFANG,GuildBuilding.GUILD_COMMENT,GuildBuilding.GUILD_SHOP]),this.refushBar()},e.prototype.refushBar=function(){TimerManager.ins().remove(this.refushBarList,this),TimerManager.ins().doTimer(100,1,this.refushBarList,this)},e.prototype.refushBarList=function(){TimerManager.ins().remove(this.refushBarList,this),this.buildScroller.viewport.scrollV=this.index},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;e.onTap(t.target)}},e}(BaseComponent);__reflect(GuildManagePanel.prototype,"GuildManagePanel");var GuildMemberPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=GuildMemberItem2Render,this.dataArr=new eui.ArrayCollection,this.list.dataProvider=this.dataArr},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.quitBtn,this.onTap),this.addTouchEvent(this.list,this.onListTouch),this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo),this.observe(Guild.ins().postGuildMembers,this.updateMember),this.updateMyInfo(),this.updateMember()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.quitBtn,this.onTap),this.removeTouchEvent(this.list,this.onListTouch),this.removeObserve()},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.parent;e.onTap(t.target)}},e.prototype.updateMember=function(){var t=Guild.ins().getGuildMembers(1);this.dataArr.replaceAll(t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.quitBtn:if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("工会战期间,不允许退出公会",function(){},this);if(Guild.ins().myOffice==GuildOffice.GUILD_BANGZHU&&Guild.ins().getMemberNum()>1)return void WarnWin.show("需要先进行禅让，才可退出行会",function(){},this);WarnWin.show("是否确定退出公会，\n退出后贡献值清0。\n公会技能继续生效。",function(){Guild.ins().sendQuitGuild()},this,null,null,"normal","center")}},e.prototype.updateMyInfo=function(){this.office.text=GuildLanguage.guildOffice[Guild.ins().myOffice],this.totalCon.text=Guild.ins().myTotalCon+""},e}(BaseComponent);__reflect(GuildMemberPanel.prototype,"GuildMemberPanel");var GuildTaskPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=GuildTaskItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.list,this.onListTouch),this.list.dataProvider=Guild.ins().guildTaskInfos},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.list,this.onListTouch),this.removeObserve()},e.prototype.onLink=function(){ViewManager.ins().open(VipWin)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.parent;e.onTap(t.target)}},e}(BaseComponent);__reflect(GuildTaskPanel.prototype,"GuildTaskPanel");var GwBossRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e._lastX=0,e._lastY=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastX=t.stageX,this._lastY=t.stageY,this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(t){MathUtils.getDistance(this._lastX,this._lastY,t.stageX,t.stageY)>20&&(this._move=!0)},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){var t,e=this.data,i=GlobalConfig.WorldBossConfig[e.id],s=1e3*UserZs.ins().lv+Actor.level,n=1e3*i.zsLevel[0]+i.level,o=s>=n;t=i.samsaraLv>0?i.showName:i.zsLevel[0]>0?i.zsLevel[0]+"转-"+i.zsLevel[1]+"转":i.level+"级",this.checkBoxs.visible=o,o&&(this.checkBoxs.selected=UserBoss.ins().getBossRemindByIndex(e.id)),this.txt.visible=!o,this.checkBoxs.name=e.id+"";var a=GlobalConfig.MonstersConfig[i.bossId];this.bossName.text=a.name,this.levelShow.text=t},e}(BaseItemRender);__reflect(GwBossRemindItem.prototype,"GwBossRemindItem");var HeirloomItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(this.clear(),this.data){this.data.icon&&(this.lv.visible=this.lvBg.visible=!1);var t=this.data.info;this.itemIcon.setData(t,this.data.pos,this.data.icon,this.data.uplevel),this.lv.visible=t?!0:!1,this.data.icon?(this.lvBg.visible=this.lv.visible=!1,this.skillname=this.data.skillname,this.skilldesc=this.data.skilldesc,this.equipName.visible=!1):(t&&t.lv>0?(this.lv.visible=!0,this.lv.source="heir_0"+t.lv):this.lv.visible=!1,this.lvBg.visible=this.lv.visible),t.name&&(this.equipName.text=t.name),this.data.uplevel&&this.setUpEff()}},e.prototype.cleanEff=function(){this.itemIcon.cleanEff()
},e.prototype.setTipsVisible=function(){this.itemIcon.imgRect.visible=!1,this.equipName.visible=!1},e.prototype.clear=function(){this.cleanEff()},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){},e.prototype.setSelectIconVisible=function(t){this.selectIcon.visible=t;var e=this.itemIcon.y;this.itemIcon.imgRect.visible||(e=this.itemIcon.y-5),this.selectIcon.y=e},e.prototype.setUpEff=function(){null==this.upEffect&&(this.upEffect=new MovieClip,this.upEffect.x=this.itemIcon.x+this.itemIcon.width/2,this.upEffect.y=this.itemIcon.y+this.itemIcon.height/2,this.addChild(this.upEffect)),this.upEffect.playFile(RES_DIR_EFF+"promoteeff",1)},e}(BaseItemRender);HeirloomItem.QUALITY_COLOR=[14868436,3532333,13779707,16741647,15937822,16767295],__reflect(HeirloomItem.prototype,"HeirloomItem");var HeirloomItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomItemIcon",e.imgRect.visible=!0,e}return __extends(e,t),e.prototype.setSkillData=function(t){this.imgRect.visible=!1,this.imgIcon.source=t},e.prototype.setData=function(t,e,i,s){if(void 0===s&&(s=!1),this.imgRect.visible=!0,null!=t&&((i||t.icon)&&(this.imgIcon.source=(i?i:t.icon)+"_png"),t.lv>0&&!i))return this.imgRect.visible=!1,null==this.effect&&(this.effect=new MovieClip,this.effect.x=this.imgBg.x+this.imgBg.width/2,this.effect.y=this.imgBg.y+this.imgBg.height/2-10,this.addChildAt(this.effect,this.getChildIndex(this.imgIcon)+1)),void this.effect.playFile(RES_DIR_EFF+"quaeff6",-1);if(i)t.lv>0?this.imgRect.visible=!1:this.imgRect.visible=!0;else{var n=GlobalConfig.HeirloomEquipConfig[e+1][1];this.imgIcon.source=n.icon+"_png"}},e.prototype.cleanEff=function(){DisplayUtils.removeFromParent(this.effect),this.effect=null},e.prototype.setUpEff=function(){null==this.upEffect&&(this.upEffect=new MovieClip,this.upEffect.x=this.imgBg.x+this.imgBg.width/2,this.upEffect.y=this.imgBg.y+this.imgBg.height/2-10,this.addChild(this.upEffect)),this.upEffect.playFile(RES_DIR_EFF+"promoteeff",1)},e.prototype.resumePlay=function(t){this.effect.play(-1)},e}(BaseComponent);__reflect(HeirloomItemIcon.prototype,"HeirloomItemIcon");var HejiPanel=function(t){function e(){var e=t.call(this)||this;return e.otherWhite="#D1C28F",e.colorWhite="#f8b141",e.colorGray="#444134",e.otherWhiteN=13746831,e.colorWhiteN=16298305,e.colorGrayN=4473140,e.unActTextArr=["装备3件符文大幅增强对玩家的伤害","装备5件符文大幅增强对怪物的伤害","装备8件符文大幅减少合击冷却时间"],e.jobId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.HejiSkillMc1=new MovieClip,this.HejiSkillMc1.x=207,this.HejiSkillMc1.y=316,this.Punchpre.addChild(this.HejiSkillMc1),this.HejiSkillMc2=new MovieClip,this.HejiSkillMc2.x=434,this.HejiSkillMc2.y=425,this.Punchpre.addChild(this.HejiSkillMc2),this.preViewText.textFlow=(new egret.HtmlTextParser).parser("<font color = '#23C42A'><u>"+this.preViewText.text+"</u></font>"),this.effArr=[];for(var t=0;8>t;t++)this["itemEff"+t]=new MovieClip,this["itemEff"+t].x=177,this["itemEff"+t].y=174,this["itemEff"+t].rotation=45*t,this["itemEff"+t].touchEnabled=!1,this.effArr.push(this["itemEff"+t]);this.jobId=SubRoles.ins().getSubRoleByIndex(0).job,this.mcSkillID="skill40"+this.jobId;var e=403+this.jobId;this.targetSkillID="skill"+e},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.UplevelBtn1,this.onClick),this.addTouchEvent(this.AttrBtn,this.onClick),this.addTouchEvent(this.punchtogether1,this.onClick),this.addTouchEvent(this.preViewText,this.onClick),this.addTouchEvent(this.skillitem,this.onClick),this.addTouchEvent(this.clickGroup,this.onClick),this.addTouchEvent(this.fenjieBtn,this.onClick),this.addTouchEvent(this.turnPunchForge,this.onClick),this.observe(UserSkill.ins().postHejiUpdate,this.setData),this.observe(UserSkill.ins().postHejiEquipChange,this.setData),this.observe(Actor.ins().postUpdateTogeatter,this.setData),this.observe(Actor.ins().postUpdateTogeatter,this.setRedPoint),this.observe(UserFb.ins().postGuanKaIdChange,this.setRedPoint),this.observe(UserBag.ins().postItemAdd,this.addItem),this.observe(UserBag.ins().postItemDel,this.setRedPoint),this.resetData(),this.setData(),this.setRedPoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.UplevelBtn1,this.onClick),this.removeTouchEvent(this.AttrBtn,this.onClick),this.removeTouchEvent(this.punchtogether1,this.onClick),this.removeTouchEvent(this.skillitem,this.onClick),this.removeTouchEvent(this.preViewText,this.onClick),this.removeTouchEvent(this.fenjieBtn,this.onClick),this.removeTouchEvent(this.turnPunchForge,this.onClick),this.removeAllEffect(),this.removeObserve(),TimerManager.ins().removeAll(this),this.PunchForge.visible=!1,this.PunchForge.close()},e.prototype.resetData=function(){this.validateNow();for(var t=1;9>t;t++)this["item"+t].data=null},e.prototype.addItem=function(){this.refushPanelInfo(),this.setRedPoint()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.UplevelBtn1:UserFb.ins().guanqiaID<UserSkill.ACTIVE_LEVEL?UserTips.ins().showTips("通关到第"+UserSkill.ACTIVE_LEVEL+"关开启"):(this.Activation.visible=UserSkill.ins().hejiLevel>0?!1:!0,UserSkill.ins().sendGrewUpHejiSkill());break;case this.AttrBtn:ViewManager.ins().open(PunchEquipAttrWin);break;case this.punchtogether1:ViewManager.ins().open(PunchExchangeWin);break;case this.skillitem:ViewManager.ins().open(PunchSkillTipsWin);break;case this.preViewText:ViewManager.ins().open(PunchExtShowWin);break;case this.fenjieBtn:ViewManager.ins().open(PunchResWin);break;case this.turnPunchForge:this.Activation.visible=!1,this.Punchpre.visible=!1,this.Punch.visible=!1,this.PunchForge.visible=!0,this.PunchForge.open()}},e.prototype.showActive=function(t){var e=t.isAct;if(e){var i=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel],s=i.skill_id,n=s[0].toString();Activationtongyong.show(0,"合击","j"+n+"_png")}},e.prototype.setRedPoint=function(){this.redPointEx.visible=UserSkill.ins().canExchange(),this.redPointSo.visible=UserSkill.ins().canSolve(),this.redPointAct.visible=UserSkill.ins().canAcitve(),this.redPointPf.visible=UserSkill.ins().getPunchForge().getRedPoint()},e.prototype.playSkillAnmi=function(){var t=this,e=egret.Tween.get(this.Punchpre);this.HejiSkillMc1.parent||this.Punchpre.addChild(this.HejiSkillMc1),this.HejiSkillMc1.playFile(""+RES_DIR_SKILLEFF+this.mcSkillID,1,null,!0),e.wait(1500).call(function(){t.HejiSkillMc2.parent||t.Punchpre.addChild(t.HejiSkillMc2),t.HejiSkillMc2.playFile(""+RES_DIR_SKILLEFF+t.targetSkillID,1,null,!0)},this)},e.prototype.setData=function(){SubRoles.ins().subRolesLen;return UserSkill.ins().hejiLevel<=0?(this.Activation.visible=!0,this.Punchpre.visible=!1,this.Punch.visible=!1,this.PunchForge.visible=!1,void(this.activeTipsTxt.text="闯关达到 第"+UserSkill.ACTIVE_LEVEL+"关 即可开启合击技能")):void(Actor.level>=UserSkill.HEJI_SHOW_LEVEL?(this.PunchForge.visible?this.Punch.visible=!1:(this.Punch.visible=!0,this.PunchForge.visible=!1),this.Activation.visible=!1,this.Punchpre.visible=!1,this.setPunchView(),this.setPunch2View(),this.refushPanelInfo(),this.checkShowEff()):this.setPunchpreView())},e.prototype.setPunchpreView=function(){TimerManager.ins().remove(this.playSkillAnmi,this),this.Activation.visible=!1,this.Punch.visible=!1,this.Punchpre.visible=!0,this.PunchForge.visible=!1,this.skillName.source="8000"+this.jobId+"_png";var t=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel],e=new SkillData(t.skill_id[this.jobId-1]);this.skillIcon.source=e.id+"_png",TimerManager.ins().doTimer(3e3,0,this.playSkillAnmi,this),this.playSkillAnmi()},e.prototype.checkShowEff=function(){var t=UserSkill.ins().equipListData,e=-1,i=t.length;if(!t||8==t.length){for(var s=0;i>s;s++){var n=t[s];if(!n||!n.itemConfig)return;if(-1==e)e=1e4*(n.itemConfig.zsLevel||0)+n.itemConfig.level;else{var o=1e4*(n.itemConfig.zsLevel||0)+n.itemConfig.level;if(e!=o)return void this.removeAllEffect()}}this.playAllEffect()}},e.prototype.setPunch2View=function(){var t=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel],e=new SkillData(t.skill_id[this.jobId-1]);this.skillitem.setData(e)},e.prototype.destructor=function(){},e.prototype.updateRedPoint=function(t){},e.prototype.refushPanelInfo=function(){for(var t=[],e=1;9>e;e++){this["item"+e].data=e-1;var i=UserSkill.ins().equipListData[e-1];t=0==t.length?i.att:AttributeData.AttrAddition(t,i.att)}this.powerPanel.setPower(this.countAllAttNum()),this.validateNow(),this.updateForge()},e.prototype.refushOne=function(t){this["item"+(t+1)].data=t,ViewManager.ins().isShow(PunchEquipChooseWin)&&ViewManager.ins().close(PunchEquipChooseWin),this.powerPanel.setPower(this.countAllAttNum())},e.prototype.countAllAttNum=function(){var t=UserSkill.ins().equipListData,e=0,i=t.length;if(t&&t.length<=0)return 0;for(var s=0;i>s;s++){var n=t[s];n&&n.configID&&(e+=n.point)}return e*SubRoles.ins().subRolesLen},e.prototype.playAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent||(this.effArr[t].playFile(RES_DIR_EFF+"hejizbjihuoeff",-1),this.EffectGroup.addChild(this["itemEff"+t]))},e.prototype.removeAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent&&DisplayUtils.removeFromParent(this["itemEff"+t])},e.prototype.setPunchView=function(){var t,e=UserSkill.ins().qimingAttrDic,i=0,s=0,n=0,o=0,a="",r="",h="";this.currText3.text="",this.currText5.text="",this.currText8.text="",this.nextText1.text="",this.nextText2.text="",this.nextText3.text="";var l=0,c=0;if(e&&CommonUtils.getObjectLength(e)>0){for(var u in e)for(var p in e[u])i=e[u][p].zslv,s=e[u][p].lv;n=i+1,o=80,t=GlobalConfig.TogetherHitEquipQmConfig[i][s],this.paserText("currText",t,e[1e4*i+s])}else this.currTitleText.text="无",this.currText0.text="",this.currText3.text="",this.currText5.text="",this.currText8.text="",i=0,s=60,n=1,o=80,t=GlobalConfig.TogetherHitEquipQmConfig[i][s],this.paserText("currText",t);for(var d=0;d<UserSkill.ins().equipListData.length;d++){var g=UserSkill.ins().equipListData[d].itemConfig;if(g){var f=g.zsLevel?g.zsLevel:0,v=g.level?g.level:1;f>=i&&v>=s?(r=this.colorWhite,l++):r=this.colorGray,f>=n&&v>=o?(h=this.colorWhite,c++):h=this.colorGray}else r=h=this.colorGray;a+="<font color="+r+">"+Role.hejiPosName[d]+"  </font>"}this.currTitleText.text=i>0?i+"转齐鸣套装 ("+l+"/8)":s+"级齐鸣套装 ("+l+"/8)",this.currText0.textFlow=(new egret.HtmlTextParser).parser(a),this.preViewText.x=this.currTitleText.x+this.currTitleText.textWidth+10},e.prototype.paserText=function(t,e,i){void 0===i&&(i=null);var s={},n=UserSkill.ins().equipListData,o=0,a={};for(var r in n)if(0!=n[r].configID){var h=n[r].itemConfig,l=1e4*(h.zsLevel||0)+h.level;s[l]||(s[l]=0),s[l]+=1,o++,a[l]=ItemConfig.getQualityColor(h)}var c=0;for(var u in s)c=s[u],s[u]=o,o-=c;var p={},d=GlobalConfig.TogetherHitEquipQmConfig;for(var g in d)for(var l in d[g]){for(var f in s)if(Number(f)==1e4*Number(g)+Number(l)){var v=void 0;for(var y in d[g][l]){var m="";if(s[f]>=Number(y))m=Number(g)?"|C:"+a[f]+"&T:"+g+"转"+y+"件套:|C:"+this.otherWhiteN+"&T:"+d[g][l][y].desc:"|C:"+a[f]+"&T:"+l+"级"+y+"件套:|C:"+this.otherWhiteN+"&T:"+d[g][l][y].desc,p[y]=m,v=TextFlowMaker.generateTextFlow1(m);else if(!p[y]){var T=GlobalConfig.TogetherHitEquipQmConfig;for(var b in T){for(var C in T[b]){m="|C:"+a[f]+"&T:"+C+"级"+y+"件套:|C:"+this.otherWhiteN+"&T:"+d[b][C][y].desc,v=TextFlowMaker.generateTextFlow1(m);for(var I=0,w=v;I<w.length;I++){var _=w[I];_.style&&delete _.style.textColor}this[""+t+y].textColor=this.colorGrayN;break}break}}m&&(this[""+t+y].textFlow=v)}break}break}},e.prototype.updateForge=function(){this.turnPunchForge.visible=UserSkill.ins().getPunchForge().isShowPunchEquipForge()},e}(BaseView);__reflect(HejiPanel.prototype,"HejiPanel");var HejiProgressItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=UserSkill.ins().hejiProgressList[this.itemIndex];t&&(this.descLab.text=this.data.j+"",this.nameLab.text=this.data.t+"",this.label0.text="("+t.progress+"/"+this.data.v+")",this.goBtn0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this))},e}(BaseItemRender);__reflect(HejiProgressItem.prototype,"HejiProgressItem");var HomeBossRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(){this._move=!0},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){var t,e=this.data,i=GlobalConfig.WorldBossConfig[e.id];for(var s in GlobalConfig.BossHomeConfig)if(-1!=GlobalConfig.BossHomeConfig[s].boss.lastIndexOf(e.id)){t=GlobalConfig.BossHomeConfig[s];break}var n=!1;t&&UserVip.ins().lv>=t.vip?(n=i.zsLevel>0?UserZs.ins().lv>=i.zsLevel:Actor.level>=i.level,n||(this.txt.text="未满足挑战等级"),this.levelShow.text=i.zsLevel>0?i.zsLevel+"转":i.level+"级"):(n=!1,this.levelShow.text="",this.txt.text="未满足挑战VIP等级"),this.checkBoxs.visible=n,n&&(this.checkBoxs.selected=UserBoss.ins().getBossRemindByIndex(e.id)),this.txt.visible=!this.checkBoxs.visible,this.checkBoxs.name=e.id+"";var o=GlobalConfig.MonstersConfig[i.bossId];this.bossName.text=o.name},e}(BaseItemRender);__reflect(HomeBossRemindItem.prototype,"HomeBossRemindItem");var HonorMarketItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.goodsID=0,e.skinName="HonorMarketItemSkin",e.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e),e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t&&t instanceof FeatsStore){this.goodsID=t.goods[0].id;var e=GlobalConfig.ItemConfig[this.goodsID];if(e)if(this.isShowTips=!1,t.shopType==FEATS_SHOP_TYPE.Money?(this.money.text=t.costMoney.count+"",this.moneyIcon.source="ZSchip"):t.shopType==FEATS_SHOP_TYPE.Item&&(this.money.text=t.costItem.count+"",this.moneyIcon.source="204076_png"),this.itemName.text=e.name,this.itemName.textColor=ItemConfig.getQualityColor(e),this.num.text=t.goods[0].count+"",this.itemIcon&&this.itemIcon.setData&&this.itemIcon.setData(e),t.use&&(this.usage.text="（"+t.use+"）"),t.buyType==FEATS_TYPE.forever){this.myTimes.visible=!0;var i=Shop.ins().medalData.exchangeCount[t.index];i=i?i:0;var s=this.myTimes.textColor,n=void 0,o="";t.daycount&&(i>=t.daycount?(n=ColorUtil.RED,o="永久限购:|C:"+n+"&T:"+i+"/"+t.daycount):(n=ColorUtil.GREEN,o="永久限购:|C:"+n+"&T:"+i+"|/|C:"+s+"&T:"+t.daycount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o)}else if(t.buyType==FEATS_TYPE.infinite)this.myTimes.visible=!1;else if(t.buyType==FEATS_TYPE.day){this.myTimes.visible=!0;var i=Shop.ins().medalData.exchangeCount[t.index];i=i?i:0;var s=this.myTimes.textColor,n=void 0,o="";t.daycount&&(i>=t.daycount?(n=ColorUtil.RED,o="每日限购:|C:"+n+"&T:"+i+"/"+t.daycount,this.isShowTips=!0):(n=ColorUtil.GREEN,o="每日限购:|C:"+n+"&T:"+i+"|/|C:"+s+"&T:"+t.daycount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o)}}},e.prototype.onClick=function(){return this.isShowTips?void UserTips.ins().showTips("|C:16711680&T:今日已无兑换次数，请明日再来"):void(this.data.shopType==FEATS_SHOP_TYPE.Money?ViewManager.ins().open(BuyWin,this.data.index,2):this.data.shopType==FEATS_SHOP_TYPE.Item&&ViewManager.ins().open(BuyWin,this.data.index,3))},e.prototype.showTip=function(){var t,e=GlobalConfig.FeatsStore;for(var i in e)e[i].goods[0].id==this.goodsID&&(t=e[i].goods[0].id);void 0==t&&new Error("竟然没有找到该商品ID");var s=GlobalConfig.ItemConfig[t],n=this.data;ViewManager.ins().open(ItemDetailedWin,0,s.id,n.goods[0].count)},e}(BaseItemRender);__reflect(HonorMarketItemRenderer.prototype,"HonorMarketItemRenderer");var GuideMaskBackgroud=function(t){function e(){var e=t.call(this)||this;return e._stageWidth=0,e._stageHeight=0,e._bgs=new Array,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.init=function(t,e){this._stageWidth=t,this._stageHeight=e},e.prototype.draw=function(t){this.cacheAsBitmap=!1,this._deductRec=t,this.removeAllChild();var e=Math.max(t.x,0),i=Math.max(t.y,0),s=Math.min(t.x+t.width,this._stageWidth),n=Math.min(t.y+t.height,this._stageHeight);this.addBg(0,0,this._stageWidth,i),this.addBg(0,i,e,t.height),this.addBg(s,i,this._stageWidth-s,t.height),this.addBg(0,n,this._stageWidth,this._stageHeight-n),this.width=this._stageWidth,this.height=this._stageHeight,this.cacheAsBitmap=!0},e.prototype.destroy=function(){this.removeChildren(),this._bgs=[]},e.prototype.removeAllChild=function(){for(;this.numChildren;){var t=this.removeChildAt(0);this._bgs.push(t)}},e.prototype.addBg=function(t,e,i,s){var n;this._bgs.length?(n=this._bgs.pop(),n.graphics.clear()):n=new egret.Shape,n.graphics.beginFill(0,.5),n.graphics.drawRect(t,e,i,s),n.graphics.endFill(),this.addChild(n)},e.prototype.hitTest=function(t,e,i){return this._deductRec&&this._deductRec.contains(t,e)?null:this},e}(egret.Sprite);__reflect(GuideMaskBackgroud.prototype,"GuideMaskBackgroud");var ItemBaseNoName=function(t){function e(){var e=t.call(this)||this;return e.isShowName(!1),e}return __extends(e,t),e}(ItemBase);__reflect(ItemBaseNoName.prototype,"ItemBaseNoName");var ItemBaseNoTap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onClick=function(){},e}(ItemBase);__reflect(ItemBaseNoTap.prototype,"ItemBaseNoTap");var ItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemIconSkin",e}return __extends(e,t),e.prototype.setSoul=function(t){this.tag.visible=t},e.prototype.setData=function(t){if(this.config=t,null!=t){this.setIconfix(t),this.imgIcon.source=t.icon+"_png",this.imgBg.source="quality"+ItemConfig.getQuality(t);var e=ItemConfig.getType(t),i=ItemConfig.getJob(t);this.imgJob.source=(0==e||4==e)&&i&&this.imgJob.visible?"job"+i+"Item":"",GlobalConfig.ClientGlobalConfig.effectItems.indexOf&&GlobalConfig.ClientGlobalConfig.effectItems.indexOf(t.id)>=0?(null==this.effect&&(this.effect=new MovieClip,this.effect.x=35,this.effect.y=35,this.addChildAt(this.effect,2),this.effect.addEventListener(egret.Event.ADDED_TO_STAGE,this.resumePlay,this)),this.effect.playFile(RES_DIR_EFF+"quality_0"+ItemConfig.getQuality(t))):null!=this.effect}else this.imgIcon.source="",this.imgBg.source="quality0",this.imgJob.source="",null!=this.effect},e.prototype.setIconfix=function(t){switch(t.id){case 200136:t.icon=200136}},e.prototype.resumePlay=function(t){this.effect.play(-1)},e.prototype.setActived=function(t){this.actived.visible=t},e.prototype.setImgBg1=function(t){this.imgBg1.visible=!0,this.imgBg.visible=!this.imgBg1.visible,t&&(this.imgBg1.source=t)},e}(BaseComponent);__reflect(ItemIcon.prototype,"ItemIcon");var shop=GameSystem.shop,ItemShopItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.goodsID=0,e.skinName="ItemShopItem",e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ItemConfig[t.itemId];this.goodsID=t.id;var i="";if(i=t.price>1e5?Math.floor(t.price/1e4)+"万":t.price+"",this.money.text=i,this.itemName.text=e.name,this.itemName.textColor=ItemConfig.getQualityColor(e),this.used.text="（"+t.use+"）",this.used.x=this.itemName.x+this.itemName.width,t.viplv&&UserVip.ins().lv<t.viplv)this.num.visible=!0,this.num.text="VIP"+t.viplv+"可购买";else if(t.vipLimit){var s=Shop.ins().shopData.getHadBuyCountItem(t.itemId),n=0;s&&(n=s.count);var o=t.vipLimit[UserVip.ins().lv];this.num.text="今日可购买"+(o-n)+"次",this.num.visible=!0}else this.num.visible=!1;this.itemIcon&&this.itemIcon.setData&&this.itemIcon.setData(e)},e.prototype.showTip=function(){var t,e=GlobalConfig.ItemStoreConfig;for(var i in e)e[i].id==this.goodsID&&(t=e[i].itemId);void 0==t&&new Error("竟然没有找到该商品ID");var s=GlobalConfig.ItemConfig[t];ViewManager.ins().open(ItemDetailedWin,0,s.id,1)},e}(BaseItemRender);__reflect(ItemShopItemRenderer.prototype,"ItemShopItemRenderer");var ItemStage=function(t){function e(){var e=t.call(this)||this;return e.skinName="LvSkin",e}return __extends(e,t),e.prototype.convert=function(t){for(var e=0;e<t.length;e++)t[e]=StringUtils.NumberToChinese(Number(t[e]));return t},e.prototype.dataChanged=function(){if(this.data&&"string"==typeof this.data){var t=StringUtils.getStrByRegExp(this.data),e=StringUtils.getStrByRegExp(this.data,/[\u4E00-\u9FA5]+/g),i="",s=[],n=[],o=this.data.indexOf(t[0]),a=this.data.indexOf(e[0]);o>=0&&a>=0?a>o?(s=this.convert(t),n=e):(s=e,n=this.convert(t)):s=-1==o?e:this.convert(t);for(var r=0;r<s.length;r++)i+=s[r],n[r]&&(i+=n[r]);this.lv0.text=i}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(ItemStage.prototype,"ItemStage");var JingMaiPanel=function(t){function e(){var e=t.call(this)||this;return e.cursorLocation=[[132,131],[92,186],[165,177],[138,252],[84,231],[96,316],[152,339],[126,431]],e.curRole=0,e.canClick=!0,e.name="经脉",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.danItemID=GlobalConfig.JingMaiCommonConfig.levelItemid,this.cursor=new MovieClip,this.cursor.visible=!1},e.prototype.open=function(){this.addTouchEvent(this.boostBtn,this.onTap),this.addTouchEvent(this.bigUpLevelBtn,this.onTap),this.observe(UserJingMai.ins().postUpdate,this.setForgeData),this.observe(UserBag.ins().postItemAdd,this.setForgeData),this.cursor.playFile(RES_DIR_EFF+"jingmaiCursor",-1),this.setForgeData(!1)},e.prototype.close=function(){this.removeTouchEvent(this.boostBtn,this.onTap),this.removeTouchEvent(this.bigUpLevelBtn,this.onTap),this.canClick=!0,this.removeObserve()},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.boostBtn:var i=GlobalConfig.JingMaiLevelConfig[this._data.level];if(!this.canClick)return;this._data.level%10==0&&this._data.level/10>this._data.stage&&0!=this._data.level?(this.canClick=!1,this.showUpgradeEffect(),TimerManager.ins().doTimer(1e3,1,function(){UserJingMai.ins().sendUpgrade(e.curRole),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP),e.canClick=!0},this)):UserBag.ins().getBagGoodsCountById(0,i.itemId)>=i.count?(UserJingMai.ins().sendBoost(this.curRole),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)):UserWarn.ins().setBuyGoodsWarn(i.itemId);break;case this.bigUpLevelBtn:var s=GlobalConfig.ItemConfig[this.danItemID].name;WarnWin.show("确定使用"+s+"提升当前经脉吗？\n说明：\n"+GlobalConfig.JingMaiCommonConfig.levelItemidStage+"阶及以下经脉使用可直升1阶\n其他等阶使用转换为"+GlobalConfig.JingMaiCommonConfig.levelItemChange+"个"+GlobalConfig.ItemConfig[GlobalConfig.JingMaiCommonConfig.itemid].name,function(){UserJingMai.ins().sendBigUpLevel(e.curRole)},this)}},e.prototype.showLight=function(t,e){},e.prototype.showUpgradeEffect=function(){for(var t=0;9>=t;t++)this["jinmai_"+t].setLights(4)},e.prototype.setForgeData=function(t){void 0===t&&(t=!0),this._data=SubRoles.ins().getSubRoleByIndex(this.curRole).jingMaiData;var e=GlobalConfig.JingMaiStageConfig[this._data.stage],i=GlobalConfig.JingMaiLevelConfig[this._data.level];this.jinmaiStage.setValue(e.level),this.jinMaiName.text=e.name,this.attr.text=AttributeData.getAttStr(AttributeData.AttrAddition(e.attr,i.attr),.75),this._totalPower=UserBag.getAttrPower(AttributeData.AttrAddition(e.attr,i.attr)),this.powerPanel.setPower(this._totalPower);var s=this._data.level/10-e.stage;if(e.stage<GlobalConfig.JingMaiCommonConfig.stageMax){var n=void 0,o=void 0,a=UserBag.ins().getBagGoodsCountById(0,i.itemId);if(this.redPoint0.visible=a>=i.count,this._data.level>0&&this._data.level%10==0&&s?(n=GlobalConfig.JingMaiStageConfig[this._data.stage+1],o=i):(n=e,o=GlobalConfig.JingMaiLevelConfig[this._data.level+1]),0==this.nextAttr.visible&&(this.nextAttr.visible=!0,this.countLabel.x=2,this.countLabel.y=497),this.nextAttr.text=AttributeData.getAttStr(AttributeData.AttrAddition(n.attr,o.attr),0,1,"+",!1,!0),this.boostBtn.visible=!0,this._data.level>0&&this._data.level%10==0&&s)this.boostBtn.label="升  阶",this.countLabel.text="经脉等级已满,可进阶",this.cursor.visible=!1;else{this.boostBtn.label="冲  脉";var r="";r=a>=i.count?"|C:0x35e62d&T:":"|C:0xf3311e&T:",this.countLabel.textFlow=TextFlowMaker.generateTextFlow("消耗经脉丹:"+r+a+"|/"+i.count)}this.cursor.x=this.cursorLocation[this._data.level%8][0],this.cursor.y=this.cursorLocation[this._data.level%8][1],this.showLight(this._data.level,s)}else this.nextAttr.visible=!1,this.boostBtn.visible=!1,this.countLabel.x=this.nextAttr.x-60,this.countLabel.y=this.nextAttr.y,this.redPoint0.visible=!1,this.cursor.parent&&this.removeChild(this.cursor),this.countLabel.text="经脉已满阶";for(var h=0;9>h;h++)this["nadis"+h].source="jingmailine"+(1==s||h+1<this._data.level%10?"1":"2");for(var l,c=!0,h=0;9>=h;h++)l=this["jinmai_"+h],l.item.visible=1==s||h+1<=this._data.level%10?!0:!1,l.bgImg.visible=!l.item.visible,l.item.visible?l.setLights(2):(t&&c&&h-1>=0&&this["jinmai_"+(h-1)].setLights(3),l.setLights(c?1:0),c=!1);var u=UserBag.ins().getBagGoodsCountById(0,this.danItemID);this.bigUpLevelBtn.redPoint&&(this.bigUpLevelBtn.redPoint.visible=u>0),this.bigUpLevelBtn.txt&&(this.bigUpLevelBtn.txt.text=u)},e}(BaseView);__reflect(JingMaiPanel.prototype,"JingMaiPanel");var JimMaiItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="JinMaiItemSkin",e.guang.visible=!1,e}return __extends(e,t),e.prototype.setLights=function(t){var e=this;if(0==t&&this.mc)return this.mc.stop(),void(this.mc.visible=!1);if(null==this.mc&&(this.mc=new MovieClip,this.mc.x=this.mc.y=20,this.addChild(this.mc)),this.mc.visible=!0,this.mc.parent||this.addChild(this.mc),1==t)this.mc.playFile(RES_DIR_EFF+"bally1",-1);else if(2==t)this.mc.playFile(RES_DIR_EFF+"bally2",-1);else if(3==t){var i=egret.Tween.get(this);this.mc.playFile(RES_DIR_EFF+"bally3",1,null,!1),i.wait(800).call(function(){e.mc.playFile(RES_DIR_EFF+"bally2",-1)})}else 4==t&&this.mc.playFile(RES_DIR_EFF+"bally3",1,function(){DisplayUtils.removeFromParent(e.mc),e.mc=null},!0)},e}(BaseComponent);__reflect(JimMaiItem.prototype,"JimMaiItem");var LadderStarListView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.skinName="LadderSratListSkin",this.level.anchorOffsetX=10,this.level.anchorOffsetY=14,this.level.x=100,this.level.y=141},e.prototype.setLvAndRank=function(t){return void 0==t?(this.dwImg.source="ladder_rank_0",void(this.level.source=null)):(this.dwImg.source="ladder_rank_"+t.level,void(t.level>=4||t.showDan<=0||t.showDan>5?this.level.source=null:this.level.source="laddergradnum_"+t.showDan))},e.prototype.updataStarInfo=function(t,e){if(void 0===e&&(e=!0),t){this.len=Ladder.ins().getStatuByLevel(t.level);for(var i=1;5>=i;i++)this["star"+i].currentState=i>t.showStar?"black":"light"}else this.len=0;this.currentState=this.len+"",this.setLvAndRank(t)},e.prototype.upStarStatu=function(t,e,i){var s=this;void 0===i&&(i=!1);var n=e,o=i?t:t-1,a=this;0>=o&&(o=1),void 0==this.mc&&(this.mc=new MovieClip);var r=this["star"+o];this.mc.x=r.x+22,this.mc.y=r.y+22,this.addChild(this.mc);var h=this.len;if(i?(--n,this.mc.playFile(RES_DIR_EFF+"addstar",1,function(){-1!=a.getChildIndex(a.mc)&&a.removeChild(a.mc),r.currentState="light",h==o&&(r.currentState="black"),n>0&&o<s.len&&s.upStarStatu(++o,n,i)})):(--n,--o,this.mc.playFile(RES_DIR_EFF+"minusstar",1,function(){if(-1!=a.getChildIndex(a.mc)&&a.removeChild(a.mc),r.currentState="black",0==o){var t=ViewManager.ins().getView(LadderResultWin);t&&t.isShow()&&t.cheackIsChangeLevel(n),s.upSign=!1}}),n=0),i&&o==this.len){var l=ViewManager.ins().getView(LadderResultWin);l&&l.isShow()&&l.cheackIsChangeLevel(n),this.upSign=!0}},e.prototype.showLvUp=function(t){this.numLevel=t},e.prototype.showRankUp=function(t){this.numRank=t,this.rankMc=new MovieClip,this.rankMc.x=100,this.rankMc.y=99,this.rankMc.playFile(RES_DIR_EFF+"ladderlvup",1,this.RankChangeCallback.bind(this)),this.addChild(this.rankMc)},e.prototype.showLvDown=function(t){this.numLevel=t,this.level.source="laddergradnum_"+this.numLevel},e.prototype.RankChangeCallback=function(){this.dwImg.source="ladder_rank_"+this.numRank;var t=egret.Tween.get(this.dwImg);this.dwImg.alpha=0,t.to({alpha:1},700)},e}(BaseComponent);__reflect(LadderStarListView.prototype,"LadderStarListView");var LadderStarView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e}(BaseComponent);__reflect(LadderStarView.prototype,"LadderStarView");var LevelImage=function(t){function e(){var e=t.call(this)||this;return e._value=1,e.skinName="jiejiSkin",e}return __extends(e,t),e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(t){0>=t&&(t=1),this._value=t;var e=t+"";10>=t?(this.currentState="1",this.num1.source="jieji0"+e+"_png"):20>=t||t%10==0?(this.currentState="2","1"==e.charAt(0)?(this.num21.source="jieji010_png",this.num22.source="jieji0"+e.charAt(1)+"_png"):(this.num21.source="jieji0"+e.charAt(0)+"_png",this.num22.source="jieji010_png")):100>t&&(this.currentState="3",this.num31.source="jieji0"+e.charAt(0)+"_png",this.num32.source="jieji010_png",this.num33.source="jieji0"+e.charAt(1)+"_png")},e}(BaseComponent);__reflect(LevelImage.prototype,"LevelImage");var MijiItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.addImg.visible=!1,this.itemLock.visible=!1,this.unlearn.visible=!1,null==this.data)this.lock.visible=!0,this.icon.source="",this.setUnlearn(!1);else if(this.data instanceof ItemData)this.lock.visible=!1,this.icon.source=this.data.itemConfig.icon+"_png",this.count.text=this.data.count+"",this.icon.visible=!0;else if(!isNaN(this.data.id)||!isNaN(this.data)){var t=!isNaN(this.data.id);this.lock.visible=!1,this.count.text="";var e=void 0;if(t?(this.itemLock.visible=this.data.isLocked,e=this.data.id):e=this.data,GlobalConfig.MiJiSkillConfig[e]){var i=GlobalConfig.MiJiSkillConfig[e].item,s=GlobalConfig.ItemConfig[i];s&&(this.icon.source=s.icon+"_png"),this.icon.visible=!0}else this.icon.source=""}this.select.visible=!1},e.prototype.setCountLabel=function(t){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#9f946d'>"+(t+1)+"转开启</font>"),this.count.visible=!0},e.prototype.showSelect=function(){this.lock.visible=!1,this.icon.source="",this.addImg.visible=!1,this.select.visible=!0},e.prototype.setSelected=function(t){this.select.visible=t},e.prototype.setUnlearn=function(t){this.unlearn.visible=t},e.prototype.showAdd=function(){this.data=null,this.lock.visible=!1,this.icon.source="",this.addImg.visible=!0,this.redPoint.visible=UserMiji.ins().isMjiSum()},e}(BaseItemRender);__reflect(MijiItem.prototype,"MijiItem");var MijiPanel=function(t){function e(){var e=t.call(this)||this;return e.isTween=!1,e.curRole=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.change.textFlow=(new egret.HtmlTextParser).parser("<u>秘籍置换</u>"),this.mijiBtns=[this.mijiBtn0,this.mijiBtn1,this.mijiBtn2,this.mijiBtn3,this.mijiBtn4,this.mijiBtn5,this.mijiBtn6,this.mijiBtn7,this.select],this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"chargeff1"),this.eff.x=278,this.eff.y=500,this.eff.scaleX=.7},e.prototype.destructor=function(){},e.prototype.setCurRole=function(t){if(this.curRole!=t&&(this.curRole=t,this.isTween)){UserMiji.ins().sendMijiwancheng(this.roleID),this.isTween=!1;
for(var e=0;8>e;e++)egret.Tween.removeTweens(this["imageSmall_"+(e+1)])}},e.prototype.setData=function(){for(var t=this,e=UserMiji.ins(),i=!0,s=0;8>s;s++){this["imageMax_"+(s+1)].visible=!1;var n=void 0;if(ErrorLog.Assert(e.miji,"MijiPanel   data.miji is null"))this.mijiBtns[s].data=null;else if(n=e.miji[this.curRole],ErrorLog.Assert(n,"MijiPanel   numList is null  roleId = "+this.curRole))this.mijiBtns[s].data=null;else{var o=n[s]?0==n[s].id?!1:!0:!1;this["imageMax_"+(s+1)].visible=o,this.mijiBtns[s].data=n[s]?n[s]:null,n[s]||i&&(this.mijiBtns[s].setCountLabel(s),i=!1)}}this.learnLabel.visible=!1,this.learnImg.visible=!1,e.miji[this.curRole].forEach(function(e){e.id>0&&(t.learnLabel.visible=!0,t.learnImg.visible=!0)}),this.powerPanel.setPower(e.getPowerByRole(this.curRole))},e.prototype.updateEff=function(){this.select.addImg.visible?DisplayUtils.removeFromParent(this.mc):this.playEff()},e.prototype.playEff=function(){this.mc||(this.mc=new MovieClip),this.mc.parent||(this.btnAct.addChildAt(this.mc,1),this.mc.x=this.getBtn.x+this.getBtn.width/2,this.mc.y=this.getBtn.y+this.getBtn.height/2),this.mc.playFile(RES_DIR_EFF+"chargeff1",-1)},e.prototype.playArrow=function(){this._arrow||(this._arrow=new GuideArrow2),this._arrow.parent||this.arrow.addChild(this._arrow),this._arrow.x=0,this._arrow.setTips("点击镶嵌秘籍"),this._arrow.setDirection(0)},e.prototype.stopArrow=function(){this._arrow&&this._arrow.removeTweens(),DisplayUtils.removeFromParent(this._arrow),this._arrow=null},e.prototype.setOpenDesc=function(){var t=GlobalConfig.MiJiGridConfig[UserMiji.ins().grid+1];t||(this.curZsLv.visible=!1)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setOpenDesc(),this.setData(),this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.change,this.onTap),this.addTouchEvent(this.mijitujian,this.onTap),this.addTouchEvent(this.all,this.onTap),this.addTouchEvent(this.btnLock,this.onTap);for(var i in this.mijiBtns)this.addTouchEvent(this.mijiBtns[i],this.onTap);this.observe(UserMiji.ins().postMijiData,this.updateRedPoint),this.observe(UserMiji.ins().postMijiUpDate,this.learnUpdate),this.observe(UserMiji.ins().postSelectedMiji,this.selectMijiItem),this.observe(UserMiji.ins().postMijiLockInfo,this.setData),this.select.showAdd()},e.prototype.close=function(){for(var t in this.mijiBtns)this.removeTouchEvent(this.mijiBtns[t],this.onTap);this.removeTouchEvent(this.getBtn,this.onTap),this.removeTouchEvent(this.change,this.onTap),this.removeTouchEvent(this.mijitujian,this.onTap),this.removeTouchEvent(this.all,this.onTap),this.removeObserve(),DisplayUtils.removeFromParent(this.mc),this.stopArrow()},e.prototype.selectMijiItem=function(t){this.select.data=t[0],this.curName=t[1],this.updateEff()},e.prototype.onBagUseMiji=function(t){this.playEff(),this.playArrow()},e.prototype.learnUpdate=function(t){var e=this,i=t[0],s=t[1],n=t[2],o=t[3];if(1==o)this.learnUpdateEffect(i,!1,function(){e["imageMax_"+(i+1)].visible=!0;var t=ObjectPool.pop("MovieClip");t.scaleX=t.scaleY=1,t.rotation=0,t.x=t.y=36,t.playFile(RES_DIR_EFF+"faileff",1,function(){ObjectPool.push(t)}),e.mijiBtns[i].addChild(t),UserTips.ins().showTips("秘籍镶嵌失败")});else{var a=function(){e["imageMax_"+(i+1)].visible=!0,TimerManager.ins().doTimer(500,1,function(){var t=ObjectPool.pop("MovieClip");t.scaleX=t.scaleY=1,t.rotation=0,t.x=t.y=36,t.playFile(RES_DIR_EFF+"successeff",1,function(){ObjectPool.push(t)}),e.mijiBtns[i].addChild(t),e.mijiBtns[i].showSelect(),e.setData();var s=n?",["+GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[n].item].name+"]被替换":"";UserTips.ins().showTips("秘籍镶嵌完成"+s);var o=Setting.ins().getValue(ClientSet.mijiRedPoint);o||Setting.ins().setValue(ClientSet.mijiRedPoint,1)},e)};s-n==1?a():this.learnUpdateEffect(i,!0,a)}this.updateEff()},e.prototype.learnUpdateEffect=function(t,e,i){var s=this;this.isTween=!0;for(var n=24+t+1,o=function(t){var e=t,o=150*t,r=150;t>7&&16>t?(e=t-8,o=150*t):t>15&&24>t?(e=t-16,o=150*t+100*(t-15),r=250):t>23&&(e=t-24,o=150*t+200*(t-23)+650,r=350);var h=egret.Tween.get(a["imageSmall_"+(e+1)]);h.to({},o).call(function(){var o=egret.Tween.get(s["imageSmall_"+(e+1)]);s["imageSmall_"+(e+1)].visible=!0,t==n-1?o.to({visible:!0},150).call(function(){for(var t=0;8>t;t++)egret.Tween.removeTweens(s["imageSmall_"+(t+1)]),s.isTween=!1;UserMiji.ins().sendMijiwancheng(s.roleID),i()}):o.to({visible:!1},r)})},a=this,r=0;n>r;r++)o(r)},e.prototype.updateRedPoint=function(){this.setOpenDesc(),this.setData()},e.prototype.onTap=function(t){var e=this,i=UserMiji.ins();switch(t.target){case this.getBtn:if(DisplayUtils.removeFromParent(this.mc),this.stopArrow(),!this.select.data){var s=this.mijiBtns.indexOf(this.select);return 8==s?i.grid?void ViewManager.ins().open(MijiLearnWin,this.curRole):void UserTips.ins().showTips("1转后开启"):void UserTips.ins().showTips("请选择技能！")}var n=this.select.data+1,o=void 0;n=this.select.data-1,o=UserMiji.ins().hasSpecificSkillOfRole(this.curRole,n);var a="";GlobalConfig.MiJiSkillConfig[n]&&(a=GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[n].item].name),o?WarnWin.show("已镶嵌《"+a+"》,将直接替代《"+a+"》获得《"+this.curName+"》效果",function(){e.roleID=e.curRole,UserMiji.ins().sendMijiLearn(e.curRole,e.select.data),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP),e.select.showAdd()},this):WarnWin.show("镶嵌后获得《"+this.curName+"》,有几率替换已镶嵌秘籍，是否镶嵌？"+(o?"\n<font color='#f3311e'>(已镶嵌《"+a+"》,同类技能仅高级生效)</font>":"\n<font color='#35e62d'>（低级秘籍不会替换高级秘籍）</font>"),function(){e.roleID=e.curRole,UserMiji.ins().sendMijiLearn(e.curRole,e.select.data),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP),e.select.showAdd()},this);break;case this.change:ViewManager.ins().open(MijiZhWin);break;case this.mijitujian:ViewManager.ins().open(MiJiTujianWin);break;case this.all:ViewManager.ins().open(MijiLookWin);break;case this.btnLock:ViewManager.ins().open(MijiLockWin,this.curRole);break;default:var r=this.mijiBtns.indexOf(t.target.parent);if(8==r)return i.grid?void ViewManager.ins().open(MijiLearnWin,this.curRole):void UserTips.ins().showTips("1转后开启");if(!this.mijiBtns[r]||this.mijiBtns[r].data&&!this.mijiBtns[r].data.id)return;if(!i.grid||r>=i.grid)return void UserTips.ins().showTips("未开启");ViewManager.ins().open(MijiTipWin,this.mijiBtns[r].data)}},e}(BaseView);__reflect(MijiPanel.prototype,"MijiPanel");var PersonalBossPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=PersonalBossItem,this.rewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tempArrData=[];var i=UserBoss.ins().getListData(),s=i[0],n=i[1],o=i[2];this.tempArrData=s.concat(n,o),this.bossGroup.addChild(this.bossImage),this.tempIndex=0,this.addTouchEvent(this.challengeBtn,this.onTap),this.listData.replaceAll(this.tempArrData),this.list.scrollV=0,this.list.selectedIndex=0;var a=0;t[0]&&(a=this.getIdFromBossId(t[0],s)),this.currData=this.list.dataProvider.getItemAt(a),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.setWin()},e.prototype.getIdFromBossId=function(t,e){for(var i=0;i<e.length;i++)if(e[i].bossId==t)return this.list.selectedIndex=i,i;return 0},e.prototype.onClickMenu=function(t){this.currData=this.list.dataProvider.getItemAt(t.itemIndex),this.setWin()},e.prototype.setWin=function(){this.config=this.currData;var t,e=GlobalConfig.MonstersConfig[this.config.bossId];t=this.config.levelLimit||this.config.zsLevel?this.config.zsLevel>0?this.config.zsLevel+"转":this.config.levelLimit+"级":e.level+"级",this.nameTxt.text=e.name+"("+t+")";var i="无";this.rewardList.dataProvider=new eui.ArrayCollection(this.config.showItem),""!=this.currData.roleName&&(i=this.currData.roleName,""!=this.currData.guildName&&(i=i+"("+this.currData.guildName+")")),this.config.monthcard&&!Recharge.ins().monthDay?this.stateImage.source="":this.config.specialCard&&!Recharge.ins().franchise?this.stateImage.source="":this.config.zsLevel<=UserZs.ins().lv&&this.config.levelLimit<=Actor.level?UserFb.ins().getFbDataById(this.currData.id).getCount()>0?this.stateImage.source="zdbosskejisha":this.stateImage.source="zdbossyijisha":this.stateImage.source="";var s,n=1e3*UserZs.ins().lv+Actor.level,o=1e3*this.config.zsLevel+this.config.levelLimit;this.config.monthcard?Recharge.ins().monthDay<=0?(this.canChallengeTxt.text="月卡特权可挑战",s=!1):(this.canChallengeTxt.text="",s=!0):this.config.specialCard?Recharge.ins().franchise?(this.canChallengeTxt.text="",s=!0):(this.canChallengeTxt.text="至尊特权可挑战",s=!1):this.config.privilege?Recharge.ins().getIsForeve()?(this.canChallengeTxt.text="",s=!0):(this.canChallengeTxt.text="贵族特权可挑战",s=!1):(s=n>=o,this.canChallengeTxt.text=this.config.zsLevel>0?this.config.zsLevel+"转可挑战":this.config.levelLimit+"级可挑战"),this.challengeBtn.visible=s,this.canChallengeTxt.visible=!s,this.bossImage.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1),this.btnLabel()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(UserFb.ins().checkInFB())return;if(this.config.zsLevel<=UserZs.ins().lv&&this.config.levelLimit<=Actor.level){if(UserFb.ins().getFbDataById(this.currData.id).getCount()<=0)return void UserTips.ins().showTips("次数不足，无法挑战");var e=UserFb.ins().fbModel[this.config.id].isPass;Recharge.ins().franchise&&e?(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):UserFb.ins().sendChallenge(this.config.id),ViewManager.ins().close(LimitTaskView)):(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):(UserZs.ins().lv>=this.config.sweepLevel&&e||ViewManager.ins().close(BossWin),UserFb.ins().sendChallenge(this.currData.id)),ViewManager.ins().close(LimitTaskView))}else UserTips.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|")}},e.prototype.setOneData=function(){},e.prototype.close=function(){TimerManager.ins().remove(this.setOneData,this),this.tempArrData=null},e.prototype.sortFun=function(t,e){var i=UserFb.ins().getFbDataById(t.id).getCount(),s=UserFb.ins().getFbDataById(e.id).getCount();return i>s?-1:s>i?1:t.zsLevel<e.zsLevel?-1:t.zsLevel>e.zsLevel?1:t.levelLimit<e.levelLimit?-1:t.levelLimit>e.levelLimit?1:0},e.prototype.btnLabel=function(){var t=UserFb.ins().fbModel[this.config.id].isPass;Recharge.ins().franchise&&t?this.challengeBtn.label="快速挑战":UserZs.ins().lv>=this.config.sweepLevel&&t?this.challengeBtn.label="快速挑战":this.challengeBtn.label="挑战"},e}(BaseView);__reflect(PersonalBossPanel.prototype,"PersonalBossPanel");var PersonRewardRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="PersonRewardRendererSkin",e.itemList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){this.desc.text=+this.data.integral+"",this.itemList.dataProvider=new eui.ArrayCollection(this.data.award)},e}(BaseItemRender);__reflect(PersonRewardRenderer.prototype,"PersonRewardRenderer");var PowerPanel=function(t){function e(){var e=t.call(this)||this;return e.showBg=!0,e.imgWidth=72,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.playFlameMC(),this.totalPower=BitmapNumber.ins().createNumPic(0,"8",5),this.totalPower.x=105,this.totalPower.y=17,this.addChild(this.totalPower),this.initPos()},e.prototype.setPower=function(t){this.power=t,BitmapNumber.ins().changeNum(this.totalPower,t,"8",5),this.initPos()},e.prototype.initPos=function(){if(this.showBg){var t=this.totalPower.width>30?this.totalPower.width:30;this.totalPower.x=this.width-t-80,this.powerImg.x=this.totalPower.x-this.imgWidth-10}},e.prototype.setBgVis=function(t){this.bgImg.visible=t,this.flameGroup.visible=t,this.showBg=t},e.prototype.setMcVisible=function(t){this.flameGroup.visible=t},e.prototype.playFlameMC=function(){this.flameMC?this.flameMC.play(-1):(this.flameMC=new MovieClip,this.flameMC.x=76,this.flameMC.y=23,this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1),this.flameGroup.addChild(this.flameMC))},e.prototype.destructor=function(){DisplayUtils.removeFromParent(this)},e}(BaseView);__reflect(PowerPanel.prototype,"PowerPanel");var PriceIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="PriceIconSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.priceLabel.textColor=ColorUtil.NORMAL_COLOR},e.prototype.getPrice=function(){return this._price},e.prototype.setPrice=function(t,e){if(void 0===e&&(e=-1),t!=this._price||-1!=e)if(this._price=t,e>=0){var i="";i=e>=t?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.priceLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+e+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t+"</font> ")}else this.priceLabel.text=""+this._price},e.prototype.setText=function(t){this.priceLabel.textFlow=(new egret.HtmlTextParser).parser(t)},e.prototype.setData=function(t){var e="";if(t){var i=t;if(0==i.type)switch(i.id){case MoneyConst.exp:e="exp_png";break;case MoneyConst.gold:e="szjinbi";break;case MoneyConst.yuanbao:e="szyuanbao";break;case MoneyConst.fame:e="fame";break;case MoneyConst.soul:e="soul";break;case MoneyConst.wing:e="yumao_png";break;case MoneyConst.piece:e="500008_png"}else if(1==i.type)switch(i.id){case 200001:e="yumao_png";break;case 200002:e="forge";break;case 200003:e="gem";break;case 200004:e="spirit";break;case 200005:e="vigor";break;case 200006:e="shield"}this._type=i.id,this.setPrice(i.count)}else if(t){var s=t;switch(s.itemConfig.id){case 200001:e="yumao_png";break;case 200002:e="szyuanbao";break;case 200003:e="szyuanbao";break;case 200004:e="szyuanbao";break;case 200005:e="szyuanbao";break;case 200006:e="szyuanbao"}this._type=s.itemConfig.id,this.setPrice(s.count)}this.iconImg.source=e},e.prototype.getType=function(){return this._type},e.prototype.setType=function(t){if(this._type!=t){this._type=t;var e="";switch(this._type){case MoneyConst.exp:e="exp";break;case MoneyConst.gold:e="szjinbi";break;case MoneyConst.yuanbao:e="szyuanbao";break;case MoneyConst.fame:e="fame";break;case MoneyConst.soul:e="soul";break;case MoneyConst.wing:e="yumao_png"}this.iconImg.source=e}},Object.defineProperty(e.prototype,"labelColor",{get:function(){return this._labelColor},set:function(t){this._labelColor!=t&&(this._labelColor=t,this.priceLabel.textColor=this._labelColor)},enumerable:!0,configurable:!0}),e}(BaseComponent);__reflect(PriceIcon.prototype,"PriceIcon");var PropGainTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="PropGainTipsSkin",this.itemIcon.imgJob.visible=!1,this.gainList.itemRenderer=GainGoodsNoSkinItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2];this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.addTouchEndEvent(this,this.otherClose),this.setData(i,s,n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);if(i){var s=!0;if("Recharge2Win"==e[1]){var n=Recharge.ins().getRechargeData(0);n&&n.num||(s=!1,ViewManager.ins().open(Recharge1Win))}s&&GameGuider.guidance(e[1],e[2],e[3]),ViewManager.ins().close(ShopGoodsWarn),ViewManager.ins().close(BookUpWin),ViewManager.ins().close(WeaponPanel),ViewManager.ins().close(WeaponSoulBreakWin),"HeirloomCom"!=e[1]&&ViewManager.ins().close(HeirloomCom),"LadderWin"==e[1]&&ViewManager.ins().close(ForgeWin),"PlayFunView"==e[1]&&ViewManager.ins().close(ShopWin)}}},e.prototype.setData=function(t,e,i){var s="";if(void 0==i){var n=UserBag.ins().getBagGoodsByTypeAndId(t,e);s=n?n.count+"":"0"}else s=i+"";var o=GlobalConfig.ItemConfig[e];if(this.nameLabel.text=o.name,this.nameLabel.textColor=ItemConfig.getQualityColor(o),this.itemIcon.setData(o),this.lv.text=(o.level||1)+"级",this.num.text=s,this.description0.textFlow=TextFlowMaker.generateTextFlow(o.desc),2==ItemConfig.getType(o)){var a=MiJiSkillConfig.getSkillIDByItem(o.id);this.power.text="评分："+GlobalConfig.MiJiSkillConfig[a].power}else this.power.text="";var r=GlobalConfig.GainItemConfig[e];r?this.gainList.dataProvider=new eui.ArrayCollection(r.gainWay):this.gainList.dataProvider=new eui.ArrayCollection([])},e}(BaseEuiView);__reflect(PropGainTipsWin.prototype,"PropGainTipsWin"),ViewManager.ins().reg(PropGainTipsWin,LayerManager.UI_Popup);var PubBossRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e._lastX=0,e._lastY=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastX=t.stageX,this._lastY=t.stageY,this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(t){MathUtils.getDistance(this._lastX,this._lastY,t.stageX,t.stageY)>20&&(this._move=!0)},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){var t,e=this.data,i=GlobalConfig.WorldBossConfig[e.id],s=UserBoss.isCanChallenge(i);t=i.samsaraLv>0?i.showName:i.zsLevel>0?i.zsLevel+"转":i.level+"级",this.checkBoxs.visible=s,s&&(this.checkBoxs.selected=UserBoss.ins().getBossRemindByIndex(e.id)),this.txt.visible=!s,this.checkBoxs.name=e.id+"";var n=GlobalConfig.MonstersConfig[i.bossId];this.bossName.text=n.name,this.levelShow.text=t},e}(BaseItemRender);__reflect(PubBossRemindItem.prototype,"PubBossRemindItem");var PunchEquipItem=function(t){function e(){var e=t.call(this)||this;return e.wearData=null,e.skinName="PunchEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var t=UserSkill.ins().equipListData[this.data];if(this.wearData=UserSkill.ins().getWearEquipsData(this.data),this.img.source="",this.addBtn.visible=!0,t&&t.itemConfig){var e=ItemConfig.getSubType(t.itemConfig);this.img.source=""+(t.itemConfig.zsLevel||0)+(t.itemConfig.level||1)+"_"+(e+1)+"_png",this.redPoint.visible=UserSkill.ins().checkIsHaveBestEquip(e)}else this.img.source="",this.redPoint.visible=UserSkill.ins().checkIsHaveBestEquip(this.data)},e.prototype.destruct=function(){this.img.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(){this.wearData&&0!=this.wearData.configID?ViewManager.ins().open(HejiEquipTipsWin,this.wearData,!0):ViewManager.ins().open(HejiEquipTipsWin,this.data,!0)},e}(BaseComponent);__reflect(PunchEquipItem.prototype,"PunchEquipItem");var PunchEquipItemBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.validateNow(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var t=this.data,e=this.wearData=new ItemData;e.configID=t.id,this.addBtn.visible=!1,this.redPoint.visible=!1,this.img.source="",e&&e.itemConfig?this.img.source=""+(e.itemConfig.zsLevel||0)+e.itemConfig.level+"_"+(ItemConfig.getSubType(e.itemConfig)+1)+"_png":this.img.source=""},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(){this.wearData&&0!=this.wearData.configID?ViewManager.ins().open(HejiEquipTipsWin,this.wearData,!0):ViewManager.ins().open(PunchEquipChooseWin,this.data,0)},e}(BaseComponent);__reflect(PunchEquipItemBase.prototype,"PunchEquipItemBase");var PunchEquipPanel=function(t){function e(){var e=t.call(this)||this;return e.selectIndex=0,e.skinName="PunchEquip",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserSkill.ins().postHejiEquipChange,this.refushPanelInfo),this.refushPanelInfo(),this.reufshRolePoint()},e.prototype.refushPanelInfo=function(){for(var t=[],e=1;9>e;e++){this["item"+e].data=e-1;var i=UserSkill.ins().equipListData[e-1];t=0==t.length?i.att:AttributeData.AttrAddition(t,i.att)}this.powerPanel.setPower(998),this.attrsText.text=AttributeData.getAttStr(t)},e.prototype.refushOne=function(t){this["item"+(t+1)].data=t,ViewManager.ins().isShow(PunchEquipChooseWin)&&ViewManager.ins().close(PunchEquipChooseWin),this.powerPanel.setPower(998)},e.prototype.reufshRolePoint=function(){},e.prototype.countAllAttNum=function(){var t=0;return t},e.prototype.onTap=function(t){switch(this.selectIndex=0,t.target){}},e}(BaseEuiView);__reflect(PunchEquipPanel.prototype,"PunchEquipPanel"),ViewManager.ins().reg(PunchEquipPanel,LayerManager.UI_Main);var RankItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(null!=this.data){for(var t in this.data){var e=this[t];e&&this.updateValue(e,t,this.data[t])}2==this.data[RankDataType.DATA_POS]?(this.t3.source="rankcolor_1",this.t1.source="paihang2",this.pos.visible=!1,this.t1.visible=!0):3==this.data[RankDataType.DATA_POS]?(this.t3.source="rankcolor_2",this.t1.source="paihang3",this.pos.visible=!1,this.t1.visible=!0):4==this.data[RankDataType.DATA_POS]?(this.t3.source="rankcolor_3",this.t1.source="",this.pos.visible=!0,this.t1.visible=!1):(this.t3.source="bantoutiaobg",this.pos.visible=!0,this.t1.visible=!1),this.t10&&(this.t10.visible=this.data.pos<=10),this.vip.visible=this.data.vip>0}this.visible=null!=this.data},e.prototype.updateValue=function(t,i,s){switch(i){case RankDataType.DATA_VIP:return;case RankDataType.DATA_MONTH:return void(t.visible=1==s);case RankDataType.DATA_LEVEL:s+="级";break;case RankDataType.DATA_COUNT:if(Rank.ins().curType==RankDataType.TYPE_XUNZHANG){var n=GlobalConfig.KnighthoodConfig[s];s=n.type}else if(Rank.ins().curType==RankDataType.TYPE_LILIAN){var n=GlobalConfig.TrainLevelConfig[s];s=n.trainlevel+"等"+n.trainName}else Rank.ins().curType==RankDataType.TYPE_XIAYI&&(s="魅力值:"+s);break;case RankDataType.DATA_WEIWANG:s=WeiWangCC.ins().getWeiWangCfg(s).res}t instanceof eui.Label?("number"==typeof s&&(s=CommonUtils.overLength(s)),t.text=i in e.dataFormat?e.dataFormat[i].replace("{value}",s):s):t instanceof eui.Image&&(t.source=i in e.dataFormat?e.dataFormat[i].replace("{value}",s):s)},e}(BaseItemRender);__reflect(RankItemRenderer.prototype,"RankItemRenderer");var RedBagRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RedBagRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.num.text=this.data.robNum,this.nameLabel.text=this.data.robName},e}(BaseItemRender);__reflect(RedBagRenderer.prototype,"RedBagRenderer");var RoleInfoItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleInfoItemSkin",e.iconMc=new MovieClip,e.iconMc.x=45,e.iconMc.y=40,e.iconMc.scaleX=e.iconMc.scaleY=.4,e}return __extends(e,t),e.prototype.getImgSource=function(){return this._imgSource},e.prototype.setImgSource=function(t,e){var i=t?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+i,-1),this.iconMc&&!this.iconMc.parent&&this.addChild(this.iconMc);var s=e?[]:FilterUtil.ARRAY_GRAY_FILTER;this.iconMc.filters=s},e.prototype.getLv=function(){return this._lv},e.prototype.setLv=function(t){this._lv!=t&&(this._lv=t,0==this._lv?this.lvTxt.text="":this.lvTxt.text="+"+this._lv)},e.prototype.getNameTxt=function(){return this.labelDisplay.text},e.prototype.setNameTxt=function(t){this._imgSource!=t&&(this.labelDisplay.text=t)},e.prototype.setBgValue=function(t){this.bgImg.source=t},e.prototype.getRedPointVisibel=function(){return this.redPoint.visible},e.prototype.setRedPointVisibel=function(t){this.redPoint.visible=t},e.prototype.destory=function(){this.iconMc.filters=null,DisplayUtils.removeFromParent(this.iconMc),this.iconMc.filters=null},e}(BaseView);__reflect(RoleInfoItem.prototype,"RoleInfoItem");var RoleInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.beforeIndex=-1,e.name="角色",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.touchEnabled=!1,this.touchChildren=!0,this.groupRole.touchEnabled=!1,this.groupRoleNext.touchEnabled=!1,this.groupRole.touchChildren=!1,this.groupRoleNext.touchChildren=!1,this.equips=[];for(var t=0;t<EquipPos.MAX;t++)this.equips[t]=this["item"+t],this.equips[t].touchEnabled=!0,this.equips[t].isShowJob(!1),this.equips[t].isShowTips(!1),this["redPoint"+t].touchEnabled=!1;this.eff=new MovieClip,this.eff.x=this.oneKeyChange.width/2,this.eff.y=this.oneKeyChange.height/2,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.suitEff=new MovieClip,this.suitEff.x=this.suitImg.x,this.suitEff.y=this.suitImg.y,this.suitEff3=new MovieClip,this.suitEff3.x=this.suitImg1.x,this.suitEff3.y=this.suitImg1.y,this.suitEff2=new MovieClip,this.suitEff4=new MovieClip,this.suitEff5=new MovieClip,this.suitEff6=new MovieClip,this.suitEff7=new MovieClip,this.suitEff8=new MovieClip,this.suitEff9=new MovieClip,this.suitEff10=new MovieClip},e.prototype.clear=function(){this.beforeIndex=-1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.shuzhuang,this.onClick),this.addTouchEvent(this.bless0,this.onClick),this.addTouchEvent(this.bless1,this.onClick),this.addTouchEvent(this.oneKeyChange,this.onClick),this.addTouchEvent(this.roleInfoItem0,this.onClick),this.addTouchEvent(this.roleInfoItem1,this.onClick),this.addTouchEvent(this.shenlu,this.onClick),this.addTouchEvent(this.orange,this.onClick),this.addTouchEvent(this.heirloom,this.onClick),this.addTouchEvent(this.rune,this.onClick),this.addTouchEvent(this.juesexiangxi,this.onClick),this.observe(UserEquip.ins().postEquipChange,this.updataEquip),this.observe(UserEquip.ins().postAddSpirit,this.updataEquip),this.observe(UserEquip.ins().postAddSoul,this.updataEquip),this.observe(SpecialRing.ins().postRingUpdate,this.updateRing),this.observe(UserForge.ins().postForgeTips,this.delayRedPoint),this.observe(GameLogic.ins().postRuneExchange,this.delayRedPoint),this.observe(GameLogic.ins().postRuneShatter,this.delayRedPoint),this.observe(Rune.ins().postInlayResult,this.delayRedPoint),this.observe(UserBag.ins().postHuntStore,this.delayRedPoint),this.observe(Dress.ins().postChangeWing,this.setWing),this.observe(LongHun.ins().postDateUpdate,this.updateLoongSoul),this.observe(LongHun.ins().postStageActive,this.updateLoongSoul),this.observe(ShenshouRedpoint.ins().postRedPoint,this.updateLoongSoul),this.observe(Dress.ins().postDressInfo,this.setFashionRetPoint),this.observe(SpecialRing.ins().postActiveRing,this.delayRedPoint),this.observe(UserFb.ins().postFbRingInfo,this.delayRedPoint),this.observe(Heirloom.ins().postHeirloomInfo,this.setRoleEff),this.observe(Weapons.ins().postWeaponsUse,this.setRoleEff),this.observe(UserBag.ins().postItemAdd,this.delayRedPoint),this.observe(UserBag.ins().postItemDel,this.delayRedPoint),this.observe(UserBag.ins().postItemChange,this.delayRedPoint),this.observe(UserBag.ins().postItemCountChange,this.delayRedPoint),this.observe(UserFb.ins().postFbRingInfo,this.delayRedPoint),this.observe(Actor.ins().postLevelChange,this.delayRedPoint),this.observe(JadeNew.ins().postJadeData,this.delayRedPoint),this.observe(LyMark.ins().postMarkData,this.delayRedPoint),this.updateRing(),this.updateLoongSoul(),this.setRetPoint(),this.updataEquip(!1),this.setFashionRetPoint(),this.clearChangeEff(),-1!=this.beforeIndex?this.roleChange(this.beforeIndex,this.curRole):(this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setWing()),this.beforeIndex=this.curRole,this.setSuitEquips()},e.prototype.close=function(){DisplayUtils.removeFromParent(this.eff),DisplayUtils.removeFromParent(this.suitEff),DisplayUtils.removeFromParent(this.suitEff2),DisplayUtils.removeFromParent(this.suitEff3),DisplayUtils.removeFromParent(this.suitEff4),DisplayUtils.removeFromParent(this.suitEff5),DisplayUtils.removeFromParent(this.suitEff6),DisplayUtils.removeFromParent(this.suitEff7),DisplayUtils.removeFromParent(this.suitEff8),DisplayUtils.removeFromParent(this.suitEff9),DisplayUtils.removeFromParent(this.suitEff10),this.roleInfoItem0.destory(),this.roleInfoItem1.destory()},e.prototype.clearChangeEff=function(){egret.Tween.removeTweens(this.groupRole),egret.Tween.removeTweens(this.groupRoleNext),this.groupRole.x=0,this.groupRoleNext.x=580,this.groupRole.alpha=1,this.groupRoleNext.alpha=0,this.groupRoleNext.visible=!1,this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWing(this.curRole,this.wingImg),this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)},e.prototype.roleChange=function(t,e){if(t==e)return void this.clearChangeEff();this.groupRoleNext.visible=!0,this.setWing(t,this.wingImg),this.setWing(e,this.nextWingImg),this.setRole(t,this.bodyImg,this.weaponImg),this.setRole(e,this.nextBodyImg,this.nextWeaponImg),this.setSuit(t,this.suitImg,this.suitEff),this.setSuit(e,this.suitImg1,this.suitEff3),this.setWeaponsSuit(t,"sef",this.soulEff,this.suitEff2),this.setWeaponsSuit(e,"nsef",this.nsoulEff,this.suitEff4),this.setWeaponEffect(t,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(e,"nwsef",this.nsoulEff,this.suitEff6),this.setWeaponEffect(t,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setWeaponEffect(e,"nbodyEffect",this.nbodyEff,this.suitEff8,2);var i=egret.Tween.get(this.groupRole),s=egret.Tween.get(this.groupRoleNext);e>t?(this.groupRoleNext.x=580,i.to({x:-580,alpha:0},600),s.to({x:0,alpha:1},600).call(this.clearChangeEff,this)):(this.groupRoleNext.x=-580,i.to({x:580,alpha:0},600),s.to({x:0,alpha:1},600).call(this.clearChangeEff,this))},e.prototype.updateLoongSoul=function(){this.redPointShenlu.visible=LongHun.ins().canShowRedPointInAll()||JadeNew.ins().checkRed()||ShenshouRedpoint.ins().redpoint},e.prototype.updateRing=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole).exRingsData;t[0]>0?(this.roleInfoItem0.setImgSource(0,1),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality4"),this.roleInfoItem0.setRedPointVisibel(!1)):(this.roleInfoItem0.setImgSource(0,0),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality0")),t[1]>0?(this.roleInfoItem1.setImgSource(1,1),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality4"),this.roleInfoItem1.setRedPointVisibel(!1)):(this.roleInfoItem1.setImgSource(1,0),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality0"))
},e.prototype.updataEquip=function(t){void 0===t&&(t=!0);var e=SubRoles.ins().getSubRoleByIndex(this.curRole);this.setEquip(e),t?TimerManager.ins().doTimer(300,1,this.onDelayReflash,this):this.onDelayReflash(),this.setSuitEquips()},e.prototype.onDelayReflash=function(){UserRole.ins().setCanChange()},e.prototype.setEquip=function(t){if(t){var e=t.getEquipLen();this.weaponImg.source="";for(var i=0;e>i;i++){var s=t.getEquipByIndex(i);this.equips[i].setModel(t),this.equips[i].setCurRole(this.curRole),this.equips[i].setIndex(i),this.equips[i].data=s.item,0==s.item.configID?(this.equips[i].setItemImg(i>EquipPos.MAX?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[i]),this.equips[i].isShowTips(!1),this.addTouchEvent(this.equips[i],this.onClick)):(this.equips[i].isShowTips(!0),this.removeTouchEvent(this.equips[i],this.onClick))}this.powerPanel.setPower(t.power),this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)}},e.prototype.setRole=function(t,e,i){e.source=null,i.source=null;var s,n=SubRoles.ins().getSubRoleByIndex(t),o=n.getEquipByIndex(0).item.configID,a=n.zhuangbei,r=a[0],h=a[1],l=n.getEquipByIndex(0),c=l.item.configID,u=n.getEquipByIndex(2),p=u.item.configID;if(c>0){var d=GlobalConfig.EquipConfig[c].appearance;d&&d.indexOf("[job]")>-1&&(d=d.replace("[job]",n.job+"")),i.source=GlobalConfig.EquipWithEffConfig[o+"_"+n.sex]?null:d+"_"+n.sex+"_c_png"}if(p>0){var d=GlobalConfig.EquipConfig[p].appearance;d&&d.indexOf("[job]")>-1&&(d=d.replace("[job]",n.job+"")),e.source=d+"_"+n.sex+"_c_png",s=!0}s||(e.source="body000_"+n.sex+"_c_png"),h>0&&(i.source=this.getZhuangbanById(h).res+"_"+n.sex+"_c_png"),r>0&&(e.source=this.getZhuangbanById(r).res+"_"+n.sex+"_c_png")},e.prototype.setRoleEff=function(){this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)},e.prototype.setSuit=function(t,e,i){DisplayUtils.removeFromParent(i);var s=SubRoles.ins().getSubRoleByIndex(t),n=s.heirloom.getSuitConfig(s);if(n){i.parent||e.parent.addChildAt(i,e.parent.getChildIndex(e));var o=GlobalConfig.HeirloomEquipSetConfig[n.lv];i.playFile(RES_DIR_EFF+o.neff,-1)}},e.prototype.setWeaponsSuit=function(t,e,i,s){var n=SubRoles.ins().getSubRoleByIndex(t);s.x=this[e+n.job].x,s.y=this[e+n.job].y,s.rotation=this[e+n.job].rotation,DisplayUtils.removeFromParent(s);var o=n.weapons.weaponsId,a=n.hideWeapons();if(!a&&o){s.parent||i.addChild(s);var r=GlobalConfig.WeaponSoulConfig[o];s.playFile(RES_DIR_EFF+r.inside[n.job-1],-1)}},e.prototype.setWeaponEffect=function(t,e,i,s,n){void 0===n&&(n=0);var o=SubRoles.ins().getSubRoleByIndex(t),a=o.getEquipByIndex(n).item.configID,r=GlobalConfig.EquipWithEffConfig[a+"_"+o.sex];DisplayUtils.removeFromParent(s);var h=o.zhuangbei,l=s;l==this.suitEff5?0==o.sex?DisplayUtils.removeFromParent(this.suitEff9):l=this.suitEff9:l==this.suitEff6&&(0==o.sex?DisplayUtils.removeFromParent(this.suitEff10):l=this.suitEff10),r&&(0==n&&h[1]<=0||2==n&&h[0]<=0)?(l.x=this[e+o.sex].x+r.offX,l.y=this[e+o.sex].y+r.offY,l.rotation=this[e+o.sex].rotation,l.scaleX=l.scaleY=r.scaling,l.playFile(RES_DIR_EFF+r.inShowEff,-1),i.addChild(l)):DisplayUtils.removeFromParent(l)},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.setFashionRetPoint=function(){this.fashionPoint&&(this.fashionPoint.visible=Dress.ins().redPoint())},e.prototype.onClick=function(t){switch(t.currentTarget){case this.juesexiangxi:ViewManager.ins().open(RoleAttrWin,this.curRole);break;case this.oneKeyChange:UserRole.ins().checkHaveCan(!0,this.curRole),this.setCanChange(),SoundUtil.ins().playEffect(SoundUtil.EQUIP),SoundUtil.ins().playEffect(SoundUtil.EQUIP);break;case this.roleInfoItem0:ViewManager.ins().open(SpecialRingWin,0,this.curRole);break;case this.roleInfoItem1:ViewManager.ins().open(SpecialRingWin,1,this.curRole);break;case this.shuzhuang:ViewManager.ins().open(DressWin,this.curRole);break;case this.shenlu:ViewManager.ins().open(TreasureWin,0,this.curRole);break;case this.orange:ViewManager.ins().open(AdvanEquipWin,0,0),this.setRetPoint();break;case this.heirloom:ViewManager.ins().open(HeirloomWin,this.curRole);break;case this.rune:ViewManager.ins().open(RuneWin,this.curRole);break;case this.bless0:SpecialRing.ins().isFireRingFuse()?ViewManager.ins().open(FireRingWin):SpecialRing.ins().checkRingOpen()?ViewManager.ins().open(RingInfoView):UserTips.ins().showTips("激活神器 神龙之戒 后开启");break;case this.bless1:break;default:var e=this.equips.indexOf(t.currentTarget);e>=0&&(e>8||ViewManager.ins().open(RoleChooseEquipWin,this.curRole,e))}},e.prototype.setWing=function(t,e){void 0===t&&(t=this.curRole),void 0===e&&(e=this.wingImg),e.source=null;var i=SubRoles.ins().getSubRoleByIndex(t).wingsData,s=SubRoles.ins().getSubRoleByIndex(t).zhuangbei[2];s>0?e.source=GlobalConfig.ZhuangBanId[s].res+"_png":i.openStatus?e.source=GlobalConfig.WingLevelConfig[i.lv].appearance+"_png":e.source=""},e.prototype.delayRedPoint=function(){TimerManager.ins().isExists(this.setRetPoint,this)||TimerManager.ins().doTimer(60,1,this.setRetPoint,this)},e.prototype.setRetPoint=function(){for(var t=0;2>t;t++){var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=UserRole.ins().roleHintCheck(e,t);this["roleInfoItem"+t].setRedPointVisibel(i)}for(var s=!1,n=SubRoles.ins().subRolesLen,o=0;n>o;o++){for(var a=SubRoles.ins().getSubRoleByIndex(o),t=0;8>t;t++){if(s=UserEquip.ins().setOrangeEquipItemState(t,a),!s&&2>t&&(s=UserEquip.ins().setLegendEquipItemState(t>0?2:0,a)),s){var r=UserBag.ins().checkEqRedPoint(t,a);s=null!=r?r:s}if(s)break}if(s)break}if(s||(s=UserEquip.ins().checkRedPointEx(5,this.curRole)),s||(s=UserBag.ins().getLegendHasResolve()),!s){var h=UserBag.ins().getLegendOutEquips();s=h.length>0}s||(s=Boolean(UserBag.ins().getHuntGoods(0).length)),s||(s=ExtremeEquipModel.ins().getRedPoint()),this.orangeRedPoint.visible=s,this.heirloomRedPoint.visible=Heirloom.ins().checkRedPoint(),this.updateLoongSoul(),this.ringRedPoint.visible=OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||SpecialRing.ins().fireRingRedPoint()||LyMark.ins().checkRed()),this.zwRedPoint.visible=RuneRedPointMgr.ins().checkAllSituation(!1),this.setCanChange()},e.prototype.setSamsaraRedPoint=function(){if(SamsaraModel.ins().isOpen())for(var t=EquipPos.HAT;t<EquipPos.MAX;t++){var e=this["redPoint"+t],i=SubRoles.ins().getSubRoleByIndex(this.curRole),s=i.getEquipByIndex(t);s.soulLv>0?this["item"+t].setSoul(!0):this["item"+t].setSoul(!1),e.visible||(e.visible=SamsaraModel.ins().checkEquipPosCanAddSpirit(i,t)||SamsaraModel.ins().checkUpgradeSoul(i,t))}for(var t=9;13>t;t++)this["item"+t].visible=SamsaraModel.ins().isOpen()},e.prototype.setCanChange=function(t){var e=t?t[this.curRole]?t[this.curRole]:[]:UserRole.ins().canChangeEquips[this.curRole],i=!1,s=this.equips.length;DisplayUtils.removeFromParent(this.eff);for(var n=0;s>n;n++)this["redPoint"+n].visible=e[n]?e[n]:!1,i||(i=e[n]?e[n]:!1);this.updateOneKey(i),this.setSamsaraRedPoint()},e.prototype.updateOneKey=function(t){return OpenSystem.ins().checkSysOpen(SystemType.ONEKEY)?(this.oneKeyChange.visible=t,void(this.oneKeyChange.visible?(this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.effGroup.addChild(this.eff)):DisplayUtils.removeFromParent(this.eff))):void(this.oneKeyChange.visible=!1)},e.prototype.getEquipItem=function(t){return this.equips[t]},e.prototype.setSuitEquips=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=0;e<UserEquip.FOEGE_MAX;e++){var i=this.equips[e],s=t.heirloom.getInfoBySolt(e);i&&s.lv>0?i.setItemHeirloomBgImg(!0,s.image):i.setItemHeirloomBgImg(!1)}},e}(BaseView);__decorate([callLater],RoleInfoPanel.prototype,"updataEquip",null),__reflect(RoleInfoPanel.prototype,"RoleInfoPanel");var RoleItem=function(t){function e(){var e=t.call(this)||this;return e._curRole=-1,e._index=-1,e.showTip=!0,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.boostLv=new eui.Label,this.boostLv.x=35,this.boostLv.y=55,this.boostLv.textColor=16360197,this.zhulingLv=new eui.Label,this.zhulingLv.x=12,this.zhulingLv.y=55,this.zhulingLv.textColor=4046335,this.tupoLv=new eui.Label,this.tupoLv.x=20,this.tupoLv.y=5,this.tupoLv.textColor=15333897,this.boostLv.size=this.zhulingLv.size=this.tupoLv.size=16,this.boostLv.width=this.zhulingLv.width=this.tupoLv.width=41,this.boostLv.stroke=this.zhulingLv.stroke=this.tupoLv.stroke=1,this.boostLv.strokeColor=this.zhulingLv.strokeColor=this.tupoLv.strokeColor=0,this.boostLv.textAlign=this.tupoLv.textAlign="right",this.addChild(this.boostLv),this.addChild(this.zhulingLv),this.addChild(this.tupoLv),this.mc=new MovieClip,this.mc.x=46,this.mc.y=43},e.prototype.dataChanged=function(){this.playEff(),t.prototype.dataChanged.call(this);var e=this.data.itemConfig;if(this.bless.visible=!1,e){for(var i=this._wings?this._model.wingsData.equipdata:this._model.equipsData,s=void 0,n=0;n<i.length;n++)if(this.data.handle==i[n].item.handle){s=i[n];break}this._wings||(this.boostLv.text=s.strengthen>0?"+"+s.strengthen:"",this.zhulingLv.text=s.zhuling>0?s.zhuling+"":"",this.tupoLv.text=s.tupo>0?s.tupo+"星":"",this.bless.visible=s.bless>0,ItemConfig.getSubType(e)==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]&&(this.nameTxt.text=UserBag.ins().getGuanyinLevel(e)))}this.getItemIcon().extreme.visible=!1,this._curRole>=0&&this._index>=EquipPos.WEAPON&&this._index<=EquipPos.SHOE&&(this.getItemIcon().extreme.visible||(this.getItemIcon().extreme.visible=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this._model,this._index)>0)),this._lastData=this.data,this._lastModel=this._model},e.prototype.clear=function(){t.prototype.clear.call(this),this.boostLv.text=this.zhulingLv.text=this.tupoLv.text="",this.playEff()},e.prototype.isShowTips=function(t){this.showTip=t},e.prototype.openEquipsTips=function(){this.showTip&&(this._index>EquipPos.DZI?ViewManager.ins().open(SamsaraEquipTips,this._curRole,this._lastModel,this._index):ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data,this._model,this._curRole,this._index))},e.prototype.showPower=function(){this.openEquipsTips()},e.prototype.setModel=function(t){this._model=t},e.prototype.getModel=function(){return this._model},e.prototype.setCurRole=function(t){this._curRole=t},e.prototype.getCurRole=function(){return this._curRole},e.prototype.setIndex=function(t){this._index=t},e.prototype.getIndex=function(){return this._index},e.prototype.setWings=function(t){this._wings=t},e.prototype.getWings=function(){return this._wings},e.prototype.playEff=function(){this._lastData&&this._lastData!=this.data&&this._model==this._lastModel&&(this.mc.playFile(RES_DIR_EFF+"forgeSuccess",1),this.addChild(this.mc))},e}(ItemBase);__reflect(RoleItem.prototype,"RoleItem");var RoleItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="RoleShowSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showRole,e),e.suitEff=new MovieClip,e.suitEff.x=e.suitImg.x,e.suitEff.y=e.suitImg.y,e.suitEff2=new MovieClip,e.suitEff5=new MovieClip,e.suitEff7=new MovieClip,e.suitEff9=new MovieClip,e}return __extends(e,t),e.prototype.dataChanged=function(){if(!(this.data&&this.data.otherPlayerData&&this.data.otherPlayerData instanceof OtherPlayerData))return this.bodyImg.source="body00_png",this.weaponImg.source="",this.wingImg.source="",this.suitEff&&DisplayUtils.removeFromParent(this.suitEff),this.suitEff2&&DisplayUtils.removeFromParent(this.suitEff2),this.suitEff5&&DisplayUtils.removeFromParent(this.suitEff5),void(this.suitEff7&&DisplayUtils.removeFromParent(this.suitEff7));var t=this.data.otherPlayerData,e=t.roleData[this.index];e&&(this.setWing(e.index,this.wingImg),this.setRole(e.index,this.bodyImg,this.weaponImg),this.setRoleEff(e.index))},e.prototype.setRole=function(t,e,i){e.source=null,i.source=null;var s,n=this.data.otherPlayerData.roleData[t],o=n.getEquipByIndex(0).item.configID,a=n.zhuangbei,r=a[0],h=a[1],l=n.getEquipByIndex(0),c=l.item.configID,u=n.getEquipByIndex(2),p=u.item.configID;if(c>0){var d=GlobalConfig.EquipConfig[c].appearance;d&&d.indexOf("[job]")>-1&&(d=d.replace("[job]",n.job+"")),i.source=GlobalConfig.EquipWithEffConfig[o+"_"+n.sex]?null:d+"_"+n.sex+"_c_png"}if(p>0){var d=GlobalConfig.EquipConfig[p].appearance;d&&d.indexOf("[job]")>-1&&(d=d.replace("[job]",n.job+"")),e.source=d+"_"+n.sex+"_c_png",s=!0}s||(e.source="body000_"+n.sex+"_c_png"),h>0&&(i.source=this.getZhuangbanById(h).res+"_"+n.sex+"_c_png"),r>0&&(e.source=this.getZhuangbanById(r).res+"_"+n.sex+"_c_png")},e.prototype.setWing=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.wingImg),e.source=null;var i=this.data.otherPlayerData.roleData[t],s=i.wingsData,n=i.zhuangbei[2];n>0?e.source=GlobalConfig.ZhuangBanId[n].res+"_png":s.openStatus?e.source=GlobalConfig.WingLevelConfig[s.lv].appearance+"_png":e.source=""},e.prototype.setRoleEff=function(t){this.setSuit(t,this.suitImg,this.suitEff),this.setWeaponsSuit(t,"sef",this.soulEff,this.suitEff2),this.setWeaponEffect(t,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(t,"bodyEffect",this.bodyEff,this.suitEff7,2)},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.showRole=function(t){if(this.data&&this.data.otherPlayerData){ViewManager.ins().open(RRoleWin,this.data.otherPlayerData);var e=ViewManager.ins().open(RRoleWin,this.data.otherPlayerData);e.hideEx(2)}},e.prototype.setSuit=function(t,e,i){DisplayUtils.removeFromParent(i);var s=this.data.otherPlayerData.roleData[t],n=s.heirloom.getSuitConfig(s);if(n){i.parent||e.parent.addChildAt(i,e.parent.getChildIndex(e));var o=GlobalConfig.HeirloomEquipSetConfig[n.lv];i.playFile(RES_DIR_EFF+o.neff,-1)}},e.prototype.setWeaponsSuit=function(t,e,i,s){var n=this.data.otherPlayerData.roleData[t];s.x=this[e+n.job].x,s.y=this[e+n.job].y,s.rotation=this[e+n.job].rotation,DisplayUtils.removeFromParent(s);var o=n.weapons.weaponsId,a=n.hideWeapons();if(!a&&o){s.parent||i.addChild(s);var r=GlobalConfig.WeaponSoulConfig[o];s.playFile(RES_DIR_EFF+r.inside[n.job-1],-1)}},e.prototype.setWeaponEffect=function(t,e,i,s,n){void 0===n&&(n=0);var o=this.data.otherPlayerData.roleData[t],a=o.getEquipByIndex(n).item.configID,r=GlobalConfig.EquipWithEffConfig[a+"_"+o.sex];DisplayUtils.removeFromParent(s);var h=o.zhuangbei,l=s;l==this.suitEff5&&(0==o.sex?DisplayUtils.removeFromParent(this.suitEff9):l=this.suitEff9),r&&(0==n&&h[1]<=0||2==n&&h[0]<=0)?(l.x=this[e+o.sex].x+r.offX,l.y=this[e+o.sex].y+r.offY,l.rotation=this[e+o.sex].rotation,l.scaleX=l.scaleY=r.scaling,l.playFile(RES_DIR_EFF+r.inShowEff,-1),i.addChild(l)):DisplayUtils.removeFromParent(l)},e}(BaseItemRender);__reflect(RoleItemRenderer.prototype,"RoleItemRenderer");var RoleSelectPanel=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.lastX=0,e.isTouchBegin=!1,e.rolesLength=1,e.initMc(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdd,e),e}return __extends(e,t),e.prototype.$onRemoveFromStage=function(){t.prototype.$onRemoveFromStage.call(this),this.destructor()},e.prototype.childrenCreated=function(){this.init()},e.prototype.initMc=function(){this.roleMovie=[];for(var t=0;2>t;t++){var e=new MovieClip;e.x=44,e.y=44,e.touchEnabled=!1,this.roleMovie.push(e)}},e.prototype.hideTop=function(){this.leftImg.visible=!1,this.rightImg.visible=!1,this.bgImg.visible=!1},e.prototype.init=function(){this.roles=[this.role0,this.role1,this.role2];for(var t=0;2>t;t++){var e=this.roleMovie[t];this.roles[t+1].addChild(e)}},e.prototype.onAdd=function(){this.destructor(),this.parent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.parent.addEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this),this.addTouchEvent(this.recharge,this.onBtnClick),this.addTouchEvent(this.recharge0,this.onBtnClick),this.addTouchEvent(this,this.onClick),this.observe(GameLogic.ins().postSubRoleChange,this.updateRole),this.observe(Actor.ins().postLevelChange,this.updateRole),this.observe(UserVip.ins().postUpdateVipData,this.updateRole),this.observe(UserZs.ins().postZsData,this.updateRole),this.observe(Actor.ins().postGoldChange,this.initData),this.observe(Actor.ins().postYbChange,this.initData),this.setCurRole(this._curRole),this.updateRole(),this.initData()},e.prototype.initData=function(){CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold),CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb)},e.prototype.getCurRole=function(){return this._curRole},e.prototype.setCurRole=function(t){this._curRole=t;for(var e=0;e<this.roles.length;e++){var i=this.roles[e];i.selected=e==t}this.dispatchEventWith(egret.Event.CHANGE,!1,this._curRole)},e.prototype.onBtnClick=function(t){switch(t.currentTarget){case this.recharge0:var e=Recharge.ins().getRechargeData(0);e&&2==e.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win);break;case this.recharge:Shop.openBuyGoldWin()}},e.prototype.onClick=function(t){var e=this.roles.indexOf(t.target);e>-1&&this.changeRole(e)},e.prototype.onMove=function(t){if(this.headGroup.visible&&this.parent&&this.parent.touchEnabled&&!this.isPass())switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.lastX=t.stageX,this.isTouchBegin=!0;break;case egret.TouchEvent.TOUCH_END:if(!this.isTouchBegin)break;this.isTouchBegin=!1;var e=this._curRole;this.lastX-t.stageX>=100?(e++,e>this.rolesLength&&(e=0),this.changeRole(e)):this.lastX-t.stageX<=-100&&(e--,0>e&&(e=this.rolesLength),this.changeRole(e))}},e.prototype.isPass=function(){var t=ViewManager.ins().getView(ForgeWin);if(t&&t.isNotMove)return!0;var e=ViewManager.ins().getView(AdvanEquipWin);return e&&e.isNotMove?!0:!1},e.prototype.changeRole=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);e?this.setCurRole(t):(ViewManager.ins().open(NewRoleWin),Assert(this.roles[t],"RoleSelectPanel changeRole value:"+t)||(this.roles[t].selected=!1))},e.prototype.updateRole=function(){var t,e,i=this.roles.length;this.rolesLength=SubRoles.ins().subRolesLen-1;for(var s=0;i>s;s++){if(t=this.roles[s],e=SubRoles.ins().getSubRoleByIndex(s))t.jobImg.visible=!0,t.jobImg.source="job"+e.job+"Item",t.stageImg.visible=!1,t.stageImg.source="",t.icon="yuanhead"+e.job+e.sex,this.roleMovie[s-1]&&DisplayUtils.removeFromParent(this.roleMovie[s-1]);else{var n=GlobalConfig.NewRoleConfig[s];if(!n){var o=egret.getQualifiedClassName(this.parent);Assert(!1,"角色索引"+s+"不存在，出错类："+o);continue}t.jobImg.visible=!1,t.stageImg.visible=!0,n.zsLevel?UserZs.ins().lv<n.zsLevel?t.stageImg.source="toujiesuo"+n.zsLevel:t.stageImg.source="toujiesuo":Actor.level<n.level?t.stageImg.source="toujiesuo"+n.level:t.stageImg.source="toujiesuo",n.vip&&UserVip.ins().lv>=n.vip&&(t.stageImg.source="toujiesuo"),t.icon=""}this.roleMovie[s-1]&&"toujiesuo"==t.stageImg.source&&t.stageImg.visible&&(this.roleMovie[s-1].playFile(RES_DIR_EFF+"juesejiesuo",-1),this.showRedPoint(s,!0))}},e.prototype.showRedPoint=function(t,e){null!=this.roles&&(this.roles[t].redPoint.visible=e)},e.prototype.clearRedPoint=function(){for(var t=0;t<this.roles.length;t++)this.roles[t].redPoint.visible=!1},e.prototype.openRole=function(){this.headGroup.visible=!0},e.prototype.hideRole=function(){this.headGroup.visible=!1},e.prototype.destructor=function(){this.parent&&(this.parent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.parent.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this))},e}(BaseView);__reflect(RoleSelectPanel.prototype,"RoleSelectPanel");var SkillPanel=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.curIndex=0,e}return __extends(e,t),e.prototype.init=function(){this.curRole=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.all,this.onAllUpgrade);for(var i=0;5>i;i++){var s=this["skillItem"+(i+1)];this.addTouchEvent(s,this.onSelect),this.addTouchEvent(s.grewUpAllBtn,this.onSingleUpgrade)}this.observe(UserSkill.ins().postSkillUpgradeAll,this.grewupAllSkillCB),this.updateAllSkillItemAndDesc()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.all,this.onAllUpgrade);for(var i=0;5>i;i++){var s=this["skillItem"+(i+1)];this.removeTouchEvent(s,this.onSelect),this.removeTouchEvent(s.grewUpAllBtn,this.onSingleUpgrade)}this.removeObserve(),DisplayUtils.removeFromParent(this.mc),this.mc=null},e.prototype.showHint=function(){var t;t=Actor.level>=80?"|C:0xf3311e&T:技能等级达到上限，请提高转生|":"|C:0xf3311e&T:技能等级不能超过人物等级|",UserTips.ins().showTips(t)},e.prototype.onSelect=function(t){var e=UserSkill.ins().getSkillLimitLevel();switch(t.currentTarget){case this.skillItem1:if(e<GlobalConfig.SkillsOpenConfig[1].level)return;this.curIndex=0;break;case this.skillItem2:if(e<GlobalConfig.SkillsOpenConfig[2].level)return;this.curIndex=1;break;case this.skillItem3:if(e<GlobalConfig.SkillsOpenConfig[3].level)return;this.curIndex=2;break;case this.skillItem4:if(e<GlobalConfig.SkillsOpenConfig[4].level)return;this.curIndex=3;break;case this.skillItem5:if(e<GlobalConfig.SkillsOpenConfig[5].level)return;this.curIndex=4}this.setSkillItem()},e.prototype.onSingleUpgrade=function(t){switch(t.currentTarget.parent){case this.skillItem1:this.onSendUpgrade(0),this.curIndex=0;break;case this.skillItem2:this.onSendUpgrade(1),this.curIndex=1;break;case this.skillItem3:this.onSendUpgrade(2),this.curIndex=2;break;case this.skillItem4:this.onSendUpgrade(3),this.curIndex=3;break;case this.skillItem5:this.onSendUpgrade(4),this.curIndex=4}SoundUtil.ins().playEffect(SoundUtil.SKILL_UP),this.setSkillItem()},e.prototype.onAllUpgrade=function(t){this.onSendUpgrade(0,!0),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP),this.setSkillItem()},e.prototype.onSendUpgrade=function(t,e){void 0===e&&(e=!1),UserSkill.ins().sendGrewUpAllSkill(this.curRole,e,t)},e.prototype.updateAllSkillItemAndDesc=function(){DisplayUtils.removeFromParent(this.mc),this.mc=null,this.updateAllSkillItem(),this.setSkillItem()},e.prototype.updateAllSkillItem=function(){this.isUpGrade=!1;for(var t=0;5>t;t++){var e=this["skillItem"+(t+1)],i=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!i)return;var s=i.skillsData[t];s.lv<=0?(UserSkill.ins().getSkillLimitLevel()>=GlobalConfig.SkillsOpenConfig[t+1].level?(e.lock.textColor=64865,e.lock.text="开启"):(e.lock.textColor=16580618,e.lock.text=GlobalConfig.SkillsOpenConfig[t+1].level+"级开启"),e.lock.visible=!0,e.lv.text="",e.costAll.visible=!1,e.coinIcon1.visible=!1,e.grewUpAllBtn.visible=!1):(e.lock.visible=!1,e.lv.text="Lv."+s.lv,e.costAll.visible=!0,e.coinIcon1.visible=!0,e.grewUpAllBtn.visible=!0,this.setCost(e,t,s.lv)),e.icon.source=s.icon,e.skillName.text=s.name+"",e.skillDesc.textFlow=TextFlowMaker.generateTextFlow1(s.desc+"")}this.all.visible&&this.isUpGrade&&(this.mc||(this.mc=new MovieClip,this.mc.x=this.all.width/2,this.mc.y=this.all.height/2,this.all.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"chargeff1",-1)))},e.prototype.setCost=function(t,e,i){var s=GlobalConfig.SkillsUpgradeConfig[i].cost,n=Actor.level,o=Actor.gold;if(t.costAll.visible=t.coinIcon1.visible=!0,i>=UserSkill.ins().getSkillLimitLevel()){t.grewUpAllBtn.enabled=!1;var a=SubRoles.ins().getSubRoleByIndex(this.curRole).skillsData[this.curIndex];if(a.lv>=UserSkill.MAX_LEVEL)t.grewUpAllBtn.labelDisplay.text="已满级",t.costAll.visible=t.coinIcon1.visible=!1;else{var r=UserZs.ins();i>=80?t.grewUpAllBtn.labelDisplay.text=r.lv+1+"转可升":t.grewUpAllBtn.labelDisplay.text=n+1+"级可升"}o>=s?(t.costAll.textColor=3532333,t.costAll.text=s):(t.costAll.textColor=16580618,t.costAll.text=s)}else{var h=UserSkill.ins().getSingleSkillGrewUpCost(this.curRole,e);t.grewUpAllBtn.labelDisplay.text="一键升级",h>0?(this.isUpGrade=!0,t.costAll.textColor=3532333,t.costAll.text=h,t.grewUpAllBtn.enabled=!0):(t.costAll.textColor=16580618,t.costAll.text=s,t.grewUpAllBtn.enabled=!1)}},e.prototype.setSkillItem=function(){for(var t=0;5>t;t++){var e=this["skillItem"+(t+1)];e.select.visible=t==this.curIndex}},e.prototype.setRoleId=function(t){this.curRole=t,this.updateAllSkillItemAndDesc()},e.prototype.grewupAllSkillCB=function(t){var e=t[0];if(t[1]==this.curRole){for(var i=SubRoles.ins().getSubRoleByIndex(this.curRole),s=0;s<e.length;s++)e[s].lv&&e[s].lv<i.skillsData[s].lv&&this.grewupTip(e[s],i.skillsData[s],s);this.updateAllSkillItemAndDesc(),DisplayUtils.removeFromParent(this.mc),this.mc=null}},e.prototype.grewupTip=function(t,e,i){var s=this,n="",o=new eui.Label;o.size=20,o.textColor=2149168;var a;if(e.args)t.args?(a=e.args.b-t.args.b,n=e.name+"增加"+a+"点伤害"):Assert(!1,"SkillPanel.grewupTip() skillold.args is null!!新技能：id("+e.id+"),lv("+e.lv+") 旧技能：id("+t.id+"),lv("+t.lv+")");else if(t.tarEff&&e.tarEff){var r=GlobalConfig.EffectsConfig[t.tarEff[0]],h=GlobalConfig.EffectsConfig[e.tarEff[0]],l=Math.floor(e.id/1e3);switch(l){case SHORT_SKILLID.MAGIC:a=Math.ceil(1e3*(h.args.d-r.args.d))/10,n=e.name+"伤害减免增加"+a+"%";break;case SHORT_SKILLID.CURE:a=h.args.c-r.args.c,n=e.name+"增加"+a+"点治疗量";break;case SHORT_SKILLID.POISONING:a=h.args.c-r.args.c,n=e.name+"每秒失去"+a+"点生命";break;case SHORT_SKILLID.ARMOR:a=h.args.c-r.args.c,n=e.name+"增加"+a+"点物防和魔防";break;case SHORT_SKILLID.SUMMON:a=h.args.a-r.args.a,n="神兽等级增加"+a}a=h.args.d-r.args.d}else e.tarEff&&Assert(!1,"SkillPanel.grewupTip() skillold.tarEff is null!!新技能：id("+e.id+"),lv("+e.lv+") 旧技能：id("+t.id+"),lv("+t.lv+")");var c=this["skillItem"+(i+1)];o.text=n;var u=c.x+c.width/2-o.textWidth/2,p=c.y+c.height/4;o.x=u,o.y=p,this.addChild(o);var d=new MovieClip;d.x=65,d.y=p+20,d.playFile(RES_DIR_EFF+"forgeSuccess",1),this.addChild(d);var g=egret.Tween.get(o);g.to({y:o.y-45},600).wait(1e3).call(function(){s.removeChild(o)},this)},e}(BaseView);__reflect(SkillPanel.prototype,"SkillPanel");var SmeltEquipNormalPanel=function(t){function e(){var e=t.call(this)||this;return e.viewIndex=0,e.name="普通装备",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.smeltEquips=[],this.smeltEquips.length=9,this.itemList.itemRenderer=SmeltEquipItem,this.dataInfo=new eui.ArrayCollection(this.smeltEquips),this.itemList.dataProvider=this.dataInfo,this.eff=new MovieClip,this.eff.x=78,this.eff.y=30,this.eff.scaleX=1,this.eff.scaleY=1,this.eff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.itemList,this.onTap),this.addTouchEvent(this.smeltLable,this.onTap),this.addTouchEvent(this.backbtn,this.onTap),this.setItemData(),this.observe(UserEquip.ins().postSmeltEquipComplete,this.smeltComplete),this.observe(UserEquip.ins().postEquipCheckList,this.setItemList),this.observe(UserEquip.ins().postSmeltEquipComplete,this.smeltShowTips)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.smeltBtn,this.onTap),this.removeTouchEvent(this.itemList,this.onTap),this.removeTouchEvent(this.smeltLable,this.onTap),this.removeTouchEvent(this.backbtn,this.onTap),this.removeObserve(),DisplayUtils.removeFromParent(this.eff),TimerManager.ins().remove(this.AutoSmeltEquip,this)},e.prototype.smeltShowTips=function(t){for(var e=0;e<t.length;e++){var i=t[e],s=GlobalConfig.EquipConfig[i.itemId];if(s){var n=GlobalConfig.ItemConfig[s.id];if(n){var o=ItemConfig.getQualityColor(n),a="获得|C:"+o+"&T:"+n.name+" x "+i.count+"|",r=this.smeltBtn.localToGlobal();UserTips.ins().showEverTips({str:a,x:r.x-25,y:r.y-45})}}}},e.prototype.smeltComplete=function(){for(var t=this.itemList.numChildren;t--;)this.itemList.getChildAt(t).playEff();this.setItemData()},e.prototype.setItemData=function(){this.smeltEquips=UserBag.ins().getOutEquips(),this.dataInfo.replaceAll(this.smeltEquips),"取消熔炼"!=this.smeltBtn.label&&this.setBtnLabel()},e.prototype.setItemList=function(t){this.dataInfo.replaceAll(t),this.itemList.dataProvider=this.dataInfo},e.prototype.getGuildButton=function(){return this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.btnGroup.addChild(this.eff),this.smeltBtn},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:if(Recharge.ins().franchise)"取消熔炼"==this.smeltBtn.label?(this.setBtnLabel(),TimerManager.ins().remove(this.AutoSmeltEquip,this)):TimerManager.ins().isExists(this.AutoSmeltEquip,this)||(this.smeltBtn.label="取消熔炼",TimerManager.ins().doTimer(200,0,this.AutoSmeltEquip,this));else{DisplayUtils.removeFromParent(this.eff);var e=UserEquip.ins().sendSmeltEquip(this.viewIndex,this.smeltEquips);e&&SoundUtil.ins().playEffect(SoundUtil.SMELT)}break;case this.itemList:var i=t.target;if(i&&i.data){var s=this.smeltEquips.indexOf(i.data);s>=0&&(this.smeltEquips.splice(s,1),i.data=null)}break;case this.smeltLable:break;case this.backbtn:ViewManager.ins().close(SmeltEquipTotalWin)}},e.prototype.AutoSmeltEquip=function(){DisplayUtils.removeFromParent(this.eff);var t=UserEquip.ins().sendSmeltEquip(this.viewIndex,this.smeltEquips);t?SoundUtil.ins().playEffect(SoundUtil.SMELT):(this.setBtnLabel(),TimerManager.ins().remove(this.AutoSmeltEquip,this))},e.prototype.setBtnLabel=function(){Recharge.ins().franchise?this.smeltBtn.label="一键熔炼":this.smeltBtn.label="熔  炼"},e}(BaseComponent);__reflect(SmeltEquipNormalPanel.prototype,"SmeltEquipNormalPanel");var SmeltItemList=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof RewardData&&(this.itemConfig=GlobalConfig.ItemConfig[this.data.id],this.num=this.data.count,this.itemIcon.setData(this.itemConfig),this.setCount(this.num+""),this.nameTxt.text=this.itemConfig.name)},e}(ItemBase);__reflect(SmeltItemList.prototype,"SmeltItemList");var SmeltItemNormalPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.itemDataList=[],this.selectList=[],this.smeltEquips=[],this.smeltEquips.length=9,this.itemList.itemRenderer=SmeltEquipItem,this.getItemList.itemRenderer=SmeltItemList,this.dataInfo=new eui.ArrayCollection(this.smeltEquips),this.itemList.dataProvider=this.dataInfo,this.getItemCollection=new eui.ArrayCollection,this.getItemList.dataProvider=this.getItemCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemDataList=t[0],this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.itemList,this.onTap),this.addTouchEvent(this.backbtn,this.onTap),this.setItemData(),this.observe(UserForge.ins().postMeltItem,this.smeltComplete)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.smeltComplete=function(){for(var t=0;t<this.selectList.length;t++)for(var e=0;e<this.itemList.numElements;e++){var i=this.itemList.dataProvider.getItemAt(e);if(i.handle==this.selectList[t].handle){var s=this.itemList.getVirtualElementAt(e);this.itemList.removeChild(s),this.itemDataList[e]&&this.itemDataList.splice(e,1);break}}this.selectList=[],SoundUtil.ins().playEffect(SoundUtil.SMELT),this.setItemData()},e.prototype.setItemData=function(){this.smeltEquips=this.updateList(),this.dataInfo.replaceAll(this.smeltEquips),this.updateFJlist()},e.prototype.updateList=function(){for(var t=[],e=0;e<this.smeltEquips.length&&this.itemDataList[e];e++)t.push(this.itemDataList[e]);return t},e.prototype.updateFJlist=function(){var t=[];for(var e in this.selectList){var i=GlobalConfig.RongLuExpConfig[this.selectList[e].configID],s=!1;
t:for(var n in t)for(var o in i.reward)if(t[n].id==i.reward[o].id){t[n].count+=i.reward[o].count*this.selectList[e].count,s=!0;break t}if(!s){var a=new RewardData;a.type=i.reward[e].type,a.id=i.reward[e].id,a.count=i.reward[e].count*this.selectList[e].count,t.push(a)}}this.getItemCollection.replaceAll(t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:if(this.selectList.length<=0)return void UserTips.ins().showTips("未选中需要分解的道具");UserForge.ins().sendMeltItem(this.selectList);break;case this.itemList:var e=t.target;if(e&&e.data){var i=this.selectList.indexOf(e.data);-1==i?(e.selectFrame.visible=!0,this.selectList.push(e.data)):(e.selectFrame.visible=!1,this.selectList.splice(i,1))}this.updateFJlist();break;case this.backbtn:ViewManager.ins().close(SmeltItemTotalWin)}},e}(BaseComponent);__reflect(SmeltItemNormalPanel.prototype,"SmeltItemNormalPanel");var SmeltItemTotalWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguRongluSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.equip.open(t[0]),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.equip.close()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(SmeltItemTotalWin.prototype,"SmeltItemTotalWin"),ViewManager.ins().reg(SmeltItemTotalWin,LayerManager.UI_Popup);var WingAttrWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WingAttrSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.setRoleAttr(this.curRole),this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.closeBtn,this.onClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this),this.removeTouchEvent(this.closeBtn,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.setRoleAttr=function(t){this.wingsData=SubRoles.ins().getSubRoleByIndex(t).wingsData;var e=GlobalConfig.WingLevelConfig[this.wingsData.lv];this.attr.text=AttributeData.getAttStr(e.attr,1)},e}(BaseEuiView);__reflect(WingAttrWin.prototype,"WingAttrWin"),ViewManager.ins().reg(WingAttrWin,LayerManager.UI_Main);var WingEquipItemrender=function(t){function e(){var e=t.call(this)||this;return e.skinName="WingEquipItemSkin",e.addEventListener(egret.TouchEvent.TOUCH_END,e.onClick,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.curRole,i=t.data;this.role=SubRoles.ins().getSubRoleByIndex(e),this.itemConfig=i.itemConfig,this.item0.setData(i.itemConfig),this.equipXuqiu.text="需求：羽翼达到"+(this.itemConfig.level+1)+"阶",this.equipXuqiu.textColor=15937822,this.equipName.text=i.itemConfig.name,this.score.text="评分："+i.point},e.prototype.descut=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){this.openEquipsTips()},e.prototype.openEquipsTips=function(){ViewManager.ins().open(EquipDetailedWin,1,this.data.data.handle,this.itemConfig.id,this.data.data,this.role)},e}(BaseItemRender);__reflect(WingEquipItemrender.prototype,"WingEquipItemrender");var WingPanel=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e._lastLv=0,e._isAutoUp=!1,e.barbc=new ProgressBarEff,e.currViewNum=0,e.lastTimeDown=0,e.rapetNum=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.boostPrice1.setType(MoneyConst.wing),this.barbc.setWidth(525),this.barbc.x=10,this.barbc.y=-15,this.expGroup.addChild(this.barbc),this.mc=new MovieClip,this.mc.x=214,this.mc.y=245,this.wingImg.touchEnabled=!1,this.reliveEff=new MovieClip,this.reliveEff.x=280,this.reliveEff.y=588,this.reliveEff.scaleX=1.3,this.reliveEff.scaleY=1.1,this.skillIconArr=[];for(var t=0;5>t;t++)this.skillIconArr[t]=this["itemicon"+t];this.danItemID=GlobalConfig.WingCommonConfig.levelItemid},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.openStatusBtn,this.onTap),this.addTouchEvent(this.boostBtn1,this.onTap),this.addTouchEvent(this.checkBoxs,this.isShowUpGradeBtn),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.bigUpLevelBtn,this.onTap),this.addTouchEvent(this.boostBtn0,this.onTap),this.addTouchEvent(this.shenyu,this.onTap),this.addTouchEvent(this.feishengBtn,this.onTap),this.addTouchEvent(this.zizhiBtn,this.onTap);for(var i=0;5>i;i++)this.addTouchEvent(this.skillIconArr[i],this.skillItemClick);this.observe(Wing.ins().postBoost,this.showBoost),this.observe(Wing.ins().postWingUpgrade,this.updateLevel),this.observe(Wing.ins().postActivate,this.setWingData),this.observe(Wing.ins().postWingEquip,this.setWingData),this.observe(Wing.ins().postWingTime,this.setTimeDown),this.observe(UserBag.ins().postItemChange,this.isShowUpGradeBtn),this.observe(UserBag.ins().postItemAdd,this.isShowUpGradeBtn),this.observe(UserBag.ins().postItemDel,this.isShowUpGradeBtn),this.observe(GodWingRedPoint.ins().postGodWingRedPoint,this.updateRedPoint),this.observe(Wing.ins().postUseDanSuccess,this.setWingData),this.barbc.reset(),this.setWingData(),this.updateLevel(),this.updateRedPoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.openStatusBtn,this.onTap),this.removeTouchEvent(this.boostBtn1,this.onTap),this.removeTouchEvent(this.checkBoxs,this.isShowUpGradeBtn),this.removeTouchEvent(this.rightBtn,this.onTap),this.removeTouchEvent(this.leftBtn,this.onTap),this.removeTouchEvent(this.boostBtn0,this.onTap),this.removeTouchEvent(this.bigUpLevelBtn,this.onTap),this.removeTouchEvent(this.shenyu,this.onTap),this.removeTouchEvent(this.feishengBtn,this.onTap),this.removeTouchEvent(this.zizhiBtn,this.onTap);for(var i=0;5>i;i++)this.removeTouchEvent(this.skillIconArr[i],this.skillItemClick);TimerManager.ins().remove(this.autoUpStar,this),this.removeObserve(),this._isAutoUp&&this.stopAutoUp(),TimerManager.ins().remove(this.refushTimeLabel,this)},e.prototype.updateLevel=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole).wingSkillData,e=0,i=0;5>i;i++)if(t[i]&&t[i]>0)this.skillIconArr[i].data=t[i],this["openTxt"+i].text="",e=i+1;else{var s=Wing.ins().getLevelBySkill(i);this["openTxt"+i].text=s+1+"阶开启";var n=GlobalConfig.WingLevelConfig[s];n&&n.pasSkillId&&(this.skillIconArr[i].data=n.pasSkillId,this.skillIconArr[i].blackImg.visible=!0)}if(5>e){var o=void 0,a=GlobalConfig.WingLevelConfig,r=0;for(var h in a){var n=a[h];if(n&&n.pasSkillId){if(o=n.pasSkillId,r==e)break;r++}}o&&(this.skillIconArr[e].data=o,this.skillIconArr[e].blackImg.visible=!0)}this._isAutoUp&&this.stopAutoUp(),this.setWingData()},e.prototype.updateDans=function(){this.redPoint1.visible=Wing.ins().canUseFlyUpByRoleID(this.curRole),this.redPoint2.visible=Wing.ins().canUseAptitudeByRoleID(this.curRole)},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.openStatusBtn:Actor.level>=GlobalConfig.WingCommonConfig.openLevel?this.showOpenMovie():UserTips.ins().showTips("|C:0xf3311e&T:等级不够，无法激活|");break;case this.boostBtn1:this._isAutoUp&&this.stopAutoUp(),this.autoUpStar();break;case this.rightBtn:this.currViewNum++,this.setSeeBtnStatu(),this.setWingView(this.currViewNum);break;case this.leftBtn:this.currViewNum--,this.setSeeBtnStatu(),this.setWingView(this.currViewNum);break;case this.boostBtn0:"停 止"==this.boostBtn0.label?this._isAutoUp&&this.stopAutoUp():(this._isAutoUp=!0,this.boostBtn0.label="停 止",TimerManager.ins().doTimer(150,0,this.autoUpStar,this));break;case this.bigUpLevelBtn:var i=GlobalConfig.ItemConfig[this.danItemID].name;WarnWin.show("确定使用"+i+"提升羽翼吗？\n说明：\n"+GlobalConfig.ItemConfig[this.danItemID].desc,function(){Wing.ins().sendBigUpLevel(e.curRole)},this);break;case this.shenyu:ViewManager.ins().open(GodWingWin);break;case this.feishengBtn:ViewManager.ins().open(WingFeishengTipsWin,this.curRole);break;case this.zizhiBtn:ViewManager.ins().open(WingZizhiTipsWin,this.curRole)}},e.prototype.skillItemClick=function(t){var e=this.skillIconArr.indexOf(t.currentTarget);if(e>=0){if(!this.skillIconArr[e].skillIcon.visible)return;ViewManager.ins().open(WingSkillTipPanel,Wing.ins().getWingSkillByIndex(e))}},e.prototype.stopAutoUp=function(){this._isAutoUp=!1,this.boostBtn0.label="一键升阶",TimerManager.ins().remove(this.autoUpStar,this)},e.prototype.autoUpStar=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv],e=UserBag.ins().getBagGoodsCountById(0,t.itemId);e>=t.itemNum?Wing.ins().sendBoost(this.curRole,0):this.checkBoxs.selected?Actor.yb>=t.itemNum*t.itemPrice?Wing.ins().sendBoost(this.curRole,1):this.stopAutoUp():(this.stopAutoUp(),UserTips.ins().showTips("|C:0xf3311e&T:羽毛不足，可自动消耗元宝升级|"))},e.prototype.notOpenStatus=function(){this.expGroup.visible=!1,this.skillGroup.visible=!1,this.barbc.visible=!1,this.boostBtn0.visible=!1,this.boostBtn1.visible=!1,this.boostPrice1.visible=!1,this.powerPanel.visible=!1,this.openStatusBtn.visible=!0,this.rightBtn.visible=!1,this.leftBtn.visible=!1,this.jihuo.visible=!1,this.weijihuo.visible=!0,this.wing.visible=!0,this.dor1.x=2,this.dor2.x=558,this.shan.visible=!1;var t=GlobalConfig.WingCommonConfig.openLevel>Actor.level;this.jihuolv.visible=t,this.jihuolv.text=GlobalConfig.WingCommonConfig.openLevel+"级开启",this.bigUpLevelBtn.visible=this.redPoint.visible=!1,t||(this.reliveEff.playFile(RES_DIR_EFF+"chargeff1",-1),this.weijihuo.addChild(this.reliveEff))},e.prototype.openStatusOpen=function(){this.skillGroup.visible=!0,this.openStatusBtn.visible=!1,this.barbc.visible=!0,this.boostBtn0.visible=!0,this.boostBtn1.visible=!0,this.powerPanel.visible=!0,this.rightBtn.visible=!0,this.leftBtn.visible=!0,this.jihuo.visible=!0,this.weijihuo.visible=!1,this.bigUpLevelBtn.visible=!0,this._wingsData.lv>=Wing.WingMaxLv?(this.arrows.visible=!1,this.nextAttrLabel.text="",this.attrLabel.horizontalCenter=0,this.expGroup.visible=!1,this.maxInfo.visible=!0):(this.arrows.visible=!0,this.attrLabel.horizontalCenter=-100,this.expGroup.visible=!0,this.maxInfo.visible=!1),this.redPoint.visible=this.bigUpLevelBtn.visible&&this._wingsData.lv==Wing.WingExpRedPoint,this.shenyu.visible=GameServer.serverOpenDay+1>=GlobalConfig.WingCommonConfig.openDay?!0:!1},e.prototype.showBoost=function(t){var e=this,i=t[0],s=t[1],n=new eui.Label;n.size=20;var o="";n.textColor=3532333,o="羽翼经验 + ",n.x=225,n.y=326,n.text=o+s,this.addChild(n);var a=egret.Tween.get(n);if(a.to({y:n.y-45},500).call(function(){e.removeChild(n)},this),i&&(2==i||5==i)){var r=new eui.Image("xn_wingup"+i);r.horizontalCenter=0,r.verticalCenter=0,r.scaleX=r.scaleY=.5;var h=egret.Tween.get(r);h.to({scaleX:1.5,scaleY:1.5,alpha:0},500).call(function(){DisplayUtils.removeFromParent(r)},this),this.actEff.addChild(r)}this.expBarChange(),this.updateAtt(),this.isShowUpGradeBtn()},e.prototype.setWingView=function(t){if(this.updateDans(),!(t>Wing.WingMaxLv||0>t)){var e=GlobalConfig.WingLevelConfig[t];this.wingImg.source=e.appearance+"_png",this.nameTxt.text=e.name}},e.prototype.setWingData=function(){this._wingsData=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData,this.wingImg.source=this._wingsData.getImgSource(),this.currViewNum=this._wingsData.lv,this.setSeeBtnStatu();var t=GlobalConfig.WingLevelConfig[this._wingsData.lv];return this.nameTxt.text=t.name,this.updateDans(),this._wingsData.openStatus?(this.openStatusOpen(),this.expBarChange(),this.updateAtt(),this.isShowUpGradeBtn(),this.setTimeDown(),0==this._lastLv&&(this._lastLv=this._wingsData.lv),void(this._lastLv!=this._wingsData.lv&&(this._lastLv=this._wingsData.lv))):void this.notOpenStatus()},e.prototype.setSeeBtnStatu=function(){this.currViewNum>=Wing.WingMaxLv||this.currViewNum>=this._wingsData.lv+1?(this.rightBtn.enabled=!1,this.leftBtn.enabled=!0):this.currViewNum<=0?(this.leftBtn.enabled=!1,this.rightBtn.enabled=!0):(this.leftBtn.enabled=!0,this.rightBtn.enabled=!0)},e.prototype.setTimeDown=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv];t&&(TimerManager.ins().remove(this.refushTimeLabel,this),t.clearTime?(this.clearGroup.visible=!0,this._wingsData.clearTime>0?(this.lastTime.text="剩余时间：",this.lastTimeDown=Math.floor((DateUtils.formatMiniDateTime(this._wingsData.clearTime)-GameServer.serverTime)/1e3),this.lastTimeDown=Math.max(0,this.lastTimeDown),this.timeLabel.text=DateUtils.getFormatBySecond(this.lastTimeDown,1),TimerManager.ins().remove(this.refushTimeLabel,this),TimerManager.ins().doTimer(1e3,this.lastTimeDown,this.refushTimeLabel,this)):(this.lastTime.text="",this.timeLabel.text="",TimerManager.ins().remove(this.refushTimeLabel,this))):this.clearGroup.visible=!1,this.noclean.visible=!this.clearGroup.visible)},e.prototype.refushTimeLabel=function(){this.lastTimeDown>0&&(--this.lastTimeDown,this.timeLabel.text=DateUtils.getFormatBySecond(this.lastTimeDown,1))},e.prototype.updateAtt=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv],e=GlobalConfig.WingLevelConfig[this._wingsData.lv+1],i=0;this._totalPower=UserBag.getAttrPower(t.attr);var s=this.getDanAttrs(this._wingsData.lv);if(this._totalPower+=UserBag.getAttrPower(s),this.attrLabel.text=AttributeData.getAttStr(AttributeData.AttrAddition(s,t.attr),1),this._wingsData&&this._wingsData.exp&&e){for(var n=[],o=e.attr,a=GlobalConfig.WingCommonConfig.tempattr?GlobalConfig.WingCommonConfig.tempattr:1,r=0;r<o.length;r++){var h=new AttributeData;h.type=o[r].type,h.value=Math.ceil(this._wingsData.exp/t.exp*(a*o[r].value)),n.push(h)}this.attrTempLabel.text=AttributeData.getAttStr(n,1,1,"（临时+",!1,!1,null,"）"),i=UserBag.getAttrPower(n),this.attrGroup.horizontalCenter=-143}else this.attrTempLabel.text="",this.attrGroup.horizontalCenter=-100;this._totalPower=this._totalPower+i,this.powerPanel.setPower(this._totalPower),this._wingsData.lv<Wing.WingMaxLv&&(this.nextAttrLabel.text=AttributeData.getAttStr(AttributeData.AttrAddition(s,e.attr),1))},e.prototype.getDanAttrs=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=GlobalConfig.WingLevelConfig[t],s=i.attr.length,n=[],o=0;s>o;o++)n.push(new AttributeData(i.attr[o].type,Math.floor(i.attr[o].value*GlobalConfig.WingCommonConfig.flyPill/1e4*e.wingsData.flyUpDan)));var a=GlobalConfig.WingCommonConfig.attrPill;s=a.length;for(var o=0;s>o;o++)n.push(new AttributeData(a[o].type,a[o].value*e.wingsData.aptitudeDan));a=GlobalConfig.WingCommonConfig.flyPillAttr,s=a.length;for(var o=0;s>o;o++)n.push(new AttributeData(a[o].type,a[o].value*e.wingsData.flyUpDan));return n},e.prototype.expBarChange=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv],e=t.exp;this.barbc.getMaxValue()!=e?this.barbc.setData(this._wingsData.exp,e):this.barbc.setValue(this._wingsData.exp)},e.prototype.isShowUpGradeBtn=function(){if(this.updateDans(),!(this._wingsData.lv>=Wing.WingMaxLv)){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv];if(this._wingsData.lv>=Wing.WingMaxLv)this.boostBtn1.visible=!1,this.boostPrice1.visible=!1,this.bigUpLevelBtn.visible=!1;else{this.boostBtn1.visible=!0,this.boostPrice1.visible=!0;var e=UserBag.ins().getBagGoodsCountById(0,this.danItemID);this.bigUpLevelBtn.visible=e>0;var i=UserBag.ins().getBagItemById(t.itemId);i?i.count<t.itemNum&&this.checkBoxs.selected?(this.boostPrice1.setType(MoneyConst.yuanbao),this.boostPrice1.setPrice(t.itemPrice*t.itemNum,Actor.yb)):(this.boostPrice1.setType(MoneyConst.wing),this.boostPrice1.setPrice(t.itemNum,i.count)):this.checkBoxs.selected?(this.boostPrice1.setType(MoneyConst.yuanbao),this.boostPrice1.setPrice(t.itemPrice*t.itemNum,Actor.yb)):(this.boostPrice1.setType(MoneyConst.wing),this.boostPrice1.setPrice(t.itemNum,0))}this.redPoint.visible=this.bigUpLevelBtn.visible&&this._wingsData.lv==Wing.WingExpRedPoint}},e.prototype.showOpenMovie=function(){var t=this;if(StageUtils.ins().setTouchChildren(!1),DisplayUtils.removeFromParent(this.reliveEff),this.openStatusBtn.visible=!1,!this.flyUpEffect){this.flyUpEffect=new MovieClip;var e=this.flyUpEffect.localToGlobal();e.x=290,e.y=400,this.flyUpEffect.globalToLocal(e.x,e.y,e),this.flyUpEffect.x=e.x,this.flyUpEffect.y=e.y}this.wingeff.addChild(this.flyUpEffect),this.flyUpEffect.playFile(RES_DIR_EFF+"functionopeneff",-1);var i=new egret.Sprite,s=new egret.Shape;s.graphics.beginFill(16777215),s.graphics.drawRect(0,0,640,640),s.graphics.endFill(),i.anchorOffsetX=0,i.anchorOffsetY=0;var n=i.localToGlobal();n.x=0,n.y=640,i.globalToLocal(n.x,n.y,n),i.x=n.x,i.y=n.y,i.addChild(s),this.wingeff.addChild(i),this.flyUpEffect.mask=i;var o=egret.Tween.get(i);o.to({y:0},1500).call(function(){egret.Tween.removeTweens(t.flyUpEffect),t.flyUpEffect.visible=!1,t.wingeff.removeChild(i),t.wingeff.removeChild(t.flyUpEffect),t.flowReckEffect()})},e.prototype.flowReckEffect=function(){var t=this;this.openEffect||(this.openEffect=new MovieClip,this.openEffect.x=290,this.openEffect.y=400),this.addChild(this.openEffect),this.openEffect.playFile(RES_DIR_EFF+"wingstart",1),TimerManager.ins().doTimer(500,1,function(){t.shan.visible=!0,t.openEffect.scaleX+=1,t.openEffect.scaleY+=1;egret.Tween.get(t.openEffect,{loop:!1,onChange:function(){var e=egret.Tween.get(t.dor1),i=egret.Tween.get(t.dor2),s=egret.Tween.get(t.shan);e.to({x:-280},500),i.to({x:838},500).call(function(){Wing.ins().sendActivate(t.curRole)},t),t.wing.visible=!1,s.to({alpha:0},500),DisplayUtils.removeFromParent(t.openEffect)}})},this)},e.prototype.updateRedPoint=function(){this._wingsData.openStatus?this.redPoint0.visible=GodWingRedPoint.ins().getGodWingRedPoint():this.redPoint0.visible=!1},e}(BaseView);__reflect(WingPanel.prototype,"WingPanel");var ZhuzaiEquipAdvancePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.initUI=function(){this.tab=[];for(var t=0;4>t;t++)this.tab.push(this["tab"+t]);this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获得材料</u>"),this.totalPower=BitmapNumber.ins().createNumPic(0,"1"),this.totalPower.x=185,this.totalPower.y=128,this.addChild(this.totalPower),this.tab[0].selected=!0,this.selectIndex=0,this.inited=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.inited||this.initUI(),this.roleSelectPanel.getCurRole=t&&t.length?t[0]:0,this.setEquipPoint(),this.setSelect(t&&t.length?t[1]:0),this.addTouchEvent(this.link,this.onClick),this.addTouchEvent(this.upgradeBtn0,this.onClick),this.addChangeEvent(this.roleSelectPanel,this.onChange);for(var i=0;this.tab&&i<this.tab.length;i++)this.addTouchEvent(this.tab[i],this.onClick);this.observe(ZhuzaiEquip.ins().postZhuZaiData,this.update)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.link,this.onClick),this.removeTouchEvent(this.upgradeBtn0,this.onClick),this.roleSelectPanel.removeEventListener(egret.Event.CHANGE,this.onChange,this);for(var i=0;this.tab&&i<this.tab.length;i++)this.removeTouchEvent(this.tab[i],this.onClick);this.removeObserve()},e.prototype.update=function(){this.setEquipPoint(),this.setData()},e.prototype.onChange=function(t){this.parent.parent.selectRole=this.roleSelectPanel.getCurRole(),this.update()},e.prototype.setData=function(){var t=this.selectIndex+1,e=this.roleSelectPanel.getCurRole(),i=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole()),s=i.getZhuZaiDataByIndex(this.selectIndex),n=s.lv;if(0==n)return this.currentState="not",void(this.totalPower.visible=!1);this.totalPower.visible=!0;var o=GlobalConfig.EquipPointGrowUpConfig[t][n],a=GlobalConfig.EquipPointGrowUpConfig[t][n+GlobalConfig.EquipPointConstConfig.rankGrowUp];this.curAtt.text=AttributeData.getAttStr(o.attrs,1),a&&(this.nextAtt.text=AttributeData.getAttStr(a.attrs,1));var r=SubRoles.ins().getSubRoleByIndex(e),h=r.getZhuZaiDataByIndex(this.selectIndex),l=h.rank,c=GlobalConfig.EquipPointRankConfig[t][l];if(this.currentState=c?"normal":"max",c){var u=c.rankUpItem.id,p=UserBag.ins().getBagGoodsCountById(0,u);this.useTxt0.text=p+" / "+c.rankUpItem.count,this.useTxt0.textColor=p<c.rankUpItem.count?15937822:3066402,this.countTxt0.text="消耗"+GlobalConfig.ItemConfig[u].name+"：",this.useTxt1.text=c.rankUpProbability/100+"%"}BitmapNumber.ins().changeNum(this.totalPower,UserBag.getAttrPower(o.attrs),"1")},e.prototype.setEquipPoint=function(){var t=GlobalConfig.EquipPointBasicConfig,e=0;for(e=0;e<this.tab.length;e++){var i=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole()),s=i.getZhuZaiDataByIndex(e);this.tab[e].icon="zzequip_"+(e+1)+GlobalConfig.EquipPointGrowUpConfig[e+1][s.lv].rank,s.growupID?(this.tab[e].label=t[e+1].name,this.tab[e].lvTxt.text="+"+s.growupID):(this.tab[e].label=(t[e+1].activationLevel/1e3>>0)+"转激活",this.tab[e].lvTxt.text=""),this.tab[e].redPoint.visible=s.canAdvance()}var n=SubRoles.ins().subRolesLen;for(e=0;n>e;e++)this.roleSelectPanel.showRedPoint(e,ZhuzaiEquip.ins().canAdvance(e))},e.prototype.setSelect=function(t){for(var e=0;e<this.tab.length;e++)e!=t&&(this.tab[e].selected=!1);this.tab[t].selected=!0,this.selectIndex=t,this.parent.parent.select=t,this.setData()},e.prototype.onClick=function(t){var e=this.tab.indexOf(t.currentTarget);if(e>=0)return void this.setSelect(e);var i=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole()),s=i.getZhuZaiDataByIndex(this.selectIndex),n=s.rank,o=GlobalConfig.EquipPointRankConfig[this.selectIndex+1][n],a=o.rankUpItem.id;switch(t.currentTarget){case this.link:UserWarn.ins().setBuyGoodsWarn(a,o.rankUpItem.count);break;case this.upgradeBtn0:if(UserBag.ins().getBagGoodsCountById(0,a)<o.rankUpItem.count)return void UserTips.ins().showTips("道具不足");ZhuzaiEquip.ins().sendShengjie(this.roleSelectPanel.getCurRole(),this.selectIndex+1)}},e}(BaseComponent);__reflect(ZhuzaiEquipAdvancePanel.prototype,"ZhuzaiEquipAdvancePanel");var ZhuZaiEquipGrowPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.initUI=function(){this.tab=[];for(var t=0;4>t;t++)this.tab.push(this["tab"+t]);this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获得材料</u>"),this.totalPower=BitmapNumber.ins().createNumPic(0,"1"),this.totalPower.x=185,this.totalPower.y=128,this.addChild(this.totalPower),this.tab[0].selected=!0,this.selectIndex=0,this.star=new StarList(5,0),this.star.x=150,this.star.y=290,this.addChild(this.star),this.inited=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.inited||this.initUI(),this.roleSelectPanel.getCurRole=t&&t.length?t[0]:0,this.setEquipPoint(),this.setSelect(t&&t.length?t[1]:0),this.addTouchEvent(this.link,this.onClick),this.addTouchEvent(this.upgradeBtn0,this.onClick),this.addChangeEvent(this.roleSelectPanel,this.onChange);for(var i=0;i<this.tab.length;i++)this.addTouchEvent(this.tab[i],this.onClick);this.observe(ZhuzaiEquip.ins().postZhuZaiData,this.update)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.link,this.onClick),this.removeTouchEvent(this.upgradeBtn0,this.onClick),this.roleSelectPanel.removeEventListener(egret.Event.CHANGE,this.onChange,this);for(var i=0;this.tab&&i<this.tab.length;i++)this.removeTouchEvent(this.tab[i],this.onClick);this.removeObserve()},e.prototype.update=function(){this.setEquipPoint(),this.setData()},e.prototype.onChange=function(t){this.parent.parent.selectRole=this.roleSelectPanel.getCurRole(),this.update()},e.prototype.setData=function(){var t=this.selectIndex+1,e=this.roleSelectPanel.getCurRole(),i=SubRoles.ins().getSubRoleByIndex(e),s=i.getZhuZaiDataByIndex(this.selectIndex),n=s.lv,o=GlobalConfig.EquipPointGrowUpConfig[t][n],a=GlobalConfig.EquipPointGrowUpConfig[t][n+1],r=o.needLevel;this.useTxt.text=(r/1e3>>0)+"转";var h=1e3*UserZs.ins().lv+Actor.level;this.useTxt.textColor=r>h?15937822:3066402,this.currentState=s.isMaxLevel()?"max":"normal",this.curAtt.text=AttributeData.getAttStr(o.attrs,1),a&&(this.nextAtt.text=AttributeData.getAttStr(a.attrs,1));var l=o.growUpItem.id,c=UserBag.ins().getBagGoodsCountById(0,l);this.useTxt0.text=c+" / "+o.growUpItem.count,this.useTxt0.textColor=c<o.growUpItem.count?15937822:3066402,this.countTxt0.text="消耗"+GlobalConfig.ItemConfig[l].name+"：",this.useTxt1.text=o.growUpProbability/100+"%",this.star.setStarNum(o.star),this.upgradeBtn0.label=o.growUpItem.count?n?"升 星":"激 活":"免费升级",BitmapNumber.ins().changeNum(this.totalPower,UserBag.getAttrPower(o.attrs),"1")},e.prototype.setEquipPoint=function(){var t=GlobalConfig.EquipPointBasicConfig,e=0;for(e=0;e<this.tab.length;e++){var i=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole()),s=i.getZhuZaiDataByIndex(e);this.tab[e].icon="zzequip_"+(e+1)+GlobalConfig.EquipPointGrowUpConfig[e+1][s.lv].rank,s.growupID?(this.tab[e].label=t[e+1].name,this.tab[e].lvTxt.text="+"+s.growupID):(this.tab[e].label=(t[e+1].activationLevel/1e3>>0)+"转激活",this.tab[e].lvTxt.text=""),this.tab[e].redPoint.visible=s.canLevelup()}var n=SubRoles.ins().subRolesLen;for(e=0;n>e;e++)this.roleSelectPanel.showRedPoint(e,ZhuzaiEquip.ins().canLevelup(e))},e.prototype.setSelect=function(t){for(var e=0;e<this.tab.length;e++)e!=t&&(this.tab[e].selected=!1);this.tab[t].selected=!0,this.selectIndex=t,this.parent.parent.select=t,this.setData()},e.prototype.onClick=function(t){var e=this.tab.indexOf(t.currentTarget);if(e>=0)return void this.setSelect(e);var i=SubRoles.ins().getSubRoleByIndex(this.roleSelectPanel.getCurRole()),s=i.getZhuZaiDataByIndex(this.selectIndex),n=s.lv,o=GlobalConfig.EquipPointGrowUpConfig[this.selectIndex+1][n],a=o.growUpItem.id;switch(t.currentTarget){case this.link:UserWarn.ins().setBuyGoodsWarn(a,o.growUpItem.count);break;case this.upgradeBtn0:var r=o.needLevel/1e3>>0,h=o.needLevel%1e3;if(r&&UserZs.ins().lv<r||Actor.level<h)return void UserTips.ins().showTips("转生等级不足");if(UserBag.ins().getBagGoodsCountById(0,a)<o.growUpItem.count)return void UserTips.ins().showTips("道具不足");ZhuzaiEquip.ins().sendGrow(this.roleSelectPanel.getCurRole(),this.selectIndex+1)}},e}(BaseComponent);__reflect(ZhuZaiEquipGrowPanel.prototype,"ZhuZaiEquipGrowPanel");var ZhuZaiFenjiePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.initUI=function(){this.list.dataProvider=new eui.ArrayCollection([]),this.useTxt0.text="",this.countTxt.text="",this.inited=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.inited||this.initUI(),this.startSetBagData(),this.addTouchEvent(this.btn,this.onTap),this.observe(UserBag.ins().postItemDel,this.startSetBagData)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.btn,this.onTap),this.removeObserve()},e.prototype.startSetBagData=function(){TimerManager.ins().doTimer(100,1,this.setBagData,this)},e.prototype.setBagData=function(){var t,e,i=[],s=GlobalConfig.EquipPointResolveConfig,n=0;for(e in s)t=UserBag.ins().getBagItemById(s[e].itemId),t&&(i.push(t),n+=t.count*s[e].materials[0].count);this.countTxt.text="可得"+GlobalConfig.ItemConfig[s[e].materials[0].id].name+"：",this.useTxt0.text=n+"",this.list.dataProvider=new eui.ArrayCollection(i)},e.prototype.onTap=function(){ZhuzaiEquip.ins().sendFenjie()},e}(BaseComponent);__reflect(ZhuZaiFenjiePanel.prototype,"ZhuZaiFenjiePanel");var ZsPanel=function(t){function e(){var e=t.call(this)||this;return e.lastZsLevel=-1,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获取修为</u>"),this.eff=new MovieClip,this.eff.x=420,this.eff.y=100,this.eff.touchEnabled=!1,this.eff.scaleX=.6,this.eff.scaleY=.5,this.upLevelEff=new MovieClip,this.upLevelEff.x=284,this.upLevelEff.y=314,this.upLevelEff.scaleX=this.upLevelEff.scaleY=2,this.upLevelEff.touchEnabled=!1,this.maxGroup.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEvents()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEvent()},e.prototype.addEvents=function(){this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.link,this.onTap),this.observe(UserZs.ins().postZsData,this.setData),this.observe(Actor.ins().postLevelChange,this.setData)},e.prototype.removeEvent=function(){this.removeTouchEvent(this.getBtn,this.onTap),this.removeTouchEvent(this.link,this.onTap),DisplayUtils.removeFromParent(this.eff),DisplayUtils.removeFromParent(this.upLevelEff),this.removeObserve()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.getBtn:var e=UserZs.ins(),i=GlobalConfig.ZhuanShengLevelConfig[e.lv+1];if(e.exp<i.exp)return void UserTips.ins().showTips("修为不足");UserZs.ins().sendZsUpgrade();break;case this.link:ViewManager.ins().open(GainZsWin)}},e.prototype.setData=function(){this.curAtt.lineSpacing=5,this.nextAtt.lineSpacing=5;var t=UserZs.ins();this.redPoint.visible=t.canUpgrade(),this.curZsLv.text="当前转生等级："+t.lv+"转",this.haveTxt.text=t.exp+"";var e=GlobalConfig.ZhuanShengLevelConfig[t.lv];this.curAtt.text=AttributeData.getAttStr(e,1);var i=[];for(var s in AttributeData.translate)if(!isNaN(e[s])){var n=new AttributeData;n.type=parseInt(AttributeData.translate[s]),n.value=e[s],i.push(n)}var o=SubRoles.ins().subRolesLen;this._totalPower=UserBag.getAttrPower(i)*o,this.powerPanel.setPower(this._totalPower);var a=GlobalConfig.ZhuanShengLevelConfig[t.lv+1];if(a)this.nextAtt.text=AttributeData.getAttStr(a,1),this.useTxt.text=a.exp+"",this.maxGroup.visible=!1,this.normalGroup.visible=!0;else{GlobalConfig.ZhuanShengLevelConfig[t.lv];this.group.visible=!1,this.curAtt.horizontalCenter=0,this.maxTxt.visible=!0,this.arrowImg.visible=!1,this.nextAtt.visible=!1,this.normalGroup.visible=!1,this.maxGroup.visible=!0;for(var r=0;r<i.length&&!(r>=4);r++)this["attr"+r].text=AttributeData.getAttStr(i[r],.5)}-1!=this.lastZsLevel&&this.lastZsLevel!=t.lv?(this.upLevelEff.parent||this.mainGroup.addChild(this.upLevelEff),this.upLevelEff.playFile(RES_DIR_EFF+"zhuanshengeff",1)):DisplayUtils.removeFromParent(this.upLevelEff),this.lastZsLevel=t.lv,t.canGet()&&a?(this.eff.parent||this.group.addChild(this.eff),this.eff.playFile(RES_DIR_EFF+"chargeff1",-1)):DisplayUtils.removeFromParent(this.eff)},e}(BaseView);__reflect(ZsPanel.prototype,"ZsPanel");var GuideUtils=function(_super){function GuideUtils(){var t=_super.call(this)||this;return t.step=0,t.part=0,t.wrongCount=0,t.maxWrongCount=2,t}return __extends(GuideUtils,_super),GuideUtils.ins=function(){return _super.ins.call(this)},GuideUtils.prototype.init=function(){if(!this.isInit){this.isInit=!0,0==Setting.currPart?(this.part=1,this.step=1):(this.part=Setting.currPart,this.step=Setting.currStep),this.cfg=[];var t;for(var e in GlobalConfig.GuideConfig){t=[];for(var i in GlobalConfig.GuideConfig[e])t.push(GlobalConfig.GuideConfig[e][i]);this.cfg.push(t)}if(this.part<=this.cfg.length){var s=this.cfg[this.part-1].length-1;this.overs=this.cfg[this.part-1][s].overs}this.part<=this.cfg.length&&MessageCenter.addListener(UserTask.ins().postUpdteTaskTrace,this.updateByTask,this)}},GuideUtils.prototype.updateByTask=function(){this.guideOver(),this.update(1)},GuideUtils.prototype.updateByClick=function(){this.update(2)},GuideUtils.prototype.updateByAppear=function(){this.update(3)},GuideUtils.prototype.canShow=function(){return Assert(this.cfg,"新手引导未初始化就调用 canShow()")?!1:this.part>this.cfg.length?(MessageCenter.ins().removeAll(this),!1):this.view&&this.view.parent?!1:!0},GuideUtils.prototype.checkShow=function(){if(!this.curCfg)return!1;
try{var t=this.getDisplayObj(this.part,this.step);if(!t)return!1}catch(e){return!1}return!0},GuideUtils.prototype.addTimeHandler=function(){TimerManager.ins().isExists(this.timeHandler,this)||TimerManager.ins().doTimer(50,0,this.timeHandler,this)},GuideUtils.prototype.removeTimeHandler=function(){TimerManager.ins().remove(this.timeHandler,this)},GuideUtils.prototype.timeHandler=function(){this.canShow()?this.checkShow()&&this.show(this.part,this.step):this.removeTimeHandler()},GuideUtils.prototype.guideOver=function(){var t=UserTask.ins().taskTrace;if(this.overs&&t&&0==t.state)for(var e=this.overs.length,i=0;e>i;i++){var s=this.overs[i];if(1==s.type&&s.value==t.id)return this.readyForNext(),void this.close()}},GuideUtils.prototype.update=function(t){if(void 0===t&&(t=0),0!=this.canShow()&&(this.curCfg=this.cfg[this.part-1][this.step-1],this.curCfg&&this.curCfg.start))if(1==t){if(1==this.curCfg.start.type){var e=UserTask.ins().taskTrace;e.id==this.curCfg.start.value&&0==e.state&&GuideUtils.ins().show(this.part,this.step)}else if(3==this.curCfg.start.type){var e=UserTask.ins().taskTrace;e.id==this.curCfg.start.value&&1==e.state&&GuideUtils.ins().show(this.part,this.step)}}else if(2==t){if(2==this.curCfg.start.type){var e=UserTask.ins().taskTrace;e.id==this.curCfg.start.value&&0==e.state&&GuideUtils.ins().show(this.part,this.step)}}else 3==t&&4==this.curCfg.start.type&&GuideUtils.ins().show(this.part,this.step)},GuideUtils.prototype.show=function(t,e){var i=this;this.part=t,this.step=e;var s=this.cfg[this.part-1];if(s?this.curCfg=this.cfg[this.part-1][this.step-1]:this.curCfg=null,!this.curCfg)return this.readyForNext(),void this.close();if(!this.checkShow())return this.close(),void this.addTimeHandler();null==this.view&&(this.view=new GuideView),this.view.clickCD=!0,this.view.hasEventListener(egret.Event.CHANGE)||this.view.addEventListener(egret.Event.CHANGE,this.next,this),this.save();var n;try{n=this.getDisplayObj(t,e)}catch(o){return this.wrongCount>=this.maxWrongCount?void this.close():(this.wrongCount++,this.view.close(),console.log("新手引导:"+t+","+e+"出错,重新播放"),void TimerManager.ins().doTimer(300,1,function(){i.show(t,e-1)},this))}n?(console.log("播放新手引导:"+t+","+e),TimerManager.ins().doNext(function(){i.view.show(n),StageUtils.ins().getStage().addChild(i.view)},this)):(this.readyForNext(),this.close())},GuideUtils.prototype.clickOut=function(){this.curCfg&&1==this.curCfg.type&&(this.readyForNext(),this.close())},GuideUtils.prototype.readyForNext=function(){if(this.part++,this.step=1,this.part<=this.cfg.length){var t=this.cfg[this.part-1].length-1;this.overs=this.cfg[this.part-1][t].overs}else this.overs=null;this.curCfg=null},GuideUtils.prototype.close=function(){this.view&&(DisplayUtils.removeFromParent(this.view),this.view.close(),this.view.removeEventListener(egret.Event.CHANGE,this.next,this),this.wrongCount=0),this.removeTimeHandler()},GuideUtils.prototype.next=function(){var t=this;TimerManager.ins().doNext(function(){t.show(t.part,t.step+1)},this)},GuideUtils.prototype.save=function(){1==this.step&&(Setting.ins().setValue(ClientSet.guidePart,this.part+1),Setting.ins().setValue(ClientSet.guideStep,1))},GuideUtils.prototype.getDisplayObj=function(part,step){var displayObject,cfg;return this.cfg[part-1]&&step<=this.cfg[part-1].length&&(cfg=this.cfg[part-1][step-1],displayObject=eval("ViewManager.ins().getView("+cfg.view+")."+cfg.target)),displayObject},GuideUtils}(BaseClass);__reflect(GuideUtils.prototype,"GuideUtils");var GameSystem;!function(t){t.guideUtils=GuideUtils.ins.bind(GuideUtils)}(GameSystem||(GameSystem={}));var GuideView=function(t){function e(){var e=t.call(this)||this;return e.rect=new egret.Rectangle(1,1,1,1),e.infoGroup=new eui.Group,e.infoGroup.touchEnabled=!1,e.infoGroup.touchChildren=!1,e.addChild(e.infoGroup),e.mc=new MovieClip,e.infoGroup.addChild(e.mc),e.arrowGroup=new eui.Group,e.infoGroup.addChild(e.arrowGroup),e.arrow=new GuideArrow,e.arrowGroup.addChild(e.arrow),e}return __extends(e,t),e.prototype.show=function(e){t.prototype.show.call(this,e),this.arrow.update(),this.mc.playFile(RES_DIR_EFF+"guideff",-1)},e.prototype.close=function(){t.prototype.close.call(this),this.arrow.close()},e}(GuideViewBase);__reflect(GuideView.prototype,"GuideView");var CharEncounter=function(t){function e(){var e=t.call(this)||this;return e.lastRunTime=0,e.atkTime=-1500,e.atkCount=0,e.posCount=0,e.touchEnabled=!1,e._role=new CharRole,e._role.touchEnabled=!0,e._monster=new CharMonster,e._monster.x=e.x+30,e._monster.y=e.y+30,e._role.x=e.x,e._role.y=e.y,e}return __extends(e,t),e.prototype.autoAtk=function(){var t=this;this.atkTime=egret.getTimer(),this._role.stopMove(),this.atkCount++,this._monster.dir=DirUtil.get8DirBy2Point(this._monster,this._role),this._role.AI_STATE=AI_State.Atk;var e=egret.getTimer(),i=e-this.lastRunTime>2e3;if(this.lastRunTime=e,!i){var s=this._role.infoModel;if(void 0==s)return void Log.trace("遭遇敌人自动攻击异常，本角色model为空");this.skillData=SkillData.getSkillByJob(s.job),10*Math.random()>9&&this.atkCount>2?this.killMonster():(GameLogic.ins().playSkillEff(this.skillData,this._role,[this._monster]),this._monster.playAction(EntityAction.ATTACK),TimerManager.ins().doTimer(500,1,function(){t._monster.playAction(EntityAction.STAND)},this))}},e.prototype.showPk=function(){this._role.dir=3,this._monster.y=this.y+30,this._monster.x=this.x+30,this.x=this._role.x,this.y=this._role.y,this._role.stopMove(),TimerManager.ins().removeAll(this),TimerManager.ins().doTimer(1500,0,this.waitAtk,this)},e.prototype.waitAtk=function(){var t=this,e=this._role.infoModel;return void 0==e?void Log.trace("遭遇敌人自动攻击异常，本角色model为空"):(GameLogic.ins().playSkillEff(this.skillData,this._role,[this._monster]),this._monster.playAction(EntityAction.ATTACK),void TimerManager.ins().doTimer(500,1,function(){t._monster.playAction(EntityAction.STAND)},this))},e.prototype.runToNewMonster=function(){this._role&&this._role.infoModel&&(this._monster.visible=!0,this._role.infoModel.setAtt(AttributeType.atMoveSpeed,3e3),GameMap.moveEntity(this._role,this._monster.x,this._monster.y),this._role.AI_STATE=AI_State.Run)},e.prototype.killMonster=function(){if(this._monster){this._role.AI_STATE=AI_State.Stand,this.posCount++,this._monster.visible=!1;var t=UserFb.ins().encounterPos.length,e=Math.floor(Math.random()*t),i=UserFb.ins().encounterPos.splice(e,1);this.atkCount=0,UserFb.ins().encounterPos.push(this.posIndex),this.posIndex=i[0];var s=UserFb.ins().zyPos[i[0]];this._monster.x=s.x*GameMap.CELL_SIZE,this._monster.y=s.y*GameMap.CELL_SIZE,this._monster.playAction(EntityAction.STAND),this.atkTime=-1500}},e.prototype.reach=function(){var t=MathUtils.getDistance(this._monster.x,this._monster.y,this._role.x,this._role.y);return 100>t},e.prototype.AI=function(){switch(this._role.AI_STATE){case AI_State.Atk:egret.getTimer()-this.atkTime>1500&&this.autoAtk();break;case AI_State.Stand:this.runToNewMonster();break;case AI_State.Run:this.reach()?this.autoAtk():this.runToNewMonster()}},e.prototype.onTap=function(t){return EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval?void UserTips.ins().showTips("PK值已满无法进行PK"):void 0},e.prototype.reset=function(){GameLogic.ins().addEntity(this._monster),GameLogic.ins().addEntity(this._role),this.atkCount=0,this._role.AI_STATE=AI_State.Stand,this._role.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTap,this),TimerManager.ins().doTimer(100,0,this.AI,this)},e.prototype.destruct=function(){this._role.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTap,this),this._role.playAction(EntityAction.STAND),this._monster.playAction(EntityAction.STAND),TimerManager.ins().removeAll(this),DisplayUtils.removeFromParent(this),DisplayUtils.removeFromParent(this._role),DisplayUtils.removeFromParent(this._monster),UserFb.ins().encounterPos.push(this.posIndex),ObjectPool.push(this)},e.prototype.setData=function(t){this.infoModel=t,UserFb.ins().guanqiaID>-1,this._role.infoModel=t.subRole[0],this._role.playAction(EntityAction.STAND),this._role.updateBlood(!0),this._role.showBlood(!0),this._role.updateNeiGong(),this._role.updateModel(),this._role.setCharName(this.infoModel.name)},e.prototype.setPosition=function(t,e){this.x=this._role.x=t,this.y=this._role.y=e,this._monster.x=this.x+30,this._monster.y=this.y+30},e}(egret.DisplayObjectContainer);__reflect(CharEncounter.prototype,"CharEncounter",["IChar"]);var AStarNode=function(){function t(t,e,i){this.nX=t,this.nY=e,this.nDir=i}return t}();__reflect(AStarNode.prototype,"AStarNode");var CharItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e._itemImg=new eui.Image,e._itemImg.x=-17,e._itemImg.y=-17,e._itemImg.scaleX=e._itemImg.scaleY=.6,e.addChild(e._itemImg),e._roatImg=new eui.Image("point3"),e._roatImg.anchorOffsetX=5,e._roatImg.anchorOffsetY=5,e._roatImg.alpha=0,e.addChild(e._roatImg),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.removeRoatEffect()},e),e}return __extends(e,t),e.prototype.setData=function(t){t.type?this._itemImg.source=GlobalConfig.ItemConfig[t.id].icon+"_png":t.id==MoneyConst.gold?this._itemImg.source="icgoods117_png":t.id==MoneyConst.yuanbao?this._itemImg.source="icgoods121_png":t.id==MoneyConst.soul?this._itemImg.source="200136_png":t.id==MoneyConst.rune&&(this._itemImg.source="500007_png")},e.prototype.addRoatEffect=function(){this.removeRoatEffect();var t=egret.Tween.get(this._roatImg,{loop:!0});t.to({alpha:1},200).to({rotation:90},1e3).to({alpha:0},200).wait(300)},e.prototype.removeRoatEffect=function(){this._roatImg.alpha=0,this._roatImg.rotation=0,egret.Tween.removeTweens(this._roatImg)},e}(egret.DisplayObjectContainer);__reflect(CharItem.prototype,"CharItem");var CharItem2=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e.item=new CharItem,e.itemName=new CharItemName,e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this.item.setData(t),this.itemName.setData(t),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)},e.prototype.setItemParent=function(t){this._itemParent=t,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this),this._itemParent.addChild(this)},e.prototype.addRoatEffect=function(){this.item.addRoatEffect()},e.prototype.removeRoatEffect=function(){this.item.removeRoatEffect()},e.prototype.addFloatEffect=function(){egret.Tween.removeTweens(this.item);var t=egret.Tween.get(this.item),e=this.item.y;this.item.y-=100,t.to({y:e},500,egret.Ease.bounceOut)},e.prototype.onAdd=function(t){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),ResourceMgr.ins().reloadContainer(this.item),this._itemParent?(this._itemParent.addChild(this.item),this._itemParent.addChild(this.itemName)):(DropHelp.dropContainer.addChild(this.item),DropHelp.dropNameContainer.addChild(this.itemName))},e.prototype.onRemove=function(t){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.item.parent&&this.item.parent.removeChild(this.item),this.itemName.parent&&this.itemName.parent.removeChild(this.itemName),this.removeRoatEffect()},Object.defineProperty(e.prototype,"x",{get:function(){return egret.superGetter(e,this,"x")},set:function(t){egret.superSetter(e,this,"x",t),this.itemName.x=t,this.item.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return egret.superGetter(e,this,"y")},set:function(t){egret.superSetter(e,this,"y",t),this.itemName.y=t,this.item.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"team",{get:function(){return this.infoModel.team},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.item.scaleX=1,this.item.scaleY=1,this.itemName.scaleX=1,this.itemName.scaleY=1},e.prototype.destruct=function(){this.item.scaleX=1,this.item.scaleY=1,this.itemName.scaleX=1,this.itemName.scaleY=1,this._itemParent=null,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)},e}(egret.DisplayObjectContainer);__reflect(CharItem2.prototype,"CharItem2",["IChar"]);var CharItemName=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e._nameTxt=new eui.Label,e._nameTxt.stroke=1,e._nameTxt.strokeColor=0,e._nameTxt.size=14,e._nameTxt.y=-25,e._nameTxt.width=120,e._nameTxt.x=-60,e._nameTxt.textAlign=egret.HorizontalAlign.CENTER,e.addChild(e._nameTxt),e}return __extends(e,t),e.prototype.setData=function(t){if(t.type){if(500007==t.id)this._nameTxt.text=""+t.count;else{var e=GlobalConfig.ItemConfig[t.id].name;t.count>1?this._nameTxt.text=t.count+e:this._nameTxt.text=e}this._nameTxt.textColor=ItemConfig.getQualityColor(GlobalConfig.ItemConfig[t.id])}else t.id==MoneyConst.gold?(this._nameTxt.text=""+t.count,this._nameTxt.textColor=ItemBase.QUALITY_COLOR[0]):t.id==MoneyConst.yuanbao?(this._nameTxt.text=t.count+"元宝",this._nameTxt.textColor=ItemBase.QUALITY_COLOR[5]):t.id==MoneyConst.soul?(this._nameTxt.text=t.count+"精炼石",this._nameTxt.textColor=ItemBase.QUALITY_COLOR[2]):t.id==MoneyConst.rune&&(this._nameTxt.text=t.count+"精华",this._nameTxt.textColor=ItemBase.QUALITY_COLOR[1])},e}(egret.DisplayObjectContainer);__reflect(CharItemName.prototype,"CharItemName");var CharMiner=function(t){function e(){var e=t.call(this)||this;return e.npcHead.currentState=e.npcHead.states[1],e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){t.prototype.updateModel.call(this);var e=GlobalConfig.KuangYuanConfig[this.infoModel.configID];this.npcHead.nameTxt.text=this.infoModel.name+"的矿工",this.npcHead.nameTxt.textColor=e.color,this.updateTime(),this.updateTitleState()},e.prototype.updateTime=function(){var t=Math.floor((this.infoModel.endTime-GameServer.serverTime)/1e3);t>=0?this.npcHead.timeTxt.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3):MineData.ins().remove(this.infoModel.index),this.playAction(EntityAction.ATTACK,function(){})},e.prototype.updateTitleState=function(){this.npcHead.updateState(this.infoModel)},e.prototype.destruct=function(){this.destroy(),ObjectPool.push(this)},e}(CharNpc);__reflect(CharMiner.prototype,"CharMiner");var CharModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parserItemData=function(t){this.itemData=new RewardData,this.itemData.parser(t)},e}(EntityModel);__reflect(CharModel.prototype,"CharModel");var EasyLoading=function(t){function e(){var e=t.call(this)||this;return e.content=null,e.speed=.6,e.init(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.init=function(){this.averageUtils=new AverageUtils,this.content=new egret.Sprite,this.content.graphics.beginFill(0,.2),this.content.graphics.drawRect(0,0,StageUtils.ins().getWidth(),StageUtils.ins().getHeight()),this.content.graphics.endFill(),this.content.touchEnabled=!0,this.uiImageContainer=new egret.DisplayObjectContainer,this.uiImageContainer.x=.5*this.content.width,this.uiImageContainer.y=.5*this.content.height,this.content.addChild(this.uiImageContainer),this.uiImage=new egret.Bitmap,this.uiImageContainer.addChild(this.uiImage),this.loadReel(),GameSocket.ins().setOnClose(this.showLoading,this),GameSocket.ins().setOnConnected(this.hideLoading,this)},e.prototype.loadReel=function(){var t=this;RES.getResByUrl(RES_DIR+"load_Reel.png",function(e){var i=t.uiImage;i.texture=e,i.x=.5*-i.width,i.y=.5*-i.height},this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.showLoading=function(){StageUtils.ins().getStage().addChild(this.content),this.loadReel(),egret.startTick(this.enterFrame,this)},e.prototype.hideLoading=function(){this.content&&this.content.parent&&(StageUtils.ins().getStage().removeChild(this.content),this.uiImageContainer.rotation=0),egret.stopTick(this.enterFrame,this)},e.prototype.enterFrame=function(t){return this.averageUtils.push(this.speed*t),this.uiImageContainer.rotation+=this.averageUtils.getValue(),!1},e}(BaseClass);__reflect(EasyLoading.prototype,"EasyLoading");var CRC16=function(){function t(){}return t.update=function(e,i,s){void 0===i&&(i=0),void 0===s&&(s=0);var n=0,o=0;0==s&&(s=e.length),e.position=i;for(var a=i;s>a;++a)o=255&t.CRCBitReflect(e.readByte(),8)^n>>8&16777215,o&=255,n=t.CRCTable[o]^n<<8&4294967040;return 65535&(0^t.CRCBitReflect(n,16))},t.makeCRCTable=function(){for(var e=0,i=new Array(256),s=0;256>s;++s){e=s<<8&4294967040;for(var n=0;8>n;++n)e=32768&e?e<<1&4294967294^t.POLYNOMIAL:e<<1&4294967294;i[s]=e}return i},t.CRCBitReflect=function(e,i){var s=0,n=0;i--;for(var o=0;i>=o;++o)n=i-o,1&e&&(s|=1<<n&t.DropBits[n]),e=e>>1&2147483647;return s},t}();CRC16.POLYNOMIAL=4129,CRC16.CRCTable=CRC16.makeCRCTable(),CRC16.DropBits=[4294967295,4294967294,4294967292,4294967288,4294967280,4294967264,4294967232,4294967168,4294967040,4294966784,4294966272,4294965248,4294963200,4294959104,4294950912,4294934528],__reflect(CRC16.prototype,"CRC16");var CharRole=function(t){function e(){var e=t.call(this)||this;return e.ringMc=[],e.zhanLingAttack=!1,e.touchEnabled=!1,e.touchChildren=!1,e.AI_STATE=AI_State.Stand,e.neigongBar=new eui.ProgressBar,e.neigongBar.skinName="bloodyelskin",e.neigongBar.anchorOffsetY=-5,e.neigongBar.labelDisplay.visible=!1,e.neigongBar.labelFunction=function(){return""},e.titleCantainer.addChild(e.neigongBar),e.neigongBar.anchorOffsetX=Math.floor(e.neigongBar.width>>1),e._nameTxt.textColor=16777215,e._nameGroup.visible=!0,e._lilianTitle=new eui.Image,e._lilianTitle.scaleX=.5,e._lilianTitle.scaleY=.5,e._lilianTitle.bottom=-1,e._nameGroup.addChild(e._lilianTitle),e}return __extends(e,t),e.prototype.createTweenObj=function(){var t=this;this.dieTweenObj={set alpha(e){t.alpha=e},get alpha(){return t.alpha}},this.moveTweenObj={set x(e){t.x=e>>0,t.moveCamera()},set y(e){t.y=e>>0,t.moveCamera()},get x(){return t.x},get y(){return t.y}}},e.prototype.setWeaponFileName=function(t){this.addMc(CharMcOrder.WEAPON,RES_DIR_WEAPON+t)},e.prototype.setWingFileName=function(t){this.addMc(CharMcOrder.WING,RES_DIR_WING+t)},e.prototype.setHeirloomFileName=function(t){this.addMc(CharMcOrder.HEIR,RES_DIR_EFF+t)},e.prototype.setSoulFileName=function(t){this.addMc(CharMcOrder.SOUL,RES_DIR_WEAPON+t)},e.prototype.loadOther=function(e){if(this.action==EntityAction.DIE){if(e!=CharMcOrder.BODY&&e!=CharMcOrder.WEAPON){var i=this.getMc(e);return void(i&&(i.visible=!1))}}else{var i=this.getMc(e);i&&(i.visible=!0)}(e!=CharMcOrder.ZHANLING||!this.zhanLingAttack&&this._state!=EntityAction.ATTACK)&&t.prototype.loadOther.call(this,e)},e.prototype.playBody=function(e){t.prototype.playBody.call(this,e),this.ringMc&&this.ringMc.length>0&&this.updateRingMC()},e.prototype.getResDir=function(t){if(t==CharMcOrder.ZHANLING)return 3;var e=2*(this._dir-4);if(0>e&&(e=0),GameServer.serverOpenDay<7)return this._dir-e;var i=this._dir-e;return 2>i?1:3},e.prototype.updateBlood=function(e){var i=this;void 0===e&&(e=!1),t.prototype.updateBlood.call(this,e),this._hpBar.value<=0&&this.onDead(function(){i.deadDelay()})},e.prototype.updateModel=function(){t.prototype.updateModel.call(this)},e.prototype.parseModel=function(){this._hpBar.thumb.source=this.isMy?"boolGreen_png":"boolRed_png";var t=this.infoModel;this.setCharName(t.guildAndName),this.setLilian(t.lilianUrl),this.updateBlood(!0),this.updateNeiGong();var e=t.getEquipByIndex(0).item.configID,i=t.hideWeapons();if(t.zhuangbei[1]>0){var s=GlobalConfig.ZhuangBanId[t.zhuangbei[1]].res;this.setWeaponFileName(s+"_"+t.sex)}else if(e>0&&GlobalConfig.EquipConfig[e]){var s=GlobalConfig.EquipConfig[e].appearance;this.setWeaponFileName(s+"_"+t.sex)}if(t.zhuangbei[2]>0){var s=GlobalConfig.ZhuangBanId[t.zhuangbei[2]].res;this.setWingFileName(s)}else t.wingsData.openStatus&&GlobalConfig.WingLevelConfig[t.wingsData.lv]&&this.setWingFileName(GlobalConfig.WingLevelConfig[t.wingsData.lv].appearance);if(t.heirloom){var n=t.heirloom.getSuitConfig(t);n&&n.weff&&this.setHeirloomFileName(n.weff)}if(!i&&t.weapons&&t.weapons.weaponsId>0){var s=GlobalConfig.WeaponSoulConfig[t.weapons.weaponsId].outside[t.job-1];this.setSoulFileName(s)}if(e=t.equipsData[2].item.configID,t.zhuangbei[0]>0){var s=GlobalConfig.ZhuangBanId[t.zhuangbei[0]].res;this.initBody(RES_DIR_BODY+s+"_"+t.sex)}else if(e>0){if(GlobalConfig.EquipConfig[e]){var s=GlobalConfig.EquipConfig[e].appearance;this.initBody(RES_DIR_BODY+s+"_"+t.sex)}}else this.initBody(RES_DIR_BODY+("body000_"+t.sex));this.updateTitle(),this.updateNameColor()},e.prototype.updateNameColor=function(){var t=this.infoModel;return void 0==t?void Log.trace("角色更新数据异常，moidel为空"):void(t.camp>0&&BattleCC.ins().isBattle()?this.setNameTxtColor(t.camp!=BattleCC.ins().camp?16711680:65280):this.team==Team.WillEntity?this.setNameTxtColor(16776960):this.setNameTxtColor(16777215))},e.prototype.setHeirloomSuitEff=function(){var t=this.infoModel;if(void 0!=t&&t.heirloom){var e=t.heirloom.getSuitConfig(t);e&&e.weff&&this.setHeirloomFileName(e.weff)}},e.prototype.addBuff=function(e){t.prototype.addBuff.call(this,e);var i=e.effConfig;if(0==GameMap.fubenID)switch(i.type){case SkillEffType.Summon:var s=void 0;if(this.team==Team.My){var n=Artifact.ins().getReviseBySkill(35001),o=GodWeaponCC.ins().getReviseBySkill(35001),a=void 0;o&&(a=o[0]);var r=i.args.a;n&&n.args&&n.args[0]&&(r+=n.args[0].vals[2]),a&&a.args&&a.args[0]&&(r+=a.args[0].vals[2]),s=UserFb.createModel(GlobalConfig.MonstersConfig[r]),s.x=this.x,s.y=this.y,s.masterHandle=this.infoModel.handle,s.setAtt(AttributeType.atMoveSpeed,this.infoModel.getAtt(AttributeType.atMoveSpeed));var h=0,l=s.getAtt(AttributeType.atAttack);if(n&&n.args&&n.args[0]){var c=n.args[0].vals[3]?n.args[0].vals[3]:1;h+=this.infoModel.getAtt(AttributeType.atAttack)*c}if(a&&a.args&&a.args[0]){var c=a.args[0].vals[3]?a.args[0].vals[3]:1;h+=this.infoModel.getAtt(AttributeType.atAttack)*c}s.setAtt(AttributeType.atAttack,(h>>0)+l)}else s=UserFb.createModel(GlobalConfig.MonstersConfig[i.args.a]),s.x=this.x,s.y=this.y,s.masterHandle=this.infoModel.handle,s.setAtt(AttributeType.atMoveSpeed,this.infoModel.getAtt(AttributeType.atMoveSpeed));s.isMy=s.checkHandleIsMy(s.masterHandle),GameLogic.ins().createEntityByModel(s,this.team)}},e.prototype.updateNeiGong=function(){if(this.infoModel){var t=this.infoModel.getAtt(AttributeType.maxNeiGong);this.neigongBar.visible=this.checkNeigongVisible(),this.neigongBar.maximum=t,this.neigongBar.value=this.infoModel.getAtt(AttributeType.cruNeiGong),this.neigongBar.visible&&(this.showName(this.neigongBar.visible),this.showBlood(this.neigongBar.visible))}},e.prototype.checkNeigongVisible=function(){var t=this.infoModel.getAtt(AttributeType.maxNeiGong);return 0!=t&&this._state!=EntityAction.DIE},e.prototype.updateTitle=function(){var t=this.infoModel,e=t.title;if(this.removeTitle(),this.getIsShowBody()&&e>0){var i=GlobalConfig.TitleConf[e];if(i)if(i.img)null==this._title&&(this._title=new eui.Image,this._title.anchorOffsetX=115,this._title.anchorOffsetY=100,this.titleCantainer.addChild(this._title)),this._title.source=i.img;else if(i.eff){null==this._titleMc&&(this._titleMc=ObjectPool.pop("MovieClip"),this._titleMc.anchorOffsetX=0,this._titleMc.anchorOffsetY=80,this.titleCantainer.addChild(this._titleMc));var s=RES_DIR_EFF+i.eff;this.playFile(this._titleMc,s)}}},e.prototype.updateRingMC=function(){for(var t in this.ringMc)this.ringMc[t]&&(null==this.ringMc[t].parent&&this.addChild(this.ringMc[t]),this.ringMc[t].setEffectXY(this.dir))},e.prototype.setCharName=function(e){t.prototype.setCharName.call(this,e),this._lilianTitle.x=(this._nameGroup.width>>1)+(this._nameTxt.width>>1)-6,this._nameGroup.visible=!0},e.prototype.setLilian=function(t){this._lilianTitle.source=t},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){t?this._infoModel=t:Log.trace("设置infoModel异常,对象为空")},enumerable:!0,configurable:!0}),e.prototype.autoAddBlood=function(){if(this.action==EntityAction.DIE)return void egret.clearTimeout(this.timeID);if(this.getRealHp()<this.infoModel.getAtt(AttributeType.atMaxHp)){var t=-this.infoModel.getAtt(AttributeType.atRegeneration);this.hram(t);var e=this.infoModel.getAtt(AttributeType.atHp)-t,i=this.infoModel.getAtt(AttributeType.atMaxHp);this.infoModel.setAtt(AttributeType.atHp,e>i?i:e),GameLogic.ins().postEntityHpChange(this,null,DamageTypes.HIT,t)}TimerManager.ins().doTimer(1e3,1,this.autoAddBlood,this)},e.prototype.showNeigong=function(t){this.neigongBar.visible=t&&this.checkNeigongVisible()},e.prototype.showZhanling=function(t,e){var i=GlobalConfig.ZhanLingLevel[0][e];if(i.talentLevel&&(i=GlobalConfig.ZhanLingLevel[t][e],!Assert(i,"战灵天赋等级配置为空：id("+t+"),lv("+e+")"))){var s=i.appearance;this.addMc(CharMcOrder.ZHANLING,RES_DIR_MONSTER+s);var n=this.getMc(CharMcOrder.ZHANLING),o=GlobalConfig.ZhanLingConfig.anchorOffset||[];n.anchorOffsetX=o[0]||0,n.anchorOffsetY=o[1]||0,TimerManager.ins().remove(this.playZhanLingAttack,this),TimerManager.ins().doTimer(200,1,this.playZhanLingAttack,this),TimerManager.ins().remove(this.hideZhanling,this),TimerManager.ins().doTimer(3e3,1,this.hideZhanling,this)}},e.prototype.playZhanLingAttack=function(){var t=this,e=CharMcOrder.ZHANLING,i=this.getMc(e);if(i){i.scaleX=this._dir>4?-1:1;var s=this.getFileName(e)+"_"+this.getResDir(e)+EntityAction.ATTACK;this.zhanLingAttack=!0,i.playFile(s,1,function(){t.zhanLingAttack=!1;var s=t.getFileName(e)+"_"+t.getResDir(e)+EntityAction.STAND;i.playFile(s,-1,null,!1)},!1)}},e.prototype.hideZhanling=function(){var t=this,e=this.getMc(CharMcOrder.ZHANLING);e&&egret.Tween.get(e).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){t.removeMc(CharMcOrder.ZHANLING)})},e.prototype.reset=function(){t.prototype.reset.call(this),this.zhanLingAttack=!1,this.AI_STATE=AI_State.Stand},e.prototype.destruct=function(){t.prototype.destruct.call(this),this.AI_STATE=AI_State.Stand,this._hpBar.visible=this._nameGroup.visible=!0,this._nameTxt.textColor=16777215;for(var e in this.ringMc)this.ringMc[e]&&(this.ringMc[e].reset(),this.ringMc[e]=null,delete this.ringMc[e])},e.prototype.deadDelay=function(){this._hpBar.slideDuration=0,this._hpBar.value=0,this.neigongBar.slideDuration=0,this.neigongBar.value=this.neigongBar.maximum,this.stopMove(),this.removeHardStraight(),this.removeAllBuff(),this.hideZhanling(),this.neigongBar.visible=!1,this._title&&(this._title.source=""),this._hpBar.visible=this._nameGroup.visible=!1,this.atking=!1,TimerManager.ins().removeAll(this)},Object.defineProperty(e.prototype,"nameVisible",{get:function(){return this._nameGroup.visible},enumerable:!0,configurable:!0}),e.prototype.showNameAndHp=function(){this._hpBar.visible=this._nameGroup.visible=!0},e.prototype.showBodyContainer=function(){this.isShowBody||(t.prototype.showBodyContainer.call(this),this.neigongBar.alpha=1)},e.prototype.hideBodyContainer=function(){this.isShowBody&&(t.prototype.hideBodyContainer.call(this),this.neigongBar.alpha=0)},e.prototype.moveCamera=function(){if(this==EntityManager.ins().getNoDieRole()){GameLogic.ins().postMoveCamera();var t="sefety",e={x:GameMap.point2Grip(this.x),y:GameMap.point2Grip(this.y)};!this[t]&&GameMap.checkSafety(e)?(UserTips.ins().showCenterTips("|C:0x00ff00&T:进入安全区|"),this[t]=!0):this[t]&&!GameMap.checkSafety(e)&&(UserTips.ins().showCenterTips("|C:0xff0000&T:离开安全区|"),this[t]=!1)}},e.prototype.isSafety=function(){var t={x:GameMap.point2Grip(this.x),y:GameMap.point2Grip(this.y)};return GameMap.checkSafety(t)},e.prototype.onDead=function(t){this.stopMove(),this.playAction(EntityAction.DIE,t)},e.prototype.stopMove=function(){t.prototype.stopMove.call(this),this==EntityManager.ins().getNoDieRole()&&(SoundUtil.ins().stopRun(),GameLogic.ins().postAdjustMapPos())},e}(CharMonster);__decorate([callLater],CharRole.prototype,"moveCamera",null),__reflect(CharRole.prototype,"CharRole");var CharTransfer=function(t){function e(){var e=t.call(this)||this;return e.hasDir=[],e.touchEnabled=!0,e.transferName=new TransferNameHead,e.transferName.anchorOffsetX=40,e.transferName.anchorOffsetY=21,e.titleCantainer.addChild(e.transferName),e.titleCantainer.anchorOffsetY=80,e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){this.x=this.infoModel.x,this.y=this.infoModel.y,this.transferName.updateModel(this.infoModel),this.addMc(CharMcOrder.BODY,this.infoModel.avatarFileName)},e}(CharEffect);__reflect(CharTransfer.prototype,"CharTransfer");var Encrypt=function(){function t(){}return t.encode=function(e,i,s){if(void 0===i&&(i=0),void 0===s&&(s=0),i>=e.length)return 0;var n=s?i+s:e.length;n>e.length&&(n=e.length),e.position=i;for(var o=i;n>o;++o){var a=e.readByte();a^=t.sKeyBuff[o%4],e.position--,e.writeByte(a)}return n-i},t.decode=function(e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),t.encode(e,i,s)},t.getCRC16=function(t,e){return void 0===e&&(e=0),CRC16.update(t,0,e)},t.getCRC16ByPos=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),CRC16.update(t,e,i)},t.getCheckKey=function(){var e=new egret.ByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.writeUnsignedInt(t.sKey);var i=CRC16.update(e);return i},t.getSelfSalt=function(){return t.sSelfSalt},t.getTargetSalt=function(){return t.sTargetSalt},t.setTargetSalt=function(e){t.sTargetSalt=e,t.makeKey()},t.makeSalt=function(){var t=new Date;return Math.random()*t.getTime()},t.makeKey=function(){t.sKey=(t.sSelfSalt^t.sTargetSalt)+8254;for(var e=0;4>e;++e)t.sKeyBuff[e]=(t.sKey&255<<(e<<3))>>(e<<3)},t}();Encrypt.sSelfSalt=Encrypt.makeSalt(),Encrypt.sKeyBuff=new Array(4),__reflect(Encrypt.prototype,"Encrypt");var EntityBuff=function(){function t(){this.multRate=1}return t.prototype.dispose=function(){this.source=null,this.hostsHandle=null,this.multRate=1},t.createBuff=function(e,i,s){var n=GlobalConfig.EffectsConfig[e];Assert(n,"EffectsConfig中 "+e+" 配置为空！！！");var o=RoleAI.ins().skillEffValue(i,n,s),a=s?s.time||0:0;return t.createBaseBuff(e,i,o,n.duration+a)},t.createBaseBuff=function(t,e,i,s){var n=GlobalConfig.EffectsConfig[t];Assert(n,"EffectsConfig中 "+t+" 配置为空！！！");var o=ObjectPool.pop("EntityBuff");if(o.effConfig=n,o.value=i,o.addTime=egret.getTimer(),o.endTime=o.addTime+(s?s:n.duration),o.count=(s?s:n.duration)/n.interval>>0,o.step=0,o.source=e,n.type==SkillEffType.HostAddAttributes){null==o.hostsHandle&&(o.hostsHandle=[]);var a=EntityManager.ins().getRootMasterHandle(e.infoModel.handle);o.hostsHandle.indexOf(a)<0&&o.hostsHandle.push(a)}return o},t.prototype.isExecute=function(){return egret.getTimer()-this.addTime>this.step*this.effConfig.interval},t.prototype.canRemove=function(){return this.effConfig.type!=SkillEffType.Summon&&egret.getTimer()>=this.endTime},t.prototype.isCanotHit=function(){return this.effConfig.type==SkillEffType.AdditionalState&&1==this.effConfig.args.i},t}();__reflect(EntityBuff.prototype,"EntityBuff");var EntityFilter;!function(t){t[t.no=0]="no",t[t.hard=1]="hard",t[t.poison=2]="poison"}(EntityFilter||(EntityFilter={}));var EntityFilterUtil=function(){function t(){}return t.getEntityFilter=function(e){var i=EntityFilter.no;return t.isHard(e)?i=EntityFilter.hard:t.isPoison(e)&&(i=EntityFilter.poison),i},t.isHard=function(t){return 51001==t||150065==t},t.isPoison=function(t){return 23001==t||61001==t||150071==t},t}();EntityFilterUtil.buffFilter={1:{filters:FilterUtil.ARRAY_GRAY_FILTER},2:{filters:FilterUtil.ARRAY_GREEN_FILTER}},__reflect(EntityFilterUtil.prototype,"EntityFilterUtil");var MineModel=function(t){function e(){var e=t.call(this)||this;return e.type=EntityType.Mine,e}return __extends(e,t),Object.defineProperty(e.prototype,"npcConfig",{get:function(){var t=GlobalConfig.KuangYuanConfig[this.configID];return GlobalConfig.NpcBaseConfig[t.npcId]},enumerable:!0,configurable:!0}),e.prototype.parser=function(t){this.index=t.readByte(),this.actorID=t.readInt(),this.name=t.readString(),this.power=t.readInt(),this.guildName=t.readString(),this.configID=t.readUnsignedByte(),this.startTime=DateUtils.formatMiniDateTime(t.readInt()),this.endTime=DateUtils.formatMiniDateTime(t.readInt()),this.isBeFight=t.readBoolean();
var e=t.readByte();this.beFightActorID=[];for(var i=0;e>i;i++)this.beFightActorID[i]=t.readInt()},e}(NpcModel);__reflect(MineModel.prototype,"MineModel");var MineNpcHead=function(t){function e(){var e=t.call(this)||this;return e.states=["none","mine"],e.skinName="MineNpcHeadSkin",e.contentGroup.touchEnabled=!1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.updateModel=function(t){var e=t.npcConfig;e&&e.title?this.titleGroup.visible=!0:this.titleGroup.visible=!1,this.titleImg.source=e?e.title:"",this.icon.source=e?e.headIcon:""},e.prototype.updateState=function(t){t.isBeFight?this.setState(1):MineData.ins().getIsCanAtk(t)?this.setState(2):this.setState(0)},e.prototype.setState=function(t){1==t?this.workerState.source="":2==t?this.workerState.source="jingji_json.kuanggong_title":this.workerState.source="",this.setEff(t)},e.prototype.setEff=function(t){if(1==t){var e=this.getEff();e.playFile(RES_DIR_EFF+"fighting",-1),e.x=this.stateGroup.width>>1,e.y=-20,this.stateGroup.addChild(e)}else this.eff&&(DisplayUtils.removeFromParent(this.eff),this.eff.dispose())},e.prototype.getEff=function(){return this.eff||(this.eff=new MovieClip),this.eff},e}(BaseComponent);__reflect(MineNpcHead.prototype,"MineNpcHead");var BresenhamLine=function(){function t(){}return t.isAbleToThrough=function(t,e,i,s){var n=0,o=0,a=0,r=0,h=0,l=0,c=0,u=0,p=0,d=0,g=0,f=0,v=0,y=0;for(this.throughCheckResult||(this.throughCheckResult=new Array(4)),this.throughCheckResult[0]=0,this.throughCheckResult[1]=0,f=(s-e)/(i-t),v=s-f*i,h=i>t?1:-1,l=s>e?1:-1,n=t>>0,o=e>>0,a=i>>0,r=s>>0,c=a-n,c=(c^c>>31)-(c>>31),u=n,d=o,this.throughCheckResult[2]=u,this.throughCheckResult[3]=d,y=0;c>y;y++){for(u+=h,g=f*u+v,p=g>>0;d!=p;){if(d+=l,!GameMap.checkWalkable(u,d))return this.throughCheckResult;this.throughCheckResult[2]=u,this.throughCheckResult[3]=d}if(!GameMap.checkWalkable(u,p))return this.throughCheckResult;this.throughCheckResult[2]=u,this.throughCheckResult[3]=p}for(;d!=r;){if(d+=l,!GameMap.checkWalkable(u,d))return this.throughCheckResult;this.throughCheckResult[2]=u,this.throughCheckResult[3]=d}return this.throughCheckResult[0]=1,this.throughCheckResult},t.tileLine=function(t,e,i,s){for(var n=(s-e)/(i-t),o=s-n*i,a=i>t?1:-1,r=Math.abs(i-t),h=[],l=0;r>l;++l){var c=t+l*a>>0,u=n*c+o>>0;h.push(c),h.push(u)}return h},t.getPointOnLine=function(t,e,i,s,n){var o=0,a=0,r=0,h=0;return r=i-t,h=s-e,o=Math.sqrt(r*r+h*h),a=o+n,[Math.round(t+r*a/o),Math.round(e+h*a/o)]},t.shortenPath=function(e,i,s,n){var o,a=e,r=i,h=s[s.length-2],l=s[s.length-1],c=0,u=0;s.length>=4&&(a=s[s.length-4],r=s[s.length-3]),c=h-a,u=l-r,c*c+u*u>n*n?(o=t.getPointOnLine(a,r,h,l,-n),s[s.length-2]=o[0],s[s.length-1]=o[1]):s.length-=2},t}();__reflect(BresenhamLine.prototype,"BresenhamLine");var PaoPaoView=function(t){function e(){var e=t.call(this)||this;return e.jobText=[16146438,16146438,2933496,14831353],e.skinName="paopaoSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.x=-this.width/2,this.visible=!1},e.prototype.setSpeak=function(t,e){void 0===e&&(e=1),TimerManager.ins().removeAll(this),this.start(),this.nameTxt.textColor=this.jobText[e];var i=BubbleFactory.ins().playBubbleEffect(t);i&&(this.nameTxt.text=i,this.nameTxt.x=-this.nameTxt.textWidth>>1,this.visible=!0)},e.prototype.start=function(){TimerManager.ins().doTimer(1e3,1,this.destruct,this)},e.prototype.destruct=function(){this.parent&&(this.visible=!1)},e}(BaseView);__reflect(PaoPaoView.prototype,"PaoPaoView");var Role=function(t){function e(){var e=t.call(this)||this;return e.runeDatas=[],e.wingSkillData=[],e.lilianLv=0,e._mbRing=0,e.hsRing=0,e.type=EntityType.Role,e}return __extends(e,t),e.getAttrTypeByName=function(t){return this.translate[t]},e.getJobNameByJob=function(t){return this.jobNumberToName[t]},e.getHejiEquipNameByType=function(t){return this.hejiPosName[t]},e.getEquipNameByType=function(t){return this.typeNumberToName[t]},e.getWingEquipNameByType=function(t){return this.typeEquipWingToName[t]},e.getAllForgeLevelByType=function(t){for(var e=0,i=SubRoles.ins().subRolesLen,s=0;i>s;s++)for(var n=SubRoles.ins().getSubRoleByIndex(s).equipsData,o=0;o<UserEquip.FOEGE_MAX;o++)switch(t){case PackageID.strongthen:e+=n[o].strengthen;break;case PackageID.Gem:e+=n[o].gem;break;case PackageID.Zhuling:e+=n[o].zhuling}return e},e.getAllZSLevel=function(){for(var t=0,e=SubRoles.ins().subRolesLen,i=0;e>i;i++)for(var s=SubRoles.ins().getSubRoleByIndex(i).equipsData,n=0;n<UserEquip.FOEGE_MAX;n++){var o=s[n].item.configID,a=GlobalConfig.ItemConfig[o];a&&4==ItemConfig.getQuality(a)&&a.zsLevel&&(t+=a.zsLevel)}return t},e.prototype.parser=function(t){this.title=t.readInt(),this.index=t.readInt(),this.job=t.readInt(),this.sex=t.readInt(),this.power=t.readDouble(),this.skillsData=[];var e;for(e=0;5>e;e++){var i=t.readInt();this.skillsData.push(SkillData.getSkillByJob(this.job,e+1,i))}for(e=0;5>e;e++)t.readInt();for(this.yuanshengData=[],this.yuanshenLv=t.readInt(),e=0;6>e;e++)this.yuanshengData.push(t.readBoolean());this.equipsData=[];var s;for(e=0;e<EquipPos.MAX;e++)s=new EquipsData,s.parser(t),this.equipsData.push(s);for(this.exRingsData=[],e=0;4>e;e++)this.exRingsData.push(t.readInt());this.wingsData=new WingsData,this.wingsData.parser(t),this.jingMaiData=new JingMaiData,this.jingMaiData.parser(t),this.loongSoulData=new LongHunData,this.loongSoulData.parser(t),this.parserRune(t),this.parserhHeirloom(t),this.parserhWeapons(t),this.parserAtt(t),this.parserExAtt(t),this.parseJadeData(t),this.parserZhuangbei(t),this.setWingSkill()},e.prototype.parserhWeapons=function(t){this.weapons||(this.weapons=new WeaponsData),this.weapons.weaponsId=t.readInt()},e.prototype.parserhHeirloom=function(t){this.heirloom||(this.heirloom=new HeirloomData),this.heirloom.parser(t)},e.prototype.setWingSkill=function(){this.wingSkillData=[];for(var t=0;t<this.wingsData.lv+1;t++){var e=GlobalConfig.WingLevelConfig[t];e&&e.pasSkillId&&this.wingSkillData.push(e.pasSkillId)}},e.prototype.parserModel=function(t){var e=t.readShort();this.zhuZaiData=[];for(var i=0;e>i;i++){var s=new ZhuZaiData;s.parser(t),this.zhuZaiData[s.id-1]=s}},e.prototype.parseJadeData=function(t){this.jadeData||(this.jadeData=new JadeDataNew),this.jadeData.parserOther(t)},e.prototype.parserZhuangbei=function(t){this.zhuangbei=[];for(var e=0;3>e;e++)this.zhuangbei.push(t.readInt())},e.prototype.parserRune=function(t){var e=8,i=null;this.runeDatas=[];for(var s=0;e>s;s++)i=new ItemData,i.parser(t),this.runeDatas.push(i)},e.prototype.parseForgeChange=function(t,e){var i=t.readInt();switch(e){case PackageID.strongthen:this.equipsData[i].strengthen=t.readInt();break;case PackageID.Gem:this.equipsData[i].gem=t.readInt();break;case PackageID.Zhuling:this.equipsData[i].zhuling=t.readInt();break;case PackageID.Tupo:this.equipsData[i].tupo=t.readInt();break;case 1100:this.equipsData[i].bless=t.readInt()}return i},e.prototype.parserExAtt=function(t){for(var e=t.readShort(),i=0;e>i;i++)this.attributeExData[i]=t.readInt()},e.prototype.parserOtherRole=function(t,e){this.parserAtt(t),this.parserExAtt(t),this._name=t.readString(),e&&(this._servId=t.readInt()),this.job=t.readByte(),this.sex=t.readByte(),this._lv=t.readInt(),this.equipsData=[],this.equipsData[2]=new EquipsData,this.equipsData[2].item=new ItemData,this.equipsData[2].item.configID=t.readInt(),this.equipsData[0]=new EquipsData,this.equipsData[0].item=new ItemData,this.equipsData[0].item.configID=t.readInt(),this.wingsData=new WingsData,this.wingsData.lv=t.readInt(),this.wingsData.openStatus=t.readInt(),this.title=t.readInt(),this.guildID=t.readInt(),this.guildName=t.readString(),this.parserZhuangbei(t),this.lilianLv=t.readInt(),this.weaponsId=t.readShort(),this.parserhHeirloom(t),this.camp=t.readShort()},Object.defineProperty(e.prototype,"mbRing",{get:function(){return this._mbRing},set:function(t){this._mbRing=t},enumerable:!0,configurable:!0}),e.prototype.getMinEquipIndexByType=function(t){for(var e=0,i=Number.MAX_VALUE,s=0,n=ForgeConst.CAN_FORGE_EQUIP.length,o=0;n>o;++o){var a=ForgeConst.CAN_FORGE_EQUIP[o];switch(t){case ForgeWin.Page_Select_Boost:s=this.equipsData[a].strengthen;break;case ForgeWin.Page_Select_Gem:s=this.equipsData[a].gem;var r=GlobalConfig.StoneOpenConfig[a];if(Actor.level<r.openLv)continue;break;case ForgeWin.Page_Select_ZhuLing:s=this.equipsData[a].zhuling;break;case 3:s=this.equipsData[a].tupo}i>s&&(i=s,e=a)}return e},e.prototype.getEquipForgeTotalLv=function(t){for(var e=0,i=ForgeConst.CAN_FORGE_EQUIP.length;i--;){var s=ForgeConst.CAN_FORGE_EQUIP[i];switch(t){case ForgeWin.Page_Select_Boost:e+=this.getEquipByIndex(s).strengthen;break;case ForgeWin.Page_Select_Gem:e+=this.getEquipByIndex(s).gem;break;case ForgeWin.Page_Select_ZhuLing:e+=this.getEquipByIndex(s).zhuling;break;case 3:e+=this.getEquipByIndex(s).tupo}}return e},e.prototype.getEquipForgeLv=function(t,e){var i=0;switch(e){case ForgeWin.Page_Select_Boost:i+=this.getEquipByIndex(t).strengthen;break;case ForgeWin.Page_Select_Gem:i+=this.getEquipByIndex(t).gem;break;case ForgeWin.Page_Select_ZhuLing:i+=this.getEquipByIndex(t).zhuling;break;case 3:i+=this.getEquipByIndex(t).tupo}return i},e.prototype.getAllHeirloomPower=function(){for(var t=0,e=0;8>e;e++)t+=this.getHeirloomSlotPower(e);return t},e.prototype.getHeirloomSlotPower=function(t){var e=this.heirloom.getInfoBySolt(t),i=UserBag.getAttrPower(e.attr)||0,s=e.attr_add,n=0,o=this.getEquipByIndex(t);if(o.item.itemConfig){n+=o.item.point;for(var a=0;3>a;a++){var r=this.getEquipForgeLv(t,a),h=UserForge.ins().getForgeConfigByPos(t,r,a);n+=UserBag.getAttrPower(h.attr)||0}}var l=i+Math.floor(n*(s/100));return l},e.prototype.getCurSkillIDs=function(){for(var t=[],e=0;e<this.skillsData.length;e++)t.push(this.skillsData[e].lv1ConfigID);return t},e.prototype.mergeData=function(t){return this.masterHandle=t.masterHandle,this.handle=t.handle,this.type=t.type,this.x=t.x,this.y=t.y,this.attributeData=t.attributeData,this.attributeExData=t.attributeExData,this.team=t.team,this.lilianLv=t.lilianLv,this.name=t.name,this.guildID=t.guildID,this.guildName=t.guildName,this.isMy=t.isMy,this.title=t.title,t instanceof e&&(this.warLevel=t.warLevel,this.mbRing=t.mbRing,this.hsRing=t.hsRing),this},e.prototype.getEquipDataByPos=function(t){return this.equipsData&&this.equipsData[t]?this.equipsData[t]:null},e.prototype.getForgeTotalPower=function(t){for(var e=0,i=ForgeConst.CAN_FORGE_EQUIP.length;i--;){var s=ForgeConst.CAN_FORGE_EQUIP[i],n=void 0;switch(t){case ForgeWin.Page_Select_Boost:n=this.equipsData[s].strengthen;break;case ForgeWin.Page_Select_ZhuLing:n=this.equipsData[s].zhuling;break;case ForgeWin.Page_Select_Gem:n=this.equipsData[s].gem;break;case 3:n=this.equipsData[s].tupo}if(n>0){var o=UserForge.ins().getForgeConfigByPos(s,n,t);e+=Math.floor(UserBag.getAttrPower(o.attr))}}return e},e.prototype.getWeaponTotalPower=function(t){var e=0,i=[];if(t>0)for(var s=GlobalConfig.WeaponSoulConfig[t],n=0;n<s.actcond.length;n++){var o=s.actcond[n],a=this.weapons.getSlotByInfo(o);if(a)for(var r=0;r<a.attr.length;r++){var h=new AttributeData;h.type=a.attr[r].type,h.value=a.attr[r].value,i.push(h)}}else{var l=this.weapons.getInfoData();for(var c in l){var u=l[c];for(var p in u){var d=u[p];if(d&&d.level)for(var r=0;r<d.attr.length;r++){var h=new AttributeData,g=d.attr[r];h.type=g.type,h.value=g.value,i.push(h)}}}}var f=this.weapons.flexibleCount?this.weapons.flexibleCount-1:0,v=GlobalConfig.WeaponSoulItemAttr[f];if(i.length&&v)for(var n=0;n<v.attr.length;n++){for(var y=!1,r=0;r<i.length;r++)if(i[r].type==v.attr[n].type){y=!0,i[r].value+=v.attr[n].value;break}if(!y){var h=new AttributeData,g=v.attr[n];h.type=g.type,h.value=g.value,i.push(h)}}return e+=Math.floor(UserBag.getAttrPower(i))},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),e.prototype.getNameWithServer2=function(){return this._servId&&KFServerSys.ins().isKF?this.name+("\nS"+this._servId):this.name},Object.defineProperty(e.prototype,"guildAndName",{get:function(){var t=this.getNameWithServer(),e=this.camp>0&&BattleCC.ins().isBattle()?this.camp!=BattleCC.ins().camp?"#FF0000":"#00FF00":null,i=0==this.guildID||void 0==this.guildID?t:"<font color='"+(e?e:this.guildID==GuildWar.ins().getModel().winGuildInfo.guildId?"#ffb243":this.guildID==Guild.ins().guildID?"#5add70":"#2CC2F8")+"}'>"+this.guildName+"</font>\n"+this.name;if(this.lilianLv>0){var s=GlobalConfig.TrainLevelConfig[this.lilianLv];if(s.type>1){var n=ColorUtil.JUEWEI_COLOR[s.type-1]||ColorUtil.JUEWEI_COLOR[ColorUtil.JUEWEI_COLOR.length-1];i+=" <font color="+(e?e:n)+">["+s.trainName+"]</font>"}}return i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lilianUrl",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lv",{get:function(){return this._lv},enumerable:!0,configurable:!0}),e.prototype.getZhuZaiDataByIndex=function(t){return this.zhuZaiData[t]},e.prototype.getEquipByIndex=function(t){return this.equipsData[t]},e.prototype.hideWeapons=function(){var t=this.getEquipByIndex(0).item.configID;return GlobalConfig.EquipConfig[t]&&GlobalConfig.EquipConfig[t].noWSoulEff>=1},e.prototype.getEquipLen=function(){return this.equipsData.length},e.prototype.getExRingsData=function(t){return this.exRingsData[t]},e.prototype.setExRingsData=function(t,e){this.exRingsData[t]=e},e.prototype.setZhuZaiData=function(t,e){this.zhuZaiData[t]=e},e}(EntityModel);Role.jobNumberToName={0:"通用",1:"战士",2:"法师",3:"道士"},Role.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough},Role.typeNumberToName=["武器","头盔","衣服","项链","护腕","腰带","戒指","鞋子","官印","斗笠","面甲","披风","盾牌"],Role.hejiPosName=["乾","巽","坎","艮","坤","震","离","兑"],Role.typeEquipWingToName=["翼枢","翼爪","翎羽","彩凤"],__reflect(Role.prototype,"Role");var SubRoles=function(t){function e(){var e=t.call(this)||this;return e.roles=[],e.jobDic=[],e.observe(Guild.ins().postQuitGuild,e.setGuildName),e.observe(Guild.ins().postGuildInfo,e.setGuildName),e.observe(LiLian.ins().postLilianData,e.updateName),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.init=function(){this.roles=[],this.jobDic=[]},e.prototype.doSubRole=function(t){this.init();for(var i=t.readShort(),s=e.ins().subRolesLen,n=0;i>n;n++){var o=this.roles[n];o||(o=new Role),o.parser(t),this.roles[n]||this.roles.push(o),this.jobDic[o.job]||(this.jobDic[o.job]=o)}s&&s<this.roles.length&&UserTips.ins().showTips("成功开启新角色")},e.prototype.doSubRoleAtt=function(t){for(var e=t.readInt(),i=0,s=this.roles.length,n=0;s>n;n++){var o=this.getSubRoleByIndex(n);o.index==e&&(o.parserAtt(t,!0),o.power=t.readDouble()),i+=o.power}Actor.ins().postPowerChange(i),GodWeaponCC.ins().gwshowTips&&(GodWeaponCC.ins().roleshowTips&&GodWeaponCC.ins().roleshowTips--,GodWeaponCC.ins().roleshowTips<=0&&(GodWeaponCC.ins().roleshowTips=0,GodWeaponCC.ins().gwshowTips=!1))},e.prototype.doSubRoleExtAtt=function(t){for(var e=t.readInt(),i=this.roles.length,s=0;i>s;s++){var n=this.getSubRoleByIndex(s);n.index==e&&n.parserExtAtt(t,!0)}},e.prototype.getSubRoleByIndex=function(t){return this.roles[t]},e.prototype.getSubRoleByJob=function(t){for(var e=this.roles.length,i=0;e>i;i++){var s=this.getSubRoleByIndex(i);if(s.job==t)return this.roles[i]}return null},Object.defineProperty(e.prototype,"subRolesLen",{get:function(){return this.roles.length},enumerable:!0,configurable:!0}),e.prototype.resetRolesModel=function(){this.roles.length=0},e.prototype.updateName=function(){for(var t=this.subRolesLen,e=0;t>e;e++){var i=EntityManager.ins().getMainRole(e);if(i){var s=this.getSubRoleByIndex(e);i.setCharName(s.guildAndName),i.setLilian(s.lilianUrl)}}},e.prototype.setGuildName=function(t){for(var e=t[0],i=t[1],s=this.subRolesLen,n=0;s>n;n++)this.roles[n].guildName=i,this.roles[n].guildID=e;this.updateName()},e.prototype.getIsMyPlayer=function(t){for(var e in this.roles)if(this.roles[e].handle==t)return!0;return!1},e.prototype.isLockRole=function(){for(var t=3,i=0;t>i;i++){var s=e.ins().getSubRoleByIndex(i);if(!s){var n=GlobalConfig.NewRoleConfig[i];if(!n)continue;if(n.zsLevel){if(UserZs.ins().lv>=n.zsLevel)return!0}else if(Actor.level>=n.level)return!0;if(n.vip&&UserVip.ins().lv>=n.vip)return!0}}return!1},e}(BaseSystem);SubRoles.MAX_ROLES=3,__reflect(SubRoles.prototype,"SubRoles");var TransferModel=function(t){function e(){var e=t.call(this)||this;return e.type=EntityType.Transfer,e}return __extends(e,t),Object.defineProperty(e.prototype,"avatarFileName",{get:function(){return RES_DIR_EFF+"movestand"},enumerable:!0,configurable:!0}),e}(NpcModel);__reflect(TransferModel.prototype,"TransferModel");var TransferNameHead=function(t){function e(){var e=t.call(this)||this;return e.skinName="Trans",e}return __extends(e,t),e.prototype.updateModel=function(t){t.index?(this.visible=!0,this.num.text=t.index+""):this.visible=!1},e}(BaseComponent);__reflect(TransferNameHead.prototype,"TransferNameHead");var GameApp=function(t){function e(){var e=t.call(this)||this;return e.preload_load_count=0,e.map_load_count=0,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.load=function(){var t=LocationProperty.isFirstLoad?"firstLoad":"preload";ResourceUtils.ins().loadGroup(t,this.complete,this.progress,this)},e.prototype.complete=function(){var t=this;RES.getResByUrl(MAP_DIR+"maps.json",function(i){if(t.map_load_count+=1,Assert(i,"maps.json 地图数据加载失败!!加载次数："+t.map_load_count))return void(t.map_load_count<3?t.complete():alert("地图加载失败，请检查网络重新登录"));Assert(1==t.map_load_count,"maps.json 重新加载成功。加载次数："+t.map_load_count),ReportData.getIns().report("loaded",ReportData.LOAD);for(var s in GameSystem)GameSystem[s]();GlobalConfig.init(),GameMap.init(i),LocationProperty.setLoadProgress(90,"(登录游戏中)"),RoleMgr.ins().connectServer(),eui.Label.default_fontFamily="微软雅黑",RoleAI.ins().init(),LocationProperty.isFirstLoad&&ResourceUtils.ins().loadGroup("preload",e.ins().doPerLoadComplete,e.ins().postPerLoadProgress,t)},this)},e.prototype.progress=function(t,e){LocationProperty.setLoadProgress(40+t/e*30,"(加载必要资源)")},e.prototype.postPerLoadProgress=function(t,e){return[t,e]},e.prototype.doPerLoadComplete=function(){GlobalConfig.init(),this.postPerLoadComplete()},e.prototype.postPerLoadComplete=function(){},e.prototype.postLoginInit=function(){},e.prototype.postZeroInit=function(){},e}(BaseClass);__reflect(GameApp.prototype,"GameApp"),MessageCenter.compile(GameApp);var GameMap=function(){function t(){}return t.init=function(t){this.grid=this.grid||new MapGrid,this.aStar=this.aStar||new AStar,this.mapZip=t},t.update=function(){},t.moveEntity=function(e,i,s,n){void 0===n&&(n=!1);var o,a=t.CELL_SIZE,r=Math.floor(e.x/a),h=Math.floor(e.y/a),l=Math.floor(i/a),c=Math.floor(s/a);if(n)o=[new AStarNode(i,s,DirUtil.get8DirBy2Point({x:e.x,y:e.y},{x:i,y:s}))];else if(r==l&&h==c)o=[new AStarNode(l,c,DirUtil.get8DirBy2Point({x:e.x,y:e.y},{x:i,y:s}))];else if(o=this.aStar.getPatch(r,h,l,c),!o)return;GameLogic.ins().postMoveEntity(e,o,!n)},t.getPatch=function(t,e,i,s){var n=this.aStar.getPatch(t,e,i,s);return n},t.myMoveTo=function(t,e,i,s){for(var n,o=SubRoles.ins().subRolesLen,a=0;o>a;a++)n=EntityManager.ins().getMainRole(a),n&&this.moveEntity(n,t,e);var r=function(){for(var a=!0,h=0;o>h;h++)n=EntityManager.ins().getMainRole(h),n&&n.action==EntityAction.RUN&&(MathUtils.getDistance(n.x,n.y,t,e)<100&&(n.stopMove(),n.playAction(EntityAction.STAND)),a=!1);a&&(TimerManager.ins().remove(r,this),i&&i.call(s))};TimerManager.ins().doTimer(500,0,r,this)},t.moveTo=function(e,i){var s=t.CELL_SIZE,n=Math.floor(e/s),o=Math.floor(i/s);if(SysSetting.ins().setValue("mapClickTx",n),SysSetting.ins().setValue("mapClickTy",o),!this.checkWalkable(n,o))return!1;var a=EntityManager.ins().getNoDieRole();if(!a)return!1;if(a.hasFilter(EntityFilter.hard))return UserTips.ins().showTips("被麻痹，无法移动"),!1;var r=Math.floor(a.x/s),h=Math.floor(a.y/s),l=this.aStar.getPatch(r,h,n,o);if(!l||0==l.length)return!1;var c=l[0];return c.nX=e,c.nY=i,GameLogic.ins().sendFindPathToServer(a.infoModel.handle,l,!1),!0},t.checkWalkable=function(t,e){var i=!1,s=this.grid.getNode(t,e);return s?i=s.walkable:debug.log("地图:"+this.mapID+"副本:"+this._fubenID+"坐标:"+t+","+e+"出现问题!"),i},t.checkAlpha=function(t,e){var i=!1,s=this.grid.getNode(t,e);return s?i=s.hidden:debug.log("地图:"+this.mapID+"副本:"+this._fubenID+"坐标:"+t+","+e+"出现问题!"),i},t.parser=function(e){this.lastFbId=this.fubenID,this.fubenID=e.readInt(),this.mapID=e.readInt(),this.mapX=e.readShort(),this.mapY=e.readShort(),this.lastFbTyp=this.fbType,this.fbType=e.readByte(),this.fbName=e.readString(),this.fbDesc=e.readString();var i=this.getFileName(),s=this.mapZip[i];this.CELL_SIZE=s.title_wh,this.MAX_HEIGHT=s.pixHeight,this.MAX_WIDTH=s.pixWidth,this.COL=s.maxX,this.ROW=s.maxY,this.grid.initMapInfo(s,t.getTurn()),this.aStar.initFromMap(this.grid),this.SafetyZone={};for(var n=GlobalConfig.ScenesConfig[this.mapID],o=0;n.area&&o<n.area.length;o++)for(var a=n.area[o],r=a.attr,h=0;h<r.length;h++)switch(r[h].type){case 0:this.safetyCalculate(a)}},t.safetyCalculate=function(e){for(var i=e.grids,s=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MIN_VALUE,a=Number.MIN_VALUE,r=!1,h=0;h<i.length;h++){for(var l=i[h],c=h+1==i.length?i[0]:i[h+1],u=BresenhamLine.tileLine(l.x,l.y,c.x,c.y),p=0;p<u.length;p+=2){var d=u[p],g=u[p+1];this.SafetyZone[g*t.CELL_SIZE+d]={x:d,y:g},r=!0}s=Math.min(l.x,s),o=Math.max(l.x,o),n=Math.min(l.y,n),a=Math.max(l.y,a)}if(r)for(var h=n;a>=h;h++){for(var f=void 0,v=void 0,y=s;o>=y;y++)if(this.SafetyZone[h*t.CELL_SIZE+y]){f=y;break}for(var y=o;y>=s;y--)if(this.SafetyZone[h*t.CELL_SIZE+y]){v=y;break}if(!isNaN(f)&&!isNaN(v))for(var y=f+1;v>=y;y++)this.SafetyZone[h*t.CELL_SIZE+y]={x:h,y:y}}},t.checkSafety=function(e){return!!this.SafetyZone[e.y*t.CELL_SIZE+e.x]},Object.defineProperty(t,"fubenID",{get:function(){return this._fubenID},set:function(t){this._fubenID=t,t>0&&GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK)},enumerable:!0,configurable:!0}),t.sceneInMain=function(){return 0==t.fbType&&0==t.fubenID},t.sceneInMine=function(){return 0==t.fbType&&0!=t.fubenID},t.canStartAI=function(){return 0==t.fbType},t.getFileName=function(){return GlobalConfig.ScenesConfig[this.mapID].mapfilename},t.getTurn=function(){return GlobalConfig.ScenesConfig[this.mapID].turn},t.autoPunch=function(){return 1==GlobalConfig.ScenesConfig[this.mapID].autoPunch},t.getRectangle=function(e,i,s){var n=e.x+(i-.5)*t.CELL_SIZE,o=e.y+(s-.5)*t.CELL_SIZE;return new egret.Rectangle(n,o,t.CELL_SIZE,t.CELL_SIZE)},t.getIncludeElement=function(e,i,s){var n=[];for(var o in i){var a=t.getRectangle(e,i[o].x,i[o].y);for(var r in s){var h=s[r];h.x>=a.x&&h.y>=a.y&&h.x<a.x+a.width&&h.y<a.y+a.height&&n.push(h)}}return n},t.getPoint=function(t,e,i){var s=Math.floor(t/e)-Math.floor(i/2),n=Math.floor(t%e)-Math.floor(e/2);return new egret.Point(n,s)},t.getTargetIndex=function(e,i,s,n){var o=i.x-e.x+t.CELL_SIZE*(s/2),a=i.y-e.y+t.CELL_SIZE*(n/2),r=Math.floor(o/t.CELL_SIZE),h=Math.floor(a/t.CELL_SIZE);return s*h+r},t.checkWalkableByPixel=function(e,i){var s=Math.floor(e/t.CELL_SIZE),n=Math.floor(i/t.CELL_SIZE);return t.checkWalkable(s,n)},t.getPosRange=function(e,i,s){var n=MathUtils.limitInteger(-s,+s),o=MathUtils.limitInteger(-s,+s);+n!=+s&&(o=Math.random()<.5?-s:s);for(var a=0,r=n,h=o;;){var l=t.checkWalkable(e+r,i+h);if(l)return[e+r,i+h];if(r==s&&s>h?h+=1:h==s&&r>-s?r-=1:r==-s&&h>-s?h-=1:h==-s&&s>r&&(r+=1),r==n&&h==o&&(n==s&&(r=n=s+1),n==-s&&(r=n=-s-1),o==s&&(h=o=s+1),o==-s&&(h=o=-s-1),s+=1),a+=1,a>100)break}return[e,i]},t.getPosRangeByDir=function(e,i,s,n){var o=e,a=i;return(s>=0&&1>=s||7==s)&&(a-=n),s>=3&&5>=s&&(a+=n),s>=1&&3>=s&&(o+=n),s>=5&&7>=s&&(o-=n),[o,a,t.checkWalkable(o,a)]},t.getPosRangeRandom=function(e,i,s,n){void 0===n&&(n=1);var o=t.point2Grip(e),a=t.point2Grip(i),r=[s],h=Math.random();h>.66?(s=0>s-1?7:s-1,r.unshift(s),h>.8?r.push((s+2)%8):r.splice(1,0,(s+2)%8)):h>.33&&(s=s+1>7?0:s+1,r.unshift(s),h>.5?r.push((s-2+8)%8):r.splice(1,0,(s-2+8)%8));for(var l,c=!1,u=0;u<r.length;u++)if(l=t.getPosRangeByDir(o,a,r[u],n),l[2]){c=!0;break}return c||(l=t.getPosRange(o,a,n)),l},t.point2Grip=function(e){return Math.floor(e/t.CELL_SIZE)},t.grip2Point=function(e){return e*t.CELL_SIZE+(t.CELL_SIZE>>1)},t}();GameMap.fbType=0,GameMap.lastFbTyp=0,GameMap.lastFbId=0,__reflect(GameMap.prototype,"GameMap");var MapView=function(t){function e(){var i=t.call(this)||this;return i.moveObjDic={},i.touchEnabled=!0,i.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onGridClick,e),egret.startTick(i.onEnterFrame,i),i}return __extends(e,t),e.prototype.initMap=function(){var t=this;this._stepIndex={},this._mapImage=new MapViewBg,this.addChild(this._mapImage),this._dropLayer=new egret.DisplayObjectContainer,this.addChild(this._dropLayer),this._effBottomLayer=new egret.DisplayObjectContainer,this.addChild(this._effBottomLayer),this._entityLayer=new egret.DisplayObjectContainer,this.addChild(this._entityLayer),this._dropNameLayer=new egret.DisplayObjectContainer,this.addChild(this._dropNameLayer),this._effTopLayer=new egret.DisplayObjectContainer,this.addChild(this._effTopLayer),this._bloodLayer=new BloodView,this.addChild(this._bloodLayer),SkillEffPlayer.bottomLayer=this._effBottomLayer,SkillEffPlayer.topLayer=this._effTopLayer,SkillEffPlayer.setTimeout=function(t,e,i){TimerManager.ins().doTimer(t,1,e,i)},SkillEffPlayer.shake=function(e,i,s,n,o){o=o||1,e==EntityManager.ins().getMainRole(0)&&Math.random()<o&&DisplayUtils.shakeIt(t._mapImage,i,s,n)},DropHelp.init(this._dropLayer,this._dropNameLayer),TimerManager.ins().doTimer(500,0,this.sortEntity,this)},e.prototype.sortEntity=function(){this._entityLayer.$children.sort(this.sortF)},e.prototype.sortF=function(t,e){return t.weight>e.weight?1:t.weight<e.weight?-1:0},e.prototype.addEntity=function(t){this._entityLayer.addChild(t)},e.prototype.moveEntity=function(t){var e=t[0],i=t[1],s=void 0==t[2]?!0:!!t[2];i&&i.length?(this._stepIndex[e.hashCode]=i.length-1,this.moveNextStep(e,i,s)):e.playAction(EntityAction.STAND)},e.moveComplete=function(t){return t},e.prototype.moveNextStep=function(t,i,s){if(void 0===s&&(s=!0),t.stopMove(),t.action!=EntityAction.DIE){if(this._stepIndex[t.hashCode]<0)return delete this._stepIndex[t.hashCode],t.playAction(EntityAction.STAND),void e.moveComplete(t);var n=i[this._stepIndex[t.hashCode]],o={x:0,y:0},a=n.nDir;s?(o.x=GameMap.grip2Point(n.nX),o.y=GameMap.grip2Point(n.nY)):(o.x=n.nX,o.y=n.nY),a=t instanceof CharRole||2!=t.infoModel.dirNum?DirUtil.get8DirBy2Point(t,o):DirUtil.get4DirBy2Point(t,o),t.dir=a,t.playAction(EntityAction.RUN),this.moveToPoint(t,o,i,s)}},e.prototype.moveToPoint=function(t,e,i,s){var n=egret.getTimer(),o=this.moveObjDic[t.hashCode],a=0;o&&n>o.total&&(a=o.total-n),t.canMove=!0;var r={x:e.x-t.x,y:e.y-t.y},h=t.moveSpeed/1e3,l=Math.sqrt(r.x*r.x+r.y*r.y),c=t==EntityManager.ins().getNoDieRole(),u=l/h;r.x=r.x/u,r.y=r.y/u;var p={entity:t,endPoint:e,vec:r,path:i,isGrid:s,time:n+a,total:n+u+a,isMainRole:c};this.moveObjDic[t.hashCode]=p,0>a&&this.moveObj(p,n),c&&SoundUtil.ins().playRun()},e.prototype.onEnterFrame=function(t){for(var e in this.moveObjDic){var i=this.moveObjDic[e];i.entity.canMove?this.moveObj(this.moveObjDic[e],egret.getTimer()):delete this.moveObjDic[e]}return!1},e.prototype.moveObj=function(t,e){var i=t.entity;if(e>=t.total)i.x=t.endPoint.x,i.y=t.endPoint.y,this.onChange(t),this.onComplete(t);else{var s=e-t.time,n=t.vec.x*s,o=t.vec.y*s;t.time=e,i.x+=n,i.y+=o,this.onChange(t)}},e.prototype.onChange=function(t){var e=t.entity,i=GameMap.point2Grip(e.x),s=GameMap.point2Grip(e.y);e.alpha=GameMap.checkAlpha(i,s)?.7:1,t.isMainRole&&this.lookAt(e.x,e.y)},e.prototype.onComplete=function(t){var e=t.entity.hashCode;this._stepIndex[e]--,this._stepIndex[e]<0&&delete this.moveObjDic[e],this.moveNextStep(t.entity,t.path,t.isGrid)},e.onGridClick=function(t){return{target:t.target,x:t.stageX-t.currentTarget.x,y:t.stageY-t.currentTarget.y}},e.prototype.lookAt=function(t,e,i){void 0===i&&(i=!1);var s=StageUtils.ins().getWidth(),n=StageUtils.ins().getHeight(),o=this.minValue;this.x=o(t*this.scaleX,s,GameMap.MAX_WIDTH),this.y=o(e*this.scaleY,n,GameMap.MAX_HEIGHT,60),this._mapImage.updateHDMap({x:o(t,s/this.scaleX,GameMap.MAX_WIDTH),y:o(e,n/this.scaleY,GameMap.MAX_HEIGHT,60)},i)},e.prototype.minValue=function(t,e,i,s){return void 0===s&&(s=0),-Math.min(Math.max(t-s-(e>>1),0),i-e)},e.prototype.changeMap=function(){e.DRAW_GRID?this.drawGrid():this._shapeContainer&&this._shapeContainer.parent&&this.removeChild(this._shapeContainer),egret.Tween.removeTweens(this),egret.Tween.removeTweens(this._mapImage),this._mapImage.initThumbnail(GameMap.MAX_WIDTH,GameMap.MAX_HEIGHT,GameMap.getFileName(),GameMap.getTurn());for(var t=GlobalConfig.ScenesConfig[GameMap.mapID],i=0;t.effPos&&i<t.effPos.length;i++)for(var s=t.effPos[i],n=s.pos.length,o=0;n>o;o++){var a=s.pos[o],r=ObjectPool.pop("MovieClip");r.playFile(RES_DIR_EFF+s.eff,-1),r.x=a.x,r.y=a.y,this._effBottomLayer.addChild(r)}this.createNpc(),this.addEvent(),this.lookAt(GameMap.mapX,GameMap.mapY,!0)},e.prototype.addEvent=function(){var t=this;MessageCenter.ins().removeAll(this),MessageCenter.addListener(GameLogic.ins().postMoveEntity,this.moveEntity,this),MessageCenter.addListener(GameLogic.ins().postMoveCamera,function(e){var i=e[0],s=e[1],n=e[2],o=e[3];n==GameMap.mapID&&o==GameMap.fubenID&&t.lookAt(i,s)},this),MessageCenter.addListener(GameLogic.ins().postAdjustMapPos,this.adjustMapPos,this)},e.prototype.adjustMapPos=function(){this.x=this.x>>0,this.y=this.y>>0},e.prototype.createNpc=function(){var t=GlobalConfig.ScenesConfig[GameMap.mapID];if(t.npc)for(var e=0;e<t.npc.length;e++){var i=new NpcModel;i.configID=t.npc[e].id,i.x=t.npc[e].x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),i.y=t.npc[e].y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),i.dir=t.npc[e].d,GameLogic.ins().createEntityByModel(i)}},e.prototype.drawGrid=function(){var t=this._shape||new egret.Shape;this._shapeContainer=this._shapeContainer||new egret.DisplayObjectContainer,this._shapeContainer.cacheAsBitmap=!0,this._shapeContainer.touchEnabled=!1,this._shapeContainer.touchChildren=!1,t.graphics.clear(),t.graphics.lineStyle(.1);for(var e=GameMap.COL,i=GameMap.ROW,s=0;e>s;s++)for(var n=0;i>n;n++){GameMap.checkAlpha(s,n)?t.graphics.beginFill(3532333,.3):GameMap.checkWalkable(s,n)?t.graphics.beginFill(13421772,.3):t.graphics.beginFill(15937822,.3),t.graphics.drawRect(s*GameMap.CELL_SIZE,n*GameMap.CELL_SIZE,GameMap.CELL_SIZE,GameMap.CELL_SIZE),t.graphics.endFill();var o=new eui.Label;o.size=12,o.text=s+","+n,o.x=s*GameMap.CELL_SIZE,o.y=n*GameMap.CELL_SIZE,this._shapeContainer.addChild(o)}this._shapeContainer.addChild(t),this.addChild(this._shapeContainer),this._shape=t},e.prototype.clearAllLayer=function(){this._effBottomLayer.removeChildren(),this._effTopLayer.removeChildren(),this._bloodLayer.removeChildren(),this._entityLayer.removeChildren()},e}(egret.DisplayObjectContainer);MapView.DRAW_GRID=!1,__decorate([post],MapView,"moveComplete",null),__decorate([post],MapView,"onGridClick",null),__reflect(MapView.prototype,"MapView");var MapViewBg=function(t){function e(){var e=t.call(this)||this;e._shape=new egret.Shape,e.lastUpdateX=0,e.lastUpdateY=0,e.turn=0,e.shape=[],e.touchChildren=!1,e.touchEnabled=!1;var i=new eui.Image;return e.addChild(i),e.thumbnail=i,e.thumbnail.addEventListener(egret.Event.COMPLETE,e.onThumbnailComplete,e),e._imageList=[],e.showImages=[],e._poolImages=[],e._fileDic={},e}return __extends(e,t),e.prototype.destructor=function(){this.thumbnail.removeEventListener(egret.Event.COMPLETE,this.onThumbnailComplete,this),this.removeChildren(),this._imageList.length=0},e.prototype.onThumbnailComplete=function(t){this.isThumbnailComplete=!0,t.target&&t.target.name==this.mapName&&this.updateHDMap({x:this.lastUpdateX,y:this.lastUpdateY},!0)},e.prototype.initThumbnail=function(t,e,i,s){this.mapName!=i&&(this.isThumbnailComplete=!1),(this.mapName!=i||this.turn!=s)&&this.clearHDMap(),this.mapName!=i&&this.destroyFile(),this.mapName=i,this.turn=s,this.thumbnail.width=t,this.thumbnail.height=e,this.thumbnail.source=""+MAP_DIR+this.mapName+"/small.jpg",this.thumbnail.scaleX=s?-1:1,this.thumbnail.x=s?t:0,this.thumbnail.name=this.mapName;
var n=256;this.maxImagX=Math.floor(t/n),this.maxImagY=Math.floor(e/n),this.updateHDMap({x:this.lastUpdateX,y:this.lastUpdateY},!0)},e.prototype.clearHDMap=function(){this._imageList=[],this.showImages=[],this.removeChildren(),this.addChild(this.thumbnail)},e.prototype.destroyFile=function(){var t=RES.getAnalyzer(RES.ResourceItem.TYPE_IMAGE);for(var e in this._fileDic)t.destroyRes(e);this._fileDic={}},e.prototype.getImage=function(){return this._poolImages.pop()||new eui.Image},e.prototype.updateHDMap=function(t,e){void 0===e&&(e=!1);var i=256;if(e||Math.abs(this.lastUpdateX-t.x)>i/4||Math.abs(this.lastUpdateY-t.y)>i/4||0==this.lastUpdateX){if(this.lastUpdateX=t.x,this.lastUpdateY=t.y,!this.isThumbnailComplete)return;var s=[],n=StageUtils.ins().getWidth(),o=StageUtils.ins().getHeight(),a=Math.max(Math.floor(-t.x/i)-1,0),r=Math.max(Math.floor(-t.y/i)-1,0),h=a+Math.floor(n/i)+2,l=r+Math.floor(o/i)+2;if(this.turn)for(var c=a;h>=c&&c<this.maxImagX;c++)for(var u=this.maxImagX-c>0?this.maxImagX-c-1:0,p=r;l>=p&&p<this.maxImagY;p++){if(this._imageList[p]=this._imageList[p]||[],this._imageList[p][u])this._imageList[p][u].parent||this.addChild(this._imageList[p][u]);else{var d=""+MAP_DIR+this.mapName+"/image/"+p+"_"+u+".jpg";this._fileDic[d]=1;var g=this.getImage();g.source=d,g.name=d,g.scaleX=-1,g.x=(c+1)*i,g.y=p*i,this.addChild(g),this._imageList[p][u]=g}s.push(this._imageList[p][u])}else for(var c=a;h>=c&&c<this.maxImagX;c++)for(var p=r;l>=p&&p<this.maxImagY;p++){if(this._imageList[p]=this._imageList[p]||[],this._imageList[p][c])this._imageList[p][c].parent||this.addChild(this._imageList[p][c]);else{var d=""+MAP_DIR+this.mapName+"/image/"+p+"_"+c+".jpg";this._fileDic[d]=1;var g=this.getImage();g.source=d,g.name=d,g.x=c*i,g.y=p*i,this.addChild(g),this._imageList[p][c]=g}s.push(this._imageList[p][c])}for(var f=this.showImages.length,c=f-1;c>=0;c--)s.indexOf(this.showImages[c])>=0||DisplayUtils.removeFromParent(this.showImages[c]);this.showImages=s}},e.prototype.drawGrid=function(t,e){this.clearDrawGrid(),this.shapeContainer=this.shapeContainer||new egret.DisplayObjectContainer,this.shapeContainer.cacheAsBitmap=!0,this.shapeContainer.touchEnabled=!1,this.shapeContainer.touchChildren=!1;for(var i=t.x;i<e.x;i++)for(var s=t.y;s<e.y;s++){var n=i*e.x+s,o=this.shape[n];o||(o=this.shape[n]=new egret.Shape),o.graphics.lineStyle(1,16777215),GameMap.checkAlpha(i,s)?o.graphics.beginFill(255,.8):GameMap.checkWalkable(i,s)?o.graphics.beginFill(65280,.8):o.graphics.beginFill(16711680,.8),o.graphics.drawRect(0,0,GameMap.CELL_SIZE,GameMap.CELL_SIZE),o.graphics.endFill(),o.x=i*GameMap.CELL_SIZE,o.y=s*GameMap.CELL_SIZE;var a=new eui.Label;a.size=12,a.text=i+","+s,a.x=i*GameMap.CELL_SIZE,a.y=s*GameMap.CELL_SIZE,a.name="label"+i+","+s,this.shapeContainer.addChild(a),this.shapeContainer.addChild(o)}this.addChild(this.shapeContainer)},e.prototype.clearDrawGrid=function(){if(this.shapeContainer&&this.shape){for(;this.shapeContainer.numChildren>0;)this.shapeContainer.removeChildAt(0);this.shape.length=0}},e}(egret.DisplayObjectContainer);__reflect(MapViewBg.prototype,"MapViewBg");var Activationtongyong=function(t){function e(){var e=t.call(this)||this;return e.skinName="activationtongyong",e.isTopLevel=!0,e.bgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.onTap=function(t){switch(t.currentTarget){case this.okBtn:case this.bgClose:ViewManager.ins().close(e)}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2],o=t[3];this.closeFunc=t[4];var a=t[5],r=t[6];this.title.source=i?"tongyongjihuochenggongp3":"tongyongjihuochenggongp2";var h=RegExpUtil.NonNumericExp.exec(s);if(h){for(var l="",c="",u=0;u<s.length;u++)u>=h.index?c+=s[u]:l+=s[u];var p="";p=Number(l)/10>=1?l+"\n":" "+l+"\n",this.itemname.text=p+c.split("").join("\n")}else this.itemname.text=s.split("").join("\n");this.img.source=n,a&&(this.imgEff||(this.imgEff=new MovieClip),this.imgEff.parent||this.imgMc.addChild(this.imgEff),this.imgEff.playFile(RES_DIR_EFF+a,-1)),r&&(this.zlEff||(this.zlEff=new MovieClip),this.zlEff.parent||this.zlMc.addChild(this.zlEff),this.zlEff.playFile(RES_DIR_EFF+r,-1)),this.playAnimaiton(o)},e.prototype.close=function(){egret.Tween.removeTweens(this.title),egret.Tween.removeTweens(this.titleBg),egret.Tween.removeTweens(this.img),egret.Tween.removeTweens(this.imgMc),egret.Tween.removeTweens(this.zlMc),egret.Tween.removeTweens(this.tielian),egret.Tween.removeTweens(this.imgAct),this.closeFunc&&this.closeFunc.apply(null),this.closeFunc=null,DisplayUtils.removeFromParent(this.zlEff),DisplayUtils.removeFromParent(this.imgEff),DisplayUtils.removeFromParent(this.mc),this.zlEff=null,this.imgEff=null,this.mc=null},e.prototype.playAnimaiton=function(t){var e=this,i=this.tlpos=this.tlpos||[this.tielian.x,this.tielian.y],s=this.lbgpos=this.lbgpos||[this.lbg.x,this.lbg.y],n=this.rbgpos=this.rbgpos||[this.rbg.x,this.rbg.y],o=this.titleScale=this.titleScale||[this.title.scaleX,this.title.scaleY],a=this.tbgScale=this.tbgScale||[this.titleBg.scaleX,this.titleBg.scaleY],r=this.imgScale=this.imgScale||[this.img.scaleX,this.img.scaleY],h=[0,0];this.imgEff?h=this.imgMcScale=this.imgMcScale||[this.imgMc.scaleX,this.imgMc.scaleY]:this.zlEff&&(h=this.imgMcScale=this.imgMcScale||[this.zlMc.scaleX,this.zlMc.scaleY]),this.bg.visible=!1,this.itemname.visible=!1,this.leftBg.visible=!1,this.buttonBg.visible=!1,this.title.scaleX=0,this.title.scaleY=0,this.titleBg.scaleX=0,this.titleBg.scaleY=0,this.img.scaleX=0,this.img.scaleY=0,this.imgMc.scaleX=0,this.imgMc.scaleY=0,this.tielian.y=2*-this.tielian.height;var l=1,c=egret.Tween.get(this.tielian);c.to({y:i[1]+50},200*l).to({y:i[1]},100*l).call(function(){e.bg.visible=!0;var i=egret.Tween.get(e.title),s=egret.Tween.get(e.titleBg),n=egret.Tween.get(e.img),c=egret.Tween.get(e.imgMc);i.to({scaleX:o[0],scaleY:o[1]},500*l),s.to({scaleX:a[0],scaleY:a[1]},500*l),c.to({scaleX:h[0],scaleY:h[1]},500*l),n.to({scaleX:r[0],scaleY:r[1]},500*l).wait(500).call(function(){e.itemname.visible=!0,e.leftBg.visible=!0,e.buttonBg.visible=!0,e.showPanel(t),e.artifactTween()})}),this.lbg.y=-this.tielian.height,this.rbg.y=-this.tielian.height;var u=egret.Tween.get(this.lbg);u.to({y:s[1]+50},200*l).to({y:s[1]},100*l);var p=egret.Tween.get(this.rbg);p.to({y:n[1]+50},200*l).to({y:n[1]},100*l)},e.prototype.showPanel=function(t){t&&(this.mc=new MovieClip,this.mc.anchorOffsetX=this.Groupeff.anchorOffsetX,this.mc.anchorOffsetY=this.Groupeff.anchorOffsetY,this.Groupeff.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"artifacteff",-1))},e.prototype.artifactTween=function(){var t=egret.Tween.get(this.imgAct,{loop:!0});t.to({y:this.imgAct.y-20},1e3).to({y:this.imgAct.y},1e3)},e.show=function(t,i,s,n,o,a,r){void 0===n&&(n=!0),void 0===o&&(o=null),ViewManager.ins().open(e,t,i,s,n,o,a,r),StageUtils.ins().setTouchChildren(!0)},e}(BaseEuiView);__reflect(Activationtongyong.prototype,"Activationtongyong"),ViewManager.ins().reg(Activationtongyong,LayerManager.UI_Main);var Activity=function(t){function e(){var e=t.call(this)||this;return e.activityData={},e.doubleElevenData={},e.doubleElevenIDs=[130,150,151,152,153,156],e.doubleElevenSpecialIDs=[150,151,152,153],e.doubleTwelveData={},e.doubleTwelveIDAry=[221,222,223,224],e.doubleTwelveRechargeData={},e.doubleTwelveRechargeIDAry=[225,226,227],e.hfLoginID=157,e.geLoginID=210,e.palyEffList=[],e.rankInfoList=[],e.indexCurrDabiao=0,e.nextDayState=0,e.hfLoginDay=1,e.geLoginDay=1,e.isSuccee=!1,e.sysId=PackageID.Activity,e.regNetMsg(1,e.doActivityData),e.regNetMsg(2,e.postRewardResult),e.regNetMsg(3,e.doDaBiaoInfo),e.regNetMsg(4,e.postIsGetAwards),e.regNetMsg(5,e.doRewardStatu),e.regNetMsg(7,e.postChangePage),e.regNetMsg(11,e.doSevenDayData),e.regNetMsg(12,e.doChangeSevenDayData),e.regNetMsg(21,e.doNextDayLoginData),e.regNetMsg(20,e.doNextDayLoginReward),e.regNetMsg(22,e.postKuaFuRank),e.regNetMsg(6,e.postEnvelopeData),e.regNetMsg(8,e.postRedEnvelopeData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){},e.prototype.initZero=function(){if(this.activityData)for(var t in this.activityData){var e=+t;if(1e4>e){var i=GlobalConfig.ActivityConfig[t];i&&this.sendChangePage(e)}}},e.prototype.getActivityDataById=function(t){return this.activityData[t]},e.prototype.getDoubleElevenDataByID=function(t){return this.doubleElevenData[t]},e.prototype.getPalyEffListById=function(t){return this.palyEffList[t]},e.prototype.setPalyEffListById=function(t,e){this.palyEffList[t]=e},e.prototype.getrankInfoListByIndex=function(t){return this.rankInfoList[t]},e.prototype.doActivityData=function(t){this.activityData={};for(var e=t.readShort(),i=0;e>i;i++){var s=ActivityDataFactory.create(t);if(s){var n=s.id;-1!=this.doubleElevenIDs.indexOf(n)?this.doubleElevenData[n]=s:-1!=this.doubleTwelveIDAry.indexOf(n)?this.doubleTwelveData[n]=s:-1!=this.doubleTwelveRechargeIDAry.indexOf(n)?this.doubleTwelveRechargeData[n]=s:this.activityData[n]=s}}this.postActivityIsGetAwards(),ActivityDataFactory.createEx(),this.checkSpecials(),this.checkActivityTimer()},e.prototype.checkSpecials=function(){TimerManager.ins().isExists(this.checkSpecials,this)&&TimerManager.ins().remove(this.checkSpecials,this),this.postSpecials();var t;for(var e in this.doubleElevenData)if(-1!=this.doubleElevenSpecialIDs.indexOf(Number(e))&&(t=this.doubleElevenData[e],!t.isSpecialOpen()&&t.getSpecialOpenLeftTime()))return void TimerManager.ins().doTimer(1e3*t.getSpecialOpenLeftTime(),1,this.checkSpecials,this)},e.prototype.postSpecials=function(){},e.prototype.postActivityIsGetAwards=function(){},e.prototype.postRewardResult=function(t){this.isSuccee=t.readBoolean();var e=t.readInt();return-1!=this.doubleElevenIDs.indexOf(e)?this.getDoubleElevenDataByID(e).update(t):-1!=this.doubleTwelveRechargeIDAry.indexOf(e)?this.doubleTwelveRechargeData[e].update(t):-1!=this.doubleTwelveIDAry.indexOf(e)?this.doubleTwelveData[e].update(t):this.getActivityDataById(e).update(t),this.postActivityPanel(e),this.postActivityIsGetAwards(),e},e.prototype.postActivityPanel=function(t){return t},e.prototype.postHuntResult=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.sendReward=function(t,e,i,s){var n=this.getBytes(2),o=GlobalConfig.ActivityConfig[t];if(o&&o.activityType==ActivityDataFactory.ACTIVITY_TYPE_9)e?(n.writeInt(t),n.writeShort(e)):(n.writeInt(t),n.writeShort(e),n.writeByte(i));else if(o&&o.activityType==ActivityDataFactory.ACTIVITY_TYPE_11)n.writeInt(t),n.writeShort(e),n.writeShort(i);else if(o&&o.activityType==ActivityDataFactory.ACTIVITY_TYPE_22)n.writeInt(t),n.writeShort(e),n.writeShort(i),n.writeInt(s);else if(o&&o.activityType==ActivityDataFactory.ACTIVITY_TYPE_12)i==EnvelopeType.SEND?(n.writeInt(t),n.writeShort(e),n.writeShort(i),s&&n.writeString(s)):i==EnvelopeType.GET&&(n.writeInt(t),n.writeUnsignedShort(e),n.writeShort(i));else if(o&&o.activityType==ActivityDataFactory.ACTIVITY_TYPE_2){n.writeInt(t),n.writeShort(e);var a=i?i:0;n.writeShort(a)}else n.writeInt(t),n.writeShort(e);this.sendToServer(n)},e.prototype.sendLianxuReward=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.doRewardStatu=function(t){var e=t.readInt(),i=this.getActivityDataById(e);i?i.id==this.hfLoginID?(i.updateData(t),this.hfLoginDay=i.logTime):i.id==this.geLoginID?(i.updateData(t),this.geLoginDay=i.logTime):i.updateData(t):(i=new ActivityType5Data(null),this.activityData[e]=i,i.updateData(t)),this.postActivityIsGetAwards()},e.prototype.postChangePage=function(t){var e=ActivityDataFactory.create(t);return e&&(-1!=this.doubleElevenIDs.indexOf(e.id)?this.doubleElevenData[e.id]=e:-1!=this.doubleTwelveRechargeIDAry.indexOf(e.id)?this.doubleTwelveRechargeData[e.id]=e:-1!=this.doubleTwelveIDAry.indexOf(e.id)?this.doubleTwelveData[e.id]=e:this.activityData[e.id]=e),this.postActivityIsGetAwards(),e?e.id:0},e.prototype.sendChangePage=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.doDaBiaoInfo=function(t){this.dabiaoDecode(t),this.postGetDaBiaoInfo()},e.prototype.postGetDaBiaoInfo=function(){},e.prototype.doNextDayLoginData=function(t){this.nextDayState=t.readShort(),debug.log(this.nextDayState)},e.prototype.doNextDayLoginReward=function(t){var e=t.readShort();e&&(this.nextDayState=2,UserTips.ins().showTips(StringUtils.addColor("领取奖励成功",15937822)))},e.prototype.sendNextDayReward=function(){var t=this.getBytes(20);this.sendToServer(t)},e.prototype.sendDabiaoInfo=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetDabiaoReward=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.postIsGetAwards=function(t){this.isGetAward=t.readBoolean()},e.prototype.sendGetSevenDayAwards=function(t){var e=this.getBytes(12);e.writeShort(t),this.sendToServer(e)},e.prototype.doSevenDayData=function(t){this.dayNum=t.readShort(),this.isAwards=t.readInt(),this.postSevendayIsAwards()},e.prototype.doChangeSevenDayData=function(t){var e=t.readBoolean();if(e){t.readShort();this.isAwards=t.readInt(),this.postSevendayAwardCallback()}else UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");this.postSevendayIsAwards()},e.prototype.postSevendayAwardCallback=function(){},e.prototype.postSevendayIsAwards=function(){},e.prototype.postNextDayInfo=function(){},e.prototype.getSevenDayStast=function(){var t=DateUtils.DAYS_PER_WEEK;t=this.dayNum>14?14:this.dayNum;for(var e=1;t>=e;e++){var i=GlobalConfig.LoginRewardsConfig[e];if(i&&this.dayNum>=i.day&&0==(this.isAwards>>i.day&1))return!0}return!1},e.prototype.checkNoticeRed=function(){var t=GlobalConfig.WelfareConfig[4],i=e.ins().getActivityDataById(t.activityId?t.activityId:0);return i&&i.canReward()},e.prototype.getSevenDayLogIsVisible=function(){return 0==(this.isAwards>>14&1)},e.prototype.getbtnInfo=function(t){var e=GlobalConfig.ActivityBtnConfig;return e[t]?e[t]:null},e.prototype.isShowRedPointByBtnInfo=function(t){var e=!1;return e=this.checkAcCanGet(t.id+"")},e.prototype.checkAcCanGet=function(t){if(-1!=this.doubleElevenIDs.indexOf(Number(t))){if(-1!=this.doubleElevenSpecialIDs.indexOf(Number(t))){for(var i,s=this.doubleElevenSpecialIDs.length,n=0;s>n;n++)if(i=this.doubleElevenData[this.doubleElevenSpecialIDs[n]],i.isSpecialOpen()&&i.canReward())return!0}else{var o=this.doubleElevenData[Number(t)];if(o.isOpenActivity()&&o.canReward())return!0}return!1}if(-1!=this.doubleTwelveIDAry.indexOf(Number(t)))for(var a in this.doubleTwelveData){if(a==t&&this.doubleTwelveData[a].isOpenActivity()&&9==this.doubleTwelveData[a].type)for(var r=0;3>r;r++)if(e.ins().isGetRollReward(this.doubleTwelveData[a].id,r))return!0;return!1}var h=this.activityData;for(var l in h)if(l==t&&h[l].isOpenActivity()&&h[l].canReward()&&h[l].specialState())return!0;return!1},e.prototype.checkOtherCharge2CanGet=function(){var t=Recharge.ins().getRechargeData(1),e=GlobalConfig.ChongZhi2Config[t.day/7>=1?2:1][t.day%7];for(var i in e)if(0==(t.isAwards>>e[i].index&1)&&t.num>=e[i].pay)return!0;return!1},e.prototype.dabiaoDecode=function(t){this.isDaBiao=t.readBoolean(),this.indexCurrDabiao=Math.max(t.readInt()-1,0);var e=t.readShort();if(e==RankDataType.TYPE_LEVEL)t.readInt(),t.readInt();else if(e==RankDataType.TYPE_BAOSHI)this.myDabiaoInfo=t.readInt();else if(e==RankDataType.TYPE_ZHANLING){var i=t.readInt(),s=t.readInt();this.myDabiaoInfo=[i,s]}else e==RankDataType.TYPE_LONGHUN?this.myDabiaoInfo=t.readInt():e==RankDataType.TYPE_XIAOFEI?this.myDabiaoInfo=t.readInt():e==RankDataType.TYPE_HF_XIAOFEI?(this.myDabiaoInfo=t.readInt(),this.myPaiming=t.readInt()):this.myDabiaoInfo=t.readDouble();var n,o=t.readShort();this.rankInfoList=[];for(var a=0;o>a;a++)this.rankInfoList[a]||this.rankInfoList.push(new DabiaoData),n=this.rankInfoList[a],n.prase(t,e)},e.prototype.getisCangetDabiao3=function(t){var i=e.ins().getActivityDataById(t);return i.canOnlyReward?(i.canOnlyReward(),i.btn1||i.btn2):this.checkAcCanGet(t+"")},e.prototype.getisCanBuyXianGou=function(t){var e=!1,i=GlobalConfig.ActivityType2Config[t];if(i)for(var s=0;s<i.length&&!(e=this.getisCanBuyXianGouItem(t,s));s++);return e},e.prototype.getisCanBuyXianGouItem=function(t,i){var s=!1,n=e.ins().activityData[t],o=GlobalConfig.ActivityType2Config[t];if(n&&o){var a=o[i],r=n.buyData[i]||0;if(a&&r){var h=1==a.currencyType?Actor.gold:Actor.yb,l=1==a.currencyType,c=parseInt(h+"")>=a.price,u=a.count-r>0;s=l&&c&&u}}return s},e.prototype.isDoubleElevenCanGet=function(){var t=this.doubleElevenData;for(var e in t)if(t[e].isSpecialOpen()&&t[e].canReward())return!0;return!1},e.prototype.IsHefuXunBaoTimer=function(){if(!GameServer._serverHeZeroTime)return!1;var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),e=t+24*GlobalConfig.TreasureHuntConfig.hefuDay*60*60*1e3,i=GameServer.serverTime;return i>=t&&e>=i?!0:!1},e.prototype.IsBossScoreTitle=function(t,i){var s=GlobalConfig.ActivityType7Config[t],n=e.ins().getActivityDataById(t);for(var o in s){var a=s[o];if(a.title==i&&this.getIsBuy(a)&&n.bossScore>=a.score)return!0}return!1},e.prototype.getIsBuy=function(t){if(t){var i=e.ins().getActivityDataById(t.Id);return t.count&&i.personalRewardsSum[t.index]>=t.count?!1:t.scount&&i.worldRewardsSum[t.index]>=t.scount?!1:!0}},e.prototype.getType7RedPoint=function(t){var i,s=GlobalConfig.ActivityType7Config[t],n=e.ins().getActivityDataById(t);if(s[1].showType==ActivityType7Data.TYPE_LABA)for(var o in s){var a=n.getExchange(s[o].index);if(a==e.CanGet)return!0}else for(var o in s)if(e.ins().getIsBuy(s[o]))if(s[o].itemId){if(i=UserBag.ins().getBagItemById(s[o].itemId),i&&i.count>=s[o].itemCount)return!0}else if(n.bossScore>=s[o].score)return!0;return!1},e.prototype.getCurrentRingAwardIndex=function(t){var e=1;if(t>0)for(;0!=(t>>e&1);)e++;return e},e.prototype.getRingAward=function(t){for(var e in GlobalConfig.ActivityType8Config){var i=GlobalConfig.ActivityType8Config[e][1];if(i.showType==ActivityType8Data.TYPE_RING)for(var s in GlobalConfig.ActivityType8Config[e])if(s==t.toString())return GlobalConfig.ActivityType8Config[e][s]}return null},e.prototype.getLastRingAward=function(){var t;for(var e in GlobalConfig.ActivityType8Config){var i=GlobalConfig.ActivityType8Config[e][1];if(i.showType==ActivityType8Data.TYPE_RING)for(var s in GlobalConfig.ActivityType8Config[e])t=GlobalConfig.ActivityType8Config[e][s]}return t},e.prototype.addEvent=function(){MessageCenter.addListener(GameLogic.ins().postEnterMap,this.openRingActivity,this)},e.prototype.removeEvent=function(){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap.funcallname,this.openRingActivity,this)},e.prototype.openRingActivity=function(){0==GameMap.fbType&&(MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap.funcallname,this.openRingActivity,this),ViewManager.ins().open(ActivityWin,201),e.ins().sendChangePage(201))},e.prototype.getType8RedPoint=function(t){var i=!1,s=e.ins().activityData[t];return s&&0==s.record&&(i=!0),i},e.prototype.getType9RedPoint=function(t){var i=!1;e.ins().activityData[t];if(this.getRollSum(t))i=!0;else{var s=GlobalConfig.ActivityType9Config[t];if(Assert(s,"ActivityType9Config is null!! activityId:"+t))return!1;for(var n in s[0].reward)if(this.isGetRollReward(t,+n)){i=!0;break}}return i},e.prototype.getType10RedPoint=function(t){var i=e.ins().activityData[t],s=GlobalConfig.ActivityType10Config[t][i.getLevel()];return s&&i.yb>=s.recharge&&Actor.yb>=s.yuanBao?!0:!1},e.prototype.getType17RedPoint=function(t){var i=e.ins().activityData[t],s=GlobalConfig.ActivityType17_2Config[t];return s&&i.score>=s.score?!0:!1},e.prototype.isGetRollReward=function(t,i){var s=e.ins().activityData[t];s||(s=e.ins().doubleTwelveData[t]);var n=GlobalConfig.ActivityType9Config[t];return n&&n[0]&&n[0].reward[i].times&&s.count>=n[0].reward[i].times&&!(s.record>>i+1&1)?!0:!1},e.prototype.getRollSum=function(t){var e=GlobalConfig.ActivityType9Config[t];if(e&&e[0]){var i=UserBag.ins().getBagItemById(e[0].item);if(i)return!0}return!1},e.prototype.getIsRollTen=function(t){var e=GlobalConfig.ActivityType9Config[t][0];if(e){var i=0;if(e.item){var s=UserBag.ins().getBagItemById(e.item);if(s&&(i+=s.count),i>=10)return!0}if(i=10-i,e.yb&&Actor.yb>=e.yb*i)return!0}return!1},e.prototype.postKuaFuRank=function(t){var i=t.readInt(),s=t.readInt(),n=e.ins().getActivityDataById(i);n&&n.CleanRandData();for(var o=0;s>o;o++){var a=new KuaFuRankData;a.actorId=t.readInt(),a.rmb=t.readInt(),a.rank=t.readInt(),a.serverId=t.readInt(),a.roleName=t.readString(),a.job=t.readInt(),a.sex=t.readInt(),n&&n.SetRankData(a)}var r=t.readInt();n&&(n.mycost=r)},e.prototype.sendKuaFuRank=function(t){var e=this.getBytes(22);e.writeInt(t),this.sendToServer(e)},e.prototype.checkLabaBossData=function(){for(var t in e.ins().activityData)if(e.ins().activityData[t].pageStyle==ActivityPageStyle.LABA&&e.ins().activityData[t].type==ActivityDataFactory.ACTIVITY_TYPE_20&&e.ins().getActivityDataById(+t).isOpenActivity()){var i=e.ins().activityData[t].id,s=e.ins().getActivityDataById(i);return s}return null},e.prototype.getConfig22_3=function(t){var e,i=GlobalConfig.ActivityType22_3Config[t];for(var s in i){e=i[s];for(var n in e)if(e[n].low<=UserZs.ins().lv&&UserZs.ins().lv<=e[n].high)return e[n]}return null},e.prototype.sendEnvelopeData=function(t,e){var i=this.getBytes(6);i.writeInt(t),i.writeUnsignedShort(e),this.sendToServer(i)},e.prototype.postEnvelopeData=function(t){var e=t.readInt(),i=t.readByte();if(i){var s=t.readUnsignedShort(),n=t.readShort(),o=t.readShort(),a=t.readShort(),r=t.readInt(),h=t.readString(),l=t.readString(),c=new EnvelopeData;return c.id=e,c.eId=s,c.job=n,c.sex=o,c.index=a,c.serverId=r,c.name=h,c.desc=l,void this.postEnvelopeDataCall(c)}this.postEnvelopeDataCall(null)},e.prototype.postEnvelopeDataCall=function(t){return t},e.prototype.postRedEnvelopeData=function(t){var e=t.readInt();if(this.activityData[e]&&this.activityData[e]instanceof ActivityType12Data){var i=this.activityData[e],s=t.readShort(),n=t.readShort();if(1==s){if(n){var o=new RedEnvelope;o.id=t.readUnsignedShort(),o.timer=t.readInt(),i.envelopeData.push(o)}}else{for(var a=[],r=0;n>r;r++){var o=new RedEnvelope;o.id=t.readUnsignedShort(),o.timer=t.readInt(),a.push(o)}i.envelopeData=a}}},e.prototype.checkActivityTimer=function(){for(var t in this.activityData)if(this.activityData[t]instanceof ActivityType12Data){TimerManager.ins().isExists(this.ActivityTimerSecond1,this)||TimerManager.ins().doTimer(1e3,0,this.ActivityTimerSecond1,this);break}},e.prototype.postGetRedEnvelope=function(t,e,i,s,n){return[t,e,i,s,n]},e.prototype.ActivityTimerSecond1=function(){for(var t=0;t<this._actTimeSecond1.length;){var e=this._actTimeSecond1[t];if(this.activityData[e]){if(!this.activityData[e].isOpenActivity()){if(this.activityData[e]instanceof ActivityType12Data){var i=this.activityData[e];i.clearAll()}this._actTimeSecond1.splice(t,1);continue}if(this.activityData[e]instanceof ActivityType12Data){var i=this.activityData[e];i.checkClear()}}t++}},Object.defineProperty(e.prototype,"activityTimers",{get:function(){return this._actTimeSecond1=this._actTimeSecond1?this._actTimeSecond1:[],this._actTimeSecond1},enumerable:!0,configurable:!0}),e}(BaseSystem);Activity.NotReached=0,Activity.CanGet=1,Activity.Geted=2,Activity.NOKILL=0,Activity.KILL=1,__reflect(Activity.prototype,"Activity");var DabiaoData=function(){function t(){}return t.prototype.prase=function(t,e){if(e==RankDataType.TYPE_XIAOFEI||e==RankDataType.TYPE_HF_XIAOFEI)return this.rankIndex=t.readShort(),this.id=t.readInt(),this.name=t.readString(),void(this.numType=t.readInt());if(this.rankIndex=t.readShort(),this.id=t.readInt(),this.name=t.readString(),this.level=t.readShort(),this.zsLevel=t.readShort(),this.monthCard=t.readShort(),this.vipLv=t.readShort(),RankDataType.TYPE_LEVEL!=e)if(e==RankDataType.TYPE_BAOSHI||e==RankDataType.TYPE_LONGHUN)this.numType=t.readInt();else if(e==RankDataType.TYPE_ZHANLING){var i=t.readInt(),s=t.readInt();this.numType=[i,s]}else this.numType=t.readDouble()},t}();__reflect(DabiaoData.prototype,"DabiaoData");var GameSystem;!function(t){t.activity=Activity.ins.bind(Activity)}(GameSystem||(GameSystem={}));var ActivityBtnType=function(){function t(){}return t}();ActivityBtnType.LEI_JI_1=1,ActivityBtnType.DA_BIAO=2,ActivityBtnType.CHONG_JI=3,ActivityBtnType.LEI_JI_2=4,ActivityBtnType.XIAN_GOU=5,ActivityBtnType.QI_XI_XIAN_GOU=6,ActivityBtnType.TE_HUI_1=7,ActivityBtnType.LEI_JI_3=8,ActivityBtnType.TE_HUI_2=9,ActivityBtnType.LEI_JI_4=10,ActivityBtnType.TE_HUI_3=11,ActivityBtnType.ZHONG_QIU=12,ActivityBtnType.SHENG_XIA=13,ActivityBtnType.GUO_QING_LEI_JI=14,ActivityBtnType.GUO_QING_DENG_LU=15,ActivityBtnType.GUO_QING_XIAN_GOU=16,ActivityBtnType.LEI_JI_DAYS42=10002,ActivityBtnType.LEI_JI_EVERYDAY=10003,ActivityBtnType.THREE_HEROES=10004,ActivityBtnType.HEFU_XUNBAO=10005,ActivityBtnType.HEFU_BOSS=10006,ActivityBtnType.HEFU_JZLC=10007,ActivityBtnType.HEFU_CZZS=10008,ActivityBtnType.SANRI_RECHARGE=10017,__reflect(ActivityBtnType.prototype,"ActivityBtnType");var HBSystem=function(t){function e(){var e=t.call(this)||this;return e.observe(Activity.ins().postGetRedEnvelope,e.showHongBaoTips),e.observe(Activity.ins().postRewardResult,e.ActRewardResult),e.observe(Activity.ins().postEnvelopeDataCall,e.showEnvelope),e.observe(Activity.ins().postRedEnvelopeData,e.updateHongBao),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.updateHongBao=function(){var t=ViewManager.ins().getView(PlayFunView);if(t&&t.hongbao&&!(t.hongbao.numElements>0))for(var e=0;e<Activity.ins().activityTimers.length;e++){var i=Activity.ins().activityTimers[e];if(Activity.ins().activityData[i]&&Activity.ins().activityData[i]instanceof ActivityType12Data){var s=Activity.ins().activityData[i];if(!s.envelopeData.length)continue;for(var n=s.envelopeData.length-1;n>=0;)if(n=s.envelopeData.length-1,s.envelopeData[n]){var o=s.envelopeData[n].id;if(!s.envelopeData[n].isOverTimer()){var a=new HongBaoShowItem;a.data={actId:i,eId:o},t.hongbao.addChild(a);break}s.popEnvelope(o)}else s.envelopeData.splice(e,1)}}},e.prototype.showHongBaoTips=function(t){var e=t[0],i=t[1],s=t[2],n=(t[3],t[4]),o=Activity.ins().activityData[e];if(o){if(s){var a=new RewardData;a.type=0,a.id=MoneyConst.yuanbao,a.count=s,UserTips.ins().showGoodRewardTips(a)}i&&o.popEnvelope(i),this.HongBaoResultAni(n)}},e.prototype.HongBaoResultAni=function(t){var e=ViewManager.ins().getView(PlayFunView);if(e&&e.hongbao){var i=e.hongbao.getChildAt(1);i&&i.playAni(t,this.updateHongBao,this)}},e.prototype.ActRewardResult=function(t){-1!=Activity.ins().activityTimers.indexOf(t)&&Activity.ins().activityData[t]&&Activity.ins().activityData[t]instanceof ActivityType12Data&&(Activity.ins().isSuccee||(Activity.ins().activityData[t].isOpenActivity()?UserTips.ins().showTips("|C:0xff0000&T:红包已过期"):UserTips.ins().showTips("|C:0xff0000&T:活动已结束")))},e.prototype.showEnvelope=function(t){var e=ViewManager.ins().getView(PlayFunView);if(e&&e.hongbao){if(!t)return UserTips.ins().showTips("|C:0xff0000&T:红包已过期"),e.hongbao.removeChildren(),void this.updateHongBao();if(Activity.ins().activityData[t.id]&&Activity.ins().activityData[t.id]instanceof ActivityType12Data){var i=new HongBaoOpenItem;t.desc||(t.desc=GlobalConfig.ActivityType12Config[t.id][t.index].blessWord),i.data={actId:t.id,eId:t.eId,job:t.job,sex:t.sex,name:t.name,text:t.desc,index:t.index},e.hongbao.addChildAt(i,1)}}},e}(BaseSystem);__reflect(HBSystem.prototype,"HBSystem");var GameSystem;!function(t){t.hbsystem=HBSystem.ins.bind(HBSystem)}(GameSystem||(GameSystem={}));var GameSocket=function(){function t(){this._socketStatus=0,this._lastReceiveTime=0,this.pid=0,this.PACK_HANDLER=[],this._serverId=0,this._user="",this._pwd="",this.lastPos=-1,this.hasShowReLoginWin=!1,this.disconnectTime=0,egret.startTick(this.update,this),this.newSocket(),this.recvPack=new GameByteArray,this._packets=[]}return t.ins=function(){return t._ins||(t._ins=new t),t._ins},t.prototype.getSocket=function(){return this.socket_},t.prototype.newSocket=function(){this.socket_&&this.removeEvent(),this.socket_=new egret.WebSocket,this.socket_.type=egret.WebSocket.TYPE_BINARY,this.socket_.addEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.socket_.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket_.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketRead,this),this.socket_.addEventListener(egret.IOErrorEvent.IO_ERROR,this.connectError,this)},t.prototype.removeEvent=function(){this.socket_.removeEventListener(egret.Event.CONNECT,this.onSocketConnected,this),this.socket_.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket_.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketRead,this),this.socket_.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.connectError,this)},t.prototype.sendToServer=function(t){this.send(t),t.position=12,this.recycleByte(t)},t.prototype.connectError=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window.connectError(),TimerManager.ins().remove(this.reLogin,this),TimerManager.ins().doTimer(1e3,1,this.reLogin,this)},t.prototype.connect=function(e,i){this.updateStatus(t.STATUS_CONNECTING),this._host=e,this._port=i,-1!=location.protocol.indexOf("https:")?this.socket_.connectByUrl("wss://"+e+":"+i):this.socket_.connect(e,i)},t.prototype.close=function(){this.socket_&&this.socket_.close()},t.prototype.send=function(e){return this._socketStatus==t.STATUS_COMMUNICATION?(this.sendPack(e),!0):(console.log("发送数据时没和服务连接或者未进入通信状态"),!1)},t.prototype.onSocketConnected=function(e){console.log("Socket connected！ip:"+this._host+" port:"+this._port),TimerManager.ins().remove(this.reLogin,this),this.updateStatus(t.STATUS_CHECKING);var i=Encrypt.getSelfSalt();console.log("发送Encrypt:",i);var s=new GameByteArray;s.writeUnsignedInt(i),this.socket_.writeBytes(s),this.socket_.flush(),this._onConnected&&this._onConnected()},t.prototype.onSocketRead=function(e){if(-1!=this.lastPos){for(var i=0;i<=this.lastPos;i++)this.recycleByte(this._packets[i]);this._packets.splice(0,this.lastPos+1),this.lastPos=-1}if(this._socketStatus<t.STATUS_COMMUNICATION)return void this.sendKeyToServer();var s=new GameByteArray;this._lastReceiveTime=egret.getTimer(),this.socket_.readBytes(s,s.length);var n=s.readUnsignedShort();if(n==t.DEFAULT_TAG){s.readUnsignedShort();s.position+=4,this._packets.push(s)}},t.prototype.update=function(t){for(var e=0,i=this._packets;e<i.length;e++){var s=i[e];this.lastPos++,this.processRecvPacket(s),this.recycleByte(s)}return this._packets.length=0,this.lastPos=-1,!1},t.prototype.sendKeyToServer=function(){var e=new GameByteArray;this.socket_.readBytes(e),e.position=0;var i=e.readUnsignedInt();Encrypt.setTargetSalt(i);var s=Encrypt.getCheckKey();console.log("发送校验码：",s),e.position=0,e.writeShort(s),this.socket_.writeBytes(e,0,2),this.updateStatus(t.STATUS_COMMUNICATION)},t.prototype.onSocketClose=function(e){console.log("与服务器的连接断开了！ip:"+this._host+" port:"+this._port),this.updateStatus(t.STATUS_DISCONNECT),TimerManager.ins().remove(this.reLogin,this),KFServerSys.ins().closeSocket(),this.showReLoginWin()},t.prototype.showReLoginWin=function(){var t=this;if(!this.hasShowReLoginWin||!ViewManager.ins().isShow(WarnWin)){this.hasShowReLoginWin=!0,this.disconnectTime=egret.getTimer();var e=function(){t.hasShowReLoginWin=!1,t._onClosed&&t._onClosed(),TimerManager.ins().remove(t.reLogin,t),egret.getTimer()-t.disconnectTime>=6e3?t.reLogin():TimerManager.ins().doTimer(6e3-(egret.getTimer()-t.disconnectTime),1,t.reLogin,t)};WarnWin.show("网络已断开，点击确定重新连接",e,this,e,this,"sure")}},t.prototype.reLogin=function(){var t=this;this.close();var e=function(){t.newSocket(),RoleMgr.ins().connectServer()};return LocationProperty.isLocation?void e():void window.getClientVersion(function(t){var i=parseInt(t)||0;i===LocationProperty.v||0===i?e():location.reload()})},t.prototype.updateStatus=function(t){if(this._socketStatus!=t){var e=this._socketStatus;
this._socketStatus=t,this.onFinishCheck(t,e)}},t.prototype.onFinishCheck=function(e,i){e==t.STATUS_COMMUNICATION?(console.log("与服务器建立通信成功！ip:"+this._host+" port:"+this._port),KFServerSys.ins().isKF?KFServerSys.ins().sendKFLogin():this.sendCheckAccount(this._user,this._pwd)):e==t.STATUS_DISCONNECT},Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this._port},enumerable:!0,configurable:!0}),t.prototype.sendCheckAccount=function(t,e){console.log("登陆验证，命令码 255,1",this._serverId,t,e);var i=this.getBytes();i.writeCmd(255,1),i.writeInt(this._serverId),i.writeString(t),i.writeString(e),this.sendToServer(i)},t.prototype.login=function(t,e,i,s,n){this._user=t,this._pwd=e,this._serverId=i,s.split(":")[1]&&s.split(":")[1].length&&(n=parseInt(s.split(":")[1])),this.socket_.connected?this.sendCheckAccount(t,e):(console.log("connect to "+s+" ,port: "+n),this.connect(s,n))},t.prototype.processRecvPacket=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte();this.dispatch(e,i,t)},t.prototype.dispatch=function(t,e,i){if(this.PACK_HANDLER[t]&&this.PACK_HANDLER[t][e]){var s=this.PACK_HANDLER[t][e];s[0].call(s[1],i)}},t.prototype.recycleByte=function(t){ObjectPool.push(t)},t.prototype.getBytes=function(){var e=ObjectPool.pop(t.CLASSNAME);return e.clear(),e.writeShort(t.DEFAULT_TAG),e.writeShort(0),e.writeShort(0),e.writeShort(t.DEFAULT_CRC_KEY),e.writeUnsignedInt(this.pid++),e},t.prototype.registerSTCFunc=function(t,e,i,s){if(this.PACK_HANDLER[t]){if(this.PACK_HANDLER[t][e])return void console.error("重复注册协议接口"+t+"-"+e)}else this.PACK_HANDLER[t]=[];this.PACK_HANDLER[t][e]=[i,s]},t.prototype.setOnClose=function(t,e){this._onClosed=t.bind(e)},t.prototype.setOnConnected=function(t,e){this._onConnected=t.bind(e)},t.prototype.sendPack=function(e){if(null==e||0==e.length)throw new egret.error("创建客户端数据包时数据不能为空！");var i=t.HEAD_SIZE;e.position=2,e.writeShort(e.length-i);var s=Encrypt.getCRC16ByPos(e,i);e.position=4,e.writeShort(s);var n=Encrypt.getCRC16(e,i);e.position=6,e.writeShort(n),Encrypt.encode(e,4,4),this.socket_.writeBytes(e)},t}();GameSocket.DEFAULT_TAG=52462,GameSocket.DEFAULT_CRC_KEY=30301,GameSocket.HEAD_SIZE=8,GameSocket.STATUS_CONNECTING=1,GameSocket.STATUS_CHECKING=2,GameSocket.STATUS_COMMUNICATION=3,GameSocket.STATUS_DISCONNECT=4,GameSocket.CLASSNAME=egret.getQualifiedClassName(GameByteArray),__reflect(GameSocket.prototype,"GameSocket");var ActivityDataFactory=function(){function t(){}return t.create=function(e){var i,s=e.readInt(),n=e.readInt(),o=e.readInt(),a=e.readShort(),r=e.readInt();switch(a){case t.ACTIVITY_TYPE_1:i=new ActivityType1Data(e);break;case t.ACTIVITY_TYPE_2:i=new ActivityType2Data(e);break;case t.ACTIVITY_TYPE_3:i=new ActivityType3Data(e);break;case t.ACTIVITY_TYPE_4:i=new ActivityType4Data(e);break;case t.ACTIVITY_TYPE_5:i=Activity.ins().getActivityDataById(s),i?i.updateRecord(e):i=new ActivityType5Data(e);break;case t.ACTIVITY_TYPE_6:i=new ActivityType6Data(e);break;case t.ACTIVITY_TYPE_7:i=new ActivityType7Data(e);break;case t.ACTIVITY_TYPE_8:i=new ActivityType8Data(e);break;case t.ACTIVITY_TYPE_9:i=new ActivityType9Data(e);break;case t.ACTIVITY_TYPE_10:i=new ActivityType10Data(e);break;case t.ACTIVITY_TYPE_11:i=new ActivityType11Data(e,s,n,o);break;case t.ACTIVITY_TYPE_12:Activity.ins().activityData[s]?(i=Activity.ins().activityData[s],i.init(e,s)):i=new ActivityType12Data(e,s);break;case t.ACTIVITY_TYPE_17:i=new ActivityType17Data(e);break;case t.ACTIVITY_TYPE_18:i=new ActivityType18Data(e);break;case t.ACTIVITY_TYPE_19:i=new ActivityType19Data(e);break;case t.ACTIVITY_TYPE_20:i=new ActivityType20Data(e);break;case t.ACTIVITY_TYPE_21:i=new ActivityType21Data(e);break;case t.ACTIVITY_TYPE_22:i=new ActivityType22Data(e);break;default:debug.log("错误活动类型:"+a);for(var h=0;r>h;h++)e.readByte();return null}if(!i)return null;i.id=s,i.startTime=n,i.endTime=o,i.type=a,i.activityType=ActivityType.Normal;var l=GlobalConfig.ActivityConfig[s];return l&&(i.timeType=l.timeType,i.pageStyle=l.pageStyle,i.pageSkin=l.pageSkin),i},t.createEx=function(){var e,i=GlobalConfig.ActivityBtnConfig,s=DateUtils.formatMiniDateTime(GameServer._serverZeroTime),n=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);for(var o in i){var a=i[o],r=a.hfTimes?a.hfTimes:0,h=a.timeType?a.timeType:0;if((!h||h!=t.TimeType_Total||!r||r==GameServer._hefuCount)&&a.id>1e4){if(e=new ActivityType0Data(null),e.id=a.id,e.type=a.type,e.activityType=ActivityType.Normal,e.timeType=a.timeType,a.pageStyle&&(e.pageStyle=a.pageStyle),a.relyOn){e.relyOn=a.relyOn;for(var l=0;l<a.relyOn.length;l++)if(Activity.ins().activityData[a.relyOn[l]]){e.startTime=DateUtils.formatMiniDateTime(Activity.ins().activityData[a.relyOn[l]].startTime),e.endTime=DateUtils.formatMiniDateTime(Activity.ins().activityData[a.relyOn[l]].endTime);break}}else if(a.timeType==t.TimeType_Normal){var c=a.startTime.split("-"),u=+c[0],p=c[1].split(":"),d=new Date(s);if(d.setDate(d.getDate()+u),d.setHours(+p[0],+p[1],0,0),e.startTime=d.getTime(),a.endTime){c=a.endTime.split("-");var g=+c[0],f=c[1].split(":"),v=new Date(s);v.setDate(v.getDate()+g),v.setHours(+f[0],+f[1],0,0),e.endTime=v.getTime()}else e.endTime=GameServer.serverTime+2592e6}else if(a.timeType==t.TimeType_Fixed)e.startTime=new Date(a.startTime).getTime(),e.endTime=new Date(a.endTime).getTime();else if(a.timeType==t.TimeType_Total){var c=[],g=DateUtils.DAYS_PER_WEEK;switch(a.endTime&&(c=a.endTime.split("-"),g=+c[0]),a.id){case ActivityBtnType.HEFU_XUNBAO:e.startTime=n,e.endTime=n+24*GlobalConfig.TreasureHuntConfig.hefuDay*60*60*1e3;break;case ActivityBtnType.HEFU_BOSS:case ActivityBtnType.HEFU_JZLC:case ActivityBtnType.HEFU_CZZS:e.startTime=n,e.endTime=n+g*DateUtils.SECOND_PER_DAY*1e3}}else e.startTime=s,e.endTime=GameServer.serverTime+2592e6;var y=Math.floor((e.endTime-GameServer.serverTime)/1e3);y>0?Activity.ins().activityData[a.id]=e:a.id==ActivityBtnType.THREE_HEROES&&ThreeHeroes.ins().showIcon3DaysLater&&(Activity.ins().activityData[a.id]=e)}}},t}();ActivityDataFactory.TimeType_Normal=0,ActivityDataFactory.TimeType_Fixed=1,ActivityDataFactory.TimeType_Total=2,ActivityDataFactory.ACTIVITY_TYPE_1=1,ActivityDataFactory.ACTIVITY_TYPE_2=2,ActivityDataFactory.ACTIVITY_TYPE_3=3,ActivityDataFactory.ACTIVITY_TYPE_4=4,ActivityDataFactory.ACTIVITY_TYPE_5=5,ActivityDataFactory.ACTIVITY_TYPE_6=6,ActivityDataFactory.ACTIVITY_TYPE_7=7,ActivityDataFactory.ACTIVITY_TYPE_8=8,ActivityDataFactory.ACTIVITY_TYPE_9=9,ActivityDataFactory.ACTIVITY_TYPE_10=10,ActivityDataFactory.ACTIVITY_TYPE_11=11,ActivityDataFactory.ACTIVITY_TYPE_12=12,ActivityDataFactory.ACTIVITY_TYPE_17=17,ActivityDataFactory.ACTIVITY_TYPE_18=18,ActivityDataFactory.ACTIVITY_TYPE_19=19,ActivityDataFactory.ACTIVITY_TYPE_20=20,ActivityDataFactory.ACTIVITY_TYPE_21=21,ActivityDataFactory.ACTIVITY_TYPE_22=22,__reflect(ActivityDataFactory.prototype,"ActivityDataFactory");var ActivityPageStyle;!function(t){t[t.THANKS=1]="THANKS",t[t.NEWYEAR=2]="NEWYEAR",t[t.CHRISTMAS=3]="CHRISTMAS",t[t.HAPPYSEVENDAY=4]="HAPPYSEVENDAY",t[t.TOTALRECHARGE=5]="TOTALRECHARGE",t[t.CELEBRATION=6]="CELEBRATION",t[t.LABA=7]="LABA",t[t.YBZHUANPAN=8]="YBZHUANPAN",t[t.ZHANLING=9]="ZHANLING",t[t.SPRINGBEGIN=10]="SPRINGBEGIN",t[t.XIAONIAN=11]="XIAONIAN",t[t.SPRINGFESTIVAL=12]="SPRINGFESTIVAL",t[t.SPRINGEIGHTDAY=13]="SPRINGEIGHTDAY",t[t.KAIMENHONG=14]="KAIMENHONG",t[t.SANBA=15]="SANBA",t[t.LONGTAITOU=16]="LONGTAITOU",t[t.VERSIONCELE=17]="VERSIONCELE"}(ActivityPageStyle||(ActivityPageStyle={}));var ActivityType0Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.specialState=function(){var t,e,i,s,n=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);if(this.id==ActivityBtnType.HEFU_BOSS){for(var o=[0,1,3,5],a=0;a<o.length;a++)if(t=n+o[a]*DateUtils.MS_PER_DAY,e=new Date(t),e.setHours(20,30,0),i=n+(o[a]+1)*DateUtils.MS_PER_DAY,s=new Date(i),GameServer.serverTime>=e.getTime()&&GameServer.serverTime<s.getTime()){var r=GlobalConfig.CityBossConfig[a+1];if(!r)return!1;var h=r.killBossId,l=CityCC.ins().bossKillNumData;if(l&&void 0!=l[h]&&1!=l[h][1])return!0}return!1}if(this.id==ActivityBtnType.HEFU_JZLC){var o=GlobalConfig.GuildBattleConst.hefuOpen;return o&&GuildWar.ins().getModel().isWatStart?!0:!1}return!0},e.prototype.canReward=function(){if(this.id==ActivityBtnType.LEI_JI_DAYS42)return Recharge.ins().rechargeTotal.hasGetDays.length<Recharge.ins().rechargeTotal.totalDay;if(this.id==ActivityBtnType.LEI_JI_EVERYDAY){var t=Recharge.ins().getRechargeData(0),e=Recharge.ins().getCurRechargeConfig();for(var i in e){var s=e[i];if(t.curDayPay>=s.pay){var n=t.isAwards>>s.index&1;if(!n)return!0}}}else{if(this.id==ActivityBtnType.THREE_HEROES)return ThreeHeroes.ins().awardState==ThreeHeroes.CanGet;if(this.id==ActivityBtnType.HEFU_JZLC||this.id==ActivityBtnType.HEFU_BOSS)return!0;if(this.id==ActivityBtnType.SANRI_RECHARGE){var o=GlobalConfig.MultiDayRechargeConfig;for(var a in o){var r=o[a];if(Recharge.ins().mDayNum==parseInt(a)&&Recharge.ins().mRecNum>=r.num&&0==Recharge.ins().mReward)return!0}}}var h=GlobalConfig.ActivityBtnConfig[this.id];if(h&&h.jump&&h.jump[0]==StatePageSysType.RING&&LyMark.ins().checkOpen()&&!LyMark.ins().isMax){var l=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv],c=UserBag.ins().getBagItemById(l.costItem),u=c?c.count:0;return u>=l.costCount}return!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;if(this.id==ActivityBtnType.LEI_JI_DAYS42)Recharge.ins().rechargeTotal.hasGetDays.length>=CommonUtils.getObjectLength(GlobalConfig.RechargeDaysAwardsConfig)&&(this.isHide=!0);else if(this.id==ActivityBtnType.THREE_HEROES)this.isHide=!this.isOpenActivity();else if(this.id==ActivityBtnType.HEFU_BOSS){var t=[0,1,3,5],e=GlobalConfig.CityBossConfig[t.length];if(e){var i=e.killBossId,s=CityCC.ins().bossKillNumData;s&&void 0!=s[i]&&s[i][1]>=1&&(this.isHide=!0)}}else if(this.id==ActivityBtnType.HEFU_JZLC){var n=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),t=GlobalConfig.GuildBattleConst.hefuOpen,o=t.length-1,a=n+t[o].day*DateUtils.MS_PER_DAY,r=new Date(a);if(r.setHours(0,0,0),GameServer.serverTime>r.getTime())return!0}return this.isHide},e.prototype.isOpenActivity=function(){var t=Math.floor((this.startTime-GameServer.serverTime)/1e3),e=Math.floor((this.endTime-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:this.id==ActivityBtnType.THREE_HEROES?ThreeHeroes.ins().showIcon3DaysLater:!1},e}(ActivityBaseData);__reflect(ActivityType0Data.prototype,"ActivityType0Data");var StatePageSysType;!function(t){t[t.WING=1]="WING",t[t.RING=2]="RING"}(StatePageSysType||(StatePageSysType={}));var ActivityType10Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.record=t.readInt(),this.yb=t.readInt(),this.index=t.readInt(),this.state=t.readByte();var e=t.readByte();this.noticeArr=[];for(var i=0;e>i;i++)this.noticeArr.push({name:t.readString(),multiple:t.readDouble(),yb:t.readInt()});this.noticeArr.reverse()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return Activity.ins().getType10RedPoint(this.id)},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getLevel=function(){var t=GlobalConfig.ActivityType10Config[this.id],e=Object.keys(t).length,i=this.record+1;return this.record>=e&&(i=0),i},e.prototype.getCondition=function(t){var e=GlobalConfig.ActivityType10Config[this.id][t];return e&&this.yb>=e.recharge?!0:!1},e}(ActivityBaseData);__reflect(ActivityType10Data.prototype,"ActivityType10Data");var ActivityType11Data=function(t){function e(e,i,s,n){var o=t.call(this,e)||this;return o._rewardInfo=0,o.id=i,o.startTime=s,o.endTime=n,o.update(e),o}return __extends(e,t),e.prototype.update=function(t){this._rewardInfo=t.readInt();var e=t.readShort();this._achieveInfo=[],this._achieveInfo.length=Object.keys(GlobalConfig.ActivityType11_2Config[this.id]).length;var i;for(i=0;e>i;i++)this._achieveInfo[t.readShort()-1]={times:t.readInt(),isGot:t.readBoolean()};e=this._achieveInfo.length;var s;this._hiScore=0;var n=this.getCurDay();for(i=0;e>i;i++)this._achieveInfo[i]||(this._achieveInfo[i]={times:0,isGot:!1}),s=GlobalConfig.ActivityType11_2Config[this.id][i+1],(!s.day||n>=s.day)&&(this._hiScore+=Math.floor(this._achieveInfo[i].times/s.target)*s.score)},Object.defineProperty(e.prototype,"rewardInfo",{get:function(){return this._rewardInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hiScore",{get:function(){return this._hiScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"achieveInfo",{get:function(){return this._achieveInfo},enumerable:!0,configurable:!0}),e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityConfig[this.id];if(t.pageStyle==ActivityPageStyle.HAPPYSEVENDAY||t.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY||t.pageStyle==ActivityPageStyle.VERSIONCELE){for(var i=Object.keys(GlobalConfig.ActivityType11_2Config[this.id]).length,s=void 0,n=void 0,o=this.getCurDay(),a=1;i>=a;a++)if(s=GlobalConfig.ActivityType11_2Config[this.id][a],n=this.achieveInfo[s.index-1],o>=s.day&&!n.isGot&&n.times>=s.dayLimit)return!0}else if(this.checkPhaseAward())return!0;if(t.pageStyle==ActivityPageStyle.VERSIONCELE){if(e.FIRST_OPEN_SHOP)return!0;if(this.checkPhaseAward())return!0;var r=0;for(var h in Activity.ins().activityData){var l=Activity.ins().activityData[h];if(l&&l.pageStyle==ActivityPageStyle.VERSIONCELE&&l.type==ActivityDataFactory.ACTIVITY_TYPE_22&&Activity.ins().getActivityDataById(+h).isOpenActivity()&&!Activity.ins().getActivityDataById(+h).getHide()){if(r=l.id,l.refreshFree)return!0;break}}}return!1},e.prototype.checkPhaseAward=function(){for(var t=Object.keys(GlobalConfig.ActivityType11_1Config[this.id]).length,e=1;t>=e;e++)if((this._rewardInfo>>e&1)<=0&&this._hiScore>=GlobalConfig.ActivityType11_1Config[this.id][e].score)return!0;return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getCurDay=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t>=0?0:0>=e?0:Math.ceil(Math.abs(t)/86400)},e}(ActivityBaseData);ActivityType11Data.FIRST_OPEN_SHOP=!0,__reflect(ActivityType11Data.prototype,"ActivityType11Data");var ActivityType12Data=function(t){function e(i,s){var n=t.call(this,i)||this;return n.envelopeSum=e.maxEnvelope,n.SecondCount=0,n.init(i,s),n}return __extends(e,t),e.prototype.init=function(t,e){this.score=t.readInt();var i=t.readShort();this.logs=[];for(var s=0;i>s;s++){var n=t.readShort(),o=t.readString(),a=t.readInt();this.logs.push({name:o,serverId:a,index:n})}-1==Activity.ins().activityTimers.indexOf(e)&&Activity.ins().activityTimers.push(e)},e.prototype.update=function(t){var e=t.readUnsignedShort(),i=t.readInt(),s=t.readInt(),n=t.readShort(),o=[],a=SubRoles.ins().getSubRoleByIndex(0);o.push({job:a.job,sex:a.sex,name:Actor.myName,yb:i,gold:s});for(var r=0;n>r;r++){var h=t.readShort(),l=t.readShort(),c=t.readString(),u=t.readInt();Actor.myName!=c&&o.push({job:h,sex:l,name:c,yb:u,gold:0})}Activity.ins().postGetRedEnvelope(this.id,e,i,s,o)},Object.defineProperty(e.prototype,"envelopeData",{get:function(){return this._envelopeData=this._envelopeData?this._envelopeData:[],this._envelopeData},set:function(t){t.sort(this.sortTimer),this._envelopeData=t},enumerable:!0,configurable:!0}),e.prototype.sortTimer=function(t,e){return t.timer<e.timer?-1:1},e.prototype.checkClear=function(){this.envelopeData.length>=this.envelopeSum?(this.SecondCount=0,this.clearEnvelopeData(),this.envelopeSum>e.maxEnvelope&&(this.envelopeSum=this.envelopeData.length+e.maxEnvelope)):this.SecondCount>10&&this.envelopeSum>e.maxEnvelope?(this.SecondCount=0,this.envelopeSum=e.maxEnvelope):this.SecondCount>60&&this.envelopeData.length<e.maxEnvelope&&(this.SecondCount=0,this.clearEnvelopeData()),this.SecondCount++},e.prototype.clearEnvelopeData=function(){for(var t=0;t<this.envelopeData.length;)(!this.envelopeData[t]||this.envelopeData[t].isOverTimer())&&this.envelopeData.splice(t,1),t++},e.prototype.clearAll=function(){this.envelopeData=[],this.envelopeSum=e.maxEnvelope},e.prototype.popEnvelope=function(t){for(var e=0;e<this.envelopeData.length;){if(!this.envelopeData[e]||this.envelopeData[e].id==t){this.envelopeData.splice(e,1);break}e++}},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType12Config[this.id];for(var e in t)if(this.score>=t[e].score)return!0;return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);ActivityType12Data.maxEnvelope=10,__reflect(ActivityType12Data.prototype,"ActivityType12Data");var RedEnvelope=function(){function t(){this.id=0,this.timer=0}return t.prototype.isOverTimer=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.timer)-GameServer.serverTime)/1e3);return 0>=t?!0:!1},t}();__reflect(RedEnvelope.prototype,"RedEnvelope");var EnvelopeData=function(){function t(){this.id=0,this.eId=0,this.job=0,this.sex=0,this.index=0,this.serverId=0,this.name="",this.desc=""}return t}();__reflect(EnvelopeData.prototype,"EnvelopeData");var EnvelopeType;!function(t){t[t.SEND=1]="SEND",t[t.GET=2]="GET"}(EnvelopeType||(EnvelopeType={}));var ActivityType17Data=function(t){function e(e){var i=t.call(this,e)||this;i.noticeArr=[],i.actStar=[],i.awardIndex=0;for(var s=e.readShort(),n=1;s>=n;n++)i.actStar[n]=e.readShort();var o=e.readShort();i.noticeArr=[];for(var n=0;o>n;n++)i.noticeArr.push({name:e.readString(),index:e.readByte()});return i.noticeArr.reverse(),i.score=e.readInt(),i.curRecharge=e.readInt(),i.overDay=e.readInt(),i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.update=function(t){this.awardIndex=t.readShort(),this.recrod=t.readInt()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return Activity.ins().getType17RedPoint(this.id)},e}(ActivityBaseData);__reflect(ActivityType17Data.prototype,"ActivityType17Data");var ActivityType18Data=function(t){function e(e){var i=t.call(this,e)||this;return i.num=0,i.init(e),i}return __extends(e,t),e.prototype.init=function(t){this.num=t.readInt(),this.recrod=t.readInt();var e=t.readShort();this.logs?this.logs.length=0:this.logs=[];for(var i=0;e>i;i++){var s=[t.readString(),t.readInt()];this.logs.push(s)}this.logs=this.logs.reverse(),this.bestlogs?this.bestlogs.length=0:this.bestlogs=[],e=t.readShort();for(var i=0;e>i;i++){var s=[t.readString(),t.readInt()];this.bestlogs.push(s)}},e.prototype.update=function(t){var e=t.readShort();this.num=t.readInt(),this.recrod=t.readInt();for(var i=t.readShort(),s=[],n=0;i>n;n++)s[n]=[t.readInt(),t.readShort()];var o=0;2==e&&(o=1),ViewManager.ins().isShow(HuntResultWin)?Activity.ins().postHuntResult(o,s,3,this.id):(ViewManager.ins().open(HuntResultWin,o,s,2,this.id),Activity.ins().postHuntResult(o,s,3,this.id))},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getLeftTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.getStateByIndex=function(t){var e=this.recrod>>t&1;if(0==e){var i=GlobalConfig.ActivityType18Config[this.id][t];i&&i.dbCount&&i.dbCount<=this.num&&(e=2)}return e},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType18Config[this.id];for(var e in t)if(t[e].dbCount&&this.num>=t[e].dbCount&&0==(this.recrod>>t[e].index&1))return!0;return!1},e}(ActivityBaseData);__reflect(ActivityType18Data.prototype,"ActivityType18Data");var ActivityType19Data=function(t){function e(e){var i=t.call(this,e)||this;return i.awardIndex=0,i._data={},i._list=[],i}return __extends(e,t),e.prototype.CleanRandData=function(){this._data={},this._list=[]},e.prototype.SetRankData=function(t){this._list[t.rank-1]=t,this._data[t.actorId]=t},e.prototype.GetRankData=function(){return this._data},e.prototype.GetRankList=function(){return this._list},e.prototype.update=function(t){},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType19Config[this.id][1];if(t.activityID){var e=Activity.ins().getActivityDataById(t.activityID);if(e&&e.canReward())return!0}return!1},e}(ActivityBaseData);__reflect(ActivityType19Data.prototype,"ActivityType19Data");var DynamicChange=function(){function t(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}return Object.defineProperty(t.prototype,"pUpdate",{get:function(){return this._pUpdate},enumerable:!0,configurable:!0}),t.prototype.getCacheData=function(t){return this._dataCache[t]?this._dataCache[t]:null},t.prototype.clearCache=function(){for(var t=Object.keys(this._dataCache),e=0,i=t.length;i>e;e++){var s=t[e];this._dataCache[s]=null,delete this._dataCache[s]}},t.prototype.getCacheKeyInfos=function(){for(var t=[],e=Object.keys(this._dataCache),i=0,s=e.length;s>i;i++){var n=e[i],o=this._dataCache[n];t.push(o)}return t},t.prototype.isCache=function(t){return this._dataCache[t]},t}();__reflect(DynamicChange.prototype,"DynamicChange");var ActivityType20Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.index=t.readInt()||1,this.timer=t.readInt(),this.timer&&(this.timer=Math.floor(DateUtils.formatMiniDateTime(this.timer)/DateUtils.MS_PER_SECOND)),this.isGoIn=t.readByte()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){if(this.IsEnd())return!1;var t=this.getStartTimer(),e=this.getEndTimer(),i=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);return t>i||i>=e?!1:!0},e.prototype.IsEnd=function(){var t=this.getEndTimer(),e=new Date(t*DateUtils.MS_PER_SECOND),i=new Date(GameServer.serverTime);return i.getDate()!=e.getDate()?!0:!1},e.prototype.go2BossFb=function(){return this.isGoIn},e.prototype.getReadyTimer=function(){var t=GlobalConfig.ActivityType20Config[this.id][this.index];return this.timer-t.duration-t.enterTime},e.prototype.getStartTimer=function(){var t=GlobalConfig.ActivityType20Config[this.id][this.index];return this.timer-t.duration},e.prototype.getEndTimer=function(){return this.timer},e.prototype.getResidueTimer=function(){if(this.IsEnd())return 0;var t=this.getStartTimer(),e=this.getEndTimer(),i=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);return i>=t&&e>i?e-i:e-i},e.prototype.getResidueStartTimer=function(){if(this.IsEnd())return 0;var t=this.getStartTimer(),e=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);return e>=t?0:t-e},e.prototype.getDateTime=function(t){var e=t.split(/[-,.,:]/g),i=new Date(+e[0],+e[1]-1,+e[2],+e[3]||0,+e[4]||0);return i},e}(ActivityBaseData);__reflect(ActivityType20Data.prototype,"ActivityType20Data");var LBBossRankData=function(){function t(){this.rank=0,this.name="",this.damage=0}return t}();__reflect(LBBossRankData.prototype,"LBBossRankData");var ActivityType21Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.update=function(t){},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){return!1},e}(ActivityBaseData);__reflect(ActivityType21Data.prototype,"ActivityType21Data");var ActivityType22Data=function(t){function e(e){var i=t.call(this,e)||this;return i._refreshTime=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.tScore=t.readInt(),this.refreshFree=1==t.readByte(),this._refreshTime=t.readInt(),this._oldTimer=egret.getTimer();var e=t.readShort();this.shopItems=[],this.shopItems.length=e;for(var i=0;e>i;i++)this.shopItems[i]=new SpringBeginShopVo,this.shopItems[i].parser(t);e=t.readShort(),this.scoreItems=[],this.scoreItems.length=e;for(var i=0;e>i;i++)this.scoreItems[i]=new SpringBeginShopVo,this.scoreItems[i].parser2(t);this.limitItems=[],e=t.readShort();for(var s,i=0;e>i;i++)s=new SpringBeginShopVo,s.parser3(t),this.limitItems.push(s)},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){if(this.refreshFree)return!0;var t=Activity.ins().getConfig22_3(this.id);if(t&&this.tScore>=t.score)return!0;var e=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.id][1].freshItem);return e&&e.count>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getRefreshTime=function(){return this._refreshTime-(egret.getTimer()-this._oldTimer)/1e3},e}(ActivityBaseData);__reflect(ActivityType22Data.prototype,"ActivityType22Data");var ActivityType2Data=function(t){function e(e){var i=t.call(this,e)||this;return i.buyData=[],i.serverBuyData=[],i.areaBuyData=[],i.areabuyReward=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var i=e.readShort(),s=e.readInt();this.buyData[i]=s,this.serverBuyData[i]=e.readInt(),this.areaBuyData[i]=e.readInt(),this.areabuyReward[i]=e.readInt();for(var n=0;s>=n;n++)this.areaBuyData[n]=Math.max(this.areaBuyData[n],this.buyData[n])},e.prototype.initBuyData=function(t){for(var e=t.readShort(),i=1;e>=i;i++)this.buyData[i]=t.readShort(),this.serverBuyData[i]=t.readShort(),this.areaBuyData[i]=t.readInt(),this.areabuyReward[i]=t.readInt();for(var s=0;e>=s;s++)this.areaBuyData[s]=Math.max(this.areaBuyData[s],this.buyData[s]);this.sumRMB=t.readInt()},e.prototype.canReward=function(){if(Actor.level<e.LimitLevel)return!1;var t;t=-1!=Activity.ins().doubleElevenIDs.indexOf(this.id)?Activity.ins().getDoubleElevenDataByID(this.id):Activity.ins().getActivityDataById(this.id);var i=GlobalConfig.ActivityType2Config[this.id],s=!1;for(var n in i){var o=i[n],a=t.buyData[o.index]>=o.count?!0:!1;if(s=this.serverBuyData[o.index]>=o.scount?!0:!1,!a&&t.sumRMB>=o.needRecharge&&Actor.yb>=o.price&&UserVip.ins().lv>=o.vip&&!s)return!0;if(a&&o.countReward)for(var r in o.countReward)if(this.getAreaReward(o.index,Number(r)+1))return!0}return!1},e.prototype.isSpecialOpen=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),i=GlobalConfig.ActivityType2Config[this.id][1],s=Number(i.limitTime[0]),n=Number(i.limitTime[1]);return 0>t+3600*s+60*n&&e>0?!0:!1},e.prototype.getSpecialStrikeTimes=function(){var t=GlobalConfig.ActivityType2Config[this.id][1],e=Number(t.limitTime[0]),i=Number(t.limitTime[1]),s=(GameServer.serverTime-DateUtils.formatMiniDateTime(this.startTime)-36e5*e-6e4*i)/1e3/240;return s>0?s:0},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;for(var t=GlobalConfig.ActivityType2Config[this.id],e=1;e<this.buyData.length;e++){var i=t[e];if(this.buyData[e]<i.count)return this.isHide=!1,this.isHide}return this.isHide=!0,this.isHide},e.prototype.getLeftTime=function(){if(this.endTime){var t=DateUtils.formatMiniDateTime(this.endTime)/1e3,e=Math.floor((t-GameServer.serverTime)/1e3);return 0>e&&(e=0),e}var i=GlobalConfig.ActivityConfig[this.id],s=0,n=0;if(0==i.timeType){var o=+i.startTime.split("-")[0];n=+i.endTime.split("-")[0]-o,s=GameServer.serverOpenDay-o}else if(1==i.timeType){var o=GameServer.serverTime,a=new Date(i.startTime).getTime(),r=new Date(i.endTime).getTime();s=Math.floor((o-a)/1e3/3600/24),n=Math.round((r-a)/1e3/3600/24)}else if(2==i.timeType){var o=+i.startTime.split("-")[0];n=+i.endTime.split("-")[0]-o;var h=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);s=h-o}var l=new Date(GameServer.serverTime),c=n-s;
if(0>=c)return 0;var u=new Date(GameServer.serverTime);return u.setDate(l.getDate()+c),u.setHours(0,0,0,0),Math.floor((u.getTime()-GameServer.serverTime)/1e3)},e.prototype.getSpecialOpenLeftTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),i=GlobalConfig.ActivityType2Config[this.id][1],s=Number(i.limitTime[0]),n=Number(i.limitTime[1]);return t+=3600*s+60*n,0>t&&e>0?t:0},e.prototype.getAreaReward=function(t,e){var i=GlobalConfig.ActivityType2Config[this.id][t];if(this.buyData[t]&&this.buyData[t]>=i.count){if((this.areabuyReward[t]>>e&1)>0)return Activity.Geted;if(this.areaBuyData[t]>=i.countReward[e-1].count)return Activity.CanGet}return Activity.NotReached},e}(ActivityBaseData);ActivityType2Data.LimitLevel=50,__reflect(ActivityType2Data.prototype,"ActivityType2Data");var ActivityType3Data=function(t){function e(e){var i=t.call(this,e)||this;return i.dabiao=[],i.chongzhiNum=0,i.chongzhiTotal=0,i.btn1=!1,i.btn2=!1,i.image1=!1,i.image2=!1,i.updateData(e),i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.recrod=e.readInt()},e.prototype.openDay=function(){var t=GlobalConfig.ActivityType3Config[this.id];return t&&t[0]?t[0].day:7},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType3Config[this.id],e=this.recrod,i=-1,s=0;for(var n in t){var o=e>>t[n].index&1;if(1==t[n].type){if(this.dabiao[s]>=t[n].day&&0==o)return!0}else if(2==t[n].type&&t[n].val<=this.chongzhiTotal){if(0==o)return!0}else if(3==t[n].type&&t[n].val<=this.chongzhiNum&&(-1==i&&(i=this.getCurIndex(3)),i==t[n].index&&0==o))return!0;s++}return this.canRewardEx()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.updateData=function(t){var e=t.readShort();this.dabiao=[];for(var i=0;e>i;i++)this.dabiao.push(t.readShort());this.chongzhiNum=t.readInt(),this.chongzhiTotal=t.readInt()},Object.defineProperty(e.prototype,"day7text",{get:function(){var t=GlobalConfig.ActivityType3Config[this.id];for(var e in t)1==t[e].type&&(this.rewards1=t[e].rewards,this._day7text="累计"+("<font color='#ffff00'>"+t[e].day+"</font>")+"天，每日充值"+("<font color='#ffff00'>"+t[e].val+"</font>")+"元宝可领取");return this._day7text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totaltext",{get:function(){var t=GlobalConfig.ActivityType3Config[this.id];for(var e in t)2==t[e].type&&(this.maxTotal=t[e].val,this.rewards2=t[e].rewards,this._totaltext="活动期间累计充值"+("<font color='#ffff00'>"+t[e].val+"</font>")+"元宝可领取");return this._totaltext},enumerable:!0,configurable:!0}),e.prototype.canOnlyReward=function(){var t=GlobalConfig.ActivityType3Config[this.id],e=this.recrod;this.btn1=!1,this.btn2=!1,this.image1=!1,this.image2=!1;for(var i in t){var s=e>>t[i].index&1;1==t[i].type&&this.dabiao&&this.dabiao[0]>=t[i].day&&(0==s&&(this.btn1=!0),1==s&&(this.image1=!0)),2==t[i].type&&t[i].val<=this.chongzhiTotal&&(0==s&&(this.btn2=!0),1==s&&(this.image2=!0))}},e.prototype.getDateTime=function(t){var e=t.split(/[-,.,:]/g),i=new Date(+e[0],+e[1]-1,+e[2],+e[3]||0,+e[4]||0);return i.getTime()},e.prototype.isOverTimer=function(t){var e=this.curOpenDay(),i=GlobalConfig.ActivityType3Config[this.id][t],s=this.recrod>>i.index&1;return e+1>i.day&&s!=Activity.Geted?!0:!1},e.prototype.curOpenDay=function(){var t=GlobalConfig.ActivityConfig[this.id],e=0;if(0==t.timeType){var i=+t.startTime.split("-")[0];e=GameServer.serverOpenDay-i}else if(1==t.timeType){var i=GameServer.serverTime,s=this.getDateTime(t.startTime);this.getDateTime(t.endTime);e=Math.floor((i-s)/1e3/3600/24)}else if(2==t.timeType){var i=+t.startTime.split("-")[0],s=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);e=s-i}return e},e.prototype.getCurIndex=function(t){var e=(GlobalConfig.ActivityConfig[this.id],GlobalConfig.ActivityType3Config[this.id]),i=this.curOpenDay(),s={};for(var n in e)s[e[n].type]=1;var o=Object.keys(s);(1==o.length||void 0==t)&&(t=+o[0]);var a,r=[];for(a in e)e[a].type==t&&r.push(e[a]);r.sort(function(t,e){return t.day<e.day?-1:1});for(var h=0,l=r;h<l.length;h++){var c=l[h];if(a=c.index,1==t||2==t){if(i<c.day)return+a}else if(3==t&&i<c.day)return+a}return+a},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRewardStateById=function(t){var e=GlobalConfig.ActivityType3Config[this.id][t];switch(e.showType){case Show3Type.TYPE6:case Show3Type.TYPE8:case Show3Type.TYPE9:if(this.chongzhiTotal<e.val)return Activity.NotReached;break;case Show3Type.TYPE7:if(this.dabiao[t-1]<e.day)return Activity.NotReached}var i=this.recrod>>e.index&1;return i?Activity.Geted:Activity.CanGet},e.prototype.canRewardEx=function(){var t=GlobalConfig.ActivityType3Config[this.id];if(t&&t[1]&&t[1].activityID)for(var e=0;e<t[1].activityID.length;e++){var i=Activity.ins().getActivityDataById(t[1].activityID[e]);if(i&&i.canReward())return!0}return!1},e}(ActivityBaseData);__reflect(ActivityType3Data.prototype,"ActivityType3Data");var Show3Type;!function(t){t[t.TYPE1=1]="TYPE1",t[t.TYPE2=2]="TYPE2",t[t.TYPE3=3]="TYPE3",t[t.TYPE4=4]="TYPE4",t[t.TYPE5=5]="TYPE5",t[t.TYPE6=6]="TYPE6",t[t.TYPE7=7]="TYPE7",t[t.TYPE8=8]="TYPE8",t[t.TYPE9=9]="TYPE9",t[t.TYPE10=10]="TYPE10"}(Show3Type||(Show3Type={}));var ActivityType4Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.updateData=function(t){},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getCostRank=function(t,e){if(!t)return 0;for(var i=0,s=t.numType,n=GlobalConfig.ActivityType4Config[this.id];n[e.idx];){if(s>=n[e.idx].value){i=n[e.idx].ranking,e.idx++,t.rankIndex==Activity.ins().myPaiming&&(this.myPaiming=i);break}e.idx++}return i},e}(ActivityBaseData);__reflect(ActivityType4Data.prototype,"ActivityType4Data");var ActivityType5Data=function(t){function e(e){var i=this;if(e)return i=t.call(this,e)||this,i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.updateRecord=function(t){this.recrod=t.readInt()},e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.recrod=e.readInt()},e.prototype.updateData=function(t){this.logTime=t.readInt()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.canReward=function(t){void 0===t&&(t=0),0==t&&(t=this.logTime);var e=GlobalConfig.ActivityType5Config[this.id];for(var i in e){var s=this.recrod>>e[i].index&1;if(0==s&&e[i].day<=this.logTime)return!0}return!1},e.prototype.checkOneDayStatu=function(t){void 0===t&&(t=0),0==t&&(t=this.logTime);var e=(GlobalConfig.ActivityType5Config[this.id],this.recrod>>t&1);return 0==e?!0:!1},e.prototype.getCurDay=function(){var t=this.logTime;return 157==this.id?t=Activity.ins().hfLoginDay:210==this.id&&(t=Activity.ins().geLoginDay),t},e}(ActivityBaseData);__reflect(ActivityType5Data.prototype,"ActivityType5Data");var ActivityType6Data=function(t){function e(e){var i=t.call(this,e)||this;return i.rewardsBossSum=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.record=e.readInt()},e.prototype.initBuyData=function(t){this.record=t.readInt();for(var e=t.readShort(),i=1;e>=i;i++)this.rewardsBossSum[i]=t.readShort()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.getBossGroup=function(t,e){for(var i=this.getBossGroupIndex(t,e),s=0;s<i.length;s++)if(!i[s])return Activity.NOKILL;return Activity.KILL},e.prototype.getBossGroupIndex=function(t,e){for(var i=[],s=t<<1,n=1;3>=n;n++){var o=Math.floor(s/Math.pow(2,n))%2;i.push(o)}return i},e.prototype.getBossGroupGiftIndex=function(t){var e=Math.floor(this.record/Math.pow(2,t.index))%2;return e?Activity.Geted:Activity.CanGet},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType6Config[this.id],e=1;for(var i in t){var s=this.getBossGroupGiftIndex(t[i]),n=this.getBossGroup(this.rewardsBossSum[e],t[i]);if(n==Activity.KILL&&s==Activity.CanGet)return!0;e++}return!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;var t=this.record>>1,e=GlobalConfig.ActivityType6Config[this.id],i=Object.keys(e);return t>=Math.pow(2,i.length)-1?(this.isHide=!0,this.isHide):(this.isHide=!1,this.isHide)},e}(ActivityBaseData);__reflect(ActivityType6Data.prototype,"ActivityType6Data");var ActivityType7Data=function(t){function e(e){var i=t.call(this,e)||this;return i.personalRewardsSum=[],i.worldRewardsSum=[],i.exchange=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var i=e.readShort(),s=e.readShort();this.personalRewardsSum[i]=s,this.worldRewardsSum[i]=e.readShort(),this.exchange[i]=e.readShort()},e.prototype.initBuyData=function(t){for(var e=t.readShort(),i=1;e>=i;i++)this.personalRewardsSum[i]=t.readShort(),this.worldRewardsSum[i]=t.readShort(),this.exchange[i]=t.readShort();this.bossScore=t.readInt()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return Activity.ins().getType7RedPoint(this.id)},e.prototype.getAwardState=function(t){var e=GlobalConfig.ActivityType7Config[this.id][t],i=this.personalRewardsSum[e.index]>=e.count;return i?Activity.Geted:this.bossScore>=e.score?Activity.CanGet:Activity.NotReached},e.prototype.getExchange=function(t){var e=Activity.ins().getActivityDataById(this.id),i=GlobalConfig.ActivityType7Config[this.id][t];if(!i.items)return Activity.NotReached;var s=Activity.CanGet,n=e.worldRewardsSum[t],o=e.exchange[t],a=e.personalRewardsSum[t];for(var r in i.items){var h=UserBag.ins().getBagItemById(i.items[r].id),l=h?h.count:0;if(l<i.items[r].count){s=Activity.NotReached;break}}return s!=Activity.NotReached&&(i.scount&&n>=i.scount&&(s=Activity.Geted),i.count&&a>=i.count&&(s=Activity.Geted),i.dailyCount&&o>=i.dailyCount&&(s=Activity.Geted)),s},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e}(ActivityBaseData);ActivityType7Data.TYPE_RING=1,ActivityType7Data.TYPE_HEFUBOSS=2,ActivityType7Data.TYPE_CELEBREATE=5,ActivityType7Data.TYPE_LABA=6,__reflect(ActivityType7Data.prototype,"ActivityType7Data");var ActivityType8Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.record=t.readInt()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return Activity.ins().getType8RedPoint(this.id)},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);ActivityType8Data.TYPE_RING=1,__reflect(ActivityType8Data.prototype,"ActivityType8Data");var ProxyUpdate=function(){function t(t){this._cache=t}return t.prototype.isArray=function(t){return t instanceof Array},t.prototype.isObject=function(t){return t.indexOf("object")>-1},t.prototype.isNormal=function(t){var e=t.indexOf("@")>-1,i=t.indexOf(".")>-1,s=t.indexOf("_")>-1;return!e&&!i&&!s},t.prototype.isAddToArray=function(t){return"@a"==t},t.prototype.isRemoveToArray=function(t){var e=t.split("_");return e.length<=3&&"@d"==e[0]},t.prototype.isFilter=function(t){var e=t.split("_");return"@f"==e[0]},t.prototype.isNumeric=function(t){return parseFloat(t).toString()==t.toString()},t.prototype._updateObject=function(t,e,i){var s=t.split(".");"@a"==s[0]||"@s"==s[0]?i[s[1]]=e:"@d"==s[0]&&delete i[s[1]]},t.prototype._getFilterObject=function(t,e){if(e){var i=t.split("_");if(3==i.length&&"@f"==i[0]&&this.isArray(e))for(var s=i[1],n=i[2],o=0;o<e.length;o++){var a=e[o];if(3==i.length&&this.isObject(a.toString())){var r=a[s];if(r&&("@"==n[0]&&(n=n.replace("@","")),n==r))return a}}}return null},t.prototype._addObjectToArray=function(t,e){if(this.isArray(e))for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e)},t.prototype._removeObjectFromArray=function(t,e,i){var s=e.split("_");if(s.length<=3&&"@d"==s[0]&&this.isArray(t))for(var n=t.length,o=n-1;o>=0;o--){var a=t[o];if(3==s.length){if(a.hasOwnProperty(s[1])){var r=s[2];"@"==r[0]&&(r=r.replace("@","")),r==a[s[1]]&&t.splice(o,1)}}else 2==s.length&&a.hasOwnProperty(s[1])?i==a[s[1]]&&t.splice(o,1):1==s.length&&i==a&&t.splice(o,1)}},t.prototype.update=function(t,e){if(this._cache[t]=e,e.hasOwnProperty("c"))for(var i=e.c,s=Object.keys(i),n=0,o=s.length;o>n;n++){var a=s[n];this._cache[a]&&(this._update(this._cache[a],i[a]),MessageCenter.ins().dispatch(a+"_HttpUpdate"))}},t.prototype._update=function(t,e){if(t&&e&&this.isObject(e.toString()))for(var i=Object.keys(e),s=0,n=i.length;n>s;s++){var o=i[s],a=e[o];if(this.isNormal(o)&&this.isObject(a.toString()))t.hasOwnProperty(o)&&this._update(t[o],a);else if(this.isNormal(o)&&this.isNumeric(a)){var r=t[o];t[o]=r+a}else if(this.isNormal(o))t[o]=a;else if(this.isAddToArray(o))this._addObjectToArray(t,a);else if(this.isRemoveToArray(o))this._removeObjectFromArray(t,o,a);else if(this.isFilter(o)){var h=this._getFilterObject(o,t);h&&this._update(h,a)}else this._updateObject(o,a,t)}},t}();__reflect(ProxyUpdate.prototype,"ProxyUpdate");var RewardData=function(){function t(){}return t.prototype.parser=function(t){this.type=t.readInt(),this.id=t.readInt(),this.count=t.readInt()},t.getCurrencyName=function(e){return t.CURRENCY_NAME[e]},t.getCurrencyRes=function(e){return t.CURRENCY_RES[e]},t}();RewardData.CURRENCY_NAME={0:"经验",1:"金币",2:"元宝",3:"声望",4:"精炼石",5:"公会贡献",6:"公会资金",7:"功勋",8:"成就",9:"战纹精华",10:"战纹碎片",11:"低级符文碎片",12:"高级符文碎片",13:"神兵经验",14:"威望",15:"筹码",16:"兽神精魄",99:"元宝"},RewardData.CURRENCY_RES={1:"ZSgold",2:"ZScoin",3:"ZSshengwang",4:"ZSlingpo",0:"result_json.ZSexp",5:"ZSguildgx",6:"ZSguildfund",8:"ZSchengjiu",99:"ZScoin",7:"ZShonor",9:"500007_png",10:"500008_png",11:"hejisuipian",12:"hejisuipian1",13:"ZSexp",14:"ZSprestige",15:"ZSchip",16:"SSExp"},__reflect(RewardData.prototype,"RewardData");var RewardDataCurrency;!function(t){t[t.Exp=0]="Exp",t[t.Glod=1]="Glod",t[t.Yb=2]="Yb",t[t.Shengwang=3]="Shengwang",t[t.Lingpo=4]="Lingpo",t[t.GuildContribute=5]="GuildContribute",t[t.GuildGold=6]="GuildGold",t[t.Feats=7]="Feats",t[t.Recharge=99]="Recharge"}(RewardDataCurrency||(RewardDataCurrency={}));var SpringBeginShopVo=function(){function t(){this.discount=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.itemID=t.readInt(),this.itemCount=t.readShort(),this.price=t.readInt(),this.discount=t.readByte(),this.state=t.readByte(),this.buyCount=t.readByte(),this.buyMax=t.readByte(),this.materialNum=t.readShort()},t.prototype.parser2=function(t){this.id=t.readInt(),this.itemID=t.readInt(),this.itemCount=t.readShort(),this.score=t.readInt()},t.prototype.parser3=function(t){this.itemID=t.readInt(),this.buyCount=t.readByte(),this.buyMax=t.readByte()},t}();__reflect(SpringBeginShopVo.prototype,"SpringBeginShopVo");var ThreeHeroes=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.ThreeHeroes,e.regNetMsg(1,e.doGotAward),e.regNetMsg(2,e.doAwardInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.doGotAward=function(t){t.readByte()>0&&(this.awardState=e.Geted,this.postInfoChange())},e.prototype.doAwardInfo=function(t){var i=t.readBoolean();this.loginDays=t.readShort(),this.showIcon3DaysLater=t.readBoolean(),ActivityDataFactory.createEx();var s=Activity.ins().activityData[ActivityBtnType.THREE_HEROES];if(s){var n=Math.floor((s.startTime-GameServer.serverTime)/1e3),o=Math.floor((s.endTime-GameServer.serverTime)/1e3);0>n&&o>0?(UserVip.ins().lv>=GlobalConfig.LoginActivateConfig.vipLevel?this.awardState=e.Active:this.awardState=e.NotActive,MessageCenter.addListener(UserVip.ins().postUpdateVipData,this.updateStateByVip,this),MessageCenter.addListener(UserVip.ins().postUpdataExp,this.updateStateByVip,this)):(this.showIcon3DaysLater?this.loginDays>=GlobalConfig.LoginActivateConfig.loginDays?this.awardState=e.CanGet:this.awardState=e.Active:this.awardState=i?e.Geted:e.NotActive,MessageCenter.ins().removeAll(this))}Activity.ins().postActivityIsGetAwards(),this.postInfoChange()},e.prototype.updateStateByVip=function(){var t=Activity.ins().activityData[ActivityBtnType.THREE_HEROES];if(t){var i=Math.floor((t.startTime-GameServer.serverTime)/1e3),s=Math.floor((t.endTime-GameServer.serverTime)/1e3);0>i&&s>0&&(UserVip.ins().lv>=GlobalConfig.LoginActivateConfig.vipLevel?this.awardState=e.Active:this.awardState=e.NotActive)}this.postInfoChange()},e.prototype.sendReward=function(){var t=this.getBytes(1);this.sendToServer(t)},e.prototype.postInfoChange=function(){},e}(BaseSystem);ThreeHeroes.NotActive=0,ThreeHeroes.Active=1,ThreeHeroes.CanGet=2,ThreeHeroes.Geted=3,__reflect(ThreeHeroes.prototype,"ThreeHeroes");var GameSystem;!function(t){t.threeHeros=ThreeHeroes.ins.bind(ThreeHeroes)}(GameSystem||(GameSystem={}));var ActivityBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t,e;this.data instanceof ActivityBtnConfig?(t=this.data,e=Activity.ins()):this.data instanceof PActivityBtnConfig&&(t=this.data,e=PActivity.ins()),null!=t?(this.iconDisplay.source=t.icon,this.redPoint.visible=e.isShowRedPointByBtnInfo(t),t.light&&!e.getPalyEffListById(t.id)?(this.mc||(this.mc=new MovieClip,this.mc.x=40,this.mc.y=43),this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1),this.addChild(this.mc)):DisplayUtils.removeFromParent(this.mc)):this.iconDisplay.source=""},e}(FuliActBtnRenderer);__reflect(ActivityBtnRenderer.prototype,"ActivityBtnRenderer");var Http=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.send=function(t,e,i,s,n,o){var a=new egret.HttpRequest;a.responseType=e?egret.HttpResponseType.TEXT:egret.HttpResponseType.ARRAY_BUFFER,a.open(t,i?egret.HttpMethod.GET:egret.HttpMethod.POST),a.once(egret.Event.COMPLETE,s,this),a.once(egret.IOErrorEvent.IO_ERROR,n?n:function(){},this),a.once(egret.ProgressEvent.PROGRESS,o?o:function(){},this),a.send()},e}(BaseClass);__reflect(Http.prototype,"Http");var ActivityType1ItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActLevelSonSkin",e.list.itemRenderer=ItemBase,e.rewardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.reward,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=Activity.ins().getActivityDataById(t.Id);t.zslevel>0?this.level.source="level_"+(8+t.zslevel):this.level.source="level_"+t.level/10,this.currentState=e.getRewardStateById(t.index-1)+"",this.list.dataProvider=new eui.ArrayCollection(t.rewards)},e.prototype.reward=function(t){var e=this.data;UserBag.ins().getSurplusCount()<1&&13==this.data.index?UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|"):Activity.ins().sendReward(e.Id,e.index)},e}(BaseItemRender);__reflect(ActivityType1ItemRenderer.prototype,"ActivityType1ItemRenderer");var ActivityType1Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActLevelSkin",e.list.itemRenderer=ActivityType1ItemRenderer,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData()},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.date.text="活动未开启":0>=i?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3),this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var s=GlobalConfig.ActivityType1Config[t.id].slice();s.sort(this.sortFunc),this.listData.replaceAll(s)},e.prototype.sortFunc=function(t,e){var i=Activity.ins().getActivityDataById(t.Id),s=i.getRewardStateById(t.index-1),n=i.getRewardStateById(e.index-1);return n>s?-1:s>n?1:t.zslevel<e.zslevel?-1:t.zslevel>e.zslevel?1:t.level<e.level?-1:t.level>e.level?1:0},e}(ActivityPanel);__reflect(ActivityType1Panel.prototype,"ActivityType1Panel");var ActivityType2Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityConfig[this.activityID];switch(i.openType){case 1:this.type2PanelList[this.activityID+""]||(this.type2PanelList[this.activityID+""]=new Activity2Panel2,this.type2PanelList[this.activityID+""].activityID=this.activityID);break;case 2:this.type2PanelList[this.activityID+""]||(this.type2PanelList[this.activityID+""]=new Activity2Panel1,this.type2PanelList[this.activityID+""].activityID=this.activityID)}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(ActivityType2Panel.prototype,"ActivityType2Panel");var ActivityType3Panel=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="MoneyActSkin",this.list.itemRenderer=ItemBase,this.list1.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.suerBtn,this.reward),this.addTouchEvent(this.suerBtn0,this.reward),Activity.ins().sendLianxuReward(this.activityID),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.reward),this.removeTouchEvent(this.suerBtn0,this.reward)},e.prototype.updateData=function(){this.sureImg.visible=!1,this.sureImg0.visible=!1,this.activityData=Activity.ins().getActivityDataById(this.activityID);var t=Math.floor((DateUtils.formatMiniDateTime(this.activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.date.text="活动未开启":0>=e?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3),this.label.textFlow=(new egret.HtmlTextParser).parser(this.activityData.day7text),this.label1.textFlow=(new egret.HtmlTextParser).parser(this.activityData.totaltext),this.activityData.chongzhiTotal>this.activityData.maxTotal&&(this.activityData.chongzhiTotal=this.activityData.maxTotal),this.label2.text="已达成"+(this.activityData.dabiao?this.activityData.dabiao[0]:0)+"/"+this.activityData.openDay()+"天",this.label3.text="已充值"+this.activityData.chongzhiTotal+"/"+this.activityData.maxTotal+"元宝",this.list.dataProvider=new eui.ArrayCollection(this.activityData.rewards1),this.list1.dataProvider=new eui.ArrayCollection(this.activityData.rewards2),this.activityData.canOnlyReward(),this.activityData.btn1?(this.mc1=this.mc1||new MovieClip,this.mc1.x=50,this.mc1.y=19,this.mc1.playFile(RES_DIR_EFF+"normalbtn",-1),this.suerBtn.addChild(this.mc1)):this.mc1&&DisplayUtils.removeFromParent(this.mc1),this.activityData.btn2?(this.mc2=this.mc2||new MovieClip,this.mc2.x=50,this.mc2.y=19,this.mc2.playFile(RES_DIR_EFF+"normalbtn",-1),this.suerBtn0.addChild(this.mc2)):this.mc2&&DisplayUtils.removeFromParent(this.mc2),this.sureImg0.visible=this.activityData.image1,this.sureImg.visible=this.activityData.image2,this.suerBtn.visible=!this.activityData.image1,this.suerBtn0.visible=!this.activityData.image2},e.prototype.reward=function(t){switch(t.currentTarget){case this.suerBtn:this.activityData.btn1?UserBag.ins().getSurplusCount()>=1?Activity.ins().sendReward(this.activityData.id,1):UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|"):UserTips.ins().showTips("|C:0xf3311e&T:未达到活动天数！|");break;case this.suerBtn0:this.activityData.btn2?UserBag.ins().getSurplusCount()>=1?Activity.ins().sendReward(this.activityData.id,2):UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|"):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")}},e}(ActivityPanel);__reflect(ActivityType3Panel.prototype,"ActivityType3Panel");var ActivityType4ItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActraceSkinson",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.data.ranking>0?this.rankImg.source="rankDabiao_"+this.data.ranking:this.rankImg.source="rankDabiao_"+this.data.rankType+"_"+this.data.ranking,this.list.dataProvider=new eui.ArrayCollection(t.rewards);var e=Activity.ins().getrankInfoListByIndex(this.itemIndex);if(e){this.y=21,this.rankName.text=e.name,this.value.visible=!0;var i=void 0;switch(this.data.rankType){case RankDataType.TYPE_LEVEL:i=e.zsLevel>0?e.zsLevel+"转"+e.level+"级":e.level+"级";break;case RankDataType.TYPE_POWER:case RankDataType.TYPE_WING:case RankDataType.TYPE_JOB_ZS:case RankDataType.TYPE_JOB_FS:case RankDataType.TYPE_JOB_DS:i=CommonUtils.overLength(e.numType);break;case RankDataType.TYPE_BAOSHI:i=e.numType+"级"}this.value.text=i}else this.y=33,this.rankName.text="暂无",this.value.visible=!1},e}(BaseItemRender);__reflect(ActivityType4ItemRenderer.prototype,"ActivityType4ItemRenderer");var ActivityType4Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActRaceSkin",e.list.itemRenderer=ActivityType4ItemRenderer,e.list1.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData(),this.addTouchEvent(this.getReward,this.onClick),this.btn_showRank&&this.addTouchEvent(this.btn_showRank,this.onClick),this.btn_showRank0&&this.addTouchEvent(this.btn_showRank0,this.onClick),this.group_Rank&&(this.group_Rank.visible=!1),this.btn_showRank&&this.group_Rank&&(this.btn_showRank.label=this.group_Rank.visible?"查看奖励":"查看排行")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];debug.log("close"),this.removeTouchEvent(this.getReward,this.onClick),this.btn_showRank&&this.removeTouchEvent(this.btn_showRank,this.onClick),this.btn_showRank0&&this.removeTouchEvent(this.btn_showRank0,this.onClick),this.removeObserve()},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);if(e>=0)this.date.text="活动未开启";else if(0>=i)this.date.text="活动已结束";else{var s=Math.floor(i/86400),n=Math.floor(i%86400/3600),o=Math.floor(i%3600/60);this.date.text=s+"天"+n+"小时"+o+"分"}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var a=this.getDataList(t.id);this.listData.replaceAll(a);var r=this.getCurRewards();this.list1.dataProvider=new eui.ArrayCollection(r),this.refushBtnStatu();for(var h=0;4>h;h++){var l=a[h],c=Activity.ins().getrankInfoListByIndex[h],u=h+1,p=this["list_item"+u],d=this["label_nname"+u],g=this["label_value"+u],f="暂无",v="";if(c)switch(f=c.name,l.rankType){case RankDataType.TYPE_LEVEL:v=c.zsLevel>0?c.zsLevel+"转"+c.level+"级":c.level+"级";break;case RankDataType.TYPE_POWER:v=CommonUtils.overLength(c.numType);break;case RankDataType.TYPE_WING:v=CommonUtils.overLength(c.numType);break;case RankDataType.TYPE_JOB_ZS:v=CommonUtils.overLength(c.numType);break;case RankDataType.TYPE_JOB_FS:v=CommonUtils.overLength(c.numType);break;case RankDataType.TYPE_JOB_DS:v=CommonUtils.overLength(c.numType);break;case RankDataType.TYPE_BAOSHI:v=c.numType+"级";break;case RankDataType.TYPE_ZHANLING:v=c.numType[0]+"阶"+c.numType[1]+"星";break;case RankDataType.TYPE_LONGHUN:v=c.numType+"级";break;case RankDataType.TYPE_XIAOFEI:v=c.numType+"元宝"}p&&(p.itemRenderer=ItemBase,p.dataProvider=new eui.ArrayCollection(l.rewards)),d&&(d.text=f),g&&(g.text=v)}},e.prototype.refushBtnStatu=function(){for(var t in Activity.ins().activityData){var e=Activity.ins().activityData[t];e&&4==e.type&&e.isOpenActivity()&&Activity.ins().sendDabiaoInfo(e.id)}var i=(Activity.ins(),this.getCurStatus()),s=this.getCurValue();switch(i){case 0:this.dabiaoImg.visible=!1,this.getReward.visible=!1,this.rankName.visible=!0,this.rankDesc.visible=!0,this.rankName.text=Actor.myName;break;case 1:this.rankName.visible=!1,this.rankDesc.visible=!1,this.dabiaoImg.visible=!1,this.getReward.visible=!0;break;case 2:this.rankName.visible=!1,this.rankDesc.visible=!1,this.dabiaoImg.visible=!0,this.getReward.visible=!1;break;default:debug.log("达标活动领奖状态不存在:"+i)}switch(this.dabiao.rankType){case RankDataType.TYPE_LEVEL:UserZs.ins().lv>0?this.rankDesc.text=UserZs.ins().lv+"转"+Actor.level+"级":this.rankDesc.text=Actor.level+"级";var n=Math.floor(s/1e3),o=s%1e3;this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到等级\n"+(n?n+"转":"")+(o+"级"));break;case RankDataType.TYPE_POWER:case RankDataType.TYPE_WING:case RankDataType.TYPE_JOB_ZS:case RankDataType.TYPE_JOB_FS:case RankDataType.TYPE_JOB_DS:this.rankDesc.text=CommonUtils.overLength(Activity.ins().myDabiaoInfo),this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到战力\n"+s);break;case RankDataType.TYPE_BAOSHI:this.rankDesc.text=Activity.ins().myDabiaoInfo+"级",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到等级\n"+s);break;case RankDataType.TYPE_ZHANLING:var a=Math.floor(s/1e3),r=s%1e3,h=Activity.ins().myDabiaoInfo[0],l=Activity.ins().myDabiaoInfo[1];this.rankDesc.text=h+"阶"+l+"星",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到星阶\n"+(a?a+"阶":"")+(r+"星"));break;case RankDataType.TYPE_LONGHUN:this.rankDesc.text=Activity.ins().myDabiaoInfo+"级",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到等级\n"+s);break;case RankDataType.TYPE_XIAOFEI:this.rankDesc.text=Activity.ins().myDabiaoInfo+"元宝",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="消费\n"+s+"元宝")}},e.prototype.getDataList=function(t){var e=GlobalConfig.ActivityType4Panel[t],i=[];for(var s in e)0==e[s].ranking?this.dabiao=e[s]:i.push(e[s]);
return i},e.prototype.onClick=function(t){switch(t.currentTarget){case this.getReward:Activity.ins().sendGetDabiaoReward(this.activityID);break;case this.btn_showRank:case this.btn_showRank0:this.group_Rank&&(this.group_Rank.visible=!this.group_Rank.visible,this.btn_showRank&&(this.btn_showRank.label=this.group_Rank.visible?"查看奖励":"查看排行"))}},e.prototype.getCurValue=function(){var t=0;return t},e.prototype.getCurRewards=function(){var t=[];return t},e.prototype.getCurStatus=function(){var t=0;return t},e}(ActivityPanel);__reflect(ActivityType4Panel.prototype,"ActivityType4Panel");var ActivityType5Panel=function(t){function e(){var e=t.call(this)||this;return e.rewardIndex=-1,e.btnMax=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.refushSkin()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.refushSkin(),this.updateData(),this.addTouchEvent(this.sureBtn1,this.onClick),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);for(var i=1;i<=this.btnMax;i++)this.addTouchEvent(this["btn"+i],this.onClick)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];debug.log("close"),this.removeTouchEvent(this.sureBtn1,this.onClick);for(var i=1;i<=this.btnMax;i++)this.removeTouchEvent(this["btn"+i],this.onClick);this.removeObserve()},e.prototype.refushSkin=function(){this.activityBtnType==ActivityBtnType.ZHONG_QIU?(this.btnMax=7,this.skinName="ActMidLogSkin"):this.activityBtnType==ActivityBtnType.SHENG_XIA?(this.btnMax=5,this.skinName="SunmerLogSkin"):(this.btnMax=10,this.skinName="ActNatLogSkin"),this.list1.itemRenderer=ItemBase},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.date.text="活动未开启":0>=i?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3),this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.refushBtnReward()},e.prototype.refushBtnReward=function(t){void 0===t&&(t=0);var e=Activity.ins().getActivityDataById(this.activityID);0==t&&(t=e.logTime,e.logTime||(t=1)),this.rewardIndex=t;var i=GlobalConfig.ActivityType5Config[this.activityID][this.rewardIndex-1+""];this.list1.dataProvider=new eui.ArrayCollection(i.rewards),this.selectBtn&&(this.selectBtn.currentState="up"),this.selectBtn=this["btn"+t],this.selectBtn.currentState="down",t<=e.logTime?e.checkOneDayStatu(t)?(this.sign.visible=!1,this.sureBtn1.visible=!0):(this.sign.visible=!0,this.sureBtn1.visible=!1):(this.sign.visible=!1,this.sureBtn1.visible=!1)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.sureBtn1:Activity.ins().sendReward(this.activityID,this.rewardIndex);break;case this.btn1:this.refushBtnReward(1);break;case this.btn2:this.refushBtnReward(2);break;case this.btn3:this.refushBtnReward(3);break;case this.btn4:this.refushBtnReward(4);break;case this.btn5:this.refushBtnReward(5);break;case this.btn6:this.refushBtnReward(6);break;case this.btn7:this.refushBtnReward(7);break;case this.btn8:this.refushBtnReward(8);break;case this.btn9:this.refushBtnReward(9);break;case this.btn10:this.refushBtnReward(10)}},e}(ActivityPanel);__reflect(ActivityType5Panel.prototype,"ActivityType5Panel");var ActivityWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ActivityWinSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY)),!1;var i=t[0];if(void 0!=i&&!(Activity.ins().getActivityDataById(i)&&Activity.ins().getActivityDataById(i).isOpenActivity()&&PActivity.ins().getActivityDataById(i)&&PActivity.ins().getActivityDataById(i).isOpenActivity()))return UserTips.ins().showTips("|C:0xff0000&T:活动未开启"),!1;var s=Object.keys(Activity.ins().activityData),n=Object.keys(PActivity.ins().activityData);if(!s.length&&!n.length)return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1;for(var o in Activity.ins().activityData)if(Activity.ins().activityData[o]&&!Activity.ins().activityData[o].pageStyle&&Activity.ins().activityData[o].timeType!=ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+o).isOpenActivity())return!0;for(var o in PActivity.ins().activityData)if(PActivity.ins().getActivityDataById(+o).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postMuchDayRecReward,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.observe(PActivity.ins().postActivityPanel,this.updatePanel),this.observe(PActivity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(PActivity.ins().postChangePage,this.ChangePageCallBack),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&!Activity.ins().activityData[i].pageStyle&&Activity.ins().activityData[i].timeType!=ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"ActivityWin  data   "+i)||this._datas.push(s)}for(var i in PActivity.ins().activityData)if(PActivity.ins().getActivityDataById(+i).isOpenActivity()){var s=PActivity.ins().getbtnInfo(i);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"PActivityWin  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=void 0;if(this._datas[i].activityType==ActivityType.Normal?o=Activity.ins().getActivityDataById(+n):this._datas[i].activityType==ActivityType.Personal&&(o=PActivity.ins().getActivityDataById(+n)),o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,o.activityType);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}GameServer.serverOpenDay<7?this.title.source="biaoti_kaifuhuodong":this.title.source="biaoti_huodong"},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,this.activityPanelList[t].activityType==ActivityType.Normal?Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0):this.activityPanelList[t].activityType==ActivityType.Personal&&PActivity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=void 0,i=this.activityPanelList[this.selectIndex].activityType;i==ActivityType.Normal?e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID]:i==ActivityType.Personal&&(e=GlobalConfig.PActivityConfig[this.activityPanelList[this.selectIndex].activityID]),e&&(e.activityType==ActivityDataFactory.ACTIVITY_TYPE_3||e.activityType==ActivityDataFactory.ACTIVITY_TYPE_9||e.activityType==ActivityDataFactory.ACTIVITY_TYPE_19?this.setOpenIndex(this.selectIndex):i==ActivityType.Normal?Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID):i==ActivityType.Personal&&PActivity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID))}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:t.activityType>e.activityType?1:-1},e}(BaseEuiView);__reflect(ActivityWin.prototype,"ActivityWin"),ViewManager.ins().reg(ActivityWin,LayerManager.UI_Main);var CelebrationItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CERechargeItemSkin",e}return __extends(e,t),e.prototype.destruct=function(){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=Activity.ins().getActivityDataById(t.config.Id),i=e.getRewardStateById(t.config.index);this.redPoint.visible=!1,this.already.visible=!1;var s=13746831;this.ball.source=t.config.expAttr[0],i==Activity.Geted?(this.already.visible=!0,s=65280,this.ball.source=t.config.expAttr[1]):i==Activity.CanGet?(s=65280,this.redPoint.visible=!0):s=16711680,this.now.textFlow=TextFlowMaker.generateTextFlow1("|C:"+s+"&T:"+Math.floor(t.curCost/100)),this.target.text=Math.floor(t.config.val/100)+"",this.ball0.visible=!1}},e.prototype.setSelect=function(t){this.ball0.visible=t},e}(BaseItemRender);__reflect(CelebrationItem.prototype,"CelebrationItem");var CelebrationWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="celebrationWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.CELEBRATION,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i].pageStyle==ActivityPageStyle.CELEBRATION&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);ErrorLog.Assert(s,"christmas  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=Activity.ins().getActivityDataById(+n);if(o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,ActivityType.Normal);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&this.setOpenIndex(this.selectIndex)}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(CelebrationWin.prototype,"CelebrationWin"),ViewManager.ins().reg(CelebrationWin,LayerManager.UI_Main);var ChristmasDayWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="christmasDayWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.CHRISTMAS,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if((!Activity.ins().activityData[i]||Activity.ins().activityData[i].pageStyle==ActivityPageStyle.CHRISTMAS)&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if((!Activity.ins().activityData[i]||Activity.ins().activityData[i].pageStyle==this._pageStyle)&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);ErrorLog.Assert(s,"christmas  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=Activity.ins().getActivityDataById(+n);if(o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,o.activityType);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):this.setOpenIndex(this.selectIndex))}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){},e.prototype.onTouchBtn=function(t){},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(ChristmasDayWin.prototype,"ChristmasDayWin"),ViewManager.ins().reg(ChristmasDayWin,LayerManager.UI_Main);var ChristmasRechargeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t,e;this.data instanceof ActivityType3Config?(t=this.data,e=Activity.ins().getActivityDataById(t.Id)):this.data instanceof PActivity3Config&&(t=this.data,e=PActivity.ins().getActivityDataById(t.Id)),this.reward.data=t.rewards[0],this.reward.hideName(),this.schedule.textFlow=TextFlowMaker.generateTextFlow1("|C:0x00ff00&T:"+Math.floor(e.chongzhiTotal/100)+"|/"+Math.floor(t.val/100));var i=e.getRewardStateById(t.index);i==Activity.Geted?(this.lingqu.visible=!0,this.redPoint.visible=!1,this.reward.touchEnabled=!0,this.reward.touchChildren=!0,this.ball.source="cd_treeitembg2"):i==Activity.CanGet?(this.lingqu.visible=!1,this.redPoint.visible=!0,this.reward.touchEnabled=!1,this.reward.touchChildren=!1,this.ball.source="cd_treeitembg2"):(this.lingqu.visible=!1,this.redPoint.visible=!1,this.reward.touchEnabled=!0,this.reward.touchChildren=!0,this.ball.source="cd_treeitembg1")},e}(BaseItemRender);__reflect(ChristmasRechargeItem.prototype,"ChristmasRechargeItem");var ChritmasSnowMainItem=function(t){function e(){var e=t.call(this)||this;return e.states=["lingqu","normal","done"],e.skinName="snowManItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(t){var e=this.data;Activity.ins().sendReward(e.Id,e.index)},e.prototype.dataChanged=function(){var t=this.data,e=Activity.ins().getActivityDataById(t.Id),i=e.getAwardState(t.index);i==Activity.Geted?this.currentState=this.states[2]:i==Activity.CanGet?this.currentState=this.states[0]:(this.currentState=this.states[1],this.schedule.textFlow=TextFlowMaker.generateTextFlow1("|C:0x00ff00&T:"+t.score+"|雪球")),this.reward.data=t.rewards[0],this.reward.hideName()},e}(BaseItemRender);__reflect(ChritmasSnowMainItem.prototype,"ChritmasSnowMainItem");var DailyGiftItemRender=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._activityID=0,e._subRmb=0,e.skinName="DEDailyGiftItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){this._config=this.data[0],this._state=this.data[1],this._activityID=this.data[3],this._subRmb=this.data[4],this.discountNum.text=this._config.discount+"",this.vipLv.text=this._config.vip+"",this.vip.visible=this._config.vip>0,this.original.text=this._config.originalPrice+"",this.now.text=this._config.price+"";var t=this.data[2]?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1("可购买：|C:"+t+"&T:"+this.data[2]+"|/"+this._config.count),this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards),this.redPoint.visible=1==this._state&&Actor.yb>=this._config.price&&this._subRmb>=this._config.needRecharge&&UserVip.ins().lv>=this._config.vip,this.get.enabled=1==this._state,this.get.visible=2!=this._state,this.already.visible=2==this._state},e.prototype.onTap=function(t){UserVip.ins().lv<this._config.vip?UserTips.ins().showTips("|C:0xff0000&T:VIP等级不满足要求|"):Actor.yb<this._config.price?UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):this._subRmb<this._config.needRecharge?UserTips.ins().showTips("|C:0xf3311e&T:充值不足|"):Activity.ins().sendReward(this._activityID,this._config.index)},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(DailyGiftItemRender.prototype,"DailyGiftItemRender");var DailyGiftPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gift.itemRenderer=DailyGiftItemRender,this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(UserVip.ins().postUpdateVipData,this.update),this.observe(UserVip.ins().postUpdataExp,this.update),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.update()},e.prototype.update=function(){var t,e=Activity.ins().getDoubleElevenDataByID(this.activityID),i=GlobalConfig.ActivityType2Config[this.activityID],s=[],n=0,o=0,a=0;for(var r in i)t=i[r],o=e.buyData[n+1]>=t.count?2:1,a=t.count-e.buyData[n+1],0>a&&(a=0),s[n]=[t,o,a,this.activityID,e.sumRMB],n++;s.sort(this.sort),this.gift.dataProvider=new eui.ArrayCollection(s),this._time=e.getLeftTime(),this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)},e.prototype.sort=function(t,e){return 1==t[1]&&1!=e[1]?-1:2==t[1]&&2!=e[1]?1:t[0].index<e[0].index?-1:t[0].index>e[0].index?1:0},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4))},e}(BaseView);__reflect(DailyGiftPanel.prototype,"DailyGiftPanel");var DoubleEleventWin=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=0,e.skinName="doubleElevenWin",e.isTopLevel=!0,e.DETimeBuySkin.activityIDs=[150,151,152,153],e.DEFanliSkin.activityID=156,e.DEDailyGiftSkin.activityID=130,e._panels=[e.DETimeBuySkin,e.DEFanliSkin,e.DEDailyGiftSkin],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e,i=[],s=[],n=[150,156,130];for(var o in Activity.ins().doubleElevenData)e=Activity.ins().getbtnInfo(o),-1==s.indexOf(e.icon)&&(i.push(e),s.push(e.icon));s.length=0,s=null;var a=[];i.sort(this.sort);for(var r in i)e=i[r],a.push(this._panels[n.indexOf(e.id)]);this.BtnArr=i,this.dataArr=new eui.ArrayCollection,this.dataArr.source=this.BtnArr,this.menuList.itemRenderer=ActivityBtnRenderer,this.menuList.dataProvider=this.dataArr,this._panels=a,this.viewStack.removeChildren();for(var h=a.length,l=0;h>l;l++)this.viewStack.addChild(this._panels[l]);this._panels[this._selectIndex].open(),this.menuList.selectedIndex=this._selectIndex,this.viewStack.selectedIndex=this._selectIndex,Activity.ins().setPalyEffListById(this._panels[this._selectIndex].activityID,!0),this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(Actor.ins().postYbChange,this.refushRedPoint),this.observe(Actor.ins().postLevelChange,this.refushRedPoint),this.refushRedPoint()},e.prototype.close=function(){for(var t=0;t<this.viewStack.numChildren;t++)this.viewStack.getChildAt(t).close()},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onClickMenu=function(t){this._selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this._panels[this._selectIndex].close()),this._selectIndex=t.currentTarget.selectedIndex,this._panels[this._selectIndex].open(),this.viewStack.selectedIndex=this._selectIndex,Activity.ins().setPalyEffListById(this._panels[this._selectIndex].activityID,!0)},e}(BaseEuiView);__reflect(DoubleEleventWin.prototype,"DoubleEleventWin"),ViewManager.ins().reg(DoubleEleventWin,LayerManager.UI_Main);var FanLinPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e._stateList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.pay0,this.onPay0),this.addTouchEvent(this.pay1,this.onPay1),this.observe(Activity.ins().postActivityIsGetAwards,this.update),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.update()},e.prototype.update=function(){var t,e,i=Activity.ins().getDoubleElevenDataByID(this.activityID),s=GlobalConfig.ActivityType3Config[this.activityID],n=0,o=[this.pay0,this.pay1],a=0;for(var r in s)t=s[r],n=i.recrod>>t.index&1?2:i.chongzhiNum>=t.val?1:0,e=o[a],2==n?e.label="已领取":1==n?e.label="领取奖励":e.label="充值¥"+t.val/100,e.enabled=2!=n,this._stateList[a]=n,this["redPoint"+a].visible=1==n,a++;this._time=i.getLeftTime(),this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this.pay0,this.onPay0),this.removeTouchEvent(this.pay1,this.onPay1),TimerManager.ins().removeAll(this)},e.prototype.onPay0=function(t){this.onPay(0)},e.prototype.onPay1=function(t){this.onPay(1)},e.prototype.onPay=function(t){var e=this._stateList[t];if(0==e){var i=Recharge.ins().getRechargeData(0);i&&2==i.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win)}else 1==e&&Activity.ins().sendReward(this.activityID,t+1)},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4))},e}(BaseView);__reflect(FanLinPanel.prototype,"FanLinPanel");var TimeBuyItemRender=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._activityID=0,e.skinName="DETimeBuyItemSkin",e
}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){this._config=this.data[0],this._state=this.data[1],this._activityID=this.data[3],this.discountNum.text=this._config.discount+"",this.priceLabel.text=this._config.price+"";var t=this.data[2]?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1("可购买：|C:"+t+"&T:"+this.data[2]+"|/"+this._config.count),this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards),this.stock.text=this.data[4],this.redPoint.visible=1==this._state&&Actor.yb>=this._config.price,this.get.enabled=1==this._state,this.get.visible=2!=this._state,this.already.visible=2==this._state},e.prototype.onTap=function(t){Actor.yb<this._config.price?UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):Activity.ins().sendReward(this._activityID,this._config.index)},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(TimeBuyItemRender.prototype,"TimeBuyItemRender");var TimeBuyPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e._selectIndex=0,e._openLeftTime=0,e._arrayCollect=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gift.itemRenderer=TimeBuyItemRender,this.gift.dataProvider=this._arrayCollect,this.actDesc.text=GlobalConfig.ActivityConfig[this.activityIDs[0]].desc},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this,this.onTop),TimerManager.ins().doTimer(1e3,0,this.setTime,this),TimerManager.ins().doTimer(3e4,0,this.getServerTimes,this),this.update(),this.getServerTimes()},e.prototype.getServerTimes=function(){for(var t=this.activityIDs.length,e=0;t>e;e++)Activity.ins().sendChangePage(this.activityIDs[e])},e.prototype.update=function(){var t,e,i=this.activityIDs.length,s=0;this._openLeftTime=0;for(var n=0;i>n;n++)e=GlobalConfig.ActivityType2Config[this.activityIDs[n]][1],t=Activity.ins().getDoubleElevenDataByID(this.activityIDs[n]),this["timeItem"+n].setData(e,t?t.isSpecialOpen():!1),this["timeItem"+n].setSelected(!1),this["timeItem"+n].setRedPoint(t&&t.isSpecialOpen()&&t.canReward()),this["timeItem"+n].name=n,s=t?t.getSpecialOpenLeftTime():0,s>0&&0==this._openLeftTime&&(this._openLeftTime=s),this._openLeftTime>0&&s>0&&s<this._openLeftTime&&(this._openLeftTime=s);this._time=t?t.getLeftTime():0,this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4),this.updateSelected()},e.prototype.updateSelected=function(){this["timeItem"+this._selectIndex].setSelected(!0);var t,e=GlobalConfig.ActivityType2Config[this.activityIDs[this._selectIndex]],i=Activity.ins().getDoubleElevenDataByID(this.activityIDs[this._selectIndex]),s=[],n=0,o=0,a=(UserVip.ins().lv,0),r=0,h=0;for(var l in e)t=e[l],o=i?i.buyData[n+1]>=t.count?2:i.isSpecialOpen()&&i.serverBuyData[n+1]<t.scount?1:0:0,a=i?t.count-i.buyData[n+1]:0,0>a&&(a=0),h=i?t.scount-i.serverBuyData[n+1]:0,r=i?Math.floor(Math.max(Math.min(h/t.scount*t.shamScount,t.shamScount-i.getSpecialStrikeTimes()),0)):0,5>=h&&r>5&&(r=5),0==h&&(r=0),s[n]=[t,o,a,this.activityIDs[this._selectIndex],h+r],n++;s.sort(this.sort),this._arrayCollect.source=s},e.prototype.sort=function(t,e){return 1==t[1]?-1:1==e[1]?1:t[0].index<e[0].index?-1:t[0].index>e[0].index?1:0},e.prototype.close=function(){TimerManager.ins().removeAll(this),this.removeTouchEvent(this,this.onTop),this.removeObserve()},e.prototype.onTop=function(t){switch(t.target){case this.timeItem0:case this.timeItem1:case this.timeItem2:case this.timeItem3:this["timeItem"+this._selectIndex].setSelected(!1),this._selectIndex=Number(t.target.name),this.updateSelected()}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)),this._openLeftTime>0&&(this._openLeftTime--,0==this._openLeftTime&&this.update())},e}(BaseView);__reflect(TimeBuyPanel.prototype,"TimeBuyPanel");var TimeBuyTab=function(t){function e(){var e=t.call(this)||this;return e.skinName="DETimeBuyTabSkin",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.setData=function(t,e){this.time.text=t.limitTime[0]+":"+(t.limitTime[1]<10?t.limitTime[1]+"0":t.limitTime[1]),this._isOpen=e,this.setSelected(!1)},e.prototype.setSelected=function(t){t?this.currentState=this._isOpen?"intimeselect":"outtimeselect":this.currentState=this._isOpen?"intime":"outtime"},e.prototype.setRedPoint=function(t){this.redPoint.visible=t},e}(BaseComponent);__reflect(TimeBuyTab.prototype,"TimeBuyTab");var DoubleTwelveRechargeItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.item.isShowName(!1),this.item.data=this.data,0==this.data.type){var t=1;switch(this.data.id){case MoneyConst.yuanbao:t=5;break;case MoneyConst.gold:t=0;break;case MoneyConst.soul:t=2;break;case MoneyConst.piece:t=2;break;case MoneyConst.godweaponExp:t=2}this.nameTxt.text=RewardData.getCurrencyName(this.data.id),this.nameTxt.textColor=ItemBase.QUALITY_COLOR[t]}else{var e=GlobalConfig.ItemConfig[this.data.id];this.nameTxt.text=e.name,this.nameTxt.textColor=ItemConfig.getQualityColor(e)}},e}(ItemRenderer);__reflect(DoubleTwelveRechargeItem.prototype,"DoubleTwelveRechargeItem");var DoubleTwelveRechargeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DTRechargeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.list.itemRenderer=DoubleTwelveRechargeItem,this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.bgClose,this.closeWin),this.addTouchEvent(this.chooseBtn0,this.onSelect),this.addTouchEvent(this.chooseBtn1,this.onSelect),this.addTouchEvent(this.chooseBtn2,this.onSelect),this.addTouchEvent(this.rechargeBtn,this.onRecharge),this.observe(Recharge.ins().postUpdateRecharge,this.updateView),this.observe(Recharge.ins().postUpdateRechargeEx,this.updateView),this.observe(Activity.ins().postChangePage,this.updateView),this.observe(Activity.ins().postRewardResult,this.updateView),this.observe(Activity.ins().postActivityIsGetAwards,this.updateView),TimerManager.ins().doNext(function(){t.updateView()},this)},e.prototype.onRecharge=function(t){var e=this.idAry[this.selectIndex];if(this.recharge.visible){var i=Recharge.ins().getRechargeData(0);i&&2==i.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win)}else Activity.ins().sendReward(e,1)},e.prototype.updateView=function(){this.idAry=Activity.ins().doubleTwelveRechargeIDAry;var t,e=Activity.ins().doubleTwelveRechargeData[this.idAry[0]],i=e.getLeftTime(),s=Math.floor(1e3*i/DateUtils.MS_PER_DAY);0==s?(s=Math.floor(1e3*i/(DateUtils.MS_PER_DAY/24)),t=s+"小时"):t=s+"天",this.limitTime.text="距离活动结束仅剩"+t;for(var n=0;3>n;n++)this.setText(n);this.selectIndex?this.selectActivity(this.selectIndex):this.selectActivity(0)},e.prototype.selectBtn=function(t){this.select0.visible=!1,this.select1.visible=!1,this.select2.visible=!1,this["select"+t].visible=!0},e.prototype.selectActivity=function(t){this.selectIndex=t;var e=this.idAry[t],i=Activity.ins().doubleTwelveRechargeData[e],s=DoubleTwelveModel.ins().getNeedRecharge(e);this.rechargeCount.text=s.toString(),i.recrod>0?this.btn.visible=!1:(this.btn.visible=!0,s>0?(this.recharge.visible=!0,this.get.visible=!1):(this.recharge.visible=!1,this.get.visible=!0));var n=GlobalConfig.ActivityType3Config[e][1];this.list.dataProvider=new ArrayCollection(n.rewards),this.selectBtn(t)},e.prototype.setText=function(t){var e=this.idAry[t],i=GlobalConfig.ActivityType3Config[e][1],s=i.val;s=0==t?Math.floor(s/1e3):Math.floor(s/1e4),this["count"+t].text=s.toString()},e.prototype.onSelect=function(t){var e=t.target,i=0;i=e==this.chooseBtn0?0:e==this.chooseBtn1?1:2,this.selectActivity(i)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DoubleTwelveRechargeWin.prototype,"DoubleTwelveRechargeWin"),ViewManager.ins().reg(DoubleTwelveRechargeWin,LayerManager.UI_Popup);var DoubleTwelveWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="doubleTwelveWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuList.itemRenderer=ActivityBtnRenderer,this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.closeBtn,this.closeWin),this.observe(Activity.ins().postChangePage,this.updateView),this.observe(Activity.ins().postRewardResult,this.updateView),this.observe(Activity.ins().postActivityIsGetAwards,this.updateView),this.updateView()},e.prototype.close=function(){for(var t=0;t<this.viewStack.numChildren;t++)this.viewStack.getChildAt(t).close()},e.prototype.updateView=function(){var t=[];for(var e in Activity.ins().doubleTwelveData){var i=Activity.ins().getbtnInfo(e),s=Activity.ins().doubleTwelveData[e];s.isOpenActivity()&&(t.push(i),2==s.type?this.DTDailyGiftSkin.activityID=s.id:this.DTLuckyTurntableSkin.activityID=s.id)}t.sort(function(t,e){return Algorithm.sortAscAttr(t,e,"sort")}),this.menuList.dataProvider=new ArrayCollection(t),this.panels=[this.DTDailyGiftSkin,this.DTLuckyTurntableSkin],this.selectIndex||(this.selectIndex=0),this.viewStack.selectedIndex=this.selectIndex,this.panels[this.selectIndex].open()},e.prototype.closeWin=function(t){ViewManager.ins().close(e)},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.panels[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.viewStack.selectedIndex=this.selectIndex,this.panels[this.selectIndex].open(),Activity.ins().setPalyEffListById(this.panels[this.selectIndex].activityID,!0)},e}(BaseEuiView);__reflect(DoubleTwelveWin.prototype,"DoubleTwelveWin"),ViewManager.ins().reg(DoubleTwelveWin,LayerManager.UI_Main);var DoubleTwelveGift=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.getRule();this.updateData(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy,this.onTap),this.addTouchEvent(this.szlb,this.onTap),this.addTouchEvent(this.lhlb,this.onTap),this.addTouchEvent(this.yylb,this.onTap),this.addTouchEvent(this.sblb,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.hideSelect();var i=this.getRule();this.updateData(i)},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.hideSelect=function(){for(var t=0;4>t;t++)this["select"+t].visible=!1,this["arrow"+t].visible=!1,this["select"+t].visible=!1},e.prototype.GetCallBack=function(t){if(this.activityID==t){if(!Activity.ins().isSuccee){UserTips.ins().showTips("领取失败");var e=Activity.ins().doubleTwelveData[this.activityID];Activity.ins().sendChangePage(e.id)}Activity.ins().isSuccee=!1,this.hideSelect();var i=this.getRule();this.updateData(i)}},e.prototype.onTap=function(t){var e;switch(t.currentTarget){case this.buy:if(this.config.vip&&UserVip.ins().lv<this.config.vip)UserTips.ins().showTips("vip等级不足");else{if(UserBag.ins().getSurplusCount()<7)return void UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");Actor.yb>=this.config.price?Activity.ins().sendReward(this.activityID,this._index):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")}e=-1;break;case this.lhlb:e=1;break;case this.yylb:e=2;break;case this.szlb:e=3;break;case this.sblb:e=4}if(-1!=e){for(var i=0;4>i;i++)e!=i+1?this["select"+i].visible=!1:this["select"+i].visible=!0,this["arrow"+i].visible=this["select"+i].visible;this.updateData(e)}},e.prototype.getRule=function(){var t=Activity.ins().doubleTwelveData[this.activityID],e=GlobalConfig.ActivityType2Config[this.activityID],i=[];for(var s in e)i.push(e[s]);i.sort(this.sortFunc);for(var n=0;n<i.length;n++){var o=i[n],a=t.buyData[o.index]>=o.count?!0:!1;if(!a)return o.index}return 2},e.prototype.sortFunc=function(t,e){return t.price<e.price?-1:t.price>e.price?1:0},e.prototype.updateData=function(t){void 0===t&&(t=2),this._index=t,this["select"+(t-1)].visible=!0,this["arrow"+(t-1)].visible=!0;var e=Activity.ins().doubleTwelveData[this.activityID];this.setTime(),this.config=GlobalConfig.ActivityType2Config[this.activityID][t];var i=GlobalConfig.ActivityBtnConfig[this.activityID];i&&(this.title.source=i.title),this.desc3.text=this.config.price+"",this.desc5.text=this.config.giftName;for(var s=0;s<this.config.rewards.length;s++){var n=this.config.rewards[s];this["item"+s].data={type:n.type,count:n.count,id:n.id},17==this["item"+s].getItemType()&&(this["item"+s].showSpeicalDetail=!1)}var o=e.buyData[this._index]>=this.config.count?!0:!1;this.buy.visible=!o,this.already.visible=o,this.actTime.visible=!this.already.visible,this.showbg.source=this.config.source[2]+"_png",this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1);for(var s in GlobalConfig.ActivityType2Config[this.activityID]){var a=GlobalConfig.ActivityType2Config[this.activityID][s];a&&a.source[0]&&(this["bg"+(+s-1)].source=a.source[0]),a&&a.source[1]&&(this["name"+(+s-1)].source=a.source[1])}},e.prototype.setTime=function(){var t=Activity.ins().doubleTwelveData[this.activityID],e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);DoubleTwelveGift.giftNameArr=["","材料礼包","图鉴礼包","羽翼礼包","神兵礼包"],__reflect(DoubleTwelveGift.prototype,"DoubleTwelveGift");var DoubleTwelveLottery=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve();for(var i=0;3>i;i++)this.removeTouchEvent(this["isget"+i],this.onGiftClick);egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var s=Activity.ins().doubleTwelveData[this.activityID];1==s.indexs.length&&Activity.ins().sendReward(this.activityID,1),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postChangePage,this.resultCallBack),this.observe(Activity.ins().postChangePage,this.updateView),this.observe(Activity.ins().postRewardResult,this.updateView),this.observe(Activity.ins().postActivityIsGetAwards,this.updateView),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery);for(var i=0;3>i;i++)this.addTouchEvent(this["isget"+i],this.onGiftClick);this.list.itemRenderer=NoticeListRenderer,this.turnten.selected=!1,this.updateView()},e.prototype.onTouch=function(t){},e.prototype.updateView=function(){var t=(Activity.ins().doubleTwelveData[this.activityID],GlobalConfig.ActivityType9Config[this.activityID][0]),e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=UserBag.ins().getBagItemById(e.id),s=0,n=1,o=13746831;i?(s=i.count,o=s>=n?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+s+"|C:0xD1C28F&T:/"+n),this.pay0.text=t.yb+""}for(var a in GlobalConfig.ActivityType9Config[this.activityID])if(+a){var r=GlobalConfig.ActivityType9Config[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(){var t=Activity.ins().doubleTwelveData[this.activityID];t.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,t.indexs):1==t.indexs.length&&this.beginLottery(t.indexs[0]),this.listRefush()},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){return this.rolling?void UserTips.ins().showTips("正在抽奖，请稍候"):void(this.turnten.selected?Activity.ins().getIsRollTen(this.activityID)?Activity.ins().sendReward(this.activityID,2):UserTips.ins().showTips("元宝不足"):Activity.ins().getRollSum(this.activityID)||Actor.yb>=GlobalConfig.ActivityType9Config[this.activityID][0].yb?Activity.ins().sendReward(this.activityID,1):UserTips.ins().showTips("元宝不足"))},e.prototype.onGiftClick=function(t){for(var e=0;3>e;e++)if(t.currentTarget==this["isget"+e]){var i=this["gift"+e].getItemIcon();this.flyItemEx(i),Activity.ins().sendReward(this.activityID,0,e+1);break}},e.prototype.updateProgress=function(){var t=GlobalConfig.ActivityType9Config[this.activityID][0],e=Activity.ins().doubleTwelveData[this.activityID];if(t&&e){this.turntime.text=e.count+"";for(var i=0;3>i;i++){if(this["turntime"+i].text=t.reward[i].times,this["gift"+i].data={id:t.reward[i].id,type:t.reward[i].type,count:t.reward[i].count},this["gift"+i].isShowName(!1),this["bar"+i].maximum=100,this["lingqu"+i].touchEnabled=!1,e.record>>i+1&1)this["bar"+i].value=100,this["lingqu"+i].visible=!0,this["isget"+i].touchEnabled=!1;else if(this["lingqu"+i].visible=!1,e.count>=t.reward[i].times)this["bar"+i].value=100,this["isget"+i].touchEnabled=!0;else{var s=t.reward[i-1],n=e.count,o=t.reward[i].times;s&&(n=e.count-s.times,o=t.reward[i].times-s.times),n=n>0?n:0,this["bar"+i].value=Math.floor(n/o*100),this["isget"+i].touchEnabled=!1}this.updateRedPoint(this.activityID,i)}}},e.prototype.updateRedPoint=function(t,e){var i=Activity.ins().isGetRollReward(t,e);this["redPoint"+e].visible=i},e.prototype.listRefush=function(){var t=Activity.ins().doubleTwelveData[this.activityID];if(t){for(var e=[],i=0;i<t.noticeArr.length;i++){var s={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].index};e.push(s)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t=Activity.ins().doubleTwelveData[Activity.ins().doubleTwelveIDAry[2]];this.actTime.text="剩余时间："+t.getLastTime()},e}(ActivityPanel);__reflect(DoubleTwelveLottery.prototype,"DoubleTwelveLottery");var DoubleTwelveModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getNeedRecharge=function(t){var e=Activity.ins().doubleTwelveRechargeData[t],i=GlobalConfig.ActivityType3Config[t][1];return Math.max(0,i.val-e.chongzhiTotal)},e}(BaseClass);__reflect(DoubleTwelveModel.prototype,"DoubleTwelveModel");var GameSystem;!function(t){t.doubleTwelveModel=DoubleTwelveModel.ins.bind(DoubleTwelveModel)}(GameSystem||(GameSystem={}));var FengceActivityWin=function(t){function e(){var e=t.call(this)||this;return e.curLevelIndex=0,e.skinName="fengceActiveSkin",e.defaultText="游戏内容遇到的问题，请咨询客服（不超过100字）",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.edit.addEventListener(egret.FocusEvent.FOCUS_IN,this.onTap,this),this.addTouchEvent(this.sendBtn,this.onTap),this.addTouchEvent(this.arrowleft,this.onTap),this.addTouchEvent(this.arrowright,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.edit,this.onTap),this.addChangeEvent(this.tab,this.onSelectIndex),this.setSelectIndex(t[0]||0)},e.prototype.setSelectIndex=function(t){if(this.viewStack.selectedIndex=t,0==t){if(!this.levelData){this.levelData=[];var e=GlobalConfig.LevelMailConfig;for(var i in e)e[i].mType&&this.levelData.push(+i);this.levelData.sort(function(t,e){return e>t?-1:1})}var s=Actor.level,n=UserZs.ins().lv;this.curLevelIndex=0;for(var o=0;o<this.levelData.length;o++){this.curLevelIndex=o;var a=Math.floor(this.levelData[o]/1e3);if(1>a){if(s<this.levelData[o])break}else if(a>n)break}this.updateLevel(this.curLevelIndex);var r=GameServer.serverOpenDay+1,h=GlobalConfig.LoginDayMailConfig[r];if(h){var l=h.idList[0],c=GlobalConfig.MailIdConfig[l];this.count0.text=c.attachment[0].count+""}else this.count0.text="0"}},e.prototype.updateLevel=function(t){0>t&&(t=0),t>=this.levelData.length&&(t=this.levelData.length-1),0==t?(this.arrowleft.visible=!1,this.arrowright.visible=!0):t==this.levelData.length-1?(this.arrowleft.visible=!0,this.arrowright.visible=!1):(this.arrowleft.visible=!0,this.arrowright.visible=!0),this.curLevelIndex=t;var e=this.levelData[t],i=Math.floor(this.levelData[t]/1e3);1>i?(e>Actor.level?this.countDesc.text="再升"+(e-Actor.level)+"级可领取":this.countDesc.text="",this.lvText.text=e+"级奖励"):(i>UserZs.ins().lv?this.countDesc.text="达到"+i+"转可领取":this.countDesc.text="",this.lvText.text=i+"转奖励");var s=GlobalConfig.LevelMailConfig[e],n=s.idList[0],o=GlobalConfig.MailIdConfig[n];this.count2.text=o.attachment[0].count+""},e.prototype.onSelectIndex=function(t){this.setSelectIndex(t.itemIndex)},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.bgClose)ViewManager.ins().close(this);else if(e==this.arrowleft)this.updateLevel(this.curLevelIndex-1);else if(e==this.arrowright)this.updateLevel(this.curLevelIndex+1);else if(e==this.sendBtn){if(0==this.edit.text.length||this.edit.text==this.defaultText)return void UserTips.ins().showTips("内容不能为空");ReportData.getIns().advice(this.edit.text,this.callBack,this)}else e==this.edit&&this.edit.text==this.defaultText&&(this.edit.text="",this.edit.textColor=16777215)},e.prototype.callBack=function(){this.edit.text=""},e.prototype.close=function(){this.tab.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectIndex,this),this.edit.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onTap,this)},e}(BaseEuiView);__reflect(FengceActivityWin.prototype,"FengceActivityWin"),ViewManager.ins().reg(FengceActivityWin,LayerManager.UI_Popup);var GuoActivityWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="guoqingjie",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuoActivityWin.prototype,"GuoActivityWin"),ViewManager.ins().reg(GuoActivityWin,LayerManager.UI_Popup);var HappySevenDayBtnItemRender=function(t){function e(){var e=t.call(this)||this;return e.day=0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.dayImg.source=this.data.res,this.isOpen=this.data.isOpen,this.day=this.data.day,this.currentState=this.isOpen?"unlock":"lock",this.redpoint.visible=this.data.showRed},Object.defineProperty(e.prototype,"selected",{set:function(t){this.currentState=this.isOpen?t?"unlockS":"unlock":"lock",this.data&&(this.redpoint.visible=this.data.showRed)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(HappySevenDayBtnItemRender.prototype,"HappySevenDayBtnItemRender");var HappySevenDayItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this._listCollect=new ArrayCollection,this.list.dataProvider=this._listCollect,this.actBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.dataChanged=function(){this._listCollect.source=this.data.conf.reward,this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.conf.name),this.scedule.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+Math.floor(this.data.times/this.data.conf.rate)+"|/"+Math.floor(this.data.conf.dayLimit/this.data.conf.rate)),this.currentState=2==this.data.state?"done":"normal",this.redpoint.visible=1==this.data.state,0==this.data.state&&this.data.conf.turn?(this.actBtn.enabled=!0,this.actBtn.label="前  往"):(this.actBtn.label="领  取",this.actBtn.enabled=1==this.data.state)},e.prototype.onTouch=function(t){0==this.data.state&&this.data.conf.turn?ViewManager.ins().open(this.data.conf.turn[0],this.data.conf.turn[1]):Activity.ins().sendReward(this.data.activityID,this.data.conf.index,2)},e.prototype.destruct=function(){this.actBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(HappySevenDayItemRender.prototype,"HappySevenDayItemRender");var HappySevenDayTabListItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.tabName.text=this.data.gName,this.redpoint.visible=this.data.showRed},Object.defineProperty(e.prototype,"selected",{set:function(t){this.currentState=t?"select":"unselect",this.data&&(this.redpoint.visible=this.data.showRed)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(HappySevenDayTabListItemRender.prototype,"HappySevenDayTabListItemRender");var HappySevenDayWin=function(t){function e(){var e=t.call(this)||this;return e._curDay=0,e._curDayIndex=0,e._curGroupIndex=0,e.isTopLevel=!0,e.setActivityID(),e.setCurSkin(),e}return __extends(e,t),e.prototype.setActivityID=function(){var t=Activity.ins().activityData;for(var e in t)if(t[e].pageStyle==ActivityPageStyle.HAPPYSEVENDAY){this._activityID=t[e].id;break}},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this._activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="sevenDayWin",this.actInfo0&&(this.actInfo0.text=t.desc)},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.tabP.itemRenderer=HappySevenDayTabListItemRender,this.tabD.itemRenderer=HappySevenDayBtnItemRender,this.list.itemRenderer=HappySevenDayItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._activityID=t[0],this.setCurSkin(),this._curDayIndex=0,this._curGroupIndex=0,this.updateView(),this.updateTabs(),this.tabD.selectedIndex=this._curDayIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData(),this.updateTargetAward(),this.addTouchEvent(this,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds),this.addChangeEvent(this.tabD,this.onClickBtn),this.addChangeEvent(this.tabP,this.onTabBtn),TimerManager.ins().doTimer(1e3,0,this.setTime,this)},e.prototype.close=function(){this._tabCollect=null,this._btnCollect=null,this._listCollect=null},e.prototype.updateView=function(){var t=Activity.ins().getActivityDataById(this._activityID);this._curDay=t.getCurDay(),this._items=[];var e,i,s,n,o,a,r=GlobalConfig.ActivityType11_2Config[this._activityID],h=[];for(var l in r)e=r[l],s=e.day,i=this._items[e.day-1],i||(i=[],this._items[e.day-1]=i,h.push({res:e.dayImg,isOpen:this._curDay>=e.day,showRed:!1,day:e.day})),a=t.achieveInfo[e.index-1],this._curDay>=e.day&&!a.isGot&&a.times>=e.dayLimit&&(h[e.day-1].showRed=!0),n=e.group,o=i[n-1],o||(o=[],i[n-1]=o),o.push(e);this._btnCollect||(this._btnCollect=new ArrayCollection,this.tabD.dataProvider=this._btnCollect),this._btnCollect.source=h,this.tabD.validateNow(),this._tabCollect||(this._tabCollect=new ArrayCollection,this.tabP.dataProvider=this._tabCollect)},e.prototype.refreshReds=function(){this.updateView(),this.updateTabs(),this.updateData(),this.updateTargetAward()},e.prototype.updateData=function(){var t=this._items[this._curDayIndex][this._curGroupIndex];if(t&&t.length){this._listCollect||(this._listCollect=new ArrayCollection,this.list.dataProvider=this._listCollect);for(var e,i,s=t.length,n=[],o=0,a=Activity.ins().getActivityDataById(this._activityID),r=0;s>r;r++)e=t[r],i=a.achieveInfo[e.index-1],o=i.isGot?2:i.times>=e.dayLimit?1:0,n[r]={activityID:this._activityID,conf:e,state:o,times:i.times};n.sort(this.sort),this._listCollect.source=n}},e.prototype.sort=function(t,e){return 1==t.state&&1!=e.state?-1:2==t.state&&2!=e.state?1:t.conf.index<e.conf.index?-1:t.conf.index>e.conf.index?1:0},e.prototype.updateTargetAward=function(){var t=GlobalConfig.ActivityType11_1Config[this._activityID][Object.keys(GlobalConfig.ActivityType11_1Config[this._activityID]).length];this.schedule.maximum=t.score,this.schedule.value=Activity.ins().getActivityDataById(this._activityID).hiScore},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:ViewManager.ins().open(SDRewardWin,this._activityID)}},e.prototype.onClickBtn=function(t){if(this._curDayIndex!=t.currentTarget.selectedIndex){var e=this.tabD.getChildAt(t.currentTarget.selectedIndex);e.isOpen?(e=this.tabD.getChildAt(this._curDayIndex),e.selected=!1,this._curDayIndex=t.currentTarget.selectedIndex):UserTips.ins().showCenterTips("活动开启第"+e.day+"天开放"),this.tabD.selectedIndex=this._curDayIndex,e=this.tabD.getChildAt(this._curDayIndex),e.selected=!0,this.updateTabs(),this.tabP.selectedIndex=this._curGroupIndex=0,this.updateData()}},e.prototype.onTabBtn=function(t){this._curGroupIndex!=t.currentTarget.selectedIndex&&(this._curGroupIndex=t.currentTarget.selectedIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData())},e.prototype.updateTabs=function(){var t,e,i,s=this._items[this._curDayIndex],n=Activity.ins().getActivityDataById(this._activityID),o=[];for(var a in s){o.push({gName:s[a][0].gName,showRed:!1}),t=s[a].length;for(var r=0;t>r;r++)if(i=s[a][r],e=n.achieveInfo[i.index-1],this._curDay>=i.day&&!e.isGot&&e.times>=i.dayLimit){o[a].showRed=!0;break}}this._tabCollect.source=o},e.prototype.setTime=function(){var t=Activity.ins().activityData[this._activityID];t&&(this.actTime0.text=t.getRemainTime())},e}(BaseEuiView);__reflect(HappySevenDayWin.prototype,"HappySevenDayWin"),ViewManager.ins().reg(HappySevenDayWin,LayerManager.UI_Main);var SDRewardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SDRewardSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=SDShowItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,s=(Object.keys(GlobalConfig.ActivityType11_1Config[t[0]]).length,[]);for(var n in GlobalConfig.ActivityType11_1Config[t[0]])i=GlobalConfig.ActivityType11_1Config[t[0]][n],s.push({reward:i.reward,showText:i.showText});this.list.dataProvider=new ArrayCollection(s)},e}(BaseEuiView);__reflect(SDRewardWin.prototype,"SDRewardWin"),ViewManager.ins().reg(SDRewardWin,LayerManager.UI_Main);var SDShowItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase},e.prototype.dataChanged=function(){this.scheduleTxt.textFlow=TextFlowMaker.generateTextFlow1(this.data.showText),this.list.dataProvider=new ArrayCollection(this.data.reward)},e}(BaseItemRender);__reflect(SDShowItemRender.prototype,"SDShowItemRender");var KaiMenItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KMHRechargeItem",e.init(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)
},e.prototype.onClick=function(){if(this.data&&this.data instanceof KaiMenData){if(this.data.already)return void UserTips.ins().showTips("已购买");if(this.data.unready)return void UserTips.ins().showTips("已过期");if(3==this.data.type){if(!this.data.redPoint)return void ViewManager.ins().open(ChargeFirstWin)}else if(1==this.data.type&&!this.data.redPoint)return void UserTips.ins().showTips("未达到条件");Activity.ins().sendReward(this.data.id,this.data.index)}},e.prototype.dataChanged=function(){if(this.data&&this.data instanceof KaiMenData&&(this.unready.visible=this.data.unready,this.already.visible=this.data.already,this.redPoint.visible=this.data.redPoint,this.reward.dataProvider=new eui.ArrayCollection(this.data.reward),3==this.data.type?(this.unready.visible?this.get.visible=!1:this.get.visible=!this.already.visible,this.day.text="第"+this.data.day+"天",DisplayUtils.removeFromParent(this.daySchedule),this.get.parent||this.buyGroup.addChild(this.get)):1==this.data.type&&(this.unready.visible?this.get.visible=!1:(this.get.visible=this.redPoint.visible,this.get.parent||this.buyGroup.addChild(this.get)),this.unready.visible=!1,this.day.text="连充"+this.data.day+"天",this.already.visible?DisplayUtils.removeFromParent(this.daySchedule):this.daySchedule.parent||this.buyGroup.addChild(this.daySchedule)),this.get.visible||DisplayUtils.removeFromParent(this.get),3!=this.data.type||this.data.redPoint?this.get.label="领取":this.get.label="充值",this.daySchedule.parent)){var t=Activity.ins().getActivityDataById(this.data.id),e=65280;this.daySchedule.textFlow=TextFlowMaker.generateTextFlow1("累充|C:"+e+"&T:"+t.dabiao[this.data.index-1]+"|/"+this.data.day+"天")}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(KaiMenItem.prototype,"KaiMenItem");var KaiMenData=function(){function t(){}return t}();__reflect(KaiMenData.prototype,"KaiMenData");var KaiMenWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="kaimenhongWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.KAIMENHONG,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.KAIMENHONG&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"kaimenhong  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=Activity.ins().getActivityDataById(+n);if(o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,ActivityType.Normal);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&this.setOpenIndex(this.selectIndex)}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(KaiMenWin.prototype,"KaiMenWin"),ViewManager.ins().reg(KaiMenWin,LayerManager.UI_Main);var LaBaBossPlayerItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="LaBaBossPlayerRankSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&(this.rank.text=this.data.rank+"",this.rank.visible=this.data.rank?!0:!1,this.name1.text=this.data.name,CommonUtils.labelIsOverLenght(this.hurt,this.data.damage))},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(LaBaBossPlayerItemRender.prototype,"LaBaBossPlayerItemRender");var LabaBossUIPanel=function(t){function e(){var e=t.call(this)||this;return e._curMonsterID=0,e.curValue=1,e.skinName="LaBaBossBattleUiSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.bloodBar.slideDuration=0,this.grayImg.visible=!1,this.already=!1,this.bossHurt=!1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.otherRank.itemRenderer=LaBaBossPlayerItemRender,this.rankArrayCollection=new eui.ArrayCollection,this.otherRank.dataProvider=this.rankArrayCollection,this.meRank.itemRenderer=LaBaBossPlayerItemRender,this.myrankArrayCollection=new eui.ArrayCollection,this.meRank.dataProvider=this.myrankArrayCollection},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.calcTime,this),TimerManager.ins().remove(this.updateLogic,this),this.removeObserve(),this._curMonsterID=0,ViewManager.ins().close(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.observe(UserBoss.ins().postHpChange,this.updateInfo),this.addTouchEvent(this.rankReward,this.onTap),this.updateData(),this.activity&&this.activity.go2BossFb()?void this.init():(ViewManager.ins().close(this),void UserFb.ins().sendExitFb())},e.prototype.init=function(){this.timer=this.activity.getResidueTimer(),this.readyTimer=this.activity.getResidueStartTimer(),this.already=this.activity.checkRedPoint(),this.TimerChange()},e.prototype.updateData=function(){this.activity=Activity.ins().checkLabaBossData()},e.prototype.updateLogic=function(){this.already?this.updateFb():this.updateReady(),this.refreshBg.visible=this.refreshHints.visible=this.refreshTime.visible=!this.already,this.bossBloodGroup.visible=this.already},e.prototype.updateReady=function(){this.readyTimer?this.refreshTime.text=this.readyTimer+"秒":this.refreshTime.text="刷新中",this.bossHurt?(this.timer=this.activity.getResidueTimer(),this.already=!0):this.already=!1},e.prototype.updateFb=function(){this.updateBaseInfo();var t=GlobalConfig.ActivityType20Config[this.activity.id][this.activity.index],e=this.timer/t.duration;e=e>=1?1:e,this.bloodBar.value=100*e,this.bloodBar.maximum=100;var i=(100*e).toFixed(1);this.bloodBar.labelFunction=function(){return i+"%"},this.updateHurtRank()},e.prototype.updateHurtRank=function(){for(var t=[],e=[],i=0;i<UserBoss.ins().rank.length;i++){var s=UserBoss.ins().rank[i],n={rank:s.rank,name:s.roleName,damage:s.value};if(5>i&&t.push(n),s.id==Actor.actorID&&e.push(n),5==t.length&&!e.length)break}if(!e.length){var n={rank:0,name:Actor.myName,damage:0};e.push(n)}this.rankArrayCollection.replaceAll(t),this.myrankArrayCollection.replaceAll(e)},e.prototype.updateBaseInfo=function(){if(this._curMonsterID!=UserBoss.ins().monsterID){this._curMonsterID=UserBoss.ins().monsterID;var t=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];t&&(this.head.source="monhead"+t.head+"_png",this.lvTxt.text="Lv."+t.level,this.nameTxt.text=t.name)}},e.prototype.tweenBlood=function(){var t=this,i=this.curValue*e.GRAYIMG_WIDTH/100,s=this;if(egret.Tween.removeTweens(this.grayImgMask),!(3>i)){var n=egret.Tween.get(this.grayImgMask,{onChange:function(){s.grayImg&&(s.grayImg.mask=t.grayImgMask)}},s);n.to({width:i-3},1e3).call(function(){0>=i&&(s.grayImgMask.width=0,egret.Tween.removeTweens(this.grayImgMask))},s)}},e.prototype.TimerChange=function(){TimerManager.ins().isExists(this.calcTime,this)||TimerManager.ins().doTimer(1e3,0,this.calcTime,this),TimerManager.ins().isExists(this.updateLogic,this)||TimerManager.ins().doTimer(60,0,this.updateLogic,this)},e.prototype.calcTime=function(){this.timer>0?this.timer--:this.timer=0,this.bossHurt?this.readyTimer=0:this.readyTimer>0&&this.readyTimer--},e.prototype.onTap=function(t){switch(t.currentTarget){case this.rankReward:ViewManager.ins().open(LabaRewardTips,this.activity)}},e.prototype.updateReliveTime=function(){UserBoss.ins().reliveTime>0?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.updateInfo=function(){this.bossHurt=!0},e}(BaseEuiView);LabaBossUIPanel.GRAYIMG_WIDTH=0,__reflect(LabaBossUIPanel.prototype,"LabaBossUIPanel"),ViewManager.ins().reg(LabaBossUIPanel,LayerManager.Game_Main);var LabaChangeItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.config,e=this.data.state,i=Activity.ins().getActivityDataById(t.Id);this._dataCollect||(this._dataCollect=new ArrayCollection,this.reward.dataProvider=this._dataCollect),this.result.data=t.rewards[0];var s=[];for(var n in t.items){var o=GlobalConfig.ItemConfig[t.items[n].id],a={id:t.items[n].id,count:t.items[n].count,type:ItemConfig.getType(o)};s.push(a)}this._dataCollect.replaceAll(s),this.reward.validateNow();for(var n=0;n<this.reward.numElements;n++){var r=this.reward.getVirtualElementAt(n),h=this.reward.dataProvider.getItemAt(n),l=UserBag.ins().getBagItemById(h.id),c=l?l.count:0,u=c>=h.count?65280:16711680;r.setName("|C:"+u+"&T:("+c+"/"+h.count+")")}var p=0;e==Activity.CanGet?(this.get.enabled=!0,this.get.currentState="up",p=65280):(this.get.enabled=!1,this.get.currentState="disabled",p=16711680);var d=0;t.count?(d=t.count-i.personalRewardsSum[t.index],d=d>0?d:0,this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("剩余："+d)):t.dailyCount&&(d=t.dailyCount-i.exchange[t.index],d=d>0?d:0,this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("今日剩余："+d)),t.scount?(this.slimit.visible=!0,d=t.scount-i.worldRewardsSum[t.index],d=d>0?d:0,this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("今日全服可兑换次数："+d)):this.slimit.visible=!1,this.redPoint.visible=this.get.enabled;for(var g=3,n=0;g>n;n++)t.items[g-n-1]||this["add"+(g-n-1)]&&DisplayUtils.removeFromParent(this["add"+(g-n-1)])}},e.prototype.onTap=function(t){return this.data&&this.data.config?UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void Activity.ins().sendReward(this.data.config.Id,this.data.config.index):void UserTips.ins().showTips("数据异常")},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(LabaChangeItemRender.prototype,"LabaChangeItemRender");var LaBaRewardItemItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=ItemBase},e.prototype.dataChanged=function(){if(this.data){var t=this.data.config,e=this.data.index,i=t.rankReward[e],s="";s=e==t.rankReward.length-1?"其他名次":i.start==i.endi?"第"+i.start+"名":"第"+i.start+"-"+i.endi+"名",this.ranks.text=s,this.rewardList.dataProvider=new eui.ArrayCollection(i.reward)}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(LaBaRewardItemItemRender.prototype,"LaBaRewardItemItemRender");var LabaRewardTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="LaBaRankRewardskin",e}return __extends(e,t),e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list0.itemRenderer=LaBaRewardItemItemRender,this.addTouchEvent(this.bgClose,this.onClick),this.activity=t[0],this.updateView()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateView=function(){if(this.activity){for(var t=GlobalConfig.ActivityType20Config[this.activity.id][this.activity.index],e=[],i=0;i<t.rankReward.length;i++)e.push({config:t,index:i});this.list0.dataProvider=new eui.ArrayCollection(e)}},e}(BaseEuiView);__reflect(LabaRewardTips.prototype,"LabaRewardTips"),ViewManager.ins().reg(LabaRewardTips,LayerManager.UI_Popup);var LabaWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="LaBaWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.LABA,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.LABA&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);ErrorLog.Assert(s,"laba  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=Activity.ins().getActivityDataById(+n);if(o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,ActivityType.Normal);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&this.setOpenIndex(this.selectIndex)}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(LabaWin.prototype,"LabaWin"),ViewManager.ins().reg(LabaWin,LayerManager.UI_Main);var OSATarget21Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),TimerManager.ins().removeAll(this),TimerManager.ins().remove(this.setTime,this)},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="LaBaActivityTimeDrop"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.rewardList.itemRenderer=ItemBase,this.updateData(),this.updateUI(),TimerManager.ins().doTimer(1e3,0,this.setTime,this)},e.prototype.updateData=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];t.showReward&&(this.rewardList.dataProvider=new eui.ArrayCollection(t.showReward))},e.prototype.updateUI=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(DateUtils.formatMiniDateTime(t.startTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND),i=Math.floor(DateUtils.formatMiniDateTime(t.endTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":(this._time=i,this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3));var s=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=s.desc;var n=GlobalConfig.ActivityBtnConfig[this.activityID];n&&(this.title.source=n.title)},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(ActivityPanel);__reflect(OSATarget21Panel.prototype,"OSATarget21Panel");var OSATarget7Panel6=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e.skinName="LaBaexchangeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actInfo0.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.content.itemRenderer=LabaChangeItemRender},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserBag.ins().postItemAdd,this.updateList),this.observe(UserBag.ins().postItemChange,this.updateList),this.observe(Activity.ins().postActivityIsGetAwards,this.updateList),this.updateData()},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().remove(this.setTime,this),this._leftTime=0},e.prototype.updateData=function(){this._activityData=Activity.ins().getActivityDataById(this.activityID),this.checkTime(),this.updateList()},e.prototype.updateList=function(){var t=[],e=GlobalConfig.ActivityType7Config[this.activityID];for(var i in e){var s=this._activityData.getExchange(e[i].index);t.push({config:e[i],state:s})}t.sort(this.sort),this._dataCollect||(this._dataCollect=new ArrayCollection,this.content.dataProvider=this._dataCollect),this._dataCollect.replaceAll(t)},e.prototype.sort=function(t,e){return t.config.index<e.config.index?-1:1},e.prototype.checkTime=function(){this._leftTime=0,Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3)>=0?this.actTime0.text="活动未开启":(this._leftTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3),this._leftTime<=0?this.actTime0.text="活动已结束":(this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),TimerManager.ins().isExists(this.setTime,this)||TimerManager.ins().doTimer(1e3,0,this.setTime,this)))},e.prototype.setTime=function(){this._leftTime--,this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),this._leftTime<=0&&this.checkTime()},e}(BaseView);__reflect(OSATarget7Panel6.prototype,"OSATarget7Panel6");var LongTaiTouWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="longtaitouWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.LONGTAITOU,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.LONGTAITOU&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"longtaitou  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=Activity.ins().getActivityDataById(+n);if(o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,ActivityType.Normal);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&this.setOpenIndex(this.selectIndex)}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(LongTaiTouWin.prototype,"LongTaiTouWin"),ViewManager.ins().reg(LongTaiTouWin,LayerManager.UI_Main);var cc_launchX=180,cc_launchY=500,cc_firstX=0,cc_firstY=0,cc_distantX=77,cc_distantY=93,cc_depotX=320,cc_depotY=620,cwaitTime=50,LuckyResultWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="HuntResult",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.buy),this.observe(Activity.ins().postRewardResult,this.updateView),this.activityID=t[0],this.indexs=t[1],this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buyBtn,this.buy),this.removeObserve()},e.prototype.updateView=function(){this.canClicck=!0,this.zwHunt.visible=!0;var t;t=GlobalConfig.PActivityBtnConfig[this.activityID]?GlobalConfig.PActivityType9Config:GlobalConfig.ActivityType9Config;var e=t[this.activityID];this.arr=[];for(var i=0;i<this.indexs.length;i++)if(this.indexs[i])for(var s=0;s<e[this.indexs[i]].reward.length;s++)this.arr.push(e[this.indexs[i]].reward[s]);this.title.text="获得如下宝物",this.buyBtn.labelDisplay.text="抽10次",this.yb=10*e[0].yb,this.zw.text=this.yb+"";var n=GlobalConfig.ItemConfig[e[0].item];this.icon.source=n?n.icon+"_png":null,this.itemId=e[0].item,this.updateDesc(),this.playResult(),this.zwNum2.text="/10）"
},e.prototype.updateDesc=function(){var t=UserBag.ins().getBagItemById(this.itemId),e=ColorUtil.WHITE_COLOR,i=0,s=10;t&&(i=t.count,e=t.count>=s?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR),this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+i+"</font> ")},e.prototype.playResult=function(t){var e=this;this.releaseAllItem();for(var i=this.arr.length,s=0;i>s;s++){this.items[s]=this.createItem(this.arr[s]);var n=egret.Tween.get(this.items[s]);this.items[s].x=s%5*cc_distantX+cc_firstX,this.items[s].y=Math.floor(s/5)*cc_distantY+cc_firstY,this.items[s].alpha=0,n.wait(s*cwaitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.playGet=function(t){for(var e=this,i=this.arr.length,s=0;i>s;s++)if(this.items[s]){var n=egret.Tween.get(this.items[s]);n.to({y:cc_depotY,x:cc_depotX,scaleX:0,scaleY:0},300-50*Math.floor(s/5)).call(function(){i--,0==i&&(void 0!=t&&t(),e.releaseAllItem())})}},e.prototype.createItem=function(t){var e=new ItemBase;this.listCon.addChild(e);var i=GlobalConfig.ItemConfig[t.id];return i?(e.num=t.count,e.data=t):e.data={type:0,count:t.count,id:t.id},e.x=cc_launchX,e.y=cc_launchY,e},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[]},e.prototype.buy=function(t){if(this.canClicck){GlobalConfig.PActivityBtnConfig[this.activityID]?(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config):(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config);var e=this.config9[this.activityID][0],i=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,e.item);if(i&&i.count)this.ins.sendReward(this.activityID,2);else{var s=10;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.huntWarnFun.bind(this),"是否消耗"+e.yb*s+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+s)}}},e.prototype.huntWarnFun=function(){var t=this.config9[this.activityID][0];Actor.yb>=10*t.yb?this.ins.sendReward(this.activityID,2):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(LuckyResultWin.prototype,"LuckyResultWin"),ViewManager.ins().reg(LuckyResultWin,LayerManager.UI_Main);var FireworkerItemRender=function(t){function e(){var e=t.call(this)||this;return e._state=0,e.skinName="fireworkerItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.touchEnabled=2!=this.data.state,this.redPoint.visible=1==this.data.state,this.lingqu.visible=2==this.data.state;var t=0==this.data.state?16711680:65280;if(this.boxSchadule.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+(this.data.curTimes>this.data.times?this.data.times:this.data.curTimes)+"|/"+this.data.times),this.count.text=this.data.count,1==this.data.type){var e=GlobalConfig.ItemConfig[this.data.id];this.box.source=e.icon+"_png"}else this.box.source="richman_reward"},e}(BaseItemRender);__reflect(FireworkerItemRender.prototype,"FireworkerItemRender");var HighProjectItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="highProjectItemSkin",e.touchChildren=!1,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouch,e),e}return __extends(e,t),e.prototype.dataChanged=function(){this.projectName.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.data.config.name),this.jifen.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+this.data.config.score+"|积分");var t=Math.floor(this.data.times/this.data.config.target),e=Math.floor(this.data.config.dayLimit/this.data.config.target);t>e&&(t=e),this.daliyCount.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+t+"|/"+e)},e.prototype.onTouch=function(t){this.data.config.turn&&ViewManager.ins().open(this.data.config.turn[0],this.data.config.turn[1])},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(HighProjectItemRender.prototype,"HighProjectItemRender");var HighRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="highRewardItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this._listCollect=new ArrayCollection,this.list.dataProvider=this._listCollect,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.dataChanged=function(){this.count.text=this.data.config.score,this.currentState=2==this.data.state?"done":1==this.data.state?"kelingqu":"normal",this._listCollect.source=this.data.config.reward},e.prototype.onTouch=function(t){Activity.ins().sendReward(this.data.activityID,this.data.index,1)},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(HighRewardItemRender.prototype,"HighRewardItemRender");var NewYearWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="newYearWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList),this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller),this.removeObserve();for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn0.visible=!1,this.rightBtn0.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn0.visible=!0,this.rightBtn0.visible=!1):(this.leftBtn0.visible=!0,this.rightBtn0.visible=!0),this.leftRed0.visible=this.rightRed0.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn0.visible=!1,this.rightBtn0.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn0.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed0.visible=!0;break}if(this.rightBtn0.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed0.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];for(var e in Activity.ins().activityData)Activity.ins().activityData[e]&&Activity.ins().activityData[e].pageStyle==ActivityPageStyle.NEWYEAR&&Activity.ins().getActivityDataById(+e).isOpenActivity()&&!Activity.ins().getActivityDataById(+e).getHide()&&this._datas.push(Activity.ins().getbtnInfo(e));this._datas.sort(this.sort),t=0;for(var e in this._datas){var i=this._datas[e].id,s=Activity.ins().getActivityDataById(+i),n=ActivityPanel.create(i,s.activityType);n.top=0,n.left=0,n.bottom=0,n.right=0,this.activityPanelList[t]=n,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn0:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn0:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(NewYearWin.prototype,"NewYearWin"),ViewManager.ins().reg(NewYearWin,LayerManager.UI_Main);var NoticeListRenderer=function(t){function e(){var e=t.call(this)||this;return e.job=["","战士","法师","道士"],e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t="";switch(this.activityID=this.data.activityID,this.activityType=this.data.activityType,this.actType=this.data.actType,this.activityType){case ActivityDataFactory.ACTIVITY_TYPE_17:var e=GlobalConfig.ActivityType17_3Config[this.activityID],i=e[CommonUtils.getObjectLength(e)].group,s=GlobalConfig.ItemConfig[i[this.data.index-1].id],n=ItemConfig.getQualityColor(s),o=s.name;t="恭喜|C:0x16b2ff&T:"+this.data.name+"|在幸运星转盘中抽到了|C:"+n+"&T:"+o+" X"+i[this.data.index-1].count+"|";break;default:var a=this.data.name,r=this.data.index,h=void 0;if(this.actType==ActivityType.Normal?h=GlobalConfig.ActivityType9Config[this.activityID][r]:this.actType==ActivityType.Personal&&(h=GlobalConfig.PActivityType9Config[this.activityID][r]),h){var l="",c=ColorUtil.NORMAL_COLOR;if(h.reward[0].type){var u=GlobalConfig.ItemConfig[h.reward[0].id];l=u.name,c=ItemConfig.getQualityColor(u);var p=ItemConfig.getType(u);0==p&&u&&(l+=u.zsLevel>0?"("+u.zsLevel+"转 ":"("+u.level+"级 ",l+=this.job[ItemConfig.getJob(u)]+")"),t="<font color = '#12b2ff'>"+a+"</font> "+(this.data.des?this.data.des:"获得")+" <font color='"+c+"'>"+l+"</font>"}else{var d=1;switch(h.reward[0].id){case MoneyConst.yuanbao:d=5;break;case MoneyConst.gold:d=0;break;case MoneyConst.soul:d=2;break;case MoneyConst.piece:d=2;break;case MoneyConst.godweaponExp:d=2}l=RewardData.getCurrencyName(h.reward[0].id),c=ItemBase.QUALITY_COLOR[d],t="<font color = '#12b2ff'>"+a+"</font> 获得 <font color='"+c+"'>"+l+"</font>"}}}this.showText.textFlow=TextFlowMaker.generateTextFlow(t)},e}(BaseItemRender);NoticeListRenderer.QUALITY_COLOR=["#e2dfd4","#35e62d","#d242fb","#ff750f","#f3311e","#ffd93f"],__reflect(NoticeListRenderer.prototype,"NoticeListRenderer");var NoticeYBListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.name;this.activityID=this.data.activityID;var e=this.data.multiple,i=this.data.yb,s="",n="",o=ColorUtil.NORMAL_COLOR;n=RewardData.getCurrencyName(2),o=16711680,s="<font color = '#16b2ff'>"+t+"</font> 在元宝转盘中抽中了 <font color='"+o+"'>"+e+"</font>倍，获得<font color='"+o+"'>"+i+"</font>元宝",this.showText.textFlow=TextFlowMaker.generateTextFlow(s)},e}(BaseItemRender);__reflect(NoticeYBListRenderer.prototype,"NoticeYBListRenderer");var DailyRechargeItemRender=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._totalRecharge=0,e._activityID=0,e._index=0,e.skinName="DailyRechargeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){this._config=this.data[0],this._state=this.data[1],this._totalRecharge=this.data[2],this._activityID=this.data[3],this._index=this.data[4],this.target.text="累计充值"+this._config.val+"元宝",this.recharge.text="("+(this._totalRecharge>this._config.val?this._config.val:this._totalRecharge)+"/"+this._config.val+")",this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards),this.redPoint.visible=1==this._state,this.get.enabled=1==this._state,this.get.label=2==this._state?"已领取":1==this._state?"领取":"未完成"},e.prototype.onTap=function(t){this._config instanceof ActivityType3Config?Activity.ins().sendReward(this._activityID,this._index):this._config instanceof PActivity3Config&&PActivity.ins().sendReward(this._activityID,this._index)},e}(BaseItemRender);__reflect(DailyRechargeItemRender.prototype,"DailyRechargeItemRender");var DailyRechargePanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="DailyRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.content.itemRenderer=DailyRechargeItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.updateData()},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID]);var i,s=[],n=0,o=0;for(var a in e)i=e[a],o=t.recrod>>i.index&1?2:t.chongzhiTotal>=i.val?1:0,s[n]=[i,o,t.chongzhiTotal,this.activityID,i.index],n++;this.content.dataProvider=new eui.ArrayCollection(s),this._time=t.getLeftTime(),this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4))},e}(BaseView);__reflect(DailyRechargePanel.prototype,"DailyRechargePanel");var OSA3HeroesPanel=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s.skinName="OSA3Heroes",s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.active,this.onTap),this.observe(ThreeHeroes.ins().postInfoChange,this.updateData),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.active,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){t.currentTarget==this.active&&(ThreeHeroes.ins().awardState==ThreeHeroes.NotActive?ViewManager.ins().open(VipWin,[4]):ThreeHeroes.ins().awardState==ThreeHeroes.CanGet?ThreeHeroes.ins().sendReward():ThreeHeroes.ins().awardState==ThreeHeroes.Active&&UserTips.ins().showTips("再登陆"+(GlobalConfig.LoginActivateConfig.loginDays-ThreeHeroes.ins().loginDays)+"天可领取20000元宝"))},e.prototype.getTime=function(t){var e=(GlobalConfig.GuildBattleConst.openServer,new Date(t.startTime)),i=e.getMonth()+1+"月"+e.getDate()+"日-";e=new Date(t.endTime-1e3*DateUtils.SECOND_PER_DAY);var s=e.getMonth()+1+"月"+e.getDate()+"日23:59";return i+s},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=this.getTime(t);var s=ThreeHeroes.ins().awardState;this.active.enabled=s!=ThreeHeroes.Geted,this.redPoint.visible=s==ThreeHeroes.CanGet,s==ThreeHeroes.NotActive?this.active.label="激活":s==ThreeHeroes.CanGet||s==ThreeHeroes.Active?this.active.label="领取奖励":this.active.label="已领取";var n=GlobalConfig.ActivityBtnConfig[this.activityID];this.actInfo.text=n.acDesc,this.state.text=s==ThreeHeroes.Active?"再登陆"+(GlobalConfig.LoginActivateConfig.loginDays-ThreeHeroes.ins().loginDays)+"天可领取20000元宝":""},e}(BaseView);__reflect(OSA3HeroesPanel.prototype,"OSA3HeroesPanel");var OSADailyRechargeRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSADailyRechargeItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.getBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.info.text="累计充值"+e.pay+"元宝",this.reward.dataProvider=new eui.ArrayCollection(e.awardList.concat());var i=Recharge.ins().getRechargeData(0);if(i.curDayPay>=e.pay){var s=i.isAwards>>e.index&1;s?(this.getBtn.label="已领取",this.getBtn.enabled=!1):(this.getBtn.label="领取",this.getBtn.enabled=!0)}else this.getBtn.label="未完成",this.getBtn.enabled=!1},e.prototype.onTap=function(t){Recharge.ins().getDayReward(this.data.index)},e}(BaseItemRender);__reflect(OSADailyRechargeRender.prototype,"OSADailyRechargeRender");var OSARankTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSARankTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.arr=t[0],this.rankType=t[1],this.record.itemRenderer=OSATargetItemRender4,this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.init=function(){switch(this.rankType){case RankDataType.TYPE_BAOSHI:this.title.text="开服铸造榜";break;case RankDataType.TYPE_LONGHUN:this.title.text="开服龙魂榜";break;case RankDataType.TYPE_WING:this.title.text="开服翅膀榜";break;case RankDataType.TYPE_BOOK:this.title.text="开服图鉴榜";break;case RankDataType.TYPE_ZS:this.title.text="开服转生榜";break;case RankDataType.TYPE_SCORE:this.title.text="开服装备榜";break;case RankDataType.TYPE_HF_XIAOFEI:this.title.text="合服消费榜"}this.record.dataProvider=new eui.ArrayCollection(this.arr)},e.prototype.onClick=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(OSARankTipsWin.prototype,"OSARankTipsWin"),ViewManager.ins().reg(OSARankTipsWin,LayerManager.UI_Popup);var OSATarget0Panel=function(t){function e(){var e=t.call(this)||this;return e.type0PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initPanelList()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=this.activityID-1e4;this.initPanelList(),this.cruPanel=this.type0PanelList[i+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID],i=this.activityID-1e4;if(!this.type0PanelList[i+""]){var s=e.targetIndex[t.showType]||"OSATarget0Panel1",n=egret.getDefinitionByName(s);this.type0PanelList[i+""]=new n(this.activityID),this.type0PanelList[i+""].top=0,this.type0PanelList[i+""].bottom=0,this.type0PanelList[i+""].left=0,this.type0PanelList[i+""].right=0,this.type0PanelList[i+""].activityID=this.activityID}},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);OSATarget0Panel.targetIndex={1:"OSATarget0Panel1",2:"OSATarget0Panel2",3:"OSATarget0Panel3",4:"OSA3HeroesPanel",5:"HefuXunbaoPanel",6:"HefuAncientBossPanel",7:"HefuLCZBPanel",8:"OSATarget0Panel8",9:"OSATarget0Panel9",11:"OSATarget0Panel4"},__reflect(OSATarget0Panel.prototype,"OSATarget0Panel");var OSATarget0Panel1=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s.skinName="OSAComp",s.effs=[],s.rewards=[{type:1,id:900007,count:1},{type:1,id:900008,count:1},{type:1,id:900009,count:1},{type:0,id:2,count:2e4}],s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.go,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.go,this.onTap),this.removeObserve();for(var i=0;i<this.effs.length;i++)this.effs[i]&&DisplayUtils.removeFromParent(this.effs[i]);this.effs=[]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.go:0!=Guild.ins().guildID?(ViewManager.ins().close(ActivityWin),GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(GuildMap),ViewManager.ins().open(GuildWarMainWin)):UserTips.ins().showTips("还没加入行会")}},e.prototype.getTime=function(t){var e=GlobalConfig.GuildBattleConst.openServer,i=new Date(t.startTime-1e3*DateUtils.SECOND_PER_DAY);i.setDate(i.getDate()+e.day),i.setHours(e.hours,e.min||0,0,0);var s=i.getMonth()+1+"月"+i.getDate()+"日"+e.hours+":"+e.min+"-",n=e.hours+":"+(e.min+GlobalConfig.GuildBattleConst.continueTime/60),o=i.getDay(),a=["(周日)","(周一)","(周二)","(周三)","(周四)","(周五)","(周六)"];return s+n+a[Number(o)]},e.prototype.updateData=function(t){void 0===t&&(t=1);var e=Activity.ins().getActivityDataById(this.activityID),i=Math.floor(e.startTime/1e3-GameServer.serverTime/1e3),s=Math.floor(e.endTime/1e3-GameServer.serverTime/1e3);i>=0?(this.actTime.text="活动未开启",this.over.visible=!1):0>=s?(this.actTime.text="活动已结束",this.over.visible=!0):(this.over.visible=!1,this.actTime.text=this.getTime(e)),this.go.visible=!this.over.visible;for(var n=1;4>=n;n++)this["reward"+n].data=this.rewards[n-1];for(var n=1;3>=n;n++){var o="chuanqizbeff";if(!this.effs[n-1]||!this.effs[n-1].parent){var a=new MovieClip;a.x=this["reward"+n].width/2,a.y=this["reward"+n].height/2,a.y-=10,a.playFile(RES_DIR_EFF+o,-1),this["reward"+n].addChild(a),this.effs.push(a)}}},e}(BaseView);__reflect(OSATarget0Panel1.prototype,"OSATarget0Panel1");var OSATarget0Panel2=function(t){function e(){var e=t.call(this)||this;return e.skinName="Days42Recharge",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.content.useVirtualLayout=!0,this.content.itemRenderer=OSATargetDays42ItemRender,this.bigReward.itemRenderer=OSATargetDays42ItemRender2},e.prototype.open=function(){this.content.dataProvider?this.updateData():this.updateList(),this.observe(Recharge.ins().postRechargeTotalDay,this.updateData)},e.prototype.updateList=function(){var t=[],e=[],i=new RewardData;i.count=0,i.id=2,i.type=0;var s={id:100,awardList:[i]};e.push(s);var n=Recharge.ins().getRechargeList();for(var o in n){var a=n[o];t.push(a),i.id=a.awardList[0].id,i.type=a.awardList[0].type,i.count+=a.awardList[0].count,a.awardList.length>1&&e.push(a)}t.sort(this.sort),e.sort(this.sort2),this.content.dataProvider=new eui.ArrayCollection(t.splice(0,4)),this.delayUpdate(t),this.bigReward.dataProvider=new eui.ArrayCollection(e);var r=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=r.acDesc},e.prototype.delayUpdate=function(t){var e=this.content.dataProvider;e.addItem(t.shift()),t.length&&this.delayUpdate(t)},e.prototype.sort=function(t,e){var i=Recharge.ins().rechargeTotal.hasGetDays;return i.indexOf(t.id)>=0&&i.indexOf(e.id)<0?1:i.indexOf(t.id)<0&&i.indexOf(e.id)>=0?-1:t.id<e.id?-1:1},e.prototype.sort2=function(t,e){return t.id<e.id?1:-1},e.prototype.close=function(){this.removeObserve()},e.prototype.updateData=function(){var t=this.content.dataProvider;t.source.sort(this.sort);for(var e=0;e<t.length;e++)t.itemUpdated(t.getItemAt(e));t=this.bigReward.dataProvider;for(var e=0;e<t.length;e++)t.itemUpdated(t.getItemAt(e))},e}(BaseView);__decorate([callLater],OSATarget0Panel2.prototype,"delayUpdate",null),__reflect(OSATarget0Panel2.prototype,"OSATarget0Panel2");var OSATarget0Panel3=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="OSADailyRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.dailyReward.itemRenderer=OSADailyRechargeRender},e.prototype.open=function(){this.observe(Recharge.ins().postUpdateRechargeEx,this.updateList),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.initList()},e.prototype.updateData=function(){this.updateList()},e.prototype.updateList=function(){var t=this.dailyReward.dataProvider,e=t.source;e.sort(this.sort),t.refresh(),this.updateTime(),this.updateValue()},e.prototype.updateTime=function(){var t=new Date(GameServer.serverTime);t.setHours(23,59,59,0),this._time=Math.floor((t.getTime()-GameServer.serverTime)/1e3),this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);var e=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=e.acDesc},e.prototype.initList=function(){var t=Recharge.ins().getCurRechargeConfig(),e=[];for(var i in t)e.push(t[i]);e.sort(this.sort),this.dailyReward.dataProvider=new eui.ArrayCollection(e),this.updateTime(),this.updateValue()},e.prototype.updateValue=function(){var t=Recharge.ins().getRechargeData(0);this.record.text="已充值"+t.curDayPay+"元宝"},e.prototype.sort=function(t,e){var i=Recharge.ins().getRechargeData(0),s=i.isAwards>>t.index&1,n=i.isAwards>>e.index&1;return s&&!n?1:!s&&n?-1:t.pay<e.pay?-1:1},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e}(BaseView);__reflect(OSATarget0Panel3.prototype,"OSATarget0Panel3");var OSATarget0Panel4=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoopRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){this.setData(),this.observe(Recharge.ins().postMuchDayRecReward,this.setData)},e.prototype.close=function(){this.removeObserve()},e.prototype.setData=function(){var t=GlobalConfig.MultiDayRechargeConfig,e=0;for(var i in t[1].awardList){if(e<=GameServer.serverOpenDay&&GameServer.serverOpenDay<parseInt(i))break;e=parseInt(i)}var s=0,n=Recharge.ins().mDayNum;n=Recharge.ins().mRecNum>=t[n].num?Recharge.ins().mDayNum:Recharge.ins().mDayNum-1;for(var i in t){var o=t[i];this["reward"+s].itemRenderer=ItemBase,this["reward"+s].dataProvider=new eui.ArrayCollection(o.awardList[e]);var a=StringUtils.addColor("（"+(n>s+1?i:n)+"/"+i+"）",n>=parseInt(i)?65280:16750848);this["target"+s].textFlow=(new egret.HtmlTextParser).parser("累计"+i+"天"+a+"充值"+o.num+"元宝"),this["redPoint"+s].visible=!1,Recharge.ins().mDayNum>parseInt(i)?(this["get"+s],this["get"+s].enabled=!1):Recharge.ins().mDayNum==parseInt(i)&&Recharge.ins().mRecNum>=o.num&&0==Recharge.ins().mReward?(this["redPoint"+s].visible=!0,this["get"+s].label="立即领取",this["get"+s].enabled=!0,this.addTouchEvent(this["get"+s],this.onTap)):this["get"+s].enabled=!1,s++}this.todayRecharge.text="本日累计充值："+Recharge.ins().mRecNum;var r=Activity.ins().getbtnInfo(this.activityID);this.actInfo0.text=r.acDesc},e.prototype.onTap=function(){Recharge.ins().sendMuchDayRecReward()},e}(BaseView);__reflect(OSATarget0Panel4.prototype,"OSATarget0Panel4");var OSATarget0Panel8=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s._time=0,s.skinName="HeFuResetRechargeSkin",s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.pay0,this.onTap),this.updateData(),TimerManager.ins().doTimer(1e3,0,this.setTime,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.pay0:var e=Recharge.ins().getRechargeData(0);e&&e.num&&2==e.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win)}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime1.text="活动未开启":0>=i?this.actTime1.text="活动已结束":this.actTime1.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3);var s=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=s.title,this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(s.acDesc)},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(BaseView);__reflect(OSATarget0Panel8.prototype,"OSATarget0Panel8");var OSATarget0Panel9=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s._time=0,s._angles=[0,0,0,0,0,0,0],s._circleCenter={x:168,y:120},s._a=155,s._b=80,s._angle=.1,s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="XNWingUpSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.addTouchEvent(this.pay0,this.onTap),this.updateData(),TimerManager.ins().doTimer(1e3,0,this.setTime,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),TimerManager.ins().removeAll(this),this.resetBalls()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.pay0:var e=GlobalConfig.ActivityBtnConfig[this.activityID];if(!e.jump)return;switch(e.jump[0]){case StatePageSysType.WING:if(Actor.level<GlobalConfig.WingCommonConfig.openLevel)return void UserTips.ins().showTips("羽翼"+GlobalConfig.WingCommonConfig.openLevel+"级开启");ViewManager.ins().open(e.jump[1],e.jump[2],0);break;case StatePageSysType.RING:if(!LyMark.ins().checkOpen())return void UserTips.ins().showTips("烈焰戒指达到"+GlobalConfig.FlameStamp.openLevel+"级开启");ViewManager.ins().open(e.jump[1],e.jump[2]);break;default:ViewManager.ins().open(e.jump[1],e.jump[2])}}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3);var s=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=s.title,this.actInfo.textFlow=TextFlowMaker.generateTextFlow1(s.acDesc);var n=GlobalConfig.ActivityBtnConfig[this.activityID];switch(n.jump[0]){case StatePageSysType.RING:if(this.updateBalls(),this.redPoint.visible=!1,LyMark.ins().checkOpen()&&!LyMark.ins().isMax){var o=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv],a=UserBag.ins().getBagItemById(o.costItem),r=a?a.count:0;this.redPoint.visible=r>=o.costCount
}}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.updateBalls=function(){if(this.img&&this.img.parent){var t=7;if(t){this.resetBalls(),this._balls||(this._balls=[],TimerManager.ins().doTimer(51,0,this.doCircle,this)),this._circleCenter.x=this.img.width/2,this._circleCenter.y=this.img.height/2+25;for(var e=void 0,i=2*Math.PI/t,s=0;t>s;s++)e=ObjectPool.pop("MovieClip"),this.img.parent.addChild(e),this._angles[s]=i*s,e.x=this._a*Math.cos(i*s)+this._circleCenter.x,e.y=this._b*Math.sin(i*s)+this._circleCenter.y,this._balls.push(e),e.playFile(RES_DIR_EFF+"lymarkeff",-1)}}},e.prototype.doCircle=function(){if(!this._balls)return void TimerManager.ins().removeAll(this);if(this.img&&this.img.parent)for(var t,e,i=this._balls.length,s=0,n=0,o=0;i>o;o++)t=this._balls[o],t.x=this._a*Math.cos(this._angles[o])+this._circleCenter.x,t.y=this._b*Math.sin(this._angles[o])+this._circleCenter.y,this._angles[o]+=this._angle,this._angles[o]=this._angles[o]%(2*Math.PI),e=t.parent,s=e.getChildIndex(this.img),n=e.getChildIndex(t),this._angles[o]>=2.5&&this._angles[o]<=6?n>s&&e.addChildAt(t,3):s>n&&e.addChildAt(t,e.numChildren)},e.prototype.resetBalls=function(){if(TimerManager.ins().removeAll(this),this._balls){for(var t=this._balls.length,e=0;t>e;e++)this._balls[e].destroy(),this._balls[e]=null;this._balls.length=0,this._balls=null}},e}(BaseView);__reflect(OSATarget0Panel9.prototype,"OSATarget0Panel9");var OSATarget10Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.skinName||(this.skinName="YbTurntableSkin")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi);var i=Activity.ins().activityData[this.activityID];i&&i.state&&Activity.ins().sendReward(this.activityID,this.level),this.rolling=!1,this.isClick=!1,TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.skinName||(this.skinName="YbTurntableSkin"),this.observe(Activity.ins().postChangePage,this.resultCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeYBListRenderer,this.updateView()},e.prototype.updateView=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=GlobalConfig.ActivityType10Config[this.activityID];this.level=t.getLevel();var i=this.level,s=!1;this.level||(i=Object.keys(e).length,s=!0),this.img_level.source="trun_10000"+i;for(var n=e[i],o=0;o<n.info.length;o++)this["multiple"+o].text=n.info[o].multiple+"倍";this.pay0.text=n.yuanBao+"";var a=65280,r=0;t.yb<n.recharge&&(a=16711680,r=n.recharge-t.yb),s?this.label_needCharge.text="充值转盘全部抽取完毕":this.label_needCharge.textFlow=TextFlowMaker.generateTextFlow1("再充值|C:"+a+"&T:"+r+"|C:0x00ff00&T:元宝可激活"),this.listRefush(),this.setTime();var h=GlobalConfig.ActivityBtnConfig[this.activityID];h&&(this.title.source=h.title)}},e.prototype.resultCallBack=function(t){if(this.isClick){var e=Activity.ins().activityData[this.activityID];this.activityID==t&&(e&&e.state&&this.beginLottery(e.index),this.updateView(),this.listRefush())}},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,e.level),e.flyItemEx(e["multiple"+(t-1)]),setTimeout(function(){e.rolling=!1,e.isClick=!1},2e3)},this)},e.prototype.flyItemEx=function(t){var e=new eui.Image(RewardData.getCurrencyRes(2));e.x=t.x,e.y=t.y,e.scaleX=1,e.scaleY=1,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(!this.level)return UserTips.ins().showTips("充值转盘全部抽取完毕"),void(this.isClick=!1);var t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType10Config[this.activityID][this.level];return t&&!t.getCondition(this.level)?(UserTips.ins().showTips("还需要充值"+(e.recharge-t.yb)+"元宝激活"),void(this.isClick=!1)):this.rolling?void UserTips.ins().showTips("正在抽奖，请稍候"):this.isClick?void UserTips.ins().showTips("等待抽奖结果 请稍后"):void(Activity.ins().getRollSum(this.activityID)||Actor.yb>=e.yuanBao?(this.isClick=!0,Activity.ins().sendReward(this.activityID,this.level)):(UserTips.ins().showTips("元宝不足"),this.isClick=!1))},e.prototype.listRefush=function(){var t=Activity.ins().activityData[this.activityID];if(t){this.list.dataProvider||(this.list.dataProvider=new eui.ArrayCollection);for(var e=this.list.dataProvider,i=[],s=0;s<t.noticeArr.length;s++){var n={activityID:this.activityID,name:t.noticeArr[s].name,multiple:t.noticeArr[s].multiple,yb:t.noticeArr[s].yb};i.push(n)}e.replaceAll(i)}},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(ActivityPanel);__reflect(OSATarget10Panel.prototype,"OSATarget10Panel");var OSATarget11Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityType11_1Config[this.activityID];if(!this.type2PanelList[this.activityID]){var s=ObjectPool.pop("OSATarget11Panel"+i[1].showType,[this.activityID]);s.top=0,s.bottom=0,s.left=0,s.right=0,s.activityID=this.activityID,this.type2PanelList[this.activityID+""]=s}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget11Panel.prototype,"OSATarget11Panel");var OSATarget11Panel1=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="NYHighSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=HighRewardItemRender,this.projectList.itemRenderer=HighProjectItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin();var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=i.desc,this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=Object.keys(GlobalConfig.ActivityType11_1Config[this.activityID]).length,i=0,s=[];s.length=e;var n,o;for(o=1;e>=o;o++)n=GlobalConfig.ActivityType11_1Config[this.activityID][o],i=t.rewardInfo>>o&1?2:t.hiScore>=n.score?1:0,s[o-1]={activityID:this.activityID,index:o,state:i,config:n};this._rewardCollect||(this._rewardCollect=new ArrayCollection,this.rewardList.dataProvider=this._rewardCollect),this._rewardCollect.source=s,e=Object.keys(GlobalConfig.ActivityType11_2Config[this.activityID]).length;var a;s=[],s.length=e;var r=0;for(o=0;e>o;o++){var h=t.achieveInfo[o];a=GlobalConfig.ActivityType11_2Config[this.activityID][o+1],s[o]={config:a,times:h.times};var l=Math.floor(h.times/a.target),c=Math.floor(a.dayLimit/a.target);l>c&&(l=c),r+=a.score*l}this._achieveCollect||(this._achieveCollect=new ArrayCollection,this.projectList.dataProvider=this._achieveCollect),this._achieveCollect.source=s,this.totalScore.text="当前嗨积分:"+r,this.setTime()}},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.actTime1.text=t.getRemainTime())},e}(BaseView);__reflect(OSATarget11Panel1.prototype,"OSATarget11Panel1");var OSATarget11Panel3=function(t){function e(e){var i=t.call(this)||this;return i._curDayIndex=0,i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabD.itemRenderer=FDtabBtnItemRender,this.list.itemRenderer=FDProjectItemRender,this.rewardlist.itemRenderer=FDrewardItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this._curDayIndex=0,this.setAct22ID(),this.updateView(),this.tabD.selectedIndex=this._curDayIndex,this.updateData(),this.addTouchEvent(this,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds),this.addChangeEvent(this.tabD,this.onClickBtn),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.osa22Panel2&&(this.osa22Panel2.close(),DisplayUtils.removeFromParent(this.osa22Panel2))},e.prototype.setAct22ID=function(){this.activity22ID=0;for(var t in Activity.ins().activityData){var e=Activity.ins().activityData[t];if(e&&e.pageStyle==ActivityPageStyle.VERSIONCELE&&e.type==ActivityDataFactory.ACTIVITY_TYPE_22&&Activity.ins().getActivityDataById(+t).isOpenActivity()&&!Activity.ins().getActivityDataById(+t).getHide())return void(this.activity22ID=e.id)}},e.prototype.close=function(){this._btnCollect=null,this._listCollect=null},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="fiveDaySkin",this.actDesc&&(this.actDesc.text=t.desc)},e.prototype.updateView=function(){var t=Activity.ins().getActivityDataById(this.activityID);this._items=[];var e,i,s,n,o=GlobalConfig.ActivityType11_2Config[this.activityID],a=[];for(var r in o)e=o[r],s=e.group,i=this._items[s-1],i||(i=[],this._items[s-1]=i,a.push({gName:e.gName,showRed:!1})),n=t.achieveInfo[e.index-1],!n.isGot&&n.times>=e.dayLimit&&(a[s-1].showRed=!0),i.push(e);this._btnCollect||(this._btnCollect=new ArrayCollection,this.tabD.dataProvider=this._btnCollect),this._btnCollect.source=a,this.tabD.validateNow();var h=Activity.ins().activityData[this.activity22ID];this.redPointImg.visible=ActivityType11Data.FIRST_OPEN_SHOP||h.refreshFree},e.prototype.refreshReds=function(){this.updateView(),this.updateData()},e.prototype.updateData=function(){var t=this._items[this._curDayIndex];if(t&&t.length){this._listCollect||(this._listCollect=new ArrayCollection,this.list.dataProvider=this._listCollect);for(var e,i,s=t.length,n=[],o=0,a=Activity.ins().getActivityDataById(this.activityID),r=0;s>r;r++)e=t[r],i=a.achieveInfo[e.index-1],o=i.isGot?2:i.times>=e.dayLimit?1:0,n[r]={activityID:this.activityID,conf:e,state:o,times:i.times};n.sort(this.sort),this._listCollect.source=n,s=Object.keys(GlobalConfig.ActivityType11_1Config[this.activityID]).length;var h=[];h.length=s;var l,c;for(c=1;s>=c;c++)l=GlobalConfig.ActivityType11_1Config[this.activityID][c],o=a.rewardInfo>>c&1?2:a.hiScore>=l.score?1:0,h[c-1]={activityID:this.activityID,index:c,state:o,config:l};this._rewardCollect||(this._rewardCollect=new ArrayCollection,this.rewardlist.dataProvider=this._rewardCollect),this._rewardCollect.source=h,this.totalScore.text=a.hiScore+""}},e.prototype.sort=function(t,e){return 1==t.state&&1!=e.state?-1:1!=t.state&&1==e.state?1:2==t.state&&2!=e.state?1:t.conf.index<e.conf.index?-1:t.conf.index>e.conf.index?1:0},e.prototype.onTouch=function(t){switch(t.target){case this.shopBtn:this.osa22Panel2||(this.osa22Panel2=ObjectPool.pop("OSATarget22Panel2",[this.activity22ID]),this.osa22Panel2.top=0,this.osa22Panel2.bottom=0,this.osa22Panel2.left=0,this.osa22Panel2.right=0),this.osa22Panel2.activityID=this.activity22ID,this.parent.addChild(this.osa22Panel2),this.osa22Panel2.open(),this.close(),DisplayUtils.removeFromParent(this),ActivityType11Data.FIRST_OPEN_SHOP=!1,Activity.ins().postActivityIsGetAwards()}},e.prototype.onClickBtn=function(t){this._curDayIndex!=t.currentTarget.selectedIndex&&(this._curDayIndex=t.currentTarget.selectedIndex,this.updateData())},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.actTime.text=t.getRemainTime());var e=Activity.ins().activityData[this.activity22ID];if(e){var i=e.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(i>0?i:0,DateUtils.TIME_FORMAT_1,5)+"后刷新"}else this.refreshTime.text="00:00:00后刷新"},e}(BaseView);__reflect(OSATarget11Panel3.prototype,"OSATarget11Panel3");var OSATarget12Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityType12Config[this.activityID];if(!this.type2PanelList[this.activityID+""]){var s=ObjectPool.pop("OSATarget12Panel"+i[1].showType);s.top=0,s.bottom=0,s.left=0,s.right=0,s.activityID=this.activityID,s.activityType=this.activityType,this.type2PanelList[this.activityID+""]=s}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget12Panel.prototype,"OSATarget12Panel");var OSATarget12Panel1=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="XNHongBaoSkin"},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this),this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postChangePage,this.updateLogs),this.addTouchEvent(this.onbtn,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.dataArr||(this.list.itemRenderer=XiaoNianListRenderer,this.dataArr=new eui.ArrayCollection,this.list.dataProvider=this.dataArr),this.index=this.getRuleIndex(),this.updateData(),this.updateLogs()},e.prototype.getRuleIndex=function(){var t=1,e=Activity.ins().getActivityDataById(this.activityID);for(var i in GlobalConfig.ActivityType12Config[this.activityID])e.score>=GlobalConfig.ActivityType12Config[this.activityID][i].score&&(t=GlobalConfig.ActivityType12Config[this.activityID][i].index);return t},e.prototype.GetCallBack=function(t){t==this.activityID&&this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.onbtn:var e=Activity.ins().getActivityDataById(this.activityID);if(!e.isOpenActivity())return void UserTips.ins().showTips("活动已结束");var i=GlobalConfig.ActivityType12Config[this.activityID];i&&i[this.index]&&(e.score>=i[this.index].score?ViewManager.ins().open(HongBaoSpeak,this.activityID,this.index):UserTips.ins().showTips("积分不足"));break;case this.leftBtn:if(this.index<=1)return;this.index--,this.updateBtn();break;case this.rightBtn:if(this.index>=CommonUtils.getObjectLength(GlobalConfig.ActivityType12Config[this.activityID]))return;this.index++,this.updateBtn()}},e.prototype.updateBtn=function(){1==this.index?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.index==CommonUtils.getObjectLength(GlobalConfig.ActivityType12Config[this.activityID])?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):this.leftBtn.visible=this.rightBtn.visible=!0;var t=GlobalConfig.ActivityType12Config[this.activityID][this.index];this.hongbao.data=t.skinType;var e=Activity.ins().getActivityDataById(this.activityID);this.redPoint.visible=e.score>=t.score},e.prototype.updateLogs=function(){var t=[],e=Activity.ins().getActivityDataById(this.activityID);this.actPoint.text=e.score+"";for(var i=e.logs.length-1;i>=0;i--){var s=GlobalConfig.ActivityType12Config[this.activityID][e.logs[i].index],n="s"+e.logs[i].serverId+"."+e.logs[i].name,o=StringUtils.replace(s.record,n);t.push(o)}this.dataArr.replaceAll(t)},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID],i=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),s=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);i>=0?this.actTime.text="活动未开启":0>=s?this.actTime.text="活动已结束":(this._time=s,this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_5,3)),this.actInfo.text=e.desc,this.updateBtn()},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(BaseView);__reflect(OSATarget12Panel1.prototype,"OSATarget12Panel1");var OSATarget17Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.panelList=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.showPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.curPanel&&this.curPanel.close()},e.prototype.showPanel=function(t){if(void 0===t&&(t=1),!this.panelList[t]){var e=egret.getDefinitionByName("OSATarget17Panel"+t);this.panelList[t]=new e,this.panelList[t].top=0,this.panelList[t].bottom=0,this.panelList[t].left=0,this.panelList[t].right=0,this.panelList[t].activityID=this.activityID,this.panelList[t].showPanel=this.showPanel.bind(this)}this.curPanel&&(this.curPanel.close(),DisplayUtils.removeFromParent(this.curPanel)),this.curPanel=this.panelList[t],this.curPanel.open(),this.addChild(this.curPanel)},e.prototype.updateData=function(){this.curPanel&&this.curPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget17Panel.prototype,"OSATarget17Panel");var OSATarget17Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyStarSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.$onClose(),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.luckyzp,this.gotoLuckTurn),this.addTouchEvent(this.help,this.openHelp),this.updateData(),this.refRedpoint()},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=GlobalConfig.ActivityType17_1Config[this.activityID];this.inte.text=t.score+"",this.recharge.text=t.curRecharge+"",this.endtime.text=t.overDay+"天";var i=0;for(var s in t.actStar){i+=t.actStar[s]*e[s].score;for(var n=1;n<=e[s].star;n++){var o=10>n?"0"+n:n+"";n<=t.actStar[s]?this["star"+(parseInt(s)-1)+o].source="star"+(parseInt(s)+3):this["star"+(parseInt(s)-1)+o].source="star1"}}var a=0;for(var r in e)a+=e[r].score*e[r].star;this.accinte.text=i+"/"+a}},e.prototype.gotoLuckTurn=function(){this.showPanel&&this.showPanel(2)},e.prototype.openHelp=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[26].text)},e.prototype.refRedpoint=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.redPoint.visible=t.checkRedPoint())},e}(ActivityPanel);__reflect(OSATarget17Panel1.prototype,"OSATarget17Panel1");var OSATarget17Panel2=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableSkin2",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),TimerManager.ins().removeAll(this),this.rolling=!1,this.isClick=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postRewardResult,this.resultCallBack),this.addTouchEvent(this.choujiangBtn,this.startLottery),this.addTouchEvent(this.back,this.gotoHome),this.list.itemRenderer=NoticeListRenderer,this.updateView(),this.updateData()},e.prototype.updateView=function(){for(var t=Activity.ins().activityData[this.activityID],e=(GlobalConfig.ActivityType17_2Config[this.activityID],GlobalConfig.ActivityType17_3Config[this.activityID]),i=e[CommonUtils.getObjectLength(e)].group,s=i.length,n=0;s>n;n++)this["item"+n].itemIcon.data=i[n],this["item"+n].rewardState(t.recrod>>n+1&1);this.listRefush();var o=GlobalConfig.ActivityBtnConfig[this.activityID];o&&(this.title.source=o.title)},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];this.inte.text="当前积分 "+t.score},e.prototype.resultCallBack=function(t){if(Activity.ins().isSuccee&&this.isClick&&this.activityID==t){var e=Activity.ins().activityData[this.activityID],i=e.awardIndex;i&&this.beginLottery(i),this.updateView(),this.listRefush()}},e.prototype.beginLottery=function(t){var e=this,i=1440+30*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,0),Activity.ins().isSuccee=!1,e.flyItemEx(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1,e.isClick=!1},2e3)},this)},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.itemIcon.getItemSoure());e.x=t.x,e.y=t.y,e.scaleX=1,e.scaleY=1,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.startLottery=function(){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType17_2Config[this.activityID];return this.rolling?void UserTips.ins().showTips("正在抽奖，请稍候"):this.isClick?void UserTips.ins().showTips("等待抽奖结果 请稍后"):void(Activity.ins().getRollSum(this.activityID)||t.score>=e.score?(this.isClick=!0,Activity.ins().sendReward(this.activityID,1)):(UserTips.ins().showTips("积分不够"),this.isClick=!1))},e.prototype.listRefush=function(){var t=Activity.ins().activityData[this.activityID];if(t){for(var e=[],i=0;i<t.noticeArr.length;i++){var s={activityID:this.activityID,activityType:ActivityDataFactory.ACTIVITY_TYPE_17,name:t.noticeArr[i].name,index:t.noticeArr[i].index};e.push(s)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.gotoHome=function(){this.showPanel&&this.showPanel(1)},e}(ActivityPanel);__reflect(OSATarget17Panel2.prototype,"OSATarget17Panel2");var OSATarget18Panel=function(t){function e(){var e=t.call(this)||this;return e.typePanelList=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityType18Config[this.activityID];if(!this.typePanelList[this.activityID]){var s=i[0].showType||1,n=ObjectPool.pop("OSATarget18Panel"+s,[this.activityID]);n.top=0,n.bottom=0,n.left=0,n.right=0,n.activityID=this.activityID,this.typePanelList[this.activityID+""]=n}this.cruPanel=this.typePanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget18Panel.prototype,"OSATarget18Panel");var OSATarget18Panel1=function(t){function e(e){var i=t.call(this)||this;return i.addBoxEvent=!1,i.huntType=1,i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="CETreasureSkin"},e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){for(var t,e=GlobalConfig.ActivityType18Config[this.activityID],i=e[0],s=i.showDrop.length,n=0;s>n&&16>n;n++)t=this["gift"+n],t.data=i.showDrop[n],1>=n&&t.setItemHeirloomBgImg(!0,"csbk03");this.list.itemRenderer=HuntListRenderer,this.jpList.itemRenderer=HuntListRenderer;for(var o in e)1==e[o].count?this.yb1.text=e[o].yb+"":10==e[o].count&&(this.yb10.text=e[o].yb+"")},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.observe(Activity.ins().postChangePage,this.updateData);var i=Activity.ins().getActivityDataById(this.activityID);this.endedTime=i.getLeftTime(),this.timeClock(),TimerManager.ins().remove(this.timeClock,this),TimerManager.ins().doTimer(1e3,0,this.timeClock,this),this.addBoxEvent=!0,Activity.ins().sendChangePage(this.activityID)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buy1,this.onBuy),this.removeTouchEvent(this.buy10,this.onBuy),this.removeObserve(),TimerManager.ins().remove(this.timeClock,this),this.addBoxEvent=!1},e.prototype.updateData=function(){this.listRefush(),this.updateBox(),this.updateMaterial()},e.prototype.timeClock=function(){this.endedTime>=0&&(this.leftTimeTxt.text=DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)),this.endedTime-=1},e.prototype.listRefush=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.list.dataProvider=new eui.ArrayCollection(t.logs),this.jpList.dataProvider=new eui.ArrayCollection(t.bestlogs)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(1);break;case this.buy10:this.buyHunt(2)}},e.prototype.buyHunt=function(t){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);this.huntType=t;var e=GlobalConfig.ActivityType18Config[this.activityID],i=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,e[t].item);if(i&&i.count)Activity.ins().sendReward(this.activityID,t);else{var s=t>1?10:1,n=e[t].yb;HuntWarnBuyWin.showBuyWarn("OSATarget18Panel1-HuntResultWin"+(10==s?1:0),this.huntWarnFun.bind(this),"是否消耗"+n+"元宝购买"+GlobalConfig.ItemConfig[e[t].item].name+"*"+s)}},e.prototype.huntWarnFun=function(){var t=GlobalConfig.ActivityType18Config[this.activityID][this.huntType].yb;Actor.yb>=t?Activity.ins().sendReward(this.activityID,this.huntType):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.updateBox=function(){var t=GlobalConfig.ActivityType18Config[this.activityID],e=[];for(var i in t)t[i].dbCount&&e.push(t[i]);e.sort(function(t,e){return t.dbCount<e.dbCount?-1:1});var s,n,o=Activity.ins().getActivityDataById(this.activityID),a=0,r=e.length,h=0;for(var l in e){if(n=e[l],this["time"+a].text=n.dbCount+"次",this["time"+a].visible=!0,this["done"+a].visible=!1,this["boxPoint"+a].visible=!1,this["bar"+a].value=0,this["bar"+a].maximum=100,this["box"+a].source="200116_0_png",this["box"+a].name="box"+n.index,this.addBoxEvent||this.addTouchEvent(this["box"+a],this.onGetAward),r>a)if(s=o.getStateByIndex(n.index),2==s)this["box"+a].source="200116_png",this["bar"+a].value=100,this["boxPoint"+a].visible=!0;else if(1==s)this["time"+a].visible=!1,this["done"+a].visible=!0,this["bar"+a].value=100;else{var c=Math.floor((o.num-h)/(n.dbCount-h)*100);0>c?c=0:c>100&&(c=100),this["bar"+a].value=c}h=n.dbCount,a++}this.icon10.source=this.icon1.source=GlobalConfig.ItemConfig[t[1].item].icon+"_png"},e.prototype.onGetAward=function(t){var e=t.target.name.slice(3,4),i=Activity.ins().getActivityDataById(this.activityID),s=i.getStateByIndex(e);2==s?Activity.ins().sendReward(this.activityID,e):ViewManager.ins().open(HuntBoxsTips,e,3,this.activityID)},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagGoodsByTypeAndId(0,GlobalConfig.ActivityType18Config[this.activityID][1].item),e=t?t.count:0;this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(e?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|"),this.num10.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(e>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|")},e}(BaseView);__reflect(OSATarget18Panel1.prototype,"OSATarget18Panel1");var OSATarget19Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.panelList=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.showPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.curPanel&&this.curPanel.close()},e.prototype.showPanel=function(){var t=GlobalConfig.ActivityType19Config[this.activityID];if(t){var e=t[1].showType;if(!this.panelList[e]){var i=egret.getDefinitionByName("OSATarget19Panel"+e);this.panelList[e]=new i,this.panelList[e].top=0,this.panelList[e].bottom=0,this.panelList[e].left=0,this.panelList[e].right=0,this.panelList[e].activityID=this.activityID,this.panelList[e].showPanel=this.showPanel.bind(this)}this.curPanel&&(this.curPanel.close(),DisplayUtils.removeFromParent(this.curPanel)),this.curPanel=this.panelList[e],this.curPanel.open(),this.addChild(this.curPanel)}},e.prototype.updateData=function(){this.curPanel&&this.curPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget19Panel.prototype,"OSATarget19Panel");var OSATarget19Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostWinSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panelArr[this.curSelectIndex].close(),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.onTabTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.updateRedPoint);var i=GlobalConfig.ActivityType19Config[this.activityID][1];this.costTarget.activityType=ActivityType.Normal,this.costTarget.activityID=i.activityID,this.panelArr=[this.ranking,this.costTarget,this.reward],this.setSelectedIndex(0),this.updateRedPoint()},e.prototype.onTabTouch=function(t){this.panelArr[this.curSelectIndex].close();var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.panelArr[t].open(this.activityID),this.viewStack.selectedIndex=t},e.prototype.updateRedPoint=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.redPoint1.visible=t.canReward()},e.prototype.updateData=function(){},e}(BaseView);__reflect(OSATarget19Panel1.prototype,"OSATarget19Panel1");var OSATarget19PanelAct1=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostTargetSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.maskGroup,this.onClick),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.activityID=t[0],Activity.ins().sendChangePage(this.activityID)
},e.prototype.onClick=function(t){switch(t.currentTarget){case this.maskGroup:if(this.state==Activity.CanGet)Activity.ins().sendReward(this.activityID,this.index);else{var e=GlobalConfig.ActivityType1Config[this.activityID][this.index],i=0;switch(e.showType){case ShowType.XIAOFEI:var s=Activity.ins().getActivityDataById(this.activityID);s.hFTotalConsumption<e.consumeYuanbao&&(i=e.consumeYuanbao-s.hFTotalConsumption)}if(!i)return void Activity.ins().sendReward(this.activityID,this.index);e.showType==ShowType.XIAOFEI&&UserTips.ins().showTips("再消费"+i+"之后即领取奖励")}}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t){if(!t.isOpenActivity())return void UserTips.ins().showTips("异常:跨服达标领取活动结束!");var e=GlobalConfig.ActivityType1Config[this.activityID];this.index=this.getRuleIndex(),this.reward.data=e[this.index].rewards[0],this.reward.setImgBg1(),this.reward.hideName(),this.reward.clearEffect(),this.reward.showNum(!1),this.cost.text=t.hFTotalConsumption+"",this.target.text="/"+e[this.index].consumeYuanbao}},e.prototype.getRuleIndex=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType1Config[this.activityID],i=1;for(var s in e){var n=e[s];t.getRewardStateById(n.index);var o=t.getRewardStateById(n.index),a=t.rewardsSum[n.index],r=n.total?n.total-a:1;switch(this.state=o,i=n.index,o){case Activity.NotReached:break;case Activity.CanGet:0>=r?this.state=Activity.NotReached:this.state=Activity.CanGet;break;case Activity.Geted:}if(this.state==Activity.CanGet){this.currentState="can";break}if(this.state==Activity.NotReached){this.currentState="cannot";break}}return this.state==Activity.Geted&&(this.currentState="already"),this.validateNow(),i},e}(BaseComponent);__reflect(OSATarget19PanelAct1.prototype,"OSATarget19PanelAct1");var OSATarget1Panel=function(t){function e(e){var i=t.call(this)||this;return i._time=0,i}return __extends(e,t),e.prototype.setCurSkin=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="OSATarget1"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.content.itemRenderer=OSATargetItemRenderer;var i;this.activityType==ActivityType.Normal?i=Activity.ins():this.activityType==ActivityType.Personal&&(i=PActivity.ins()),this.observe(i.postRewardResult,this.GetCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData()},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e,i;this.activityType==ActivityType.Normal?(e=Activity.ins(),i=e.getActivityDataById(this.activityID)):this.activityType==ActivityType.Personal&&(e=PActivity.ins(),i=e.getActivityDataById(this.activityID)),e.isSuccee||(UserBag.ins().getSurplusCount()?(UserTips.ins().showTips("领取失败"),e.sendChangePage(i.id)):UserTips.ins().showTips("背包已满")),e.isSuccee=!1,this.updateData()}},e.prototype.updateData=function(){this.listData||(this.listData=new ArrayCollection,this.content.dataProvider=this.listData);var t,e,i,s;this.activityType==ActivityType.Normal?(t=Activity.ins(),e=t.getActivityDataById(this.activityID),i=GlobalConfig.ActivityType1Config[e.id],s=GlobalConfig.ActivityConfig):this.activityType==ActivityType.Personal&&(t=PActivity.ins(),e=t.getActivityDataById(this.activityID),i=GlobalConfig.PActivityType1Config[e.id],s=GlobalConfig.PActivityConfig);var n=Math.floor((DateUtils.formatMiniDateTime(e.startTime)-GameServer.serverTime)/1e3),o=Math.floor((DateUtils.formatMiniDateTime(e.endTime)-GameServer.serverTime)/1e3);n>=0?this.actTime0.text="活动未开启":0>=o?this.actTime0.text="活动已结束":(this._time=o,this._time<0&&(this._time=0),this.actTime0.text=DateUtils.getFormatBySecond(o,DateUtils.TIME_FORMAT_5,3)),this.actInfo0.text=s[this.activityID].desc;var a=[];for(var r in i)a.push(i[r]);a=a.slice();for(var h=[],l=[],c=0;c<a.length;c++){var u=e.getRewardStateById(a[c].index);u==Activity.Geted?l.push(a[c]):h.push(a[c])}if(a[0].showType==ShowType.LEVEL){var p=[],d=[];d=this.sortLevelList(h),p=this.sortLevelList(l),a=d.concat(p),this.listData.replaceAll(a)}else h.sort(this.sortFunc),l.sort(this.sortFunc),a=h.concat(l),this.listData.replaceAll(a);var g=t.getbtnInfo(this.activityID.toString());this.title.source=g.title,this.setDesc(e)},e.prototype.setDesc=function(t){var e;this.activityType==ActivityType.Normal?e=GlobalConfig.ActivityType1Config[t.id][1]:this.activityType==ActivityType.Personal&&(e=GlobalConfig.PActivityType1Config[t.id][1]);var i="",s="";switch(e.showType){case ShowType.LEVEL:i="我的等级:",e.zslevel&&(s+=UserZs.ins().lv+"转"),e.level&&(s+=Actor.level+"级");break;case ShowType.WING:i="我的翅膀等阶:",s=WingsData.getWingAllLevel()+"";break;case ShowType.ZHUZAO:i="我的铸造等级:",s=Role.getAllForgeLevelByType(PackageID.Zhuling)+"";break;case ShowType.LONGHUN:i="我的龙魂等级:",s=LongHunData.getLongHunAllLevel()+"";break;case ShowType.BOOK:var n=Book.ins().getBookPowerNumEx();i="我的图鉴战力:",s=n+"";break;case ShowType.EQUIP:i="我的装备评分:",s=UserBag.ins().getEquipsScoreByRolesOfBody()+"";break;case ShowType.XIAOFEI:i="我的消费:",s=t.hFTotalConsumption+"";break;case ShowType.RING:i="我的烈焰戒指等级:";var o=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),a=SpecialRing.ins().getRingStair(o.level),r=SpecialRing.ins().getRingStar(o.level);s=a+"阶"+r+"星";break;case ShowType.SAMSARA:i="我的轮回等级:";var h=SamsaraModel.ins().getSamsara(Actor.samsaraLv),l=SamsaraModel.ins().getSamsaraLv(Actor.samsaraLv);s=Actor.samsaraLv+" "+SamsaraModel.ins().getSamsaraDesc(h)+"·"+SamsaraModel.ins().getSamsaraLvDesc(l);break;case ShowType.ZHANLING:i="我的战灵等阶:";var c=ZhanLingModel.ins().getZhanLingDataByLevel(0);s=Math.ceil(c/10)+"阶"+(c%10==0?c?10:0:c%10)+"星"}this.attr.text=i,this.myAttrValue.text=s},e.prototype.sortLevelList=function(t){for(var e=[],i=[],s=[],n=0;n<t.length;n++)t[n].zslevel?s.push(t[n]):i.push(t[n]);return i.sort(this.sortFunc),s.sort(this.sortFunc),e=i.concat(s)},e.prototype.sortFunc=function(t,e){var i;i=GlobalConfig.PActivityBtnConfig[t.Id]?PActivity.ins().getActivityDataById(t.Id):Activity.ins().getActivityDataById(t.Id);i.getRewardStateById(t.index),i.getRewardStateById(e.index);if(t.showType==ShowType.LEVEL){if(t.zslevel<e.zslevel)return-1;if(t.zslevel>e.zslevel)return 1;if(t.level<e.level)return-1;if(t.level>e.level)return 1}if(t.showType==ShowType.WING){if(t.wingLv<e.wingLv)return-1;if(t.wingLv>e.wingLv)return 1}if(t.showType==ShowType.ZHUZAO){if(t.zzLv<e.zzLv)return-1;if(t.zzLv>e.zzLv)return 1}if(t.showType==ShowType.LONGHUN){if(t.lhLv<e.lhLv)return-1;if(t.lhLv>e.lhLv)return 1}if(t.showType==ShowType.BOOK){if(t.tjPower<e.tjPower)return-1;if(t.tjPower>e.tjPower)return 1}if(t.showType==ShowType.EQUIP){if(t.equipPower<e.equipPower)return-1;if(t.equipPower>e.equipPower)return 1}if(t.showType==ShowType.XIAOFEI){if(t.consumeYuanbao<e.consumeYuanbao)return-1;if(t.consumeYuanbao>e.consumeYuanbao)return 1}if(t.showType==ShowType.SAMSARA){if(t.lunhLv<e.lunhLv)return-1;if(t.lunhLv>e.lunhLv)return 1}if(t.showType==ShowType.ZHANLING){if(t.zhanlingLv<e.zhanlingLv)return-1;if(t.zhanlingLv>e.zhanlingLv)return 1}return 0},e}(ActivityPanel);__reflect(OSATarget1Panel.prototype,"OSATarget1Panel");var OSATarget20Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="LaBaBossSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap),TimerManager.ins().remove(this.setTime,this)},e.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap),this.initData(),TimerManager.ins().doTimer(1e3,0,this.setTime,this)},e.prototype.initData=function(){this.rewardList.itemRenderer=ItemBase,this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goBtn:var e=Activity.ins().getActivityDataById(this.activityID);if(e.IsEnd())return void UserTips.ins().showTips("已经全部消灭，请期待下次！");e.go2BossFb()?Activity.ins().sendReward(this.activityID,e.index):UserTips.ins().showTips("未到刷新时间")}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(DateUtils.formatMiniDateTime(t.startTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND),i=Math.floor(DateUtils.formatMiniDateTime(t.endTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);e>=0?(this.actTime.text="活动未开启",this.readyTime=0):0>=i?(this.actTime.text="活动已结束",this.readyTime=0):(this._time=i,this._time<0&&(this._time=0),this.readyTime=t.getStartTimer(),this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3));var s=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(s.desc),this.redPoint.visible=t.checkRedPoint();var n=GlobalConfig.ActivityType20Config[this.activityID][t.index];n&&(this.rewardList.dataProvider=new eui.ArrayCollection(n.showReward)),this.playModel(),this.setDate()},e.prototype.setDate=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t.IsEnd())return void(this.time.text="今天已全部消灭，请期待下次！");var e=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND),i=t.getEndTimer();if(e>=i)return void(this.time.text="已结束");var s=t.getStartTimer();if(e>=s&&i>e)return void(this.time.text="BOSS已出现，请前往击杀！");var n=GlobalConfig.ActivityType20Config[this.activityID][t.index],o=GlobalConfig.MonstersConfig[n.monsterId.id],a=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_6);this.time.text=o.name+"将在"+a+"后出现"},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.playModel=function(){this.bossModel||(this.bossModel=new MovieClip),this.bossModel.parent||this.Boss.addChild(this.bossModel);var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType20Config[this.activityID][t.index];e&&(this.bossModel.playFile(RES_DIR_MONSTER+e.monsterId.monster,-1),this.bossModel.scaleX=this.bossModel.scaleY=e.monsterId.scale/100)},e}(ActivityPanel);__reflect(OSATarget20Panel.prototype,"OSATarget20Panel");var OSATarget22Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityType22_1Config[this.activityID];if(!this.type2PanelList[this.activityID]){var s=ObjectPool.pop("OSATarget22Panel"+i[1].showType,[this.activityID]);s.top=0,s.bottom=0,s.left=0,s.right=0,s.activityID=this.activityID,this.type2PanelList[this.activityID+""]=s}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget22Panel.prototype,"OSATarget22Panel");var OSATarget22Panel1=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="activityStoreSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goodsOverView.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.goodsOverView.text),this.listView.itemRenderer=ActivityStoreItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin();var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo0.text=i.desc,this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.observe(UserBag.ins().postItemDel,this.updateMaterial),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this,this.onTouch),this.currentState="activityStore",this.updateData(),this.updateMaterial()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTouch),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.activityID][1].freshItem),e=t?t.count:0;if(this.refreshItemNum.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e?65280:16711680)+"&T:"+e),this._isEnough=e>0,"activityStore"==this.currentState){var i=Activity.ins().activityData[this.activityID];this.redPoint1.visible=i.refreshFree||this._isEnough}},e.prototype.updateData=function(){this._collect||(this._collect=new ArrayCollection,this.listView.dataProvider=this._collect);for(var t=Activity.ins().activityData[this.activityID],e=[],i="activityStore"==this.currentState?t.shopItems:t.scoreItems,s=i?i.length:0,n=0;s>n;n++)e.push({data:i[n],isScore:"integralStore"==this.currentState,activityID:this.activityID});if(this._collect.source=e,"activityStore"==this.currentState){this.costGroup.visible=!t.refreshFree,this.price.text=GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice+"",this.refreshShopBtn.label=t.refreshFree?"免费刷新":"刷   新",this.redPoint1.visible=t.refreshFree||this._isEnough;var o=Activity.ins().getConfig22_3(this.activityID);this.redPoint0.visible=o&&t.tScore>=o.score}this.integralNum.text=t.tScore+"";var a=GlobalConfig.ItemConfig[GlobalConfig.ActivityType22_1Config[this.activityID][1].freshItem];this.refreshItem.source=a?a.icon+"_png":""},e.prototype.onTouch=function(t){switch(t.target){case this.goodsOverView:ViewManager.ins().open(ActivityStoreRewardShowWin,this.activityID);break;case this.integralStoreBtn:this.currentState="integralStore"==this.currentState?"activityStore":"integralStore",this.updateData();break;case this.refreshShopBtn:var e=Activity.ins().activityData[this.activityID];e.refreshFree?Activity.ins().sendReward(this.activityID,0,5,0):Actor.yb<GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice&&!this._isEnough?UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):Activity.ins().sendReward(this.activityID,0,5,0)}},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];this.actTime0.text=t.getRemainTime();var e=t.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(e>0?e:0,DateUtils.TIME_FORMAT_1,5)},e}(BaseView);__reflect(OSATarget22Panel1.prototype,"OSATarget22Panel1");var OSATarget22Panel2=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="FDStoreSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listView.itemRenderer=FDstoreItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.observe(UserBag.ins().postItemDel,this.updateMaterial),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this,this.onTouch),this.updateData(),this.updateMaterial(),this.setTime()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.removeTouchEvent(this,this.onTouch),this.removeObserve(),TimerManager.ins().removeAll(this),this.objList){for(var i=void 0,s=0;s<this.objList.length;s++)i=this.objList.shift(),egret.Tween.removeTweens(i),DisplayUtils.removeFromParent(i);this.objList=null}},e.prototype.updateData=function(){this._collect||(this._collect=new ArrayCollection,this.listView.dataProvider=this._collect);for(var t=Activity.ins().activityData[this.activityID],e=[],i=t.shopItems,s=i?i.length:0,n=0;s>n;n++)e.push({data:i[n],activityID:this.activityID});this.noGoods.visible=!e||!e.length,this._collect.source=e,this.redPoint.visible=t.refreshFree,this.refresh.visible=this.priceTxt.visible=this.moneyIcon.visible=!t.refreshFree;var o=GlobalConfig.ActivityType22_1Config[this.activityID][1];this.priceTxt.text=o.freshPrice+"",this.refreshFree.visible=t.refreshFree,this.icon.source=GlobalConfig.ItemConfig[o.costItem].icon+"_png",i=t.limitItems,s=i?i.length:0;for(var a,r,n=0;5>n;n++)r=this["itemShow"+n],s-1>=n?(a=i[n],r.visible=!0,r.update({itemID:a.itemID,max:a.buyMax,buy:a.buyCount})):r.visible=!1},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.activityID][1].costItem),e=t?t.count:0;this.point.text="X"+e,this.point.textColor=e?65280:16711680},e.prototype.onTouch=function(t){switch(t.target){case this.refreshShopBtn:var e=Activity.ins().activityData[this.activityID];if(e.refreshFree)Activity.ins().sendReward(this.activityID,0,5,0);else{var i=GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice;Actor.yb<i?UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):(Activity.ins().sendReward(this.activityID,0,5,0),this.flyRMB(i))}}},e.prototype.flyRMB=function(t){var e=this;this.objList||(this.objList=[]);var i=new eui.BitmapLabel;i.font="num_2_fnt",i.y=-10,i.x=460,i.scaleX=i.scaleY=1.5,i.text="-"+t,this.addChild(i),this.objList.push(i),egret.Tween.get(i).to({y:i.y+50},1e3).call(function(){DisplayUtils.removeFromParent(i),e.objList.shift()})},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID],e=t.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(e>0?e:0,DateUtils.TIME_FORMAT_1,5),this.refreshTime.visible=this.refreshTip.visible=e>0},e}(BaseView);__reflect(OSATarget22Panel2.prototype,"OSATarget22Panel2");var OSATarget2Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i;if(this.activityType==ActivityType.Normal?i=GlobalConfig.ActivityType2Config[this.activityID]:this.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivity2Config[this.activityID]),!this.type2PanelList[this.activityID+""]){var s=ObjectPool.pop("OSATarget2Panel"+i[1].showType);s.top=0,s.bottom=0,s.left=0,s.right=0,s.activityID=this.activityID,s.activityType=this.activityType,this.type2PanelList[this.activityID+""]=s}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),this.type2PanelList[this.activityID+""]||(this.type2PanelList[this.activityID+""]=new OSATarget2Panel2,this.type2PanelList[this.activityID+""].activityID=this.activityID,this.type2PanelList[this.activityID+""].actType=this.activityType)},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget2Panel.prototype,"OSATarget2Panel");var OSATarget2Panel1=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gift.itemRenderer=OSATargetItemRender1},e.prototype.setCurSkin=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="OSADailyGiftSkin"},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID),this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.dataArr||(this.dataArr=new eui.ArrayCollection,this.gift.dataProvider=this.dataArr),this.updateData()},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this),this.removeObserve()},e.prototype.GetCallBack=function(t){this.updateData()},e.prototype.onTap=function(t){t.currentTarget},e.prototype.updateData=function(){var t,e,i;this.activityType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID],i=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID],i=GlobalConfig.PActivity2Config[this.activityID]);var s=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),n=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);s>=0?this.actTime1.text="活动未开启":0>=n?this.actTime1.text="活动已结束":(this._time=n,this._time<0&&(this._time=0),this.actTime1.text=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_5,3)),this.actDesc.text=e.desc;var o=[];for(var a in i)o.push(i[a]);this.dataArr.replaceAll(o)},e}(BaseView);__reflect(OSATarget2Panel1.prototype,"OSATarget2Panel1");var OSATarget2Panel2=function(t){function e(){var e=t.call(this)||this;return e._index=0,e.skinName="OSAGift",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activityType=ActivityPanel.getActivityTypeFromId(this.activityID);var e=this.getRule();this.updateData(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy,this.onTap),this.addTouchEvent(this.szlb,this.onTap),this.addTouchEvent(this.lhlb,this.onTap),this.addTouchEvent(this.yylb,this.onTap),this.addTouchEvent(this.sblb,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.hideSelect();var i=this.getRule();this.updateData(i)},e.prototype.hideSelect=function(){for(var t=0;4>t;t++)this["select"+t].visible=!1,this["arrow"+t].visible=!1,this["select"+t].visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buy,this.onTap),this.removeTouchEvent(this.szlb,this.onTap),this.removeTouchEvent(this.lhlb,this.onTap),this.removeTouchEvent(this.yylb,this.onTap),this.removeTouchEvent(this.sblb,this.onTap),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e,i;this.activityType==ActivityType.Normal?(e=Activity.ins(),i=e.getActivityDataById(this.activityID)):this.activityType==ActivityType.Personal&&(e=PActivity.ins(),i=e.getActivityDataById(this.activityID)),e.isSuccee||(UserTips.ins().showTips("领取失败"),e.sendChangePage(i.id)),e.isSuccee=!1,this.hideSelect();var s=this.getRule();this.updateData(s)}},e.prototype.onTap=function(t){var e;switch(t.currentTarget){case this.buy:if(this.config.vip&&UserVip.ins().lv<this.config.vip)UserTips.ins().showTips("vip等级不足");else{if(UserBag.ins().getSurplusCount()<7)return void UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");Actor.yb>=this.config.price?this.activityType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.activityType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")}e=-1;break;case this.lhlb:e=1;break;case this.yylb:e=2;break;case this.szlb:e=3;break;case this.sblb:e=4}if(-1!=e){for(var i=0;4>i;i++)e!=i+1?this["select"+i].visible=!1:this["select"+i].visible=!0,this["arrow"+i].visible=this["select"+i].visible;this.updateData(e)}},e.prototype.getRule=function(){var t,e;this.activityType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity2Config[this.activityID]);var i=[];for(var s in e)i.push(e[s]);i.sort(this.sortFunc);for(var n=0;n<i.length;n++){var o=i[n],a=t.buyData[o.index]>=o.count?!0:!1;if(!a)return o.index}return 2},e.prototype.sortFunc=function(t,e){return t.price<e.price?-1:t.price>e.price?1:0},e.prototype.updateData=function(t){void 0===t&&(t=2),this._index=t,this["select"+(t-1)].visible=!0,this["arrow"+(t-1)].visible=!0;var e,i,s;this.activityType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.ActivityType2Config[this.activityID][t],i=GlobalConfig.ActivityBtnConfig[this.activityID],s=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.PActivity2Config[this.activityID][t],i=GlobalConfig.PActivityBtnConfig[this.activityID],s=GlobalConfig.PActivity2Config[this.activityID]),this.setTime(),i&&(this.title.source=i.title),this.desc3.text=this.config.price+"",this.desc5.text=this.config.giftName;for(var n=0;n<this.config.rewards.length;n++){var o=this.config.rewards[n];this["item"+n].data={type:o.type,count:o.count,id:o.id}}var a=e.buyData[this._index]>=this.config.count?!0:!1;this.buy.visible=!a,this.already.visible=a,this.actTime.visible=!this.already.visible,this.showbg.source=this.config.source[2]+"_png",this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1);for(var n in s){var r=s[n];r&&r.source[0]&&(this["bg"+(+n-1)].source=r.source[0]),r&&r.source[1]&&(this["name"+(+n-1)].source=r.source[1])}},e.prototype.setTime=function(){var t;this.activityType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID));var e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);OSATarget2Panel2.giftNameArr=["","材料礼包","图鉴礼包","羽翼礼包","神兵礼包"],__reflect(OSATarget2Panel2.prototype,"OSATarget2Panel2");var OSATarget2Panel3=function(t){function e(){var e=t.call(this)||this;return e._time=0,e._curPage=1,e._maxPage=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase},e.prototype.setCurSkin=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="SFVipGiftSkin"},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID),this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.addTouchEvent(this,this.onTouch),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData()},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this),this.removeObserve(),this.removeTouchEvent(this,this.onTouch)},e.prototype.GetCallBack=function(t){this.updateData()},e.prototype.onTap=function(t){t.currentTarget},e.prototype.updateData=function(){this.activityType==ActivityType.Normal?(this._activityData=Activity.ins().getActivityDataById(this.activityID),this._config=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(this._activityData=PActivity.ins().getActivityDataById(this.activityID),this._config=GlobalConfig.PActivity2Config[this.activityID]);var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime0.text="活动未开启":0>=e?this.actTime0.text="活动已结束":(this._time=e,this._time<0&&(this._time=0),this.actTime0.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)),this._maxPage=Object.keys(this._config).length,this._curPage=1;for(var i,s=1;s<=this._maxPage;s++)if(i=this._config[s],this._activityData.buyData[i.index]<i.count){this._curPage=s;break}this.updatePage()},e.prototype.updatePage=function(){this.turnBackBtn.visible=this._curPage>1,this.turnNextBtn.visible=this._curPage<this._maxPage;var t=this._config[this._curPage];this.ggtxt0.source="viptitle"+t.index+"_png",this.tu0.source="vipshow"+t.index+"_png",this.vipLv0.text=t.vip+"",this.times0.text="活动期间仅可购买"+t.count+"次",this.get0.label=t.price+"元宝",this._collect||(this._collect=new ArrayCollection,this.reward0.dataProvider=this._collect),this._collect.source=t.rewards,this.buyred.visible=!1,this.already0.visible=!1,this.get0.visible=!0,this._activityData.buyData[t.index]>=t.count?(this.isGet=!1,this.already0.visible=!0,this.get0.visible=!1):(this.isGet=UserVip.ins().lv>=t.vip&&Actor.yb>=t.price,this.buyred.visible=this.isGet),this.leftred.visible=this.rightred.visible=!1;for(var e=1;e<this._curPage;e++)if(t=this._config[e],this._activityData.buyData[t.index]<t.count&&UserVip.ins().lv>=t.vip&&Actor.yb>=t.price){this.leftred.visible=!0;break}for(var e=this._curPage+1;e<=this._maxPage;e++)if(t=this._config[e],this._activityData.buyData[t.index]<t.count&&UserVip.ins().lv>=t.vip&&Actor.yb>=t.price){this.rightred.visible=!0;break}},e.prototype.onTouch=function(t){switch(t.target){case this.get0:var e=this._config[this._curPage];this.isGet?e instanceof ActivityType2Config?Activity.ins().sendReward(e.Id,e.index):e instanceof PActivity2Config&&PActivity.ins().sendReward(e.Id,e.index):UserVip.ins().lv<e.vip?UserTips.ins().showTips("|C:0xff0000&T:VIP等级不满足要求|"):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");break;case this.turnBackBtn:this._curPage>1&&(this._curPage--,this.updatePage());break;case this.turnNextBtn:this._curPage<this._maxPage&&(this._curPage++,this.updatePage())}},e}(BaseView);__reflect(OSATarget2Panel3.prototype,"OSATarget2Panel3");var OSATarget3BigRewardItemRender=function(t){function e(){return t.call(this)||this
}return __extends(e,t),e.prototype.setData=function(t,e){this.reward.touchEnabled=!1;var i=GlobalConfig.ActivityType3Config[t][e],s=Activity.ins().getActivityDataById(t);this.days.text="累充"+s.dabiao[e-1]+"/"+i.day+"天",this.reward.data=i.rewards[0],this.reward.isShowName(!1),1==(s.recrod>>e&1)?this.state.visible=!0:this.state.visible=!1},e.prototype.showEquipEffect=function(t){t?(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.x=45,this.EquipEffect.y=48,this.EquipEffect.scaleX=1.6,this.EquipEffect.scaleY=1.6,this.EquipEffect.parent||this.addChild(this.EquipEffect),this.EquipEffect.playFile(RES_DIR_EFF+"quaeff4",-1)):this.EquipEffect&&DisplayUtils.removeFromParent(this.EquipEffect)},e.prototype.setSelected=function(t){this.select.visible=t},e}(BaseComponent);__reflect(OSATarget3BigRewardItemRender.prototype,"OSATarget3BigRewardItemRender");var OSATarget3ItemRender6=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyRechargeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.reward.itemRenderer=ItemBase,this.isGet=!0},e.prototype.onClick=function(t){var e,i,s;switch(this.data instanceof ActivityType3Config?(e=Activity.ins(),i=GlobalConfig.ActivityType3Config[this.actId][this.index],s=e.getActivityDataById(this.actId)):this.data instanceof PActivity3Config&&(e=PActivity.ins(),i=GlobalConfig.PActivity3Config[this.actId][this.index],s=e.getActivityDataById(this.actId)),t.target){case this.get:if(this.isGet)e.sendReward(this.actId,this.index);else{var n=0;switch(i.showType){case Show3Type.TYPE6:s.chongzhiTotal<i.val&&(n=i.val-s.chongzhiTotal)}if(!n)return void Activity.ins().sendReward(this.actId,this.index);i.showType==Show3Type.TYPE6&&s.chongzhiTotal<i.val&&UserTips.ins().showTips("未完成累计充值")}}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i;this.data instanceof ActivityType3Config?(e=this.data,i=Activity.ins().getActivityDataById(e.Id)):this.data instanceof PActivity3Config&&(e=this.data,i=PActivity.ins().getActivityDataById(e.Id)),this.reward.dataProvider=new eui.ArrayCollection(e.rewards),this.target.text="累计充值"+e.val+"元宝";var s=65280;i.chongzhiTotal<e.val&&(s=16711680),this.recharge.textFlow=TextFlowMaker.generateTextFlow1("(|C:"+s+"&T:"+i.chongzhiTotal+"|C:65280&T:/"+e.val+")");var n=i.getRewardStateById(e.index);switch(n){case Activity.NotReached:this.get.label="未完成",this.get.currentState="disabled",this.isGet=!1,this.redPoint.visible=!1;break;case Activity.CanGet:this.get.label="领取",this.get.currentState="up",this.isGet=!0,this.redPoint.visible=!0;break;case Activity.Geted:this.isGet=!1,this.redPoint.visible=!1,this.get.visible=!1,this.already.visible=!0}this.actId=e.Id,this.index=e.index},e}(BaseItemRender);__reflect(OSATarget3ItemRender6.prototype,"OSATarget3ItemRender6");var OSATarget3ItemRender7=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rewardList.itemRenderer=ItemBase,this.isGet=!0},e.prototype.onClick=function(t){switch(t.target){case this.get0:if(this.isGet)this.data instanceof ActivityType3Config?Activity.ins().sendReward(this.actId,this.index):this.data instanceof PActivity3Config&&PActivity.ins().sendReward(this.actId,this.index);else{var e=void 0,i=void 0,s=void 0;this.data instanceof ActivityType3Config?(e=GlobalConfig.ActivityType3Config[this.actId][this.index],s=Activity.ins(),i=s.getActivityDataById(this.actId)):this.data instanceof PActivity3Config&&(e=GlobalConfig.PActivity3Config[this.actId][this.index],s=PActivity.ins(),i=s.getActivityDataById(this.actId));var n=0;switch(e.showType){case Show3Type.TYPE7:i.dabiao[this.index-1]<e.day&&(n=e.day-i.dabiao[this.index-1])}if(!n)return void s.sendReward(this.actId,this.index);e.showType==Show3Type.TYPE7&&i.dabiao[this.index-1]<e.day&&UserTips.ins().showTips("累计充值"+ +n+"天之后即可领取奖励")}}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i,s;this.data instanceof ActivityType3Config?(e=this.data,i=Activity.ins(),s=i.getActivityDataById(e.Id)):this.data instanceof PActivity3Config&&(e=this.data,i=PActivity.ins(),s=i.getActivityDataById(e.Id)),this.num.text=e.day+"",this.rewardList.dataProvider=new eui.ArrayCollection(e.rewards);var n=s.getRewardStateById(e.index);switch(n){case Activity.NotReached:this.get0.label="未完成",this.get0.currentState="disabled",this.isGet=!1,this.redPoint.visible=!1;break;case Activity.CanGet:this.get0.label="领取",this.get0.currentState="up",this.isGet=!0,this.redPoint.visible=!0;break;case Activity.Geted:this.isGet=!1,this.redPoint.visible=!1,this.get0.visible=!1,this.already.visible=!0}this.actId=e.Id,this.index=e.index},e}(BaseItemRender);__reflect(OSATarget3ItemRender7.prototype,"OSATarget3ItemRender7");var OSATarget3Panel=function(t){function e(){var e=t.call(this)||this;return e.type3PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initPanelList()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),this.observe(PActivity.ins().postChangePage,this.updateData),this.observe(PActivity.ins().postRewardResult,this.updateData),this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=this.activityID;this.initPanelList(),this.cruPanel=this.type3PanelList[i+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.cruPanel&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t,i="",s=this.activityID;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityType3Config[s]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivity3Config[s]);for(var n in t)if(e.targetIndex[t[n].showType]){i=e.targetIndex[t[n].showType];break}if(i&&!this.type3PanelList[s+""]){var o=egret.getDefinitionByName(i);this.type3PanelList[s+""]=new o(s),this.type3PanelList[s+""].top=0,this.type3PanelList[s+""].bottom=0,this.type3PanelList[s+""].left=0,this.type3PanelList[s+""].right=0,this.type3PanelList[s+""].activityID=s}},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e}(ActivityPanel);OSATarget3Panel.targetIndex={1:"OSATarget3Panel3",2:"OSATarget3Panel2",3:"OSATarget3Panel4",4:"DailyRechargePanel",5:"OSATarget3Panel5",6:"OSATarget3Panel6",7:"OSATarget3Panel7",8:"OSATarget3Panel8",9:"OSATarget3Panel9",10:"OSATarget3Panel10"},__reflect(OSATarget3Panel.prototype,"OSATarget3Panel");var OSATarget3Panel1=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._index=1,e._time=0,e.skinName="OSASeriesRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.initData()},e.prototype.initData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getCurIndex();this._index=e;var i=GlobalConfig.ActivityType3Config[this.activityID][e];if(this.reward.dataProvider=new eui.ArrayCollection(i.rewards),this.redPoint.visible=!1,this.state.visible=!0,(t.dabiao[e-1]||0)>=i.day){var s=t.recrod>>e&1;0==s?(this.getBtn.label="领取",this.getBtn.visible=!0,this.getBtn.enabled=!0,this.already.visible=!1,this.redPoint.visible=!0,this._state=1):(this.getBtn.label="已领取",this.getBtn.visible=!1,this.already.visible=!0,this.state.visible=!1,this._state=2),this.state.textColor=65280}else this.getBtn.label="未完成",this.getBtn.visible=!0,this.getBtn.enabled=!1,this.already.visible=!1,this.state.textColor=16750848,this._state=0;this.state.text="当前进度"+(t.dabiao[e-1]||0)+"/"+i.day,this.updateTime()},e.prototype.updateTime=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);var i=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=i.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.onTap=function(){1==this._state&&Activity.ins().sendReward(this.activityID,this._index)},e.prototype.close=function(){this.removeTouchEvent(this.getBtn,this.onTap),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel1.prototype,"OSATarget3Panel1");var OSATarget3Panel10=function(t){function e(){var e=t.call(this)||this;return e.selectRes=["sd_projecttitle2","sd_projecttitle1"],e.pageRedPoint=[!1,!1,!1],e}return __extends(e,t),e.prototype.initSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="KMHRechargeSkin"},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.open=function(){this.initSkin(),this.observe(Activity.ins().postRewardResult,this.updateDataCall),this.observe(Activity.ins().postChangePage,this.updateDataCall);for(var t=0;3>t;t++)this["projectbg"+t].name=t.toString(),this.addTouchEvent(this["projectbg"+t],this.onTap);this.rechargeitem.itemRenderer=KaiMenItem,this.rechargeitemData=new eui.ArrayCollection,this.rechargeitem.dataProvider=this.rechargeitemData,this.initData(),TimerManager.ins().doTimer(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getLeftTime();this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e.prototype.updatePageRedPoint=function(t){for(var e=0;e<t.length;e++)if(t[e].redPoint)return!0;return!1},e.prototype.updateList=function(t){var e=GlobalConfig.ActivityType3Config[t],i=Activity.ins().getActivityDataById(t),s=[];for(var n in e){var o=new KaiMenData;o.id=e[n].Id,o.index=e[n].index,o.type=e[n].type,o.day=e[n].day,o.reward=e[n].rewards,o.already=i.recrod>>e[n].index&1?!0:!1,3==o.type?(o.unready=i.isOverTimer(e[n].index),i.curOpenDay()+1==e[n].day?o.redPoint=i.chongzhiNum>=e[n].val?!0:!1:o.redPoint=!1):1==o.type&&(o.unready=i.dabiao[e[n].index-1]<e[n].day,o.redPoint=!o.already&&!o.unready),o.unready?o.already=o.redPoint=!1:o.redPoint=o.already?!1:o.redPoint,s.push(o)}return s},e.prototype.onTap=function(t){for(var e=0;3>e;e++)if(this["projectbg"+e].source=this.selectRes[0],t.currentTarget==this["projectbg"+e]){this.actIndex=e,this["projectbg"+e].source=this.selectRes[1];var i=this.actIds[this.actIndex],s=this.updateList(i);this.rechargeitemData.replaceAll(s)}},e.prototype.initData=function(){var t=GlobalConfig.ActivityType3Config[this.activityID];this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.actIds=[],this.actIds.push(this.activityID);for(var e=1;e<=t[1].activityID.length;e++)this.actIds.push(t[1].activityID[e-1]);this.actIndex=this.getRuleIndex(),this.updateTime(),this.updateData1();var i=GlobalConfig.ActivityBtnConfig[this.activityID];i&&(this.title.source=i.title)},e.prototype.getRuleIndex=function(){var t=0;return t},e.prototype.updateDataCall=function(t){-1!=this.actIds.indexOf(t)&&this.updateData1()},e.prototype.updateData1=function(){for(var t=0;3>t;t++)this["projectbg"+t].source=this.selectRes[0];this["projectbg"+this.actIndex].source=this.selectRes[1];for(var t=0;t<this.actIds.length;t++){var e=this.actIds[t],i=this.updateList(e);this["redpoint"+t].visible=this.updatePageRedPoint(i),t==this.actIndex&&this.rechargeitemData.replaceAll(i)}var s=Activity.ins().getActivityDataById(this.actIds[this.actIndex]);this.rechargeCoumt.text="今日已充值"+Math.floor(s.chongzhiNum/100)+"元"},e.prototype.updateData=function(){},e}(BaseView);__reflect(OSATarget3Panel10.prototype,"OSATarget3Panel10");var OSATarget3Panel2=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._index=1,e._time=0,e.skinName="OSATotalRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){this.rechargeBar||(this.rechargeBar=new ProgressBarEff,this.rechargeBar.setWidth(520),this.rechargeBar.x=-272,this.rechargeBar.y=0,this.process.addChild(this.rechargeBar));var t,e,i;if(this.actType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),i=e.getCurIndex(),t=GlobalConfig.ActivityType3Config[this.activityID][i]):this.actType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),i=e.getCurIndex(),t=GlobalConfig.PActivity3Config[this.activityID][i]),this._index=i,this.reward.dataProvider=new eui.ArrayCollection(t.rewards),this.redPoint.visible=!1,this.state.visible=!0,e.chongzhiTotal>=t.val){var s=e.recrod>>i&1;0==s?(this.getBtn.label="领取",this.getBtn.visible=!0,this.getBtn.enabled=!0,this.already.visible=!1,this.redPoint.visible=!0,this._state=1):(this.getBtn.label="已领取",this.getBtn.visible=!1,this.already.visible=!0,this.state.visible=!1,this._state=2),this.state.textColor=65280}else this.getBtn.label="未完成",this.getBtn.visible=!0,this.getBtn.enabled=!1,this.already.visible=!1,this.state.textColor=16750848,this._state=0;this.state.text="已充值"+e.chongzhiTotal+"/"+t.val+"元宝",this.rechargeBar.setData(e.chongzhiTotal,t.val),this.rechargeBar.setLbValueText(""),this.updateTime()},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.onTap=function(){if(1==this._state){if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void UserTips.ins().showTips("背包剩余空位不足，请先清理");this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index)}},e.prototype.close=function(){this.removeTouchEvent(this.getBtn,this.onTap),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel2.prototype,"OSATarget3Panel2");var OSATarget3Panel3=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSASeriesRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.gift0,this.onTap),this.addTouchEvent(this.gift1,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID]);var i=-1,s=Object.keys(e);for(var n in e){var o=e[n],a=+n;(t.dabiao[a-1]||0)<o.day?-1==i&&(i=s.length):0==(t.recrod>>a&1)&&(t.dabiao[a-1]||0)>=o.day&&(i=a),this["gift"+(a-1)].setData(this.activityID,a)}var r=Object.keys(e),h=+r[r.length-1];this.bar.maximum=e[h].day,this.bar.value=t.dabiao[h-1],-1==i&&(i=t.getCurIndex()),this.setSelectIndex(i),this.updateTime()},e.prototype.setSelectIndex=function(t){this._index=t;var e,i;if(this.actType==ActivityType.Normal?(e=GlobalConfig.ActivityType3Config[this.activityID][t],i=Activity.ins().getActivityDataById(this.activityID)):this.actType==ActivityType.Personal&&(e=GlobalConfig.PActivity3Config[this.activityID][t],i=PActivity.ins().getActivityDataById(this.activityID)),this.reward.dataProvider=new eui.ArrayCollection(e.rewards),this.redPoint.visible=!1,(i.dabiao[t-1]||0)>=e.day){var s=i.recrod>>t&1;0==s?(this.getBtn.label="领取",this.getBtn.visible=!0,this.getBtn.enabled=!0,this.already.visible=!1,this.redPoint.visible=!0,this._state=1):(this.getBtn.label="已领取",this.getBtn.visible=!1,this.already.visible=!0,this._state=2)}else this.getBtn.label="未完成",this.getBtn.visible=!0,this.getBtn.enabled=!1,this.already.visible=!1,this._state=0;1==t?(this.show0.visible=!0,this.show1.visible=!1,this.gift0.setSelected(!0),this.gift1.setSelected(!1)):(this.show0.visible=!1,this.show1.visible=!0,this.gift0.setSelected(!1),this.gift1.setSelected(!0))},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.getBtn?1==this._state&&(this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index)):e==this.gift0?this.setSelectIndex(1):e==this.gift1&&this.setSelectIndex(2)},e.prototype.close=function(){this.removeTouchEvent(this.getBtn,this.onTap),this.removeTouchEvent(this.gift0,this.onTap),this.removeTouchEvent(this.gift1,this.onTap),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel3.prototype,"OSATarget3Panel3");var OSATarget3Panel4=function(t){function e(){var e=t.call(this)||this;return e.skinName="SecondRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase,this.reward1.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.get0,this.onTap),this.addTouchEvent(this.get1,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){this.setIndex(0),this.setIndex(1),this.updateTime()},e.prototype.setIndex=function(t){var e,i,s,n;this.actType==ActivityType.Normal?s=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(s=PActivity.ins().getActivityDataById(this.activityID)),0==t?(e=s.getCurIndex(3),this._index=e,i=s.chongzhiNum):(e=s.getCurIndex(2),i=s.chongzhiTotal),this.actType==ActivityType.Normal?n=GlobalConfig.ActivityType3Config[this.activityID][e]:this.actType==ActivityType.Personal&&(n=GlobalConfig.ActivityType3Config[this.activityID][e]),this["reward"+t].dataProvider=new eui.ArrayCollection(n.rewards),this["redPoint"+t].visible=!1;var o=this["already"+t],a=this["get"+t],r=this["record"+t];if(o.visible=!1,i>=n.val){var h=s.recrod>>e&1;0==h?(a.label="立即领取",a.visible=!0,a.enabled=!0,this["redPoint"+t].visible=!0):(a.label="已领取",a.visible=!1,o.visible=!0),r.textColor=65280}else a.label="未完成",a.visible=!0,a.enabled=!1,r.textColor=16750848;r.text="已充值"+i+"/"+n.val+"元宝",0==t?this.target0.text="今日累计充值"+n.val+"元宝可领取":this.target1.text="7日累计充值"+n.val+"元宝可领取"},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.get0)this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index);else if(e==this.get1){var i=void 0;this.actType==ActivityType.Normal?(i=Activity.ins().getActivityDataById(this.activityID),Activity.ins().sendReward(this.activityID,i.getCurIndex(2))):this.actType==ActivityType.Personal&&(i=PActivity.ins().getActivityDataById(this.activityID),PActivity.ins().sendReward(this.activityID,i.getCurIndex(2)))}},e.prototype.close=function(){this.removeTouchEvent(this.get0,this.onTap),this.removeTouchEvent(this.get1,this.onTap),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel4.prototype,"OSATarget3Panel4");var OSATarget3Panel5=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase,this.reward1.itemRenderer=ItemBase},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="hefuSeriesRechargeSkin"},e.prototype.open=function(){this.setCurSkin(),this.addTouchEvent(this.getBtn0,this.onTap),this.addTouchEvent(this.getBtn1,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){this.setIndex(0),this.setIndex(1),this.updateTime()},e.prototype.setIndex=function(t){var e,i,s,n;this.actType==ActivityType.Normal?(s=Activity.ins().getActivityDataById(this.activityID),n=GlobalConfig.ActivityBtnConfig[this.activityID]):this.actType==ActivityType.Personal&&(s=PActivity.ins().getActivityDataById(this.activityID),n=GlobalConfig.PActivityBtnConfig[this.activityID]),n&&(this.title.source=n.title),0==t?(e=s.getCurIndex(3),this._index=e,i=s.chongzhiNum):(e=s.getCurIndex(2),i=s.chongzhiTotal);var o;this.actType==ActivityType.Normal?o=GlobalConfig.ActivityType3Config[this.activityID][e]:this.actType==ActivityType.Personal&&(o=GlobalConfig.PActivity3Config[this.activityID][e]),this["reward"+t].dataProvider=new eui.ArrayCollection(o.rewards),this["redPoint"+t].visible=!1;var a=this["already"+t],r=this["getBtn"+t];if(a.visible=!1,i>=o.val){var h=s.recrod>>e&1;0==h?(r.label="立即领取",r.visible=!0,r.enabled=!0,this["redPoint"+t].visible=!0):(r.label="已领取",r.visible=!1,a.visible=!0)}else r.label="未完成",r.visible=!0,r.enabled=!1;0==t||(this.state.text="累计充值:"+i+"/"+o.val+"元宝"),this.bar&&(this.bar.maximum=o.val,this.bar.value=i),158==this.activityID?this.addchong.source="l_biaoti_leichong800":212==this.activityID&&(this.addchong.source="l_biaoti_leichong800")},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.getBtn0)this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index);else if(e==this.getBtn1){var i=void 0;this.actType==ActivityType.Normal?(i=Activity.ins().getActivityDataById(this.activityID),Activity.ins().sendReward(this.activityID,i.getCurIndex(2))):this.actType==ActivityType.Personal&&(i=PActivity.ins().getActivityDataById(this.activityID),PActivity.ins().sendReward(this.activityID,i.getCurIndex(2)))}},e.prototype.close=function(){this.removeTouchEvent(this.getBtn0,this.onTap),this.removeTouchEvent(this.getBtn1,this.onTap),TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel5.prototype,"OSATarget3Panel5");var OSATarget3Panel6=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuCostSkin",e}return __extends(e,t),e.prototype.close=function(){TimerManager.ins().removeAll(this)},e.prototype.open=function(){this.listData=new eui.ArrayCollection,this.content.itemRenderer=OSATarget3ItemRender6,this.content.dataProvider=this.listData,TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.updateData()},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.updateData=function(){this.updateTime(),this.updateList()},e.prototype.updateList=function(){var t,e,i;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID],i=Activity.ins().getbtnInfo(this.activityID.toString())):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID],i=PActivity.ins().getbtnInfo(this.activityID.toString()));var s=[];for(var n in e)s.push(e[n]);s=s.slice();for(var o=[],a=[],r=0;r<s.length;r++){var h=t.getRewardStateById(s[r].index);h==Activity.Geted?a.push(s[r]):o.push(s[r])}o.sort(this.sortFunc),a.sort(this.sortFunc),s=o.concat(a),this.listData.replaceAll(s),this.title.source=i.title},e.prototype.sortFunc=function(t,e){return t.val<e.val?-1:1},e}(BaseView);__reflect(OSATarget3Panel6.prototype,"OSATarget3Panel6");var OSATarget3Panel7=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuSeriesRechargeSkin2",e}return __extends(e,t),e.prototype.open=function(){this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.listData=new eui.ArrayCollection,this.content0.itemRenderer=OSATarget3ItemRender7,this.content0.dataProvider=this.listData,TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.updateData()},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e;if(this.actType==ActivityType.Normal?e=Activity.ins():this.actType==ActivityType.Personal&&(e=PActivity.ins()),!e.isSuccee)if(UserBag.ins().getSurplusCount()){UserTips.ins().showTips("领取失败");var i=void 0;this.actType==ActivityType.Normal?i=e.getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(i=e.getActivityDataById(this.activityID)),e.sendChangePage(i.id)}else UserTips.ins().showTips("背包已满");e.isSuccee=!1,this.updateData()}},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){TimerManager.ins().removeAll(this)},e.prototype.updateData=function(){this.updateTime(),this.updateList()},e.prototype.updateList=function(){var t,e,i;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID],i=Activity.ins().getbtnInfo(this.activityID.toString())):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID],i=PActivity.ins().getbtnInfo(this.activityID.toString()));var s=[];for(var n in e)s.push(e[n]);s=s.slice();for(var o=[],a=[],r=0;r<s.length;r++){var h=t.getRewardStateById(s[r].index);h==Activity.Geted?a.push(s[r]):o.push(s[r])}o.sort(this.sortFunc),a.sort(this.sortFunc),s=o.concat(a),this.listData.replaceAll(s),this.title.source=i.title},e.prototype.sortFunc=function(t,e){return t.index<e.index?-1:1},e}(BaseView);__reflect(OSATarget3Panel7.prototype,"OSATarget3Panel7");var Timer=egret.Timer,OSATarget3Panel8=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e||0,i.initSkin(),i}return __extends(e,t),e.prototype.initSkin=function(){this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var t;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityConfig[this.activityID],this.skinName=t.pageSkin):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID],this.skinName=t.pageSkin)},e.prototype.open=function(){this.initSkin();for(var t=0;6>t;t++)this.addTouchEvent(this["reward"+t],this.onTap);this.addTouchEvent(this.rechargeBtn,this.onTap),this.observe(Activity.ins().postActivityIsGetAwards,this.showAward),this.observe(PActivity.ins().postActivityIsGetAwards,this.showAward),this.initData(),TimerManager.ins().doTimer(1e3,0,this.updateTime,this)},e.prototype.initData=function(){var t;this.actType==ActivityType.Normal?(this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc,t=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(this.actInfo1.text=GlobalConfig.PActivityConfig[this.activityID].desc,t=GlobalConfig.PActivity3Config[this.activityID]);for(var e in t){var i=t[e];if(4==i.type){this.singleReward.data=i.rewards[0];break}}this.updateTime(),this.updateData()},e.prototype.updateTime=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID));var e=t.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e.prototype.onTap=function(t){if(t.currentTarget==this.rechargeBtn){var e=Recharge.ins().getRechargeData(0);
return void(e&&2==e.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win))}var i=t.currentTarget;if(i){var s=void 0,n=void 0;this.actType==ActivityType.Normal?(s=i.data,Activity.ins().sendReward(s.Id,s.index),n=Activity.ins().getActivityDataById(s.Id)):this.actType==ActivityType.Personal&&(s=i.data,PActivity.ins().sendReward(s.Id,s.index),n=PActivity.ins().getActivityDataById(s.Id));var o=n.getRewardStateById(s.index);o==Activity.CanGet&&(this._sendConf=s)}},e.prototype.showAward=function(){if(this._sendConf){var t=void 0;this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this._sendConf.Id):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this._sendConf.Id));var e=t.getRewardStateById(this._sendConf.index);e==Activity.Geted&&UserTips.ins().showItemTips(this._sendConf.rewards[0].id)}},e.prototype.close=function(){for(var t=0;6>t;t++)this.removeTouchEvent(this["reward"+t],this.onTap);this.removeTouchEvent(this.rechargeBtn,this.onTap),this.removeObserve(),TimerManager.ins().remove(this.updateTime,this)},e.prototype.updateData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID]);for(var i=0;5>i;i++)for(var s=e[i+1],n=e[i+2],o=Math.floor((t.chongzhiTotal-s.val)/(n.val-s.val)*5),a=0;5>a;a++){var r="sche"+i+"bell"+a;o>a?this[r].source="bell2":this[r].source="bell1"}for(var i=0;6>i;i++)this["reward"+i].data=e[i+1];this.numLbl.text=""+Math.floor(t.chongzhiTotal/100)},e}(BaseView);__reflect(OSATarget3Panel8.prototype,"OSATarget3Panel8");var OSATarget3Panel9=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e||0,i.initSkin(),i}return __extends(e,t),e.prototype.initSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];this.skinName=t.pageSkin},e.prototype.open=function(){this.initSkin();for(var t=GlobalConfig.ActivityType3Config[this.activityID],e=CommonUtils.getObjectLength(t),i=0;e>i;i++)this["targtet"+i]&&this.addTouchEvent(this["targtet"+i],this.onTap);this.addTouchEvent(this.rechargeBtn,this.onTap),this.observe(Activity.ins().postActivityIsGetAwards,this.showAward),this.reward.itemRenderer=ItemBase,this.initData(),TimerManager.ins().doTimer(1e3,0,this.updateTime,this)},e.prototype.initData=function(){this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;for(var t in GlobalConfig.ActivityType3Config[this.activityID]){var e=GlobalConfig.ActivityType3Config[this.activityID][t];if(4==e.type){this.singleReward.data=e.rewards[0];break}}this.updateTime(),this.updateData2()},e.prototype.updateTime=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e.prototype.onTap=function(t){if(t.currentTarget==this.rechargeBtn){if(!this._sendConf)return;var e=Activity.ins().getActivityDataById(this._sendConf.Id),i=e.getRewardStateById(this._sendConf.index);return void(i==Activity.Geted?UserTips.ins().showTips("已领取"):i==Activity.CanGet?Activity.ins().sendReward(this.activityID,this._sendConf.index):UserTips.ins().showTips("未达成条件不足，请先获得锤子充值目标"))}if(t.currentTarget instanceof CelebrationItem){var s=t.currentTarget;this.updateReward(s.data.config.index,s.data.config.index);var n=GlobalConfig.ActivityType3Config[this.activityID];for(var o in n)n[o].index!=s.data.config.index&&this["targtet"+(n[o].index-1)]&&this["targtet"+(n[o].index-1)].setSelect(!1)}},e.prototype.showAward=function(){if(this._sendConf){var t=Activity.ins().getActivityDataById(this._sendConf.Id),e=t.getRewardStateById(this._sendConf.index);e==Activity.Geted&&(this.showEff(this._sendConf),this.rechargeBtn.visible=!1,this.already.visible=!this.rechargeBtn.visible)}},e.prototype.close=function(){this.cleanEff(),this.removeTouchEvent(this.rechargeBtn,this.onTap),this.removeObserve(),TimerManager.ins().remove(this.updateTime,this)},e.prototype.updateReward=function(t,e){var i=Activity.ins().getActivityDataById(this.activityID),s=GlobalConfig.ActivityType3Config[this.activityID][t];if(s&&i&&this["targtet"+(t-1)]){if(this["targtet"+(t-1)].data={curCost:i.chongzhiTotal,config:s},this["targtet"+(t-1)].setSelect(e?t==e:!1),this.rechargeBtn.visible=!0,this.bigEgg.source=s.expAttr[4],t==e){this._sendConf=s;var n=i.getRewardStateById(this._sendConf.index);this.redPoint.visible=!1,n==Activity.Geted?(this.rechargeBtn.visible=!1,this.bigEgg.source=s.expAttr[5]):n==Activity.CanGet&&(this.redPoint.visible=!0),this.reward.dataProvider=new eui.ArrayCollection(s.rewards)}this.already.visible=!this.rechargeBtn.visible}},e.prototype.updateData2=function(){var t=this.getRuleIndex();if(t)for(var e=(Activity.ins().getActivityDataById(this.activityID),GlobalConfig.ActivityType3Config[this.activityID]),i=CommonUtils.getObjectLength(e),s=0;i>s;s++)this.updateReward(s+1,t)},e.prototype.updateData=function(){},e.prototype.getRuleIndex=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(!t)return 0;var e=GlobalConfig.ActivityType3Config[this.activityID],i=CommonUtils.getObjectLength(e),s=i;for(var n in e)if(!(e[n].index-1>=i)&&this["targtet"+(e[n].index-1)]){var o=t.getRewardStateById(e[n].index);if(o!=Activity.Geted){if(o==Activity.CanGet)return e[n].index;s>e[n].index&&(s=e[n].index)}}return s},e.prototype.cleanEff=function(){egret.Tween.removeTweens(this.hamer),egret.Tween.removeTweens(this.flower),DisplayUtils.removeFromParent(this.tonk),DisplayUtils.removeFromParent(this.boom)},e.prototype.showEff=function(t){var e=this;if(t){this.tonk||(this.tonk=new MovieClip),this.tonk.parent||this.hamer.addChild(this.tonk),this.boom||(this.boom=new MovieClip),this.boom.parent||this.flower.addChild(this.boom),egret.Tween.removeTweens(this.hamer),egret.Tween.removeTweens(this.flower);var i=this;this.tonk.playFile(RES_DIR_EFF+t.expAttr[2],1,function(){var s=egret.Tween.get(e.hamer);s.wait(200).call(function(){i.updateReward(t.index,t.index)}),i.boom.playFile(RES_DIR_EFF+t.expAttr[3],1,function(){egret.Tween.removeTweens(i.hamer),egret.Tween.removeTweens(i.flower),DisplayUtils.removeFromParent(i.tonk),DisplayUtils.removeFromParent(i.boom)})})}},e}(BaseView);__reflect(OSATarget3Panel9.prototype,"OSATarget3Panel9");var OSATarget4Panel=function(t){function e(){var e=t.call(this)||this;return e.type4PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.observe(Rank.ins().postRankingData,this.initInfo),this.initPanelList()},e.prototype.initInfo=function(t){this.openPanel(t)},e.prototype.openPanel=function(t){this.cruPanel=this.type4PanelList[this.activityID+""],this.cruPanel.open(t),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.initPanelList=function(){GlobalConfig.ActivityConfig[this.activityID];if(!this.type4PanelList[this.activityID+""]){var t=new OSATarget4Panel2;t.top=0,t.bottom=0,t.left=0,t.right=0,this.type4PanelList[this.activityID+""]=t,this.type4PanelList[this.activityID+""].activityID=this.activityID}var e=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;e&&e!=RankDataType.TYPE_HF_XIAOFEI?Rank.ins().sendGetRankingData(e):this.openPanel()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget4Panel.prototype,"OSATarget4Panel");var OSATarget4Panel2=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="OSARankSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase,this.reward1.itemRenderer=ItemBase,this.reward2.itemRenderer=ItemBase,this.reward3.itemRenderer=ItemBase,this.titleEffNameMc||(this.titleEffNameMc=new MovieClip),this.titleEffNameMc.parent||this.titleEffGroup.addChild(this.titleEffNameMc),this.titleEffNameMc.x=this.titleEffGroup.x,this.titleEffNameMc.y=this.titleEffGroup.y},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.seek,this.onTap),TimerManager.ins().doTimer(1e3,0,this.setTime,this),t&&(this.model=t[0]),this.observe(Activity.ins().postGetDaBiaoInfo,this.updateData);var i=GlobalConfig.ActivityType4Config[this.activityID][1];i&&i.rankType==RankDataType.TYPE_HF_XIAOFEI?Activity.ins().sendDabiaoInfo(this.activityID):this.updateData()},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.seek,this.onTap),TimerManager.ins().removeAll(this),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.seek:var e=GlobalConfig.ActivityType4Config[this.activityID][0].rankType,i=void 0,s=void 0;i=this.model?this.model.getDataList():Activity.ins().rankInfoList,s=Math.min(i.length,20);for(var n=[],o=Activity.ins().getActivityDataById(this.activityID),a={idx:1},r=0;s>r;r++){var h=i[r],l=o.getCostRank(h,a);n.push({rankData:i[r],activityID:this.activityID,rank:l})}ViewManager.ins().open(OSARankTipsWin,n,e)}},e.prototype.setMyRank=function(){this.myAttrValue.text="空";var t=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;if(t==RankDataType.TYPE_HF_XIAOFEI)if(null==Activity.ins().myPaiming||0==Activity.ins().myPaiming)this.myRanking.text="20名以后";else{var e=Activity.ins().getActivityDataById(this.activityID);e.myPaiming?this.myRanking.text=e.myPaiming+"":this.myRanking.text="20名以后"}else this.myRanking.text="20名以后";switch(t){case RankDataType.TYPE_BAOSHI:this.myAttrValue.text=Role.getAllForgeLevelByType(PackageID.Zhuling)+"";break;case RankDataType.TYPE_LONGHUN:this.myAttrValue.text=LongHunData.getLongHunAllLevel()+"";break;case RankDataType.TYPE_WING:this.myAttrValue.text=WingsData.getWingAllLevel()+"";break;case RankDataType.TYPE_BOOK:var i=Book.ins().getBookPowerNumEx();this.myAttrValue.text=i+"";break;case RankDataType.TYPE_ZS:this.myAttrValue.text=UserZs.ins().lv+"";break;case RankDataType.TYPE_SCORE:this.myAttrValue.text=UserBag.ins().getEquipsScoreByRolesOfBody()+"";break;case RankDataType.TYPE_HF_XIAOFEI:this.myAttrValue.text=Activity.ins().myDabiaoInfo?Activity.ins().myDabiaoInfo:0}},e.prototype.updateData=function(){var t=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;t==RankDataType.TYPE_HF_XIAOFEI?this.currentState="hefu":this.currentState="kaifu",this.validateNow();var e,i=GlobalConfig.ActivityConfig[this.activityID],s=GlobalConfig.ActivityType4Config[this.activityID];if(e=this.model?this.model.getDataList():Activity.ins().rankInfoList){var n=Activity.ins().getActivityDataById(this.activityID),o=Math.floor((DateUtils.formatMiniDateTime(n.startTime)-GameServer.serverTime)/1e3),a=Math.floor((DateUtils.formatMiniDateTime(n.endTime)-GameServer.serverTime)/1e3);o>=0?this.actTime.text="活动未开启":0>=a?this.actTime.text="活动已结束":(this._time=a,this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(a,DateUtils.TIME_FORMAT_5,3)),this.actDesc.text=i.desc,t==RankDataType.TYPE_HF_XIAOFEI?this.costRank(e,s):this.normalRank(e,s);var r=GlobalConfig.ActivityBtnConfig[this.activityID];switch(r&&(this.title.source=r.title),t){case RankDataType.TYPE_BAOSHI:this.attr.text="我的铸造总等级：";break;case RankDataType.TYPE_LONGHUN:this.attr.text="我的龙魂总等级：";break;case RankDataType.TYPE_WING:this.attr.text="我的翅膀总等阶：";break;case RankDataType.TYPE_BOOK:this.attr.text="我的图鉴总战力：";break;case RankDataType.TYPE_ZS:this.attr.text="我的总转生：";break;case RankDataType.TYPE_SCORE:this.attr.text="我的装备总评分：";break;case RankDataType.TYPE_HF_XIAOFEI:this.attr.text="我的消费："}if(GlobalConfig.ActivityType4Config[this.activityID][0].titleEffName){var h=GlobalConfig.ActivityType4Config[this.activityID][0].titleEffName;this.titleEffNameMc.playFile(RES_DIR_EFF+h,-1)}else this.titleName.source=GlobalConfig.ActivityType4Config[this.activityID][0].titleName}},e.prototype.costRank=function(t,e){for(var i=0;4>i;i++){this["name"+i]&&(this["name"+i].visible=!1),this["name"+i+"1"]&&(this["name"+i+"1"].visible=!1);var s=i+1;2==i?s=4:3==i&&(s=6);var n=e[s];this["reward"+i].dataProvider=new eui.ArrayCollection(n.rewards),this["attrValue"+i]&&(this["attrValue"+i].visible=!0,this["attrValue"+i].text="要求："+n.value)}var o={idx:1},a=Activity.ins().getActivityDataById(this.activityID);for(var r in t){var h=t[r],l=a.getCostRank(h,o),c=e[l];if(l&&c&&!(l>5))if(1==l)h&&(this.name0.visible=!0,this.attrValue0.visible=this.name0.visible,this.model?(this.name0.text=h.player,this.attrValue0.text=h.value):(this.name0.text=h.name,this.attrValue0.text="消费："+h.numType));else{var u="";if(2==l)u="name1";else if(3==l)u="name11",this.attrValue1.visible=!1;else if(4==l)u="name2";else{if(5!=l)continue;u="name21",this.attrValue2.visible=!1}c=e[l];var p=this[u];p.visible=!0,this.model?p.text=h.player:p.text=h.name}}var d=e[6];this.reward3.dataProvider=new eui.ArrayCollection(d.rewards),this.model&&this.model.selfPos?(this.model.selfPos<=20?this.myRanking.text=this.model.selfPos+"":this.myRanking.text="20名以后",t[this.model.selfPos-1]?this.myAttrValue.text=t[this.model.selfPos-1].value:this.setMyRank()):this.setMyRank()},e.prototype.normalRank=function(t,e){for(var i=1;3>=i;i++){var s=t[i-1];s?(this["name"+(i-1)].visible=!0,this["attrValue"+(i-1)].visible=this["name"+(i-1)].visible,this.model?(this["name"+(i-1)].text=s.player,this["attrValue"+(i-1)].text=s.value):(this["name"+(i-1)].text=s.name,this["attrValue"+(i-1)].text="消费："+s.numType)):(this["name"+(i-1)].visible=!1,this["attrValue"+(i-1)].visible=this["name"+(i-1)].visible);var n=e[i];this["reward"+(i-1)].dataProvider=new eui.ArrayCollection(n.rewards)}var o=e[4];this.reward3.dataProvider=new eui.ArrayCollection(o.rewards),this.model&&this.model.selfPos?(this.model.selfPos<=20?this.myRanking.text=this.model.selfPos+"":this.myRanking.text="20名以后",t[this.model.selfPos-1]?this.myAttrValue.text=t[this.model.selfPos-1].value:this.setMyRank()):this.setMyRank()},e}(BaseView);__reflect(OSATarget4Panel2.prototype,"OSATarget4Panel2");var OSATarget5Panel=function(t){function e(){var e=t.call(this)||this;return e.type5PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initPanelList()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=this.activityID;this.initPanelList(),this.cruPanel=this.type5PanelList[i+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.cruPanel&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t=this.activityID;if(!this.type5PanelList[t+""]){var i=e.targetIndex[t]||"OSATarget5Panel"+GlobalConfig.ActivityType5Config[t][1].showType,s=egret.getDefinitionByName(i);this.type5PanelList[t+""]=new s(this.activityID),this.type5PanelList[t+""].top=0,this.type5PanelList[t+""].bottom=0,this.type5PanelList[t+""].left=0,this.type5PanelList[t+""].right=0,this.type5PanelList[t+""].activityID=this.activityID}},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);OSATarget5Panel.targetIndex={157:"OSATarget5Panel1",210:"OSATarget5Panel2"},__reflect(OSATarget5Panel.prototype,"OSATarget5Panel");var OSATarget5Panel1=function(t){function e(){var e=t.call(this)||this;return e.itemary=[],e.dayindex=1,e.itemList=[],e.skinName="hefuLogSkin",e.itemary=[],e}return __extends(e,t),e.prototype.initData=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType5Config[this.activityID];this.maxNum=0,this.itemList=[];for(var s=0;7>s;s++)this.itemList[s]=this["dayNum"+(s+1)],this.itemList[s].touchEnabled=!1,i[s+1]?(this["dayNum"+(s+1)]&&(this["dayNum"+(s+1)].visible=!0),this["imgDay"+(s+1)]&&(this["imgDay"+(s+1)].visible=!0),this["arrow"+(s+2)]&&(this["arrow"+(s+2)].visible=!0),this.maxNum++):(this["dayNum"+(s+1)]&&(this["dayNum"+(s+1)].visible=!1),this["imgDay"+(s+1)]&&(this["imgDay"+(s+1)].visible=!1),this["arrow"+(s+2)]&&(this["arrow"+(s+2)].visible=!1));this._activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this.suerBtn,this.onTouch),this.addTouchEvent(this.group,this.onTouch);for(var s=0;s<this.maxNum;s++)this.addTouchEvent(this.itemList[s],this.itemTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.changeList),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData();var n=t[0];n&&this.setList(n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.onTouch),this.removeTouchEvent(this.group,this.onTouch),DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.changeList=function(){var t=1,e=this._activityData.getCurDay();e||(e=t),t=e>=this.maxNum?this.maxNum:e;for(var i=1;t>=i;i++){var s=GlobalConfig.ActivityType5Config[this.activityID][i+""];if(s&&e>=s.day&&0==(this._activityData.recrod>>s.day&1))return void this.setList(i)}this.setList(t+1)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.group:this.setList(this.group.getChildIndex(t.target));break;case this.suerBtn:this._activityData.getCurDay()>=this.day?Activity.ins().sendReward(this.activityID,this.day):UserTips.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),t>this.maxNum&&(t=this.maxNum),this.dayindex=t;var e=GlobalConfig.ActivityType5Config[this.activityID][t+""],i=e.rewards;this.day=e.day;var s=1;s=this._activityData.getCurDay(),this.daylabel.text="登陆天数："+s,this.daylabel.visible=!0;var n=1==(this._activityData.recrod>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t)+"天奖励详情",this.suerBtn.visible=!0,s>=this.day?n?(this.daylabel.visible=!1,this.suerBtn.visible=!1,this.redPoint.visible=!1):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=this.suerBtn.width/2,this.btnMC.y=this.suerBtn.height/2,this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var o=0;o<i.length;o++){var a=new ItemBase;this.group1.addChild(a),a.data=i[o],this.itemary.push(a)}for(var o=0;o<this.maxNum;o++)this.itemList[o].activityID=this.activityID,this.itemList[o].data=o+1,o+1==t||o+1==this.maxNum&&t==this.maxNum?this.itemList[o].setSelectImg(!0):this.itemList[o].setSelectImg(!1);this.showRedPoint()},e.prototype.showRedPoint=function(){},e.prototype.updateData=function(){this.changeList(),this.showRedPoint(),this.setTime()},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime.text="活动未开启":0>=e?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget5Panel1.prototype,"OSATarget5Panel1");var ActivityHFRenderItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.activityID,e=Activity.ins().getActivityDataById(t),i=this.data,s=GlobalConfig.ActivityType5Config[t][i+""],n=(e.getCurDay(),1==(e.recrod>>s.day&1));n?(this.select.visible=!1,this.checkedMask.visible=this.checked.visible=!0):this.checkedMask.visible=this.checked.visible=!1,this.item.data=s.rewards[0]},e}(SevenDayItemRender);__reflect(ActivityHFRenderItem.prototype,"ActivityHFRenderItem");var OSATarget5Panel2=function(t){function e(){var e=t.call(this)||this;return e.itemary=[],e.dayindex=1,e.itemList=[],e.skinName="ganenLogSkin",e.itemary=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType5Config[this.activityID];this.maxNum=0,this.itemList=[];for(var s=0;3>s;s++)this.itemList[s]=this["dayNum"+(s+1)],this.itemList[s].touchEnabled=!1,i[s+1]?(this["dayNum"+(s+1)]&&(this["dayNum"+(s+1)].visible=!0),this["imgDay"+(s+1)]&&(this["imgDay"+(s+1)].visible=!0),this["arrow"+(s+1)]&&(this["arrow"+(s+1)].visible=!0),this.maxNum++):(this["dayNum"+(s+1)]&&(this["dayNum"+(s+1)].visible=!1),this["imgDay"+(s+1)]&&(this["imgDay"+(s+1)].visible=!1),this["arrow"+(s+1)]&&(this["arrow"+(s+1)].visible=!1));this._activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this.suerBtn,this.onTouch),this.addTouchEvent(this.group,this.onTouch);for(var s=0;s<this.maxNum;s++)this.addTouchEvent(this.itemList[s],this.itemTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.changeList),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData();var n=t[0];n&&this.setList(n)},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime.text="活动未开启":0>=e?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.onTouch),this.removeTouchEvent(this.group,this.onTouch),DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.changeList=function(){var t=1,e=this._activityData.getCurDay();e||(e=t),t=e>=this.maxNum?this.maxNum:e;for(var i=1;t>=i;i++){var s=GlobalConfig.ActivityType5Config[this.activityID][i+""];if(s&&e>=s.day&&0==(this._activityData.recrod>>s.day&1))return void this.setList(i)}this.setList(t+1)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.group:this.setList(this.group.getChildIndex(t.target));break;case this.suerBtn:this._activityData.getCurDay()>=this.day?Activity.ins().sendReward(this.activityID,this.day):UserTips.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),t>this.maxNum&&(t=this.maxNum),this.dayindex=t;var e=GlobalConfig.ActivityType5Config[this.activityID][t+""],i=e.rewards;this.day=e.day;var s=1;s=this._activityData.getCurDay(),this.daylabel.text="登陆天数："+s,this.daylabel.visible=!0;var n=1==(this._activityData.recrod>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t)+"天奖励详情",this.suerBtn.visible=!0,s>=this.day?n?(this.daylabel.visible=!1,this.suerBtn.visible=!1,this.redPoint.visible=!1):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=this.suerBtn.width/2,this.btnMC.y=this.suerBtn.height/2,this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var o=0;o<i.length;o++){var a=new ItemBase;this.group1.addChild(a),a.data=i[o],this.itemary.push(a)}for(var o=0;o<this.maxNum;o++)this.itemList[o].activityID=this.activityID,this.itemList[o].data=o+1,o+1==t||o+1==this.maxNum&&t==this.maxNum?this.itemList[o].setSelectImg(!0):this.itemList[o].setSelectImg(!1);this.showRedPoint()},e.prototype.showRedPoint=function(){},e.prototype.updateData=function(){this.changeList(),this.showRedPoint(),this.setTime()},e}(BaseView);__reflect(OSATarget5Panel2.prototype,"OSATarget5Panel2");var OSATarget5Panel3=function(t){function e(){var e=t.call(this)||this;return e.itemary=[],e.itemList=[],e.dayindex=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="NYLogSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin();var i=GlobalConfig.ActivityType5Config[this.activityID];this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.itemList=[],this.maxNum=Object.keys(i).length;for(var s=0;s<this.maxNum;s++)this.itemList[s]=this["dayNum"+(s+1)],this.addTouchEvent(this.itemList[s],this.itemTouch),this.itemList[s].item.hideName();this._activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this.suerBtn,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.changeList),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData();var n=t[0];n&&this.setList(n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.onTouch),DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.itemList.length=0,this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.changeList=function(){var t=1,e=this._activityData.getCurDay();e||(e=t),t=e>=this.maxNum?this.maxNum:e;for(var i=1;t>=i;i++){var s=GlobalConfig.ActivityType5Config[this.activityID][i+""];if(e>=s.day&&0==(this._activityData.recrod>>s.day&1))return void this.setList(i)}this.setList(t+1)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.suerBtn:this._activityData.getCurDay()>=this.day?Activity.ins().sendReward(this.activityID,this.day):UserTips.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),t>this.maxNum&&(t=this.maxNum),this.dayindex=t;var e=GlobalConfig.ActivityType5Config[this.activityID][t+""],i=e.rewards;this.day=e.day;var s=1;s=this._activityData.getCurDay(),this.daylabel.text="登陆天数："+s;var n=1==(this._activityData.recrod>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t)+"天奖励详情",this.suerBtn.visible=!0,this.done.visible=!1,s>=this.day?n?(this.suerBtn.visible=!1,this.redPoint.visible=!1,this.done.visible=!0):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=this.suerBtn.width/2,this.btnMC.y=this.suerBtn.height/2,this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var o=0;o<i.length;o++){var a=new ItemBase;this.group1.addChild(a),a.data=i[o],this.itemary.push(a)}for(var o=0;o<this.maxNum;o++)this.itemList[o].activityID=this.activityID,this.itemList[o].data=o+1,o+1==t||o+1==this.maxNum&&t==this.maxNum?this.itemList[o].setSelectImg(!0):this.itemList[o].setSelectImg(!1)},e.prototype.updateData=function(){this.changeList(),this.setTime()},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime1.text="活动未开启":0>=e?this.actTime1.text="活动已结束":this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget5Panel3.prototype,"OSATarget5Panel3");var OSATarget6Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSABoss",e.maxIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.getRule();this.updateData(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.goBtn,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack);for(var i=1;3>=i;i++)this.addTouchEvent(this["boss"+i],this.onClick);this.maxIndex=0;for(var s in GlobalConfig.ActivityType6Config[this.activityID])this.maxIndex++;var n=this.getRule();this.updateData(n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.leftBtn,this.onTap),this.removeTouchEvent(this.rightBtn,this.onTap),this.removeTouchEvent(this.goBtn,this.onTap),this.removeObserve()},e.prototype.onClick=function(t){for(var e=1;3>=e;e++)if(t.currentTarget==this["boss"+e]){var i=this.calcIndex(this.index),s=GlobalConfig.ActivityType6Config[this.activityID][i];s&&s.bossID&&s.jump&&ViewManager.ins().open(s.jump[0][0],s.jump[0][1],s.bossID[e-1][0]);break}},e.prototype.onTap=function(t){var e,i;switch(t.currentTarget){case this.leftBtn:if(--this.index,i=this.calcIndex(this.index),!i)return;e=GlobalConfig.ActivityType6Config[this.activityID][i],(!e||this.index-1<=0)&&(this.index=1,this.leftBtn.visible=!1),this.rightBtn.visible=!0,this.updateData(this.index);break;case this.rightBtn:if(++this.index,i=this.calcIndex(this.index),!i)return;e=GlobalConfig.ActivityType6Config[this.activityID][i],(!e||this.index+1>this.maxIndex)&&(this.index=this.maxIndex,this.rightBtn.visible=!1),this.leftBtn.visible=!0,this.updateData(this.index);break;case this.goBtn:if(i=this.calcIndex(this.index),!i)return;"前往击杀"==this.goBtn.label?(ViewManager.ins().close(ActivityWin),e=GlobalConfig.ActivityType6Config[this.activityID][i],e&&e.bossID&&e.jump&&ViewManager.ins().open(e.jump[0][0],e.jump[0][1],e.bossID[0][0])):Activity.ins().sendReward(this.activityID,i)}},e.prototype.GetCallBack=function(t){if(this.activityID==t){if(!Activity.ins().isSuccee)if(UserBag.ins().getSurplusCount()){UserTips.ins().showTips("领取失败");var e=Activity.ins().getActivityDataById(this.activityID);Activity.ins().sendChangePage(e.id)}else UserTips.ins().showTips("背包已满");Activity.ins().isSuccee=!1;var i=this.getRule();this.updateData(i)}},e.prototype.sortRule=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.getRule=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType6Config[this.activityID],i=0,s=0,n=!1,o=[];for(var a in e)o.push(e[a]);o.sort(this.sortRule);for(var r in o){var h=this.calcIndex(Number(r)),l=t.getBossGroupGiftIndex(o[r]),c=t.getBossGroup(t.rewardsBossSum[h],o[r]);if(l==Activity.Geted);else{if(c==Activity.KILL&&l==Activity.CanGet){(!i||o[r].sort<i)&&(i=o[r].sort,n=!0);break}if(c==Activity.NOKILL&&l==Activity.CanGet){(!s||o[r].sort<s)&&(s=o[r].sort);break}}if(n)break}var u=0;return u=i?i:s,u=u?u:o[0].sort},e.prototype.updateData=function(t){if(void 0===t&&(t=1),t>this.maxIndex)return void(this.index=this.maxIndex);this.index=t;var e=this.calcIndex(this.index);if(e){var i=Activity.ins().getActivityDataById(this.activityID),s=Math.floor((DateUtils.formatMiniDateTime(i.startTime)-GameServer.serverTime)/1e3),n=Math.floor((DateUtils.formatMiniDateTime(i.endTime)-GameServer.serverTime)/1e3);
s>=0?this.actTime.text="活动未开启":0>=n?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_5,3),this.actInfo.text=GlobalConfig.ActivityConfig[this.activityID].desc;for(var o=SubRoles.ins().getSubRoleByIndex(0),a=GlobalConfig.ActivityType6Config[this.activityID][e],r=0,h=0;h<a.rewards.length&&this["item"+r];h++){var l=a.rewards[h];l.job&&o.job!=l.job||(this["item"+r].data={type:l.type,count:l.count,id:l.id},this["item"+r].visible=!0,r++)}for(var c=r;4>c;c++)this["item"+c].visible=!1;for(var u=a.bossID,h=0;3>h;h++)if(this["boss"+(h+1)]){var p=u[h][0],d=GlobalConfig.MonstersConfig[p];this["boss"+(h+1)].source="monhead"+d.head+"_png",this["monName"+h].text=d.name}var g=i.getBossGroupGiftIndex(a),f=i.getBossGroup(i.rewardsBossSum[e],a);this.redPoint.visible=!1,g==Activity.Geted?(this.successBtn.visible=!0,this.goBtn.visible=!1):f==Activity.KILL&&g==Activity.CanGet?(this.goBtn.visible=!0,this.successBtn.visible=!1,this.goBtn.label="领取",this.redPoint.visible=!0):f==Activity.NOKILL&&g==Activity.CanGet&&(this.goBtn.visible=!0,this.successBtn.visible=!1,this.goBtn.label="前往击杀"),this.leftBtn.visible=!0,this.rightBtn.visible=!0,1==this.index?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.index==this.maxIndex&&(this.rightBtn.visible=!1,this.leftBtn.visible=!0);for(var v=i.getBossGroupIndex(i.rewardsBossSum[e],a),h=0;h<v.length;h++)v[h]?this["state"+h].visible=!0:this["state"+h].visible=!1;this.actTitle.source=a.groupName,this.giftTitle.source=a.giftName}},e.prototype.calcSortId=function(t){for(var e in GlobalConfig.ActivityType6Config[this.activityID]){var i=GlobalConfig.ActivityType6Config[this.activityID][e];if(i.index==t)return i.sort}return 0},e.prototype.calcIndex=function(t){for(var e in GlobalConfig.ActivityType6Config[this.activityID]){var i=GlobalConfig.ActivityType6Config[this.activityID][e];if(i.sort==t)return i.index}return 0},e}(ActivityPanel);__reflect(OSATarget6Panel.prototype,"OSATarget6Panel");var OSATarget7Panel4=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDSnowManSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ChritmasSnowMainItem},e.prototype.open=function(){this.addTouchEvent(this.turnBossBtn,this.onTap),this.addTouchEvent(this.arrowUp,this.onTap),this.addTouchEvent(this.arrowDown,this.onTap),TimerManager.ins().doTimer(1e3,0,this.updateTime,this),this.initData()},e.prototype.initData=function(){this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;var t=GlobalConfig.ActivityType7Config[this.activityID],e=[];for(var i in t)e.push(t[i]);e.sort(function(t,e){return t.index<e.index?-1:1}),this.list.dataProvider=new eui.ArrayCollection(e),this.updateTime(),this.updateData()},e.prototype.updateTime=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.numLbl.text=""+t.bossScore;for(var e=this.list.dataProvider,i=0,s=e.source;i<s.length;i++){var n=s[i];e.itemUpdated(n)}},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.turnBossBtn:ViewManager.ins().open(BossWin,1);break;case this.arrowUp:this.arrowTo(-1);break;case this.arrowDown:this.arrowTo(1)}},e.prototype.arrowTo=function(t){var e=this.list.scrollV+130*t;0>e?e=0:e>this.list.contentHeight-this.list.parent.height&&(e=this.list.contentHeight-this.list.parent.height),this.list.scrollV=e},e.prototype.close=function(){this.removeTouchEvent(this.turnBossBtn,this.onTap),this.removeTouchEvent(this.arrowUp,this.onTap),this.removeTouchEvent(this.arrowDown,this.onTap),TimerManager.ins().remove(this.updateTime,this)},e}(BaseView);__reflect(OSATarget7Panel4.prototype,"OSATarget7Panel4");var OSATarget8Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSARingFbSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postChangePage,this.updateView),this.addTouchEvent(this.chanllage,this.onChanllage);var i=0;for(var s in GlobalConfig.ActivityType8Config){var n=GlobalConfig.ActivityType8Config[s][1];if(n.showType=ActivityType8Data.TYPE_RING){i=n.Id;break}}this.updateView()},e.prototype.updateView=function(){var t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType8Config[this.activityID][1];if(e.showType==ActivityType8Data.TYPE_RING){var i=Activity.ins().getCurrentRingAwardIndex(t.record),s=Activity.ins().getRingAward(i);if(s){this.currentState="normal",this.price.setPrice(s.ybCount),this.awardIndex=i,this.needYB=s.ybCount;var n=s.rewardsNum;this.starNum.text=SpecialRing.ins().getCanUpgradeStars(n).toString(),this.rewardsCount.text=n.toString()}else{var o=Activity.ins().getLastRingAward();this.starNum.text=SpecialRing.ins().getCanUpgradeStars(o.rewardsNum).toString(),this.rewardsCount.text=o.rewardsNum.toString(),this.currentState="fullcount",this.price.visible=!1,this.chanllage.visible=!1}}this.actTime.text=t.getRemainTime()},e.prototype.onChanllage=function(){Actor.yb>=this.needYB?(Activity.ins().sendReward(this.activityID,this.awardIndex),Activity.ins().addEvent()):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(ActivityPanel);__reflect(OSATarget8Panel.prototype,"OSATarget8Panel");var OSATarget9Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i;if(this.activityType==ActivityType.Normal?i=GlobalConfig.ActivityType9Config[this.activityID]:this.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivityType9Config[this.activityID]),this.cruPanel&&(1==i[1].showType||3==i[1].showType||4==i[1].showType||(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel))),!this.type2PanelList[this.activityID]){var s=ObjectPool.pop("OSATarget9Panel"+i[1].showType);s.top=0,s.bottom=0,s.left=0,s.right=0,s.activityID=this.activityID,this.type2PanelList[this.activityID+""]=s}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget9Panel.prototype,"OSATarget9Panel");var OSATarget9Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve();for(var i=0;3>i;i++)this.removeTouchEvent(this["isget"+i],this.onGiftClick);egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var s,n;this.actType==ActivityType.Normal?(n=Activity.ins(),s=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(n=PActivity.ins(),s=PActivity.ins().activityData[this.activityID]),s&&1==s.indexs.length&&n.sendReward(this.activityID,1),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var i;this.actType==ActivityType.Normal?i=Activity.ins():this.actType==ActivityType.Personal&&(i=PActivity.ins()),this.observe(i.postChangePage,this.resultCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery);for(var s=0;3>s;s++)this.addTouchEvent(this["isget"+s],this.onGiftClick);this.list.itemRenderer=NoticeListRenderer,this.turnten.selected=!1,this.currentState="unReset",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.getkey:}},e.prototype.updateData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType9Config[this.activityID][0]):this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID],e=GlobalConfig.PActivityType9Config[this.activityID][0]);var i=GlobalConfig.ItemConfig[e.item];if(i){this.icon.source=i.icon+"_png";var s=UserBag.ins().getBagItemById(i.id),n=0,o=1,a=13746831;s?(n=s.count,a=n>=o?ColorUtil.GREEN:ColorUtil.RED):a=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:"+n+"|C:0xD1C28F&T:/"+o),this.pay0.text=e.yb+""}var r;this.actType==ActivityType.Normal?r=GlobalConfig.ActivityType9Config:this.actType==ActivityType.Personal&&(r=GlobalConfig.PActivityType9Config);for(var h in r[this.activityID])if(+h){var l=r[this.activityID][h],s=this["item"+(+h-1)];s.itemIcon.data=l.reward[0],s.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=PActivity.ins().activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void UserTips.ins().showTips("正在抽奖，请稍候");var t,e;this.actType==ActivityType.Normal?(t=Activity.ins(),e=GlobalConfig.ActivityType9Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins(),e=GlobalConfig.PActivityType9Config[this.activityID]),this.turnten.selected?t.getIsRollTen(this.activityID)?t.sendReward(this.activityID,2):UserTips.ins().showTips("元宝不足"):t.getRollSum(this.activityID)||Actor.yb>=e[0].yb?t.sendReward(this.activityID,1):UserTips.ins().showTips("元宝不足")},e.prototype.onGiftClick=function(t){for(var e=0;3>e;e++)if(t.currentTarget==this["isget"+e]){var i=this["gift"+e].getItemIcon();this.flyItemEx(i),Activity.ins().sendReward(this.activityID,0,e+1);break}},e.prototype.updateProgress=function(){var t,e;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config[this.activityID],e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID],e=PActivity.ins().activityData[this.activityID]);var i=t[0];if(i&&e){this.turntime.text=e.count+"";for(var s=0;3>s;s++){if(this["turntime"+s].text=i.reward[s].times,this["gift"+s].data={id:i.reward[s].id,type:i.reward[s].type,count:i.reward[s].count},this["gift"+s].isShowName(!1),this["bar"+s].maximum=100,this["lingqu"+s].touchEnabled=!1,e.record>>s+1&1)this["bar"+s].value=100,this["lingqu"+s].visible=!0,this["isget"+s].touchEnabled=!1;else if(this["lingqu"+s].visible=!1,e.count>=i.reward[s].times)this["bar"+s].value=100,this["isget"+s].touchEnabled=!0;else{var n=i.reward[s-1],o=e.count,a=i.reward[s].times;n&&(o=e.count-n.times,a=i.reward[s].times-n.times),o=o>0?o:0,this["bar"+s].value=Math.floor(o/a*100),this["isget"+s].touchEnabled=!1}this.updateRedPoint(this.activityID,s)}}},e.prototype.updateRedPoint=function(t,e){var i;this.actType==ActivityType.Normal?i=Activity.ins():this.actType==ActivityType.Personal&&(i=PActivity.ins());var s=i.isGetRollReward(t,e);this["redPoint"+e].visible=s},e.prototype.listRefush=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID]),t){for(var e=[],i=0;i<t.noticeArr.length;i++){var s={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].index,actType:this.actType};e.push(s)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID]),t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel1.prototype,"OSATarget9Panel1");var OSATarget9Panel2=function(t){function e(){var e=t.call(this)||this;return e._curAwardPage=1,e._maxAwardPages=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.list.itemRenderer=ItemBase,this.list0.itemRenderer=NoticeListRenderer;for(var t,e,i=[],s=1;8>=s;s++)this.actType==ActivityType.Normal?t=GlobalConfig.ActivityType9Config[this.activityID][s]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID][s]),e=new RewardData,e.type=t.reward[0].type,e.id=t.reward[0].id,e.count=t.reward[0].count,i[s-1]=e;this.list.dataProvider=new ArrayCollection(i)},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,isNaN(this.actType)&&(this.actType=ActivityPanel.getActivityTypeFromId(this._activityID)),this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="NYFireworkerSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.init();var i;this.actType==ActivityType.Normal?(i=Activity.ins(),this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc):this.actType==ActivityType.Personal&&(i=PActivity.ins(),this.actInfo1.text=GlobalConfig.PActivityConfig[this.activityID].desc),this.observe(i.postActivityIsGetAwards,this.updateData),this.observe(i.postChangePage,this.resultCallBack),this.addTouchEvent(this,this.onTouch),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.removeTouchEvent(this,this.onTouch),TimerManager.ins().removeAll(this),DisplayUtils.removeFromParent(this._fireEff),this.turnten.selected=!1},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagGoodsByTypeAndId(0,this.config.item),e=t?t.count:0;this.costNum.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(e?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|")},e.prototype.onTouch=function(t){switch(t.target){case this.buyBtn:var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,this.config.item);if(e&&e.count)this.onSend();else{var i=this.turnten.selected?10:1,s=this.config.yb*i;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+(10==i?"-10":"-1"),this.huntWarnFun.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[this.config.item].name+"*"+i)}break;case this.reward0:case this.reward1:case this.reward2:case this.reward3:var n=t.target.data;0==n.state?ViewManager.ins().open(ItemDetailedWin,0,n.id,n.count):1==n.state&&(this.flyItemEx(t.target),this.ins.sendReward(this.activityID,0,n.index));break;case this.arrowleft:this._curAwardPage>1&&(this._curAwardPage--,this.updateAwardPage());break;case this.arrowright:this._curAwardPage<this._maxAwardPages&&(this._curAwardPage++,this.updateAwardPage())}},e.prototype.huntWarnFun=function(){var t=this.turnten.selected?10:1,e=this.config.yb*t;Actor.yb>=e?this.onSend():UserTips.ins().showTips("元宝不足")},e.prototype.onSend=function(){this.turnten.selected?this.ins.sendReward(this.activityID,2):(this.ins.sendReward(this.activityID,1),this.ins.sendReward(this.activityID,1),this._fireEff||(this._fireEff=new MovieClip),this._fireEff.parent||(this.effLocation.addChild(this._fireEff),this._fireEff.scaleX=this.effLocation.scaleX,this._fireEff.scaleY=this.effLocation.scaleY),this._fireEff.playFile(RES_DIR_EFF+"yanhuaeff",1))},e.prototype.setCurAwardPage=function(){var t,e;if(this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config[this.activityID][0],e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID][0],e=PActivity.ins().activityData[this.activityID]),this._maxAwardPages=t.reward.length/4,!e)return void(this._curAwardPage=1);for(var i=t.reward.length,s=0;i>s;s++)if(!(e.record>>s+1&1))return void(this._curAwardPage=Math.floor(s/4)+1);this._curAwardPage=1},e.prototype.updateData=function(){var t,e;if(this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config=GlobalConfig.ActivityType9Config[this.activityID][0],t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config=GlobalConfig.PActivityType9Config[this.activityID][0],t=PActivity.ins().activityData[this.activityID],e=GlobalConfig.PActivityType9Config),this.price.setText(this.config.yb+""),this.price.setType(MoneyConst.yuanbao),this.costIcon.source=GlobalConfig.ItemConfig[this.config.item].icon+"_png",this.setCurAwardPage(),this.updateAwardPage(),this._recordCollect||(this._recordCollect=new ArrayCollection,this.list0.dataProvider=this._recordCollect),t){for(var i=[],s=t.noticeArr.length,n=void 0,o=0;s>o;o++){var a=e[this.activityID][t.noticeArr[o].index];n={activityID:this.activityID,name:t.noticeArr[o].name,index:t.noticeArr[o].index,des:a?a.middleDesc:null},i.push(n)}this._recordCollect.source=i}else this._recordCollect.source=null;this.setTime(),this.updateMaterial()},e.prototype.updateAwardPage=function(){var t,e;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config,e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config,e=PActivity.ins().activityData[this.activityID]),this.arrowleft.visible=this._curAwardPage>1,this.arrowright.visible=this._curAwardPage<this._maxAwardPages;var i=t[this.activityID][0];if(this.redPointLeft.visible=this.redPointRight.visible=!1,e)for(var s=e.count,n=0,o=0,a=0,r=0,h=1;h<=this._maxAwardPages;h++)for(var l=0;4>l;l++)if(n=4*(h-1)+l,o=e.record>>n+1&1?2:s>=i.reward[n].times?1:0,h==this._curAwardPage)this["reward"+l].data={id:i.reward[n].id,type:i.reward[n].type,count:i.reward[n].count,index:n+1,state:o,times:i.reward[n].times,curTimes:s},l>0&&(a=this["reward"+l].data.times,s>=a?(this["bar"+(l-1)].maximum=100,this["bar"+(l-1)].value=100):(r=this["reward"+(l-1)].data.times,this["bar"+(l-1)].maximum=a-r,this["bar"+(l-1)].value=r>=s?0:s-r));else if(h<this._curAwardPage){if(1==o){this.redPointLeft.visible=!0;break}}else if(1==o){this.redPointRight.visible=!0;break}},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=PActivity.ins().activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1&&ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs),this.updateMaterial())},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.box.source);e.x=t.box.x,e.y=t.box.y,e.width=t.box.width,e.height=t.box.height,e.scaleX=t.box.scaleX,e.scaleY=t.box.scaleY,t.box.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID]),this.actTime1.text=t.getRemainTime()},e}(BaseView);__reflect(OSATarget9Panel2.prototype,"OSATarget9Panel2");var OSATarget9Panel3=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i;this.actType==ActivityType.Normal?i=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(i=PActivity.ins().activityData[this.activityID]),i&&1==i.indexs.length&&this.ins.sendReward(this.activityID,1),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.config9=GlobalConfig.ActivityType9Config,this.ins=Activity.ins()):this.actType==ActivityType.Personal&&(this.config9=GlobalConfig.PActivityType9Config,this.ins=PActivity.ins()),this.observe(this.ins.postChangePage,this.resultCallBack),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.addTouchEvent(this.rightBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeListRenderer,this.menuList.itemRenderer=OSATarget9Panel3ItemRender,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.turnten.selected=!1,this.currentState="reset",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.currentTarget){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.updateBtn();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.updateBtn()}},e.prototype.updateData=function(){var t;this.actType==ActivityType.Normal?t=this.config9[this.activityID][0]:this.actType==ActivityType.Personal&&(t=this.config9[this.activityID][0]);var e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=UserBag.ins().getBagItemById(e.id),s=0,n=1,o=13746831;i?(s=i.count,o=s>=n?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+s+"|C:0xD1C28F&T:/"+n),this.pay0.text=t.yb+""}for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=PActivity.ins().activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush(),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0;var n;this.actType==ActivityType.Normal?n=Activity.ins():this.actType==ActivityType.Personal&&(n=PActivity.ins()),s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){n.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void UserTips.ins().showTips("正在抽奖，请稍候");if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t;this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins());var e=this.config9[this.activityID][0];if(this.turnten.selected){var i=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,e.item);if(i&&i.count)t.sendReward(this.activityID,2);else{var s=10,n=e.yb*s;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.checkSend10.bind(this),"是否消耗"+n+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+s)}}else{var i=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,e.item);if(i&&i.count)t.sendReward(this.activityID,1);else{var s=1,n=1*e.yb;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.checkSend1.bind(this),"是否消耗"+n+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+s)}}},e.prototype.checkSend1=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins()),t.getRollSum(this.activityID)||Actor.yb>=this.config9[this.activityID][0].yb?t.sendReward(this.activityID,1):UserTips.ins().showTips("元宝不足")},e.prototype.checkSend10=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins()),t.getIsRollTen(this.activityID)?t.sendReward(this.activityID,2):UserTips.ins().showTips("元宝不足")},e.prototype.updateProgress=function(){var t,e,i=this;this.actType==ActivityType.Normal?(e=Activity.ins(),t=e.activityData[this.activityID]):this.actType==ActivityType.Personal&&(e=PActivity.ins(),t=e.activityData[this.activityID]);var s=this.config9[this.activityID][0],n=[];if(s&&t){for(var o=0;o<s.reward.length;o++){var a={index:o,config:s,actType:this.actType};n.push(a)}this.menuListData.replaceAll(n)}this.menuList.validateNow(),TimerManager.ins().doNext(function(){for(var e=0,s=1;s<=i.menuListData.length;s++)if(0==t.getStateByIndex(s)){e=90*(s-1);break}e>i.menuList.contentWidth-i.menuList.width&&(e=i.menuList.contentWidth-i.menuList.width),i.menuList.scrollH=e,i.updateBtn()},this)},e.prototype.updateBtn=function(){this.menuListData.length<=5?this.rightBtn.visible=this.rightRed.visible=this.leftBtn.visible=this.leftRed.visible=!1:this.onChange()},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=this.leftRed.visible=!1,this.rightBtn.visible=this.rightRed.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!1):(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){var t,e=this.config9[this.activityID][0];this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins());for(var i=!1,s=0;s<e.reward.length&&!(i=t.isGetRollReward(this.activityID,s));s++);this.leftBtn.visible&&(this.leftRed.visible=i),this.rightBtn.visible&&(this.rightRed.visible=i)},e.prototype.listRefush=function(){var t,e;if(this.actType==ActivityType.Normal?(t=Activity.ins(),e=t.activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins(),e=t.activityData[this.activityID]),e){for(var i=[],s=0;s<e.noticeArr.length;s++){var n={activityID:this.activityID,name:e.noticeArr[s].name,index:e.noticeArr[s].index,actType:this.actType};i.push(n)}this.list.dataProvider=new eui.ArrayCollection(i)}},e.prototype.setTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins(),e=t.activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins(),e=t.activityData[this.activityID]),e&&(this.actTime.text="剩余时间："+e.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel3.prototype,"OSATarget9Panel3");var OSATarget9Panel3ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isget.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)},e.prototype.onTap=function(t){var e=this.gift.getItemIcon();this.flyItemEx(e),this.ins.sendReward(this.activityID,0,this.index+1)},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data&&(this.data.config instanceof ActivityType9Config||this.data.config instanceof PActivity9Config)){this.actType=this.data.actType;var e=this.data.config;this.activityID=e.Id;var i,s=this.index=this.data.index;if(this.actType==ActivityType.Normal?(this.ins=Activity.ins(),i=this.ins.activityData[e.Id]):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),i=this.ins.activityData[e.Id]),i){this.targetTime.text="/"+e.reward[s].times,this.gift.data={id:e.reward[s].id,type:e.reward[s].type,count:e.reward[s].count},this.gift.isShowName(!1),this.lingqu.touchEnabled=!1;var n=0,o=i.count>=e.reward[s].times?e.reward[s].times:i.count;if(i.record>>s+1&1)this.lingqu.visible=!0,this.isget.touchEnabled=!1,n=65280;else if(this.lingqu.visible=!1,i.count>=e.reward[s].times)this.isget.touchEnabled=!0,n=65280;else{var a=e.reward[s-1],r=i.count,h=e.reward[s].times;a&&(r=i.count-a.times,h=e.reward[s].times-a.times),r=r>0?r:0,this.isget.touchEnabled=!1,n=16711680}this.alreadyTime.textFlow=TextFlowMaker.generateTextFlow1("|C:"+n+"&T:"+o),this.updateRedPoint(this.activityID,s)}}},e.prototype.updateRedPoint=function(t,e){var i=this.ins.isGetRollReward(t,e);this.redPoint.visible=i},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e}(BaseItemRender);__reflect(OSATarget9Panel3ItemRender.prototype,"OSATarget9Panel3ItemRender");var OSATarget9Panel4=function(t){function e(){var e=t.call(this)||this;return e.huntType=1,e.skinName="luckyTurntableSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i;this.actType==ActivityType.Normal?i=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(i=this.ins.activityData[this.activityID]),i&&1==i.indexs.length&&this.ins.sendReward(this.activityID,1),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config),this.observe(this.ins.postChangePage,this.resultCallBack),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.addTouchEvent(this.rightBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeListRenderer,this.menuList.itemRenderer=OSATarget9Panel3ItemRender,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.turnten.selected=!1,this.currentState="resetWithKey",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.currentTarget){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.updateBtn();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.updateBtn()
}},e.prototype.updateData=function(){var t=this.config9[this.activityID][0],e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=UserBag.ins().getBagItemById(e.id),s=0,n=1,o=13746831;i?(s=i.count,o=s>=n?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+s+"|C:0xD1C28F&T:/"+n),this.pay0.text=t.yb+""}for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=this.ins.activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush(),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.ins.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void UserTips.ins().showTips("正在抽奖，请稍候");if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);this.huntType=this.turnten.selected?2:1;var t=this.config9[this.activityID][0],e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,t.item);if(e&&e.count)this.ins.sendReward(this.activityID,this.huntType);else{var i=2==this.huntType?10:1;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+(10==i?"-10":"-1"),this.huntWarnFun.bind(this),"是否消耗"+t.yb*i+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}},e.prototype.huntWarnFun=function(){var t=this.config9[this.activityID][0],e=2==this.huntType?10:1;Actor.yb>=t.yb*e?this.ins.sendReward(this.activityID,this.huntType):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.updateProgress=function(){var t,e=this,i=this.config9[this.activityID][0];this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]);var s=[];if(i&&t){for(var n=0;n<i.reward.length;n++){var o={index:n,config:i,actType:this.actType};s.push(o)}this.menuListData.replaceAll(s)}this.menuList.validateNow(),TimerManager.ins().doNext(function(){for(var i=0,s=1;s<=e.menuListData.length;s++)if(0==t.getStateByIndex(s)){i=90*(s-1);break}i>e.menuList.contentWidth-e.menuList.width&&(i=e.menuList.contentWidth-e.menuList.width),e.menuList.scrollH=i,e.updateBtn()},this)},e.prototype.updateBtn=function(){this.menuListData.length<=5?this.rightBtn.visible=this.rightRed.visible=this.leftBtn.visible=this.leftRed.visible=!1:this.onChange()},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=this.leftRed.visible=!1,this.rightBtn.visible=this.rightRed.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!1):(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){for(var t=this.config9[this.activityID][0],e=!1,i=0;i<t.reward.length&&!(e=this.ins.isGetRollReward(this.activityID,i));i++);this.leftBtn.visible&&(this.leftRed.visible=e),this.rightBtn.visible&&(this.rightRed.visible=e)},e.prototype.listRefush=function(){var t;if(this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t){for(var e=[],i=0;i<t.noticeArr.length;i++){var s={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].index,actType:this.actType};e.push(s)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel4.prototype,"OSATarget9Panel4");var OSATarget9Panel5=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="XNluckyTurntableSkin"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i;this.actType==ActivityType.Normal?i=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(i=this.ins.activityData[this.activityID]),i&&1==i.indexs.length&&this.ins.sendReward(this.activityID,1),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin(),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config),this.observe(this.ins.postChangePage,this.resultCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeListRenderer,this.turnten.selected=!1,this.currentState="resetWithKey",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){t.currentTarget},e.prototype.updateData=function(){var t=this.config9[this.activityID][0],e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=UserBag.ins().getBagItemById(e.id),s=0,n=1,o=13746831;i?(s=i.count,o=s>=n?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+s+"|C:0xD1C28F&T:/"+n),this.pay0.text=t.yb+""}for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=this.ins.activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush(),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.ins.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void UserTips.ins().showTips("正在抽奖，请稍候");if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t=this.config9[this.activityID][0];if(this.turnten.selected){var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,t.item);if(e&&e.count)this.ins.sendReward(this.activityID,2);else{var i=10,s=t.yb*i;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.checkSend10.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}}else{var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,t.item);if(e&&e.count)this.ins.sendReward(this.activityID,1);else{var i=1,s=1*t.yb;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.checkSend1.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}}},e.prototype.checkSend10=function(){this.ins.getIsRollTen(this.activityID)?this.ins.sendReward(this.activityID,2):UserTips.ins().showTips("元宝不足")},e.prototype.checkSend1=function(){this.ins.getRollSum(this.activityID)||Actor.yb>=this.config9[this.activityID][0].yb?this.ins.sendReward(this.activityID,1):UserTips.ins().showTips("元宝不足")},e.prototype.updateRedPoint=function(){for(var t=this.config9[this.activityID][0],e=!1,i=0;i<t.reward.length&&!(e=this.ins.isGetRollReward(this.activityID,i));i++);},e.prototype.listRefush=function(){var t;if(this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t){for(var e=[],i=0;i<t.noticeArr.length;i++){var s=this.config9[this.activityID][t.noticeArr[i].index],n={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].index,actType:this.actType,des:s?s.middleDesc:null};e.push(n)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel5.prototype,"OSATarget9Panel5");var OSATargetDays42ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.get0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.rewardList.itemRenderer=ItemBase},e.prototype.onTap=function(t){Recharge.ins().getRechargeTotalAward(this.data.id)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.num.text=e.id+"",this.rewardList.dataProvider=new eui.ArrayCollection(e.awardList),Recharge.ins().rechargeTotal.hasGetDays.indexOf(e.id)>=0?(this.get0.visible=!1,this.already.visible=!0):(this.get0.visible=!0,this.already.visible=!1,e.id<=Recharge.ins().rechargeTotal.totalDay?(this.get0.label="领取",this.get0.enabled=!0):(this.get0.label="未完成",this.get0.enabled=!1))},e}(BaseItemRender);__reflect(OSATargetDays42ItemRender.prototype,"OSATargetDays42ItemRender");var OSATargetDays42ItemRender2=function(t){function e(){var e=t.call(this)||this;return e.skinName="Days42BigRewardItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.days.text="",e.awardList.length>1?this.reward.data=e.awardList[1]:this.reward.data=e.awardList[0],Recharge.ins().rechargeTotal.hasGetDays.length>=42?this.state.visible=!0:Recharge.ins().rechargeTotal.hasGetDays.indexOf(e.id)>=0?this.state.visible=!0:this.state.visible=!1},e}(BaseItemRender);__reflect(OSATargetDays42ItemRender2.prototype,"OSATargetDays42ItemRender2");var OSATargetItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.isGet=!0},e.prototype.onClick=function(t){switch(t.target){case this.get:var e=void 0,i=void 0;if(GlobalConfig.PActivityBtnConfig[this.actId]?(e=GlobalConfig.PActivityType1Config[this.actId][this.index],i=PActivity.ins()):(e=GlobalConfig.ActivityType1Config[this.actId][this.index],i=Activity.ins()),this.isGet)i.sendReward(this.actId,this.index);else{var s=0;switch(e.showType){case ShowType.LEVEL:Actor.level<e.level?s=e.level-Actor.level:UserZs.ins().lv<e.zslevel&&(s=e.zslevel-UserZs.ins().lv);break;case ShowType.WING:WingsData.getWingAllLevel()<e.wingLv&&(s=e.wingLv-WingsData.getWingAllLevel());break;case ShowType.ZHUZAO:Role.getAllForgeLevelByType(PackageID.Zhuling)<e.zzLv&&(s=e.zzLv-Role.getAllForgeLevelByType(PackageID.Zhuling));break;case ShowType.LONGHUN:LongHunData.getLongHunAllLevel()<e.lhLv&&(s=e.lhLv-LongHunData.getLongHunAllLevel());break;case ShowType.BOOK:var n=Book.ins().getBookPowerNumEx();n<e.tjPower&&(s=e.tjPower-n);break;case ShowType.EQUIP:var o=UserBag.ins().getEquipsScoreByRolesOfBody();o<e.equipPower&&(s=e.equipPower-o);break;case ShowType.XIAOFEI:var a=Activity.ins().getActivityDataById(this.actId);a.hFTotalConsumption<e.consumeYuanbao&&(s=e.consumeYuanbao-a.hFTotalConsumption);break;case ShowType.RING:var r=0,h=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);h&&h.level&&(r=h.level),r<e.huoyanRingLv&&(s=e.huoyanRingLv-r);break;case ShowType.SAMSARA:Actor.samsaraLv<e.lunhLv&&(s=e.lunhLv-Actor.samsaraLv)}if(!s)return void Activity.ins().sendReward(this.actId,this.index);e.showType==ShowType.LEVEL&&UserZs.ins().lv<e.zslevel?UserTips.ins().showTips(+s+"转之后即可领取奖励"):e.showType==ShowType.BOOK?UserTips.ins().showTips("再升"+s+"图鉴战力之后即领取奖励"):e.showType==ShowType.EQUIP?UserTips.ins().showTips("再升"+s+"装备评分之后即领取奖励"):e.showType==ShowType.XIAOFEI?UserTips.ins().showTips("再消费"+s+"之后即领取奖励"):UserTips.ins().showTips("再升"+s+"级即可领取奖励")}}},e.prototype.dataChanged=function(){if(this.data){var t,e=this.data;t=GlobalConfig.PActivityBtnConfig[e.Id]?PActivity.ins().getActivityDataById(e.Id):Activity.ins().getActivityDataById(e.Id),this.ActivityShowType(e);for(var i=SubRoles.ins().getSubRoleByIndex(0),s=0,n=0;3>n;n++)this["item"+n].visible=!1;for(var n=0;n<e.rewards.length;n++){var o=e.rewards[n];o.job&&o.job!=i.job||(this["item"+s].visible=!0,this["item"+s].data={type:o.type,count:o.count,id:o.id},s++)}var a=t.getRewardStateById(e.index),r=t.rewardsSum[e.index],h=e.total?e.total-r:1;switch(h=h>0?h:0,this.redPoint.visible=!1,a){case Activity.NotReached:h>0?this.currentState="can":this.currentState="zero",this.isGet=!1;break;case Activity.CanGet:h>0?(this.currentState="can",this.redPoint.visible=!0):this.currentState="zero";break;case Activity.Geted:this.currentState="already"}this.get.touchEnabled=this.redPoint.visible,this.get.touchEnabled?(this.get.label="领取",this.get.currentState="up"):(this.get.label="未完成",this.get.currentState="disabled"),this.num.visible=!0,e.total?this.num.text="剩余"+h+"份":this.num.visible=!1,this.actId=e.Id,this.index=e.index,e.showType==ShowType.XIAOFEI?(this.target.visible=this.recharge.visible=!0,this.target.visible=!1,this.recharge.text=t.hFTotalConsumption+"/"+e.consumeYuanbao):this.target.visible=this.recharge.visible=!1,this.validateNow()}},e.prototype.getRedPoint=function(t){switch(t.showType){case ShowType.LEVEL:var e=t.level?t.level:0,i=t.zslevel?t.zslevel:0;if(Actor.level>=e&&UserZs.ins().lv>=i)return!0;break;case ShowType.LEVEL:if(WingsData.getWingAllLevel()>=t.wingLv)return!0;break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)>=t.zzLv)return!0;break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()>=t.lhLv)return!0;break;case ShowType.BOOK:var s=Book.ins().getBookPowerNumEx();if(s>=t.tjPower)return!0;break;case ShowType.EQUIP:var n=UserBag.ins().getEquipsScoreByRolesOfBody();if(n>=t.equipPower)return!0;break;case ShowType.XIAOFEI:var o=Activity.ins().getActivityDataById(this.actId);if(o.hFTotalConsumption>=t.consumeYuanbao)return!0;break;case ShowType.RING:var a=0,r=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);return r&&r.level&&(a=r.level),a>=t.huoyanRingLv;case ShowType.SAMSARA:if(Actor.samsaraLv>=t.lunhLv)return!0;break;default:return!1}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.ActivityShowType=function(t){switch(t.showType){case ShowType.LEVEL:this.lvName.text="等级",t.zslevel?this.lvName0.text=t.zslevel+"转":this.lvName0.text=t.level+"",15==t.Id&&(this.lvName.text="转生数",this.lvName0.text=t.zslevel+"转");break;case ShowType.WING:this.lvName.text="总等阶",this.lvName0.text=t.wingLv+"";break;case ShowType.ZHUZAO:this.lvName.text="总等级",this.lvName0.text=t.zzLv+"";break;case ShowType.LONGHUN:this.lvName.text="总星数",this.lvName0.text=t.lhLv+"";break;case ShowType.BOOK:this.lvName.text="战力",this.lvName0.text=t.tjPower+"";break;case ShowType.EQUIP:this.lvName.text="评分",this.lvName0.text=t.equipPower+"";break;case ShowType.XIAOFEI:this.lvName.text="消费",this.lvName0.text=t.consumeYuanbao+"";break;case ShowType.RING:this.lvName.text="特戒等级";var e=t.huoyanRingLv,i=SpecialRing.ins().getRingStair(e),s=SpecialRing.ins().getRingStar(e);this.lvName0.text=i+"阶"+s+"星";break;case ShowType.SAMSARA:this.lvName.text="轮回等级";var n=SamsaraModel.ins().getSamsara(t.lunhLv),o=SamsaraModel.ins().getSamsaraLv(t.lunhLv),a=SamsaraModel.ins().getSamsaraDesc(n)+"·"+SamsaraModel.ins().getSamsaraLvDesc(o);this.lvName0.textFlow=TextFlowMaker.generateTextFlow1(t.lunhLv+"\n|S:16&T:"+a);break;case ShowType.ZHANLING:this.lvName.text="战灵等阶";var r=t.zhanlingLv;this.lvName0.text=Math.ceil(r/10)+"阶"+(r%10==0?r?10:0:r%10)+"星"}},e}(BaseItemRender);__reflect(OSATargetItemRenderer.prototype,"OSATargetItemRenderer");var OSATargetItemRender1=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSADailyGiftItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.reward.itemRenderer=ItemBase},e.prototype.onClick=function(t){switch(t.target){case this.get:if(this.isGet)this.data instanceof ActivityType2Config?Activity.ins().sendReward(this.actId,this.index):this.data instanceof PActivity2Config&&PActivity.ins().sendReward(this.actId,this.index);else{var e=this.data;e&&(UserVip.ins().lv<e.vip?UserTips.ins().showTips("|C:0xff0000&T:VIP等级不满足要求|"):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"))}}},e.prototype.dataChanged=function(){if(this.data){var t,e;if(this.data instanceof ActivityType2Config?(t=this.data,e=Activity.ins().getActivityDataById(t.Id)):this.data instanceof PActivity2Config&&(t=this.data,e=PActivity.ins().getActivityDataById(t.Id)),!t||!e)return void(this.isGet=!1);this.redPoint.visible=!1,e.buyData[t.index]>=t.count?(this.isGet=!1,this.already.visible=!0):(this.isGet=UserVip.ins().lv>=t.vip&&Actor.yb>=t.price,this.already.visible=!1,this.redPoint.visible=this.getRedPoint(t));var i=t.count-e.buyData[t.index];i=0>=i?0:i;var s=i?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1("可购买：|C:"+s+"&T:"+i+"|/"+t.count),this.times.visible=this.get.visible=!this.already.visible,this.original.text=t.originalPrice+"",this.now.text=t.price+"",this.reward.dataProvider=new eui.ArrayCollection(t.rewards),this.actId=t.Id,this.index=t.index,this.discountNum.text=t.discount+"",t.vip?(this.vip.visible=!0,this.vipLv.text=t.vip+""):this.vip.visible=!1,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1)}},e.prototype.getRedPoint=function(t){return UserVip.ins().lv>=t.vip&&Actor.yb>=t.price},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(OSATargetItemRender1.prototype,"OSATargetItemRender1");var OSATargetItemRender4=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSARankListItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.reward.itemRenderer=ItemBase},e.prototype.onClick=function(t){},e.prototype.dataChanged=function(){if(this.data.rankData){var t,e=this.data.rankData,i=this.data.activityID,s=GlobalConfig.ActivityType4Config[i][1],n=s.rankType;if(n==RankDataType.TYPE_HF_XIAOFEI)if(e instanceof DabiaoData){var o=this.data.rank?this.data.rank:e.rankIndex;3>=o?(this.rankImg.source="paihang"+o,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=o+""),this.name1.text=e.name,this.value.text=e.numType,t=o,t=1==t?1:2==t||3==t?2:4==t||5==t?4:6,s=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(s.rewards)}else{var o=this.data.rank?this.data.rank:e.pos;3>=o?(this.rankImg.source="paihang"+o,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=o),this.name1.text=e.player,this.value.text=e.value,t=o,t=1==t?1:2==t||3==t?2:4==t||5==t?4:6,s=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(s.rewards)}else e instanceof DabiaoData?(e.rankIndex<=3?(this.rankImg.source="paihang"+e.rankIndex,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=e.rankIndex+""),this.name1.text=e.name,this.value.text=e.numType,t=e.rankIndex,t>4&&(t=4),s=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(s.rewards)):(e.pos<=3?(this.rankImg.source="paihang"+e.pos,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=e.pos),this.name1.text=e.player,this.value.text=e.value,t=e.pos,s=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(s.rewards))}},e}(BaseItemRender);__reflect(OSATargetItemRender4.prototype,"OSATargetItemRender4");var SanbaWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="sanbaWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn0.visible=!1,this.rightBtn0.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn0.visible=!0,this.rightBtn0.visible=!1):(this.leftBtn0.visible=!0,this.rightBtn0.visible=!0),this.leftRed0.visible=this.rightRed0.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn0.visible=!1,this.rightBtn0.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn0.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed0.visible=!0;break}if(this.rightBtn0.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed0.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];for(var e in Activity.ins().activityData)Activity.ins().activityData[e].pageStyle==ActivityPageStyle.SANBA&&Activity.ins().getActivityDataById(+e).isOpenActivity()&&!Activity.ins().getActivityDataById(+e).getHide()&&this._datas.push(Activity.ins().getbtnInfo(e));this._datas.sort(this.sort),t=0;for(var e in this._datas){var i=this._datas[e].id,s=Activity.ins().getActivityDataById(+i),n=ActivityPanel.create(i,s.activityType);n.top=0,n.left=0,n.bottom=0,n.right=0,this.activityPanelList[t]=n,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn0:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn0:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(SanbaWin.prototype,"SanbaWin"),ViewManager.ins().reg(SanbaWin,LayerManager.UI_Main);var ActivityStoreRewardShowWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="activityStoreRewardShowSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.shopList.itemRenderer=ActivityStoreShowItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._activityID=t[0],this.update(),this.addTouchEvent(this.bgClose,this.onTouch)},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)},e.prototype.update=function(){var t=Activity.ins().getConfig22_3(this._activityID);this.shopList.dataProvider=new ArrayCollection(t?t.showReward:null)},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ActivityStoreRewardShowWin.prototype,"ActivityStoreRewardShowWin"),ViewManager.ins().reg(ActivityStoreRewardShowWin,LayerManager.UI_Main);var ActivityStoreItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="activityStoreItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.buyBtn.label=this.data.isScore?"兑 换":"购 买",this.discount.visible=!this.data.isScore&&this.data.data.discount,this.discount.visible&&(this.discountNum.source="discountNum"+this.data.data.discount),this.itemIcon.data={type:1,id:this.data.data.itemID,count:this.data.data.itemCount},this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.data.isScore?(this.buyBtn.enabled=!0,this.yuanbao.visible=!1,this.jifen.visible=!0,this.jifenNum.text=this.data.data.score):(this.buyBtn.enabled=0==this.data.data.state,this.yuanbao.visible=!0,this.jifen.visible=!1,this.money.text=this.data.data.price)},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){var e=Activity.ins().activityData[this.data.activityID];this.data.isScore?e.tScore<this.data.data.score?UserTips.ins().showTips("|C:0xf3311e&T:积分不足|"):Activity.ins().sendReward(this.data.activityID,0,4,this.data.data.id):Actor.yb<this.data.data.price?UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):Activity.ins().sendReward(this.data.activityID,0,3,this.data.data.id)},e}(BaseItemRender);__reflect(ActivityStoreItemRender.prototype,"ActivityStoreItemRender");var ActivityStoreShowItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="activityStoreShowItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.discount.visible=this.data.discountImg>0,this.discount.visible&&(this.discountNum.source="discountNum"+this.data.discountImg),this.money.text=this.data.cost,this.itemIcon.data=this.data},e}(BaseItemRender);__reflect(ActivityStoreShowItemRender.prototype,"ActivityStoreShowItemRender");var SpringBeginWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="springBeginWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(UserBag.ins().postItemAdd,this.refushRedPoint),this.observe(UserBag.ins().postItemChange,this.refushRedPoint),this.observe(UserBag.ins().postItemDel,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList),this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller),this.removeObserve();for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.leftRed.visible=this.rightRed.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn.visible=!1,this.rightBtn.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=!0;break}if(this.rightBtn.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];for(var e in Activity.ins().activityData)Activity.ins().activityData[e]&&Activity.ins().activityData[e].pageStyle==ActivityPageStyle.SPRINGBEGIN&&Activity.ins().getActivityDataById(+e).isOpenActivity()&&!Activity.ins().getActivityDataById(+e).getHide()&&this._datas.push(Activity.ins().getbtnInfo(e));this._datas.sort(this.sort),t=0;for(var e in this._datas){var i=this._datas[e].id,s=Activity.ins().getActivityDataById(+i),n=ActivityPanel.create(i,s.activityType);n.top=0,n.left=0,n.bottom=0,n.right=0,this.activityPanelList[t]=n,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()
},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(SpringBeginWin.prototype,"SpringBeginWin"),ViewManager.ins().reg(SpringBeginWin,LayerManager.UI_Main);var SpringEightDayWin=function(t){function e(){var e=t.call(this)||this;return e._curDay=0,e._curDayIndex=0,e._curGroupIndex=0,e.isTopLevel=!0,e.setActivityID(),e.setCurSkin(),e}return __extends(e,t),e.prototype.setActivityID=function(){var t=Activity.ins().activityData;for(var e in t)if(t[e].pageStyle==ActivityPageStyle.SPRINGEIGHTDAY){this._activityID=t[e].id;break}},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this._activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="SFEightDayWin",this.actInfo0&&(this.actInfo0.text=t.desc)},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.tabP.itemRenderer=HappySevenDayTabListItemRender,this.tabD.itemRenderer=HappySevenDayBtnItemRender,this.list.itemRenderer=HappySevenDayItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._activityID=t[0],this.setCurSkin(),this._curDayIndex=0,this._curGroupIndex=0,this.updateView(),this.updateTabs(),this.tabD.selectedIndex=this._curDayIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData(),this.updateTargetAward(),this.addTouchEvent(this,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds),this.addChangeEvent(this.tabD,this.onClickBtn),this.addChangeEvent(this.tabP,this.onTabBtn),TimerManager.ins().doTimer(1e3,0,this.setTime,this)},e.prototype.close=function(){this._tabCollect=null,this._btnCollect=null,this._listCollect=null},e.prototype.updateView=function(){var t=Activity.ins().getActivityDataById(this._activityID);this._curDay=t.getCurDay(),this._items=[];var e,i,s,n,o,a,r=GlobalConfig.ActivityType11_2Config[this._activityID],h=[];for(var l in r)e=r[l],s=e.day,i=this._items[e.day-1],i||(i=[],this._items[e.day-1]=i,h.push({res:e.dayImg,isOpen:this._curDay>=e.day,showRed:!1,day:e.day})),a=t.achieveInfo[e.index-1],this._curDay>=e.day&&!a.isGot&&a.times>=e.dayLimit&&(h[e.day-1].showRed=!0),n=e.group,o=i[n-1],o||(o=[],i[n-1]=o),o.push(e);this._btnCollect||(this._btnCollect=new ArrayCollection,this.tabD.dataProvider=this._btnCollect),this._btnCollect.source=h,this.tabD.validateNow(),this._tabCollect||(this._tabCollect=new ArrayCollection,this.tabP.dataProvider=this._tabCollect)},e.prototype.refreshReds=function(){this.updateView(),this.updateTabs(),this.updateData(),this.updateTargetAward()},e.prototype.updateData=function(){var t=this._items[this._curDayIndex][this._curGroupIndex];if(t&&t.length){this._listCollect||(this._listCollect=new ArrayCollection,this.list.dataProvider=this._listCollect);for(var e,i,s=t.length,n=[],o=0,a=Activity.ins().getActivityDataById(this._activityID),r=0;s>r;r++)e=t[r],i=a.achieveInfo[e.index-1],o=i.isGot?2:i.times>=e.dayLimit?1:0,n[r]={activityID:this._activityID,conf:e,state:o,times:i.times};n.sort(this.sort),this._listCollect.source=n}},e.prototype.sort=function(t,e){return 1==t.state&&1!=e.state?-1:2==t.state&&2!=e.state?1:t.conf.index<e.conf.index?-1:t.conf.index>e.conf.index?1:0},e.prototype.updateTargetAward=function(){var t=GlobalConfig.ActivityType11_1Config[this._activityID][Object.keys(GlobalConfig.ActivityType11_1Config[this._activityID]).length];this.schedule.maximum=t.score,this.schedule.value=Activity.ins().getActivityDataById(this._activityID).hiScore},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:ViewManager.ins().open(SDRewardWin,this._activityID)}},e.prototype.onClickBtn=function(t){if(this._curDayIndex!=t.currentTarget.selectedIndex){var e=this.tabD.getChildAt(t.currentTarget.selectedIndex);e.isOpen?(e=this.tabD.getChildAt(this._curDayIndex),e.selected=!1,this._curDayIndex=t.currentTarget.selectedIndex):UserTips.ins().showCenterTips("活动开启第"+e.day+"天开放"),this.tabD.selectedIndex=this._curDayIndex,e=this.tabD.getChildAt(this._curDayIndex),e.selected=!0,this.updateTabs(),this.tabP.selectedIndex=this._curGroupIndex=0,this.updateData()}},e.prototype.onTabBtn=function(t){this._curGroupIndex!=t.currentTarget.selectedIndex&&(this._curGroupIndex=t.currentTarget.selectedIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData())},e.prototype.updateTabs=function(){var t,e,i,s=this._items[this._curDayIndex],n=Activity.ins().getActivityDataById(this._activityID),o=[];for(var a in s){o.push({gName:s[a][0].gName,showRed:!1}),t=s[a].length;for(var r=0;t>r;r++)if(i=s[a][r],e=n.achieveInfo[i.index-1],this._curDay>=i.day&&!e.isGot&&e.times>=i.dayLimit){o[a].showRed=!0;break}}this._tabCollect.source=o},e.prototype.setTime=function(){var t=Activity.ins().activityData[this._activityID];this.actTime0.text=t.getRemainTime()},e}(BaseEuiView);__reflect(SpringEightDayWin.prototype,"SpringEightDayWin"),ViewManager.ins().reg(SpringEightDayWin,LayerManager.UI_Main);var SpringFestivalWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="springfestivalWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList),this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller),this.removeObserve();for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn0.visible=!1,this.rightBtn0.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn0.visible=!0,this.rightBtn0.visible=!1):(this.leftBtn0.visible=!0,this.rightBtn0.visible=!0),this.leftRed0.visible=this.rightRed0.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn0.visible=!1,this.rightBtn0.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn0.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed0.visible=!0;break}if(this.rightBtn0.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed0.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];for(var e in Activity.ins().activityData)Activity.ins().activityData[e].pageStyle==ActivityPageStyle.SPRINGFESTIVAL&&Activity.ins().getActivityDataById(+e).isOpenActivity()&&!Activity.ins().getActivityDataById(+e).getHide()&&this._datas.push(Activity.ins().getbtnInfo(e));this._datas.sort(this.sort),t=0;for(var e in this._datas){var i=this._datas[e].id,s=Activity.ins().getActivityDataById(+i),n=ActivityPanel.create(i,s.activityType);n.top=0,n.left=0,n.bottom=0,n.right=0,this.activityPanelList[t]=n,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn0:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn0:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(SpringFestivalWin.prototype,"SpringFestivalWin"),ViewManager.ins().reg(SpringFestivalWin,LayerManager.UI_Main);var ThanksGivingWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ActivityWinSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.THANKS&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,感恩节活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onClick),this.removeTouchEvent(this.closeBtn0,this.onClick),this.menuList.removeEventListener(egret.Event.CHANGE,this.onClickMenu,this),this.removeTouchEvent(this.leftBtn,this.onTouchBtn),this.removeTouchEvent(this.rightBtn,this.onTouchBtn),this.menuScroller.removeEventListener(egret.Event.CHANGE,this.onChange,this),this.removeObserve(),TimerManager.ins().removeAll(this);for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){for(var t=0,e=0,i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var s in Activity.ins().activityData)if(Activity.ins().activityData[s]&&Activity.ins().activityData[s].pageStyle==ActivityPageStyle.THANKS&&Activity.ins().getActivityDataById(+s).isOpenActivity()){var n=Activity.ins().getbtnInfo(s);ErrorLog.Assert(n,"ThanksGivingWin  data   "+s)||this._datas.push(n)}this._datas.sort(this.sort),this.BtnArr=[];for(var s in this._datas){var o=this._datas[s].id,a=void 0;if(this._datas[s].activityType==ActivityType.Normal?a=Activity.ins().getActivityDataById(+o):this._datas[s].activityType==ActivityType.Personal&&(a=PActivity.ins().getActivityDataById(+o)),a&&a.id==o){var r=a.getHide();if(!r){var h=ActivityPanel.create(o,a.activityType);if(!h)continue;h.top=0,h.left=0,h.bottom=0,h.right=0,this.activityPanelList[e]=h,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[s]),this.actId&&this.actId==o&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var l=92*t;l>this.menuList.contentWidth-this.menuScroller.width&&(l=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=l}this.title.source="biaoti_ganen"},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID))}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(ThanksGivingWin.prototype,"ThanksGivingWin"),ViewManager.ins().reg(ThanksGivingWin,LayerManager.UI_Main);var TotalRechargeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DTRechargeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.itemRenderer=DoubleTwelveRechargeItem,this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.bgClose,this.closeWin),this.addTouchEvent(this.chooseBtn0,this.onSelect),this.addTouchEvent(this.chooseBtn1,this.onSelect),this.addTouchEvent(this.chooseBtn2,this.onSelect),this.addTouchEvent(this.rechargeBtn,this.onRecharge),this.observe(Recharge.ins().postUpdateRecharge,this.update),this.observe(Recharge.ins().postUpdateRechargeEx,this.update),this.observe(Activity.ins().postChangePage,this.update),this.observe(Activity.ins().postRewardResult,this.update),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.updateView()},e.prototype.onRecharge=function(t){if(this.recharge.visible){var e=Recharge.ins().getRechargeData(0);e&&2==e.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win)}else Activity.ins().sendReward(this._activityId,this._index)},e.prototype.update=function(){TimerManager.ins().remove(this.updateView,this),TimerManager.ins().doTimer(80,1,this.updateView,this)},e.prototype.getActivityId=function(){var t=Activity.ins().activityData;for(var e in t)if(t[e].pageStyle==ActivityPageStyle.TOTALRECHARGE&&Activity.ins().getActivityDataById(t[e].id).isOpenActivity()&&!Activity.ins().getActivityDataById(t[e].id).getHide())return t[e].id;return 0},e.prototype.updateView=function(){var t=this.getActivityId();this._activityId=t;var e,i=Activity.ins().getActivityDataById(t),s=i.getLeftTime(),n=Math.floor(1e3*s/DateUtils.MS_PER_DAY);0==n?(n=Math.floor(1e3*s/(DateUtils.MS_PER_DAY/24)),e=n+"小时"):e=n+"天",this.limitTime.text="距离活动结束仅剩"+e;for(var o=1;3>=o;o++)this.setText(o);for(var a=1,r=GlobalConfig.ActivityType3Config[t],o=1;3>=o;o++){var h=r[o];if(h.val>i.chongzhiTotal||0==(i.recrod>>h.index&1)){a=o;break}}this.selectActivity(a)},e.prototype.selectBtn=function(t){this.select0.visible=!1,this.select1.visible=!1,this.select2.visible=!1,this["select"+t].visible=!0},e.prototype.selectActivity=function(t){var e=this._activityId;this._index=t;var i=Activity.ins().getActivityDataById(e),s=GlobalConfig.ActivityType3Config[e][t],n=Math.max(0,s.val-i.chongzhiTotal);this.rechargeCount.text=n.toString(),1==(i.recrod>>t&1)?(this.btn.visible=!1,this.get.visible=!1,this.recharge.visible=!1):(this.btn.visible=!0,n>0?(this.recharge.visible=!0,this.get.visible=!1):(this.recharge.visible=!1,this.get.visible=!0)),this.list.dataProvider=new ArrayCollection(s.rewards),this.selectBtn(t-1)},e.prototype.setText=function(t){var e=this._activityId,i=GlobalConfig.ActivityType3Config[e][t],s=i.val;s>=1e4?(s=Math.floor(s/1e4),this["unit"+(t-1)].source="dt_wan"):(s=Math.floor(s/1e3),this["unit"+(t-1)].source="dt_qian"),this["count"+(t-1)].text=s.toString()},e.prototype.onSelect=function(t){var e=t.currentTarget,i=1;i=e==this.chooseBtn0?1:e==this.chooseBtn1?2:3,this.selectActivity(i)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(TotalRechargeWin.prototype,"TotalRechargeWin"),ViewManager.ins().reg(TotalRechargeWin,LayerManager.UI_Popup);var Activity2Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="LimitGiftActSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData(),this.addTouchEvent(this.buy0,this.onTap),this.addTouchEvent(this.buy1,this.onTap),this.addTouchEvent(this.buy2,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];debug.log("close"),this.removeTouchEvent(this.buy0,this.onTap),this.removeTouchEvent(this.buy1,this.onTap),this.removeTouchEvent(this.buy2,this.onTap)},e.prototype.onTap=function(t){var e,i,s=this;switch(t.currentTarget){case this.buy0:i=0;break;case this.buy1:i=1;break;case this.buy2:i=2}var n=Activity.ins().activityData[this.activityID];e=GlobalConfig.ActivityType2Config[this.activityID][i];var o=(n.buyData[i]||0,1==e.currencyType?Actor.gold:Actor.yb),a=1==e.currencyType?"金币":"元宝";if(e.vip&&UserVip.ins().lv<e.vip)UserTips.ins().showTips("vip等级不足");else{var r=this.configList[i].rewards[0].id,h=ItemConfig.getType(GlobalConfig.ItemConfig[r]);if(UserBag.ins().getSurplusCount()<1&&0==h)return void UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");o>=e.price?WarnWin.show("确定消耗"+e.price+a+"购买特惠商品吗？",function(){Activity.ins().sendReward(s.activityID,i+1)},this):UserTips.ins().showTips(a+"不足")}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);if(e>=0)this.date.text="活动未开启";else if(0>=i)this.date.text="活动已结束";else{var s=Math.floor(i/86400),n=Math.floor(i%86400/3600),o=Math.floor(i%3600/60);this.date.text=s+"天"+n+"小时"+o+"分"}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.configList=GlobalConfig.ActivityType2Config[this.activityID],this.group_item0&&(this.group_item0.visible=!1),this.group_item1&&(this.group_item1.visible=!1),this.group_item2&&(this.group_item2.visible=!1);for(var a=0;a<this.configList.length;a++){var r=this.configList[a],h=t.buyData[a]||0,l=this["item"+a],c=this["itemCount"+a],u=this["label_title"+a],p=this["price"+a],d=this["desc"+a],g=this["buy"+a],f=this["redPoint"+a],v=this["group_item"+a],y=(this["imgDiscount"+a],this["itemname"+a]),m=this["title"+a],T=GlobalConfig.ItemConfig[r.rewards[0].id];l&&(l.setData(T),c.text=r.rewards[0].count+""),y&&(y.text=T.name),u&&(u.text=r.vip?"VIP"+r.vip+"特权":"全民特惠"),p&&(p.setText(r.price+""),p.setType(1==r.currencyType?MoneyConst.gold:MoneyConst.yuanbao)),d&&(d.text="今日购买次数："+(r.count-h)),m&&(m.source="tq_"+(r.vip<10?"0"+r.vip:r)),g&&(g.enabled=r.count-h>0),f&&(f.visible=Activity.ins().getisCanBuyXianGouItem(this.activityID+"",a)),v&&(v.visible=!0)}},e}(BaseView);__reflect(Activity2Panel1.prototype,"Activity2Panel1");var Activity2Panel2=function(t){function e(){var e=t.call(this)||this;return e._index=0,e.skinName="ActGiftSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this.type_1,this.onTap),this.addTouchEvent(this.type_2,this.onTap),this.addTouchEvent(this.type_3,this.onTap),this.addTouchEvent(this.type_4,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buyBtn,this.onTap),this.removeTouchEvent(this.type_1,this.onTap),this.removeTouchEvent(this.type_2,this.onTap),this.removeTouchEvent(this.type_3,this.onTap),this.removeTouchEvent(this.type_4,this.onTap)},e.prototype.onTap=function(t){var e,i=this;switch(t.currentTarget){case this.buyBtn:if(e=-1,this.config.vip&&UserVip.ins().lv<this.config.vip)UserTips.ins().showTips("vip等级不足");else{if(UserBag.ins().getSurplusCount()<1&&3==this._index)return void UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");Actor.yb>=this.config.price?WarnWin.show("确定消耗"+this.config.price+"元宝购买特惠商品吗？",function(){Activity.ins().sendReward(i.activityID,i._index+1)},this):UserTips.ins().showTips("元宝不足")}break;case this.type_1:e=0;break;case this.type_2:e=1;break;case this.type_3:e=2;break;case this.type_4:e=3}-1!=e&&this.updateData(e)},e.prototype.updateData=function(t){void 0===t&&(t=0);var i=Activity.ins().getActivityDataById(this.activityID),s=Math.floor((DateUtils.formatMiniDateTime(i.startTime)-GameServer.serverTime)/1e3),n=Math.floor((DateUtils.formatMiniDateTime(i.endTime)-GameServer.serverTime)/1e3);s>=0?this.date.text="活动未开启":0>=n?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_5,3),this.config=GlobalConfig.ActivityType2Config[this.activityID][t],this.list.dataProvider=new eui.ArrayCollection(this.config.rewards);var o=e.giftNameArr[t],a="花费<font color = '#FF964C'>"+this.config.price+"</font>元宝即可获得<font color = '#FF964C'>"+o+"</font>";this.desc.textFlow=(new egret.HtmlTextParser).parser(a),this.chosen.x=7+105*t,this._index=t,this.get_1.visible=1==i.buyData[0],this.get_2.visible=1==i.buyData[1],this.get_3.visible=1==i.buyData[2],this.get_4.visible=1==i.buyData[3],this.buyBtn.visible=0==i.buyData[t]},e}(BaseView);Activity2Panel2.giftNameArr=["超值礼包","豪华礼包","神翅礼包","官印礼包"],__reflect(Activity2Panel2.prototype,"Activity2Panel2");var FDProjectItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this._listCollect=new ArrayCollection,this.list.dataProvider=this._listCollect},e.prototype.dataChanged=function(){this._listCollect.source=this.data.conf.reward,this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.conf.name),this.scedule.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+Math.floor(this.data.times/this.data.conf.rate)+"|/"+Math.floor(this.data.conf.dayLimit/this.data.conf.rate)),this.currentState=2==this.data.state?"done":"normal",this.redpoint.visible=1==this.data.state,this.score.text=this.data.conf.score,0==this.data.state&&this.data.conf.turn?(this.actBtn.enabled=!0,this.actBtn.label="前  往"):(this.actBtn.label="领  取",this.actBtn.enabled=1==this.data.state),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){t.target==this.actBtn&&(0==this.data.state&&this.data.conf.turn?ViewManager.ins().open(this.data.conf.turn[0],this.data.conf.turn[1]):Activity.ins().sendReward(this.data.activityID,this.data.conf.index,2))},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(FDProjectItemRender.prototype,"FDProjectItemRender");var FDrewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FDrewardItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemicon.touchChildren=!1},e.prototype.dataChanged=function(){this.tsNeed.text=this.data.config.score+"狂欢值",this.get.visible=2==this.data.state,this.redpoint.visible=1==this.data.state,this.arrow.source=this.data.state?"fd_arrow2":"fd_arrow1";var t=this.data.config;this.itemicon.data=t.reward[0],this.itemicon.isShowName(!1),this.itemicon.showNum(!1),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.itemicon.touchEnabled=1!=this.data.state,this.itemicon.filters=0==this.data.state?FilterUtil.ARRAY_GRAY_FILTER:null},e.prototype.onTouch=function(t){1==this.data.state&&Activity.ins().sendReward(this.data.activityID,this.data.index,1)},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(FDrewardItemRender.prototype,"FDrewardItemRender");var FDstoreItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FDstoreItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.data;this.discount.visible=t.buyMax>0,this.limitCount.text=t.buyMax-t.buyCount+"",this.itemIcon.data={type:1,id:t.itemID,count:t.itemCount},this.costIcon.source=GlobalConfig.ItemConfig[GlobalConfig.ActivityType22_1Config[this.data.activityID][1].costItem].icon+"_png",this.money.text="X"+t.materialNum,this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.buyBtn.label=0==this.data.data.state?"购买":"已购买",this.buyBtn.enabled=0==this.data.data.state},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){if(t.target==this.buyBtn){var e=UserBag.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.data.activityID][1].costItem),i=e?e.count:0;i>=this.data.data.materialNum?Activity.ins().sendReward(this.data.activityID,0,3,this.data.data.id):UserTips.ins().showTips("材料不足")}},e}(BaseItemRender);__reflect(FDstoreItemRender.prototype,"FDstoreItemRender");var FDstoreShowItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FDstoreShowItem",e}return __extends(e,t),e.prototype.update=function(t){this.itemID=t.itemID,this.itemImg.source=GlobalConfig.ItemConfig[t.itemID].icon+"_png",this.limitCount.textFlow=TextFlowMaker.generateTextFlow("限购 "+t.buy+"/"+t.max),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){this.itemID&&ViewManager.ins().open(ItemDetailedWin,0,this.itemID)},e}(eui.Component);__reflect(FDstoreShowItemRender.prototype,"FDstoreShowItemRender");var FDtabBtnItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.tabName.text=this.data.gName,this.redpoint.visible=this.data.showRed},Object.defineProperty(e.prototype,"selected",{set:function(t){this.currentState=t?"select":"unselect",this.data&&(this.redpoint.visible=this.data.showRed)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(FDtabBtnItemRender.prototype,"FDtabBtnItemRender");var VersionCeleWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="carnivalWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(UserBag.ins().postItemAdd,this.refushRedPoint),this.observe(UserBag.ins().postItemChange,this.refushRedPoint),this.observe(UserBag.ins().postItemDel,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;
for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList),this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller),this.removeObserve();for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.leftRed.visible=this.rightRed.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn.visible=!1,this.rightBtn.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=!0;break}if(this.rightBtn.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];for(var e in Activity.ins().activityData){var i=Activity.ins().activityData[e];i&&i.pageStyle==ActivityPageStyle.VERSIONCELE&&i.type!=ActivityDataFactory.ACTIVITY_TYPE_22&&Activity.ins().getActivityDataById(+e).isOpenActivity()&&!Activity.ins().getActivityDataById(+e).getHide()&&this._datas.push(Activity.ins().getbtnInfo(e))}this._datas.sort(this.sort),t=0;for(var e in this._datas){var s=this._datas[e].id,n=Activity.ins().getActivityDataById(+s),o=ActivityPanel.create(s,n.activityType);o.top=0,o.left=0,o.bottom=0,o.right=0,this.activityPanelList[t]=o,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(VersionCeleWin.prototype,"VersionCeleWin"),ViewManager.ins().reg(VersionCeleWin,LayerManager.UI_Main);var HongBaoOpenItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoOpenSkin",e.init(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.hbbtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.list.itemRenderer=HongBaoRewardsItem,this.closeBtn.visible=!1},e.prototype.onClick=function(t){switch(t.currentTarget){case this.hbbtn:if(!this.data||!this.data.actId||!this.data.eId)return;var e=Activity.ins().getActivityDataById(this.data.actId);if(!e.isOpenActivity())return void UserTips.ins().showTips("活动已结束");Activity.ins().sendReward(this.data.actId,this.data.eId,EnvelopeType.GET)}},e.prototype.onTouch=function(){this.close()},e.prototype.close=function(){this.callFun&&this.bt1&&this.bt2&&this.bt3&&(TimerManager.ins().remove(this.close,this),this.parent&&(this.parent.removeChildren(),this.callFun()))},e.prototype.dataChanged=function(){if(this.data){var t=this.data.job,e=this.data.sex,i=this.data.name,s=this.data.text,n=this.data.index;this.myFace.source="head_"+t+e,this.playerName.text=i,this.speaktxt.textFlow=TextFlowMaker.generateTextFlow1(s);var o=GlobalConfig.ActivityType12Config[this.data.actId][n];this.title.source="hongbao_title"+o.skinType}},e.prototype.destruct=function(){this.hbbtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.playAni=function(t,e,i){var s=this;this.removeChild(this.hbbtn),this.removeChild(this.hhbtnlabel),this.removeChild(this.speaktxt),this.removeChild(this.speakbg),this.topImg.scrollRect||(this.topImg.scrollRect=new egret.Rectangle(0,0,this.topImg.width,this.topImg.height)),this.downImg.scrollRect||(this.downImg.scrollRect=new egret.Rectangle(0,0,this.downImg.width,this.downImg.height));var n=this;this.callFun=function(){e&&e.call(i)};var o=this.topImg.scrollRect,a=this.downImg.scrollRect,r=400;this.list.dataProvider=new eui.ArrayCollection(t);var h=egret.Tween.get(o,{onChange:function(){s.topImg.scrollRect=o}}).to({y:200},r).call(function(){egret.Tween.removeTweens(h),n.bt1=!0,n.closeBtn.visible=!0}),l=egret.Tween.get(a,{onChange:function(){s.downImg.scrollRect=a}}).to({height:0},r).call(function(){egret.Tween.removeTweens(l),n.bt2=!0}),c=egret.Tween.get(this.downImg).to({y:this.downImg.y+this.downImg.height},r).call(function(){egret.Tween.removeTweens(c),n.bt3=!0});TimerManager.ins().isExists(this.close,this)||TimerManager.ins().doTimer(1e4,0,this.close,this)},e}(BaseItemRender);__reflect(HongBaoOpenItem.prototype,"HongBaoOpenItem");var HongBaoRewardsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoRewardItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.yb,e=this.data.gold,i=""+t,s="";this.itemIndex||this.data.name!=Actor.myName?(this.currentState="otherman",s="在红包里抢到了"):(this.currentState="owner",s="手气爆炸，在红包里抢到了"),e?(i=CommonUtils.overLength(e),s+=i+"金币"):s+=i+"元宝",this.validateNow(),this.speaktxt.text=s,this.myFace.source="yuanhead"+this.data.job+this.data.sex,this.playerName.text=this.data.name}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(HongBaoRewardsItem.prototype,"HongBaoRewardsItem");var HongBaoShowItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoShowItem",e.init(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!1},e.prototype.init=function(){this.hbimg.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.hongbaoeff.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){if(this.data&&this.data.actId&&this.data.eId){var t=Activity.ins().getActivityDataById(this.data.actId);if(!t.isOpenActivity())return void UserTips.ins().showTips("活动已结束");for(var e=t.envelopeData.length-1;e>=0;e--)if(!t.envelopeData[e]||t.envelopeData[e].id==this.data.eId){if(t.envelopeData[e].isOverTimer())return UserTips.ins().showTips("|C:0xff0000&T:红包已过期"),void Activity.ins().postEnvelopeDataCall(null);break}Activity.ins().sendEnvelopeData(this.data.actId,this.data.eId)}},e.prototype.dataChanged=function(){if(this.data&&(this.eff||(this.eff=new MovieClip),!this.eff.parent)){this.hbimg.visible=!1,this.hongbaoeff.addChild(this.eff);var t=this;this.eff.playFile(RES_DIR_EFF+"hongbaoeff",1,function(){t.hbimg&&(t.hbimg.visible=!0)})}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(HongBaoShowItem.prototype,"HongBaoShowItem");var HongBaoSpeak=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoSpeakSkin",e}return __extends(e,t),e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.sendBtn,this.onClick),this.actId=t[0],this.index=t[1];var i=GlobalConfig.ActivityType12Config[this.actId][this.index];this.input.text="",this.input.prompt=i.blessWord+"（点击输入）",this.input.maxChars=i.wordCount},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:ViewManager.ins().close(this);var e=Activity.ins().getActivityDataById(this.actId);if(!e.isOpenActivity())return void UserTips.ins().showTips("活动已结束");Activity.ins().sendReward(this.actId,this.index,EnvelopeType.SEND,this.input.text),ViewManager.ins().close(XiaoNianWin)}},e}(BaseEuiView);__reflect(HongBaoSpeak.prototype,"HongBaoSpeak"),ViewManager.ins().reg(HongBaoSpeak,LayerManager.UI_Popup);var XiaoNianItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="XNHongBaoItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&(this.currentState=this.data)},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(XiaoNianItem.prototype,"XiaoNianItem");var XiaoNianListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.showText.textFlow=TextFlowMaker.generateTextFlow(this.data))},e}(BaseItemRender);__reflect(XiaoNianListRenderer.prototype,"XiaoNianListRenderer");var XiaoNianWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="XiaoNianWinSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.XIAONIAN,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.XIAONIAN&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var s=Activity.ins().getbtnInfo(i);ErrorLog.Assert(s,"xiaonian  data   "+i)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var n=this._datas[i].id,o=Activity.ins().getActivityDataById(+n);if(o&&o.id==n){var a=o.getHide();if(!a){var r=ActivityPanel.create(n,ActivityType.Normal);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==n&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&this.setOpenIndex(this.selectIndex)}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(XiaoNianWin.prototype,"XiaoNianWin"),ViewManager.ins().reg(XiaoNianWin,LayerManager.UI_Main);var YBZhuanPanWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="CEYBZhuanPanSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.YBZHUANPAN,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.YBZHUANPAN&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){for(var t=0,e=0,i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var s in Activity.ins().activityData)if(Activity.ins().activityData[s]&&Activity.ins().activityData[s].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+s).isOpenActivity()){var n=Activity.ins().getbtnInfo(s);if(n.activityType&&n.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(n,"ybzhuanpan  data   "+s)||this._datas.push(n)}this._datas.sort(this.sort),this.BtnArr=[];for(var s in this._datas){var o=this._datas[s].id,a=Activity.ins().getActivityDataById(+o);if(a&&a.id==o){var r=a.getHide();if(!r){var h=ActivityPanel.create(o,a.activityType);if(!h)continue;h.top=0,h.left=0,h.bottom=0,h.right=0,this.activityPanelList[e]=h,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[s]),this.actId&&this.actId==o&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var l=92*t;l>this.menuList.contentWidth-this.menuScroller.width&&(l=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=l}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):this.setOpenIndex(this.selectIndex))}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(YBZhuanPanWin.prototype,"YBZhuanPanWin"),ViewManager.ins().reg(YBZhuanPanWin,LayerManager.UI_Main);var ZhanLingACTWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="ZhanlingActWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.ins().playEffect(SoundUtil.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList),this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller),this.removeObserve();for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.leftRed.visible=this.rightRed.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn.visible=!1,this.rightBtn.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=!0;break}if(this.rightBtn.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];for(var e in Activity.ins().activityData)Activity.ins().activityData[e]&&Activity.ins().activityData[e].pageStyle==ActivityPageStyle.ZHANLING&&Activity.ins().getActivityDataById(+e).isOpenActivity()&&!Activity.ins().getActivityDataById(+e).getHide()&&this._datas.push(Activity.ins().getbtnInfo(e));this._datas.sort(this.sort),t=0;for(var e in this._datas){var i=this._datas[e].id,s=Activity.ins().getActivityDataById(+i),n=ActivityPanel.create(i,s.activityType);n.top=0,n.left=0,n.bottom=0,n.right=0,this.activityPanelList[t]=n,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(ZhanLingACTWin.prototype,"ZhanLingACTWin"),ViewManager.ins().reg(ZhanLingACTWin,LayerManager.UI_Main);var ActivityExWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ActivityWinSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY)),!1;var i=t[0];if(void 0!=i){if(Activity.ins().activityData[i].pageStyle||Activity.ins().activityData[i].timeType!=ActivityDataFactory.TimeType_Total)return UserTips.ins().showTips("|C:0xff0000&T:此活动不是合服活动"),!1;if(!Activity.ins().getActivityDataById(i)||!Activity.ins().getActivityDataById(i).isOpenActivity())return UserTips.ins().showTips("|C:0xff0000&T:合服活动未开启"),!1}var s=Object.keys(Activity.ins().activityData);if(!s.length)return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,合服活动已经结束了"),!1;for(var n in Activity.ins().activityData)if(!Activity.ins().activityData[n].pageStyle&&Activity.ins().activityData[n].timeType==ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+n).isOpenActivity())return!0;return UserTips.ins().showTips("|C:0xff0000&T:很遗憾,合服活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.updateView(i),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(UserBag.ins().postItemAdd,this.refushRedPoint),this.observe(UserBag.ins().postItemChange,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onClick),this.removeTouchEvent(this.closeBtn0,this.onClick),this.menuList.removeEventListener(egret.Event.CHANGE,this.onClickMenu,this),this.removeTouchEvent(this.leftBtn,this.onTouchBtn),this.removeTouchEvent(this.rightBtn,this.onTouchBtn),this.menuScroller.removeEventListener(egret.Event.CHANGE,this.onChange,this),this.removeObserve(),TimerManager.ins().removeAll(this);for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(t){this.title.source="biaoti_hefuhuodong";var e=0,i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],i=0;for(var s in Activity.ins().activityData)if(!Activity.ins().activityData[s].pageStyle&&Activity.ins().activityData[s].timeType==ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+s).isOpenActivity()){var n=Activity.ins().getbtnInfo(s);if(n.activityType&&n.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(n,"ActivityExWin  data   "+s)||this._datas.push(n)}this._datas.sort(this.sort),this.BtnArr=[];for(var s in this._datas){var o=this._datas[s].id,a=void 0;if(this._datas[s].activityType==ActivityType.Normal?a=Activity.ins().getActivityDataById(+o):this._datas[s].activityType==ActivityType.Personal&&(a=PActivity.ins().getActivityDataById(+o)),a&&a.id==o){var r=a.getHide();if(!r){var h=ActivityPanel.create(o,a.activityType);if(!h)continue;h.top=0,h.left=0,h.bottom=0,h.right=0,this.activityPanelList[i]=h,this.viewStack.addChild(this.activityPanelList[i]),this.BtnArr.push(this._datas[s]),void 0!=t&&t==o&&(e=i),i++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(e),this.viewStack.validateNow(),this.menuList.validateNow(),e>=5){var l=92*e;l>this.menuList.contentWidth-this.menuScroller.width&&(l=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=l}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID))}},e.prototype.ChangePageCallBack=function(){this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e}(BaseEuiView);__reflect(ActivityExWin.prototype,"ActivityExWin"),ViewManager.ins().reg(ActivityExWin,LayerManager.UI_Main);var BossScoreExchangeBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuBossBtnSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.id,e=this.data.index,i=GlobalConfig.ActivityType7Config[t][e];
this.btnText.text=i.title+"转",this.redPoint.visible=Activity.ins().IsBossScoreTitle(i.Id,i.title)},e.prototype.destruct=function(){},e}(eui.ItemRenderer);__reflect(BossScoreExchangeBtn.prototype,"BossScoreExchangeBtn");var BossScoreExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuBossItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data instanceof ActivityType7Config){var t=this.data,e=GlobalConfig.ItemConfig[t.rewards[0].id],i=Activity.ins().getActivityDataById(t.Id),s=i.bossScore,n=Activity.ins().getIsBuy(t);this.redPoint.visible=n&&s>=t.score,this.nameLab.text=e.name;var o=s<t.score?"#F3311E":"#35E62D";if(this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+o+"'>"+t.score+"</font>"),this.goBtn.currentState="up",this.goBtn.touchEnabled=!0,t.count){this.count.visible=!0;var a=t.count-i.personalRewardsSum[t.index];a=a>0?a:0,a||(this.goBtn.currentState="disabled",this.goBtn.touchEnabled=!1);var r=0>a?15937822:3532333;this.count.textFlow=TextFlowMaker.generateTextFlow1("|C:0x9F946D&T:剩余|C:"+r+"&T:"+a+"|C:0x9F946D&T:份")}else this.count.visible=!1;this.itemConfig=e,this.itemIcon0.data=t.rewards[0]}},e.prototype.onClick=function(){if(this.data instanceof ActivityType7Config){var t=this.data,e=Activity.ins().getActivityDataById(t.Id);if(e.bossScore<t.score)return void UserTips.ins().showTips("|C:0xf3311e&T:积分不足|");if(!Activity.ins().getIsBuy(t))return void UserTips.ins().showTips("|C:0xf3311e&T:已经兑换完|");Activity.ins().sendReward(t.Id,t.index)}},e}(eui.ItemRenderer);__reflect(BossScoreExchangeItem.prototype,"BossScoreExchangeItem");var BossScoreExchangeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="hefuBossjifenSkin",this.equiplist.itemRenderer=BossScoreExchangeBtn,this.dataArr=new eui.ArrayCollection,this.listData={},this.menuData=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.initMenu();var i=GlobalConfig.ActivityType7Config[this.activityID][1];i&&i.showType==ActivityType7Data.TYPE_RING?(this.currentState="lyring",this.exchangelist.itemRenderer=RingBossScoreExchangeItem):(this.currentState="hefu",this.equiplist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.exchangelist.itemRenderer=BossScoreExchangeItem),this.observe(Activity.ins().postRewardResult,this.onListChange),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.addTouchEvent(this.bgClose,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),i&&i.showType!=ActivityType7Data.TYPE_RING&&(this.equiplist.selectedIndex=this.currentSelect),this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeTouchEvent(this.closeBtn,this.onClick),this.equiplist.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.removeObserve()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this)}},e.prototype.onListChange=function(){Activity.ins().sendChangePage(this.activityID)},e.prototype.ChangePageCallBack=function(){this.refushInfo()},e.prototype.initMenu=function(){var t=GlobalConfig.ActivityType7Config[this.activityID],e=-1,i=0;for(var s in t)i!=t[s].title&&(i=t[s].title,e++,this.menuData||(this.menuData=[]),this.menuData.push({id:t[s].Id,index:t[s].index})),this.listData[e]||(this.listData[e]=[]),this.listData[e].push(t[s])},e.prototype.refushInfo=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.suipian.text=""+t.bossScore,this.dataArr.replaceAll(this.listData[this.currentSelect].concat()),this.exchangelist.dataProvider=this.dataArr,this.exchangelist.scrollV=0,this.exchangelist.validateNow();var e=GlobalConfig.ActivityType7Config[this.activityID][1];e&&e.showType!=ActivityType7Data.TYPE_RING&&(this.equiplist.dataProvider=new eui.ArrayCollection(this.menuData))},e.prototype.onListTap=function(t){t&&t.itemRenderer&&t.item&&this.listData[this.currentSelect][t.itemIndex]},e.prototype.onTap=function(t){t&&t.itemRenderer&&t.item&&(this.currentSelect=t.itemIndex,this.refushInfo())},e}(BaseEuiView);__reflect(BossScoreExchangeWin.prototype,"BossScoreExchangeWin"),ViewManager.ins().reg(BossScoreExchangeWin,LayerManager.UI_Popup);var HefuAncientBossPanel=function(t){function e(){var e=t.call(this)||this;return e.openTime=[0,1,3,5],e._aryTime=[],e.skinName="hefuBoss",e.bossEffect=new MovieClip,e.bossEffect.scaleX=-1,e.bossEffect.scaleY=1,e.bossEffect.x=128,e.bossEffect.y=160,e.Boss.addChild(e.bossEffect),e.bossImage=new MovieClip,e.bossImage.scaleX=-1,e.bossImage.scaleY=1,e.bossImage.x=128,e.bossImage.y=160,e.Boss.addChild(e.bossImage),e.bossImg.visible=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap)},e.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap),this.rewardList.itemRenderer=ItemBase,this.initView()},e.prototype.initView=function(){this._aryTime=[],this.actInfo.text=GlobalConfig.ActivityBtnConfig[this.activityID].acDesc;var t,i,s=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),n="",o=0;for(i=0;i<this.openTime.length;i++)n.length>0&&(n+="、"),o=s+this.openTime[i]*DateUtils.MS_PER_DAY,t=new Date(o),n+=t.getMonth()+1+"月"+t.getDate()+"日",this._aryTime.push(t.getMonth()+1+"月"+t.getDate()+"日");n+="的"+e.timer+"开启",this.actTime.text=n;var a,r,h,l,c=!1,u=-1;for(i=this.openTime.length-1;i>=0;i--){if(o=s+this.openTime[i]*DateUtils.MS_PER_DAY,t=new Date(o),t.setHours(20,30,0),a=s+(this.openTime[i]+1)*DateUtils.MS_PER_DAY,r=new Date(a),0==i&&(h=t.getTime()),i==this.openTime.length-1&&(l=r.getTime()),!i){GameServer.serverTime>=t.getTime()&&(c=!0),u=i;break}var p=i-1;if(p>=0){var d=this.getBossConfig(i),g=d.killBossId;o=s+this.openTime[i]*DateUtils.MS_PER_DAY;var f=new Date(o);if(f.setHours(0,0,0),1!=CityCC.ins().bossKillNumData[g][1]&&GameServer.serverTime<f.getTime())continue;GameServer.serverTime>=t.getTime()&&(c=!0),u=i;break}}if(c)this.selectCurBoss(GlobalConfig.CityBossConfig[u+1].bossId,u);else if(GameServer.serverTime<h)u=-1,this.selectCurBoss(GlobalConfig.CityBossConfig[1].bossId,u);else if(GameServer.serverTime>=l)u=-2,this.selectCurBoss(GlobalConfig.CityBossConfig[4].bossId,u);else{var v=this.getBossConfig(u+1).bossId;this.selectCurBoss(v,u,!0)}var y;y=-1==u?1:-2==u?4:u+1;var m=GlobalConfig.CityBossConfig[y];m&&(this.rewardList.dataProvider=new eui.ArrayCollection(m.showReward))},e.prototype.selectCurBoss=function(t,i,s){void 0===s&&(s=!1);var n=GlobalConfig.MonstersConfig[t];if(i>=0){var o=GlobalConfig.CityBossConfig[i+1].bossId;n=GlobalConfig.MonstersConfig[o]}var a=GlobalConfig.EffectConfig[n.effect].fileName;this.bossImage.playFile(RES_DIR_MONSTER+("monster"+n.avatar+"_3s"),-1),this.bossEffect.playFile(RES_DIR_EFF+a,-1);var r,h=Activity.ins().getActivityDataById(this.activityID);if(this.redPoint.visible=h.specialState(),i>=0)if(s)r=this._aryTime[i],this.time.text=r+(" "+e.timer),this._btnB=!1;else{r=this._aryTime[i],this.time.text=r+(" "+e.timer);var l=this.getBossConfig(i+1),c=l.killBossId;if(CityCC.ins().bossKillNumData&&void 0!=CityCC.ins().bossKillNumData[c]&&1!=CityCC.ins().bossKillNumData[c][1])this._btnB=!0;else if(this._btnB=!1,r=this._aryTime[i+1]){this.time.text=r+(" "+e.timer);var o=GlobalConfig.CityBossConfig[i+1].bossId;n=GlobalConfig.MonstersConfig[o];var u=GlobalConfig.EffectConfig[n.effect].fileName;this.bossImage.playFile(RES_DIR_MONSTER+("monster"+n.avatar+"_3s"),-1),this.bossEffect.playFile(RES_DIR_EFF+u,-1)}}else this._btnB=!1,-2==i?this.time.text="已结束":-1==i&&(r=this._aryTime[0]+("的"+e.timer+"开启"),this.time.text=r)},e.getCityBossConfig=function(t){var e;for(var i in GlobalConfig.CityBossConfig)if(GlobalConfig.CityBossConfig[i].bossId==t&&GlobalConfig.CityBossConfig[i].killBossId<=999){e=GlobalConfig.CityBossConfig[i];break}return e},e.prototype.getNextBossId=function(){for(var t,e,i=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),s=0,n=0;n<this.openTime.length;n++)t=i+this.openTime[n]*DateUtils.MS_PER_DAY,e=new Date(t),GameServer.serverTime>=e.getTime()&&(s=n);return s},e.prototype.getBossConfig=function(t){return GlobalConfig.CityBossConfig[t]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goBtn:if(!this._btnB)return void UserTips.ins().showTips("BOSS未开启，请准时参加");if(CityCC.ins().enterCD>0)return void UserTips.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城");CityCC.ins().isCity?TimerManager.ins().doNext(function(){var t=ViewManager.ins().getView(BossBelongPanel);t&&t.attrBoss()},this):(CityCC.ins().isChallenge=!0,CityCC.ins().sendEnter()),ViewManager.ins().close(ActivityExWin)}},e}(BaseView);HefuAncientBossPanel.timer="20:30",__reflect(HefuAncientBossPanel.prototype,"HefuAncientBossPanel");var HefuLCZBPanel=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s.openTime=[3,5,7],s.skinName="hefuLongchengSkin",s.effs=[],s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.go,this.onTap),this.observe(GuildWar.ins().postHeFuBelong,this.updateBelongs),GuildWar.ins().sendHeFuBelong(),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.go,this.onTap),this.removeObserve();for(var i=0;i<this.effs.length;i++)this.effs[i]&&DisplayUtils.removeFromParent(this.effs[i]);this.effs=[]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.go:0!=Guild.ins().guildID?(ViewManager.ins().close(ActivityExWin),GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(GuildMap),ViewManager.ins().open(GuildWarMainWin)):UserTips.ins().showTips("还没加入行会")}},e.prototype.getTime=function(t){},e.prototype.updateData=function(){this.actInfo.text=GlobalConfig.ActivityBtnConfig[this.activityID].acDesc;var t,e,i=GlobalConfig.GuildBattleConst.hefuOpen,s=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),n="",o=0;for(e=0;e<i.length;e++){n.length>0&&(n+="、"),o=s+(i[e].day-1)*DateUtils.MS_PER_DAY,t=new Date(o),t.setHours(i[e].hours,i[e].min||0,0,0);var a=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()+"";n+=t.getMonth()+1+"月"+t.getDate()+"日"+t.getHours()+":"+a}this.actTime.text=n;var r,h,l,c=!1,u=0,p=0;for(e=0;e<i.length;e++)if(o=s+(i[e].day-1)*DateUtils.MS_PER_DAY,p=s+i[e].day*DateUtils.MS_PER_DAY,t=new Date(o),t.setHours(i[e].hours,i[e].min||0,0,0),h=new Date(p),h.setHours(0,0,0),0==e&&(r=t.getTime()),e==i.length-1&&(l=h.getTime()),GameServer.serverTime>=t.getTime()&&GameServer.serverTime<h.getTime()){c=!0,u=e;break}c?this.over.visible=!1:(this.over.visible=!0,GameServer.serverTime<r?this.over.text="未开启":GameServer.serverTime>=l?this.over.text="已结束":this.over.text="未开启"),this.go.visible=!this.over.visible;var d=GlobalConfig.GuildBattleConst.hefuAward.leader,g=d.award;this.list0.itemRenderer=ItemBase,this.list1.itemRenderer=ItemBase,this.list2.itemRenderer=ItemBase,this.list0.dataProvider=new eui.ArrayCollection(g[0]),this.list1.dataProvider=new eui.ArrayCollection(g[1]),this.list2.dataProvider=new eui.ArrayCollection(g[2])},e.prototype.updateBelongs=function(){for(var t=0;3>t;t++)GuildWar.ins().GuildNameBelongs[t]?(this["guild"+t].visible=!0,this["guild"+t].text="归属:"+GuildWar.ins().GuildNameBelongs[t]):this["guild"+t].visible=!1},e}(BaseView);__reflect(HefuLCZBPanel.prototype,"HefuLCZBPanel");var Group=eui.Group,HefuXunbaoPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuXunbao",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap),TimerManager.ins().remove(this.playSkillAnmi,this)},e.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap),TimerManager.ins().isExists(this.playSkillAnmi,this)||TimerManager.ins().doTimer(3e3,0,this.playSkillAnmi,this),this.initData()},e.prototype.initData=function(){this.playSkillAnmi(),this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goBtn:ViewManager.ins().close(ActivityWin),ViewManager.ins().open(TreasureHuntWin)}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3);var s=GlobalConfig.ActivityBtnConfig[this.activityID];this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(s.acDesc)},e.prototype.playSkillAnmi=function(){for(var t=this,e=1;2>=e;e++)this["mc"+e]||(this["mc"+e]=new MovieClip);var i=SubRoles.ins().getSubRoleByIndex(0),s="skill40"+i.job,n="skill"+(403+i.job),o=egret.Tween.get(this);this.mc1.parent||this.eff1.addChild(this.mc1),this.mc1.playFile("res/skilleff/"+s,1,null,!0),o.wait(1500).call(function(){t.mc2.parent||t.eff2.addChild(t.mc2),t.mc2.playFile("res/skilleff/"+n,1,null,!0)},this)},e}(BaseView);__reflect(HefuXunbaoPanel.prototype,"HefuXunbaoPanel");var limitChangeItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){if(this._activityID=this.data[0],this._config=this.data[1],this.slimit.visible=this.data[4]!=Number.MAX_VALUE,this.data[4]!=Number.MAX_VALUE){var t=this.data[4]?65280:16711680;this.limitchange0.textFlow=TextFlowMaker.generateTextFlow1("今日全服可兑换次数：|C:"+t+"&T:"+this.data[4])}if(this.data[3]==Number.MAX_VALUE)this.limitchange1.text="";else{var t=this.data[3]?65280:16711680;this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("可兑换：|C:"+t+"&T:"+this.data[3]+"|/"+this._config.count)}this._dataCollect||(this._dataCollect=new ArrayCollection,this.reward.dataProvider=this._dataCollect),this._dataCollect.source=this._config.rewards,this.consnum.text=this._config.itemCount+"",this.get.enabled=this.data[2],this.redPoint.visible=this.get.enabled},e.prototype.onTap=function(t){return UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void Activity.ins().sendReward(this._activityID,this._config.index)},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(limitChangeItemRender.prototype,"limitChangeItemRender");var OSATarget7Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityType7Config[this.activityID];if(!this.type2PanelList[this.activityID]){var s=i[1].showType,n=ObjectPool.pop("OSATarget7Panel"+(s==ActivityType7Data.TYPE_RING||s==ActivityType7Data.TYPE_HEFUBOSS||s==ActivityType7Data.TYPE_CELEBREATE?1:s));n.top=0,n.bottom=0,n.left=0,n.right=0,n.activityID=this.activityID,this.type2PanelList[this.activityID+""]=n}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget7Panel.prototype,"OSATarget7Panel");var OSATarget7Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuHalftimeBoss",e.bossMc=new MovieClip,e.bossGroup.addChild(e.bossMc),e.bossMc.x=e.bossGroup.x,e.bossMc.y=e.bossGroup.y,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.boss,this.onTap),this.addTouchEvent(this.costbtn,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(Activity.ins().postChangePage,this.GetCallBack),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.boss,this.onTap),this.removeTouchEvent(this.costbtn,this.onTap),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onClick=function(t){},e.prototype.onTap=function(t){switch(t.currentTarget){case this.boss:ViewManager.ins().open(BossWin,1);break;case this.costbtn:this.activityData&&ViewManager.ins().open(BossScoreExchangeWin,this.activityID)}},e.prototype.GetCallBack=function(t){this.updateData()},e.prototype.updateData=function(){var t=GlobalConfig.ActivityType7Config[this.activityID][1];t.showType==ActivityType7Data.TYPE_RING?this.currentState="lieyan":t.showType==ActivityType7Data.TYPE_HEFUBOSS?this.currentState="hefu":this.currentState="celebreate",this.validateNow();var e=GlobalConfig.ActivityBtnConfig[this.activityID];e&&(this.title.source=e.title),this.activityData=Activity.ins().getActivityDataById(this.activityID),this.setTime(),this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var i=Activity.ins().getActivityDataById(this.activityID);this.cost.text="积分:"+i.bossScore;var s="monster10129_3s";t.exValue&&t.exValue.bossModel&&(s=t.exValue.bossModel),this.bossMc.playFile(RES_DIR_MONSTER+s,-1),this.redPoint.visible=Activity.ins().getType7RedPoint(this.activityID)},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime.text="活动未开启":0>=e?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget7Panel1.prototype,"OSATarget7Panel1");var OSATarget7Panel3=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e._matrailId=0,e._oldCount=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actInfo0.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.content.itemRenderer=limitChangeItemRender},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="limitChangeSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.updateData()},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().remove(this.setTime,this),this._leftTime=0,this._oldCount=0},e.prototype.updateData=function(){this._activityData=Activity.ins().getActivityDataById(this.activityID),this.checkTime(),this.updateList()},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagItemById(this._matrailId),e=t?t.count:0;e!=this._oldCount&&this.updateList()},e.prototype.updateList=function(){var t=GlobalConfig.ActivityType7Config[this.activityID];this._matrailId=t[1].itemId;var e=UserBag.ins().getBagItemById(this._matrailId),i=e?e.count:0;this.num.text=i+"",this._oldCount=i;var s,n=[],o=0,a=0,r=0,h=0;for(var l in t)s=t[l],h=void 0==s.scount||0==s.scount?Number.MAX_VALUE:s.scount-this._activityData.worldRewardsSum[o+1],r=void 0==s.count||0==s.count?Number.MAX_VALUE:s.count-this._activityData.personalRewardsSum[o+1],a=h&&r&&i>=s.itemCount?1:0,n[o]=[this.activityID,s,a,r,h],o++;n.sort(this.sort),this._dataCollect||(this._dataCollect=new ArrayCollection,this.content.dataProvider=this._dataCollect),this._dataCollect.source=n},e.prototype.sort=function(t,e){return t[2]>e[2]?-1:t[2]<e[2]?1:t[1].index<e[1].index?-1:1},e.prototype.checkTime=function(){TimerManager.ins().remove(this.setTime,this),this._leftTime=0,Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3)>=0?this.actTime0.text="活动未开启":(this._leftTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3),this._leftTime<=0?this.actTime0.text="活动已结束":(this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),TimerManager.ins().doTimer(1e3,0,this.setTime,this)))},e.prototype.setTime=function(){this._leftTime--,this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),this._leftTime<=0&&this.checkTime()},e}(BaseView);__reflect(OSATarget7Panel3.prototype,"OSATarget7Panel3");var RingBossScoreExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ringBossItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data instanceof ActivityType7Config){var t=this.data,e=GlobalConfig.ItemConfig[t.rewards[0].id],i=Activity.ins().getActivityDataById(t.Id),s=i.bossScore,n=Activity.ins().getIsBuy(t);this.redPoint.visible=n&&s>=t.score,this.nameLab.text=e.name;var o=s<t.score?"#F3311E":"#35E62D";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+o+"'>"+s+"</font><font color = '#9F946D'>/"+t.score+"</font>"),this.itemConfig=e,this.itemIcon0.data=t.rewards[0],this.itemIcon0.hideName();var a=Activity.ins().getActivityDataById(t.Id),r=a.personalRewardsSum[t.index],h=t.count-r;h?this.count.text="剩余"+h+"份":this.count.text=""}},e.prototype.onClick=function(){if(this.data instanceof ActivityType7Config){var t=this.data,e=Activity.ins().getActivityDataById(t.Id);if(e.bossScore<t.score)return void UserTips.ins().showTips("|C:0xf3311e&T:积分不足|");if(!Activity.ins().getIsBuy(t))return void UserTips.ins().showTips("|C:0xf3311e&T:已经兑换完|");Activity.ins().sendReward(t.Id,t.index)}},e}(eui.ItemRenderer);__reflect(RingBossScoreExchangeItem.prototype,"RingBossScoreExchangeItem");var PActivityDataFactory=function(){function t(){}return t.create=function(e){var i,s=e.readInt(),n=e.readInt(),o=e.readInt(),a=e.readShort(),r=e.readInt();switch(a){case t.PACTIVITY_TYPE_1:i=new PActivityType1Data(e);break;case t.PACTIVITY_TYPE_2:i=new PActivityType2Data(e);break;case t.PACTIVITY_TYPE_3:i=new PActivityType3Data(e);break;case t.PACTIVITY_TYPE_9:i=new PActivityType9Data(e);break;default:if(!ErrorLog.Assert(a,"错误个人活动:"+s+" 类型:"+a))for(var h=0;r>h;h++)e.readByte();return null}if(!i)return null;i.id=s,i.startTime=n,i.endTime=o,i.type=a,i.activityType=ActivityType.Personal;var l=GlobalConfig.PActivityConfig[s];return l&&(i.duration=l.duration),i},t}();PActivityDataFactory.PACTIVITY_TYPE_1=1,PActivityDataFactory.PACTIVITY_TYPE_2=2,PActivityDataFactory.PACTIVITY_TYPE_3=3,PActivityDataFactory.PACTIVITY_TYPE_4=4,PActivityDataFactory.PACTIVITY_TYPE_5=5,PActivityDataFactory.PACTIVITY_TYPE_6=6,PActivityDataFactory.PACTIVITY_TYPE_7=7,PActivityDataFactory.PACTIVITY_TYPE_8=8,PActivityDataFactory.PACTIVITY_TYPE_9=9,PActivityDataFactory.PACTIVITY_TYPE_10=10,PActivityDataFactory.PACTIVITY_TYPE_11=11,PActivityDataFactory.PACTIVITY_TYPE_17=17,__reflect(PActivityDataFactory.prototype,"PActivityDataFactory");var PActivityType1Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType1Data);__reflect(PActivityType1Data.prototype,"PActivityType1Data");var PActivityType2Data=function(t){function e(e){var i=t.call(this,e)||this;return i.buyData=[],i.serverBuyData=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var i=e.readShort(),s=e.readInt();this.buyData[i]=s,this.serverBuyData[i]=e.readInt()},e.prototype.initBuyData=function(t){for(var e=t.readShort(),i=1;e>=i;i++)this.buyData[i]=t.readShort(),this.serverBuyData[i]=t.readShort();this.sumRMB=t.readInt()},e.prototype.canReward=function(){if(Actor.level<e.LimitLevel)return!1;var t;t=PActivity.ins().getActivityDataById(this.id);var i=GlobalConfig.PActivity2Config[this.id],s=!1;for(var n in i){var o=i[n],a=t.buyData[o.index]>=o.count?!0:!1;if(!a&&t.sumRMB>=o.needRecharge&&Actor.yb>=o.price&&UserVip.ins().lv>=o.vip&&!s)return!0}return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;for(var t=GlobalConfig.PActivity2Config[this.id],e=1;e<this.buyData.length;e++){var i=t[e];if(this.buyData[e]<i.count)return this.isHide=!1,this.isHide}return this.isHide=!0,this.isHide},e.prototype.getLeftTime=function(){if(this.endTime){var t=DateUtils.formatMiniDateTime(this.endTime)/1e3,e=Math.floor((t-GameServer.serverTime)/1e3);return 0>e&&(e=0),e}return 0},e.prototype.getSpecialOpenLeftTime=function(){},e.prototype.getAreaReward=function(t,e){return 0},e}(ActivityBaseData);PActivityType2Data.LimitLevel=50,__reflect(PActivityType2Data.prototype,"PActivityType2Data");var PActivityType3Data=function(t){function e(e){var i=t.call(this,e)||this;return i.dabiao=[],i.chongzhiNum=0,i.chongzhiTotal=0,i.btn1=!1,i.btn2=!1,i.image1=!1,i.image2=!1,i.updateData(e),i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.recrod=e.readInt()},e.prototype.openDay=function(){var t=GlobalConfig.PActivity3Config[this.id];return t&&t[0]?t[0].day:7},e.prototype.canReward=function(){var t=GlobalConfig.PActivity3Config[this.id],e=this.recrod,i=-1,s=0;for(var n in t){var o=e>>t[n].index&1;if(1==t[n].type){if(this.dabiao[s]>=t[n].day&&0==o)return!0}else if(2==t[n].type&&t[n].val<=this.chongzhiTotal){if(0==o)return!0}else if(3==t[n].type&&t[n].val<=this.chongzhiNum&&(-1==i&&(i=this.getCurIndex(3)),i==t[n].index&&0==o))return!0;s++}return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.updateData=function(t){var e=t.readShort();this.dabiao=[];for(var i=0;e>i;i++)this.dabiao.push(t.readShort());this.chongzhiNum=t.readInt(),this.chongzhiTotal=t.readInt()},Object.defineProperty(e.prototype,"day7text",{get:function(){var t=GlobalConfig.PActivity3Config[this.id];for(var e in t)1==t[e].type&&(this.rewards1=t[e].rewards,this._day7text="累计"+("<font color='#ffff00'>"+t[e].day+"</font>")+"天，每日充值"+("<font color='#ffff00'>"+t[e].val+"</font>")+"元宝可领取");return this._day7text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totaltext",{get:function(){var t=GlobalConfig.PActivity3Config[this.id];for(var e in t)2==t[e].type&&(this.maxTotal=t[e].val,this.rewards2=t[e].rewards,this._totaltext="活动期间累计充值"+("<font color='#ffff00'>"+t[e].val+"</font>")+"元宝可领取");return this._totaltext},enumerable:!0,configurable:!0}),e.prototype.canOnlyReward=function(){var t=GlobalConfig.PActivity3Config[this.id],e=this.recrod;this.btn1=!1,this.btn2=!1,this.image1=!1,this.image2=!1;for(var i in t){var s=e>>t[i].index&1;1==t[i].type&&this.dabiao&&this.dabiao[0]>=t[i].day&&(0==s&&(this.btn1=!0),1==s&&(this.image1=!0)),2==t[i].type&&t[i].val<=this.chongzhiTotal&&(0==s&&(this.btn2=!0),1==s&&(this.image2=!0))}},e.prototype.getDateTime=function(t){var e=t.split(/[-,.,:]/g),i=new Date(+e[0],+e[1]-1,+e[2],+e[3]||0,+e[4]||0);return i.getTime()},e.prototype.curOpenDay=function(){var t=Math.floor(GameServer.serverTime-DateUtils.formatMiniDateTime(this.startTime)/1e3/3600/24);return t},e.prototype.getCurIndex=function(t){var e=(GlobalConfig.PActivityConfig[this.id],GlobalConfig.PActivity3Config[this.id]),i=0;this.startTime&&(i=this.curOpenDay());var s={};for(var n in e)s[e[n].type]=1;var o=Object.keys(s);(1==o.length||void 0==t)&&(t=+o[0]);var a,r=[];for(a in e)e[a].type==t&&r.push(e[a]);r.sort(function(t,e){return t.day<e.day?-1:1});for(var h=0,l=r;h<l.length;h++){var c=l[h];if(a=c.index,1==t||2==t){if(i<c.day)return+a}else if(3==t&&i<c.day)return+a}return+a},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRewardStateById=function(t){var e=GlobalConfig.PActivity3Config[this.id][t];switch(e.showType){case Show3Type.TYPE6:case Show3Type.TYPE8:if(this.chongzhiTotal<e.val)return Activity.NotReached;break;case Show3Type.TYPE7:if(this.dabiao[t-1]<e.day)return Activity.NotReached}var i=this.recrod>>e.index&1;return i?Activity.Geted:Activity.CanGet},e}(ActivityBaseData);__reflect(PActivityType3Data.prototype,"PActivityType3Data");var PShow1Type;!function(t){t[t.TYPE1=1]="TYPE1",t[t.TYPE2=2]="TYPE2",t[t.TYPE3=3]="TYPE3",t[t.TYPE4=4]="TYPE4",t[t.TYPE5=5]="TYPE5",t[t.TYPE6=6]="TYPE6",t[t.TYPE7=7]="TYPE7",t[t.TYPE8=8]="TYPE8"}(PShow1Type||(PShow1Type={}));var PActivityType9Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType9Data);__reflect(PActivityType9Data.prototype,"PActivityType9Data");var PActivity=function(t){function e(){var e=t.call(this)||this;return e.activityData={},e.palyEffList=[],e.rankInfoList=[],e.indexCurrDabiao=0,e.nextDayState=0,e.hfLoginDay=1,e.geLoginDay=1,e.isSuccee=!1,e.sysId=PackageID.PActivity,e.regNetMsg(1,e.doActivityData),e.regNetMsg(2,e.postRewardResult),e.regNetMsg(7,e.postChangePage),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initZero=function(){if(this.activityData)for(var t in this.activityData){var e=+t;if(1e4>e){var i=GlobalConfig.ActivityConfig[t];i&&this.sendChangePage(e)}}},e.prototype.getActivityDataById=function(t){return this.activityData[t]},e.prototype.getPalyEffListById=function(t){return this.palyEffList[t]},e.prototype.setPalyEffListById=function(t,e){this.palyEffList[t]=e},e.prototype.getrankInfoListByIndex=function(t){return this.rankInfoList[t]},e.prototype.doActivityData=function(t){this.activityData={};for(var e=t.readShort(),i=0;e>i;i++){var s=PActivityDataFactory.create(t);if(s){var n=s.id;this.activityData[n]=s}}this.postActivityIsGetAwards()},e.prototype.postSpecials=function(){},e.prototype.postActivityIsGetAwards=function(){},e.prototype.postRewardResult=function(t){this.isSuccee=t.readBoolean();var e=t.readInt();return this.getActivityDataById(e).update(t),this.postActivityPanel(e),this.postActivityIsGetAwards(),e},e.prototype.postActivityPanel=function(t){return t},e.prototype.sendReward=function(t,e,i){var s=this.getBytes(2),n=GlobalConfig.PActivityConfig[t];n&&n.activityType==PActivityDataFactory.PACTIVITY_TYPE_9?e?(s.writeInt(t),s.writeShort(e)):(s.writeInt(t),s.writeShort(e),s.writeByte(i)):(s.writeInt(t),s.writeShort(e)),this.sendToServer(s)},e.prototype.sendLianxuReward=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.doRewardStatu=function(t){var e=t.readInt(),i=this.getActivityDataById(e);
i&&i.updateData(t),this.postActivityIsGetAwards()},e.prototype.postChangePage=function(t){var e=PActivityDataFactory.create(t);return e&&(this.activityData[e.id]=e),this.postActivityIsGetAwards(),e?e.id:0},e.prototype.sendChangePage=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.doDaBiaoInfo=function(t){this.dabiaoDecode(t),this.postGetDaBiaoInfo()},e.prototype.postGetDaBiaoInfo=function(){},e.prototype.doNextDayLoginData=function(t){this.nextDayState=t.readShort(),debug.log(this.nextDayState)},e.prototype.doNextDayLoginReward=function(t){var e=t.readShort();e&&(this.nextDayState=2,UserTips.ins().showTips(StringUtils.addColor("领取奖励成功",15937822)))},e.prototype.sendNextDayReward=function(){var t=this.getBytes(20);this.sendToServer(t)},e.prototype.sendDabiaoInfo=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetDabiaoReward=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.postIsGetAwards=function(t){this.isGetAward=t.readBoolean()},e.prototype.sendGetSevenDayAwards=function(t){var e=this.getBytes(12);e.writeShort(t),this.sendToServer(e)},e.prototype.doSevenDayData=function(t){this.dayNum=t.readShort(),this.isAwards=t.readInt(),this.postSevendayIsAwards()},e.prototype.doChangeSevenDayData=function(t){var e=t.readBoolean();if(e){t.readShort();this.isAwards=t.readInt(),this.postSevendayAwardCallback()}else UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");this.postSevendayIsAwards()},e.prototype.postSevendayAwardCallback=function(){},e.prototype.postSevendayIsAwards=function(){},e.prototype.postNextDayInfo=function(){},e.prototype.getSevenDayStast=function(){var t=DateUtils.DAYS_PER_WEEK;t=this.dayNum>14?14:this.dayNum;for(var e=1;t>=e;e++){var i=GlobalConfig.LoginRewardsConfig[e];if(i&&this.dayNum>=i.day&&0==(this.isAwards>>i.day&1))return!0}return!1},e.prototype.getSevenDayLogIsVisible=function(){return 0==(this.isAwards>>14&1)},e.prototype.getbtnInfo=function(t){var e=GlobalConfig.PActivityBtnConfig;return e[t]?e[t]:null},e.prototype.isShowRedPointByBtnInfo=function(t){var e=!1;return e=this.checkAcCanGet(t.id+"")},e.prototype.checkAcCanGet=function(t){var e=this.activityData;for(var i in e)if(i==t&&e[i].isOpenActivity()&&e[i].canReward()&&e[i].specialState())return!0;return!1},e.prototype.checkOtherCharge2CanGet=function(){var t=Recharge.ins().getRechargeData(1),e=GlobalConfig.ChongZhi2Config[t.day/7>=1?2:1][t.day%7];for(var i in e)if(0==(t.isAwards>>e[i].index&1)&&t.num>=e[i].pay)return!0;return!1},e.prototype.dabiaoDecode=function(t){this.isDaBiao=t.readBoolean(),this.indexCurrDabiao=Math.max(t.readInt()-1,0);var e=t.readShort();if(e==RankDataType.TYPE_LEVEL)t.readInt(),t.readInt();else if(e==RankDataType.TYPE_BAOSHI)this.myDabiaoInfo=t.readInt();else if(e==RankDataType.TYPE_ZHANLING){var i=t.readInt(),s=t.readInt();this.myDabiaoInfo=[i,s]}else e==RankDataType.TYPE_LONGHUN?this.myDabiaoInfo=t.readInt():e==RankDataType.TYPE_XIAOFEI?this.myDabiaoInfo=t.readInt():e==RankDataType.TYPE_HF_XIAOFEI?(this.myDabiaoInfo=t.readInt(),this.myPaiming=t.readInt()):this.myDabiaoInfo=t.readDouble();var n,o=t.readShort();this.rankInfoList=[];for(var a=0;o>a;a++)this.rankInfoList[a]||this.rankInfoList.push(new PDabiaoData),n=this.rankInfoList[a],n.prase(t,e)},e.prototype.getisCangetDabiao3=function(t){var i=e.ins().getActivityDataById(t);return i.canOnlyReward?(i.canOnlyReward(),i.btn1||i.btn2):this.checkAcCanGet(t+"")},e.prototype.getisCanBuyXianGou=function(t){var e=!1,i=GlobalConfig.PActivity2Config[t];if(i)for(var s=0;s<i.length&&!(e=this.getisCanBuyXianGouItem(t,s));s++);return e},e.prototype.getisCanBuyXianGouItem=function(t,i){var s=!1,n=e.ins().activityData[t],o=GlobalConfig.PActivity2Config[t];if(n&&o){var a=o[i],r=n.buyData[i]||0;if(a&&r){var h=1==a.currencyType?Actor.gold:Actor.yb,l=1==a.currencyType,c=h>=a.price,u=a.count-r>0;s=l&&c&&u}}return s},e.prototype.IsHefuXunBaoTimer=function(){if(!GameServer._serverHeZeroTime)return!1;var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),e=t+24*GlobalConfig.TreasureHuntConfig.hefuDay*60*60*1e3,i=GameServer.serverTime;return i>=t&&e>=i?!0:!1},e.prototype.IsBossScoreTitle=function(t,e){return!1},e.prototype.getIsBuy=function(t){if(t){var e=Activity.ins().getActivityDataById(t.Id);return t.count&&e.personalRewardsSum[t.index]>=t.count?!1:t.scount&&e.worldRewardsSum[t.index]>=t.scount?!1:!0}},e.prototype.getType7RedPoint=function(t){var e,i=GlobalConfig.ActivityType7Config[t],s=Activity.ins().getActivityDataById(t);for(var n in i)if(Activity.ins().getIsBuy(i[n]))if(i[n].itemId){if(e=UserBag.ins().getBagItemById(i[n].itemId),e&&e.count>=i[n].itemCount)return!0}else if(s.bossScore>=i[n].score)return!0;return!1},e.prototype.getCurrentRingAwardIndex=function(t){var e=1;if(t>0)for(;0!=(t>>e&1);)e++;return e},e.prototype.getRingAward=function(t){for(var e in GlobalConfig.ActivityType8Config){var i=GlobalConfig.ActivityType8Config[e][1];if(i.showType==ActivityType8Data.TYPE_RING)for(var s in GlobalConfig.ActivityType8Config[e])if(s==t.toString())return GlobalConfig.ActivityType8Config[e][s]}return null},e.prototype.getLastRingAward=function(){var t;for(var e in GlobalConfig.ActivityType8Config){var i=GlobalConfig.ActivityType8Config[e][1];if(i.showType==ActivityType8Data.TYPE_RING)for(var s in GlobalConfig.ActivityType8Config[e])t=GlobalConfig.ActivityType8Config[e][s]}return t},e.prototype.addEvent=function(){MessageCenter.addListener(GameLogic.ins().postEnterMap,this.openRingActivity,this)},e.prototype.removeEvent=function(){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap.funcallname,this.openRingActivity,this)},e.prototype.openRingActivity=function(){0==GameMap.fbType&&(MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap.funcallname,this.openRingActivity,this),ViewManager.ins().open(ActivityWin,201),Activity.ins().sendChangePage(201))},e.prototype.getType8RedPoint=function(t){var e=!1,i=Activity.ins().activityData[t];return i&&0==i.record&&(e=!0),e},e.prototype.getType9RedPoint=function(t){var i=!1;e.ins().activityData[t];if(this.getRollSum(t))i=!0;else{var s=GlobalConfig.PActivityType9Config[t];for(var n in s[0].reward)if(this.isGetRollReward(t,+n)){i=!0;break}}return i},e.prototype.getType10RedPoint=function(t){var e=Activity.ins().activityData[t],i=GlobalConfig.ActivityType10Config[t][e.getLevel()];return i&&e.yb>=i.recharge&&Actor.yb>=i.yuanBao?!0:!1},e.prototype.getType17RedPoint=function(t){var e=Activity.ins().activityData[t],i=GlobalConfig.ActivityType17_2Config[t];return i&&e.score>=i.score?!0:!1},e.prototype.isGetRollReward=function(t,i){var s=e.ins().activityData[t],n=GlobalConfig.PActivityType9Config[t];return n&&n[0]&&n[0].reward[i].times&&s.count>=n[0].reward[i].times&&!(s.record>>i+1&1)?!0:!1},e.prototype.getRollSum=function(t){var e=GlobalConfig.PActivityType9Config[t];if(e&&e[0]){var i=UserBag.ins().getBagItemById(e[0].item);if(i)return!0}return!1},e.prototype.getIsRollTen=function(t){var e=GlobalConfig.PActivityType9Config[t][0];if(e){var i=0;if(e.item){var s=UserBag.ins().getBagItemById(e.item);if(s&&(i+=s.count),i>=10)return!0}if(i=10-i,e.yb&&Actor.yb>=e.yb*i)return!0}return!1},e}(BaseSystem);PActivity.NotReached=0,PActivity.CanGet=1,PActivity.Geted=2,PActivity.NOKILL=0,PActivity.KILL=1,__reflect(PActivity.prototype,"PActivity");var PDabiaoData=function(){function t(){}return t.prototype.prase=function(t,e){if(e==RankDataType.TYPE_XIAOFEI||e==RankDataType.TYPE_HF_XIAOFEI)return this.rankIndex=t.readShort(),this.id=t.readInt(),this.name=t.readString(),void(this.numType=t.readInt());if(this.rankIndex=t.readShort(),this.id=t.readInt(),this.name=t.readString(),this.level=t.readShort(),this.zsLevel=t.readShort(),this.monthCard=t.readShort(),this.vipLv=t.readShort(),RankDataType.TYPE_LEVEL!=e)if(e==RankDataType.TYPE_BAOSHI||e==RankDataType.TYPE_LONGHUN)this.numType=t.readInt();else if(e==RankDataType.TYPE_ZHANLING){var i=t.readInt(),s=t.readInt();this.numType=[i,s]}else this.numType=t.readDouble()},t}();__reflect(PDabiaoData.prototype,"PDabiaoData");var GameSystem;!function(t){t.pactivity=PActivity.ins.bind(PActivity)}(GameSystem||(GameSystem={}));var Artifact=function(t){function e(){var e=t.call(this)||this;return e.artifacts=[],e.showGuide=-2e3,e.openHeji=0,e.attArr=["a","args","b","cd","crit","d","selfEff"],e.listArtifacts={},e.sysId=PackageID.Artifact,e.regNetMsg(1,e.postArtifactInit),e.regNetMsg(2,e.postArtifactUpdate),e.regNetMsg(3,e.postNewArtifactInit),e.regNetMsg(4,e.postNewArtifactUpdate),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getNewArtifactPower=function(t){var e=GlobalConfig.ImbaConf[t],i=this.listArtifacts[e.id];if(!i)return 0;for(var s=!0,n=0,o=0;o<e.jigsawId.length;o++){var a=i.record>>o&1;a?n+=GlobalConfig.ImbaJigsawConf[e.jigsawId[o]].power:s=!1}return i.open&&(n+=e.power),n},e.prototype.getAttr=function(){var t={};for(var e in GlobalConfig.ImbaConf){for(var i=GlobalConfig.ImbaConf[e],s=this.getNewArtifactBy(i.index),n=0;n<i.jigsawId.length;n++){var o=s.record>>n&1;if(o)for(var a=GlobalConfig.ImbaJigsawConf[i.jigsawId[n]],r=0;r<a.attrs.length;r++){var h=a.attrs[r];AttributeData.addAttrToList(t,h)}}if(s.open&&i.attrs)for(var n=0;n<i.attrs.length;n++)AttributeData.addAttrToList(t,i.attrs[n])}var l=[];for(var c in t)l.push(t[c]);return l.sort(AttributeData.sortAttribute),l},e.prototype.getAllArtifactPower=function(){var t=0;for(var e in GlobalConfig.ImbaConf)t+=this.getNewArtifactPower(+e);return t},e.prototype.getArtifactIndexById=function(t){for(var e in GlobalConfig.ImbaConf)if(GlobalConfig.ImbaConf[e].id==t)return GlobalConfig.ImbaConf[e].index;return 0},e.prototype.getNewArtifactBy=function(t){var e=0;if(!GlobalConfig.ImbaConf[t])return null;if(e=GlobalConfig.ImbaConf[t].id,!this.listArtifacts[e]){var i=new NewArtifactData;i.id=e,i.record=0,this.listArtifacts[e]=i}return this.listArtifacts[e]},e.prototype.getMaxIndex=function(){if(!this.maxIndex){var t=1,e=GlobalConfig.ImbaConf;for(var i in e)t=Math.max(e[i].index,t);this.maxIndex=t}return this.maxIndex},e.prototype.getConfById=function(t){var e=GlobalConfig.ImbaConf;for(var i in e)if(e[i].id==t)return e[i]},e.prototype.showRedPoint=function(){for(var t=this.getMaxIndex(),e=1;t>=e;e++){var i=GlobalConfig.ImbaConf[e],s=this.getNewArtifactBy(e);if(!s.open){var n=i.jigsawId.length,o=Math.pow(2,n)-1;if(o==s.record)return!0;if(s.exitRecord!=s.record)return!0}}return!1},e.prototype.getNextChapterId=function(){for(var t=this.getMaxIndex(),e=1;t>=e;e++){var i=this.getNewArtifactBy(e);i.getNextChipId()}},e.prototype.getConfByChipId=function(t){var e=GlobalConfig.ImbaConf;for(var i in e)if(-1!=e[i].jigsawId.indexOf(t))return e[i];return null},e.prototype.setGuide=function(){this.showGuide=egret.getTimer(),this.postGuide(),TimerManager.ins().remove(this.guideEnd,this),TimerManager.ins().doTimer(3e3,1,this.guideEnd,this)},e.prototype.guideEnd=function(){e.ins().showGuide=-3e3,e.ins().postGuide()},e.prototype.postGuide=function(){},e.prototype.postArtifactInit=function(t){for(var e=t.readInt(),i=0;e>i;i++){var s=new ArtifactData;s.parser(t),this.artifacts[s.id]=s}},e.prototype.postArtifactUpdate=function(t){var e=t.readBoolean();if(e){var i=t.readInt(),s=t.readShort();this.artifacts[i].rank=s}else UserTips.ins().showTips("不满足条件");return e},e.prototype.sendRank=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.postNewArtifactInit=function(t){var e=t.readUnsignedShort();this.artifactsOpenDic={};for(var i=0;e>i;i++){var s=new NewArtifactData;s.id=t.readInt(),s.record=t.readInt(),s.open=0!=t.readByte(),s.open?(s.exitRecord=Math.pow(2,32)-1,1==e&&1==this.openHeji&&(this.openHeji=2)):s.exitRecord=t.readInt(),this.listArtifacts[s.id]=s,s.open&&(this.artifactsOpenDic[s.id]=s)}this.setImbaBuffDic()},e.prototype.setImbaBuffDic=function(){if(!this.imbaBuffDic){this.imbaBuffDic={};var t=GlobalConfig.ImbaSkillReviseConfig;for(var e in t)this.imbaBuffDic[t[e].skill]||(this.imbaBuffDic[t[e].skill]={}),this.imbaBuffDic[t[e].skill][t[e].imba_id]||(this.imbaBuffDic[t[e].skill][t[e].imba_id]={}),this.imbaBuffDic[t[e].skill][t[e].imba_id]=t[e]}var i=CommonUtils.getObjectLength(this.artifactsOpenDic);if(i){this.imbaSkillDic={};for(var s in this.imbaBuffDic)for(var n in this.imbaBuffDic[s])if(this.artifactsOpenDic[n]){this.imbaSkillDic[s]||(this.imbaSkillDic[s]=new ImbaSkillReviseConfig);for(var o in this.imbaSkillDic[s])-1!=this.attArr.indexOf(o)&&this.imbaBuffDic[s][n][o]&&("selfEff"==o?(this.imbaSkillDic[s][o]||(this.imbaSkillDic[s][o]=[]),this.imbaSkillDic[s][o].push(this.imbaBuffDic[s][n][o][0])):"args"==o?this.imbaSkillDic[s][o]=this.imbaBuffDic[s][n][o]:this.imbaSkillDic[s][o]+=this.imbaBuffDic[s][n][o])}}},e.prototype.getReviseBySkill=function(t){if(!this.imbaSkillDic)return null;var e=Math.floor(t/1e3);return this.imbaSkillDic[e]?this.imbaSkillDic[e]:null},e.prototype.postNewArtifactUpdate=function(t){var e=t.readInt(),i=this.listArtifacts[e];if(i){var s=i.exitRecord;i.exitRecord=t.readInt(),i.record=t.readInt();for(var n=i.exitRecord-s,o=this.getConfById(e),a=0;a<o.jigsawId.length;a++){var r=n>>a&1;if(r){var h=new ItemData;h.configID=o.jigsawId[a]}}}else{var l=new NewArtifactData;l.id=e,l.exitRecord=t.readInt(),l.record=t.readInt(),this.listArtifacts[e]=l}},e.prototype.sendOpenChip=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.openArtifact=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e),0==this.openHeji&&(this.openHeji=1)},e}(BaseSystem);__reflect(Artifact.prototype,"Artifact");var GameSystem;!function(t){t.artifact=Artifact.ins.bind(Artifact)}(GameSystem||(GameSystem={}));var ArtifactData=function(){function t(){this.id=0,this.rank=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.rank=t.readShort()},t}();__reflect(ArtifactData.prototype,"ArtifactData");var NewArtifactData=function(){function t(){this.id=0,this.record=0,this.open=!1,this.exitRecord=0}return t.prototype.isChipExit=function(t){return 1==(this.exitRecord>>t&1)},t.prototype.isChipOpen=function(t){return 1==(this.record>>t&1)},t.prototype.getChipLength=function(){return GlobalConfig.ImbaConf[this.id].jigsawId.length},t.prototype.getNextChipId=function(){for(var t=GlobalConfig.ImbaConf[this.id],e=0;e<t.jigsawId.length;e++)if(!this.isChipExit(e))return t.jigsawId[e];return null},t.prototype.remindNumToOpen=function(){for(var t=this.getConf(),e=0,i=0;i<t.jigsawId.length;i++)this.isChipExit(i)||e++;return e},t.prototype.getConf=function(){for(var t in GlobalConfig.ImbaConf)if(GlobalConfig.ImbaConf[t].id==this.id)return GlobalConfig.ImbaConf[t]},t}();__reflect(NewArtifactData.prototype,"NewArtifactData");var ArtifactAllAttrWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqiAttrskin",e.list.itemRenderer=ArtifactAttrDescItem,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.rect,this.onTap),this.list.dataProvider=new eui.ArrayCollection(Artifact.ins().getAttr())},e.prototype.close=function(){},e.prototype.onTap=function(t){switch(t.target){case this.rect:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ArtifactAllAttrWin.prototype,"ArtifactAllAttrWin"),ViewManager.ins().reg(ArtifactAllAttrWin,LayerManager.UI_Popup);var ArtifactAttrDescItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenQiAttrDescSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=AttributeData.getAttStrByType(t,0,"：");this.labelInfo.text=e},e}(eui.ItemRenderer);__reflect(ArtifactAttrDescItem.prototype,"ArtifactAttrDescItem");var ArtifactChipOpenWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqiPartActskin",e.list.itemRenderer=ArtifactAttrDescItem,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[1],this.mId=t[0],this.openTips(this.mId),this.addTouchEvent(this.btnOpen,this.onTap)},e.prototype.close=function(){},e.prototype.openTips=function(t){var e=Artifact.ins().getNewArtifactBy(this.index),i=GlobalConfig.ImbaJigsawConf[t];this.list.dataProvider=new eui.ArrayCollection(i.attrs),this.imgArtifact.source=i.img,this.labelInfo.text="再获得"+e.remindNumToOpen()+"个碎片可激活完整神器",this.labelName.text=i.name},e.prototype.onTap=function(t){switch(t.target){case this.btnOpen:Artifact.ins().sendOpenChip(this.mId),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ArtifactChipOpenWin.prototype,"ArtifactChipOpenWin"),ViewManager.ins().reg(ArtifactChipOpenWin,LayerManager.UI_Popup);var ArtifactConditionItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ArtifactsItemSkin",e.go.addEventListener(egret.TextEvent.LINK,e.onGo,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.taskId,e=UserTask.ins().getAchieveByTaskId(t);this.config=UserTask.ins().getAchieveConfById(e.id);var i;e.value>=this.config.target?(i="0x35e62d",this.go.visible=!1,this.complete.visible=!0):(i="0xf3311e",this.go.textFlow=(new egret.HtmlTextParser).parser("<a href='event:' color=0x35e62d><u>前往</u></a>"),this.go.visible=!0,this.complete.visible=!1,void 0==this.config.controlTarget&&(this.go.visible=!1));var s=this.config.name+"(<font color="+i+">"+e.value+"</font>/"+this.config.target+")";this.desc.textFlow=(new egret.HtmlTextParser).parser(s)},e.prototype.destruct=function(){this.go.removeEventListener(egret.TextEvent.LINK,this.onGo,this)},e.prototype.onGo=function(){void 0==this.config.controlTarget?new Error("配置表没有配跳转界面ID"):(ViewManager.ins().close(this.config.controlTarget[0].toString()),ViewManager.ins().open(this.config.controlTarget[0].toString(),[this.config.controlTarget[1]]))},e}(BaseItemRender);__reflect(ArtifactConditionItemRenderer.prototype,"ArtifactConditionItemRenderer");var ArtifactSuiItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqiItemskin",e}return __extends(e,t),e.prototype.dataChanged=function(){""==this.data.name?(this.itemImg.visible=!1,this.labelMaterial.visible=!1,this.closeImg.visible=!0):(this.data.state?this.labelMaterial.textColor=3532333:this.labelMaterial.textColor=12434877,this.data.state2?(this.mc||(this.mc=new MovieClip,this.mc.x=0,this.mc.y=0),this.groupMc.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"chargeff1",-1)):this.mc&&DisplayUtils.removeFromParent(this.mc),this.itemImg.visible=!0,this.labelMaterial.visible=!0,this.closeImg.visible=!1,this.itemImg.source=this.data.img,this.labelMaterial.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.data.name+"</u>"))},e}(BaseItemRender);__reflect(ArtifactSuiItemRenderer.prototype,"ArtifactSuiItemRenderer");var NewArtifactWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.arrImage=[],e.name="神器",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.beginY=this.imgArtfact.y,this.mc=new MovieClip,this.groupEff.addChild(this.mc),this.mc.x=0,this.mc.y=0,this.mc.playFile(RES_DIR_EFF+"artifacteff",-1),this.pieceCom.piece.itemRenderer=ArtifactSuiItemRenderer,this.list.itemRenderer=ArtifactAttrDescItem,this.turnicon.textFlow=(new egret.HtmlTextParser).parser("<u>查看合击</u>"),this.eff=new MovieClip,this.eff.x=65,this.eff.y=25,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1},e.prototype.open=function(){this.index=1,this.addTouchEvent(this.imgLeft,this.onTap),this.addTouchEvent(this.imgRight,this.onTap),this.addTouchEvent(this.btnOpen,this.onTap),this.addTouchEvent(this.detail,this.onTap),this.addTouchEvent(this.turnicon,this.onTap),this.pieceCom.piece.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onLink,this),this.observe(Artifact.ins().postNewArtifactUpdate,this.updateView),this.observe(Artifact.ins().postNewArtifactInit,this.updateView),this.getGuideTips(),this.updateView()},e.prototype.close=function(){DisplayUtils.removeFromParent(this.eff),egret.Tween.removeTweens(this.groupMaterial),ViewManager.ins().close(ArtifactChipOpenWin)},e.prototype.onTap=function(t){switch(this.isBtnOpen=!1,t.target){case this.imgLeft:if(1==this.index)break;this.index--,this.updateView();break;case this.imgRight:this.index<Artifact.ins().getMaxIndex()&&this.getIsNext()&&this.index++,this.updateView();break;case this.btnOpen:this.isBtnOpen=!0,Artifact.ins().openArtifact(this.index);break;case this.detail:ViewManager.ins().open(ArtifactAllAttrWin);break;case this.turnicon:var e=GlobalConfig.ImbaConf[this.index];e&&e.winGuide&&(GameGuider.guidance(e.winGuide[0],e.winGuide[1]),"LiLianWin"!=e.winGuide[0]&&ViewManager.ins().close(LiLianWin))}},e.prototype.getIsNext=function(){if(1==this.index)return!0;var t=this.index-1,e=Artifact.ins().getNewArtifactBy(t);return e.open?!0:!1},e.prototype.updateView=function(){var t=GlobalConfig.ImbaConf[this.index],e=Artifact.ins().getNewArtifactBy(this.index);e&&e.open&&t.turnDesc?(this.turnicon.visible=!0,this.turnicon.textFlow=(new egret.HtmlTextParser).parser("<u>"+t.turnDesc+"</u>")):this.turnicon.visible=!1,this.imgArtfact.y=this.beginY,this.imgOpen.visible=!e.open,this.getGuideMaterialId(this.index)?(this.imgArtfact.source=t.imgShadow,this.setMaterialImg(),this.groupEff.visible=!1,this.currentState="normal",DisplayUtils.removeFromParent(this.eff),egret.Tween.removeTweens(this.groupMaterial),this.groupMaterial.x=42,this.groupMaterial.y=101):e.open?(this.imgArtfact.source=t.img,this.cleanMaterialImg(),this.groupEff.visible=!0,this.currentState="normal",DisplayUtils.removeFromParent(this.eff),this.artifactTween()):(this.imgArtfact.source=t.imgShadow,this.setMaterialImg(),this.groupEff.visible=!1,this.currentState="open",this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.actGroup.addChild(this.eff),egret.Tween.removeTweens(this.groupMaterial),this.groupMaterial.x=42,this.groupMaterial.y=101),this.imgName.source=t.imgName;var i="",s=0;for(var n in t.attrs)s++;if(t.attrs&&(i=AttributeData.getAttStr(t.attrs,1)),null!=t.exattrs)for(var n in t.exattrs)i+="\n",i+=AttributeData.getExtAttStrByType(t.exattrs[n],1),s++;this.labelAttr.text=t.funcDesc,this.imgFunc.source=t.simpleDesc;for(var o=[],a=Artifact.ins().getNewArtifactBy(this.index),r=0,h=0;8>h;h++){var l=a.record>>h&1,c=a.exitRecord>>h&1&&0==l,u={};u.state=l,u.state2=c;var p=t.jigsawId[h],d="",g="";null==p?(d="",g=""):(d=GlobalConfig.ImbaJigsawConf[p].name,g=GlobalConfig.ImbaJigsawConf[p].img,r++),u.name=d,u.index=p,u.img=g,o.push(u)}if(r=r>2?r:2,this.pieceCom.setData(r),this.pieceCom.piece.dataProvider=new eui.ArrayCollection(o),this.pieceCom.piece.validateNow(),this.powerPanel.setPower(Artifact.ins().getNewArtifactPower(this.index)),this.imgLeft.visible=1!=this.index,this.imgRight.visible=this.index<Artifact.ins().getMaxIndex()&&this.getIsNext(),e.open&&this.isBtnOpen){var f=t.img.split("_"),g=f[0]+"_"+f[1];Activationtongyong.show(0,t.name,"j"+g+"_png",!0,function(){t.winGuide&&(ViewManager.ins().open(t.winGuide[0],t.winGuide[1]),"LiLianWin"!=t.winGuide[0]&&ViewManager.ins().close(LiLianWin))})}},e.prototype.artifactTween=function(){var t=egret.Tween.get(this.groupMaterial,{loop:!0});t.to({y:60},1e3).to({y:101},1e3)},e.prototype.getGuideTips=function(){for(var t=Artifact.ins().getMaxIndex(),e=1;t>=e;e++){var i=Artifact.ins().getNewArtifactBy(e);this.getGuideMaterialId(e);if(this.index=e,!i.open)break}},e.prototype.getGuideMaterialId=function(t){for(var e=GlobalConfig.ImbaConf[t],i=Artifact.ins().getNewArtifactBy(t),s=0,n=0;n<e.jigsawId.length;n++){var o=i.record>>n&1;if(1!=o){s=e.jigsawId[n];break}}return s},e.prototype.openTips=function(t){var e=Artifact.ins().getNewArtifactBy(this.index),i=GlobalConfig.ImbaConf[this.index],s=(GlobalConfig.ImbaJigsawConf[t],i.jigsawId.indexOf(t)),n=e.record>>s&1,o=e.exitRecord>>s&1&&!n;this.parttips.visible=!1,o?ViewManager.ins().open(ArtifactChipOpenWin,t,this.index):ViewManager.ins().open(shenqispTipsWin,t,this.index)},e.prototype.setMaterialImg=function(){this.cleanMaterialImg();for(var t=GlobalConfig.ImbaConf[this.index],e=Artifact.ins().getNewArtifactBy(this.index),i=0;i<t.jigsawId.length;i++){var s=e.record>>i&1;if(!this.arrImage[i]){var n=new eui.Image;this.arrImage.push(n),this.groupMaterial.addChild(n)}if(1==s){var o=GlobalConfig.ImbaJigsawConf[t.jigsawId[i]];this.arrImage[i].source=o.img,this.arrImage[i].visible=!0,this.arrImage[i].x=o.point.x,this.arrImage[i].y=o.point.y}}},e.prototype.cleanMaterialImg=function(){for(var t=0;t<this.arrImage.length;t++)this.arrImage[t].visible=!1},e.prototype.onLink=function(t){var e=parseInt(t.item.index);isNaN(e)||this.openTips(e)},e}(BaseEuiView);__reflect(NewArtifactWin.prototype,"NewArtifactWin"),ViewManager.ins().reg(NewArtifactWin,LayerManager.UI_Main);var ShenqiSelectItemWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.setData=function(t){this.currentState=t.toString()},e.prototype.dataChanged=function(){},e}(BaseView);__reflect(ShenqiSelectItemWin.prototype,"ShenqiSelectItemWin");var shenqispTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqispTip",e.isTopLevel=!0,e.powerPanel.setBgVis(!1),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1];this.list.itemRenderer=ArtifactAttrDescItem,this.addTouchEvent(this.rect,this.onTap),this.setData(i,s)},e.prototype.setData=function(t,e){var i=GlobalConfig.ImbaJigsawConf[t],s=GlobalConfig.ImbaJigsawConf[t];this.partname.text=s.name,this.getway.text=s.guide,this.icon.source=s.img;var n=Artifact.ins().getNewArtifactBy(e);this.list.dataProvider=new eui.ArrayCollection(i.attrs);var o=t%10-1,a=n.record>>o&1,r="",h=UserBag.getAttrPower(i.attrs);this.powerPanel.setPower(h),r=a?"|C:0x35e62d&T:已获得|":"|C:0xf3311e&T:未获得|"},e.prototype.onTap=function(t){switch(t.target){case this.rect:ViewManager.ins().close(this)}},e.prototype.dataChanged=function(){},e}(BaseEuiView);__reflect(shenqispTipsWin.prototype,"shenqispTipsWin"),ViewManager.ins().reg(shenqispTipsWin,LayerManager.UI_Popup);var TargetWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="targetSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.taskTip.visible=!1},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.removeTouchEvent(this,this.onTouch),this.removeTouchEvent(this.bgClose,this.onTouch),this.removeTouchEvent(this.button,this.onTouch),this.removeTouchEvent(this.btn2,this.onTouch),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.addTouchEvent(this,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.button,this.onTouch),this.addTouchEvent(this.btn2,this.onTouch),this.observe(UserFb.ins().postAddEnergy,this.upDataGuanqia),t[0]==e.SEHNQI?(this.guanqia.visible=!0,this.quest.visible=!1,this.index=this.getShenQiId()):(this.guanqia.visible=!1,this.quest.visible=!0,this.HejiSkillMc1=new MovieClip,this.HejiSkillMc1.x=this.roleimg.x+this.roleimg.width/2+73,this.HejiSkillMc1.y=this.roleimg.y+this.roleimg.height/2+70+73,this.quest.addChild(this.HejiSkillMc1),this.HejiSkillMc2=new MovieClip,this.HejiSkillMc2.x=this.enenyimg.x+this.enenyimg.width/2+80,this.HejiSkillMc2.y=this.enenyimg.y+this.enenyimg.height/2+167,this.quest.addChild(this.HejiSkillMc2)),this["show"+t[0]]()},e.prototype.show2=function(){var t=SubRoles.ins().getSubRoleByIndex(0),i=this.getTaskSum(),s=e.TASKID%100;this.skillName.source="8000"+t.job+"_png",this.questNumber.text=e.TASKID%100-i+1+"",this.mcSkillID="skill40"+t.job,this.targetSkillID="skill"+(403+t.job);var n=0;i=i>0?i:0;var o=(i-1)/s;o=0>=o?0:o,o=o>=1?1:o,n=Math.floor(100*o),this.bar2.value=i-1,this.bar2.maximum=s,this.bar2.labelFunction=function(){return n+"%"},TimerManager.ins().remove(this.playSkillAnmi,this),TimerManager.ins().doTimer(3e3,0,this.playSkillAnmi,this),this.playSkillAnmi()},e.prototype.getTaskSum=function(){if(UserTask.ins().taskTrace.id>=e.TASKID)return 0;for(var t in GlobalConfig.AchievementTaskConfig)if(UserTask.ins().taskTrace.id==GlobalConfig.AchievementTaskConfig[t].taskId){var i=GlobalConfig.AchievementTaskConfig[t].index;return i>0?i:0}return 0},e.prototype.show1=function(){var t=GlobalConfig.ImbaConf[this.index];if(t){var e=UserFb.ins().getNextReward();if(e){var i=UserFb.ins().getNewChapter();if(i){var s=this.getChipNum(t),n=UserFb.ins().getDiffChapter(),o=i.needLevel,a=GlobalConfig.ItemConfig[e[0].id];this.artifactImg.source=t.img,this.itemImg.source=a.icon+"_png",this.artifactname.text=t.name,this.number1.text=s+"",this.des1a1.text=t.funcDesc,this.guanqiaDes2.text=UserFb.ins().getNextNeedChapter()+"",this.artifactName1.text=a.name;var r=0,h=UserFb.ins().guanqiaID-o-1;h=h>0?h:0;var l=h/n;l=l>=1?1:l,r=Math.floor(100*l),this.bar1.value=h,this.bar1.maximum=n,this.bar1.labelFunction=function(){return r+"%"},this.prossX=0;var c=this.btnbar.localToGlobal();this.btnbar.parent.globalToLocal(c.x,c.y,c),this.masksp=new egret.Sprite;var u=new egret.Shape;u.graphics.beginFill(16777215),u.graphics.drawRect(c.x,c.y,this.btnbar.width,this.btnbar.height),u.graphics.endFill(),this.prossX=c.x-this.btnbar.width,this.masksp.y=c.y,this.masksp.addChild(u),this.btnbar.parent.addChild(this.masksp),this.btnbar.mask=this.masksp,this.upDataGuanqia()}}}},e.prototype.upDataGuanqia=function(){if(this.masksp){var t=UserFb.ins().currentEnergy,e=UserFb.ins().energy,i=(t-1)/e;i=i>=1?1:i,this.masksp.x=this.prossX+Math.abs(this.prossX)*i}},e.prototype.getChipNum=function(t){for(var e=0,i=0;i<t.jigsawId.length;i++)for(var s in GlobalConfig.WorldRewardConfig){var n=GlobalConfig.WorldRewardConfig[s];if(n.rewards[0].id==t.jigsawId[i]){n.needLevel>=UserFb.ins().guanqiaID&&e++;break}}return e},e.prototype.getShenQiId=function(){for(var t=Artifact.ins().getMaxIndex(),e=1,i=1;t>=i;i++){var s=Artifact.ins().getNewArtifactBy(i);for(var n in GlobalConfig.ImbaConf)if(GlobalConfig.ImbaConf[n].id==s.id){var o=UserFb.ins().getChipByGuanQia();if(-1!=GlobalConfig.ImbaConf[n].jigsawId.indexOf(o))return e=GlobalConfig.ImbaConf[n].index}}return e},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.bgClose:case this.btn2:ViewManager.ins().close(this);break;case this.button:if(UserFb.ins().currentEnergy>=UserFb.ins().energy){var e=this;GameGuider.challengeBoss(function(){ViewManager.ins().close(e)})}else this.showTaskTips("能量未满无法挑战，请继续清怪。")}},e.prototype.showTaskTips=function(t){var e=this.taskTip;this.taskTipText0.textFlow=TextFlowMaker.generateTextFlow1(t),egret.Tween.removeTweens(e),e.bottom=70,e.visible=!0,egret.Tween.get(e).to({bottom:100},500).wait(2e3).call(function(){e.visible=!1})},e.prototype.playSkillAnmi=function(){var t=this;egret.Tween.removeTweens(this.roleimg);var e=egret.Tween.get(this.roleimg);this.HejiSkillMc1.parent||this.quest.addChild(this.HejiSkillMc1),this.HejiSkillMc1.playFile(""+RES_DIR_SKILLEFF+this.mcSkillID,1,null,!0),e.wait(1500).call(function(){t.HejiSkillMc2.parent||t.quest.addChild(t.HejiSkillMc2),t.HejiSkillMc2.playFile(""+RES_DIR_SKILLEFF+t.targetSkillID,1,null,!0)},this)},e}(BaseEuiView);TargetWin.SEHNQI=1,TargetWin.HEJI=2,TargetWin.TASKID=100026,__reflect(TargetWin.prototype,"TargetWin"),ViewManager.ins().reg(TargetWin,LayerManager.UI_Popup);var PackageID;!function(t){t[t.Default=0]="Default",t[t.Guanqia=1]="Guanqia",t[t.Skill=2]="Skill",t[t.Bag=3]="Bag",t[t.Equip=4]="Equip",t[t.Encounter=5]="Encounter",t[t.Wing=6]="Wing",t[t.strongthen=7]="strongthen",t[t.Mail=8]="Mail",t[t.Task=9]="Task",t[t.Boss=10]="Boss",t[t.Gem=11]="Gem",t[t.JingMai=12]="JingMai",t[t.Zs=13]="Zs",t[t.Zhuling=14]="Zhuling",t[t.Tupo=15]="Tupo",t[t.Shop=16]="Shop",t[t.Ring=17]="Ring",t[t.Ranking=18]="Ranking",t[t.Vip=19]="Vip",t[t.Notice=20]="Notice",t[t.LoongSoul=21]="LoongSoul",t[t.TreasureHunt=22]="TreasureHunt",t[t.Train=23]="Train",t[t.FbChallenge=24]="FbChallenge",t[t.Activity=25]="Activity",t[t.Artifact=26]="Artifact",t[t.Recharge=27]="Recharge",t[t.ExpGold=28]="ExpGold",t[t.CDKey=29]="CDKey",t[t.Chat=30]="Chat",t[t.ZhuZaiEquip=31]="ZhuZaiEquip",t[t.ZsBoss=32]="ZsBoss",t[t.pfActivity=33]="pfActivity",t[t.Ladder=34]="Ladder",t[t.Miji=35]="Miji",t[t.moneyTree=36]="moneyTree",t[t.Guild=37]="Guild",t[t.Title=38]="Title",t[t.GuildFB=39]="GuildFB",t[t.GuildWar=40]="GuildWar",t[t.GuildRobber=41]="GuildRobber",t[t.GuildStore=42]="GuildStore",t[t.WarSpirit=43]="WarSpirit",t[t.Dress=44]="Dress",t[t.GuildBoss=46]="GuildBoss",t[t.Friends=47]="Friends",t[t.Mine=49]="Mine",t[t.Rune=50]="Rune",t[t.NeiGong=51]="NeiGong",t[t.Box=52]="Box",t[t.Book=53]="Book",t[t.DailyCheckIn=54]="DailyCheckIn",t[t.Heirloom=55]="Heirloom",t[t.Weapons=56]="Weapons",t[t.Millionaire=57]="Millionaire",t[t.City=58]="City",t[t.ThreeHeroes=59]="ThreeHeroes",t[t.GodWeapon=60]="GodWeapon",t[t.Battle=61]="Battle",t[t.PaoDian=62]="PaoDian",t[t.GodWeaponItem=63]="GodWeaponItem",t[t.Samsara=64]="Samsara",t[t.WJBattle=65]="WJBattle",t[t.WeiWang=66]="WeiWang",t[t.PKCompetition=67]="PKCompetition",t[t.PActivity=68]="PActivity",t[t.HeartMethod=69]="HeartMethod",t[t.JadeNew=70]="JadeNew",t[t.LyMark=71]="LyMark",t[t.KFBoss=72]="KFBoss",t[t.Shenshou=73]="Shenshou",t[t.Hungu=74]="Hungu",t[t.Devildom=75]="Devildom",t[t.Auction=76]="Auction",t[t.KfArena=77]="KfArena",t[t.Login=255]="Login"
}(PackageID||(PackageID={}));var AuctionItemRender=function(t){function e(){var e=t.call(this)||this;return e.STATE_SHOW=0,e.STATE_AUCTION=1,e.STATE_END=2,e.state=0,e.leftTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.AuctionItem[t.aID];e&&(this.item.data=e.item,this.price=e.buy,this.price2=e.bid+Math.floor(e.bid*t.auctionTimes*GlobalConfig.AuctionConfig.priceIncrease/1e4),this.btn1.visible=e.buy>0,this.zb0.text=this.price+"",this.jingjia.text=this.price2+"",this.labelMy.visible=t.owner>0,this.labelMy.source=t.owner?1==t.owner?"labelMy":"labelGuild":"",this.zb1.text=e.bid+Math.floor(e.bid*(t.auctionTimes>0?t.auctionTimes-1:0)*GlobalConfig.AuctionConfig.priceIncrease/1e4)+"",this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.checkTime(),this.openedWard&&this.showWarn())},e.prototype.showWarn=function(){WarnWin.show("是否花费|C:2149168&T:"+(this.isYiKouJia?this.price:this.price2)+"|元宝"+(this.isYiKouJia?"立即拍下商品":"参与竞拍"),this.onAuction.bind(this),this,this.onAuction2.bind(this),this)},e.prototype.checkTime=function(){TimerManager.ins().removeAll(this);var t=this.data,e=DateUtils.formatMiniDateTime(t.endTime),i=GameServer.serverTime,s=DateUtils.formatMiniDateTime(t.putAwayTime);this.leftTime=0,this.showTime.textColor=16711680,i>=e?(this.state=this.STATE_END,this.showTime.text="00:00:00",Auction.ins().deleteVo(t),Auction.ins().postUpdate()):Math.floor((i-s)/1e3)<(t.type?GlobalConfig.AuctionConfig.globalShowTime:GlobalConfig.AuctionConfig.guildShowTime)?(this.state=this.STATE_SHOW,this.showTime.textColor=16767295,this.leftTime=(t.type?GlobalConfig.AuctionConfig.globalShowTime:GlobalConfig.AuctionConfig.guildShowTime)-Math.floor((i-s)/1e3)):(this.state=this.STATE_AUCTION,this.showTime.textColor=65280,this.leftTime=Math.floor((e-i)/1e3)),this.leftTime&&(this.repeat(),TimerManager.ins().doTimer(1e3,0,this.repeat,this)),this.jingjiazhong.visible=t.auctionTimes>0,this.jingjiazhong.textFlow=TextFlowMaker.generateTextFlow("|C:"+(t.myAuPrice?16767295:2149168)+"&T:"+(t.myAuPrice?"我的竞价":"竞价中"))},e.prototype.repeat=function(){return this.showTime.text=DateUtils.getFormatBySecond(this.leftTime,DateUtils.TIME_FORMAT_12)+(this.state==this.STATE_SHOW?"后开始":"后结束"),this.state==this.STATE_AUCTION&&this.leftTime<=GlobalConfig.AuctionConfig.rushTime&&16711680!=this.showTime.textColor&&(this.showTime.textColor=16711680),this.leftTime<=0?void this.checkTime():void this.leftTime--},e.prototype.onRemove=function(){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),TimerManager.ins().removeAll(this),this.openedWard=!1},e.prototype.onTouch=function(t){switch(t.target){case this.yikoujia:case this.yikoujia0:if(this.state==this.STATE_END)return void UserTips.ins().showTips("物品拍卖结束");if(this.state==this.STATE_SHOW)return void UserTips.ins().showTips("物品展示时间");this.openedWard=!0,this.isYiKouJia=t.target==this.yikoujia,this.showWarn()}},e.prototype.onAuction=function(){if(this.openedWard=!1,Actor.yb<(this.isYiKouJia?this.price:this.price2))return void this.noMoney();var t=this.data;this.isYiKouJia?Auction.ins().sendBuy(t.id,t.type):Auction.ins().sendAUction(t.id,t.type,t.auctionTimes+1)},e.prototype.noMoney=function(){UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onAuction2=function(){this.openedWard=!1},e}(BaseItemRender);__decorate([callDelay(150)],AuctionItemRender.prototype,"noMoney",null),__reflect(AuctionItemRender.prototype,"AuctionItemRender");var AuctionRecordItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.AuctionItem[t.aId];this.item.data=e.item,this.playerName.text=t.roleName,this.price.text=t.price+"",this.successTime.text=DateUtils.getFormatBySecond(Math.floor(DateUtils.formatMiniDateTime(t.time)/1e3),DateUtils.TIME_FORMAT_15),this.text1.text=t.state?1==t.state?"竞拍价成交":"一口价成交":0==t.type?"流拍到全服":"流拍"},e}(BaseItemRender);__reflect(AuctionRecordItemRender.prototype,"AuctionRecordItemRender");var AuctionItemChoiceWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="auctionItemChoiceSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemID=t[0],this.auID=t[1],this.addTouchEndEvent(this,this.onTouch),this.update()},e.prototype.update=function(){var t=GlobalConfig.AuctionItem[this.auID];this.item.data=t.item,this.price1.text=t.bid+"",this.price2.text=t.buy+""},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.ownUse:case this.auctionBtn:Auction.ins().sendUseAuBox(t.target==this.ownUse?0:1,this.itemID),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(AuctionItemChoiceWin.prototype,"AuctionItemChoiceWin"),ViewManager.ins().reg(AuctionItemChoiceWin,LayerManager.UI_Main);var auction=GameSystem.auction,AuctionPanel=function(t){function e(){var e=t.call(this)||this;return e.curPage=1,e.maxPage=1,e.type=0,e.itemCount=10,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=AuctionItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.itemCount=GlobalConfig.AuctionConfig.eachPageNumber,this.addTouchEndEvent(this,this.onTouch),this.observe(Auction.ins().postListData,this.update),this.observe(Auction.ins().postAuctionResult,this.update),this.observe(Auction.ins().postBuyResult,this.update),this.observe(Auction.ins().postUpdate,this.update),this.curPage=1,this.update(),TimerManager.ins().removeAll(this),TimerManager.ins().doTimer(1e4,0,this.onSend,this)},e.prototype.close=function(){TimerManager.ins().removeAll(this)},e.prototype.onSend=function(){Auction.ins().sendGetList(this.type)},e.prototype.update=function(){this.collect||(this.collect=new ArrayCollection,this.list.dataProvider=this.collect),this.maxPage=Auction.ins().getMaxPageByType(this.type,this.itemCount),this.curPage>this.maxPage&&(this.curPage=this.maxPage),this.updateCurPage(),this.add.visible=this.maxPage>1},e.prototype.onTouch=function(t){switch(t.target){case this.btn:ViewManager.ins().open(AuctionRecordWin,this.type);break;case this.minBtn:this.curPage>1&&(this.curPage--,this.updateCurPage());break;case this.maxBtn:this.curPage<this.maxPage&&(this.curPage++,this.updateCurPage())}},e.prototype.updateCurPage=function(){var t=Auction.ins().getDataByPage(this.type,this.curPage,this.itemCount),e=this.collect.source;if(e&&e.length==(t?t.length:0))for(var i=e.length,s=0;i>s;s++){e[s]=t[s];var n=this.list.getElementAt(s);n&&this.list.updateRenderer(n,s,t[s])}else this.collect.source=t;this["null"].visible=!this.collect.source||this.collect.source.length<=0,this.pageTxt.text=this.curPage+"/"+this.maxPage},e}(BaseEuiView);__reflect(AuctionPanel.prototype,"AuctionPanel");var AuctionQuotaTipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="auctionQuotaTipSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onTouch),this.positiveQuotaNum.text=t[0],this.rechargeQuotaNum.text=t[1]},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.goRechargeBtn:var i=Recharge.ins().getRechargeData(0);i&&2==i.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win),ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(AuctionQuotaTipWin.prototype,"AuctionQuotaTipWin"),ViewManager.ins().reg(AuctionQuotaTipWin,LayerManager.UI_Popup);var AuctionRecordWin=function(t){function e(){var e=t.call(this)||this;return e.type=0,e.skinName="auctionRecordSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=AuctionRecordItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.observe(Auction.ins().postRecord,this.update),this.curAuction.textFlow=TextFlowMaker.generateTextFlow("拍卖纪录("+(this.type?"全服":"公会")+")"),this["null"].visible=!0,Auction.ins().sendRecord(this.type),this.addTouchEndEvent(this,this.onTouch)},e.prototype.onTouch=function(t){t.target==this.bgClose&&ViewManager.ins().close(this)},e.prototype.update=function(t){this.collect||(this.collect=new ArrayCollection,this.list.dataProvider=this.collect),t.type==this.type&&(this.collect.source=t.list,this["null"].visible=!this.collect.source||this.collect.source.length<=0)},e}(BaseEuiView);__reflect(AuctionRecordWin.prototype,"AuctionRecordWin"),ViewManager.ins().reg(AuctionRecordWin,LayerManager.UI_Popup);var AuctionWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="auctionSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onTouch),this.addChangeEvent(this.tab,this.selectIndexChange),this.observe(Auction.ins().postListData,this.updateRed),this.observe(Auction.ins().postAuctionResult,this.updateRed),this.observe(Auction.ins().postBuyResult,this.updateRed),this.observe(Auction.ins().postUpdate,this.updateRed),this.updateRed(),this.tab.selectedIndex=this.viewStack.selectedIndex=Auction.ins().checkRedByType(1)&&!Auction.ins().checkRedByType(0)?1:0,this.selectIndexChange()},e.prototype.close=function(){},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(ZsBossRuleSpeak,41)}},e.prototype.selectIndexChange=function(t){switch(void 0===t&&(t=null),this.tab.selectedIndex){case 0:Auction.ins().sendGetList(0),this.guild.open(0);break;case 1:Auction.ins().sendGetList(1),this.server.open(1)}},e.prototype.updateRed=function(){this.redPoint0.visible=Auction.ins().checkRedByType(0),this.redPoint1.visible=Auction.ins().checkRedByType(1)},e}(BaseEuiView);__reflect(AuctionWin.prototype,"AuctionWin"),ViewManager.ins().reg(AuctionWin,LayerManager.UI_Main);var AuctionRecordVo=function(){function t(t){this.type=0,this.parser(t)}return t.prototype.parser=function(t){this.aId=t.readInt(),this.roleName=t.readString(),this.state=t.readByte(),this.price=t.readInt(),this.time=t.readInt()},t}();__reflect(AuctionRecordVo.prototype,"AuctionRecordVo");var AuctionVo=function(){function t(t){this.parser(t)}return t.prototype.parser=function(t){this.type=t.readByte(),this.endTime=t.readInt(),this.id=t.readInt(),this.putAwayTime=t.readInt(),this.aID=t.readInt(),this.auctionTimes=t.readByte(),this.myAuPrice=t.readByte(),this.owner=t.readByte()},t}();__reflect(AuctionVo.prototype,"AuctionVo");var DepotType;!function(t){t[t.Equip=0]="Equip",t[t.Rune=1]="Rune",t[t.Heirloom=2]="Heirloom"}(DepotType||(DepotType={}));var ItemData=function(){function t(){this._point=-1}return t.prototype.parser=function(t){this.handle=t.readDouble(),this.configID=t.readInt(),this.count=t.readInt(),this.att=[];for(var e=0;8>e;e++){var i=new AttributeData(t.readInt(),t.readInt());this.att.push(i)}this.extAtt=[];for(var e=0;8>e;e++){var i=new AttributeData(t.readInt(),t.readInt());this.extAtt.push(i)}},Object.defineProperty(t.prototype,"configID",{get:function(){return this._configID},set:function(t){this.itemConfig=GlobalConfig.ItemConfig[t],0!=t&&Assert(this.itemConfig,"无法读取道具配置，id："+t+",请检查配置"),this._point=-1,this._configID=t,this.setCanbeUsed()},enumerable:!0,configurable:!0}),t.getStringByList=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=": ");for(var s="",n=0;n<t.length;n++)if(s+=t[n]+i,n<t.length-1)for(var o=0;e>o;o++)s+="\n";return s},t.getStringByNextList=function(t,e){for(var i="",s=0;s<t.length;s++)i+=t[s],e[s]&&(i+=e[s]),s<t.length-1&&(i+="\n");return i},Object.defineProperty(t.prototype,"point",{get:function(){return-1==this._point&&(this._point=ItemConfig.calculateBagItemScore(this)),this._point},enumerable:!0,configurable:!0}),t.prototype.setCanbeUsed=function(){if(this.itemConfig)if(ItemConfig.getType(this.itemConfig)==ItemType.TYPE_20)this.canbeUsed=SpecialRing.ins().checkCanUseByItem(this.itemConfig.id);else if(1==this.itemConfig.useType||2==this.itemConfig.useType){if(UserZs.ins().lv<this.itemConfig.zsLevel&&Actor.level<this.itemConfig.level)this.canbeUsed=!1;else if(230001==this.itemConfig.id||230002==this.itemConfig.id||230003==this.itemConfig.id?this.canbeUsed=!1:this.canbeUsed=!0,26==Math.floor(this.itemConfig.id/1e4)){var t=this.itemConfig.id%26e4,e=Book.ins().getBookById(t),i=e.getState();this.canbeUsed=i==BookState.canOpen}}else this.canbeUsed=!1},t.prototype.getCanbeUsed=function(){return this.canbeUsed},t.prototype.copy=function(e){e||(e=new t);var i=this;e.handle=i.handle,e.configID=i.configID,e.count=i.count,e._point=i._point,e.att=[];for(var s=0;8>s;s++){var n=new AttributeData(i.att[s].type,i.att[s].value);e.att.push(n)}e.extAtt=[];for(var s=0;8>s;s++){var n=new AttributeData(i.extAtt[s].type,i.extAtt[s].value);e.extAtt.push(n)}return e},t.prototype.init=function(){this.handle=0,this.configID=0,this.count=0,this.att=[];for(var t=0;8>t;t++){var e=new AttributeData(0,0);this.att.push(e)}this.extAtt=[];for(var t=0;8>t;t++){var e=new AttributeData(0,0);this.extAtt.push(e)}},t}();__reflect(ItemData.prototype,"ItemData");var UserBag=function(t){function e(){var e=t.call(this)||this;e.bagNum=0,e.bagModel=[],e.isExitUsedItem=0,e.isChange=0,e.OrangeEquipRedPoint=[],e.itemCount={0:{},1:{}},e.promptList=["","背包满了","","不能被使用","级别不足","数量不足够"],e.equipPowerDic=[],e.wearList=[],e.sysId=PackageID.Bag,e.regNetMsg(1,e.doBagData),e.regNetMsg(2,e.doBagValumnAdd),e.regNetMsg(3,e.doDeleteItem),e.regNetMsg(4,e.doAddItem),e.regNetMsg(5,e.doUpDataItem),e.regNetMsg(6,e.doUserItemBack),e.regNetMsg(7,e.postMergeItemBack),e.regNetMsg(8,e.doChoosableGiftResult),e.observe(Recharge.ins().postGetMonthDay,e.doBagVolChange),e._useItemFunc={},e.registerUseItemFunc(ItemConst.RENAME,e.useRenameItem);for(var i=0;8>i;i++)e.OrangeEquipRedPoint[i]=!1;return e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e,"fitleEquip",{get:function(){if(!e._fitleEquip){e._fitleEquip=[];for(var t in GlobalConfig.SpecialEquipsConfig)GlobalConfig.SpecialEquipsConfig[t].style==FitleStyle.hc&&e._fitleEquip.push(GlobalConfig.SpecialEquipsConfig[t].id)}return e._fitleEquip},enumerable:!0,configurable:!0}),e.prototype.sendAddBagGrid=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendUseItem=function(t,e){if(null!=this._useItemFunc[t])return this._useItemFunc[t](t,e),!0;var i=this.getBytes(6);return i.writeInt(t),i.writeInt(e),this.sendToServer(i),!1},e.prototype.sendUserGoods=function(t,e){},e.prototype.addItemCount=function(t,e){var i=e.configID;return 0==e.count?void this.delItemCount(t,i):(this.itemCount[t][i]=this.itemCount[t][i]||0,void(1==t?this.itemCount[t][i]+=1:this.itemCount[t][i]=e.count))},e.prototype.delItemCount=function(t,e){1==t?this.itemCount[t][e]&&(this.itemCount[t][e]-=1,0==this.itemCount[t][e]&&delete this.itemCount[t][e]):delete this.itemCount[t][e]},e.prototype.getBagItemCount=function(t,e){return this.itemCount[t][e]||0},e.prototype.doBagData=function(t){var i=t.readByte(),s=t.readByte();0==i&&(this.bagModel[s]=[],this.itemCount[s]={});for(var n,o=t.readInt(),a=0;o>a;a++)n=new ItemData,n.parser(t),this.bagModel[s].push(n),(0==s||1==s)&&this.addItemCount(s,n);e.ins().postItemAdd(),1==s&&this.doBagVolChange(),2==s&&e.ins().postHuntStore(),this.getIsExitUsedItem(),e.ins().postHasItemCanUse()},e.prototype.doBagVolChange=function(){this.postBagVolChange()},e.prototype.postBagVolChange=function(){var t=this.ronglianCheck();this.isChange=t?1:0;var i=t?2:0;e.ins().postItemCountChange(),t||(t=this.getSurplusCount()<.05*this.getMaxBagRoom(),i=t?1:0),e.ins().postBagWillFull(i)},e.prototype.ronglianCheck=function(){var t=this.bagNum;GlobalConfig&&GlobalConfig.VipGridConfig&&GlobalConfig.VipGridConfig[UserVip.ins().lv]&&(t+=GlobalConfig.VipGridConfig[UserVip.ins().lv].grid+Recharge.ins().getAddBagGrid());var i=e.ins(),s=!1,n=UserFb.ins().guanqiaID>50?this.getBagItemNum()/t>=.8:this.getBagItemNum()>=50;if(n)for(var o=i.getOutEquips(),a=0,r=o;a<r.length;a++){var h=r[a];if(h&&h.itemConfig){s=!0;break}}return s},e.prototype.doUserItemBack=function(t){var i=t.readByte();i>0?UserTips.ins().showTips(this.promptList[i]):0==i&&e.ins().postUseItemSuccess()},e.prototype.doBagValumnAdd=function(t){this.bagNum=t.readInt(),e.ins().postBagVolAdd()},e.prototype.doDeleteItem=function(t){for(var i=t.readByte(),s=t.readDouble(),n=0,o=this.bagModel[i].length-1;o>=0;o--)if(this.bagModel[i][o].handle==s){n=this.bagModel[i][o].configID,e.ins().isExitUsedItem=this.bagModel[i][o].getCanbeUsed()?1:0,this.bagModel[i].splice(o,1);break}(0==i||1==i)&&this.delItemCount(i,n),2==i&&(this.deleteHasType2=!0),this.isDeleteDelay||(this.isDeleteDelay=!0,TimerManager.ins().doTimer(50,1,this.deleteDelay,this))},e.prototype.doAddItem=function(t){var i=t.readByte(),s=new ItemData;s.parser(t),this.bagModel[i].push(s),(0==i||1==i)&&this.addItemCount(i,s),e.ins().isExitUsedItem=s.getCanbeUsed()?1:0;var n=t.readByte();if(n){var o=ItemConfig.getQuality(s.itemConfig);if(o>=4&&1==i)UserTips.ins().showGoodEquipTips(s);else if(2!=i)if(ItemConfig.getType(s.itemConfig)==ItemType.TYPE_18)UserTips.ins().showHeartItemTips(s.itemConfig.id);else{var a="获得|C:"+ItemConfig.getQualityColor(s.itemConfig)+"&T:"+s.itemConfig.name+" x "+s.count+"|";UserTips.ins().showTips(a)}}2==i&&(this.addHasType2=!0),this.isAddDelay||(this.isAddDelay=!0,TimerManager.ins().doTimer(50,1,this.addDelay,this)),1==i&&NewEquip.ins().addItem(s)},e.prototype.addDelay=function(){this.isAddDelay=!1,e.ins().postItemAdd(),e.ins().postHasItemCanUse(),this.doBagVolChange(),this.addHasType2&&(this.addHasType2=!1,e.ins().postHuntStore())},e.prototype.deleteDelay=function(){this.isDeleteDelay=!1,e.ins().postItemDel(),e.ins().postHasItemCanUse(),this.doBagVolChange(),this.deleteHasType2&&(this.deleteHasType2=!1,e.ins().postHuntStore())},e.prototype.doUpDataItem=function(t){for(var i,s=t.readByte(),n=t.readDouble(),o=0,a=0;a<this.bagModel[s].length;a++)if(i=this.bagModel[s][a],i.handle==n){var r=t.readInt();o=r-i.count,i.count=r,(0==s||1==s)&&this.addItemCount(s,i),e.ins().isExitUsedItem=i.getCanbeUsed()?1:0,e.ins().postHasItemCanUse();break}var h=t.readByte();if(h&&o>0&&2!=s){if(ItemConfig.getType(i.itemConfig)==ItemType.TYPE_18)UserTips.ins().showHeartItemTips(i.itemConfig.id);else{var l=ItemConfig.getQualityColor(i.itemConfig),c="获得|C:"+l+"&T:"+i.itemConfig.name+" x "+o+"|";UserTips.ins().showTips(c)}e.ins().postItemAdd()}this.doBagVolChange(),e.ins().postItemChange()},e.prototype.sendMergeItem=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postMergeItemBack=function(t){for(var e=(t.readInt(),t.readInt(),t.readInt()),i=[],s=0;e>s;s++)i[s]=new RewardData,i[s].parser(t);return i},e.prototype.sendGetGoodsByStore=function(t){if(t==DepotType.Equip&&this.getSurplusCount()<1){var e=GlobalConfig.ServerTips[2].tips;return void UserTips.ins().showTips(e)}var i=this.getBytes(4);i.writeDouble(t),this.sendToServer(i)},e.prototype.postItemChange=function(){},e.prototype.registerUseItemFunc=function(t,e){this._useItemFunc[t]=e},e.prototype.postItemDel=function(){},e.prototype.postItemAdd=function(){},e.prototype.postItemCountChange=function(){return e.ins().isChange},e.prototype.postBagWillFull=function(t){return t},e.prototype.postHuntStore=function(){},e.prototype.postHasItemCanUse=function(){return e.ins().isExitUsedItem},e.prototype.postUseItemSuccess=function(){},e.prototype.postBagVolAdd=function(){},e.prototype.getBagItemById=function(t,i){void 0===i&&(i=e.BAG_TYPE_OTHTER);var s=this.bagModel[i];if(!s)return null;for(var n=0,o=s;n<o.length;n++){var a=o[n];if(a.itemConfig.id==t)return a}return null},e.prototype.getFilterBagItemById=function(t,i,s){void 0===s&&(s=e.BAG_TYPE_OTHTER);for(var n=this.bagModel[s],o=0,a=n;o<a.length;o++){var r=a[o];if(r.itemConfig.id==t&&i.indexOf(r.handle)<0)return r}return null},e.prototype.getBagGoodsByTypeAndId=function(t,e){for(var i=this.bagModel[t],s=0,n=i;s<n.length;s++){var o=n[s];if(o.itemConfig.id==e)return o}return null},e.prototype.getBagEquipByType=function(t){var i=this.bagModel[e.BAG_TYPE_EQUIP],s=[];for(var n in i)ItemConfig.getType(i[n].itemConfig)==t&&s.push(i[n]);return s},e.prototype.getBagByType=function(t){return this.bagModel[t]},e.prototype.getBagGoodsCountByType=function(t,i){var s=this.bagModel[e.BAG_TYPE_OTHTER];if(s)for(var n=0;n<s.length;n++){if(8==ItemConfig.getType(s[n].itemConfig)){if(s[n].itemConfig.bagType==DepotType.Rune)continue;if(i&&-1!=i.indexOf(s[n].itemConfig.id))return!0;if(s[n].itemConfig.id==ItemConst.EXP_ITEM&&Actor.level<65)continue;if(s[n].itemConfig.id==ItemConst.LEVELUP_ITEM){if(this.getRmbItemIsBuy(ItemConst.LEVELUP_ITEM))return!0;continue}if(s[n].itemConfig.id==ItemConst.WEIWANG_ITEM)continue;return!0}if(12==ItemConfig.getType(s[n].itemConfig)){var o=Actor.level>=s[n].itemConfig.level&&0!=Guild.ins().guildID?!0:!1;if(o)return!0}else{if(17==ItemConfig.getType(s[n].itemConfig))return!0;var a=GlobalConfig.ItemComposeConfig[s[n].configID];if(a&&a.srcCount<=s[n].count)return!0}}return!1},e.prototype.getRuneBagGoodsCountByType=function(t){var i=this.bagModel[e.BAG_TYPE_OTHTER];if(i)for(var s=0;s<i.length;s++)if(8==ItemConfig.getType(i[s].itemConfig)&&i[s].itemConfig.bagType)return!0;return!1},e.prototype.getBagGoodsCountById=function(t,e){if(0==t||1==t)return this.getBagItemCount(t,e);var i=this.bagModel[t];if(i)for(var s=0;s<i.length;s++)if(i[s].itemConfig&&i[s].itemConfig.id==e)return i[s].count;return 0},e.prototype.getBagGoodsByIndex=function(t,e){return this.bagModel[t][e]},e.prototype.getBagItemNum=function(t){void 0===t&&(t=1);var e=this.bagModel[t];return e?e.length:0},e.prototype.getSurplusCount=function(){return this.bagNum-this.getBagItemNum()+GlobalConfig.VipGridConfig[UserVip.ins().lv].grid+Recharge.ins().getAddBagGrid()},e.prototype.getMaxBagRoom=function(){return this.bagNum+GlobalConfig.VipGridConfig[UserVip.ins().lv].grid+Recharge.ins().getAddBagGrid()+Recharge.ins().getAddBagFranchiseGrid()},e.prototype.sort1=function(t,e){var i=t.point,s=e.point;return i>s?-1:s>i?1:0},e.prototype.sort2=function(t,e){var i=t.point,s=e.point;return s>i?-1:i>s?1:0},e.prototype.getHejiEquipsByType=function(t){for(var e=this.bagModel[1],i=[],s=0;s<e.length;s++){var n=e[s],o=ItemConfig.getType(n.itemConfig),a=ItemConfig.getSubType(n.itemConfig);5==o&&a==t&&i.push(n)}return i.sort(this.sort3),i},e.prototype.sort3=function(t,e){var i=t.point,s=e.point;return i>s?-1:s>i?1:t.configID>e.configID?-1:t.configID<e.configID?1:0},e.prototype.getBagSortEquips=function(t){void 0===t&&(t=0);var i=this.bagModel[e.BAG_TYPE_EQUIP];return t?i.sort(this.sort1):i.sort(this.sort2),i},e.prototype.getBagSortQualityEquips=function(t,i,s,n){void 0===t&&(t=5),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=null);var o=this.bagModel[e.BAG_TYPE_EQUIP],a=[];if(!o)return a;for(var r=0;r<o.length;r++){var h=ItemConfig.getQuality(o[r].itemConfig);5!=t&&(h>t||i&&t>h)||(null==n||n(o[r]))&&(a[a.length]=o[r])}return a},e.prototype.getLegendOutEquips=function(){for(var t=e.ins().getBagEquipsByQuality(5),i=[],s=[],n=[],o=SubRoles.ins().subRolesLen,a=0;o>a;a++){var r=SubRoles.ins().getSubRoleByIndex(a);n[r.job]||(n[r.job]=[]);for(var h=r.getEquipLen(),l=0;h>l;l++){var c=r.getEquipByIndex(l);c.item.itemConfig&&this.addOneEquipToListEx(s,c,r.job)}}for(var u,a=0;a<t.length;a++){var p=t[a],d=ItemConfig.getSubType(p.itemConfig);if(0==d||2==d){for(var g=!1,f=0;f<s.length;f++){var v=ItemConfig.getSubType(p.itemConfig);if(v==d){g=!0;break}}g&&(u=this.checkEquipsIsGood(s,this.cloneItemDataInfo(p)),u&&(UserEquip.ins().checkEquipsIsWear(u)||5!=ItemConfig.getQuality(u.itemConfig)||i.push(u)))}}return i},e.prototype.getLegendHasResolve=function(){for(var t=e.ins().getBagEquipsByQuality(4),i=[],s=SubRoles.ins().subRolesLen,n=0;s>n;n++)for(var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getEquipLen(),r=0;a>r;r++){var h=o.getEquipByIndex(r);h.item.itemConfig&&this.addOneEquipToListRed(i,h,n)}for(var l,n=0;n<t.length;n++){var c=t[n];ItemConfig.getJob(c.itemConfig);if(!BreakDownView.fitleEquip[c.configID]&&(l=this.checkEquipsIsGoodRed(i,this.cloneItemDataInfo(c)),!l))return!0}return!1},e.prototype.otherEquipSmeltFilter=function(t){var e=ItemConfig.getType(t.itemConfig),i=ItemConfig.getSubType(t.itemConfig);if(t.itemConfig&&4==e)return!0;if(0==e){for(var s in ForgeConst.CAN_FORGE_EQUIP)if(ForgeConst.EQUIP_POS_TO_SUB[ForgeConst.CAN_FORGE_EQUIP[s]]==i)return!1;return!0}return!1},e.prototype.normalEquipSmeltFilter=function(t){return 0==ItemConfig.getType(t.itemConfig)},e.prototype.getHejiOutEquips=function(){var t=[];return t.length<9&&this.checkHejiEquipsTodestroy(t),this.creatListLength(t),t},e.prototype.getOutEquips=function(){for(var t=this.getBagSortQualityEquips(5,0,1,this.normalEquipSmeltFilter),e=[],i=[],s=SubRoles.ins().subRolesLen,n=0;s>n;n++)for(var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getEquipLen(),r=0;a>r;r++){var h=o.getEquipByIndex(r);h.item.itemConfig&&this.addOneEquipToList(i,h,o.job)}for(var l,n=0;n<t.length;n++){var c=t[n];if(l=this.checkEquipsIsGood(i,this.cloneItemDataInfo(c)),l&&!UserEquip.ins().checkEquipsIsWear(l)&&ItemConfig.getQuality(l.itemConfig)<4&&ItemConfig.getSubType(l.itemConfig)!=ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]&&e.push(l),e.length>=9)break}return e.length<9&&this.getGuanyinEquip(e),this.upLevelEquips=[],this.creatListLength(e),e},e.prototype.creatListLength=function(t){if(t.length<9)for(var e=0;9>e;e++)void 0==t[e]&&(t[e]=null)},e.prototype.checkUpLevelEquips=function(t){var e=ItemConfig.getJob(t.itemConfig),i=ItemConfig.getSubType(t.itemConfig),s=t.itemConfig.zsLevel,n=t.itemConfig.level,o=ItemConfig.getQuality(t.itemConfig);if(5==o)return null;this.upLevelEquips||(this.upLevelEquips=[]),this.upLevelEquips[e]||(this.upLevelEquips[e]=[]),this.upLevelEquips[e][i]||(this.upLevelEquips[e][i]=[]),this.upLevelEquips[e][i][s]||(this.upLevelEquips[e][i][s]=[]);var a;if(a=this.upLevelEquips[e][i][s][n]){var r=this.checkEquipGetBest(a,t);return r==a&&(this.upLevelEquips[e][i][s][n]=t),r}return this.upLevelEquips[e][i][s][n]=t,null},e.prototype.checkUplevelBest=function(t,e){var i,s=ItemConfig.getJob(t.itemConfig),n=ItemConfig.getSubType(t.itemConfig),o=null;return e[s]||(e[s]=[]),e[s][n]||(e[s][n]=null),i=e[s][n],i&&(o=this.checkEquipGetBest(i,t)),o},e.prototype.checkEquipsIsGoodRed=function(t,e){for(var i=Actor.level,s=UserZs.ins().lv,n=(ItemConfig.getJob(e.itemConfig),ItemConfig.getSubType(e.itemConfig)),o=SubRoles.ins().subRolesLen,a=0;o>a;a++){t[a]||(t[a]=[]);var r=e.itemConfig.zsLevel?e.itemConfig.zsLevel:0,h=e.itemConfig.level?e.itemConfig.level:0;if(s>=r&&i>=h){if(!t[a][n])return e;var l=this.checkEquipGetBestEx(t[a][n],e);if(!UserEquip.ins().checkEquipsIsWear(l))return l}}return null},e.prototype.checkEquipsIsGood=function(t,e){var i=Actor.level,s=UserZs.ins().lv,n=ItemConfig.getJob(e.itemConfig),o=ItemConfig.getSubType(e.itemConfig);if(e.itemConfig.level>i||e.itemConfig.zsLevel>s){var a=this.checkUplevelBest(e,t);return a&&!UserEquip.ins().checkEquipsIsWear(a)?a:this.checkUpLevelEquips(e)}if(!t[n]||!t[n][o])return this.addOneEquipToList(t,e),null;var r,h;return r=t[n][o],h=this.checkEquipGetBest(r,e),r==h&&(t[n][o]=e),h},e.prototype.checkEquipGetBestEx=function(t,e){return t&&e?t.point>=e.point?t:e:null},e.prototype.checkEquipGetBest=function(t,e){return null!=t&&null!=e&&t.point>=e.point?e:t},e.prototype.addOneEquipToListEx=function(t,e,i){void 0===i&&(i=0);var s;s=e instanceof EquipsData?this.cloneItemDataInfo(e.item):this.cloneItemDataInfo(e);var n=ItemConfig.getJob(s.itemConfig),o=ItemConfig.getSubType(s.itemConfig);n||(n=i),t[n]||(t[n]=[]),t[n][o]=s},e.prototype.addOneEquipToListRed=function(t,e,i){var s;s=e instanceof EquipsData?this.cloneItemDataInfo(e.item):this.cloneItemDataInfo(e);var n=ItemConfig.getSubType(s.itemConfig);t[i]||(t[i]=[]),t[i][n]=s},e.prototype.addOneEquipToList=function(t,e,i){void 0===i&&(i=0);var s;s=e instanceof EquipsData?this.cloneItemDataInfo(e.item):this.cloneItemDataInfo(e);var n=ItemConfig.getJob(s.itemConfig);0==n&&(n=i);var o=ItemConfig.getSubType(s.itemConfig);t[n]||(t[n]=[]),t[n][o]=s},e.prototype.cloneItemDataList=function(t){for(var e=[],i=0;i<t.length;i++){var s=new ItemData;s.handle=t[i].handle,s.configID=t[i].configID,s.att=t[i].att,s.itemConfig=t[i].itemConfig,s.count=t[i].count,e.push(s)}return e},e.prototype.cloneItemDataInfo=function(t){var e=new ItemData;return e.handle=t.handle,e.configID=t.configID,e.att=t.att,e.itemConfig=t.itemConfig,e.count=t.count,e},e.prototype.getBagGoodsBySort=function(t){var i=this.getGoodsListByType(t,e.BAG_TYPE_OTHTER);return i.sort(function(t,e){return t.configID>e.configID?1:t.configID<e.configID?-1:0}),i},e.prototype.getBagGoodsByType=function(t){var i=this.bagModel[e.BAG_TYPE_OTHTER],s=[];for(var n in i)ItemConfig.getType(i[n].itemConfig)==t&&s.push(i[n]);return s},e.prototype.getBagGoodsByDescIndex=function(t,i){void 0===i&&(i=e.BAG_TYPE_OTHTER);var s,n=this.bagModel[i];for(var o in n)if(n[o].itemConfig.descIndex==t){s=n[o];break}return s},e.prototype.getBagEquipsByQuality=function(t,i,s){void 0===i&&(i=0),void 0===s&&(s=e.BAG_TYPE_EQUIP);var n=this.bagModel[s],o=[];for(var a in n){var r=n[a];r&&ItemConfig.getType(r.itemConfig)==i&&ItemConfig.getQuality(r.itemConfig)==t&&o.push(n[a])}return o},e.prototype.getBagGoodsByHandle=function(t,e){for(var i=this.bagModel[t],s=0;s<i.length;s++)if(i[s].handle==e)return i[s];return null},e.prototype.getHuntGoods=function(t){return this.getGoodsListByType(t)},e.prototype.getGoodsListByType=function(t,i){void 0===i&&(i=e.BAG_TYPE_TREASUREHUNT);var s=this.bagModel[i],n=[];if(s)for(var o=0;o<s.length;o++){var a=s[o].itemConfig;a.bagType==t&&(a.split?this.splitItemData(n,s[o]):n.push(s[o]))}return n},e.prototype.splitItemData=function(t,e){var i=e.count;if(i>1)for(;i>0;){var s=e.copy();s.count=1,t.push(s),i-=1}else t.push(e)},e.prototype.getHuntGoodsBySort=function(t){var i=[];return this.bagModel[e.BAG_TYPE_TREASUREHUNT]&&(i=this.getGoodsListByType(t),i.sort(function(t,e){var i=ItemConfig.getType(t.itemConfig),s=ItemConfig.getType(e.itemConfig);if(s>i)return 1;if(i>s)return-1;if(i){if(t.configID>=e.configID)return 1;if(t.configID<e.configID)return-1}else{if(t.point>=e.point)return-1;if(t.point<e.point)return 1}return 0})),i},e.prototype.getGuanyinEquip=function(t){var e=this.getBagSortQualityEquips(5,0,0,this.otherEquipSmeltFilter),i=0,s=SubRoles.ins().subRolesLen;if(3>s)i=0;else for(var n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getEquipByIndex(EquipPos.DZI);(a&&a.item&&a.item.configID<i||0==i)&&(i=a.item.configID)}if(e.length>0)for(var r in e){var h=this.updateGuanyinEquip(e[r],i);if(null!=h&&t.push(h),t.length>=9)break}return t},e.prototype.updateGuanyinEquip=function(t,e){void 0===e&&(e=0);var i=SubRoles.ins().subRolesLen;if(ItemConfig.getSubType(t.itemConfig)==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]){for(var s=t.point,n=0;i>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getEquipByIndex(EquipPos.DZI),r=a.item.itemConfig;if(!r||r&&s>a.item.point)return null}return t}return null},e.prototype.getGuanyinLevel=function(t){var e=TextFlowMaker.getCStr(t.id-ItemConst.GUANYIN_ITEM+1);
return e+"阶"},e.prototype.getIsExitUsedItem=function(){var t=this.bagModel[e.BAG_TYPE_OTHTER];if(!t)return!1;for(var i=0;i<t.length;i++)if(t[i].getCanbeUsed())return e.ins().isExitUsedItem=1,!0;return e.ins().isExitUsedItem=0,!1},e.prototype.getEquipsScoreByRolesOfBody=function(){for(var t=SubRoles.ins().subRolesLen,e=0,i=0;t>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i);if(s&&s.equipsData)for(var n=s.equipsData,o=0;o<EquipPos.MAX;o++)n[o]&&n[o].item&&n[o].item.itemConfig&&n[o].item.itemConfig.id&&(e+=n[o].item.point)}return e},e.prototype.calculationScore=function(t){for(var e,i=0,s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n);if(o.job==ItemConfig.getJob(t.itemConfig))for(var a=o.getEquipLen(),r=0;a>r;r++)e=o.getEquipByIndex(r).item,e&&e.itemConfig&&ItemConfig.getSubType(e.itemConfig)==ItemConfig.getSubType(t.itemConfig)&&(i=0==i?e.point:Math.min(e.point,i))}return t.point-i},e.prototype.useRenameItem=function(t,e){ViewManager.ins().open(RenameWin)},e.getAttrPower=function(t,e){void 0===e&&(e=null);var i=GlobalConfig.AttrPowerConfig,s=0;if(!t)return s;for(var n=0,o=0;o<t.length;o++){var a=t[o].type,r=t[o].value;a!=AttributeType.atHpEx&&a!=AttributeType.atAtkEx&&a!=AttributeType.atDamageReduction&&i[a]&&r&&(s+=r*i[a].power,a==AttributeType.atHuiXinDamage&&e&&(n+=ItemConfig.relatePower(t[o],e)))}return Math.floor(s/100)+Math.floor(n)},e.prototype.setEquipPowerDic=function(t,e,i){void 0===i&&(i=0),this.equipPowerDic[t]||(this.equipPowerDic[t]=[]),this.equipPowerDic[t][e]||(this.equipPowerDic[t][e]=0),this.equipPowerDic[t][e]=i},e.prototype.getEquipPowerDic=function(t,e){return this.equipPowerDic[t]&&this.equipPowerDic[t][e]?this.equipPowerDic[t][e]:0},e.prototype.getLowEquipIndex=function(t,e){for(var i=-1,s=Number.MAX_VALUE,n=t.length,o=0;n>o;o++)if(ForgeConst.EQUIP_POS_TO_SUB[o]==e){var a=t[o];if(0==a.handle)return o;var r=a.point;s>r&&(i=o,s=r)}return i},e.prototype.getHejiEquips=function(){for(var t=this.bagModel[1],e=[],i=0;i<t.length;i++){var s=t[i];5==ItemConfig.getType(s.itemConfig)&&e.push(s)}return e},e.prototype.checkIsWear=function(t){if(!t)return!1;for(var e=0;8>e;e++){var i=UserSkill.ins().equipListData[e];if(i&&i.handle==t.handle)return!1}return!0},e.prototype.makeHejiWearList=function(t){var e=ItemConfig.getSubType(t.itemConfig);this.wearList[e]=t},e.prototype.checkHejiEquipsTodestroy=function(t){if(UserSkill.ins().equipListData){for(var e=0;8>e;e++){var i=UserSkill.ins().equipListData[e];i&&0!=i.configID&&this.makeHejiWearList(i)}for(var s,n,o=this.getHejiEquips(),a=o.length,r=0;a>r;r++){s=o[r];var h=ItemConfig.getSubType(s.itemConfig);if(n=this.wearList[h],n&&0!=n.configID){var l=0,c=0;if(l=s.point,c=n.point,c>=l)t.push(s);else{var u=0;s.itemConfig.level<=u&&(this.wearList[h]=s,this.checkIsWear(n)&&t.push(n))}if(t.length>=9)break}}}},e.prototype.getEquipByPos=function(t,i){var s=this.bagModel[e.BAG_TYPE_EQUIP],n=SubRoles.ins().getSubRoleByIndex(t),o=n.getEquipByIndex(i),a=0;a=o&&o.item.itemConfig?ItemConfig.getSubType(o.item.itemConfig):i;for(var r=[],h=[],l=Actor.level,c=UserZs.ins().lv,u=0;u<s.length;u++){var p=ItemConfig.getJob(s[u].itemConfig),d=ItemConfig.getSubType(s[u].itemConfig);if((p==n.job||0==p)&&d==a){if(91==Math.floor(s[u].itemConfig.id/1e4))continue;if(o&&s[u].handle==o.item.handle)continue;c<s[u].itemConfig.zsLevel||l<s[u].itemConfig.level?h.push(s[u]):r.push(s[u])}}return r=r.sort(this.sortFun),h.sort(this.sortFun),r=r.concat(h)},e.prototype.sortFun=function(t,i){var s=e.ins().getEquipAttrs(t),n=e.getAttrPower(s),o=e.ins().getEquipAttrs(i),a=e.getAttrPower(o);return a>n?1:n>a?-1:0},e.prototype.getEquipAttrs=function(t){var e=GlobalConfig.EquipConfig[t.configID],i=[];for(var s in Role.translate)if(!(e[s]<=0))for(var n=t.att,o=0;o<n.length;o++)if(n[o].type==Role.getAttrTypeByName(s)){var a=new AttributeData;a.type=n[o].type,a.value=e[s]+n[o].value,i.push(a);break}return i},e.prototype.checkEqRedPoint=function(t,i,s){var n,o=i.getEquipByIndex(t);n=o.item.itemConfig&&ItemConfig.getQuality(o.item.itemConfig)<4?null:GlobalConfig.ItemConfig[o.item.configID+1];var a=0,r=0;if(o.item.itemConfig&&4==ItemConfig.getQuality(o.item.itemConfig)&&o.item.itemConfig.zsLevel>=12)return null;if(o.item.itemConfig&&5==ItemConfig.getQuality(o.item.itemConfig))return null;if(null!=n&&(n.level>Actor.level||n.zsLevel>UserZs.ins().lv))return null;if(void 0!=n&&0!=o.item.handle&&4==ItemConfig.getQuality(o.item.itemConfig)&&1!=o.item.itemConfig.level&&-1==e.fitleEquip.indexOf(o.item.configID));else{var h=UserEquip.ins().getEquipConfigIDByPosAndQualityByGod(i,t,4,i.job),l=GlobalConfig.LegendComposeConfig[h];if(l){a=l.count,r=l.itemId;var c=e.ins().getBagGoodsCountById(0,r);return c>=a&&!e.ins().OrangeEquipRedPoint[t]?(s&&(e.ins().OrangeEquipRedPoint[t]=!1),!0):!1}}return null},e.prototype.doChoosableGiftResult=function(t){var e=t.readUnsignedByte();0==e&&this.postGiftResult()},e.prototype.postGiftResult=function(){},e.prototype.sendChoosableGift=function(t,e,i){var s=this.getBytes(8);s.writeInt(t),s.writeInt(e),s.writeInt(i+1),this.sendToServer(s)},e.prototype.getRmbItemIsBuy=function(t){var e=GlobalConfig.ItemConfig[t];return e&&e.needyuanbao&&Actor.yb>=e.needyuanbao?!0:!1},e}(BaseSystem);UserBag.BAG_TYPE_OTHTER=0,UserBag.BAG_TYPE_EQUIP=1,UserBag.BAG_TYPE_TREASUREHUNT=2,UserBag.BAG_ENOUGH=20,UserBag.BAG_ENOUGH100=100,UserBag.BAG_ENOUGH200=200,UserBag.BAG_DESC_TYPE_HEIR=11,__reflect(UserBag.prototype,"UserBag");var GameSystem;!function(t){t.userbag=UserBag.ins.bind(UserBag)}(GameSystem||(GameSystem={}));var BagWin=function(t){function e(){var e=t.call(this)||this;return e.oldIndex=0,e.skinName="BagSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.tab.dataProvider=this.viewStack,this.itemList.itemRenderer=ItemBase,this.itemListGoods.itemRenderer=ItemBase,this.itemListRune.itemRenderer=ItemBase,this.itemScroller.viewport=this.itemList,this.itemGoodsScroller.viewport=this.itemListGoods},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.smeltBtn,this.onClick),this.addTouchEvent(this.addBtn,this.onClick),this.addChangeEvent(this.tab,this.onClick),this.observe(UserBag.ins().postBagWillFull,this.setBagTips),this.observe(UserBag.ins().postBagVolAdd,this.setCount),this.observe(UserBag.ins().postHasItemCanUse,this.setIsExitUsedItem),this.observe(UserBag.ins().postItemCountChange,this.showBagBtnRedPoint),this.observe(UserBag.ins().postItemChange,this.updateBag),this.observe(UserBag.ins().postItemAdd,this.updateBag),this.observe(UserBag.ins().postItemDel,this.updateBag);var i=0;void 0!=t[0]&&(i=t[0],3==i&&this.reinComposePanel.open(t[1],t[2],t[3])),this.viewStack.selectedIndex=this.tab.selectedIndex=i,this.setBagData(i),this.setIsExitUsedItem(),UserBag.ins().postBagVolChange(),this.showBagBtnRedPoint(UserBag.ins().isChange),MergeCC.ins().isOpen()?this.openMerge():this.inactiveSamsara()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=ViewManager.ins().getView(UIView2);i&&i.closeNav(UIView2.NAV_BAG)},e.prototype.openMerge=function(){var t=this.viewStack.getChildIndex(this.reinComposePanel);0>t&&this.viewStack.addChild(this.reinComposePanel),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=37,this.redPoint3.visible=MergeCC.ins().redPoint()},e.prototype.inactiveSamsara=function(){var t=this.viewStack.getChildIndex(this.reinComposePanel);t>=0&&this.viewStack.removeChildAt(t),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=98,this.redPoint3.visible=!1},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.smeltBtn:ViewManager.ins().close(e),ViewManager.ins().open(SmeltEquipTotalWin);break;case this.addBtn:var i=GlobalConfig.BagBaseConfig,s=(UserBag.ins().bagNum-i.baseSize)/i.rowSize;s==CommonUtils.getObjectLength(GlobalConfig.BagExpandConfig)?UserTips.ins().showTips(StringUtils.addColor("格子不能继续扩张",15937822)):ViewManager.ins().open(BagAddItemWarn);break;case this.tab:3==this.tab.selectedIndex?this.reinComposePanel.open():2==this.tab.selectedIndex?this.setBagData(this.tab.selectedIndex):this.setBagData(this.tab.selectedIndex)}},e.prototype.setCount=function(){this.itemCount.text=UserBag.ins().getBagItemNum()+"/"+UserBag.ins().getMaxBagRoom()},e.prototype.updateBag=function(){this.setBagData(this.oldIndex)},e.prototype.setBagData=function(t){switch(void 0===t&&(t=1),t){case 0:var e=UserBag.ins().getBagSortQualityEquips(5,0,1);e.sort(UserBag.ins().sort3);var i=this.itemList.dataProvider;i?i.replaceAll(e):this.itemList.dataProvider=new eui.ArrayCollection(e);break;case 1:var s=UserBag.ins().getBagGoodsBySort(0),n=UserBag.ins().getBagGoodsBySort(2),o=n.concat(s),a=this.itemListGoods.dataProvider;a?a.replaceAll(o):this.itemListGoods.dataProvider=new eui.ArrayCollection(o);break;case 2:var r=UserBag.ins().getBagGoodsBySort(1),h=this.itemListRune.dataProvider;h?h.replaceAll(r):this.itemListRune.dataProvider=new eui.ArrayCollection(r)}this.oldIndex!=t?this.oldIndex=t:this.tab.selectedIndex=t,this.setCount()},e.prototype.setIsExitUsedItem=function(){this.redPoint1.visible=UserBag.ins().getIsExitUsedItem()||UserBag.ins().getBagGoodsCountByType(8),this.redPoint2.visible=UserBag.ins().getRuneBagGoodsCountByType(8),this.redPoint3.visible=MergeCC.ins().isOpen()&&MergeCC.ins().redPoint()},e.prototype.setBagTips=function(t){this.redPoint0.visible=t>0||UserBag.ins().isChange>0},e.prototype.showBagBtnRedPoint=function(t){this.redPoint.visible=t>0},e}(BaseEuiView);__decorate([callDelay(100)],BagWin.prototype,"updateBag",null),__reflect(BagWin.prototype,"BagWin"),ViewManager.ins().reg(BagWin,LayerManager.UI_Main);var BookUpItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mc=new MovieClip,this.mc.x=45,this.mc.y=40},e.prototype.dataChanged=function(){if(this.clear(),this.data instanceof ItemData){if(this.itemConfig=this.data.itemConfig,this.itemIcon.setData(this.itemConfig),null==this.itemConfig)return;var t=ItemConfig.getType(this.itemConfig),e=ItemConfig.getJob(this.itemConfig);4==t&&(this.nameTxt.text=this.itemConfig.name),this.itemIcon.imgJob.source=(0==t||4==t)&&e&&this.itemIcon.imgJob.visible?"job"+e+"Item":""}},e.prototype.onClick=function(){},e.prototype.playEff=function(){this.data&&(this.mc.playFile(RES_DIR_EFF+"litboom",1),this.addChild(this.mc))},e.prototype.clear=function(){t.prototype.clear.call(this),this.itemIcon.imgJob.source=null},e}(ItemBase);__reflect(BookUpItem.prototype,"BookUpItem");var FlowerRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerRewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.playerName.text=this.data.roleName,this.flowerCount.textFlow=TextFlowMaker.generateTextFlow("被你的魅力折服，送上了|C:65280&T:【"+this.data.count+"】|朵泣血神花")},e}(BaseItemRender);__reflect(FlowerRewardItemRender.prototype,"FlowerRewardItemRender");var FlowerShowItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerShowItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._inited=!0,this.showEffect()},e.prototype.onTouch=function(t){ViewManager.ins().open(FlowerOpenWin),DisplayUtils.removeFromParent(this)},e.prototype.onRemove=function(t){this.flowerImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.mcEff&&(this.mcEff.destroy(),this.mcEff=null,this.isPlaying=!1)},e.prototype.showEffect=function(){this._inited&&(this.isPlaying||(this.flowerImg.alpha=0,this.mcEff||(this.mcEff=ObjectPool.pop("MovieClip"),this.flowereff.addChild(this.mcEff)),this.mcEff.playFile(RES_DIR_EFF+"flowereff",1,this.playComplete.bind(this),!0),this.isPlaying=!0,this.flowerImg.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.flowerImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.flowerImg.source=null,this.flowerImg.source="flower_openImg",this.imgBg.source=null,this.imgBg.source="main_hongbaotexiao_png"))},e.prototype.playComplete=function(){this.mcEff.destroy(),this.mcEff=null,this.flowerImg.alpha=1,this.isPlaying=!1},e}(eui.Component);__reflect(FlowerShowItem.prototype,"FlowerShowItem");var FlowerTargetItemrender=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerTargetItem",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.nameTxt.text=this.data.name},e}(BaseItemRender);__reflect(FlowerTargetItemrender.prototype,"FlowerTargetItemrender");var DressSpecialTipsBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="DressSpecialAttrSkin",e}return __extends(e,t),e.prototype.setData=function(t){if(this.clear(),null!=t){var e=t.title,i=t.attrDesc;this.attrType.textFlow=TextFlowMaker.generateTextFlow1(e),this.suit.textFlow=TextFlowMaker.generateTextFlow1(i)}},e.prototype.clear=function(){this.attrType.textFlow=null,this.suit.textFlow=null},e}(BaseView);__reflect(DressSpecialTipsBase.prototype,"DressSpecialTipsBase");var DressTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DressTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemConfig=t[0],this.itemId=this.itemConfig.id,this.addTouchEvent(this.takeBtn,this.onTap),this.addTouchEndEvent(this,this.otherClose),this.setTipsData()},e.prototype.close=function(){this.itemData=null},e.prototype.setTipsData=function(){var t=this.getIdByItemId(this.itemId);if(this.itemData=t,t){var e=t.attr,i=UserBag.getAttrPower(AttributeData.transformAttr(e));this.powerPanel.setPower(i),this.itemname.text=t.name;var s=t.show_img;this.module.source=s,this.quali.source="quali"+ItemConfig.getQuality(this.itemConfig),this.style.text=DressTypeName[t.pos],this.dressName.source=t.dress_name+"_png";var n=new EquipTipsItemBase;if(n.data={title:"普通属性",attributeData:e,colorName:0,colorValue:0,others:null},this.content.addChild(n),t.special_attr_desc){var o=new DressSpecialTipsBase;o.setData({title:"特殊属性",attrDesc:t.special_attr_desc}),this.content.addChild(o)}}},e.prototype.onTap=function(){ViewManager.ins().open(DressWin,0,this.itemData.pos-1,this.itemData.id)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.getIdByItemId=function(t){var e=GlobalConfig.ZhuangBanId;for(var i in e){var s=e[i];if(s.cost.itemId==t)return s}return null},e}(BaseEuiView);__reflect(DressTipsWin.prototype,"DressTipsWin"),ViewManager.ins().reg(DressTipsWin,LayerManager.UI_Popup);var EquipDetailedWin=function(t){function e(){var e=t.call(this)||this;return e._bottomY=0,e._equipPower=0,e._totalPower=0,e.curRole=0,e.index=0,e.skinName="EquipTipsSkin",e.powerPanel.setBgVis(!1),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2],o=t[3];this.roleModel=t[4],t[5]>=0?(this.curRole=t[5],this.index=t[6],this.changeBtn.visible=!0):this.changeBtn.visible=!1,this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.changeBtn,this.onEquipChange),this.setData(i,s,n,o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onEquipChange=function(t){ViewManager.ins().open(RoleChooseEquipWin,this.curRole,this.index),ViewManager.ins().close(e)},e.prototype.getExtremeName=function(){if(!this.changeBtn.visible)return"";var t=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this.roleModel,this.index);return t?GlobalConfig.ZhiZunEquipLevel[this.index][t].headTxt:""},e.prototype.setData=function(t,e,i,s){var n,o=s instanceof ItemData?s:void 0;if(this._totalPower=0,void 0!=e&&void 0==o){if(o=UserBag.ins().getBagGoodsByHandle(t,e),!o)for(var a=SubRoles.ins().subRolesLen,r=0;a>r;r++)for(var h=SubRoles.ins().getSubRoleByIndex(r),l=h.getEquipLen(),c=0;l>c;c++)if(h.getEquipByIndex(c).item.handle==e){o=h.getEquipByIndex(c).item;break}if(!o)for(var u=Shop.ins().shopData,a=u.getShopEquipDataLength(),p=null,r=0;a>r;r++)if(p=u.getShopEquipDataByIndex(r),null!=p&&e==p.item.handle){o=p.item;break}o||new Error("请检查handle是否传错！"),n=o.itemConfig,i=o.configID}else n=GlobalConfig.ItemConfig[i];this.nameLabel.text=this.getExtremeName()+n.name,this.nameLabel.textColor=ItemConfig.getQualityColor(n);var d=ItemConfig.getQuality(n),g=ItemConfig.getSubType(n),f=ItemConfig.getJob(n);this.quali.source=d>0?"quali"+d:"",this.itemIcon.setData(n);var v=0;if(o instanceof ItemData||null!=n)if(o&&4==ItemConfig.getType(o.itemConfig)){this.levelKey.text="需求：",this.type.text=Role.getWingEquipNameByType(g),this.lv.text=n.level+1+"阶羽翼可穿戴",this.lv.textColor=15937822;for(var a=SubRoles.ins().subRolesLen,r=0;a>r;r++)if(SubRoles.ins().getSubRoleByIndex(r).wingsData.lv>=n.level){this.lv.textColor=3532333;break}this.career.text=Role.getJobNameByJob(f),this.jobGroup.visible=!0}else o&&5==ItemConfig.getType(o.itemConfig)?(this.levelKey.text=n.zsLevel>0?"转生：":"等级：",this.type.text=Role.getHejiEquipNameByType(g),this.lv.text=isNaN(n.zsLevel)?(n.level||1)+"级":n.zsLevel+"转",n.zsLevel>0?this.lv.textColor=UserZs.ins().lv<n.zsLevel?15937822:3532333:this.lv.textColor=Actor.level<n.level?15937822:3532333,this.jobGroup.visible=!1,-1!=UserBag.fitleEquip.indexOf(n.id)&&(this.lv.text="无级别")):(g==EquipPos.DZI?(this.levelKey.text="等阶：",this.type.text=Role.getEquipNameByType(g),this.lv.text=UserBag.ins().getGuanyinLevel(n)):(this.levelKey.text=n.zsLevel>0?"转生：":"等级：",this.type.text=Role.getEquipNameByType(g),this.lv.text=isNaN(n.zsLevel)?(n.level||1)+"级":n.zsLevel+"转",-1!=UserBag.fitleEquip.indexOf(n.id)&&(this.lv.text="无级别")),n.zsLevel>0?this.lv.textColor=UserZs.ins().lv<n.zsLevel?15937822:3532333:this.lv.textColor=Actor.level<n.level?15937822:3532333,this.career.text=Role.getJobNameByJob(f),this.jobGroup.visible=!0);var y=1;this.attr1.visible=!1,this.attr2.visible=!1,this.attr3.visible=!1,this.attr4.visible=!1;var m,T=GlobalConfig.EquipConfig[i],b=[],C=["","","hp","","atk","def","res"];this.roleModel&&(m=this.roleModel.heirloom.getInfoBySolt(this.index));for(var I in Role.translate)if(!isNaN(T[I])&&T[I]){var w="";w+=AttributeData.getAttrStrByType(Role.getAttrTypeByName(I))+"  ",w+=T[I];var _=new AttributeData;if(void 0!=o){if(o.att){for(var S=o.att,B=0;B<S.length;B++)if(S[B].type==Role.getAttrTypeByName(I)){w+=" +"+S[B].value,m&&m.attr_add&&(w+="+"+Math.floor((T[I]+S[B].value)*(m.attr_add/100))),_.type=S[B].type,_.value=T[I]+S[B].value,b.push(_);break}}else for(var E in T)if(C[E]){var x=T[C[E]];if(void 0!=x&&0!=x){var R=Role.getAttrTypeByName(C[E]);w+=AttributeData.getAttrStrByType(R)+"  ",w+=T[E],_.type=R,_.value=T[E],b.push(_)}}}else _.type=Role.getAttrTypeByName(I),_.value=T[I],b.push(_);this["attr"+y].text=w,this["attr"+y].visible=!0,y++}for(o?this._equipPower=o.point:(this._equipPower=Math.floor(UserBag.getAttrPower(b)),T&&T.exPower&&(v=T.exPower)),this._totalPower+=this._equipPower+v,this._score=this._totalPower,this.score.text="评分："+this._totalPower,this._bottomY=this["attr"+(y-1)].y+this["attr"+(y-1)].height;this.forgeGroup.numElements;)this.forgeGroup.removeChildAt(0);if(this.roleModel){for(var a=this.roleModel.getEquipLen(),r=0;a>r;r++){var M=this.roleModel.getEquipByIndex(r);if(M.item.handle==e){this.setForge(M,r);break}}T&&(T.baseAttr1&&(this._equipPower+=ItemConfig.relatePower(T.baseAttr1,this.roleModel)),T.baseAttr2&&(this._equipPower+=ItemConfig.relatePower(T.baseAttr2,this.roleModel)))}if(g==EquipPos.DZI&&this.addTips(null,4,0),n.desc){var D=new eui.Label;D.size=18,D.width=250,D.textColor=13746831,D.x=this.attr1.x,D.y=this._bottomY+=10,D.textFlow=TextFlowMaker.generateTextFlow(n.desc),this.forgeGroup.addChild(D),this._bottomY+=D.textHeight}var A=630;this._bottomY>A&&(this._bottomY=A),this.background.height=this.powerPanel.y+this.powerPanel.height+this._bottomY+12,this.bgGroup.y=this.background.y+this.background.height,this.powerPanel.setPower(this._totalPower);var k=this.attr1.parent.parent;k.height=this._bottomY,k.scrollPolicyV=this._bottomY>=A?"on":"off",this.anigroup.height=this.powerPanel.y+this.powerPanel.height+this.bgGroup.height+k.height+60,this.anigroup.height=this.anigroup.height>930?930:this.anigroup.height,this.anigroup.y=this.anigroup.height/2-this.background.height/2},e.prototype.setForge=function(t,e){for(var i=0,s=0;4>s;s++){switch(s){case ForgeWin.Page_Select_Boost:i=t.strengthen;break;case ForgeWin.Page_Select_ZhuLing:i=t.zhuling;break;case ForgeWin.Page_Select_Gem:i=t.gem;break;case ForgeWin.Page_Select_Weapon:i=t.tupo}if(i>0){var n=UserForge.ins().getForgeConfigByPos(e,i,s);this.addTips(n.attr,s,i);var o=0;o=3==s?Math.floor(this._equipPower*(Number(n.attr)/100)):Math.floor(UserBag.getAttrPower(n.attr)),this._totalPower+=o}}if(e>=EquipPos.WEAPON&&e<=EquipPos.SHOE&&(i=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this.roleModel,e),this.itemIcon.extreme.visible=i?!0:!1,i)){var n=GlobalConfig.ZhiZunEquipLevel[e][i];n.ex_attrs&&(this._totalPower+=Math.floor(UserBag.getAttrPower(n.ex_attrs))),this._totalPower+=n.ex_power;var a="",r=ExtremeEquipModel.ins().getZhiZunLinkLv(this.curRole+1,e,i),h=r>0,l=void 0,c=!1;for(var u in GlobalConfig.ZhiZunLinkLevel[e]){for(var p in GlobalConfig.ZhiZunLinkLevel[e][u])if(l=GlobalConfig.ZhiZunLinkLevel[e][u][p],1==l.level&&(a=l.chainDesc),l.level==r&&h){c=!0,l.attrs&&(this._totalPower+=Math.floor(UserBag.getAttrPower(l.attrs))),l.exAttrs&&(this._totalPower+=Math.floor(UserBag.getAttrPower(l.exAttrs))),this._totalPower+=l.ex_power,a=l.chainDesc;break}if(c)break}this._totalPower+=Math.floor(UserBag.getAttrPower(n.attrs)),this.addTips(n.attrs,5,i,r,n.skillId,a)}},e.prototype.addTips=function(t,e,i,s,n,o){void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o="");var a=new eui.Label;a.fontFamily="Arial",a.size=20,a.textColor=8283191,a.bold=!0,a.x=24,a.y=this._bottomY+10+14,a.touchEnabled=!1,this.forgeGroup.addChild(a);var r=new eui.Label;r.fontFamily="Arial",r.size=18,r.lineSpacing=8,r.x=46,r.y=a.y+24,r.touchEnabled=!1,this.forgeGroup.addChild(r);var h;switch(e){case ForgeWin.Page_Select_Boost:a.text="强化属性",h=AttributeData.getAttrStrAdd(t,11),r.textColor=5342973;break;case ForgeWin.Page_Select_Gem:a.text="精炼属性",h=AttributeData.getAttrStrAdd(t,12),r.textColor=13779707;break;case ForgeWin.Page_Select_ZhuLing:a.text="铸造属性",r.textColor=15054355,h=AttributeData.getAttrStrAdd(t,15);break;case ForgeWin.Page_Select_Weapon:a.text="突破属性";break;case 4:a.text="特殊属性",this._bottomY=a.y+a.height;break;case 5:a.text="至尊属性",a.textColor=16577847,h=t,r.textColor=16577847}var l;e!=ForgeWin.Page_Select_ZhuLing&&5!=e&&this.roleModel&&(l=this.roleModel.heirloom.getInfoBySolt(this.index));var c=0;if(h)if(e!=ForgeWin.Page_Select_Weapon){if(r.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(h,1,1,"  ",!1,!0,l)),5==e){var u=new eui.Label;u.fontFamily="Arial",u.size=20,u.textColor=16577847,u.x=24,u.y=r.y+r.height+10,u.touchEnabled=!1,u.width=280,this.forgeGroup.addChild(u),u.textFlow=TextFlowMaker.generateTextFlow("<font color = '"+(s?"#FCF537":"#666666")+"'><b>【灵魂锁链Lv"+(s?s:1)+"】</b></font>"),c+=u.textHeight+10;var p=new eui.Label;if(p.fontFamily="Arial",p.size=18,p.lineSpacing=8,p.textColor=16577847,p.x=46,p.y=u.y+u.textHeight+10,p.touchEnabled=!1,p.multiline=!0,p.wordWrap=!0,this.forgeGroup.addChild(p),p.textFlow=TextFlowMaker.generateTextFlow("<font color = '"+(s?"#FCF537":"#666666")+"'>"+o+"</font>"),c+=p.textHeight+10,n){var d=GlobalConfig.SkillsConfig[n],g=GlobalConfig.SkillsDescConfig[d.desc],f=new eui.Label;f.fontFamily="Arial",f.size=20,f.textColor=16577847,f.x=24,f.y=p.y+p.height+10,f.touchEnabled=!1,f.width=280,f.wordWrap=!0,f.multiline=!0,this.forgeGroup.addChild(f),f.textFlow=TextFlowMaker.generateTextFlow("<b>【"+g.name+"Lv"+i+"】</b>"),c+=f.textHeight+10;var v=new eui.Label;v.fontFamily="Arial",v.size=18,v.lineSpacing=8,v.textColor=16577847,v.x=46,v.y=f.y+f.textHeight+10,v.touchEnabled=!1,v.width=280,v.wordWrap=!0,v.multiline=!0,this.forgeGroup.addChild(v),v.textFlow=TextFlowMaker.generateTextFlow(g.desc.replace("%s%",d.desc_ex[0]+"")),c+=v.textHeight+10}}}else r.textFlow=TextFlowMaker.generateTextFlow1("基础属性 +"+t+"%");this._bottomY=r.y+r.height+c},e.prototype.getScore=function(){return this._score},e.prototype.getPower=function(){return this.powerPanel.power},e.prototype.getType=function(){return this.type.text},e}(BaseEuiView);__reflect(EquipDetailedWin.prototype,"EquipDetailedWin"),ViewManager.ins().reg(EquipDetailedWin,LayerManager.UI_Popup);var FlowerOpenWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerOpenSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=FlowerRewardItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.closeBtn0,this.onTouch),this.observe(UserFb.ins().postTeamFbFlowarRecords,this.update),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTouch),this.removeTouchEvent(this.closeBtn0,this.onTouch),this.removeObserve(),UserFb.ins().clearTfFlowerRecords();var t=ViewManager.ins().getView(PlayFunView);t&&t.removeFlowerItem()},e.prototype.update=function(){this._collect||(this._collect=new ArrayCollection,this.list.dataProvider=this._collect);var t=UserFb.ins().tfFlowerRecords.concat();t.reverse(),this._collect.source=t;for(var e=t.length,i=0,s=0;e>s;s++)i+=t[s].count*GlobalConfig.TeamFuBenBaseConfig.flowerChiv;this.charmCount.text="你的魅力提高了 "+i+" 点"},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(FlowerOpenWin.prototype,"FlowerOpenWin"),ViewManager.ins().reg(FlowerOpenWin,LayerManager.UI_Popup);var FlowerUseTipsWin=function(t){function e(){var e=t.call(this)||this;return e._sendCount=1,e._maxCount=0,e.skinName="flowerUseTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=FlowerTargetItemrender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.addTouchEvent(this.list,this.onTouchList),this.observe(Friends.ins().postFriendChange,this.update,this),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.observe(UserBag.ins().postItemDel,this.updateMaterial),this._sendCount=1,this._friendID=0,this.update(),this.selectName.text=""},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeTouchEvent(this.list,this.onTouchList),this.removeObserve(),this.scroller.visible=!1},e.prototype.update=function(){this._collect||(this._collect=new ArrayCollection,this.list.dataProvider=this._collect),this._collect.source=Friends.ins().friendsList.source,this.updateCount(),this.updateMaterial()},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagItemById(GlobalConfig.TeamFuBenBaseConfig.itemId);this._maxCount=t?t.count:0,this.itemCount.text="剩余鲜花："+this._maxCount},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:if(!this._friendID)return void UserTips.ins().showTips("请选择要赠送鲜花的好友");if(this._maxCount<=0||this._maxCount<this._sendCount)return void UserTips.ins().showTips("背包内没有足够的道具");UserFb.ins().sendTfFlower(this._friendID,this._sendCount);break;case this.minBtn:1!=this._sendCount&&(this._sendCount=1,this.updateCount());break;case this.maxBtn:this._sendCount!=this._maxCount&&(this._sendCount=this._maxCount,this.updateCount());break;case this.sub1Btn:this._sendCount>1&&(this._sendCount--,this.updateCount());break;case this.add1Btn:this._sendCount<this._maxCount&&(this._sendCount++,this.updateCount());break;case this.openListBtn:this.scroller.visible=!this.scroller.visible}},e.prototype.onTouchList=function(t){var e=this.list.selectedItem;e&&(this._friendID=e.id,this.selectName.text=e.name,this.scroller.visible=!this.scroller.visible)},e.prototype.updateCount=function(){this.numLabel.text=this._sendCount+"",this.charmPoint.text="魅力值："+this._sendCount*GlobalConfig.TeamFuBenBaseConfig.flowerChiv},e}(BaseEuiView);__reflect(FlowerUseTipsWin.prototype,"FlowerUseTipsWin"),ViewManager.ins().reg(FlowerUseTipsWin,LayerManager.UI_Popup);var HejiEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e._bottomY=0,e._equipPower=0,e._totalPower=0,e.curRole=0,e.index=0,e.gainWay=[["参与击杀秘境BOSS","BossWin",2],["限时任务","LimitTaskView"]],e.skinName="HejiEquipTipsSkin",e.powerPanel.setBgVis(!1),e.powerPanel0.setBgVis(!1),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemIcon.imgJob.visible=!1,this.waylist.itemRenderer=RingGainItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],t[1]?this.changeBtn.visible=!0:this.changeBtn.visible=!1,this.isBagTips=t[2],this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.changeBtn,this.onEquipChange),this.waylist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.setData(this.data)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEquipChange,this.changeBtn),this.waylist.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2],!0),ViewManager.ins().close(this))}},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onEquipChange=function(t){return this.needCount?void this.onBtn():void UserTips.ins().showTips("|C:0xff0000&T:材料不足")},e.prototype.onBtn=function(){var t;if(this.data instanceof ItemData||this.data.id)t=this.data.configID+10;else{var i=91e4+this.data+1;t=i}for(var s=GlobalConfig.ItemConfig[t],n=ItemConfig.getSubType(s),o=UserBag.ins().getHejiEquipsByType(n),a=0,r=0;r<o.length;r++)if(o[r].configID==s.id&&n==ItemConfig.getSubType(o[r].itemConfig)){a=o[r].handle;break}if(!a)return void UserTips.ins().showTips("|C:0xff0000&T:符文异常");var h=s.level?s.level:0,l=s.zsLevel?s.zsLevel:0;return l>UserZs.ins().lv||h>Actor.level?void UserTips.ins().showTips("|C:0xff0000&T:符文需要"+l+"转"+h+"级"):(ViewManager.ins().close(e),void UserSkill.ins().sendDressHejiEquip(a,n))},e.prototype.setData=function(t){var e;if(t instanceof ItemData){e=t;var i=GlobalConfig.EquipConfig[e.configID+10];if(i){var s=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,i.id);s?this.currentState="not_max":this.currentState="not_max_no"}else this.currentState="max"}else{if(t.id)e=new ItemData,e.configID=t.id;else if(t>91e4)e=new ItemData,e.configID=t;else{var n=91e4+t+1;e=new ItemData,e.configID=n}var s=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,e.configID);s&&s.count?this.currentState="unactivated_have":this.currentState="unactivated_no"}this.isBagTips&&(this.currentState="default"),this.validateNow(),this.needCount=0,this.setCurAttrs(e),this.setNextAttrs(e),this.unactivated(e)},e.prototype.unactivated=function(t){if("max"!=this.currentState&&"default"!=this.currentState){var e;
e=this.data instanceof ItemData||this.data.id?t.configID+10:t.configID;var i=GlobalConfig.ItemConfig[e];this.attr0.text=""+i.name,this.attr0.textColor=ItemConfig.getQualityColor(i);var s=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,i.id);s?(this.attr6.text="(拥有×"+s.count+")",this.attr6.textColor=65280,this.needCount=s.count):this.attr6.textColor=16711680,"unactivated_no"==this.currentState||"not_max_no"==this.currentState?this.waylist.dataProvider=new eui.ArrayCollection(this.gainWay):"unactivated_have"==this.currentState&&(this.changeBtn.label="激  活")}},e.prototype.setNextAttrs=function(t){if("not_max"==this.currentState||"not_max_no"==this.currentState){this.changeBtn.label="升  级";var e=t.configID+10,i=GlobalConfig.ItemConfig[e],s=GlobalConfig.EquipConfig[e],n=i;this._totalPower=0,this.nextTile.text="下级("+n.name+")",this.nextTile.textColor=ItemConfig.getQualityColor(n),this.attr7.text=""+n.name,this.attr7.textColor=this.nextTile.textColor;var o=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_EQUIP,i.id);o?(this.attr9.text="(拥有×"+o.count+")",this.attr9.textColor=65280,this.needCount=o.count):this.attr9.textColor=16711680;var a=1;this.nextAttr1.visible=!1,this.nextAttr2.visible=!1,this.nextAttr3.visible=!1,this.nextAttr4.visible=!1;var r=s,h=[];if(this.score.visible=!1,t.att){for(var l in AttributeData.translate)if(r[l]&&!(r[l]<=0)){var c=new AttributeData(AttributeData.translate[l],r[l]);for(var u in t.att)if(t.att[u].type==c.type){c.value+=t.att[u].value;break}var p="";p=AttributeData.getAttStrByType(c,0,"  "),h.push(c),this["nextAttr"+a].text=p,this["nextAttr"+a].visible=!0,a++}this._bottomY=this["nextAttr"+(a-1)].y+this["nextAttr"+(a-1)].height}else{for(var l in AttributeData.translate)if(r[l]&&!(r[l]<=0)){var c=new AttributeData(AttributeData.translate[l],r[l]),p="";p=AttributeData.getAttStrByType(c,0,"  "),h.push(c),this["nextAttr"+a].text=p,this["nextAttr"+a].visible=!0,a++}this._bottomY=this["nextAttr"+(a-1)].y+this["nextAttr"+(a-1)].height}if(r.baseAttr1){var d=new AttributeData(r.baseAttr1.type,r.baseAttr1.value);h.push(d)}if(r.baseAttr2){var d=new AttributeData(r.baseAttr2.type,r.baseAttr2.value);h.push(d)}for(this._equipPower=Math.floor(UserBag.getAttrPower(h)),this._totalPower+=this._equipPower+(r.exPower||0),this._totalPower*=SubRoles.ins().subRolesLen,this.score.text="评分："+this._totalPower;this.nextForgeGroup.numElements;)this.nextForgeGroup.removeChildAt(0);this.addTips(r,this.nextForgeGroup),this.background.height=this._bottomY+12,this.powerPanel0.setPower(this._totalPower)}},e.prototype.setCurAttrs=function(t){var e=t.itemConfig;this._totalPower=0,this.nameLabel.text=e.name,this.nameLabel.textColor=ItemConfig.getQualityColor(e);var i=ItemConfig.getQuality(e);this.quali.source=i>0?"quali"+i:"",this.itemIcon.setData(e),(t instanceof ItemData||null!=e)&&t&&5==ItemConfig.getType(t.itemConfig)&&(this.levelKey.text=e.zsLevel>0?"转生：":"等级：",this.type.text=Role.getHejiEquipNameByType(ItemConfig.getSubType(e)),this.lv.text=e.zsLevel>0?e.zsLevel+"转":e.level+"级",e.zsLevel>0?this.lv.textColor=UserZs.ins().lv<e.zsLevel?15937822:3532333:this.lv.textColor=Actor.level<(e.level||1)?15937822:3532333);var s=1;this.attr1.visible=!1,this.attr2.visible=!1,this.attr3.visible=!1,this.attr4.visible=!1;var n=GlobalConfig.EquipConfig[t.configID],o=[];if(this.score.visible=!1,t.att){for(var a in AttributeData.translate)if(n[a]&&!(n[a]<=0)){var r=new AttributeData(AttributeData.translate[a],n[a]);for(var h in t.att)if(t.att[h].type==r.type){r.value+=t.att[h].value;break}var l="";l=AttributeData.getAttStrByType(r,0,"  "),o.push(r),this["attr"+s].text=l,this["attr"+s].visible=!0,s++}this._bottomY=this["attr"+(s-1)].y+this["attr"+(s-1)].height}else{for(var a in AttributeData.translate)if(n[a]&&!(n[a]<=0)){var r=new AttributeData(AttributeData.translate[a],n[a]),l="";l=AttributeData.getAttStrByType(r,0,"  "),o.push(r),this["attr"+s].text=l,this["attr"+s].visible=!0,s++}this._bottomY=this["attr"+(s-1)].y+this["attr"+(s-1)].height}if(n.baseAttr1){var c=new AttributeData(n.baseAttr1.type,n.baseAttr1.value);o.push(c)}if(n.baseAttr2){var c=new AttributeData(n.baseAttr2.type,n.baseAttr2.value);o.push(c)}for(this._equipPower=Math.floor(UserBag.getAttrPower(o)),this._totalPower+=this._equipPower+(n.exPower||0),this._totalPower*=SubRoles.ins().subRolesLen,this.score.text="评分："+this._totalPower;this.forgeGroup.numElements;)this.forgeGroup.removeChildAt(0);this.addTips(n,this.forgeGroup),this.background.height=this._bottomY+12,this.powerPanel.setPower(this._totalPower),this.next.y=this._bottomY+12},e.prototype.addTips=function(t,e){var i=new eui.Label,s=new eui.Label;if(t.baseAttr1&&(i.parent||this.createTitle(i,s,e),s.text+=AttributeData.getAttStrByType(t.baseAttr1,1,""),this._bottomY=s.y+s.height),t.baseAttr2&&(i.parent||this.createTitle(i,s,e),s.text+=AttributeData.getAttStrByType(t.baseAttr2,1,""),this._bottomY=s.y+s.height),t.exAttr1&&(i.parent||this.createTitle(i,s,e),s.text+=AttributeData.getExtAttStrByType(t.exAttr1,1,""),this._bottomY=s.y+s.height),t.exAttr2&&(s.text=AttributeData.getExtAttStrByType(t.exAttr2,1,""),this._bottomY=s.y+s.height),this.forgeGroup==e){var n=new eui.Label,o=new eui.Label,a=t.id%10,r=UserSkill.ins().getPunchForge().getPunchLevel(a-1),h=GlobalConfig.PunchEquipConfig[a-1][r];h&&(n.parent||this.createTitle(n,o,e,"注灵属性"),o.text=AttributeData.getAttStr(h.attr,1,1," "),this._bottomY=o.y+o.height)}},e.prototype.createTitle=function(t,e,i,s){t.fontFamily="Arial",t.size=20,t.textColor=8283191,t.bold=!0,t.x=24,t.y=this._bottomY+10+14,i.addChild(t),t.text=s?s:"极品属性",e.fontFamily="Arial",e.size=18,e.lineSpacing=8,e.x=46,e.y=t.y+24,e.textColor=16730612,i.addChild(e)},e}(BaseEuiView);__reflect(HejiEquipTipsWin.prototype,"HejiEquipTipsWin"),ViewManager.ins().reg(HejiEquipTipsWin,LayerManager.UI_Popup);var ItemCurrencyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ItemCurrencySkin",this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1];s=s?s:0,this.addTouchEndEvent(this,this.otherClose),this.setData(i,s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t,e){var i="";switch(t){case MoneyConst.feat:i=e?e+"":"0"}var s=GlobalConfig.MoneyConfig[t];this.nameLabel.text=s.name,this.num.text=i,this.setImgData(t,e),this.description.textFlow=TextFlowMaker.generateTextFlow1(s.describe),this.BG.height=170+this.description.height},e.prototype.setImgData=function(t,e){var i=1;switch(t){case MoneyConst.yuanbao:i=5;break;case MoneyConst.gold:i=0;break;case MoneyConst.soul:case MoneyConst.chip:i=2;break;case MoneyConst.piece:i=2;break;case MoneyConst.godweaponExp:i=2}this.nameLabel.text=RewardData.getCurrencyName(t),this.nameLabel.textColor=ItemBase.QUALITY_COLOR[i],this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(t),this.itemIcon.imgBg.source="quality"+i,this.setCount(e+"")},e.prototype.setCount=function(t){if(t.length>4){var e=Math.floor(Number(t)/1e3);t=e/10+"万"}this.num.text=t},e}(BaseEuiView);__reflect(ItemCurrencyWin.prototype,"ItemCurrencyWin"),ViewManager.ins().reg(ItemCurrencyWin,LayerManager.UI_Popup);var ItemDetailedWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ItemTipsSkin",this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2];this.addTouchEndEvent(this,this.otherClose),this.setData(i,s,n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t,e,i){var s="";if(void 0==i){var n=UserBag.ins().getBagGoodsByTypeAndId(t,e);s=n?n.count+"":"0"}else s=i+"";var o=GlobalConfig.ItemConfig[e];if(this.nameLabel.text=o.name,this.nameLabel.textColor=ItemConfig.getQualityColor(o),this.itemIcon.setData(o),this.lv.text=(o.level||1)+"级",this.num.text=s,this.description.textFlow=TextFlowMaker.generateTextFlow1(o.desc),2==ItemConfig.getType(o)){var a=MiJiSkillConfig.getSkillIDByItem(o.id);this.power.text="评分："+GlobalConfig.MiJiSkillConfig[a].power}else this.power.text="";this.BG.height=170+this.description.height},e}(BaseEuiView);__reflect(ItemDetailedWin.prototype,"ItemDetailedWin"),ViewManager.ins().reg(ItemDetailedWin,LayerManager.UI_Popup);var ItemUseTipsWin=function(t){function e(){var e=t.call(this)||this;return e.maxNum=0,e.oldNum=0,e.bossBoxIdList=[230001,230002,230003],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ItemUseTipsSkin",this.numLabel.restrict="0-9",this.itemIcon.imgJob.visible=!1,this.isTopLevel=!0,this.showNoBtn=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0],this.showNoBtn=t[1],this.goodsId=this._data.configID,this.addTouchEndEvent(this.BG,this.otherClose),this.addTouchEndEvent(this.minBtn,this.onTap),this.addTouchEndEvent(this.maxBtn,this.onTap),this.addTouchEndEvent(this.sub1Btn,this.onTap),this.addTouchEndEvent(this.add1Btn,this.onTap),this.addTouchEndEvent(this.useBtn,this.onTap),this.addTouchEndEvent(this.useBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(UserBag.ins().postUseItemSuccess,this.useSuccess),this.observe(UserBag.ins().postItemChange,this.itemChange),this.observe(UserBag.ins().postItemDel,this.itemChange),this.addChangeEvent(this.numLabel,this.onTxtChange),this.setData(this._data),this.isBossBox=-1!=this.bossBoxIdList.lastIndexOf(this.goodsId),this.itemList.itemRenderer=ItemBase,this.useBtn.visible=!this.showNoBtn,this.useLabel.visible=this.showNoBtn,this.add.visible=ItemConfig.getType(this._data.itemConfig)!=ItemType.TYPE_25},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.BG.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this),this.minBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this),this.maxBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this),this.sub1Btn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this),this.add1Btn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this),this.useBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this),this.numLabel.removeEventListener(egret.Event.CHANGE,this.onTxtChange,this),this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve(),this._data=null},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onTxtChange=function(t){var e=Number(this.numLabel.text);e>this.maxNum?e=this.maxNum:0>=e&&(e=1),this.useNum=e,this.numLabel.text=this.useNum+""},e.prototype.onTap=function(t){switch(t.target){case this.minBtn:this.useNum=1;break;case this.maxBtn:this.useNum=this.maxNum;break;case this.sub1Btn:this.useNum--,this.useNum<=0&&(this.useNum=1);break;case this.add1Btn:this.useNum++,this.useNum>this.maxNum&&(this.useNum=this.maxNum);break;case this.useBtn:Number(this.numLabel.text)<=0&&(this.numLabel.text="1"),this.onUse();break;case this.useBtn0:this.onBack();break;case this.bgClose:ViewManager.ins().close(this)}this.numLabel.text=this.useNum+""},e.prototype.onUse=function(){var t=this._data.itemConfig;if(t.id==GlobalConfig.WingCommonConfig.attrPillId||t.id==GlobalConfig.WingCommonConfig.flyPillId)return Wing.ins().userDans(t.id),void ViewManager.ins().close(this);if(this.checkCanMerge())return this.onMerge(),void ViewManager.ins().close(e);var i=ItemConfig.getType(t);if(i==ItemType.TYPE_2)return ViewManager.ins().open(SkillWin,3),ViewManager.ins().close(this),void UserMiji.ins().postBagUseMiji(t.id);if(i==ItemType.TYPE_10)return this.onUseType10(),void ViewManager.ins().close(e);if(i==ItemType.TYPE_13)return this.onUseType13(),void ViewManager.ins().close(e);if(i==ItemType.TYPE_14)return this.onUseType14(),void ViewManager.ins().close(e);if(i==ItemType.TYPE_20&&!SpecialRing.ins().checkCanUseByItem(t.id))return UserTips.ins().showTips("烈焰精髓的使用数量已达到最大值"),void ViewManager.ins().close(e);if(t.id==ItemConst.LEVELUP_ITEM){var s=Recharge.ins().getRechargeData(0);if(!s.num)return UserTips.ins().showTips("充值任意金额才能开启礼包"),ViewManager.ins().close(e),void RechargeData.checkOpenWin()}if(t.id==GlobalConfig.MijiBaseConfig.lockId)return ViewManager.ins().close(e),void ViewManager.ins().open(MijiLockWin,UserMiji.BAGOPEN);if(i==ItemType.TYPE_9)return ViewManager.ins().close(e),void ViewManager.ins().open(LiLianWin,3);if(this.isBossBox)return ViewManager.ins().close(e),void ViewManager.ins().open(RandBossWin,this.goodsId);if(t.needyuanbao&&Actor.yb<t.needyuanbao)return UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),void ViewManager.ins().close(this);if(i==ItemType.TYPE_8){var n=t.level?t.level:0,o=t.zsLevel?t.zsLevel:0;if(Actor.level>=n&&UserZs.ins().lv>=o);else{var a="";UserZs.ins().lv<o&&(a+=o+"转"),Actor.level<n&&(a+=n+"级"),UserTips.ins().showTips("需要"+a+"后使用")}}return i==ItemType.TYPE_25?(Auction.ins().sendOpenAuBox(t.id),void ViewManager.ins().close(e)):void((UserBag.ins().sendUseItem(this.goodsId,this.useNum)||t.split)&&ViewManager.ins().close(e))},e.prototype.onUseType10=function(){for(var t=this._data.itemConfig,i=200013==t.id?0:1,s=0;s<SubRoles.MAX_ROLES;s++){var n=SubRoles.ins().getSubRoleByIndex(s);if(!n){UserTips.ins().showTips("角色未开启，无法使用");break}var o=SubRoles.ins().getSubRoleByIndex(s).getExRingsData(i);if(0>=o){ViewManager.ins().open(RoleWin,0,s),ViewManager.ins().close(e);break}}},e.prototype.onUseType13=function(){var t=this._data.itemConfig,e=t.useCond;if(300==t.descIndex)return void this.onUseType13_300();if(302==t.descIndex)return void this.onUseType13_302();if(!e)return void UserTips.ins().showTips("错误卷轴的使用类型");var i=UserBoss.ins().worldBossLeftTime[e],s=t.name;return i>0?void UserTips.ins().showTips("无"+s+"挑战次数时,才能使用"):(UserTips.ins().showTips("使用成功,获得"+this.useNum+"次"+s+"挑战次数"),void UserBag.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType13_300=function(){var t=UserFb.ins().fbRings.challengeTime;return t>0?void UserTips.ins().showTips("无挑战次数时,才能使用"):(UserTips.ins().showTips("使用成功,获得"+this.useNum+"次烈焰副本挑战次数"),void UserBag.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType13_302=function(){var t=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;return t>0?void UserTips.ins().showTips("无挑战次数时,才能使用"):(UserTips.ins().showTips("使用成功,获得"+this.useNum+"次神兵副本挑战次数"),void UserBag.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType14=function(){ViewManager.ins().open(RenameWin)},e.prototype.onMerge=function(){var t=this._data.itemConfig,e=t.id,i=this._data.count,s=GlobalConfig.ItemComposeConfig[e];return s.srcCount>i?void UserTips.ins().showTips("数量不足,不能合成"):void UserBag.ins().sendMergeItem(e,i)},e.prototype.onBack=function(){var t=this._data.itemConfig;ItemConfig.getType(t)==ItemType.TYPE_10?UserBag.ins().sendUseItem(this.goodsId,this.useNum):UserBag.ins().sendUseItem(this.goodsId,this.useNum)&&ViewManager.ins().close(e)},e.prototype.useSuccess=function(){var t=UserBag.ins().getBagItemById(this.goodsId);t?(this.setData(t),this.onTxtChange(null)):ViewManager.ins().close(e)},e.prototype.itemChange=function(){var t=UserBag.ins().getBagItemById(this.goodsId);t?(this.setData(t),this.onTxtChange(null)):ViewManager.ins().close(this)},e.prototype.updateState=function(){var t=this._data,e=ItemConfig.getType(t.itemConfig);this.checkCanMerge()?this.currentState="rename":e==ItemType.TYPE_2?this.currentState="2":e==ItemType.TYPE_10?this.currentState="10":e==ItemType.TYPE_12?this.currentState="guildgifts":e==ItemType.TYPE_14?this.currentState="rename":this.currentState="2"},e.prototype.checkCanMerge=function(){var t=this._data,e=t.itemConfig.id;return!!GlobalConfig.ItemComposeConfig[e]},e.prototype.updateBaseInfo=function(t){var e=this._data;t.count=t.count?t.count:1;var i=t.count+"",s=e.itemConfig;this.nameLabel.text=s.name,this.nameLabel.textColor=ItemConfig.getQualityColor(s),this.itemIcon.setData(s),this.lv.text=(s.level||1)+"级",this.num.text=i,this.description.textFlow=TextFlowMaker.generateTextFlow(s.desc)},e.prototype.updateUse=function(){var t=this._data;this.useNum=this._data.count,this.numLabel.text=this.useNum+"",this.oldNum=t.count,this.maxNum=t.count},e.prototype.updateHandlePos=function(){this._data},e.prototype.setData=function(t){this._data=t;var e=this._data.itemConfig;this.updateState(),this.updateBaseInfo(t);var i=ItemConfig.getType(e);i==ItemType.TYPE_2?this.updateType2():i==ItemType.TYPE_10&&this.updateType10(),this.checkCanMerge()?this.useBtn.label="合成":e.needyuanbao&&(this.useBtn.label=e.needyuanbao+"元宝"),this.updateUse(),this.updateHandlePos(),this.updateGuildGift(e)},e.prototype.updateType2=function(){},e.prototype.updateGuildGift=function(t){var e=GlobalConfig.ItemGiftConfig[t.id];e&&(this.itemList.dataProvider=new eui.ArrayCollection(e.awards))},e.prototype.updateType10=function(){var t=this._data.itemConfig,e=0;if(SubRoles.ins().subRolesLen==SubRoles.MAX_ROLES)for(var i=200013==t.id?0:1,s=0;s<SubRoles.MAX_ROLES;s++){var n=SubRoles.ins().getSubRoleByIndex(s);if(n){var o=SubRoles.ins().getSubRoleByIndex(s).getExRingsData(i);o>0&&(e+=1)}}e==SubRoles.MAX_ROLES?(this.useBtn0.horizontalCenter=0,this.useBtn.visible=!1):(this.useBtn0.horizontalCenter=-90,this.useBtn.visible=!0)},e}(BaseEuiView);__reflect(ItemUseTipsWin.prototype,"ItemUseTipsWin"),ViewManager.ins().reg(ItemUseTipsWin,LayerManager.UI_Popup);var RuneTipsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RuneTipsSkin",this.cur_desc=""},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0];this.item_config_id=t[1],this.cur_desc=t[2],this.cur_desc2=t[3],this.addTouchEndEvent(this,this.otherClose),this.addTouchEndEvent(this.userBtn,this.onUser),this.setData(this.item_config_id)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.onUser=function(t){var e=Rune.ins().getRuneMergeByID(this.item_config_id);e&&ViewManager.ins().open(BagWin,3,MergeType.Rune,e.mixId[1],Rune.ins().getMergeIndexByType(e.mixId[1],e.id))},e.prototype.setData=function(t){var e=GlobalConfig.ItemConfig[t];if(e){this.itemIcon.setData(e);var i="",s=e.id%100;0==s?this.cur_desc2||(i=" lv."+s):0!=ItemConfig.getSubType(e)&&(i=" lv."+s),this.nameLabel.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemConfig.getQualityColor(e)+"'>"+e.name+i+"</font>"),this.userBtn.visible=!1,Rune.ins().isOpen()&&Rune.ins().getRuneMergeByID(e.id)&&(this.userBtn.visible=!0);var n=!1;if(1==ItemConfig.getType(e))this.randomAttr.text=e.desc;else{var o=GlobalConfig.RuneBaseConfig[t];o?(n=!0,this.attrName.text=RuneConfigMgr.ins().getcfgAttrData(o),this.attrValue.text=RuneConfigMgr.ins().getcfgAttrData(o,!1),this.attrName.x=this.runeAttr.width/2-(this.attrName.width+this.attrValue.width)/2,this.attrValue.x=this.attrName.x+this.attrName.width,this.attrDes.text=this.cur_desc):(this.randomAttr.visible=!0,this.randomAttr.text=e.desc,this.cur_desc2?this.attrDes.text="通关"+this.cur_desc2+"解锁":this.attrDes.visible=!1)}this.attrName.visible=this.attrValue.visible=n,this.randomAttr.visible=!n}},e}(BaseEuiView);__reflect(RuneTipsWin.prototype,"RuneTipsWin"),ViewManager.ins().reg(RuneTipsWin,LayerManager.UI_Popup);var SmeltEquipItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mc=new MovieClip,this.mc.x=45,this.mc.y=40},e.prototype.dataChanged=function(){if(this.clear(),this.data instanceof ItemData){this.itemConfig=this.data.itemConfig,this.itemIcon.setData(this.itemConfig);var t=ItemConfig.getType(this.itemConfig),e=ItemConfig.getJob(this.itemConfig);if(4==t)this.nameTxt.text=this.itemConfig.name;else{var i=this.itemConfig?ItemConfig.getSubType(this.itemConfig):-1;i==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]?this.nameTxt.text=this.itemConfig.name:this.nameTxt.text=isNaN(this.itemConfig.zsLevel)?"lv."+(this.itemConfig.level||1):this.itemConfig.zsLevel+"转",-1!=UserBag.fitleEquip.indexOf(this.itemConfig.id)&&(this.nameTxt.text="无级别")}this.itemIcon.imgJob.source=(0==t||4==t)&&e&&this.itemIcon.imgJob.visible?"job"+e+"Item":""}},e.prototype.onClick=function(){},e.prototype.playEff=function(){this.data&&(this.mc.playFile(RES_DIR_EFF+"litboom",1),this.addChild(this.mc),this.selectFrame.visible=!1)},e.prototype.clear=function(){t.prototype.clear.call(this),this.itemIcon.imgJob.source=null},e}(ItemBase);__reflect(SmeltEquipItem.prototype,"SmeltEquipItem");var SmeltEquipTotalWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SmeltMainViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastSelect=0,this.equip.open(),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.equip.close(),this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(SmeltEquipTotalWin.prototype,"SmeltEquipTotalWin"),ViewManager.ins().reg(SmeltEquipTotalWin,LayerManager.UI_Popup);var SmeltSelectItem=function(t){function e(){var e=t.call(this)||this;return e.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough},e.skinName="SmeltSeletctItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.dataChanged=function(){if(this.data instanceof ItemData){var t=this.data;if(this.itemConfig=t.itemConfig,this.arrowIcon.visible=!1,!this.itemConfig)return;this.itemIcon.setData(this.itemConfig);var e=ItemConfig.getType(this.itemConfig);4==e?(this.updateWingEquip(),this.lvLabel.text=this.itemConfig.name):0==e?this.lvLabel.text=this.itemConfig.zsLevel?this.itemConfig.zsLevel+"转":"lv."+this.itemConfig.level:this.lvLabel.text="",this.nameLabel.textColor=ItemConfig.getQualityColor(this.itemConfig),this.nameLabel.text=this.itemConfig.name,this.gradeLabel.text="评分："+t.point,this.attrLabel.text=AttributeData.getAttrInfoByItemData(t)}},e.prototype.updateWingEquip=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)for(var i=SubRoles.ins().getSubRoleByIndex(e).wingsData,s=i.equipsLen,n=0;s>n;n++){var o=i.getEquipByIndex(n);if(0!=o.item.configID){if(ItemConfig.getSubType(this.data.itemConfig)==ItemConfig.getSubType(o.item.itemConfig)&&this.data.point>o.item.point)return void(this.arrowIcon.visible=!0)}else if(this.data.itemConfig.subType==n)return void(this.arrowIcon.visible=!0)}},e}(BaseItemRender);__reflect(SmeltSelectItem.prototype,"SmeltSelectItem");var SmeltSelectWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SmeltSelectSkin",this.isTopLevel=!0,this.itemList.itemRenderer=SmeltSelectItem,this.itemScroller.viewport=this.itemList,this.checkList=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.len=t[1],this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);var i=t[0];i.sort(UserBag.ins().sort2),this.itemList.dataProvider=new eui.ArrayCollection(t[0])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.foolChecklist(),this.removeObserve(),UserEquip.ins().postEquipCheckList(this.checkList)},e.prototype.onItemTap=function(t){var e=t.itemRenderer;e.checkBoxs.selected=!e.checkBoxs.selected;var i=this.itemList.selectedItem;if(e.checkBoxs.selected){if(!(this.checkList.length<this.len))return void this.autoClose();if(this.checkList[this.checkList.length]=i,this.checkList.length>=this.len)return void this.autoClose()}else{var s=this.checkList.indexOf(i);if(0>s)return;this.checkList.splice(s,1)}this.setCountLabel(this.checkList.length)},e.prototype.autoClose=function(){UserEquip.ins().postEquipCheckList(this.checkList),ViewManager.ins().close(e)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.sureBtn:UserEquip.ins().postEquipCheckList(this.checkList),ViewManager.ins().close(e)}},e.prototype.setSmeltEquipList=function(t){var e=this;this.checkList=t,this.checkListData(),this.setCountLabel(this.checkList.length),TimerManager.ins().doTimer(60,1,function(){for(var t=0;t<e.checkList.length;t++)for(var i=0;i<e.itemList.numElements;i++){var s=e.itemList.getElementAt(i);if(e.checkList[t]&&s&&e.checkList[t].handle==s.data.handle){e.checkList.length<=e.len&&(s.checkBoxs.selected=!0);break}}},this)},e.prototype.setCountLabel=function(t){this.countLabel.text=t+"/"+this.len},e.prototype.checkListData=function(){for(var t=this.checkList.length,e=t-1;e>=0;e--)null==this.checkList[e]&&this.checkList.splice(e,1)},e.prototype.foolChecklist=function(){for(var t=this.checkList.length,e=0;e<this.len;e++)e>=t&&this.checkList.push(null)},e}(BaseEuiView);__reflect(SmeltSelectWin.prototype,"SmeltSelectWin"),ViewManager.ins().reg(SmeltSelectWin,LayerManager.UI_Main);var BattleCC=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e.battleRanks=[],e.myRank=0,e.myScore=0,e.awardID=0,e._openLeftTime=0,e._openTimer=0,e._enterCD=0,e._enterCDTimer=0,e._changeTime=0,e._changeLittle=0,e.sysId=PackageID.Battle,e.observe(GameLogic.ins().postEnterMap,e.mapChange),e.regNetMsg(1,e.joinResult),e.regNetMsg(2,e.doRank),e.regNetMsg(3,e.doOpen),e.regNetMsg(4,e.doRelive),e.regNetMsg(5,e.getAwardResult),e.regNetMsg(6,e.doAwardInfo),e.regNetMsg(7,e.doMyScore),e.regNetMsg(10,e.doMyRank),e.regNetMsg(11,e.doEnterCD),e.regNetMsg(12,e.doGameOver),e.regNetMsg(13,e.postLittleChange),e.regNetMsg(14,e.postChangeTime),e.regNetMsg(15,e.postKilled),e}return __extends(e,t),e.prototype.mapChange=function(){GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId&&this.enterBattle(),this._isBattle&&GameMap.fubenID!=GlobalConfig.CampBattleConfig.fbId&&this.escBattle(),this.gotoNpc&&GameMap.fbType==UserFb.FB_TYPE_CITY&&(this.gotoNpc=!1,GameMap.myMoveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete),GameMap.moveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE))},e.prototype.findComplete=function(){ViewManager.ins().open(BattleNpcTipWin)},e.ins=function(){return t.ins.call(this)},e.prototype.isBattle=function(){return this._isBattle},e.prototype.joinBattle=function(){this.sendBaseProto(1)},e.prototype.joinResult=function(t){this.camp=t.readShort(),this._leftTime=DateUtils.formatMiniDateTime(t.readInt()),this.postEnterSuccess()},e.prototype.postEnterSuccess=function(){},e.prototype.doRank=function(t){var e=t.readInt();this.battleRanks.length=e;for(var i,s=0;e>s;s++)i=this.battleRanks[s],i||(i=new BattleRankVo,this.battleRanks[s]=i),i.parse(t);this.postRankInfo()},e.prototype.doOpen=function(t){this.isOpen=t.readBoolean(),this._openLeftTime=t.readInt(),this._openTimer=egret.getTimer(),this.postOpenInfo()},e.prototype.doRelive=function(t){UserBoss.ins().reliveTime=t.readInt(),UserBoss.ins().killerHandler=t.readDouble(),ViewManager.ins().close(TargetPlayerBigBloodPanel),UserBoss.ins().reliveTime>0?(UserBoss.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.postOpenInfo=function(){},e.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3},e.prototype.getRankTop=function(t){return void 0===t&&(t=3),this.battleRanks?this.battleRanks.slice(0,t):null},e.prototype.postRankInfo=function(){},e.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)},e.prototype.enterBattle=function(){this._isBattle=!0,ViewManager.ins().isShow(BattleWin)||ViewManager.ins().open(BattleWin),ViewManager.ins().close(BattleNpcTipWin)},e.prototype.escBattle=function(){this._isBattle=!1,ViewManager.ins().close(BattleWin);var t=EntityManager.ins().getEntitysBymasterhHandle(Actor.handle,EntityType.Role);if(t&&t.length>0)for(var e=t.length,i=void 0,s=0;e>s;s++)i=t[s],i&&i.infoModel&&(i.setCharName(i.infoModel.guildAndName),i.updateNameColor())},e.prototype.sendReLive=function(){this.sendBaseProto(4)},e.prototype.getMyAward=function(){this.sendBaseProto(5)},e.prototype.getAwardResult=function(t){t.readBoolean()},e.prototype.doAwardInfo=function(t){this.awardID=t.readInt(),this.postGiftInfo()},e.prototype.postGiftInfo=function(){},e.prototype.doMyScore=function(t){this.myScore=t.readInt();var e,i=t.readInt(),s=t.readString(),n=t.readUnsignedByte();switch(n){case 1:e="成功击杀|C:0x00ff00&T:"+s+"|，积分+|C:0x00ff00&T:"+i+"|";break;case 2:e="助攻击杀|C:0x00ff00&T:"+s+"|，积分+|C:0x00ff00&T:"+i+"|";break;case 3:e="被|C:0x00ff00&T:"+s+"|击杀，积分+|C:0x00ff00&T:"+i+"|";break;case 4:e="获得持续参与奖，积分+|C:0x00ff00&T:"+i+"|";break;case 5:e="杀怪获得积分+|C:0x00ff00&T:"+i+"|"}e&&UserTips.ins().showCenterTips3(e),this.postScoreChange()},e.prototype.doMyRank=function(t){this.myRank=t.readInt(),this.myScore=t.readInt(),this.postScoreChange()},e.prototype.postScoreChange=function(){},e.prototype.doEnterCD=function(t){this._enterCD=t.readInt(),this._enterCDTimer=egret.getTimer()},e.prototype.doGameOver=function(t){ViewManager.ins().open(BattleResultWin)},e.prototype.postLittleChange=function(t){this._changeLittle=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.getChangeLittleTime=function(){return Math.floor((this._changeLittle-GameServer.serverTime)/1e3)},e.prototype.canMove=function(){return this.getChangeLittleTime()<=0},e.prototype.postChangeTime=function(t){this._changeTime=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.postKilled=function(t){return t.readShort()},e.prototype.getChangeTime=function(){return Math.floor((this._changeTime-GameServer.serverTime)/1e3)},e.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)},e.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level>=GlobalConfig.CampBattleConfig.openLevel},e}(BaseSystem);__reflect(BattleCC.prototype,"BattleCC");var GameSystem;!function(t){t.battlecc=BattleCC.ins.bind(BattleCC)}(GameSystem||(GameSystem={}));var BattleAwardTargetItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleTargetItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data[0];this.rank.text=t.integral+"\n积分",this.award.data=t.award[0],this.already.visible=this.data[1]},e}(BaseItemRender);__reflect(BattleAwardTargetItemRender.prototype,"BattleAwardTargetItemRender");
var BattleNpcTipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onGoto),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)},e.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.CampBattleConfig.desc),this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[17].text),this.redPoint.visible=BattleCC.ins().isOpen},e.prototype.onGoto=function(t){if(t.target==this.goTo){if(Actor.level<GlobalConfig.CampBattleConfig.openLevel)return void UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openLevel+"级可参与血战比奇城");if(!BattleCC.ins().isOpen)return void UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openTips);var e=BattleCC.ins().getEnterCD();if(e>0)return void UserTips.ins().showTips(e+"秒后才可进入阵营副本");BattleCC.ins().joinBattle()}else t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(BattleNpcTipWin.prototype,"BattleNpcTipWin"),ViewManager.ins().reg(BattleNpcTipWin,LayerManager.UI_Main);var MergeJsonAnalyzer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mergeJsons=["MergeConfig_json"],e}return __extends(e,t),e.prototype.analyzeData=function(t,e){var i=t.name;if(!this.fileDic[i]&&e)try{var s=JSON.parse(e);if(-1!=this.mergeJsons.indexOf(i))for(var n in s)this.fileDic[n]=s[n];else this.fileDic[i]=s}catch(o){egret.$warn(1017,t.url,e)}},e}(RES.JsonAnalyzer);__reflect(MergeJsonAnalyzer.prototype,"MergeJsonAnalyzer");var BattleRankWin=function(t){function e(){var e=t.call(this)||this;return e._selectedIndex=0,e.skinName="BattleScoreSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._panels=[this.runePanel0,this.decomPanel0],this._panels[this._selectedIndex].open(),this.viewStack.selectedIndex=this._selectedIndex},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.addChangeEvent(this.tab,this.onTabTouch)},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeEventListener(egret.TouchEvent.CHANGE,this.onTabTouch,this.tab)},e.prototype.onTabTouch=function(t){this._panels[this._selectedIndex].close(),this._selectedIndex=t.currentTarget.selectedIndex,this._panels[this._selectedIndex].open(),this.viewStack._selectedIndex=this._selectedIndex},e.prototype.onTap=function(t){t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(BattleRankWin.prototype,"BattleRankWin"),ViewManager.ins().reg(BattleRankWin,LayerManager.UI_Main);var BattleResultItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleResultItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.ranking.text=t.rank+"",this.roleName.text=t.roleName,this.guild.text=t.unionName,this.score.text=t.score+""},e}(BaseItemRender);__reflect(BattleResultItemRender.prototype,"BattleResultItemRender");var BattleResultWin=function(t){function e(){var e=t.call(this)||this;return e._time=5,e.skinName="BattleResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rankList.itemRenderer=BattleResultItemRender,this.myRewarrd.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(BattleCC.ins().postRankInfo,this.updateRank),this.observe(BattleCC.ins().postScoreChange,this.updateMyScore),this.timerGroup.visible=!0,this.info.text=this._time+"",TimerManager.ins().doTimer(1e3,5,this.repeat,this),this.updateMyScore(),this.updateRank()},e.prototype.updateRank=function(){this.rankList.dataProvider=new eui.ArrayCollection(BattleCC.ins().getRankTop(5))},e.prototype.updateMyScore=function(){var t=BattleCC.ins().myRank;this.myScore.text=BattleCC.ins().myScore+"",this.myRanking.text=t+"";var e=Object.keys(GlobalConfig.CampBattlePersonalRankAwardConfig).length,i=GlobalConfig.CampBattlePersonalRankAwardConfig[t>0&&e>=t?t:e];this.myRewarrd.dataProvider=new eui.ArrayCollection(i.award)},e.prototype.repeat=function(){this._time--,this._time>0?this.info.text=this._time+"":this.timerGroup.visible=!1},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:UserFb.ins().sendExitFb(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BattleResultWin.prototype,"BattleResultWin"),ViewManager.ins().reg(BattleResultWin,LayerManager.UI_Main);var BattleRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleRewarrdItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.awards.itemRenderer=ItemBase,this._arrayCollect=new eui.ArrayCollection,this.awards.dataProvider=this._arrayCollect},e.prototype.dataChanged=function(){var t=this.data;this.rank.text="第"+t.rank+"名",this._arrayCollect.source=t.award},e}(BaseItemRender);__reflect(BattleRewardItemRender.prototype,"BattleRewardItemRender");var BattleRewardPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list0.itemRenderer=BattleRewardItemRender;var e=0,i=[];for(var s in GlobalConfig.CampBattlePersonalRankAwardConfig)i[e]=GlobalConfig.CampBattlePersonalRankAwardConfig[s],e++;this.list0.dataProvider=new eui.ArrayCollection(i),this._collect=new eui.ArrayCollection,this.list1.itemRenderer=BattleAwardTargetItemRender,this.list1.dataProvider=this._collect},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BattleCC.ins().postGiftInfo,this.update),this.update()},e.prototype.close=function(){this.removeObserve()},e.prototype.update=function(){var t=Object.keys(GlobalConfig.CampBattlePersonalAwardConfig).length,e=[],i=BattleCC.ins().awardID;e.length=t;for(var s=1;t>=s;s++)e[s-1]=[GlobalConfig.CampBattlePersonalAwardConfig[s],i>=s];this._collect.source=e},e}(BaseEuiView);__reflect(BattleRewardPanel.prototype,"BattleRewardPanel");var BattleScoreRankPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=BattleRankItemRender,this._arrayCllect=new eui.ArrayCollection,this.list.dataProvider=this._arrayCllect},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BattleCC.ins().postRankInfo,this.update),this.observe(BattleCC.ins().postScoreChange,this.updateMyScore),this.update(),this.updateMyScore()},e.prototype.close=function(){this.removeObserve()},e.prototype.update=function(){this._arrayCllect.source=BattleCC.ins().battleRanks},e.prototype.updateMyScore=function(){this.myScore.text=BattleCC.ins().myScore+"",this.myRank.text="我的排名："+BattleCC.ins().myRank},e}(BaseEuiView);__reflect(BattleScoreRankPanel.prototype,"BattleScoreRankPanel");var BattleWin=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e._changeTime=-1,e._littleChangeTime=-1,e.skinName="BattleLittleRankSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.jump.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:查看排行"),this.bigTimeGroup.visible=!1,this.assignPer.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(BattleCC.ins().postRankInfo,this.updateRank),this.observe(BattleCC.ins().postScoreChange,this.updateMyScore),this.observe(BattleCC.ins().postGiftInfo,this.updateGift),this.observe(BattleCC.ins().postEnterSuccess,this.update),this.observe(BattleCC.ins().postChangeTime,this.update),this.observe(BattleCC.ins().postLittleChange,this.update),this.observe(BattleCC.ins().postKilled,this.onKill),this.updateRank(),this.updateGift(),this.updateMyScore(),this.update()},e.prototype.update=function(){TimerManager.ins().remove(this.repeat,this),this._leftTime=BattleCC.ins().getLeftTime();var t;this._leftTime>0?t=!0:this.wholeLeftTime.text="",this._changeTime=BattleCC.ins().getChangeTime(),this._changeTime>0?t=!0:this.assignPer.visible=!1,this._littleChangeTime=BattleCC.ins().getChangeLittleTime(),this._littleChangeTime>0?t=!0:this.bigTimeGroup.visible=!1,t&&(TimerManager.ins().doTimer(1e3,0,this.repeat,this),this.repeat()),this.skillGroup0.visible=!1},e.prototype.onKill=function(t){if(egret.Tween.removeTweens(this.lzlabel0),egret.Tween.removeTweens(this.skillGroup0),!t)return void(this.skillGroup0.visible=!1);this.skillGroup0.visible=!0,this.skillGroup0.alpha=1,this.lzlabel0.scaleX=this.lzlabel0.scaleY=1,this.lzlabel0.text=t+"";var e=this;egret.Tween.get(this.lzlabel0).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(e.skillGroup0).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(e.lzlabel0),egret.Tween.removeTweens(e.skillGroup0),e.skillGroup0.visible=!1})})},e.prototype.repeat=function(){this._leftTime<=0?""!=this.wholeLeftTime.text&&(this.wholeLeftTime.text=""):this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4),this._leftTime--,this._changeTime<=0?this.assignPer.visible&&(this.assignPer.visible=!1):(this.assignPer.visible||(this.assignPer.visible=!0),this.campLeftTime0.text=DateUtils.getFormatBySecond(this._changeTime,DateUtils.TIME_FORMAT_5,4)),this._changeTime--,this._littleChangeTime<=0?this.bigTimeGroup.visible&&(this.bigTimeGroup.visible=!1):(this.countDown.text=Math.floor(this._littleChangeTime)+"",this.bigTimeGroup.visible||(this.bigTimeGroup.visible=!0)),this._littleChangeTime--},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),TimerManager.ins().removeAll(this),this._giftMax=!1,this._canGetGift=!1,egret.Tween.removeTweens(this.lzlabel0),egret.Tween.removeTweens(this.skillGroup0)},e.prototype.updateRank=function(){for(var t,e=BattleCC.ins().getRankTop(),i=e?e.length:0,s=0;3>s;s++)t=i>s?e[s]:null,this["name"+s].text=t?t.roleName:"",this["num"+s].text=t?t.score+"":""},e.prototype.updateMyScore=function(){this.num3.text=BattleCC.ins().myScore+"",this.rank3.text=BattleCC.ins().myRank+"",this.updateGift()},e.prototype.updateGift=function(){if(!this._giftMax){var t=BattleCC.ins().awardID,e=Object.keys(GlobalConfig.CampBattlePersonalAwardConfig).length;if(this._canGetGift=!1,t>=e)this._giftMax=!0,this.giftGroup.visible=!1;else{this.giftGroup.visible=!0;var i=void 0;i=GlobalConfig.CampBattlePersonalAwardConfig[t+1],this._canGetGift=BattleCC.ins().myScore>=i.integral,this.redPoint.visible=this._canGetGift,this.scoreTxt.text="战绩："+BattleCC.ins().myScore;var s=this._canGetGift?65280:16711680;this.scoreTxt2.textFlow=TextFlowMaker.generateTextFlow1("|C:"+s+"&T:"+BattleCC.ins().myScore+"|/"+i.integral)}}},e.prototype.onTap=function(t){switch(t.target){case this.jump:ViewManager.ins().open(BattleRankWin);break;case this.giftBtn:this._canGetGift&&BattleCC.ins().getMyAward()}},e}(BaseEuiView);__reflect(BattleWin.prototype,"BattleWin"),ViewManager.ins().reg(BattleWin,LayerManager.Main_View);var CommonHelpWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="HelpTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.textInfo.textFlow=TextFlowMaker.generateTextFlow(t[0]),this.textInfo.height=this.textInfo.textHeight,this.background.height=this.textInfo.textHeight+60,this.anigroup.y=(StageUtils.ins().getHeight()-this.background.height)/2},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(CommonHelpWin.prototype,"CommonHelpWin"),ViewManager.ins().reg(CommonHelpWin,LayerManager.UI_Popup);var BattleRankVo=function(){function t(){}return t.prototype.parse=function(t){this.rank=t.readShort(),this.camp=t.readShort(),this.roleName=t.readString(),this.unionName=t.readString(),this.score=t.readInt()},t}();__reflect(BattleRankVo.prototype,"BattleRankVo");var PHPAPI=function(){function t(){}return t}();PHPAPI.SVER_URL="http://www.baidu.com/",PHPAPI.GET_LAST_SERVER=PHPAPI.SVER_URL+"api/getlastserver?",PHPAPI.GET_SEVER_LIST=PHPAPI.SVER_URL+"api/getserverlist?",PHPAPI.WAN_BA=PHPAPI.SVER_URL+"login/wanba?",PHPAPI.USER_INFO=PHPAPI.SVER_URL+"payment/userInfo?",PHPAPI.BUY=PHPAPI.SVER_URL+"payment/buy?",__reflect(PHPAPI.prototype,"PHPAPI");var BookState;!function(t){t[t.canOpen=0]="canOpen",t[t.haveOpen=1]="haveOpen",t[t.noOpen=2]="noOpen"}(BookState||(BookState={}));var BooKData=function(){function t(){this.level=-1,this.exp=0,this.number=0}return t.prototype.updateData=function(t){this.level=t.readShort()},t.prototype.getNum=function(t){var e=GlobalConfig.CardConfig[this.id][0].itemId,i=UserBag.ins().getBagGoodsCountById(0,e);if(isNaN(t)){var s=Book.ins().getSuitIdByBookId(this.id);if(!s)return i;var n=Book.jobs.indexOf(s);if(-1==n)return i;for(var o=void 0,a=0;a<SubRoles.ins().subRolesLen;a++){var r=SubRoles.ins().getSubRoleByIndex(a);if(r&&r.job==n+1){o=!0;break}}return o?i:0}if(i)for(var h in GlobalConfig.SuitConfig){var n=Book.jobs.indexOf(Number(h));if(-1!=n&&-1!=GlobalConfig.SuitConfig[h][1].idList.indexOf(this.id))for(var a=0;a<SubRoles.ins().subRolesLen;a++){var r=SubRoles.ins().getSubRoleByIndex(a);if(r&&r.job==t+1)return i}}return 0},t.prototype.getItemId=function(){return GlobalConfig.CardConfig[this.id][0].itemId},t.prototype.canOpen=function(){return this.getNum()>0},t.prototype.getNextLevelCost=function(){if(-1==this.level)return 0;var t=GlobalConfig.CardConfig[this.id][this.level+1];return t?t.cost:0},t.prototype.getState=function(t){return this.level>-1?BookState.haveOpen:this.getNum(t)>0?BookState.canOpen:BookState.noOpen},t}();__reflect(BooKData.prototype,"BooKData");var BookRedPoint=function(t){function e(){var e=t.call(this)||this;return e.canLvlUp=!1,e.registerOpen(Actor.ins().postLevelChange,UserZs.ins().postZsData),e.registerTab(0,Book.ins().postDataChange,UserBag.ins().postItemAdd,GameLogic.ins().postSubRoleChange),e.registerTab(1,Book.ins().postDataChange,UserBag.ins().postItemAdd),e.associated(e.postLvlUp,Book.ins().postDataChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postLvlUp=function(){var t=this.canLvlUp;return this.canLvlUp=Book.ins().getBookUpRed(),t!=this.canLvlUp},e.prototype.getTabRedPoint=function(t){return 0==t?Book.ins().getBookRed():1==t?Book.ins().checkResolveRedPoint():2==t?Book.ins().getBookUpRed():!1},e.prototype.getIsOpen=function(){return LiLian.ins().checkBookOpen()},e}(RedPointBase);__reflect(BookRedPoint.prototype,"BookRedPoint");var GameSystem;!function(t){t.bookRedPoint=BookRedPoint.ins.bind(BookRedPoint)}(GameSystem||(GameSystem={}));var BookAttrWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="tujianzonshuxin",e.isTopLevel=!0,e.pown=BitmapNumber.ins().createNumPic(0,"8",8),e.pown.x=225,e.pown.y=312,e.addChild(e.pown),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),this.addTouchEvent(this.bgClose,this.onTop)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTop=function(){ViewManager.ins().close(e)},e.prototype.update=function(){},e}(BaseEuiView);__reflect(BookAttrWin.prototype,"BookAttrWin"),ViewManager.ins().reg(BookAttrWin,LayerManager.UI_Main);var book=GameSystem.book,BookItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="tujianskinstate",e.tw=egret.Tween.get(e.kejihuo,{loop:!0}),e.tw.to({scaleX:e.kejihuo.scaleX+.3,scaleY:e.kejihuo.scaleY+.3},500).to({scaleX:e.kejihuo.scaleX,scaleY:e.kejihuo.scaleY},500),e}return __extends(e,t),e.prototype.dataChanged=function(){var t,e=this.data,i=Book.ins().getBookById(e),s=GlobalConfig.DecomposeConfig[e],n=i.level>-1?i.level:0,o=GlobalConfig.CardConfig[e][n];for(var a in GlobalConfig.SuitConfig){var r=GlobalConfig.SuitConfig[a][1],h=r.idList.indexOf(e);if(-1!=h){if(t=Book.jobs.indexOf(Number(a)),-1!=t)break;t=void 0}}var l=i.getState(t);this.quality0.source=this.quality1.source=this.quality2.source=this.quality3.source="tujian_"+s.quality+"c",this.quality.source="tujian_"+s.quality+"a",this.quality4.source="tujian_"+s.quality+"b",this.setStar(n);var c=UserBag.getAttrPower(o.attrs);if(c=Book.ins().getBookPowerNum(c,s.id),this.pown?BitmapNumber.ins().changeNum(this.pown,c,"8",8):this.pown=BitmapNumber.ins().createNumPic(c,"8",8),this.pown.x=56,this.pown.y=199,this.pownGP.addChild(this.pown),this.rect.visible=!1,this.weiji.visible=!1,this.manji.visible=!1,this.kejihuo.visible=!1,10==i.level)this.manji.visible=!0,this.redPoint.visible=!1,this.imgBox.source=""+s.imgLight;else switch(l){case BookState.canOpen:this.imgBox.source=""+s.imgLight,this.redPoint.visible=!1,this.rect.visible=!0,this.kejihuo.visible=!0;break;case BookState.haveOpen:this.imgBox.source=""+s.imgLight;var u=i.getNextLevelCost();this.redPoint.visible=u&&Book.ins().score>=u;break;case BookState.noOpen:this.imgBox.source=""+s.imgLight,this.redPoint.visible=!1,this.rect.visible=!0,this.weiji.visible=!0;break;default:this.imgBox.source=""+s.imgLight}this.labelName.text=s.name,this.labelName.textColor=ItemBase.QUALITY_COLOR[s.quality],this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),egret.Tween.removeTweens(this.kejihuo)},e.prototype.setRemoveTween=function(t){t&&egret.Tween.removeTweens(this.kejihuo)},e.prototype.setStar=function(t){for(var e=t;10>e;e++)this["imgStar"+e].visible=!1;for(var e=0;t>e;e++)this["imgStar"+e].visible=!0},e.prototype.getCurrentState=function(){var t="notactive";return t},e}(BaseItemRender);__reflect(BookItem.prototype,"BookItem");var BookListItem=function(t){function e(){var e=t.call(this)||this;return e.isShow=!1,e.skinName="TujiandaanniuSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.label.touchEnabled=!1},e.prototype.destruct=function(){},e.prototype.dataChanged=function(){var t=this.data;this.label.text=""+t.name,this.btnName.source=t.icon,this.idList=t.idList,this.checkRedPoint()},e.prototype.checkRedPoint=function(){for(var t=0,e=this.idList;t<e.length;t++){var i=e[t];if(Book.ins().getBookUpRedByListId(i)||Book.ins().getSuitRedPoint(i))return void(this.redPoint.visible=!0)}this.redPoint.visible=!1},e}(BaseItemRender);__reflect(BookListItem.prototype,"BookListItem");var BookMenuItem=function(t){function e(){var e=t.call(this)||this;return e.isShow=!1,e.skinName="TujianzianniuSkin",e.width=160,e.height=50,e.label.touchEnabled=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.itemData=GlobalConfig.SuitConfig[this.data][1],this.label.text=this.itemData.name,this.checkRedPoint()},e.prototype.checkRedPoint=function(){this.redPoint.visible=Book.ins().getSuitRedPoint(this.data)},e.prototype.show=function(t){this.isShow=t,this.isShow?this.currentState="select":this.currentState="close",this.validateNow(),this.checkRedPoint()},e}(BaseItemRender);__reflect(BookMenuItem.prototype,"BookMenuItem");var BookTipsWin=function(t){function e(){var e=t.call(this)||this;return e._bottomY=0,e._equipPower=0,e._totalPower=0,e.curRole=0,e.curId=0,e.curLevel=0,e.index=0,e.skinName="tujiantips",e.powerPanel.setBgVis(!1),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemIcon.imgJob.visible=!1,this.anigroup.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curId=t[0],this.curLevel=t[1]||0,this.handle=t[2],this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.btnUse,this.onTap),this.setData(this.curId)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.otherClose),this.removeTouchEvent(this.btnUse,this.onTap)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onTap=function(t){var e=t.currentTarget;"使用"==e.label,ViewManager.ins().close(this),ViewManager.ins().open(LiLianWin,3,this.curId)},e.prototype.setData=function(t){var e=Book.ins().getDecomposeConfigByItemId(t),i=GlobalConfig.CardConfig[e.id][this.curLevel];this._confBase=e,this._totalPower=0;var s=GlobalConfig.ItemConfig[i.itemId];s&&(this.nameLabel.text=s.name),this.nameLabel.textColor=ItemBase.QUALITY_COLOR[e.quality],this.lvTxt.text=i.level+"星",this.qualityImg.source="bagSkin_json.quali"+e.quality,this.qualTxt.text=ColorUtil.COLOR_STR[e.quality],s=GlobalConfig.ItemConfig[i.itemId],this.itemIcon.setData(s);var n=1;this.attr1.visible=!1,this.attr2.visible=!1,this.attr3.visible=!1,this.attr4.visible=!1;var o=[],a=!1,r="";for(var h in i.attrs)if(0!=i.attrs[h].type&&0!=i.attrs[h].value)if(i.attrs[h].type==AttributeType.atHpEx||i.attrs[h].type==AttributeType.atAtkEx||i.attrs[h].type==AttributeType.atDamageReduction||i.attrs[h].type==AttributeType.atDefEx||i.attrs[h].type==AttributeType.atResEx){if(!a){r="特殊属性:",r+="所有角色",a=!0;var l=AttributeData.getAttrStrByType(i.attrs[h].type);(i.attrs[h].type==AttributeType.atDefEx||i.attrs[h].type==AttributeType.atResEx)&&(l="防御加成"),r+=l,r+="+"+i.attrs[h].value/100+"%",o.push(i.attrs[h])}}else{var c="";c=AttributeData.getAttStrByType(i.attrs[h],0,"  "),o.push(i.attrs[h]),this["attr"+n].text=c,this["attr"+n].visible=!0,n++}if(i.specialAttr){""==r&&(r="特殊属性:");for(var h in i.specialAttr)0!=i.specialAttr[h].type&&0!=i.specialAttr[h].value&&i.specialAttr&&(a=!0,r+="挂机获得",r+=1==i.specialAttr[h].type?"金币":"经验",r+="+"+i.specialAttr[h].value+"%")}this.specialAttr.text=r,this.specialAttr.visible=a,this._equipPower=Math.floor(UserBag.getAttrPower(o)),this._totalPower+=this._equipPower,this.addTipsEx();var u=3;for(var h in GlobalConfig.SuitConfig)if(-1!=Book.jobs.indexOf(Number(h))&&-1!=GlobalConfig.SuitConfig[h][1].idList.indexOf(i.id)){u=1,this.threeLabel.visible=!1;break}this._totalPower=this._totalPower*u,this.powerPanel.setPower(this._totalPower),this.iconBg.source=e.imgShow||e.imgLight;for(var p=Book.ins().getBookByItemId(this.curId),d=!0,g=0,f=p;g<f.length;g++){var v=f[g];if(v.getState()!=BookState.haveOpen){d=!1;break}}d?(this.btnUse.label="分解",this.tips.source="tjyijihuo"):(this.btnUse.label="使用",this.tips.source="tjweijihuo"),this.btnUse.visible=!!this.handle},e.prototype.addTipsEx=function(){var t,e=Book.ins().getBookByItemId(this.curId)[0];if(e&&(t=e.id),t){var i="";for(var s in GlobalConfig.SuitConfig){var n=GlobalConfig.SuitConfig[s][1];if(-1!=n.idList.indexOf(t)){i=n.name?n.name:"",t=n.id;break}}var o="";for(var a in GlobalConfig.BookListConfig){var n=GlobalConfig.BookListConfig[a];if(-1!=n.idList.indexOf(t)){o=n.name?n.name:"";break}}if(i||o){this.belong.visible=!0;var r=i?i+"·":"";r+=o,this.belong.text=r}else this.belong.visible=!1}},e.prototype.addTips=function(){for(;this.forgeGroup.numElements;)this.forgeGroup.removeChildAt(0);var t=new eui.Label,e=new eui.Label,i=Book.ins().getSuitNum(this.curId),s=GlobalConfig.SuitConfig[this.curId][1].count,n=Math.floor(i/s);if(0!=n){var o=GlobalConfig.SuitConfig[this.curId][n];t.parent||this.createTitle(t,e);var a=Book.ins().getTitleById(this.curId);if(t.text="当前套装系列:"+a+"·"+o.name+"("+Book.ins().getSuitNum(this.curId)+"/"+o.idList.length+")",e.text=AttributeData.getAttStr(o.attrs,1,1,"  "),GlobalConfig.SuitConfig[this.curId][n]){var r=new eui.Label,h=new eui.Label;this._bottomY=e.y+e.height,this.createTitle(r,h);var l=GlobalConfig.SuitConfig[this.curId][n+1];r.text="下级套装系列:"+a+"·"+l.name+"("+l.count+"/"+o.idList.length+")",h.text+=AttributeData.getAttStr(l.attrs,1,1,"  "),this._bottomY=h.y+h.height}else this._bottomY=e.y+e.height}},e.prototype.createTitle=function(t,e){t.fontFamily="Arial",t.size=20,t.textColor=8283191,t.bold=!0,t.x=24,t.y=this._bottomY+10+14,this.forgeGroup.addChild(t),e.fontFamily="Arial",e.size=18,e.lineSpacing=8,e.x=46,e.y=t.y+24,e.textColor=10458221,this.forgeGroup.addChild(e)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Book.ins().getDecomposeConfigByItemId(t[0])?!0:!1},e}(BaseEuiView);__reflect(BookTipsWin.prototype,"BookTipsWin"),ViewManager.ins().reg(BookTipsWin,LayerManager.UI_Popup);var BookUpWin=function(t){function e(){var e=t.call(this)||this;return e.jobName=["战士","法师","道士"],e.skinName="tujianshengxing",e.list.itemRenderer=BookUpItem,e.listOpen.dataProvider=null,e.listOpen.itemRenderer=BookItem,e.isTopLevel=!0,e.smeltEquips=[],e.smeltEquips.length=10,e.dataInfo=new eui.ArrayCollection(e.smeltEquips),e.list.dataProvider=e.dataInfo,e.barbc=new ProgressBarEff,e.barbc.setWidth(450),e.barbc.x=-10,e.barbc.y=-15,e.barGroup.addChild(e.barbc),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.selectData=t[0],this.observe(Book.ins().postDataChange,this.updateView),this.updateView(),this.addTouchEvent(this.btnUp,this.onTap),this.addTouchEvent(this.info,this.onTap),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.close=function(){this.removeTouchEvent(this.btnUp,this.onTap),this.removeTouchEvent(this.info,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.btnUp:var e=Book.ins().getSuitIdByBookId(this.selectData.id);if(!e)return;var i=!1,s=Book.jobs.indexOf(Number(e));if(-1!=s){for(var n=0;n<SubRoles.ins().subRolesLen;n++){var o=SubRoles.ins().getSubRoleByIndex(n);if(o&&o.job==s+1){i=!0;break}}if(!i)return void UserTips.ins().showTips("|C:0xff0000&T:请先开启"+this.jobName[s]+"职业")}var a=GlobalConfig.DecomposeConfig[this.selectData.id],r=a.itemId,h=a.name,l=a.imgLight;if(i){var c=GlobalConfig.CardConfig[this.selectData.id][0];r=c.itemId}if(-1==this.selectData.level){var u=GlobalConfig.ItemConfig[r],p=UserBag.ins().getBagItemById(u.id);p?(Book.ins().sendOpen(this.selectData.id),ViewManager.ins().close(this),ViewManager.ins().open(Activationtongyong,0,h,l,!0,function(){})):UserWarn.ins().setBuyGoodsWarn(u.id,1)}else{var d=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level];d.cost>Book.ins().score?UserTips.ins().showTips("图鉴经验不足"):Book.ins().sendUp(this.selectData.id)}break;case this.info:if(-1==this.selectData.level){var g=Book.ins().getSuitIdByBookId(this.selectData.id);if(!g)return;var f,u=void 0;if(-1==Book.jobs.indexOf(Number(g)))f=GlobalConfig.DecomposeConfig[this.selectData.id],u=GlobalConfig.ItemConfig[f.itemId],UserWarn.ins().setBuyGoodsWarn(u.id,1);else{var v=GlobalConfig.CardConfig[this.selectData.id][0];u=GlobalConfig.ItemConfig[v.itemId],UserWarn.ins().setBuyGoodsWarn(u.id,1)}}else ViewManager.ins().open(BreakDownView,BreakDownView.type_book,ItemType.TYPE_9);break;case this.btnAdd:break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateView=function(){var t=GlobalConfig.DecomposeConfig[this.selectData.id],e=this.selectData.level>-1?this.selectData.level:0,i=GlobalConfig.CardConfig[this.selectData.id][e];this.expBar.value=Book.ins().score,this.listOpen.dataProvider=new eui.ArrayCollection([this.selectData.id]),this.listOpen.validateNow();for(var s=0;s<this.listOpen.numElements;s++){var n=this.listOpen.getElementAt(s);n&&n.setRemoveTween(!0)}var o=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level+1];if(this.labelCur.text=AttributeData.getAttStr(i.attrs,0,1,"："),this.barbc.setMaxValue(o?o.cost:i.cost),this.barbc.setValue(Book.ins().score),this.selectData.level<0){this.currentState="noActive",this.btnUp.label="激活",this.info.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:获取图鉴|");var a=[];for(var s in i.attrs)i.attrs[s].type!=AttributeType.atHpEx&&i.attrs[s].type!=AttributeType.atAtkEx&&i.attrs[s].type!=AttributeType.atDamageReduction&&i.attrs[s].type!=AttributeType.atDefEx&&i.attrs[s].type!=AttributeType.atResEx&&a.push({type:i.attrs[s].type,value:0});this.labelCur.text=AttributeData.getAttStr(a,0,1,"：")}else o?(this.currentState="nomax",this.btnUp.label="升星",this.info.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:获取图鉴经验|")):(this.currentState="max",this.btnUp.label="已满星",this.info.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:获取图鉴经验|"));if(this.selectData.level<0){this.tujian.textColor=ItemBase.QUALITY_COLOR[t.quality];var r=GlobalConfig.ItemConfig[t.itemId];this.tujian.text=r.name+"x1"}if(o){this.expLabel.text=Book.ins().score+"/"+o.cost,this.expBar.maximum=o.cost,this.barbc.setMaxValue(o.cost);var h=[];for(var s in o.attrs)o.attrs[s].type!=AttributeType.atHpEx&&o.attrs[s].type!=AttributeType.atAtkEx&&o.attrs[s].type!=AttributeType.atDamageReduction&&o.attrs[s].type!=AttributeType.atDefEx&&o.attrs[s].type!=AttributeType.atResEx&&(h[s]=o.attrs[s]);this.labelNext.text=AttributeData.getAttStr(h,0,1,"：")}else this.expLabel.text="已满星",this.labelNext.text="已满星",this.barbc.setLbValueText("已满星");this.specialAttrDese(i)},e.prototype.setMaterial=function(){this.arrMat=Book.ins().getUpChipData(this.selectData);new eui.ArrayCollection;this.smeltEquips=[],this.smeltEquips.length=10;for(var t=0;t<this.arrMat.length&&10>t;t++){var e=GlobalConfig.CardConfig[this.arrMat[t]][1],i=new ItemData;i.itemConfig=GlobalConfig.ItemConfig[e.itemId],this.smeltEquips[t]=i}this.dataInfo.replaceAll(this.smeltEquips),this.list.dataProvider=this.dataInfo},e.prototype.specialAttrDese=function(t){if(!t)return void(this.specialAttr.visible=!1);this.specialAttr.visible=!0;var e=!1,i="";for(var s in t.attrs)if(0!=t.attrs[s].type&&0!=t.attrs[s].value&&!e&&(t.attrs[s].type==AttributeType.atHpEx||t.attrs[s].type==AttributeType.atAtkEx||t.attrs[s].type==AttributeType.atDamageReduction||t.attrs[s].type==AttributeType.atDefEx||t.attrs[s].type==AttributeType.atResEx)){i="特殊属性:",e=!0,i+="所有角色";var n=AttributeData.getAttrStrByType(t.attrs[s].type);(t.attrs[s].type==AttributeType.atDefEx||t.attrs[s].type==AttributeType.atResEx)&&(n="防御加成"),i+=n,i+="+"+t.attrs[s].value/100+"%"}if(t.specialAttr){""==i&&(i="特殊属性:");for(var s in t.specialAttr)0!=t.specialAttr[s].type&&0!=t.specialAttr[s].value&&t.specialAttr&&(e=!0,i+="挂机获得",i+=1==t.specialAttr[s].type?"金币":"经验",i+="+"+t.specialAttr[s].value+"%")}this.specialAttr.text=i,this.specialAttr.visible=e},e}(BaseEuiView);__reflect(BookUpWin.prototype,"BookUpWin"),ViewManager.ins().reg(BookUpWin,LayerManager.UI_Popup);var BookWayTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="TuJianSuitTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.suitlist.itemRenderer=BookWayTipsItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.otherClose),this.suitId=t[0],this.updateData()},e.prototype.updateData=function(){this.nameLabel.text=Book.ins().getTitleById(this.suitId)+"套装加成";var t=GlobalConfig.SuitConfig[this.suitId],e=[],i=Book.ins().getSuitNum(this.suitId);for(var s in t){var n=t[s],o={config:n,curNum:i};e.push(o)}this.suitlist.dataProvider=new eui.ArrayCollection(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(BookWayTips.prototype,"BookWayTips"),ViewManager.ins().reg(BookWayTips,LayerManager.UI_Popup);var BookWayTipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TuJianSuitItem",e.init(),e
}return __extends(e,t),e.prototype.init=function(){},e.prototype.destruct=function(){},e.prototype.dataChanged=function(){var t=this.data.config;this.jieduan.text=t.level+"阶",this.num.text=t.count+"",this.suitNum.text=this.data.curNum+"/"+t.count;for(var e=0;e<t.attrs.length;e++){var i=AttributeData.getAttrStrByType(t.attrs[e].type);this["value"+e].text=i+"+"+t.attrs[e].value,this.data.curNum>=t.count&&(this["value"+e].textColor=2149168)}this.data.curNum>=t.count&&(this.suitNum.textColor=2149168)},e}(BaseItemRender);__reflect(BookWayTipsItem.prototype,"BookWayTipsItem");var BookWin=function(t){function e(){var e=t.call(this)||this;return e.name="图鉴",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.listBook.dataProvider=null,this.listMenu.dataProvider=null,this.listBook.itemRenderer=BookItem,this.listMenu.itemRenderer=BookListItem,this.listBook.touchEnabled=!1,this.resolve.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:分解多余图鉴|"),this.chargeEff1=new MovieClip,this.eff.addChild(this.chargeEff1),this.chargeEff1.x=this.eff.x,this.chargeEff1.y=this.eff.y,this.chargeEff1.touchEnabled=!1,this.chargeEff1.scaleY=.5,this.chargeEff1.scaleX=.75,this.greencolor=2149168,this.graycolor=this.attr.textColor,this.itemHeight=150},e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.labelAttr.text="",this.labelSuit.text="",this.listBook.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBookTap,this),this.listMenu.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onMenuTap,this),this.addTouchEvent(this.xiangqing,this.onTap),this.addTouchEvent(this.resolve,this.onTap),this.addTouchEvent(this.getway,this.onTap),this.addTouchEvent(this.leftGroup,this.onTap),this.addTouchEvent(this.rightGroup,this.onTap),this.observe(Book.ins().postDataChange,this.delayItemChange),this.observe(UserBag.ins().postItemDel,this.delayItemChange),this.observe(UserBag.ins().postItemAdd,this.delayItemChange),this.observe(UserBag.ins().postItemChange,this.delayItemChange),this.observe(BookRedPoint.ins().postRedPoint,this.updateRedPoint),this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange),this.initView();var s=e[0]||0,n=null,o=0,a=0;if(s){n=Book.ins().getDecomposeConfigByItemId(s);var r=GlobalConfig.SuitConfig,h=1;for(var l in r)if(r[l][1].idList.indexOf(n.id)>=0){h=+l;break}for(var l in GlobalConfig.BookListConfig)if(GlobalConfig.BookListConfig[l].idList.indexOf(h)>=0){o=GlobalConfig.BookListConfig[l].sort-1,a=GlobalConfig.BookListConfig[l].idList.indexOf(h);break}}TimerManager.ins().doTimer(200,1,function(){t.listMenu.selectedIndex=o;var e=t.listMenu.getVirtualElementAt(o);e&&e.idList&&(t.curId=e.idList[a],t.updateBook(),t.updateAttr())},this),this.preScrollV=0},e.prototype.onChange=function(){this.listMenu.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.listMenu.scrollH>=this.listMenu.contentWidth-this.listMenu.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0),this.updateRedPoint()},e.prototype.onTap=function(t){var e=460,i=0;switch(t.currentTarget){case this.xiangqing:ViewManager.ins().open(BookAttrWin);break;case this.resolve:ViewManager.ins().open(BreakDownView,BreakDownView.type_book,ItemType.TYPE_9);break;case this.getway:ViewManager.ins().open(BookWayTips,this.curId);break;case this.leftGroup:i=this.listMenu.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.listMenu.scrollH=i,this.onChange();break;case this.rightGroup:i=this.listMenu.scrollH+e,i=92*Math.round(i/92),i>this.listMenu.contentWidth-this.listScroller.width&&(i=this.listMenu.contentWidth-this.listScroller.width),this.listMenu.scrollH=i,this.onChange()}},e.prototype.close=function(){this.removeTouchEvent(this.xiangqing,this.onTap),this.removeTouchEvent(this.resolve,this.onTap),this.removeTouchEvent(this.getway,this.onTap),this.removeTouchEvent(this.listMenu,this.onMenuTap),this.removeTouchEvent(this.leftGroup,this.onTap),this.removeTouchEvent(this.rightGroup,this.onTap),this.listBook.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBookTap,this),this.listMenu.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onMenuTap,this),this.listScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.removeObserve()},e.prototype.initView=function(){var t=GlobalConfig.BookListConfig,e=[];for(var i in t)e.push(t[i]);e.sort(function(t,e){return t.sort<e.sort?-1:1});var s=new eui.ArrayCollection(e);this.listMenu.dataProvider=s,this.updateBook(),this.leftGroup.parent.touchEnabled=!1,this.onChange()},e.prototype.playEffect=function(){BookRedPoint.ins().getRedPoint(1)?(this.chargeEff1.parent||this.eff.addChild(this.chargeEff1),this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1)):DisplayUtils.removeFromParent(this.chargeEff1)},e.prototype.delayItemChange=function(){TimerManager.ins().isExists(this.onItemChange,this)||TimerManager.ins().doTimer(60,1,this.onItemChange,this)},e.prototype.onItemChange=function(){this.updateBook();var t=this.listBook.parent;t.scrollV=this.preScrollV},e.prototype.setStartPosition=function(t){var e=this.listBook.parent,i=e.parent;i.stopAnimation();for(var s=0,n=0;n<t.length;n++)if(this.getIsAct(t[n])){n>9&&(s=Math.floor((n+1)/3)*this.itemHeight);break}if(i.height>=this.listBook.contentHeight)s=0;else{var o=this.listBook.contentHeight-41*i.height/30;o=o>0?o:0,s>=o&&(s=o)}e.scrollV=s,this.preScrollV=e.scrollV},e.prototype.updateBook=function(t){if(this.curId){var e=GlobalConfig.SuitConfig[this.curId][1],i=this.listBook.dataProvider;if(i&&i.source==e.idList?i.refresh():this.listBook.dataProvider=new eui.ArrayCollection(e.idList),this.listBook.validateNow(),this.setStartPosition(e.idList),!t){var s=this.listMenu.dataProvider;for(var n in s.source)s.itemUpdated(s.getItemAt(parseInt(n)))}this.updateAttr(),this.playEffect();var o=Book.ins().getBookPowerNumEx();this.power.text=o+""}},e.prototype.onBookTap=function(t){var e=this.listBook.selectedItem,i=Book.ins().getBookById(e);if(e&&i){var s=this.listBook.parent;this.preScrollV=s.scrollV,ViewManager.ins().open(BookUpWin,i)}},e.prototype.updateAttr=function(){var t,e=GlobalConfig.SuitConfig[this.curId][1],i=Book.ins().getSuitLevel(this.curId);i>0?(e=GlobalConfig.SuitConfig[this.curId][i],t=this.greencolor):t=this.graycolor;var s="";for(var n in GlobalConfig.BookListConfig){var o=GlobalConfig.BookListConfig[n];if(-1!=o.idList.indexOf(this.curId)){s=o.nameImg;break}}var a=Book.ins().getSuitNum(this.curId),r=e.idList.length;this.progress.text="（已集齐"+a+"/"+r+"）",this.labelIcon.source=s;for(var h=AttributeData.getAttStr(e.attrs,0,1,":"),l=h.split("\n"),c="集齐套装效果：",u=0;u<l.length;u++)c+=l[u]+"  ";this.attr.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+c),this.expValue.text=Book.ins().score+""},e.prototype.onMenuTap=function(t){var e=t.item;this.curId=e.idList[0],this.updateBook(!0),this.updateAttr()},e.prototype.getIsAct=function(t){var e=Book.ins().getBookById(t),i=e.getState();return i==BookState.canOpen},e.prototype.updateRedPoint=function(){this.leftRed.visible=BookRedPoint.ins().redpoint,this.rightRed.visible=BookRedPoint.ins().redpoint},e}(BaseComponent);__reflect(BookWin.prototype,"BookWin");var BreakDownView=function(t){function e(){var e=t.call(this)||this;return e._addExp=[],e.skinName="BreakDownSkin",e.isTopLevel=!0,e.listData=new eui.ArrayCollection,e.equipList.itemRenderer=BreakDownItemRenderer,e.equipList.dataProvider=e.listData,e.gainList.itemRenderer=GainGoodsItem,e.goList=new eui.ArrayCollection,e.gainList.dataProvider=e.goList,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(UserBag.ins().postItemDel,this.updateData),this.observe(UserBag.ins().postItemCountChange,this.updateData),this.observe(Book.ins().postDataChange,this.showExp),this.addTouchEvent(this,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this._breakType=t[0]||0,this._ext=t[1],this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this,this.onTap),this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.removeObserve()},Object.defineProperty(e,"fitleEquip",{get:function(){if(!e._fitleEquip){e._fitleEquip={};for(var t in GlobalConfig.SpecialEquipsConfig)GlobalConfig.SpecialEquipsConfig[t].style==FitleStyle.fj&&(e._fitleEquip[GlobalConfig.SpecialEquipsConfig[t].id]=GlobalConfig.SpecialEquipsConfig[t])}return e._fitleEquip},enumerable:!0,configurable:!0}),e.prototype.getLegendSource=function(){var t=[];if(4==this._ext)for(var i=UserBag.ins().getBagEquipsByQuality(4),s=0;s<i.length;s++)e.fitleEquip[i[s].configID]||t.push(i[s]);else t=UserBag.ins().getBagEquipsByQuality(5);return t.sort(function(t,e){var i=GlobalConfig.ItemConfig[t.configID],s=GlobalConfig.ItemConfig[e.configID];return i.zsLevel>s.zsLevel?1:i.zsLevel<s.zsLevel?-1:i.level>s.level?1:i.level<s.level?-1:0}),t},e.prototype.getBookSource=function(){var t=UserBag.ins().getBagGoodsByType(this._ext);t.sort(function(t,e){var i=ItemConfig.getQuality(t.itemConfig),s=ItemConfig.getQuality(e.itemConfig);return s>i?-1:i>s?1:t.configID-e.configID});var e=[],i=Book.ins().itemBook,s={};for(var n in i)for(var o=0,a=i[n];o<a.length;o++){var r=a[o];if(r.getState()!=BookState.haveOpen){s[n]=!0;break}}for(var h=0,l=t;h<l.length;h++){var r=l[h];if(!s[r.configID]){var c=new ItemData;c.count=1,c.handle=r.handle,c.configID=r.configID;for(var u=0;u<r.count;u++)e.push(c)}}return e},e.prototype.getLegendGoSource=function(){if(this.itemList)return this.itemList;var t=new GainWay;t[0]="获得神装：寻宝",t[1]=egret.getQualifiedClassName(TreasureHuntWin),t[2]=0;var e=new GainWay;e[0]="获得神装：全民BOSS",e[1]=egret.getQualifiedClassName(BossWin),e[2]=1;var i=new GainWay;i[0]="获得神装：挑战副本",i[1]=egret.getQualifiedClassName(FbWin),i[2]=2;var s=new GainWay;s[0]="获得神装：寻宝",s[1]=egret.getQualifiedClassName(TreasureHuntWin),s[2]=0;var n=[[],[],[],[],[t,e],[s]];return this.itemList=n[this._ext],this.itemList},e.prototype.getBookGoSource=function(){return[]},e.prototype.updateData=function(){var t,i;this._breakType==e.type_legend?(t=this.getLegendSource(),i=this.getLegendGoSource()):this._breakType==e.type_book&&(t=this.getBookSource(),i=this.getBookGoSource()),this.listData.source=t,this.goList.source=i;var s=i.length;this.refushPos(s)},e.prototype.showExp=function(){this._addExp.pop()},e.prototype.refushPos=function(t){this.contrain.height=60*t,this.equipScroller.height=310+60*(3-t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button)switch(t.target.name){case"breakDown":this.onHandler(t.target.parent.data)}}},e.prototype.onHandler=function(t){if(this._breakType==e.type_legend)UserEquip.ins().sendSmeltEquip(1,[t]);else if(this._breakType==e.type_book){var i=Book.ins().getDecomposeConfigByItemId(t.itemConfig.id);Book.ins().sendDecompose([[i.id,t.count]]),this._addExp.push(i.value)}},e.prototype.onGo=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2]),ViewManager.ins().close(this))}},e}(BaseEuiView);BreakDownView.type_legend=1,BreakDownView.type_book=2,__reflect(BreakDownView.prototype,"BreakDownView"),ViewManager.ins().reg(BreakDownView,LayerManager.UI_Popup);var AutoChallengeBoss=function(t){function e(){var e=t.call(this)||this;return e.observe(UserBoss.ins().postWorldBoss,e.checkEnter),e.observe(UserBoss.ins().postBossData,e.delayCheckEnter),e.observe(GameLogic.ins().postEnterMap,function(){0==GameMap.fubenID&&e.checkEnter()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.refBossTimeFun=function(){TimerManager.ins().remove(this.refTimes,this),this.refType=UserBoss.BOSS_SUBTYPE_QMBOSS;var t=UserBoss.ins().worldBossrestoreTime[this.refType];t>UserBoss.ins().worldBossrestoreTime[UserBoss.BOSS_SUBTYPE_SHENYU]&&(this.refType=UserBoss.BOSS_SUBTYPE_SHENYU,t=UserBoss.ins().worldBossrestoreTime[this.refType]);var e=t-egret.getTimer();e>0&&TimerManager.ins().doTimer(e,1,this.refTimes,this)},e.prototype.refTimes=function(){UserBoss.ins().sendWorldBossInfo(this.refType)},e.prototype.delayCheckEnter=function(t){t[0]&&TimerManager.ins().doTimer(1e3,2,this.checkEnter,this)},e.prototype.checkEnter=function(){if(UserBoss.ins().worldInfoList&&0==GameMap.fubenID){var t=[],e=[],i=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_QMBOSS];if(i&&this.autoYewaiBoss&&UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_QMBOSS])for(var s=0,n=i;s<n.length;s++){var o=n[s],a=GlobalConfig.WorldBossConfig[o.id];UserBoss.isCanChallenge(a)&&(a.samsaraLv?t.push(o):e.push(o))}t=t.sort(this.compareFn);for(var r=0;r<t.length;r++){var o=t[r];if(o.canChallenge&&UserBoss.ins().getBossRemindByIndex(o.id))return void this.enterFb(o.id,UserBoss.BOSS_SUBTYPE_QMBOSS)}if(UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_SHENYU]&&this.autoShenyuBoss&&UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_SHENYU]){var h=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_SHENYU].slice();h=h.sort(this.compareFn);for(var r=0;r<h.length;r++){var o=h[r];if(o.canChallenge&&UserBoss.ins().getBossRemindByIndex(o.id))return void this.enterFb(o.id,UserBoss.BOSS_SUBTYPE_SHENYU)}}e=e.sort(this.compareFn);for(var r=0;r<e.length;r++){var o=e[r];if(o.canChallenge&&UserBoss.ins().getBossRemindByIndex(o.id))return void this.enterFb(o.id,UserBoss.BOSS_SUBTYPE_QMBOSS)}}},e.prototype.enterFb=function(t,e){var i=UserBoss.ins().worldBossCd[e]-egret.getTimer();i>0?TimerManager.ins().doTimer(i,1,this.checkEnter,this):(UserBoss.ins().postBossData(!1),UserBoss.ins().sendChallengWorldBoss(t,e))},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],s=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<s.zsLevel?1:i.zsLevel>s.zsLevel?-1:i.level<s.level?1:i.level>s.level?-1:0},e}(BaseSystem);__reflect(AutoChallengeBoss.prototype,"AutoChallengeBoss");var GameSystem;!function(t){t.autoChallengeBoss=AutoChallengeBoss.ins.bind(AutoChallengeBoss)}(GameSystem||(GameSystem={}));var DarkMjBoss=function(t){function e(){var e=t.call(this)||this;return e.isDarkBoss=!1,e.isBossDie=!1,e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType==UserFb.FB_TYPE_DARK_BOSS?e.postEnterGwBoss():e.isDarkBoss&&e.postEscGwBoss(),e.checkIsShowBtn()}),e.observe(GameLogic.ins().postCreateOtherEntity,e.onCreateEntity),e.observe(UserBoss.ins().postRemainTime,e.onDie),e.observe(UserBoss.ins().postWorldBossEndTime,e.onBossDisappear),e.observe(UserBoss.ins().postBaseHideBossInfo,e.onHideBossAppear),e}return __extends(e,t),e.prototype.postEnterGwBoss=function(){this.isDarkBoss=GameMap.fbType==UserFb.FB_TYPE_DARK_BOSS,this.isBossDie=!1,this.showView(!0)},e.prototype.postEscGwBoss=function(){this.isDarkBoss=!1,this.isBossDie=!1,this.showView(!1),ViewManager.ins().close(BossEndView)},e.prototype.showView=function(t){t?(ViewManager.ins().isShow(BossBelongPanel)||ViewManager.ins().open(BossBelongPanel),ViewManager.ins().isShow(BossBloodPanel)||ViewManager.ins().open(BossBloodPanel),ViewManager.ins().isShow(TargetListPanel)||ViewManager.ins().open(TargetListPanel)):(ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetListPanel))},e.prototype.onCreateEntity=function(t){t&&this.isDarkBoss&&(t.type!=EntityType.Monster||t.team!=Team.Monster||t.masterHandle||(UserBoss.ins().monsterID=t.configID,UserBoss.ins().bossHandler=t.handle,this.showView(!0)))},e.prototype.onDie=function(){this.isDarkBoss&&(this.isRoleDie()?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin))},e.prototype.isRoleDie=function(){return UserBoss.ins().reliveTime>0?!0:!1},e.prototype.onBossDisappear=function(){this.isDarkBoss&&(this.showView(!1),this.isBossDie=!0,ViewManager.ins().open(BossEndView))},e.prototype.checkIsShowBtn=function(){this.checkCanShow()&&GameMap.sceneInMain()?ViewManager.ins().isShow(HideBossBtnWin)||ViewManager.ins().open(HideBossBtnWin):ViewManager.ins().close(HideBossBtnWin)},e.prototype.checkCanShow=function(){var t=UserBoss.ins().hideBossData.endTime;return UserBoss.ins().hideBossData.id&&t&&DateUtils.formatMiniDateTime(t)>GameServer.serverTime},e.prototype.onHideBossAppear=function(){var t=this;if(this.checkCanShow())if(this.isDarkBoss){var e=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);if(e&&e.parent){var i=ObjectPool.pop("MovieClip"),s=function(){ViewManager.ins().isShow(HideBossBtnWin)||ViewManager.ins().open(HideBossBtnWin,1),i.removeEventListener(egret.Event.REMOVED_FROM_STAGE,s,t),i.destroy()};i.playFile(RES_DIR_EFF+"luckyboss_dragon_up",1,function(){s()}),i.x=e.x,i.y=e.y,i.addEventListener(egret.Event.REMOVED_FROM_STAGE,s,this),e.parent.addChild(i)}else ViewManager.ins().open(HideBossBtnWin,1)}else ViewManager.ins().open(HideBossBtnWin);else ViewManager.ins().close(HideBossBtnWin)},e.prototype.canMove=function(){return!this.isBossDie},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(DarkMjBoss.prototype,"DarkMjBoss");var GameSystem;!function(t){t.darkMjBoss=DarkMjBoss.ins.bind(DarkMjBoss)}(GameSystem||(GameSystem={}));var GwBoss=function(t){function e(){var e=t.call(this)||this;return e.isGwBoss=!1,e.isGwTopBoss=!1,e.isBossDie=!1,e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON||GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON_TOP?e.postEnterGwBoss():(e.isGwBoss||e.isGwTopBoss)&&e.postEscGwBoss()}),e.observe(GameLogic.ins().postCreateOtherEntity,e.onCreateEntity),e.observe(UserBoss.ins().postRemainTime,e.onDie),e.observe(UserBoss.ins().postWorldBossEndTime,e.onBossDisappear),e}return __extends(e,t),e.prototype.postEnterGwBoss=function(){this.isGwBoss=GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON,this.isGwTopBoss=GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON_TOP,this.isBossDie=!1,this.showView(!0)},e.prototype.postEscGwBoss=function(){this.isGwBoss=!1,this.isGwTopBoss=!1,this.isBossDie=!1,this.showView(!1),ViewManager.ins().close(BossEndView)},e.prototype.showView=function(t){t?(ViewManager.ins().isShow(BossBelongPanel)||ViewManager.ins().open(BossBelongPanel),ViewManager.ins().isShow(BossBloodPanel)||ViewManager.ins().open(BossBloodPanel),ViewManager.ins().isShow(TargetListPanel)||ViewManager.ins().open(TargetListPanel)):(ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetListPanel))},e.prototype.onCreateEntity=function(t){t&&(this.isGwBoss||this.isGwTopBoss)&&(t.type!=EntityType.Monster||t.team!=Team.Monster||t.masterHandle||(UserBoss.ins().monsterID=t.configID,UserBoss.ins().bossHandler=t.handle,this.showView(!0)))},e.prototype.onDie=function(){(this.isGwBoss||this.isGwTopBoss)&&(this.isRoleDie()?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin))},e.prototype.isRoleDie=function(){var t=!1;if(this.isGwTopBoss){var e=EntityManager.ins().getNoDieRole();(!e||e.infoModel.getAtt(AttributeType.atHp)<=0)&&(t=!0)}return UserBoss.ins().reliveTime>0||t?!0:!1},e.prototype.onBossDisappear=function(){(this.isGwBoss||this.isGwTopBoss)&&(this.showView(!1),this.isBossDie=!0,ViewManager.ins().open(BossEndView))},e.prototype.canMove=function(){return!this.isBossDie},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(GwBoss.prototype,"GwBoss");var GameSystem;!function(t){t.gwboss=GwBoss.ins.bind(GwBoss)}(GameSystem||(GameSystem={}));var NewWorldBossData=function(){function t(){this.addAttrNum=0}return t}();__reflect(NewWorldBossData.prototype,"NewWorldBossData");var NewWorldBossRankData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(WorldBossRankItemData);__reflect(NewWorldBossRankData.prototype,"NewWorldBossRankData");var PublicBossInfo=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.hp=t.readShort(),this.people=t.readShort(),this.reliveTime=1e3*t.readInt()+egret.getTimer(),this.challengeing=t.readBoolean()},Object.defineProperty(t.prototype,"isDie",{get:function(){return(this.reliveTime-egret.getTimer())/1e3>0},enumerable:!0,configurable:!0}),t}();__reflect(PublicBossInfo.prototype,"PublicBossInfo");var WorldBossItemData=function(){function t(){this.id=0,this.roleName="",this.guildName="",this.relieveTime=0,this.bossState=0,this.hp=0,this.people=0,this.challengeing=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.roleName=t.readString(),this.guildName=t.readString();var e=t.readInt();this.relieveTime=1e3*e+egret.getTimer(),this.bossState=t.readShort(),this.hp=t.readByte(),this.people=t.readShort(),this.challengeing=t.readByte()},Object.defineProperty(t.prototype,"isDie",{get:function(){return(this.relieveTime-egret.getTimer())/1e3>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canInto",{get:function(){var t=GlobalConfig.WorldBossConfig[this.id],e=t.zsLevel;if("number"==typeof e)return e>0?UserZs.ins().lv>=e:Actor.level>=e;var i=e;return i.length>1?UserZs.ins().lv>=i[0]&&UserZs.ins().lv<=i[1]:void console.log("WorldBossConfig配置错误！ "+i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canChallenge",{get:function(){return!this.isDie&&this.canInto},enumerable:!0,configurable:!0}),t}();__reflect(WorldBossItemData.prototype,"WorldBossItemData");var BossBloodPanel=function(t){function e(){var e=t.call(this)||this;return e._curMonsterID=0,e.curValue=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BossBloodSkin",this.bloodBar.slideDuration=0,this.grayImg.source="bosshp2",this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height),this.grayImg.mask=this.grayImgMask,e.GRAYIMG_WIDTH=this.grayImg.width,this.see.visible=!1,this.hudunbloodBar.value=100,this.hudunbloodBar.maximum=100,this.observe(CityCC.ins().postHudunPoint,this.delayHuDunChange),this.observe(ZsBoss.ins().postHudunPoint,this.delayHuDunChange),this.observe(UserBoss.ins().postShieldPer,this.delayHuDunChange),this.addTouchEvent(this.seeRewardBtn,this.onTap),this.addChangeEvent(this.clearRole,this.autoClearChange),this.addTouchEvent(this.clearBtn,this.onTap),this.addTouchEvent(this.tipBtn0,this.onTap)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.myTxt.text="自己：",this.dropDown.setEnabled(!1),this.hudun.visible=!1,this.tipBtn0.visible=this.checkShowSeeAwardBtn();var i=UserBoss.ins().rank.concat(),s=i.length;if(s){s>10&&(s=10);var n=i.slice(1,s);this.dropDown.setData(n),this.dropDown.setLabel(i[0].name)}else this.dropDown.setData([]),this.dropDown.setLabel("");s=i.length;for(var o=Actor.actorID,a=0;s>a;a++)if(i[a].id==o){this.myTxt.text="自己:"+CommonUtils.overLength(i[a].value);break}this.huDunChange(),this.clearRole.selected=ZsBoss.ins().clearOther,this.checkIsShowFbInfo(),this.showCurRewards();var r=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];r&&(this.updateBaseInfo(),this.guildFBInfo(r))},e.prototype.checkShowSeeAwardBtn=function(){return CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS||DarkMjBoss.ins().isDarkBoss||DevildomSys.ins().isDevildomBattle},e.prototype.updateBaseInfo=function(){if(this._curMonsterID!=UserBoss.ins().monsterID){this._curMonsterID=UserBoss.ins().monsterID;var t,e=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID];GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN&&SkyLevelModel.ins().cruLevel&&(t=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel].layer);var i=t&&GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU?t+"层守将·":"";if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){var s=TextFlowMaker.generateTextFlow1(e.name),n=s[s.length-1].text;this.nameTxt.text=""+i+n+"("+e.level+"级)"}else this.nameTxt.text=""+i+e.name+"("+e.level+"级)";this.head.source="monhead"+e.head+"_png",(GameMap.fbType==UserFb.FB_TYPE_KF_BOSS||GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS)&&(UserBoss.ins().currBossConfigID=UserBoss.ins().monsterID)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.seeRewardBtn,this.onTap),this.clearRole.removeEventListener(egret.Event.CHANGE,this.autoClearChange,this),this.removeTouchEvent(this.clearBtn,this.onTap),this.closeShowInfoPanel(),this.removeObserve(),this._curMonsterID=0,this.grayImgMask&&egret.Tween.removeTweens(this.grayImgMask)},e.prototype.guildFBInfo=function(t){var e=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);e?e.infoModel:null;if(GuildWar.ins().getModel().checkinAppoint(1)){var i=GuildWar.ins().getModel().doorEndtime;this.bloodBar.value=i,this.bloodBar.maximum=120,this.barGroup.y=101,0>=i?this.visible=!1:this.visible=!0,this.bloodBar.labelFunction=function(){return Math.floor(100*i/120)+"%"},this.curValue=Math.floor(this.bloodBar.value/120*100),this.tweenBlood()}else this.myTxt.visible=this.dropDown.visible=UserBoss.ins().publicBossIdDic.lastIndexOf(t.id)>=0,this.bloodBar.value=void 0==UserBoss.ins().hp?t.hp:UserBoss.ins().hp,this.bloodBar.maximum=t.hp,this.barGroup.y=20,this.visible=this.bloodBar.value>0,this.curValue=Math.floor(this.bloodBar.value/t.hp*100),this.tweenBlood()},e.prototype.tweenBlood=function(){var t=this,i=this.curValue*e.GRAYIMG_WIDTH/100,s=this;if(egret.Tween.removeTweens(this.grayImgMask),!(3>i)){var n=egret.Tween.get(this.grayImgMask,{onChange:function(){s.grayImg&&(s.grayImg.mask=t.grayImgMask)}},s);n.to({width:i-3},1e3).call(function(){0>=i&&(s.grayImgMask.width=0,egret.Tween.removeTweens(this.grayImgMask))},s)}},e.prototype.autoClearChange=function(t){ZsBoss.ins().canChange?(ZsBoss.ins().clearOther=this.clearRole.selected,this.clearSelect=this.clearRole.selected,EntityManager.ins().hideOtherEntity(this.clearSelect)):(this.clearRole.selected=this.clearSelect,UserTips.ins().showTips("操作过于频繁，稍后再试"))},e.prototype.delayHuDunChange=function(){TimerManager.ins().isExists(this.huDunChange,this)||TimerManager.ins().doTimer(60,1,this.huDunChange,this)},e.prototype.huDunChange=function(){this.proLab.visible=!0,ZsBoss.ins().isZsBossFb(GameMap.fubenID)||GuildWar.ins().getModel().checkinAppoint(1)?ZsBoss.ins().hudun&&ZsBoss.ins().hudun>0?(this.hudun.visible=!0,this.hudunbloodBar.value=ZsBoss.ins().hudun):this.hudun.visible=!1:CityCC.ins().isCity?(this.proLab.visible=!1,CityCC.ins().hudun&&CityCC.ins().hudun>0?(this.hudun.visible=!0,this.hudunbloodBar.value=CityCC.ins().hudun,this.hudunbloodBar.maximum=CityCC.ins().huDunMax):this.hudun.visible=!1):GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||DarkMjBoss.ins().isDarkBoss?(this.proLab.visible=!1,UserBoss.ins().shieldType?UserBoss.ins().curShield>0&&(this.hudun.visible=!0,TimerManager.ins().isExists(this.setTimeShieldChange,this)||(TimerManager.ins().doTimer(1e3,0,this.setTimeShieldChange,this),this.setTimeShieldChange())):this.setHpShieldChange()):this.hudun.visible=!1},e.prototype.setHpShieldChange=function(){if(UserBoss.ins().curShield&&UserBoss.ins().curShield>0){this.hudun.visible=!0;var t=Math.ceil(UserBoss.ins().curShield/UserBoss.ins().totalShield*100);this.hudunbloodBar.value=t}else this.hudun.visible=!1},e.prototype.setTimeShieldChange=function(){this.hudunbloodBar.value=UserBoss.ins().curShield,this.hudunbloodBar.maximum=UserBoss.ins().totalShield,UserBoss.ins().curShield>0?this.hudun.visible=!0:(TimerManager.ins().remove(this.setTimeShieldChange,this),this.hudun.visible=!1),UserBoss.ins().curShield--},e.prototype.overTime=function(){this.cd.visible=!1,ViewManager.ins().close(ZSBossCDWin)},e.prototype.refushLabel=function(){this.remainM--,this.timeLable.text="复活倒数："+this.remainM+"秒"},e.prototype.onTap=function(t){switch(t.target){case this.tipBtn0:CityCC.ins().isCity?ViewManager.ins().open(CityBossJiangliTipsWin):GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON?ViewManager.ins().open(GuardRewardWin):DevildomSys.ins().isDevildomBattle?ViewManager.ins().open(DevildomBossAwardWin):ViewManager.ins().open(PublicBossJiangliTipWin);break;case this.seeRewardBtn:ViewManager.ins().open(ZsBossRewardShowWin);break;case this.clearBtn:UserBoss.ins().checkWorldBossMoney()?ViewManager.ins().open(ZSBossCDWin,this.autoClear.selected):UserTips.ins().showTips("元宝不足")}},e.prototype.checkIsShowFbInfo=function(){switch(GameMap.fbType){case UserFb.FB_TYPE_TIAOZHAN:case UserFb.FB_TYPE_HUN_SHOU:ViewManager.ins().open(ChallengeInfoPanel)}},e.prototype.closeShowInfoPanel=function(){ViewManager.ins().isShow(ChallengeInfoPanel)&&ViewManager.ins().close(ChallengeInfoPanel)},e.prototype.showCurRewards=function(){if(GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN&&GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU)return void(this.currewards.visible=!1);this.currewards.visible=!0;var t={rewards:[]};if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU){var e=Hungu.ins().hunShouFBPassID>=Object.keys(GlobalConfig.FsFbConfig).length?Hungu.ins().hunShouFBPassID:Hungu.ins().hunShouFBPassID+1,i=GlobalConfig.FsFbConfig[e];t.rewards=i.award}else{var s=SkyLevelModel.ins(),n=GlobalConfig.FbChallengeConfig[s.cruLevel];n&&(t.rewards=n.clearReward)}this.currewards.data=t},e}(BaseEuiView);BossBloodPanel.GRAYIMG_WIDTH=0,__reflect(BossBloodPanel.prototype,"BossBloodPanel"),ViewManager.ins().reg(BossBloodPanel,LayerManager.Game_Main);var BossEndView=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossEndSkin",e}return __extends(e,t),e.prototype.open=function(){this.observe(UserBoss.ins().postWorldBossEndTime,this.worldBossEnd),this.worldBossEnd()},e.prototype.close=function(){TimerManager.ins().removeAll(this)},e.prototype.worldBossEnd=function(){var t=this;this.winnerName.text="最终归属者是："+UserBoss.ins().winner;var e=Math.ceil((UserBoss.ins().worldBossEndTime-egret.getTimer())/1e3);this.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),TimerManager.ins().removeAll(this),TimerManager.ins().doTimer(1e3,e,function(){e--,t.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),0==e&&UserFb.ins().sendExitFb()},this)},e}(BaseEuiView);__reflect(BossEndView.prototype,"BossEndView"),ViewManager.ins().reg(BossEndView,LayerManager.Main_View);var BossItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.dataChanged=function(){var t,e,i="",s="",n=this.data,o=GlobalConfig.WorldBossConfig[n.id];if(this.list.itemRenderer=this.list.itemRenderer||ItemBase,this.config=o,this.list.dataProvider){var a=this.list.dataProvider;a.source=o.showReward.concat()}else this.list.dataProvider=new eui.ArrayCollection(o.showReward.concat());var r=n.isDie;if(this.boxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.infoTxt0.touchEnabled=!0,t=UserBoss.isCanChallenge(o),i=o.samsaraLv>0?o.showName+"开启":o.zsLevel>0?o.zsLevel+"转开启":o.level+"级开启",s=t?"23CA23":"f15a25",this.levelRequire.text=i,this.bar.value=n.hp,this.bar.maximum=100,e=GlobalConfig.MonstersConfig[o.bossId],this.timeTxt.visible=r,this.timeTxt.visible&&(this.updateTime(),TimerManager.ins().doTimer(100,0,this.updateTime,this)),this.challengeBtn.visible=!r,o.type==UserBoss.BOSS_SUBTYPE_QMBOSS?this.challengeBtn.name="publicChallenge":o.type==UserBoss.BOSS_SUBTYPE_SHENYU&&(this.challengeBtn.name="shenyuChallenge"),this.challengeBtn.visible){var h=(UserBoss.ins().cdTime-egret.getTimer())/1e3;n.challengeing&&h>0?(this.challengeBtn.enabled=!1,this.challengeBtn.touchEnabled=!1,this.updateCDTime(),TimerManager.ins().doTimer(100,0,this.updateCDTime,this)):(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,TimerManager.ins().remove(this.updateCDTime,this))
}if(this.barBg.visible=this.bar.visible=!0,e){this.head.source="monhead"+e.head+"_png";var l=void 0;l=o.samsaraLv>0?o.showName:o.zsLevel>0?o.zsLevel+"转":o.level+"级",this.nameTxt0.text=l,this.nameTxt.text=""+e.name}this.needLv.visible=!t,this.challengeBtn.visible=this.challengeBtn.visible&&t},e.prototype.updateCDTime=function(){var t=(UserBoss.ins().cdTime-egret.getTimer())/1e3;this.challengeBtn.label="冷却中（"+t.toFixed(0)+"）",0>=t&&(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,TimerManager.ins().remove(this.updateCDTime,this))},e.prototype.updateTime=function(){var t=this.data,e=t.relieveTime-egret.getTimer();this.timeTxt.text=DateUtils.getFormatBySecond(Math.floor(e/1e3),1)+"后重生",0>=e&&(this.timeTxt.visible=!1,UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_QMBOSS),TimerManager.ins().remove(this.updateTime,this))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.boxBtn:WarnWin.show(this.config.rewardsDesc,null,this,null,null,"sure")}},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),TimerManager.ins().removeAll(this)},e}(BaseItemRender);__reflect(BossItem.prototype,"BossItem");var BossRewardsItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.rewards;this.experience.data=t[0],this.randomRune.data=t[1],this.runeCream.data=t[2];var e=SkyLevelModel.ins(),i=e.getNextOpenLevel();if(i){this.target.data||(this.target.data=i.showIcon);var s=GlobalConfig.FbChallengeConfig[e.cruLevel],n=GlobalConfig.ItemConfig[i.showIcon],o=ItemConfig.getQuality(n),a="层解锁";o==FBChallengePanel.RunType&&(a="层获得"),s.group==i.group?this.leftlabel.text=""+i.layer+a:this.leftlabel.text="再闯"+(i.id-s.id)+a}this.labelGroup.visible=this.target.visible=i&&GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU},e}(BaseItemRender);__reflect(BossRewardsItem.prototype,"BossRewardsItem");var BossTargetInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossTargetSkin",e}return __extends(e,t),e.prototype.refushTargetInfo=function(t){this.model=t.infoModel,this.bloodBar.maximum=this.model.getAtt(AttributeType.atMaxHp),this.bloodBar.value=t.getHP(),this.model.team==Team.My?this.nameLabel.text=Actor.myName:this.nameLabel.text=this.model.name+"",this.head.source="yuanhead"+this.model.job+this.model.sex},e}(BaseView);__reflect(BossTargetInfo.prototype,"BossTargetInfo");var HomeBossGroupItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){},e}(BaseItemRender);__reflect(HomeBossGroupItem.prototype,"HomeBossGroupItem");var HomeBossItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t,e,i="",s="",n=this.data,o=GlobalConfig.WorldBossConfig[n.id];this.list.itemRenderer=ItemBase,this.config=o,this.list.dataProvider=new eui.ArrayCollection(o.showReward);var a=2==n.bossState;this.boxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.infoTxt0.touchEnabled=!0;var r;for(var h in GlobalConfig.BossHomeConfig)if(-1!=GlobalConfig.BossHomeConfig[h].boss.lastIndexOf(n.id)){r=GlobalConfig.BossHomeConfig[h];break}if(UserVip.ins().lv>=r.vip?o.zsLevel>0?(t=UserZs.ins().lv>=o.zsLevel,s=t?"23CA23":"f15a25",i=o.zsLevel+"转开启"):(t=Actor.level>=o.level,s=t?"23CA23":"f15a25",i=o.level+"级开启"):(t=!1,s=t?"23CA23":"f15a25",i="VIP"+r.vip+"开放"),a&&(i="已击杀"),this.levelRequire.text=i,this.bar.value=n.hp,this.bar.maximum=100,e=GlobalConfig.MonstersConfig[o.bossId],this.challengeBtn.visible=!a,this.challengeBtn.name="homeChallenge",this.challengeBtn.visible){var l=(UserBoss.ins().cdTime-egret.getTimer())/1e3;n.challengeing&&l>0?(this.challengeBtn.enabled=!1,this.challengeBtn.touchEnabled=!1,this.updateCDTime(),TimerManager.ins().doTimer(100,0,this.updateCDTime,this)):(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,TimerManager.ins().remove(this.updateCDTime,this))}if(this.barBg.visible=this.bar.visible=!0,e){this.head.source="monhead"+e.head+"_png";var c=o.zsLevel>0?o.zsLevel+"转":o.level+"级";this.nameTxt0.text=c,this.nameTxt.text=""+e.name}this.challengeBtn.visible=this.challengeBtn.visible&&t,this.needLv.visible=!this.challengeBtn.visible},e.prototype.updateCDTime=function(){var t=(UserBoss.ins().cdTime-egret.getTimer())/1e3;this.challengeBtn.label="冷却中（"+t.toFixed(0)+"）",0>=t&&(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,TimerManager.ins().remove(this.updateCDTime,this))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.boxBtn:WarnWin.show(this.config.rewardsDesc,null,this,null,null,"sure")}},e}(BaseItemRender);__reflect(HomeBossItem.prototype,"HomeBossItem");var PersonalBossItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="personalBossItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.MonstersConfig[t.bossId],i="";i=t.monthcard?"元宝月卡":t.specialCard?"至尊":t.privilege?"贵族":t.zsLevel>0?t.zsLevel+"转":t.levelLimit+"级",this.nameTxt.text=e.name+"·"+i;var s=1e3*UserZs.ins().lv+Actor.level,n=UserFb.ins().getFbDataById(this.data.id),o=n.getPlayCount()<=0,a=1e3*this.data.zsLevel+this.data.levelLimit;o?(this.enabled=!1,this.currentState="disabled",this.notOpenImg.visible=!1):(this.enabled=!0,t.monthcard?this.notOpenImg.visible=Recharge.ins().monthDay?!1:!0:t.privilege?this.notOpenImg.visible=2!=Recharge.ins().forevetCard:t.specialCard?this.notOpenImg.visible=Recharge.ins().franchise?!1:!0:this.notOpenImg.visible=a>s)},e}(BaseItemRender);__reflect(PersonalBossItem.prototype,"PersonalBossItem");var PublicBossPanel=function(t){function e(){var e=t.call(this)||this;return e.isStartTime=!1,e.type=0,e.restoreTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=BossItem,this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.setting.touchEnabled=!0,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.vipGroup.touchEnabled=this.tipTxt.touchEnabled=!1,this.tipTxt.textFlow=TextFlowMaker.generateTextFlow("挑战次数不足，首充开启BOSS之家，|C:0xf3311e&T:BOSS不限次数无限刷!|")},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=UserBoss.BOSS_SUBTYPE_QMBOSS,this.observe(UserBoss.ins().postWorldBoss,this.updateList),this.observe(UserBoss.ins().postWorldBoss,this.calljoinPulbicChallenge),this.observe(UserBag.ins().postItemCountChange,this.UseToItem),this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this,this.onTap),this.setData(),this.showBossId=t[0],TimerManager.ins().doTimer(2e3,0,this.getNewInfo,this)},e.prototype.close=function(){this.setting.removeEventListener(egret.TextEvent.LINK,this.onLink,this),egret.Tween.removeTweens(this.vipGroup),this.removeObserve(),TimerManager.ins().removeAll(this),this.isStartTime=!1},e.prototype.getNewInfo=function(){UserBoss.ins().sendWorldBossInfo(this.type)},e.prototype.showTips=function(){var t=UserBoss.ins().worldBossLeftTime[this.type];if(t>0)return!0;var e="",i=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.PUBLICBOSS);if(i)e="确定使用1个<font color='#FFB82A'>野外boss</font>道具进入挑战？\n",WarnWin.show(e,function(){this.isUse=!0,UserBag.ins().sendUseItem(i.configID,1)},this);else{var s=GlobalConfig.VipConfig[UserVip.ins().lv];if(!s)return UserTips.ins().showTips("|C:0xf3311e&T:成为VIP可购买挑战次数|"),!1;if(!s.boss1buy)return UserTips.ins().showTips("|C:0xf3311e&T:VIP等级不足，提升VIP等级可购买挑战次数|"),!1;var n=UserBoss.ins().worldChallengeTime[this.type];if(0>=t&&n>=s.boss1buy)return void UserTips.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战");if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[this.type-1])return UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1;e="确定花费<font color='#FFB82A'>"+GlobalConfig.WorldBossBaseConfig.buyCountPrice[this.type-1]+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+n+"/"+s.boss1buy),WarnWin.show(e,function(){UserBoss.ins().sendBuyChallengeTimes(this.type)},this)}return!1},e.prototype.UseToItem=function(){this.isUse&&(this.isUse=!1,UserBoss.ins().sendWorldBossInfo(this.type))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.buyBtn:if(!this.showTips())return;break;default:if(t.target instanceof eui.Button){var e=t.target.parent.config;switch(t.target.name){case"publicChallenge":if(this.isJoin=!0,this.config=e,this.eId=t.target.parent.data.id,!this.showTips())return;if(!this.joinPulbicChallenge(e))return}ViewManager.ins().close(LimitTaskView)}}},e.prototype.calljoinPulbicChallenge=function(){this.joinPulbicChallenge(this.config)&&ViewManager.ins().close(LimitTaskView)},e.prototype.joinPulbicChallenge=function(t){if(!t)return!1;if(!this.isJoin)return!1;if(this.isJoin=!1,UserFb.ins().checkInFB())return!1;if(t.zsLevel<=UserZs.ins().lv&&t.level<=Actor.level)if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH);else{var e=Math.ceil((UserBoss.ins().worldBossCd[this.type]-egret.getTimer())/1e3);if(e>0)return UserTips.ins().showTips("|C:0xf3311e&T:冷却中，"+e+"秒后可进行挑战|"),!1;UserBoss.ins().sendChallengWorldBoss(this.eId,this.type),ViewManager.ins().close(this)}else UserTips.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");return!0},e.prototype.updateTime=function(){if(void 0!=this.timeTxt){var t=this.restoreTime-egret.getTimer();0>=t?(TimerManager.ins().remove(this.updateTime,this),this.isStartTime=!1,UserBoss.ins().worldBossLeftTime[this.type]>=GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1]&&(this.timeTxt.visible=!1)):this.timeTxt.visible||(this.timeTxt.visible=!0);var e=DateUtils.getFormatBySecond(Math.floor(t/1e3),DateUtils.TIME_FORMAT_12);this.timeTxt.text="（"+e+"恢复）"}},e.prototype.setData=function(){var t=UserBoss.ins().worldBossLeftTime[this.type],e=UserBag.ins().getBagItemById(ItemConst.PUBLICBOSS);if(this.buyBtn.visible=t>0||e?!1:!0,this.showJuan(e),this.challengeCountTxt.text=t+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1],0>=t&&UserVip.ins().lv<=0){this.vipGroup.visible=!0;egret.Tween.get(this.vipGroup,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)}else this.vipGroup.visible=!1,egret.Tween.removeTweens(this.vipGroup);this.isStartTime||(TimerManager.ins().doTimer(1e3,0,this.updateTime,this),this.restoreTime=UserBoss.ins().worldBossrestoreTime[this.type],this.isStartTime=!0,this.updateTime()),this.initList()},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.initList=function(){for(var t=UserBoss.ins().worldInfoList[this.type].slice(),e=[],i=[],s=[],n=[],o=[],a=[],r=1e3*UserZs.ins().lv+Actor.level,h=0;h<t.length;h++){var l=(t[h].relieveTime-egret.getTimer())/1e3>0||t[h].hp<=0,c=UserBoss.ins().getBossRemindByIndex(t[h].id),u=GlobalConfig.WorldBossConfig[t[h].id];if(u){var p=1e3*u.zsLevel+u.level,d=void 0;if(u.samsaraLv){if(d=Actor.samsaraLv>=u.samsaraLv,!SamsaraModel.ins().isOpen())continue}else d=r>=p;d?c?l?s.push(t[h]):i.push(t[h]):l?o.push(t[h]):n.push(t[h]):a.push(t[h])}}i.sort(this.compareFn),s.sort(this.compareFn),n.sort(this.compareFn),o.sort(this.compareFn),a.sort(this.compareFn),e=i.concat(s,n,a,o),this.listData.replaceAll(e),this.refushBarList(e)},e.prototype.updateList=function(){for(var t=0;t<this.listData.length;t++)this.listData.itemUpdated(this.listData.getItemAt(t))},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],s=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<s.zsLevel?1:i.zsLevel>s.zsLevel?-1:i.level<s.level?1:i.level>s.level?-1:0},e.prototype.onTouch=function(){GameGuider.guidance(egret.getQualifiedClassName(ForgeWin),2)},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,this.type)},e.prototype.refushBarList=function(t){if(!this.showBossId)return void(this.bossScroller.viewport.scrollV=0);for(var e=0;e<t.length;e++){var i=GlobalConfig.WorldBossConfig[t[e].id];if(i&&this.showBossId==i.bossId){this.bossScroller.viewport.validateNow(),this.bossScroller.viewport.scrollV=138*e,this.bossScroller.viewport.contentHeight-this.bossScroller.viewport.scrollV<this.bossScroller.viewport.height&&(this.bossScroller.viewport.scrollV=this.bossScroller.viewport.contentHeight-this.bossScroller.height);break}}},e}(BaseView);__reflect(PublicBossPanel.prototype,"PublicBossPanel");var ShenyuBossPanel=function(t){function e(){var e=t.call(this)||this;return e.isStartTime=!1,e.type=0,e.restoreTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=BossItem,this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.setting.touchEnabled=!0,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=UserBoss.BOSS_SUBTYPE_SHENYU,this.observe(UserBoss.ins().postWorldBoss,this.setData),this.observe(UserBoss.ins().postWorldBoss,this.calljoinPulbicChallenge),this.observe(UserBag.ins().postItemCountChange,this.UseToItem),this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this,this.onTap),this.setData(),this.showBossId=t[0]},e.prototype.close=function(){this.setting.removeEventListener(egret.TextEvent.LINK,this.onLink,this),this.removeObserve(),TimerManager.ins().remove(this.updateTime,this),this.isStartTime=!1},e.prototype.showTips=function(){var t=UserBoss.ins().worldBossLeftTime[this.type];return t>0?!0:(UserTips.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战"),!1)},e.prototype.UseToItem=function(){this.isUse&&(this.isUse=!1,UserBoss.ins().sendWorldBossInfo(this.type))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.buyBtn:if(!this.showTips())return;break;default:if(t.target instanceof eui.Button){var e=t.target.parent.config;switch(t.target.name){case"shenyuChallenge":if(this.isJoin=!0,this.config=e,this.eId=t.target.parent.data.id,!this.showTips())return;if(!this.joinPulbicChallenge(e))return}ViewManager.ins().close(LimitTaskView)}}},e.prototype.calljoinPulbicChallenge=function(){this.joinPulbicChallenge(this.config)&&ViewManager.ins().close(LimitTaskView)},e.prototype.joinPulbicChallenge=function(t){if(!t)return!1;if(!this.isJoin)return!1;if(this.isJoin=!1,UserFb.ins().checkInFB())return!1;if(UserBoss.ins().worldBossLeftTime[this.type]<=0)UserTips.ins().showTips("挑战次数不足");else if(t.zsLevel<=UserZs.ins().lv&&t.level<=Actor.level)if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH);else{var e=Math.ceil((UserBoss.ins().worldBossCd[this.type]-egret.getTimer())/1e3);if(e>0)return UserTips.ins().showTips("|C:0xf3311e&T:冷却中，"+e+"秒后可进行挑战|"),!1;UserBoss.ins().sendChallengWorldBoss(this.eId,this.type),ViewManager.ins().close(this)}else UserTips.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");return!0},e.prototype.updateTime=function(){if(void 0!=this.timeTxt){var t=this.restoreTime-egret.getTimer();0>=t?(TimerManager.ins().remove(this.updateTime,this),this.isStartTime=!1,UserBoss.ins().worldBossLeftTime[this.type]>=GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1]?this.timeTxt.visible=!1:UserBoss.ins().sendWorldBossInfo(this.type)):this.timeTxt.visible||(this.timeTxt.visible=!0);var e=DateUtils.getFormatBySecond(Math.floor(t/1e3),DateUtils.TIME_FORMAT_12);this.timeTxt.text="（"+e+"恢复）"}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.setData=function(){var t=UserBoss.ins().worldBossLeftTime[this.type];this.buyBtn.visible=!1;var e=UserBag.ins().getBagItemById(ItemConst.SHENYUBOSS);this.showJuan(e),this.challengeCountTxt.text=t+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1];for(var i=UserBoss.ins().worldInfoList[this.type].slice(),s=[],n=[],o=[],a=[],r=[],h=[],l=1e3*UserZs.ins().lv+Actor.level,c=0;c<i.length;c++){var u=(i[c].relieveTime-egret.getTimer())/1e3>0||i[c].hp<=0,p=UserBoss.ins().getBossRemindByIndex(i[c].id),d=GlobalConfig.WorldBossConfig[i[c].id],g=1e3*d.zsLevel+d.level;l>=g?p?u?o.push(i[c]):n.push(i[c]):u?r.push(i[c]):a.push(i[c]):h.push(i[c])}n.sort(this.compareFn),o.sort(this.compareFn),a.sort(this.compareFn),r.sort(this.compareFn),h.sort(this.compareFn),s=n.concat(o,a,h,r),this.listData.replaceAll(s),this.isStartTime||(TimerManager.ins().doTimer(1e3,0,this.updateTime,this),this.restoreTime=UserBoss.ins().worldBossrestoreTime[this.type],this.isStartTime=!0,this.updateTime()),this.refushBarList(s)},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],s=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<s.zsLevel?1:i.zsLevel>s.zsLevel?-1:i.level<s.level?1:i.level>s.level?-1:0},e.prototype.onTouch=function(){GameGuider.guidance(egret.getQualifiedClassName(ForgeWin),2)},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,this.type)},e.prototype.refushBarList=function(t){if(!this.showBossId)return void(this.bossScroller.viewport.scrollV=0);for(var e=0;e<t.length;e++){var i=GlobalConfig.WorldBossConfig[t[e].id];if(i&&this.showBossId==i.bossId){this.bossScroller.viewport.validateNow(),this.bossScroller.viewport.scrollV=138*e,this.bossScroller.viewport.contentHeight-this.bossScroller.viewport.scrollV<this.bossScroller.viewport.height&&(this.bossScroller.viewport.scrollV=this.bossScroller.viewport.contentHeight-this.bossScroller.height);break}}},e}(BaseView);__reflect(ShenyuBossPanel.prototype,"ShenyuBossPanel");var VipBossItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.itemIndex+1;GlobalConfig.BossHomeConfig[t];this.bg.source="vipbossb"+t}},e}(BaseItemRender);__reflect(VipBossItem.prototype,"VipBossItem");var WildBossJoinItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bg.visible=this.itemIndex%2==0,this.data[3]?this.txt0.text=this.data[0]:this.txt0.text=this.itemIndex+1+"",this.txt1.text=this.data[1],this.txt2.text=this.data[2]},e}(BaseItemRender);__reflect(WildBossJoinItem.prototype,"WildBossJoinItem");var WorldBossItem=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=GlobalConfig.WorldBossConfig[this.data.id];if(t){var e=GlobalConfig.MonstersConfig[t.bossId];TimerManager.ins().remove(this.updateTime,this),this.titleText.text=e.name,2==this.data.bossState||0==this.data.bossState?(this.killImg.visible=!1,this.updateTime(),TimerManager.ins().doTimer(1e3,0,this.updateTime,this)):1==this.data.bossState?(this.timeTxt.text="已刷新",this.killImg.visible=!0):this.killImg.visible=!1}}},e.prototype.updateTime=function(){var t=this.data.relieveTime-egret.getTimer();this.timeTxt.text=""+DateUtils.getFormatBySecond(Math.floor(t/1e3),1),0>=t&&(TimerManager.ins().remove(this.updateTime,this),this.timeTxt.text="")},e.prototype.onRemove=function(t){TimerManager.ins().remove(this.updateTime,this)},e}(BaseItemRender);__reflect(WorldBossItem.prototype,"WorldBossItem");var WorldBossItemMain=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=WorldBossItem,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.onTap=function(t){var e=this.listData.getItemAt(t.itemIndex);this.data.clickCall(e)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.listData.source=e.arr,this.list.selectedIndex=e.selectIndex,e.type==UserBoss.BOSS_SUBTYPE_WORLDBOSS?this.title.source="title_mijingboss":e.type==UserBoss.BOSS_SUBTYPE_DARKBOSS&&(this.title.source="title_anzhimijingboss");var i=!1;UserBoss.ins().worldBossLeftTime[e.type]&&(i=UserBoss.ins().checkWorldBossRedPoint(e.type)),this.redPoint.visible=i},e}(BaseItemRender);__reflect(WorldBossItemMain.prototype,"WorldBossItemMain");var WorldBossMainPanel=function(t){function e(){var e=t.call(this)||this;return e.endTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=WorldBossItemMain,this.dropRewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.touchEnabled=this.bossGroup.touchChildren=!1,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.remindTpis.touchEnabled=!0,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){var t=[],e=UserBoss.BOSS_SUBTYPE_WORLDBOSS,i=UserBoss.ins().worldBossPlayList[e].slice();i.length||(UserBoss.ins().updateBossPlayList(e),i=UserBoss.ins().worldBossPlayList[e].slice()),i.sort(this.sortList),t.push({type:e,arr:i,selectIndex:0,clickCall:this.onClickList.bind(this)}),UserZs.ins().lv>=5&&GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.canSeeDarkBossDay-1&&(e=UserBoss.BOSS_SUBTYPE_DARKBOSS,i=UserBoss.ins().worldBossPlayList[e].slice(),i.length||(UserBoss.ins().updateBossPlayList(e),i=UserBoss.ins().worldBossPlayList[e].slice()),i.sort(this.sortList),t.push({type:e,arr:i,selectIndex:-1,clickCall:this.onClickList.bind(this)})),this.bossImage&&!this.bossImage.parent&&this.bossGroup.addChild(this.bossImage),this.observe(UserBoss.ins().postWorldBoss,this.setWin),this.observe(UserBoss.ins().postWorldBoss,this.joinWorldBoss),this.observe(UserBag.ins().postItemCountChange,this.UseToItem),this.listData.source=t,this.list.scrollV=0,this.list.selectedIndex=0,this.currData=t[0].arr[0],this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.getItemTxt,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.setWin()},e.prototype.sortList=function(t,e){return t.id<e.id?-1:1},e.prototype.onClickMenu=function(t){var e=this.list.dataProvider.getItemAt(t.itemIndex);e.type==UserBoss.BOSS_SUBTYPE_DARKBOSS&&0==e.arr.length&&UserTips.ins().showTips("6转即可开启暗之秘境")},e.prototype.onClickList=function(t){this.currData=t;for(var e=GlobalConfig.WorldBossConfig[this.currData.id],i=0;i<this.listData.length;i++){var s=this.listData.getItemAt(i);e.type==s.type?s.selectIndex=s.arr.indexOf(t):(s.selectIndex=-1,this.listData.itemUpdated(s))}this.setWin()},e.prototype.setWin=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId];t.zsLevel>0?t.zsLevel+"转":t.level+"级";this.nameTxt.text=e.name+"("+t.zslook[0]+"转-"+t.zslook[t.zslook.length-1]+"转)";var i="无";""!=this.currData.roleName&&(i=this.currData.roleName,""!=this.currData.guildName&&(i=i+"("+this.currData.guildName+")")),2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider?this.dropRewardList.dataProvider.source=t.showReward.concat():this.dropRewardList.dataProvider=new eui.ArrayCollection(t.showReward.concat()),this.playerNameTxt.text=i;var s=UserBoss.ins().worldBossLeftTime[t.type],n=t.type==UserBoss.BOSS_SUBTYPE_WORLDBOSS?"秘境BOSS":"暗之秘境BOSS";this.leftText.text=n+"剩余次数:"+s+"次",this.getItemTxt.visible=s>0||t.type==UserBoss.BOSS_SUBTYPE_DARKBOSS?!1:!0,this.endTime=Math.floor((UserBoss.ins().worldBossCd[t.type]-egret.getTimer())/1e3),this.endTime>0?(this.challengeBtn.visible=!1,this.updateTime(),TimerManager.ins().doTimer(100,0,this.updateTime,this),i=DateUtils.getFormatBySecond(this.endTime,5,3),this.leftCDText.text="挑战CD:"+i):this.leftCDText.text="",this.bossImage.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1);for(var o=0;4>o;o++){var a=void 0;switch(o){case 0:a=GlobalConfig.ItemConfig[t.joinReward];break;case 1:a=GlobalConfig.ItemConfig[t.shieldReward];break;case 2:a=GlobalConfig.ItemConfig[t.belongReward];break;case 3:a=GlobalConfig.ItemConfig[t.killReward]}}if(t.type==UserBoss.BOSS_SUBTYPE_WORLDBOSS){var r=UserBag.ins().getBagItemById(ItemConst.WORLDBOSS);this.showJuan(r)}else this.showJuan(null)}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.updateTime=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=Math.floor((UserBoss.ins().worldBossCd[t.type]-egret.getTimer())/1e3);this.leftCDText.text="挑战CD:"+DateUtils.getFormatBySecond(e,5,3),0>=e&&(TimerManager.ins().remove(this.updateTime,this),this.leftCDText.text="",this.challengeBtn.visible=!0)}},e.prototype.showTips=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=UserBoss.ins().worldBossLeftTime[t.type];if(e>0)return!0;if(t.type==UserBoss.BOSS_SUBTYPE_DARKBOSS)return void UserTips.ins().showTips("暗之秘境BOSS挑战次数已用完");var i="",s=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.WORLDBOSS);if(s)i="确定使用1个<font color='#FFB82A'>秘境boss</font>道具进入挑战？\n",WarnWin.show(i,function(){this.isUse=!0,UserBag.ins().sendUseItem(s.configID,1)},this);else{var n=GlobalConfig.VipConfig[UserVip.ins().lv];if(!n)return UserTips.ins().showTips("|C:0xf3311e&T:成为VIP可购买挑战次数|"),!1;if(!n.boss2buy)return UserTips.ins().showTips("|C:0xf3311e&T:VIP等级不足，提升VIP等级可购买挑战次数|"),!1;var o=UserBoss.ins().worldChallengeTime[t.type];if(0>=e&&o>=n.boss2buy)return void UserTips.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战");if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[t.type-1])return UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1;i="确定花费<font color='#FFB82A'>"+GlobalConfig.WorldBossBaseConfig.buyCountPrice[t.type-1]+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+o+"/"+n.boss2buy),WarnWin.show(i,function(){UserBoss.ins().sendBuyChallengeTimes(t.type)},this)}return!1}},e.prototype.UseToItem=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];this.isUse&&(this.isUse=!1,UserBoss.ins().sendWorldBossInfo(t.type))}},e.prototype.joinWorldBoss=function(){if(this.isJoin&&this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];if(this.isJoin=!1,!UserFb.ins().checkInFB()){if(Math.floor((UserBoss.ins().worldBossCd[t.type]-egret.getTimer())/1e3)>0)return void UserTips.ins().showTips("挑战CD中");var e=1e3*UserZs.ins().lv+Actor.level,i=(GlobalConfig.MonstersConfig[t.bossId],1e3*t.zsLevel+t.level);if(i>e){var s=t.zsLevel>0?t.zsLevel+"转":t.level+"级";return void UserTips.ins().showTips("只有"+s+"才可以挑战。")}UserBag.ins().getSurplusCount()<UserBoss.WB_BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin,UserBoss.WB_BAG_ENOUGH):(ViewManager.ins().close(BossWin),UserBoss.ins().sendChallengWorldBoss(this.currData.id,t.type)),ViewManager.ins().close(LimitTaskView)}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(this.isJoin=!0,!this.showTips())return;this.joinWorldBoss();break;case this.getItemTxt:if(!this.showTips())return}},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,UserBoss.BOSS_SUBTYPE_DARKBOSS)},e.prototype.close=function(){this.removeObserve(),this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.removeTouchEvent(this.challengeBtn,this.onTap),this.removeTouchEvent(this.getItemTxt,this.onTap),this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this)},e}(BaseView);__reflect(WorldBossMainPanel.prototype,"WorldBossMainPanel");var UserBoss=function(t){function e(){var e=t.call(this)||this;return e.worldBossLeftTime=[],e.worldChallengeTime=[],e.worldBossCd=[],e.worldBossLastWinner=[],e.worldBossrestoreTime=[],e.worldBossBelongTime=[],e.curShield=0,e.totalShield=0,e.shieldType=0,e.worldInfoList=[],e.worldBossPlayList=[],e.rankList=[],e.monsterID=0,e.hp=0,e.bossHandler=0,e.lastBossID=-1,e.rank=[],e.changeAttr=[],e.challengeCount=0,e.restoreTime=0,e.toDaySoul=0,e.cdTime=0,e.bossRemind=0,e.bossInfo=[],e.isDoingTimer=!1,e.autoClear=[!1,!1,!1],e.ShowTip=!0,e.currBossSubType=0,e.currBossConfigID=0,e.newWorldBossData=new NewWorldBossData,e.hideBossData={id:0,endTime:0,lastId:0},e.worldPrize=0,e._reliveTime=0,e.killerHandler=0,e.winner="",e.bossAlertList=[],e.publicBossIdDic=[],e.weixieList=[],e.canPlayList=[],e.belongName="",e.attHandle=0,e.canClick=!0,e.sysId=PackageID.Boss,e.regNetMsg(10,e.postWorldBoss),e.regNetMsg(11,e.setShieldPer),e.regNetMsg(14,e.doClearCD),e.regNetMsg(16,e.postLottery),e.regNetMsg(17,e.doLotteryRan),e.regNetMsg(18,e.doLotteryResult),e.regNetMsg(20,e.doBossBlood),e.regNetMsg(21,e.postUpdatePerInfo),e.regNetMsg(7,e.doBelongChange),e.regNetMsg(23,e.postAttackList),e.regNetMsg(24,e.doKillNotice),e.regNetMsg(25,e.postRemainTime),e.regNetMsg(26,e.postWorldBossEndTime),e.regNetMsg(27,e.postWorldNotice),e.regNetMsg(28,e.postChallageRank),e.regNetMsg(29,e.doBossChallengeResult),e.regNetMsg(30,e.doBossSetting),e.regNetMsg(31,e.postNewBossResult),e.regNetMsg(32,e.postNewBossInfo),e.regNetMsg(33,e.postNewBossReliveTime),e.regNetMsg(34,e.postNewBossOpen),e.regNetMsg(35,e.postAddAttrNum),e.regNetMsg(36,e.postNewBossRank),e.regNetMsg(37,e.postBossDieNotice),e.regNetMsg(38,e.postBaseHideBossInfo),e.observe(GameLogic.ins().postEnterMap,e.checkShow),e.observe(GameLogic.ins().postHpChange,e.checkOpenBossBlood),e.observe(GameLogic.ins().postRemoveEntity,e.checkRemoveEntity),e.observe(UserZs.ins().postZsLv,e.postUpdateWorldPlayList),e.observe(Actor.ins().postLevelChange,e.postUpdateWorldPlayList),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.init()},e.prototype.checkOpenBossBlood=function(t){var e=t[0],i=t[1],s=e.infoModel.configID;s&&s==this.monsterID&&GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_LABA&&(this.hp=i,i>0?ViewManager.ins().open(BossBloodPanel):ViewManager.ins().close(BossBloodPanel))},e.prototype.postListData=function(){},e.prototype.postHpChange=function(){},e.prototype.postBossData=function(t,e){return void 0===e&&(e=""),[t,e]},e.prototype.sendWorldBossInfo=function(t){var e=this.getBytes(10);e.writeInt(t),this.sendToServer(e)},e.prototype.postWorldBoss=function(t){var i=t.readByte(),s=this.worldInfoList[i]=this.worldInfoList[i]||[];this.worldBossPlayList[i]=[],this.worldBossrestoreTime[i]=[],this.worldBossCd[i]=1e3*t.readShort()+egret.getTimer(),this.worldBossLeftTime[i]=t.readShort();var n=t.readShort();s.length=n;for(var o=0;n>o;o++){var a=s[o]||new WorldBossItemData;a.parser(t),s[o]=a}return this.worldBossrestoreTime[i]=1e3*t.readShort()+egret.getTimer(),this.worldChallengeTime[i]=t.readShort(),this.worldBossBelongTime[i]=t.readShort(),this.updateBossPlayList(i),(i==e.BOSS_SUBTYPE_QMBOSS||i==e.BOSS_SUBTYPE_SHENYU)&&AutoChallengeBoss.ins().refBossTimeFun(),i},e.prototype.updateBossPlayList=function(t){var i=e.ins().worldInfoList[t].slice(),s=this.worldBossPlayList[t];for(var n in i){var o=GlobalConfig.WorldBossConfig[i[n].id];if(o)if(t==e.BOSS_SUBTYPE_QMBOSS)UserZs.ins().lv>=o.zsLevel&&Actor.level>=o.level&&s.push(i[n]);else if(t==e.BOSS_SUBTYPE_WORLDBOSS)-1!=o.zslook.indexOf(UserZs.ins().lv)&&Actor.level>=o.level&&s.push(i[n]);else if(t==e.BOSS_SUBTYPE_HOMEBOSS){var a=void 0;
for(var r in GlobalConfig.BossHomeConfig)if(-1!=GlobalConfig.BossHomeConfig[r].boss.lastIndexOf(i[n].id)){a=GlobalConfig.BossHomeConfig[r];break}a&&UserVip.ins().lv>=a.vip&&UserZs.ins().lv>=o.zsLevel&&Actor.level>=o.level&&s.push(i[n])}else t==e.BOSS_SUBTYPE_SHENYU?UserZs.ins().lv>=o.zsLevel&&Actor.level>=o.level&&s.push(i[n]):t==e.BOSS_SUBTYPE_GODWEAPON||t==e.BOSS_SUBTYPE_GODWEAPON_TOP?i[n].canInto&&s.push(i[n]):t==e.BOSS_SUBTYPE_DARKBOSS&&i[n].canInto&&s.push(i[n])}},e.prototype.postUpdateWorldPlayList=function(){for(var t in this.worldInfoList){var e=+t;this.worldBossPlayList[e]=[],this.updateBossPlayList(e)}},e.prototype.setShieldPer=function(t){this.shieldType=t.readByte(),this.curShield=t.readInt(),this.totalShield=t.readInt();var e=t.readByte(),i=this.curShield==this.totalShield;if(i){var s="";e?(s="BOSS开启护盾，击破护盾开启抽奖获得幸运奖励",UserTips.ins().showSceneTips(s)):(s="BOSS开启护盾，期间BOSS不会减少血量",UserTips.ins().showSceneTips(s))}this.postShieldPer()},e.prototype.postShieldPer=function(){},e.prototype.sendClearCD=function(){GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS?UserFb.ins().sendGuideFbAlive():GameMap.fbType==UserFb.FB_TYPE_CITY?CityCC.ins().sendRevival():GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId?BattleCC.ins().sendReLive():GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId?PaoDianCC.ins().sendReLive():GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS?this.sendNewBossBuyRelive():this.sendToServer(this.getBytes(14))},e.prototype.doClearCD=function(t){UserTips.ins().showTips(t.readByte()?"成功清除挑战CD":"CD已结束，直接参与挑战")},e.prototype.sendChallengWorldBoss=function(t,e){this.currBossSubType=e,this.currBossConfigID=t;var i=this.getBytes(15);i.writeInt(t),this.sendToServer(i)},e.prototype.postLottery=function(t){this.worldPrize=t.readInt(),ViewManager.ins().open(WorldBossJiangLiWin)},e.prototype.sendJoinLottery=function(){this.sendBaseProto(17)},e.prototype.doLotteryRan=function(t){var e=t.readShort();this.postLotteryRan(e)},e.prototype.postLotteryRan=function(t){return t},e.prototype.sendChallengRank=function(t){this.currBossSubType=t;var e=this.getBytes(28);e.writeInt(t),this.sendToServer(e)},e.prototype.doLotteryResult=function(t){var e=t.readString(),i=t.readShort();this.postLotteryResult(e,i)},e.prototype.postLotteryResult=function(t,e){return[t,e]},e.prototype.doBossBlood=function(t){this.monsterID=t.readInt(),this.hp=t.readDouble(),this.hp&&this.monsterID!=this.lastBossID&&GameMap.fbType!=UserFb.FB_TYPE_MATERIAL&&GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN&&GameMap.fbType!=UserFb.FB_TYPE_EXP&&GameMap.fbType!=UserFb.FB_TYPE_GUIDEBOSS&&this.postBossAppear(),this.lastBossID=this.monsterID,this.hp<=0&&(this.lastBossID=-1),this.bossHandler=t.readDouble();var e=(t.readDouble(),t.readShort());this.rank.length=e;for(var i=0;e>i;i++)this.rank[i]=this.rank[i]||new WorldBossRankItemData,this.rank[i].parser(t),this.rank[i].rank=i+1;this.postHpChange(),GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_LABA&&ViewManager.ins().open(BossBloodPanel),(!this.hp||this.hp<=0&&GuildWar.ins().getModel().checkinAppoint(1))&&ViewManager.ins().close(BossBloodPanel)},e.prototype.postBossAppear=function(){return this.monsterID},e.prototype.postBossDisappear=function(t){return this.bossHandler=0,t},e.prototype.postUpdatePerInfo=function(t){return this.worldBossCd[this.currBossSubType]=1e3*t.readShort()+egret.getTimer(),this.worldBossLeftTime[this.currBossSubType]=t.readShort(),[this.worldBossCd,this.worldBossLeftTime]},e.prototype.doBelongChange=function(t){var e=t.readDouble(),i=t.readDouble(),s=t.readString();this.postBelongChange(e,i,s)},e.prototype.postBelongChange=function(t,i,s){if(void 0===i&&(i=0),void 0===s&&(s=""),e.ins().changecanPlayList(t),this.attHandle=t,EntityShowMgr.ins().showHideSomeOne(t),t>0){var n=EntityManager.ins().getMasterList(t),o="";if(!(n&&n[0]&&n[0].infoModel))return;o=n[0].infoModel.name,this.setBelongHPandColor();var a="";if(t>0&&i>0){var r=o,h=r.split("\n");r=h[1]?h[1]:h[0];var l=s;h=l.split("\n"),l=h[1]?h[1]:h[0],l=StringUtils.replaceStr(l,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),a="|C:"+ColorUtil.ROLENAME_COLOR_GREEN+"&T:"+r+"|击败了|C:"+ColorUtil.ROLENAME_COLOR_GREEN+"&T:"+l+"|，成为了新的归属者。",UserTips.ins().showSceneTips(a)}}},e.prototype.postAttackList=function(t){var i=t.readUnsignedInt();this.weixieList=[];for(var s=0;i>s;s++){var n=t.readDouble(),o=EntityManager.ins().getRootMasterHandle(n);e.ins().changeWeiXieList(o)}this.postHasAttackChange(0)},e.prototype.doKillNotice=function(t){var e=t.readString(),i=t.readShort(),s=t.readShort(),n=GlobalConfig.WorldBossKillMsgConfig[s].msg;n=StringUtils.substitute(n,e,i),UserTips.ins().showSceneTips(n)},e.prototype.postRemainTime=function(t){this.reliveTime=t.readShort(),this.killerHandler=t.readDouble(),this.reliveTime>0&&this.clearWorldBossList()},e.prototype.setBelongHPandColor=function(){if(this.attHandle!=Actor.handle){var t=EntityManager.ins().getMasterList(this.attHandle);for(var e in t)t[e]instanceof CharRole&&t[e].setNameTxtColor(ColorUtil.ROLENAME_COLOR_YELLOW)}},e.prototype.postWorldBossEndTime=function(t){this.winner=t.readString();var e=6e4;GwBoss.ins().isGwBoss&&(e=3e4),this.worldBossEndTime=egret.getTimer()+e,this.clearWorldBossList()},e.prototype.postWorldNotice=function(t){var i=t.readByte(),s=t.readInt(),n=Actor.level,o=UserZs.ins().lv;if(i==e.BOSS_SUBTYPE_QMBOSS){var a=e.ins().worldInfoList[i];for(var r in a){var h=GlobalConfig.WorldBossConfig[s];if(a[r].id==s&&this.getBossRemindByIndex(s)&&o>=h.zsLevel&&n>=h.level){var l=GlobalConfig.MonstersConfig[h.bossId];a[r].hp=100,a[r].bossState=1;var c=this.worldBossPlayList[i];for(var u in c)if(c[u]&&c[u].id==s){c[u].hp=100,c[u].bossState=1;break}var p="|C:0xfee900&T:BOSS||C:0xfe4444&T:"+l.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:野外BOSS！|";Chat.ins().postSysChatMsg(new ChatSystemData(3,p)),e.ins().worldBossLeftTime[i]&&this.postBossData(!0,l.name);break}}}else if(i==e.BOSS_SUBTYPE_HOMEBOSS){var h=GlobalConfig.WorldBossConfig[s],l=GlobalConfig.BossHomeConfig[s];if(l&&o>=h.zsLevel&&n>=h.level&&UserVip.ins().lv>=l.vip){var a=e.ins().worldInfoList[i],c=this.worldBossPlayList[i],d=l.boss;for(var r in a)-1!=d.lastIndexOf(a[r].id)&&(a[r].hp=100,a[r].bossState=1);for(var u in c)-1!=d.lastIndexOf(c[u].id)&&(c[u].hp=100,c[u].bossState=1);var p="|C:0xfee900&T:BOSS之家"+s+"层所有BOSS刷新了，这里的BOSS太多了，简直就是打宝天堂|";Chat.ins().postSysChatMsg(new ChatSystemData(3,p)),e.ins().worldBossLeftTime[i]&&this.postBossData(!0,"BOSS之家")}}else if(i==e.BOSS_SUBTYPE_SHENYU){var a=e.ins().worldInfoList[i];for(var r in a){var h=GlobalConfig.WorldBossConfig[s];if(a[r].id==s&&this.getBossRemindByIndex(s)&&o>=h.zsLevel&&n>=h.level){var l=GlobalConfig.MonstersConfig[h.bossId];a[r].hp=100,a[r].bossState=1;var c=this.worldBossPlayList[i];for(var u in c)if(c[u]&&c[u].id==s){c[u].hp=100,c[u].bossState=1;break}var p="|C:0xfee900&T:BOSS||C:0xfe4444&T:"+l.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:神域BOSS！|";Chat.ins().postSysChatMsg(new ChatSystemData(3,p)),e.ins().worldBossLeftTime[i]&&this.postBossData(!0,l.name);break}}}else if(i==e.BOSS_SUBTYPE_GODWEAPON||i==e.BOSS_SUBTYPE_GODWEAPON_TOP){var a=e.ins().worldInfoList[i];for(var r in a){var h=GlobalConfig.WorldBossConfig[s];if(a[r].id==s){var l=GlobalConfig.MonstersConfig[h.bossId];a[r].hp=100,a[r].bossState=1;var c=this.worldBossPlayList[i];for(var u in c)if(c[u]&&c[u].id==s){c[u].hp=100,c[u].bossState=1;break}break}}}else if(i==e.BOSS_SUBTYPE_DARKBOSS){var a=e.ins().worldInfoList[i];for(var r in a){var h=GlobalConfig.WorldBossConfig[s];if(a[r].id==s){var l=GlobalConfig.MonstersConfig[h.bossId];a[r].hp=100,a[r].bossState=1;var c=this.worldBossPlayList[i];for(var u in c)if(c[u]&&c[u].id==s){c[u].hp=100,c[u].bossState=1;break}if(a[r].canInto){var p="|C:0xfee900&T:暗之秘境BOSS||C:0xfe4444&T:"+l.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:秘境BOSS！|";Chat.ins().postSysChatMsg(new ChatSystemData(3,p)),e.ins().worldBossLeftTime[i]&&this.postBossData(!0,l.name)}break}}}},e.prototype.postChallageRank=function(t){for(var e,i=t.readInt(),s=t.readByte(),n=[],o=0;s>o;o++)n[o]=[],e=t.readInt(),n[o][0]=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(e)/1e3,6),n[o][1]=t.readString(),n[o][2]=t.readDouble().toString(),n[o][3]="1";return n.reverse(),[i,n]},e.prototype.doBossChallengeResult=function(t){for(var e=t.readByte(),i=t.readString(),s=t.readByte()||1,n=t.readByte(),o=t.readShort(),a=[],r=0;o>r;r++)a[r]=new RewardData,a[r].parser(t);var h="yuanhead"+s+n;ResultManager.ins().create(GameMap.fbType,!0,a,"",null,[e,i,h])},e.prototype.setBossSetting=function(t){var e=this.bossAlertList.indexOf(t);-1!=e?this.bossAlertList.splice(e,1):this.bossAlertList.push(t)},e.prototype.sendBossSetting=function(){var t=this.bossAlertList?this.bossAlertList.length:0,e=this.getBytes(29);e.writeShort(t);for(var i=0;t>i;i++)e.writeShort(this.bossAlertList[i]);this.sendToServer(e)},e.prototype.doBossSetting=function(t){this.bossAlertList=[];for(var e=t.readShort(),i=0;e>i;i++){var s=t.readShort();this.bossAlertList.push(s)}},e.prototype.checkNewWorldBossOpen=function(){return Actor.level>=GlobalConfig.NewWorldBossBaseConfig.openLv},e.prototype.sendIntoNewBoss=function(){this.sendBaseProto(31)},e.prototype.postNewBossResult=function(t){this.newWorldBossData.isKill=!!t.readByte(),this.newWorldBossData.rank=t.readInt(),this.newWorldBossData.lastKillRoleName=t.readString(),this.newWorldBossData.randomRoleName=t.readString(),this.newWorldBossData.totalTime=t.readInt(),this.newWorldBossData.randomAwards=[];for(var e=t.readShort(),i=0;e>i;i++)this.newWorldBossData.randomAwards[i]=new RewardData,this.newWorldBossData.randomAwards[i].parser(t);ResultManager.ins().create(GameMap.fbType,1)},e.prototype.sendGetNewBossInfo=function(){this.sendBaseProto(32)},e.prototype.postNewBossInfo=function(t){this.newWorldBossData.bossID=t.readInt(),this.newWorldBossData.curHp=t.readDouble()},e.prototype.sendNewBossBuyRelive=function(){this.sendBaseProto(33)},e.prototype.postNewBossReliveTime=function(t){this.reliveTime=t.readShort()},e.prototype.postNewBossOpen=function(t){this.newWorldBossData.isOpen=!!t.readByte(),this.newWorldBossData.startTime=t.readInt(),this.newWorldBossData.startTime&&(this.newWorldBossData.startTime=DateUtils.formatMiniDateTime(this.newWorldBossData.startTime))},e.prototype.postAddAttrNum=function(t){this.newWorldBossData.addAttrNum=t.readShort()},e.prototype.postNewBossRank=function(t){var e=t.readShort();null==this.newWorldBossData.rankList&&(this.newWorldBossData.rankList=[]),this.newWorldBossData.rankList.length=e;for(var i=0;e>i;i++)this.newWorldBossData.rankList[i]=this.newWorldBossData.rankList[i]||new NewWorldBossRankData,this.newWorldBossData.rankList[i].parser(t);this.newWorldBossData.rankList.sort(this.sortNewBossRank)},e.prototype.sortNewBossRank=function(t,e){return t.value>e.value?-1:1},e.prototype.postBossDieNotice=function(t){var i=t.readInt(),s=GlobalConfig.WorldBossConfig[i];if(s)switch(s.type){case e.BOSS_SUBTYPE_WORLDBOSS:case e.BOSS_SUBTYPE_QMBOSS:case e.BOSS_SUBTYPE_DARKBOSS:case e.BOSS_SUBTYPE_GODWEAPON:case e.BOSS_SUBTYPE_GODWEAPON_TOP:var n=GlobalConfig.MonstersConfig[s.bossId];e.ins().postBossData(!1,n.name),this.sendWorldBossInfo(s.type);break;case e.BOSS_SUBTYPE_HOMEBOSS:e.ins().postBossData(!1,"BOSS之家"),this.sendWorldBossInfo(s.type)}},e.prototype.sendBuyChallengeTimes=function(t){var e=this.getBytes(30);e.writeByte(t),this.sendToServer(e)},e.prototype.sendBuyAddAttrNum=function(){this.sendBaseProto(34)},e.prototype.getBossRemindByIndex=function(t){return-1!=this.bossAlertList.indexOf(t)},e.prototype.sendCleanBelong=function(){this.sendBaseProto(35)},e.prototype.sendChallengeHideBoss=function(){this.sendBaseProto(36)},e.prototype.postBaseHideBossInfo=function(t){var e=t.readInt(),i=t.readInt();this.hideBossData.id=e,this.hideBossData.endTime=i},e.prototype.checkWorldBossMoney=function(){return Actor.yb>=this.checkWorldBossNeed()},e.prototype.checkWorldBossNeed=function(){return GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS?GlobalConfig.LeadFubenBaseConfig.BuyRebornCost:GameMap.fbType==UserFb.FB_TYPE_CITY?GlobalConfig.CityBaseConfig.BuyRebornCost:GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS?GlobalConfig.NewWorldBossBaseConfig.clearCdCost:GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId?GlobalConfig.CampBattleConfig.buyRebornCdCost:GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId?GlobalConfig.PassionPointConfig.buyRebornCdCost:GlobalConfig.WorldBossBaseConfig.clearCdCost[this.currBossSubType-1]},e.prototype.checkisAutoRelive=function(){if(this.reliveTime>0){if(this.autoClear[this.currBossSubType]){if(this.checkWorldBossMoney())return this.sendClearCD(),!1;UserTips.ins().showTips("元宝不足，无法立即复活"),this.autoClear[this.currBossSubType]=!1}return!0}return!1},Object.defineProperty(e.prototype,"reliveTime",{get:function(){return this._reliveTime},set:function(t){this._reliveTime!=t&&(this._reliveTime=t,TimerManager.ins().remove(this.timeClock,this),TimerManager.ins().doTimer(1e3,this._reliveTime,this.timeClock,this))},enumerable:!0,configurable:!0}),e.prototype.timeClock=function(){this._reliveTime--,this._reliveTime<=0&&TimerManager.ins().remove(this.timeClock,this)},e.prototype.parser=function(t){this.challengeCount=t.readShort(),this.restoreTime=1e3*t.readShort()+egret.getTimer(),this.toDaySoul=t.readInt(),this.cdTime=1e3*t.readShort()+egret.getTimer(),this.bossRemind=t.readInt(),(!this.hp||this.hp<=0&&GuildWar.ins().getModel().checkinAppoint(1))&&ViewManager.ins().close(BossBloodPanel)},e.prototype.parserBossList=function(t){},e.prototype.parserBoss=function(t){},e.prototype.checkShow=function(){var t=GameMap.fubenID;isNaN(t)||(GameMap.fubenID!=GameMap.lastFbId&&(this.lastBossID=-1,GameMap.lastFbId=GameMap.fubenID),0!=t&&GameMap.fbType!=UserFb.FB_TYPE_GUANQIABOSS?GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS&&GameMap.fubenID==GlobalConfig.NewWorldBossBaseConfig.fbId?ViewManager.ins().open(NewWorldBossUIView):GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS&&40001!=GameMap.fubenID?ViewManager.ins().open(WorldBossUiInfo):GameMap.sceneInMine()?ViewManager.ins().open(MineScenePanel):GameMap.fbType==UserFb.FB_TYPE_LABA&&ViewManager.ins().open(LabaBossUIPanel):(ViewManager.ins().close(MineScenePanel),ViewManager.ins().close(WorldBossUiInfo),ViewManager.ins().close(WorldBossBeKillWin),ViewManager.ins().close(NewWorldBossUIView),ViewManager.ins().close(LabaBossUIPanel)))},e.prototype.checkRelive=function(){if(GwBoss.ins().isRoleDie()){if(this.checkWorldBossMoney())return!0;UserTips.ins().showTips("元宝不足，无法立即复活"),this.autoClear[this.currBossSubType]=!1}return!1},e.prototype.checkRemoveEntity=function(t){var e=t[0],i=t[1],s=i.infoModel;if(s&&s.team!=Team.My&&s.type==EntityType.Role&&s.masterHandle){var n=s.masterHandle;EntityManager.ins().getMasterList(n)||EntityShowMgr.ins().showNearSomeOne()}s&&e==this.bossHandler&&this.postBossDisappear(i)},e.prototype.getRankList=function(t){return this.rankList[t]},e.prototype.init=function(){this.sendWorldBossInfo(e.BOSS_SUBTYPE_WORLDBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_QMBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_HOMEBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_SHENYU),this.sendWorldBossInfo(e.BOSS_SUBTYPE_GODWEAPON),this.sendWorldBossInfo(e.BOSS_SUBTYPE_GODWEAPON_TOP),this.sendWorldBossInfo(e.BOSS_SUBTYPE_DARKBOSS)},e.prototype.changeWeiXieList=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),Actor.handle!=t){var s=this.checkListElements(t,this.weixieList);e?-1==s&&this.weixieList.push(t):-1!=s&&this.weixieList.splice(s,1)}},e.prototype.changecanPlayList=function(t,e){void 0===e&&(e=!0);var i;Actor.handle!=t?0==t?(this.canPlayList=[],this.belongName=""):(this.weixieList=[],this.canPlayList[0]=t,i=EntityManager.ins().getEntityBymasterhHandle(t),i&&(this.belongName=i.infoModel.name)):(this.weixieList=[],this.canPlayList=[],this.belongName=Actor.myName),this.postHasAttackChange(0),this.postCanplayChange()},e.prototype.checkListElements=function(t,e){if(e.length<=0)return-1;for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1},e.prototype.postHasAttackChange=function(t){return t},e.prototype.postCanplayChange=function(){},e.prototype.clearWorldBossList=function(){GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS||GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON||GameMap.fbType==UserFb.FB_TYPE_GOD_WEAPON_TOP||GameMap.fbType==UserFb.FB_TYPE_DARK_BOSS?(this.weixieList=[],this.canPlayList=[],GameLogic.ins().currAttackHandle=0):(e.ins().winner="",UserFb.ins().guideBossKill=0)},e.prototype.checkBossIconShow=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOSS)&&!UserFb.ins().pkGqboss},e.prototype.checkShenyuOpen=function(){return GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.shenyuOpenDay-1},e.prototype.checkWorldBossRedPoint=function(t){var i=this.worldBossPlayList[t];if(!i)return!1;if(t==e.BOSS_SUBTYPE_SHENYU&&!this.checkShenyuOpen())return!1;if(t!=e.BOSS_SUBTYPE_HOMEBOSS&&(!this.worldBossLeftTime||this.worldBossLeftTime.length<0||!this.worldBossLeftTime[t]))return!1;if((t==e.BOSS_SUBTYPE_QMBOSS||t==e.BOSS_SUBTYPE_SHENYU||t==e.BOSS_SUBTYPE_DARKBOSS)&&this.bossAlertList&&this.bossAlertList.length){for(var s=!0,n=this.worldInfoList[t].slice(),o=1e3*UserZs.ins().lv+Actor.level,a=0;a<n.length;a++){var r=(n[a].relieveTime-egret.getTimer())/1e3>0||n[a].hp<=0;if(!r){var h=this.getBossRemindByIndex(n[a].id);if(h){var l=GlobalConfig.WorldBossConfig[n[a].id];if(l.samsaraLv){if(Actor.samsaraLv>=l.samsaraLv){s=!1;break}}else{var c=1e3*l.zsLevel+l.level;if(o>=c){s=!1;break}}}}}return!s}if(t==e.BOSS_SUBTYPE_GODWEAPON){for(var u=0,p=i;u<p.length;u++){var d=p[u];if(this.worldBossBelongTime[t]>0&&d.canChallenge&&this.getBossRemindByIndex(d.id))return!0}return!1}if(t==e.BOSS_SUBTYPE_GODWEAPON_TOP){for(var g=0,f=i;g<f.length;g++){var d=f[g];if(d.canChallenge&&this.getBossRemindByIndex(d.id)){var v=GlobalConfig.WorldBossBaseConfig.challengeItemYb[t-1];if(Actor.yb>=v)return!0;var y=GlobalConfig.WorldBossBaseConfig.challengeItem[t-1],m=UserBag.ins().getBagGoodsByTypeAndId(0,y);if(m&&m.count)return!0}}return!1}for(var T=i.length,a=0;T>a;a++)if(2!=i[a].bossState)return!0;return!1},Object.defineProperty(e.prototype,"clickTime",{set:function(t){this.canClick=!1,this._clickTime=t,TimerManager.ins().remove(this.endTimeChangeStatu,this),TimerManager.ins().doTimer(500,this._clickTime,this.endTimeChangeStatu,this)},enumerable:!0,configurable:!0}),e.prototype.endTimeChangeStatu=function(){--this._clickTime,this._clickTime<=0&&(this.canClick=!0,TimerManager.ins().remove(this.endTimeChangeStatu,this))},e.prototype.getListData=function(){var t=UserFb.getPersonalBossFbIds().slice(),e=[],i=[],s=[],n=1e3*UserZs.ins().lv+Actor.level;for(var o in t){var a=UserFb.ins().getFbDataById(t[o].id);if(a){var r=a.getPlayCount()<=0;if(r)e.push(t[o]);else{var h=1e3*t[o].zsLevel+t[o].levelLimit;t[o].monthcard?Recharge.ins().monthDay>0?i.unshift(t[o]):s.push(t[o]):t[o].specialCard?Recharge.ins().franchise?i.unshift(t[o]):s.push(t[o]):t[o].privilege?Recharge.ins().getIsForeve()?i.unshift(t[o]):s.push(t[o]):n>=h?i.push(t[o]):s.push(t[o])}}}return[i,s,e]},e.prototype.getGwBossList=function(){for(var t=e.ins().worldInfoList[e.BOSS_SUBTYPE_GODWEAPON].concat(),i=e.ins().worldInfoList[e.BOSS_SUBTYPE_GODWEAPON_TOP].concat(),s=0;s<i.length;s++){var n=i[s];GlobalConfig.WorldBossConfig[n.id];if(n.canInto){t.push(i[s]);break}}return t},e.isCanChallenge=function(t){var e;if(t.samsaraLv>0)e=Actor.samsaraLv>=t.samsaraLv;else{var i=1e3*UserZs.ins().lv+Actor.level,s=1e3*t.zsLevel+t.level;e=i>=s}return e},e}(BaseSystem);UserBoss.WB_BAG_ENOUGH=50,UserBoss.BOSS_SUBTYPE_WORLDBOSS=1,UserBoss.BOSS_SUBTYPE_QMBOSS=2,UserBoss.BOSS_SUBTYPE_HOMEBOSS=3,UserBoss.BOSS_SUBTYPE_SHENYU=4,UserBoss.BOSS_SUBTYPE_GODWEAPON=5,UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP=6,UserBoss.BOSS_SUBTYPE_DARKBOSS=7,__reflect(UserBoss.prototype,"UserBoss");var GameSystem;!function(t){t.userboss=UserBoss.ins.bind(UserBoss)}(GameSystem||(GameSystem={}));var BossHomeMainWin=function(t){function e(){var e=t.call(this)||this;return e.isStartTime=!1,e.type=0,e.restoreTime=0,e.lastIndex=-1,e.isClickItem=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=HomeBossItem,this.titleList.itemRenderer=VipBossItem,this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.setting.touchEnabled=!0,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData;var t=[];for(var e in GlobalConfig.BossHomeConfig)t.push(e);this.titleList.dataProvider=new eui.ArrayCollection(t),this.setLoginView()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setGroupVis(!0),this.type=UserBoss.BOSS_SUBTYPE_HOMEBOSS,this.lastIndex=-1,this.titleList.selectedIndex=0,this.observe(UserBoss.ins().postWorldBoss,this.setData),this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.titleList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.addTouchEvent(this.bosshome0,this.onTap),this.addTouchEvent(this.bosshome1,this.onTap),this.addTouchEvent(this.bosshome2,this.onTap),this.rewardList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.rewardList1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.rewardList2.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.setData()},e.prototype.close=function(){this.setting.removeEventListener(egret.TextEvent.LINK,this.onLink,this),this.rewardList0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.rewardList1.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.rewardList2.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bosshome0:this.onRukouClick(0);break;case this.bosshome1:this.onRukouClick(1);break;case this.bosshome2:this.onRukouClick(2);break;case this.rewardList0:case this.rewardList1:case this.rewardList2:this.isClickItem=!0}},e.prototype.onRukouClick=function(t){if(this.isClickItem)return void(this.isClickItem=!1);var e=GlobalConfig.BossHomeConfig[t+1];return UserVip.ins().lv<e.vip?void UserTips.ins().showTips("VIP"+e.vip+"开启"):(this.titleList.selectedIndex=t,this.setGroupVis(!1),void this.setData())},e.prototype.setGroupVis=function(t){this.rukou.visible=t,this.mainGroup.visible=!t},e.prototype.onClickMenu=function(t){this.setData()},e.prototype.setLoginView=function(){for(var t=0;3>t;t++){var e=GlobalConfig.BossHomeConfig[t+1];this["rewardList"+t].itemRenderer=ItemBase,this["rewardList"+t].dataProvider=new eui.ArrayCollection(e.icon),this["vipImg"+t].source="vip_v"+e.vip+"_png"}},e.prototype.setData=function(){if(this.lastIndex!=this.titleList.selectedIndex){this.lastIndex=this.titleList.selectedIndex;var t=this.list.parent;t.stopAnimation(),this.list.scrollV=0;var e=UserBoss.ins().worldInfoList[this.type].slice(),i=[],s=[],n=[],o=[],a=[],r=[],h=1e3*UserZs.ins().lv+Actor.level,l=this.titleList.selectedIndex+1,c=GlobalConfig.BossHomeConfig[l],u=c.boss;this.titleText.text="BOSS之家 "+l+"层",this.vipTipTxt.text="VIP"+c.vip+"无限挑战";for(var p=0;p<e.length;p++)if(-1!=u.indexOf(e[p].id)){var d=2==e[p].bossState,g=GlobalConfig.WorldBossConfig[e[p].id],f=1e3*g.zsLevel+g.level;if(f>h)r.push(e[p]);else{var v=UserBoss.ins().getBossRemindByIndex(e[p].id);v?d?n.push(e[p]):s.push(e[p]):d?a.push(e[p]):o.push(e[p])}}s.sort(this.compareFn),n.sort(this.compareFn),o.sort(this.compareFn),a.sort(this.compareFn),r.sort(this.compareFn),i=s.concat(n,o,a,r),this.listData.replaceAll(i),this.currData=i[0],this.isStartTime||(TimerManager.ins().doTimer(1e3,0,this.updateTime,this),this.restoreTime=UserBoss.ins().worldBossrestoreTime[this.type],this.isStartTime=!0,this.updateTime())}},e.prototype.updateTime=function(){if(void 0!=this.timeTxt){var t=this.currData,e=t.relieveTime-egret.getTimer();0>=e?(TimerManager.ins().remove(this.updateTime,this),this.isStartTime=!1,this.timeTxt.visible=!1,UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_HOMEBOSS)):(this.timeTxt.visible||(this.timeTxt.visible=!0),this.timeTxt.text=DateUtils.getFormatBySecond(Math.floor(e/1e3),1)+"后刷新")}},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],s=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<s.zsLevel?1:i.zsLevel>s.zsLevel?-1:i.level<s.level?1:i.level>s.level?-1:0},e.prototype.onTouch=function(){GameGuider.guidance(egret.getQualifiedClassName(ForgeWin),2)},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,UserBoss.BOSS_SUBTYPE_HOMEBOSS)},e}(BaseView);__reflect(BossHomeMainWin.prototype,"BossHomeMainWin");var BossWin=function(t){function e(){var e=t.call(this)||this;return e.lastIndex=0,e.skinName="BossSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){if(t.prototype.initUI.call(this),this.redPoint2.visible=!1,UserBoss.ins().checkShenyuOpen()){this.redPoints=[];for(var e=0;5>e;e++)this.redPoints.push(this["redPoint"+e]);this.shenyuBoss.parent||this.viewStack.addChildAt(this.shenyuBoss,3)}else{this.redPoints=[];for(var e=0;5>e;e++)3!=e&&this.redPoints.push(this["redPoint"+e]);this.shenyuBoss.parent&&this.viewStack.removeChild(this.shenyuBoss)}this.validateNow();var i=112,s=this.viewStack.numChildren,n=-180;4==s&&(n=-125);for(var e=0;s>e;e++)0==e?this.redPoints[e].horizontalCenter=n:this.redPoints[e].horizontalCenter=this.redPoints[e-1].horizontalCenter+i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(UserBoss.ins().init(),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.seeRule,this.onTap),this.addChangeEvent(this.tab,this.setSelectedIndex),this.addChangingEvent(this.tab,this.checkIsOpen),this.observe(UserBoss.ins().postWorldBoss,this.updateRedPoint),this.observe(UserFb.ins().postUpDataInfo,this.updatePanel),this.observe(UserFb.ins().postUpDataInfo,this.updateRedPoint),void 0==t[0]){var i=UserBoss.ins().getListData()[0];0==i.length&&(t[0]=1)}this.lastSelect=t.length?t[0]:0,this.lastSelect>this.viewStack.numChildren-1&&(this.lastSelect=this.viewStack.numChildren-1),this.viewStack.selectedIndex=this.lastSelect,this.tab.selectedIndex=this.lastSelect,this.viewStack.getElementAt(this.lastSelect).open(t[1]),this.updateRedPoint(),ViewManager.ins().close(GuildMap),ViewManager.ins().close(GuildActivityWin),ViewManager.ins().close(TreasureHuntWin),this.checkHelpBtn()},e.prototype.updatePanel=function(){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open(),this.checkHelpBtn()},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open(),this.checkHelpBtn()},e.prototype.checkHelpBtn=function(){UserBoss.ins().checkShenyuOpen()&&3==this.lastSelect?this.seeRule.visible=!1:this.seeRule.visible=!0},e.prototype.updateRedPoint=function(){this.redPoint0.visible=UserFb.isCanChallenge(),this.redPoint1.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_QMBOSS),this.redPoint2.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_WORLDBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_DARKBOSS),this.redPoint3.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_SHENYU),this.redPoint4.visible=UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_HOMEBOSS)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.viewStack.getElementAt(this.lastSelect).close()},e.prototype.onLink=function(t){var e=this,i=GlobalConfig.WorldBossBaseConfig.clearCdCost[UserBoss.ins().currBossSubType-1];WarnWin.show("确定消耗<font color='#ffff00'>"+i+"元宝立即清除挑战CD",function(){ViewManager.ins().close(e),UserBoss.ins().sendClearCD()},this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:4==this.viewStack.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,12):(3!=this.viewStack.selectedIndex||UserBoss.ins().checkShenyuOpen())&&ViewManager.ins().open(ZsBossRuleSpeak,this.viewStack.selectedIndex+1);break;default:if(t.target instanceof eui.Button){var e=t.target.parent.config;switch(t.target.name){case"publicChallenge":return;case"homeChallenge":if(UserFb.ins().checkInFB())return;if(e.zsLevel<=UserZs.ins().lv&&e.level<=Actor.level)if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH);else{var i=Math.ceil((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_HOMEBOSS]-egret.getTimer())/1e3);if(i>0)return void UserTips.ins().showTips("|C:0xf3311e&T:冷却中，"+i+"秒后可进行挑战|");UserBoss.ins().sendChallengWorldBoss(t.target.parent.data.id,UserBoss.BOSS_SUBTYPE_HOMEBOSS),ViewManager.ins().close(this)}else UserTips.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");break;case"ZsBoss":}ViewManager.ins().close(LimitTaskView)}}},e.prototype.checkIsOpen=function(t){var e=t.target,i=1;return ViewManager.ins().close(LimitTaskView),2==e.selectedIndex&&UserZs.ins().lv<i?(UserTips.ins().showTips(i+"转开启"),t.$cancelable=!0,void t.preventDefault()):void 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_WORLDBOSS]&&!UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_QMBOSS])return UserTips.ins().showTips("网络不佳，请稍后"),!1;if(t&&t.length){if(2==t[0]){var i=1;return UserZs.ins().lv<i?(UserTips.ins().showTips(i+"转开启"),!1):!0}if(4==t[0]&&!UserBoss.ins().checkShenyuOpen())return UserTips.ins().showTips("开服第"+GlobalConfig.WorldBossBaseConfig.shenyuOpenDay+"天开启"),!1}return OpenSystem.ins().checkSysOpen(SystemType.BOSS)?(FbWin.isClose||ViewManager.ins().close(LiLianWin),FbWin.isClose=!1,!0):(UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOSS)),!1)},e}(BaseEuiView);__reflect(BossWin.prototype,"BossWin"),ViewManager.ins().reg(BossWin,LayerManager.UI_Main);var HideBossBtnWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="HideBossBtnSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.eff_dragon.touchEnabled=!1,this.eff_dragon.touchChildren=!1,this.hideBossBtn.visible=!1,this.eff_dragon.visible=!1},e.prototype.initUI=function(){this.hideBossBtn.visible=!1,this.eff_dragon.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]?this.playDragonEff():this.showBtn()},e.prototype.onTap=function(){return GameMap.sceneInMain()?Encounter.ins().isEncounter()?void UserTips.ins().showCenterTips("|C:0xf3311e&T:正在挑战附近的人|"):void ViewManager.ins().open(HideBossWin):void UserTips.ins().showCenterTips("|C:0xf3311e&T:请先退出副本后再击杀隐藏BOSS|")},e.prototype.playDragonEff=function(){var t=this,e=ObjectPool.pop("MovieClip");e.addEventListener(egret.Event.CHANGE,this.onloadComp,this),e.playFile(RES_DIR_EFF+"luckyboss_dragon_down",1,function(){e.removeEventListener(egret.Event.CHANGE,t.onloadComp,t),e.destroy()}),this.eff_dragon.visible=!0,this.eff_dragon.addChild(e)},e.prototype.onloadComp=function(){TimerManager.ins().doTimer(400,1,this.showBtn,this)},e.prototype.showBtn=function(){if(Assert(UserBoss.ins().hideBossData.id,"hideBossData id:"+UserBoss.ins().hideBossData.id))return void ViewManager.ins().close(this);this.hideBossBtn.visible=!0,this.addTouchEvent(this.hideBossBtn,this.onTap);var t=GlobalConfig.MonstersConfig[GlobalConfig.HideBossConfig[UserBoss.ins().hideBossData.id].bossId];this.hideBossBtn.headImg.source="monhead"+t.head+"_png",this._sec=Math.floor((DateUtils.formatMiniDateTime(UserBoss.ins().hideBossData.endTime)-GameServer.serverTime)/1e3),this.lbTime.text=DateUtils.getFormatBySecond(this._sec,DateUtils.TIME_FORMAT_1),TimerManager.ins().remove(this.setTime,this),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.mcBtn||(this.mcBtn=ObjectPool.pop("MovieClip"),this.mcBtn.playFile(RES_DIR_EFF+"luckyboss_hint",-1)),this.mcBtn.parent||this.hideBossBtn.eff_btn.addChild(this.mcBtn)
},e.prototype.setTime=function(){this._sec>0?(this._sec-=1,this.lbTime.text=DateUtils.getFormatBySecond(this._sec,DateUtils.TIME_FORMAT_1)):(UserBoss.ins().hideBossData.id=0,UserBoss.ins().hideBossData.endTime=0,ViewManager.ins().close(this))},e.prototype.close=function(){this.mcBtn&&this.mcBtn.destroy(),this.mcBtn=null},e}(BaseEuiView);__reflect(HideBossBtnWin.prototype,"HideBossBtnWin"),ViewManager.ins().reg(HideBossBtnWin,LayerManager.UI_Main);var HideBossWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="LuckyBossSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.boss.touchEnabled=!1,this.boss.touchChildren=!1,this.dropRewardList.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.showBoss(),this.showAward()},e.prototype.close=function(){this.bossMc&&this.bossMc.destroy(),this.bossMc=null},e.prototype.showAward=function(){var t=UserBoss.ins().hideBossData.id,e=GlobalConfig.HideBossConfig[t].rewardShow;this.dropRewardList.dataProvider=new eui.ArrayCollection(e.concat())},e.prototype.showBoss=function(){if(!this.bossMc){var t=ObjectPool.pop("MovieClip");this.bossMc=t,t.scaleX=-1,t.scaleY=1,t.x=78,t.y=50,this.boss.addChild(t)}var e=UserBoss.ins().hideBossData.id,i=GlobalConfig.HideBossConfig[e].bossId,s=GlobalConfig.MonstersConfig[i];this.bossMc.playFile(RES_DIR_MONSTER+("monster"+s.avatar+"_3s"),-1)},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.bgClose?ViewManager.ins().close(this):e==this.challengeBtn&&(Encounter.ins().isEncounter()?UserTips.ins().showCenterTips("正在挑战附近的人"):GameMap.sceneInMain()?(UserBoss.ins().hideBossData.lastId=UserBoss.ins().hideBossData.id,UserBoss.ins().sendChallengeHideBoss(),ViewManager.ins().close(this)):UserTips.ins().showCenterTips("请先退出副本后再击杀隐藏BOSS"))},e}(BaseEuiView);__reflect(HideBossWin.prototype,"HideBossWin"),ViewManager.ins().reg(HideBossWin,LayerManager.UI_Popup);var NewBossJiangliView=function(t){function e(){var e=t.call(this)||this;return e.skinName="wpkBossJiangLiTishiSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.initView()},e.prototype.initView=function(){var t=GlobalConfig.NewWorldBossBaseConfig.showDrows;this.endItem0.data=t[0],this.endItem1.data=t[1],this.belongItem.data=GlobalConfig.NewWorldBossRankConfig[1][1].reward[0],this.joinItem.data=GlobalConfig.NewWorldBossRankConfig[1][4].reward[0],this.endItem0.isShowName(!1),this.endItem1.isShowName(!1),this.belongItem.isShowName(!1),this.joinItem.isShowName(!1)},e.prototype.onTap=function(t){var e=t.currentTarget;(e==this.closeBtn||e==this.giveUp)&&ViewManager.ins().close(this)},e.prototype.close=function(){},e}(BaseEuiView);__reflect(NewBossJiangliView.prototype,"NewBossJiangliView"),ViewManager.ins().reg(NewBossJiangliView,LayerManager.UI_Popup);var NewWorldBossUIView=function(t){function e(){var e=t.call(this)||this;return e.GRAYIMG_WIDTH=0,e.leftTime=0,e._curMonsterID=0,e.curValue=1,e.skinName="wpkBossUiSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.bossBloodGroup.visible=!1,this.leftTimeGroup.visible=!1,this.dropDown.visible=!1,this.dropDown.setEnabled(!1),this.attList.visible=!1,this.attList0.visible=!1,this.grayImg.source="bosshp2",this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height),this.grayImg.mask=this.grayImgMask,this.GRAYIMG_WIDTH=this.grayImg.width},e.prototype.open=function(){this.observe(UserBoss.ins().postHpChange,this.reflashBlood),this.observe(UserBoss.ins().postBossAppear,this.reflashBlood),this.observe(UserBoss.ins().postNewBossReliveTime,this.updateReliveTime),this.observe(UserBoss.ins().postNewBossOpen,this.updateTime),this.observe(UserBoss.ins().postNewBossRank,this.updateRank),this.observe(UserBoss.ins().postAddAttrNum,this.updateAttr),this.addTouchEvent(this.guwu,this.onTap),this.addTouchEvent(this.tipBtn0,this.onTap),this.initView()},e.prototype.initView=function(){this.updateTime(),this.updateReliveTime(),this.updateAttr(),this.dropDown.currentState="down",this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID],this.bossConfig&&(this.updateBaseInfo(),this.reflashBlood())},e.prototype.updateTime=function(){var t=UserBoss.ins().newWorldBossData.startTime,e=UserBoss.ins().newWorldBossData.isOpen;if(!e||!t)return void(this.leftTimeGroup.visible=!1);var i=Math.floor((GameServer.serverTime-t)/1e3);return 0>=i||i>=GlobalConfig.NewWorldBossBaseConfig.bossTime?void(this.leftTimeGroup.visible=!1):(this.leftTimeGroup.visible=!0,this.leftTime=GlobalConfig.NewWorldBossBaseConfig.bossTime-i,TimerManager.ins().isExists(this.setTime,this)||TimerManager.ins().doTimer(1e3,0,this.setTime,this),void this.setTime())},e.prototype.setTime=function(){this.lastTime.text=DateUtils.getFormatBySecond(this.leftTime,DateUtils.TIME_FORMAT_10),this.leftTime>0&&(this.leftTime-=1)},e.prototype.updateReliveTime=function(){UserBoss.ins().reliveTime>0?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.updateBaseInfo=function(){this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID],this.bossConfig&&(this._curMonsterID=UserBoss.ins().monsterID,this.nameTxt.text=this.bossConfig.name,this.head.source="monhead"+this.bossConfig.head+"_png",this.lvTxt.text="Lv."+this.bossConfig.level)},e.prototype.reflashBlood=function(){if(this._curMonsterID!=UserBoss.ins().monsterID&&this.updateBaseInfo(),this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID],!this.bossConfig)return this.bossBloodGroup.visible=!1,void(this.leftTimeGroup.visible=!1);var t=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);if(!t||!t.infoModel||t.infoModel.getAtt(AttributeType.atHp)<=0)return this.bossBloodGroup.visible=!1,void(this.leftTimeGroup.visible=!1);var e=t?t.infoModel:null;e?(this.bloodBar.maximum=e.getAtt(AttributeType.atMaxHp),this.bloodBar.value=e.getAtt(AttributeType.atHp),this.bossBloodGroup.visible=this.bloodBar.value>0):(this.bloodBar.maximum=this.bossConfig.hp,this.bloodBar.value=this.bossConfig.hp,this.bossBloodGroup.visible=this.bloodBar.value>0),this.bossBloodGroup.visible||(this.leftTimeGroup.visible=!1),this.dropDown.visible=!0,this.updateRank(),this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100),this.tweenBlood()},e.prototype.tweenBlood=function(){var t=this,e=this.curValue*this.GRAYIMG_WIDTH/100,i=this;if(egret.Tween.removeTweens(this.grayImgMask),!(3>e)){var s=egret.Tween.get(this.grayImgMask,{onChange:function(){i.grayImg&&(i.grayImg.mask=t.grayImgMask)}},i);s.to({width:e-3},1e3).call(function(){0>=e&&(i.grayImgMask.width=this.GRAYIMG_WIDTH,egret.Tween.removeTweens(this.grayImgMask))},i)}},e.prototype.updateRank=function(){var t=UserBoss.ins().newWorldBossData.rankList?UserBoss.ins().newWorldBossData.rankList.concat():[],e=t.length;if(e){e>10&&(e=10);var i=t.slice(1,e);this.dropDown.setData(i),this.dropDown.setLabel(t[0].roleName+":"+CommonUtils.overLength(t[0].value))}else this.dropDown.setData([]),this.dropDown.setLabel("");for(var s=0;s<t.length;s++)if(t[s].id==Actor.actorID){var n=CommonUtils.overLength(t[s].value);this.myTxt.text="自己："+n;break}},e.prototype.updateAttr=function(){var t=UserBoss.ins().newWorldBossData.addAttrNum||0,e=GlobalConfig.NewWorldBossAttrConfig[t],i=GlobalConfig.NewWorldBossAttrConfig[t+1],s="",n={type:0,value:0},o={type:0,value:0};if(i){for(var a=0;a<i.attr.length;a++)a>0&&(s+="\n"),o.type=i.attr[a].type,o.value=i.attr[a].value,n.type=o.type,n.value=0,e&&e.attr[a]&&(n.value=e.attr[a].value),s+=AttributeData.getAttStrByType(n,0,":",!1),o.value-=n.value,s+=AttributeData.getAttStrByType(o,0,"+",!1,!1);this.costGroup.parent||this.timeGroup.addChildAt(this.costGroup,0)}else{for(var a=0;a<e.attr.length;a++)a>0&&(s+="\n"),s+=AttributeData.getAttStrByType(e.attr[a],0,":",!1);this.costGroup.parent&&this.costGroup.parent.removeChild(this.costGroup)}this.guwuNum.text=s,this.guwutime.text=t+"/"+Object.keys(GlobalConfig.NewWorldBossAttrConfig).length;var r=i||e;1==r.type?this.typeImg.source="szjinbi":2==r.type&&(this.typeImg.source="szyuanbao"),this.cost.text=r.count+""},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.guwu){if(UserBoss.ins().newWorldBossData.addAttrNum==Object.keys(GlobalConfig.NewWorldBossAttrConfig).length)return void UserTips.ins().showTips("鼓舞次数已用完");var i=UserBoss.ins().newWorldBossData.addAttrNum||0,s=GlobalConfig.NewWorldBossAttrConfig[i+1];if(s){if(1==s.type&&Actor.gold<s.count)return void UserTips.ins().showTips("金币不足");if(2==s.type&&Actor.yb<s.count)return void UserTips.ins().showTips("元宝不足")}UserBoss.ins().sendBuyAddAttrNum()}else e==this.tipBtn0&&ViewManager.ins().open(NewBossJiangliView)},e.prototype.close=function(){TimerManager.ins().removeAll(this),WatcherUtil.removeFromArray(UserBoss.ins().newWorldBossData.rankList),this._curMonsterID=0},e}(BaseEuiView);__reflect(NewWorldBossUIView.prototype,"NewWorldBossUIView"),ViewManager.ins().reg(NewWorldBossUIView,LayerManager.UI_Main);var NewWorldBossWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="wpkBossSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=0,this.bossImage.y=215,this.boss.addChild(this.bossImage),this.list.itemRenderer=ItemBaseNoName,UserBoss.ins().sendGetNewBossInfo()},e.prototype.open=function(){this.observe(UserBoss.ins().postNewBossInfo,this.update),this.addTouchEvent(this.enter,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.update()},e.prototype.update=function(){var t=UserBoss.ins().newWorldBossData.bossID,e=GlobalConfig.MonstersConfig[t];e&&(this.nameTxt.text=e.name+"("+e.level+")",this.bossImage.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1),this.list.dataProvider=new eui.ArrayCollection(GlobalConfig.NewWorldBossBaseConfig.showAwards),this.bar.maximum=e.hp,this.bar.value=UserBoss.ins().newWorldBossData.curHp)},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.enter){if(UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime){var i=new Date(UserBoss.ins().newWorldBossData.startTime),s=i.getHours()+"点"+(i.getMinutes()?i.getMinutes()+"分":"");return void UserTips.ins().showTips("每天"+s+"开启，请按时参加")}if(!UserBoss.ins().checkNewWorldBossOpen())return void UserTips.ins().showTips(GlobalConfig.NewWorldBossBaseConfig.openLv+"级才可以参加");UserBoss.ins().sendIntoNewBoss(),ViewManager.ins().close(this)}else e==this.help?ViewManager.ins().open(ZsBossRuleSpeak,15):e==this.bgClose&&ViewManager.ins().close(this)},e.prototype.close=function(){},e}(BaseEuiView);__reflect(NewWorldBossWin.prototype,"NewWorldBossWin"),ViewManager.ins().reg(NewWorldBossWin,LayerManager.UI_Popup);var PubBossRemindWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PubBossRemindSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listDatas=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.autoChallenge.visible=Recharge.ins().franchise?!0:!1;var i=[];if(i=UserBoss.ins().worldInfoList[this.type].slice(),this.type==UserBoss.BOSS_SUBTYPE_QMBOSS?(this.list0.itemRenderer=PubBossRemindItem,this.autoChallenge.selected=AutoChallengeBoss.ins().autoYewaiBoss):this.type==UserBoss.BOSS_SUBTYPE_HOMEBOSS?this.list0.itemRenderer=HomeBossRemindItem:this.type==UserBoss.BOSS_SUBTYPE_DARKBOSS?(this.list0.itemRenderer=PubBossRemindItem,this.autoChallenge.visible=!1):this.type==UserBoss.BOSS_SUBTYPE_GODWEAPON?(i=UserBoss.ins().getGwBossList(),this.list0.itemRenderer=GwBossRemindItem,this.autoChallenge.visible=!1):this.type==UserBoss.BOSS_SUBTYPE_SHENYU&&(this.list0.itemRenderer=PubBossRemindItem,this.autoChallenge.selected=AutoChallengeBoss.ins().autoShenyuBoss),this.addTouchEvent(this.autoChallenge,this.onChallenge),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.type==UserBoss.BOSS_SUBTYPE_QMBOSS&&!SamsaraModel.ins().isOpen()){var s=[];for(var n in i){var o=GlobalConfig.WorldBossConfig[i[n].id];o.samsaraLv||s.push(i[n])}i=s}this.listDatas.source=i.sort(this.compareFn),this.list0.dataProvider=this.listDatas,this.addTouchEvent(this,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];UserBoss.ins().sendBossSetting(),this.removeTouchEvent(this,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),AutoChallengeBoss.ins().checkEnter()},e.prototype.onChallenge=function(t){UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?(ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH),this.autoChallenge.selected=!1):this.type==UserBoss.BOSS_SUBTYPE_SHENYU?AutoChallengeBoss.ins().autoShenyuBoss=this.autoChallenge.selected:this.type==UserBoss.BOSS_SUBTYPE_QMBOSS&&(AutoChallengeBoss.ins().autoYewaiBoss=this.autoChallenge.selected)},e.prototype.onTap=function(t){if(t.target instanceof eui.CheckBox){var e=parseInt(t.target.name);UserBoss.ins().setBossSetting(e)}else switch(t.currentTarget){case this.bgClose:case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],s=GlobalConfig.WorldBossConfig[e.id],n=UserBoss.isCanChallenge(i),o=UserBoss.isCanChallenge(s);return n&&!o?-1:!n&&o?1:i.samsaraLv>s.samsaraLv?1:i.samsaraLv<s.samsaraLv?-1:i.samsaraLv!=s.samsaraLv||0==i.samsaraLv?i.zsLevel>s.zsLevel?1:i.zsLevel<s.zsLevel?-1:i.level>s.level?1:i.level<s.level?-1:0:i.level>s.level?1:i.level<s.level?-1:void 0},e}(BaseEuiView);__reflect(PubBossRemindWin.prototype,"PubBossRemindWin"),ViewManager.ins().reg(PubBossRemindWin,LayerManager.UI_Main);var PublicBossJiangliTipWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossJiangLiTishiSkin",this.isTopLevel=!0,this.belongList.itemRenderer=ItemBase,this.joinList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.addTouchEvent(this,this.otherClose),GwBoss.ins().isGwBoss||KFBossSys.ins().isKFBossBattle?this.currentState="gwboss":GwBoss.ins().isGwTopBoss?this.currentState="tower":GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS?this.currentState="hideboss":this.currentState="normal",KFBossSys.ins().isKFBossBattle){this.proWordGroup1.visible=!1,this.proWordGroup.visible=!1;for(var i in GlobalConfig.CrossBossConfig){var s=GlobalConfig.CrossBossConfig[i];if(s.fbid==GameMap.fubenID){var n=CommonUtils.copyDataHandler(s.belongRewardshow);n&&(this.belongItem.data=n.shift()),this.belongList.dataProvider=new eui.ArrayCollection(n);break}}}else if(GameMap.fbType==UserFb.FB_TYPE_HIDE_BOSS){var o=UserBoss.ins().hideBossData.lastId,a=GlobalConfig.HideBossConfig[o].rewardShow.concat();this.belongItem.data=a.shift(),this.belongList.dataProvider=new eui.ArrayCollection(a)}else{var r=GlobalConfig.WorldBossConfig[UserBoss.ins().currBossConfigID];this.belongItem.data=r.belongRewardshow[0],this.belongList.dataProvider=new eui.ArrayCollection(r.belongRewardshow[1]),r.canRewardshow&&(this.joinItem.data=r.canRewardshow[0],this.joinList.dataProvider=new eui.ArrayCollection(r.canRewardshow[1]))}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.openCheck=function(){return UserBoss.ins().currBossConfigID?!0:!1},e}(BaseEuiView);__reflect(PublicBossJiangliTipWin.prototype,"PublicBossJiangliTipWin"),ViewManager.ins().reg(PublicBossJiangliTipWin,LayerManager.UI_Popup);var PublicBossMainWin=function(t){function e(){var e=t.call(this)||this;return e.endTime=0,e.actLevel=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=WorldBossItem,this.dropRewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.touchEnabled=this.bossGroup.touchChildren=!1},e.prototype.open=function(){var t=UserBoss.ins().worldBossPlayList[UserBoss.BOSS_SUBTYPE_QMBOSS].slice();this.bossImage&&!this.bossImage.parent&&this.bossGroup.addChild(this.bossImage),this.observe(UserZs.ins().postZsData,this.setActLevel),this.observe(Actor.ins().postLevelChange,this.setActLevel),this.setActLevel(),this.list.dataProvider=new eui.ArrayCollection(t),this.list.selectedIndex=0,this.currData=this.list.dataProvider.getItemAt(0),this.addTouchEvent(this.challengeBtn,this.onTap),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.setWin()},e.prototype.onClickMenu=function(t){this.currData=this.list.dataProvider.getItemAt(t.itemIndex),this.setWin()},e.prototype.setWin=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId],i=t.zsLevel>0?t.zsLevel+"转":t.level+"级";this.nameTxt.text=e.name+"("+i+")";var s="无";""!=this.currData.roleName&&(s=this.currData.roleName,""!=this.currData.guildName&&(s=s+"("+this.currData.guildName+")")),2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider=new eui.ArrayCollection(t.showReward),this.playerNameTxt.text=s;var n=UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_QMBOSS];this.leftText.text="挑战剩余次数:"+n+"次",this.endTime=Math.floor((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3),this.endTime>0?(this.challengeBtn.visible=!1,this.updateTime(),TimerManager.ins().doTimer(100,0,this.updateTime,this),s=DateUtils.getFormatBySecond(this.endTime,5,3),this.leftCDText.text="挑战CD:"+s):this.leftCDText.text="",this.bossImage.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1);for(var o=0;4>o;o++){var a=void 0;switch(o){case 0:a=GlobalConfig.ItemConfig[t.joinReward];break;case 1:a=GlobalConfig.ItemConfig[t.shieldReward];break;case 2:a=GlobalConfig.ItemConfig[t.belongReward];break;case 3:a=GlobalConfig.ItemConfig[t.killReward]}}}},e.prototype.updateTime=function(){var t=Math.floor((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3);this.leftCDText.text="挑战CD:"+DateUtils.getFormatBySecond(t,5,3),0>=t&&(TimerManager.ins().remove(this.updateTime,this),this.leftCDText.text="",this.challengeBtn.visible=!0)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(Math.floor((UserBoss.ins().worldBossCd[UserBoss.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3)>0)return void UserTips.ins().showTips("挑战CD中");var e=1e3*UserZs.ins().lv+Actor.level,i=GlobalConfig.WorldBossConfig[this.currData.id],s=(GlobalConfig.MonstersConfig[i.bossId],1e3*(i.zsLevel||0)+i.level);if(s>e){var n=i.zsLevel>0?i.zsLevel+"转":i.level+"级";return void UserTips.ins().showTips("只有"+n+"才可以挑战。")}UserBag.ins().getSurplusCount()<UserBoss.WB_BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin,UserBoss.WB_BAG_ENOUGH):(ViewManager.ins().close(BossWin),UserBoss.ins().sendChallengWorldBoss(this.currData.id,UserBoss.BOSS_SUBTYPE_QMBOSS))}},e.prototype.setActLevel=function(){this.actLevel=1e4*UserZs.ins().lv+Actor.level},e.prototype.close=function(){this.removeObserve(),this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.removeTouchEvent(this.challengeBtn,this.onTap)},e}(BaseView);__reflect(PublicBossMainWin.prototype,"PublicBossMainWin");var PublicBossRank=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BossRankSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.hideBtn,this.onTap),this.myHarm.text="我的伤害：",this.myRank.text="我的排名："},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.hideBtn,this.onTap),this.removeObserve()},e.prototype.updateRank=function(t){for(var e=(t[0],t[1]),i=Actor.actorID,s=0;3>s;s++)this["rank"+s].text=s+1,this["name"+s].text=e[s]?e[s][1]:"",e[s]?CommonUtils.labelIsOverLenght(this["harm"+s],e[s][2]):this["harm"+s].text="",e[s]&&e[s][0]==i.toString()&&(this.myHarm.text="我的伤害："+this["harm"+s].text,this.myRank.text="我的排名："+this["rank"+s].text)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.hideBtn:var e=egret.Tween.get(this.group);e.to({x:this.hideBtn.selected?480:247},500)}},e}(BaseEuiView);__reflect(PublicBossRank.prototype,"PublicBossRank"),ViewManager.ins().reg(PublicBossRank,LayerManager.UI_Main);var PubResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="PubResultSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2],o=t[3],a=t[4];this.addTouchEvent(this.closeBtn,this.onTap),TimerManager.ins().doTimer(1e3,10,this.updateCloseBtnLabel,this),this.txt0.text="（"+s+" Lv."+n+"）";for(var r=0;r<this.container0.numChildren;r++){var h=this.container0.getChildAt(r);h.destruct()}for(var r=0;r<this.container1.numChildren;r++){var h=this.container1.getChildAt(r);h.destruct()}this.container0.removeChildren(),this.container1.removeChildren(),this.txt1.visible=1!=i,this.txt2.visible=1!=i;for(var r=0;r<o.length;r++){var l=new ItemBase;l.data=o[r],this.container0.addChild(l)}if(this.s=10,this.closeBtn.name="退出",1!=i){this.txt2.text="（伤害排名：第"+i+"名）";for(var r=0;r<a.length;r++){var l=new ItemBase;l.data=a[r],this.container1.addChild(l)}}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&UserFb.ins().sendExitFb()},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&this.onTap(),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PubResultWin.prototype,"PubResultWin"),ViewManager.ins().reg(PubResultWin,LayerManager.UI_Main);var RandBossWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RandBossSkin",this.list.itemRenderer=ItemBase,this.upVip.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("<u>提升VIP等级</u>","#23C42A"))},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.upVip,this.onTap),this.info=this.getUserInfoByItemId(t[0]),this.list.dataProvider=new eui.ArrayCollection(this.info.show);var i=UserFb.ins().bossCallNum,s=this.info.challengeTime[UserVip.ins().lv];this.playNum.text=s-i+"/"+s,this.lastNum=s-i,this.bossdesc.text=this.info.titledes},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.upVip,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.sure:if(this.lastNum<=0)return void UserTips.ins().showTips("|C:0xf3311e&T:今日召唤次数已用完|");if(Actor.level>=this.info.levelLimit)return UserFb.ins().sendCallBossPlay(this.info.id),ViewManager.ins().close(this),void ViewManager.ins().close(BagWin);UserTips.ins().showTips("|C:0xf3311e&T:等级达到"+this.info.levelLimit+"级可召唤|");break;case this.upVip:ViewManager.ins().open(VipWin)}},e.prototype.getUserInfoByItemId=function(t){var e=GlobalConfig.OtherBoss2Config;for(var i in e)if(e[i].itemId==t)return e[i];return null},e}(BaseEuiView);__reflect(RandBossWin.prototype,"RandBossWin"),ViewManager.ins().reg(RandBossWin,LayerManager.UI_Main);var ShieldWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shieldSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.shieldBtn,this.onTap),this.touchEnabled=!1,this.shieldBtn.selected=!EntityHideBody.ins().isShow},e.prototype.onTap=function(t){EntityHideBody.ins().setShowState(!this.shieldBtn.selected)},e}(BaseEuiView);__reflect(ShieldWin.prototype,"ShieldWin"),ViewManager.ins().reg(ShieldWin,LayerManager.UI_Main);var WildBossJoinWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WildBossJoinSkin",this.list.itemRenderer=WildBossJoinItem,this.arrCollect=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.arrCollect.source=[],this.list.dataProvider=this.arrCollect},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.updateRank=function(t){var e=(t[0],t[1]);this.arrCollect.source=e,this.list.dataProvider=this.arrCollect},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WildBossJoinWin.prototype,"WildBossJoinWin"),ViewManager.ins().reg(WildBossJoinWin,LayerManager.UI_Main);var WildBossRecordWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WildBossRecordSkin",this.list.itemRenderer=WildBossJoinItem,this.arrCollect=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.observe(UserBoss.ins().postChallageRank,this.updateRank),this.arrCollect.source=[],this.list.dataProvider=this.arrCollect},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeObserve()},e.prototype.updateRank=function(t){var e=(t[0],t[1]);this.arrCollect.source=e,this.list.dataProvider=this.arrCollect},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WildBossRecordWin.prototype,"WildBossRecordWin"),ViewManager.ins().reg(WildBossRecordWin,LayerManager.UI_Main);var WorldBossBeKillWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin",this.aliveNum=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.reliveBtn,this.onTap),this.addTouchEvent(this.exitBtn,this.onTap),this.setWin()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.reliveBtn,this.onTap),this.removeTouchEvent(this.exitBtn,this.onTap),ViewManager.ins().close(WorldBossCdWin)},e.prototype.setWin=function(){if(UserBoss.ins().killerHandler>0){var t=EntityManager.ins().getEntityByHandle(UserBoss.ins().killerHandler),e="";if(t)if(t instanceof CharRole)e=t.infoModel.name;else if(t.infoModel.masterHandle){var i=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(t.infoModel.masterHandle));if(i&&i.length)for(var s=0,n=i;s<n.length;s++){var o=n[s];if(o instanceof CharRole){e=""+o.infoModel.name;break}}e||(e=""+t.infoModel.name)}else e="Boss"+t.infoModel.name;this.killTips.textFlow=(new egret.HtmlTextParser).parser("你被"+StringUtils.addColor(""+e,"#23C42A")+"击败"),this.aliveNum=this.getAliveItem(),this.alive.visible=this.aliveNum?!0:!1,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1")}this.reliveBtn.label=UserBoss.ins().checkWorldBossNeed()+"原地复活",GameMap.fbType==UserFb.FB_TEAM?(this.reliveBtn.visible=!1,this.moneyIcon.visible=!1):(this.reliveBtn.visible=!0,this.moneyIcon.visible=!0),this.reliveTimesTxt.text=UserBoss.ins().reliveTime+"秒",TimerManager.ins().remove(this.refushLabel,this),this.remainM=UserBoss.ins().reliveTime,TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this),DieGuide.ins().postdieGuide(0)},e.prototype.getAliveItem=function(){if(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian)return 0;var t=CityCC.ins().isCity?GlobalConfig.CityBaseConfig.rebornItem:GlobalConfig.WorldBossBaseConfig.rebornItem,e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,t);return e?e.count:0},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒"},e.prototype.overTime=function(){ViewManager.ins().close(this),ViewManager.ins().close(WorldBossCdWin)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.reliveBtn:if(this.aliveNum)return void UserBoss.ins().sendClearCD();UserBoss.ins().checkWorldBossMoney()?UserBoss.ins().sendClearCD():UserTips.ins().showTips("元宝不足，无法立即复活");break;case this.exitBtn:UserFb.ins().sendExitFb()}},e}(BaseEuiView);__reflect(WorldBossBeKillWin.prototype,"WorldBossBeKillWin"),ViewManager.ins().reg(WorldBossBeKillWin,LayerManager.UI_Popup);var WorldBossCdWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBosstishiSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.addChangeEvent(this.check,this.selectChange);var i=UserBoss.ins().checkWorldBossNeed();this.tipsTxt.textFlow=(new egret.HtmlTextParser).parser("确定需要消耗"+StringUtils.addColor(i+"元宝","#23C42A")+"立即复活吗?")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.giveUp,this.onTap),this.check.removeEventListener(egret.Event.CHANGE,this.selectChange,this)},e.prototype.selectChange=function(t){UserBoss.ins().ShowTip=!this.check.selected},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return UserBoss.ins().ShowTip},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sure:UserBoss.ins().checkRelive()&&(UserBoss.ins().sendClearCD(),ViewManager.ins().close(e),ViewManager.ins().close(WorldBossBeKillWin));break;case this.giveUp:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(WorldBossCdWin.prototype,"WorldBossCdWin"),ViewManager.ins().reg(WorldBossCdWin,LayerManager.UI_Popup);var WorldBossGold=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1];this.infoTxt.textFlow=(new egret.HtmlTextParser).parser("本次挑战BOSS详情：\n<font size='18' color='#A89C88'>	造成伤害：<font color='#23CA23'>"+i+"</font>\n	获得奖励：</font>"),this.price.setType(MoneyConst.gold),this.price.setPrice(s),this.s=10,this.updateBtn(),TimerManager.ins().doTimer(1e3,this.s,this.updateBtn,this),this.addTouchEvent(this.okBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.removeTouchEvent(this.okBtn,this.onTap),TimerManager.ins().remove(this.updateBtn,this),UserFb.ins().sendExitFb()},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e.prototype.updateBtn=function(){this.s--,this.okBtn.label="确 定（"+this.s+"s）",this.s<=0&&this.onTap()},e}(BaseEuiView);__reflect(WorldBossGold.prototype,"WorldBossGold"),ViewManager.ins().reg(WorldBossGold,LayerManager.UI_Main);var MapGrid=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e._poolNodes=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"numCols",{get:function(){return this._numCols},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numRows",{get:function(){return this._numRows},enumerable:!0,configurable:!0}),e.prototype.getNode=function(t,e){return this._nodes[t]?this._nodes[t][e]:void 0},e.prototype.isWalkableTile=function(t,e){return 0>t||t>=this._numCols||0>e||e>=this._numRows?!1:this._nodes[t][e].walkable},e.prototype.destruct=function(){this.clearNodes()},e.prototype.initMapInfo=function(t,e){this._nodes&&this.clearNodes(),this._numRows=t.maxY,this._numCols=t.maxX,this._nodes=[];for(var i,s=0;s<this._numCols;s++){this._nodes[s]=[];for(var n=0;n<this._numRows;n++)i=this.getGridNode(),i.flags=t.grids[s*this._numRows+n],this._nodes[s][n]=i}e&&this._nodes.reverse()},e.prototype.clearNodes=function(){for(var t in this._nodes)this._poolNodes=this._poolNodes.concat(this._nodes[t]),this._nodes[t].length=0;this._nodes.length=0},e.prototype.getGridNode=function(){return this._poolNodes.pop()||new MapGridNode},e.prototype._trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!=this.debugTrace&&this.debugTrace.apply(null,t)},e}(egret.Sprite);__reflect(MapGrid.prototype,"MapGrid");var WorldBossJiangliTipWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossJiangLiTishiSkin2",this.isTopLevel=!0,this.belongList.itemRenderer=ItemBase,this.joinList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.otherClose);var i=GlobalConfig.WorldBossConfig[UserBoss.ins().currBossConfigID];this.belongList.dataProvider=new eui.ArrayCollection(i.belongRewardshow[1]),this.joinList.dataProvider=new eui.ArrayCollection(i.canRewardshow[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.openCheck=function(){if(!UserBoss.ins().currBossConfigID)return!1;var t=GlobalConfig.WorldBossConfig[UserBoss.ins().currBossConfigID];return Assert(t,"GlobalConfig.WorldBossConfig["+UserBoss.ins().currBossConfigID+"]是空")?!1:!0},e}(BaseEuiView);__reflect(WorldBossJiangliTipWin.prototype,"WorldBossJiangliTipWin"),ViewManager.ins().reg(WorldBossJiangliTipWin,LayerManager.UI_Popup);var WorldBossJiangLiWin=function(t){function e(){var e=t.call(this)||this;return e.configTimes=0,e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossJiangLiSkin",this.bar.labelDisplay.visible=!1,this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.playGroup.visible=!0,this.maxPointGroup.visible=!1,this.myPointGroup.visible=!1,this.addTouchEvent(this.play,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.observe(UserBoss.ins().postLotteryRan,this.getMyPoint),this.observe(UserBoss.ins().postLotteryResult,this.getMaxPoint),this.observe(GuildWar.ins().postLotteryPoint,this.getMyPoint),this.observe(GuildWar.ins().postLotteryMaxPost,this.getMaxPoint),this.type=0,t[0]?(this.configTimes=GlobalConfig.WorldBossBaseConfig.lotteryTime>0?GlobalConfig.WorldBossBaseConfig.lotteryTime:10,this.type=t[0]):(this.configTimes=10,this.type=0),this.bar.maximum=10*this.configTimes,this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.play,this.onTap),this.removeTouchEvent(this.giveUp,this.onTap),TimerManager.ins().remove(this.refushBar,this),this.removeObserve()},e.prototype.refushInfo=function(){this.times=0,0==this.type?this.goods.data={type:1,id:UserBoss.ins().worldPrize,count:1}:1==this.type&&(this.goods.data={type:1,id:UserBoss.ins().worldPrize,count:1}),TimerManager.ins().doTimer(100,10*this.configTimes,this.refushBar,this,this.TimeOver,this),this.timeLabel.text=this.configTimes+"秒"},e.prototype.refushBar=function(){this.times++;var t=10*this.configTimes-this.times;this.bar.value=t,this.timeLabel.text=Math.floor(this.configTimes-this.times/10)+"秒",0>=t&&ViewManager.ins().close(e)},e.prototype.TimeOver=function(){ViewManager.ins().close(e)},e.prototype.getMyPoint=function(t){this.play.touchEnabled=!1,this.myPoint.text=t+"",this.myPointGroup.visible=!0},e.prototype.getMaxPoint=function(t){this.maxPoint.text=t[1],this.playerName.text=t[0],this.maxPointGroup.visible=!0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.play:0==this.type?UserBoss.ins().sendJoinLottery():1==this.type&&GuildWar.ins().sendPlayLotteryInfo(),this.playGroup.visible=!1;break;case this.giveUp:0==this.type?ViewManager.ins().close(e):1==this.type&&ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(WorldBossJiangLiWin.prototype,"WorldBossJiangLiWin"),ViewManager.ins().reg(WorldBossJiangLiWin,LayerManager.UI_Popup);var WorldBossUiInfo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GRAYIMG_WIDTH=0,e._curMonsterID=0,e.lastWeixieList=[],e.isDelayUpdate=!1,e.curValue=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossUiSkin",this.clickEffc=new MovieClip,this.clickEffc.x=630,this.clickEffc.y=269,this.pointEff=new MovieClip,this.pointEff.x=110,this.pointEff.y=510,this.list1.itemRenderer=WorldBossHeadRender,this.list2.itemRenderer=WorldBossHeadRender,this.bloodBar.slideDuration=0,this.bloodBar0.labelFunction=function(t,e){return""},this.grayImg.source="bosshp2",this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height),this.grayImg.mask=this.grayImgMask,this.GRAYIMG_WIDTH=this.grayImg.width,this.observe(UserBoss.ins().postHasAttackChange,this.refushWeixieList),this.observe(UserBoss.ins().postCanplayChange,this.refushcanPlayList),this.observe(UserBoss.ins().postHpChange,this.reflashBlood),this.observe(UserBoss.ins().postShieldPer,this.huDunChange),this.observe(UserBoss.ins().postRemainTime,this.reliveInfoChange),this.observe(UserBoss.ins().postWorldBossEndTime,this.worldBossEnd),this.observe(GameLogic.ins().postChangeTarget,this.refushcanPlayList),this.list2.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.list2Tap,this),this.addTouchEvent(this.btn,this.onTap),this.addTouchEvent(this.attackBoss,this.onTap),this.addTouchEvent(this.attackPlayer,this.onTap),this.addTouchEvent(this.belongGroup,this.onTap),this.addTouchEvent(this.tipBtn,this.onTap),this.addTouchEvent(this.attguishu,this.onTap),TimerManager.ins().remove(this.reflashAtkInfo,this),TimerManager.ins().doTimer(200,0,this.reflashAtkInfo,this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.hudun.visible=!1,this.visible=!0,this.attList.visible=this.attackBtnGroup.visible=""==UserBoss.ins().winner,this.updateBaseInfo(),this.refushShowInfo(),this.reflashAtkInfo(),this.refushWeixieList(),this.refushcanPlayList(),this.reflashBlood()},e.prototype.updateBaseInfo=function(){this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID],this.bossConfig&&(this._curMonsterID=UserBoss.ins().monsterID,this.nameTxt.text=this.bossConfig.name,this.head.source="monhead"+this.bossConfig.head+"_png",this.lvTxt.text="Lv."+this.bossConfig.level)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.clickEffc),DisplayUtils.removeFromParent(this.nextEff),DisplayUtils.removeFromParent(this.pointEff),this.list2.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.list2Tap,this),this.clearRendererItem(),this._curMonsterID=0},e.prototype.refushShowInfo=function(){this.leftTimeGroup.visible=!1,this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4),TimerManager.ins().isExists(this.showInfoTime,this)||TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().acEndTime,this.showInfoTime,this)},e.prototype.showInfoTime=function(){this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4)},e.prototype.reflashAtkInfo=function(){var t=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(UserBoss.ins().attHandle));if(t&&t.length>0){for(var e=t.length,i=0,s=0,n=0,o=0,a=void 0,r=0;e>r;r++){var h=t[r];if(h instanceof CharRole){var l=h.infoModel.getAtt(AttributeType.atHp)||0,c=h.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=l,s+=c;var u=h.infoModel.getAtt(AttributeType.cruNeiGong)||0,p=h.infoModel.getAtt(AttributeType.maxNeiGong)||0;n+=u,o+=p,a||(a=h.infoModel)}}this.belongGroup.visible=i>0&&""==UserBoss.ins().winner;var d=Actor.handle!=UserBoss.ins().attHandle?ColorUtil.ROLENAME_COLOR_YELLOW:ColorUtil.ROLENAME_COLOR_GREEN,g=a.name,f=g.split("\n");g=f[1]?f[1]:f[0],g=StringUtils.replaceStr(g,"0xffffff",d+""),this.belongNameTxt.textFlow=TextFlowMaker.generateTextFlow("|C:"+d+"&T:"+g),this.roleHead.source="yuanhead"+a.job+a.sex,this.bloodBar0.maximum=s,this.bloodBar0.value=i,this.neigongBar0.maximum=o,this.neigongBar0.value=n}else this.belongGroup.visible=!1},e.prototype.refushWeixieList=function(){this.isDelayUpdate||(this.isDelayUpdate=!0,TimerManager.ins().doTimer(500,1,this.updateWeixieList,this))},e.prototype.updateWeixieList=function(){this.isDelayUpdate=!1,UserBoss.ins().weixieList.length>this.lastWeixieList.length&&this.showAttGroupEff();var t=this.getWeixieList();if(this.list2.dataProvider){var e=this.list2.dataProvider;e.replaceAll(t)}else this.list2.dataProvider=new eui.ArrayCollection(t);if(this.lastWeixieList=UserBoss.ins().weixieList.slice(),this.list1.dataProvider){var e=this.list1.dataProvider;e.replaceAll([GameLogic.ins().currAttackHandle])}else this.list1.dataProvider=new eui.ArrayCollection([GameLogic.ins().currAttackHandle]);this.checkListVis(),UserBoss.ins().weixieList.length&&this.checkGuide()},e.prototype.getWeixieList=function(){for(var t=UserBoss.ins().weixieList,e=[],i=0,s=t;i<s.length;i++){var n=s[i],o=EntityManager.ins().getMasterList(n),a=void 0;if(o&&o.length){for(var r=0,h=o;r<h.length;r++){var l=h[r];if(l instanceof CharRole){a=l;break}}a||(a=o[0])}else a=EntityManager.ins().getEntityByHandle(n);a&&e.push(a)}return e},e.prototype.showAttGroupEff=function(){var t=this;if(!this.attEffectGroup.visible){this.attEffectGroup.touchEnabled=!1,this.attEffectGroup.visible=!0;var e=egret.Tween.get(this.attEffectGroup);e.to({alpha:1},500).to({alpha:0},500).to({alpha:1},500).to({alpha:0},500).call(function(){t.attEffectGroup.visible=!1},this)}},e.prototype.refushcanPlayList=function(){this.reflashAtkInfo(),this.checkListVis(),this.refushWeixieList()},e.prototype.checkListVis=function(){var t=EntityManager.ins().getNoDieRole(),e=t&&t.infoModel.getAtt(AttributeType.atHp)>0&&""==UserBoss.ins().winner;this.beAttackGroup.visible=UserBoss.ins().weixieList.length>0&&e,this.attackGroup.visible=e,this.setBtnState(e)},e.prototype.checkGuide=function(){1==UserFb.ins().guideBossKill&&GuideUtils.ins().updateByAppear()},e.prototype.setBtnState=function(t){return this.attguishu.visible=!0,t?(UserBoss.ins().attHandle==Actor.handle?(this.attackPlayer.currentState="attgsdis",this.attguishu.visible=!1):GameLogic.ins().currAttackHandle?this.attackPlayer.currentState="attgsing":this.attackPlayer.currentState="attgsup",void(GameLogic.ins().currAttackHandle||"attgsing"==this.attackPlayer.currentState?this.attackBoss.currentState="attbossup":this.attackBoss.currentState="attbossing")):(this.attackPlayer.currentState="attgsup",void(this.attackBoss.currentState="attbossup"))},e.prototype.onBegin=function(t){switch(t.currentTarget){case this.attackPlayer:this.attackPlayer.scaleX=this.attackPlayer.scaleY=.8;break;case this.attackBoss:this.attackBoss.scaleX=this.attackBoss.scaleY=.8}},e.prototype.onEnd=function(t){switch(t.currentTarget){case this.attackPlayer:this.attackPlayer.scaleX=this.attackPlayer.scaleY=1;break;case this.attackBoss:this.attackBoss.scaleX=this.attackBoss.scaleY=1;break;default:this.attackPlayer.scaleX=this.attackPlayer.scaleY=1,this.attackBoss.scaleX=this.attackBoss.scaleY=1}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn:"down"==this.btn.currentState?this.list1.dataProvider=new eui.ArrayCollection([]):this.refushcanPlayList();break;case this.attackBoss:if(0==GameLogic.ins().currAttackHandle)return;this.clearRendererItem(),GameLogic.ins().postChangeAttrPoint(0);break;case this.attackPlayer:case this.belongGroup:if(UserBoss.ins().attHandle==Actor.handle||UserBoss.ins().attHandle==GameLogic.ins().currAttackHandle)return;if(!this.list1||this.list1.dataProvider.length<=0)return;if(!UserBoss.ins().canClick)return;this.clearRendererItem(),GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS?UserFb.ins().sendGuideFbAttacker():GameLogic.ins().postChangeAttrPoint(UserBoss.ins().attHandle);break;case this.tipBtn:GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS?ViewManager.ins().open(WorldBossJiangliTipWin):ViewManager.ins().open(PublicBossJiangliTipWin);break;case this.attguishu:UserTips.ins().showTips("正在攻击归属者！")}},e.prototype.list2Tap=function(t){if(UserBoss.ins().canClick&&UserBoss.ins().attHandle!=GameLogic.ins().currAttackHandle){var e=this.list2.getChildAt(t.itemIndex);if(e){this.clearRendererItem(),e.addAttEffect();var i=e.data;e.data instanceof CharMonster&&(i=e.data.infoModel.masterHandle),GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS?UserFb.ins().sendGuideFbAttacker():GameLogic.ins().postChangeAttrPoint(i),UserBoss.ins().attHandle!=i&&EntityShowMgr.ins().showHideSomeOne(i)}}},e.prototype.clearRendererItem=function(){for(var t=this.list1.numChildren,e=0;t>e;e++){var i=this.list1.getChildAt(e);i.clearEffect()}t=this.list2.numChildren;for(var e=0;t>e;e++){var i=this.list2.getChildAt(e);i.clearEffect()}},e.prototype.reflashBlood=function(){if(this._curMonsterID!=UserBoss.ins().monsterID&&this.updateBaseInfo(),this.bossConfig=GlobalConfig.MonstersConfig[UserBoss.ins().monsterID],!this.bossConfig)return this.bossBloodGroup.visible=!1,void this.checkListVis();var t=EntityManager.ins().getEntityByHandle(UserBoss.ins().bossHandler);if(!t||!t.infoModel)return this.bossBloodGroup.visible=!1,void this.checkListVis();var e=t?t.infoModel:null;e?(this.bloodBar.maximum=e.getAtt(AttributeType.atMaxHp),this.bloodBar.value=e.getAtt(AttributeType.atHp),this.bossBloodGroup.visible=this.bloodBar.value>0):(this.bloodBar.maximum=this.bossConfig.hp,this.bloodBar.value=this.bossConfig.hp,this.bossBloodGroup.visible=this.bloodBar.value>0),this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100),this.tweenBlood()},e.prototype.huDunChange=function(){UserBoss.ins().shieldType?UserBoss.ins().curShield>0&&(TimerManager.ins().isExists(this.setTimeShieldChange,this)||TimerManager.ins().doTimer(1e3,0,this.setTimeShieldChange,this),this.setTimeShieldChange()):this.setHpShieldChange()},e.prototype.setHpShieldChange=function(){if(UserBoss.ins().curShield&&UserBoss.ins().curShield>0){this.hudun.visible=!0;var t=Math.ceil(UserBoss.ins().curShield/UserBoss.ins().totalShield*100);this.hudunbloodBar.value=t}else this.hudun.visible=!1},e.prototype.setTimeShieldChange=function(){this.hudunbloodBar.value=UserBoss.ins().curShield,this.hudunbloodBar.maximum=UserBoss.ins().totalShield,UserBoss.ins().curShield>0?this.hudun.visible=!0:(TimerManager.ins().remove(this.setTimeShieldChange,this),this.hudun.visible=!1),UserBoss.ins().curShield--},e.prototype.worldBossEnd=function(){var t=this;if(TimerManager.ins().remove(this.reflashAtkInfo,this),GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS){this.endGroup.visible=!0,this.winnerName.text="最终归属者是："+UserBoss.ins().winner;var e=Math.ceil((UserBoss.ins().worldBossEndTime-egret.getTimer())/1e3);this.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),TimerManager.ins().doTimer(1e3,e,function(){e--,t.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),0==e&&UserFb.ins().sendExitFb()},this)}this.attList.visible=this.attackBtnGroup.visible=this.attackPlayer.visible=this.attackBoss.visible=!1},e.prototype.reliveInfoChange=function(){UserBoss.ins().reliveTime>0?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin),this.refushWeixieList()},e.prototype.tweenBlood=function(){var t=this,e=this.curValue*this.GRAYIMG_WIDTH/100,i=this;if(egret.Tween.removeTweens(this.grayImgMask),!(3>e)){var s=egret.Tween.get(this.grayImgMask,{onChange:function(){i.grayImg&&(i.grayImg.mask=t.grayImgMask)}},i);s.to({width:e-3},1e3).call(function(){0>=e&&(i.grayImgMask.width=this.GRAYIMG_WIDTH,egret.Tween.removeTweens(this.grayImgMask))},i)}},e}(BaseEuiView);__reflect(WorldBossUiInfo.prototype,"WorldBossUiInfo"),ViewManager.ins().reg(WorldBossUiInfo,LayerManager.UI_Main);var WorldBossWin=function(t){function e(){var e=t.call(this)||this;return e.selectIndex=0,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossSkin",this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=330,this.bossImage.y=380,this.challengeBtn.y=400},e}(BaseEuiView);__reflect(WorldBossWin.prototype,"WorldBossWin"),ViewManager.ins().reg(WorldBossWin,LayerManager.UI_Main);var Box=function(t){function e(){var e=t.call(this)||this;return e.arrOpenData=[],e.freeInfoList=[],e.sysId=PackageID.Box,e.regNetMsg(1,e.updateBoxData),e.regNetMsg(2,e.getBox),e.regNetMsg(3,e.updateTipsList),e.regNetMsg(5,e.getBoxNotice),e.regNetMsg(6,e.doShowRewardInfo),e.arrTips=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postUpdateData=function(){},e.prototype.postUpdateFreeBox=function(){},e.prototype.getGridInfoById=function(t){for(var e=0;e<this.arrOpenData.length;e++)if(this.arrOpenData[e].pos==t)return this.arrOpenData[e];return null},e.prototype.isHaveFreePos=function(){for(var t=0,e=0;e<this.arrOpenData.length;e++)2==this.arrOpenData[e].state&&this.arrOpenData[e].getTime()>0&&++t;var i=UserVip.ins().lv>=GlobalConfig.TreasureBoxBaseConfig.thirdOpenLevel?2:1;return i>t},e.prototype.updateBoxQueue=function(){},e.prototype.canAdd=function(){for(var t=1;4>t;t++)if(this.arrOpenData[t].canUsed&&0==this.arrOpenData[t].itemId)return!0;return!1},e.prototype.getAddIndex=function(){for(var t=1;4>t;t++)if(this.arrOpenData[t].canUsed&&0==this.arrOpenData[t].itemId)return t;return 0},e.prototype.updateBoxData=function(t){var e=t.readShort();this.arrOpenData=[];for(var i=0;e>i;i++){var s=new BoxOpenData;s.updateData(t),this.arrOpenData.push(s)}e=t.readShort(),this.freeInfoList=[];for(var i=0;e>i;i++){var s=new BoxFreeData;s.updateData(t),this.freeInfoList.push(s)}TimerManager.ins().removeAll(this),this.postUpdateData()},e.prototype.sendOpen=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.getBox=function(t){UserTips.ins().showBoxTips(t.readShort())},e.prototype.sendAddToQueue=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.updateTipsList=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=new BoxTipsData;s.id=t.readShort(),s.name=t.readString(),this.arrTips.push(s)}this.postUpdateData()},e.prototype.sendOpenFreeBox=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.getBoxNotice=function(t){UserTips.ins().showRewardBox(t.readShort())},e.prototype.doShowRewardInfo=function(t){for(var e=t.readShort(),i=t.readShort(),s=[],n=0;i>n;n++){var o=new RewardData;o.parser(t),s.push(o)}ViewManager.ins().open(BoxOpenWin,e,s)},e}(BaseSystem);__reflect(Box.prototype,"Box");var GameSystem;!function(t){t.box=Box.ins.bind(Box)}(GameSystem||(GameSystem={}));var BoxItemData=function(){function t(){}return t}();__reflect(BoxItemData.prototype,"BoxItemData");var BoxModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gridCfgList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getGridCfgList=function(){if(this.gridCfgList.length>0)return this.gridCfgList;var t=GlobalConfig.TreasureBoxGridConfig;for(var e in t)this.gridCfgList.push(t[e]);return this.gridCfgList},e.prototype.countBoxTimeCost=function(t,e){var i=GlobalConfig.TreasureBoxBaseConfig.moneyCoefficient,s=Math.ceil(t/60)*i,n=1,o=GlobalConfig.TreasureBoxConfig[e];return o&&(n=o.quality),s=Math.ceil(n*s)},e.prototype.getOtherBoxIsTimeDown=function(t){var e=0==t?1:0,i=Box.ins().freeInfoList[e];return i.getTime()<=0},e.prototype.getDownTimeIndex=function(){var t=Box.ins().freeInfoList[0],e=Box.ins().freeInfoList[1],i=t.getTime(),s=e.getTime();return s>0&&i>0?i>s?e.pos:t.pos:s>0&&0>=i?e.pos:0>=s&&i>0?t.pos:0},e.prototype.checkRedPointShow=function(){if(Actor.level<GlobalConfig.TreasureBoxBaseConfig.openLevel)return!1;var t=Box.ins(),e=t.freeInfoList[0],i=t.freeInfoList[1];if(!e||!i)return!1;if(e.getTime()<=0||i.getTime()<=0)return!0;for(var s=t.arrOpenData,n=t.isHaveFreePos(),o=0;o<s.length;o++){var a=s[o];if(a.itemId>0&&1==a.state&&n)return!0}return!1},e.prototype.checkCanTake=function(){var t=Box.ins(),e=t.freeInfoList[0],i=t.freeInfoList[1];if(!e||!i)return!1;if(e.getTime()<=0||i.getTime()<=0)return!0;for(var s=t.arrOpenData,n=0,o=s;n<o.length;n++){var a=o[n];if(a.itemId>0&&2==a.state&&a.getTime()<=0)return!0}return!1},e.prototype.getMinBoxTime=function(){for(var t=Box.ins().freeInfoList,e=Number.MAX_VALUE,i=0,s=t;i<s.length;i++){var n=s[i];n&&n.getTime()<e&&(e=n.getTime())}for(var o=Box.ins().arrOpenData,a=0,r=o;a<r.length;a++){var h=r[a];h.itemId>0&&2==h.state&&h.getTime()<e&&(e=h.getTime())}return e},e}(BaseClass);__reflect(BoxModel.prototype,"BoxModel");var BoxOpenData=function(){function t(){this.itemId=0,this.canUsed=!0}return t.prototype.updateData=function(t){this.pos=t.readShort(),this.itemId=t.readShort(),this.state=t.readShort(),this.remindTime=t.readInt(),this.updateTime=egret.getTimer()},t.prototype.getTime=function(){return Math.floor((1e3*this.remindTime+this.updateTime-egret.getTimer())/1e3)},t.prototype.getDetailData=function(){for(var t=GlobalConfig.TreasureBoxConfig[this.itemId].desc,e=GlobalConfig.TreasureBoxConfig[this.itemId].rewards,i=[],s=0;s<t.length;s++){var n=new BoxItemData;n.desc=t[s],n.reward=e[s],i.push(n)}return i},t}();__reflect(BoxOpenData.prototype,"BoxOpenData");var BoxFreeData=function(){function t(){this.statu=1}return t.prototype.updateData=function(t){this.pos=t.readShort(),this.remindTime=t.readInt(),this.updateTime=egret.getTimer()},t.prototype.getTime=function(){return Math.max(Math.floor((1e3*this.remindTime+this.updateTime-egret.getTimer())/1e3),0)},t}();__reflect(BoxFreeData.prototype,"BoxFreeData");var BoxRoomData=function(){function t(){this.itemId=0,this.canUsed=!0}return t.prototype.updateData=function(t){this.itemId=t.readShort(),this.itemId&&(this.name=GlobalConfig.TreasureBoxConfig[this.itemId].name)},t}();__reflect(BoxRoomData.prototype,"BoxRoomData");var BoxTipsData=function(){function t(){}return t}();__reflect(BoxTipsData.prototype,"BoxTipsData");var BoxBgWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="chestbgskin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.onTabTouch),this.observe(Book.ins().postDataChange,this.redUpdate),this.observe(Box.ins().postUpdateData,this.redUpdate),this.observe(Box.ins().postUpdateFreeBox,this.redUpdate),this.addTouchEvent(this.help,this.onBtnClick),this.tab.selectedIndex=this.viewStack.selectedIndex=t[0]||0,this._ext=t[1],this.setSelectedIndex(this.tab.selectedIndex),this.help.visible=!1,this.redUpdate()},e.prototype.close=function(){this.boxPanel.close(),this.bookPanel.close(),this.removeObserve()},e.prototype.redUpdate=function(){this.redPoint1.visible=BoxModel.ins().checkRedPointShow(),this.redPoint2.visible=Book.ins().getBookRed()},e.prototype.onBtnClick=function(t){switch(t.currentTarget){case this.help:ViewManager.ins().open(ZsBossRuleSpeak,11)}},e.prototype.onTabTouch=function(t){void 0===t&&(t=null),this.setSelectedIndex(this.tab.selectedIndex)},e.prototype.setSelectedIndex=function(t){this.help.visible=!1,0==t?this.boxPanel.open():1==t&&(this._ext?(this.bookPanel.open(this._ext),this._ext=null):this.bookPanel.open(),this.help.visible=!0)},e}(BaseEuiView);__reflect(BoxBgWin.prototype,"BoxBgWin"),ViewManager.ins().reg(BoxBgWin,LayerManager.UI_Main);var BoxDetailItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestShowItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.labelDesc.textFlow=TextFlowMaker.generateTextFlow1(t.desc),this.item.data=t.reward},e}(BaseItemRender);__reflect(BoxDetailItem.prototype,"BoxDetailItem");var BoxDetailWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestRewardSkin",e.list.dataProvider=null,e.list.itemRenderer=BoxDetailItem,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0];var i=GlobalConfig.TreasureBoxConfig[this.data.itemId];this.imgBox.source=i.imgClose,this.updateList(),this.endTime=this.data.getTime(),2==this.data.state?(this.currentState="payOpen",this.doTime(),TimerManager.ins().doTimer(1e3,this.endTime,this.doTime,this)):1==this.data.state&&Box.ins().isHaveFreePos()?(this.currentState="open",this.t3.text=DateUtils.getFormatBySecond(i.time)):(this.currentState="jiesuo",this.labelTime.text=DateUtils.getFormatBySecond(i.time),this.costMoney=BoxModel.ins().countBoxTimeCost(i.time,i.type),this.costNum.text=this.costMoney+"",UserVip.ins().lv<GlobalConfig.TreasureBoxBaseConfig.thirdOpenLevel?(this.labelVip.visible=!0,this.labelWarning.text="队列不足，只能同时解锁1个宝箱",this.labelVip.text="VIP"+GlobalConfig.TreasureBoxBaseConfig.thirdOpenLevel+" 可同时解锁2个宝箱"):(this.labelVip.visible=!1,this.labelWarning.text="队列不足，只能同时解锁2个宝箱")),this.addTouchEvent(this.rect,this.onTap),this.addTouchEvent(this.btnOpen,this.onTap)},e.prototype.close=function(){this.removeTouchEvent(this.rect,this.onTap),this.removeTouchEvent(this.btnOpen,this.onTap)},e.prototype.doTime=function(){this.endTime--,this.endTime<=-1?(TimerManager.ins().remove(this.doTime,this),Box.ins().sendOpen(this.data.pos),ViewManager.ins().close(e)):(this.labelTime.text=DateUtils.getFormatBySecond(this.endTime,1),this.costMoney=BoxModel.ins().countBoxTimeCost(this.endTime,this.data.itemId),this.costNum.text=this.costMoney+"")},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(this.data.getDetailData())},e.prototype.onTap=function(t){switch(t.target){case this.btnOpen:if(Actor.yb<this.costMoney)return UserTips.ins().showTips("元宝不足"),void ViewManager.ins().close(this);Box.ins().sendOpen(this.data.pos),ViewManager.ins().close(e);break;case this.rect:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(BoxDetailWin.prototype,"BoxDetailWin"),ViewManager.ins().reg(BoxDetailWin,LayerManager.UI_Popup);var BoxFreeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestSkinReward2",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.info=this.data,this.info){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);var t=BoxModel.ins().getDownTimeIndex();this.info.getTime()>0&&t==this.info.pos?(this.currentState="close",this.refushDaojishi(),TimerManager.ins().doTimer(1e3,0,this.refushDaojishi,this)):this.info.getTime()<=0?this.currentState="open":this.currentState="wait"}},e.prototype.refushDaojishi=function(){var t=this.info.getTime();this.labelTime.text=DateUtils.getFormatBySecond(t),0>=t&&(TimerManager.ins().removeAll(this),this.currentState="open",Box.ins().postUpdateFreeBox())},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.removeTimer()},e.prototype.removeTimer=function(){TimerManager.ins().removeAll(this)},e}(BaseItemRender);__reflect(BoxFreeItemRenderer.prototype,"BoxFreeItemRenderer");var BoxGetHintTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestInformationSkin",e.horizontalCenter=0,e.bottom=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=GlobalConfig.TreasureBoxConfig[t];e&&(this.information.text="恭喜获得"+e.name,this.box.source=e.imgClose)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(BoxGetHintTips.prototype,"BoxGetHintTips");var BoxOpenItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestStateOpenSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelTime.text="",TimerManager.ins().removeAll(this);var t=this.data;if(this.time=t.getTime(),!t.canUsed)return this.labelTips.text=""+t.openTips,void(this.currentState="tips");if(!t.itemId)return void(this.currentState="add");var e=GlobalConfig.TreasureBoxConfig[t.itemId];this.imgBox.source=e.imgClose,this.time>0?(TimerManager.ins().doTimer(1e3,this.time,this.updateTime,this),this.currentState="waiting"):this.currentState="canOpen"},e.prototype.updateTime=function(){this.time>0?(this.time--,this.labelTime.text=DateUtils.getFormatBySecond(this.time,1)):TimerManager.ins().removeAll(this)},e.prototype.destruct=function(){TimerManager.ins().removeAll(this)},e}(BaseItemRender);__reflect(BoxOpenItem.prototype,"BoxOpenItem");var BoxOpenWin=function(t){function e(){var e=t.call(this)||this;return e.rewardList=[],e.items=[],e.rollNum=0,e.index=0,e.skinName="ChestOpenRewardSkin",e.list.itemRenderer=ItemBase,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.conf=GlobalConfig.TreasureBoxConfig[i],this.rewardList=t[1],this.list.dataProvider=new eui.ArrayCollection(this.rewardList),this.addTouchEvent(this.bgClose,this.onTap),this.showTween()},e.prototype.close=function(){},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e.prototype.showTween=function(){var t=this;this.imgBox.source=this.conf.imgClose,this.rollNum=0;var e=egret.Tween.get(this.imgBox,{loop:!0});e.to({x:265},20).to({x:245},20).to({x:265},20).call(function(){++t.rollNum,t.rollNum>=9&&(egret.Tween.removeTweens(t.imgBox),t.rotationComplete())},this)},e.prototype.rotationComplete=function(){this.imgBox.source=this.conf.imgOpen,this.movieComplete()},e.prototype.movieComplete=function(){for(var t=this.rewardList.length,e=0,i=0;t>i;i++){this.items[i]=this.createItem(this.rewardList[i]);var s=egret.Tween.get(this.items[i]),n=i%5*96+3,o=106*Math.floor(i/5)+205;this.items[i].alpha=0,s.wait(e).to({x:n,y:o,alpha:1},200),e+=500}this.boxBgMc=this.boxBgMc||new MovieClip,this.boxBgMc.x=0,this.boxBgMc.y=50,this.boxBgMc.playFile(RES_DIR_EFF+"laddercircle",-1),this.bgGroup.addChild(this.boxBgMc)},e.prototype.createItem=function(t){var e=new ItemBase;return this.listCon.addChild(e),e.data=t,e.x=204,e.y=52,e},e.prototype.showUp=function(){var t=this.list.getElementAt(this.index);++this.index,t.visible=!0;var e=egret.Tween.get(t);e.to({alpha:0},200)},e}(BaseEuiView);__reflect(BoxOpenWin.prototype,"BoxOpenWin"),ViewManager.ins().reg(BoxOpenWin,LayerManager.UI_Main);var BoxPayItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestSkinState1",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=UserFb.ins().guanqiaID;if(egret.Tween.removeTweens(this.imgNeedle),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.imgNeedle.rotation=0,t.chapter>e)this.currentState="kong2",this.openDesc.text="第"+t.chapter+"关开启";
else{var i=Box.ins().getGridInfoById(t.pos);if(this.dataInfo=i,i&&i.itemId>0){var s=GlobalConfig.TreasureBoxConfig[i.itemId];s&&(this.baoxiang.source=s.imgClose),1==i.state?(s&&(this.boxName.text=s.name,this.jishi.text=DateUtils.getFormatBySecond(s.time,9)),Box.ins().isHaveFreePos()?this.currentState="wait2":this.currentState="wait3"):i.getTime()>0?(this.currentState="wait",this.refushDaojishi(),TimerManager.ins().doTimer(1e3,0,this.refushDaojishi,this),this.runTween()):this.currentState="open"}else this.currentState="kong"}},e.prototype.runTween=function(){this.imgNeedle.rotation=0,egret.Tween.removeTweens(this.imgNeedle);var t=egret.Tween.get(this.imgNeedle,{loop:!0});t.to({rotation:360},2e3)},e.prototype.refushDaojishi=function(){var t=this.dataInfo.getTime();this.t3.text=DateUtils.getFormatBySecond(t);var e=BoxModel.ins().countBoxTimeCost(t,this.dataInfo.itemId);this.payNum.text=e+"",0>=t&&(TimerManager.ins().removeAll(this),this.currentState="open",this.imgNeedle.rotation=0)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),TimerManager.ins().removeAll(this),egret.Tween.removeTweens(this.imgNeedle)},e}(BaseItemRender);__reflect(BoxPayItemRenderer.prototype,"BoxPayItemRenderer");var BoxRoomItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(!t.canUsed)return this.currentState="Tips",void(this.labelTips.text="通关到第"+t.openChapter+"开启");if(t.itemId){this.currentState="box";var e=GlobalConfig.TreasureBoxConfig[t.itemId];this.imgBox.source=e.imgClose,this.labelName.text=e.name}else this.currentState="room"},e}(BaseItemRender);__reflect(BoxRoomItem.prototype,"BoxRoomItem");var BoxTipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestInformationSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e="|C:0x12b2ff&T:";e+=t.name+"|在宝箱中获得";var i=GlobalConfig.ItemConfig[t.id];e+="|C:"+ItemConfig.getQualityColor(i)+"&T:"+i.name+"|",this.label.textFlow=TextFlowMaker.generateTextFlow1(e)},e}(BaseItemRender);__reflect(BoxTipsItem.prototype,"BoxTipsItem");var BoxWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChestSkin",e.name="宝箱",e}return __extends(e,t),e.prototype.createChildren=function(){this.listBox.itemRenderer=BoxPayItemRenderer},e.prototype.open=function(){this.addTouchEvent(this.listBox,this.onListTap),this.addTouchEvent(this.box1,this.onTap),this.addTouchEvent(this.box2,this.onTap),this.observe(Box.ins().postUpdateData,this.setGridInfo),this.observe(Box.ins().postUpdateFreeBox,this.setFreeBox),this.setGridInfo()},e.prototype.close=function(){this.removeTouchEvent(this.box1,this.onTap),this.removeTouchEvent(this.box2,this.onTap),this.removeTouchEvent(this.listBox,this.onListTap),this.removeObserve(),this.box1.removeTimer(),this.box2.removeTimer()},e.prototype.setGridInfo=function(){this.listBox.dataProvider=new eui.ArrayCollection(BoxModel.ins().getGridCfgList()),this.setFreeBox()},e.prototype.setFreeBox=function(){var t=0,e=Box.ins().freeInfoList[0];this.box1.data=e,e.getTime()<=0&&++t,e=Box.ins().freeInfoList[1],this.box2.data=e,e.getTime()<=0&&++t,this.freeNum.text="("+t+"/2)"},e.prototype.onListTap=function(t){var e=t.target.parent;if(e&&e.data){var i=e.data,s=UserFb.ins().guanqiaID;if(i.chapter>s)return void UserTips.ins().showTips("通关条件不足，无法获得新的宝箱位");var n=Box.ins().getGridInfoById(e.data.pos);n&&n.itemId>0?2==n.state&&n.getTime()<=0?Box.ins().sendOpen(n.pos):ViewManager.ins().open(BoxDetailWin,n):UserWarn.ins().setBuyGoodsWarn(GlobalConfig.TreasureBoxBaseConfig.getItemguide,1)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.box1:"open"==this.box1.currentState&&Box.ins().sendOpenFreeBox(1);break;case this.box2:"open"==this.box2.currentState&&Box.ins().sendOpenFreeBox(2)}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Actor.level>=GlobalConfig.TreasureBoxBaseConfig.openLevel?!0:(UserTips.ins().showTips(GlobalConfig.TreasureBoxBaseConfig.openLevel+"级开启宝箱"),!1)},e}(BaseEuiView);__reflect(BoxWin.prototype,"BoxWin"),ViewManager.ins().reg(BoxWin,LayerManager.UI_Main);var BtnHejiWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="BtnHejiSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.heji,this.onTap),PaoDianCC.ins().isPaoDian&&(this.y=200),this.hejiState(Setting.ins().getValue(ClientSet.autoHeji))},e.prototype.onTap=function(){var t=Setting.ins().getValue(ClientSet.autoHeji)>0?0:1;this.hejiState(t),Setting.ins().setValue(ClientSet.autoHeji,t)},e.prototype.hejiState=function(t){this.heji.icon=t&&0!=t?"heji_png":"noheji_png"},e}(BaseEuiView);__reflect(BtnHejiWin.prototype,"BtnHejiWin"),ViewManager.ins().reg(BtnHejiWin,LayerManager.UI_Popup);var CDKey=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.CDKey,e.regNetMsg(1,e.doChangeResult),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendCdkey=function(t){if(t.length<=0)return void UserTips.ins().showTips("|C:0xf3311e&T:请输入激活码|");var e=this.getBytes(1);e.writeString(t),this.sendToServer(e)},e.prototype.doChangeResult=function(t){var e,i=t.readByte();switch(i){case 0:e="|C:0x35e62d&T:兑换成功,请在邮件中领取奖励|";break;case 1:e="|C:0xf3311e&T:激活码已被使用|";break;case 2:e="|C:0xf3311e&T:激活码不存在|";break;case 3:e="|C:0xf3311e&T:已使用过同类型|";break;case 4:e="|C:0xf3311e&T:兑换失败|"}UserTips.ins().showTips(e)},e}(BaseSystem);__reflect(CDKey.prototype,"CDKey");var GameSystem;!function(t){t.cdkey=CDKey.ins.bind(CDKey)}(GameSystem||(GameSystem={}));var CDKeyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CDkeySkin",this.input.maxChars=28},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sendBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.sendBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.sendBtn:CDKey.ins().sendCdkey(this.input.text)}},e}(BaseEuiView);__reflect(CDKeyWin.prototype,"CDKeyWin"),ViewManager.ins().reg(CDKeyWin,LayerManager.UI_Main);var Chat=function(t){function e(){var e=t.call(this)||this;return e.isShowTip=!1,e.chatInterval=5e3,e.charMax=50,e.canSpeak=!0,e.UpSpeak="",e.canSpeakTime=0,e.initData(),e.sysId=PackageID.Chat,e.regNetMsg(1,e.doNewChatMsg),e.regNetMsg(2,e.doSystemInfo),e.regNetMsg(3,e.doIsSendSuccess),e.regNetMsg(4,e.doSystemMessage),e.regNetMsg(5,e.doCannotSpeak),e}return __extends(e,t),e.prototype.initData=function(){this._chatListData||(this._chatListData=new eui.ArrayCollection),this._systemListData||(this._systemListData=new eui.ArrayCollection),this._chatListData2||(this._chatListData2=new eui.ArrayCollection),this._chatListData.removeAll(),this._systemListData.removeAll(),this._chatListData2.removeAll()},e.ins=function(){return t.ins.call(this)},e.prototype.sendChatInfo=function(t,e,i){if(void 0===i&&(i=0),e.length<=0)return void UserTips.ins().showTips("|C:0xf3311e&T:请输入聊天内容|");if("@"==e.charAt(0)){var s=this.getBytes(0);return s.writeString(e),void this.sendToServer(s)}var n=this.getBytes(1);n.writeByte(t),n.writeUnsignedInt(i),n.writeString(e),this.sendToServer(n),7==t&&this.isCanSpeak()&&ReportData.getIns().reportChat(e,4)},e.prototype.doNewChatMsg=function(t){var e=new ChatInfoData(t);-1==Friends.ins().indexOfBlackList(e.id)&&this.insertChatMsg(e)},e.prototype.insertChatMsg=function(t){if(this._chatListData||(this._chatListData=new eui.ArrayCollection),this._chatListData.length>=this.charMax){var e=this._chatListData.removeItemAt(0);this.removeAllChatMsg(e)}this._chatListData.addItem(t),this.insertAllChatMsg(t),this.postNewChatMsg(t)},e.prototype.insertAllChatMsg=function(t){this._chatListData2||(this._chatListData2=new eui.ArrayCollection),this._chatListData2.addItem(t)},e.prototype.removeAllChatMsg=function(t){var e=this._chatListData2.getItemIndex(t);e>=0&&this._chatListData2.removeItemAt(e)},e.prototype.removeChatWithId=function(t){if(this._chatListData&&this._chatListData.length){for(var e=[],i=0;i<this._chatListData.length;i++){var s=this._chatListData.getItemAt(i);s.id!=t&&e.push(s)}this._chatListData.source=e,this._chatListData.refresh()}},e.prototype.postNewChatMsg=function(t){return t},e.prototype.doSystemInfo=function(t){},e.prototype.doIsSendSuccess=function(t){t.readBoolean()&&this.postSendInfoSuccess()},e.prototype.postSendInfoSuccess=function(){},e.prototype.doSystemMessage=function(t){var e=t.readInt(),i=t.readInt(),s=t.readString();if(0==e||Actor.level>=e)switch(i){case 8:UserTips.ins().showCenterTips2(s);break;case 4:ErrorLog.ins().show(s);break;case 2:UserTips.ins().showCenterTips(s);break;default:UserTips.ins().showTips(s)}},e.prototype.doCannotSpeak=function(t){this.canSpeakTime=t.readInt()},e.prototype.isCanSpeak=function(){return this.canSpeakTime&&this.canSpeakTime>GameServer.serverTime/1e3?!1:!0},Object.defineProperty(e.prototype,"chatListData",{get:function(){return this._chatListData||(this._chatListData=new eui.ArrayCollection),this._chatListData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatListData2",{get:function(){return this._chatListData2||(this._chatListData2=new eui.ArrayCollection),this._chatListData2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatListTip",{get:function(){this._chatListData||(this._chatListData=new eui.ArrayCollection([]));var t,e,i=this._chatListData.length;return i>2?(t=i-2,e=i):(t=0,e=i),this._chatListData.source.slice(t,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatListTip2",{get:function(){this._chatListData2||(this._chatListData2=new eui.ArrayCollection([]));var t,e,i=this._chatListData2.length;return i>2?(t=i-2,e=i):(t=0,e=i),this._chatListData2.source.slice(t,e)},enumerable:!0,configurable:!0}),e.prototype.startInterval=function(){this.canSpeak=!1,TimerManager.ins().doTimer(this.chatInterval,1,this.timeDo,this)},e.prototype.timeDo=function(){this.canSpeak=!0},e.prototype.postSysChatMsg=function(t){if(this._systemListData.length>=this.charMax){var e=this._systemListData.removeItemAt(0);this.removeAllChatMsg(e)}return this._systemListData.addItem(t),this.insertAllChatMsg(t),t},Object.defineProperty(e.prototype,"systemListData",{get:function(){return this._systemListData||(this._systemListData=new eui.ArrayCollection([])),this._systemListData},enumerable:!0,configurable:!0}),e.prototype.checkRepeatString=function(t){var e=t.length;if(10>=e)return!0;for(var i=0,s=0;e>s;s++){var n=t.charAt(s);-1!=this.UpSpeak.lastIndexOf(n)&&++i}return i>=10?(UserTips.ins().showTips("|C:0xf3311e&T:输入的内容重复过多|"),!1):!0},e.prototype.getWorldStr=function(){return KFServerSys.ins().isKF||KFBossSys.ins().isKFBossBattle?"跨服":"世界"},e}(BaseSystem);__reflect(Chat.prototype,"Chat");var GameSystem;!function(t){t.chat=Chat.ins.bind(Chat)}(GameSystem||(GameSystem={}));var ChatMainUI=function(t){function e(){var e=t.call(this)||this;return e.resId=["xlt_98","xlt_99"],e.fistOpenGuild=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChatMainSkin",this.chatList.itemRenderer=ChatListItemRenderer2,this.chatList.itemRendererSkinName="ChatItemSkin2",this.dataList=new eui.ArrayCollection([]),this.chatList.dataProvider=this.dataList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.message,this.onTap),this.addTouchEvent(this.chatList,this.onTap),this.observe(Chat.ins().postSysChatMsg,this.getNewNotice),this.observe(Chat.ins().postNewChatMsg,this.updateNewChatMsg),this.observe(GameLogic.ins().postEnterMap,this.checkShow),this.observe(UserTask.ins().postUpdteTaskTrace,this.updateTipShow),this.updataList(),this.updateTipShow(),this.setChatTipShow(Chat.ins().isShowTip),this.checkShow()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.message:case this.chatList:ViewManager.ins().open(ChatWin)}},e.prototype.getNewNotice=function(t){7==t.type?(this.chat||(this.chat=new ChatTipsView,this.chat.y=this.message.y+12,this.chat.x=this.message.x+50),this.chat.parent||this.addChildAt(this.chat,0),this.chat.setData(t)):3==t.type&&this.updataList()},e.prototype.updateNewChatMsg=function(){this.fistOpenGuild&&(this.fistOpenGuild=!1,Guild.ins().guildID&&Guild.ins().sendAllGuildMessage()),this.updataList()},e.prototype.updataList=function(){this.dataList.replaceAll(Chat.ins().chatListTip2.concat())},e.prototype.checkShow=function(){var t=GameMap.fubenID;this.updataLayer(0!=t),this.updataList()},e.prototype.updataLayer=function(t){t?this.chatGroup.y=616:this.chatGroup.y=546},e.prototype.setChatTipShow=function(t){this.chatList.visible=!0},e.prototype.updateTipShow=function(){var t=!0;this.setChatTipShow(t)},e.prototype.destoryView=function(){t.prototype.destoryView.call(this,!1)},e}(BaseEuiView);__reflect(ChatMainUI.prototype,"ChatMainUI"),ViewManager.ins().reg(ChatMainUI,LayerManager.UI_Popup);var ChatWin=function(t){function e(){var e=t.call(this)||this;return e.cruIndex=0,e.dataList=new eui.ArrayCollection,e.fistOpenGuild=!0,e.isStretch=!1,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChatSkin",this.defaultText="点击输入咨询内容",this.chatInput.maxChars=30,this.input.maxChars=100,this.tabData=new eui.ArrayCollection,this.tab.dataProvider=this.tabData,this.chatList.touchEnabled=!1},e.prototype.refTab=function(){var t=Chat.ins().getWorldStr(),e=["综合",t,"行会","系统"];LocationProperty.appid!=PlatFormID.GE_TUI&&e.push("客服"),this.tabData.replaceAll(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0==this.input.text.length?(this.input.text=this.defaultText,this.input.textColor=7105644):this.input.textColor=14668213,this.addTouchEvent(this.chatList,this.onListTap),this.addTouchEvent(this.upBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sendBtn,this.onTap),this.addTouchEvent(this.allReceiveBtn,this.onTap),this.observe(Chat.ins().postNewChatMsg,this.getNewOne),this.chatInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.observe(Chat.ins().postSendInfoSuccess,this.textInOn),this.addChangeEvent(this.tab,this.selectIndexChange),this.addChangingEvent(this.tab,this.checkIsOpen),this.addTouchEvent(this.sendBtn0,this.onTap),this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this),this.observe(Guild.ins().postGetNewGuildMessage,this.getNewOneGuild),this.observe(Guild.ins().postAllGuildMessage,this.updataList),this.observe(UserMail.ins().postMailDetail,this.setOpenMail),this.observe(UserMail.ins().postMailData,this.onSendMail),this.observe(Guild.ins().postQuitGuild,this.updateMsgRedPoint),this.observe(GameLogic.ins().postEnterMap,this.updateMsgRedPoint),this.addTouchEvent(this.chatList,this.onSendMail),2!=this.cruIndex||Guild.ins().guildID?this.cruIndex>2&&(this.cruIndex=0):this.cruIndex=0,this.refTab(),this.backSelect(this.cruIndex),this.selectIndexChange(null),this.addDataProviderEvent()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.chatInput.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this),WatcherUtil.removeFromArrayCollection(Chat.ins().chatListData),WatcherUtil.removeFromArrayCollection(Guild.ins().guildMessageInfoData),WatcherUtil.removeFromArrayCollection(Chat.ins().systemListData),this.removeDataProviderEvent(),WatcherUtil.removeFromArrayCollection(this.tab.dataProvider),this.chatList.dataProvider=null},e.prototype.destoryView=function(){},e.prototype.addDataProviderEvent=function(){this.chatList.dataProvider&&this.chatList.dataProvider.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this)},e.prototype.removeDataProviderEvent=function(){this.chatList.dataProvider&&this.chatList.dataProvider.removeEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this)},e.prototype.updateInput=function(){this.input.text==this.defaultText&&(this.input.text="",this.input.textColor=14668213)},e.prototype.checkIsOpen=function(t){var e=t.target;return 2!=e.selectedIndex||Guild.ins().guildID?void 0:(UserTips.ins().showTips("请先加入公会"),void t.preventDefault())},e.prototype.selectIndexChange=function(t){this.oldChangle=this.cruIndex,this.cruIndex=this.tab.selectedIndex,this.updataList(!0),2==this.cruIndex&&this.fistOpenGuild&&(this.fistOpenGuild=!1,Guild.ins().sendAllGuildMessage())},e.prototype.backSelect=function(t){this.tab.selectedIndex=t},e.prototype.onSendMail=function(t){if(t&&5==this.cruIndex){var e=t.target.parent;if(e){var i=e.data;i&&UserMail.ins().sendMailContentData(i.handle)}}},e.prototype.setOpenMail=function(t){if(5==this.cruIndex)for(var e=0;e<this.chatList.numChildren;e++){var i=this.chatList.getChildAt(e);if(i.data.handle==t.handle){i.data=t;break}}},e.prototype.updataList=function(t){switch(void 0===t&&(t=!1),this.cruIndex){case 0:this.currentState="all",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRenderer=ChatListItemRenderer3,this.chatList.dataProvider=Chat.ins().chatListData2,this.chatList.itemRendererSkinName="ChatItemSkin3",this.addDataProviderEvent();break;case 1:this.currentState="world",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRendererSkinName="ChatItemSkin",this.chatList.dataProvider=Chat.ins().chatListData,this.chatList.itemRenderer=ChatListItemRenderer,this.addDataProviderEvent();break;case 2:this.currentState="guild",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRendererSkinName="ChatGuildItemSkin",this.chatList.itemRenderer=ChatGuildItemRender,this.chatList.dataProvider=Guild.ins().guildMessageInfoData,this.addDataProviderEvent();break;case 3:this.currentState="sys",this.removeDataProviderEvent(),this.chatList.itemRenderer=ChatSystemItemRenderer,this.chatList.dataProvider=Chat.ins().systemListData,this.addDataProviderEvent();break;case 4:this.currentState="customService",this.removeDataProviderEvent()}this.listDataChange(),this.updateMsgRedPoint()},e.prototype.updateMsgRedPoint=function(){return KFServerSys.ins().isKF?void(this.redPoint2.visible=!1):(2==this.tab.selectedIndex&&(Guild.ins().hasNewMsg=!1),void(this.redPoint2.visible=Guild.ins().hasNewMsg))},e.prototype.getNewOne=function(t){-1==Friends.ins().indexOfBlackList(t.id)&&(this.refushBar(),this.updateMsgRedPoint())},e.prototype.getNewOneGuild=function(t){-1==Friends.ins().indexOfBlackList(t.id)&&this.refushBar()},e.prototype.listDataChange=function(){4!=this.cruIndex&&(5==this.cruIndex?this.refushBarListTop():this.refushBar())},e.prototype.refushBar=function(){TimerManager.ins().doTimer(100,1,this.refushBarList,this)},e.prototype.refushBarList=function(){this.barList.viewport.validateNow(),this.barList.viewport.contentHeight>this.barList.height&&(this.barList.viewport.scrollV=this.barList.viewport.contentHeight-this.barList.height)},e.prototype.refushBarListTop=function(){this.barList.viewport.scrollV=0},e.prototype.textInOn=function(){this.chatInput.text=""},e.prototype.callBack=function(){this.input.text=""},e.prototype.setStretchWin=function(){this.isStretch?(this.isStretch=!1,this.upBtn.scaleY=1,this.winGroup.height=e.LITTLE_HEIGHT):(this.isStretch=!0,this.upBtn.scaleY=-1,this.winGroup.height=e.BIG_HEIGHT),this.updataList()},e.prototype.allReceiveMail=function(){for(var t=[],e=UserMail.ins().getMailByReceive(),i=0;i<e.length;i++)t.push(e[i].handle);UserMail.ins().sendGetItem(t)},e.prototype.onListTap=function(){var t=this.chatList.selectedItem;if(t&&(t instanceof ChatInfoData||t instanceof GuildMessageInfo||t instanceof ChatSystemData)){if(t instanceof ChatSystemData){var e=t.str;if(e&&e.indexOf("|E:")>=0)return void this.onLink(e)}void 0!=t.lv&&ViewManager.ins().open(PlayerTipsWin,t)}},e.prototype.onLink=function(t){var e=t.indexOf("|E:");t=t.slice(e+3,Number.MAX_VALUE);var i;if(t.indexOf(",")>=0?i=t.split(","):t.indexOf("*")>=0&&(i=t.split("*")),i&&!(i.length<=0))switch(i[0]){case"1":UserFb.ins().sendEnterTFRoom(+i[1]);break;case"2":KfArenaSys.ins().sendJoinTeam(+i[1])}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.upBtn:this.setStretchWin(),this.refushBar();break;case this.closeBtn0:ViewManager.ins().close(this);break;case this.sendBtn:if(2!=this.cruIndex&&!OpenSystem.ins().checkSysOpen(SystemType.CHAT))return void UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.CHAT));if(!Chat.ins().canSpeak)return void UserTips.ins().showTips("|C:0xf3311e&T:发言次数过快|");if("点击输入聊天内容"==this.chatInput.text)return void UserTips.ins().showTips("|C:0xf3311e&T:请输入聊天内容|");if(Chat.ins().startInterval(),2==this.cruIndex)Guild.ins().sendGuildMessage(this.chatInput.text),this.chatInput.text="";else{if(this.chatInput.text.indexOf("@")>-1)return GameLogic.ins().sendGMCommad(this.chatInput.text),void("@version"==this.chatInput.text?WarnWin.show(Version.BUILD_NUMBER,null,this,null,null,"sure"):"@player"==this.chatInput.text&&PlayerAttrManager.ins().getAttr());Chat.ins().checkRepeatString(this.chatInput.text)&&(Chat.ins().sendChatInfo(7,this.chatInput.text),Chat.ins().UpSpeak=this.chatInput.text,this.chatInput.text="")}break;case this.sendBtn0:if(0==this.input.text.length||this.input.text==this.defaultText)return void UserTips.ins().showTips("内容不能为空");if(this.input.text.indexOf("@")>-1)return void GameLogic.ins().sendGMCommad(this.input.text);if(this.input.text.indexOf("$")>-1){parseInt(this.input.text.slice(1));return}ReportData.getIns().advice(this.input.text,this.callBack,this)}},e}(BaseEuiView);ChatWin.BIG_HEIGHT=850,ChatWin.LITTLE_HEIGHT=370,__reflect(ChatWin.prototype,"ChatWin"),ViewManager.ins().reg(ChatWin,LayerManager.UI_Popup);var ByteArrayMsgByProtobuf=function(t){function e(){var i=t.call(this)||this;i.msgClass=null,i.protoConfig=null,i.protoConfigSymmetry=null,i.ProtoFile=null,i.msgClass={},i.protoConfig=e.ProtoConfig,i.protoConfigSymmetry={};for(var s=Object.keys(i.protoConfig),n=0,o=s.length;o>n;n++){var a=s[n],r=i.protoConfig[a];i.protoConfigSymmetry[r]=a}return i}return __extends(e,t),e.prototype.getMsgClass=function(t){var e=this.msgClass[t];return null==e&&(e=this.ProtoFile.build(t),this.msgClass[t]=e),e},e.prototype.getMsgID=function(t){return this.protoConfigSymmetry[t]},e.prototype.getMsgKey=function(t){return this.protoConfig[t]},e.prototype.decode=function(t){var e=t.readShort(),i=t.readShort();if(t.bytesAvailable>=i){var s=new egret.ByteArray;t.readBytes(s,0,i);var n={};return n.key=this.getMsgKey(e),DebugUtils.start("Protobuf Decode"),n.body=this.getMsgClass(n.key).decode(s.buffer),DebugUtils.stop("Protobuf Decode"),Log.trace("收到数据：","["+e+" "+n.key+"]",n.body),n}return null},e.prototype.encode=function(t){var e=this.getMsgID(t.key),i=new(this.getMsgClass(t.key))(t.body);DebugUtils.start("Protobuf Encode");var s=new egret.ByteArray(i.toArrayBuffer());DebugUtils.stop("Protobuf Encode"),Log.trace("发送数据：","["+e+" "+t.key+"]",t.body);var n=new egret.ByteArray;return n.writeShort(e),n.writeBytes(s),n},e}(ByteArrayMsg);ByteArrayMsgByProtobuf.ProtoConfig=null,__reflect(ByteArrayMsgByProtobuf.prototype,"ByteArrayMsgByProtobuf");var ChatInfoData=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i.type=0,i.id=0,i.servId=0,i.name="",i.job=0,i.sex=0,i.vip=0,i.monthCard=0,i.ladderLevel=0,i.pointId=0,i.str="",i.isFirst=0,i.zsLevel=0,i.lv=0,i.guild="",i.titleId=0,e&&(i.type=e.readByte(),i.id=e.readUnsignedInt(),i.servId=e.readInt(),i.name=e.readString(),i.job=e.readByte(),i.sex=e.readByte(),i.vip=e.readByte(),i.monthCard=e.readByte(),i.ladderLevel=e.readByte(),i.isFirst=e.readByte(),i.zsLevel=e.readUnsignedByte(),i.lv=e.readShort(),i.guild=e.readString(),i.pointId=e.readUnsignedInt(),i.str=e.readString()),i}return __extends(e,t),e}(ChatDataBase);__reflect(ChatInfoData.prototype,"ChatInfoData");var ChatSystemData=function(t){function e(e,i){var s=t.call(this)||this;return s.type=e,s.str=i,s}return __extends(e,t),e}(ChatDataBase);__reflect(ChatSystemData.prototype,"ChatSystemData");var ChatGuildItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildMessageInfo){var t=this.data;1!=t.type?this.currentState="sys":t.roleId==Actor.actorID?this.currentState="self":this.currentState="other";var e=this.data;if(this.validateNow(),this.vip&&1==t.type)this.vip.removeChildren(),this.head.source="head_"+t.job+t.sex,this.headBg.source=ChatListItemRenderer.HEAD_BG[t.sex],t.titleId?this.labelTitle.text=GlobalConfig.TitleConf[t.titleId].name:this.labelTitle.text="",this.labelName.text=t.name,this.vipImg.visible=this.vip.visible=0!=t.vipLevel,this.showText.text=e.content;else if(1==e.type){if(this.showChannel&&(this.showChannel.visible=e.office?!0:!1),e.office){var i="|C:0x"+GuildLanguage.guildOfficeColor[e.office]+"&T:["+GuildLanguage.guildOffice[e.office]+"]|";this.showChannel.textFlow=TextFlowMaker.generateTextFlow(i)}else this.showChannel.text="";this.chatVip&&(this.chatVip.visible=e.vipLevel>0?!0:!1);var s=0;if(e.vipLevel>0&&(this.chatVip.x=this.showChannel.width,this.chatVip.y=this.showChannel.y,s=this.chatVip.width),this.showHead&&(this.showHead.visible=e.name?!0:!1),e.name){var n="|C:0x16B2FF&T:["+e.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(n),e.office?(this.showHead.x=this.showChannel.x+this.showChannel.width+s,this.showHead.y+this.showChannel.y):(this.showHead.x=s,this.showHead.y=0)}var o="|C:0xDFD1B5&T:"+e.content+"|";if(this.showText.textFlow=TextFlowMaker.generateTextFlow(o),this.showText.x=this.showHead?this.showHead.x+this.showHead.width:0,this.showChannel&&this.showChannel.width+this.showHead.width+s+this.showText.width>=this.textGroup.width){var a="|C:0xDFD1B5&T:";this.showText.text="";for(var r=1;200>=r&&(a+=" ",!(4.5*r>this.showChannel.width+this.showHead.width+s));r++);a+=e.content+"|",this.showText.textFlow=TextFlowMaker.generateTextFlow(a),this.showText.x=0,this.showText.width=this.textGroup.width,this.showText.height=this.textGroup.height}this.showText.y=this.showHead?this.showHead.y:0}else{var h="|C:0xDFD1B5&T:"+e.content+"|";this.showText.textFlow=TextFlowMaker.generateTextFlow(h),this.showText.x=0,this.showText.y=0,this.showChannel&&(this.showChannel.visible=!1),this.chatVip&&(this.chatVip.visible=!1),this.showHead&&(this.showHead.visible=!1)}}},e}(BaseItemRender);__reflect(ChatGuildItemRender.prototype,"ChatGuildItemRender");var ChatListItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=null;this.type&&(this.type.visible=!1),t=7==this.data.type?this.data:3==this.data.type?this.data:this.data,t.id==Actor.actorID?this.currentState="self":3==this.data.type?this.currentState="sys":this.currentState="other";var i=KFServerSys.ins().isKF?"S"+t.servId:"";if(this.validateNow(),this.vip){if(!t.str)return;3==t.type?(this.labelName.text=""+t.name+i,this.head.visible=!1,this.headBg.visible=!1,this.vipImg.visible=!1,this.labelTitle.text="",this.showText.textFlow=TextFlowMaker.generateTextFlow(t.str),this.type&&(this.type.visible=!0)):(this.head.visible=!0,this.headBg.visible=!0,this.labelName.text=""+t.name+i,this.head.source="head_"+t.job+t.sex,this.headBg.source=e.HEAD_BG[t.sex],t.titleId?this.labelTitle.text=GlobalConfig.TitleConf[t.titleId].name:this.labelTitle.text="",this.vipImg.visible=this.vip.visible=0!=t.vip,this.showText.text=t.str)}else{var s="",n=0,o=void 0,a=void 0;if(0==t.type||1==t.type||2==t.type)return;3==t.type?(s=t.str,n=0,o="|C:0xDD6717&T:[系统]|",a=s):(s=t.str,n=t.vip,o="|C:0x16B2FF&T:["+t.name+i+"]|",a="|C:0xDFD1B5&T:"+s+"|"),this.showHead.textFlow=TextFlowMaker.generateTextFlow(o),this.chatVip.visible=n>0?!0:!1;var r=0;if(n>0?(r=this.chatVip.width,this.chatVip.x=0,this.chatVip.y=0,this.showHead.x=this.chatVip.x+r,this.showHead.y+this.chatVip.y):(this.showHead.x=0,this.showHead.y=0),this.showText.textFlow=TextFlowMaker.generateTextFlow(a),this.showText.x=this.showHead.x+this.showHead.width,this.showHead.width+r+this.showText.width>=this.textGroup.width){var h="|C:0xDFD1B5&T:";this.showText.text="";for(var l=1;200>=l&&(h+=" ",!(4.5*l>this.showHead.width+r));l++);h+=s+"|",this.showText.textFlow=TextFlowMaker.generateTextFlow(h),this.showText.x=0,this.showText.width=this.textGroup.width,this.showText.height=this.textGroup.height}this.showText.y=this.showHead.y}},e}(BaseItemRender);ChatListItemRenderer.HEAD_BG=["touxiangkuang0","touxiangkuang1"],__reflect(ChatListItemRenderer.prototype,"ChatListItemRenderer");var ChatListItemRenderer2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=0;this.$parent&&(e=this.$parent.$getExplicitWidth());var i="",s="",n=0;if(t instanceof GuildMessageInfo)i="|C:0xDD6717&T:[行会]|",s=t.content,n=t.vipLevel;else if(t instanceof ChatSystemData)i="|C:0xDD6717&T:[系统]|",s=t.str;else{var o=Chat.ins().getWorldStr();i="|C:0xDD6717&T:["+o+"]|",s=t.str,n=t.vip}if(this.showChannel.textFlow=TextFlowMaker.generateTextFlow(i),this.showHead.text="",t.name){var a="|C:0x16B2FF&T:["+t.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(a)}this.chatVip.visible=n>0?!0:!1;var r=0;n>0&&(this.chatVip.x=this.showChannel.width,this.chatVip.y=this.showChannel.y,r=this.chatVip.width),this.showHead.x=this.showChannel.x+this.showChannel.width+r,this.showHead.y+this.showChannel.y;var h="|C:0xDFD1B5&T:"+s+"|";if(this.showText.textFlow=TextFlowMaker.generateTextFlow(h),this.showText.y=this.showHead.y,this.showText.width=void 0,this.validateNow(),this.showChannel.width+r+this.showHead.width+this.showText.textWidth>(e||this.textGroup.width)){var l=this.showText.height;this.showText.width=(e||this.textGroup.width)-this.showChannel.width-r-this.showHead.width,this.showText.height=l}this.showText.x=this.showChannel.x+this.showChannel.width+r+this.showHead.width},e}(BaseItemRender);__reflect(ChatListItemRenderer2.prototype,"ChatListItemRenderer2");var ChatListItemRenderer3=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=0;this.$parent&&(e=this.$parent.$getExplicitWidth());var i="",s="",n=0;if(t instanceof GuildMessageInfo)i="|C:0xDD6717&T:[行会]|",s=t.content,n=t.vipLevel;else if(t instanceof ChatSystemData)i="|C:0xDD6717&T:[系统]|",s=t.str;else{var o=Chat.ins().getWorldStr();i="|C:0xDD6717&T:["+o+"]|",s=t.str,n=t.vip}if(this.showChannel.textFlow=TextFlowMaker.generateTextFlow(i),this.showHead.text="",t.name){var a="|C:0x16B2FF&T:["+t.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(a)}this.chatVip.visible=n>0?!0:!1;var r=0;n>0&&(this.chatVip.x=this.showChannel.width,this.chatVip.y=this.showChannel.y,r=this.chatVip.width),this.showHead.x=this.showChannel.x+this.showChannel.width+r,this.showHead.y+this.showChannel.y;var h="|C:0xDFD1B5&T:"+s+"|";if(this.showText.textFlow=TextFlowMaker.generateTextFlow(h),this.showText.y=this.showHead.y,this.showText.width=void 0,this.showText.height=void 0,this.validateNow(),this.showText.x=this.showChannel.x+this.showChannel.width+r+this.showHead.width,this.showChannel.width+r+this.showHead.width+this.showText.textWidth>(e||this.textGroup.width)){var l="|C:0xDFD1B5&T:";this.showText.text="";for(var c=1;200>=c&&(l+=" ",!(4.5*c>this.showChannel.width+this.showHead.width+r));c++);l+=s+"|",this.showText.x=0,this.showText.textFlow=TextFlowMaker.generateTextFlow(l),this.showText.width=e||this.textGroup.width
}},e}(BaseItemRender);__reflect(ChatListItemRenderer3.prototype,"ChatListItemRenderer3");var ChatSystemItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="SysMesItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){1==this.data.type?(this.str.textFlow=TextFlowMaker.generateTextFlow("|C:0xFD2F2F&T:"+this.data.str+"|"),this.type.source="lt_01"):(this.str.textFlow=TextFlowMaker.generateTextFlow(this.data.str),this.type.source="lt_02")},e}(BaseItemRender);__reflect(ChatSystemItemRenderer.prototype,"ChatSystemItemRenderer");var PlayerTipsWin=function(t){function e(){var e=t.call(this)||this;return e.currId=0,e.skinName="PlayerInfoSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this.data=t[0],this.data?(this.currId=0,this.addTouchEvent(this.btnIgnore,this.onTap),this.addTouchEvent(this.btnChat,this.onTap),this.addTouchEvent(this.btnFriend,this.onTap),this.addTouchEvent(this.btnInfo,this.onTap),this.addTouchEvent(this.rect,this.onTap),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),void this.initView()):void ViewManager.ins().close(e)},e.prototype.onTap=function(t){switch(t.target){case this.btnChat:var i=Friends.ins().getFriendIndex(this.currId);-1!=i?(ViewManager.ins().close(this),ViewManager.ins().open(FriendBgWin,0,i)):UserTips.ins().showTips("只有好友才能私聊");break;case this.btnInfo:UserReadPlayer.ins().sendFindPlayer(this.currId,this.data.name);break;case this.btnIgnore:Friends.ins().sendAddBlackList(this.currId,this.data.name);break;case this.btnFriend:Friends.ins().sendAddFriend(this.currId,this.data.name);break;case this.rect:ViewManager.ins().close(e)}},e.prototype.initView=function(){if(this.data instanceof FriendData){var t=this.data;this.labelName.text=t.name,t.zs?this.labelLv.text=t.zs+"转"+t.lv+"级":this.labelLv.text=this.data.lv+"级",this.labelGuild.text=t.guildName,this.imgBg.source=ChatListItemRenderer.HEAD_BG[t.sex],this.imgHead.source="head_"+t.job+t.sex,this.currId=t.id}else this.data instanceof GuildMemberInfo?(this.labelName.text=this.data.name,this.data.zsLevel?this.labelLv.text=this.data.zsLevel+"转"+this.data.level+"级":this.labelLv.text=this.data.level+"级",this.labelGuild.text=Guild.ins().guildName?Guild.ins().guildName:"",this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex],this.imgHead.source="head_"+this.data.job+this.data.sex,this.currId=this.data.roleID):this.data instanceof GuildMessageInfo?(this.labelName.text=this.data.name,this.data.zsLevel?this.labelLv.text=this.data.zsLevel+"转"+this.data.lv+"级":this.labelLv.text=this.data.lv+"级",this.labelGuild.text=this.data.guildName,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex],this.imgHead.source="head_"+this.data.job+this.data.sex,this.currId=this.data.roleId):(this.labelName.text=this.data.name,this.data.zsLevel?this.labelLv.text=this.data.zsLevel+"转"+this.data.lv+"级":this.labelLv.text=this.data.lv+"级",this.labelGuild.text=this.data.guild,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex],this.imgHead.source="head_"+this.data.job+this.data.sex,this.currId=this.data.id)},e.prototype.openOtherPlayerView=function(t){ViewManager.ins().close(this),ViewManager.ins().close(FriendBgWin),ViewManager.ins().open(RRoleWin,t)},e}(BaseEuiView);__reflect(PlayerTipsWin.prototype,"PlayerTipsWin"),ViewManager.ins().reg(PlayerTipsWin,LayerManager.UI_Popup);var DailyCheckIn=function(t){function e(){var e=t.call(this)||this;return e._loginTimes=0,e.conLoginTimes=0,e.todayReward=!1,e.comTimesIndexList=[],e.sysId=PackageID.DailyCheckIn,e.regNetMsg(1,e.postCheckInData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"loginTimes",{get:function(){return this._loginTimes},enumerable:!0,configurable:!0}),e.prototype.postCheckInData=function(t){this._loginTimes=t.readShort(),this.todayReward=t.readBoolean(),this.conLoginTimes=t.readShort(),this.rewardIndex=t.readShort()},e.prototype.sendCheckIn=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendReCheckIn=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.postCheckIn=function(t){return t},e.prototype.sendGetReward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.postComplement=function(t){return t},e.prototype.showRedPoint=function(){var t=this.canNormalCheckIn()||this.checkConReward();return t},e.prototype.canNormalCheckIn=function(){return!this.todayReward},e.prototype.checkConReward=function(){var t=this.getRewardList(this.rewardIndex)?this.getRewardList(this.rewardIndex).days:0;return this.conLoginTimes>=t},e.prototype.getCheckInState=function(t){return t>this.loginTimes?DailyCheckInState.notYet:t<this.loginTimes?DailyCheckInState.hasChecked:this.todayReward?DailyCheckInState.hasChecked:DailyCheckInState.canCheck},e.prototype.getRewardDays=function(){return 0},e.prototype.getRewardList=function(t){return GlobalConfig.MonthSignDaysConfig[t+1]?GlobalConfig.MonthSignDaysConfig[t+1]:null},e}(BaseSystem);__reflect(DailyCheckIn.prototype,"DailyCheckIn");var GameSystem;!function(t){t.dailycheckin=DailyCheckIn.ins.bind(DailyCheckIn)}(GameSystem||(GameSystem={}));var DailyCheckInState;!function(t){t[t.notYet=0]="notYet",t[t.canCheck=1]="canCheck",t[t.hasChecked=2]="hasChecked"}(DailyCheckInState||(DailyCheckInState={}));var DailyCheckInCard=function(t){function e(){var e=t.call(this)||this;return e.id=0,e.checkInState=0,e.skinName="DailyCheckInItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.resetView();var t=this.data;if(t){this.vipFlagGroup.touchChildren=!1,this.vipFlagGroup.touchEnabled=!1,this.dayFlagGroup.touchChildren=!1,this.dayFlagGroup.touchEnabled=!1,this.complement.touchEnabled=!1,this.dayFlagGroup.visible=!1,this.item.data=t.rewards[0],this.item.touchChildren=!1,this.item.touchEnabled=!1;var e=DailyCheckIn.ins().getCheckInState(t.day);if(e)switch(e){case DailyCheckInState.canCheck:this.checkInState=DailyCheckInState.canCheck,this.showFlag();break;case DailyCheckInState.hasChecked:this.checkInState=DailyCheckInState.hasChecked,this.showChecked()}else{this.showFlag();var i=!1;this.item.touchChildren=!i,this.item.touchEnabled=!i}}this.showEquipEffect()},e.prototype.showEquipEffect=function(){var t=DailyCheckIn.ins().getCheckInState(this.data.day);t!=DailyCheckInState.canCheck?this.EquipEffect&&DisplayUtils.removeFromParent(this.EquipEffect):(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.x=50,this.EquipEffect.y=48,this.EquipEffect.scaleX=1.6,this.EquipEffect.scaleY=1.6,this.EquipEffect.parent||this.addChild(this.EquipEffect),this.EquipEffect.playFile(RES_DIR_EFF+"quaeff4",-1))},e.prototype.showChecked=function(){this.checked.visible=this.checkedMask.visible=!0},e.prototype.showFlag=function(){var t=this.data;if(t)if(t.vipLabel>0){var e=t.vipLabel;e>10&&(e=10);var i=CheckInConfigMgr.ins().getVipCfg_Daily(e);i&&(this.vipFlagGroup.visible=!0,this.vipLab.text="V"+e+"双倍")}else t.dayLabel>0&&(this.dayLab.text=t.day+"天")},e.prototype.resetView=function(){this.complement.visible=!1,this.vipFlagGroup.visible=!1,this.dayFlagGroup.visible=!1,this.checked.visible=this.checkedMask.visible=!1,this.EquipEffect&&DisplayUtils.removeFromParent(this.EquipEffect)},e}(eui.ItemRenderer);DailyCheckInCard.GENE_STRING_LIST=["零","一","双","三","四","五","六","七","八","九","十"],__reflect(DailyCheckInCard.prototype,"DailyCheckInCard");var DailyCheckInPanel=function(t){function e(){var e=t.call(this)||this;return e.isTweenItem=!1,e.currentyear=0,e.currentDay=0,e.panelwidth=400,e.xqArr=["日","一","二","三","四","五","六"],e.MonthArr=[31,28,31,30,31,30,31,31,30,31,30,31],e.skinName="DailyCheckInPanelSkin",e.cardList.itemRenderer=DailyCheckInCard,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.eff=new MovieClip,this.eff.x=428,this.eff.y=43,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.listData=new eui.ArrayCollection,this.cardList.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(DailyCheckIn.ins().postCheckInData,this.onCheckInData),this.observe(DailyCheckIn.ins().postCheckIn,this.onCheckIn),this.observe(UserVip.ins().postUpdateVipData,this.onCheckInData),this.cardScroller.addEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this),this.addTouchEvent(this.cardList,this.onListTap),this.addTouchEvent(this.rewardBtn,this.ondayRewardListTap),this.isTweenItem=!0,this.initPanel(),this.updateCheckInTimes(),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isTweenItem=!1,this.cardScroller.removeEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this),DisplayUtils.removeFromParent(this.eff),this.listData=null,this.removeObserve(),this.cleanList()},e.prototype.toCheckIn=function(t){DailyCheckIn.ins().sendCheckIn(t)},e.prototype.onCheckIn=function(t){var e=t[0],i=t[1],s=e?"签到成功":"签到失败，请稍后再试";UserTips.ins().showTips(s),e&&this.isTweenItem&&this.runTweenItem(this,i)},e.prototype.runTweenItem=function(t,e){if(t){var i=t.cardList;if(i){var s=i.getElementAt(e-1);if(s){var n=s.data;if(n){var o=GlobalConfig.ItemConfig[n.rewards[0].id];if(o){var a=i.localToGlobal(s.x+(s.width>>1),s.y+(s.height>>1)),r=a.x,h=a.y;return[o.icon.toString(),r,h]}}}}}},e.prototype.onCheckInData=function(t){this.updateCheckInTimes(),this.updateList()},e.prototype.onListTap=function(t){var e=this;if(t&&t.currentTarget&&this.cardList.selectedItem){var i=DailyCheckIn.ins().getCheckInState(this.cardList.selectedItem.day);if(i)if(1==i)if(UserVip.ins().lv>0)this.toCheckIn(this.cardList.selectedItem.day);else if(this.cardList.selectedItem.vipLabel&&UserVip.ins().lv<this.cardList.selectedItem.vipLabel){var s="建议双倍领取，长期可获得高达百倍收益",n=WarnWin.show(s,function(){e.toCheckIn(e.cardList.selectedItem.day)},this,function(){ViewManager.ins().open(Recharge1Win)},this);n.showUI("","","","VIP1"),n.setBtnLabel("单倍领取","双倍领取")}else this.toCheckIn(this.cardList.selectedItem.day);else 2==i&&UserTips.ins().showTips("已签到");else this.cardList.selectedItem.day>this.currentDay&&UserTips.ins().showTips("未到签到时间")}},e.prototype.ondayRewardListTap=function(t){DailyCheckIn.ins().sendGetReward(this.curRewardData.days)},e.prototype.onNotYetCardTap=function(t){if(t){this.cardList.getElementAt(t.day-1)}},e.prototype.updateCheckInTimes=function(){this.checkInLab.text=DailyCheckIn.ins().loginTimes.toString()+"天"},e.prototype.initPanel=function(){this.monthList=CheckInConfigMgr.ins().getMonthRewardCfg_Daily();this.panelwidth/7;this.listData.replaceAll(this.monthList)},e.prototype.updateList=function(){this.addDate()},e.prototype.addDate=function(){this.listData.replaceAll(this.monthList);var t=DailyCheckIn.ins().conLoginTimes,e=DailyCheckIn.ins().getRewardList(DailyCheckIn.ins().rewardIndex);if(e){this.rewardBtn.visible=this.rewardItem.visible=!0,this.curRewardData=e;var i=this.curRewardData.days-t>=0?this.curRewardData.days-t:0,s=t>=this.curRewardData.days,n=s?2149168:15937822,o=10458221,a=16298305,r="已累计签到(|C:"+n+"&T:"+t+"|/|C:"+o+"&T:"+this.curRewardData.days+"|)天，\n再签到|C:"+a+"&T:"+i+"天|领取奖励。";this.dayReardText.textFlow=TextFlowMaker.generateTextFlow(r),this.rewardItem.data=this.curRewardData.rewards[0],s?(this.rewardBtn.enabled=!0,this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.rewardGroup.addChild(this.eff)):(this.rewardBtn.enabled=!1,DisplayUtils.removeFromParent(this.eff))}else{DisplayUtils.removeFromParent(this.eff),this.rewardBtn.visible=this.rewardItem.visible=!1,this.rewardBtn.enabled=!1;var i=1,s=!1,n=s?2149168:15937822,o=10458221,a=16298305,r="已领取所有的累计奖励";this.dayReardText.textFlow=TextFlowMaker.generateTextFlow(r)}},e.prototype.cleanList=function(){this.cardList.dataProvider=null},e.prototype.updateListPos=function(){this.cardScroller.removeEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this);var t=DailyCheckIn.ins().loginTimes;t>=25&&(this.cardScroller.viewport.scrollV=this.cardScroller.viewport.contentHeight-this.cardScroller.height)},e}(BaseEuiView);__reflect(DailyCheckInPanel.prototype,"DailyCheckInPanel");var DailyDayRewardItem=function(t){function e(){var e=t.call(this)||this;return e.id=0,e.skinName="DailyDayRewardItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.data=t.rewards[0],this.item.touchChildren=!1,this.item.touchEnabled=!1,this.item.isShowName(!1)},e.prototype.resetView=function(){},e}(eui.ItemRenderer);__reflect(DailyDayRewardItem.prototype,"DailyDayRewardItem");var CheckInConfigMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getMonthRewardCfg_Daily=function(){if(!this.monthListConfig||this.monthListConfig.length<=0){this.monthListConfig=[];var t=GlobalConfig.MonthSignConfig;for(var e in t)this.monthListConfig.push(t[e])}return this.monthListConfig},e.prototype.getSingleRewardCfg_Daily=function(t){var e=this.getMonthRewardCfg_Daily();if(e){var i=e[t-1];return this.assert(i,"MonthSignConfig("+t+")")?null:i}return null},e.prototype.getVipCfg_Daily=function(t){var e=GlobalConfig.MonthSignVipConfig[t];return this.assert(e,"MonthSignVipConfig("+t+")")?null:e},e.prototype.assert=function(t,e){return Assert(t,e+" is null")},e}(BaseClass);__reflect(CheckInConfigMgr.prototype,"CheckInConfigMgr");var CheckInData=function(){function t(){}return t.prototype.paser=function(t){this.cDate=t.readShort(),this.rewardState=t.readShort()},t}();__reflect(CheckInData.prototype,"CheckInData");var CityCC=function(t){function e(){var e=t.call(this)||this;return e.cityBossId=0,e.cityBossHandle=0,e.attStatue=2,e.bossKillNumData={},e.sysId=PackageID.City,e.enterCD=0,e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType==UserFb.FB_TYPE_CITY&&e.postEnterCity(),e.isCity&&GameMap.fbType!=UserFb.FB_TYPE_CITY&&e.postEscCity()}),e.observe(Rank.ins().postPraiseData,e.createStatue),e.observe(GuildWar.ins().postWinGuildInfo,e.createStatue),e.regNetMsg(1,e.postCityBossBelong),e.regNetMsg(2,UserBoss.ins().doBossChallengeResult),e.regNetMsg(3,e.postBossInfo),e.regNetMsg(4,e.postCityBossId),e.regNetMsg(5,e.postRemainTime),e.regNetMsg(6,e.postHudunPoint),e.regNetMsg(7,e.postEnterCD),e}return __extends(e,t),e.prototype.getBossList=function(){var t,e=new Array;for(var i in GlobalConfig.CityBossConfig){var s=GlobalConfig.CityBossConfig[i];-1==e.indexOf(s.bossId)&&s.killBossId>999&&e.push(s.bossId)}return t=new eui.ArrayCollection(e)},e.prototype.getCityBossConfig=function(t){var e;for(var i in GlobalConfig.CityBossConfig)if(GlobalConfig.CityBossConfig[i].bossId==t&&GlobalConfig.CityBossConfig[i].killBossId>999){e=GlobalConfig.CityBossConfig[i];break}return e},e.prototype.getKillBossNum=function(t){var i=e.ins().getCityBossConfig(t),s=i.killBossId,n=0;void 0!=e.ins().bossKillNumData[s]&&(n=e.ins().bossKillNumData[s][0]);var o=this.getNeedKillBossNum(t);return(t==this.cityBossId||n>o)&&(n=o),n},e.prototype.getNeedKillBossNum=function(t){var i=e.ins().getCityBossConfig(t),s=i.killBossId,n=0;return void 0!=e.ins().bossKillNumData[s]&&(n=e.ins().bossKillNumData[s][1]),n>=i.killCount.length&&(n=i.killCount.length-1),i.killCount[n]},e.prototype.getRefreshTime=function(t){var i=e.ins().getCityBossConfig(t),s=i.killBossId,n=0;void 0!=e.ins().bossKillNumData[s]&&(n=e.ins().bossKillNumData[s][2]);var o;return 0==n?o="":(n=DateUtils.formatMiniDateTime(n),o=DateUtils.checkTime(n,7)||0==n?"":DateUtils.formatFullTime(n)),o},e.prototype.postBossInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readInt(),n=t.readInt(),o=t.readInt(),a=t.readInt();this.bossKillNumData[s]=[n,o,a]}},e.prototype.postCityBossId=function(t){UserBoss.ins().monsterID=this.cityBossId=t.readInt(),UserBoss.ins().bossHandler=this.cityBossHandle=t.readDouble(),this.changeFunView()},e.prototype.getMaxKillNumBoss=function(){var t,e=0,i=0,s=0,n=Number.MAX_VALUE,o=!1,a=0;for(var r in this.bossKillNumData)if(!(999>+r)){t=this.getCfgByKillBossId(parseInt(r));var h=t.killCount[this.bossKillNumData[r][1]];if(void 0==h&&(h=t.killCount[t.killCount.length-1]),s=this.bossKillNumData[r][0]/h,s>=1)return[e,s];e||o||0!=this.bossKillNumData[r][2]||(o=!0,a=t.bossId,i=s),this.bossKillNumData[r][2]&&this.bossKillNumData[r][2]<n&&(e=t.bossId,n=this.bossKillNumData[r][2],i=s)}return[e||a,i]},e.prototype.getShowBossId=function(){var t;return t=this.cityBossId>0?this.cityBossId:this.getMaxKillNumBoss()[0]},e.prototype.getCfgByKillBossId=function(t){for(var e in GlobalConfig.CityBossConfig)if(GlobalConfig.CityBossConfig[e].killBossId==t)return GlobalConfig.CityBossConfig[e];return null},e.prototype.createStatue=function(t){if(void 0===t&&(t=-1),this.isCity){var e={};e[RankDataType.TYPE_POWER]="chenghaotxdy",e[RankDataType.TYPE_LILIAN]="chenghaomdtx",e[RankDataType.TYPE_SKIRMISH]="chenghaoslzw";var i,s,n=ViewManager.ins().getView(GameSceneView);if(-1==t){var o=GuildWar.ins().getModel().winGuildInfo;s=GlobalConfig.CityBaseConfig.masterPos,i=new StatueView("chenghaolcbz",o.guildOwnName||"虚位以待","diaoxiang0_"+o.guildOwnSex)}else{if(s=GlobalConfig.CityBaseConfig.statuePos[t],!s)return;var a=Rank.ins().getRankModel(t).praise,r=3;if(a.subRole[0])r=a.subRole[0].job;else switch(t){case RankDataType.TYPE_POWER:r=1;break;case RankDataType.TYPE_SKIRMISH:r=2}i=new StatueView(e[t],a.name||"虚位以待","statue_"+r+"_"+(a.subRole[0]?a.subRole[0].sex:0))}i.x=s.x,i.y=s.y,n.map.addEntity(i)}},e.prototype.sendEnter=function(){this.sendBaseProto(1)},e.prototype.sendStopAI=function(){this.sendBaseProto(2)},e.prototype.sendRevival=function(){this.sendBaseProto(3)},e.prototype.postEnterCity=function(){this.isCity=!0,this.cityBossId>0&&this.isChallenge&&(this.isChallenge=!1,TimerManager.ins().doNext(function(){var t=ViewManager.ins().getView(BossBelongPanel);t&&t.attrBoss()},this)),this.changeFunView(),ViewManager.ins().open(CityFunPanel),Rank.ins().sendGetRankingData(),Rank.ins().sendGetPraiseData(RankDataType.TYPE_POWER),Rank.ins().sendGetPraiseData(RankDataType.TYPE_SKIRMISH),Rank.ins().sendGetPraiseData(RankDataType.TYPE_LILIAN),GuildWar.ins().requestWinGuildInfo()},e.prototype.postEscCity=function(){this.isCity=!1,this.attStatue=2,ViewManager.ins().close(CityFunPanel),ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetPlayerBigBloodPanel)},e.prototype.postChangeAttStatue=function(t){return this.attStatue=t,this.changeFunView(),t},e.prototype.changeFunView=function(){this.isCity&&(2==this.attStatue&&0==this.cityBossId?ViewManager.ins().open(PlayFunView):ViewManager.ins().close(PlayFunView),0==this.cityBossId?(ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(BossBelongPanel)):(ViewManager.ins().open(BossBelongPanel),ViewManager.ins().open(BossBloodPanel)))},e.prototype.postCityBossBelong=function(t){var e=t.readDouble(),i=t.readDouble(),s="";if(e>0){var n=EntityManager.ins().getMasterList(e);n&&n[0]&&n[0].infoModel&&(s=n[0].infoModel.name)}UserBoss.ins().postBelongChange(i,e,s)},e.prototype.postRemainTime=function(t){UserBoss.ins().reliveTime=t.readShort(),UserBoss.ins().killerHandler=t.readDouble(),UserBoss.ins().reliveTime>0?(UserBoss.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.postHudunPoint=function(t){t&&(this.hudun=t.readInt(),this.huDunMax=t.readInt(),TimerManager.ins().remove(this.hudunPointFun,this),this.hudun>0&&TimerManager.ins().doTimer(1e3,e.ins().hudun,this.hudunPointFun,this))},e.prototype.hudunPointFun=function(){e.ins().hudun--,this.postHudunPoint(null)},e.prototype.postEnterCD=function(t){this.enterCD=t.readInt(),TimerManager.ins().remove(this.enterCDFun,this),this.enterCD>0&&TimerManager.ins().doTimer(1e3,this.enterCD,this.enterCDFun,this)},e.prototype.enterCDFun=function(){this.enterCD--},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(CityCC.prototype,"CityCC");var GameSystem;!function(t){t.citycc=CityCC.ins.bind(CityCC)}(GameSystem||(GameSystem={}));var BossBelongPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossBelongSkin",e.bloodBar0.labelDisplay.visible=!1,e.attackBoss1.currentState="attbossup",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserBoss.ins().postBelongChange,this.updateBelong),this.observe(GameLogic.ins().postChangeTarget,this.updateTarget),this.observe(MapView.onGridClick,this.mapClick),this.observe(GameLogic.ins().postEnterMap,this.onEnterMap),this.addTouchEvent(this.belongGroup,this.onTap),this.addTouchEvent(this.attguishu1,this.onTap),this.addTouchEvent(this.attackBoss1,this.onTap),this.addTouchEvent(this.attackPlayer1,this.onTap),this.updateBelong(),TimerManager.ins().remove(this.updateBelong,this),TimerManager.ins().doTimer(200,0,this.updateBelong,this)},e.prototype.onEnterMap=function(){this.attackBoss1.currentState="attbossup",this.attackPlayer1.currentState="attgsup"},e.prototype.mapClick=function(t){t.target,t.x,t.y;this.attackBoss1.currentState="attbossup"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.attackBoss1:this.attrBoss();break;case this.attguishu1:if(UserBoss.ins().attHandle==Actor.handle){KFBossSys.ins().isKFBossBattle?KFBossSys.ins().sendCleanBelong():DevildomSys.ins().isDevildomBattle?DevildomSys.ins().sendCleanBelong():UserBoss.ins().sendCleanBelong();break}case this.belongGroup:case this.attackPlayer1:if(0==UserBoss.ins().attHandle)return void UserTips.ins().showTips("|C:0xFFFF00&T:该BOSS无归属者,快去抢夺!|");if(UserBoss.ins().attHandle==Actor.handle||UserBoss.ins().attHandle==GameLogic.ins().currAttackHandle)return;if(!UserBoss.ins().canClick)return;GameLogic.ins().postChangeAttrPoint(UserBoss.ins().attHandle),this.setBtnState()}},e.prototype.attrBoss=function(){GameLogic.ins().postChangeAttrPoint(UserBoss.ins().bossHandler),this.attackBoss1.currentState="attbossing",this.attackPlayer1.currentState="attgsup"},e.prototype.updateTarget=function(){this.setBtnState()},e.prototype.setBtnState=function(){UserBoss.ins().attHandle==Actor.handle?(GwBoss.ins().isGwBoss||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle?this.attguishu1.label="取消归属":this.attguishu1.visible=!1,this.attackPlayer1.currentState="attgsdis"):(this.attguishu1.visible=!0,this.attguishu1.label="抢夺归属",GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle!=UserBoss.ins().bossHandler?this.attackPlayer1.currentState="attgsing":this.attackPlayer1.currentState="attgsup"),GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==UserBoss.ins().bossHandler?this.attackBoss1.currentState="attbossing":this.attackBoss1.currentState="attbossup"},e.prototype.updateBelong=function(){this.updateTarget();var t=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(UserBoss.ins().attHandle));if(t&&t.length>0){for(var e=t.length,i=0,s=0,n=0,o=0,a=void 0,r=0;e>r;r++){var h=t[r];if(h instanceof CharRole){var l=h.infoModel.getAtt(AttributeType.atHp)||0,c=h.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=l,s+=c;var u=h.infoModel.getAtt(AttributeType.cruNeiGong)||0,p=h.infoModel.getAtt(AttributeType.maxNeiGong)||0;n+=u,o+=p,a||(a=h.infoModel)}}this.belongGroup.visible=i>0&&""==UserBoss.ins().winner;var d=Actor.handle!=UserBoss.ins().attHandle?ColorUtil.ROLENAME_COLOR_YELLOW:ColorUtil.ROLENAME_COLOR_GREEN,g=a.getNameWithServer(),f=g.split("\n");g=f[1]?f[1]:f[0],g=StringUtils.replaceStr(g,"0xffffff",d+""),this.belongNameTxt1.textFlow=TextFlowMaker.generateTextFlow("|C:"+d+"&T:"+g),this.roleHead1.source="yuanhead"+a.job+a.sex,this.bloodBar0.maximum=s,this.bloodBar0.value=i,this.neigongBar0.maximum=o,this.neigongBar0.value=n}else this.belongGroup.visible=!1,this.attackPlayer1.currentState="attgsup"},e}(BaseEuiView);__reflect(BossBelongPanel.prototype,"BossBelongPanel");var GameSystem;!function(t){t.bossBelongPanel=function(){ViewManager.ins().reg(BossBelongPanel,LayerManager.Main_View)}}(GameSystem||(GameSystem={}));var CityBossJiangliTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CityBossJiangliTipsSkin",this.isTopLevel=!0,this.belongList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.giveUp,this.otherClose),this.showAward()},e.prototype.showAward=function(){if(CityCC.ins().isCity)for(var t in GlobalConfig.CityBossConfig)if(GlobalConfig.CityBossConfig[t].bossId==CityCC.ins().cityBossId){this.belongList.dataProvider=new eui.ArrayCollection(GlobalConfig.CityBossConfig[t].showReward);break}},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(CityBossJiangliTipsWin.prototype,"CityBossJiangliTipsWin"),ViewManager.ins().reg(CityBossJiangliTipsWin,LayerManager.UI_Popup);var CityBossView=function(t){function e(){var e=t.call(this)||this;return e.lastSelect=0,e.skinName="CitySkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.onTap),this.tab.addEventListener(egret.Event.CHANGE,this.setSelectedIndex,this),this.addTouchEvent(this.seeRule,this.onSeeRule),this.viewStack.selectedIndex=0,this.viewStack.getElementAt(0).open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn0,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onSeeRule=function(t){ViewManager.ins().open(ZsBossRuleSpeak,16)},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e}(BaseEuiView);__reflect(CityBossView.prototype,"CityBossView"),ViewManager.ins().reg(CityBossView,LayerManager.UI_Main);var CityFunPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="CityFunSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.attState,this.onClick),this.addTouchEvent(this.quit,this.onClick),this.addTouchEvent(this.npcBtn,this.onClick),this.observe(CityCC.ins().postChangeAttStatue,this.changeBtn),this.observe(CityCC.ins().postCityBossId,this.changeAttStatue),this.changeAttStatue()},e.prototype.changeAttStatue=function(){CityCC.ins().cityBossId>0&&(CityCC.ins().postChangeAttStatue(1),ViewManager.ins().open(TargetListPanel))},e.prototype.changeBtn=function(){this.attState.selected=ViewManager.ins().isShow(TargetListPanel)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.attState:var e=0;this.attState.selected?(ViewManager.ins().open(TargetListPanel),e=1):0==CityCC.ins().cityBossId?(e=2,ViewManager.ins().close(TargetListPanel)):UserTips.ins().showTips("当前远古BOSS攻城期间，不能切换模式"),CityCC.ins().postChangeAttStatue(e);break;case this.quit:WarnWin.show("是否退出主城，退出后有30秒进入CD",function(){UserFb.ins().sendExitFb()},this);break;case this.npcBtn:}},e}(BaseEuiView);__reflect(CityFunPanel.prototype,"CityFunPanel");var GameSystem;!function(t){t.cityfunpanel=function(){ViewManager.ins().reg(CityFunPanel,LayerManager.Main_View)}}(GameSystem||(GameSystem={}));var MonsterCityWarView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.open=function(){this.addCustomEvent(),this.initView()},e.prototype.init=function(){this.isInit||(this.list.itemRenderer=BossListRender,this.rewardList.itemRenderer=ItemBase,this.canChallengeTxt.text="未刷新",this.bossEffect=new MovieClip,this.bossEffect.scaleX=-1,this.bossEffect.scaleY=1,this.bossEffect.x=78,this.bossEffect.y=160,this.bossGroup.addChild(this.bossEffect),this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=160,this.bossGroup.addChild(this.bossImage),this.isInit=!0)},e.prototype.addCustomEvent=function(){this.observe(CityCC.ins().postBossInfo,this.checkState),this.observe(CityCC.ins().postCityBossId,this.checkState),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.addTouchEvent(this.challengeBtn,this.onChallenge),this.bossName.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openBossWin,this)},e.prototype.openBossWin=function(t){var e=this.list.dataProvider.getItemAt(this.list.selectedIndex),i=CityCC.ins().getCityBossConfig(e),s=i.killBossId;ViewManager.ins().open(BossWin,1,s)},e.prototype.initView=function(){this.list.dataProvider=CityCC.ins().getBossList();var t=this.getBossIndex();this.list.selectedIndex=t,this.updateView(t)},e.prototype.getBossIndex=function(){var t=CityCC.ins().getShowBossId(),e=0;if(t>0)for(var i=this.list.dataProvider.length,s=0;i>s;s++)if(t==this.list.dataProvider.getItemAt(s)){e=s;break}return e},e.prototype.onChallenge=function(t){CityCC.ins().enterCD>0?UserTips.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城"):CityCC.ins().isCity?TimerManager.ins().doNext(function(){var t=ViewManager.ins().getView(BossBelongPanel);t.attrBoss()},this):(CityCC.ins().isChallenge=!0,CityCC.ins().sendEnter()),ViewManager.ins().close(this)},e.prototype.checkState=function(){this.list.dataProvider=CityCC.ins().getBossList(),this.updateView(this.list.selectedIndex)},e.prototype.onListChange=function(t){this.updateView(t.itemIndex)},e.prototype.updateView=function(t){var e=this.list.dataProvider.getItemAt(t),i=GlobalConfig.MonstersConfig[e],s=CityCC.ins().getCityBossConfig(e),n=CityCC.ins().getKillBossNum(e),o=CityCC.ins().getNeedKillBossNum(e),a=n>=o,r=GlobalConfig.EffectConfig[i.effect].fileName;this.bossName.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+GlobalConfig.MonstersConfig[s.killBossId].name+"</u></a>"),this.bossName.touchEnabled=!0;var h=CityCC.ins().getRefreshTime(e);h&&h.length>0?this.nextTime.text="最快将于"+CityCC.ins().getRefreshTime(e)+"刷新":this.nextTime.text="",this.nextTime.visible=!0,this.nameTxt.text=i.name+"("+i.level+"级)",this.killProgressBar.minimum=0,this.killProgressBar.maximum=o,this.killProgressBar.value=n,this.rewardList.dataProvider=new eui.ArrayCollection(s.showReward),this.bossImage.playFile(RES_DIR_MONSTER+("monster"+i.avatar+"_3s"),-1),this.bossEffect.playFile(RES_DIR_EFF+r,-1),this.updateState(a)},e.prototype.updateState=function(t){this.canChallengeTxt.visible=!t,this.challengeBtn.visible=t,this.redPoint.visible=t,this.stateImage.visible=t,this.nextTime.visible=!t},e}(BaseView);__reflect(MonsterCityWarView.prototype,"MonsterCityWarView");var BossListRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="CityBossItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.MonstersConfig[t];this.nameTxt.text=e.name;var i=CityCC.ins().getKillBossNum(t)>=CityCC.ins().getNeedKillBossNum(t);this.redPoint.visible=i},e}(BaseItemRender);__reflect(BossListRender.prototype,"BossListRender");var StatueView=function(t){function e(e,i,s){var n=t.call(this)||this;return n.title=new MovieClip,n.title.playFile(RES_DIR_EFF+e,-1),n.addChild(n.title),n.roleName=new eui.Label,n.roleName.size=14,n.roleName.strokeColor=0,n.roleName.stroke=1,n.roleName.text=""+i,n.roleName.x=-n.roleName.width>>1,n.addChild(n.roleName),n.model=new eui.Image,n.model.source=RES_DIR_CITY+"/"+s+".png",n.model.once(egret.Event.COMPLETE,function(){n.model.x=-n.model.width>>1,n.model.y=-n.model.height,n.roleName.y=n.model.y-20,n.title.y=n.roleName.y-50},n),n.addChild(n.model),n}return __extends(e,t),Object.defineProperty(e.prototype,"weight",{get:function(){return this.y},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(StatueView.prototype,"StatueView");
var BubbleFactory=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.playBubbleEffect=function(t){var e="",i=GlobalConfig.BubbleConfig[t];if(i)switch(i.type){case BubbleType.B1:e=i.news;break;case BubbleType.B2:i.news&&UserSkill.ins().postShowSkillWord(i.news)}return e},e}(BaseClass);__reflect(BubbleFactory.prototype,"BubbleFactory");var BubbleType;!function(t){t[t.B1=1]="B1",t[t.B2=2]="B2"}(BubbleType||(BubbleType={}));var CustomServiceWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CustomServiceSkin",this.defaultText="点击输入咨询内容"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.input.textDisplay.size=16,this.input.textDisplay.lineSpacing=0,this.input.textDisplay.multiline=!0,this.input.textDisplay.wordWrap=!0,this.input.textDisplay.height=335,0==this.input.text.length?(this.input.text=this.defaultText,this.input.textColor=7105644):this.input.textColor=14668213,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sendBtn,this.onTap),this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.sendBtn,this.onTap),this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this)},e.prototype.updateInput=function(){this.input.text==this.defaultText&&(this.input.text="",this.input.textColor=14668213)},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:if(0==this.input.text.length||this.input.text==this.defaultText)return void UserTips.ins().showTips("内容不能为空");ReportData.getIns().advice(this.input.text,this.callBack,this)}},e.prototype.callBack=function(){this.input.text=""},e}(BaseEuiView);__reflect(CustomServiceWin.prototype,"CustomServiceWin"),ViewManager.ins().reg(CustomServiceWin,LayerManager.UI_Main);var DieGuide=function(t){function e(){var e=t.call(this)||this;return e.resImg=["vipbn2_png","vipbn2_1_png"],e.observe(Encounter.ins().postFightResult,e.postdieGuide),e.observe(Recharge.ins().postRecharge1Data,e.initRecharge1),e.observe(Setting.ins().postInitSetting,e.initSetting),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initRecharge1=function(){this.isInitRecharge1=!0},e.prototype.initSetting=function(){this.isInitSetting=!0},e.prototype.postdieGuide=function(t){if(!t){var e=Setting.ins().getValue(ClientSet.diedFirstTime);e||(e=Math.floor((new Date).getTime()/1e3),Setting.ins().setValue(ClientSet.diedFirstTime,e));var i=Recharge.ins().getRechargeData(0);i.num&&(e=Setting.ins().getValue(ClientSet.diedFirstTime2),e||(e=Math.floor((new Date).getTime()/1e3),Setting.ins().setValue(ClientSet.diedFirstTime2,e)))}},e.prototype.dieFbRedPoint=function(t,e){var i=GlobalConfig.DailyFubenConfig[e];if(!i)return!1;if(UserZs.ins().lv<i.zsLevel||Actor.level<i.levelLimit)return!1;var s=Setting.ins().getValue(ClientSet.FB);if(s){var n=e-3e3;if(s>>n&1)return!1}var o=Setting.ins().getValue(ClientSet.diedFirstTime);if(!o)return!1;var a=Math.floor((new Date).getTime()/1e3);return a>DateUtils.getTodayZeroSecond(new Date(1e3*o))+86400?!1:t>0?!0:!1},e.prototype.checkFirstChargeOrVIPWin=function(){if(this.isInitRecharge1&&this.isInitSetting&&!UserFb.ins().pkGqboss){var t=Recharge.ins().getRechargeData(0);if(t.num){var i=Setting.ins().getValue(ClientSet.diedFirstTime2);if(i&&i>0&&UserVip.ins().lv<3){var s=Setting.ins().getValue(ClientSet.vip);if(!s){var n=ViewManager.ins().getView(PlayFunView);return n&&n.setDieGuide(e.VIP),void Setting.ins().setValue(ClientSet.vip,e.Show)}}}else{if(Actor.level>=30){var o=Setting.ins().getValue(ClientSet.recharge1);if(!o){var n=ViewManager.ins().getView(PlayFunView);return n&&n.setDieGuide(e.RECHARGE),void Setting.ins().setValue(ClientSet.recharge1,e.Show)}}var i=Setting.ins().getValue(ClientSet.diedFirstTime);if(i&&i>0){var o=Setting.ins().getValue(ClientSet.recharge2);if(!o){var n=ViewManager.ins().getView(PlayFunView);return n&&n.setDieGuide(e.RECHARGE),void Setting.ins().setValue(ClientSet.recharge2,e.Show)}}}}},e.prototype.getOpenRoles=function(){var t=Setting.ins().getValue(ClientSet.role);if(t==e.Show2&&SubRoles.ins().subRolesLen>=3)return"";for(var i=3,s=1;i>s;s++){var n=SubRoles.ins().getSubRoleByIndex(s);if(!n)return t?t==e.Show&&2==s&&Setting.ins().setValue(ClientSet.role,e.Show2):Setting.ins().setValue(ClientSet.role,e.Show),this.resImg[s-1]}return""},e.prototype.setClick=function(t){var e=t-3e3,i=Setting.ins().getValue(ClientSet.FB);i||(i=0),i>>e&1||(i|=1<<e,Setting.ins().setValue(ClientSet.FB,i))},e.prototype.setMaxFb=function(t){for(var e=Setting.ins().getValue(ClientSet.FB),i=0;i<t.length;i++)if(t[i]>3e3){var s=t[i]-3e3;if(e>>s&1)continue;e|=1<<s,Setting.ins().setValue(ClientSet.FB,e)}},e}(BaseSystem);DieGuide.Show=1,DieGuide.Show2=2,DieGuide.RECHARGE=1,DieGuide.VIP=2,DieGuide.FB=3,__reflect(DieGuide.prototype,"DieGuide");var GameSystem;!function(t){t.dieGuide=DieGuide.ins.bind(DieGuide)}(GameSystem||(GameSystem={}));var DressType;!function(t){t[t.ROLE=1]="ROLE",t[t.ARM=2]="ARM",t[t.WING=3]="WING"}(DressType||(DressType={}));var DressTypeName;!function(t){t[t[""]=0]="",t[t["角色"]=1]="角色",t[t["武器"]=2]="武器",t[t["翅膀"]=3]="翅膀"}(DressTypeName||(DressTypeName={}));var Dress=function(t){function e(){var e=t.call(this)||this;return e.timeInfo={},e.posInfo=[],e.careerDic={},e.itemIdDic={},e.sysId=PackageID.Dress,e.regNetMsg(1,e.doDressInfo),e.regNetMsg(2,e.doDressActivationRes),e.regNetMsg(3,e.doDressUserRes),e.regNetMsg(4,e.doUnDressUserRes),e.regNetMsg(5,e.doDressTimeEnd),e.regNetMsg(6,e.postLevelUp),e.regNetMsg(7,e.postAddTime),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendDressInfoReq=function(){this.sendBaseProto(1)},e.prototype.doDressInfo=function(t){this.parser(t),e.ins().postDressInfo()},e.prototype.sendDressActivationReq=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.doDressActivationRes=function(t){this.parserAct(t),e.ins().postJiHuo(),UserTips.ins().showTips("|C:0xffffff&T:激活装扮形象成功|")},e.prototype.sendDressUserReq=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doDressUserRes=function(t){this.parserDress(t),e.ins().postDressInfo(),UserTips.ins().showTips("|C:0xffffff&T:幻化形象成功|")},e.prototype.sendUnDressUserReq=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doUnDressUserRes=function(t){this.parserDress(t),e.ins().postDressInfo(),UserTips.ins().showTips("|C:0xffffff&T:取消幻化形象成功|")},e.prototype.doDressTimeEnd=function(t){this.parserDel(t),e.ins().postDressInfo()},e.prototype.parser=function(t){var e=t.readInt();this.timeInfo={};for(var i=0;e>i;i++){var s=new DressTimeInfo;s.dressId=t.readInt(),s.invalidtime=t.readInt(),s.lv=t.readInt(),this.timeInfo[s.dressId]=s}e=t.readByte(),this.posInfo=[];for(var i=0;e>i;i++){for(var n=new DressPosInfo,o=0;3>o;o++)n.posAry[o]=t.readInt();this.posInfo.push(n)}},e.prototype.parserAct=function(t){var e=new DressTimeInfo;e.dressId=t.readInt(),e.invalidtime=t.readInt(),e.lv=t.readInt(),this.timeInfo[e.dressId]=e},e.prototype.parserDress=function(t){var i=t.readByte(),s=this.posInfo[i],n=t.readByte(),o=t.readInt();s&&(s.posAry[n-1]=o);var a=SubRoles.ins().getSubRoleByIndex(i);a.zhuangbei[n-1]=o,1==n||2==n?UserEquip.ins().postEquipChange():e.ins().postChangeWing();var r=EntityManager.ins().getEntityByHandle(a.handle);r&&r.updateModel()},e.prototype.parserDel=function(t){var i=t.readInt();delete this.timeInfo[i];for(var s=0;s<this.posInfo.length;s++)for(var n=this.posInfo[s],o=0;3>o;o++)if(n.posAry[o]==i){n.posAry[o]=0;var a=SubRoles.ins().getSubRoleByIndex(s);a.zhuangbei[o]=0,0==o||1==o?UserEquip.ins().postEquipChange():e.ins().postChangeWing();var r=EntityManager.ins().getEntityByHandle(a.handle);r&&r.updateModel();break}},e.prototype.getModelPosId=function(t){return this.posInfo[t]},e.prototype.redPoint=function(){return this.careerRedPoint()},e.prototype.careerRedPoint=function(){for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=SubRoles.ins().getSubRoleByIndex(t).job,i=this.getIdByCareer(e);for(var s in i)for(var n=i[s],o=0,a=n;o<a.length;o++){var r=a[o];if(this.redPointDress(r.id))return!0}}return!1},e.prototype.curRoleRedPoint=function(t){return this.roleRedPoint()[t]},e.prototype.roleRedPoint=function(){for(var t=[!1,!1,!1],e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i).job,n=this.getIdByCareer(s);for(var o in n){for(var a=n[o],r=0,h=a;r<h.length;r++){var l=h[r];if(this.redPointDress(l.id)){t[i]=!0;break}}if(t[i])break}}return t},e.prototype.canDress=function(t,e){if(e==DressType.WING&&Actor.level<=16)return!1;var i=this.getIdByCareer(t)[e];for(var s in i)if(this.redPointDress(i[s].id))return!0;return!1},e.prototype.posRedPoint=function(){for(var t=[!1,!1,!1],e=SubRoles.ins().subRolesLen,i=0;e>i;i++)for(var s=SubRoles.ins().getSubRoleByIndex(i).job,n=this.getIdByCareer(s),o=0;3>o;o++)if(!t[o])for(var a=n[o+1],r=0,h=a;r<h.length;r++){var l=h[r];if(this.redPointDress(l.id)){t[o]=!0;break}}return t},e.prototype.getIdByCareer=function(t){return this.careerDic[t]?this.careerDic[t]:(this.initConfig(),this.careerDic[t])},e.prototype.getIdByItemId=function(t){return this.itemIdDic[t]?this.itemIdDic[t]:(this.initConfig(),this.itemIdDic[t])},e.prototype.initConfig=function(){if(!Object.keys(this.itemIdDic).length){var t=GlobalConfig.ZhuangBanId;for(var e in t){var i=t[e],s=i.roletype,n=i.pos;this.careerDic[s]=this.careerDic[s]||{},this.careerDic[s][n]=this.careerDic[s][n]||[],this.careerDic[s][n].push(i);var o=i.cost.itemId;this.itemIdDic[o]=this.itemIdDic[o]||[],this.itemIdDic[o].push(i)}}},e.prototype.redPointDress=function(t){var e=GlobalConfig.ZhuangBanId[t];if(e.pos==DressType.WING&&Actor.level<=16)return!1;var i=e.cost.itemId,s=UserBag.ins().getBagGoodsCountById(0,i);if(0==s)return!1;if(this.timeInfo[t]){for(var n=this.getIdByItemId(i),o=0,a=n;o<a.length;o++){var r=a[o];if(r.id!=t&&!this.timeInfo[r.id])return!1}var h=this.timeInfo[t].lv+1,l=GlobalConfig.ZhuangBanLevelUp[t];if(l&&l[h]&&l[h].cost.num<=s)return!0}else if(s>=e.cost.num)return!0;return!1},e.prototype.getIdZhuangBanId=function(t){var e=GlobalConfig.ZhuangBanId;for(var i in e){var s=e[i];if(s.cost.itemId==t)return t}return 0},e.prototype.sendLevelUp=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.postLevelUp=function(t){var e=t.readInt(),i=t.readInt(),s=t.readInt(),n=this.timeInfo[e];n.invalidtime=i,n.lv=s,this.postDressInfo()},e.prototype.sendAddTime=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.postAddTime=function(t){var e=t.readInt(),i=t.readInt(),s=t.readInt(),n=this.timeInfo[e]||new DressTimeInfo;n.invalidtime=i,n.lv=s,n.dressId=e,this.timeInfo[e]=n},e.prototype.postDressInfo=function(){},e.prototype.postJiHuo=function(){},e.prototype.postChangeWing=function(){},e}(BaseSystem);__reflect(Dress.prototype,"Dress");var GameSystem;!function(t){t.dress=Dress.ins.bind(Dress)}(GameSystem||(GameSystem={}));var DressItemInfo=function(){function t(){this.isDress=!1,this.lv=0}return t}();__reflect(DressItemInfo.prototype,"DressItemInfo");var DressPosInfo=function(){function t(){this.posAry=[]}return t}();__reflect(DressPosInfo.prototype,"DressPosInfo");var DressTimeInfo=function(){function t(){}return t}();__reflect(DressTimeInfo.prototype,"DressTimeInfo");var DressItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="DressItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(null!=t){this.redPoint0.visible=!1;var e=t.zhuanban.cost.itemId;t.lv?(this.timelabel.visible=!0,this.imgIcon.source=e+"_png"):(this.timelabel.visible=!1,this.imgIcon.source=e+"_png"),this.redPoint0.visible=Dress.ins().redPointDress(t.zhuanban.id),this.imageName.text=t.zhuanban.name,t.isDress?this.huanhuaImage.visible=!0:this.huanhuaImage.visible=!1,0==t.timer?this.timelabel.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("永久",3532333)):t.timer>0?this.timelabel.text=this.updateTimer(t.timer):this.timelabel.visible=!1,t.lv>1?this.levellabel.text=t.lv+"级":this.levellabel.text="1级"}},e.prototype.updateTimer=function(t){var e="",i=(DateUtils.formatMiniDateTime(t)-GameServer.serverTime)/1e3;return i>=0&&(e=DateUtils.getFormatBySecond(i,5,2)),e},Object.defineProperty(e.prototype,"selected",{set:function(t){this.selectImage.visible=t},enumerable:!0,configurable:!0}),e}(eui.ItemRenderer);__reflect(DressItemRenderer.prototype,"DressItemRenderer");var DressWin=function(t){function e(){var e=t.call(this)||this;return e.lastRole=-1,e.lastIndex=-1,e.skinName="DressSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listInfo=[],this.arry=new eui.ArrayCollection(this.listInfo),this.list.itemRenderer=DressItemRenderer,this.list.dataProvider=this.arry,this.titleList.itemRenderer=TitleItem;var t=[];t=CommonUtils.copyDataHandler(GlobalConfig.ZhuangBanConfig.zhuangbanpos),t.push("称号"),this.tab.dataProvider=new eui.ArrayCollection(t)},e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.curRole=e[0]||0,void 0!=e[1]&&(this.lastIndex=this.selectIndex=parseInt(e[1]+""),this.tab.selectedIndex=this.selectIndex),this.listId=e[2]||-1,this.list.selectedIndex=-1,this.roleSelect.setCurRole(this.curRole),this.roleSelect0.setCurRole(this.curRole),MessageCenter.ins().addListener(Title.TITLE_WIN_REFLASH_PANEL,function(e,i){if(e.itemIndex==Title.ins().list.length-1){var s=Title.EXPAND_HEIGHT-Title.SIMLPE_HEIGHT;"expand"==i?t.titleList.scrollV=t.titleList.contentHeight-t.titleList.height+s:t.titleList.scrollV=t.titleList.contentHeight-t.titleList.height-s,t.titleList.validateNow()}},this),this.observe(Dress.ins().postDressInfo,this.update),this.observe(Dress.ins().postJiHuo,this.onJihuo),this.observe(GameLogic.ins().postSubRoleChange,this.getDressInfo),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.help,this.onClick),this.addTouchEvent(this.itemName,this.onClick),this.addChangeEvent(this.list,this.onChange),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.onChange),this.addChangeEvent(this.roleSelect0,this.onChange),this.addTouchEvent(this.dressBtn,this.onClick),this.addTouchEvent(this.dressBtn2,this.onClick),this.observe(Title.ins().postListUpdate,this.updateList),this.observe(Title.ins().postTitleShow,this.updateShow),this.observe(Title.ins().postUseTitle,this.useTitle),this.list.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.list.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.list.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.titleList.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.titleList.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.titleList.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.titleGroup.visible=!1,this.dressGroup.visible=!0,this.changeRole(),this.getDressInfo(),this.lastIndex>=0&&this.setSelectedIndex(this.lastIndex)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.list.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.list.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.titleList.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.titleList.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.titleList.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.lastWeapon=0,this.lastBody=0,WatcherUtil.removeFromArrayCollection(this.titleList.dataProvider),this.titleList.dataProvider=null},e.prototype.listSelectIndex=function(t){if(-1==t)return-1;var e=0;for(var i in this.listInfo){if(this.listInfo.hasOwnProperty(i)){var s=this.listInfo[i];if(s.zhuanban.id==t)break}e++}return e},e.prototype.onTouch=function(t){t.type==egret.TouchEvent.TOUCH_BEGIN?(this.roleSelect.parent.touchEnabled=!1,this.roleSelect0.parent.touchEnabled=!1):(this.roleSelect.parent.touchEnabled=!0,this.roleSelect0.parent.touchEnabled=!0)},e.prototype.getDressInfo=function(){Dress.ins().sendDressInfoReq()},e.prototype.onChange=function(t){switch(t.target){case this.roleSelect:if(this.lastRole==this.roleSelect.getCurRole())return;this.changeRole();break;case this.roleSelect0:if(this.lastRole==this.roleSelect0.getCurRole())return;Title.ins().curSelectRole=this.lastRole=this.roleSelect0.getCurRole(),null==Title.ins().list?Title.ins().sendGetList():this.updateList();break;case this.list:var e=t.target;this.onInfoUpdate(e.data)}},e.prototype.changeRole=function(){this.curRole=this.roleSelect.getCurRole(),this.lastWeapon=0,this.lastBody=0,this.lastWing=0,this.lastRole=this.curRole,this.update()},e.prototype.careerRedPoint=function(){for(var t=Dress.ins().posRedPoint(),e=0;3>e;e++)this["redPoint"+e].visible=t[e]},e.prototype.onTabTouch=function(t){var e=this.list.parent;e.stopAnimation(),this.list.scrollH=0,this.listId=-1,this.selectIndex=t.currentTarget.selectedIndex,this.setSelectedIndex(this.selectIndex)},e.prototype.setSelectedIndex=function(t){this.lastIndex=this.selectIndex,this.selectIndex<this.tab.dataProvider.length-1?(this.dressGroup.visible=!0,this.roleSelect.openRole(),this.titleGroup.visible=!1,this.update()):(this.dressGroup.visible=!1,this.titleGroup.visible=!0,Title.ins().curSelectRole=0,this.roleSelect.hideRole(),null==Title.ins().list?Title.ins().sendGetList():this.updateList())},e.prototype.update=function(){null==this.curRole&&(this.curRole=0),null==this.selectIndex&&(this.selectIndex=0);var t=Dress.ins();this.listInfo=[];for(var e in GlobalConfig.ZhuangBanId)if(SubRoles.ins().getSubRoleByIndex(this.curRole).job==GlobalConfig.ZhuangBanId[e].roletype&&this.selectIndex+1==GlobalConfig.ZhuangBanId[e].pos){var i=new DressItemInfo;i.zhuanban=GlobalConfig.ZhuangBanId[e],i.lv=0;var s=i.zhuanban.id;t.timeInfo[s]&&(i.timer=t.timeInfo[s].invalidtime,i.lv=t.timeInfo[s].lv),t.posInfo.length>this.curRole&&s==t.posInfo[this.curRole].posAry[this.selectIndex]&&(i.isDress=!0),this.listInfo.push(i)}if(this.listInfo.sort(this.sortList),this.arry.replaceAll(this.listInfo),this.list.dataProvider=this.arry,this.onInfoUpdate(),this.redPoint(),this.careerRedPoint(),-1!=this.listId){var n=this.listSelectIndex(this.listId);this.list.selectedIndex=n,this.list.scrollH=110*n}},e.prototype.sortList=function(t,e){return t.zhuanban.sort<e.zhuanban.sort?-1:t.zhuanban.sort>e.zhuanban.sort?1:0},e.prototype.redPoint=function(){for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=Dress.ins().canDress(SubRoles.ins().getSubRoleByIndex(t).job,this.tab.selectedIndex+1);this.roleSelect.showRedPoint(t,e)}},e.prototype.onInfoUpdate=function(t){if(void 0===t&&(t=null),null==t?(-1==this.list.selectedIndex&&(this.list.selectedIndex=0),this.dress=this.list.selectedItem,this.powerPanel.setPower(0)):this.dress=t,this.attrLv.visible=!0,this.attrLv.text="",this.dress){this.selectGroup.visible=!0,this.unSelectGroup.visible=!1;var e=this.dress.zhuanban.attr;if(this.dress.lv>1){var i=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id][this.dress.lv];e=AttributeData.AttrAddition(e,i.attr)}this.attrLabel.text=AttributeData.getAttStr(AttributeData.transformAttr(e),0,1,":");var s=this.getSlotDesc(this.dress.zhuanban.id);if(this.attrLabel.text+=s?"\n"+s:"",this.dress.zhuanban.wing_attr_per>0){this.attrLabel.text+="\n羽翼基础属性："+Math.floor(this.dress.zhuanban.wing_attr_per/100)+"%";var n=[],o=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData,a=o?o.lv:0;a=a>=0?a:0;for(var r=GlobalConfig.WingLevelConfig[a].attr,h=r.length,l=0;h>l;l++)n.push(new AttributeData(r[l].type,Math.floor(r[l].value*this.dress.zhuanban.wing_attr_per/1e4)));e=AttributeData.AttrAddition(e,n)}if(this.isCanLevelUp(this.dress)&&!this.isMaxLevel(this.dress)){var c=this.dress.lv+1,u=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id],p=u[c].attr;u[this.dress.lv]&&(p=AttributeData.AttrDel(p,u[this.dress.lv].attr));for(var d="",l=0;l<p.length;l++)d+="升级+"+p[l].value+"\n";var g=d.lastIndexOf("\n");d=d.substring(0,g),this.attrLv.text=d}var f=UserBag.getAttrPower(AttributeData.transformAttr(e));if(f+=this.dress.zhuanban.exPower?this.dress.zhuanban.exPower:0,this.powerPanel.setPower(f),this.namelabel.visible=!1,this.itemName.visible=!1,this.dressName.text="属性-"+this.dress.zhuanban.name,this.dressBtn.enabled=!0,this.dress.lv)if(this.isCanLevelUp(this.dress)){if(this.dressBtn.visible=!0,this.dressBtn2.visible=!0,this.isMaxLevel(this.dress))this.namelabel.visible=!1,this.itemName.visible=!1,this.dressBtn.label="已满级",this.dressBtn.enabled=!1;else{this.namelabel.visible=!0,this.itemName.visible=!0,this.dressBtn.label="升 级";var c=this.dress.lv+1,i=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id][c];this.id=i.cost.itemId,this.num=i.cost.num;var d=void 0;d=UserBag.ins().getBagGoodsCountById(0,this.id)>=this.num?"<font color = '#23C42A'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>":"<font color = '#f3311e'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>",this.itemName.textFlow=(new egret.HtmlTextParser).parser(d)}this.dress.isDress?this.dressBtn2.label="脱 下":this.dressBtn2.label="幻 化"}else this.namelabel.visible=!1,this.itemName.visible=!1,this.dressBtn.visible=!0,this.dressBtn2.visible=!1,this.dress.isDress?this.dressBtn.label="脱 下":this.dressBtn.label="幻 化";else{this.dressBtn.label="激 活",this.namelabel.visible=!0,this.itemName.visible=!0,this.dressBtn.visible=!0,this.dressBtn2.visible=!1,this.id=this.dress.zhuanban.cost.itemId,this.num=this.dress.zhuanban.cost.num;var d=void 0;d=UserBag.ins().getBagGoodsCountById(0,this.id)>=this.num?"<font color = '#23C42A'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>":"<font color = '#f3311e'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>",this.itemName.textFlow=(new egret.HtmlTextParser).parser(d)}this.onupdateEquip(!1)}else this.selectGroup.visible=!1,this.unSelectGroup.visible=!0,this.onupdateEquip(!0)},e.prototype.isCanLevelUp=function(t){var e=t.zhuanban.id;return GlobalConfig.ZhuangBanLevelUp[e]?!0:!1},e.prototype.isMaxLevel=function(t){var e=t.lv+1,i=t.zhuanban.id;return GlobalConfig.ZhuangBanLevelUp[i]&&GlobalConfig.ZhuangBanLevelUp[i][e]?!1:!0},e.prototype.onupdateEquip=function(t){void 0===t&&(t=!1);var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=Dress.ins().getModelPosId(this.curRole);if(!i||!i.posAry||i.posAry.length<=0){debug.log(this.listInfo);var s=this.listInfo[0];return 1==s.zhuanban.pos?(this.setEquip(e,s.zhuanban.id,this.lastWeapon),this.lastBody=s.zhuanban.id):2==s.zhuanban.pos?(this.setEquip(e,this.lastBody,s.zhuanban.id),this.lastWeapon=s.zhuanban.id):(this.setWing(s.zhuanban.id),this.lastWing=s.zhuanban.id),void debug.log("没有时装数据。。。。。。。。。。。。。。。。")}t?(this.setWing(i.posAry[2]),this.setEquip(e,i.posAry[0],i.posAry[1])):3==this.dress.zhuanban.pos?(this.setWing(this.dress.zhuanban.id),this.setEquip(e,this.lastBody||i.posAry[0],this.lastWeapon||i.posAry[1]),this.lastWing=this.dress.zhuanban.id):1==this.dress.zhuanban.pos?(this.setEquip(e,this.dress.zhuanban.id,this.lastWeapon||i.posAry[1]),this.lastBody=this.dress.zhuanban.id):(this.setEquip(e,this.lastBody||i.posAry[0],this.dress.zhuanban.id),this.lastWeapon=this.dress.zhuanban.id)},e.prototype.setWing=function(t){var e=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData;t>0?this.wingImg.source=this.getZhuangbanById(t).res+"_png":e.openStatus?this.wingImg.source=GlobalConfig.WingLevelConfig[e.lv].appearance+"_png":this.wingImg.source=""},e.prototype.setEquip=function(t,e,i){if(t){var s,n=t.equipsData;this.weaponImg.source="";for(var o=0;o<n.length;o++){n[o];if(0==o||2==o){var a=n[o].item.configID;if(a>0){var r=GlobalConfig.EquipConfig[a].appearance;r&&r.indexOf("[job]")>-1&&(r=r.replace("[job]",t.job+"")),0==o?this.weaponImg.source=r+"_"+t.sex+"_c_png":(this.bodyImg.source=r+"_"+t.sex+"_c_png",s=!0)}}}s||(this.bodyImg.source="body000_"+t.sex+"_c_png"),i>0&&(this.weaponImg.source=this.getZhuangbanById(i).res+"_"+t.sex+"_c_png"),e>0&&(this.bodyImg.source=this.getZhuangbanById(e).res+"_"+t.sex+"_c_png")}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.onJihuo=function(){Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id)},e.prototype.onClick=function(t){var i=this;switch(t.target){case this.closeBtn:ViewManager.ins().close(e);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,9);break;case this.itemName:var s=GlobalConfig.ItemConfig[this.id],n=ItemConfig.getType(s);void 0!=s&&s&&void 0!=n&&(0==n||4==n?ViewManager.ins().open(EquipDetailedWin,1,void 0,s.id):ViewManager.ins().open(ItemDetailedWin,0,s.id));break;case this.dressBtn2:"幻 化"==this.dressBtn2.label?Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id):Dress.ins().sendUnDressUserReq(this.curRole,this.dress.zhuanban.id);break;case this.dressBtn:if(!this.dress||!this.dress.zhuanban)return void debug.log(e,"DressWin　　"+this.dress+" ++++++ ");if("激 活"==this.dressBtn.label){if(UserBag.ins().getBagGoodsCountById(0,this.id)<this.num)return void UserTips.ins().showTips("|C:0xf3311e&T:激活道具不足|");if(3==this.dress.zhuanban.pos&&Actor.level<16)return void UserTips.ins().showTips("16级开启羽翼后可激活");var o={0:"通用",1:"战士",2:"法师",3:"道士"},a=GlobalConfig.ZhuangBanConfig.zhuangbanpos;WarnWin.show("确定要激活<font color='#35e62d'>"+(o[this.dress.zhuanban.roletype]+a[this.dress.zhuanban.pos-1])+"</font>装扮"+this.dress.zhuanban.name+"吗?",function(){Dress.ins().sendDressActivationReq(i.dress.zhuanban.id)},this)}else if("幻 化"==this.dressBtn.label)Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id);else if("升 级"==this.dressBtn.label){if(UserBag.ins().getBagGoodsCountById(0,this.id)<this.num)return void UserTips.ins().showTips("|C:0xf3311e&T:升级道具不足|");Dress.ins().sendLevelUp(this.dress.zhuanban.id)}else"脱 下"==this.dressBtn.label&&Dress.ins().sendUnDressUserReq(this.curRole,this.dress.zhuanban.id)}},e.prototype.useTitle=function(t){t.config.Id!=Title.ins().showTitleDic[Title.ins().curSelectRole]?t.config.job&&t.config.job!=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole()).job?UserTips.ins().showTips("职业不符"):Title.ins().setTitle(this.roleSelect0.getCurRole(),t.config.Id):Title.ins().setTitle(Title.ins().curSelectRole,0)},e.prototype.updateList=function(){this.titleList.dataProvider=Title.ins().list,Title.ins().list.refresh()},e.prototype.updateShow=function(t){var e,i,s;if(e=t[0],i=t[1],s=t[2],i>0==s>0)this.updateItemByID(s),this.updateItemByID(i);else for(var n in Title.ins().timeDict)this.updateItemByID(Number(n))},e.prototype.updateItemByID=function(t){if(t in Title.ins().infoDict){var e=Title.ins().infoDict[t];Title.ins().list.itemUpdated(e)}},e.prototype.getSlotDesc=function(t){var e=GlobalConfig.ZhuangBanId[t];if(!e||!e.attr_precent)return"";for(var i="",s=0;s<e.attr_precent.length;s++){switch(e.attr_precent[s].pos){case EquipPos.WEAPON:i="武器";break;case EquipPos.HEAD:i="头盔";break;case EquipPos.CLOTHES:i="衣服";break;case EquipPos.NECKLACE:i="项链";break;case EquipPos.Wrist:i="手镯";break;case EquipPos.BRACELET:i="腰带";break;case EquipPos.RING:i="戒指";break;case EquipPos.SHOE:i="鞋子"}i+="基础属性+"+Math.floor(e.attr_precent[s].pre/100)+"%\n"}if(i){var n=i.lastIndexOf("\n");i=i.substring(0,n)}return i},e}(BaseEuiView);__reflect(DressWin.prototype,"DressWin"),ViewManager.ins().reg(DressWin,LayerManager.UI_Main);var Encounter=function(t){function e(){var e=t.call(this)||this;return e.encounterModel=[],e.wildModel={},e.isGuiding=!1,e.wildPersonList={},e.isFindDrop=!1,e.buyAndFight=!1,e.encounterRank=0,e.sysId=PackageID.Encounter,e.regNetMsg(1,e.doLastRefreshTime),e.regNetMsg(2,e.doEncounterData),e.regNetMsg(3,e.doResult),e.regNetMsg(4,e.postZaoYuRecord),e.regNetMsg(7,e.postDataUpdate),e.regNetMsg(5,e.doUpdateWildBoss),e.regNetMsg(6,e.doWildBossResult),e.regNetMsg(8,e.doAddWildPlayer),e.regNetMsg(9,e.doWildPlayerResult),e.regNetMsg(10,e.doRedNameResult),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.doLastRefreshTime=function(t){EncounterModel.lastTime=t.readInt();t.readInt(),t.readInt();EncounterModel.refreshTimes=t.readInt(),EncounterModel.redName=t.readInt(),this.postEncounterDataChange()},e.prototype.sendRefresh=function(){this.sendBaseProto(1)},e.prototype.sendFightResult=function(t){if(void 0!=EncounterFight.ins().encounterIndex){1==t&&UserTips.ins().showTips("PK值增加"+GlobalConfig.SkirmishBaseConfig.onesPkval+"点");var e=this.getBytes(2);e.writeInt(EncounterFight.ins().encounterIndex),e.writeInt(t),this.sendToServer(e)}},e.prototype.postFightResult=function(t){return t},e.prototype.isEncounter=function(){return void 0!=EncounterFight.ins().encounterIndex&&EncounterFight.ins().encounterIndex>=0||this.isFindDrop},e.prototype.isHasRed=function(){for(var t=0,i=0;i<e.ins().encounterModel.length;i++)e.ins().getEncounterModel(i)&&t++;return t>0&&EncounterModel.redName<GlobalConfig.SkirmishBaseConfig.maxPkval?t:0},e.prototype.doEncounterData=function(t){var e=t.readInt();t.position-=4,this.encounterModel[e]=this.encounterModel[e]||new EncounterModel,this.encounterModel[e].parser(t),this.postEncounterDataChange()},e.prototype.postEncounterDataChange=function(){},e.prototype.sendGetreward=function(){this.sendBaseProto(3)},e.prototype.doResult=function(t){for(var i,s=t.readInt(),n=t.readInt(),o=[],a=[0,1,4,3],r=a.length,h=0;r>h;h++)i=new RewardData,i.type=0,i.id=a[h],i.count=t.readInt(),i.count&&o.push(i);r=t.readShort();for(var h=0;r>h;h++)i=new RewardData,i.parser(t),e.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,i),o.push(i);this.encounterModel[s-1]=null;if(n&&r){var l=function(){e.ins().isFindDrop=!1,this.sendGetreward(),EncounterFight.ins().win()};this.isFindDrop=!0,DropHelp.addCompleteFunc(l,this),DropHelp.start()}else n||EncounterFight.ins().lose();this.postEncounterDataChange()},e.prototype.getEncounterLength=function(){for(var t=0,i=0;i<e.ins().encounterModel.length;i++){var s=e.ins().getEncounterModel(i);s&&(t+=1)}return t},e.prototype.postDataUpdate=function(t){var e=t.readInt(),i=t.readShort();return this.encounterRank=i,[e,i]},e.prototype.sendInquirePrestige=function(){this.sendBaseProto(7)},e.prototype.postZaoYuRecord=function(t){if(void 0===t&&(t=null),!t)return null;for(var e=t.readShort(),i=[],s=0;e>s;s++){var n=[];n[0]=t.readInt(),n[1]=t.readBoolean(),n[2]=t.readString(),n[3]=t.readInt(),n[4]=t.readInt(),n[5]=t.readInt(),n[6]=t.readInt(),i[s]=n}return i},e.prototype.sendInquireRecord=function(){this.sendBaseProto(4)},e.prototype.doUpdateWildBoss=function(t){var e=t.readInt();this.willBossID=e,PlayFun.ins().upDataWillBoss(e)},e.prototype.createBoss=function(){},e.prototype.doWildBossResult=function(t){var i=t.readBoolean();if(i)for(var s=t.readShort(),n=0;s>n;n++){var o=new RewardData;o.parser(t),e.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,o)}var a=function(){this.sendGetAward(),GameLogic.ins().createGuanqiaMonster()};DropHelp.addCompleteFunc(a,this),DropHelp.start()},e.prototype.postCreateDrop=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return DropHelp.getItemCount()<5?(DropHelp.addDrop(t),!1):t},e.prototype.sendResult=function(t){var e=this.getBytes(5);
e.writeBoolean(t),this.sendToServer(e)},e.prototype.sendGetAward=function(){this.sendBaseProto(6)},e.prototype.getEncounterModel=function(t){return this.encounterModel[t]},e.prototype.clearEncounterModel=function(){this.encounterModel.length=0},e.prototype.sendCleanRedName=function(){this.sendBaseProto(8)},e.prototype.doAddWildPlayer=function(t){var e=new WildPlayerData;e.index=t.readInt();var i=t.readShort(),s=t.readShort();t.readShort(),t.readShort();e.actionType=t.readByte(),e.attackEnable=0!=t.readByte(),e.killNum=t.readInt(),e.backX=t.readShort(),e.backY=t.readShort();for(var n,o=t.readString(),a=t.readShort(),r=0;a>r;r++){var h=new Role;h.parser(t),h.x=i,h.y=s,h.name=o,h.type=EntityType.Role,h.killNum=0,GameLogic.ins().createEntityByModel(h,Team.Faker),0==r&&(n=h.handle),h.masterHandle=n}e.fireRing=new OtherFireRingData,e.fireRing.parser(t),this.wildPersonList[n]=e},e.prototype.canRunAwary=function(t){var e=this.wildPersonList[t];return e.backCount--,0==e.backCount},e.prototype.RunAwary=function(t){this.wildPersonList[t];delete this.wildPersonList[t]},e.prototype.sendWildPeopleResult=function(t,e){var i=this.getBytes(9);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doWildPlayerResult=function(t){for(var i,s=(t.readInt(),t.readInt()),n=[],o=t.readShort(),a=0;o>a;a++)i=new RewardData,i.parser(t),e.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,i),n.push(i);if(s){var r=function(){this.sendGetWildPeopleReward(),GameLogic.ins().createGuanqiaMonster()};DropHelp.addCompleteFunc(r,this),DropHelp.start()}else TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(GameMap.fbType,s,n,"",!1),GameLogic.ins().createGuanqiaMonster(),e.ins().wildPersonList={}},this)},e.prototype.sendCleanWildPeople=function(t){var e=this.getBytes(10);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetWildPeopleReward=function(){this.sendBaseProto(11)},e.prototype.doRedNameResult=function(t){UserTips.ins().showTips("PK值减少"+GlobalConfig.SkirmishBaseConfig.subPkval+"点")},e.prototype.checkIsEncounter=function(t,e){var i=this.encounterModel[t];if(!i)return!1;for(var s=i.subRole,n=0;n<s.length;n++){var o=s[n];if(o&&o.handle==e.handle)return!0}return!1},e}(BaseSystem);__reflect(Encounter.prototype,"Encounter");var GameSystem;!function(t){t.encounter=Encounter.ins.bind(Encounter)}(GameSystem||(GameSystem={}));var EncounterFight=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aiList={},e.encounterList={},e.willEntityFightTeam=Team.Monster,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.start=function(t){var e=this;if(Encounter.ins().isEncounter()||EntityManager.ins().getTeamCount(Team.WillBoss)>0)return void UserTips.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|");if(!UserFb.ins().checkInFB()&&Encounter.ins().encounterModel[t]){this.encounterIndex=t,this.rolePositions={},this.removeAllEncounter(),RoleAI.ins().stop(),DropHelp.clearDrop(),UserSkill.ins().setHejiCD(6e3),HejiUseMgr.ins().register(this),this.addCheckResult();for(var i=EntityManager.ins().getEntityByTeam(Team.My),s=0,n=i;s<n.length;s++){var o=n[s];if(o.stopMove(),o.playAction(EntityAction.STAND),o instanceof CharRole){this.rolePositions[o.infoModel.handle]={x:o.x,y:o.y,dir:o.dir};var a=new MovieClip;a.playFile(RES_DIR_SKILLEFF+"skill208",1),o.addChild(a),o.playAction(EntityAction.ATTACK)}else EntityManager.ins().removeByHandle(o.infoModel.handle)}TimerManager.ins().doTimer(800,1,function(){DropHelp.clearDrop(),e.addRole()},this),this.clearOldAI(),this.createEncounterAndMonster(),SoundUtil.ins().playEffect(SoundUtil.SCENE)}},e.prototype.addCheckResult=function(){TimerManager.ins().doTimer(1e3,0,this.checkResult,this)},e.prototype.checkResult=function(){Encounter.ins().isFindDrop||(0==EntityManager.ins().getTeamCount(Team.My)||0==EntityManager.ins().getTeamCount(Team.WillEntity))&&(0==EntityManager.ins().getTeamCount(Team.WillEntity)?this.sendFightResult(1):this.sendFightResult(0))},e.prototype.sendFightResult=function(t){t?Encounter.ins().sendFightResult(t):TimerManager.ins().doTimer(2e3,1,function(){Encounter.ins().sendFightResult(t)},this),Encounter.ins().postFightResult(t),TimerManager.ins().remove(this.checkResult,this)},e.prototype.win=function(){for(var t=this,e=EntityManager.ins().getEntityByTeam(Team.My),i=0,s=e;i<s.length;i++){var n=s[i];if(n.stopMove(),n instanceof CharRole){var o=new MovieClip;o.playFile(RES_DIR_SKILLEFF+"skill208",1),n.addChild(o),n.playAction(EntityAction.ATTACK)}else EntityManager.ins().removeByHandle(n.infoModel.handle)}SoundUtil.ins().playEffect(SoundUtil.SCENE),TimerManager.ins().doTimer(800,1,function(){for(var e=EntityManager.ins().getEntityByTeam(Team.My),i=0,s=e;i<s.length;i++){var n=s[i];EntityManager.ins().removeByHandle(n.infoModel.handle)}t.stop(),t.fightEnd(),GameMap.sceneInMain()&&(t.resetPos(),RoleAI.ins().start())},this)},e.prototype.lose=function(){SoundUtil.ins().playEffect(SoundUtil.SCENE),this.stop(),this.fightEnd()},e.prototype.fightEnd=function(){EncounterModel.redName<GlobalConfig.SkirmishBaseConfig.maxPkval&&Encounter.ins().getEncounterLength()&&ViewManager.ins().open(LadderWin)},e.prototype.stop=function(){if(void 0!=this.encounterIndex){HejiUseMgr.ins().unregister(this),TimerManager.ins().removeAll(this),EntityManager.ins().resetRole(),this.encounterIndex=void 0,this.willEntityFightTeam=Team.Monster,this.removeAllEncounter();for(var t in this.aiList){var e=EntityManager.ins().getEntityByHandle(t);e&&e.AI_STATE!=AI_State.Die&&RoleAI.ins().add(e)}this.aiList={},GameLogic.ins().postMoveCamera()}},e.prototype.resetPos=function(){var t=EntityManager.ins().getEntityByTeam(Team.My);for(var e in t){var i=t[e],s=this.rolePositions[i.infoModel.handle];s&&(i.x=s.x,i.y=s.y);var n=new MovieClip;n.playFile(RES_DIR_SKILLEFF+"skill208",1),i.addChild(n)}this.rolePositions={},GameLogic.ins().postMoveCamera()},e.prototype.removeAllEncounter=function(){for(var t in this.encounterList)EntityManager.ins().removeByHandle(t),delete this.encounterList[t]},e.prototype.addRole=function(){for(var t=EntityManager.ins().getEntityByTeam(Team.My),e=0,i=t;e<i.length;e++){var s=i[e];EntityManager.ins().removeByHandle(s.infoModel.handle)}EntityManager.ins().resetRole();var n=EntityManager.ins().getNoDieRole(),o=this.getRolePos();n.x=o[0]*GameMap.CELL_SIZE,n.y=o[1]*GameMap.CELL_SIZE;var a=EntityManager.ins().screeningTargetByPos(n);if(a[0])n.dir=DirUtil.get8DirBy2Point(n,a[0]);else{var r=Encounter.ins().encounterModel[this.encounterIndex];if(r){var h=r.subRole.length;Assert(!1,"遭遇战找不到敌人，实际遭遇战数据人数："+h)}}var l=EntityManager.ins().getMyOtherRolePos();t=EntityManager.ins().getEntityByTeam(Team.My);for(var c in t){if(t[c].playAction(EntityAction.STAND),RoleAI.ins().add(t[c]),t[c]!=n){var u=t[c].infoModel.handle;t[c].dir=n.dir,t[c].x=Math.floor(l[u].x),t[c].y=Math.floor(l[u].y)}var p=new MovieClip;p.playFile(RES_DIR_SKILLEFF+"skill208",1),t[c].addChild(p)}GameLogic.ins().postMoveCamera()},e.prototype.getRoles=function(){var t=Encounter.ins().encounterModel[this.encounterIndex];return t&&t.subRole},e.prototype.getSkillLvl=function(){var t=Encounter.ins().encounterModel[this.encounterIndex];return t&&t.hejiLvl||0},e.prototype.getIsWeiShe=function(t){var e=Encounter.ins().encounterModel[this.encounterIndex];return e?t?Actor.weiWang>e.weiWang:Actor.weiWang<e.weiWang:!1},e.prototype.getWeiSheHurt=function(t){if(!this.getIsWeiShe(t))return 0;var e=Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG),i="";if(t)i=Actor.myName;else{var s=Encounter.ins().encounterModel[this.encounterIndex];i=s.subRole[0].name}var n=0;if(e)for(var o=0;3>o;o++){var a=e.getDataList(o);if(a&&a.player==i){n=a.pos;break}}return GlobalConfig.PrestigeBase.rankDeterDam[n-1]||GlobalConfig.PrestigeBase.normalDeterDam},e.prototype.getRolePos=function(){var t=GlobalConfig.SkirmishBaseConfig.range;return GameMap.getPosRange(this.zyRolePos[0],this.zyRolePos[1],t)},e.prototype.clearOldAI=function(){this.aiList=RoleAI.ins().getAIList(),RoleAI.ins().clearAIList()},e.prototype.createEncounterAndMonster=function(){var t=UserFb.ins().zyPos,e=Math.floor(Math.random()*t.length),i=t[e],s=i[0];this.zyRolePos=s;var n=UserFb.ins().waveMonsterId[0],o=i[1];Assert(o,"关卡第"+UserFb.ins().guanqiaID+"关遭遇战怪物出生点配错")&&(o=[]);for(var a=0;a<o.length;a++){var r=UserFb.ins().createMonster(n);r.x=o[a][0]*GameMap.CELL_SIZE,r.y=o[a][1]*GameMap.CELL_SIZE;var h=GameLogic.ins().createEntityByModel(r);h.AI_STATE=AI_State.Patrol,this.encounterList[h.infoModel.handle]=h}for(var l=Encounter.ins().encounterModel[this.encounterIndex],c=l.subRole.length,a=0;c>a;a++){var u=l.subRole[a];if(u){u.setAtt(AttributeType.atHp,u.getAtt(AttributeType.atMaxHp)),u.setAtt(AttributeType.atMp,u.getAtt(AttributeType.atMaxMp)),u.type=EntityType.Role,u.x=s[0]*GameMap.CELL_SIZE+Math.floor(40*a*Math.random()),u.y=s[1]*GameMap.CELL_SIZE+Math.floor(40*a*Math.random());var p=GameLogic.ins().createEntityByModel(u,Team.WillEntity);p.AI_STATE=AI_State.Stand,p.updateNeiGong(),this.encounterList[u.handle]=p}}RoleAI.ins().start()},e}(BaseClass);__reflect(EncounterFight.prototype,"EncounterFight",["IHejiUse"]);var GameSystem;!function(t){t.encounterFight=EncounterFight.ins.bind(EncounterFight)}(GameSystem||(GameSystem={}));var EncounterModel=function(){function t(t){this.subRole=[],this.hejiLvl=0,this.weiWang=0,this.name=t}return t.prototype.parser=function(t){this.index=t.readInt(),this.lv=t.readShort(),this.zsLv=t.readShort(),this.name=t.readString(),this.subRole=[];for(var e=t.readShort(),i=0;e>i;i++){var s=this.subRole[i]=new Role;s.parser(t),s.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData,this.fireRing.parser(t),this.firstData=0!=t.readByte(),this.hejiLvl=t.readInt(),this.weiWang=t.readInt()},t.moveEncounterByMasterHandle=function(t,e,i){var s=EntityManager.ins().getMasterList(t);for(var n in s){var o=s[n];o.parent&&o.infoModel&&(GameMap.moveEntity(o,e,i),o.AI_STATE=AI_State.Run)}},t.countKillNumByMarster=function(t){var e=0,i=EntityManager.ins().getMasterList(t);for(var s in i){var n=i[s];n.parent&&n.infoModel&&(e+=n.infoModel.killNum)}return e},t.getLiveNumByMarster=function(t){var e=EntityManager.ins().getMasterList(t);for(var i in e){var s=e[i];if(s.parent&&s.infoModel)return 1}return 0},t}();EncounterModel.redName=0,__reflect(EncounterModel.prototype,"EncounterModel");var WildPlayerData=function(){function t(){}return t}();__reflect(WildPlayerData.prototype,"WildPlayerData");var BuyRedNameWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuQueSkin",e.horizontalCenter=0,e.verticalCenter=0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnBuy,this.onTap),this.addTouchEvent(this.btnClose,this.onTap),this.updateText()},e.prototype.updateText=function(){this.pkNow.text=""+EncounterModel.redName,this.ybNum.text=""+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*GlobalConfig.SkirmishBaseConfig.subPkvalCost,this.pkValue.text=""+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)},e.prototype.close=function(){this.removeTouchEvent(this.btnBuy,this.onTap),this.removeTouchEvent(this.btnClose,this.onTap)},e.prototype.onTap=function(t){switch(t.target){case this.btnBuy:if(!(Actor.yb>=(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*GlobalConfig.SkirmishBaseConfig.subPkvalCost)){UserTips.ins().showTips("元宝不足"),ViewManager.ins().close(this);break}Encounter.ins().sendCleanRedName(),Encounter.ins().buyAndFight=!0}ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(BuyRedNameWin.prototype,"BuyRedNameWin"),ViewManager.ins().reg(BuyRedNameWin,LayerManager.UI_Popup);var EncounterBgWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuBGSkin",e.isTopLevel=!0,e.encounterPanel=new EncounterInfoWin,e.viewStack.addChild(e.encounterPanel),e.tab.dataProvider=e.viewStack,e}return __extends(e,t),e.prototype.open=function(){this.roleSelect.hideRole(),this.addTouchEvent(this.btnClose,this.onTap),this.addTouchEvent(this.btnClose0,this.onTap),this.encounterPanel.open()},e.prototype.close=function(){this.encounterPanel.close()},e.prototype.onTap=function(t){switch(t.target){case this.btnClose:case this.btnClose0:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(EncounterBgWin.prototype,"EncounterBgWin"),ViewManager.ins().reg(EncounterBgWin,LayerManager.UI_Main);var EncounterInfoWin=function(t){function e(){var e=t.call(this)||this;return e.curIndex=-1,e.name="附近的人",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.myFace.source="head_"+SubRoles.ins().getSubRoleByIndex(0).job+SubRoles.ins().getSubRoleByIndex(0).sex,this.list.itemRenderer=EncounterInfoItem,this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.labelRed.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0x35e62d&T:立即挑战|"),Encounter.ins().sendInquireRecord(),Encounter.ins().sendInquirePrestige(),this.setData(),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.rewardBtn,this.onTap),this.observe(Encounter.ins().postEncounterDataChange,this.setData),this.observe(Encounter.ins().postDataUpdate,this.updatePrestigeRank)},e.prototype.$onClose=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.$onClose.call(this),TimerManager.ins().removeAll(this)},e.prototype.updatePrestigeRank=function(t){var e=t[0],i=t[1];this.dayPrestige.text=e+"",0==i?this.rank.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0xFB9409&T:未上榜|"):this.rank.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0xFB9409&T:"+i+"名|")},e.prototype.setData=function(){var t=[];this.curIndex>-1&&Encounter.ins().buyAndFight&&this.sendFight(this.curIndex),Encounter.ins().buyAndFight=!1,this.curIndex=-1,this.labelRedPoint.text=""+EncounterModel.redName,this.labelRedPoint.textColor=EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval?16711680:3532333,this.labelRed.visible=!1,EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval?(this.time.text="("+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)+"分钟后可挑战)",this.time.textColor=16711680):this.removeTime();for(var e=0;e<Encounter.ins().encounterModel.length;e++){var i=Encounter.ins().getEncounterModel(e);if(i){if(i.firstData){t=[i];break}t.push(i)}}0==t.length&&t.push(null),this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.addTime=function(){this.removeTime(),this.timeGap=60*(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1),this.time.text="("+DateUtils.getFormatBySecond(this.timeGap,3)+"后可挑战)",TimerManager.ins().doTimer(1e3,0,this.timeHandler,this)},e.prototype.timeHandler=function(){this.timeGap>0?(this.timeGap-=1,this.time.text="("+DateUtils.getFormatBySecond(this.timeGap,3)+"后可挑战)"):this.time.text=""},e.prototype.removeTime=function(){this.time.text="",TimerManager.ins().remove(this.timeHandler,this)},e.prototype.onTap=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof EncounterInfoItem){if(CityCC.ins().isCity)return void UserTips.ins().showTips("主城不能击杀附近的人,请先传送到野外");if("挑 战"==t.target.label||"挑战中"==t.target.label){if(UserFb.ins().checkInFB())return;var e=t.target.parent.data.index;if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);if(EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval)return this.curIndex=e,void ViewManager.ins().open(BuyRedNameWin);this.sendFight(e)}else"寻 敌"==t.target.label&&ViewManager.ins().open(FindEnemyWin)}else switch(t.target){case this.rankBtn:ViewManager.ins().open(RankingWin,RankDataType.TYPE_SKIRMISH);break;case this.recordBtn:ViewManager.ins().open(ZaoYuRecordWin);break;case this.labelRed:EncounterModel.redName>0?ViewManager.ins().open(BuyRedNameWin):UserTips.ins().showTips("没有可消除的PK值");break;case this.rank:ViewManager.ins().open(RankingWin,RankDataType.TYPE_SKIRMISH);break;case this.rewardBtn:ViewManager.ins().open(EncounterRewardWin)}},e.prototype.sendFight=function(t){UserFb.ins().checkInFB()||(ViewManager.ins().close(BagFullTipsWin),ViewManager.ins().closeTopLevel(),TimerManager.ins().doTimer(100,1,function(){EncounterFight.ins().start(t)},this))},e}(BaseComponent);__reflect(EncounterInfoWin.prototype,"EncounterInfoWin");var EncounterRewardRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data.maxRank==this.data.minRank?this.rank.text="第"+this.data.minRank+"名":this.rank.text="第"+this.data.minRank+"名~第"+this.data.maxRank+"名",this.item0.data=this.data.rewards[0],this.item1.data=this.data.rewards[1]},e}(BaseItemRender);__reflect(EncounterRewardRender.prototype,"EncounterRewardRender");var EncounterRewardWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="Zaoyurewardskin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list0.itemRenderer=EncounterRewardRender,this.rewardList=[];for(var t in GlobalConfig.SkirmishRankConfig)this.rewardList.push(GlobalConfig.SkirmishRankConfig[t])},e.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap),this.setPanelInfo()},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e.prototype.setPanelInfo=function(){this.list0.dataProvider=new eui.ArrayCollection(this.rewardList);var t=Encounter.ins().encounterRank;0==t?this.myRankText.textFlow=TextFlowMaker.generateTextFlow1("我的当前排名：|C:0xFB9409&T:未上榜|"):this.myRankText.textFlow=TextFlowMaker.generateTextFlow1("我的当前排名：|C:0xFB9409&T:"+t+"名|")},e}(BaseEuiView);__reflect(EncounterRewardWin.prototype,"EncounterRewardWin"),ViewManager.ins().reg(EncounterRewardWin,LayerManager.UI_Main);var FindEnemyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZaoYuTip0Skin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.closeCB),this.addTouchEvent(this.cancel,this.closeCB),this.addTouchEvent(this.ok,this.buy),this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn0,this.closeCB),this.removeTouchEvent(this.cancel,this.closeCB),this.removeTouchEvent(this.ok,this.buy)},e.prototype.updateView=function(){this.yuanbao.text=GlobalConfig.SkirmishBaseConfig.refreshCost+"元宝",this.count.text="（本日已主动寻找"+EncounterModel.refreshTimes+"次对手）"},e.prototype.closeCB=function(t){ViewManager.ins().close(this)},e.prototype.buy=function(t){Actor.yb>=GlobalConfig.SkirmishBaseConfig.refreshCost?(Encounter.ins().sendRefresh(),Encounter.ins().postZaoYuRecord(),ViewManager.ins().close(this)):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(FindEnemyWin.prototype,"FindEnemyWin"),ViewManager.ins().reg(FindEnemyWin,LayerManager.UI_Main);var WildBossWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZaoYuBossSkin",this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.x=250,this.bossImage.y=430,this.addChildAt(this.bossImage,6)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.thinkBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.challengeBtn,this.onTap),this.removeTouchEvent(this.thinkBtn,this.onTap)},e.openCheck=function(){return EntityManager.ins().getTeamCount(Team.WillBoss)?(UserTips.ins().showTips("正在挑战中"),!1):!0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:case this.thinkBtn:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(WildBossWin.prototype,"WildBossWin"),ViewManager.ins().reg(WildBossWin,LayerManager.UI_Main);var ZaoYuRecordItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuRecordInfoSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.time.text=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(t[0])/1e3,2),this.playerName.textFlow=(new egret.HtmlTextParser).parser('遭遇玩家：<font color="#3681FC">'+t[2]+"</font>"),this.exp.text=""+t[3],this.money.text=""+t[4],this.prestige.text=""+t[5],this.lingpo.text=t[6]||"0",t[1]?this.currentState="win":this.currentState="lose"},e}(BaseItemRender);__reflect(ZaoYuRecordItem.prototype,"ZaoYuRecordItem");var ZaoYuRecordWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuRecordSkin",e.list.itemRenderer=ZaoYuRecordItem,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.observe(Encounter.ins().postZaoYuRecord,this.updateData),Encounter.ins().sendInquireRecord()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeObserve()},e.prototype.updateData=function(t){function e(t,e){return t[0]<e[0]?1:t[0]>e[0]?-1:0}t&&(t.sort(e),this.list.dataProvider=new eui.ArrayCollection(t))},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ZaoYuRecordWin.prototype,"ZaoYuRecordWin"),ViewManager.ins().reg(ZaoYuRecordWin,LayerManager.UI_Main);var ExpGoldWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="exprefineSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.goUpBtn,this.onTap),this.observe(UserExpGold.ins().postExpUpdate,this.refreshShow),this.refreshShow()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.goUpBtn,this.onTap)},e.prototype.refreshShow=function(){if(UserExpGold.ins().checkIsOver())this.getAll.visible=!0,this.group.visible=!1;else{this.group.visible=!0,this.getAll.visible=!1,this.constImg.source="exprefine_json.explz_"+UserExpGold.ins().index;var t="可立即提升至<font color='#35e62d'>"+UserExpGold.ins().checkUpLevel()+"</font>级";this.depictLabel0.textFlow=(new egret.HtmlTextParser).parser(t);var e=GlobalConfig.RefinesystemExpConfig[UserExpGold.ins().index].yuanBao;Actor.yb>=e?this.goldConst.setText("<font color='#35e62d'>"+UserExpGold.ins().getIndexNeedGold()+"</font>"):this.goldConst.setText("<font color='#f3311e'>"+UserExpGold.ins().getIndexNeedGold()+"</font>");var i=UserExpGold.ins().remainTime;this.depictLabel.text="剩余时间："+DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.goUpBtn:UserExpGold.ins().checkIsCanPlay()}},e}(BaseEuiView);__reflect(ExpGoldWin.prototype,"ExpGoldWin"),ViewManager.ins().reg(ExpGoldWin,LayerManager.UI_Main);var UserExpGold=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.ExpGold,e.regNetMsg(1,e.doRemainTimeAndIndex),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.doRemainTimeAndIndex=function(t){this.remainTime=t.readUnsignedInt(),this.index=t.readInt(),this.postExpUpdate()},e.prototype.postExpUpdate=function(){},e.prototype.sendBuyExp=function(){this.sendBaseProto(2)},Object.defineProperty(e.prototype,"remainTime",{get:function(){return this._remainTime},set:function(t){this._remainTime!=t&&(this._remainTime=t,TimerManager.ins().remove(this.downTime,this),TimerManager.ins().doTimer(1e3,this._remainTime,this.downTime,this))},enumerable:!0,configurable:!0}),e.prototype.downTime=function(){this._remainTime-=1,this._remainTime<=0&&this.postExpUpdate()},e.prototype.getIndexNeedGold=function(){return GlobalConfig.RefinesystemExpConfig[this.index].yuanBao},e.prototype.checkIsOver=function(){return GlobalConfig.RefinesystemExpConfig[this.index]?!1:!0},e.prototype.checkIsCanPlay=function(){if(UserVip.ins().lv<3)return void UserTips.ins().showTips("|C:0xf3311e&T:vip3可炼制|");var t=GlobalConfig.RefinesystemExpConfig[this.index].yuanBao;return Actor.yb>=t?void e.ins().sendBuyExp():(UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),void ViewManager.ins().open(ChargeFirstWin))},e.prototype.isOpenBtn=function(){return Actor.level>=60&&this.remainTime>0?!this.checkIsOver():!1},e.prototype.checkUpLevel=function(){var t=Actor.level,e=GlobalConfig.RefinesystemExpConfig[this.index].exp,i=GlobalConfig.ExpConfig[t].exp-Actor.exp;if(e>=i)for(++t,e-=i,t;150>t&&(i=GlobalConfig.ExpConfig[t].exp,!(0>e-i));t++)e-=i;return t},e}(BaseSystem);__reflect(UserExpGold.prototype,"UserExpGold");var GameSystem;!function(t){t.userexpgold=UserExpGold.ins.bind(UserExpGold)}(GameSystem||(GameSystem={}));var ExtremeEquipModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectJob=0,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"descNames",{get:function(){return["至尊神剑","至尊头盔","至尊神甲","至尊项链","至尊手镯","至尊腰带","至尊戒指","至尊鞋子"]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return[EquipPos.WEAPON,EquipPos.CLOTHES,EquipPos.Wrist,EquipPos.RING,EquipPos.SHOE,EquipPos.BRACELET,EquipPos.NECKLACE,EquipPos.HEAD]},enumerable:!0,configurable:!0}),e.prototype.getZhiZunLv=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),s=i.getEquipByIndex(e),n=s.item.configID;return n?s.soulLv:0},e.prototype.getZhiZunLvByRoleID=function(t,e){if(!t||e>EquipPos.SHOE)return 0;var i=t.getEquipByIndex(e),s=i.item.configID;return s?i.soulLv:0},e.prototype.isWear=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),s=i.getEquipByIndex(e),n=s.item.configID;return n?!0:!1},e.prototype.canOperate=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),s=i.getEquipByIndex(e),n=s.item.configID;if(n){var o=s.soulLv;if(o<this.getMaxZhiZunEquipLevel(ItemConfig.getSubType(s.item.itemConfig))){var a=GlobalConfig.ZhiZunEquipLevel[e][o+1],r=a.materialInfo.count,h=UserBag.ins().getBagGoodsCountById(0,a.materialInfo.id);return h>=r}}return!1},e.prototype.getRedPointByJob=function(t){for(var e=EquipPos.WEAPON;e<=EquipPos.SHOE;e++)if(this.canOperate(t,e))return!0;return!1},e.prototype.getRedPoint=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e),s=i.job;if(this.getRedPointByJob(s))return!0}return!1},e.prototype.getMaxZhiZunEquipLevel=function(t){var e=CommonUtils.getObjectLength(GlobalConfig.ZhiZunEquipLevel[t]);return e},e.prototype.getZhiZunSkills=function(t){for(var e=[EquipPos.WEAPON,EquipPos.CLOTHES],i=[],s=0,n=e;s<n.length;s++){var o=n[s],a=t.getEquipByIndex(o);if(a.item.configID){var r=a.soulLv;if(r>0){var h=GlobalConfig.ZhiZunEquipLevel[o][r];h.skillId&&i.push(new SkillData(h.skillId))}}}return i},e.prototype.getZhiZunSkill=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),s=i.getEquipByIndex(e),n=s.item.configID;if(n){var o=s.soulLv;if(o>0){var a=GlobalConfig.ZhiZunEquipLevel[e][o];return a.skillId}}return 0},e.prototype.getZhiZunLinkLv=function(t,e,i){var s=this.getLinkEquipPos(e),n=SubRoles.ins().getSubRoleByIndex(t-1);if(Assert(n,"函数getZhiZunLinkLv， roleIndex:"+t+",mainPos:"+e+",soullv:"+i))return 0;var o=n.getEquipByIndex(e),a=n.getEquipByIndex(s);return o&&a?Math.min(i,a.soulLv):0},e.prototype.getZhiZunLinkLvShow=function(t,e,i){var s=SubRoles.ins().getSubRoleByIndex(t),n=s.getEquipByIndex(e);if(n&&i){var o=GlobalConfig.ZhiZunEquipLevel[e][i];return o.soulLinkLevel}return 1},e.prototype.getLinkEquipPos=function(t){for(var e in GlobalConfig.ZhiZunLinkLevel)if(e==t.toString())for(var i in GlobalConfig.ZhiZunLinkLevel[e])return+i;return null},e.prototype.getZhiZunLinkLevelConfig=function(t,i,s){var n=t,o=i,a=e.ins().getZhiZunLv(o,n);a||(a=1);var r=e.ins().getLinkEquipPos(n);s&&(a+=1);var h=GlobalConfig.ZhiZunLinkLevel[n][r][a];return h},e.prototype.getZhiZunEquipLevelConfig=function(t,e,i){var s=t,n=e;n||(n=1),i&&(n+=1);var o=GlobalConfig.ZhiZunEquipLevel[s][n];return o},e.prototype.getSkillName=function(t){var e=GlobalConfig.ZhiZunEquipLevel[t][1];if(!e)return"";var i=GlobalConfig.SkillsConfig[e.skillId];if(!i)return"";var s=GlobalConfig.SkillsDescConfig[i.desc];return s?s.name:""},e.prototype.getSkillDesc=function(t){var e=GlobalConfig.ZhiZunEquipLevel[t][1];if(!e)return"";var i=GlobalConfig.SkillsConfig[e.skillId];if(!i)return"";var s=GlobalConfig.SkillsDescConfig[i.desc];if(!s)return"";var n=s.desc;return n=n.replace("%s%",i.desc_ex[0]+"")},e}(BaseClass);__reflect(ExtremeEquipModel.prototype,"ExtremeEquipModel");var ExtremeEquipPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuList.itemRenderer=ExtremeEquipItem,this.menuListData=new ArrayCollection,this.menuList.dataProvider=this.menuListData,this.menuList.selectedIndex=0,this.addTouchEvent(this.leftBtn,this.onLeft),this.addTouchEvent(this.rightBtn,this.onRight),this.addTouchEvent(this.updateBtn,this.update),this.addTouchEvent(this.skillIcon0,this.onClick),this.addTouchEvent(this.skillIcon1,this.onClick),this.addTouchEvent(this.chainImg0,this.onClick),this.addTouchEvent(this.chainImg1,this.onClick),this.addTouchEvent(this.skillIcon2,this.onClick),this.addTouchEvent(this.chainImg2,this.onClick),this.menuList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.addChangeEvent(this.menuScroller,this.onChange),this.observe(UserEquip.ins().postZhiZunUpgrade,this.undateView),ViewManager.ins().getView(AdvanEquipWin).isNotMove=!0,this.listWidth=726,this.setRoleId(t[0])},e.prototype.onClick=function(t){var e,i,s,n,o,a;switch(t.currentTarget){case this.skillIcon0:case this.skillIcon2:i=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob),n=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,this.menuList.selectedItem),s=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem,n),o=GlobalConfig.SkillsConfig[s.skillId],e=GlobalConfig.SkillsDescConfig[o.desc],a=e.desc,a=a.replace("%s%",o.desc_ex[0]+""),ViewManager.ins().open(ExtremeSkillTipsWin,e.name+("Lv."+i.level),a);break;case this.chainImg0:case this.chainImg2:i=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob),ViewManager.ins().open(ExtremeSkillTipsWin,"灵魂锁链Lv."+i.level,i.chainDesc);break;case this.skillIcon1:i=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob),n=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,this.menuList.selectedItem),s=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem,n,!0),o=GlobalConfig.SkillsConfig[s.skillId],e=GlobalConfig.SkillsDescConfig[o.desc],a=e.desc,a=a.replace("%s%",o.desc_ex[0]+""),ViewManager.ins().open(ExtremeSkillTipsWin,e.name+("Lv."+i.level),a);break;case this.chainImg1:i=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob,!0),ViewManager.ins().open(ExtremeSkillTipsWin,"灵魂锁链Lv."+i.level,i.chainDesc)
}},e.prototype.undateView=function(){var t=this.menuList.selectedItem;this.pos=t,this.setRoleId(this.curRole,t)},e.prototype.update=function(){var t=ExtremeEquipModel.ins().selectJob,e=this.menuList.selectedItem,i=SubRoles.ins().getSubRoleByJob(t),s=i.getEquipByIndex(e),n=s.item.configID;return n?ExtremeEquipModel.ins().canOperate(t,e)?void UserEquip.ins().upgradeZhiZunEquip(i.index,e):void UserTips.ins().showTips("|C:0xff0000&T:材料不足"):void UserTips.ins().showTips("|C:0xff0000&T:该部位未穿戴装备")},e.prototype.onListChange=function(){var t=this.menuList.selectedItem;this.pos=t,this.selectEquip(t),this.selectList()},e.prototype.onLeft=function(){var t=410,e=0;e=this.menuList.scrollH-t,e=82*Math.round(e/82),0>e&&(e=0),this.menuList.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=410,e=0;e=this.menuList.scrollH+t,e=82*Math.round(e/82),e>this.listWidth-this.menuScroller.width&&(e=this.listWidth-this.menuScroller.width),this.menuList.scrollH=e,this.onChange()},e.prototype.setRoleId=function(t,e){t=t?t:0,this.curRole=t;var i=SubRoles.ins().getSubRoleByIndex(t),s=i.job;ExtremeEquipModel.ins().selectJob=s,this.menuListData.replaceAll(ExtremeEquipModel.ins().positions),e=e?e:this.pos?this.pos:EquipPos.WEAPON,this.pos=e,this.selectEquip(e)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.menuList.scrollH>=this.listWidth-this.menuList.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.leftRed.visible=ExtremeEquipModel.ins().getRedPoint(),this.rightRed.visible=ExtremeEquipModel.ins().getRedPoint()},e.prototype.selectEquip=function(t){this.extremeName.source="extreme_name_0"+t;var e=ExtremeEquipModel.ins().selectJob,i=SubRoles.ins().getSubRoleByJob(e),s=ExtremeEquipModel.ins().getZhiZunLv(e,t);if(s)if(s>=ExtremeEquipModel.ins().getMaxZhiZunEquipLevel(t)){this.attrGroup1.visible=!0,this.attrGroup0.visible=!1,this.updateBtn.visible=this.redPoint.visible=this.cost.parent.visible=!1;var n=GlobalConfig.ZhiZunEquipLevel[t][s],o=AttributeData.getAttStr(n.attrs,0,1,"  :  ");this.attr2.text=o,this.skillChain2.text="灵魂锁链Lv."+ExtremeEquipModel.ins().getZhiZunLinkLvShow(i.index,t,s);var a=ExtremeEquipModel.ins().getSkillName(t);a&&(this.skillName2.text=a+"Lv."+s,this.skillIcon2.source=UserSkill.ins().getSkillIdIcon(n.skillId));var r=Math.floor(UserBag.getAttrPower(n.attrs))+n.ex_power;r+=this.getChainAddPower(t,s),this.powerPanel2.setPower(r)}else{this.attrGroup1.visible=!1,this.attrGroup0.visible=!0,this.updateBtn.visible=this.cost.parent.visible=!0;var n=GlobalConfig.ZhiZunEquipLevel[t][s+1],h=GlobalConfig.ItemConfig[n.materialInfo.id],l=n.materialInfo.count;this.cost.text=h.name;var c=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,n.materialInfo.id),u=void 0;c>=l?(u=ColorUtil.GREEN_COLOR,this.isItemEnough=!0):(u=ColorUtil.RED_COLOR,this.isItemEnough=!1),this.numLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+c+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+l+"</font> ");var o=AttributeData.getAttStr(n.attrs,0,1,"  :  "),p=void 0,d=void 0;0==s?(d=GlobalConfig.ZhiZunEquipLevel[t][1],p=AttributeData.getAttStr(d.attrs,0,1,"  :  ")):(d=GlobalConfig.ZhiZunEquipLevel[t][s],p=AttributeData.getAttStr(d.attrs,0,1,"  :  ")),this.attr0.text=p,this.attr1.text=o;var g=Math.floor(UserBag.getAttrPower(d.attrs))+d.ex_power,f=Math.floor(UserBag.getAttrPower(n.attrs))+n.ex_power;g+=this.getChainAddPower(t,s),f+=this.getChainAddPower(t,s+1),this.powerPanel0.setPower(g),this.powerPanel1.setPower(f),this.skillChain0.text="灵魂锁链Lv."+ExtremeEquipModel.ins().getZhiZunLinkLvShow(i.index,t,s),this.skillChain1.text="灵魂锁链Lv."+ExtremeEquipModel.ins().getZhiZunLinkLvShow(i.index,t,s+1);var a=ExtremeEquipModel.ins().getSkillName(t);a&&(this.skillName0.text=a+"Lv."+s,this.skillName1.text=a+"Lv."+(s+1),this.skillIcon0.source=UserSkill.ins().getSkillIdIcon(n.skillId),this.skillIcon1.source=UserSkill.ins().getSkillIdIcon(n.skillId)),this.redPoint.visible=ExtremeEquipModel.ins().canOperate(e,t),this.updateBtn.label="升 级"}else{this.attrGroup1.visible=!0,this.attrGroup0.visible=!1,this.updateBtn.label="激 活",this.updateBtn.visible=!0;var d=GlobalConfig.ZhiZunEquipLevel[t][1],p=AttributeData.getAttStr(d.attrs,0,1,"  :  ");this.attr2.text=p,this.skillChain2.text="灵魂锁链Lv.1";var a=ExtremeEquipModel.ins().getSkillName(t);a&&(this.skillName2.text=a+"Lv.1",this.skillIcon2.source=UserSkill.ins().getSkillIdIcon(d.skillId));var r=Math.floor(UserBag.getAttrPower(d.attrs))+d.ex_power;r+=this.getChainAddPower(t,s),this.powerPanel2.setPower(r);var c=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,d.materialInfo.id),h=GlobalConfig.ItemConfig[d.materialInfo.id],l=d.materialInfo.count;this.cost.text=h.name;var u=void 0;c>=l?(u=ColorUtil.GREEN_COLOR,this.isItemEnough=!0):(u=ColorUtil.RED_COLOR,this.isItemEnough=!1),this.numLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+c+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+l+"</font> "),this.redPoint.visible=ExtremeEquipModel.ins().canOperate(e,t)}t==EquipPos.WEAPON||t==EquipPos.CLOTHES?(this.skill_0_0.parent||this.group0.addChild(this.skill_0_0),this.skill_1_0.parent||this.group1.addChild(this.skill_1_0),this.skill_2_0.parent||this.group3.addChild(this.skill_2_0)):(this.skill_0_0.parent&&this.skill_0_0.parent.removeChild(this.skill_0_0),this.skill_1_0.parent&&this.skill_1_0.parent.removeChild(this.skill_1_0),this.skill_2_0.parent&&this.skill_2_0.parent.removeChild(this.skill_2_0)),this.setEff(t),this.selectList(),this.onChange()},e.prototype.setEff=function(t){this.mc1||(this.mc1=new MovieClip),this.mc1.parent||this.extreme_eff.addChild(this.mc1),this.mc2||(this.mc2=new MovieClip),this.mc2.parent||this.extreme_eff_bottom.addChild(this.mc2),this.mc1.playFile(RES_DIR_EFF+("extrme_eff_0"+t),-1),this.mc2.playFile(RES_DIR_EFF+"extrme_eff_bottom",-1)},e.prototype.selectList=function(){for(var t=this.menuList.dataProvider.length,e=0;t>e;e++){var i=this.menuList.getElementAt(e);i&&(e!=this.menuList.selectedIndex?i.setSelect(!1):i.setSelect(!0))}},e.prototype.getChainAddPower=function(t,e){if(!e)return 0;var i=GlobalConfig.ZhiZunEquipLevel[t][e];if(!i)return 0;var s=ExtremeEquipModel.ins().getLinkEquipPos(t),n=GlobalConfig.ZhiZunLinkLevel[t][s][i.soulLinkLevel];if(!n)return 0;var o=0,a=SubRoles.ins().getSubRoleByIndex(this.curRole);if(n.attrs){o+=UserBag.getAttrPower(n.attrs);for(var r in n.attrs)o+=ItemConfig.relatePower(n.attrs[r],a)}var h=n.ex_power?n.ex_power:0;return o=Math.floor(o)+h},e.prototype.close=function(){ViewManager.ins().getView(AdvanEquipWin).isNotMove=!1},e}(BaseView);__reflect(ExtremeEquipPanel.prototype,"ExtremeEquipPanel");var ExtremeEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ExtremeEquipTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.posId=t[0],this.addTouchEvent(this.bgClose,this.onTouch),this.updateTips()},e.prototype.updateTips=function(){this.pos.text=Role.getEquipNameByType(this.posId);var t=GlobalConfig.ZhiZunEquipLevel[this.posId][1],e=t.materialInfo.id,i=GlobalConfig.ItemConfig[e];this.nameLabel.text=i.name,this.itemIcon.setData(i),this.powerPanel.setPower(t.showPower);for(var s in t.attrs)this["attr"+t.attrs[s].type]&&(this["attr"+t.attrs[s].type].text=t.attrs[s].value);this.posId==EquipPos.WEAPON||this.posId==EquipPos.CLOTHES?(this.chainName.text=ExtremeEquipModel.ins().getSkillName(this.posId),this.chainPos.textFlow=TextFlowMaker.generateTextFlow1(StringUtils.replaceStrColor(ExtremeEquipModel.ins().getSkillDesc(this.posId),"0xffff00"))):DisplayUtils.removeFromParent(this.chainGroup);var n=ExtremeEquipModel.ins().getLinkEquipPos(this.posId),o=GlobalConfig.ZhiZunLinkLevel[this.posId][n][1];this.soulAttr.textFlow=TextFlowMaker.generateTextFlow1(StringUtils.replaceStrColor(o.chainDesc,"0xffff00"))},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ExtremeEquipTipsWin.prototype,"ExtremeEquipTipsWin"),ViewManager.ins().reg(ExtremeEquipTipsWin,LayerManager.UI_Popup);var ExtremeSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="YupeiSkillTipsNewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.nameLabel.text=t[0],this.description.textFlow=TextFlowMaker.generateTextFlow1(t[1]),this.addTouchEvent(this.bgClose,this.onTouch)},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ExtremeSkillTipsWin.prototype,"ExtremeSkillTipsWin"),ViewManager.ins().reg(ExtremeSkillTipsWin,LayerManager.UI_Main);var ExtremeEquipItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.redPoint.visible=ExtremeEquipModel.ins().canOperate(ExtremeEquipModel.ins().selectJob,t);var e,i=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,t);e=0>=i?ExtremeEquipModel.ins().descNames[t]:ExtremeEquipModel.ins().descNames[t],this.nameLabel.text=e,this.selectIcon.visible=this.selected,this.itemIcon.source="icon_extreme_0"+t},e.prototype.setSelect=function(t){this.selectIcon.visible=t},e}(ItemRenderer);__reflect(ExtremeEquipItem.prototype,"ExtremeEquipItem");var FbModel=function(){function t(){}return t.prototype.parser=function(t){this.fbID=t.readInt(),this.useCount=t.readShort(),this.vipBuyCount=t.readShort(),this.vipHoldCount=t.readShort(),this.isPass=t.readBoolean()},t.prototype.getCount=function(){if(Assert(!isNaN(this.fbID),"fbid is undefined"))return 0;var t=GlobalConfig.DailyFubenConfig[this.fbID];if(Assert(t,"DailyFubenConfig is null"))return 0;if(t.zsLevel>0){if(UserZs.ins().lv<t.zsLevel)return 0}else if(Actor.level<t.levelLimit)return 0;return t.freeCount+this.vipBuyCount+this.vipHoldCount-this.useCount},t.prototype.getPlayCount=function(){if(Assert(!isNaN(this.fbID),"fbid is undefined"))return 0;var t=GlobalConfig.DailyFubenConfig[this.fbID];return Assert(t,"DailyFubenConfig is null")?0:t.freeCount+this.vipBuyCount+this.vipHoldCount-this.useCount},t.prototype.getNextVip=function(){if(Assert(!isNaN(this.fbID),"fbid is undefined"))return-1;var t=GlobalConfig.DailyFubenConfig[this.fbID];if(Assert(t,"DailyFubenConfig is null"))return-1;for(var e in t.vipBuyCount)if(this.useCount-t.freeCount-t.vipBuyCount[e]<0)return parseInt(e);return-1},t.prototype.getResetCount=function(){var t=UserVip.ins().lv,e=GlobalConfig.DailyFubenConfig[this.fbID];return e.vipBuyCount[t]-(this.useCount-e.freeCount)},t}();__reflect(FbModel.prototype,"FbModel");var FbRedPoint=function(t){function e(){var e=t.call(this)||this;return e.isOpen=!0,e.registerTab(0,UserFb.ins().postFbInfoInit,UserFb.ins().postUpDataInfo,DieGuide.ins().postdieGuide,Actor.ins().postExp),e.registerTab(1,UserFb.ins().postFbExpInfo),e.registerTab(2,UserFb2.ins().postUpDataInfo),e.registerTab(3,Millionaire.ins().postMillionaireInfo,Millionaire.ins().postTurnDice,Millionaire.ins().postRoundReward,Millionaire.ins().postMillionaireUpdate,BattleCC.ins().postOpenInfo,Actor.ins().postLevelChange,PaoDianCC.ins().postOpenInfo),e.registerTab(4,UserZs.ins().postZsLv,GameApp.ins().postZeroInit,UserFb.ins().postGuardInfo),e}return __extends(e,t),e.prototype.getTabRedPoint=function(t){return 0==t?UserFb.ins().hasCount():1==t?UserFb.ins().fbExpRed():2==t?SkyLevelModel.ins().cruLevel>1&&1==SkyLevelModel.ins().dayReward||SkyLevelModel.ins().lotteryRemainTimes>0:3==t?BattleCC.ins().checkRedPoint()||Millionaire.ins().getRedPoint()||PaoDianCC.ins().checkRedPoint():4==t?GuardWeaponModel.ins().canChallenge():!1},e}(RedPointBase);__reflect(FbRedPoint.prototype,"FbRedPoint");var GameSystem;!function(t){t.fbredpoint=FbRedPoint.ins.bind(FbRedPoint)}(GameSystem||(GameSystem={}));var MapType;!function(t){t[t.chapterMap=0]="chapterMap",t[t.bigMap=1]="bigMap"}(MapType||(MapType={}));var SpeakType;!function(t){t[t.appear=1]="appear",t[t.hit=2]="hit",t[t.die=3]="die"}(SpeakType||(SpeakType={}));var MonsterSpeak=function(t){function e(){var e=t.call(this)||this;return e.speakDic={},e.observe(GameLogic.ins().postHpChange,function(t){var i=t[0],s=t[1];40001==GameMap.fubenID&&(i instanceof CharRole||e.trigger(i.infoModel.configID,s>0?SpeakType.hit:SpeakType.die))}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.clear=function(){this.speakDic={}},e.prototype.trigger=function(t,e){if((!this.speakDic[t]||!this.speakDic[t][e])&&GlobalConfig.MonsterSpeakConfig){var i=GlobalConfig.MonsterSpeakConfig[t];i&&i[e]&&(this.postMonsterSpeak(i[e].speak),this.speakDic[t]=this.speakDic[t]||{},this.speakDic[t][e]=1)}},e.prototype.postMonsterSpeak=function(t){return t},e}(BaseSystem);__reflect(MonsterSpeak.prototype,"MonsterSpeak");var GameSystem;!function(t){t.monsterSpeak=MonsterSpeak.ins.bind(MonsterSpeak)}(GameSystem||(GameSystem={}));var SkyLevelModel=function(){function t(){this.cruLevel=1,this.lastPass=!1,this.stageLevel=1,this.dayReward=1,this.limitTime=180,this.rewardTimes=0}return t.ins=function(){return this._instance||(this._instance=new t),this._instance},Object.defineProperty(t.prototype,"lotteryRemainTimes",{get:function(){var t,e=0;if(0!=this.cruLevel){if(t=GlobalConfig.FbChallengeConfig[this.cruLevel-1],this.cruLevel-1<GlobalConfig.FbChallengeBaseConfig.LotteryOpenLevel)return 0}else{var i=Object.keys(GlobalConfig.FbChallengeConfig).length;t=GlobalConfig.FbChallengeConfig[i]}return t?e=t.lotteryCount-this.lotteryUseTimes:0},enumerable:!0,configurable:!0}),t.prototype.isGetLotteryAward=function(t){return 1==(this.lotteryIndexs>>t&1)},t.prototype.getNextOpenLevel=function(){var t=GlobalConfig.FbChallengeConfig;for(var e in t)if(t[e].id>=this.cruLevel&&t[e].showIcon)return t[e];return null},t.prototype.getIsopenNext=function(){var t=GlobalConfig.FbChallengeConfig,e=t[this.cruLevel];return Actor.level>=e.levelLimit&&Actor.zhuanShengLv>=e.zsLevelLimit?!0:!1},t.prototype.getSkyLevelList=function(){var t=[],e=GlobalConfig.FbChallengeConfig,i=e[this.cruLevel],s=this.getStageList(),n=CommonUtils.getObjectLength(s);for(var o in s){var a=s[o];if(this.checkIsPushInlist(i.layer,a.layer,n)&&(t.push(a),t.length>=6))break}return t.reverse(),t},t.prototype.setLimtTimeDown=function(t){this.limitTime=t,TimerManager.ins().remove(this.timeDown,this),TimerManager.ins().doTimer(1e3,t,this.timeDown,this)},t.prototype.timeDown=function(){this.limitTime--,this.limitTime<0&&(this.limitTime=0,TimerManager.ins().remove(this.timeDown,this))},t.prototype.checkIsPushInlist=function(t,e,i){if(4>=t)return!0;if(t>4){var s=i-t>=3?3:i-t,n=6-s,o=t-n,a=t+s;return a>=e&&e>o}},t.prototype.getStageList=function(){var t=GlobalConfig.FbChallengeConfig,e=t[this.cruLevel];this.stageLevel=e.group;var i=[];if(!e)return i;for(var s in t){var n=t[s];n.group==e.group&&i.push(n)}return i},t.prototype.setCruLevelInfo=function(t){t>0?(this.cruLevel=t,this.lastPass=!1):(this.cruLevel=CommonUtils.getObjectLength(GlobalConfig.FbChallengeConfig),this.lastPass=!0)},t}();__reflect(SkyLevelModel.prototype,"SkyLevelModel");var Socket=function(t){function e(){var e=t.call(this)||this;return e._needReconnect=!1,e._maxReconnectCount=10,e._reconnectCount=0,e}return __extends(e,t),e.prototype.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},e.prototype.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},e.prototype.onSocketOpen=function(){this._reconnectCount=0,this._connectFlag?MessageCenter.ins().dispatch(SocketConst.SOCKET_RECONNECT):MessageCenter.ins().dispatch(SocketConst.SOCKET_CONNECT),this._connectFlag=!0,this._isConnecting=!0},e.prototype.onSocketClose=function(){this._needReconnect?(this.reconnect(),MessageCenter.ins().dispatch(SocketConst.SOCKET_START_RECONNECT)):MessageCenter.ins().dispatch(SocketConst.SOCKET_CLOSE),this._isConnecting=!1},e.prototype.onSocketError=function(){this._needReconnect?this.reconnect():MessageCenter.ins().dispatch(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},e.prototype.onReceiveMessage=function(t){this._msg.receive(this._socket)},e.prototype.initServer=function(t,e,i){this._host=t,this._port=e,this._msg=i},e.prototype.connect=function(){return DeviceUtils.IsHtml5&&!window.WebSocket?void Log.trace("不支持WebSocket"):(this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),Log.trace("WebSocket: "+this._host+":"+this._port),this._socket.connect(this._host,this._port),void this.addEvents())},e.prototype.reconnect=function(){this.close(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?this.connect():(this._reconnectCount=0,this._connectFlag?MessageCenter.ins().dispatch(SocketConst.SOCKET_CLOSE):MessageCenter.ins().dispatch(SocketConst.SOCKET_NOCONNECT))},e.prototype.send=function(t){this._msg.send(this._socket,t)},e.prototype.close=function(){this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1,this._connectFlag=!1},e.prototype.isConnecting=function(){return this._isConnecting},e.prototype.debugInfo=function(t){MessageCenter.ins().dispatch(SocketConst.SOCKET_DEBUG_INFO,t)},e}(BaseClass);__reflect(Socket.prototype,"Socket");var UserFb2=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.FbChallenge,e.regNetMsg(1,e.postUpDataInfo),e.regNetMsg(2,e.postRewardStatu),e.regNetMsg(3,e.doGetFbTime),e.regNetMsg(4,e.postGetReward),e.regNetMsg(5,e.postLotteryReward),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendChallenge=function(){this.sendBaseProto(1)},e.prototype.sendrequestDayReward=function(){this.sendBaseProto(2)},e.prototype.postUpDataInfo=function(t){SkyLevelModel.ins().setCruLevelInfo(t.readInt()),SkyLevelModel.ins().dayReward=t.readShort(),SkyLevelModel.ins().lotteryIndexs=t.readInt(),SkyLevelModel.ins().lotteryUseTimes=t.readInt()},e.prototype.postRewardStatu=function(t){var e=t.readShort();SkyLevelModel.ins().dayRewardList=[];for(var i=0;e>i;i++){var s=t.readInt(),n=t.readInt(),o=t.readInt();SkyLevelModel.ins().dayRewardList[i]=[s,n,o]}SkyLevelModel.ins().rewardTimes=Math.ceil((e-12)/12)},e.prototype.doGetFbTime=function(t){SkyLevelModel.ins().setLimtTimeDown(t.readShort())},e.prototype.sendGetDayReward=function(){this.sendBaseProto(4)},e.prototype.sendBeginLottery=function(){this.sendBaseProto(5)},e.prototype.sendGetReward=function(){this.sendBaseProto(6)},e.prototype.postLotteryReward=function(t){SkyLevelModel.ins().lotteryUseTimes=t.readInt(),SkyLevelModel.ins().lotteryAwardIndex=t.readInt()},e.prototype.postGetReward=function(t){},e}(BaseSystem);__reflect(UserFb2.prototype,"UserFb2");var GameSystem;!function(t){t.userfb2=UserFb2.ins.bind(UserFb2)}(GameSystem||(GameSystem={}));var BabelLotteryWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="tttZhuanpan",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addCustomEvent(),this.updateView()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.choujiangBtn,this.getLottery),this.addTouchEvent(this.closeBtn,this.close),this.observe(UserFb2.ins().postLotteryReward,this.onGetRewards),this.observe(UserFb2.ins().postUpDataInfo,this.refreshView)},e.prototype.getLottery=function(){0==SkyLevelModel.ins().lotteryRemainTimes?UserTips.ins().showTips("没有抽奖次数，每通关10层可抽取1次"):this.rolling?UserTips.ins().showTips("正在抽奖，请稍候"):UserFb2.ins().sendBeginLottery()},e.prototype.onGetRewards=function(){this.beginLottery(SkyLevelModel.ins().lotteryAwardIndex)},e.prototype.refreshView=function(){var t=this;SkyLevelModel.ins().lotteryUseTimes%10==0?setTimeout(function(){t.updateView()},2e3):this.updateView()},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){UserFb2.ins().sendGetReward(),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1,e.refreshView()},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.updateView=function(){this.num.text=SkyLevelModel.ins().lotteryRemainTimes.toString();for(var t=SkyLevelModel.ins().lotteryUseTimes,e=10*parseInt((t/10).toString())+10,i=GlobalConfig.FbChallengeLotteryConfig[e],s=i.group.length,n=0;s>n;n++){var o=this["item"+n];o.itemIcon.data=i.group[n];var a=SkyLevelModel.ins().isGetLotteryAward(n+1);o.rewardState(a)}},e}(BaseEuiView);__reflect(BabelLotteryWin.prototype,"BabelLotteryWin"),ViewManager.ins().reg(BabelLotteryWin,LayerManager.UI_Main);var d_launchX=180,d_launchY=500,d_firstX=0,d_firstY=0,d_distantX=77,d_distantY=93,d_depotX=320,d_depotY=620,d_waitTime=50,ChallengeDayRewardWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.maxCount=12,e.isTopLevel=!0,e.skinName="chuangtianguanDayReward",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.GetRewardBtn0,this.challenge),this.addTouchEvent(this.bgClose,this.closeCB),this.observe(UserFb2.ins().postRewardStatu,this.setBtnStatu),UserFb2.ins().sendrequestDayReward()},e.prototype.challenge=function(){var t=function(){UserFb2.ins().sendGetDayReward()};this.playGet(t),this.canClicck=!1},e.prototype.setBtnStatu=function(){SkyLevelModel.ins().rewardTimes>=1?this.GetRewardBtn0.label="继续领取("+SkyLevelModel.ins().rewardTimes+")":this.GetRewardBtn0.label="确定",this.arr=SkyLevelModel.ins().dayRewardList.slice(),this.playResult()},e.prototype.playResult=function(t){for(var e=this,i=this.arr.length>this.maxCount?this.maxCount:this.arr.length,s=0;i>s;s++){this.items[s]=this.createItem(this.arr[s]);var n=egret.Tween.get(this.items[s]);this.items[s].x=s%4*d_distantX+d_firstX,this.items[s].y=Math.floor(s/4)*d_distantY+d_firstY,this.items[s].alpha=0,n.wait(s*d_waitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.playGet=function(t){for(var e=this,i=this.arr.length>this.maxCount?this.maxCount:this.arr.length,s=0;i>s;s++)if(this.items[s]){var n=egret.Tween.get(this.items[s]);n.to({y:d_depotY,x:d_depotX,scaleX:0,scaleY:0},300-50*Math.floor(s/4)).call(function(){i--,0==i&&(void 0!=t&&t(),e.releaseAllItem())})}},e.prototype.createItem=function(t){var e=new ItemBase;return this.listCon.addChild(e),e.data={type:t[0],count:t[2],id:t[1]},e.x=d_launchX,e.y=d_launchY,e},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[],0==SkyLevelModel.ins().rewardTimes&&ViewManager.ins().close(e)},e.prototype.closeCB=function(t){var e=this;if(this.canClicck){this.canClicck=!1;var i=function(){ViewManager.ins().close(e)};this.playGet(i)}},e}(BaseEuiView);__reflect(ChallengeDayRewardWin.prototype,"ChallengeDayRewardWin"),ViewManager.ins().reg(ChallengeDayRewardWin,LayerManager.UI_Main);var ChallengeInfoPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChuangtianguanBloodSkin",this.list.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU?Hungu.ins().getHunShouFbLeftTime():SkyLevelModel.ins().limitTime;this.time.text=DateUtils.getFormatBySecond(i,3),TimerManager.ins().doTimer(1e3,i,this.setTimeLimit,this),this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refushInfo=function(){var t=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel+1];t&&(this.levelLimit.text=t.zsLevelLimit>0?t.zsLevelLimit+"转":""+(t.levelLimit+"级可挑战"),this.setTimeLimit())},e.prototype.setTimeLimit=function(){var t=GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU?Hungu.ins().getHunShouFbLeftTime():SkyLevelModel.ins().limitTime;this.time.text=DateUtils.getFormatBySecond(t,3)},e}(BaseEuiView);__reflect(ChallengeInfoPanel.prototype,"ChallengeInfoPanel"),ViewManager.ins().reg(ChallengeInfoPanel,LayerManager.Game_Main);var assert=egret.assert,FBChallengePanel=function(t){function e(){var e=t.call(this)||this;return e.name="通天塔",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=SkyItemRenderer,this.iconList.itemRenderer=ItemBase,this.iconList0.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.challengeBtn,this.challenge),this.addTouchEvent(this.challengeBtn0,this.getDayRewward),this.addTouchEvent(this.jump,this.onClick),this.addTouchEvent(this.choujiang,this.lotto),this.refushPanelInfo(),this.observe(FbRedPoint.ins().postTabs,this.updateRedPoint),this.observe(UserFb2.ins().postGetReward,this.updateReward),this.observe(Rank.ins().postRankingData,this.initRanking),this.observe(UserFb2.ins().postUpDataInfo,this.updateRedPointStyle),Rank.ins().sendGetRankingData(RankDataType.TYPE_COPY),this.updateRedPoint(2),this.showRewwardLabel()},e.prototype.updateRedPointStyle=function(){this.redPoint0.visible=SkyLevelModel.ins().cruLevel>1&&1==SkyLevelModel.ins().dayReward,this.redPoint1.visible=SkyLevelModel.ins().lotteryRemainTimes>0,this.updateTowerState()},e.prototype.lotto=function(t){0==SkyLevelModel.ins().cruLevel&&0==SkyLevelModel.ins().rewardTimes?UserTips.ins().showTips("已全部通关"):ViewManager.ins().open(BabelLotteryWin)},e.prototype.destructor=function(){this.removeObserve(),this.removeTouchEvent(this.challengeBtn,this.challenge),this.removeTouchEvent(this.challengeBtn0,this.getDayRewward),this.removeTouchEvent(this.jump,this.onClick)},e.prototype.updateReward=function(){this.showRewwardLabel()},e.prototype.initRanking=function(t){if(t.type==RankDataType.TYPE_COPY){this.rankModel=t;for(var e=t.getDataList(),i=1;3>=i;i++){var s=e[i-1];if(s){this["name"+(i-1)].text=s.player;var n=GlobalConfig.FbChallengeConfig[s.count];Assert(n,"排行榜数据，爬塔异常：id("+s.count+")")?this["num"+(i-1)].text="":this["num"+(i-1)].text=n.group+"重天"+n.layer+"层"}else this["rankImg"+(i-1)].visible=this["name"+(i-1)].visible=this["num"+(i-1)].visible=!1}var o=this.jump.text;this.jump.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+o)}},e.prototype.refushPanelInfo=function(){var t=SkyLevelModel.ins().getSkyLevelList();this.list.dataProvider=new eui.ArrayCollection(t);var i=GlobalConfig.FbChNameConfig[SkyLevelModel.ins().stageLevel];this.nameLabel.text=i?i.name:"";var s=SkyLevelModel.ins(),n=s.getNextOpenLevel();if(n){var o=GlobalConfig.FbChNameConfig[n.group],a="通关"+o.name+n.layer+"层",r="";if(n.equipPos)r="第"+n.equipPos+"个战纹槽",this.noOpenTF.text=r,this.unlock.text="开启新战纹槽",this.itemicon.runeName=r,this.itemicon.desc2=""+o.name+n.layer+"层",this.itemicon.data=n.showIcon;else{this.itemicon.desc="通关"+o.name+n.layer+"层解锁",this.itemicon.data=n.showIcon;var h=GlobalConfig.ItemConfig[n.showIcon],l=ItemConfig.getQuality(h),c="解锁新类型";l==e.RunType&&(c="获得"),this.unlock.text=c}this.openDesc.text=a}else this.topGroup.visible=!1,this.buttomGroup.verticalCenter=0;var u=GlobalConfig.FbChallengeConfig[s.cruLevel];if(u){this.nowrawed.text="通关第"+u.layer+"层奖励";var p="",d=u.zsLevelLimit;d&&(p=d?d.toString()+"转":""),this.limit.text=""+p+u.levelLimit+"级可继续挑战",this.iconList.dataProvider=new eui.ArrayCollection([u.clearReward[0]]),this.iconList0.dataProvider=new eui.ArrayCollection([u.clearReward[1]]),this.expText.text=u.clearReward[2]?""+u.clearReward[2].count:"";var g=Actor.level>=u.levelLimit&&UserZs.ins().lv>=u.zsLevelLimit;this.limit.visible=!g,this.challengeBtn.visible=g,this.endImg.visible=u.layer<=4}},e.prototype.updateRedPoint=function(t){2==t&&(this.redPoint0.visible=SkyLevelModel.ins().cruLevel>1&&1==SkyLevelModel.ins().dayReward,this.redPoint1.visible=SkyLevelModel.ins().lotteryRemainTimes>0,this.updateTowerState())},e.prototype.updateTowerState=function(){var t=!0;0!=SkyLevelModel.ins().cruLevel&&SkyLevelModel.ins().cruLevel-1<GlobalConfig.FbChallengeBaseConfig.LotteryOpenLevel&&(t=!1),this.dailyGift0.visible=t,this.choujiang.visible=t},e.prototype.challenge=function(){if(!UserFb.ins().checkInFB()){if(SkyLevelModel.ins().lastPass)return void UserTips.ins().showTips("当前已全部通关");UserFb2.ins().sendChallenge(),ViewManager.ins().closeTopLevel()}},e.prototype.getDayRewward=function(){return SkyLevelModel.ins().cruLevel<=1?void UserTips.ins().showTips("通关一层后，明日0点可领取每日奖励，通关层数越高，奖励越好"):SkyLevelModel.ins().dayReward<1?void UserTips.ins().showTips("今天没有奖励可以领取"):2==SkyLevelModel.ins().dayReward?void UserTips.ins().showTips("明日0点可领取每日奖励，通关层数越高，奖励越好"):void ViewManager.ins().open(ChallengeDayRewardWin)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.jump:this.rankModel&&ViewManager.ins().open(FBChallengeRankWin,this.rankModel)}},e.prototype.showRewwardLabel=function(){var t="";t=1==SkyLevelModel.ins().dayReward?"可领取":"明日0点可领取",this.dailyGift.text=t},e}(BaseView);FBChallengePanel.RunType=3,__reflect(FBChallengePanel.prototype,"FBChallengePanel");var FBChallengeRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChuangtianguanRankItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data&&(this.data.pos>3?(this.rankImg.visible=!1,this.rank.visible=!this.rankImg.visible,this.rank.text=this.data.pos+""):(this.rankImg.visible=!0,this.rank.visible=!this.rankImg.visible,this.rankImg.source="paihang"+this.data.pos),this.vip.visible=this.data.vip,this.nameLabel.text=this.data.player,this.data.count)){var t=GlobalConfig.FbChallengeConfig[this.data.count],e=GlobalConfig.FbChNameConfig[t.group];this.cengNum.text=""+e.name+t.layer+"层"}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(FBChallengeRankItem.prototype,"FBChallengeRankItem");var FBChallengeRankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChuangtianguanRankSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.rankModel=t[0],this.list0.itemRenderer=FBChallengeRankItem,this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.init=function(){var t=this.rankModel.getDataList(),e=[];for(var i in t){if(!t[i].count)break;e.push(t[i])}this.list0.dataProvider=new eui.ArrayCollection(e);var s,n,o=e[this.rankModel.selfPos-1];if(o)s=GlobalConfig.FbChallengeConfig[o.count],n=GlobalConfig.FbChNameConfig[s.group],this.myRank.text="我的排名："+this.rankModel.selfPos;else{var a=SkyLevelModel.ins();s=GlobalConfig.FbChallengeConfig[a.cruLevel],n=GlobalConfig.FbChNameConfig[s.group],this.myRank.text="我的排名：未上榜"}s&&n&&(this.myNum.text=""+n.name+s.layer+"层")},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)
}},e}(BaseEuiView);__reflect(FBChallengeRankWin.prototype,"FBChallengeRankWin"),ViewManager.ins().reg(FBChallengeRankWin,LayerManager.UI_Popup);var FBCountDown=function(t){function e(){var e=t.call(this)||this;return e._count=1,e.skinName="FBCountDownSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(GameMap.fbType){case UserFb.FB_TYPE_PEAKED:t[0]&&(this._count=t[0]),this.bgImg.source="peakness_start_fight";break;default:return}TimerManager.ins().doTimer(1e3,this._count+1,this.upFun,this),this.upFun()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this)},e.prototype.upFun=function(){this.countDown.text=this._count+"",this._count--,this._count<0&&ViewManager.ins().close(e)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(GameMap.fbType){case UserFb.FB_TYPE_PEAKED:break;default:return!1}return!0},e}(BaseEuiView);__reflect(FBCountDown.prototype,"FBCountDown"),ViewManager.ins().reg(FBCountDown,LayerManager.UI_Popup);var FbExpPanel=function(t){function e(){var e=t.call(this)||this;return e.name="经验副本",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this,this.onTap),this.observe(UserFb.ins().postFbExpInfo,this.onUpdate),this.onUpdate()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),DisplayUtils.removeFromParent(this.eff),this.eff=null},e.prototype.onUpdate=function(){var t=UserFb.ins().fbExp,e=0;t.cid||t.sid?t.cid?(e=1,this.currentState="free"):(e=3,this.currentState="sdget"):t.useTime<=this.getChangeNum()?(e=0,this.currentState="challenge"):(e=2,this.currentState="sdfb"),this.validateNow(),this.onInitIndex(e)},e.prototype.getChangeNum=function(t){void 0==t&&(t=UserVip.ins().lv);var e=GlobalConfig.ExpFubenBaseConfig.freeCount;return(GlobalConfig.ExpFubenBaseConfig.vipCount[t]||0)+e},e.prototype.getSdNum=function(t){return GlobalConfig.ExpFubenBaseConfig.buyCount+GlobalConfig.ExpFubenBaseConfig.vipBuyCount[t]},e.prototype.onInitIndex=function(t){var e=UserFb.ins().fbExp,i=UserFb.ins().getExpFbId(),s=GlobalConfig.MonthCardConfig.expFubenPrecent/100,n=Recharge.ins().getIsForeve()?1+s:1,o=Math.floor(GlobalConfig.ExpFubenConfig[i].exp*n);if(0==t)if(this.lbTime.text="今日可挑战次数："+(this.getChangeNum()-e.useTime),this.lbExp.text=""+o,this.getChangeNum()>e.useTime)this.btnChallenge.enabled=!0;else{this.btnChallenge.enabled=!1;for(var a=UserVip.ins().lv+1,r=this.getChangeNum(a);void 0!=r&&r<=e.useTime&&(a+=1,r=this.getChangeNum(a),void 0!=GlobalConfig.ExpFubenBaseConfig.vipCount[a]););r-e.useTime>0&&(this.lbTime.text="VIP"+a+"可挑战次数+"+(r-e.useTime))}else if(2==t){this.barGroup.visible=!1,this.btnSD.visible=!0,this.bar.value=0,this.lbExp.text=""+o;var h=this.getSdNum(UserVip.ins().lv);if(e.sdTime>=(h||0)){for(var a=UserVip.ins().lv+1,r=this.getSdNum(a);void 0!=r&&h>=r;)a+=1,r=this.getSdNum(a);this.lbVip0.visible=!1,r&&r>h?(this.lbVip.textFlow=TextFlowMaker.generateTextFlow1("|C:0xf3311e&T:VIP"+a+"|可额外扫荡"+(r-h)+"次"),this.lbVip.visible=!0,this.btnSD.enabled=!1):void 0==r?(this.lbVip.textFlow=TextFlowMaker.generateTextFlow1("今日扫荡次数已用完"),this.lbVip.visible=!0,this.btnSD.enabled=!1):(this.lbVip.visible=!1,this.btnSD.enabled=!0)}else this.lbVip.visible=!1,this.lbVip0.visible=!0,this.lbVip0.textFlow=TextFlowMaker.generateTextFlow1("今日可扫荡次数"+(h-e.sdTime)+"次"),this.btnSD.enabled=!0}else if(1==t||3==t){for(var l=GlobalConfig.ExpFubenConfig[e.cid||e.sid].exp*n,c=0;3>c;c++){this["lbExp"+c].textFlow=TextFlowMaker.generateTextFlow1("经验："+l*(c+1));var u=0;u=1==t?GlobalConfig.ExpFubenBaseConfig.recPrice[c]:GlobalConfig.ExpFubenBaseConfig.buyPrice[c],this["gold"+c].setPrice(u)}0==Setting.ins().getValue(ClientSet.expFirst)&&(this.eff||(this.eff=new MovieClip,this.eff.scaleX=.75,this.eff.scaleY=.75,this.eff.touchEnabled=!1,this.eff.x=this.btnGet2.x+this.btnGet2.width/2,this.eff.y=this.btnGet2.y+this.btnGet2.height/2,this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.g2.addChild(this.eff))),Actor.level<80?(this.g1.visible=this.g2.visible=!1,this.g0.horizontalCenter=0):(this.g1.visible=this.g2.visible=!0,this.g0.horizontalCenter=-182)}},e.prototype.onTap=function(t){var e=t.target;if(this.checkBtnGet(e));else if(e==this.btnChallenge){if(UserFb.ins().checkInFB())return;UserFb.ins().sendChallengeExpFb()}else e==this.btnSD&&0==this.barGroup.visible&&(this.barGroup.visible=!0,this.btnSD.visible=!1,this.lbVip.visible=!1,this.lbVip0.visible=!1,this.bar.maximum=100,this.bar.value=0,egret.Tween.get(this.bar).to({value:100},1500).call(function(){UserFb.ins().sendSaodang()}))},e.prototype.checkBtnGet=function(t){var e=this,i=UserFb.ins().fbExp,s=0;if(t==this.btnGet0?s=1:t==this.btnGet1?s=2:t==this.btnGet2&&(s=3),s>0){var n=i.cid?0:1,o=GlobalConfig.ExpFubenBaseConfig.recPrice[s-1];if(Actor.yb<o)return void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");if(3!=s&&0==Setting.ins().getValue(ClientSet.expFirst)){if(1==s&&Actor.level<80)this.sendGetAward(n,s,t),DisplayUtils.removeFromParent(this.eff),this.eff=null;else{var a="是否领取"+s+"倍奖励，领取后您的等级将会落后一大截，强烈推荐3倍领取";0!=o&&(a="是否花费<font color='#FFB82A'>"+o+"元宝</font>领取"+s+"倍奖励，领取后您的等级将会落后一大截，强烈推荐3倍领取");var r=WarnWin.show(a,function(){e.sendGetAward(n,s,t),Setting.ins().setValue(ClientSet.expFirst,1),DisplayUtils.removeFromParent(e.eff),e.eff=null},this);r.setBtnLabel("领取")}return}0==o?this.sendGetAward(n,s,t):this.sendGetAward(n,s,t)}return s>0},e.prototype.sendGetAward=function(t,e,i){var s=UserFb.ins().fbExp,n=GlobalConfig.ExpFubenConfig[s.cid||s.sid];if(n){var o=n.exp,a=this.getFlyTime(o*e),r=Math.floor(a/15);TimerManager.ins().doTimer(15,r,function(){UserFb.ins().postExpFly(i.parent.localToGlobal(i.x+i.width/2,i.y+i.height/2)),e>1&&UserFb.ins().postExpFly(i.parent.localToGlobal(i.x+i.width/2,i.y+i.height/2)),e>2&&UserFb.ins().postExpFly(i.parent.localToGlobal(i.x+i.width/2,i.y+i.height/2))},this),egret.Tween.get(i).wait(1100).call(function(){UserFb.ins().sendGetAwardMul(t,e)})}},e.prototype.getFlyTime=function(t){for(var e=0,i=Actor.level,s=Actor.exp,n=GlobalConfig.ExpConfig[i].exp;t>0&&t>n-s;)e+=1,i+=1,t-=n-s,n=GlobalConfig.ExpConfig[i].exp,s=0;return 0==e?400:400*(e+1)-200},e}(BaseView);__reflect(FbExpPanel.prototype,"FbExpPanel");var FbWin=function(t){function e(){var e=t.call(this)||this;return e.fbDataList=[],e.lastSelectIndex=-1,e.skinName="DailyFbSkin",e.isTopLevel=!0,e.fbList.itemRenderer=FbItem,e.fbDataList=UserFb.ins().fbDataList.slice(),e.fbList.dataProvider=new eui.ArrayCollection(e.fbDataList),e}return __extends(e,t),e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=void 0==t[0]?0:t[0];switch(s){case 4:return GuardWeaponModel.ins().isOpen();case 2:var n=GlobalConfig.FbChallengeConfig[1];if(Actor.level<n.levelLimit)return UserTips.ins().showTips(n.levelLimit+"级可挑战"),!1;break;case 1:if(Actor.level<GlobalConfig.ExpFubenBaseConfig.openLv)return UserTips.ins().showTips(GlobalConfig.ExpFubenBaseConfig.openLv+"级开启"),!1;break;case 0:if(Actor.level<10)return UserTips.ins().showTips("10级开启"),!1}return e.isClose||ViewManager.ins().close(LiLianWin),e.isClose=!1,!0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.fbList,this.onTap),this.addTouchEvent(this.help,this.onTap),this.observe(UserFb.ins().postFbInfoInit,this.updateFbList),this.observe(UserFb.ins().postUpDataInfo,this.updateFbList),this.observe(FbRedPoint.ins().postTabs,this.updateRedPoint),this.observe(UserFb.ins().postUpDataInfo,this.updateRedPoint),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen),this.updateFbList();var i=void 0==t[0]?0:t[0];this.viewStack.selectedIndex=i,this.tab.selectedIndex=i,this.setOpenIndex(i),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.redPoint0.visible=FbRedPoint.ins().getRedPoint(0),this.redPoint1.visible=FbRedPoint.ins().getRedPoint(1),this.redPoint2.visible=FbRedPoint.ins().getRedPoint(2),this.redPoint3.visible=FbRedPoint.ins().getRedPoint(3),this.redPoint4.visible=FbRedPoint.ins().getRedPoint(4)},e.prototype.updateFbList=function(){this.fbList.dataProvider.replaceAll(this.fbDataList)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.help:ViewManager.ins().open(ZsBossRuleSpeak,28);break;case this.closeBtn:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button){var e=t.target.parent.data,i=GlobalConfig.DailyFubenConfig[e];if("add"==t.target.name)this.Sweep(e);else if("double"==t.target.name)this.DoubleSweep(e);else{var s=UserFb.ins().getFbDataById(e);if(s.getCount()<=0)UserTips.ins().showTips("|C:0xf3311e&T:剩余挑战次数不足|");else if(i.levelLimit>Actor.level)UserTips.ins().showTips("|C:0xf3311e&T:转生或等级不足|");else{var n=UserFb.ins().fbModel[e].isPass;if(Recharge.ins().franchise&&n)UserFb.ins().sendChallenge(e);else{if(UserFb.ins().checkInFB())return;UserFb.ins().sendChallenge(i.id),UserZs.ins().lv>=i.sweepLevel&&s.isPass||ViewManager.ins().closeTopLevel()}}}ViewManager.ins().close(LimitTaskView)}}},e.prototype.Sweep=function(t){var e=GlobalConfig.DailyFubenConfig[t],i=GlobalConfig.MonthCardConfig.sweepPrecent/100,s=Recharge.ins().monthDay>0?1-i:1,n=e.buyPrice[UserFb.ins().getFbDataById(t).vipBuyCount]*s;if(!(Actor.yb>=n))return void UserTips.ins().showTips("元宝不足");DieGuide.ins().setClick(t);var o=this.fbDataList.lastIndexOf(t);this.fbList.getChildAt(o).starSaoDang(0)},e.prototype.DoubleSweep=function(t){var e=GlobalConfig.DailyFubenConfig[t],i=GlobalConfig.MonthCardConfig.sweepPrecent/100,s=Recharge.ins().monthDay>0?1-i:1,n=e.buyDoublePrice[UserFb.ins().getFbDataById(t).vipBuyCount]*s;if(!(Actor.yb>=n))return void UserTips.ins().showTips("元宝不足");DieGuide.ins().setClick(t);var o=this.fbDataList.lastIndexOf(t);this.fbList.getChildAt(o).starSaoDang(1)},e.prototype.setOpenIndex=function(t){if(!this.checkIndexOpen(t))return this.setOpenIndex(this.lastSelectIndex),void(this.tab.selectedIndex=this.lastSelectIndex);if(this.lastSelectIndex>-1)switch(this.lastSelectIndex){case 1:this.fbExpPanel.close();break;case 2:}switch(this.lastSelectIndex=t,this.help.visible=!1,t){case 4:this.guardWeaponPanel.open(),this.help.visible=!0;break;case 3:this.playWayPanel.open();break;case 2:this.fbChallengePanel.open();break;case 1:this.fbExpPanel.open();break;case 0:this.updateFbList()}},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.checkIsOpen=function(t){var e=t.target;return this.checkIndexOpen(e.selectedIndex)?(ViewManager.ins().close(LiLianWin),void ViewManager.ins().close(LimitTaskView)):void t.preventDefault()},e.prototype.checkIndexOpen=function(t){if(2==t){var e=GlobalConfig.FbChallengeConfig[1];if(Actor.level<e.levelLimit)return UserTips.ins().showTips(e.levelLimit+"级可挑战"),!1}else if(1==t){if(Actor.level<GlobalConfig.ExpFubenBaseConfig.openLv)return UserTips.ins().showTips(GlobalConfig.ExpFubenBaseConfig.openLv+"级开启"),!1}else if(4==t&&!GuardWeaponModel.ins().isOpen())return UserTips.ins().showTips(GuardWeaponModel.ins().getDesc()),!1;return!0},e}(BaseEuiView);__reflect(FbWin.prototype,"FbWin"),ViewManager.ins().reg(FbWin,LayerManager.UI_Main);var GuanQiaTipsWin=function(t){function e(){var e=t.call(this)||this;return e.chapter=0,e.skinName="CheckItemTipsSkin",e.item0=new ItemBase,e.item0.x=64,e.item0.y=46,e.item0.scaleX=e.item0.scaleY=.8,e.reward.addChild(e.item0),e.item0.isShowName(!1),e.addTouchEvent(e.rewardBtn,e.onTap),e.observe(UserFb.ins().postZhangJieAwardChange,e.reflashChapter),e.observe(UserFb.ins().postGuanqiaWroldReward,e.reflashChapter),e.rightIcon.visible=!1,e.chargeEff1=new MovieClip,e.chargeEff1.x=100,e.chargeEff1.y=127,e.chargeEff1.scaleX=.5,e.chargeEff1.scaleY=.5,e.addChild(e.chargeEff1),e}return __extends(e,t),e.prototype.reflashChapter=function(){this.update(this.chapter)},e.prototype.updateDir=function(t){this.leftIcon.visible=t,this.rightIcon.visible=!t},e.prototype.update=function(t){this.chapter=t;var e=GlobalConfig.WorldRewardConfig[t],i=GlobalConfig.WorldRewardConfig[t-1],s=1;i&&(s=i.needLevel+1),this.item0.data=e.rewards[0];var n=0;n=s-UserFb.ins().guanqiaID,UserFb.ins().guanqiaID<=e.needLevel?(n>0?this.rew.text="距离"+e.name+"还差"+n+"关":this.rew.text="距离领取奖励还差"+(e.needLevel-UserFb.ins().guanqiaID+1)+"关",this.rew.visible=!0,this.rewardBtn.visible=!1,this.chargeEff1.visible=!1,this.chargeEff1.stop()):(this.rewardBtn.visible=!0,UserFb.ins().isGetReceiveBox(t)?(this.rew.text="",this.rewardBtn.enabled=!1,this.chargeEff1.visible=!1,this.chargeEff1.stop(),this.rew.visible=!0,this.rewardBtn.label="已领取",this.rewardBtn.touchEnabled=!1):(this.rewardBtn.enabled=!0,this.rew.visible=!1,this.rewardBtn.label="领取",this.rewardBtn.touchEnabled=!0,this.chargeEff1.visible=!0,this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1)))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.rewardBtn:UserFb.ins().sendGuanqiaWroldReward(this.chapter)}},e}(BaseView);__reflect(GuanQiaTipsWin.prototype,"GuanQiaTipsWin");var GuanQiaWordMapWin=function(t){function e(){var e=t.call(this)||this;return e.rewardItemChapter=-1,e.pass=0,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CheckInfoSkin",this.bg.source="chapterworld_jpg",this.mapGroup=new eui.Group,this.map.addChild(this.mapGroup),this.mapItemArr=[],this.bigMapGroup=new eui.Group,this.map.addChild(this.bigMapGroup),this.bigMapItemArr=[],this.initBigMapItem(),this.changeMap(MapType.chapterMap,-1)},e.prototype.changeMap=function(t,e){if(void 0===e&&(e=-1),this.type!=t){switch(t){case MapType.bigMap:this.map.removeChild(this.mapGroup),this.map.addChild(this.bigMapGroup),this.bg.source="bigworld_jpg",this.backtobig.visible=!1;var i=GlobalConfig.AllWorldConfig[UserFb.ins().groupID],s=i.position.x+80-this.mapScroller.width/2,n=i.position.y+80-this.mapScroller.height/2;s+this.map.width>=960&&(s=960-this.map.width),n+this.map.height>=1010&&(n=1010-this.map.height),this.map.scrollH=s>0?s:0,this.map.scrollV=n>0?n:0,this.rewordBtnGroup.x=490;break;default:this.map.removeChild(this.bigMapGroup),this.map.addChild(this.mapGroup),this.bg.source="chapterworld_jpg",this.backtobig.visible=!0,this.initMapItem(e);var o=0,a=745;if(-1!=this.rewardItemChapter){var r=GlobalConfig.WorldRewardConfig[this.rewardItemChapter].position.y;o=r-450+75}else o=860-a;o+a>860&&(o=860-a),this.map.scrollV=o>0?o:0,this.map.scrollH=0,this.rewordBtnGroup.x=410}this.type=t}},e.prototype.initBigMapItem=function(){this.bigMapItemArr=[];var t=GlobalConfig.AllWorldConfig;for(var e in t){var i=new GuanQiaWorldBigMapItem;i.x=t[e].position.x,i.y=t[e].position.y,i.update(t[e].id),this.bigMapGroup.addChild(i),this.bigMapItemArr.push(i)}},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.getRewordBtn,this.onTap),this.addTouchEvent(this.backtobig,this.onClick),this.observe(UserFb.ins().postGuanqiaWroldReward,this.upDateItemGroup),this.upDateItemGroup()},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];for(t.prototype.close.call(this,e);0!=this.bigMapItemArr.length;){var s=this.bigMapItemArr.pop();s.close()}this.clearMapItem()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.backtobig:this.changeMap(MapType.bigMap)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.getRewordBtn:UserBag.ins().getSurplusCount()>=4?UserFb.ins().sendGetAward():UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|")}},e.prototype.clearMapItem=function(){for(;0!=this.mapItemArr.length;){var t=this.mapItemArr.pop();this.mapGroup.removeChild(t),t.close()}this.rewardItemChapter=-1},e.prototype.initMapItem=function(t){void 0===t&&(t=-1),this.clearMapItem();var e=-1;if(-1==t){var i=GlobalConfig.WorldRewardConfig;for(var s in i)if(UserFb.ins().guanqiaID>i[s].needLevel&&!UserFb.ins().isGetReceiveBox(i[s].id)){t=i[s].groupId,e=i[s].id;break}-1==t&&(t=UserFb.ins().groupID)}var n=GlobalConfig.AllWorldConfig[t].mapGroup;this.WorldMapItem=[];for(var o=0;o<n.length;o++)this.WorldMapItem.push(GlobalConfig.WorldRewardConfig[n[o]]);for(var s in this.WorldMapItem){var a=new GuanQiaWorldMapItem;a.x=this.WorldMapItem[s].position.x,a.y=this.WorldMapItem[s].position.y,a.chapter=this.WorldMapItem[s].id,this.mapGroup.addChild(a),this.mapItemArr.push(a),-1!=a.rewardChapter&&(this.rewardItemChapter=a.rewardChapter)}},e.prototype.upDateItemGroup=function(){this.pass=UserFb.ins().getWorldGuanQiaBox();var t=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward],e=(UserFb.ins().guanqiaID,GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward-1]),i=e?t.needLevel-e.needLevel:t.needLevel,s=UserFb.ins().guanqiaID-(e?e.needLevel:0)-1,n=s>=i;this.rewordBtnGroup.visible=n,this.getRewordBtn.enabled=n,this.goldTxt2.text=UserFb.ins().goldEff+"/小时",this.expTxt2.text=UserFb.ins().expEff+"/小时",this.goldTxt0.text="",this.expTxt0.text=""},e}(BaseEuiView);__reflect(GuanQiaWordMapWin.prototype,"GuanQiaWordMapWin"),ViewManager.ins().reg(GuanQiaWordMapWin,LayerManager.UI_Main);var GuanQiaWorldBigMapItem=function(t){function e(){var e=t.call(this)||this;e.chapterBig=0,e.skinName="CheckBigItemSkin",e.observe(UserFb.ins().postZhangJieAwardChange,e.reflashChapter),e.observe(UserFb.ins().postGuanqiaWroldReward,e.reflashChapter),e.addTouchEvent(e,e.onClick);var i=SubRoles.ins().getSubRoleByIndex(0);return e.rolelocation.source="head_"+i.job+i.sex,e}return __extends(e,t),e.prototype.onClick=function(t){var e=ViewManager.ins().getView(GuanQiaWordMapWin);e.changeMap(MapType.chapterMap,this.chapterBig)},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onClick),egret.Tween.removeTweens(this.roleHeadGroup)},e.prototype.reflashChapter=function(){this.update(this.chapterBig)},e.prototype.update=function(t){this.chapterBig=t;var e,i,s=1,n=GlobalConfig.AllWorldConfig[t],o=GlobalConfig.AllWorldConfig[t-1],a=n.mapGroup.length,r=GlobalConfig.WorldRewardConfig[n.mapGroup[a-1]];e=r.needLevel,o&&(a=o.mapGroup.length,i=GlobalConfig.WorldRewardConfig[o.mapGroup[a-1]],s=i.needLevel+1),this.nameTxt.text=n?n.id+"."+n.name:"",this.chapterCount.text=s+"-"+e+"关";var h=this.roleHeadGroup.y,l=h-10;egret.Tween.removeTweens(this.roleHeadGroup),UserFb.ins().groupID==n.id?(this.roleHeadGroup.visible=!0,egret.Tween.get(this.roleHeadGroup,{loop:!0}).to({y:l},1e3).to({y:h},1e3)):this.roleHeadGroup.visible=!1;var c=!1;if(UserFb.ins().guanqiaID<s)c=!1;else for(var u=0;u<n.mapGroup.length;u++)if(i=GlobalConfig.WorldRewardConfig[n.mapGroup[u]],UserFb.ins().guanqiaID>i.needLevel&&!UserFb.ins().isGetReceiveBox(n.mapGroup[u])){c=!0;break}this.redPointBox.visible=c},e}(BaseView);__reflect(GuanQiaWorldBigMapItem.prototype,"GuanQiaWorldBigMapItem");var GuanQiaWorldMapItem=function(t){function e(){var e=t.call(this)||this;return e.chapter=0,e.rewardChapter=-1,e.skinName="CheckMapItemSkin",e.observe(UserFb.ins().postZhangJieAwardChange,e.reflashChapter),e.observe(UserFb.ins().postGuanqiaWroldReward,e.reflashChapter),e.addTouchEvent(e,e.onClick),e.mc=new MovieClip,e.mc.x=e.mc.y=32,e.mc.scaleX=.45,e.mc.scaleY=1.2,e.rewardGroup.addChild(e.mc),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reflashChapter()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onClick),egret.Tween.removeTweens(this.rewardGroup)},e.prototype.onClick=function(t){var e=GlobalConfig.WorldRewardConfig[this.chapter];UserFb.ins().guanqiaID>e.needLevel?UserFb.ins().sendGuanqiaWroldReward(this.chapter):UserFb.ins().isGetReceiveBox(this.chapter)||UserTips.ins().showTips("还需要"+(e.needLevel-UserFb.ins().guanqiaID+1)+"关可领取")},e.prototype.reflashChapter=function(){this.update(this.chapter)},e.prototype.update=function(t){this.chapter=t,this.rewardChapter=-1;var e=GlobalConfig.WorldRewardConfig[t],i=GlobalConfig.WorldRewardConfig[t-1];this.itemIcon.setData(GlobalConfig.ItemConfig[e.rewards[0].id]);var s=1;i&&(s=i.needLevel+1),this.nameTxt.text=e?e.id+"."+e.name:"",this.chapterCount.text=s+"-"+e.needLevel+"关",UserFb.ins().guanqiaID<=e.needLevel&&UserFb.ins().guanqiaID>=s?this.box.source=e.icon+"c":this.box.source=e.icon;var n=0;n=s-UserFb.ins().guanqiaID,this.passImg.visible=!1;var o=this.rewardGroup.y,a=o-10;egret.Tween.removeTweens(this.rewardGroup),UserFb.ins().guanqiaID>e.needLevel?UserFb.ins().isGetReceiveBox(t)?(this.mc.visible=!1,this.mc.stop(),this.rewardGroup.visible=!1,this.passImg.visible=!0):(this.rewardGroup.visible=!0,this.mc.visible=!0,this.rewardChapter=t,this.mc.playFile(RES_DIR_EFF+"chargeff1",-1),egret.Tween.get(this.rewardGroup,{loop:!0}).to({y:a},1e3).to({y:o},1e3)):(this.rewardGroup.visible=UserFb.ins().guanqiaID<=e.needLevel&&UserFb.ins().guanqiaID>=s,this.mc.visible=!1,this.mc.stop())},e}(BaseView);__reflect(GuanQiaWorldMapItem.prototype,"GuanQiaWorldMapItem");var GuanQiaWorldRewardWin=function(t){function e(){var e=t.call(this)||this;return e.isReceive=!1,e.pass=0,e.rewardCount=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CheckWorldRewardSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.update(e[0])},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.close.call(this,e),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap)},e.prototype.update=function(t){this.isReceive=UserFb.ins().isReceiveBox(t),this.pass=t>0?t:1;var e=GlobalConfig.WorldRewardConfig[this.pass];this.rewardCount=e.rewards.length,this.specialItem0.data=e.rewards[0],this.specialItem1.data=e.rewards[1],this.specialItem2.data=e.rewards[2],this.specialItem3.data=e.rewards[3];var i,s;if(t>1){var n=GlobalConfig.WorldRewardConfig[this.pass-1];i=this.getLevelStr(n.needLevel,e.needLevel),s=n.needLevel+1+"-"+e.needLevel}else i=this.getLevelStr(e.needLevel-1,e.needLevel),s=""+e.needLevel;this.requireLabel.text="通关第"+s+"章（"+i+"关）的奖励",this.isReceive?this.closeBtn0.label="领取":this.closeBtn0.label="确定"},e.prototype.getLevelStr=function(t,e){return 10*t+1+"-"+10*e},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.closeBtn0:this.isReceive?this.sendReceiveReward():UserTips.ins().showTips("|C:0xf3311e&T:通关地图才能领取奖励|"),ViewManager.ins().close(this)}},e.prototype.sendReceiveReward=function(){UserBag.ins().getSurplusCount()>=this.rewardCount?UserFb.ins().sendGuanqiaWroldReward(this.pass):UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|")},e}(BaseEuiView);__reflect(GuanQiaWorldRewardWin.prototype,"GuanQiaWorldRewardWin"),ViewManager.ins().reg(GuanQiaWorldRewardWin,LayerManager.UI_Popup);var PlayWayPanel=function(t){function e(){var e=t.call(this)||this;return e.name="玩法",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var e=1;4>=e;e++){var i=this["info"+e].text;TextFlowMaker.generateTextFlow1("|U:&T:"+i)}var s=this.time1.text;if(GameServer.serverOpenDay){var n=s.split("每天");this.time1.textFlow=TextFlowMaker.generateTextFlow1("每天"+n[1])}else;this.time4.text=GlobalConfig.PassionPointConfig.openTips;for(var e=1;4>=e;e++)this["info"+e].textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this["info"+e].text)},e.prototype.open=function(){this.addTouchEvent(this,this.onTap),this.observe(Millionaire.ins().postMillionaireInfo,this.callbackMillionaireInfo),this.observe(Millionaire.ins().postTurnDice,this.callbackRedPoint),this.observe(Millionaire.ins().postRoundReward,this.callbackRedPoint),this.observe(Millionaire.ins().postMillionaireUpdate,this.callbackRedPoint),this.observe(BattleCC.ins().postOpenInfo,this.updateBattleRed),this.observe(Actor.ins().postLevelChange,this.updateBattleRed),this.observe(Actor.ins().postLevelChange,this.updatePaoDianRed),this.observe(PaoDianCC.ins().postOpenInfo,this.updatePaoDianRed),this.redPoint2.visible=Millionaire.ins().getRedPoint(),this.updateBattleRed(),this.updatePaoDianRed()},e.prototype.updateBattleRed=function(){this.redPoint3.visible=BattleCC.ins().checkRedPoint()},e.prototype.updatePaoDianRed=function(){this.redPoint0.visible=PaoDianCC.ins().checkRedPoint()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.btn1:if(!UserBoss.ins().newWorldBossData.isOpen)return void UserTips.ins().showTips("世界BOSS未开启");if(UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime){var e=new Date(UserBoss.ins().newWorldBossData.startTime),i=e.getHours()+"点"+(e.getMinutes()?e.getMinutes()+"分":"");return void UserTips.ins().showTips("每天"+i+"开启，请按时参加")}if(!UserBoss.ins().checkNewWorldBossOpen())return void UserTips.ins().showTips(GlobalConfig.NewWorldBossBaseConfig.openLv+"级才可以参加");UserBoss.ins().sendIntoNewBoss();break;case this.btn2:Millionaire.ins().sendMillionaireInfo();break;case this.btn3:if(Actor.level<=GlobalConfig.CampBattleConfig.openLevel)return void UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openLevel+"级可参与血战比奇城");if(!BattleCC.ins().isOpen)return void UserTips.ins().showTips(GlobalConfig.CampBattleConfig.openTips);CityCC.ins().enterCD<1?CityCC.ins().isCity?(GameMap.myMoveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE,BattleCC.ins().findComplete),GameMap.moveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE)):(BattleCC.ins().gotoNpc=!0,CityCC.ins().sendEnter()):UserTips.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城");break;case this.btn4:if(!PaoDianCC.ins().isOpen)return void UserTips.ins().showTips(GlobalConfig.PassionPointConfig.openTips);var s=GlobalConfig.PassionPointConfig.openLv;if(Actor.level+1e3*UserZs.ins().lv<s)return void UserTips.ins().showTips((1e3>s?s+"级":s%1e3==0?s/1e3+"转":s/1e3+"转"+s%1e3+"级")+"可参与激情泡点");CityCC.ins().enterCD<1?CityCC.ins().isCity?(GameMap.myMoveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE,PaoDianCC.ins().findComplete),GameMap.moveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE)):(PaoDianCC.ins().gotoNpc=!0,CityCC.ins().sendEnter()):UserTips.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城");break;case this.info1:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[18].text);break;case this.info2:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[19].text);break;case this.info3:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[17].text);break;case this.info4:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[20].text)}},e.prototype.callbackMillionaireInfo=function(){var t=ViewManager.ins().getView(MillionaireWin);t||ViewManager.ins().open(MillionaireWin),this.redPoint2.visible=Millionaire.ins().getRedPoint()},e.prototype.callbackRedPoint=function(){this.redPoint2.visible=Millionaire.ins().getRedPoint()},e}(BaseView);__reflect(PlayWayPanel.prototype,"PlayWayPanel");var BabelLotteryItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.rewardState=function(t){t?this.currentState="yilingqu":this.currentState="weilingqu"},e}(BaseComponent);__reflect(BabelLotteryItem.prototype,"BabelLotteryItem");var SkyItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.skinName="chuangtianguanItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t&&(this.passAllTip0.text=t.layer+"层",this.currentState=t.id==SkyLevelModel.ins().cruLevel?"down":"up")},e}(eui.ItemRenderer);__reflect(SkyItemRenderer.prototype,"SkyItemRenderer");var WaveDropData=function(){function t(){this.drops=[]}return t.prototype.parser=function(t){for(var e=1,i=0;e>i;i++)this.drops[i]=this.drops[i]||new RewardData,this.drops[i].parser(t);this.drops.length=e},t}();__reflect(WaveDropData.prototype,"WaveDropData");var HunShouFBWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Hungu.ins().postHunShouFBInfo,this.update),this.observe(Hungu.ins().postSweepHunShouFB,this.updateTimes),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){this.updateTimes();var t=Hungu.ins().hunShouFBPassID?Hungu.ins().hunShouFBPassID+1:1;this._isMax=!1,t>Object.keys(GlobalConfig.FsFbConfig).length&&(this._isMax=!0,t--);var e=GlobalConfig.FsFbConfig[t];this._zsLvEough=UserZs.ins().lv>=e.zsLevelLimit,this.zsLimit.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this._zsLvEough?3532331:16711680)+"&T:挑战要求：人物"+e.zsLevelLimit+"转|"),this._collect||(this._collect=new ArrayCollection,this.itemList.dataProvider=this._collect),this._collect.source=e.award,this.btnSweep.visible=GlobalConfig.HunGuConf.sweepLayer<=Hungu.ins().hunShouFBPassID,this.sweepInfoText.visible=this.sweepInfo.visible=this.btnSweep.visible,this.btnChallenge.visible=!this._isMax,this.btnChallenge.horizontalCenter=this.btnSweep.visible?109:0,this.max.visible=this._isMax,this.zsLimit.visible=!this._isMax,this.sweepInfo.visible&&(this.sweepInfo.text=Hungu.ins().hunShouFBPassID+""),this.bossName.source=e.pic,this._bossMc||(this._bossMc=ObjectPool.pop("MovieClip"),this.Boss.addChild(this._bossMc)),this._bossMc.playFile(RES_DIR_MONSTER+("monster"+GlobalConfig.MonstersConfig[e.monster].avatar+"_3s"),-1)},e.prototype.updateTimes=function(){this.lbTime.textFlow=TextFlowMaker.generateTextFlow("|c:"+(Hungu.ins().hunShouFBTimes?3532331:16711680)+"&T:"+Hungu.ins().hunShouFBTimes+"|")},e.prototype.onTouch=function(t){switch(t.target){case this.btnSweep:case this.btnChallenge:if(!Hungu.ins().hunShouFBTimes)return void UserTips.ins().showTips("剩余次数不足");t.target==this.btnSweep?Hungu.ins().sweepHunShouFB():this._zsLvEough?this._isMax?UserTips.ins().showTips("当前已通关"):(Hungu.ins().enterHunShouFB(),ViewManager.ins().close(LadderWin)):UserTips.ins().showTips("转生等级不足")}},e}(BaseEuiView);__reflect(HunShouFBWin.prototype,"HunShouFBWin");var HunShouSweepWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunshouSweepSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._id=t[0],this._rewards=t[1],this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){this.reward.dataProvider=new ArrayCollection(this._rewards),this.times.textFlow=TextFlowMaker.generateTextFlow("|c:"+(Hungu.ins().hunShouFBTimes?3532331:16711680)+"&T:"+Hungu.ins().hunShouFBTimes+"|"),this.fbName.text=GlobalConfig.FsFbConfig[this._id].fbName},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.nextBtn:if(!Hungu.ins().hunShouFBTimes)return void UserTips.ins().showTips("剩余次数不足");Hungu.ins().sweepHunShouFB()}},e}(BaseEuiView);__reflect(HunShouSweepWin.prototype,"HunShouSweepWin"),ViewManager.ins().reg(HunShouSweepWin,LayerManager.UI_Popup);var AssistantHeadItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="assistantHeadSkin",e
}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.Name.text=this.data.vo.roleName,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.vo.sex],this.imgHead.source="head_"+this.data.vo.job+this.data.vo.sex,this.charm.text="魅力值 +"+GlobalConfig.TeamFuBenConfig[this.data.id].chiv},e}(BaseItemRender);__reflect(AssistantHeadItemRender.prototype,"AssistantHeadItemRender");var ChallengerHeadItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="challengerHeadSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.Name.text=this.data.roleName,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex],this.imgHead.source="head_"+this.data.job+this.data.sex},e}(BaseItemRender);__reflect(ChallengerHeadItemRender.prototype,"ChallengerHeadItemRender");var FriendItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="friendItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelName.text=this.data.name,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex],this.imgHead.source="head_"+this.data.job+this.data.sex,this.labelGuild.text=this.data.guildName?this.data.guildName:"",this.labelLv.text=(this.data.zs?this.data.zs+"级":"")+this.data.lv+"级"},e}(BaseItemRender);__reflect(FriendItemRender.prototype,"FriendItemRender");var TeamFbGuideItemrender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.monHeadImg.source=t.monHead,this.nameTxt.text=t.monName,this.dangerLvTxt.textFlow=TextFlowMaker.generateTextFlow(t.dangerLv),this.guideTxt.textFlow=TextFlowMaker.generateTextFlow(t.guideText)},e}(BaseItemRender);__reflect(TeamFbGuideItemrender.prototype,"TeamFbGuideItemrender");var TeamFbItemRender=function(t){function e(){var e=t.call(this)||this;return e._isShow=!1,e.skinName="teamFbItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Rewardlist.itemRenderer=ItemBase,this.gonglveTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.gonglveTxt.text)},e.prototype.dataChanged=function(){this.nameImg.source=this.data.config.nameImg,this.fbDesc.textFlow=TextFlowMaker.generateTextFlow(this.data.config.infoText),this.head.source=this.data.config.bossImg,this.Rewardlist.dataProvider=new ArrayCollection(this.data.config.rewardShow),this.nameTxt.text=this.data.config.bossName,this.fbImg.source=this.data.config.guanqiaImg,this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.updateStates(),this.data.open&&(this._isShow=!0,this.currentState="zhankai")},e.prototype.updateStates=function(){this.lock.visible=this.data.config.id>this.data.passID+1,this.unlock.visible=!this.lock.visible,this.redPoint.visible=this.data.config.id==this.data.passID+1,this.createRoomBtn.visible=this.data.config.id>this.data.passID,this.done.visible=this.data.config.id<=this.data.passID},e.prototype.onTap=function(t){if(t.target==this.fbImg)this._isShow=!this._isShow,this.currentState=this._isShow?"zhankai":"normal",MessageCenter.ins().dispatch(UserFb.TEAM_FB_WIN_REFLASH_PANEL,this,this._isShow);else if(t.target==this.createRoomBtn){if(0!=GameMap.fbType)return void UserTips.ins().showTips("正在其他副本中，不能挑战");ViewManager.ins().open(TeamFbRoomWin,this.state,this.data.config.id,0)}else t.target==this.gonglveTxt&&ViewManager.ins().open(TeamFbGuideWin,this.data.config.id)},Object.defineProperty(e.prototype,"state",{get:function(){return this.data.passID>=this.data.config.id?2:this.data.config.id==this.data.passID+1?1:0},enumerable:!0,configurable:!0}),e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(TeamFbItemRender.prototype,"TeamFbItemRender");var TeamFbMemberItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbMemberSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.fuhuoImg.visible=!1;for(var e,i=t.length,s=0;i>s;s++)if(t[s].infoModel.getAtt(AttributeType.atHp)>0){e=!0,this.updateRole(t[s]);break}e||(this.updateRole(t[0]),this.fuhuoImg.visible=!0)},e.prototype.updateRole=function(t){var e=t.infoModel;this.roleName.text=e.name,this.roleHead.source="yuanhead"+e.job+e.sex},e}(BaseItemRender);__reflect(TeamFbMemberItemRender.prototype,"TeamFbMemberItemRender");var TeamFbRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.member.visible=!0,this.noteam.visible=!1,this.fubenName.text=GlobalConfig.TeamFuBenConfig[this.data.configID].name;for(var t=void 0,e=void 0,i=this.data.members.length,s=0;3>s;s++)t=this["img"+s],e=this["nameTxt"+s],i>=s+1?(t.source=1==this.data.members[s].position?"tfb_leader":2==this.data.members[0].position?"tfb_assistant":"",e.text=this.data.members[s].roleName):(t.source="",e.text="")}else this.member.visible=!1,this.noteam.visible=!0},e}(BaseItemRender);__reflect(TeamFbRankItemRender.prototype,"TeamFbRankItemRender");var TeamFbRoleItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbRoleItem",e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){switch(t.target){case this.invite:case this.nomember:if(!UserFb.ins().isTFCaptain)return void UserTips.ins().showTips("队长才能邀请玩家");ViewManager.ins().open(TeamFbInviteWin,GlobalConfig.TeamFuBenBaseConfig.inviteText.replace("{0}",GlobalConfig.TeamFuBenConfig[UserFb.ins().tfPassID+1].name),UserFb.ins().tfRoomID,this.data.configID);break;case this.body:this.data.vo.roleID!=Actor.actorID&&ViewManager.ins().open(MemberInfoWin,this.data.vo)}},e.prototype.dataChanged=function(){if(this.data.vo){this.nomember.visible=this.invite.visible=!1,this.body.visible=this.position.visible=this.weapon.visible=!0;var t=this.data.vo;this.roleName.text=t.roleName,3!=t.position?this.position.source=1==t.position?"tfb_leader":"tfb_assistant":this.position.source=null,this.body.source=this.weapon.source=this.wing.source=null;var e=GlobalConfig.EquipConfig[t.cloth];if(e){var i=e.appearance;i&&i.indexOf("[job]")>-1&&(i=i.replace("[job]",t.job+"")),this.body.source=(t.cloth>0?i+"_":"body"+t.job+"00_")+t.sex+"_c_png"}var s=GlobalConfig.EquipConfig[t.weapon];if(s){var i=s.appearance;i&&i.indexOf("[job]")>-1&&(i=i.replace("[job]",t.job+"")),this.weapon.source=t.weapon>0?i+"_"+t.sex+"_c_png":""}var n=GlobalConfig.WingLevelConfig[t.wingLv];n&&(this.wing.source=t.wingLv>=0?n.appearance+"_png":""),t.pos1>0&&(this.body.source=this.getZhuangbanById(t.pos1).res+"_"+t.sex+"_c_png"),t.pos2>0&&(this.weapon.source=this.getZhuangbanById(t.pos2).res+"_"+t.sex+"_c_png"),t.pos3>0&&(this.wing.source=this.getZhuangbanById(t.pos3).res+"_png"),this.body.source||(this.body.source="body000_"+t.sex+"_c_png")}else this.nomember.visible=this.invite.visible=!0,this.body.visible=this.position.visible=this.weapon.visible=this.wing.visible=!1,this.roleName.text="虚位以待"},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(TeamFbRoleItemRender.prototype,"TeamFbRoleItemRender");var TeamFbTargetItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbTargetSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.MonstersConfig[t.infoModel.configID];this.roleName.text=e.name,this.checkMonHead(e)&&(this.roleHead.source="monhead"+e.head+"_png"),GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==t.infoModel.handle?(this.addAttEffect(),this.targetName.visible=!0,this.targetSelect.visible=!0):(this.removeAttEffect(),this.targetName.visible=!1,this.targetSelect.visible=!1)},e.prototype.checkMonHead=function(t){return Assert(t.head,"怪物头像不存在2，id:"+t.id+",name:"+t.name)?!1:!0},e.prototype.addAttEffect=function(){this.attEffect||(this.attEffect=new MovieClip,this.attEffect.x=49,this.attEffect.y=28,this.attEffect.playFile(RES_DIR_EFF+"FightingEff",-1),this.addChild(this.attEffect))},e.prototype.removeAttEffect=function(){this.attEffect&&(this.attEffect.destroy(),this.attEffect=null)},e}(BaseItemRender);__reflect(TeamFbTargetItemRender.prototype,"TeamFbTargetItemRender");var FriendListWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="friendListSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=FriendItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._des=t[0],this.addTouchEvent(this,this.onTouch),this.addTouchEvent(this.list,this.onListTap),this.observe(Friends.ins().postFriendChange,this.update,this),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeTouchEvent(this.list,this.onListTap),this.removeObserve()},e.prototype.update=function(){this._collect||(this._collect=new ArrayCollection,this.list.dataProvider=this._collect),this._collect.source=Friends.ins().friendsList.source},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.onListTap=function(t){var e=this.list.selectedItem;e&&Friends.ins().sendChat(e.id,this._des)},e}(BaseEuiView);__reflect(FriendListWin.prototype,"FriendListWin"),ViewManager.ins().reg(FriendListWin,LayerManager.UI_Popup);var MemberInfoWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="memberInfoSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0],this.addTouchEvent(this,this.onTouch),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve()},e.prototype.update=function(){this.imgBg.source=ChatListItemRenderer.HEAD_BG[this._data.sex],this.imgHead.source="head_"+this._data.job+this._data.sex,this.labelName.text=this._data.roleName,this.labelLv.text=(this._data.zs?this._data.zs+"级":"")+this._data.lv+"级",this.btnRemove.visible=UserFb.ins().isTFCaptain},e.prototype.onTouch=function(t){switch(t.target){case this.btnInfo:UserReadPlayer.ins().sendFindPlayer(this._data.roleID);break;case this.btnRemove:UserFb.ins().sendOutTFRoom(this._data.roleID),ViewManager.ins().close(this);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.openOtherPlayerView=function(t){ViewManager.ins().open(TeamFBCheckRoleWin,t)},e}(BaseEuiView);__reflect(MemberInfoWin.prototype,"MemberInfoWin"),ViewManager.ins().reg(MemberInfoWin,LayerManager.UI_Popup);var TeamFBCheckRoleWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbCheckSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.viewStack.selectedIndex=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.otherPlayerData=t[0],this.roleSelect.otherPlayerData=this.otherPlayerData,this.nameTxt.text=this.otherPlayerData.name,this.roleSelect.open(),this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange),this.roleSelect.setCurRole(0),this.setRoleInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onClick),this.roleInfoPanel.clear()},e.prototype.destoryView=function(){t.prototype.destoryView.call(this),this.roleSelect.close(),this.roleInfoPanel.close()},e.prototype.setRoleInfo=function(){var t=this.otherPlayerData.roleData[0],e="[S"+this.otherPlayerData.serverId+"]";this.otherPlayerData.serverId&&this.otherPlayerData.serverId!=LocationProperty.srvid||(e=""),this.nameTxt.text=this.otherPlayerData.name+e,this.guildNameText.x=this.nameTxt.x+this.nameTxt.textWidth+10,this.guildNameText.text=this.otherPlayerData.guildName?"公会："+this.otherPlayerData.guildName:"";var i=this.otherPlayerData.zhuan?this.otherPlayerData.zhuan+"转":"";this.levelText.text=""+i+this.otherPlayerData.level+"级",this.headIcon.source="head_"+t.job+t.sex;var s=this.otherPlayerData.lilianLv,n=GlobalConfig.TrainLevelConfig[s];this.jueweiIcon.source="juewei_1_"+n.type+"_png"},e.prototype.onChange=function(t){this.setView(this.roleSelect.getCurRole())},e.prototype.setView=function(t){void 0===t&&(t=0),this.roleInfoPanel.curRole=this.roleSelect.getCurRole(),this.roleInfoPanel.open(this.otherPlayerData)},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn1:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(TeamFBCheckRoleWin.prototype,"TeamFBCheckRoleWin"),ViewManager.ins().reg(TeamFBCheckRoleWin,LayerManager.UI_Popup);var TeamFbFightWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbFightSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.teamFbMember.touchEnabled=!1,this.teamFbMember.touchChildren=!1,this.gonglveTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.gonglveTxt.text)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(UserFb.ins().postFbTime,this.setTime),TimerManager.ins().removeAll(this),TimerManager.ins().doTimer(1e3,0,this.update,this),this.setTime([UserFb.ins().curFbID,UserFb.ins().curFbLeftTime]),this.updateFbName(),this.update()},e.prototype.close=function(){},e.prototype.updateFbName=function(){var t;for(var e in GlobalConfig.TeamFuBenConfig)if(t=GlobalConfig.TeamFuBenConfig[e],t.fbid==GameMap.fubenID){this.teamFbName.source=t.nameImg,this._roomID=t.id;break}},e.prototype.setTime=function(t){TimerManager.ins().remove(this.updateLeftTime,this),GameMap.fbType==UserFb.FB_TEAM&&(this._leftTime=t[1],this.updateLeftTime(),TimerManager.ins().doTimer(1e3,0,this.updateLeftTime,this))},e.prototype.updateLeftTime=function(){return this.leftTimeTxt.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4),this._leftTime<=0?void TimerManager.ins().remove(this.updateLeftTime,this):void this._leftTime--},e.prototype.onTouch=function(t){switch(t.target){case this.target1:case this.target2:case this.target3:case this.target4:case this.boss:t.target.data&&t.target.data.infoModel&&(SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameLogic.ins().postChangeAttrPoint(t.target.data.infoModel.handle));break;case this.gonglveTxt:ViewManager.ins().open(TeamFbGuideWin,this._roomID)}},e.prototype.update=function(){var t,e,i,s,n=EntityManager.ins().getAllEntity(),o=[],a=[],r=[];for(var h in n)if(t=n[h],i=t.infoModel)if(i.type==EntityType.Role){if(e=i,e.masterHandle!=Actor.handle){var l=o.indexOf(e.masterHandle);-1==l?(o.push(e.masterHandle),a[a.length]=[t]):a[l].push(t)}}else if(i.type==EntityType.Monster&&i.getAtt(AttributeType.atHp)>0){var c=GlobalConfig.MonstersConfig[i.configID];if(!c)continue;if(4==c.type||3==c.type)continue;var u=1==c.type;!u&&!i.masterHandle&&r.length<4&&r.push(t),u&&(s=t)}this.teamFbMember.visible=a.length>0;for(var p,d=a.length,h=0;2>h;h++)p=this["member"+(h+1)],d>=h+1?(p.visible=!0,p.data=a[h]):p.visible=!1;for(var g,f=r.length,h=1;5>h;h++)g=this["target"+h],f>=h?(this.teamFbTarget.addChild(g),g.data=r[h-1]):DisplayUtils.removeFromParent(g);s?(this.boss.data=s,this.teamFbTarget.addChildAt(this.boss,Math.ceil(this.teamFbTarget.numChildren/2))):DisplayUtils.removeFromParent(this.boss)},e}(BaseEuiView);__reflect(TeamFbFightWin.prototype,"TeamFbFightWin"),ViewManager.ins().reg(TeamFbFightWin,LayerManager.UI_Main);var TeamFbGuideWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbGuideSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=TeamFbGuideItemrender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._roomId=t[0],this.addTouchEvent(this.bgClose,this.onTouch),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)},e.prototype.update=function(){this.fbName.text=GlobalConfig.TeamFuBenConfig[this._roomId].name,this._collect||(this._collect=new ArrayCollection,this.list.dataProvider=this._collect);for(var t=Object.keys(GlobalConfig.TeamFuBenGuideConfig[this._roomId]).length,e=[],i=1;t>=i;i++)e.push(GlobalConfig.TeamFuBenGuideConfig[this._roomId][i]);this._collect.source=e},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(TeamFbGuideWin.prototype,"TeamFbGuideWin"),ViewManager.ins().reg(TeamFbGuideWin,LayerManager.UI_Main);var TeamFbInviteWin=function(t){function e(){var e=t.call(this)||this;return e._deDes="",e.skinName="teamFbInviteSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._deDes=t[0],this._room=t[1],this._configID=t[2],this.input.text=this._deDes,this.input.maxChars=40,this.addTouchEvent(this,this.onTouch)},e.prototype.close=function(){},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.worldInviteBtn:var e=UserFb.ins().getTfInviteCD();if(e>0)return void UserTips.ins().showTips(e+"秒后才能世界邀请");UserFb.ins().sendTfSysInvite(this.getDes()+("|E:1,"+UserFb.ins().tfRoomID+",&U:&C:65280&T:快速加入")),ViewManager.ins().close(this);break;case this.friendInviteBtn:ViewManager.ins().open(FriendListWin,this.getDes()+("|E:1,"+UserFb.ins().tfRoomID+",&U:&C:65280&T:快速加入")),ViewManager.ins().close(this)}},e.prototype.getDes=function(){var t=this.input.text?this.input.text:this._deDes,e="[|C:1487615&T:"+Actor.myName+"|]";return t=t==this._deDes?t.replace("我",e):e+t},e}(BaseEuiView);__reflect(TeamFbInviteWin.prototype,"TeamFbInviteWin"),ViewManager.ins().reg(TeamFbInviteWin,LayerManager.UI_Popup);var TeamFbNewPanel=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Fblist.itemRenderer=TeamFbItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserFb.ins().postFTRoomPassInfo,this.update),MessageCenter.ins().addListener(UserFb.TEAM_FB_WIN_REFLASH_PANEL,this.listFresh,this),this._firstOpen=!0,this.update(),UserFb.ins().postShowRedChange(!1)},e.prototype.close=function(){MessageCenter.ins().removeListener(UserFb.TEAM_FB_WIN_REFLASH_PANEL,this.listFresh,this),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.listFresh=function(t,e){if(this._collect&&t.itemIndex==this._collect.length-1){var i=UserFb.TF_EXPAND_HEIGHT-UserFb.TF_SIMLPE_HEIGHT;1==e?this.Fblist.scrollV=this.Fblist.contentHeight-this.Fblist.height+i:this.Fblist.scrollV=this.Fblist.contentHeight-this.Fblist.height-i,this.Fblist.validateNow()}},e.prototype.update=function(){this._collect||(this._collect=new ArrayCollection,this.Fblist.dataProvider=this._collect);for(var t,e=Object.keys(GlobalConfig.TeamFuBenConfig).length,i=[],s=0;e>s;s++)t=GlobalConfig.TeamFuBenConfig[s+1].id==UserFb.ins().tfPassID+1,t&&(this._index=s),i.push({config:GlobalConfig.TeamFuBenConfig[s+1],passID:UserFb.ins().tfPassID,open:t});this._collect.source=i,this.Fblist.validateNow(),this._firstOpen&&(this._firstOpen=!1,TimerManager.ins().doTimer(50,1,this.selectCanChallege,this),this.selectCanChallege())},e.prototype.selectCanChallege=function(){var t=(this._index+1)*UserFb.TF_SIMLPE_HEIGHT-this.Fblist.height+UserFb.TF_EXPAND_HEIGHT-UserFb.TF_SIMLPE_HEIGHT;this.Fblist.scrollV=t>0?t:0,this.Fblist.validateNow()},e}(BaseEuiView);__reflect(TeamFbNewPanel.prototype,"TeamFbNewPanel");var TeamFbResultWin=function(t){function e(){var e=t.call(this)||this;return e._result=0,e.skinName="teamFbResultSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listItem.itemRenderer=ItemBase,this.listChallenger.itemRenderer=ChallengerHeadItemRender,this.listAssistant.itemRenderer=AssistantHeadItemRender,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._configID=t[0],this._result=t[1],this._list=t[2],this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){},e.prototype.update=function(){this.listItem.dataProvider=new ArrayCollection(GlobalConfig.TeamFuBenConfig[this._configID].rewardShow),this.title.source=this._result?"result_json.win_02":"result_json.lost_02",this.bg.source=this._result?"win_png":"lost_png",this.win.visible=this._result>0,this.defeat.visible=0==this._result,this._hasCaptain=!1;for(var t,e,i,s=[],n=0;n<this._list.length;n++)2==this._list[n].position?(t=this._list.splice(n,1)[0],s.push(t),t.roleID==Actor.actorID&&(e=!0),n--):1==this._list[n].position&&(this._list[n].roleID==Actor.actorID&&(i=!0),this._hasCaptain=!0);this.assResultTxt.visible=e,0==this._result&&this.updateDefeatList(),this.listChallenger.dataProvider=new ArrayCollection(this._list);for(var o=s.length,a=[],n=0;o>n;n++)a.push({vo:s[n],id:this._configID});this.listAssistant.dataProvider=new ArrayCollection(a),this.closeBtn.visible=i&&1==this._result,0==this._result||this._configID>=Object.keys(GlobalConfig.TeamFuBenConfig).length?(this.closeBtn.horizontalCenter=0,this.challengeBtn.visible=!1):(this.closeBtn.horizontalCenter=-80,this.challengeBtn.visible=this.closeBtn.visible),this._exitTime=5,TimerManager.ins().doTimer(1e3,0,this.repeate,this),this.repeate()},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(UserZs.ins().lv<=i.zslv||Actor.level<=i.lv){for(var s in i.gainWay)if(16!=i.gainWay[s][0])t.push(i.gainWay[s][0]);else{var n=DieGuide.ins().getOpenRoles();if(n){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[s][0]];o.itemId=n,t.push(i.gainWay[s][0])}}break}}this.list0.dataProvider=new ArrayCollection(t)},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:this.exitFb();break;case this.challengeBtn:this.exitFb(1);break;case this.openRole:case this.openRole1:ViewManager.ins().close(this),ViewManager.ins().open(NewRoleWin)}},e.prototype.repeate=function(){return this.closeBtn.label="退出("+this._exitTime+"s)",this.assResultTxt.text="等待队长操作（"+this._exitTime+"s）",this._exitTime<=0?(TimerManager.ins().removeAll(this),void this.exitFb()):void this._exitTime--},e.prototype.exitFb=function(t){void 0===t&&(t=0),0==this._result||this._configID>=Object.keys(GlobalConfig.TeamFuBenConfig).length?UserFb.ins().sendExitFb():this._hasCaptain?UserFb.ins().sendExitTFFb(t):UserFb.ins().sendExitFb(),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(TeamFbResultWin.prototype,"TeamFbResultWin"),ViewManager.ins().reg(TeamFbResultWin,LayerManager.UI_Popup);var TeamFbRoomWin=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._room=0,e.skinName="teamFbRoomSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._state=t[0],this._config=GlobalConfig.TeamFuBenConfig[t[1]],this._room=t[2],this.observe(UserFb.ins().postFTRoomChange,this.onRoomInfoChange),this.observe(UserFb.ins().postCreateTFRoomSuccess,this.createSuccess),this.addTouchEvent(this,this.onTouch),this.update(),this.onRoomInfoChange(),ViewManager.ins().open(ChatMainUI)},e.prototype.close=function(){ViewManager.ins().close(ChatMainUI)},e.prototype.createSuccess=function(){this._room=UserFb.ins().tfRoomID,this.onRoomInfoChange()},e.prototype.update=function(){if(this._collect||(this._collect=new ArrayCollection,this.itemList.dataProvider=this._collect),this._collect.source=this._config.rewardShow,this.fbName.text=this._config.name,this.passTxt.visible=!1,this.infoText.visible=!1,this.roleGroup.visible=!0,this.challengeBtn.visible=!1,this.leader.visible=this.member1.visible=this.member2.visible=!1,0==this._state)this.roleGroup.visible=!1,this.infoText.visible=!0,this.infoText.textFlow=TextFlowMaker.generateTextFlow("通关"+GlobalConfig.TeamFuBenConfig[this._config.id-1].name+"后可开启挑战");else if(2==this._state){this.passTxt.visible=!0,this.member1.visible=this.member2.visible=!1;var t=new TeamFuBenRoleVo,e=SubRoles.ins().getSubRoleByIndex(0);t.roleID=Actor.actorID,t.position=1,t.roleName=Actor.myName,t.job=e.job,t.sex=e.sex,t.cloth=e.getEquipByIndex(2).item.configID,t.weapon=e.getEquipByIndex(0).item.configID,t.wingLv=e.wingsData.lv,t.wingState=e.wingsData.openStatus,t.pos1=e.zhuangbei[0],t.pos2=e.zhuangbei[1],t.pos3=e.zhuangbei[2],t.zs=UserZs.ins().lv,t.lv=e.lv,this.leader.data={vo:t,configID:this._config.id},this.leader.visible=!0}else this.challengeBtn.visible=!0,this._room<=0&&UserFb.ins().sendCreateTFRoom()},e.prototype.onRoomInfoChange=function(){if(this._room){for(var t,e=UserFb.ins().tfMembers?UserFb.ins().tfMembers.length:0,i=[this.member1,this.member2],s=0;e>s;s++)1==UserFb.ins().tfMembers[s].position?this.leader.data={vo:UserFb.ins().tfMembers[s],configID:this._config.id}:(t=i.shift(),t.data={vo:UserFb.ins().tfMembers[s],configID:this._config.id});e=i.length;for(var s=0;e>s;s++)i[s].data={vo:null,configID:this._config.id};i.length=0,i=null,this.member1.visible=null!=this.member1.data,this.member2.visible=null!=this.member2.data,this.leader.visible=null!=this.leader.data}},e.prototype.onTouch=function(t){switch(t.target){case this.challengeBtn:var i=new Date(GameServer.serverTime);if(i.getDay()==GlobalConfig.TeamFuBenBaseConfig.closeTime[0]&&i.getHours()>=GlobalConfig.TeamFuBenBaseConfig.closeTime[1])return UserTips.ins().showTips("每周"+DateUtils.WEEK_CN[GlobalConfig.TeamFuBenBaseConfig.closeTime[0]]+GlobalConfig.TeamFuBenBaseConfig.closeTime[1]+"点后不能挑战"),void ViewManager.ins().close(this);if(!UserFb.ins().isTFCaptain)return void UserTips.ins().showTips("队长才能开启进入副本");UserFb.ins().sendBeginTF(),ViewManager.ins().close(e);break;case this.closeBtn0:1==this._state?WarnWin.show("是否退出房间",function(){UserFb.ins().sendExitTFRoom(),ViewManager.ins().close(e)},this):ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(TeamFbRoomWin.prototype,"TeamFbRoomWin"),ViewManager.ins().reg(TeamFbRoomWin,LayerManager.UI_Popup);var TeamFuBenRoleVo=function(){function t(){}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.position=t.readByte(),this.roleName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.cloth=t.readInt(),this.weapon=t.readInt(),this.wingLv=t.readInt(),this.wingState=t.readByte(),this.pos1=t.readInt(),this.pos2=t.readInt(),this.pos3=t.readInt(),this.zs=t.readInt(),this.lv=t.readInt()},t}();__reflect(TeamFuBenRoleVo.prototype,"TeamFuBenRoleVo");var BossResultWin=function(t){function e(){var e=t.call(this)||this;return e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BossResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;e[0];this.bg.source="win_png",this.closeBtn.name="领取奖励",this.title.source="win_02";var s=5;(GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS)&&(s=10),this.s=this.repeatTimes=s,this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var n=e[0];if(e[1]){var o=e[1][0];o&&(this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1));var a=e[1][1]||"",r=a.split("\n");a=r[1]?r[1]:r[0],a=StringUtils.replaceStr(a,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(a),this.labelItem.text=o?"我的归属奖：":"我的参与奖：",this.roleIcon.icon=e[1][2],this.roleIcon.jobImg.visible=!1}else this.belongTxt.text="";this.addTouchEvent(this.closeBtn,this.onTap),n?this.setRewardList(n):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);var e=[],i=[],s=[];this.labelItem.visible=!0;for(var n=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemConfig.getType(r))0==t[a].type?t[a].id==MoneyConst.soul?n.push(t[a]):e.push(t[a]):s.push(t[a]);else if(i.length){for(var h=!1,l=0;l<i.length;l++)if(i[l].id==t[a].id){i[l].count+=t[a].count,h=!0;break}h||i.push(t[a])}else i.push(t[a])}s.sort(this.RuleSortByItem),o=n.concat(e,i,s),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&UserFb.ins().isQuite&&this._fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&UserFb.ins().sendExitFb(),this._fbType==UserFb.FB_TYPE_HOMEBOSS&&ViewManager.ins().open(BossWin,5),this.closeFunc&&(this.closeFunc(),this.closeFunc=null)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);__reflect(BossResultWin.prototype,"BossResultWin"),ViewManager.ins().reg(BossResultWin,LayerManager.UI_Popup);var CityResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CityResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(t.prototype.open.call(this,e),this.addTouchEvent(this.closeBtn,this.onTap),this.bg.source="win_png",this.closeBtn.label="领取奖励",this.title.source="win_02",e[1]){var s=e[1][0];s&&(this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1));var n=e[1][1]||"",o=n.split("\n");n=o[1]?o[1]:o[0],n=StringUtils.replaceStr(n,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(n),this.labelItem.text=s?"我的归属奖：":"我的参与奖：",this.roleIcon.icon=e[1][2],this.roleIcon.jobImg.visible=!1}var a=e[0];a&&this.setRewardList(a)},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],s=[],n=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemConfig.getType(r))0==t[a].type?t[a].id==MoneyConst.soul?n.push(t[a]):e.push(t[a]):s.push(t[a]);else if(i.length){for(var h=!1,l=0;l<i.length;l++)if(i[l].id==t[a].id){i[l].count+=t[a].count,h=!0;break}h||i.push(t[a])}else i.push(t[a])}s.sort(this.RuleSortByItem),o=n.concat(e,i,s),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.removeTouchEvent(this.closeBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);__reflect(CityResultWin.prototype,"CityResultWin"),ViewManager.ins().reg(CityResultWin,LayerManager.UI_Popup);var ExpFbResultWin=function(t){function e(){var e=t.call(this)||this;return e.s=11,e.skinName="jyjiangli",e.lbExp=BitmapNumber.ins().createNumPic(0,"r0",5),e.lbExp.y=97,e.lbExp.x=180,e.mainGroup.addChild(e.lbExp),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnGet,this.onTouch),this.observe(UserFb.ins().postFbExpInfo,this.update),this.update(),this.s=9,this.btnGet.name="前往领取",this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this)},e.prototype.onTouch=function(){ViewManager.ins().close(this)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.btnGet.label=this.btnGet.name+"("+this.s+"s)"},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().remove(this.updateCloseBtnLabel,this),ViewManager.ins().open(FbWin,1),UserFb.ins().sendExitFb()},e.prototype.update=function(){var t=UserFb.ins().fbExp,e=GlobalConfig.ExpFubenConfig[t.cid||t.sid];if(e){var i=GlobalConfig.MonthCardConfig.expFubenPrecent/100,s=Recharge.ins().getIsForeve()?1+i:1;this.setExp(Math.ceil(e.exp*s))}},e.prototype.setExp=function(t){BitmapNumber.ins().changeNum(this.lbExp,t,"r0",5),this.lbExp.anchorOffsetX=this.lbExp.width/2},e}(BaseEuiView);__reflect(ExpFbResultWin.prototype,"ExpFbResultWin"),ViewManager.ins().reg(ExpFbResultWin,LayerManager.UI_Popup);var FireResultWin=function(t){function e(){var e=t.call(this)||this;return e.s=11,e.skinName="LYRFbResultSkin",e.lbExp=BitmapNumber.ins().createNumPic(0,"r0",5),e.lbExp.y=103,e.lbExp.x=171,e.mainGroup.addChild(e.lbExp),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnGet,this.onTouch),this.s=9,this.btnGet.name="前往领取",this.updateCloseBtnLabel(),this.setExp(),TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this)},e.prototype.onTouch=function(){ViewManager.ins().close(this)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.btnGet.label=this.btnGet.name+"("+this.s+"s)"},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().remove(this.updateCloseBtnLabel,this),ViewManager.ins().open(FireRingWin,2),UserFb.ins().sendExitFb()},e.prototype.setExp=function(){var t=GlobalConfig.ActorExRingFubenConfig.reward[0].count;BitmapNumber.ins().changeNum(this.lbExp,t,"r0",5)},e}(BaseEuiView);__reflect(FireResultWin.prototype,"FireResultWin"),ViewManager.ins().reg(FireResultWin,LayerManager.UI_Popup);var MaterialResultWin=function(t){function e(){var e=t.call(this)||this;return e.winResult=0,e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DailyFbResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;var s=e[0];this.winResult=s,this.bg.source=s?"win_png":"lost_png",this.closeBtn.name=s?"领取奖励":"退出",this.title.source=s?"win_02":"lost_02",DieGuide.ins().postdieGuide(s);var n=5;this.s=this.repeatTimes=n,this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var o=e[1];e[2]&&(this.txt.text=e[2]),this.txt.visible=0!=s,this.defeat.visible=0==s,this.addTouchEvent(this.closeBtn,this.onTap),0==s&&this.updateDefeatList(),o&&this.setRewardList(o)},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=0;i<t.length;i++){var s=GlobalConfig.ItemConfig[t[i].id];1==ItemConfig.getType(s)&&e.push(t[i])}this.listItem.dataProvider=new eui.ArrayCollection(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),UserFb.ins().sendExitFb(),this._fbType==UserFb.FB_TYPE_MATERIAL&&ViewManager.ins().open(FbWin,0)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(UserZs.ins().lv<=i.zslv||Actor.level<=i.lv){for(var s in i.gainWay)if(16!=i.gainWay[s][0])t.push(i.gainWay[s][0]);else{var n=DieGuide.ins().getOpenRoles();if(n){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[s][0]];o.itemId=n,t.push(i.gainWay[s][0])}}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e}(BaseEuiView);__reflect(MaterialResultWin.prototype,"MaterialResultWin"),ViewManager.ins().reg(MaterialResultWin,LayerManager.UI_Popup);var NewWorldBossResultPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="wpkResultSkin",this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.init()},e.prototype.init=function(){this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1),this.s=20;var t=UserBoss.ins().newWorldBossData;this.myrank.text=t.rank?t.rank+"":"没上榜",this.rankList.itemRenderer=NewWorldBossResultRender,this.rankList.itemRendererSkinName="wpkResultRenderSkin";var e=t.rankList.concat();e.length>3?e.length=3:null;for(var i=0;i<e.length;i++)e[i].rank=i+1;this.rankList.dataProvider=new eui.ArrayCollection(e),this.time.text=DateUtils.getFormatBySecond(t.totalTime,DateUtils.TIME_FORMAT_10),this.weidao.text=t.lastKillRoleName,t.randomRoleName&&t.randomAwards&&t.randomAwards.length?(this.lucky.visible=!0,this.luckyName.text=t.randomRoleName,this.luckyGift.text=GlobalConfig.ItemConfig[t.randomAwards[0].id].name):this.lucky.visible=!1,this.updateBtn(),TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this),UserFb.ins().isQuite=!0},e.prototype.onTap=function(t){ViewManager.ins().close(this),UserFb.ins().sendExitFb()},e.prototype.updateCloseBtnLabel=function(){this.s>0&&this.s--,this.s<=0&&(ViewManager.ins().close(this),UserFb.ins().sendExitFb()),this.updateBtn()},e.prototype.updateBtn=function(){this.closeBtn.label="离开("+this.s+"s)"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),TimerManager.ins().removeAll(this)},e}(BaseEuiView);__reflect(NewWorldBossResultPanel.prototype,"NewWorldBossResultPanel"),ViewManager.ins().reg(NewWorldBossResultPanel,LayerManager.UI_Popup);var NewWorldBossResultRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.nameTxt.text=t.roleName,this.valueTxt.text=Math.floor(t.value)+"",this.paihang.source="paihangs"+t.rank},e}(BaseItemRender);__reflect(NewWorldBossResultRender.prototype,"NewWorldBossResultRender");var PersonalResultWin=function(t){function e(){var e=t.call(this)||this;return e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="PersonalBossResultSkin",this.listCoin.itemRenderer=ResultCoinItem,this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;var s=e[0];this.bg.source=s?"win_png":"lost_png",this.closeBtn.name=s?"领取奖励":"退出",this.title.source=s?"win_02":"lost_02",DieGuide.ins().postdieGuide(s);var n=5;this.s=this.repeatTimes=n,this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var o=e[1];e[2]&&(this.txt.text=e[2]),GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON&&(this.txt.text="本次击杀"+GuardWeaponModel.ins().getKillWave()+"波怪物"),UserFb.ins().isQuite=!0,e[3]instanceof Function&&(this.closeFunc=e[3]),this.txt.visible=0!=s,this.defeat.visible=0==s,this.addTouchEvent(this.closeBtn,this.onTap),0==s&&this.updateDefeatList(),o?this.setRewardList(o):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],s=[],n=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemConfig.getType(r))0==t[a].type?e.push(t[a]):i.push(t[a]);else if(n.length){for(var h=!1,l=0;l<n.length;l++)if(n[l].id==t[a].id){n[l].count+=t[a].count,h=!0;break}h||n.push(t[a])}else n.push(t[a])}this.labelItem.text="获得道具：",this.labelItem.height=i.length>0?20:0,this.labelItem.visible=i.length>0,e.sort(this.RuleSort),i.sort(this.RuleSortByItem),this.listCoin.dataProvider=new eui.ArrayCollection(e),o=s.concat(e,n,i),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&UserFb.ins().isQuite&&UserFb.ins().sendExitFb(),this.closeFunc&&(this.closeFunc(),this.closeFunc=null)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(UserZs.ins().lv<=i.zslv||Actor.level<=i.lv){for(var s in i.gainWay){if(14==i.gainWay[s][0]){var n=Recharge.ins().getRechargeData(0);if(n.num&&2!=n.num&&UserVip.ins().lv>=Object.keys(GlobalConfig.VipConfig).length)continue}else if(16==i.gainWay[s][0]){var o=DieGuide.ins().getOpenRoles();if(o){var a=GlobalConfig.DeathgainWayConfig[i.gainWay[s][0]];a.itemId=o,t.push(i.gainWay[s][0])}continue}t.push(i.gainWay[s][0])}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.RuleSort=function(t,e){return t.id<e.id?-1:1},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);__reflect(PersonalResultWin.prototype,"PersonalResultWin"),ViewManager.ins().reg(PersonalResultWin,LayerManager.UI_Popup);var ResultCoinItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ResultCoinItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.labelInfo.size=20,this.labelInfo.text="获得"+RewardData.getCurrencyName(t.id)+"：",this.imgCoin.source=RewardData.getCurrencyRes(t.id),this.labelCount.text=""+t.count,this.labelInfo.x=0,this.imgCoin.x=this.labelInfo.x+this.labelInfo.textWidth,this.labelCount.x=this.imgCoin.x+this.imgCoin.width},e}(eui.ItemRenderer);__reflect(ResultCoinItem.prototype,"ResultCoinItem");var ResultWin=function(t){function e(){var e=t.call(this)||this;return e.winResult=0,e.repeatTimes=5,e.isBossResult=!1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ResultSkin",this.listCoin.itemRenderer=ResultCoinItem,this.listItem.itemRenderer=ItemBase,this.listEmblem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.sortFunc=function(t,e){if(1==t.type&&1==e.type){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(i);if(n>o)return-1;if(o>n)return 1;if(i.level>s.level)return-1;if(i.level<s.level)return 1}else{if(t.type<e.type)return-1;if(t.type>e.type)return 1}return 0},e.prototype.showRune=function(t){if(GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){if(!t)return void(this.nune.visible=!1);var e=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel-1];if(!e||!e.showIcon)return void(this.nune.visible=!1);var i=GlobalConfig.ItemConfig[e.showIcon],s=ItemConfig.getQuality(i);if(s==FBChallengePanel.RunType)return void(this.nune.visible=!1);this.nune.visible=!0,this.scrollerGroup.y+=3*this.nune.height/2;var n="";e.equipPos?(this.nuneLock.visible=!0,n="开启战纹槽：",this.oldValue.text=(e.equipPos-1).toString(),this.newValue.text=e.equipPos.toString()):(this.nuneLock.visible=!1,n="解锁类型：",this.nuneValue.text=e.describe),this.nameLabel.text=n,this.nuneValue.visible=!this.nuneLock.visible}},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType,this.doublePrice.visible=!1;var s=e[0];this.winResult=s,this.bg.source=s?"win_png":"lost_png",this.closeBtn.name=s?"领取奖励":"退出",this.title.source=s?"win_02":"lost_02",DieGuide.ins().postdieGuide(s),this.showRune(s);var n=GameMap.fbType==UserFb.FB_TYPE_EXP?15:5;GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS?n=10:GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS&&(n=21),this.s=this.repeatTimes=n,this.updateCloseBtnLabel(),CityCC.ins().isCity||TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var o=e[1];if(e[2]&&(this.txt.text=e[2]),UserFb.ins().isQuite=!0,e[3]instanceof Function?this.closeFunc=e[3]:0==e[3]&&(UserFb.ins().isQuite=e[3]),CityCC.ins().isCity&&(UserFb.ins().isQuite=!1),e[4]){var a=e[4][0];a&&(this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1));var r=e[4][1]||"",h=r.split("\n");r=h[1]?h[1]:h[0],r=StringUtils.replaceStr(r,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(r),this.labelItem.text=a?"我的归属奖：":"我的参与奖：",this.isBossResult=!0,this.roleIcon.icon=e[4][2],this.roleIcon.jobImg.visible=!1,this.txt.text=""}else this.belongTxt.text="";if(this.txt.visible=0!=s,this.defeat.visible=0==s,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.rewardBtn,this.onTap),this.addTouchEvent(this.openRole,this.onTap),this.addTouchEvent(this.openRole1,this.onTap),this.openRole.visible=!1,this.defeat.y=210,this.closeBtn.x=90,0==s&&(0!=GameMap.fubenID&&(this.defeat.y=110),this.updateDefeatList()),0!=GameMap.fubenID&&1==s)if(GameMap.fbType==UserFb.FB_TYPE_EXP)this.closeBtn.label="领取奖励";else if(GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){var l=SkyLevelModel.ins(),c=GlobalConfig.FbChallengeConfig[l.cruLevel];c&&UserZs.ins().lv>=c.zsLevelLimit&&Actor.level>=c.levelLimit&&0==SkyLevelModel.ins().lotteryRemainTimes?(this.rewardBtn.visible=!0,this.closeBtn.x=0,1==c.layer?(this.rewardBtn.label="继续挑战",this.rewardBtn.width=130):(this.rewardBtn.label="挑战第"+c.layer+"层",this.rewardBtn.width=140)):(this.rewardBtn.visible=!1,this.closeBtn.x=90)}else if(GameMap.fbType==UserFb.FB_TYPE_NEW_WORLD_BOSS)this.winnerGroup.visible=!1,this.closeBtn.visible=!1,this.rewardBtn.visible=!1,this.txt.visible=!1,this.wpkBoss.visible=!0,this.wpkBoss.open();else if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU){this.closeBtn.name="退出",this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)";var u=Hungu.ins().hunShouFBPassID,p=u>=Object.keys(GlobalConfig.FsFbConfig).length;p?(this.rewardBtn.visible=!1,this.closeBtn.x=90):(this.rewardBtn.visible=!0,this.closeBtn.x=0,this.rewardBtn.label="挑战第"+(u+1)+"层")}else this.rewardBtn.visible=!1;else this.rewardBtn.visible=!1;o?this.setRewardList(o):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);var i=[],s=[],n=[];if(this.isBossResult){this.winnerGroup.visible=!0,this.scrollerGroup.y+=60,this.scrollerGroup.height=336,this.labelEmblem.height=0,this.labelItem.height=20,this.labelEmblem.visible=!1,this.labelItem.visible=!0;for(var o=[],a=[],r=0;r<t.length;r++){var h=GlobalConfig.ItemConfig[t[r].id];if(1!=ItemConfig.getType(h))0==t[r].type?t[r].id==MoneyConst.soul?o.push(t[r]):i.push(t[r]):n.push(t[r]);else if(-1!=e.filterFb.indexOf(GameMap.fbType))s.push(t[r]);else if(s.length){for(var l=!1,c=0;c<s.length;c++)if(s[c].id==t[r].id){s[c].count+=t[r].count,l=!0;break}l||s.push(t[r])}else s.push(t[r])}n.sort(this.RuleSortByItem),a=o.concat(i,s,n),this.listItem.dataProvider=new eui.ArrayCollection(a)}else{for(var o=[],u=[],a=[],r=0;r<t.length;r++){var h=GlobalConfig.ItemConfig[t[r].id];if(1!=ItemConfig.getType(h))if(0==t[r].type)i.push(t[r]);else{var p=GlobalConfig.ItemConfig[t[r].id],d=ItemConfig.getType(p);d==ItemType.TYPE_6?n.push(t[r]):n.push(t[r])}else if(-1!=e.filterFb.indexOf(GameMap.fbType))u.push(t[r]);else if(u.length){for(var l=!1,c=0;c<u.length;c++)if(u[c].id==t[r].id){u[c].count+=t[r].count,l=!0;break}l||u.push(t[r])}else u.push(t[r])}this.winnerGroup.visible=!1,this.scrollerGroup.height=324,this.labelItem.text="获得道具：",this.labelEmblem.height=s.length>0?20:0,this.labelItem.height=n.length>0?20:0,this.labelEmblem.visible=s.length>0,this.labelItem.visible=n.length>0,i.sort(this.RuleSort),n.sort(this.RuleSortByItem),this.listCoin.dataProvider=new eui.ArrayCollection(i),this.listEmblem.dataProvider=new eui.ArrayCollection(s),a=o.concat(i,u,n),this.listItem.dataProvider=new eui.ArrayCollection(a)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.wpkBoss.close();for(var i=1;6>i;i++)this.removeTouchEvent(this["img"+i],this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.openRole,this.onTap),this.removeTouchEvent(this.openRole1,this.onTap),GameMap.fubenID>0&&UserFb.ins().isQuite&&UserFb.ins().sendExitFb(),this._fbType==UserFb.FB_TYPE_MATERIAL?ViewManager.ins().open(FbWin,0):this._fbType==UserFb.FB_TYPE_GUILD_BOSS?ViewManager.ins().open(GuildBossWin):this._fbType==UserFb.FB_TYPE_HOMEBOSS&&ViewManager.ins().open(BossWin,5),this.closeFunc&&(this.closeFunc(),this.closeFunc=null),this.bossmc&&(DisplayUtils.removeFromParent(this.bossmc),this.bossmc=null),SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN&&ViewManager.ins().open(BabelLotteryWin)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),CityCC.ins().isCity?this.closeBtn.label=""+this.closeBtn.name:this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:if(GameMap.fbType==UserFb.FB_TYPE_HUN_SHOU){if(!Hungu.ins().hunShouFBTimes)return void UserTips.ins().showTips("剩余次数不足");UserZs.ins().lv<GlobalConfig.FsFbConfig[Hungu.ins().hunShouFBPassID+1].zsLevelLimit?UserTips.ins().showTips("转生等级不足"):(Hungu.ins().enterHunShouFB(),UserFb.ins().isQuite=!1)}else UserFb2.ins().sendChallenge(),UserFb.ins().isQuite=!1;ViewManager.ins().close(this);break;case this.openRole:case this.openRole1:ViewManager.ins().close(this),ViewManager.ins().open(NewRoleWin)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(UserZs.ins().lv<=i.zslv||Actor.level<=i.lv){for(var s in i.gainWay)if(16!=i.gainWay[s][0])t.push(i.gainWay[s][0]);else{var n=DieGuide.ins().getOpenRoles();if(n){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[s][0]];o.itemId=n,t.push(i.gainWay[s][0])}}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.RuleSort=function(t,e){return t.id<e.id?-1:1},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);ResultWin.filterFb=[UserFb.FB_TYPE_MATERIAL],__reflect(ResultWin.prototype,"ResultWin"),ViewManager.ins().reg(ResultWin,LayerManager.UI_Popup);var TongResultWin=function(t){function e(){var e=t.call(this)||this;return e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChuangtianguanResultSkin",this.listCoin.itemRenderer=ResultCoinItem,this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.showRune=function(t){if(GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN){if(!t)return void(this.nune.visible=!1);var e=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel-1];if(!e||!e.showIcon)return void(this.nune.visible=!1);var i=GlobalConfig.ItemConfig[e.showIcon],s=ItemConfig.getQuality(i);if(s==FBChallengePanel.RunType)return void(this.nune.visible=!1);this.nune.visible=!0,this.scrollerGroup.y+=3*this.nune.height/2;var n="";e.equipPos?(this.nuneLock.visible=!0,n="开启战纹槽：",this.oldValue.text=(e.equipPos-1).toString(),this.newValue.text=e.equipPos.toString()):(this.nuneLock.visible=!1,n="解锁类型：",this.nuneValue.text=e.describe),this.nameLabel.text=n,this.nuneValue.visible=!this.nuneLock.visible}},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e);var s=e[0];this.bg.source=s?"win_png":"lost_png",this.closeBtn.name=s?"领取奖励":"退出",this.title.source=s?"win_02":"lost_02",DieGuide.ins().postdieGuide(s),this.showRune(s);var n=5;this.s=this.repeatTimes=n,this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var o=e[1];if(e[2]&&(this.txt.text=e[2]),UserFb.ins().isQuite=!0,e[3]instanceof Function?this.closeFunc=e[3]:0==e[3]&&(UserFb.ins().isQuite=e[3]),this.txt.visible=0!=s,this.defeat.visible=0==s,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.rewardBtn,this.onTap),0==s)this.rewardBtn.visible=!1,this.updateDefeatList();else if(1==s){var a=SkyLevelModel.ins(),r=GlobalConfig.FbChallengeConfig[a.cruLevel];r&&UserZs.ins().lv>=r.zsLevelLimit&&Actor.level>=r.levelLimit&&0==SkyLevelModel.ins().lotteryRemainTimes?(this.rewardBtn.visible=!0,this.closeBtn.x=0,1==r.layer?(this.rewardBtn.label="继续挑战",this.rewardBtn.width=130):(this.rewardBtn.label="挑战第"+r.layer+"层",this.rewardBtn.width=140)):(this.rewardBtn.visible=!1,this.closeBtn.x=90)}o?this.setRewardList(o):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],s=[],n=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemConfig.getType(r))0==t[a].type?e.push(t[a]):i.push(t[a]);else if(n.length){for(var h=!1,l=0;l<n.length;l++)if(n[l].id==t[a].id){n[l].count+=t[a].count,h=!0;break}h||n.push(t[a])}else n.push(t[a])}this.scrollerGroup.height=324,this.labelItem.text="获得道具：",this.labelItem.height=i.length>0?20:0,this.labelItem.visible=i.length>0,e.sort(this.RuleSort),i.sort(this.RuleSortByItem),this.listCoin.dataProvider=new eui.ArrayCollection(e),o=s.concat(e,n,i),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&UserFb.ins().isQuite&&UserFb.ins().sendExitFb(),this.closeFunc&&(this.closeFunc(),this.closeFunc=null),SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN&&ViewManager.ins().open(BabelLotteryWin)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:UserFb2.ins().sendChallenge(),UserFb.ins().isQuite=!1,ViewManager.ins().close(this)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(UserZs.ins().lv<=i.zslv||Actor.level<=i.lv){for(var s in i.gainWay)if(16!=i.gainWay[s][0]){if(14==i.gainWay[s][0]||20==i.gainWay[s][0]){var n=Object.keys(GlobalConfig.VipConfig).length;if(UserVip.ins().lv>=n)continue}t.push(i.gainWay[s][0])}else{var o=DieGuide.ins().getOpenRoles();if(o){var a=GlobalConfig.DeathgainWayConfig[i.gainWay[s][0]];a.itemId=o,t.push(i.gainWay[s][0])}}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.RuleSort=function(t,e){return t.id<e.id?-1:1},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);__reflect(TongResultWin.prototype,"TongResultWin"),ViewManager.ins().reg(TongResultWin,LayerManager.UI_Popup);var SocketConst=function(){function t(){}return t}();SocketConst.SOCKET_CONNECT="SOCKET_CONNECT",SocketConst.SOCKET_RECONNECT="SOCKET_RECONNECT",SocketConst.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",SocketConst.SOCKET_CLOSE="SOCKET_CLOSE",SocketConst.SOCKET_DATA="SOCKET_DATA",SocketConst.SOCKET_NOCONNECT="SOCKET_NOCONNECT",SocketConst.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",__reflect(SocketConst.prototype,"SocketConst");var ForgeConst;!function(t){t.CAN_FORGE_EQUIP=[EquipPos.WEAPON,EquipPos.HEAD,EquipPos.CLOTHES,EquipPos.NECKLACE,EquipPos.Wrist,EquipPos.BRACELET,EquipPos.RING,EquipPos.SHOE],t.EQUIP_POS_TO_SUB=[],t.EQUIP_POS_TO_SUB[EquipPos.WEAPON]=0,t.EQUIP_POS_TO_SUB[EquipPos.HEAD]=1,t.EQUIP_POS_TO_SUB[EquipPos.CLOTHES]=2,t.EQUIP_POS_TO_SUB[EquipPos.NECKLACE]=3,t.EQUIP_POS_TO_SUB[EquipPos.Wrist]=4,t.EQUIP_POS_TO_SUB[EquipPos.BRACELET]=5,t.EQUIP_POS_TO_SUB[EquipPos.RING]=6,t.EQUIP_POS_TO_SUB[EquipPos.SHOE]=7,t.EQUIP_POS_TO_SUB[EquipPos.DZI]=8,t.EQUIP_POS_TO_SUB[EquipPos.HAT]=9,t.EQUIP_POS_TO_SUB[EquipPos.VIZARD]=10,t.EQUIP_POS_TO_SUB[EquipPos.CLOAK]=11,t.EQUIP_POS_TO_SUB[EquipPos.SHIELD]=12}(ForgeConst||(ForgeConst={}));var ForgeRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleTabs={},e.flexible={},e.tabs={},e.roleTabs={},e.flexible={},e.redPoint=!1,e.associated(e.postForgeRedPoint,e.postForgeBoostRedPoint,e.postForgeZhulingRedPoint,e.postForgeGemRedPoint,e.postForgeWeaponRedPoint),e.associated(e.postForgeBoostRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips),e.associated(e.postForgeZhulingRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips),e.associated(e.postForgeGemRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips),e.associated(e.postForgeWeaponRedPoint,UserForge.ins().postForgeUpdate,UserForge.ins().postForgeTips,Weapons.ins().postWeaponsUse,Weapons.ins().postWeaponsFlexibleAct,Weapons.ins().postWeaponsInfo),e}return __extends(e,t),e.prototype.postForgeRedPoint=function(){var t=this.redPoint;return this.redPoint=this.tabs[ForgeWin.Page_Select_Boost]||this.tabs[ForgeWin.Page_Select_ZhuLing]||this.tabs[ForgeWin.Page_Select_Gem]||this.tabs[ForgeWin.Page_Select_Weapon],t!=this.redPoint},e.prototype.getRedPoint=function(t){return this.tabs[t]},e.prototype.getFlexibleRoleRedPoint=function(t){return this.flexible[t]},e.prototype.postForgeBoostRedPoint=function(){for(var t=ForgeWin.Page_Select_Boost,e=this.tabs[t],i=!1,s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getMinEquipIndexByType(t),r=o.getEquipByIndex(a).strengthen,h=UserForge.ins().getEnhanceCostConfigByLv(r+1);if(h){var l=h.stoneNum;if(l){var c=h.stoneId,u=UserBag.ins().getBagGoodsCountById(0,c);if(u>=l){var p=UserForge.ins().isMaxForge(o,t);p&&(i=!0)}this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][n]=u>=l}}}return this.tabs[t]=i,e!=i},e.prototype.postForgeZhulingRedPoint=function(){for(var t=ForgeWin.Page_Select_ZhuLing,e=this.tabs[t],i=!1,s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getMinEquipIndexByType(t),r=o.getEquipByIndex(a).zhuling,h=UserForge.ins().getZhulingCostConfigByLv(r+1);if(h){var l=h.count;if(l){var c=h.itemId,u=UserBag.ins().getBagGoodsCountById(0,c);if(u>=l){var p=UserForge.ins().isMaxForge(o,t);p&&(i=!0)}this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][n]=u>=l}}}return this.tabs[t]=i,e!=i},e.prototype.postForgeGemRedPoint=function(){if(Actor.level<GlobalConfig.StoneOpenConfig[0].openLv)return!1;for(var t=ForgeWin.Page_Select_Gem,e=this.tabs[t],i=!1,s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getMinEquipIndexByType(t),r=o.getEquipByIndex(a).gem,h=UserForge.ins().getStoneLevelCostConfigByLv(r+1);if(h){var l=h.soulNum;if(l){var c=(h.stoneId,Actor.soul);if(c>=l){var u=UserForge.ins().isMaxForge(o,t);u&&(i=!0)}this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][n]=c>=l}}}return this.tabs[t]=i,e!=i},e.prototype.postForgeWeaponRedPoint=function(){for(var t=ForgeWin.Page_Select_Weapon,e=!1,i=!1,s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=Weapons.ins().checkRedPoint(n);o&&(i=o),this.roleTabs[t]||(this.roleTabs[t]={}),e||this.roleTabs[t][n]==o||(e=!0);var a=this.getFlexibleRedPoint(n);this.flexible[n]=a,this.roleTabs[t][n]=o}return this.tabs[t]=i,e},e.prototype.getFlexibleRedPointOnly=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t),s=i.weapons.getFlexibleData();if(i.weapons.flexibleCount<=s.length)return!1;var n=i.weapons.getSoulInfoData(),o=[];for(var a in n)n[a]&&n[a].id&&o.push(n[a].id);return-1==s.indexOf(e)?!0:!1},e.prototype.getFlexibleRedPoint=function(t){var e=SubRoles.ins().getSubRoleByIndex(t),i=e.weapons.getFlexibleData();if(e.weapons.flexibleCount<=i.length)return!1;var s=e.weapons.getSoulInfoData(),n=[];for(var o in s)s[o]&&s[o].id&&n.push(s[o].id);for(var a=0;a<n.length;a++)if(-1==i.indexOf(n[a]))return!0;return e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?!0:!1},e}(BaseSystem);__reflect(ForgeRedPoint.prototype,"ForgeRedPoint");var GameSystem;!function(t){t.forgeredpoint=ForgeRedPoint.ins.bind(ForgeRedPoint)}(GameSystem||(GameSystem={}));var UserForge=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.strongthen,e.regNetMsg(2,e.doForgeUpdata),e.regNetMsg(5,e.postMeltItem),e.observe(UserBag.ins().postItemAdd,e.delaySeekItem),e.observe(UserBag.ins().postItemDel,e.delaySeekItem),e.observe(UserBag.ins().postItemChange,e.delaySeekItem),e.observe(Actor.ins().postSoulChange,e.delaySeekItem),e}return __extends(e,t),Object.defineProperty(e,"CONDITION_ZHUZAO",{get:function(){return GlobalConfig.StoneOpenConfig[0].openLv},enumerable:!0,configurable:!0}),e.ins=function(){return t.ins.call(this)},e.prototype.doForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e).parseForgeChange(t,this.sysId);this.postForgeUpdate(this.sysId,i)},e.prototype.postForgeUpdate=function(t,e){return void 0===e&&(e=0),[t,e]},e.prototype.postForgeTips=function(t){return t?1:0},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.delaySeekItem=function(){TimerManager.ins().isExists(this.seekForgeItem,this)||TimerManager.ins().doTimer(60,1,this.seekForgeItem,this)},e.prototype.seekForgeItem=function(){for(var t=!1,e=UserBag.ins().getBagItemNum(0),i=0;e>i;i++){var s=UserBag.ins().getBagGoodsByIndex(0,i);switch(s.itemConfig.id){case 200002:t=this.forgeHint(0,s.count);break;case 200003:t=this.forgeHint(ForgeWin.Page_Select_ZhuLing,s.count)}if(t)break}if(t||(t=this.forgeHint(ForgeWin.Page_Select_Gem,Actor.soul)),!t)for(var n=0;n<SubRoles.ins().subRolesLen&&!(t=Weapons.ins().checkRedPoint(n));n++);this.postForgeTips(t)
},e.prototype.getForgeConfigByPos=function(t,e,i){var s=this.getForgeConfig(i);return s[t]&&s[t][e]},e.prototype.getForgeConfig=function(t){if(this.forgeConfigDic=this.forgeConfigDic||{},!this.forgeConfigDic[t]){var e=void 0;switch(t){case ForgeWin.Page_Select_Boost:e=GlobalConfig.EnhanceAttrConfig;break;case ForgeWin.Page_Select_ZhuLing:e=GlobalConfig.ZhulingAttrConfig;break;case ForgeWin.Page_Select_Gem:e=GlobalConfig.StoneLevelConfig;break;case 3:}var i=this.forgeConfigDic[t]={};for(var s in e){var n=e[s];i[n.posId]||(i[n.posId]={}),i[n.posId][n.level]=e[s]}}return this.forgeConfigDic[t]},e.prototype.getEnhanceCostConfigByLv=function(t){var e=GlobalConfig.EnhanceCostConfig;return e[t]},e.prototype.getStoneLevelCostConfigByLv=function(t){var e,i=GlobalConfig.StoneLevelCostConfig;for(e in i){var s=i[e];if(s.level==t)return s}return null},e.prototype.getZhulingCostConfigByLv=function(t){var e,i=GlobalConfig.ZhulingCostConfig;for(e in i){var s=i[e];if(s.level==t)return s}return null},e.prototype.jingLianCanUp=function(){for(var t=SubRoles.ins().subRolesLen,i=!1,s=0;t>s;s++){var n=SubRoles.ins().getSubRoleByIndex(s),o=n.getMinEquipIndexByType(1),a=n.getEquipByIndex(o).zhuling,r=e.ins().getZhulingCostConfigByLv(a+1).count;if(r){var h=e.ins().getZhulingCostConfigByLv(a+1).itemId,l=UserBag.ins().getBagGoodsCountById(0,h);if(l>=r){i=!0;break}}}return i},e.prototype.getTupoCostConfigByLv=function(t){return null},e.prototype.forgeHint=function(t,i){for(var s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getMinEquipIndexByType(t),r=this.getForgeLv(t,o,a),h=this.getForgeCount(t,r);if(h&&i>=h){if(t!=ForgeWin.Page_Select_Gem)return e.ins().postForgeTips(!0),!0;if(Actor.level>=e.CONDITION_ZHUZAO)return e.ins().postForgeTips(!0),!0}}return e.ins().postForgeTips(!1),!1},e.prototype.getForgeLv=function(t,e,i){switch(t){case ForgeWin.Page_Select_Boost:return e.getEquipByIndex(i).strengthen;case ForgeWin.Page_Select_ZhuLing:return e.getEquipByIndex(i).zhuling;case ForgeWin.Page_Select_Gem:return e.getEquipByIndex(i).gem;case 3:return e.getEquipByIndex(i).tupo}},e.prototype.getForgeCount=function(t,e){switch(t){case ForgeWin.Page_Select_Boost:var i=this.getEnhanceCostConfigByLv(e+1);if(i)return i.stoneNum;break;case ForgeWin.Page_Select_ZhuLing:var s=this.getZhulingCostConfigByLv(e+1);if(s)return s.count;break;case ForgeWin.Page_Select_Gem:var n=this.getStoneLevelCostConfigByLv(e+1);if(n)return n.soulNum;break;case 3:var o=this.getTupoCostConfigByLv(e+1);if(o)return o.count}return 0},e.prototype.countAllBoostAttr=function(t,i,s,n){void 0===s&&(s=0),void 0===n&&(n=!1);for(var o=[],a=SubRoles.ins().getSubRoleByIndex(t),r=0;r<UserEquip.FOEGE_MAX;r++){var h=null,l=this.getForgeLv(i,a,r);n&&s==r&&(l+=1),h=e.ins().getForgeConfigByPos(r,l,i),h&&h.attr&&(o=e.AttrAddition(h.attr,o))}return o},e.prototype.isMaxForge=function(t,i){for(var s=0;8>s;s++){var n=this.getForgeLv(i,t,i),o=e.ins().getForgeConfigByPos(i,n+1,i);if(!o)return!1}return!0},e.AttrAddition=function(t,e){for(var i,s=t.length,n=e.length,o=[],a=0;s>a;a++)i=AttributeData.copyAttrbute(t[a]),o.push(i);for(var r=0;n>r;r++){for(var h=!1,a=0;a<o.length;a++)e[r].type==o[a].type&&(o[a].value=o[a].value+e[r].value,h=!0);h||(i=AttributeData.copyAttrbute(e[r]),o.push(i))}return o},e.prototype.sendMeltItem=function(t){var e=this.getBytes(5);e.writeShort(t.length);for(var i in t)e.writeInt(t[i].configID),e.writeInt(t[i].count);this.sendToServer(e)},e.prototype.postMeltItem=function(){},e}(BaseSystem);__reflect(UserForge.prototype,"UserForge");var GameSystem;!function(t){t.userforge=UserForge.ins.bind(UserForge)}(GameSystem||(GameSystem={}));var UserGem=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Gem,e.regNetMsg(2,e.postForgeUpdata),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),s=i.parseForgeChange(t,this.sysId);UserForge.ins().postForgeUpdate(this.sysId,s)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e}(BaseSystem);UserGem.ROLL_NUM=8,__reflect(UserGem.prototype,"UserGem");var GameSystem;!function(t){t.usergem=UserGem.ins.bind(UserGem)}(GameSystem||(GameSystem={}));var UserTupo=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Tupo,e.regNetMsg(2,e.postForgeUpdata),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e);i.parseForgeChange(t,this.sysId),UserForge.ins().postForgeUpdate(this.sysId)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e}(BaseSystem);__reflect(UserTupo.prototype,"UserTupo");var GameSystem;!function(t){t.usertupo=UserTupo.ins.bind(UserTupo)}(GameSystem||(GameSystem={}));var UserZhuLing=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Zhuling,e.regNetMsg(2,e.postForgeUpdata),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),s=i.parseForgeChange(t,this.sysId);UserForge.ins().postForgeUpdate(this.sysId,s)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e}(BaseSystem);__reflect(UserZhuLing.prototype,"UserZhuLing");var GameSystem;!function(t){t.userzhuling=UserZhuLing.ins.bind(UserZhuLing)}(GameSystem||(GameSystem={}));var CastingPosItemRender=function(t){function e(){var e=t.call(this)||this;return e.statuList=["open","select","dark"],e.skinName="castingpositemrenderskin",e}return __extends(e,t),e.prototype.setShowStatu=function(t){this.currentState=this.statuList[t]},e}(BaseView);__reflect(CastingPosItemRender.prototype,"CastingPosItemRender");var Castingposlist=function(t){function e(){var e=t.call(this)||this;return e.skinName="castingposlistskin",e}return __extends(e,t),e.prototype.setShow=function(t,e,i){this.currentState="pos_"+t;for(var s=i?UserGem.ROLL_NUM:e%UserGem.ROLL_NUM,n=0;n<UserGem.ROLL_NUM;n++){var o=0;o=s>n?0:s==n?1:2,this["item"+n].setShowStatu(o),this["line_"+n]&&(this["line_"+n].source=0==o?"zhuzaoxian":"zhuzaoxianbg")}},e}(BaseView);__reflect(Castingposlist.prototype,"Castingposlist");var CircleRunBoostView=function(t){function e(){var e=t.call(this)||this;e.equipSource=["xduanzao_20","xduanzao_21","xduanzao_22","xduanzao_23","xduanzao_24","xduanzao_24","xduanzao_25","xduanzao_25"],e.nameBg=["xduanzao_10_png","xduanzao_11_png"],e.skinName="CircleRunBoostSkin",e.itemList=[];for(var i=CircleRunView.EQUIP_COUNT;i--;)e.itemList[i]=e["item"+i];return e.item0.itemName.source="xduanzao_12_png",e.item1.itemName.source="xduanzao_13_png",e.item2.itemName.source="xduanzao_14_png",e.item3.itemName.source="xduanzao_15_png",e.item4.itemName.source="xduanzao_16_png",e.item5.itemName.source="xduanzao_16_png",e.item6.itemName.source="xduanzao_17_png",e.item7.itemName.source="xduanzao_17_png",e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;for(var e=0;e<this.itemList.length;e++)this.itemList[e].setType(this._type);this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setValue=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=this.itemList.length,i=0;e>i;i++){var s=0;switch(this._type){case 0:s=t.getEquipByIndex(i).strengthen}this.itemList[i].setValue(s)}},e.prototype.turnItem=function(t){this.equip.source=this.equipSource[t],this.setNameBg(t)},e.prototype.setNameBg=function(t){for(var e=this.itemList.length,i=0;e>i;i++)i==t?this.itemList[i].setSource(this.nameBg[1]):this.itemList[i].setSource(this.nameBg[0])},e}(BaseView);__reflect(CircleRunBoostView.prototype,"CircleRunBoostView");var CircleRunGemView=function(t){function e(){var e=t.call(this)||this;e.skinName="CircleRunGemSkin",e.itemList=[];for(var i=CircleRunView.EQUIP_COUNT;i--;)e.itemList[i]=e["item"+i];return e.item0.item.source="forge_00_png",e.item1.item.source="forge_01_png",e.item2.item.source="forge_02_png",e.item3.item.source="forge_03_png",e.item4.item.source="forge_04_png",e.item5.item.source="forge_05_png",e.item6.item.source="forge_06_png",e.item7.item.source="forge_07_png",e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;for(var e=0;e<this.itemList.length;e++)this.itemList[e].setType(this._type);this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setValue=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=this.itemList.length,i=0;e>i;i++){var s=0;switch(this._type){case 1:s=t.getEquipByIndex(i).gem}this.itemList[i].setValue(s)}},e.prototype.turnItem=function(t){this.setItemSelect(t)},e.prototype.setItemSelect=function(t){for(var e=this.itemList.length,i=0;e>i;i++)i==t?this.itemList[i].isSelectEff(!0):this.itemList[i].isSelectEff(!1)},e}(BaseView);__reflect(CircleRunGemView.prototype,"CircleRunGemView");var CircleRunView=function(t){function e(){var e=t.call(this)||this;return e.boostView=new CircleRunBoostView,e.addChild(e.boostView),e.gemView=new CircleRunGemView,e.addChild(e.gemView),e.zhulingView=new CircleRunZhulingView,e.addChild(e.zhulingView),e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){switch(this._type=t,this.boostView.visible=!1,this.gemView.visible=!1,this.zhulingView.visible=!1,this._type){case 0:this.boostView.visible=!0,this.boostView.type=t;break;case 1:this.gemView.visible=!0,this.gemView.type=t;break;case 2:this.zhulingView.visible=!0,this.zhulingView.type=t;break;case 3:}this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setCurRole=function(t){this._curRole=t,this.boostView.curRole=t,this.gemView.curRole=t,this.zhulingView.curRole=t},e.prototype.getCurRole=function(){return this._curRole},e.prototype.setValue=function(){switch(this._type){case 0:this.boostView.setValue();break;case 1:this.gemView.setValue();break;case 2:this.zhulingView.setValue();break;case 3:}},e.prototype.turnItem=function(t){switch(this._type){case 0:this.boostView.turnItem(t);break;case 1:this.gemView.turnItem(t);break;case 2:this.zhulingView.turnItem(t);break;case 3:}},e}(BaseView);CircleRunView.BOOST=0,CircleRunView.GEM=1,CircleRunView.ZHU_LING=2,CircleRunView.EQUIP_COUNT=8,__reflect(CircleRunView.prototype,"CircleRunView");var CircleRunZhulingView=function(t){function e(){var e=t.call(this)||this;e.skinName="CircleRunZhulingSkin",e.itemList=[];for(var i=CircleRunView.EQUIP_COUNT;i--;)e.itemList[i]=e["item"+i];return e.item0.item.source="forge_00_png",e.item1.item.source="forge_01_png",e.item2.item.source="forge_02_png",e.item3.item.source="forge_03_png",e.item4.item.source="forge_04_png",e.item5.item.source="forge_05_png",e.item6.item.source="forge_06_png",e.item7.item.source="forge_07_png",e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;for(var e=0;e<this.itemList.length;e++)this.itemList[e].setType(this._type);this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setValue=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=this.itemList.length,i=0;e>i;i++){var s=0;switch(this._type){case 2:s=t.getEquipByIndex(i).zhuling}this.itemList[i].setValue(s)}},e.prototype.turnItem=function(t){this.setItemSelect(t)},e.prototype.setItemSelect=function(t){for(var e=this.itemList.length,i=0;e>i;i++)i==t?this.itemList[i].isSelectEff(!0):this.itemList[i].isSelectEff(!1)},e}(BaseView);__reflect(CircleRunZhulingView.prototype,"CircleRunZhulingView");var Tween=egret.Tween,ForgeBoostPanel=function(t){function e(){var e=t.call(this)||this;return e.isMax=!1,e.isAutoUp=!1,e.itemNum=0,e.startPos=0,e.name="强化",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.upGradeBtn.label="强  化",this.curPanel=ForgeWin.Page_Select_Boost,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.eff=new MovieClip,this.eff.x=this.upGradeBtn.width/2,this.eff.y=this.upGradeBtn.height/2,this.eff.touchEnabled=!1},e.prototype.getGuildButton=function(){return this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.x=this.upGradeBtn.width/2,this.eff.y=this.upGradeBtn.height/2,this.eff.parent||this.upGradeBtn.addChild(this.eff),this.upGradeBtn},e.prototype.open=function(t,e){this.addTouchEvent(this.upGradeBtn,this.onTouch),this.addTouchEvent(this.upGradeBtn0,this.onTouch),this.addTouchEvent(this.getItemTxt,this.onGetItem),this.observe(UserBag.ins().postItemAdd,this.setCount),this.observe(UserBag.ins().postItemChange,this.setCount),this.observe(Actor.ins().postLevelChange,this.setView),this.isMax=!1,this.setView(),this.changeData(t,e),this.stopAutoUp()},e.prototype.close=function(){this.removeTouchEvent(this.upGradeBtn,this.onTouch),this.removeTouchEvent(this.getItemTxt,this.onGetItem),DisplayUtils.removeFromParent(this.eff),this.stopAutoUp()},e.prototype.setView=function(){DisplayUtils.removeFromParent(this.eff)},e.prototype.onTouch=function(t){switch(t.target){case this.upGradeBtn:DisplayUtils.removeFromParent(this.eff);var e=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!e)return;this.itemNum>=e.stoneNum?(SoundUtil.ins().playEffect(SoundUtil.FORGE),UserForge.ins().sendUpGrade(this.curRole,this.pos)):UserWarn.ins().setBuyGoodsWarn(e.stoneId,e.stoneNum-this.itemNum);break;case this.upGradeBtn0:if(!this.isAutoUp){if(this.isAutoUp=!0,this.startPos=this.pos,!this.autoUpStarEx())return UserTips.ins().showTips("材料不足"),void(this.isAutoUp=!1);var i;i||(i=new MovieClip,i.x=this.itemGroup.width/2+120,i.y=this.itemGroup.height/2+140,this.itemGroup.addChild(i)),i.playFile(RES_DIR_EFF+"qianghua2",1,function(){DisplayUtils.removeFromParent(i)})}}},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,this.upGradeBtn0&&(this.upGradeBtn0.label="一键强化"),egret.Tween.removeTweens(this.upGradeBtn0)},e.prototype.stopAutoUpEx=function(){this.isAutoUp=!1,TimerManager.ins().remove(this.stopAutoUpEx,this)},e.prototype.autoUpBack=function(t){if(this.isAutoUp){var e=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);if(!e)return;if(this.itemNum<e.stoneNum)return this.isAutoUp=!1,void UserTips.ins().showTips("材料不足");if(this.startPos==t)return void(this.isAutoUp=!1);UserForge.ins().sendUpGrade(this.curRole,t)}},e.prototype.autoUpStarEx=function(){var t=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);return t?this.itemNum>=t.stoneNum?(SoundUtil.ins().playEffect(SoundUtil.FORGE),UserForge.ins().sendUpGrade(this.curRole,this.pos),!0):(this.upGradeBtn0.label="一键强化",!1):!1},e.prototype.autoUpStar=function(){var t=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1);t&&(this.itemNum>=t.stoneNum?(UserForge.ins().sendUpGrade(this.curRole,this.pos),7==this.pos&&(this.isAutoUp=!1,this.upGradeBtn0.label="一键强化",TimerManager.ins().remove(this.autoUpStar,this))):(this.isAutoUp=!1,this.upGradeBtn0.label="一键强化",TimerManager.ins().remove(this.autoUpStar,this)))},e.prototype.onGetItem=function(t){UserWarn.ins().setBuyGoodsWarn(UserForge.ins().getEnhanceCostConfigByLv(this.lv+1).stoneId,1)},e.prototype.changeData=function(t,e,i){void 0===i&&(i=!0),this.pos=t,this.lv=e;var s=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel);this.setAttrData(s),this.setPower(),this.setSlectedInfo(),i?(this.setCount(),this.upGradeBtn.touchEnabled=!0):this.upGradeBtn.touchEnabled=!1},e.prototype.setPower=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=t.getForgeTotalPower(this.curPanel),this.powerPanel.setPower(this._totalPower)},e.prototype.setSlectedInfo=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.equipsData,i=0;i<UserEquip.FOEGE_MAX;i++){var s=e[i].strengthen;this["level_"+i].text=s>0?"+"+s:"",this["show"+(i+1)].visible=i==this.pos,this["lianjiexian"+i].visible=i==this.pos}},e.prototype.setAttrData=function(t){var e,i=t.length;t.sort(AttributeData.sortAttribute);for(var s=0;4>s;s++)this["attr"+s].text=i>s?AttributeData.getAttStrByType(t[s],.5):"";if(e=UserForge.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel)){this.isMax=!1;var n="",o=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel,this.pos,!0);o.sort(AttributeData.sortAttribute);for(var s=0;4>s;s++){if(i>s){var a=t[s];n=this.getAttrByType(o,a)}this["arrow"+s].visible=n.length>0,this["addAttr"+s].text=n}}else{this.isMax=!0;for(var s=0;4>s;s++)this["arrow"+s].visible=!1,this["addAttr"+s].text=""}this.upInfo.visible=!this.isMax,this.maxDesc.visible=this.isMax},e.prototype.setCount=function(){var t=UserForge.ins().getEnhanceCostConfigByLv(this.lv+1),e=0;t&&(this.itemNum=UserBag.ins().getBagGoodsCountById(0,t.stoneId),e=t.stoneNum);var i="";i=this.itemNum>=e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+e+"</font> ")},e.prototype.getAttrByType=function(t,e){for(var i=t.length,s=0;i>s;s++)if(t[s].type==e.type&&t[s].value!=e.value)return""+t[s].value;return""},e}(BaseEuiView);__reflect(ForgeBoostPanel.prototype,"ForgeBoostPanel");var ForgeGemPanel=function(t){function e(){var e=t.call(this)||this;return e.curPanel=3,e.isMax=!1,e.isAutoUp=!1,e.itemNum=0,e.itemArr=[],e.eqIndexItems=[],e.isPlay=!1,e.name="精炼",e.curPanel=ForgeWin.Page_Select_Gem,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>")},e.prototype.open=function(t,e){this.addTouchEvent(this.upGradeBtn,this.onTouch),this.addTouchEvent(this.getItemTxt,this.onGetItem);for(var i=0;i<UserEquip.FOEGE_MAX;i++)this.eqIndexItems.push(this["item"+i]),this["item"+i].select.visible=i==t?!0:!1,this.addTouchEvent(this["item"+i],this.onSelectItem);this.observe(UserBag.ins().postItemAdd,this.setCount),this.observe(UserBag.ins().postItemChange,this.setCount),this.observe(UserGem.ins().postForgeUpdata,this.updateCallBack),this.isMax=!1,this.changeData(t,e,!0,!0),this.stopAutoUp(),this.cleanEff(),this.playEff()},e.prototype.close=function(){this.removeTouchEvent(this.upGradeBtn,this.onTouch),this.removeTouchEvent(this.getItemTxt,this.onGetItem),this.removeObserve(),this.stopAutoUp()},e.prototype.onTouch=function(t){switch(t.target){case this.upGradeBtn:this.costConfig&&this.itemNum>=this.costConfig.soulNum?(UserGem.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.ins().playEffect(SoundUtil.FORGE)):UserWarn.ins().setBuyGoodsWarn(this.costConfig.stoneId,this.costConfig.soulNum-this.itemNum)}},e.prototype.onItemTouch=function(t){var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=Number(t.currentTarget.name);this.changeData(i,e.getEquipByIndex(i).gem)},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,TimerManager.ins().remove(this.autoUpStar,this)},e.prototype.autoUpStar=function(){this.costConfig&&this.itemNum>=this.costConfig.soulNum?(UserGem.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.ins().playEffect(SoundUtil.FORGE)):(this.isAutoUp=!1,TimerManager.ins().remove(this.autoUpStar,this))},e.prototype.setPower=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=t.getForgeTotalPower(this.curPanel),this.powerPanel.setPower(this._totalPower)},e.prototype.changeData=function(t,e,i,s){void 0===i&&(i=!0),void 0===s&&(s=!1),this.pos=t,this.lv=e,this.setPower(),i&&this.setCount(),this.updateItem(s),this.setAttrData()},e.prototype.playEff=function(){var t=this;if(!this.isPlay){var e="jljdt";this.isPlay=!0;var i=1,s=new MovieClip;s.playFile(RES_DIR_EFF+e,-1),this.leftEff.addChild(s),s.scaleX=0,s.scaleY=.6;var n=new MovieClip;n.playFile(RES_DIR_EFF+e,-1),this.rightEff.addChild(n),n.scaleX=0,n.scaleY=.6;var o=new MovieClip;o.playFile(RES_DIR_EFF+e,-1),this.buttonEff.addChild(o),o.x+=5,o.scaleX=0,o.scaleY=.6,o.$setRotation(90);var a=new MovieClip;a.playFile(RES_DIR_EFF+e,-1),this.leftEff2.addChild(a),a.scaleX=0,a.scaleY=.4;var r=new MovieClip;r.playFile(RES_DIR_EFF+e,-1),this.rightEff2.addChild(r),r.scaleX=0,r.scaleY=.4;var h=new MovieClip;h.playFile(RES_DIR_EFF+e,-1),this.obliqueleft.addChild(h),h.scaleX=0,h.scaleY=.4;var l=new MovieClip;l.playFile(RES_DIR_EFF+e,-1),this.obliqueright.addChild(l),l.scaleX=0,l.scaleY=.4;var c=new MovieClip;c.playFile(RES_DIR_EFF+e,-1),this.leftEff3.addChild(c),c.scaleX=0,c.scaleY=.4;var u=new MovieClip;u.playFile(RES_DIR_EFF+e,-1),this.rightEff3.addChild(u),u.scaleX=0,u.scaleY=.4;var p=new MovieClip;p.playFile(RES_DIR_EFF+e,-1),this.obliqueleft2.addChild(p),p.scaleX=0,p.scaleY=.4;var d=new MovieClip;d.playFile(RES_DIR_EFF+e,-1),this.obliqueright2.addChild(d),d.scaleX=0,d.scaleY=.4;var g=new MovieClip;g.playFile(RES_DIR_EFF+e,-1),this.leftEff4.addChild(g),g.scaleX=0,g.scaleY=.4;var f=new MovieClip;f.playFile(RES_DIR_EFF+e,-1),this.rightEff4.addChild(f),f.scaleX=0,f.scaleY=.4;var v=.19,y=.09,m=.023,T=.15,b=egret.Tween.get(s),C=egret.Tween.get(n);C.to({scaleX:v},250*i),b.to({scaleX:v},250*i).call(function(){var e=egret.Tween.get(o);e.to({scaleX:.162},250*i).call(function(){var e=egret.Tween.get(a),s=egret.Tween.get(r);s.to({scaleX:y},250*i),e.to({scaleX:y},250*i).call(function(){var e=egret.Tween.get(h),s=egret.Tween.get(l);s.to({scaleX:m},50*i),e.to({scaleX:m},50*i).call(function(){var e=egret.Tween.get(c),s=egret.Tween.get(u);s.to({scaleX:T},250*i),e.to({scaleX:T},250*i).call(function(){var e=egret.Tween.get(p),s=egret.Tween.get(d);s.to({scaleX:m},50*i),e.to({scaleX:m},50*i).call(function(){var e=egret.Tween.get(g),s=egret.Tween.get(f);s.to({scaleX:y},250*i),e.to({scaleX:y},250*i).call(function(){t.isPlay=!1})})})})})})})}},e.prototype.cleanEff=function(){this.leftEff.removeChildren(),this.rightEff.removeChildren(),this.buttonEff.removeChildren(),this.leftEff2.removeChildren(),this.rightEff2.removeChildren(),this.obliqueleft.removeChildren(),this.obliqueright.removeChildren(),this.leftEff3.removeChildren(),this.rightEff3.removeChildren(),this.obliqueleft2.removeChildren(),this.obliqueright2.removeChildren(),this.leftEff4.removeChildren(),this.rightEff4.removeChildren()},e.prototype.updateCallBack=function(){var t=this,e=new MovieClip;e.x=this["new"].x+this["new"].width/2,e.y=this["new"].y+this["new"].height/2,this.itemGroup2.addChild(e),e.playFile(RES_DIR_EFF+"forgeSuccess",1,function(){var e=SubRoles.ins().getSubRoleByIndex(t.curRole),i=e.equipsData;t.now.updateItem(i[t.pos].item.itemConfig,t.pos,i[t.pos].gem,t.itemNum,!1),t["new"].updateItem(i[t.pos].item.itemConfig,t.pos,i[t.pos].gem+1,t.itemNum,!1)})},e.prototype.updateItem=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=e.equipsData,s=0;s<UserEquip.FOEGE_MAX;s++){var n=i[s].gem,o=this.itemNum;if(t&&s==this.pos){var a=GlobalConfig.StoneOpenConfig[s];Actor.level>=a.openLv&&(this.lv=i[this.pos].gem,this["item"+s].select.visible=!0,this.xjyl.visible=!1),this.now.updateItem(i[s].item.itemConfig,s,n,this.itemNum,!1),this["new"].updateItem(i[s].item.itemConfig,s,n+1,this.itemNum,!1)}if(!o){var r=i[s].gem?i[s].gem:1,h=GlobalConfig.StoneLevelCostConfig[r];h&&(o=UserBag.ins().getBagGoodsCountById(0,h.stoneId))}this["item"+s].data={item:i[s].item.itemConfig,pos:s,lv:i[s].gem,itemNum:o}}},e.prototype.onSelectItem=function(t){var e=this.eqIndexItems.indexOf(t.currentTarget);if(-1!=e){this.isPlay&&(this.isPlay=!1,this.cleanEff());for(var i=this.pos,s=0;s<UserEquip.FOEGE_MAX;s++)this["item"+s].select.visible&&(i=s),this["item"+s].select.visible=!1;var n=!1,o=SubRoles.ins().getSubRoleByIndex(this.curRole),a=o.equipsData,r=GlobalConfig.StoneOpenConfig[e],h="";switch(t.currentTarget){case this["item"+e]:Actor.level>=r.openLv?(this.cleanEff(),this.playEff(),this.pos=e,this.lv=a[this.pos].gem,n=!0,this["item"+e].select.visible=!0,this.xjyl.visible=!1,this.now.updateItem(a[e].item.itemConfig,e,a[e].gem,this.itemNum,!1),this["new"].updateItem(a[e].item.itemConfig,e,a[e].gem+1,this.itemNum,!1)):h=r.openLv+"级开启"}n||(this["item"+i].select.visible=!0,UserTips.ins().showTips(h)),this.setAttrData(),this.setCount()}},e.prototype.setAttrData=function(){var t;t=UserForge.ins().getForgeConfigByPos(this.pos,this.lv,this.curPanel);var e=t.attr||[],i=e.length;e.sort(AttributeData.sortAttribute);for(var s=0;4>s;s++)this["attr"+s].text=i>s?AttributeData.getAttStrByType(e[s],.5):"";var n;n=UserForge.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel);var o="";if(n){this.isMax=!1;var a=n.attr||[];a.sort(AttributeData.sortAttribute);for(var s=0;4>s;s++){var r="";if(i>s){var h=e[s];r=this.getAttrByType(a,h)}this["arrow"+s].visible=r.length>0,this["addAttr"+s].text=r}}else{this.isMax=!0;for(var s=0;4>s;s++)this["arrow"+s].visible=!1,this["addAttr"+s].text=""}this.attr.text=o,this.upInfo.visible=!this.isMax,this.maxDesc.visible=this.isMax,this.maxDesc.visible&&(this.now.hideAdd(),this["new"].hideAdd())},e.prototype.onGetItem=function(t){UserWarn.ins().setBuyGoodsWarn(this.costConfig.stoneId,1)},e.prototype.setCount=function(){this.costConfig=UserForge.ins().getStoneLevelCostConfigByLv(this.lv+1);var t=0;this.costConfig&&(this.itemNum=Actor.soul,t=this.costConfig.soulNum);var e="";e=this.itemNum>=t?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t+"</font> "),this.buyStoneUpdateItem()},e.prototype.buyStoneUpdateItem=function(){this.updateItem()},e.prototype.getAttrByType=function(t,e){if(!e)return"";for(var i=t.length,s=0;i>s;s++)if(t[s].type==e.type&&t[s].value!=e.value)return""+t[s].value;return""},e}(BaseEuiView);__reflect(ForgeGemPanel.prototype,"ForgeGemPanel");var ForgeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.getSource=function(){return this._source},e.prototype.getSourceName=function(){return this._sourceName},e.prototype.setSource=function(t){this._source!=t&&(this._source=t,this.item.source=this._source)},e.prototype.setSourceName=function(t){this._sourceName!=t&&(this._sourceName=t,this.item.source=this._sourceName)},e.prototype.isSelect=function(t){return this.select.visible=t,t},e.prototype.isSelectEff=function(t){return this.parent?(this.selectEff||(this.selectEff=new MovieClip,this.selectEff.x=40,this.selectEff.y=38,this.selectEff.playFile(RES_DIR_EFF+"zhuling",-1)),!this.selectEff.parent&&t&&this.addChildAt(this.selectEff,2),t?this.selectEff.play(-1):this.selectEff.stop(),this.selectEff.visible=t,t):void 0},e.prototype.setValue=function(t){switch(this._type){case 0:this.boost.text="+"+t;break;case 1:this.gem.text="+"+t;break;case 2:this.zhuling.text="+"+t;break;case 3:this.tupo.text=t+"星"}},e.prototype.getType=function(){return this._type},e.prototype.setType=function(t){if(this._type!=t)switch(this._type=t,this._type){case 0:this.boost.visible=!0,this.itemName.visible=!0,this.gem.visible=!1,this.zhuling.visible=!1,this.tupo.visible=!1,this.isSelect(!1),this.labelBg.visible=!1;break;case 1:this.boost.visible=!1,this.itemName.visible=!1,this.gem.visible=!0,this.zhuling.visible=!1,this.tupo.visible=!1,this.labelBg.visible=!0;break;case 2:this.boost.visible=!1,this.itemName.visible=!1,this.gem.visible=!1,this.zhuling.visible=!0,this.tupo.visible=!1,this.labelBg.visible=!0;break;case 3:this.boost.visible=!1,this.itemName.visible=!1,this.gem.visible=!1,this.zhuling.visible=!1,this.tupo.visible=!0,this.labelBg.visible=!0}},e}(BaseComponent);__reflect(ForgeItem.prototype,"ForgeItem");var ForgeTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="forgeTips"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.attr=t[0],this.attrStr=t[1],this.addTouchEndEvent(this,this.otherClose),this.attrTxt.text=this.attrStr,this.attrTxt0.text="";for(var i=0;i<this.attr.length;i++)this.attrTxt0.text+=this.attr[i]+(i==this.attr.length-1?"":"\n");this.background.height=this.attrTxt.textHeight+60,this.group.y=this.group.height/2-this.background.height/2},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ForgeTipsWin.prototype,"ForgeTipsWin"),ViewManager.ins().reg(ForgeTipsWin,LayerManager.UI_Popup);var ForgeTupoPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(BaseView);__reflect(ForgeTupoPanel.prototype,"ForgeTupoPanel");var ForgeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="forgeskin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.viewStack.selectedIndex=e.Page_Select_Boost,this.tab.dataProvider=this.viewStack,this.mc=new MovieClip,this.mc.x=240,this.mc.y=400,this.mcList=[];for(var i=0;8>i;i++){var s=new MovieClip;s.x=240,s.y=400,this.mcList.push(s)}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tab.selectedIndex=this.viewStack.selectedIndex=t[0],void 0!=t[1]&&this.roleSelect.setCurRole(parseInt(t[1]+"")),this.setRoleId(this.roleSelect.getCurRole()),this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.closeBtn0,this.onTouch),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(UserForge.ins().postForgeUpdate,this.onEvent),this.observe(ForgeRedPoint.ins().postForgeBoostRedPoint,this.delayRedPoint),this.observe(ForgeRedPoint.ins().postForgeZhulingRedPoint,this.delayRedPoint),this.observe(ForgeRedPoint.ins().postForgeGemRedPoint,this.delayRedPoint),this.observe(ForgeRedPoint.ins().postForgeWeaponRedPoint,this.delayRedPoint)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.viewStack.numChildren,s=0;i>s;s++)this.viewStack.getChildAt(s).close();var n=ViewManager.ins().getView(UIView2);n&&n.closeNav(UIView2.NAV_SMITH),DisplayUtils.removeFromParent(this.mc);for(var s=0;8>s;s++)DisplayUtils.removeFromParent(this.mcList[s])},e.prototype.onTouch=function(t){ViewManager.ins().close(e)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex),this.redPointEx()},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.setOpenIndex=function(t,i){var s=0,n=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole()),o=!0;switch(this.roleSelect.openRole(),t){case e.Page_Select_Boost:s=n.getMinEquipIndexByType(0),this.boostPanel.open(s,n.getEquipByIndex(s).strengthen);break;case e.Page_Select_Gem:s=n.getMinEquipIndexByType(e.Page_Select_Gem),Actor.level>=GlobalConfig.StoneOpenConfig[0].openLv?this.gemPanel.open(s,n.getEquipByIndex(s).gem):(o=!1,UserTips.ins().showTips("精炼"+GlobalConfig.StoneOpenConfig[0].openLv+"级开启"));break;case e.Page_Select_ZhuLing:s=n.getMinEquipIndexByType(e.Page_Select_ZhuLing),this.zhulingPanel.open(s,n.getEquipByIndex(s).zhuling);break;case e.Page_Select_Weapon:o=OpenSystem.ins().checkSysOpen(SystemType.WEAPONS),o?i&&this.weaponsoul.isShowSoul()?this.weaponsoul.open(this.roleSelect.getCurRole(),!1):this.weaponsoul.open(this.roleSelect.getCurRole(),!0):UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.WEAPONS));break;case e.PageSelectSamsara:this.roleSelect.hideRole()}o||(this.tab.selectedIndex=this.viewStack.selectedIndex),this.tab.selectedIndex!=this.viewStack.selectedIndex&&this.checkAutoBtn()},e.prototype.checkIsOpen=function(t){switch(t){case e.Page_Select_Boost:break;
case e.Page_Select_Gem:if(Actor.level<GlobalConfig.StoneOpenConfig[0].openLv)return UserTips.ins().showTips("精炼"+GlobalConfig.StoneOpenConfig[0].openLv+"级开启"),!1;break;case e.Page_Select_ZhuLing:break;case e.Page_Select_Weapon:if(!OpenSystem.ins().checkSysOpen(SystemType.WEAPONS))return UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.WEAPONS)),!1}return!0},e.prototype.checkAutoBtn=function(){this.boostPanel.isAutoUp&&this.boostPanel.stopAutoUp(),this.zhulingPanel.isAutoUp&&this.zhulingPanel.stopAutoUp()},e.prototype.onEvent=function(t){var i=this,s=t[0],n=t[1],o=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole());switch(s){case PackageID.strongthen:e.Page_Select_Boost==this.viewStack.selectedIndex&&(this.boostPanel.isAutoUp||(this.mcList[n].x=n%2*434+40,this.mcList[n].y=120*Math.floor(n/2)+35,this.mcList[n].playFile(RES_DIR_EFF+"forgeSuccess",1),this.boostPanel.itemGroup.addChild(this.mcList[n])),n=o.getMinEquipIndexByType(0),this.boostPanel.changeData(n,o.getEquipByIndex(n).strengthen),this.boostPanel.autoUpBack(n));break;case PackageID.Gem:break;case PackageID.Zhuling:e.Page_Select_ZhuLing==this.viewStack.selectedIndex&&(this.zhulingPanel.isAutoUp||(this.mcList[n].x=this.zhulingPanel["kuang"+n].x+this.zhulingPanel["kuang"+n].width/2,this.mcList[n].y=this.zhulingPanel["kuang"+n].y+this.zhulingPanel["kuang"+n].height/2,this.mcList[n].playFile(RES_DIR_EFF+"forgeSuccess",1),this.zhulingPanel.itemGroup.addChild(this.mcList[n])),n=o.getMinEquipIndexByType(e.Page_Select_ZhuLing),this.zhulingPanel.changeData(n,o.getEquipByIndex(n).zhuling),this.zhulingPanel.autoUpBack(n))}TimerManager.ins().doTimer(200,1,function(){switch(s){case PackageID.strongthen:break;case PackageID.Gem:e.Page_Select_Gem==i.viewStack.selectedIndex&&i.gemPanel.changeData(n,o.getEquipByIndex(n).gem);break;case PackageID.Zhuling:}},this),this.redPointEx()},e.prototype.delayRedPoint=function(){TimerManager.ins().isExists(this.redPointEx,this)||TimerManager.ins().doTimer(60,1,this.redPointEx,this)},e.prototype.redPointEx=function(){for(var t=[!1,!1,!1],i=0;i<t.length;i++)this.roleSelect.showRedPoint(i,t[i]);for(var i=0;4>i;i++){if(ForgeRedPoint.ins().roleTabs[i]&&this.tab.selectedIndex==i)for(var s=0;s<SubRoles.ins().subRolesLen;s++)this.roleSelect.showRedPoint(s,ForgeRedPoint.ins().roleTabs[i][s]),i==e.Page_Select_Weapon&&this.weaponsoul.isShowSoul()&&this.roleSelect.showRedPoint(s,ForgeRedPoint.ins().getFlexibleRoleRedPoint(s));this["redPoint"+i].visible=!1,this["redPoint"+i].visible=ForgeRedPoint.ins().getRedPoint(i)}},e.prototype.redPoint=function(){for(var t=SubRoles.ins().subRolesLen,i=[!1,!1,!1],s=0;s<i.length;s++)this.roleSelect.showRedPoint(s,i[s]),this["redPoint"+s].visible=!1;this.redPoint3.visible=!1;for(var n=0;t>n;n++){for(var s=0;3>s;s++){var o=SubRoles.ins().getSubRoleByIndex(n),a=o.getMinEquipIndexByType(s),r=this.getForgeLv(s,o,a),h=this.getForgeIdOrCount(s,r,0);if(h){var l=this.getForgeIdOrCount(s,r,1),c=void 0;if(c=s==e.Page_Select_Gem?Actor.soul:UserBag.ins().getBagGoodsCountById(0,l),c>=h&&(this.tab.selectedIndex==s&&this.roleSelect.showRedPoint(n,!0),s!=e.Page_Select_Gem?this["redPoint"+s].visible=!0:Actor.level>=GlobalConfig.StoneOpenConfig[0].openLv&&(this["redPoint"+s].visible=!0),this["redPoint"+s].visible)){var u=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole());this["redPoint"+s].visible=UserForge.ins().isMaxForge(u,s)}}}var p=Weapons.ins().checkRedPoint(n);this.redPoint3.visible||(this.redPoint3.visible=p),this.tab.selectedIndex==e.Page_Select_Weapon&&this.roleSelect.showRedPoint(n,p)}},e.prototype.getForgeLv=function(t,i,s){switch(t){case e.Page_Select_Boost:return i.getEquipByIndex(s).strengthen;case e.Page_Select_ZhuLing:return i.getEquipByIndex(s).zhuling;case e.Page_Select_Gem:return i.getEquipByIndex(s).gem;case 3:return i.getEquipByIndex(s).tupo}},e.prototype.getForgeIdOrCount=function(t,i,s){switch(t){case e.Page_Select_Boost:var n=UserForge.ins().getEnhanceCostConfigByLv(i+1);if(n)return s?n.stoneId:n.stoneNum;break;case e.Page_Select_ZhuLing:var o=UserForge.ins().getZhulingCostConfigByLv(i+1);if(o)return s?o.itemId:o.count;break;case e.Page_Select_Gem:var a=UserForge.ins().getStoneLevelCostConfigByLv(i+1);if(a)return s?a.stoneId:a.soulNum;break;case 3:var r=UserForge.ins().getTupoCostConfigByLv(i+1);if(r)return s?r.itemId:r.count}return 0},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole(),!0)},e.prototype.setRoleId=function(t,e){this.boostPanel.curRole=this.gemPanel.curRole=this.zhulingPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex,e),this.redPointEx()},e}(BaseEuiView);ForgeWin.Page_Select_Boost=0,ForgeWin.Page_Select_Gem=1,ForgeWin.Page_Select_ZhuLing=2,ForgeWin.Page_Select_Weapon=3,ForgeWin.PageSelectSamsara=4,__reflect(ForgeWin.prototype,"ForgeWin"),ViewManager.ins().reg(ForgeWin,LayerManager.UI_Main);var ForgeZhulingPanel=function(t){function e(){var e=t.call(this)||this;return e.isMax=!1,e.isAutoUp=!1,e.itemNum=0,e.startPos=0,e.name="铸造",e.curPanel=ForgeWin.Page_Select_ZhuLing,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>")},e.prototype.open=function(t,e){this.addTouchEvent(this.upGradeBtn,this.onTouch),this.addTouchEvent(this.upGradeBtn0,this.onTouch),this.addTouchEvent(this.getItemTxt,this.onGetItem),this.observe(UserBag.ins().postItemAdd,this.setCount),this.observe(UserBag.ins().postItemChange,this.setCount),this.observe(Actor.ins().postLevelChange,this.setView),this.isMax=!1,this.setView(),this.createBitMapNum(),this.changeData(t,e),this.stopAutoUp()},e.prototype.close=function(){this.removeTouchEvent(this.upGradeBtn,this.onTouch),this.removeTouchEvent(this.getItemTxt,this.onGetItem),this.removeObserve(),this.stopAutoUp()},e.prototype.setView=function(){},e.prototype.onTouch=function(t){switch(t.target){case this.upGradeBtn:this.costConfig&&this.itemNum>=this.costConfig.count?(UserZhuLing.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.ins().playEffect(SoundUtil.FORGE)):UserWarn.ins().setBuyGoodsWarn(this.costConfig.itemId,1);break;case this.upGradeBtn0:this.isAutoUp||(this.isAutoUp=!0,this.startPos=this.pos,this.autoUpStarEx()||(UserTips.ins().showTips("材料不足"),this.isAutoUp=!1))}},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,this.upGradeBtn0&&(this.upGradeBtn0.label="一键精炼"),TimerManager.ins().remove(this.autoUpStar,this)},e.prototype.autoUpBack=function(t){if(this.isAutoUp){var e=UserForge.ins().getZhulingCostConfigByLv(this.lv+1);if(!e)return;if(this.itemNum<e.count)return this.isAutoUp=!1,void UserTips.ins().showTips("材料不足");if(this.startPos==t)return void(this.isAutoUp=!1);UserZhuLing.ins().sendUpGrade(this.curRole,t)}},e.prototype.autoUpStarEx=function(){var t=UserForge.ins().getZhulingCostConfigByLv(this.lv+1);return t?this.itemNum>=t.count?(UserZhuLing.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.ins().playEffect(SoundUtil.FORGE),!0):(this.upGradeBtn0.label="一键精炼",!1):!1},e.prototype.autoUpStar=function(){this.costConfig&&this.itemNum>=this.costConfig.count?(UserZhuLing.ins().sendUpGrade(this.curRole,this.pos),7==this.pos&&(this.isAutoUp=!1,this.upGradeBtn0.label="一键精炼",TimerManager.ins().remove(this.autoUpStar,this))):(this.isAutoUp=!1,this.upGradeBtn0.label="一键精炼",TimerManager.ins().remove(this.autoUpStar,this))},e.prototype.onGetItem=function(t){UserWarn.ins().setBuyGoodsWarn(this.costConfig.itemId,1)},e.prototype.changeData=function(t,e,i){void 0===i&&(i=!0),this.pos=t,this.lv=e;var s=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel);this.setAttrData(s),this.setPower(),this.setSlectedInfo(),this.updateLevel(),i&&this.setCount()},e.prototype.setPower=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=t.getForgeTotalPower(this.curPanel),this.powerPanel.setPower(this._totalPower)},e.prototype.createBitMapNum=function(){for(var t=0;t<UserEquip.FOEGE_MAX;t++)this["level_"+t].text="0"},e.prototype.updateLevel=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.equipsData,i=0;i<UserEquip.FOEGE_MAX;i++){var s=e[i].zhuling;this["level_"+i].visible=s>0?!0:!1,this["level_"+i].text=s.toString()}},e.prototype.setSlectedInfo=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=(t.equipsData,0);e<UserEquip.FOEGE_MAX;e++)this["selectIcon"+e].visible=e==this.pos,0==e||(this["line"+(e-1)].source=e<=this.pos?"jinglianline1":"jinglianline0",this["jinglianed"+e].visible=e<=this.pos?!0:!1)},e.prototype.setAttrData=function(t){var e,i=t.length;t.sort(AttributeData.sortAttribute);for(var s=0;4>s;s++)this["attr"+s].text=i>s?AttributeData.getAttStrByType(t[s],.5):"";if(e=UserForge.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel)){this.isMax=!1;var n=UserForge.ins().countAllBoostAttr(this.curRole,this.curPanel,this.pos,!0);n.sort(AttributeData.sortAttribute);for(var s=0;4>s;s++){var o="";if(i>s){var a=t[s];o=this.getAttrByType(n,a)}this["arrow"+s].visible=o.length>0,this["addattr"+s].text=o}}else{this.isMax=!0;for(var s=0;4>s;s++)this["arrow"+s].visible=!1,this["addattr"+s].text=""}this.maxDesc.visible=this.isMax,this.upInfo.visible=!this.isMax},e.prototype.setCount=function(){this.costConfig=UserForge.ins().getZhulingCostConfigByLv(this.lv+1);var t=0;this.costConfig&&(this.itemNum=UserBag.ins().getBagGoodsCountById(0,this.costConfig.itemId),t=this.costConfig.count);var e="";e=this.itemNum>=t?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t+"</font> ")},e.prototype.getAttrByType=function(t,e){for(var i=t.length,s=0;i>s;s++)if(t[s].type==e.type&&t[s].value!=e.value)return""+t[s].value;return""},e}(BaseEuiView);__reflect(ForgeZhulingPanel.prototype,"ForgeZhulingPanel");var Friends=function(t){function e(){var e=t.call(this)||this;return e.friendsList=new eui.ArrayCollection,e.recentList=new eui.ArrayCollection,e.appList=new eui.ArrayCollection,e.blackList=new eui.ArrayCollection,e.isDebug=!1,e.chatList={},e.newMsg={},e.currentId=-1,e.sysId=PackageID.Friends,e.regNetMsg(7,e.doAddListMsg),e.regNetMsg(3,e.doAppList),e.regNetMsg(4,e.doBlackList),e.regNetMsg(13,e.doChatAdd),e.regNetMsg(1,e.doFriendsList),e.regNetMsg(10,e.doFriendsStateChange),e.regNetMsg(14,e.doRecentChatList),e.regNetMsg(9,e.doRemoveListMsg),e.regNetMsg(2,e.doRencentList),e.regNetMsg(11,e.doSendResult),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendAppList()},e.prototype.log=function(t){this.isDebug&&debug.log(t)},e.prototype.sendFriendsList=function(){var t=this.getBytes(1);this.sendToServer(t)},e.prototype.sendRecentList=function(){var t=this.getBytes(2);this.sendToServer(t)},e.prototype.sendAppList=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.sendBlackList=function(){var t=this.getBytes(4);this.sendToServer(t)},e.prototype.sendAddFriend=function(t,e){if(Actor.level<GlobalConfig.FriendLimit.chatLv)return void UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+"级开放功能");if(-1!=this.indexOfBlackList(t))return void UserTips.ins().showTips("不能添加黑名单中的用户为好友");for(var i=0,s=this.blackList.source;i<s.length;i++){var n=s[i],o=n;if(o.name==e)return void UserTips.ins().showTips("不能添加黑名单中的用户为好友")}var a=this.getBytes(5);a.writeInt(t),a.writeString(e),this.sendToServer(a)},e.prototype.sendAddBlackList=function(t,e){if(Actor.level<GlobalConfig.FriendLimit.chatLv)return void UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+"级开放功能");var i=this.getBytes(6);i.writeInt(t),i.writeString(e),this.sendToServer(i)},e.prototype.sendAgreeApp=function(t,e){var i=this.getBytes(8);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendDelete=function(t,e){var i=this.getBytes(9);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendChat=function(t,e){var i=this.getBytes(11);i.writeInt(t),i.writeString(e),this.sendToServer(i),ReportData.getIns().reportChat(e,1)},e.prototype.sendRecentChat=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e.prototype.doFriendsList=function(t){this.paserList(1,t),this.postFriendChange()},e.prototype.doRencentList=function(t){this.paserList(2,t),this.postFriendChange()},e.prototype.doAppList=function(t){this.paserList(3,t),this.postFriendChange()},e.prototype.doBlackList=function(t){this.paserList(4,t),this.postFriendChange()},e.prototype.doAddListMsg=function(t){var e=t.readByte();this.paserAddData(e,t),this.postFriendChange()},e.prototype.doRemoveListMsg=function(t){var e=t.readByte(),i=t.readInt();this.paserRemoveData(e,i),this.postFriendChange()},e.prototype.doFriendsStateChange=function(t){var e=t.readUnsignedInt(),i=t.readByte();this.paserOnlineChange(e,i),this.postFriendChange()},e.prototype.doSendResult=function(t){var e=t.readByte();if(0!=e){var i=t.readUnsignedInt(),s=t.readInt(),n=t.readString();this.paserChatMsg(1,i,s,n)}this.postFriendChange()},e.prototype.doChatAdd=function(t){var e=t.readUnsignedInt(),i=t.readInt(),s=t.readString();this.paserChatMsg(0,e,i,s),this.postFriendChange()},e.prototype.doRecentChatList=function(t){this.paserRecentMsg(t),this.postFriendChange()},e.prototype.postFriendChange=function(){return 0},e.prototype.postCloseFriendList=function(){},e.prototype.postChatToFriend=function(t){return t},e.prototype.indexOfFriendList=function(t){for(var e=-1,i=0;i<this.friendsList.length;i++){var s=this.friendsList.getItemAt(i);if(s&&s.id==t){e=i;break}}return e},e.prototype.indexOfBlackList=function(t){for(var e=-1,i=0;i<this.blackList.length;i++){var s=this.blackList.getItemAt(i);if(s&&s.id==t){e=i;break}}return e},e.prototype.indexOfRecentList=function(t){for(var e=-1,i=0;i<this.recentList.length;i++){var s=this.recentList.getItemAt(i);if(s&&s.id==t){e=i;break}}return e},e.prototype.indexOfAppList=function(t){for(var e=-1,i=0;i<this.appList.length;i++){var s=this.appList.getItemAt(i);if(s&&s.id==t){e=i;break}}return e},e.prototype.sortRecentList=function(){},e.prototype.sortFriendList=function(){var t=this.friendsList.source,e=[],i=[];t.forEach(function(t){1==t.online?e.push(t):i.push(t)}),e.sort(function(t,e){return e.zs!=t.zs?e.zs-t.zs:e.lv-t.lv}),i.sort(function(t,e){return e.zs!=t.zs?e.zs-t.zs:e.lv-t.lv}),t=e.concat(i),this.friendsList.replaceAll(t)},e.prototype.sortAppList=function(){var t=this.appList.source;t.sort(function(t,e){return e.power-t.power}),this.appList.replaceAll(t)},e.prototype.paserList=function(t,i){for(var s=[],n=i.readInt(),o=0;n>o;o++){var a=new FriendData(t,i);s.push(a)}switch(t){case 1:this.friendsList.source=s,this.sortFriendList();break;case 2:this.recentList.source=s,this.sortRecentList();break;case 3:s.length>e.MAXNUM&&(s=s.slice(s.length-e.MAXNUM,e.MAXNUM)),this.appList.source=s,this.sortAppList();break;case 4:this.blackList.replaceAll(s)}},e.prototype.paserAddData=function(t,e){var i=new FriendData(t,e),s=["friendsList","recentList","appList","blackList"][t-1],n=-1;1==t?n=this.indexOfFriendList(i.id):2==t?n=this.indexOfRecentList(i.id):3==t?n=this.indexOfAppList(i.id):4==t&&(n=this.indexOfBlackList(i.id),this.paserRemoveData(1,i.id),this.paserRemoveData(2,i.id),this.paserRemoveData(3,i.id),Chat.ins().removeChatWithId(i.id),Guild.ins().removeMsgWithId(i.id)),this[s]&&2!=t&&(n>-1?this[s].replaceItemAt(i,n):this[s].addItemAt(i,0)),this.sortFriendList(),this.sortRecentList(),this.sortAppList()},e.prototype.paserRemoveData=function(t,e){var i=["friendsList","recentList","appList","blackList"][t-1],s=-1;this[i]&&(1==t?(s=this.indexOfFriendList(e),this.newMsg[e]=!1):2==t?(s=this.indexOfRecentList(e),this.newMsg[e]=!1):3==t?s=this.indexOfAppList(e):4==t&&(s=this.indexOfBlackList(e)),s>-1&&this[i].removeItemAt(s))},e.prototype.paserOnlineChange=function(t,e){var i=this.indexOfFriendList(t);if(i>-1){var s=this.friendsList.getItemAt(i);s.id==t&&(s.online=e,0==s.online?this.friendsList.replaceItemAt(s,i):(this.friendsList.removeItemAt(i),this.friendsList.addItemAt(s,0)))}},e.prototype.paserChatMsg=function(t,e,i,s){if(!(this.indexOfBlackList(e)>-1)){0==t&&this.currentId!=e&&(this.newMsg[e]=!0);var n=this.indexOfFriendList(e);if(n>-1){var o=this.friendsList.getItemAt(n),a=new FriendData(1);a.id=Actor.actorID,a.job=SubRoles.ins().getSubRoleByIndex(0).job,a.sex=SubRoles.ins().getSubRoleByIndex(0).sex,a.power=Actor.power,0==t?o.addChat(new ChatData(o,a,i,s)):1==t&&o.addChat(new ChatData(a,o,i,s))}var r=this.indexOfRecentList(e);if(r>-1){var o=this.recentList.getItemAt(r);o.lastMsg=s,this.recentList.removeItemAt(r),this.recentList.addItemAt(o,0)}else if(n>-1){var o=this.friendsList.getItemAt(n);o.lastMsg=s,this.recentList.addItemAt(o,0)}else debug.log("有一个不属于最近联系人和好友列表的私聊"),debug.log("id:"+e+"/ msg:"+s);this.sortFriendList(),this.sortRecentList(),this.sortAppList()}},e.prototype.paserRecentMsg=function(t){for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte(),n=t.readInt(),o=t.readString();if(-1==this.indexOfBlackList(s))for(var a=0;i<this.recentList.length;i++){var r=this.recentList.getItemAt(a);if(r.id==s){r.lastMsg=o,r.offLineSec=n;break}}}},e.prototype.getFriendIndex=function(t){for(var e=0;;){var i=this.friendsList.getItemAt(e);if(!i)return-1;if(i.id==t)return e;e++}},e}(BaseSystem);Friends.MAXNUM=100,Friends.CLOSS_FRIEND_LIST_BUTTON="CLOSS_FRIEND_LIST_BUTTON",__reflect(Friends.prototype,"Friends");var GameSystem;!function(t){t.friends=Friends.ins.bind(Friends)}(GameSystem||(GameSystem={}));var FriendData=function(){function t(t,e){if(void 0===e&&(e=null),this._offLineSec=0,this.appDate=0,this._redPoint=!1,this.msgMaxLen=50,this.lastMsg="",this.lastMsgDate=0,this.lastMsgData_local=0,this.type=t,e)switch(this.id=e.readUnsignedInt(),this.name=e.readString(),this.guildName=e.readString(),this.online=e.readUnsignedByte(),this.job=e.readUnsignedByte(),this.sex=e.readUnsignedByte(),this.vip=e.readUnsignedByte(),this.lv=e.readUnsignedByte(),this.zs=e.readUnsignedByte(),this.monthCard=e.readUnsignedByte(),this.ladderLv=e.readUnsignedByte(),this.isLastWeekLadder=e.readUnsignedByte(),this.power=e.readInt(),t){case 1:var i=e.readInt()||0;this.offLineSec=i;break;case 2:this.lastMsgDate=e.readInt();break;case 3:var s=e.readInt()||0;this.appDate=s;break;case 4:}}return Object.defineProperty(t.prototype,"offLineSec",{get:function(){var t=0;try{var e=Date.now()/1e3;t=Math.floor(this._offLineSec+(e-this._updateTs))}catch(i){debug.log("取好友离线时间失败"),debug.log(i)}return t},set:function(t){this._offLineSec=t,this._updateTs=Date.now()/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"redPoint",{get:function(){var t=this._redPoint;return this._redPoint=!1,t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"acMsg",{get:function(){return null==Friends.ins().chatList[this.id]&&(Friends.ins().chatList[this.id]=new eui.ArrayCollection),Friends.ins().chatList[this.id]},set:function(t){Friends.ins().chatList[this.id]=t},enumerable:!0,configurable:!0}),t.prototype.addChat=function(t){var e=this;if(this._redPoint=t.fromActor.id==this.id,0==this.acMsg.length)t.showDate=!0;else for(var i=e.acMsg.length-1;i>=0;--i){var s=e.acMsg.getItemAt(i);if(t.date-s.date>300&&(t.showDate=!0),s.showDate)break}e.acMsg.addItem(t),e.lastMsgData_local=Date.now(),e.acMsg.length>this.msgMaxLen&&e.acMsg.removeItemAt(0)},t}();__reflect(FriendData.prototype,"FriendData");var ChatData=function(){function t(t,e,i,s){this.date=0,this.msg="",this.showDate=!1,this.fromActor=t,this.toActor=e,this.date=i,this.msg=s}return Object.defineProperty(t.prototype,"dateStr",{get:function(){var t="";return t=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(this.date)/1e3,8),t=StringUtils.complementByChar(t,16)},enumerable:!0,configurable:!0}),t}();__reflect(ChatData.prototype,"ChatData");var BlackListWin=function(t){function e(){var e=t.call(this)||this;return e.name="黑名单",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.list_blackList.itemRenderer=BlackListItemRender,this.list_blackList.dataProvider=Friends.ins().blackList,this.observe(Friends.ins().postFriendChange,this.updateView),Friends.ins().sendBlackList(),this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeObserve(),WatcherUtil.removeFromArrayCollection(this.list_blackList.dataProvider),this.list_blackList.dataProvider=null},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e.prototype.updateView=function(){this.label_num.text=+this.list_blackList.dataProvider.length+"/"+GlobalConfig.FriendLimit.blacklistLen,this.group_pingbi&&(this.group_pingbi.visible=0==Friends.ins().blackList.length)},e}(BaseComponent);__reflect(BlackListWin.prototype,"BlackListWin"),ViewManager.ins().reg(BlackListWin,LayerManager.UI_Main);var FriendBgWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsWinSkin",e.isTopLevel=!0,e.tab.dataProvider=e.viewStack,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0,s=0;0==i&&(s=t[1]?t[1]:0),this.viewStack.selectedIndex=i,this.addTouchEvent(this.btnClose,this.onTap),this.addChangeEvent(this.tab,this.onTap),Friends.ins().sendFriendsList(),this.friendPanel.open(),this.friendChatPanel.open(s),this.friendAppListPanel.open(),this.blackListPanel.open(),this.mailPanel.open(),this.updateRedPoint(),this.observe(Friends.ins().postFriendChange,this.updateRedPoint),this.observe(UserMail.ins().postMailDetail,this.updateRedPoint),this.observe(UserMail.ins().postMailData,this.updateRedPoint)},e.prototype.close=function(){t.prototype.close.call(this),this.friendPanel.close(),this.friendChatPanel.close(),this.friendAppListPanel.close(),this.blackListPanel.close(),this.mailPanel.close(),WatcherUtil.removeFromArrayCollection(this.tab.dataProvider)},e.prototype.onShowdMailPoint=function(){UserMail.ins().mailData?this.mailRedPoint.visible=UserMail.ins().getUnreadMail()>0:this.mailRedPoint.visible=!1},e.prototype.updateRedPoint=function(){this.applyRedPoint.visible=Friends.ins().appList.length>0,this.onShowdMailPoint()},e.prototype.onTap=function(t){switch(t.target){case this.btnClose:ViewManager.ins().close(this);break;case this.tab:}},e}(BaseEuiView);__reflect(FriendBgWin.prototype,"FriendBgWin"),ViewManager.ins().reg(FriendBgWin,LayerManager.UI_Popup);var FriendChatPanel=function(t){function e(){var e=t.call(this)||this;return e.name="最近",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.listFriend.dataProvider=null,this.listChat.dataProvider=null,this.listFriend.itemRenderer=FriendHeadItem,this.listChat.itemRenderer=FriendsChatItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Friends.ins().sendFriendsList(),Friends.ins().sendRecentList(),this.listFriend.selectedIndex=t[0]?t[0]:0,this.addChangeEvent(this.listFriend,this.onChange),this.addTouchEvent(this.btnSend,this.onTap),this.observe(Friends.ins().postFriendChange,this.updateView),this.observe(Friends.ins().postChatToFriend,this.updateView),this.addTouchEvent(this.listChat,this.onListTap),this.onChange()},e.prototype.close=function(){this.removeTouchEvent(this.listChat,this.onListTap),WatcherUtil.removeFromArrayCollection(this.listChat.dataProvider),WatcherUtil.removeFromArrayCollection(this.listFriend.dataProvider),this.listFriend.dataProvider=null,this.listChat.dataProvider=null,this.$onClose()},e.prototype.onListTap=function(){var t=this.listChat.selectedItem;if(t&&t instanceof ChatData){var e=t.msg;e&&e.indexOf("|E:")>=0&&this.onLink(e)}},e.prototype.onLink=function(t){var e=t.indexOf("|E:");t=t.slice(e+3,Number.MAX_VALUE);var i;if(t.indexOf(",")>=0?i=t.split(","):t.indexOf("*")>=0&&(i=t.split("*")),i&&!(i.length<=0))switch(i[0]){case"1":UserFb.ins().sendEnterTFRoom(+i[1])}},e.prototype.updateView=function(){this.listFriend.dataProvider=Friends.ins().friendsList;var t=this.listFriend.selectedItem;if(t){this.currentState="chat";var e=Friends.ins().indexOfFriendList(t.id);this.listChat.dataProvider&&WatcherUtil.removeFromArrayCollection(this.listChat.dataProvider),this.listChat.dataProvider=Friends.ins().friendsList.getItemAt(e).acMsg,this.scroller.viewport.validateNow(),this.scroller.viewport.contentHeight>this.scroller.height&&(this.scroller.viewport.scrollV=this.scroller.viewport.contentHeight-this.scroller.height)}else this.currentState="nofriend"},e.prototype.onChange=function(){this.updateView();var t=this.listFriend.selectedItem;t&&Friends.ins().sendRecentChat(t.id)},e.prototype.onTap=function(t){switch(t.target){case this.btnSend:var e=this.listFriend.selectedItem;if(!e)return;Actor.level<GlobalConfig.FriendLimit.chatLv?UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+"级开放"):this.input.text.length>GlobalConfig.FriendLimit.contentLimit?UserTips.ins().showTips("你说的话太长了"):this.input.text.length>0&&(Friends.ins().sendChat(e.id,this.input.text+""),this.input.text="")}},e}(BaseComponent);__reflect(FriendChatPanel.prototype,"FriendChatPanel");var FriendListPanel=function(t){function e(){var e=t.call(this)||this;return e.name="好友",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=FriendListItemRender},e.prototype.open=function(){this.updateView(),this.readMsg(),this.addTouchEvent(this.btnFind,this.onTap)},e.prototype.readMsg=function(){for(var t in Friends.ins().newMsg)Friends.ins().newMsg[t]=!1},e.prototype.close=function(){this.$onClose(),WatcherUtil.removeFromArrayCollection(this.list.dataProvider),this.list.dataProvider=null},e.prototype.updateView=function(){this.list.dataProvider=Friends.ins().friendsList},e.prototype.onTap=function(t){switch(t.target){case this.btnFind:ViewManager.ins().open(FriendsAddWin)}},e}(BaseComponent);__reflect(FriendListPanel.prototype,"FriendListPanel");var FriendsAddWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsAddWinSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn_add,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.shadow,this.onTap),this.observe(Friends.ins().postFriendChange,this.updateView)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn0:ViewManager.ins().close(e);break;case this.btn_add:if(this.editText_name.text==Actor.myName)return void UserTips.ins().showTips("不能添加自己为好友");""!=this.editText_name.text&&Friends.ins().sendAddFriend(0,this.editText_name.text),ViewManager.ins().close(e);break;case this.shadow:ViewManager.ins().close(this)}},e.prototype.updateView=function(){},e}(BaseEuiView);__reflect(FriendsAddWin.prototype,"FriendsAddWin"),ViewManager.ins().reg(FriendsAddWin,LayerManager.UI_Popup);var FriendsAppListWin=function(t){function e(){var e=t.call(this)||this;return e.panelList=[],e.name="申请",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn_allNo,this.onTap),this.addTouchEvent(this.btn_allYes,this.onTap),this.list_appList.itemRenderer=FriendAppListItemRender,this.list_appList.dataProvider=Friends.ins().appList,this.observe(Friends.ins().postFriendChange,this.updateView),this.updateView(),this.panelList=Friends.ins().appList.source},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.btn_allNo,this.onTap),this.removeTouchEvent(this.btn_allYes,this.onTap),this.removeObserve(),WatcherUtil.removeFromArrayCollection(this.list_appList.dataProvider),this.list_appList.dataProvider=null},e.prototype.onTap=function(t){switch(t.target){case this.btn_allYes:for(var e=0,i=this.panelList;e<i.length;e++){var s=i[e];Friends.ins().sendAgreeApp(s.id,1)}break;case this.btn_allNo:for(var n=0,o=this.panelList;n<o.length;n++){var s=o[n];Friends.ins().sendAgreeApp(s.id,0)}}},e.prototype.updateView=function(){this.group_shenqing&&(this.group_shenqing.visible=0==Friends.ins().appList.length)},e}(BaseComponent);__reflect(FriendsAppListWin.prototype,"FriendsAppListWin"),ViewManager.ins().reg(FriendsAppListWin,LayerManager.UI_Main);var FriendsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="FriendsWinSkin",this.isTopLevel=!0;var e=["最近","联系人"];this.tab.dataProvider=new eui.ArrayCollection(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.btn_add,this.onTap),this.addTouchEvent(this.btn_AskList,this.onTap),this.addTouchEvent(this.btn_blackList,this.onTap),this.addTouchEvent(this.btn_send,this.onTap),this.addChangeEvent(this.tab,this.onTap),this.list_recent.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onRecentListItemTap,this),this.tab.selectedIndex=0,this.onTabBarTouchTap(),this.list_friends.itemRenderer=FriendListItemRender,this.list_friends.dataProvider=Friends.ins().friendsList,this.list_recent.itemRenderer=FriendRecentListItemRender,this.list_recent.dataProvider=Friends.ins().recentList,this.list_chat.itemRenderer=FriendsChatItemRender,this.editText_input.maxChars=GlobalConfig.FriendLimit.contentLimit,this.observe(Friends.ins().postFriendChange,this.updateView),this.observe(Friends.ins().postChatToFriend,this.openChatGroup),Friends.ins().sendFriendsList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.btn_add,this.onTap),this.removeTouchEvent(this.btn_AskList,this.onTap),this.removeTouchEvent(this.btn_blackList,this.onTap),this.removeTouchEvent(this.btn_send,this.onTap),this.list_recent.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onRecentListItemTap,this),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:Friends.ins().currentId=-1,ViewManager.ins().close(e);break;case this.btn_add:ViewManager.ins().open(FriendsAddWin);break;case this.btn_AskList:ViewManager.ins().open(FriendsAppListWin);break;case this.btn_blackList:ViewManager.ins().open(BlackListWin);break;case this.btn_send:Actor.level<GlobalConfig.FriendLimit.chatLv?UserTips.ins().showTips(GlobalConfig.FriendLimit.chatLv+"级开放"):this.editText_input.text.length>GlobalConfig.FriendLimit.contentLimit?UserTips.ins().showTips("你说的话太长了"):this.editText_input.text.length>0&&(Friends.ins().sendChat(this.talkWith,this.editText_input.text+""),this.editText_input.text="",TimerManager.ins().doTimer(200,1,this.scrollerChatToBottom,this));break;case this.tab:this.onTabBarTouchTap()}},e.prototype.onRecentListItemTap=function(t){var e=t.item;e&&e.id&&this.openChatGroup(e.id)},e.prototype.onTabBarTouchTap=function(){this.group_recent&&(this.group_recent.visible=!1),this.group_lianxiren&&(this.group_lianxiren.visible=!1),this.list_friends.selectedIndex=-1,this.group_0.visible=this.group_1.visible=this.group_chat.visible=!1;var t=this["group_"+this.tab.selectedIndex];t&&(this.img_title.visible=!0,t.visible=!0,this.updateView(),0==this.tab.selectedIndex&&Friends.ins().recentList.refresh(),this.updateTipTab(),Friends.ins().sortRecentList(),Friends.ins().sortFriendList()),Friends.ins().postCloseFriendList()},e.prototype.openChatGroup=function(t){this.group_recent&&(this.group_recent.visible=!1),this.group_lianxiren&&(this.group_lianxiren.visible=!1);
var e=Friends.ins().indexOfFriendList(t);if(e>-1){Friends.ins().currentId=t;var i=Friends.ins().friendsList.getItemAt(e);this.group_0.visible=this.group_1.visible=this.img_title.visible=!1,this.group_chat.visible=!0,this.talkWith=i.id,this.label_name.text=i.name,this.list_chat.dataProvider=Friends.ins().friendsList.getItemAt(e).acMsg,delete Friends.ins().newMsg[t]}egret.setTimeout(this.scrollerChatToBottom,this,200)},e.prototype.scrollerChatToBottom=function(){this.scroller_chat&&(this.scroller_chat.viewport.scrollV=Math.max(this.scroller_chat.viewport.contentHeight-this.scroller_chat.height,0))},e.prototype.updateView=function(t){if(void 0===t&&(t=null),this.label_num.text=this.list_friends.dataProvider.length+"/"+GlobalConfig.FriendLimit.friendListLen,this.redPoint0&&(this.redPoint0.visible=!1,Object.keys(Friends.ins().newMsg).length>0))for(var e in Friends.ins().newMsg){var i=Friends.ins().newMsg[e];if(1==i){this.redPoint0.visible=!0;break}}this.redPoint1.visible=Friends.ins().appList.length>0,this.redPoint2&&(this.redPoint2.visible=Friends.ins().appList.length>0),this.group_chat.visible&&egret.setTimeout(this.scrollerChatToBottom,this,200),this.updateTipTab()},e.prototype.updateTipTab=function(){this.group_recent&&0==this.tab.selectedIndex&&(this.group_recent.visible=0==Friends.ins().recentList.length),this.group_lianxiren&&1==this.tab.selectedIndex&&(this.group_lianxiren.visible=0==Friends.ins().friendsList.length)},e}(BaseEuiView);__reflect(FriendsWin.prototype,"FriendsWin"),ViewManager.ins().reg(FriendsWin,LayerManager.UI_Main);var BlackListItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().sendDelete(4,e.data.id),t.stopPropagation(),t.stopImmediatePropagation()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.img_userIcon.source="head_"+e.job+e.sex+(1==e.online?"":"b"),this.labelGuild.text=e.guildName,this.headBg.source=ChatListItemRenderer.HEAD_BG[e.sex]},e}(BaseItemRender);__reflect(BlackListItemRender.prototype,"BlackListItemRender");var FriendAppListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsAppListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().sendAgreeApp(e.data.id,1),t.stopPropagation(),t.stopImmediatePropagation()},this),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().sendAgreeApp(e.data.id,0),t.stopPropagation(),t.stopImmediatePropagation()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.img_userIcon.source="head_"+e.job+e.sex,this.labelGuild.text=e.guildName;var i=Math.floor(e.vip/10)||0,s=e.vip%10||0;i?this.img_vipLv0.source="xvip_4"+i+"_png":this.img_vipLv0.source=null,this.img_vipLv1.source="xvip_4"+s+"_png",this.headBg.source=ChatListItemRenderer.HEAD_BG[e.sex]},e}(BaseItemRender);__reflect(FriendAppListItemRender.prototype,"FriendAppListItemRender");var FriendHeadItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.label_name.text=t.name,this.img_userIcon.source="head_"+t.job+t.sex,this.imgBg.source=ChatListItemRenderer.HEAD_BG[t.sex]},e}(BaseItemRender);__reflect(FriendHeadItem.prototype,"FriendHeadItem");var FriendListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(e)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().postChatToFriend(e.data.id),t.stopPropagation(),t.stopImmediatePropagation()},this),this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){WarnWin.show("确定要删除<font color='#f3311e'>"+e.data.name+"</font>吗?",function(){Friends.ins().sendDelete(1,e.data.id)},e),t.stopPropagation(),t.stopImmediatePropagation()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.label_power.text="战斗力:"+e.power,this.labelGuild.text=e.guildName,1==e.online?(this.label_lastLogin.text="在线",this.label_lastLogin.textColor=2610714):(this.label_lastLogin.text=DateUtils.getFormatBySecond(Math.max(e.offLineSec,60),4),this.label_lastLogin.textColor=16579836),this.img_userIcon.source="head_"+e.job+e.sex+(1==e.online?"":"b"),this.headBg.source=ChatListItemRenderer.HEAD_BG[e.sex]},e}(BaseItemRender);__reflect(FriendListItemRender.prototype,"FriendListItemRender");var FriendRecentListItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.label_lastChat.text=e.lastMsg,this.img_userIcon.source="head_"+e.job+e.sex+(1==e.online?"":"b"),this.redPoint.visible=Friends.ins().newMsg[e.id]},e}(BaseItemRender);__reflect(FriendRecentListItemRender.prototype,"FriendRecentListItemRender");var FriendsChatItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.label_msg&&(this.label_msg.wordWrap=!1)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i,s=this.data;s.fromActor.id==Actor.actorID?(s.fromActor.name=Actor.myName,e="0xE5B613",i="0xE5B613"):(e=s.fromActor.sex?"0xBC8787":"0x318ECE",i="0xFFFFFF"),this.label_date.text=s.dateStr;var n="|C:"+e+"&T:"+s.fromActor.name+"|:|C:"+i+"&T:"+s.msg+"|";this.label_msg.textFlow=TextFlowMaker.generateTextFlow1(n)},e}(BaseItemRender);__reflect(FriendsChatItemRender.prototype,"FriendsChatItemRender");var UserFuLi=function(t){function e(){var e=t.call(this)||this;return e.playNum=0,e.boxOn=0,e.addCoefficient=1,e.exp=0,e.boxInfo=0,e.baoji=0,e.isOpen=[],e.sysId=PackageID.moneyTree,e.regNetMsg(1,e.doMoneyTreeInfo),e.regNetMsg(2,e.doPalyBack),e.regNetMsg(3,e.doGetRewardBack),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendPlayYaoYao=function(){this.sendBaseProto(2)},e.prototype.sendGetCaseReward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.doMoneyTreeInfo=function(t){this.playNum=t.readUnsignedShort(),this.boxOn=t.readUnsignedShort(),this.addCoefficient=t.readUnsignedShort(),this.exp=t.readUnsignedShort(),this.boxInfo=t.readInt(),this.postMoneyInfoChange()},e.prototype.postMoneyInfoChange=function(t){return void 0===t&&(t=null),t},e.prototype.doPalyBack=function(t){this.playNum=t.readUnsignedShort(),this.boxOn=t.readUnsignedShort(),this.addCoefficient=t.readUnsignedShort(),this.exp=t.readUnsignedShort(),this.baoji=t.readUnsignedShort(),this.postMoneyInfoChange([!1,this.baoji])},e.prototype.doGetRewardBack=function(t){this.boxInfo=t.readInt(),this.postMoneyInfoChange()},e.prototype.getOrderByIndex=function(t){void 0===t&&(t=0);var e=this.boxInfo>>t&1;return e},e.prototype.getNowCoefficientinfo=function(t){void 0===t&&(t=0);var e=GlobalConfig.CashCowAmplitudeConfig;for(var i in e)if(e[i].level==this.addCoefficient+t)return e[i];return null},Object.defineProperty(e.prototype,"maxNum",{get:function(){return this.checkCashCowBasicLenght(10)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cruMaxNum",{get:function(){return this.checkCashCowBasicLenght()},enumerable:!0,configurable:!0}),e.prototype.getIndexCost=function(){var t=GlobalConfig.CashCowBasicConfig;for(var e in t)if(t[e].time==this.boxOn+1)return t[e];return null},e.prototype.getBoxInfoByIndex=function(t){var e=GlobalConfig.CashCowBoxConfig;for(var i in e)if(e[i].index==t)return e[i];return null},e.prototype.checkCashCowBasicLenght=function(t){void 0===t&&(t=0),0==t&&(t=UserVip.ins().lv);var e=GlobalConfig.CashCowLimitConfig;for(var i in e)if(e[i].vip==t)return e[i].maxTime;return 0},e.prototype.checkBoxIsCanget=function(t){var e=this.getBoxInfoByIndex(t);return e.time<=this.playNum&&this.getOrderByIndex(t-1)<=0?!0:!1},e}(BaseSystem);__reflect(UserFuLi.prototype,"UserFuLi");var GameSystem;!function(t){t.userfuli=UserFuLi.ins.bind(UserFuLi)}(GameSystem||(GameSystem={}));var FuliWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FuliMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.iconList.itemRenderer=FuliActBtnRenderer,this.allPanels=[DailyCheckInPanel,SevenDayLogWin,MonthCardWin,FranchiseWin,GameNoticePanle,CdkeyPanle],this.panels=[],this.arrList=new eui.ArrayCollection},e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.listBar,this.onChange),this.addChangeEvent(this.iconList,this.onClickMenu),this.observe(Notice.ins().postGameNotice,this.updateMenuList),this.observe(DailyCheckIn.ins().postCheckInData,this.updateMenuList),this.observe(Activity.ins().postSevendayAwardCallback,this.updateMenuList),this.observe(Recharge.ins().postFranchiseInfo,this.updateMenuList),this.observe(Activity.ins().postActivityIsGetAwards,this.updateMenuList),this.index=0,e[0]&&(this.index=e[0],this.initFunc=function(){if(t.allPanels[t.index]!=t.panels[t.index]){var e=t.allPanels.length-t.panels.length;e=e>0?e:0,t.index-=e}}),this.updateMenuList([!0],e[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel.close()},e.prototype.updateMenuList=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._datas=[],this.panels=this.allPanels;var i,s=!1,n=0;t&&t[0]&&(t[0][0]&&(s=t[0][0]),t[0][1]&&(n=t[0][1]));for(var o in GlobalConfig.WelfareConfig)i=GlobalConfig.WelfareConfig[o],this._datas.push(i);var a=!0;for(var r in GlobalConfig.LoginRewardsConfig){var h=GlobalConfig.LoginRewardsConfig[r];if(0==(Activity.ins().isAwards>>h.day&1)){a=!1;break}}if(a){this.panels=[];for(var r=0,l=0;r<this._datas.length;l++)i=this._datas[r],1==i.id?this._datas.splice(r,1):(this.panels.push(this.allPanels[l]),r++)}this.arrList.replaceAll(this._datas),this.initFunc&&(this.initFunc(),this.initFunc=null),this.iconList.selectedIndex=this.index,this.iconList.dataProvider=this.arrList,s&&(this.curId=this.iconList.selectedIndex,this.updateDetail(t[1])),this.btnNum=this._datas.length,this.onChange()},e.prototype.onClickMenu=function(t){SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.curId=this.iconList.selectedIndex,this.index=this.curId,this.updateDetail()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onChange=function(){this.iconList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.iconList.scrollH>88*(this.iconList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.btnNum<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1)},e.prototype.updateDetail=function(t){this.cruPanel&&(DisplayUtils.removeFromParent(this.cruPanel),this.cruPanel.close()),this.cruPanel=new this.panels[this.curId],UserFuLi.ins().isOpen[this.curId]||(UserFuLi.ins().isOpen[this.curId]=!0,this.updateMenuList()),this.cruPanel&&(this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.top=0,this.cruPanel.bottom=0,this.info.addChild(this.cruPanel),this.cruPanel.open(t))},e}(BaseEuiView);__reflect(FuliWin.prototype,"FuliWin"),ViewManager.ins().reg(FuliWin,LayerManager.UI_Main);var CdkeyPanle=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDkeySkin",e.input.maxChars=28,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sendBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sendBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sendBtn:CDKey.ins().sendCdkey(this.input.text)}},e}(BaseView);__reflect(CdkeyPanle.prototype,"CdkeyPanle");var MapGridNode=function(){function t(){}return Object.defineProperty(t.prototype,"hidden",{get:function(){return(2&this.flags)>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"walkable",{get:function(){return(1&this.flags)>0},enumerable:!0,configurable:!0}),t}();MapGridNode.FLAG_WALKABLE=32768,MapGridNode.FLAG_HIDDEN=16384,__reflect(MapGridNode.prototype,"MapGridNode");var GameNoticePanle=function(t){function e(){var e=t.call(this)||this;return e.skinName="gameNoticeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.HelpInfoConfig[5].text,s=i.split("_");this.title.textFlow=TextFlowMaker.generateTextFlow(s[0]),this.desc.textFlow=TextFlowMaker.generateTextFlow(window.game_notice||s[1]),UserFuLi.ins().isOpenNotice&&(UserFuLi.ins().isOpenNotice=!1,Notice.ins().postGameNotice(),Notice.ins().setNoticeOPen()),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.update=function(){this._cfg=GlobalConfig.WelfareConfig[4];var t=Activity.ins().getActivityDataById(this._cfg.activityId?this._cfg.activityId:0);t?(this.updataReward.visible=!0,this.suerBtn.enabled=t.canReward(),this.redPoint.visible=this.suerBtn.enabled,t.getRewardStateById(1)==Activity.Geted?(this.yilingqu.visible=!0,this.suerBtn.visible=!1):(this.yilingqu.visible=!1,this.suerBtn.visible=!0),this._collect||(this._collect=new ArrayCollection,this.reward.dataProvider=this._collect),this._collect.source=GlobalConfig.ActivityType1Config[this._cfg.activityId][1].rewards):this.updataReward.visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.removeTouchEvent(this,this.onTouch)},e.prototype.onTouch=function(t){switch(t.target){case this.suerBtn:Activity.ins().sendReward(this._cfg.activityId,1)}},e}(BaseView);__reflect(GameNoticePanle.prototype,"GameNoticePanle");var MoneyTreeBoxWin=function(t){function e(){var e=t.call(this)||this;return e.dataList=[],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MoneyTreeBoxSkin",this.list.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.index=t[0];var i=UserFuLi.ins().getBoxInfoByIndex(this.index);this.desc.text="今日使用摇钱树"+i.time+"次，可额外获得：",this.creatRewardList(i.box),this.list.dataProvider=new eui.ArrayCollection(this.dataList),this.sure.enabled=UserFuLi.ins().playNum>=i.time},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap)},e.prototype.creatRewardList=function(t){for(var e,i=0;3>i;i++)this.dataList[i]?e=this.dataList[i]:(e=new RewardData,e.type=0,e.id=1,this.dataList.push(e)),e.count=t[i]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn1:ViewManager.ins().close(this);break;case this.sure:UserFuLi.ins().sendGetCaseReward(this.index),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(MoneyTreeBoxWin.prototype,"MoneyTreeBoxWin"),ViewManager.ins().reg(MoneyTreeBoxWin,LayerManager.UI_Main);var MoneyTreePanel=function(t){function e(){var e=t.call(this)||this;return e.posY=180,e.skinName="MoneyTreeSkin",e.mc1=new MovieClip,e.mc1.x=140,e.mc1.y=46,e.mc2=new MovieClip,e.mc2.x=222,e.mc2.y=46,e.mc3=new MovieClip,e.mc3.x=370,e.mc3.y=46,e.expMc=new MovieClip,e.expMc.x=376,e.expMc.y=e.posY,e.addChildAt(e.expMc,3),e.baojiMc=new MovieClip,e.baojiMc.x=207,e.baojiMc.y=270,e.movieExp=new MovieClip,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Notice.ins().postGameNotice,this.refushInfo),this.observe(UserFuLi.ins().postMoneyInfoChange,this.refushInfo),this.addTouchEvent(this.goUpBtn,this.onTap),this.addTouchEvent(this.image1,this.onTap),this.addTouchEvent(this.image2,this.onTap),this.addTouchEvent(this.image3,this.onTap),this.addTouchEvent(this.descBtn,this.onTap),this.addTouchEvent(this.expMc,this.onTap),this.refushInfo([!0]),this.expMc.playFile(RES_DIR_EFF+"moneytreebar")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.goUpBtn,this.onTap),this.removeTouchEvent(this.image1,this.onTap),this.removeTouchEvent(this.image2,this.onTap),this.removeTouchEvent(this.image3,this.onTap),this.removeTouchEvent(this.descBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goUpBtn:if(UserFuLi.ins().playNum>=UserFuLi.ins().cruMaxNum)return void(UserVip.ins().lv>=10?UserTips.ins().showTips("|C:0xf3311e&T:今日次数已用完|"):UserTips.ins().showTips("|C:0xf3311e&T:提高vip等级，获得更多次数|"));if(Actor.yb>=this.costNum)return void UserFuLi.ins().sendPlayYaoYao();UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");break;case this.image1:ViewManager.ins().open(MoneyTreeBoxWin,1);break;case this.image2:ViewManager.ins().open(MoneyTreeBoxWin,2);break;case this.image3:ViewManager.ins().open(MoneyTreeBoxWin,3);break;case this.descBtn:ViewManager.ins().open(ZsBossRuleSpeak,6);break;case this.expMc:ViewManager.ins().open(ZsBossRuleSpeak,6)}},e.prototype.refushInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=!1,s=0,n=UserFuLi.ins(),o=n.getIndexCost(),a=(n.getNowCoefficientinfo(),n.getNowCoefficientinfo(1));t&&t[0]&&(t[0][0]&&(i=t[0][0]),t[0][1]&&(s=t[0][1])),n.playNum==n.maxNum||(this.costNum=o.yuanbao),i||this.moveExpMc();var r=0;null==a||(r=60*(.5-n.exp/a.needExp)),this.refushBoxInfo(),s>1&&(this.baojiMc.playFile(RES_DIR_EFF+"moneytreecrit",1),this.addChild(this.baojiMc))},e.prototype.moveExpMc=function(){this.movieExp.x=189,this.movieExp.y=257,this.movieExp.playFile(RES_DIR_EFF+"moneytreeexp",1),this.addChild(this.movieExp);var t=egret.Tween.get(this.movieExp);t.to({y:180,x:376},420)},e.prototype.refushBoxInfo=function(){for(var t=UserFuLi.ins(),e=1;4>e;e++){var i=this["mc"+e];t.checkBoxIsCanget(e)?this.playEffect(i):i.parent&&DisplayUtils.removeFromParent(i)}},e.prototype.playEffect=function(t){t.playFile(RES_DIR_EFF+"taskBox",100),this.addChild(t)},e}(BaseView);MoneyTreePanel.MAXNUMBER=50,__reflect(MoneyTreePanel.prototype,"MoneyTreePanel");var NextDayLoginWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="nextDaySkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sendBtn,this.onTap),this.item.data={count:500,id:2,type:0}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sendBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sendBtn:1==Activity.ins().nextDayState?Activity.ins().sendNextDayReward():2==Activity.ins().nextDayState?UserTips.ins().showTips(StringUtils.addColor("已领取奖励",15937822)):UserTips.ins().showTips(StringUtils.addColor("创建角色第二天才能领取奖励",15937822))}},e}(BaseView);__reflect(NextDayLoginWin.prototype,"NextDayLoginWin");var GameGuider=function(){function t(){}return t.taskGuidance=function(e,i){var s;switch(i){case 0:s=GlobalConfig.DailyConfig[e];break;case 1:s=UserTask.ins().getAchieveConfById(e),Hint.ins().postAchievementBef(s)}switch(s.control){case GuideType.OpenWin:100082==e&&"LimitTaskView"==String(s.controlTarget[0])?UserTask.ins().limitTaskEndTime>0&&0!=UserTask.ins().limitTaskState&&UserTask.ins().limitTaskEndTime>0&&UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)>0?t.guidance(s.controlTarget[0],s.controlTarget[1]):t.guidance("RoleWin",1):t.guidance(s.controlTarget[0],s.controlTarget[1]);break;case GuideType.ChallengeBoss:if(this.challengeBoss(),1==i){var n=s;Hint.ins().postKillBoss(n)}break;case GuideType.ArtifactGuide:Artifact.ins().setGuide();break;case GuideType.AtkMonster:RoleAI.ins().stop();var o=s.controlTarget[0],a=UserFb.ins().rPos[o][0].x*GameMap.CELL_SIZE,r=UserFb.ins().rPos[o][0].y*GameMap.CELL_SIZE;this.tempMainRole=EntityManager.ins().getNoDieRole(),GameMap.moveEntity(this.tempMainRole,a,r),TimerManager.ins().doTimer(500,0,this.guideFun,this);break;case GuideType.AutoPk:UserFb.ins().setAutoPk();break;case GuideType.KillDeer:break;case GuideType.GuideFb:if(Encounter.ins().isEncounter())return void UserTips.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|");if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);UserFb.ins().sendIntoGuideFb(s.controlTarget[1])}},t.guideFun=function(){this.tempMainRole.action==EntityAction.STAND&&(RoleAI.ins().start(),TimerManager.ins().remove(this.guideFun,this))},t.guidance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=-1!=t[1]?t[1]:null;ViewManager.ins().open(t[0],i,t[2])},t.challengeBoss=function(t){return UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void(UserFb.ins().currentEnergy>=UserFb.ins().energy&&(t&&"function"==typeof t&&t(),UserFb.ins().autoPk()))},t.startTaskEffect=function(){this.taskEffect||(this.taskEffect=new TaskEffectView),this.taskEffect.start()},t.stopTaskEffect=function(){this.taskEffect&&this.taskEffect.stop()},t}();__reflect(GameGuider.prototype,"GameGuider");var GuideType;!function(t){t[t.OpenWin=1]="OpenWin",t[t.ChallengeBoss=2]="ChallengeBoss",t[t.ArtifactGuide=3]="ArtifactGuide",t[t.AtkMonster=4]="AtkMonster",t[t.AutoPk=5]="AutoPk",t[t.KillDeer=6]="KillDeer",t[t.GuideFb=7]="GuideFb"}(GuideType||(GuideType={}));var DamageTypes;!function(t){t[t.BLANK=0]="BLANK",t[t.HIT=1]="HIT",t[t.CRIT=2]="CRIT",t[t.Dodge=4]="Dodge",t[t.Lucky=8]="Lucky",t[t.Heji=16]="Heji",t[t.Fujia=32]="Fujia",t[t.Deter=64]="Deter",t[t.Lianji=128]="Lianji",t[t.ZhuiMing=256]="ZhuiMing",t[t.ZhiMing=512]="ZhiMing"}(DamageTypes||(DamageTypes={}));var EffectType;!function(t){t[t.Targer=0]="Targer",t[t.Self=1]="Self",t[t.Ballistic=2]="Ballistic",t[t.AnyAngle=3]="AnyAngle",t[t.Sustain=4]="Sustain",t[t.Range=5]="Range",t[t.Sector=6]="Sector"}(EffectType||(EffectType={}));var UTFMsgByJson=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.decode=function(t){return JSON.parse(t)},e.prototype.encode=function(t){return JSON.stringify(t)},e}(UTFMsg);__reflect(UTFMsgByJson.prototype,"UTFMsgByJson");var EquipAddAttrType;!function(t){t[t.EquipSlotType_Weapon=0]="EquipSlotType_Weapon",t[t.EquipSlotType_Helmet=1]="EquipSlotType_Helmet",t[t.EquipSlotType_Coat=2]="EquipSlotType_Coat",t[t.EquipSlotType_Necklace=3]="EquipSlotType_Necklace",t[t.EquipSlotType_Accessory1=4]="EquipSlotType_Accessory1",t[t.EquipSlotType_Accessory2=5]="EquipSlotType_Accessory2",t[t.EquipSlotType_Ring1=6]="EquipSlotType_Ring1",t[t.EquipSlotType_Ring2=7]="EquipSlotType_Ring2",t[t.EquipSlotType_Dzi=8]="EquipSlotType_Dzi",t[t.EquipSlotType_Max=9]="EquipSlotType_Max"}(EquipAddAttrType||(EquipAddAttrType={}));var ExAttributeType;!function(t){t[t.eatReflectProbability=0]="eatReflectProbability",t[t.eatReflectRate=1]="eatReflectRate",t[t.eatIgnoreReflect=2]="eatIgnoreReflect",t[t.eatGodBlessProbability=3]="eatGodBlessProbability",t[t.eatGodBlessRate=4]="eatGodBlessRate",t[t.eatDeathCurseProbability=5]="eatDeathCurseProbability",t[t.eatDeathCurseDamageIncrease=6]="eatDeathCurseDamageIncrease",t[t.eatDeathCurseTime=7]="eatDeathCurseTime",t[t.eatAllCrit=8]="eatAllCrit",t[t.eatAllCritTime=9]="eatAllCritTime",t[t.eatBeHitTimesDodge=10]="eatBeHitTimesDodge",t[t.eatAttackTimesCrit=11]="eatAttackTimesCrit",t[t.eatAttackAddHpProbability=12]="eatAttackAddHpProbability",t[t.eatAttackAddHpValue=13]="eatAttackAddHpValue",t[t.eatAddToWarriorDamageInc=14]="eatAddToWarriorDamageInc",t[t.eatAddToMageDamageInc=15]="eatAddToMageDamageInc",t[t.eatAddToTaoistDamageInc=16]="eatAddToTaoistDamageInc",t[t.eatSubWarriorDamageInc=17]="eatSubWarriorDamageInc",t[t.eatSubMageDamageInc=18]="eatSubMageDamageInc",t[t.eatSubTaoistDamageInc=19]="eatSubTaoistDamageInc",t[t.eatTogetherHitFree=20]="eatTogetherHitFree",t[t.eatTogetherHitMonDamageInc=21]="eatTogetherHitMonDamageInc",t[t.eatTogetherHitRoleDamageInc=22]="eatTogetherHitRoleDamageInc",t[t.eatTogetherHitCdSub=23]="eatTogetherHitCdSub",t[t.eatAdditionalHarm=24]="eatAdditionalHarm",t[t.eatReductionHarm=25]="eatReductionHarm",t[t.eatMiss=26]="eatMiss",t[t.eatBaseSkillExArg=27]="eatBaseSkillExArg",t[t.eatMultipleCrit=28]="eatMultipleCrit",t[t.eatMultipleCritCoeff=29]="eatMultipleCritCoeff",t[t.atMultipleCritHurt=30]="atMultipleCritHurt",t[t.eatAddWarriorDamageInc=31]="eatAddWarriorDamageInc",t[t.eatAddMageDamageInc=32]="eatAddMageDamageInc",t[t.eatAddTaoistDamageInc=33]="eatAddTaoistDamageInc",t[t.eatMultipleCritTime=34]="eatMultipleCritTime",t[t.eatAttackAddHpTime=35]="eatAttackAddHpTime",t[t.eatStunTime=36]="eatStunTime",t[t.eatGodPowerCd=37]="eatGodPowerCd",t[t.eatGodPowerProbability=38]="eatGodPowerProbability",t[t.eatGodPowerDamageIncrease=39]="eatGodPowerDamageIncrease",t[t.eatHpLtAddBuffId=40]="eatHpLtAddBuffId",t[t.eatHpLtAddBuffCd=41]="eatHpLtAddBuffCd",t[t.eatHit=42]="eatHit",t[t.eatSkillVamirePro=43]="eatSkillVamirePro",t[t.eatWarriorPeakDamageInc=44]="eatWarriorPeakDamageInc",t[t.eatMagePeakDamageInc=45]="eatMagePeakDamageInc",t[t.eatTaoistPeakDamageInc=46]="eatTaoistPeakDamageInc",t[t.eatPetSkillLevel=47]="eatPetSkillLevel",t[t.eatPetAttackInc=48]="eatPetAttackInc",t[t.eatSkillAddArgA=49]="eatSkillAddArgA",t[t.eatSkillAddArgB=50]="eatSkillAddArgB",t[t.eatResistDeathCd=51]="eatResistDeathCd",t[t.eatResistDeathPro=52]="eatResistDeathPro",t[t.eatResistDeathRate=53]="eatResistDeathRate",t[t.eatCritHpLt=54]="eatCritHpLt",t[t.eatCritHpLtAddDamage=55]="eatCritHpLtAddDamage",t[t.eatMiJiKNHpPer=56]="eatMiJiKNHpPer",t[t.eatMiJiKNHpSubPer=57]="eatMiJiKNHpSubPer",t[t.eatMiJiKNDamPer=58]="eatMiJiKNDamPer",t[t.eatMiJiZHDamPer=59]="eatMiJiZHDamPer",t[t.eatMiJiZHTime=60]="eatMiJiZHTime",t[t.eatMiJiBQHpTime=61]="eatMiJiBQHpTime",t[t.eatMiJiBQHpPer=62]="eatMiJiBQHpPer",t[t.eatMiJiBQBuffId=63]="eatMiJiBQBuffId",t[t.eatCount=64]="eatCount"}(ExAttributeType||(ExAttributeType={}));var SkillEffType;!function(t){t[t.AdditionalDamage=1]="AdditionalDamage",t[t.AddBlood=2]="AddBlood",t[t.AdditionalAttributes=3]="AdditionalAttributes",t[t.AdditionalState=4]="AdditionalState",t[t.Summon=5]="Summon",t[t.Other=6]="Other",t[t.HostAddAttributes=7]="HostAddAttributes",t[t.SuperArmor=8]="SuperArmor"}(SkillEffType||(SkillEffType={}));var GameLogic=function(t){function e(){var e=t.call(this)||this;e.MONSTER_RADIUS=2,e.MONSTER_LEN=2*e.MONSTER_RADIUS+1,e.currHandle=0,e.currAttackHandle=0,e.rPosindex=[],e.runTime=0,e.guanqiaId=0,e.sysId=PackageID.Default,e.regNetMsg(2,e.postSubRoleChange),e.regNetMsg(3,e.postEnterMap),e.regNetMsg(4,e.postCreateOtherEntity),e.regNetMsg(5,e.doGoldChange),e.regNetMsg(8,e.doSubRoleAtt),e.regNetMsg(9,e.postHpChange),e.regNetMsg(10,e.doRemoveEntity),e.regNetMsg(11,e.doMoveEntity),e.regNetMsg(12,e.doStopMoveEntity),e.regNetMsg(13,e.doSyncPos),e.regNetMsg(15,e.postMpChange),e.regNetMsg(17,e.doTips),e.regNetMsg(18,e.doFirstRegister),e.regNetMsg(20,e.doDieNotice),e.regNetMsg(21,e.postGuildChange),e.regNetMsg(22,e.postRename),e.regNetMsg(24,e.postOtherAttChange),e.regNetMsg(25,e.doPaoPao),e.regNetMsg(26,e.doNeiGongChange),e.regNetMsg(27,e.doSubRoleExtAtt),e.regNetMsg(31,e.doFindPath),e.regNetMsg(32,e.doBloodNumShow),e.regNetMsg(33,e.doChangeTarget),e.regNetMsg(34,e.doAddMonsterConfig),e.regNetMsg(35,e.doZeroInit),e.regNetMsg(36,e.postChangeCamp),KeyboardUtils.ins().addKeyDown(e.test,e),e.radiusMap=[];for(var i=2*e.MONSTER_RADIUS+1,s=0;i>s;s++)e.radiusMap[s]=[];return e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendHeartbeat()},e.prototype.sendNewRole=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendHeartbeat=function(){var t=this;if(!this.heartBeatTimer){var e=function(){var e=t.getBytes(255);t.sendToServer(e)};this.heartBeatTimer=new egret.Timer(6e4),this.heartBeatTimer.addEventListener(egret.TimerEvent.TIMER,e,this),this.heartBeatTimer.start()}},e.prototype.sendGMCommad=function(t){var e=this.getBytes(0);e.writeString(t),this.sendToServer(e)},e.prototype.postSubRoleChange=function(t){SubRoles.ins().doSubRole(t)},e.prototype.postEnterMap=function(t){window.showGame(),DropHelp.clearDrop(),GameMap.parser(t),RoleAI.ins().clear(),MonsterSpeak.ins().clear(),MineFight.ins().stop(),MineData.ins().removeAll(),EntityManager.ins().removeAll(),EntityHideBody.ins().changeScene(),EntityShowMgr.ins().changeScene(),TimerManager.ins().removeAll(GameMap),TimerManager.ins().removeAll(SkillEffPlayer),TimerManager.ins().remove(this.shakeMapView,this),this.gamescene.map.clearAllLayer(),this.gamescene.map.changeMap(),0==GameMap.fubenID?(UserFb.ins().pkGqboss=!1,Encounter.ins().willBossID&&(Encounter.ins().createBoss(),PlayFun.ins().upDataWillBoss(Encounter.ins().willBossID))):GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||ViewManager.ins().closeTopLevel(),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetPlayerBigBloodPanel),GuildWar.ins().getModel().clearGuildWarList(),UserBoss.ins().clearWorldBossList(),TargetListCC.ins().clear(),SoundUtil.WINDOW_OPEN||GameMap.lastFbId==GameMap.fubenID&&!GameMap.fubenID||SoundUtil.ins().playEffect(SoundUtil.SCENE)},e.prototype.postCreateOtherEntity=function(t){var e=t.readShort();t.readDouble();t.position-=10;var i,s;return e==EntityType.Monster||e==EntityType.CollectionMonst?(i=new EntityModel,i.parser(t)):e==EntityType.Role?(i=new Role,i.parserBase(t),i.parserOtherRole(t,!0)):e==EntityType.LadderPlayer?(i=new Role,i.parserBase(t),i.parserOtherRole(t,!1),GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS&&(i.masterHandle=i.handle)):e==EntityType.DropItem&&(i=new CharModel,i.parserBase(t),i.parserItemData(t)),i?(EntityHideBody.ins().onCreateEntity(i),s=this.createEntityByModel(i),this.afterCreateOtherEntity(e,i,s),i):!1},e.prototype.afterCreateOtherEntity=function(t,e,i){t==EntityType.Monster||t==EntityType.CollectionMonst?(GameMap.fbType==UserFb.FB_TYPE_EXP&&(UserFb.ins().expMonterCount+=1),GameMap.sceneInMine()&&i&&(i.visible=!1),MonsterSpeak.ins().trigger(e.configID,SpeakType.appear)):t==EntityType.Role?((GuildWar.ins().getModel().checkinAppoint()||GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS)&&(e.guildID!=Guild.ins().guildID?GuildWar.ins().getModel().changecanPlayList(e.masterHandle):GuildWar.ins().getModel().setMyGuildNum(e.masterHandle)),MineFight.ins().isFighting&&i&&(i.visible=!1)):t==EntityType.LadderPlayer&&GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS&&(UserFb.ins().guideBossPlayerId=e.configID,UserFb.ins().guideBossPlayerJob=e.job,UserFb.ins().guideBossPlayerSex=e.sex,UserFb.ins().guideBossPlayerName=e.name,0==UserFb.ins().guideBossKill&&UserBoss.ins().postBelongChange(e.masterHandle))
},e.prototype.doGoldChange=function(t){var e=t.readShort();if(1==e){var i=t.readNumber();Actor.ins().postGoldChange(i)}else if(4==e){var s=t.readNumber();Actor.ins().postSoulChange(s)}else if(7==e)Actor.ins().postFeatsChange(t.readNumber());else if(9==e){var n=Actor.runeShatter;Actor.runeShatter=t.readNumber(),Actor.runeShatter-n>0&&UserTips.ins().showTips("获得|C:0x35e62d&T:战纹精华x"+(Actor.runeShatter-n)+"|"),this.postRuneShatter()}else if(e==MoneyConst.piece){var o=Actor.runeExchange;Actor.runeExchange=t.readNumber(),o&&Actor.runeExchange-o>0&&UserTips.ins().showTips("|C:0xFFD700&T:获得"+(Actor.runeExchange-o)+RewardData.getCurrencyName(MoneyConst.piece)+"|"),this.postRuneExchange()}else if(11==e){var a=t.readNumber();Actor.ins().postUpdateTogeatter(a,1)}else if(12==e){var a=t.readNumber();Actor.ins().postUpdateTogeatter(a,2)}else if(e==MoneyConst.weiWang)Actor.ins().postWeiWang(t.readNumber());else if(e==MoneyConst.chip)Actor.ins().postChip(t.readNumber());else{var r=t.readNumber();Actor.ins().postYbChange(r)}},e.prototype.postRuneShatter=function(){},e.prototype.postRuneExchange=function(){},e.prototype.postLevelBarChange=function(t){return t},e.prototype.postAdjustMapPos=function(){},e.prototype.doSubRoleAtt=function(t){SubRoles.ins().doSubRoleAtt(t)},e.prototype.postHpChange=function(t){var e=t.readDouble(),i=t.readDouble(),s=EntityManager.ins().getEntityByHandle(e);if(!s)return!1;var n=s.infoModel,o=n.getAtt(AttributeType.atHp);return n.setAtt(AttributeType.atHp,i),s.updateBlood(),0>=i?(RoleAI.ins().checkPlayDieSound(s),DropHelp.tempDropPoint.x=Math.floor(s.x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y=Math.floor(s.y/GameMap.CELL_SIZE)):n.type!=EntityType.Role||s.nameVisible||s.showNameAndHp(),[s,i,o]},e.prototype.doNeiGongChange=function(t){var e=t.readDouble(),i=t.readDouble(),s=EntityManager.ins().getEntityByHandle(e);s&&s.infoModel&&(s.infoModel.setAtt(AttributeType.cruNeiGong,i),s.updateNeiGong())},e.prototype.postEntityHpChange=function(t,e,i,s){if((e&&e.team==Team.My||t&&t.team==Team.My)&&i==DamageTypes.Heji){var n=ViewManager.ins().getView(GameSceneView);DisplayUtils.shakeItHeji(n.map,30,700)}return[t,e,i,s]},e.prototype.doRemoveEntity=function(t){var i=t.readDouble(),s=EntityManager.ins().getEntityByHandle(i);if(s){if(s instanceof CharRole)s.infoModel&&s.infoModel.type==EntityType.LadderPlayer?GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS?0==UserFb.ins().guideBossKill?(this.removeEntity(i),UserBoss.ins().postBelongChange(Actor.handle,i,s.infoModel.name),UserFb.ins().guideBossKill+=1):(EntityManager.ins().removeByHandle(i,!1,!0),s.onDead(function(){s.deadDelay()}),GuideUtils.ins().clickOut(),UserFb.ins().guideBossKill+=1,UserBoss.ins().weixieList.length=0,UserBoss.ins().postHasAttackChange(0)):this.removeEntity(i):EntityManager.ins().removeByHandle(i);else if(s instanceof CharItem2)EntityManager.ins().removeByHandle(i);else{if(this.removeEntity(i),s&&s.team!=Team.My){var n=!1,o=EntityManager.ins().screeningTargetByPos(s,!0);if(o&&0!=o.length){if(GameMap.fbType==UserFb.FB_TYPE_GUILD_WAR){var a=EntityManager.ins().getEntityByHandle(e.ins().currAttackHandle);(!a||a.infoModel.getAtt(AttributeType.atHp)<=0)&&(n=!0)}}else n=!0;if(n)for(var r=EntityManager.ins().getEntityByTeam(Team.My),h=0,l=r;h<l.length;h++){var a=l[h];a.action!=EntityAction.RUN&&a.playAction(EntityAction.STAND)}if((GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN)&&s.parent){var c=s.parent.localToGlobal(s.x,s.y);UserFb.ins().postExpFly(c,50)}}GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS&&(UserBoss.ins().attHandle=0,UserFb.ins().guideBossKill&&(UserBoss.ins().winner=Actor.myName),GuideUtils.ins().clickOut(),e.ins().postChangeTarget(0))}this.postRemoveEntity(i,s)}},e.prototype.postRemoveEntity=function(t,e){return[t,e]},e.prototype.removeEntity=function(t){var e=EntityManager.ins().getEntityByHandle(t);e&&e.infoModel.getAtt(AttributeType.atHp)<=0?(EntityManager.ins().removeByHandle(t,!1,!0),e.playAction(EntityAction.HIT),e.stopMove(),e.onDead(function(){e.deadDelay();var t=egret.Tween.get(e.dieTweenObj);t.wait(1e3).to({alpha:0},1e3).call(function(){DisplayUtils.removeFromParent(e)})})):EntityManager.ins().removeByHandle(t,!0,!0)},e.prototype.doMoveEntity=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var s=t.readInt(),n=t.readInt();(i.x!=s||i.y!=n)&&GameMap.moveEntity(i,s,n,!0)}},e.prototype.doStopMoveEntity=function(t){var i=t.readDouble(),s=EntityManager.ins().getEntityByHandle(i);s&&(s.stopMove(),s.infoModel.getAtt(AttributeType.atHp)>0&&s.playAction(EntityAction.STAND),s.x=t.readInt(),s.y=t.readInt(),s==EntityManager.ins().getNoDieRole()&&e.ins().postMoveCamera())},e.prototype.doSyncPos=function(t){var e=this,i=t.readDouble(),s=EntityManager.ins().getEntityByHandle(i),n=t.readShort();if(s){s.stopMove();var o=void 0;switch(n){case 0:s.playAction(EntityAction.STAND),s.x=t.readInt(),s.y=t.readInt(),s.isMy&&egret.callLater(function(){e.postMoveCamera()},this);break;case 1:s.playAction(EntityAction.RUN),o=egret.Tween.get(s.moveTweenObj),o.to({x:t.readInt(),y:t.readInt()},t.readInt()).call(function(){s.playAction(EntityAction.STAND)});break;case 2:s.playAction(EntityAction.STAND),o=egret.Tween.get(s.moveTweenObj),o.to({x:t.readInt(),y:t.readInt()},t.readInt())}}},e.prototype.postMoveCamera=function(){var t=EntityManager.ins().getNoDieRole();return t?[t.x,t.y,GameMap.mapID,GameMap.fubenID]:!1},e.prototype.sendSyncServerTime=function(){this.sendBaseProto(14)},e.prototype.postMpChange=function(t){var e,i=t.readDouble(),s=t.readDouble(),n=EntityManager.ins().getEntityByHandle(i);return n&&(e=n.infoModel,e.setAtt(AttributeType.atMp,s)),e},e.prototype.postExpMc=function(t){return t},e.prototype.doTips=function(t){var e=GlobalConfig.ServerTips[t.readInt()].tips;UserTips.ins().showTips(e)},e.prototype.doFirstRegister=function(t){ViewManager.ins().open(WelcomeWin)},e.prototype.doDieNotice=function(t){},e.prototype.postGuildChange=function(t){return[t.readInt(),t.readString()]},e.prototype.postOtherAttChange=function(t){var e=EntityManager.ins().getEntityByHandle(t.readDouble());if(!e||!e.infoModel)return!1;for(var i=t.readShort(),s=0;i>s;s++)e.infoModel.setAtt(t.readInt(),t.readDouble());return e},e.prototype.doPaoPao=function(t){var e=t.readDouble(),i=t.readInt(),s=EntityManager.ins().getEntityByHandle(e);s&&s.addPaoPao(i)},e.prototype.doSubRoleExtAtt=function(t){SubRoles.ins().doSubRoleExtAtt(t)},e.prototype.sendRename=function(t){var e=this.getBytes(22);e.writeString(t),this.sendToServer(e)},e.prototype.postRename=function(t){var e=t.readByte();0==e?(GameSocket.ins().close(),ViewManager.ins().close(RenameWin),alert("改名成功，重新登录即可生效！"),location.reload()):RoleMgr.ins().showErrorTips(e)},e.prototype.postChangeAttrPoint=function(t){var e=this.getBytes(25);e.writeDouble(t),this.sendToServer(e),GuildWar.ins().getModel().clickTime=1},e.prototype.doFindPath=function(t){var e=t.readDouble(),i=Math.floor(t.readInt()/GameMap.CELL_SIZE),s=Math.floor(t.readInt()/GameMap.CELL_SIZE),n=t.readInt(),o=t.readInt(),a=Math.floor(n/GameMap.CELL_SIZE),r=Math.floor(o/GameMap.CELL_SIZE),h=GameMap.getPatch(i,s,a,r);this.sendFindPathToServer(e,h)},e.prototype.sendFindPathToServer=function(t,e,i){void 0===i&&(i=!0);var s=e?e.length:0,n=this.getBytes(31);n.writeDouble(t),n.writeInt(s);for(var o=0;s>o;o++)0!=o||i?(n.writeInt(e[o].nX*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1)),n.writeInt(e[o].nY*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1))):(n.writeInt(e[o].nX),n.writeInt(e[o].nY));this.sendToServer(n)},e.prototype.doBloodNumShow=function(t){var i=t.readDouble(),s=t.readDouble(),n=-1*Math.ceil(t.readDouble()),o=t.readUnsignedInt(),a=EntityManager.ins().getEntityByHandle(s);if(a){var r=EntityManager.ins().getEntityByHandle(i);r&&(r.team==Team.My&&r.infoModel.type==EntityType.Monster&&0>n||(r instanceof CharRole||r.shakeIt(),e.ins().postEntityHpChange(r,a,o,n)))}},e.prototype.doChangeTarget=function(t){var i=t.readDouble(),s=t.readDouble();this.postAllAtkTarget(i,s);var n=EntityManager.ins().getEntityByHandle(i);if(n&&n.infoModel&&n.infoModel.masterHandle==Actor.handle&&this.postAtkTarget(s),CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena)return void TargetListCC.ins().postTargetList(i,s);if(GameMap.fbType!=UserFb.FB_TYPE_GUILD_WAR&&GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_GUIDEBOSS||0==s)return void(n&&n==EntityManager.ins().getNoDieRole()&&(e.ins().currAttackHandle=s));var o=EntityManager.ins().getEntityByHandle(s);if(o&&o.infoModel&&o.infoModel.masterHandle>0){var a=EntityManager.ins().getEntityByHandle(i);if(a&&a.infoModel&&a.infoModel.masterHandle==Actor.handle&&this.postChangeTarget(o.infoModel.masterHandle),a&&a.infoModel){var r=EntityManager.ins().getMasterList(a.infoModel.masterHandle);if(o.infoModel.masterHandle==Actor.handle&&r){for(var h in r)r[h]instanceof CharRole&&r[h].setNameTxtColor(ColorUtil.ROLENAME_COLOR_YELLOW);if(GameMap.fbType==UserFb.FB_TYPE_GUIDEBOSS){if(UserBoss.ins().weixieList[0]!=a.infoModel.masterHandle){var l=a.infoModel.name;if(a.infoModel.type==EntityType.LadderPlayer){var c=l.split("\n");l=c[1]?c[1]:c[0],l=StringUtils.replaceStr(l,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"")}UserFb.ins().guideBossKill&&UserTips.ins().showCenterTips("受到|C:0x35e62d&T:"+l+"|玩家的攻击，点击右边头像进行反击")}UserBoss.ins().weixieList.length=0,UserBoss.ins().changeWeiXieList(a.infoModel.masterHandle),UserBoss.ins().postHasAttackChange(0)}}}}else{var u=EntityManager.ins().getEntityByHandle(i);u&&u.infoModel&&u.infoModel.masterHandle==Actor.handle&&(o&&o.infoModel?this.postChangeTarget(o.infoModel.masterHandle):this.postChangeTarget(0))}},e.prototype.postChangeTarget=function(t){e.ins().currAttackHandle=t},e.prototype.postAtkTarget=function(t){this.currHandle=t},e.prototype.postAllAtkTarget=function(t,e){return[t,e]},e.prototype.test=function(t){if(t==Keyboard.BRACE_R,t==Keyboard.BRACE_L,t==Keyboard.BACKSLASH,t==Keyboard.I,t==Keyboard.O,t==Keyboard.P,t==Keyboard.SPACE&&RoleAI.ins().togglePause(),t==Keyboard.BACK_QUOTE&&this.gamescene&&(this.gamescene.input.visible=!0),t==Keyboard.ENTER&&this.gamescene&&this.gamescene.input.visible&&this.sendGMCommad(this.gamescene.input.text),t==Keyboard.KC_TAB)if(ViewManager.ins().isShow(WarnWin))ViewManager.ins().close(WarnWin);else{var e=Version.BUILD_NUMBER;e+="\n开服天数:"+(GameServer.serverOpenDay+1)+"天",e+="\n服务器id:"+LocationProperty.srvid,WarnWin.show(e,null,this,null,null,"sure")}},e.prototype.startPkBoss=function(){UserFb.ins().autoPk()},e.prototype.createEntityByModel=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=EntityManager.ins().createEntity(t,e);return s&&this.addEntity(s),s},e.prototype.addEntity=function(t){t instanceof CharRole?(t.showBlood(t.isMy||t.team==Team.WillEntity),t.showNeigong(t.isMy),t.dir=t.x>=GameMap.MAX_WIDTH>>1?6:2):t instanceof CharMonster&&GlobalConfig.MonstersConfig[t.infoModel.configID]&&3==GlobalConfig.MonstersConfig[t.infoModel.configID].type&&(t.dir=t.x>=GameMap.MAX_WIDTH>>1?6:2),this.gamescene.map.addEntity(t)},e.prototype.playSkillEff=function(t,e,i,s){void 0===s&&(s=null);var n=300;if(t.wordEff&&e.team==Team.My&&(UserSkill.ins().postShowSkillWord(t.wordEff+""),UserSkill.ins().hejiLevel>0&&UserSkill.ins().isHejiSkill(t.configID)&&(UserSkill.ins().hejiEnable=!1,UserSkill.ins().setHejiCD(-1),UserSkill.ins().postHejiRemove())),(1==i.length&&e!=i[0]||i.length>1)&&(e.dir=DirUtil.get8DirBy2Point(e,i[0])),t&&t.actionType&&e.playAction(t.actionType,e instanceof CharRole?null:function(){e.action!=EntityAction.DIE&&e.playAction(EntityAction.STAND)}),!ViewManager.ins().isShow(GameSceneView))return 0;e&&e.team==Team.My&&t.repelDistance&&TimerManager.ins().doTimer(350,1,this.shakeMapView,this);var o=[14],a=Math.floor(t.configID/1e3);if(!(o.indexOf(a)<0&&!EntityShowMgr.ins().checkShowSkillEffect()&&e.infoModel.masterHandle)||e.isMy||i[0].isMy){if(!t.effectId)return s&&s(),0;if(e.infoModel.type==EntityType.Monster&&-1!=GlobalConfig.FlameStamp.skillId.indexOf(t.configID)&&e.usedLyMarkSkill(),!e.getIsShowBody())return s&&s(),0;switch(SkillEffPlayer.play(t.effectId,e,[i[0]],s),t.effType){case EffectType.AnyAngle:return 700}return n}},e.prototype.shakeMapView=function(){var t=ViewManager.ins().getView(GameSceneView);DisplayUtils.shakeIt(t.map,5,250,2)},e.prototype.addOutEff=function(t,e){var i=new TransferModel;i.configID=0,i.x=t,i.y=e,i.type=EntityType.Transfer,EntityManager.ins().createEntity(i)},e.prototype.removeOutEff=function(){EntityManager.ins().removeTransferById(0)},Object.defineProperty(e.prototype,"gamescene",{get:function(){return ViewManager.ins().getView(GameSceneView)},enumerable:!0,configurable:!0}),e.prototype.createGuanqiaMonster=function(t,e){if(void 0===t&&(t=!0),void 0===e&&(e=!1),this.guanqiaId=UserFb.ins().guanqiaID,GameMap.sceneInMain()){var i=Math.ceil(UserFb.ins().waveMonsterCount*Math.random()),s=UserFb.ins().waveMonsterId.length,n=EntityManager.ins().getEntityByMonsterId(UserFb.ins().eliteMonsterId).length,o=EntityManager.ins().getTeamCount(Team.Monster)-n;if(!(o>3)||e){i=10-o;for(var a=0;s>a;a++){var r=t?UserFb.ins().rPos[a].length:1;r>3&&(r=3),i=Math.ceil(i/r);for(var h=e,l=0;r>l;l++){this.runTime=0,(!this.rPosindex[a]||this.rPosindex[a]>=UserFb.ins().rPos[a].length)&&(this.rPosindex[a]=0);var c=this.rPosindex[a],u=[],p=UserFb.ins().rPos[a][c],d=p.x-this.MONSTER_RADIUS,g=p.y-this.MONSTER_RADIUS;this.writeMap(u,d,g,i);for(var f=0;f<this.MONSTER_LEN;f++)for(var v=0;v<this.MONSTER_LEN;v++)if(u[f]){var y=u[f][v];if(y){var m=void 0;if(e&&h&&5>n)m=UserFb.ins().createMonster(UserFb.ins().eliteMonsterId),m.isElite=!0,h=!1,n+=1;else{var T=UserFb.ins().waveMonsterId[a];m=UserFb.ins().createMonster(T)}m.x=(d+f)*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),m.y=(g+v)*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);var b=isNaN(UserFb.ins().wanderpercent)?5e3:UserFb.ins().wanderpercent;m.isWander=1e4*Math.random()<b;var C=this.createEntityByModel(m);C.AI_STATE=AI_State.Patrol,m.effect&&C.addHalo(GlobalConfig.EffectConfig[m.effect].fileName)}}this.rPosindex[a]++}}GameMap.sceneInMain()&&RoleAI.ins().start()}}},e.prototype.writeMap=function(t,e,i,s){if(this.runTime++,this.runTime>200)return void debug.log("关卡"+this.guanqiaId+"的刷怪点可能在不可行区域内,请策划检查");var n=MathUtils.limitInteger(0,this.MONSTER_LEN-1),o=MathUtils.limitInteger(0,this.MONSTER_LEN-1);if(t[n]||(t[n]=[]),t[n][o])this.writeMap(t,e,i,s);else{var a=GameMap.checkWalkable(e+n,i+o);a&&(t[n][o]=1,s--),s>0&&this.writeMap(t,e,i,s)}},e.prototype.postHookStateChange=function(t){return this.hookState=t,t},e.prototype.postMoveEntity=function(t,e,i){return void 0===i&&(i=!0),[t,e,i]},e.calculateRealAttribute=function(t,e,i,s){void 0===s&&(s={});var n,o=t.infoModel.getAtt(e),a=t.buffList;for(var r in a){n=a[r];var h=EntityManager.ins().getRootMasterHandle(i.infoModel.handle);(n.effConfig.type==SkillEffType.AdditionalAttributes||n.effConfig.type==SkillEffType.HostAddAttributes&&n.hostsHandle&&n.hostsHandle.indexOf(h)>=0)&&n.effConfig.args.d==e&&(o+=n.multRate?n.value*n.multRate:n.value)}var l=s[e]?s[e]:0;return o+l},e.triggerAttr=function(t,e,i){void 0===i&&(i={});var s=t.infoModel.attributeData[e]||0;if(s+=i[e]?i[e]:0){var n=Math.random();if(s/1e4>n)return!0}return!1},e.triggerExAttr=function(t,e){var i=t.infoModel.attributeExData[e];if(i){var s=Math.random();if(i/1e4>s)return!0}return!1},e.triggerCrit=function(t,e,i){void 0===i&&(i=0);var s=t.infoModel.getAtt(AttributeType.atCrit);if(t.buffList[60003]){var n=t.buffList[60003].effConfig;s+=Math.floor(n.args.c/1e4*s)}var o=s-e.infoModel.getAtt(AttributeType.atTough)+i;if(o>0){var a=Math.random();if(o/1e4>a)return!0}return!1},e.triggerMiss=function(t,e){var i=t.infoModel.getExAtt(ExAttributeType.eatHit),s=e.infoModel.getExAtt(ExAttributeType.eatMiss),n=Math.min(s-i,4e3);if(n>0){var o=Math.random();if(n/1e4>o)return!0}return!1},e.triggerValue=function(t){if(t){var e=Math.random();if(t/1e4>e)return!0}return!1},e.prototype.postViewOpen=function(t){return t},e.prototype.doAddMonsterConfig=function(t){var e=JSON.parse(t.readString());for(var i in e)GlobalConfig.MonstersConfig[i]=e[i]},e.prototype.doZeroInit=function(t){GameApp.ins().postZeroInit()},e.prototype.postChangeCamp=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);i&&i.infoModel&&(i.infoModel.camp=t.readInt(),i.infoModel.masterHandle==Actor.handle&&(BattleCC.ins().camp=i.infoModel.camp,BattleCC.ins().postEnterSuccess()),i.setCharName(i.infoModel.guildAndName),i.updateNameColor())},e.skyBallCheck=function(t){if(this.triggerExAttr(t,ExAttributeType.eatAllCrit)){var e=void 0;return e=ObjectPool.pop("EntityBuff"),e.effConfig=GlobalConfig.EffectsConfig[SkillConst.EFF_SKY_BALL],e.addTime=egret.getTimer(),e.endTime=e.addTime+t.infoModel.getExAtt(ExAttributeType.eatAllCritTime),t.addBuff(e),!0}return!1},e.prototype.postFlyItem=function(t){return t},e.prototype.postFlyItemEx=function(t){return t},e.prototype.stopAI=function(){this.sendBaseProto(33)},e.prototype.sendGetOtherAttr=function(t){var e=this.getBytes(34);e.writeShort(t.length);for(var i=0;i<t.length;i++)e.writeDouble(t[i]);this.sendToServer(e)},e}(BaseSystem);GameLogic.HOOK_STATE_HOOK=0,GameLogic.HOOK_STATE_FIND_ENMENY=1,__reflect(GameLogic.prototype,"GameLogic");var GameSystem;!function(t){t.gamelogic=GameLogic.ins.bind(GameLogic)}(GameSystem||(GameSystem={}));var DropHelp=function(){function t(){}return t.init=function(t,e){this.dropContainer=t,this.dropNameContainer=e,MessageCenter.addListener(Encounter.ins().postCreateDrop,this.addDrop,this)},t.start=function(t){this.mainEntity=t?t:EntityManager.ins().getNoDieRole(),GameMap.fbType==UserFb.FB_TYPE_MATERIAL||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS&&OpenSystem.ins().checkSysOpen(SystemType.QUICKDROP)||(GameMap.fbType==UserFb.FB_TYPE_PERSONAL||Encounter.ins().isEncounter()||GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN)&&GameServer.serverOpenDay>0||GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON||GameMap.fbType==UserFb.FB_TYPE_KF_BOSS?TimerManager.ins().doTimer(800,1,this.delayTweenItem,this):TimerManager.ins().doTimer(100,0,this.findDrop,this),this.starting=!0},t.stop=function(){TimerManager.ins().removeAll(this),this.starting=!1,RoleAI.ins().isFindDrop=!1},t.delayTweenItem=function(){if(!t.getItemCount())return void this.checkDrop();var e=this.mainEntity;if(!e)return void this.clearDrop();for(var i in this.itemPos)t.tweenItem(this.itemPos[i],e,i)},t.tweenItem=function(e,i,s){if(null==e)return void DebugUtils.warn("掉落物Item=null，不能缓动！");DisplayUtils.removeFromParent(e),e.setItemParent(t.dropNameContainer);var n=egret.Tween.get(e),o=500*Math.random()+200;n.wait(o).to({x:i.x,y:i.y-50},450,egret.Ease.backIn).call(function(){egret.Tween.removeTweens(e),DisplayUtils.removeFromParent(e),e.destruct(),delete t.itemPos[s],t.getItemCount()||t.checkDrop()},t)},t.getItemCount=function(){return t.itemPos?Object.keys(t.itemPos).length:0},t.addDrop=function(t){var e=t[0],i=t[1],s=t[2],n=ObjectPool.pop("CharItem2");n.setData(s);var o=0,a=0,r=0,h="|";if(this.itemPos[e+h+i]||!GameMap.checkWalkable(e,i)){for(r=0;r<this.orderX.length&&(o=e+this.orderX[r],a=i+this.orderY[r],0==GameMap.checkWalkable(o,a)||null!=this.itemPos[o+h+a]);r++);if(r>=this.orderX.length)for(var l=2,c=!0;c;){for(var u=e-l;e+l>u&&c;u++)for(var p=i-l;i+l>p&&c;p++)o=u,a=p,0!=GameMap.checkWalkable(o,a)&&null==this.itemPos[o+h+a]&&(c=!1);l++}}else o=e,a=i;n.x=GameMap.grip2Point(o),n.y=GameMap.grip2Point(a),this.itemPos[o+h+a]=n,GameLogic.ins().addEntity(n),n.addRoatEffect(),n.addFloatEffect()},t.clearAllDropTween=function(){if(this.itemPos){var t=null;for(var e in this.itemPos)t=this.itemPos[e],t&&t instanceof CharItem2&&t.removeRoatEffect()}},t.clearDrop=function(){t.clearAllDropTween(),this.stop();for(var e in this.itemPos)DisplayUtils.removeFromParent(this.itemPos[e]),this.itemPos[e]&&this.itemPos[e].destruct(),ObjectPool.push(this.itemPos[e]),delete this.itemPos[e];this.curTarget=null,this.completeFunc&&(this.completeFunc.func.call(this.completeFunc.funcThis),this.completeFunc=null)},t.findDrop=function(){var t=this.mainEntity;if(t){var e=EntityManager.ins().getEntityByTeam(Team.My);if(this.curTarget&&(!t||t.action==EntityAction.RUN||t.atking))return void(t&&t.action==EntityAction.RUN&&(t.x==this.lastPoint.x&&t.y==this.lastPoint.y?t.playAction(EntityAction.STAND):(this.lastPoint.x=t.x,this.lastPoint.y=t.y)));if(RoleAI.ins().isFindDrop=!0,e.length>1)for(var i=(SubRoles.ins().subRolesLen,0),s=[-1,1],n=0;n<e.length;n++){var o=e[n];if(o!=t&&o.action!=EntityAction.RUN){var a=t;if(o.infoModel.masterHandle){var r=EntityManager.ins().getEntityByHandle(o.infoModel.masterHandle);r&&(a=r)}2==e.length&&(s=[0]);var h=DirUtil.getGridByDir(a.dir+s[i]!=null?s[i]:0);i+=1,GameMap.moveEntity(o,a.x+h.x,a.y+h.y)}}if(!(egret.getTimer()-this.waitTime<200)){var l=null;if(this.curTarget){if(l=this.curTarget,MathUtils.getDistance(t.x,t.y,l.x,l.y)<GameMap.CELL_SIZE>>1){for(var c in this.itemPos)if(this.itemPos[c]==l){var u=this.itemPos[c];u&&u instanceof CharItem2&&u.removeRoatEffect(),delete this.itemPos[c];break}return egret.Tween.get(l).wait(100).call(function(){if(l&&l.parent){var t=l.parent.localToGlobal(l.x,l.y);GameLogic.ins().postFlyItem({item:l,gp:t}),DisplayUtils.removeFromParent(l)}l=null}),this.curTarget=null,void(this.waitTime=egret.getTimer())}this.curTarget=null}var p=null,d=Number.MAX_VALUE;for(var c in this.itemPos){l=this.itemPos[c];var g=MathUtils.getDistance(t.x,t.y,l.x,l.y);d>g&&(d=g,p=this.itemPos[c])}if(p)return this.curTarget=p,void GameMap.moveEntity(t,p.x,p.y);this.checkDrop(),0==GameMap.fubenID&&UserFb.ins().sendGetReward()}}},t.checkDrop=function(){return this.getItemCount()?void 0:(this.stop(),void(this.completeFunc&&(this.completeFunc.func.call(this.completeFunc.funcThis),this.completeFunc=null)))},t.addCompleteFunc=function(t,e){this.completeFunc={func:t,funcThis:e}},t}();DropHelp.tempDropPoint=new egret.Point,DropHelp.itemPos={},DropHelp.orderX=[-1,1,-1,0,1,-1,0,1],DropHelp.orderY=[0,0,1,1,1,-1,-1,-1],DropHelp.waitTime=0,DropHelp.lastPoint=new egret.Point,__reflect(DropHelp.prototype,"DropHelp");var EaseToFollowUtils=function(){function t(){}return t.startTweenMove=function(e,i,s,n){var o=[];if(t.followTarget=i,"object"==typeof e)for(var a in e)o.push(e[a]);else Array.isArray(e)&&(o=e);t.arrowArray=o,t.callBack=s,t.finishFunc=n,TimerManager.ins().remove(t.onEnterFrame,t),TimerManager.ins().doTimer(10,0,t.onEnterFrame,t)},t.onEnterFrame=function(){if(!Assert(t.followTarget,"the easeToFollow followTarget is null"))for(var e=t.arrowArray,i=e.length<5,s=0;s<e.length;s++)if(s>0&&i)t.calEvery(e[s-1].x,e[s-1].y,e[s]);else{if(null==e[s])return;t.calEvery(t.followTarget.x,t.followTarget.y-50,e[s])}},t.calEvery=function(e,i,s){if(t.dx=e-s.x,t.dy=i-s.y,Math.abs(t.dx)<30&&Math.abs(t.dy)<30){t.vx=0,t.vy=0;var n=t.arrowArray.indexOf(s);if(n>-1&&(t.arrowArray.splice(n,1),t.callBack&&t.callBack(s)),0==t.arrowArray.length)return void t.dispose(s)}else t.easing+=.004,t.vx=t.dx*t.easing,t.vy=t.dy*t.easing;s.x+=t.vx,s.y+=t.vy},t.dispose=function(e){TimerManager.ins().remove(t.onEnterFrame,t),t.followTarget=null,t.callBack=null,t.arrowArray=[],t.easing=.04,t.finishFunc&&(t.finishFunc(),t.finishFunc=null)},t}();EaseToFollowUtils.easing=.04,EaseToFollowUtils.vx=0,EaseToFollowUtils.vy=0,EaseToFollowUtils.isFirst=!0,__reflect(EaseToFollowUtils.prototype,"EaseToFollowUtils");var MainScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onEnter=function(){t.prototype.onEnter.call(this),this.addLayerAt(LayerManager.Game_Bg,1),this.addLayerAt(LayerManager.Game_Main,2),this.addLayer(LayerManager.Main_View),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Main2),this.addLayer(LayerManager.UI_Popup),this.addLayer(LayerManager.UI_Tips),ViewManager.ins().open(GameSceneView),ViewManager.ins().open(ChatMainUI),ViewManager.ins().open(UIView2),ViewManager.ins().open(TipsView),SoundManager.ins().stopBg(),GameApp.ins().postLoginInit(),DeviceUtils.IsMobile&&egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlaySound,this)},e.prototype.onTouchPlaySound=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchPlaySound,this),SoundUtil.ins().playEffect(SoundUtil.WINDOW)},e.prototype.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);__reflect(MainScene.prototype,"MainScene");var BloodLabel=function(t){function e(){var e=t.call(this)||this;return e.urlDic={256:"wydEffectIcon",512:["j0z","j4z","j5z"]},e.containers=[],e.imgs=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.createBloodLabel=function(t,e,i,s,n,o){void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o=1);var a=this.getContainer();return a.createBlood(t,e,i,s,n,o),a},e.prototype.getTypeUrl=function(t,e){void 0===e&&(e=1);var i=this.urlDic[t];return i?"string"!=typeof i?i[e-1]:i:void 0},e.prototype.getImage=function(){return this.imgs.pop()||new eui.Image},e.prototype.getContainer=function(){return this.containers.pop()||new BloodContainer},e.prototype.pushImage=function(t){t&&-1==this.imgs.indexOf(t)&&this.imgs.push(t)},e.prototype.pushContainer=function(t){t&&-1==this.containers.indexOf(t)&&this.containers.push(t)},e}(BaseClass);__reflect(BloodLabel.prototype,"BloodLabel");var BloodContainer=function(t){function e(){var e=t.call(this)||this;return e.offset=3,e}return __extends(e,t),e.prototype.createBlood=function(t,e,i,s,n,o){void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o=1),(t&DamageTypes.ZhuiMing)==DamageTypes.ZhuiMing&&this.addImage(DamageTypes.ZhuiMing,o),(t&DamageTypes.ZhiMing)==DamageTypes.ZhiMing&&this.addImage(DamageTypes.ZhiMing,o),this.addBmpNumber(e,i,s,n),this.resetPosition()},e.prototype.addImage=function(t,e){void 0===e&&(e=1);var i=BloodLabel.ins().getTypeUrl(t,e);if(!i)return void console.log("伤害类型:"+t+"未设置资源");var s=BloodLabel.ins().getImage();s.addEventListener(egret.Event.COMPLETE,this.onLoaded,this),s.width=0/0,s.height=0/0,s.source=i,this.addChild(s)},e.prototype.addBmpNumber=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0),this.bmpContainer?BitmapNumber.ins().changeNum(this.bmpContainer,t,e,i,s):this.bmpContainer=BitmapNumber.ins().createNumPic(t,e,i,s),this.addChild(this.bmpContainer)},e.prototype.onLoaded=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.COMPLETE,this.onLoaded,this),this.resetPosition()},e.prototype.resetPosition=function(){for(var t=0,e=0,i=this.numChildren,s=0;i>s;s++){var n=this.getChildAt(s);n.x=t,t+=n.width+this.offset,e=Math.max(e,n.height)}for(var s=0;i>s;s++){var n=this.getChildAt(s);n.y=(e-n.height)/2}this.width=t-this.offset,this.height=e},e.prototype.destroy=function(){for(;this.numChildren;){var t=this.removeChildAt(this.numChildren-1);t instanceof eui.Image?(t.removeEventListener(egret.Event.COMPLETE,this.onLoaded,this),BloodLabel.ins().pushImage(t)):t instanceof egret.DisplayObjectContainer&&BitmapNumber.ins().desstroyNumPic(t)}this.bmpContainer=null,BloodLabel.ins().pushContainer(this)},e}(egret.DisplayObjectContainer);__reflect(BloodContainer.prototype,"BloodContainer");var BloodView=function(t){function e(){var e=t.call(this)||this;return e.offY=0,e.offsetY=0,e._lastType=0,e.bloodNum=50,e.tempBloodViews=[],e.tick=0,e.delayCount=0,MessageCenter.addListener(GameLogic.ins().postEntityHpChange,e.showBlood,e),egret.startTick(function(){return e.tick++,!1},e),TimerManager.ins().doTimer(1e3,0,function(){var t=e.tick;return e.tick=0,e.delayCount<=0?void e.delayCount--:(t>=25?e.bloodNum=50:t>=15?e.bloodNum=10:t>=10?e.bloodNum=5:e.bloodNum=0,void(25>t&&(e.delayCount=5)))},e),e}return __extends(e,t),e.prototype.showBlood=function(t){var e=t[0],i=t[1],s=t[2],n=t[3];if(this.tempBloodViews.length>=this.bloodNum){var o=this.tempBloodViews[0];o&&(egret.Tween.removeTweens(o),DisplayUtils.removeFromParent(o),this.destroyBlood(o))}if(e&&i&&(e.team==Team.My||i.team==Team.My)){e.team==Team.My&&(s=1);var a=s&DamageTypes.Deter&&i.isMy,r=s&DamageTypes.CRIT&&!a,h=s&DamageTypes.Lucky,l=s&DamageTypes.Heji,c=s&DamageTypes.Dodge,u=s&DamageTypes.ZhiMing;if(u&&(r=!1),this.offY=EntityManager.CHAR_DEFAULT_TYPEFACE-e.typeface,this._lastType!=s&&(this.offsetY=0),this._lastType=s,0!=n||c){var p="";if(i instanceof CharRole)switch(i.infoModel.job){case JobConst.ZhanShi:p="j"+(r||a?0:1);break;case JobConst.FaShi:p="j"+(r||a?4:2);break;case JobConst.DaoShi:p="j"+(r||a?5:3)}else if(i instanceof CharMonster){p="j3";var d=GlobalConfig.MonstersConfig[i.infoModel.configID];d&&d.type==MonsterType.Ring&&(p="j9",r=!0)}(l||h)&&(p="j0");var g=e.team==Team.My?"2":p;c&&(g="j0");var f="";f=c?"s":l?0>n?"+"+Math.abs(n):"h"+(n>>0):0>n?"+"+Math.abs(n):(r?"b":a?"d":h?"b":"")+(n>>0);var v=0>n?"g3":g,y=3.5;s&DamageTypes.Fujia||s&DamageTypes.Lianji?this.offsetY+=25:this.offsetY=0;var m=this.offsetY,T=BloodLabel.ins().createBloodLabel(s,f,v,y,m,i.infoModel.job||1);T.touchChildren=!1,s&DamageTypes.Heji?this.addChildAt(T,1e3):this.addChild(T),T.x=e.x-T.width/2,T.y=e.y-50-m;var b=0>n;"6"==p&&(b=!0),this.floatImg(T,s,e,i,b),this.tempBloodViews.push(T)}}},e.prototype.removeFloatTarget=function(t){DisplayUtils.removeFromParent(t),this.destroyBlood(t)},e.prototype.injuredCritLucky=function(t,i){t.scaleX=t.scaleY=e.sc_s0;var s=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-80)/2,n=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-30);t.y=s,i.to({y:n,scaleX:e.sc_s1,scaleY:e.sc_s1},e.sc_sp1,e.sc_fun1).wait(e.sc_sp2).to({alpha:0,scaleX:e.sc_s2,scaleY:e.sc_s2},e.sc_sp3,e.sc_fun2).call(this.removeFloatTarget,this,[t])},e.prototype.injured=function(t,i){t.scaleX=t.scaleY=e.sn_s0;var s=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-80)/2,n=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-30);t.y=s,i.to({y:n,scaleX:e.sn_s1,scaleY:e.sn_s1},e.sn_sp1,e.sn_fun1).wait(e.sn_sp2).to({alpha:0,scaleX:e.sn_s2,scaleY:e.sn_s2},e.sn_sp3,e.sn_fun2).call(this.removeFloatTarget,this,[t])},e.prototype.atkCritLucky=function(t,i){var s=0,n=0;t.x+=e.c_posX1,s=t.x+e.c_posX2,n=t.x+e.c_posX3,t.scaleX=t.scaleY=e.c_s0,t.y=t.y-e.c_posY1+this.offY,t.alpha=e.c_alpha0;var o=t.y-e.c_posY2;i.to({x:s,y:o,scaleX:e.c_s1,scaleY:e.c_s1,alpha:e.c_alpha1},e.c_sp1,e.c_fun1).to({scaleX:e.c_s2,scaleY:e.c_s2,alpha:e.c_alpha2},e.c_sp2,e.c_fun2).to({scaleX:e.c_s3,scaleY:e.c_s3,alpha:e.c_alpha3},e.c_sp3,e.c_fun3).wait(100).to({alpha:e.c_alpha4,y:t.y+e.c_posY3,x:n,scaleX:e.c_s4,scaleY:e.c_s4},e.c_sp4,e.c_fun4).to({alpha:e.c_alpha5,y:t.y+e.c_posY4,scaleX:e.c_s5,scaleY:e.c_s5},e.c_sp5,e.c_fun5).call(this.removeFloatTarget,this,[t])},e.prototype.atkHeJi=function(t,i){var s=0,n=0,o=ViewManager.gamescene.map,a=this.localToGlobal();a.x=StageUtils.ins().getWidth()/2,o.globalToLocal(a.x,a.y,a);var r=100*Math.random()-50,h=200*Math.random()-100;t.x=a.x-100-t.width/2+r,t.x+=e.h_posX1,s=t.x+e.h_posX2,n=t.x+e.h_posX3,t.scaleX=t.scaleY=e.h_s0,t.y=t.y-e.h_posY1+this.offY+h,t.alpha=e.h_alpha0;var l=t.y-e.h_posY2;i.to({x:s,y:l,scaleX:e.h_s1,scaleY:e.h_s1,alpha:e.h_alpha1},e.h_sp1,e.h_fun1).to({scaleX:e.h_s2,scaleY:e.h_s2,alpha:e.h_alpha2},e.h_sp2,e.h_fun2).to({scaleX:e.h_s3,scaleY:e.h_s3,alpha:e.h_alpha3},e.h_sp3,e.h_fun3).wait(100).to({alpha:e.h_alpha4,y:t.y+e.h_posY3,x:n,scaleX:e.h_s4,scaleY:e.h_s4},e.h_sp4,e.h_fun4).to({alpha:e.h_alpha5,y:t.y+e.h_posY4,scaleX:e.h_s5,scaleY:e.h_s5},e.h_sp5,e.h_fun5).call(this.removeFloatTarget,this,[t])},e.prototype.atk=function(t,i){var s=0,n=0;t.x+=e.posX1,s=t.x+e.posX2,n=t.x+e.posX3,t.scaleX=t.scaleY=e.s0,t.y=t.y-e.posY1+this.offY,t.alpha=e.alpha0;var o=t.y-e.posY2;i.to({x:s,y:o,scaleX:e.s1,scaleY:e.s1,alpha:e.alpha1},e.sp1,e.fun1).to({scaleX:e.s2,scaleY:e.s2,alpha:e.alpha2},e.sp2,e.fun2).to({scaleX:e.s3,scaleY:e.s3,alpha:e.alpha3},e.sp3,e.fun3).wait(100).to({alpha:e.alpha6,y:t.y+e.posY6,x:t.x+e.posX6,scaleX:e.s6,scaleY:e.s6},e.sp6,e.fun6).to({alpha:e.alpha7,y:t.y+e.posY7,x:t.x+e.posX7,scaleX:e.s7,scaleY:e.s7},e.sp7,e.fun7).to({alpha:e.alpha8,y:t.y+e.posY8,x:t.x+e.posX8,scaleX:e.s8,scaleY:e.s8},e.sp8,e.fun8).to({alpha:e.alpha9,y:t.y+e.posY9,x:t.x+e.posX9,scaleX:e.s9,scaleY:e.s9},e.sp9,e.fun9).to({alpha:e.alpha5,y:t.y+e.posY4,scaleX:e.s5,scaleY:e.s5},e.sp5,e.fun5).call(this.removeFloatTarget,this,[t])
},e.prototype.floatImg=function(t,e,i,s,n){var o=egret.Tween.get(t);if(null==s||i.team==Team.My)(e&DamageTypes.CRIT)==DamageTypes.CRIT||(e&DamageTypes.Lucky)==DamageTypes.Lucky?this.injuredCritLucky(t,o):this.injured(t,o);else{var a=(e&DamageTypes.Deter)==DamageTypes.Deter&&s&&s.isMy,r=a&&(e&DamageTypes.CRIT)==DamageTypes.CRIT;r||(e&DamageTypes.CRIT)==DamageTypes.CRIT||(e&DamageTypes.Lucky)==DamageTypes.Lucky?this.atkCritLucky(t,o):(e&DamageTypes.Heji)==DamageTypes.Heji?this.atkHeJi(t,o):this.atk(t,o)}},e.prototype.destroyBlood=function(t){t.x=0,t.y=0,t.alpha=1,t.scaleX=t.scaleY=1,t.touchChildren=!0,t instanceof BloodContainer?t.destroy():BitmapNumber.ins().desstroyNumPic(t);var e=this.tempBloodViews.indexOf(t);~e&&this.tempBloodViews.splice(e,1)},e}(egret.DisplayObjectContainer);BloodView.sp1=60,BloodView.sp2=80,BloodView.sp3=80,BloodView.sp4=400,BloodView.sp5=720,BloodView.fun1=egret.Ease.circInOut,BloodView.fun2=egret.Ease.circInOut,BloodView.fun3=egret.Ease.sineIn,BloodView.fun4=null,BloodView.fun5=egret.Ease.sineIn,BloodView.s0=1.2,BloodView.s1=.4,BloodView.s2=.75,BloodView.s3=.6,BloodView.s4=.6,BloodView.s5=.6,BloodView.posX6=-18,BloodView.posX7=-20,BloodView.posX8=-23,BloodView.posX9=-30,BloodView.posY6=10,BloodView.posY7=13,BloodView.posY8=16,BloodView.posY9=20,BloodView.alpha6=.6,BloodView.alpha7=.5,BloodView.alpha8=.4,BloodView.alpha9=0,BloodView.sp6=600,BloodView.sp7=200,BloodView.sp8=400,BloodView.sp9=400,BloodView.fun6=null,BloodView.fun7=null,BloodView.fun8=null,BloodView.fun9=null,BloodView.s6=.6,BloodView.s7=.6,BloodView.s8=.6,BloodView.s9=.6,BloodView.posX1=90,BloodView.posX2=0,BloodView.posX3=0,BloodView.posY1=100,BloodView.posY2=0,BloodView.posY3=0,BloodView.posY4=10,BloodView.alpha0=1,BloodView.alpha1=1,BloodView.alpha2=1,BloodView.alpha3=.9,BloodView.alpha4=.5,BloodView.alpha5=0,BloodView.startX=70,BloodView.startY=75,BloodView.changeTime1=300,BloodView.changeTime2=1e3,BloodView.changeY=.5,BloodView.bigScale=3,BloodView.endScale=.6,BloodView.bigAlpha=1,BloodView.endAlpha1=1,BloodView.endAlpha2=.3,BloodView.endTime1=600,BloodView.endTime2=500,BloodView.c_sp1=80,BloodView.c_sp2=200,BloodView.c_sp3=200,BloodView.c_sp4=1e3,BloodView.c_sp5=1200,BloodView.c_fun1=egret.Ease.circInOut,BloodView.c_fun2=egret.Ease.circInOut,BloodView.c_fun3=egret.Ease.sineIn,BloodView.c_fun4=null,BloodView.c_fun5=egret.Ease.sineIn,BloodView.c_s0=.1,BloodView.c_s1=.8,BloodView.c_s2=.8,BloodView.c_s3=.8,BloodView.c_s4=.6,BloodView.c_s5=.1,BloodView.c_posX1=0,BloodView.c_posX2=100,BloodView.c_posX3=120,BloodView.c_posY1=120,BloodView.c_posY2=10,BloodView.c_posY3=10,BloodView.c_posY4=10,BloodView.c_alpha0=1,BloodView.c_alpha1=1,BloodView.c_alpha2=1,BloodView.c_alpha3=.6,BloodView.c_alpha4=0,BloodView.c_alpha5=0,BloodView.h_sp1=80,BloodView.h_sp2=300,BloodView.h_sp3=200,BloodView.h_sp4=1e3,BloodView.h_sp5=1200,BloodView.h_fun1=egret.Ease.circInOut,BloodView.h_fun2=egret.Ease.circInOut,BloodView.h_fun3=egret.Ease.sineIn,BloodView.h_fun4=null,BloodView.h_fun5=egret.Ease.sineIn,BloodView.h_s0=.1,BloodView.h_s1=1.2,BloodView.h_s2=1.2,BloodView.h_s3=1.2,BloodView.h_s4=1.2,BloodView.h_s5=1.2,BloodView.h_posX1=0,BloodView.h_posX2=100,BloodView.h_posX3=120,BloodView.h_posY1=150,BloodView.h_posY2=10,BloodView.h_posY3=-30,BloodView.h_posY4=-30,BloodView.h_alpha0=1,BloodView.h_alpha1=1,BloodView.h_alpha2=1,BloodView.h_alpha3=.6,BloodView.h_alpha4=0,BloodView.h_alpha5=0,BloodView.NORMAL_SCALE_1=1.1,BloodView.NORMAL_SCALE_2=.95,BloodView.sn_sp1=600,BloodView.sn_sp2=200,BloodView.sn_sp3=200,BloodView.sn_fun1=null,BloodView.sn_fun2=null,BloodView.sn_s0=1.3,BloodView.sn_s1=1.3,BloodView.sn_s2=1.3,BloodView.sc_sp1=600,BloodView.sc_sp2=200,BloodView.sc_sp3=200,BloodView.sc_fun1=null,BloodView.sc_fun2=null,BloodView.sc_s0=1.5,BloodView.sc_s1=1.5,BloodView.sc_s2=1.5,BloodView.C_END_DES=0,BloodView.C_YPOS1=120,BloodView.C_YPOS2=0,BloodView.C_YPOS3=-20,BloodView.C_WAIT1=200,BloodView.C_SPEED1=100,BloodView.C_SPEED2=600,__reflect(BloodView.prototype,"BloodView");var GameBlackView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.black=new eui.Rect,this.black.fillColor=2367519,this.black.left=0,this.black.right=0,this.black.top=0,this.black.bottom=0,this.addChild(this.black)},e.prototype.destoryView=function(){},e}(BaseEuiView);__reflect(GameBlackView.prototype,"GameBlackView"),ViewManager.ins().reg(GameBlackView,LayerManager.Game_Main);var GameSceneView=function(t){function e(){var e=t.call(this)||this;return e.skillWordList=[],e.mijingpassTime=0,e._shap=new egret.Shape,e.gwStartTimes=0,e.leftTimeMj=0,e._miCurFloor=0,e.leftTime=0,e.isStartTime=!1,e.leftFlyExp=0,e.curAddExp=0,e.curExp=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GameFightSceneSkin",this.touchEnabled=!1,this.map=new MapView,this.map.initMap(),this.addChildAt(this.map,0),this.pkBossBtn.touchEnabled=!0,this.pkBossBtn.visible=!1,this.input=new eui.TextInput,this.input.visible=!1,this.input.text="点我输入命令1645",this.input.y=300,this.addChild(this.input),this.escBtn.visible=!1,this.skillWordImg=new eui.Image,this.skillWordImg.x=100,this.skillWordImg.visible=!1,this.skillWordImg.touchEnabled=!1,this.addChild(this.skillWordImg),this.leftTimePic=BitmapNumber.ins().createNumPic(0,"r0",5),this.leftTimePic.x=90,this.leftTimePic.y=38,this.guildBossGroup.addChild(this.leftTimePic),this.GwRankGroup.addChild(this._shap),this._shap.rotation=-90,this._shap.x=48,this._shap.y=50,this.schedule.mask=this._shap,this.riseupBtn.visible=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.observe(GameLogic.ins().postHookStateChange,this.upDataGuajiState),this.observe(GameLogic.ins().postHpChange,this.updateExpGroup),this.observe(UserSkill.ins().postShowSkillWord,this.showSkillWord),this.observe(UserFb.ins().postFbExpTotal,this.updateKill),this.observe(GameLogic.ins().postEnterMap,this.onEnterMap),this.observe(UserFb.ins().postFbTime,this.onSetTime),this.observe(GameLogic.ins().postViewOpen,this.onViewOpen),this.observe(GodWeaponCC.ins().postFubenInfo,this.updateMijingAdd),this.observe(Actor.ins().postExp,this.expChange),this.addTouchEvent(this.pkBossBtn,this.onTap),this.addTouchEvent(this.escBtn,this.onTap),this.addTouchEvent(this.riseup,this.onTap)},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.close.call(this,e),this.skillWordList=[],egret.Tween.removeTweens(this.skillWordImg),this.skillWordImg.visible=!1,TimerManager.ins().remove(this.updateTime,this),TimerManager.ins().remove(this.updateMijingTime,this),this.mijingpassTime=0},e.prototype.expChange=function(t){if((GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS||GameMap.fbType==UserFb.FB_TYPE_TIAOZHAN)&&t){var e=EntityManager.ins().getNoDieRole();if(e){var i=new egret.DisplayObjectContainer;BitmapNumber.ins().changeNum(i,"j+"+t,"g3",3.5,0),i.anchorOffsetX=i.width/2,i.y=e.y-e.typeface-30,i.x=e.x,i.scaleX=i.scaleY=1,this.map.addChild(i),egret.Tween.get(i).to({y:i.y-80,scaleX:2,scaleY:2},200).to({scaleX:1.2,scaleY:1.2},100).wait(1e3).to({alpha:0,y:i.y-140},1e3).call(function(){DisplayUtils.removeFromParent(i)})}}},e.prototype.onViewOpen=function(t){1==t?this.map.parent&&(ViewManager.ins().open(GameBlackView),this.removeChild(this.map)):this.map.parent||(this.addChildAt(this.map,0),ViewManager.ins().close(GameBlackView))},e.prototype.onEnterMap=function(){TimerManager.ins().remove(this.updateTime,this),ViewManager.ins().close(GwMijingRiseUpView),TimerManager.ins().remove(this.updateMijingTime,this),this.mijingpassTime=0,this.isStartTime=!1,GameMap.fbType==UserFb.FB_TYPE_EXP?(this.curExp=0,this.expTxt||(this.expTxt=BitmapNumber.ins().createNumPic(0,"r0",5),this.expTxt.x=this.flyExpGroup.width/2,this.expTxt.y=65,this.flyExpGroup.addChild(this.expTxt)),this.updateKill(),this.setExp(this.curExp),this.leftFlyExp=0,this.totleExp.source="chuangtianguan_json.fbljjy",this.killNumImg.source="chuangtianguan_json.fbjsgw",this.flyExpGroup.visible=!0,this.flyExpGroup1.visible=!0):(this.flyExpGroup.visible=!1,this.flyExpGroup1.visible=!1),this.guildBossGroup.visible=!1,this.escBtn.visible=GameMap.fubenID&&GameMap.fbType!=UserFb.FB_TYPE_GUANQIABOSS&&GameMap.fbType!=UserFb.FB_TYPE_CITY&&GameMap.fbType!=UserFb.FB_TYPE_FIRE_RING&&GameMap.fbType!=UserFb.FB_TYPE_PEAK,UserSkill.ins().hejiLevel>=0&&this.checkHJState(),GameMap.fbType==UserFb.FB_TYPE_MIJING?(this.GwRankGroup.visible=!1,this.showMijing()):this.GwRankGroup.visible=!1,GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON?ViewManager.ins().open(GuardMainUI):(ViewManager.ins().close(GuardMainUI),ViewManager.ins().close(GuardCallBossWin))},e.prototype.checkHJState=function(){GameMap.autoPunch()?ViewManager.ins().open(BtnHejiWin):ViewManager.ins().close(BtnHejiWin)},e.prototype.updateMijingAdd=function(){if(GameMap.fbType==UserFb.FB_TYPE_MIJING)for(var t=GodWeaponCC.ins().fubenInfoData,e=t.listData,i=0;i<e.length;i++)if(e[i].config.fbId==GameMap.fubenID){UserFb.ins().oldMijingPoint=e[i].curPoint;break}},e.prototype.showMijing=function(){var t,e=(GlobalConfig.GodWeaponBaseConfig,1);for(var i in GlobalConfig.GodWeaponFubenConfig)if(GlobalConfig.GodWeaponFubenConfig[i].fbId==GameMap.fubenID){e=parseInt(i),t=GlobalConfig.GodWeaponFubenConfig[i];break}this._miCurFloor=e;var s=GodWeaponCC.ins().fubenInfoData;if(s){for(var n=s.listData,o=0;o<n.length;o++)if(n[o].config.fbId==GameMap.fubenID){UserFb.ins().oldMijingPoint=n[o].curPoint;break}}else GodWeaponCC.ins().requestFubenInfo()},e.prototype.removeMiingTimeFun=function(){TimerManager.ins().remove(this.updateMijingTime,this)},e.prototype.updateMijingTime=function(){if(this.leftTimeMj<=0)return ViewManager.ins().close(GwMijingRiseUpView),this.mijingpassTime=0,UserFb.ins().sendExitFb(),ViewManager.ins().open(GwResultView,GameMap.fubenID,4),void TimerManager.ins().remove(this.updateMijingTime,this);for(var t=360-this.leftTimeMj,e=void 0,i=0;i<GlobalConfig.GodWeaponBaseConfig.fbGrade.length;i++)if(t<=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]){this.mijingpassTime=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]-t,e=GodWeaponCC.ins().getPinfenTime(i),UserFb.ins().mijingFingfen=i+1,UserFb.ins().mijingUseTime=t,this.updateMijingTimeView(e,i);break}this.leftTimeMj=360-(Math.floor((new Date).getTime()/1e3)-this.gwStartTimes)},e.prototype.updateMijingTimeView=function(t,e){this.GwRankGroup.visible||(this.GwRankGroup.visible=!0,this.schedule.source="godweapon_rankschedule",this.rankbg.source="GodWeapon_rankball");var i=360*this.mijingpassTime/t;360==i?i=0:0==i&&(i=360),DisplayUtils.drawCir(this._shap,this.schedule.width/2,360-i,!0),this.rank.source="godweapon_rank"+(e+1),this.time.text=DateUtils.getFormatBySecond(this.mijingpassTime,DateUtils.TIME_FORMAT_1);var s;s=GlobalConfig.GodWeaponBaseConfig.fbGrade[e]+"秒";var n="";switch(e+1){case 1:n="S";break;case 2:n="A";break;case 3:n="B";break;case 4:n="C"}this.requireTime.textFlow=(new egret.HtmlTextParser).parser(s+'<font color="#FFFFFF">内通关将保持</font>'+n+'<font color="#FFFFFF">评价</font>');var o=GlobalConfig.GodWeaponFubenConfig[this._miCurFloor];if(o){var a=o.award[e+1];a?this.rewardExp.text=""+a[0].count:this.rewardExp.text=""}else this.rewardExp.text=""},e.prototype.setMJPingfen=function(t){var e="godweapon_rank"+t;this.rank.source!=e&&(this.rank.source=e)},e.prototype.upDataGuajiState=function(t){0!=GameMap.fubenID&&1==t&&(t=0),this.stateImg.source=t?"zy_20":""},e.prototype.onSetTime=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];GameMap.fbType==UserFb.FB_TYPE_GUILD_BOSS?t&&t[0]&&(this.leftTime=t[0][1],this.leftTimeImg.source="lastcount",this.guildBossGroup.visible=!0,this.isStartTime||(TimerManager.ins().doTimer(1e3,0,this.updateTime,this),this.isStartTime=!0,this.updateTime())):GameMap.fbType==UserFb.FB_TYPE_MIJING&&t&&t[0]&&(this.leftTimeMj=t[0][1],this.leftTimeMj>=2&&(this.leftTimeMj=this.leftTimeMj-2),this.gwStartTimes=Math.floor((new Date).getTime()/1e3)-(360-this.leftTimeMj),TimerManager.ins().doTimer(1e3,0,this.updateMijingTime,this),this.updateMijingTime())},e.prototype.updateTime=function(){return this.leftTime<0?(TimerManager.ins().remove(this.updateTime,this),this.isStartTime=!1,this.guildBossGroup.visible=!1,BitmapNumber.ins().changeNum(this.leftTimePic,0,"r0",5),void UserFb.ins().sendExitFb()):(BitmapNumber.ins().changeNum(this.leftTimePic,this.leftTime,"r0",5),void this.leftTime--)},e.prototype.updateKill=function(){this.lbNum.textFlow=TextFlowMaker.generateTextFlow1("|C:0x35e62b&T:"+UserFb.ins().expMonterCountKill+"||C:0xF8B141&T:/"+UserFb.ins().fbExpTotal+"|")},e.prototype.flyExp=function(t,e){var i=this,s=new eui.Image;s.source="point2",s.anchorOffsetX=20,s.anchorOffsetY=20,s.x=t.x,s.y=t.y,this.addChild(s);var n=this.flyExpGroup.x+this.expTxt.x,o=this.flyExpGroup.y+this.expTxt.y+this.expTxt.height/2,a=egret.Tween.get(s);a.to({x:n,y:o,alpha:.5},800).call(function(){i.addExp(e),i.removeChild(s),egret.Tween.removeTweens(s)},this);var r=egret.Tween.get(s,{loop:!0});r.to({rotation:s.rotation+360},800)},e.prototype.rollExp=function(){var t=this.leftFlyExp>this.curAddExp?this.curAddExp:this.leftFlyExp;this.leftFlyExp=this.leftFlyExp-t,this.curExp+=t,this.setExp(this.curExp),this.leftFlyExp<=0&&TimerManager.ins().remove(this.rollExp,this)},e.prototype.addExp=function(t){this.leftFlyExp+=t,this.curAddExp=Math.floor(this.leftFlyExp/10),TimerManager.ins().isExists(this.rollExp,this)||TimerManager.ins().doTimer(30,0,this.rollExp,this)},e.prototype.setExp=function(t){BitmapNumber.ins().changeNum(this.expTxt,t,"r0",5),this.expTxt.anchorOffsetX=this.expTxt.width/2},e.prototype.updateExpGroup=function(t){var e=t[0],i=t[1];if(!(i>0||GameMap.fbType!=UserFb.FB_TYPE_EXP)){var s=e.infoModel.configID,n=GlobalConfig.ExpFbMonsterConfig[s];if(n){var o=e.parent;if(!o){var a=EntityManager.ins().getNoDieRole();a&&(o=a.parent)}if(o){var r=GlobalConfig.MonthCardConfig.expFubenPrecent/100,h=Recharge.ins().getIsForeve()?1+r:1,l=o.localToGlobal(e.x,e.y);this.flyExp(l,Math.ceil(n.exp*h))}this.updateKill()}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.pkBossBtn:break;case this.escBtn:if(GameMap.fbType==UserFb.FB_TYPE_GUARD_WEAPON)return void ViewManager.ins().open(GuardQuitTips);if(MineFight.ins().isFighting)return void UserTips.ins().showTips("掠夺矿中不可以退出");if(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS&&PlayFun.ins().closeAuto(),ZsBoss.ins().isZsBossFb(GameMap.fubenID)&&(UserBoss.ins().ShowTip=!0),GuildWar.ins().getModel().checkinAppoint())return void ViewManager.ins().open(GuileWarReliveWin,3);if(BattleCC.ins().isBattle())return void WarnWin.show("是否退出阵营副本，退出后有30秒进入CD",function(){UserFb.ins().sendExitFb()},this);if(PaoDianCC.ins().isPaoDian)return void WarnWin.show("是否确定退出激情泡点？退出后将损失大量经验、威望奖励且有30秒进入CD",function(){UserFb.ins().sendExitFb()},this);if(KfArenaSys.ins().isKFArena)return void WarnWin.show("战场未结束，退出将扣除大量竞技场积分，是否退出？",function(){UserFb.ins().sendExitFb()},this);UserFb.ins().sendExitFb(),TimerManager.ins().remove(this.updateMijingTime,this),this.mijingpassTime=0;break;case this.riseup:ViewManager.ins().open(GwMijingRiseUpView)}},e.prototype.showSkillWord=function(t){if(t){egret.Tween.removeTweens(this.skillWordImg);var e=egret.Tween.get(this.skillWordImg);this.skillWordImg.source=null,this.skillWordImg.source=t,this.skillWordImg.visible=!0,this.skillWordImg.scaleX=3,this.skillWordImg.scaleY=3,this.skillWordImg.alpha=1,this.skillWordImg.y=250,e.to({y:250,scaleX:1,scaleY:1},200).wait(600).to({alpha:0},350)}},e.prototype.destoryView=function(){},e}(BaseEuiView);__reflect(GameSceneView.prototype,"GameSceneView"),ViewManager.ins().reg(GameSceneView,LayerManager.Game_Bg);var UIView1=function(t){function e(){var e=t.call(this)||this;return e.ft=new FrameTick,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="UIView1Skin",this.touchEnabled=!1},e.prototype.initData=function(){this.ft.checkAndTick(0)||(CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold),CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb),this.nameTxt.text=Actor.myName,this.expChange())},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.observe(GameLogic.ins().postSubRoleChange,this.initData),this.observe(Actor.ins().postGoldChange,this.initData),this.observe(Actor.ins().postYbChange,this.initData),this.observe(Actor.ins().postNameChange,this.initData),this.observe(Actor.ins().postPowerChange,this.initData),this.observe(Actor.ins().postLevelChange,this.expChange),this.addTouchEvent(this.recharge,this.onClick),this.addTouchEvent(this.recharge0,this.onClick),this.initData()},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.close.call(this,e),this.removeTouchEvent(this.recharge,this.onClick),this.removeTouchEvent(this.recharge0,this.onClick),this.removeObserve()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.recharge:ViewManager.ins().open(ChargeFirstWin);break;case this.recharge0:if(GameServer.serverOpenDay<2)return void UserTips.ins().showTips("|C:0xf3311e&T:开服第三天开启摇钱树|");ViewManager.ins().open(FuliWin)}},e.prototype.expChange=function(){var t=Actor.level,e=UserZs.ins()?UserZs.ins().lv:0,i="|C:0xF1D715&T:"+(e?e+"转":"")+"|";i=i+t+"级",this.lvTxt.textFlow=TextFlowMaker.generateTextFlow(i)},e}(BaseEuiView);__reflect(UIView1.prototype,"UIView1"),ViewManager.ins().reg(UIView1,LayerManager.UI_Popup);var UIView2=function(t){function e(){var e=t.call(this)||this;return e.lastLevel=0,e.flyExpLevel=[],e.canClick=!0,e._shap=new egret.Shape,e.radius=0,e._curAngle=0,e._toAngle=0,e._oldAngle=360,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="UIView2Skin",this.expBar.slideDuration=0,this.navBtn=[this.roleBtn,this.furnaceBtn,this.taskBtn,this.forgingBtn,this.bagBtn];for(var e=0;e<this.navBtn.length;e++)this.navBtn[e].redPoint.visible=!1;this.navBind=[RoleWin,SkillWin,LiLianWin,ForgeWin,BagWin],this.hpBall=new MovieClip,this.hpBall.mask=new egret.Rectangle(-45,-53,80,106),this.hpBall.x=65,this.hpBall.y=45,this.mpBall=new MovieClip,this.mpBall.mask=new egret.Rectangle(-32.5,-53,88,106),this.mpBall.x=57,this.mpBall.y=45,this.hpLineMc=new MovieClip,this.hpLineMc.x=50,this.hpLineMc.y=0,this.hpLineMc.mask=this.hpMask,this.mpLineMc=new MovieClip,this.mpLineMc.x=80,this.mpLineMc.y=0,this.mpLineMc.mask=this.mpMask,this.hjMc=new MovieClip,this.hjMc.x=41,this.hjMc.y=41,this.hjMc.touchEnabled=!1,this.circleImg=new MovieClip,this.circleImg.x=41,this.circleImg.y=41,this.circleImg.touchEnabled=!1,this.taskItemImg=new eui.Image,this.taskItemImg.x=250,this.taskItemImg.y=730,this.taskItemImg.visible=!1,this.flyItemGroup.addChild(this.taskItemImg),this.backMc=new MovieClip,this.backMc.x=50,this.backMc.y=50,this.isExitUsedItem=!1,this.isItemCountChange=!1,this.backBtnGroup.visible=!1,this.powerGroup.visible=!0,this.circleImg.touchEnabled=!1,this.backBtnGroup.touchEnabled=this.backMc.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.lastLevel=Actor.level||0;for(var s=0;s<this.navBtn.length;s++)this.addTouchEvent(this.navBtn[s],this.onClick);this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.powerGroup,this.onClick),this.addTouchEvent(this.lockImg,this.onClick),this.observe(Actor.ins().postExp,this.expChange),this.observe(Actor.ins().postInit,this.expChange),this.observe(UserRole.ins().postRoleHint,this.showRoleBtnRedPoint),this.observe(GameLogic.ins().postMpChange,this.updateHuShen),this.observe(GameLogic.ins().postCreateOtherEntity,this.updateHuShen),this.observe(GameLogic.ins().postHpChange,this.readyUpdateHp),this.observe(GameLogic.ins().postHpChange,this.flyGQBossExpToBar),this.observe(GameLogic.ins().postCreateOtherEntity,this.readyUpdateHp),this.observe(UserTask.ins().postParabolicItem,this.runItem),this.observe(UserBag.ins().postItemCountChange,this.showBagBtnRedPoint),this.observe(ForgeRedPoint.ins().postForgeRedPoint,this.showForgingBtnRedPoint),this.observe(UserBag.ins().postBagWillFull,this.setBagTips),this.observe(UserBag.ins().postHasItemCanUse,this.setIsExitUsedItem),this.observe(UserBoss.ins().postBossAppear,this.onBossAppear),this.observe(MonsterSpeak.ins().postMonsterSpeak,this.onMonsterSpeak),this.observe(UserFb.ins().postExpFly,this.flyExpToBar),this.observe(Encounter.ins().postFightResult,this.onFightResult),this.observe(NeiGong.ins().postNeiGongDataChange,this.startUpdateRedPoint),this.observe(UserJingMai.ins().postUpdate,this.startUpdateRedPoint),this.observe(UserBag.ins().postItemAdd,this.startUpdateRedPoint),this.observe(UserZs.ins().postZsData,this.startUpdateRedPoint),this.observe(Actor.ins().postLevelChange,this.startUpdateRedPoint),this.observe(Actor.ins().postGoldChange,this.startUpdateRedPoint),this.observe(UserSkill.ins().postSkillUpgradeAll,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingComposeItem,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingInfo,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingUpExp,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingDrug,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingWear,this.startUpdateRedPoint),this.observe(GameLogic.ins().postViewOpen,this.checkViewOpen),this.observe(UserBag.ins().postItemAdd,this.setLilianRedPoint),this.observe(LiLian.ins().postLilianData,this.setLilianRedPoint),this.observe(LiLian.ins().postNobilityData,this.setLilianRedPoint),this.observe(UserTask.ins().postTaskChangeData,this.setLilianRedPoint),this.observe(Artifact.ins().postNewArtifactUpdate,this.setLilianRedPoint),this.observe(Artifact.ins().postNewArtifactInit,this.setLilianRedPoint),this.observe(BookRedPoint.ins().postRedPoint,this.setLilianRedPoint),this.observe(Actor.ins().postLevelChange,this.setLilianRedPoint),this.observe(LiLian.ins().postJadeLv,this.setLilianRedPoint),this.observe(UserBag.ins().postItemChange,this.setLilianRedPoint),this.observe(UserSkill.ins().postHejiRemove,this.resetHejiCd),this.observe(UserSkill.ins().postHejiStartCD,this.resetHejiCd),this.observe(UserSkill.ins().postHejiUpdate,this.checkHejiOpen),this.observe(LiLian.ins().postGetLilianReward,this.lilianRewardFlash),this.observe(Guild.ins().postGuildCreate,this.setRedPiont),this.observe(Guild.ins().postProcessJoin,this.setRedPiont),this.observe(GameLogic.ins().postFlyItem,this.flyItemToBag),this.observe(GameLogic.ins().postFlyItemEx,this.flyItemToBagEx),this.observe(Recharge.ins().postRecharge1Data,this.setRedPiont),this.observe(UserBag.ins().postItemAdd,this.setRedPiont),this.observe(UserBag.ins().postItemDel,this.setRedPiont),this.observe(UserBag.ins().postItemChange,this.setRedPiont),this.observe(GameLogic.ins().postEnterMap,this.cleanPowerGuilderEff),this.hpBall.playFile(RES_DIR_EFF+"hpeff",-1),this.mpBall.playFile(RES_DIR_EFF+"mpeff",-1),this.hPGroup.addChildAt(this.hpBall,0),this.hPGroup.addChildAt(this.mpBall,0),this.hpLineMc.playFile(RES_DIR_EFF+"hpsxeff",-1),this.mpLineMc.playFile(RES_DIR_EFF+"mpsxeff",-1),this.hPGroup.addChildAt(this.hpLineMc,0),this.hPGroup.addChildAt(this.mpLineMc,0),this.powerGroup.addChildAt(this.circleImg,1),this.powerGroup.addChild(this._shap),this.circleImg.mask=this._shap,this.checkHejiOpen(),UserSkill.ins().hejiLevel>0&&UserSkill.ins().postHejiStartCD(),this.startUpdateRedPoint(),this.showForgingBtnRedPoint()},e.prototype.checkHejiOpen=function(){UserSkill.ins().hejiLevel>0?(this.powerGroup.touchEnabled=!0,this.circleImg.playFile(RES_DIR_EFF+"hejianniueff",-1),this.powerImg.visible=!0,this.lockImg.visible=!1,this.powerImg.source=UserSkill.ins().getHejiSkillIdIcon(),this.powerImg.scaleX=.55,this.powerImg.scaleY=.55):(this.powerGroup.touchEnabled=!1,this.powerImg.visible=!1,this.lockImg.visible=!0)},e.prototype.checkViewOpen=function(t){void 0===t&&(t=0),1==t?(this.backBtnGroup.visible=!0,this.powerGroup.visible=!1,this.backMc.parent||(this.backMc.playFile(RES_DIR_EFF+"fanhuibtneff",-1),this.backBtnGroup.addChild(this.backMc))):(this.backBtnGroup.visible=!1,this.powerGroup.visible=!0,DisplayUtils.removeFromParent(this.backMc)),this.checkShowHejiIcon(t)},e.prototype.checkShowHejiIcon=function(t){2==Artifact.ins().openHeji&&(0==t?TimerManager.ins().doTimer(50,1,this.showHejiIcon,this):TimerManager.ins().remove(this.showHejiIcon,this))},e.prototype.showHejiIcon=function(){if(2==Artifact.ins().openHeji&&UserSkill.ins().hejiLevel>0){var t=SubRoles.ins().getSubRoleByIndex(0);if(!t)return;Artifact.ins().openHeji=-1;var e=t.job,i=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel],s=new SkillData(i.skill_id[e-1]),n=new eui.Image(s.id+"_png");n.anchorOffsetX=32,n.anchorOffsetY=32,n.scaleX=4,n.scaleY=4,n.x=this.width/2,n.y=this.height/2,this.addChild(n);var o=this.powerGroup.x+this.powerGroup.width/2,a=this.powerGroup.y+this.powerGroup.height/2;egret.Tween.get(n).to({scaleX:1,scaleY:1},200).to({x:o,y:a},600).to({scaleX:0,scaleY:0},200).call(function(){n.parent.removeChild(n)})}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this)},e.prototype.showRoleBtnRedPoint=function(t){this.roleBtn.redPoint.visible=t>0},e.prototype.showBagBtnRedPoint=function(t){this.isItemCountChange=t>0,this.setRedPiont()},e.prototype.showForgingBtnRedPoint=function(){this.forgingBtn.redPoint.visible=ForgeRedPoint.ins().redPoint},e.prototype.setLilianRedPoint=function(){var t=LiLian.ins(),e=LiLian.ins().getNobilityIsMaxLevel(),i=t.getLilianShenGongStast()||Artifact.ins().showRedPoint()||t.checkXunZhangOpen()&&t.getNobilityIsUpGrade()&&!e||Artifact.ins().showRedPoint()||BookRedPoint.ins().redpoint||t.checkJadeRed();this.taskBtn.redPoint.visible=i},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:SoundUtil.ins().playEffect(SoundUtil.WINDOW);var e=ViewManager.ins().getView(RoleWin);e&&e.getWingPanelInfo()?e.doOpenHintWin(2):ViewManager.ins().closeLastTopView();break;case this.lockImg:UserTips.ins().showTips("闯关达到"+UserSkill.ACTIVE_LEVEL+"开启合击");break;case this.powerImg:case this.powerGroup:if(UserSkill.ins().hejiLevel<=0)return;if(!this.hjMc||!this.hjMc.parent)return void UserTips.ins().showTips("怒气未满，无法释放合击");this.cleanPowerGuilderEff();var i=this.useHejiSkill();-1==i?UserTips.ins().showTips("释放距离过远，无法释放"):-2==i?UserTips.ins().showTips("请先选择攻击目标"):-3==i&&UserTips.ins().showTips("麻痹状态中，无法释放");break;default:var s=this.navBtn.indexOf(t.currentTarget);if(this.navBtn[s].selected){var n=this.openWindow(s);n||(this.navBtn[s].selected=!1)}else this.closeWindow(s);for(var o=0;o<this.navBtn.length;o++)s!=o&&this.closeWindow(o)}},e.prototype.useHejiSkill=function(){if(UserSkill.ins().hejiEnable&&this.canClick){var t=UserSkill.ins().getHejiSkillId(),e=EntityManager.ins().getNoDieRole();if(!e)return;var i=EntityManager.ins().screeningTargetByPos(e,!1,t.affectCount,t.castRange);if(!i||0==i.length)return-1;if(GameMap.fbType==UserFb.FB_TYPE_GUILD_WAR||GameMap.fbType==UserFb.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==UserFb.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==UserFb.FB_TYPE_HOMEBOSS||CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian){var s=GameLogic.ins().currHandle,n=EntityManager.ins().getEntityByHandle(s);if(!s||!n||n.infoModel.getAtt(AttributeType.atHp)<=0)return-2}if(this.canClick=!1,TimerManager.ins().doTimer(50,1,this.setClickDelay,this),0==GameMap.fubenID||GameMap.sceneInMine())UserSkill.ins().fieldUse=!0;else{for(var o=SubRoles.ins().subRolesLen,a=void 0,r=!1,h=0;o>h&&(a=EntityManager.ins().getMainRole(h),!(a&&a.infoModel&&a.infoModel.getAtt(AttributeType.atHp)>0));h++);if(a.hasEffById(1)&&(r=!0),r||a.hasBuff(51001)||a.hasBuff(14001)||a.hasBuff(70001))return-3;UserSkill.ins().sendUseHejiSkill()}}},e.prototype.setClickDelay=function(){this.canClick=!0},e.prototype.openWindow=function(t){return KFServerSys.ins().checkIsKFBattle("跨服战场内，无法操作!")?void 0:ViewManager.ins().open(this.navBind[t])},e.prototype.closeWindow=function(t){ViewManager.ins().close(this.navBind[t])},e.prototype.expChange=function(t,e){var i=this;if(void 0===e&&(e=!1),e||GameMap.fbType!=UserFb.FB_TYPE_GUANQIABOSS&&GameMap.fbType!=UserFb.FB_TYPE_TIAOZHAN){this.lastLevel||(this.lastLevel=Actor.level);var s=0==this.flyExpLevel.length;this.flyExpLevel.length?(this.flyExpLevel[this.flyExpLevel.length-1][0]=Actor.level,this.flyExpLevel[this.flyExpLevel.length-1][1]=Actor.exp):this.flyExpLevel.push([Actor.level,Actor.exp]);var n=this.flyExpLevel[0][0],o=this.flyExpLevel[0][1];if(this.lastLevel<n){if(!this.expBar.tween_count||s){var a=GlobalConfig.ExpConfig[this.lastLevel].exp;egret.Tween.removeTweens(this.expBar);var r=egret.Tween.get(this.expBar);r.to({value:this.expBar.maximum},300).wait(100).call(function(){i.expBar.maximum=a,i.expBar.value=0,i.lastLevel+=1,GameLogic.ins().postLevelBarChange(i.lastLevel),SoundUtil.ins().playEffect(SoundUtil.LEVEL_UP),i.expChange()},this)}}else{egret.Tween.removeTweens(this.expBar);var h=GlobalConfig.ExpConfig[n].exp;this.expBar.maximum!=h&&(this.expBar.maximum=h);var r=egret.Tween.get(this.expBar);r.to({value:o},400),this.flyExpLevel.shift()}}},e.prototype.closeNav=function(t){this.navBtn[t].selected=!1},e.prototype.updateHuShen=function(t){if(!t||t.team==Team.My){for(var e,i=SubRoles.ins().subRolesLen,s=0,n=0,o=0;i>o;o++)e=SubRoles.ins().getSubRoleByIndex(o),s+=e.getAtt(AttributeType.atMp),n+=e.getAtt(AttributeType.atMaxMp);var a=this.mpBall.mask;s>n&&(s=n),a.y=-53+106*(1-s/n),this.mpLineMc.y=a.y+35}},e.prototype.onBossAppear=function(){GameMap.fbType!=UserFb.FB_TYPE_HUN_SHOU&&this.showEffectTips("zdbossskin_json.bosstishi")},e.prototype.onMonsterSpeak=function(t){this.showEffectTips(t)},e.prototype.onFightResult=function(t){t?this.showEffectTips("pktishi_png"):this.showEffectTips("pktishi1_png")},e.prototype.showEffectTips=function(t){var e=this;this.tips.source=t,egret.Tween.removeTweens(this.tips),this.tips.visible=!0,this.tips.alpha=1,egret.Tween.get(this.tips).wait(4e3).to({alpha:0},1e3).call(function(){e.tips.visible=!1})},e.prototype.readyUpdateHp=function(t){if(t){if(t instanceof EntityModel){if(!t.isMy)return}else if(!t[0].isMy)return;this.updateHp()}},e.prototype.updateHp=function(){for(var t=SubRoles.ins().subRolesLen,e=0,i=0,s=0;t>s;s++){var n=SubRoles.ins().getSubRoleByIndex(s);if(n){var o=n.getAtt(AttributeType.atHp)||0,a=n.getAtt(AttributeType.atMaxHp)||0;e+=o,i+=a}}var r=this.hpBall.mask;e>i&&(e=i),r.y=-53+106*(1-e/i),this.hpLineMc.y=r.y+35},e.prototype.lilianUpgradeSuccess=function(t){for(var e=this,i=function(i){var s=new eui.Image;s.source=t[i],s.x=261+63*i,s.y=200,e.addChild(s),s.visible=!1;var n=egret.Tween.get(s);n.wait(130*i).to({visible:!0},1).to({x:326,y:730},900).call(function(){e.removeChild(s)})},s=0;3>s;s++)i(s)},e.prototype.lilianGetRankSuccess=function(t){var e=this,i=new eui.Image;i.source=t,i.x=260,i.y=100,this.addChild(i);var s=egret.Tween.get(i);s.to({x:326,y:730},1e3).call(function(){e.removeChild(i)})},e.prototype.runItem=function(){var t=UserTask.ins().taskTrace,e=UserTask.ins().getAchieveConfById(t.id).awardList;this.runStrat(e,0)},e.prototype.runStrat=function(t,e){var i=this,s="";if(0==t[e].type)switch(t[e].id){case MoneyConst.exp:s="";break;case MoneyConst.gold:s="icgoods117_png";break;case MoneyConst.yuanbao:s="icgoods121_png"}else s=""+t[e].id+"_png";this.taskItemImg.visible=!0,this.taskItemImg.source=s;var n=this;this.tweenTaskObj||(this.tweenTaskObj={get factor(){return 0},set factor(t){n.taskItemImg.x=(1-t)*(1-t)*250+2*t*(1-t)*380+t*t*426,n.taskItemImg.y=(1-t)*(1-t)*730+2*t*(1-t)*630+t*t*820}}),egret.Tween.removeTweens(this.tweenTaskObj);var o=egret.Tween.get(this.tweenTaskObj);o.to({factor:1},400).call(function(){if(i.taskItemImg.visible=!1,t.length>++e){var s=SubRoles.ins().getSubRoleByIndex(0);t[e].job?t[e].job==s.job&&i.runStrat(t,e):i.runStrat(t,e)}},this)
},e.prototype.setBagTips=function(t){return this.bagBtn.visible?(this.groupBagTips.visible=t>0,void(t&&(2==t?this.tipsText.text="有装备可以熔炼":this.tipsText.text="背包将满，请熔炼"))):void(this.groupBagTips.visible=!1)},e.prototype.setIsExitUsedItem=function(t){this.isExitUsedItem=UserBag.ins().getIsExitUsedItem(),this.setRedPiont()},e.prototype.setRedPiont=function(t){return t?void(this.bagBtn.redPoint.visible=t):void(this.isExitUsedItem||this.isItemCountChange||UserBag.ins().getBagGoodsCountByType(8)||UserBag.ins().getBagGoodsCountByType(12)||UserBag.ins().getRuneBagGoodsCountByType(8)||MergeCC.ins().isOpen()&&MergeCC.ins().redPoint()?this.bagBtn.redPoint.visible=!0:this.bagBtn.redPoint.visible=!1)},e.prototype.resetHejiCd=function(){this.reset(),DisplayUtils.removeFromParent(this.hjMc),this._shap.graphics.clear(),TimerManager.ins().isExists(this.showAni,this)||TimerManager.ins().doTimer(500,0,this.showAni,this),this.drawProgress(0)},e.prototype.reset=function(){this._curAngle=0,this._toAngle=0,this._oldAngle=360,UserSkill.ins().hejiEnable=!1,UserSkill.ins().fieldUse=!1,this.radius=this.powerGroup.width>>1},e.prototype.showAni=function(){var t=UserSkill.ins().getHejiSkillId(),e=1-(UserSkill.ins().hejiCD-GameServer.serverTime)/(t.cd-UserSkill.ins().reduceCD),i=360*e;this.drawProgress(i)},e.prototype.drawProgress=function(t,e){return void 0===e&&(e=!0),t>360&&(t=360),0>t&&(t=0),0==t||360==this.curAngle?(360==this.curAngle&&(UserSkill.ins().hejiEnable=!0,this.addAutoUse(),this.addPowerEff()),void egret.Tween.removeTweens(this)):(this.removeAutoUse(),this._toAngle=t,this._shap.x=this._shap.y=this.radius,this._shap.rotation=-90,egret.Tween.removeTweens(this),void egret.Tween.get(this).to({curAngle:this._toAngle},500).call(function(){360==this.curAngle&&(UserSkill.ins().hejiEnable=!0,this.addAutoUse())},this))},e.prototype.addPowerEff=function(){this.hjMc.playFile(RES_DIR_EFF+"hejibtn",-1),this.hjMc&&this.hjMc.parent||(this.powerGroup.addChild(this.hjMc),this.powerGuilderEff())},e.prototype.powerGuilderEff=function(){if(UserFb.ins().guanqiaID>16)return void this.cleanPowerGuilderEff();if(!UserFb.ins().pkGqboss)return void this.cleanPowerGuilderEff();if(!this.arrow){this.arrow=new GuideArrow,this.arrow.touchEnabled=!1,this.arrow.lab.text="点击释放合击",this.powerGroup.addChild(this.arrow),this.arrow.x=0,this.arrow.y=this.powerGroup.height/2,this.eff||(this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"guideff",-1),this.powerGroup.addChild(this.eff),this.eff.x=this.powerGroup.width/2,this.eff.y=this.powerGroup.height/2);var t=this;egret.Tween.get(this.arrow,{loop:!0}).to({x:this.arrow.x+40},1e3).to({x:this.arrow.x},1e3),egret.Tween.get(this.powerGroup,{loop:!1}).wait(5e3).call(function(){t.cleanPowerGuilderEff()})}},e.prototype.cleanPowerGuilderEff=function(){this.arrow&&egret.Tween.removeTweens(this.arrow),this.eff&&egret.Tween.removeTweens(this.eff),DisplayUtils.removeFromParent(this.arrow),DisplayUtils.removeFromParent(this.eff),this.removeAutoUse(),this.arrow=null,this.eff=null},e.prototype.addAutoUse=function(){UserSkill.ins().hejiEnable&&this.checkIsAutoUse()&&(TimerManager.ins().isExists(this.autoUseHeji,this)||TimerManager.ins().doTimer(400,0,this.autoUseHeji,this))},e.prototype.checkIsAutoUse=function(){var t=GameLogic.ins().currHandle,e=EntityManager.ins().getEntityByHandle(t);return GameMap.autoPunch()&&e&&e.infoModel.type!=EntityType.CollectionMonst&&Setting.ins().getValue(ClientSet.autoHeji)||SysSetting.ins().getBool(SysSetting.AUTO_HEJI)&&GameMap.fbType!=UserFb.FB_TYPE_HOMEBOSS&&GameMap.fbType!=UserFb.FB_TYPE_NEW_WORLD_BOSS&&GameMap.fbType!=UserFb.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=UserFb.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=UserFb.FB_TYPE_GUILD_WAR&&GameMap.fbType!=UserFb.FB_TYPE_PEAKED&&GameMap.fbType!=UserFb.FB_TYPE_KF_BOSS&&!CityCC.ins().isCity&&!BattleCC.ins().isBattle()&&!PaoDianCC.ins().isPaoDian&&!GwBoss.ins().isGwBoss&&!GwBoss.ins().isGwTopBoss&&!DarkMjBoss.ins().isDarkBoss},e.prototype.removeAutoUse=function(){TimerManager.ins().remove(this.autoUseHeji,this)},e.prototype.autoUseHeji=function(){this.useHejiSkill()},Object.defineProperty(e.prototype,"curAngle",{get:function(){return this._curAngle},set:function(t){this._curAngle=t,DisplayUtils.drawCir(this._shap,this.radius,this._curAngle)},enumerable:!0,configurable:!0}),e.prototype.jingMaiCanUp=function(){var t;for(var e in SubRoles.ins().roles)if(t=SubRoles.ins().roles[e].jingMaiData,t.jingMaiCanUp()){var i=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level>=i)return!0}return!1},e.prototype.getToggleBtn=function(t){return this.validateNow(),this.navBtn[t]},e.prototype.lilianRewardFlash=function(t){for(var e=this,i=t.length,s=function(i){var s=new eui.Image;s.source=t[i],s.x=74+91*i,s.y=260,e.addChild(s),s.visible=!1,s.scaleX=s.scaleY=1;var n=egret.Tween.get(s);n.wait(130*i).to({visible:!0},1).to({x:441,y:872,scaleX:.6,scaleY:.6},900).call(function(){e.removeChild(s)})},n=0;i>n;n++)s(n)},e.prototype.startUpdateRedPoint=function(){TimerManager.ins().isExists(this.updateRedPoint,this)||TimerManager.ins().doTimer(50,1,this.updateRedPoint,this)},e.prototype.updateRedPoint=function(){var t=!1;UserFb.ins().guanqiaID>2&&(this.and(UserSkill.ins().canGrewupSkill())||NeiGongModel.ins().canUp()||this.jingMaiCanUp())&&(t=!0),t||(t=UserMiji.ins().isMjiSum()),t||(t=ZhanLing.ins().checkRedPoint()),this.furnaceBtn.redPoint.visible=t},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.getBagBtn=function(){return this.bagBtn},e.prototype.flyGQBossExpToBar=function(t){var e=this,i=(t[0],t[1]);if(!(GameMap.fbType||i>0)){var s=new eui.Image;s.source="point2",s.anchorOffsetX=20,s.anchorOffsetY=20,s.x=100,s.y=100,this.addChild(s);var n=Math.ceil(StageUtils.ins().getWidth()/2),o=Math.ceil(StageUtils.ins().getHeight())+60,a=egret.Tween.get(s);a.to({x:n,y:o,alpha:.5},800).call(function(){e.removeChild(s),egret.Tween.removeTweens(s)},this);var r=egret.Tween.get(s,{loop:!0});r.to({rotation:s.rotation+360},800)}},e.prototype.flyExpToBar=function(t){for(var e=this,i=t[0],s=t[1],n=t[2],o=this.globalToLocal(i.x,i.y),a=this.expBar.x+this.expBar.width/2,r=this.expBar.y,h=new egret.Point(a,r),l=function(t){var i=egret.Point.interpolate(o,h,MathUtils.limit(.2,.8));i.x+=MathUtils.limitInteger(-100,100),i.y+=MathUtils.limitInteger(-100,100);var s=new eui.Image;s.source="point2",s.anchorOffsetX=20,s.anchorOffsetY=20,s.x=o.x,s.y=o.y,c.addChild(s);var a=Bezier.pop(o,h);a.display=s,a.centerPoint=i,a.start(1e3,function(){Bezier.push(a),e.removeChild(s),egret.Tween.removeTweens(s),t||e.expChange(0,!0)},c,t*n),egret.Tween.get(s).to({alpha:.5},1e3);var r=egret.Tween.get(s,{loop:!0});r.to({rotation:s.rotation+360},500)},c=this,u=0;s>u;u++)l(u)},e.prototype.flyItemToBag=function(t){var e=t.item,i=t.gp;if(ViewManager.ins().hasTopView()){var s=this.bagBtn.parent.localToGlobal(this.bagBtn.x+this.bagBtn.width/2,this.bagBtn.y+this.bagBtn.height/2);e.reset(),e.setItemParent(this),e.x=i.x,e.y=i.y,egret.Tween.get(e).to({x:s.x,y:s.y},1700,egret.Ease.sineOut).call(function(){DisplayUtils.removeFromParent(e),e.destruct(),ObjectPool.push(e)})}},e.prototype.flyItemToBagEx=function(t){if(t.parent){var e=t.parent.localToGlobal(t.x,t.y),i=this.bagBtn.parent.localToGlobal(this.bagBtn.x+this.bagBtn.width/2-t.width/4,this.bagBtn.y+this.bagBtn.height/2-t.width/4);DisplayUtils.removeFromParent(t),t.x=e.x,t.y=e.y,this.addChild(t),egret.Tween.get(t).to({x:i.x,y:i.y},1700,egret.Ease.sineOut).call(function(){DisplayUtils.removeFromParent(t)})}else DisplayUtils.removeFromParent(t)},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.isHideNavBtn=function(t){for(var e=0,i=this.navBtn;e<i.length;e++){var s=i[e];s.visible=t}this.expBar.visible=t},e}(BaseEuiView);UIView2.NAV_ROLE=0,UIView2.NAV_SKILL=1,UIView2.NAV_LILIAN=2,UIView2.NAV_SMITH=3,UIView2.NAV_BAG=4,__decorate([callLater],UIView2.prototype,"setLilianRedPoint",null),__decorate([callLater],UIView2.prototype,"updateHp",null),__reflect(UIView2.prototype,"UIView2"),ViewManager.ins().reg(UIView2,LayerManager.UI_Popup);var GodWeaponCC=function(t){function e(){var e=t.call(this)||this;return e.curExp=0,e._firstExp=!0,e.weaponDataAry=[],e._isFirst=!1,e.exattrDesObj={43:"施放刺杀剑法附加吸血效果，恢复%s%%伤害值的生命",48:"白虎会吸收其他角色的亡魂，每死亡一个角色，其伤害提高%s%%",44:"攻击时有几率触发武神之怒效果",45:"攻击时有几率触发武神之怒效果",46:"攻击时有几率触发武神之怒效果",47:"白虎攻击时有10%机率狂暴，增加自身%s%%攻击力并且必暴击，持续3秒"},e.sysId=PackageID.GodWeapon,e.gwTask=new GwTaskData,e.regNetMsg(1,e.postUpdateExp),e.regNetMsg(2,e.postUpdateInfo),e.regNetMsg(6,e.postFubenInfo),e.regNetMsg(9,e.postRankInfo),e.regNetMsg(13,e.doGetAward),e.regNetMsg(10,e.postGwTask),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.createData=function(){0==this._isFirst&&(this.initData(),this._isFirst=!0)},e.prototype.initData=function(){this.maxSkillIdAry=[],this.weaponDataAry=[],this.allSkillData={},this.allSkillData2={},this.allGodItemData={};for(var t in GlobalConfig.GodWeaponLineConfig){var e={},i={},s=GlobalConfig.GodWeaponLineConfig[t];this.allSkillData[t]=e,this.allSkillData2[t]=i;var n=0;for(var o in s){var a=new GwSkillData;a.skillId=parseInt(o),a.skillLv=0,a.config=s[o],a.weaponId=parseInt(t),i[a.skillId]=a,e[a.config.skinId]=a,n++}this.maxSkillIdAry.push(n);for(var r=[],h=0;h<GlobalConfig.GodWeaponBaseConfig.weaponItemCount;h++){var l=new GwItem;l.pos=h+1,l.itemId=void 0,l.config=null,l.weaponId=parseInt(t),r.push(l)}this.allGodItemData[t]=r}this.gwSkillConfig={};for(var t in GlobalConfig.GWSkillReviseConfig){var s=GlobalConfig.GWSkillReviseConfig[t];this.gwSkillConfig[s.skill]||(this.gwSkillConfig[s.skill]={}),this.gwSkillConfig[s.skill][s.gwIndex]=s}},e.prototype.godWeaponIsOpen=function(){return UserZs.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay},e.prototype.getReviseBySkill=function(t){if(!this.allSkillData2)return null;var e=(""+t).charAt(0),i=this.allSkillData2[e];if(!i)return null;var s=Math.floor(t/1e3),n=[];for(var o in i){var a=i[o];if(a.config.skill==s){if(0==a.skillLv)continue;var r=a.skillLv+a.addLv,h=1e3*a.skillId+r;this.gwSkillConfig[s]&&this.gwSkillConfig[s][h]&&n.push(this.gwSkillConfig[s][h])}}return n},e.prototype.getJobGWNewSkill=function(t){if(!this.allSkillData2)return null;var e=this.allSkillData2[t];if(!e)return null;var i=SubRoles.ins().getSubRoleByJob(t);if(!i)return null;i.godWeaponSkills||(i.godWeaponSkills=[]);var s=0;for(var n in e){var o=e[n];if(o.config.newskill||o.config.passiveskill){var a=o.config.newskill||o.config.passiveskill,r=1e3*a+(o.skillLv+o.addLv);i.godWeaponSkills[s]=i.godWeaponSkills[s]||new SkillData(r),i.godWeaponSkills[s].configID=r,s+=1}}return i.godWeaponSkills},e.prototype.getWeaponSkinIdData=function(t,e){return this.allSkillData[t][e]},e.prototype.getWeaponSkillidData=function(t,e){return this.allSkillData2[t][e]},e.prototype.getGodItemData=function(t,e){return this.allGodItemData[t][e-1]},e.prototype.postUpdateExp=function(t){var e=this.curExp;this.curExp=t.readInt(),this._firstExp||this.curExp-e>0&&UserTips.ins().showTips("|C:0xffd93f&T:神兵经验  +"+(this.curExp-e)+"|"),this._firstExp=!1},e.prototype.postUpdateInfo=function(t){this.createData();for(var e,i=t.readInt(),s=0;i>s;s++)this.weaponDataAry[s]?(e=this.weaponDataAry[s],e.parse(t)):(e=new GodWeaponData(t),this.weaponDataAry.push(e));this.weaponDataAry.sort(function(t,e){return t.weaponId<e.weaponId?-1:1})},e.prototype.getWeaponData=function(t){if(this.weaponDataAry)for(var e=0,i=this.weaponDataAry;e<i.length;e++){var s=i[e];if(s.weaponId==t)return s}return null},e.prototype.upSkill=function(t,e){var i=this.getBytes(3);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.inlayItem=function(t,e,i){var s=this.getBytes(4);s.writeInt(t),s.writeInt(e),s.writeInt(i),this.sendToServer(s)},e.prototype.upWeapon=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.hadRedPoint=function(){this.createData();var t=!1;if(GameServer.serverOpenDay<GlobalConfig.GodWeaponBaseConfig.openDay)return t;if(GodWeaponRedPoint.ins().gwTaskRed)t=!0;else for(var e=0;e<this.weaponDataAry.length;e++)if(this.weaponDataAry[e]&&1==this.weaponDataAry[e].hasRedPoint||this.getSwRedPoint(this.weaponDataAry[e].weaponId)){t=!0;break}return t=t||this.mijintHadRedPoint()||this.maxLvRedPoint()},e.prototype.maxLvRedPoint=function(){if(!this.weaponDataAry)return!1;var t=this.weaponDataAry.concat();t.sort(function(t,e){return t.curLv-e.curLv});var i=t[t.length-1];return i&&i.config&&e.ins().curExp>=2*i.config.everyExp?!0:!1},e.prototype.mijintHadRedPoint=function(){return this.godWeaponIsOpen()&&this.fubenInfoData&&this.fubenInfoData.hadChallengeNum>0?!0:!1},e.prototype.getSwRedPoint=function(t){for(var e,i=this.allGodItemData[t],s=0;s<i.length;s++)if(e=i[s],e.isOpen&&!e.itemId&&GwShengWuChooseView.getGwItemType(e).length>0)return!0;return!1},e.prototype.gwAddAttr=function(t){var e=this.getWeaponData(t+1);if(!e)return[];var i,s=e.addAttr.concat(),n=0,o=0;for(n=0;n<this.maxSkillIdAry[t];n++)if(i=this.getWeaponSkillidData(t+1,n+1),i.skillLv+i.addLv>0&&i.config.attr)for(o=0;o<i.config.attr.length;o++){var a={value:0,type:0};a.value=i.config.attr[o].value*(i.skillLv+i.addLv),a.type=i.config.attr[o].type,s.push(a)}var r=this.allGodItemData[t+1];for(n=0;n<r.length;n++)if(r[n].itemId)for(o=0;o<r[n].config.attr.length;o++){var a={value:0,type:0};a.value=r[n].config.attr[o].value,a.type=r[n].config.attr[o].type,s.push(a)}var h=[];for(n=0;n<s.length;n++){var l=!1;for(o=0;o<h.length;o++){if(h[o].type==s[n].type){h[o].value+=s[n].value,l=!1;break}l=!0}if(1==l||0==h.length){var a={value:s[n].value,type:s[n].type};h.push(a)}}return h},e.prototype.postFubenInfo=function(t){this.fubenInfoData||(this.fubenInfoData=new GwFubenData),this.fubenInfoData.parse(t)},e.prototype.postRankInfo=function(t){this.rankInfoDataAry||(this.rankInfoDataAry=[]);for(var e,i=t.readInt(),s=0;i>s;s++)e=this.rankInfoDataAry[s],e||(e=new GwRankInfoData,this.rankInfoDataAry[s]=e),e.parse(t);this.rankInfoDataAry.sort(this.sortFun)},e.prototype.sortFun=function(t,e){return t.rank-e.rank},e.prototype.postGwTask=function(t){this.gwTask.parser(t)},e.prototype.requestFubenInfo=function(){var t=this.getBytes(6);this.sendToServer(t)},e.prototype.joinFuben=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.buybuff=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.requestRanInfo=function(){var t=this.getBytes(9);this.sendToServer(t)},e.prototype.doGetAward=function(t){var e=t.readByte(),i=t.readByte();ViewManager.gamescene&&(ViewManager.gamescene.removeMiingTimeFun(),ViewManager.gamescene.setMJPingfen(i)),e?ViewManager.ins().open(GwResultView,GameMap.fubenID,i,UserFb.ins().mijingUseTime):ViewManager.ins().open(GwResultView,GameMap.fubenID,4)},e.prototype.requestGetAward=function(){var t=this.getBytes(13);this.sendToServer(t)},e.prototype.requestReceiveTask=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.requestActiveWeapon=function(){this.sendBaseProto(12)},e.prototype.getPinfenTime=function(t){var e;if(!this._timeMijinAry){this._timeMijinAry=[];for(var i in GlobalConfig.GodWeaponBaseConfig.fbGrade)e?(this._timeMijinAry.push(GlobalConfig.GodWeaponBaseConfig.fbGrade[i]-e),e=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]):(e=GlobalConfig.GodWeaponBaseConfig.fbGrade[i],this._timeMijinAry.push(e))}return this._timeMijinAry[t]},e.prototype.weaponIsActive=function(t){if(this.createData(),this.weaponDataAry)for(var e=0,i=this.weaponDataAry;e<i.length;e++){var s=i[e];if(s.weaponId==t)return!0}return!1},e.prototype.taskIsOpen=function(){return GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay?!0:!1},e.prototype.sendReset=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e}(BaseSystem);__reflect(GodWeaponCC.prototype,"GodWeaponCC");var GameSystem;!function(t){t.godWeaponCC=GodWeaponCC.ins.bind(GodWeaponCC)}(GameSystem||(GameSystem={}));var GodWeaponItemCC=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.GodWeaponItem,e.regNetMsg(1,e.postCompound),e.regNetMsg(2,e.postFuse),e}return __extends(e,t),e.prototype.requestCompound=function(t,e,i){var s=this.getBytes(1);s.writeInt(t),s.writeInt(e),s.writeInt(i),this.sendToServer(s)},e.prototype.postCompound=function(t){var e=t.readBoolean(),i=(t.readShort(),t.readInt());return{id:i,isSuccess:e}},e.prototype.requestFuse=function(t,e,i){var s=this.getBytes(2);s.writeInt(t),s.writeInt(e),s.writeShort(i),this.sendToServer(s)},e.prototype.postFuse=function(t){var e=t.readBoolean(),i=0;if(e){t.readShort();i=t.readInt()}return{id:i,isSuccess:e}},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(GodWeaponItemCC.prototype,"GodWeaponItemCC");var GameSystem;!function(t){t.godWeaponItemCC=GodWeaponItemCC.ins.bind(GodWeaponItemCC)}(GameSystem||(GameSystem={}));var GodWeaponData=function(){function t(t){this.parse(t)}return t.prototype.parse=function(t){if(this.weaponId=t.readInt(),this.curLv=t.readInt(),this.curExp=t.readInt(),this.skillPoint=t.readInt(),this.openCount=t.readInt(),this.openCount<=0&&this.openSkillAry&&this.openSkillAry.length>0)for(var e=this.openSkillAry.length,i=0;e>i;i++)this.openSkillAry[i].skillLv=0;this.openSkillAry=[];for(var s,n,i=0;i<this.openCount;i++)n=t.readInt(),s=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,n),s.addLv=0,s.skillLv=t.readInt(),this.openSkillAry.push(s);for(var o in GodWeaponCC.ins().allSkillData2[this.weaponId])0==GodWeaponCC.ins().allSkillData2[this.weaponId][o].skillLv&&(GodWeaponCC.ins().allSkillData2[this.weaponId][o].addLv=0);this.inlayCount=t.readInt();for(var a,r,i=0;i<this.inlayCount;i++){r=t.readInt(),a=GodWeaponCC.ins().getGodItemData(this.weaponId,r),a.itemId=t.readInt();for(var h=0;h<a.config.skill.length;h++){var l=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,a.config.skill[h]);l.addLv+=1}}this.config=GlobalConfig.GodWeaponLevelConfig[this.curLv]},Object.defineProperty(t.prototype,"hasRedPoint",{get:function(){return this.skillPoint>0?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"addAttr",{get:function(){return null==this.config["attr"+this.weaponId]?[]:this.config["attr"+this.weaponId]},enumerable:!0,configurable:!0}),t.prototype.getResetPoint=function(){for(var t=this.openSkillAry?this.openSkillAry.length:0,e=0,i=0;t>i;i++)e+=this.openSkillAry[i].skillLv;return e},t.prototype.getWeaponName=function(){switch(this.weaponId){case 1:return"雷霆怒斩";case 2:return"赤血魔剑";case 3:return"无极逍遥扇"}return""},t}();__reflect(GodWeaponData.prototype,"GodWeaponData");var GwSkillData=function(){function t(t,e){this._skillLv=0,this.addLv=0,this.skillId=t,this.skillLv=e}return Object.defineProperty(t.prototype,"skillLv",{get:function(){return this._skillLv},set:function(t){this._skillLv=t},enumerable:!0,configurable:!0}),t.prototype.lvLabel=function(t){void 0===t&&(t=!1);var e,i=this._skillLv+this.addLv;return e=this.isOpen?this.config.upLevel+this.addLv:0!=this._skillLv?this.config.upLevel+this.addLv:this.addLv,t?""+i:i+"/"+e},Object.defineProperty(t.prototype,"skillPower",{get:function(){var t=this.config.exPower||0,e=this._skillLv+this.addLv;return t*e},enumerable:!0,configurable:!0}),t.prototype.addAttrValyeType=function(t){var e="";if(this.config.attr)for(var i=0;i<this.config.attr.length;i++)e.length>0&&(e+="\n"),e+=AttributeData.getAttrStrByType(this.config.attr[i].type)+"提升"+('<font color="#35E62D">'+this.config.attr[i].value*t+"</font>");return e},t.prototype.addExAttrstr=function(t){var e="";if(this.config.exattr)for(var i="",s="",n=0;n<this.config.exattr.length;n++){switch(e.length>0&&(e+="\n"),i=GodWeaponCC.ins().exattrDesObj[this.config.exattr[n].type],this.config.exattr[n].type){case 43:case 48:s='<font color="#35E62D">'+this.config.exattr[n].value*t/100+"</font>";break;case 44:case 45:case 46:s='<font color="#35E62D">'+(1+this.config.exattr[n].value*t/100)+"</font>";break;case 47:var o=GlobalConfig.EffectsConfig[100400+this.config.exattr[n].value*t];o&&o.args&&(s='<font color="#35E62D">'+100*o.args.a+"</font>")}i=i.replace("%s%",s),e+=i}return e},t.prototype.addatrStr=function(t){this._addStr="";var e=t+this.addLv;this._addStr+=this.addAttrValyeType(e),this._addStr+=this.addExAttrstr(e);var i,s;return this.config.newskill&&(i=1e3*this.config.newskill+e,s=new SkillData(i),this._addStr.length>0&&(this._addStr+="\n"),this._addStr+=this.getSkillDataDes(s)),this.config.passiveskill&&(i=1e3*this.config.passiveskill+e,s=new SkillData(i),this._addStr.length>0&&(this._addStr+="\n"),this._addStr+=this.getSkillDataDes(s)),this._addStr+=this.specialSkill(e),this._addStr},t.prototype.getSkillDataDes=function(t){var e=t.config||GlobalConfig.SkillsConfig[t.lv1ConfigID];if(Assert(e,"技能id:"+t.configID+"找不到配置"))return"";var i=GlobalConfig.SkillsDescConfig[e.desc],s=i?i.desc:"";if(!s.length||!e.desc_ex)return s;for(var n=e.desc_ex.length,o=0;n>o;o++)s=s.replace("%s%",'<font color="#35E62D">'+e.desc_ex[o]+"</font>");return s},t.prototype.specialSkill=function(t){var e=t+this.addLv,i="";if(this.config.skill){var s=void 0,n=1e3*this.skillId+e;for(var o in GlobalConfig.GWSkillReviseConfig)if(s=GlobalConfig.GWSkillReviseConfig[o],s.skill==this.config.skill&&s.gwIndex==n){i=s.desc;break}}return i},Object.defineProperty(t.prototype,"isOpen",{get:function(){var t=!0;if(this.config.condition){for(var e in this.config.condition){var i=void 0;if(i=0==parseInt(e)?GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(e)+1):GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(e)),i.skillLv<this.config.condition[e]){t=!1;break}}return t}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openTip",{get:function(){if(!this._openTip)if(this._openTip="",this.skillId==GodWeaponCC.ins().maxSkillIdAry[this.weaponId-1])this._openTip="所有技能满级后解锁";else for(var t in this.config.condition){var e=void 0;e=0==parseInt(t)?GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(t)+1):GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(t)),this._openTip.length>0&&(this._openTip+="\n"),this._openTip+=e.config.skillName+("达到"+this.config.condition[t]+"解锁")}return this._openTip},enumerable:!0,configurable:!0}),t}();__reflect(GwSkillData.prototype,"GwSkillData");var GwItem=function(){function t(){this.isCur=!1}return Object.defineProperty(t.prototype,"itemId",{get:function(){return this._itemId},set:function(t){this._itemId=t,this.config=GlobalConfig.GodweaponItemConfig[this.itemId],this.itemConfig=GlobalConfig.ItemConfig[this.itemId]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openLv",{get:function(){return GlobalConfig.GodWeaponBaseConfig.openLevel[this.pos-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpen",{get:function(){var t=GodWeaponCC.ins().getWeaponData(this.weaponId);return t&&t.curLv<this.openLv?!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"addatrStr",{get:function(){if(null==this._addStr){this._addStr="";for(var t=0;t<this.config.attr.length;t++)this._addStr.length>0&&(this._addStr+="\n"),this._addStr+=AttributeData.getAttrStrByType(this.config.attr[t].type)+" +"+this.config.attr[t].value}return this._addStr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillName",{get:function(){if(null==this._skillName){this._skillName="";for(var t=0;t<this.config.skill.length;t++)this._skillName.length>0&&(this._skillName+="、"),this._skillName+=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,this.config.skill[t]).config.skillName}return this._skillName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillPower",{get:function(){if(!this._skillPower){this._skillPower=0;for(var t=void 0,e=0;e<this.config.skill.length;e++)if(t=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,this.config.skill[e]),t.config.exPower&&(this._skillPower+=t.config.exPower),t.config.attr){for(var i=[],s=0;s<t.config.attr.length;s++)i.push(new AttributeData(t.config.attr[s].type,t.config.attr[s].value));this._skillPower+=UserBag.getAttrPower(i)}}return this._skillPower},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){if(!this._power){this._power=0,this._power+=this.skillPower;for(var t=[],e=0;e<this.config.attr.length;e++)t.push(new AttributeData(this.config.attr[e].type,this.config.attr[e].value));this._power+=UserBag.getAttrPower(t)}return this._power},enumerable:!0,configurable:!0}),t}();__reflect(GwItem.prototype,"GwItem");var GodweaponItemData=function(){function t(t,e,i){this.id=t,this.count=e,this.quality=i}return t}();__reflect(GodweaponItemData.prototype,"GodweaponItemData");var GodweaponItemModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.init=function(){if(!this._qualityItemMap&&!this._jobItemMap){this._qualityItemMap={},this._jobItemMap={};for(var t in GlobalConfig.GodweaponItemConfig){var e=GlobalConfig.GodweaponItemConfig[t],i=GlobalConfig.ItemConfig[e.id],s=ItemConfig.getQuality(i);if(4>s){var n=this._qualityItemMap[s];void 0==n&&(n=[]),n.push(e.id),this._qualityItemMap[s]=n}else if(4==s&&(!e.skill||e.skill.length<=1)){var o=ItemConfig.getJob(i),a=this._jobItemMap[o];void 0==a&&(a=[]),a.push(e.id),this._jobItemMap[o]=a}}}},Object.defineProperty(e.prototype,"qualityItemMap",{get:function(){return this._qualityItemMap||this.init(),this._qualityItemMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jobItemMap",{get:function(){return this._jobItemMap||this.init(),this._jobItemMap},enumerable:!0,configurable:!0}),e.prototype.isCanCompound=function(){var t=!1,e=this.qualityItemMap;for(var i in e)if(parseInt(i)<4&&(t=this.checkNum(e[i])))return t;return t},e.prototype.checkNum=function(t){for(var e=t.length,i=0,s=0;e>s;s++)i+=UserBag.ins().getBagGoodsCountById(0,t[s]);return i>=3},e.prototype.getCompoundItemList=function(){var t={},e=!1,i=this.qualityItemMap;for(var s in i)e=this.checkNum(i[s]),e&&(t[s]=this.getItemList(i[s]));return t},e.prototype.filterCompoundItemList=function(t,e){var i=[];for(var s in e){var n=new GodweaponItemData(e[s].id,e[s].count,e[s].quality);n.quality==t.quality&&(n.id==t.id?n.count>1&&(n.count--,i.push(n)):i.push(n))}return i},e.prototype.toList=function(t){var e=[];for(var i in t)e=e.concat(t[i]);return e},e.prototype.getItemList=function(t){for(var e=t.length,i=[],s=0;e>s;s++){var n=t[s],o=UserBag.ins().getBagGoodsCountById(0,n),a=ItemConfig.getQuality(GlobalConfig.ItemConfig[n]);o>0&&i.push(new GodweaponItemData(n,o,a))}return i},e.prototype.isCanFuse=function(){var t=!1;return t},e.prototype.checkFuseNum=function(t){for(var e=0,i=0,s=0;s<t.length;s++)if(i=UserBag.ins().getBagGoodsCountById(0,t[s]),i>0&&(e++,e>1))return!0;return!1},e.prototype.getFuseItemList=function(){var t={},e=!1,i=this.jobItemMap;for(var s in i)e=this.checkFuseNum(i[s]),e&&(t[s]=this.getJobFuseItemList(i[s]));return t},e.prototype.getJobFuseItemList=function(t){for(var e=t.length,i=[],s=0;e>s;s++){var n=t[s],o=ItemConfig.getQuality(GlobalConfig.ItemConfig[n]),a=UserBag.ins().getBagGoodsCountById(0,t[s]);a>0&&i.push(new GodweaponItemData(n,a,o))}return i},e.prototype.filterFuseItemList=function(t,e){var i=[],s=ItemConfig.getJob(GlobalConfig.ItemConfig[t.id]);for(var n in e){var o=new GodweaponItemData(e[n].id,e[n].count,e[n].quality),a=ItemConfig.getJob(GlobalConfig.ItemConfig[o.id]);s==a&&t.id!=o.id&&i.push(o)}return i},e.prototype.getFuseTargetItem=function(t,e){var i=ItemConfig.getJob(GlobalConfig.ItemConfig[t]),s=4e5+1e4*i+Math.max(t,e)-Math.min(t,e)+100*(Math.min(t,e)%20);return s},e}(BaseClass);__reflect(GodweaponItemModel.prototype,"GodweaponItemModel");var GodWeaponRedPoint=function(t){function e(){var e=t.call(this)||this;return e.gwTaskRed=!1,e.gwTaskRed1=!1,e.gwTaskRed2=!1,e.gwTaskRed3=!1,e.godWeaponRed=!1,e.gwMjRed=!1,e.gwSbRed=!1,e.gwSbRed1=!1,e.gwSbRed2=!1,e.gwSbRed3=!1,e.gwBossRp=!1,e.gwItem=!1,e.associated(e.postGodWeapon,e.postGwSb,e.postGwMj,e.postgGwBossRp,e.postGodWeaponItem),e.associated(e.postGwSb,e.postGwTab1,e.postGwTab2,e.postGwTab3),e.associated(e.postGwTask,GodWeaponCC.ins().postGwTask,GodWeaponCC.ins().postUpdateInfo,GameLogic.ins().postSubRoleChange),e.associated(e.postGwMj,GodWeaponCC.ins().postFubenInfo),e.associated(e.postGwTab1,e.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp),e.associated(e.postGwTab2,e.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp),e.associated(e.postGwTab3,e.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp),e.associated(e.postgGwBossRp,UserBoss.ins().postWorldBoss,GodWeaponCC.ins().postUpdateInfo,UserBoss.ins().postWorldNotice,UserBoss.ins().postUpdateWorldPlayList,Actor.ins().postYbChange,UserBag.ins().postItemDel,UserBag.ins().postItemAdd),e.associated(e.postGodWeaponItem,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,UserBag.ins().postItemCountChange),e}return __extends(e,t),e.prototype.postGodWeaponItem=function(){return!1},e.prototype.postGodWeapon=function(){var t=this.godWeaponRed;return this.godWeaponRed=this.gwSbRed||this.gwMjRed||this.gwItem||this.gwBossRp,t!=this.godWeaponRed},e.prototype.postGwSb=function(){var t=this.gwSbRed;return this.gwSbRed=this.gwSbRed1||this.gwSbRed2||this.gwSbRed3,t!=this.gwSbRed},e.prototype.postGwTab1=function(){var t=this.gwSbRed1;return this.gwTaskRed1?this.gwSbRed1=!0:GodWeaponCC.ins().getWeaponData(1)?(this.gwSbRed1=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(1).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(1),this.gwSbRed1||(this.gwSbRed1=GodWeaponCC.ins().weaponIsActive(1)&&GodWeaponCC.ins().maxLvRedPoint())):this.gwSbRed1=!1,t!=this.gwSbRed1},e.prototype.postGwTab2=function(){var t=this.gwSbRed2;return this.gwTaskRed2?this.gwSbRed2=!0:GodWeaponCC.ins().getWeaponData(2)?(this.gwSbRed2=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(2).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(2),this.gwSbRed2||(this.gwSbRed2=GodWeaponCC.ins().weaponIsActive(2)&&GodWeaponCC.ins().maxLvRedPoint())):this.gwSbRed2=!1,t!=this.gwSbRed2},e.prototype.postGwTab3=function(){var t=this.gwSbRed3;return this.gwTaskRed3?this.gwSbRed3=!0:GodWeaponCC.ins().getWeaponData(3)?(this.gwSbRed3=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(3).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(3),this.gwSbRed3||(this.gwSbRed3=GodWeaponCC.ins().weaponIsActive(3)&&GodWeaponCC.ins().maxLvRedPoint())):this.gwSbRed3=!1,t!=this.gwSbRed3},e.prototype.postGwMj=function(){var t=this.gwMjRed;return this.gwMjRed=GodWeaponCC.ins().mijintHadRedPoint(),t!=this.gwMjRed},e.prototype.postGwTask=function(){this.gwTaskRed;if(this.gwTaskRed=!1,GodWeaponCC.ins().taskIsOpen()){var t=GodWeaponCC.ins().gwTask;if(t.statue==GwTaskData.DONE||t.statue==GwTaskData.FINISH?this.gwTaskRed=!0:0==t.taskIdx&&SubRoles.ins().subRolesLen>GodWeaponCC.ins().weaponDataAry.length&&(this.gwTaskRed=!0),this.gwTaskRed)for(var e=1;3>=e;e++)GodWeaponCC.ins().getWeaponData(e)?this["gwTaskRed"+e]=!1:SubRoles.ins().getSubRoleByJob(e)&&0==t.taskIdx||t.weapon==e?this["gwTaskRed"+e]=!0:this["gwTaskRed"+e]=!1;else this.gwTaskRed1=!1,this.gwTaskRed2=!1,this.gwTaskRed3=!1}return!0},e.prototype.postgGwBossRp=function(){var t=this.gwBossRp;return this.gwBossRp=GodWeaponCC.ins().godWeaponIsOpen()&&(UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_GODWEAPON)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP)),t!=this.gwBossRp},e}(BaseSystem);__reflect(GodWeaponRedPoint.prototype,"GodWeaponRedPoint");var GameSystem;!function(t){t.godweaponRedPoint=GodWeaponRedPoint.ins.bind(GodWeaponRedPoint)}(GameSystem||(GameSystem={}));var GwFubenData=function(){function t(){}return t.prototype.parse=function(t){this.hadBuyData=[],this.hadChallengeNum=t.readInt(),this.vipBuyNum=t.readInt(),this.hadPass=t.readInt(),this.curPoint=t.readInt();
for(var e=t.readInt(),i=0;e>i;i++){var s=[];s.push(t.readInt()),s.push(t.readInt()),this.hadBuyData[i]=s}this.getList()},Object.defineProperty(t.prototype,"hadPass",{get:function(){return this._hadPass},set:function(t){this._hadPass=t},enumerable:!0,configurable:!0}),t.prototype.getList=function(){var t,e=this.getMaxGird();t=1==this.curPoint?Math.min(this._hadPass+1,e):this._hadPass,this.listData=[];for(var i,s=t;s>0;s--)i=new GwfubenFloorData,i.gridNum=s,i.gridNum>this._hadPass?i.curPoint=0:i.gridNum==this._hadPass?i.curPoint=this.curPoint:i.curPoint=1,this.listData.push(i)},t.prototype.getMaxGird=function(){if(!this._maxGird){this._maxGird=0;for(var t in GlobalConfig.GodWeaponFubenConfig)this._maxGird++}return this._maxGird},t.prototype.buyTypeData=function(t){for(var e=0;e<this.hadBuyData.length;e++)if(this.hadBuyData[e][0]==t)return this.hadBuyData[e];return[t,0]},Object.defineProperty(t.prototype,"getBuyCount",{get:function(){for(var t=0,e=0;e<this.hadBuyData.length;e++)t+=this.hadBuyData[e][1];return t},enumerable:!0,configurable:!0}),t}();__reflect(GwFubenData.prototype,"GwFubenData");var GwfubenFloorData=function(){function t(){}return Object.defineProperty(t.prototype,"gridNum",{get:function(){return this._gridNum},set:function(t){this._gridNum=t,this.config=GlobalConfig.GodWeaponFubenConfig[t]},enumerable:!0,configurable:!0}),t}();__reflect(GwfubenFloorData.prototype,"GwfubenFloorData");var GwRankInfoData=function(){function t(){}return t.prototype.parse=function(t){this.rank=t.readInt(),this.nameStr=t.readString();var e=t.readInt();this.floorNum=Math.floor(e/1e4),this.timeNum=1e4-e%1e4},t.prototype.getgetTimeStr=function(){var t="";return t=DateUtils.getFormatBySecond(this.timeNum,DateUtils.TIME_FORMAT_3)},t}();__reflect(GwRankInfoData.prototype,"GwRankInfoData");var GwTaskData=function(){function t(){}return t.prototype.parser=function(t){this.weaponIdx=t.readInt(),this.weapon=t.readInt(),this.taskIdx=t.readInt(),this.progress=t.readInt(),this.statue=t.readInt()},t}();GwTaskData.DOING=0,GwTaskData.DONE=1,GwTaskData.FINISH=2,__reflect(GwTaskData.prototype,"GwTaskData");var GodweaponItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=GlobalConfig.ItemConfig[this.data.id];this.shengwuImg.source=t.icon+"_png",this.shengwuName.text=t.name,this.shengwuName.textColor=ItemConfig.getQualityColor(t),this.frame.source="godweapon_quality"+(ItemConfig.getQuality(t)+1),this.imgJob.source="job"+ItemConfig.getJob(t)+"Item",this.data.count?this.count.text=this.data.count:this.count.text=""},e}(BaseItemRender);__reflect(GodweaponItem.prototype,"GodweaponItem");var GodweaponItemMixView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isHintEffectPlay=!1,e.isPlay=!1,e.COMPOUND_STATE="mix",e.FUSE_STATE="ultramix",e.PAGE_SIZE=5,e}return __extends(e,t),e.prototype.open=function(){this.mix1.touchChildren=!1,this.mix2.touchChildren=!1,this.mix3.touchChildren=!1,this.targetGroup.touchChildren=!1,this.mix.enabled=!1,this.list.itemRenderer=GodweaponItem,this.labelEffect=new MovieClip,this.labelEffect.scaleX=.6,this.labelEffect.scaleY=.5,this.labelEffect.touchEnabled=!1,this.hintEffect=new MovieClip,this.hintEffect.touchEnabled=!1,this.descTxt.alpha=1,this.MaterialItemId=ItemConst.GODWEAPON_ITEM,this.addCustomEvent(),this.updateView()},e.prototype.close=function(){this.cleanTween()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.turn,this.changeState),this.addTouchEvent(this.leftButton,this.prevPage),this.addTouchEvent(this.rightButton,this.nextPage),this.addTouchEvent(this.mix1,this.touchMixItem),this.addTouchEvent(this.mix2,this.touchMixItem),this.addTouchEvent(this.mix3,this.touchMixItem),this.addTouchEvent(this.targetGroup,this.touchTargetItem),this.addTouchEvent(this.mix,this.operate),this.addTouchEvent(this.mixMaterial,this.onTouch),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.observe(GodWeaponItemCC.ins().postCompound,this.onCompound),this.observe(GodWeaponItemCC.ins().postFuse,this.onFuse)},e.prototype.operate=function(){this.mix.enabled&&(this.currentState==this.FUSE_STATE?GodWeaponItemCC.ins().requestFuse(this.mixData1.id,this.mixData2.id,this.isMaterial?1:0):GodWeaponItemCC.ins().requestCompound(this.mixData1.id,this.mixData2.id,this.mixData3.id))},e.prototype.onCompound=function(t){var e=this;this.mix.enabled=!1,this.isMaterial=!1,this.addEffect(),TimerManager.ins().doTimerDelay(300,0,1,function(){e.addEffect(function(){e.updateView(),e.updateTargetItem(t.id),e.addResultEffect(t.isSuccess,t.id,!0)})},this)},e.prototype.addResultEffect=function(t,e,i){var s=this;void 0===i&&(i=!1);var n=new MovieClip;n.x=this.targetGroup.width/2,this.targetGroup.addChild(n);var o;t?(o=RES_DIR_EFF+"forgeSuccess",n.y=this.targetGroup.height/2-15):(o=RES_DIR_EFF+"litboom",n.y=this.targetGroup.height/2),n.playFile(o,1,function(){i||s.cleanEff(),e&&(i||t)&&s.flyItem(e)})},e.prototype.playEff=function(t){var e=this;if(!this.isPlay){var i=RES_DIR_EFF+"jljdt";this.isPlay=!0;var s=1,n=new MovieClip;n.playFile(i,-1),this.leftEff.addChild(n),n.scaleX=0,n.scaleY=.6;var o=new MovieClip;o.playFile(i,-1),this.rightEff.addChild(o),o.scaleX=0,o.scaleY=.6;var a=new MovieClip;a.playFile(i,-1),this.buttonEff.addChild(a),a.x+=14,a.scaleX=0,a.scaleY=.6,a.$setRotation(90);var r=.23,h=egret.Tween.get(n),l=egret.Tween.get(o);l.to({scaleX:r},250*s),h.to({scaleX:r},250*s).call(function(){var i=egret.Tween.get(a);i.to({scaleX:.35},250*s).call(function(){e.isPlay=!1,t&&t.call(e)})})}},e.prototype.cleanEff=function(){this.leftEff.removeChildren(),this.rightEff.removeChildren(),this.buttonEff.removeChildren()},e.prototype.addEffect=function(t){var e=this,i=new MovieClip;i.scaleX=3,i.scaleY=3,i.x=this.targetGroup.width/2-4,i.y=this.targetGroup.height/2-7,this.targetGroup.addChild(i);var s=DisplayUtils.getEffectPath("forceguildeff");i.playFile(s,1,function(){t&&t.call(e)})},e.prototype.onFuse=function(t){var e=this;this.mix.enabled=!1,this.isMaterial=!1;var i,s=t.isSuccess;!s&&this.mixData1&&(i=new GodweaponItemData(this.mixData1.id,this.mixData1.count,this.mixData1.quality)),this.playEff(function(){e.updateView(),e.updateTargetItem(t.id),!s&&i&&(e.updateMixItem(1,i),e.mixData1&&e.currentState==e.FUSE_STATE&&(e.dataSource=new PageArray(e.updateMixData(),e.PAGE_SIZE),e.setPageData())),e.addResultEffect(s,t.id)})},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=this.targetGroup.x,e.y=this.targetGroup.y,e.data=t,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,this.targetGroup.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.touchMixItem=function(t){var e=t.target,i=1;e==this.mix1?i=1:e==this.mix2?i=2:e==this.mix3&&(i=3),this["mixData"+i]||this.addHintEffect(),this.updateMixItem(i),this.currentState!=this.FUSE_STATE?this.setCompoundState(!1):(this.updateTargetItem(),1==i&&this.updateMixItem(2)),this.dataSource=new PageArray(this.updateMixData(),this.PAGE_SIZE),this.setPageData()},e.prototype.touchTargetItem=function(){var t=this.isCanFuse();t||this.updateTargetItem()},e.prototype.updateTargetItem=function(t){if(void 0===t&&(t=0),t){var e=GlobalConfig.ItemConfig[t];this.targetImg.visible=!0,this.targetImg.source=e.icon+"_png",this.targetLabel.text=e.name,this.targetLabel.textColor=ItemConfig.getQualityColor(e)}else{var i=this.isCanCompound();this.setCompoundState(i),this.targetLabel.textColor=13746831,this.targetImg.source="",this.targetImg.visible=!1}},e.prototype.setCompoundState=function(t){var e;e=t?"随机圣物":"",this.targetLabel.text=e,this.targetRandom.visible=t,this.mixline0Effect.visible=t,this.mixline1Effect.visible=t},e.prototype.updateMixItem=function(t,e){void 0===e&&(e=null);var i=this["mix"+t+"Img"],s=this["mix"+t+"Name"];if(e){i.visible=!0;var n=GlobalConfig.ItemConfig[e.id];i.source=n.icon+"_png",s.text=n.name,s.textColor=ItemConfig.getQualityColor(n)}else s.text="",i.visible=!1;this["mixData"+t]=e},e.prototype.addHintEffect=function(){var t=this;if(!this.isHintEffectPlay){DisplayUtils.removeFromParent(this.hintEffect),this.list.addChild(this.hintEffect),this.isHintEffectPlay=!0,this.hintEffect.x=241,this.hintEffect.y=49;var e=DisplayUtils.getEffectPath("mixhint");this.hintEffect.playFile(e,1,function(){t.isHintEffectPlay=!1})}},e.prototype.onListChange=function(){var t=this.list.selectedItem,e=this.setMixData(t);if(e){var i=this.isCanFuse();i||this.updateTargetItem(),this.dataSource=new PageArray(this.updateMixData(),this.PAGE_SIZE),this.setPageData()}else UserTips.ins().showTips("物品格已满")},e.prototype.setMixData=function(t){if(this.currentState==this.FUSE_STATE){var e=this.isCanFuse();if(e)return!1;var i=1;return this.mixData1?this.mixData2||(this.mixData2=t,i=2):(this.mixData1=t,i=1),this.updateMixItem(i,t),!0}var s=this.isCanCompound();if(s)return!1;var i=1;return this.mixData1?this.mixData2?this.mixData3||(this.mixData3=t,i=3):(this.mixData2=t,i=2):(this.mixData1=t,i=1),this.updateMixItem(i,t),!0},e.prototype.isCanCompound=function(){return this.mixData1&&this.mixData2&&this.mixData3&&this.currentState!=this.FUSE_STATE},e.prototype.isCanFuse=function(){return this.mixData1&&this.mixData2&&this.currentState==this.FUSE_STATE},e.prototype.updateMixData=function(){var t=this.dataList.concat();if(this.currentState==this.FUSE_STATE){this.mixData1&&(t=GodweaponItemModel.ins().filterFuseItemList(this.mixData1,t)),this.mixData2&&(t=GodweaponItemModel.ins().filterFuseItemList(this.mixData2,t));var e=this.isCanFuse();this.mix.enabled=e,e&&this.updateTargetItem(GodweaponItemModel.ins().getFuseTargetItem(this.mixData1.id,this.mixData2.id))}else this.mixData1&&(t=GodweaponItemModel.ins().filterCompoundItemList(this.mixData1,t)),this.mixData2&&(t=GodweaponItemModel.ins().filterCompoundItemList(this.mixData2,t)),this.mixData3&&(t=GodweaponItemModel.ins().filterCompoundItemList(this.mixData3,t)),this.mix.enabled=this.isCanCompound();return t},e.prototype.changeState=function(){this.currentState==this.FUSE_STATE?this.currentState=this.COMPOUND_STATE:this.currentState=this.FUSE_STATE,this.updateView()},e.prototype.prevPage=function(){this.dataSource.prev(),this.setPageData()},e.prototype.nextPage=function(){this.dataSource.next(),this.setPageData()},e.prototype.setPageData=function(){this.leftButton.visible=this.dataSource.havePre(),this.rightButton.visible=this.dataSource.haveNext(),this.list.dataProvider=new ArrayCollection(this.dataSource.pageData)},e.prototype.clearView=function(){for(var t=1;4>t;t++)this["mixData"+t]=null,this.updateMixItem(t);this.updateTargetItem()},e.prototype.updateView=function(){var t,e,i;this.clearView(),this.currentState==this.FUSE_STATE?(t=GodweaponItemModel.ins().getFuseItemList(),e="圣物合成",i=GodweaponItemModel.ins().isCanCompound(),this.startTween()):(t=GodweaponItemModel.ins().getCompoundItemList(),e="圣物融合",i=GodweaponItemModel.ins().isCanFuse(),this.cleanTween()),i?this.addLabelEffect():this.removeLabelEffect(),this.turn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e+"</u></a>"),this.dataList=GodweaponItemModel.ins().toList(t),this.noItemDesc.visible=0==this.dataList.length,this.dataSource=new PageArray(this.dataList,this.PAGE_SIZE),this.setPageData(),this.updateShengWu()},e.prototype.addLabelEffect=function(){var t=this;TimerManager.ins().doNext(function(){DisplayUtils.removeFromParent(t.labelEffect),t.labelEffect.x=t.turn.x+37,t.labelEffect.y=t.turn.y+11,null==t.labelEffect.parent&&t.turn.parent.addChild(t.labelEffect),t.labelEffect.playFile(RES_DIR_EFF+"chargeff1",-1)},this)},e.prototype.removeLabelEffect=function(){this.labelEffect.stop(),DisplayUtils.removeFromParent(this.labelEffect)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.mixMaterial:if(this.isMaterial)this.isMaterial=!1,this.addShengWu();else{var e=UserBag.ins().getBagItemById(this.MaterialItemId);e?(this.isMaterial=!0,this.addShengWu()):(this.isMaterial=!1,UserWarn.ins().setBuyGoodsWarn(this.MaterialItemId))}}},e.prototype.updateShengWu=function(){this.descTxt.text=this.isMaterial?"100%成功率":"点击添加",this.isMaterial?(this.setLight(this.mixMaterialImg),this.setLight(this.mixlabel)):(this.setGray(this.mixMaterialImg),this.setGray(this.mixlabel))},e.prototype.addShengWu=function(){this.updateShengWu(),this.isMaterial?this.cleanTween():this.startTween()},e.prototype.startTween=function(){this.isMaterial||(this.cleanTween(),this.descTxt.alpha=0,this.playTween())},e.prototype.playTween=function(){if(!this.tw){this.tw=egret.Tween.get(this.descTxt,{loop:!0});var t=this.descTxt.alpha?0:1;this.tw.to({alpha:t},600).to({alpha:1-t},600)}},e.prototype.cleanTween=function(){this.descTxt.alpha=1,this.tw&&egret.Tween.removeTweens(this.descTxt),this.tw=null},e.prototype.setGray=function(t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)],this.materialTxt.visible=this.materialTxtImg.visible=!0},e.prototype.setLight=function(t){t.filters=[],this.materialTxt.visible=this.materialTxtImg.visible=!1},e}(BaseView);__reflect(GodweaponItemMixView.prototype,"GodweaponItemMixView");var GodWeaponWin=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=-1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwSkin",this.isTopLevel=!0,this.gwRp.visible=!1,this.mjRp.visible=!1,this.gwBossRp.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GodWeaponRedPoint.ins().postGwMj,this.updateRedPoint),this.observe(GodWeaponRedPoint.ins().postGwSb,this.updateRedPoint),this.observe(GodWeaponRedPoint.ins().postgGwBossRp,this.updateRedPoint),this.observe(GodWeaponRedPoint.ins().postGodWeaponItem,this.updateRedPoint),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.help,this.onTap),this.gwadImg.visible=!1,this.gwadImg.source="",this.tab.visible=!0,this.timeBp.visible=!1,this.addChangeEvent(this.tab,this.itemTouchHandler),this.addChangingEvent(this.tab,this.itemTouching),t[0]&&this.checkIsOpen(t[0])?(this.viewStack.selectedIndex=t[0],this.selectIndex=this.tab.selectedIndex=t[0]):(this.viewStack.selectedIndex=0,this.selectIndex=this.tab.selectedIndex=0),this.updateRedPoint()},e.prototype.gwTimeShow=function(){var t=GlobalConfig.GodWeaponBaseConfig.openDay-GameServer.serverOpenDay,e=t*DateUtils.SECOND_PER_DAY;this.totalNumber=e-DateUtils.getTodayPassedSecond(),this.updateAward();var i=this.totalNumber;TimerManager.ins().doTimer(1e3,i,this.updateAward,this)},e.prototype.updateAward=function(){if(this.totalNumber<=0)return TimerManager.ins().remove(this.updateAward,this),void this.updateOpen();var t=DateUtils.getFormatBySecond(this.totalNumber,DateUtils.TIME_FORMAT_1),e=t.split(":");t=e.join("."),this.timeBp.text=t,this.totalNumber--},e.prototype.updateOpen=function(){this.gwadImg.visible=!1,this.gwadImg.source="",this.tab.visible=!0,this.timeBp.visible=!1,this.viewStack.selectedIndex=0,this.selectIndex=0},e.prototype.updateRedPoint=function(){this.gwRp.visible=GodWeaponRedPoint.ins().gwSbRed,this.mjRp.visible=GodWeaponRedPoint.ins().gwMjRed,this.gwBossRp.visible=GodWeaponRedPoint.ins().gwBossRp,this.mixRp.visible=GodWeaponRedPoint.ins().gwItem},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._selectIndex>-1&&this.viewStack.getChildAt(this._selectIndex).close()},Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex>-1&&this.viewStack.getChildAt(this._selectIndex).close(),this._selectIndex=t,this.viewStack.getChildAt(this._selectIndex).open(),3==this._selectIndex?this.help.visible=!0:this.help.visible=!1},enumerable:!0,configurable:!0}),e.prototype.itemTouchHandler=function(t){this.selectIndex=this.tab.selectedIndex},e.prototype.itemTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return t>=1?UserZs.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay?!0:(UserZs.ins().lv<GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel?UserTips.ins().showTips("角色转生等级"+GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel+"开启"):GameServer.serverOpenDay<GlobalConfig.GodWeaponBaseConfig.openDay&&UserTips.ins().showTips("开服"+GlobalConfig.GodWeaponBaseConfig.openDay+"天开启"),!1):!0},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:3==this._selectIndex&&ViewManager.ins().open(ZsBossRuleSpeak,23)}},e}(BaseEuiView);__reflect(GodWeaponWin.prototype,"GodWeaponWin"),ViewManager.ins().reg(GodWeaponWin,LayerManager.UI_Main);var GwAddAttrView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwAttrskin",this._ary=new eui.ArrayCollection,this.list.dataProvider=this._ary,this.list.itemRenderer=GwAddAttrRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(this._ary.replaceAll(GodWeaponCC.ins().gwAddAttr(t[0])),this.addTouchEvent(this.rect,this.onTap),t[0]){case 0:this.GwName.text="雷霆怒斩";break;case 1:this.GwName.text="赤血魔剑";break;case 2:this.GwName.text="无极逍遥扇"}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.dataProvider=null,this.removeTouchEvent(this.rect,this.onTap)},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwAddAttrView.prototype,"GwAddAttrView");var GwAddAttrRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this._thisData=this.data,this.labelInfo.text=AttributeData.getAttrStrByType(this._thisData.type)+"："+this._thisData.value)},e}(BaseItemRender);__reflect(GwAddAttrRender.prototype,"GwAddAttrRender"),ViewManager.ins().reg(GwAddAttrView,LayerManager.UI_Popup);var GwBossChallengeView=function(t){function e(){var e=t.call(this)||this;return e._cdTime=0,e.skinName="GwBossChallengeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.reward.itemRenderer=ItemBase,this._awardAC=new eui.ArrayCollection,this.reward.dataProvider=this._awardAC},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.notBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.challengeBtn,this.onTap),this._bossData=t[0],this.initView()},e.prototype.initView=function(){var t=this._bossData,e=GlobalConfig.WorldBossConfig[t.id];this.title.text=e.showName,this._awardAC.source=e.showReward.concat();var i=GlobalConfig.WorldBossBaseConfig.challengeItemYb[e.type-1];this.yuanbao.text=""+i;var s=GlobalConfig.WorldBossBaseConfig.challengeItem[e.type-1];this.ticket.source=s+"_png";var n=UserBag.ins().getBagGoodsByTypeAndId(0,s),o=0;n&&(o=n.count),this.num.text=""+o,o?this.num.textColor=ColorUtil.GREEN_COLOR_N:this.num.textColor=ColorUtil.RED_COLOR_N;var a=Math.ceil((UserBoss.ins().worldBossCd[e.type]-egret.getTimer())/1e3);a>0?(this.leftCDText.visible=!0,this.updateCDTime(a)):this.leftCDText.visible=!1},e.prototype.updateCDTime=function(t){this._cdTime=t,TimerManager.ins().remove(this.updateBtnLabel,this),t>0&&TimerManager.ins().doTimer(1e3,t,this.updateBtnLabel,this),this.updateBtnLabel()},e.prototype.updateBtnLabel=function(){this.leftCDText.text="挑战CD："+this._cdTime+"秒",this._cdTime-=1,this._cdTime<=0&&(this.leftCDText.text="")},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.notBtn||e==this.bgClose?ViewManager.ins().close(this):e==this.challengeBtn&&this.onChallenge()},e.prototype.onChallenge=function(){if(UserFb.ins().checkInFB())return!1;var t=GlobalConfig.WorldBossConfig[this._bossData.id];if(this._bossData.canInto)if(this._bossData.isDie)UserTips.ins().showTips("BOSS未复活");else{if(!(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)){var e=Math.ceil((UserBoss.ins().worldBossCd[t.type]-egret.getTimer())/1e3);if(e>0)return UserTips.ins().showTips("|C:0xf3311e&T:冷却中，"+e+"秒后可进行挑战|"),!1;var i=GlobalConfig.WorldBossBaseConfig.challengeItemYb[t.type-1],s=GlobalConfig.WorldBossBaseConfig.challengeItem[t.type-1],n=UserBag.ins().getBagGoodsByTypeAndId(0,s);return n&&n.count||!(Actor.yb<i)?(UserBoss.ins().sendChallengWorldBoss(this._bossData.id,t.type),ViewManager.ins().close(this),!0):(UserTips.ins().showTips("元宝不足"),ViewManager.ins().close(this),!1)}ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH)}else UserTips.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");return!1},e.prototype.close=function(){},e}(BaseEuiView);__reflect(GwBossChallengeView.prototype,"GwBossChallengeView"),ViewManager.ins().reg(GwBossChallengeView,LayerManager.UI_Popup);var GwBossItem=function(t){function e(){var e=t.call(this)||this;return e.states=["cannot","already","havetime"],e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.WorldBossConfig[t.id];this.fbname.text=e.showName,this.selected?this.bg0.visible=!0:this.bg0.visible=!1,this.enabled=!0,TimerManager.ins().remove(this.updateTime,this),t.canChallenge?this.currentState=this.states[1]:t.isDie&&t.canInto?(this.updateTime(),TimerManager.ins().doTimer(1e3,0,this.updateTime,this),this.currentState=this.states[2]):(this.enabled=!1,this.currentState=this.states[0]),this.levelNeed.text="("+e.zsLevel[0]+"转-"+e.zsLevel[1]+"转)"},e.prototype.updateTime=function(){var t=this.data.relieveTime-egret.getTimer();this.timeTxt.text=""+DateUtils.getFormatBySecond(Math.floor(t/1e3),1),0>=t&&(TimerManager.ins().remove(this.updateTime,this),this.timeTxt.text="")},e.prototype.onRemove=function(t){TimerManager.ins().remove(this.updateTime,this)},e}(BaseItemRender);__reflect(GwBossItem.prototype,"GwBossItem");var GwBossView=function(t){function e(){var e=t.call(this)||this;return e.numToStr=["一","二","三","四","五"],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.remindTpis.touchEnabled=!0},e.prototype.open=function(){this.addTouchEvent(this.gw0,this.onTap),this.addTouchEvent(this.gw1,this.onTap),this.addTouchEvent(this.gw2,this.onTap),this.addTouchEvent(this.tower,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.observe(UserZs.ins().postZsLv,this.initData),this.observe(UserBoss.ins().postWorldBoss,this.onUpdateBoss),TimerManager.ins().doTimer(3e3,0,this.onUpdateTime,this),TimerManager.ins().doTimer(1e3,0,this.onUpdateDieTime,this),this.initData()},e.prototype.onUpdateTime=function(){UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_GODWEAPON),UserBoss.ins().sendWorldBossInfo(UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP)},e.prototype.onUpdateDieTime=function(){this.initData()},e.prototype.initData=function(){var t=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON].concat();t.sort(this.compareFn);var e=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP].concat();e.sort(this.compareFn);for(var i=0,s=0;s<t.length;s++){var n=t[s],o=GlobalConfig.WorldBossConfig[n.id],a="("+o.zsLevel[0]+"转-"+o.zsLevel[1]+"转)";if(this["redPoint"+s].visible=!1,i=o.type,n.canInto)if(this.setGwState(s,2),n.isDie){var r=n.relieveTime-egret.getTimer();r=0>r?0:r,a+="\n"+DateUtils.getFormatBySecond(Math.floor(r/1e3),1)}else this["redPoint"+s].visible=this.checkCanInto1(o.type)&&UserBoss.ins().getBossRemindByIndex(n.id);else this.setGwState(s,0);this["info"+s].text=a}for(var s=0;s<e.length;s++){var n=e[s],o=GlobalConfig.WorldBossConfig[n.id],a=this.numToStr[s]+"层("+o.zsLevel[0]+"转-"+o.zsLevel[1]+"转)";if(this["towerRedPoint"+s].visible=!1,n.canInto)if(this.setTopState(s,2),n.isDie){var r=n.relieveTime-egret.getTimer();r=0>r?0:r,a+="\n"+DateUtils.getFormatBySecond(Math.floor(r/1e3),1)}else this["towerRedPoint"+s].visible=this.checkCanInto(o.type)&&UserBoss.ins().getBossRemindByIndex(n.id);else this.setTopState(s,0);this["towerInfo"+s].text=a}this.leftTime.text="今日剩余圣域归属次数："+UserBoss.ins().worldBossBelongTime[i]},e.prototype.checkCanInto=function(t){var e=GlobalConfig.WorldBossBaseConfig.challengeItemYb[t-1];if(Actor.yb>=e)return!0;var i=GlobalConfig.WorldBossBaseConfig.challengeItem[t-1],s=UserBag.ins().getBagGoodsByTypeAndId(0,i);return s&&s.count?!0:!1},e.prototype.checkCanInto1=function(t){return UserBoss.ins().worldBossBelongTime[t]>0},e.prototype.setGwState=function(t,e){var i=["locked","normal","selected"];this["img"+t].source="gw_field_"+i[e]+"_"+t,this["titleBg"+t].source="gw_title_bg_"+(0==e?1:0),this["title"+t].source="gw_title_"+(0==e?"locked_":"")+(t+1),this["info"+t].textColor=0==e?11119017:65280},e.prototype.setTopState=function(t,e){this["tower"+t].visible=0!=e,this["towerInfo"+t].textColor=0==e?11119017:65280},e.prototype.onUpdateBoss=function(t){(t==UserBoss.BOSS_SUBTYPE_GODWEAPON||t==UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP)&&this.initData()},e.prototype.compareFn=function(t,e){return t.id<e.id?-1:1},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,UserBoss.BOSS_SUBTYPE_GODWEAPON)},e.prototype.close=function(){this.removeTouchEvent(this.gw0,this.onTap),this.removeTouchEvent(this.gw1,this.onTap),this.removeTouchEvent(this.gw2,this.onTap),this.removeTouchEvent(this.tower,this.onTap),this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onTap=function(t){var e=t.currentTarget;if(e!=this.tower){var i=this.getClickGwIndex(e);if(i>-1){var s=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON].concat();if(s.sort(this.compareFn),s[i].canInto){var n=s[i],o=GlobalConfig.WorldBossConfig[n.id];if(n.isDie)UserTips.ins().showTips("BOSS未复活");else if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,UserBag.BAG_ENOUGH);else{var a=Math.ceil((UserBoss.ins().worldBossCd[o.type]-egret.getTimer())/1e3);if(a>0)return UserTips.ins().showTips("|C:0xf3311e&T:冷却中，"+a+"秒后可进行挑战|"),!1;UserBoss.ins().sendChallengWorldBoss(n.id,o.type)}}}else if(i=this.getClickTowerIndex(e),i>-1){var s=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP].concat();s.sort(this.compareFn),s[i].canInto&&ViewManager.ins().open(GwBossChallengeView,s[i])}}else for(var s=UserBoss.ins().worldInfoList[UserBoss.BOSS_SUBTYPE_GODWEAPON_TOP].concat(),r=0,h=s;r<h.length;r++){var l=h[r];l.canInto&&ViewManager.ins().open(GwBossChallengeView,l)}},e.prototype.getClickTowerIndex=function(t){for(var e=0;5>e;e++)if(t==this["tower"+e])return e;return-1},e.prototype.getClickGwIndex=function(t){for(var e=0;3>e;e++)if(t==this["gw"+e])return e;return-1},e}(BaseView);__reflect(GwBossView.prototype,"GwBossView");var RES_RESOURCE="resource",RES_DIR=cdnurl+"resource/res",MAP_DIR=cdnurl+"resource/map",RES_DIR_BLOOD=RES_DIR+"/blood/",RES_DIR_BODY=RES_DIR+"/body/",RES_DIR_EFF=RES_DIR+"/eff/",RES_DIR_ITEM=RES_DIR+"/item/",RES_DIR_MONSTER=RES_DIR+"/monster/",RES_DIR_SKILL=RES_DIR+"/skill/",RES_DIR_SKILLEFF=RES_DIR+"/skilleff/",RES_DIR_WARSPIRIT=RES_DIR+"/warspirit/",RES_DIR_WEAPON=RES_DIR+"/weapon/",RES_DIR_WING=RES_DIR+"/wing/",RES_DIR_CITY=RES_DIR+"/city/",GwMijingRankView=function(t){function e(){var e=t.call(this)||this;return e.skinName="GwMijingRankSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.touchEnabled=!0,this.addTouchEvent(this.bgClose,this.touchHandler),this._ary=new eui.ArrayCollection,this.list.dataProvider=this._ary,this.list.itemRenderer=GwMijingRankItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ary.replaceAll(GodWeaponCC.ins().rankInfoDataAry)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.touchHandler),this.list.dataProvider=null},e.prototype.touchHandler=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwMijingRankView.prototype,"GwMijingRankView");var GwMijingRankItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this._thisData=this.data,this.playerName.text=this._thisData.nameStr,this.storeyCount.text="第"+this._thisData.floorNum+"层",this.time.text=this._thisData.getgetTimeStr(),this._thisData.rank<=3?(this.rank.visible=!1,this.qiansan.visible=!0,this.qiansan.source="paihang"+this._thisData.rank):(this.rank.text=""+this._thisData.rank,this.rank.visible=!0,this.qiansan.visible=!1))},e}(BaseItemRender);__reflect(GwMijingRankItemRender.prototype,"GwMijingRankItemRender"),ViewManager.ins().reg(GwMijingRankView,LayerManager.UI_Popup);var GwMijingRiseUpView=function(t){function e(){var e=t.call(this)||this;return e.isMax1=!1,e.isMax2=!1,e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="GwRiseUpSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gold.selected=!0,this.addTouchEvent(this.gold,this.onTap),this.addTouchEvent(this.yuanbao,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.cancelBtn,this.onTap),this.observe(GodWeaponCC.ins().postFubenInfo,this.updateView),this.updateView()},e.prototype.updateView=function(){var t=GodWeaponCC.ins().fubenInfoData,e=10*t.getBuyCount;this.now.text="当前鼓舞  伤害 +"+e+"%",this.goldCost.text=GlobalConfig.GodWeaponBaseConfig.buyBuff[0].moneyCount+"",this.yuanbaoCost.text=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].moneyCount+"";var i=t.buyTypeData(1);i[1]>=GlobalConfig.GodWeaponBaseConfig.buyBuff[0].maxCount&&(this.gold.visible=!1,this.goldImg.visible=!1,this.goldCost.visible=!1,this.goldText.text="金币鼓舞次数已满",this.isMax1=!0,this.gold.selected=!1),i=t.buyTypeData(2),i[1]>=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].maxCount&&(this.yuanbao.visible=!1,this.yuanbaoCost.visible=!1,this.yuanbaoImg.visible=!1,this.yuanbaoText.text="元宝鼓舞次数已满",this.isMax2=!0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.gold,this.onTap),this.removeTouchEvent(this.yuanbao,this.onTap),this.removeTouchEvent(this.cancelBtn,this.onTap),this.removeTouchEvent(this.cancelBtn,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.gold:this.yuanbao.selected=!1,this.gold.selected=!0;break;case this.yuanbao:this.yuanbao.selected=!0,this.gold.selected=!1;break;case this.cancelBtn:ViewManager.ins().close(this);break;case this.sureBtn:if(this.isMax2&&this.isMax1)return void UserTips.ins().showTips("鼓舞次数已满");if(!this.yuanbao.selected&&!this.gold.selected)return void UserTips.ins().showTips("请选择购买的金钱类型");if(this.gold.selected){if(Actor.gold<GlobalConfig.GodWeaponBaseConfig.buyBuff[0].moneyCount)return void UserTips.ins().showCenterTips("金币不足")}else if(Actor.yb<GlobalConfig.GodWeaponBaseConfig.buyBuff[1].moneyCount)return void UserTips.ins().showCenterTips("元宝不足");GodWeaponCC.ins().buybuff(this.gold.selected?1:2);var e=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].maxCount+GlobalConfig.GodWeaponBaseConfig.buyBuff[0].maxCount;GodWeaponCC.ins().fubenInfoData.getBuyCount==e-1&&ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GwMijingRiseUpView.prototype,"GwMijingRiseUpView"),ViewManager.ins().reg(GwMijingRiseUpView,LayerManager.UI_Popup);var GwResetWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GwResetSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.price.setType(MoneyConst.yuanbao)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgclose,this.onTouch),this.addTouchEvent(this.resetBtn,this.onTouch),this.price.setPrice(GlobalConfig.GodWeaponBaseConfig.skillResetCost),this._dataWeapon=t[0];
var i=this._dataWeapon.getResetPoint();this.resetDesc.text=i>0?"重置后可返还"+i+"技能点":"目前没有可重置的技能",this.gwName.text=this._dataWeapon.getWeaponName(),this.resetBtn.enabled=i>0&&Actor.yb>=GlobalConfig.GodWeaponBaseConfig.skillResetCost},e.prototype.onTouch=function(t){switch(t.target){case this.bgclose:ViewManager.ins().close(this);break;case this.resetBtn:GodWeaponCC.ins().sendReset(this._dataWeapon.weaponId),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GwResetWin.prototype,"GwResetWin"),ViewManager.ins().reg(GwResetWin,LayerManager.UI_Main);var GwResultView=function(t){function e(){var e=t.call(this)||this;return e._pFNum=4,e.secNum=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwResultSkin",this.addTouchEvent(this.closeBtn,this.touchHandler),this.addTouchEvent(this.get,this.touchHandler),this.addTouchEvent(this.closenoget,this.touchHandler),this._ary=new eui.ArrayCollection,this.listCoin.dataProvider=this._ary,this.listCoin.itemRenderer=MijingItemBase2},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._fubenId=t[0],this._pFNum=t[1];var i,s,n=null==t[2]?-1:t[2];for(var o in GlobalConfig.GodWeaponFubenConfig)if(GlobalConfig.GodWeaponFubenConfig[o].fbId==this._fubenId){i=GlobalConfig.GodWeaponFubenConfig[o],s=parseInt(o);break}var a;if(-1==n)this.time.text="未击杀BOSS",this.gaptime.visible=!1,this.get.visible=!0,this.closenoget.visible=!0,this.closeBtn.visible=!1,this.noget.visible=!0,a=!1;else if(this.time.text=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_3),1!=this._pFNum){this.gaptime.visible=!0,this.get.visible=!0,this.closenoget.visible=!0,this.closeBtn.visible=!1;var r=Math.abs(n-GlobalConfig.GodWeaponBaseConfig.fbGrade[0]);this.gaptime.text="（距离S只差"+r+"秒）",this.noget.visible=!0,a=!1}else this.gaptime.visible=!1,this.get.visible=!1,this.closenoget.visible=!1,this.closeBtn.visible=!0,this.noget.visible=!1,a=!0;this._isB=a;var h=i.award[this._pFNum].concat();UserFb.ins().oldMijingPoint;if(1!=UserFb.ins().oldMijingPoint&&1==this._pFNum){var l=i.firstAward.concat();h=h.concat(l)}for(var c=[],u=0;u<h.length;u++){var p=new MijinglistData;p.data=h[u],p.index=u+1,p.start=i.award[1].length,p.floorNum=s,c.push(p)}if(this._ary.replaceAll(c),this.rank.source="godweapon_rank"+this._pFNum,a){this.updateCloseBtnLabel();var d=this.secNum;TimerManager.ins().doTimer(1e3,d,this.updateCloseBtnLabel,this)}},e.prototype.updateCloseBtnLabel=function(){this.secNum--,this.secNum<=0&&(ViewManager.ins().close(this),GodWeaponCC.ins().requestGetAward()),this.closeBtn.label="退出("+this.secNum+"s)"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.touchHandler),this.removeTouchEvent(this.get,this.touchHandler),this.removeTouchEvent(this.closenoget,this.touchHandler),this.listCoin.dataProvider=null,TimerManager.ins().remove(this.updateCloseBtnLabel,this),GameMap.fubenID>0&&UserFb.ins().sendExitFb(),GameMap.fbType==UserFb.FB_TYPE_MIJING&&ViewManager.ins().open(GodWeaponWin,1)},e.prototype.touchHandler=function(t){t.currentTarget==this.closeBtn?(GodWeaponCC.ins().requestGetAward(),ViewManager.ins().close(this)):t.currentTarget==this.get?(GodWeaponCC.ins().requestGetAward(),ViewManager.ins().close(this)):t.currentTarget==this.closenoget&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwResultView.prototype,"GwResultView"),ViewManager.ins().reg(GwResultView,LayerManager.UI_Popup);var MijingItemBase2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.getImg.visible=!1},e}(MijingItemBase);__reflect(MijingItemBase2.prototype,"MijingItemBase2");var GwShengWuChooseView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwShengWuChooseSkin",this._aryDate=new eui.ArrayCollection,this.list.dataProvider=this._aryDate,this.list.itemRenderer=GwShengwurenderItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0],this.addTouchEvent(this.bgClose,this.closeHandler),this.addTouchEvent(this.list,this.clickHandler),this.updateView()},e.prototype.updateView=function(){var t=e.getGwItemType(this._data);if(t.sort(this.sortFun),this._data.itemId){var i=new GwItem;i.itemId=this._data.itemId,i.weaponId=this._data.weaponId,i.isCur=!0,t.unshift(i)}0==t.length?this.tipLabel2.visible=!0:this.tipLabel2.visible=!1,this._aryDate.replaceAll(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.closeHandler),this.removeTouchEvent(this.list,this.clickHandler),this.list.dataProvider=null},e.prototype.closeHandler=function(t){ViewManager.ins().close(this)},e.prototype.clickHandler=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;GodWeaponCC.ins().inlayItem(this._data.weaponId,this._data.pos,e.datathis.itemId),ViewManager.ins().close(this)}},e.getGwItemType=function(t){var i=[],s=UserBag.ins().bagModel[UserBag.BAG_TYPE_OTHTER],n=0;if(s)for(var o=0;o<s.length;o++){ItemConfig.getType(s[o].itemConfig),ItemConfig.getJob(s[o].itemConfig);if(15==ItemConfig.getType(s[o].itemConfig)&&ItemConfig.getJob(s[o].itemConfig)==t.weaponId)for(n=0;n<s[o].count;n++){var a=new GwItem;a.itemId=s[o].configID,a.weaponId=t.weaponId,i.push(a)}}var r=GodWeaponCC.ins().allGodItemData[t.weaponId];r=r.concat();var h={};for(n=0;n<r.length;n++)r[n].itemId&&(void 0==h[r[n].itemId]?h[r[n].itemId]=1:h[r[n].itemId]++);for(n=0;n<r.length;n++)if(r[n].itemId&&r[n].config.onlyOne){r[n].config.onlyOne;r[n].config.onlyOne==h[r[n].itemId]&&(e.deleteItemData(r[n].itemId,i),delete h[r[n].itemId])}return i},e.prototype.sortFun=function(t,e){return e.power-t.power},e.deleteItemData=function(t,e){for(var i=0;i<e.length;i++)e[i].itemId==t&&e.splice(i--,1)},e}(BaseEuiView);__reflect(GwShengWuChooseView.prototype,"GwShengWuChooseView"),ViewManager.ins().reg(GwShengWuChooseView,LayerManager.UI_Popup);var GwShengwurenderItem=function(t){function e(){var e=t.call(this)||this;return e.qualityName=["凡品","精品","极品","神品"],e.skinName="GWChooseItemSkin",e.best.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this.datathis=this.data;var e=ItemConfig.getQuality(this.datathis.itemConfig);this.nameTxt.text=this.datathis.itemConfig.name,this.nameTxt.textColor=ItemConfig.getQualityColor(this.datathis.itemConfig),this.attr.text=this.datathis.addatrStr,this.power.text="评分："+this.datathis.power,this.itemIcon.imgJob.source="job"+this.datathis.weaponId+"Item",this.itemIcon.imgIcon.source=this.datathis.itemConfig.icon+"_png",this.itemIcon.imgBg.source="quality"+e,0>e-1?this.quality.text=this.qualityName[0]:this.quality.text=this.qualityName[e-1],this.quality.textColor=ItemConfig.getQualityColor(this.datathis.itemConfig),this.addNameLb.text="装备该圣物可提升"+this.datathis.skillName+"等级",1==this.datathis.isCur?(this.now.visible=!0,this.changeBtn.visible=!1):(this.now.visible=!1,this.changeBtn.visible=!0)}},e}(BaseItemRender);__reflect(GwShengwurenderItem.prototype,"GwShengwurenderItem");var Gwshengwuitem_icon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);__reflect(Gwshengwuitem_icon.prototype,"Gwshengwuitem_icon");var GwSkillTipView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwSkillTipSkin",this.bgClose.touchEnabled=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._dataInfo=t[0],this.addTouchEvent(this.update,this.touchHandler),this.addTouchEvent(this.bgClose,this.closeHandler),this.observe(GodWeaponCC.ins().postUpdateInfo,this.updateView),this.updateView()},e.prototype.updateView=function(){var t=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId);16==this._dataInfo.skillId?(this.currentState="max",this._dataInfo.isOpen?(this.update.visible=!0,this.pointCount.visible=!0,this.unlockDesc.visible=!1,this.unlcokTitle.visible=!1,this.validateNow(),t&&0!=t.skillPoint?this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">当前可用的技能点：</font>'+t.skillPoint):this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">神兵等级每提升10级可获得1个技能点</font>'),0==this._dataInfo.skillLv?(this.nowskillDesc.text="提升等级可学会"+this._dataInfo.config.skillName+"技能",this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(1))):(this.nowskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv)),this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(this._dataInfo.skillLv))),this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv+1)),this.skillImg.source=this._dataInfo.config.iconId+"_N"):(this.validateNow(),this.update.visible=!1,this.pointCount.visible=!1,this.unlcokTitle.visible=!0,this.unlockDesc.visible=!0,this.unlockDesc.text=this._dataInfo.openTip,this.skillImg.source=this._dataInfo.config.iconId+"_L",this.nowskillDesc.text="提升等级可学会"+this._dataInfo.config.skillName+"技能",this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(1)),this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv+1)))):this._dataInfo.isOpen?(this.validateNow(),this._dataInfo.skillLv<this._dataInfo.config.upLevel?(this.currentState="normal",t&&0!=t.skillPoint?this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">当前可用的技能点：</font>'+t.skillPoint):this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">神兵等级每提升10级可获得1个技能点</font>')):this.currentState="fullLv",0==this._dataInfo.skillLv?this.nowskillDesc.text="提升等级可学会"+this._dataInfo.config.skillName+"技能":(this.nowskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addatrStr(this._dataInfo.skillLv)),this._dataInfo.config.skill&&(this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.specialSkill(this._dataInfo.skillLv))),this.descTextAlign(this.nowskillDesc)),this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addatrStr(this._dataInfo.skillLv+1)),this._dataInfo.config.skill&&(this.nextskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.specialSkill(this._dataInfo.skillLv+1))),this.descTextAlign(this.nextskillDesc),this.skillImg.source=this._dataInfo.config.iconId+"_N"):(this.validateNow(),this.currentState="lock",this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.config.lockDesc),this.descTextAlign(this.nowskillDesc),this.unlockDesc.text=this._dataInfo.openTip,this.skillImg.source=this._dataInfo.config.iconId+"_L"),this.skillName.text=this._dataInfo.config.skillName,16==this._dataInfo.skillId?this.lvCount.text=this._dataInfo.lvLabel(!0):this.lvCount.text=this._dataInfo.lvLabel();var e=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId),i=e&&e.skillPoint||0;0>=i?this.update.enabled=!1:this.update.enabled=!0},e.prototype.descTextAlign=function(t){this._dataInfo.config.attr?t.textAlign="center":t.numLines>=2?t.textAlign="left":t.textAlign="center"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.update,this.touchHandler),this.removeTouchEvent(this.bgClose,this.closeHandler)},e.prototype.touchHandler=function(t){if(this._dataInfo.skillLv>=this._dataInfo.config.upLevel)return void UserTips.ins().showTips("已达到最大等级");var e=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId),i=e&&e.skillPoint||0;return 0>=i?void UserTips.ins().showTips("当前可用技能点不足"):(GodWeaponCC.ins().gwshowTips=!0,GodWeaponCC.ins().roleshowTips=SubRoles.ins().subRolesLen,void GodWeaponCC.ins().upSkill(this._dataInfo.weaponId,this._dataInfo.skillId))},e.prototype.closeHandler=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwSkillTipView.prototype,"GwSkillTipView"),ViewManager.ins().reg(GwSkillTipView,LayerManager.UI_Popup);var GwTaskView=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._weaponId=1,e.weaponTxt=["雷霆怒斩","赤血魔剑","无极逍遥扇"],e.skinName="GwTaskSkin",e}return __extends(e,t),e.prototype.open=function(t){this.addTouchEndEvent(this.btn,this.onTap),this.setSelectIndex(t)},e.prototype.close=function(){this.removeTouchEvent(this.btn,this.onTap)},e.prototype.setSelectIndex=function(t){var e=this._weaponId=t+1;this.initSkill();var i="激活|C:0xFFCC00&T:"+this.weaponTxt[t]+"|，需要先完成神兵任务",s=["领取任务","前往","完成任务","激活"];this.BG.source="godweapon_weaponBG"+e+"_png";for(var n=["zhanshi","fashi","daoshi"],o=0;2>=o;o++){var a=this[n[o]];o==t?a.visible=!0:a.visible=!1}for(var r=["renwuchushi","renwuneirong","quanbuwancheng"],h=0,l=r;h<l.length;h++){var c=l[h];this[c].visible=!1}var u=GodWeaponCC.ins().gwTask;if(!GodWeaponCC.ins().weaponIsActive(e))if(u.taskIdx&&u.weapon==e){var p=GlobalConfig.GodWeaponTaskConfig[u.weaponIdx][u.taskIdx];u.statue==GwTaskData.DOING?(i+="|C:0xff0000&T:("+(u.taskIdx-1)+"/5)|",this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.renwuneirong.visible=!0,this.renwuneirong.textFlow=TextFlowMaker.generateTextFlow1(u.taskIdx+"."+p.desc+(p.itemName[u.weapon-1]||"")+"|C:0xff0000&T:("+u.progress+"/"+p.target+")|"),this.btn.label=s[1],this._state=1,this.removeTaskMc()):u.statue==GwTaskData.DONE?(i+="|C:0xff0000&T:("+(u.taskIdx-1)+"/5)|",this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.renwuneirong.visible=!0,this.renwuneirong.textFlow=TextFlowMaker.generateTextFlow1(u.taskIdx+"."+p.desc+(p.itemName[u.weapon-1]||"")+"|C:0x00ff00&T:("+u.progress+"/"+p.target+")|"),this.btn.label=s[2],this._state=2,this.addTaskMc()):(i+="|C:0x00ff00&T:("+u.taskIdx+"/5)|",this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.quanbuwancheng.visible=!0,this.btn.label=s[3],this._state=3,this.addTaskMc())}else this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.renwuchushi.visible=!0,this.btn.label=s[0],this._state=0,this.removeTaskMc()},e.prototype.addTaskMc=function(){this.validateNow(),this.taskMc=this.taskMc||ObjectPool.pop("MovieClip"),this.taskMc.x=this.btn.width/2,this.taskMc.y=this.btn.height/2,this.taskMc.scaleX=1,this.taskMc.scaleY=.85,this.taskMc.touchEnabled=!1,this.btn.parent.addChild(this.taskMc),this.taskMc.playFile(RES_DIR_EFF+"chargeff1",-1)},e.prototype.removeTaskMc=function(){TimerManager.ins().removeAll(this),this.taskMc&&this.taskMc.parent&&(this.taskMc.parent.removeChild(this.taskMc),this.taskMc.destroy()),this.taskMc=null},e.prototype.initSkill=function(){for(var t=this._weaponId,e=GlobalConfig.GodWeaponBaseConfig.noticeSkillId[t-1],i=GlobalConfig.GodWeaponLineConfig[t],s=0,n=0,o=e;n<o.length;n++){var a=o[n],r=GodWeaponCC.ins().getWeaponSkinIdData(t,i[a].skinId);this["item"+s].imgLight=!0,this["item"+s].updateView(r,t-1),this["skillName"+s].text=i[a].skillName,this["skillDesc"+s].text=i[a].lockDesc,s+=1}},e.prototype.onTap=function(t){var e=this,i=t.currentTarget,s=GodWeaponCC.ins().gwTask;if(i==this.btn)if(0==this._state){var n=SubRoles.ins().getSubRoleByJob(this._weaponId);if(!n){var o=["0","战士","法师","道士"];return void UserTips.ins().showTips("未激活"+o[this._weaponId]+"，无法领取任务")}s.weapon?UserTips.ins().showTips("有已领取的神兵任务，请先完成"):WarnWin.show("领取<font color='#FFCC00'>"+this.weaponTxt[this._weaponId-1]+"</font>任务后，需要全部任务做完，才能再次领取其他神兵任务，是否确定领取？",function(){GodWeaponCC.ins().requestReceiveTask(e._weaponId)},this)}else if(1==this._state){var a=GlobalConfig.GodWeaponTaskConfig[s.weaponIdx][s.taskIdx];a.controlTarget&&ViewManager.ins().open(a.controlTarget[0],a.controlTarget[1])}else(2==this._state||3==this._state)&&(GodWeaponCC.ins().requestActiveWeapon(),2==this._state&&(this.taskComMc=this.taskComMc||ObjectPool.pop("MovieClip"),this.taskComMc.playFile(RES_DIR_EFF+"complete",1,function(){e.taskComMc.parent&&(e.taskComMc.parent.removeChild(e.taskComMc),e.taskComMc.destroy(),e.taskComMc=null)}),this.taskComMc.y=this.btn.y-80,this.taskComMc.x=this.btn.x+this.btn.width/2,this.GwTask.addChild(this.taskComMc)))},e}(BaseView);__reflect(GwTaskView.prototype,"GwTaskView");var GwWeaponView=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.clickRect.touchEnabled=!0,this.expschedule.mask=this.maskRect,this.detailBtn.touchEnabled=!0,this.maskPro.touchEnabled=!1,this.progressImg.mask=this.maskPro,this.progressHeadImg=new eui.Image,this.exp.addChild(this.progressHeadImg),this.progressHeadImg.y=39,this.flameMC=new MovieClip,this.flameMC.x=120,this.flameMC.y=30,this.power.addChildAt(this.flameMC,0),this.powerCon=BitmapNumber.ins().createNumPic(0,"8",5),this.powerCon.scaleX=this.power.scaleY=.8,this.powerCon.x=105,this.powerCon.y=20,this.power.addChild(this.powerCon),this.rpImg0.visible=!1,this.rpImg1.visible=!1,this.rpImg2.visible=!1,this.rpImgExp.visible=!1,this.reset.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.reset.text)},e.prototype.open=function(){this.addTouchEvent(this.weapon0,this.touchHandler),this.addTouchEvent(this.weapon1,this.touchHandler),this.addTouchEvent(this.weapon2,this.touchHandler),this.addTouchEvent(this.clickRect,this.touchHandler),this.addTouchEvent(this.detailBtn,this.touchHandler),this.addTouchEvent(this.reset,this.touchHandler),this.observe(GodWeaponCC.ins().postUpdateInfo,this.updateView),this.observe(GodWeaponCC.ins().postUpdateExp,this.updateGwExp),this.observe(GodWeaponCC.ins().postGwTask,this.updateView),this.observe(GodWeaponRedPoint.ins().postGwTab1,this.showRedPoint),this.observe(GodWeaponRedPoint.ins().postGwTab2,this.showRedPoint),this.observe(GodWeaponRedPoint.ins().postGwTab3,this.showRedPoint);for(var t=1;5>=t;t++)this["shengwu"+t].touchEnabled=!0,this["shengwu"+t].touchChildren=!1,this.addTouchEvent(this["shengwu"+t],this.touchHandler);this.selectIndex=this.getSelectedIndex(),this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1),this.godweaponskill.open()},e.prototype.getSelectedIndex=function(t){return void 0==t&&(t=GodWeaponCC.ins().gwTask.taskIdx?GodWeaponCC.ins().gwTask.weapon-1:0),t},Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex=t;var e=GodWeaponCC.ins().weaponIsActive(t+1);e?this.showWeapon():this.showTask(),this.selectBtnImage(),this.showRedPoint(),this.reset.visible=e},enumerable:!0,configurable:!0}),e.prototype.showTask=function(){this.currentState="task",this.gwTask.open(this._selectIndex)},e.prototype.showWeapon=function(){this.currentState="active",this.validateNow();var t=this._selectIndex;this._curWeapon=GodWeaponCC.ins().getWeaponData(t+1),this.godweaponskill.selectIndex=t;var e=t+1;this.weaponName.source="godweapon_name"+e,this.needExp.text="("+this._curWeapon.curExp+"/"+this._curWeapon.config.exp+")",this.lvCount.text="Lv."+this._curWeapon.curLv,0==this._curWeapon.skillPoint?this.curPointLabel.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">神兵等级每提升10级可获得1个技能点</font>'):this.curPointLabel.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">当前可用的技能点：</font>'+this._curWeapon.skillPoint),this.updateGwExp(),this.expschedule.visible=!0;var i,s=this._curWeapon.config.everyExp,n=2*s,o=GodWeaponCC.ins().curExp;n>o?(i=1*o/n,0>i&&(i=0)):i=1;var a=egret.Tween.get(this.maskRect);a.to({scaleY:i},200),this.updateGodItemView(),this.progressHeadImg.source="godweapon_expfront",i=1*this._curWeapon.curExp/this._curWeapon.config.exp,a=egret.Tween.get(this.maskPro,{onChange:this.funcChange,onChangeObj:this}),a.to({scaleX:i},200)},e.prototype.selectBtnImage=function(){switch(this["selectIcon"+this._selectIndex].visible=!0,this._selectIndex){case 0:this.selectIcon1.visible=!1,this.selectIcon2.visible=!1;break;case 1:this.selectIcon0.visible=!1,this.selectIcon2.visible=!1;break;case 2:this.selectIcon0.visible=!1,this.selectIcon1.visible=!1}},e.prototype.showRedPoint=function(){var t=GodWeaponCC.ins().maxLvRedPoint();t?(this.rpImg0.visible=GodWeaponCC.ins().weaponIsActive(1)?!0:!1,this.rpImg1.visible=GodWeaponCC.ins().weaponIsActive(2)?!0:!1,this.rpImg2.visible=GodWeaponCC.ins().weaponIsActive(3)?!0:!1,this.rpImgExp.visible=!0):(this.rpImg0.visible=GodWeaponRedPoint.ins().gwSbRed1,this.rpImg1.visible=GodWeaponRedPoint.ins().gwSbRed2,this.rpImg2.visible=GodWeaponRedPoint.ins().gwSbRed3,this.rpImgExp.visible=!1)},e.prototype.funcChange=function(){341*this.maskPro.scaleX<18?(this.progressHeadImg.x=130,this.progressHeadImg.scaleX=1*(341*this.maskPro.scaleX)/18):(this.progressHeadImg.x=130+341*this.maskPro.scaleX-18,this.progressHeadImg.scaleX=1)},e.prototype.updateGodItemView=function(){for(var t=0;5>t;t++)this["shengwu"+(t+1)].updateView(GodWeaponCC.ins().getGodItemData(this._selectIndex+1,t+1))},e.prototype.updatePower=function(){for(var t=GodWeaponCC.ins().gwAddAttr(this.selectIndex),e=[],i=0;i<t.length;i++)e.push(new AttributeData(t[i].type,t[i].value));var s=UserBag.getAttrPower(e);if(GodWeaponCC.ins().weaponIsActive(this._selectIndex+1)){for(var n=0,o=void 0,a=GodWeaponCC.ins().maxSkillIdAry[this.selectIndex],i=0;a>i;i++)o=GodWeaponCC.ins().getWeaponSkinIdData(this.selectIndex+1,i),o.isOpen&&(n+=o.skillPower);s+=n}BitmapNumber.ins().changeNum(this.powerCon,s,"8",5)},e.prototype.updateView=function(){this.selectIndex=this.selectIndex},e.prototype.updateGwExp=function(){this.updatePower(),this.expcount.text=""+GodWeaponCC.ins().curExp},e.prototype.touchHandler=function(t){if(t.target instanceof eui.Button)switch(t.target){case this.weapon0:this.selectIndex=0;break;case this.weapon1:this.selectIndex=1;break;case this.weapon2:this.selectIndex=2}else if(t.target instanceof GwshengwuItem){var e=void 0;switch(t.target){case this.shengwu1:e=1;break;case this.shengwu2:e=2;break;case this.shengwu3:e=3;break;case this.shengwu4:e=4;break;case this.shengwu5:e=5}this.inlayItem(e)}else if(t.target==this.clickRect){var i=GodWeaponCC.ins().getWeaponData(this.selectIndex+1);if(i&&i.config.everyExp>GodWeaponCC.ins().curExp)return void UserTips.ins().showTips("当前经验不足");GodWeaponCC.ins().gwshowTips=!0,GodWeaponCC.ins().roleshowTips=SubRoles.ins().subRolesLen,GodWeaponCC.ins().upWeapon(this.selectIndex+1)}else t.target==this.detailBtn?ViewManager.ins().open(GwAddAttrView,this.selectIndex):t.target==this.reset&&ViewManager.ins().open(GwResetWin,GodWeaponCC.ins().getWeaponData(this.selectIndex+1))},e.prototype.inlayItem=function(t){var e=GodWeaponCC.ins().getGodItemData(this._selectIndex+1,t);e.isOpen?ViewManager.ins().open(GwShengWuChooseView,e):UserTips.ins().showTips("神兵等级达到"+e.openLv+"级开启")},e.prototype.close=function(){this.godweaponskill.close(),this.removeTouchEvent(this.weapon0,this.touchHandler),this.removeTouchEvent(this.weapon1,this.touchHandler),this.removeTouchEvent(this.weapon2,this.touchHandler),this.removeTouchEvent(this.clickRect,this.touchHandler),this.removeTouchEvent(this.detailBtn,this.touchHandler);for(var t=1;5>=t;t++)this.removeTouchEvent(this["shengwu"+t],this.touchHandler);this.removeObserve()},e}(BaseView);__reflect(GwWeaponView.prototype,"GwWeaponView");var GwshengwuItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.updateView=function(t){this.data=t,t?t.isOpen?t.itemConfig?(this.shengwuImg.source=t.itemConfig.icon+"_png",this.shengwuImg.visible=!0,this.add.visible=!1,this.rpImgAdd.visible=!1,this.frame.source="godweapon_quality"+(ItemConfig.getQuality(t.itemConfig)+1)):(this.shengwuImg.visible=!1,this.add.visible=!0,this.frame.source="godweapon_quality1",GwShengWuChooseView.getGwItemType(t).length<=0?this.rpImgAdd.visible=!1:this.rpImgAdd.visible=!0):(this.shengwuImg.visible=!1,this.add.visible=!1,this.rpImgAdd.visible=!1,this.frame.source="godweapon_quality0"):(this.frame.source="godweapon_quality0",this.add.visible=!1,this.shengwuImg.visible=!1,this.rpImgAdd.visible=!1)},e}(eui.Component);__reflect(GwshengwuItem.prototype,"GwshengwuItem");var GwGodWeaponSkillView=function(t){function e(){var e=t.call(this)||this;return e.max=16,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!1},e.prototype.open=function(){this.addTouchEvent(this,this.touchHandler)},Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex=t,this.updateView(t)},enumerable:!0,configurable:!0}),e.prototype.updateView=function(t){switch(t+1){case 1:this.skill_wp1.visible=!0,this.skill_wp2.visible=!1,this.skill_wp3.visible=!1;break;case 2:this.skill_wp1.visible=!1,this.skill_wp2.visible=!0,this.skill_wp3.visible=!1;break;case 3:this.skill_wp1.visible=!1,this.skill_wp2.visible=!1,this.skill_wp3.visible=!0}this.updateWp(t)},e.prototype.updateWp=function(t){for(var e,i,s=[],n=0;n<this.max;n++)if(e=this.getWpSkill(t+1,n),i=GodWeaponCC.ins().getWeaponSkinIdData(t+1,n),e.updateView(i,t),i&&i.isOpen&&i.config.lineId)for(var o=0;o<i.config.lineId.length;o++)this["wp"+(t+1)+"_lock"+i.config.lineId[o]].visible=!1,this["wp"+(t+1)+"_unlock"+i.config.lineId[o]].visible=!0,-1==s.indexOf(i.config.lineId[o])&&s.push(i.config.lineId[o]);else-1==s.indexOf(n)&&(this["wp"+(t+1)+"_lock"+n].visible=!0,this["wp"+(t+1)+"_unlock"+n].visible=!1)},e.prototype.touchHandler=function(t){if(t.target instanceof GwWeaponSkillIcon){t.target.dataThis;ViewManager.ins().open(GwSkillTipView,t.target.dataThis)}},e.prototype.getWpSkill=function(t,e){return this["wp"+t+"_skill"+e]},e.prototype.getWpLine=function(t,e){return this["wp"+t+"_line"+e]},e.prototype.close=function(){this.removeTouchEvent(this,this.touchHandler);for(var t=0;3>t;t++)for(var e=void 0,i=0;i<this.max;i++)e=this.getWpSkill(t+1,i),e.close()},e}(BaseView);__reflect(GwGodWeaponSkillView.prototype,"GwGodWeaponSkillView");var GwWeaponSkillIcon=function(t){function e(){var e=t.call(this)||this;return e._isFirst=!1,e.imgLight=!1,e.skinName="GwItemSkin",e.touchChildren=!1,e.glowImg.visible=!1,e._effect=new MovieClip,e.addChildAt(e._effect,3),e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchChildren=!1},e.prototype.updateView=function(t,e){if(this.dataThis=t,0==this._isFirst&&(this.validateNow(),this._isFirst=!0),t.isOpen||this.imgLight){var i=GodWeaponCC.ins().getWeaponData(e+1);if(t.skillLv<t.config.upLevel&&i&&i.skillPoint>0)switch(this._effect.name||(this._effect.playFile(RES_DIR_EFF+"actIconCircle",-1),this._effect.x=45,this._effect.y=45),this.dataThis.skillId){case 16:case 15:case 14:case 13:this._effect.scaleX=this._effect.scaleY=1.1;break;default:this._effect.scaleX=this._effect.scaleY=.6}else this._effect.dispose();this.Img.source=t.config.iconId+"_N"}else this.glowImg.visible=!1,this.Img.source=t.config.iconId+"_L",this._effect&&this._effect.dispose();t.addLv>0||t.skillLv>0||t.isOpen?(this.lvCount.visible=!0,this.lvFrame.visible=!0,t.addLv>0&&(this.lvCount.textColor=3531373),16==this.dataThis.skillId?this.lvCount.text=t.lvLabel(!0):this.lvCount.text=t.lvLabel()):(this.lvCount.visible=!1,this.lvFrame.visible=!1)},e.prototype.close=function(){this.dataThis=null,this._effect.dispose()},e}(BaseView);__reflect(GwWeaponSkillIcon.prototype,"GwWeaponSkillIcon");var GodWingRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleTabs={},e.tabs={},e.roleTabs={},e.redPoint=!1,e.associated(e.postGodWingRedPoint,e.postGodWingItem),e.associated(e.postGodWingItem,Wing.ins().postWingWear,Wing.ins().postGodWingData,Wing.ins().postWingUpgrade,Wing.ins().postActivate,UserBag.ins().postItemChange,UserBag.ins().postItemAdd),e.associated(e.postGodWingCompose,UserBag.ins().postItemChange,UserBag.ins().postItemAdd),e}return __extends(e,t),e.prototype.postGodWingRedPoint=function(){var t=this.redPoint;return this.redPoint=this.tabs[0]||this.tabs[1],t!=this.redPoint},e.prototype.postGodWingItem=function(){var t=0;this.roleTabs[t]||(this.roleTabs[t]={});for(var e=3,i=0;e>i;i++)this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][i]=Wing.ins().isWearGodWing(i);this.tabs[t]=!1;for(var s in this.roleTabs[t])this.roleTabs[t][s]&&(this.tabs[t]=!0);return!0},e.prototype.postGodWingCompose=function(){var t=1;return this.tabs[t]=Wing.ins().isComposeGodWingAll(),this.roleTabs[t]||(this.roleTabs[t]={}),!0},e.prototype.postGodWingTransfer=function(){var t=2;this.roleTabs[t]||(this.roleTabs[t]={}),this.tabs[t]=Boolean(UserBag.ins().getBagGoodsByType(ItemType.TYPE_16))},e.prototype.getGodWingRedPoint=function(){if(GameServer.serverOpenDay+1<GlobalConfig.WingCommonConfig.openDay)return!1;for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(e.openStatus)return this.redPoint}return!1},e}(BaseSystem);__reflect(GodWingRedPoint.prototype,"GodWingRedPoint");var GameSystem;!function(t){t.godwingredpoint=GodWingRedPoint.ins.bind(GodWingRedPoint)}(GameSystem||(GameSystem={}));var GodWingComposeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuComposeItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.suitConfig,e=this.data.slot,i=GlobalConfig.GodWingLevelConfig[t.lv][e],s=GlobalConfig.ItemConfig[i.itemId];this.nameTxt.text=s.name}},e.prototype.setRedPoint=function(t){this.redPoint.visible=t},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(GodWingComposeItem.prototype,"GodWingComposeItem");var GodWingComposePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.compose,this.onClick),this.removeObserve();for(var i=0;i<Wing.GodWingMaxSlot;i++)this.removeTouchEvent(this["item"+i],this.onSlot)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.compose,this.onClick),this.addTouchEvent(this.now,this.onClick),this.addTouchEndEvent(this.next,this.onClick),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.observe(GodWingRedPoint.ins().postGodWingCompose,this.updateItem),this.slot=1;for(var i in GlobalConfig.GodWingSuitConfig){this.curIndex=GlobalConfig.GodWingSuitConfig[i].lv;break}for(var i=0;i<Wing.GodWingMaxSlot;i++)this.addTouchEvent(this["item"+i],this.onSlot),this["item"+i].setSelect(!1);this.item0.setSelect(!0),this.list.itemRenderer=GodWingComposeItem,this.itemList=new eui.ArrayCollection([]),this.updateGodWing()},e.prototype.onListTap=function(t){if(t&&t.itemRenderer&&t.item){var e=t.item;this.curIndex=e.suitConfig.lv,this.updateItem()}},e.prototype.onSlot=function(t){for(var e=0;e<Wing.GodWingMaxSlot;e++)t.currentTarget==this["item"+e]?(this["item"+e].setSelect(!0),this.slot=e+1,this.updateItem()):this["item"+e].setSelect(!1)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.compose:var e=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];if(Wing.ins().isComposeGodWingOnly(e.itemId)){var i=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];Wing.ins().sendWingCompose(2,i.itemId)}else UserTips.ins().showTips("|C:0xff0000&T:材料不足");break;case this.now:var s=void 0;if(t.currentTarget.data instanceof ItemConfig){var n=t.currentTarget.data,o=UserBag.ins().getBagItemById(n.id),a=o?o.count:0;ViewManager.ins().open(ItemDetailedWin,0,n.id,a)}else{var r=t.currentTarget.data;s=GlobalConfig.GodWingItemConfig[r.itemId],ViewManager.ins().open(GodWingTipsWin,s)}break;case this.next:var h=t.currentTarget.data;s=GlobalConfig.GodWingItemConfig[h.itemId],ViewManager.ins().open(GodWingTipsWin,s)}},e.prototype.updateGodWing=function(){this.dataList=[];var t=1;for(var e in GlobalConfig.GodWingSuitConfig){var i=GlobalConfig.GodWingSuitConfig[e];
this.dataList.push({slot:t,suitConfig:i})}this.itemList.replaceAll(this.dataList),this.list.dataProvider=this.itemList,this.list.validateNow(),this.list.selectedIndex=0,this.updateItem()},e.prototype.updateItem=function(){var t=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot],e=0,i=0;if(this.power0.visible=this.attr0.visible=!1,t){this.next.data=t,this.next.setCountVisible(!1);var s=GlobalConfig.GodWingItemConfig[t.itemId];if(s=GlobalConfig.GodWingItemConfig[s.composeItem.id]){var n=Wing.ins().getPreLevel(this.curIndex),o=GlobalConfig.GodWingLevelConfig[n][this.slot];this.now.data=o,this.now.setCountVisible(!1);var a=GlobalConfig.GodWingItemConfig[o.itemId],r=AttributeData.getAttStr(a.attr,0,1,"：")+"\n";r+=AttributeData.getExAttrNameByAttrbute(a.exattr[0],!0),this.attr1.text=r;var h=Math.floor(UserBag.getAttrPower(a.attr));this.power1.text="战斗力："+(h+a.exPower),s=GlobalConfig.GodWingItemConfig[t.itemId];var l=AttributeData.getAttStr(s.attr,0,1,"：")+"\n";l+=AttributeData.getExAttrNameByAttrbute(s.exattr[0],!0),this.attr2.text=l;var c=Math.floor(UserBag.getAttrPower(s.attr));this.power2.text="战斗力："+(c+s.exPower);var u=UserBag.ins().getBagItemById(s.composeItem.id);e=u?u.count:0,i=s.composeItem.count}else{s=GlobalConfig.GodWingItemConfig[t.itemId];var p=GlobalConfig.ItemConfig[s.composeItem.id];this.now.data=p,this.now.setCountVisible(!1);var l=AttributeData.getAttStr(s.attr,0,1,"：")+"\n";l+=AttributeData.getExAttrNameByAttrbute(s.exattr[0],!0),this.attr0.text=l;var d=Math.floor(UserBag.getAttrPower(s.attr));this.power0.text="战斗力："+(d+s.exPower);var u=UserBag.ins().getBagItemById(p.id);e=u?u.count:0,i=s.composeItem.count,this.power0.visible=this.attr0.visible=!0}}this.attr1.visible=this.attr2.visible=!this.attr0.visible,this.power1.visible=this.power2.visible=!this.power0.visible;var g;g=e>=i?ColorUtil.GREEN:ColorUtil.RED,this.number.textFlow=TextFlowMaker.generateTextFlow1("|C:"+g+"&T:"+e+"|/|C:0xD1C28F&T:"+i);for(var f=0;f<this.dataList.length;f++)this.dataList[f].slot=this.slot;this.itemList.replaceAll(this.dataList),this.list.dataProvider=this.itemList,this.updateRedPoint(),this.updateGodWingItem()},e.prototype.updateGodWingItem=function(){for(var t=0;t<Wing.GodWingMaxSlot;t++){var e=GlobalConfig.GodWingLevelConfig[this.curIndex][t+1],i=GlobalConfig.GodWingItemConfig[e.itemId];this["item"+t].data=i,this["item"+t].setImgIcon("sybg"+(t+1)),this["item"+t].setCountVisible(!1),this["item"+t].setNameVisible(!1)}},e.prototype.updateRedPoint=function(){var t=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];this.redPoint.visible=Wing.ins().isComposeGodWingOnly(t.itemId);for(var e=0;e<this.list.numElements;e++){var i=this.list.getVirtualElementAt(e),s=this.list.dataProvider.getItemAt(e),n=Wing.ins().isComposeGodWingLevel(s.suitConfig.lv,this.slot);i.setRedPoint(n)}for(var e=1;e<=Wing.GodWingMaxSlot;e++){var n=Wing.ins().isComposeGodWingSlot(this.curIndex,e);this["item"+(e-1)].updateRedPoint(n)}},e}(BaseView);__reflect(GodWingComposePanel.prototype,"GodWingComposePanel");var GodWingItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setSelect=function(t){this.select.visible=t},e.prototype.dataChanged=function(){if(this.data){if(this.itemId=0,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.source="",this.data instanceof GodWingItemConfig){var t=this.data,e=GlobalConfig.ItemConfig[t.itemId];this.itemIcon.imgIcon.source=e.icon+"_png",this.nameTxt.text=e.name,this.itemId=t.itemId,this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(e),this.nameTxt.textColor=ItemConfig.getQualityColor(e)}else if(this.data instanceof ItemData){var i=this.data,e=GlobalConfig.ItemConfig[i._configID];this.itemIcon.imgIcon.source=e.icon+"_png",this.nameTxt.text=e.name,this.itemId=e.id,this.count.text=i.count+"",this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(e),this.nameTxt.textColor=ItemConfig.getQualityColor(e)}else if(this.data instanceof ItemConfig){var s=this.data;this.itemIcon.imgIcon.source=s.icon+"_png",this.nameTxt.text=s.name,this.itemId=s.id,this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(s),this.nameTxt.textColor=ItemConfig.getQualityColor(s)}else if(this.data instanceof GodWingSuitConfig){var s=this.data;if(!s.skillname)for(var n in GlobalConfig.GodWingSuitConfig)if(GlobalConfig.GodWingSuitConfig[n].skillname){s=GlobalConfig.GodWingSuitConfig[n],this.data=s;break}this.itemIcon.imgIcon.source=s.skillicon,this.nameTxt.text=s.skillname}else if(this.data instanceof GodWingLevelConfig){var s=this.data,o=GlobalConfig.ItemConfig[s.itemId];this.itemIcon.imgIcon.source=o.icon+"_png",this.nameTxt.text=o.name,this.itemIcon.imgBg.source="quality"+ItemConfig.getQuality(o),this.nameTxt.textColor=ItemConfig.getQualityColor(o)}this.itemIcon.imgIcon.visible=this.itemIcon.imgIcon.source?!0:!1}},e.prototype.setCountVisible=function(t){this.count.visible=t},e.prototype.setNameVisible=function(t){this.nameTxt.visible=t,t||this.setQuality("quality0")},e.prototype.setImgIcon=function(t){this.itemIcon.imgIcon.source=t,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.visible=this.itemIcon.imgIcon.source?!0:!1},e.prototype.updateRedPoint=function(t){this.redPoint.visible=t},e.prototype.setNameText=function(t){this.nameTxt.text=t},e.prototype.setQuality=function(t){this.itemIcon.imgBg.source=t},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(GodWingItem.prototype,"GodWingItem");var GodWingPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.attr,this.onClick),this.addTouchEndEvent(this.skill,this.onTouch),this.addTouchEndEvent(this.replace,this.onClick),this.addTouchEndEvent(this.replace0,this.onClick),this.addTouchEndEvent(this.getItemTxt,this.onClick),this.observe(GodWingRedPoint.ins().postGodWingItem,this.updateItem);for(var i=0;i<Wing.GodWingMaxSlot;i++)this.addTouchEvent(this["item"+i],this.onTab);this.slot=1,this.updateGodWing()},e.prototype.onTab=function(t){for(var e=0;e<Wing.GodWingMaxSlot;e++)t.currentTarget==this["item"+e]?(this.slot=e+1,this["item"+e].setSelect(!0),this.updateGodWing()):this["item"+e].setSelect(!1)},e.prototype.onClick=function(t){switch(t.target){case this.attr:ViewManager.ins().open(GodWingSuitTipsWin,this.curRole);break;case this.replace:var e=this["item"+(this.slot-1)].data;if(e){if(e=GlobalConfig.GodWingLevelConfig[e.level][e.slot],!Wing.ins().wearItemRedPoint(this.curRole,this.slot))return void UserTips.ins().showTips("无可穿戴的高阶神羽");var i=Wing.ins().getWearItem(this.curRole,this.slot);i||(i=e.itemId),Wing.ins().sendWingWear(this.curRole,i)}break;case this.replace0:if(Wing.ins().isQuicComposeGodWing(this.curRole,this.slot)){var s=Wing.ins().getCurLevelItemId(this.curRole,this.slot);if(s){var n=Wing.ins().getNextLevel(s.level);s=GlobalConfig.GodWingLevelConfig[n][this.slot]}else{var n=Wing.ins().getStartLevel(this.slot);s=GlobalConfig.GodWingLevelConfig[n][this.slot]}if(!Wing.ins().checkGodWingLevel(this.curRole,s.itemId))return void UserTips.ins().showTips("不符合穿戴要求");if(!Wing.ins().checkGodWingItem(this.curRole,s.itemId,this.slot))return void UserTips.ins().showTips("没有足够的材料");Wing.ins().sendWingCompose(1,s.itemId,this.curRole)}else UserTips.ins().showTips("道具不足或穿戴等级不足");break;case this.getItemTxt:var o=this["item"+(this.slot-1)].data;if(o){o=GlobalConfig.GodWingItemConfig[o.itemId];var a=o.itemId;Wing.ins().getGodWing(this.curRole).getLevel(this.slot)||o instanceof GodWingItemConfig&&(a=o.composeItem.id),UserWarn.ins().setBuyGoodsWarn(a)}}},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.skill:ViewManager.ins().open(GodWingSkillTipsWin,this.skill.data,this.isActive)}},e.prototype.updateGodWing=function(){this.updateItem()},e.prototype.updateItem=function(){var t=Wing.ins().getGodWing(this.curRole),e=t.getData(),i=t.getLevel(this.slot);if(this.attr0.visible=i?!1:!0,this.attr1.visible=this.attr2.visible=!this.attr0.visible,this.state0.visible=this.power0.visible=this.attr0.visible,this.power1.visible=this.power2.visible=!this.power0.visible,this.state1.visible=this.state2.visible=!this.state0.visible,this.attr3.visible=this.power3.visible=this.state3.visible=!1,i&&!Wing.ins().getNextLevel(i)){this.attr3.visible=this.power3.visible=this.state3.visible=!0;for(var s=0;3>s;s++)this["attr"+s].visible=this["power"+s].visible=this["state"+s].visible=!this.attr3.visible}var n,o,a=0,r=t.getSuitSum();if(r>=Wing.GodWingMaxSlot){var h=t.getSuitLevel(),l=GlobalConfig.GodWingSuitConfig[h];l&&(a=l.precent/1e4)}if(this.attr0.visible){var c=Wing.ins().getStartLevel(this.slot),u=GlobalConfig.GodWingLevelConfig[c][this.slot];n=GlobalConfig.GodWingItemConfig[u.itemId];var p=Math.floor(UserBag.getAttrPower(n.attr));this.power0.text="战斗力："+(p+n.exPower),this.power0.visible=!0,this.attr0.text=AttributeData.getAttStr(n.attr,0,1,"：");var d=AttributeData.getAttStr(n.attr,0,1,"：")+"\n";d+=AttributeData.getExAttrNameByAttrbute(n.exattr[0],!0),this.attr0.text=d}if(this.attr1.visible){var g=Wing.ins().getCurLevelItemId(this.curRole,this.slot);if(g){n=GlobalConfig.GodWingItemConfig[g.itemId];var f=AttributeData.getPercentAttr(n.attr,a),v=Math.floor(UserBag.getAttrPower(f));this.power1.text="战斗力："+(v+n.exPower);var d=AttributeData.getAttStr(n.attr,0,1,"：")+"\n";d+=AttributeData.getExAttrNameByAttrbute(n.exattr[0],!0),this.attr1.text=d}if(g=Wing.ins().getNextLevelItemId(this.curRole,this.slot)){o=GlobalConfig.GodWingItemConfig[g.itemId];var f=AttributeData.getPercentAttr(o.attr,a),y=Math.floor(UserBag.getAttrPower(f));this.power2.text="战斗力："+(y+o.exPower);var d=AttributeData.getAttStr(o.attr,0,1,"：")+"\n";d+=AttributeData.getExAttrNameByAttrbute(o.exattr[0],!0),this.attr2.text=d}}if(this.attr3.visible){var g=Wing.ins().getCurLevelItemId(this.curRole,this.slot);n=GlobalConfig.GodWingItemConfig[g.itemId];var f=AttributeData.getPercentAttr(n.attr,a),p=Math.floor(UserBag.getAttrPower(f));this.power3.text="战斗力："+(p+n.exPower),this.power3.visible=!0,this.attr3.text=AttributeData.getAttStr(n.attr,0,1,"：");var d=AttributeData.getAttStr(n.attr,0,1,"：")+"\n";d+=AttributeData.getExAttrNameByAttrbute(n.exattr[0],!0),this.attr3.text=d}var m=n;if(this.costImg0.visible=this.cost0.visible=!0,!this.attr0.visible){var T=Wing.ins().getNextLevel(n.level);if(T){var b=GlobalConfig.GodWingLevelConfig[T][this.slot];m=GlobalConfig.GodWingItemConfig[b.itemId]}else this.costImg0.visible=this.cost0.visible=!1}this.updateCost(m);for(var s=0;4>s;s++){this["item"+s].data=null,this["item"+s].setSelect(!1),this["item"+s].setCountVisible(!1);var C=Wing.ins().getGodWing(this.curRole).getLevel(s+1);this["item"+s].setNameVisible(C)}this["item"+(this.slot-1)].data=n,Wing.ins().getCurLevelItemId(this.curRole,this.slot)||this["item"+(this.slot-1)].setImgIcon("sybg"+this.slot),this["item"+(this.slot-1)].setSelect(!0),this["item"+(this.slot-1)].setCountVisible(!1);var I=Wing.ins().getGodWing(this.curRole).getLevel(this.slot);this["item"+(this.slot-1)].setNameVisible(I);for(var s=1;4>=s;s++)if(s!=this.slot){var w=void 0,_=!1;e[s]?(w=e[s].level,_=!0):w=Wing.ins().getStartLevel(s);var S=GlobalConfig.GodWingLevelConfig[w][s],B=GlobalConfig.GodWingItemConfig[S.itemId];B&&(this["item"+(s-1)].data=B,_||(this["item"+(s-1)].setImgIcon("sybg"+s),this["item"+(s-1)].setQuality("quality0")))}this.updatePower(),this.updateRedPoint(),this.updateSkill()},e.prototype.setNnactive=function(){for(var t in GlobalConfig.GodWingSuitConfig){var e=GlobalConfig.GodWingSuitConfig[t];this.skill.data=e,this.skill.setCountVisible(!1),this.skill.setImgIcon("sy100000");break}},e.prototype.updateSkill=function(){var t,e=Wing.ins().getGodWing(this.curRole),i=e.getSuitLevel();if(this.isActive=!1,!i)return this.setNnactive(),0;var s=GlobalConfig.GodWingSuitConfig[i];if(s.skillname&&(this.isActive=!0),t=s,this.skill.data=t,this.skill.setCountVisible(!1),!this.isActive){this.skill.setImgIcon("sy100000");for(var n in GlobalConfig.GodWingSuitConfig){var o=GlobalConfig.GodWingSuitConfig[n];o.skillname&&this.skill.setNameText(o.skillname)}}},e.prototype.updateCost=function(t){if(t){var e=UserBag.ins().getBagItemById(t.composeItem.id),i=e?e.count:0,s=Wing.ins().getGodWing(this.curRole).getLevel(this.slot);if(s){var n=GlobalConfig.GodWingLevelConfig[s][this.slot];n.itemId==t.composeItem.id&&(i+=1)}var o=GlobalConfig.ItemConfig[t.composeItem.id];this.costImg0.source=o.icon+"_png",this.costImg0.visible=!1;var a;a=i>=t.composeItem.count?ColorUtil.GREEN:ColorUtil.RED,this.cost0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:"+i+"|/|C:0xD1C28F&T:"+t.composeItem.count),this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text);var r=GlobalConfig.ItemConfig[t.composeItem.id];a=ItemConfig.getQualityColor(r),this.costName.textFlow=TextFlowMaker.generateTextFlow1("消耗|C:"+a+"&T:"+r.name+"|C:65280&T::")}},e.prototype.updateRedPoint=function(){for(var t=0;t<Wing.GodWingMaxSlot;t++)this["item"+t].updateRedPoint(Wing.ins().gridRedPoint(this.curRole,t+1));this.redPointReplace.visible=Wing.ins().wearItemRedPoint(this.curRole,this.slot),this.redPointReplace0.visible=Wing.ins().quickComposeRedPoint(this.curRole,this.slot)},e.prototype.updatePower=function(){var t=Wing.ins().getGodWing(this.curRole),e=t.getData(),i=0,s=0,n=t.getSuitSum();if(n>=Wing.GodWingMaxSlot){var o=t.getSuitLevel(),a=GlobalConfig.GodWingSuitConfig[o];a&&(s=a.precent/1e4)}for(var r in e){var h=GlobalConfig.GodWingLevelConfig[e[r].level][e[r].slot],l=GlobalConfig.GodWingItemConfig[h.itemId],c=l.exPower?l.exPower:0,u=AttributeData.getPercentAttr(l.attr,s);i+=Math.floor(UserBag.getAttrPower(u))+c}this.powerPanel.setPower(i)},e}(BaseView);__reflect(GodWingPanel.prototype,"GodWingPanel");var GodWingSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuSkillTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.gwsConfig=t[0];var i=t[1];for(var s in GlobalConfig.GodWingSuitConfig){var n=GlobalConfig.GodWingSuitConfig[s];if(n.skillname&&n.lv>this.gwsConfig.lv){this.nextConfig=n;break}}i?this.nextConfig?this.currentState="active":this.currentState="max":this.currentState="unactive",this.validateNow(),this.updateDesc()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.updateDesc=function(){this.setCurDesc(),this.setNextDesc()},e.prototype.setCurDesc=function(){this.icon.data=this.gwsConfig,this.icon.setNameVisible(!1),this.icon.setCountVisible(!1),this.content.textFlow=TextFlowMaker.generateTextFlow1(this.gwsConfig.skilldesc),this.lv.text="等级："+this.gwsConfig.skilllevel;var t=GlobalConfig.GodWingLevelConfig[this.gwsConfig.lv][1],e=GlobalConfig.GodWingItemConfig[t.itemId].showlv;this.condition.text="所有神羽达到"+e+"阶"},e.prototype.setNextDesc=function(){if(this.nextConfig){this.icon0.data=this.nextConfig,this.icon0.setNameVisible(!1),this.icon0.setCountVisible(!1),this.content0.textFlow=TextFlowMaker.generateTextFlow1(this.nextConfig.skilldesc),this.lv0.text="等级："+this.nextConfig.skilllevel;var t=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1];GlobalConfig.GodWingItemConfig[t.itemId].showlv;this.condition0.text="所有神羽达到"+this.nextConfig.lv+"阶"}},e}(BaseEuiView);__reflect(GodWingSkillTipsWin.prototype,"GodWingSkillTipsWin"),ViewManager.ins().reg(GodWingSkillTipsWin,LayerManager.UI_Popup);var GodWingSuitTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuSuitTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.roleIndex=t[0];var i=Wing.ins().getGodWing(this.roleIndex).getSuitLevel(),s=0;if(i&&(s=Wing.ins().getNextLevel(i)),this.gwsConfig=GlobalConfig.GodWingSuitConfig[i],!this.gwsConfig)for(var n in GlobalConfig.GodWingSuitConfig){this.gwsConfig=GlobalConfig.GodWingSuitConfig[n];break}i?(this.nextConfig=GlobalConfig.GodWingSuitConfig[s],this.nextConfig?this.currentState="active":this.currentState="max"):this.currentState="unactive",this.validateNow(),this.updateDesc()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.updateDesc=function(){this.setCurDesc(),this.setNextDesc()},e.prototype.setCurDesc=function(){if("unactive"==this.currentState){var t=Math.floor(this.gwsConfig.precent/100),e=Wing.GodWingMaxSlot,i=Wing.ins().getGodWing(this.roleIndex).getSuitSum();this.content0.text="激活条件：全部神羽1阶可激活（"+i+"/"+e+"）\n激活属性：羽翼全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}else if("max"==this.currentState){var t=Math.floor(this.gwsConfig.precent/100);this.content0.text="激活属性：羽翼全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}else{var t=Math.floor(this.gwsConfig.precent/100);this.content0.text="激活属性：羽翼全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}},e.prototype.setNextDesc=function(){if("active"==this.currentState){for(var t=Math.floor(this.nextConfig.precent/100),e=Wing.GodWingMaxSlot,i=Wing.ins().calcGodWingSlot(this.roleIndex),s=0,n=0;n<i.length;n++)i[n].level>=this.nextConfig.lv&&s++;var o=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1],a=GlobalConfig.GodWingItemConfig[o.itemId].showlv;this.content1.text="激活条件：全部神羽"+a+"阶可激活（"+s+"/"+e+"）\n激活属性：羽翼全属性+"+t+"%",this.name1.text=this.nextConfig.suitname}},e}(BaseEuiView);__reflect(GodWingSuitTipsWin.prototype,"GodWingSuitTipsWin"),ViewManager.ins().reg(GodWingSuitTipsWin,LayerManager.UI_Popup);var GodWingTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.otherClose),this.gwConfig=t[0],this.updateTips()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.updateTips=function(){var t=GlobalConfig.ItemConfig[this.gwConfig.itemId];this.nameLabel.text=t.name,this.type.text=Wing.ins().getNameFromSlot(this.gwConfig.slot),this.lv.text="羽翼"+this.gwConfig.level+"阶可穿戴";for(var e=16711680,i=0;i<SubRoles.ins().subRolesLen;i++){var s=SubRoles.ins().getSubRoleByIndex(i);if(s&&s.wingsData.lv+1>=this.gwConfig.level){e=65280;break}}this.lv.textColor=e,this.nameLabel.textColor=ItemConfig.getQualityColor(t);for(var n=this.gwConfig.attr,o=this.gwConfig.exattr,a="",r=this.gwConfig.exPower,i=0;i<n.length;i++)a+=AttributeData.getAttrStrByType(n[i].type)+": ",a+=n[i].value+"\n";for(var i=0;i<o.length;i++){a+=AttributeData.getExtAttrStrByType(o[i].type)+": ";var h=o[i].value;(o[i].type==ExAttributeType.eatMiss||o[i].type==ExAttributeType.eatHit)&&(h/=100,a+=h,a+="%"),a+="\n"}var l=a.lastIndexOf("\n");a=a.substring(0,l),this.attr0.text=a;var c=n,u=Math.floor(UserBag.getAttrPower(c))+r;this.score.text="评分："+u,this.powerPanel.setPower(u),this.itemIcon.data=this.gwConfig,this.itemIcon.setNameVisible(!1),this.itemIcon.setCountVisible(!1),this.quali.source="quali"+ItemConfig.getQuality(t)},e}(BaseEuiView);__reflect(GodWingTipsWin.prototype,"GodWingTipsWin"),ViewManager.ins().reg(GodWingTipsWin,LayerManager.UI_Popup);var GodWingTransferPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.transfer,this.onClick),this.removeTouchEvent(this.have,this.onListTap),this.removeTouchEvent(this.item0,this.onClick),this.removeObserve(),this.reset();for(var i=1;i<Wing.GodWingMaxSlot;i++)this.removeTouchEvent(this["item"+i],this.onTouchItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.transfer,this.onClick),this.addTouchEvent(this.have,this.onListTap),this.addTouchEvent(this.item0,this.onClick),this.observe(UserBag.ins().postItemAdd,this.callbackUpdate),this.itemList=new eui.ArrayCollection,this.have.itemRenderer=GodWingItem,this.have.dataProvider=new eui.ArrayCollection([]),this.updateGodWing()},e.prototype.reset=function(){for(var t=1;t<Wing.GodWingMaxSlot;t++)this.addTouchEvent(this["item"+t],this.onTouchItem),this["item"+t].setCountVisible(!1),this["item"+t].setNameVisible(!1),this["item"+t].setImgIcon(""),this["item"+t].setSelect(!1),this["item"+t].data=null;this.item0.setCountVisible(!1),this.item0.setImgIcon(""),this.item0.setNameVisible(!1),this.item0.data=null,this.updateBagList(),this.warn.visible=this.itemList.length?!1:!0,this.curItemId=0,this.desId=0},e.prototype.updateBagList=function(){var t=UserBag.ins().getBagGoodsByType(ItemType.TYPE_16);this.itemList.replaceAll(t),this.have.dataProvider=this.itemList},e.prototype.callbackUpdate=function(){if(this.item0.itemId){var t=UserBag.ins().getBagItemById(this.item0.itemId);t||this.reset(),this.updateBagList(),this.updateCost()}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.transfer:Boolean(UserBag.ins().getBagGoodsByType(ItemType.TYPE_16))?this.item0.itemId&&this.desId?Wing.ins().sendResetGodWing(this.item0.itemId,this.desId):UserTips.ins().showTips("请确认转换源和转换目标"):UserTips.ins().showTips("不可转换");break;case this.item0:if(this.curItemId){var e=GlobalConfig.GodWingItemConfig[this.curItemId];ViewManager.ins().open(GodWingTipsWin,e)}}},e.prototype.onTouchItem=function(t){for(var e=1;e<Wing.GodWingMaxSlot;e++)t.currentTarget==this["item"+e]?t.currentTarget.itemId&&(this.desId=t.currentTarget.itemId,this["item"+e].setSelect(!0)):this["item"+e].setSelect(!1)},e.prototype.onListTap=function(t){if(t&&t.currentTarget&&this.have.selectedItem){var e=this.have.selectedItem;this.curItemId=e._configID;var i=GlobalConfig.GodWingItemConfig[e._configID],s=GlobalConfig.GodWingLevelConfig[i.level];this.item0.data=i,this.item0.setNameVisible(!0);var n=GlobalConfig.ItemConfig[e._configID];this.item0.setImgIcon(n.icon+"_png");var o=1;for(var a in s)if(s[a].slot!=i.slot&&(this["item"+o].data=GlobalConfig.GodWingItemConfig[s[a].itemId],this["item"+o].setNameVisible(!0),this["item"+o].setSelect(!1),o++,o>3))break;this.updateCost()}},e.prototype.updateGodWing=function(){this.reset(),this.updateCost()},e.prototype.updateCost=function(){if(!this.curItemId)return void(this.costImg0.visible=this.cost.visible=!1);this.costImg0.visible=this.cost.visible=!0;var t=GlobalConfig.GodWingItemConfig[this.curItemId];this.cost.text=t.needMoney+""},e.prototype.updateRedPoint=function(){},e}(BaseView);__reflect(GodWingTransferPanel.prototype,"GodWingTransferPanel");var GodWingWin=function(t){function e(){var e=t.call(this)||this;return e.roleIndex=0,e.skinName="ShenYuSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(GodWingRedPoint.ins().postGodWingRedPoint,this.updateRedPoint),this.observe(GodWingRedPoint.ins().postGodWingItem,this.updateRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.updateRedPoint),this.roleIndex=t[0]?t[0]:0,this.roleSelect.setCurRole(this.roleIndex),this.godWingPanel.curRole=this.roleIndex,this.setOpenIndex(0),this.updateRedPoint()},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.setRoleId=function(t){this.godWingPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.roleSelect.openRole(),this.godWingPanel.open();break;case 1:this.roleSelect.hideRole(),this.godWingComposePanel.open();break;case 2:this.roleSelect.hideRole(),this.godWingTransferPanel.open()}this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.updateRedPoint=function(){if(GodWingRedPoint.ins().tabs||(GodWingRedPoint.ins().tabs={}),this.redPoint0.visible=GodWingRedPoint.ins().tabs[0],this.redPoint1.visible=GodWingRedPoint.ins().tabs[1],!this.tab.selectedIndex)for(var t=0;t<SubRoles.ins().subRolesLen;t++)this.roleSelect.showRedPoint(t,GodWingRedPoint.ins().roleTabs[this.tab.selectedIndex][t])},e}(BaseEuiView);__reflect(GodWingWin.prototype,"GodWingWin"),ViewManager.ins().reg(GodWingWin,LayerManager.UI_Main);var GuardMainUI=function(t){function e(){var e=t.call(this)||this;return e.isDelayBuff=!1,e.skillCd1=0,e.skillCd2=0,e.skillCd3=0,e.isDelayUpdateInfo=!1,e.skinName="guardGodWeaponUISkind",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.help,this.onHelp),this.addTouchEvent(this.luckyBossBtn,this.onLuckBoss),this.addTouchEvent(this.skillBtn1,this.useSkill),this.addTouchEvent(this.skillBtn2,this.useSkill),this.addTouchEvent(this.skillBtn3,this.useSkill),this.observe(GameLogic.ins().postHpChange,this.updateHead),this.observe(UserFb.ins().postGuardCopyInfo,this.delayUpdateInfo),this.observe(UserSkill.ins().postDoBuff,this.doBuff),this.observe(UserSkill.ins().postDoRemoveBuff,this.doBuff),this.observe(UserFb.ins().postGuardUseSkill,this.useSkillHandler),void 0!=GuardWeaponModel.ins().leftTime?this.beginTime():this.observe(UserFb.ins().postGuardLeftTime,this.beginTime),this.updateHeadIcon(),this.initHp(),this.updateInfo(),this.skillBtn1.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[0],this.skillBtn2.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[1],this.skillBtn3.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[2],this.skillcostnum1.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[0],this.skillcostnum2.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[1],this.skillcostnum3.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[2],this.shortcutCD1=new ShortcutCD(40),this.cdGroup1.addChild(this.shortcutCD1),this.shortcutCD2=new ShortcutCD(40),this.cdGroup2.addChild(this.shortcutCD2),this.shortcutCD3=new ShortcutCD(40),this.cdGroup3.addChild(this.shortcutCD3)},e.prototype.close=function(){},e.prototype.updateHeadIcon=function(){for(var t=(SubRoles.ins().subRolesLen,0);3>t;t++){var e=this["player"+(t+1)+"touxiang"],i=SubRoles.ins().getSubRoleByIndex(t);i?e.source="yuanhead"+i.job+i.sex:e.visible=!1}},e.prototype.onHelp=function(){ViewManager.ins().open(ZsBossRuleSpeak,29)},e.prototype.updateBuffInfo=function(){this.isDelayBuff=!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)this.setBuff(e)},e.prototype.doBuff=function(){this.isDelayBuff||(this.isDelayBuff=!0,TimerManager.ins().doTimer(80,1,this.updateBuffInfo,this))},e.prototype.setBuff=function(t){var e=EntityManager.ins().getMainRole(t);e&&(this["littleBuff"+(t+1)].visible=e.hasBuff(59100))},e.prototype.useSkill=function(t){var e=t.target,i=1;switch(e){case this.skillBtn1:i=1;break;case this.skillBtn2:i=2;break;case this.skillBtn3:if(i=3,UserSkill.ins().hejiEnable)return void UserTips.ins().showTips("怒气已满")}var s=GuardWeaponModel.ins().guardCopyInfo,n=this["skillCd"+i];n>0?UserTips.ins().showTips("技能CD中,还剩"+n+"秒"):s.score<GlobalConfig.GuardGodWeaponConf.sSkillCost[i-1]?UserTips.ins().showTips("技能积分不足"):UserFb.ins().guardUseSkill(i)},e.prototype.useSkillHandler=function(t){this["shortcutCD"+t].play(GlobalConfig.GuardGodWeaponConf.sSkillCd[t-1]),this["skillCd"+t]=GlobalConfig.GuardGodWeaponConf.sSkillCd[t-1];var e="|C:0x00ff00&T:"+GlobalConfig.GuardGodWeaponConf.sSkillUseText[t-1]+"|";UserTips.ins().showTips(e)},e.prototype.delayUpdateInfo=function(){this.isDelayUpdateInfo||(this.isDelayUpdateInfo=!0,TimerManager.ins().doTimer(200,1,this.updateInfo,this))},e.prototype.updateInfo=function(){this.isDelayUpdateInfo=!1;var t=GuardWeaponModel.ins().guardCopyInfo;this.refreshHints0.text="（"+t.wave+"/"+GuardWeaponModel.ins().getMaxWaves()+"）";var e;this.lastWave!=t.wave&&(e=GuardWeaponModel.ins().getWaveTime(t.wave),this.refreshHints1.text=""+e),this.lastWave=t.wave,this.dangqianbo1.text=""+t.minMonsterWave,this.dangqianbo2.text=""+t.minMonsteNums,this.zongshu2.text=""+t.monsterNum,this.zongshu0.text=""+t.score,this.redPoint.visible=GuardWeaponModel.ins().isCanCallBoss();var i;if(i=void 0==this.lastScore?t.score:t.score-this.lastScore,this.lastScore=t.score,i>0){var s="|C:0x00ff00&T:积分+"+i+"|";UserTips.ins().showTips(s)}},e.prototype.initHp=function(){for(var t=0;3>t;t++){var e=this["bloodBar"+t],i=SubRoles.ins().getSubRoleByIndex(t);if(i){var s=i.getAtt(AttributeType.atHp),n=i.getAtt(AttributeType.atMaxHp);e.maximum=100,e.value=Math.floor(100*s/n)}else e.visible=!1}},e.prototype.updateHead=function(t){var e=t[0],i=t[1],s=t[2];if(e instanceof CharRole&&i!=s){var n=e.infoModel,o=this["bloodBar"+n.index],a=n.getAtt(AttributeType.atHp),r=n.getAtt(AttributeType.atMaxHp);o.maximum=100,o.value=100*a/r;var h=this["player"+(n.index+1)+"touxiang"];0==a?(h.filters=FilterUtil.ARRAY_GRAY_FILTER,this["time"+(n.index+1)]=GlobalConfig.GuardGodWeaponConf.recoverCD):(h.filters=null,this["time"+(n.index+1)]=0,this["CountDown"+(n.index+1)].visible=!1)}},e.prototype.setTimeLabel=function(t){this["time"+t]--,this["time"+t]>0?(this["CountDown"+t].visible=!0,this["CountDown"+t].text=this["time"+t].toString()):this["CountDown"+t].visible=!1},e.prototype.onLuckBoss=function(){ViewManager.ins().open(GuardCallBossWin)},e.prototype.beginTime=function(){this.isBegin||(this.time=GuardWeaponModel.ins().leftTime,this.isBegin=!0,TimerManager.ins().doTimer(1e3,0,this.runTime,this))},e.prototype.runTime=function(){this.time-=1,this.time>0?this.lastTime.text=DateUtils.getFormatBySecond(this.time,DateUtils.TIME_FORMAT_12):(this.lastTime.text="",TimerManager.ins().remove(this.runTime,this));var t=this.refreshHints1.text,e=+t;e>0&&(e--,this.refreshHints1.text=""+e);for(var i=1;3>=i;i++)this["time"+i]>0&&this.setTimeLabel(i),this.setSkillCd(i)},e.prototype.setSkillCd=function(t){this["skillCd"+t]>0&&this["skillCd"+t]--},e}(BaseEuiView);__reflect(GuardMainUI.prototype,"GuardMainUI"),ViewManager.ins().reg(GuardMainUI,LayerManager.UI_Main);var GuardCopyInfo=function(){function t(){this.wave=0,this.score=0,this.callBossNum=0,this.monsterNum=0,this.minMonsterWave=0,this.minMonsteNums=0}return t.prototype.parser=function(t,e,i,s,n,o){this.wave=t,this.score=e,this.callBossNum=i,this.monsterNum=s,this.minMonsterWave=n,this.minMonsteNums=o},t}();__reflect(GuardCopyInfo.prototype,"GuardCopyInfo");var GuardWeaponModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShowSweep=!1,e.guardCopyInfo=new GuardCopyInfo,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.canChallenge=function(){return this.isOpen()&&GlobalConfig.GuardGodWeaponConf.dailyCount>this.challengeTimes},e.prototype.isOpen=function(){var t=GlobalConfig.GuardGodWeaponConf.opencondition,e=t[0],i=t[1];return UserZs.ins().lv>=e&&GameServer.serverOpenDay+1>=i},e.prototype.getDesc=function(){var t=GlobalConfig.GuardGodWeaponConf.opencondition,e=t[0],i=t[1];return"角色"+e+"转，并且开服第"+i+"天开启"},e.prototype.getMaxWaves=function(){var t=GlobalConfig.GGWWaveConf[UserZs.ins().lv]||{};return Object.keys(t).length},e.prototype.getWaveTime=function(t){return 0==t?GlobalConfig.GuardGodWeaponConf.starDelayRsf:GlobalConfig.GGWWaveConf[UserZs.ins().lv][t].time
},e.prototype.isCanCallBoss=function(){return this.getCallBossTimes()>0},e.prototype.getCallBossTimes=function(){var t=this.guardCopyInfo.wave,e=0;for(var i in GlobalConfig.GuardGodWeaponConf.sSummonLimit)t>=+i&&(e+=GlobalConfig.GuardGodWeaponConf.sSummonLimit[i]);return e-this.guardCopyInfo.callBossNum},e.prototype.callBossMoney=function(){var t=this.getCallBossTimes();return GlobalConfig.GuardGodWeaponConf.sSummonCost[t-1]},e.prototype.getKillWave=function(){return this.guardCopyInfo.wave},e}(BaseClass);__reflect(GuardWeaponModel.prototype,"GuardWeaponModel");var GuardCallBossWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponBossTips",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){var t=GuardWeaponModel.ins().getCallBossTimes(),e=GuardWeaponModel.ins().callBossMoney();this.callTimesLable.text=""+t,0==t&&(e=0),this.zb0.text=""+e,this.time=t,this.money=e,this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.up,this.callBoss)},e.prototype.callBoss=function(){this.time>0?Actor.yb<this.money?UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):UserFb.ins().callGuardBoss():UserTips.ins().showTips("没有召唤BOSS次数"),this.closeWin()},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuardCallBossWin.prototype,"GuardCallBossWin"),ViewManager.ins().reg(GuardCallBossWin,LayerManager.UI_Popup);var GuardLogsListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="UIshowDropNoticeSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=GlobalConfig.GuardGodWeaponConf.UIshowDrop[this.data.noticeId];t=t?t:16777215;var e=GlobalConfig.GuardGodWeaponConf.UIshowDropNotice;e=StringUtils.replace(e,this.data.roleName,this.data.monsterName,"|C:"+t+"&T:"+this.data.itemName),this.showText.textFlow=TextFlowMaker.generateTextFlow1(e)}},e}(BaseItemRender);__reflect(GuardLogsListRenderer.prototype,"GuardLogsListRenderer");var GuardQuitTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponQuiteTip",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.BG,this.closeWin),this.addTouchEvent(this.up,this.onQuit)},e.prototype.onQuit=function(){UserFb.ins().sendExitFb(),this.closeWin()},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuardQuitTips.prototype,"GuardQuitTips"),ViewManager.ins().reg(GuardQuitTips,LayerManager.UI_Popup);var GuardRewardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponTishiSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.giveUp,this.closeWin)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuardRewardWin.prototype,"GuardRewardWin"),ViewManager.ins().reg(GuardRewardWin,LayerManager.UI_Popup);var GuardWeaponPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.itemList.itemRenderer=ItemBase,this.noticeList.itemRenderer=GuardLogsListRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnChallenge,this.challenge),this.observe(UserFb.ins().postGuardWeaponLogs,this.updateLogs),this.observe(UserFb.ins().postGuardInfo,this.updateChallgeTimes),this.updateChallgeTimes(),this.itemList.dataProvider=new eui.ArrayCollection(GlobalConfig.GuardGodWeaponConf.showReward[UserZs.ins().lv]),UserFb.ins().sendGuardWeaponLogs(),this.btnChallenge.label=GuardWeaponModel.ins().isShowSweep?"扫  荡":"挑  战"},e.prototype.updateChallgeTimes=function(){this.lbTime.text=(GlobalConfig.GuardGodWeaponConf.dailyCount-GuardWeaponModel.ins().challengeTimes).toString()},e.prototype.challenge=function(){if(GuardWeaponModel.ins().isShowSweep){if(GlobalConfig.GuardGodWeaponConf.dailyCount-GuardWeaponModel.ins().challengeTimes<=0)return void UserTips.ins().showCenterTips("今天次数已用完，请明天再参加");ViewManager.ins().open(BuySpecialWin)}else UserFb.ins().challengeGuard()},e.prototype.updateLogs=function(t){this.noticeList.dataProvider=new eui.ArrayCollection(t)},e.prototype.close=function(){this.removeObserve()},e}(BaseView);__reflect(GuardWeaponPanel.prototype,"GuardWeaponPanel");var ShortcutCD=function(t){function e(e){var i=t.call(this)||this;return i.setSize(e),i}return __extends(e,t),e.prototype.setSize=function(t){this.radius=t,this.graphics.clear(),this.graphics.beginFill(0,.9),this.graphics.drawCircle(0,0,t),this.graphics.endFill(),this.maskShape=new egret.Shape,this.maskShape.graphics.clear(),this.maskShape.graphics.beginFill(0,.7),this.maskShape.graphics.drawCircle(0,0,t),this.maskShape.graphics.endFill(),this.addChild(this.maskShape),this.mask=this.maskShape,this.visible=!1},e.prototype.play=function(t){t*=1e3,t>0&&(this.visible=!0,this.duration=t,this.startTime=egret.getTimer(),egret.startTick(this.onUpdate,this))},e.prototype.onUpdate=function(){var t=egret.getTimer(),e=t-this.startTime;return e>=this.duration?(this.stop(),!1):(this.maskShape.graphics.clear(),this.maskShape.graphics.beginFill(0,.7),this.maskShape.graphics.moveTo(0,0),this.maskShape.graphics.lineTo(this.radius,0),this.maskShape.graphics.drawArc(0,0,this.radius,e/this.duration*2*Math.PI-Math.PI/2,2*Math.PI-Math.PI/2),this.maskShape.graphics.lineTo(0,0),this.maskShape.graphics.endFill(),!1)},e.prototype.stop=function(){this.visible=!1,egret.stopTick(this.onUpdate,this),this.maskShape.graphics.clear()},e}(egret.Sprite);__reflect(ShortcutCD.prototype,"ShortcutCD");var GuildBuilding;!function(t){t[t.GUILD_HALL=1]="GUILD_HALL",t[t.GUILD_LIANGONGFANG=2]="GUILD_LIANGONGFANG",t[t.GUILD_SHOP=3]="GUILD_SHOP",t[t.GUILD_COMMENT=4]="GUILD_COMMENT"}(GuildBuilding||(GuildBuilding={}));var GuildLanguage=function(){function t(){}return t}();GuildLanguage.guildOffice=["成员","精英","堂主","护法","长老","副会长","会长"],GuildLanguage.guildOfficeColor=["d1c3a8","00c832","1694ec","8e2abc","f4b12a","ffff00","ffff00"],GuildLanguage.guildBuilding=["","管理大厅","练功房"],__reflect(GuildLanguage.prototype,"GuildLanguage");var GuildOffice;!function(t){t[t.GUILD_MEMBER=0]="GUILD_MEMBER",t[t.GUILD_JINGYING=1]="GUILD_JINGYING",t[t.GUILD_TANGZHU=2]="GUILD_TANGZHU",t[t.GUILD_HUFA=3]="GUILD_HUFA",t[t.GUILD_ZHANGLAO=4]="GUILD_ZHANGLAO",t[t.GUILD_FUBANGZHU=5]="GUILD_FUBANGZHU",t[t.GUILD_BANGZHU=6]="GUILD_BANGZHU"}(GuildOffice||(GuildOffice={}));var Guild=function(t){function e(){var e=t.call(this)||this;return e.guildID=0,e.guildName="",e.guildLv=0,e._buildingLevels=[],e.money=0,e.notice="",e.records=[],e.guildListInfos=[],e._guildMembers=[],e.applyGuilds=[],e._guillRoleSkillInfo=[],e.guildTaskInfos=new eui.ArrayCollection,e.isFirstGetMessageInfo=!0,e._memberSortType=0,e.pageMax=1,e.hasApply=!1,e.changeNameNum=0,e.hasNewMsg=!1,e.sendToFireCount=[],e.isAuto=1,e.attrLimit=99999,e._conCount=[],e.sysId=PackageID.Guild,e.regNetMsg(1,e.postGuildInfo),e.regNetMsg(2,e.postGuildMembers),e.regNetMsg(3,e.postGuildList),e.regNetMsg(4,e.postGuildCreate),e.regNetMsg(6,e.postJoinGuild),e.regNetMsg(7,e.postApplyInfos),e.regNetMsg(8,e.postProcessJoin),e.regNetMsg(9,e.doChangeOffice),e.regNetMsg(11,e.postQuitGuild),e.regNetMsg(12,e.doUpdateGuildInfo),e.regNetMsg(13,e.postGuildMoney),e.regNetMsg(14,e.postChangeNotice),e.regNetMsg(15,e.doGuildSkillInfo),e.regNetMsg(16,e.postLearnGuildSkill),e.regNetMsg(17,e.postUpBuilding),e.regNetMsg(18,e.doPracticeGuildSkill),e.regNetMsg(19,e.doGuildTaskInfos),e.regNetMsg(20,e.doGuildTaskUpdate),e.regNetMsg(22,e.postManageList),e.regNetMsg(23,e.doManage),e.regNetMsg(24,e.postConCount),e.regNetMsg(25,e.postMyGuildInfo),e.regNetMsg(26,e.doGuildMessage),e.regNetMsg(27,e.postAllGuildMessage),e.regNetMsg(28,e.doAddGuildlimit),e.regNetMsg(30,e.postUpdateFire),e.observe(GameLogic.ins().postEnterMap,e.startCheckShow),e.observe(GameLogic.ins().postGuildChange,e.setGuild),e.initData(),e}return __extends(e,t),e.prototype.initData=function(){this.guildMessageInfoData||(this.guildMessageInfoData=new eui.ArrayCollection),this.guildMessageInfoData.removeAll(),this.isFirstGetMessageInfo=!0},e.prototype.setGuild=function(t){var e=t[0],i=t[1];this.guildID!=e&&(this.guildID=e,this.guildName=i,this.sendGuildInfo(),0!=this.guildID&&ViewManager.ins().isShow(GuildApplyWin)&&(ViewManager.ins().close(GuildApplyWin),ViewManager.ins().open(GuildMap)))},e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendGuildInfo(),this.sendMyGuildInfo()},e.prototype.getSkllInfoByIndex=function(t){return this._guillRoleSkillInfo[t]},e.prototype.getGuildMembersByIndex=function(t){return this._guildMembers[t]},e.prototype.getGuildTaskInfosByIndex=function(t){return this.guildTaskInfos.getItemAt(t)},e.prototype.getBuildingLevels=function(t){return void 0===t&&(t=-1),-1==t?this._buildingLevels:this._buildingLevels[t]},e.prototype.getConCount=function(t){return void 0===t&&(t=-1),-1==t?this._conCount:this._conCount[t]},e.prototype.sendGuildInfo=function(){this.sendBaseProto(1)},e.prototype.postGuildInfo=function(t){if(this._buildingLevels=[],1==t.readByte()){this.guildID=t.readUnsignedInt(),this.guildName=t.readString();for(var e=t.readUnsignedByte(),i=0;e>i;i++)this._buildingLevels.push(t.readUnsignedByte());return this.money=t.readInt(),this.notice=t.readString(),this.doAddGuildlimit(t),this.guildLv=this._buildingLevels[0],this.sendGuildMembers(),this.sendGuildSkillInfo(),this.postUpdateFire(t),this.changeNameNum=t.readInt(),[this.guildID,this.guildName]}return!1},e.prototype.sendGuildMembers=function(){this.sendBaseProto(2)},e.prototype.postGuildMembers=function(t){var e=t.readInt();this._guildMembers=[];for(var i=0;e>i;i++){var s=new GuildMemberInfo;s.roleID=t.readInt(),s.name=t.readString(),s.office=t.readUnsignedByte(),s.job=t.readUnsignedByte(),s.sex=t.readUnsignedByte(),s.vipLevel=t.readInt(),s.monthCard=t.readUnsignedByte(),s.contribution=t.readInt(),s.curContribution=t.readInt(),s.attack=t.readDouble(),s.downTime=t.readUnsignedInt(),s.level=t.readInt(),s.zsLevel=t.readInt(),this._guildMembers.push(s)}},e.prototype.sendGuildList=function(t,e){this.sendBaseProto(3)},e.prototype.postGuildList=function(t){this.guildListInfos=[];for(var e=t.readInt(),i=0;e>i;i++){var s=new GuildListInfo;s.guildRank=i+1,s.guildID=t.readUnsignedInt(),s.guildLevel=t.readUnsignedByte(),s.commentLv=t.readUnsignedByte(),s.guildMember=t.readInt(),s.guildName=t.readString(),s.guildPresident=t.readString(),s.attr=t.readInt(),this.guildListInfos.push(s)}},e.prototype.sendGuildCreate=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeString(e),this.sendToServer(i)},e.prototype.postGuildCreate=function(t){var e=t.readUnsignedByte();return 0==e?(this.guildID=t.readUnsignedInt(),ViewManager.ins().close(GuildCreateWin),ViewManager.ins().close(GuildApplyWin),ViewManager.ins().open(GuildMap),UserTips.ins().showTips("公会创建成功"),this.sendGuildInfo(),!0):!1},e.prototype.sendQuitGuild=function(){this.sendBaseProto(5)},e.prototype.sendJoinGuild=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.postJoinGuild=function(t){this.hasApply=!0},e.prototype.sendApplyInfos=function(){this.sendBaseProto(7)},e.prototype.postApplyInfos=function(t){for(var e=t.readInt(),i=[],s=0;e>s;s++){var n=new GuildApplyInfo;n.roleID=t.readInt(),n.vipLevel=t.readInt(),n.job=t.readUnsignedByte(),n.sex=t.readUnsignedByte(),n.attack=t.readDouble(),n.name=t.readString(),i.push(n)}return this.hasApply=e>0,i},e.prototype.sendProcessJoin=function(t,e){var i=this.getBytes(8);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postProcessJoin=function(t){var e=t.readUnsignedInt(),i=t.readUnsignedByte(),s=this.applyGuilds,n=s.indexOf(e);return-1!=n&&0==i&&s.splice(n,1),1==i?!0:!1},e.prototype.sendChangeOffice=function(t,e){var i=this.getBytes(9);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.doChangeOffice=function(t){for(var e=t.readInt(),i=t.readUnsignedByte(),s=0;s<this._guildMembers.length;s++){var n=this.getGuildMembersByIndex(s);if(n.roleID==e)return void(n.office=i)}},e.prototype.sendDemise=function(){this.sendBaseProto(10)},e.prototype.sendKick=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.postQuitGuild=function(t){var e=t.readInt();return e==Actor.actorID?(this.clearGuildInfo(),ViewManager.ins().close(GuildWin),ViewManager.ins().close(GuildMap),!0):!1},e.prototype.doUpdateGuildInfo=function(t){var e=t.readUnsignedByte();switch(e){case 1:break;case 2:this.sendGuildInfo();break;case 3:this.sendGuildMembers();break;case 4:break;case 5:this.sendApplyInfos();break;case 6:}},e.prototype.sendCon=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.postGuildMoney=function(t){this.money=t.readInt()},e.prototype.sendChangeNotice=function(t){var e=this.getBytes(14);e.writeString(t),this.sendToServer(e)},e.prototype.postChangeNotice=function(t){var e=t.readUnsignedByte();0==e&&(this.notice=t.readString())},e.prototype.sendGuildSkillInfo=function(){this.sendBaseProto(15)},e.prototype.doGuildSkillInfo=function(t){var e=t.readUnsignedByte();this._guillRoleSkillInfo=[];for(var i=0;e>i;i++){for(var s=new GuildRoleSkillInfo,n=t.readUnsignedByte(),o=0;n>o;o++){var a=new GuildSkillInfo;a.level=t.readInt(),s.guildSkillInfo.push(a)}n=t.readUnsignedByte();for(var r=0;n>r;r++){var a=(n[r],new GuildSkillInfo);a.level=t.readInt(),a.exp=t.readInt(),s.practiceSkillInfo.push(a)}this._guillRoleSkillInfo.push(s)}this.postGuildSkillInfo()},e.prototype.postGuildSkillInfo=function(){},e.prototype.sendLearnGuildSkill=function(t,e){var i=this.getBytes(16);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postLearnGuildSkill=function(t){var e=t.readShort(),i=t.readUnsignedByte();this.getSkllInfoByIndex(e).guildSkillInfo[i-1].level=t.readInt(),this.postGuildSkillInfo(),UserTips.ins().showTips("升级成功")},e.prototype.sendPracticeGuildSkill=function(t,e){var i=this.getBytes(18);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.doPracticeGuildSkill=function(t){var e=t.readShort(),i=t.readUnsignedByte();this.getSkllInfoByIndex(e).practiceSkillInfo[i-1].level=t.readInt(),this.getSkllInfoByIndex(e).practiceSkillInfo[i-1].exp=t.readInt();var s=t.readInt();this.postGuildSkillInfo(),UserTips.ins().showTips("|C:0x23CA23&T:修炼值 +"+s+"|")},e.prototype.sendUpBuilding=function(t){var e=this.getBytes(17);e.writeByte(t),this.sendToServer(e)},e.prototype.postUpBuilding=function(t){var e=t.readByte();this._buildingLevels[e-1]=t.readByte(),this.guildLv=this._buildingLevels[0]},e.prototype.doGuildTaskInfos=function(t){this.guildTaskInfos.removeAll(),this.initTaskInfos();for(var e=t.readInt(),i=0;e>i;i++){var s=new GuildTaskInfo;s.taskID=t.readInt(),s.param=t.readInt(),s.state=t.readInt(),s.stdTask=GlobalConfig.GuildTaskConfig[s.taskID],this.guildTaskInfos.addItem(s)}this.updateTaskList()},e.prototype.postGuildTaskUpdate=function(){},e.prototype.doGuildTaskUpdate=function(t){for(var e=t.readInt(),i=t.readInt(),s=t.readInt(),n=0;n<this.guildTaskInfos.length;n++){var o=this.guildTaskInfos.getItemAt(n);if(o&&o.taskID==e){o.param=i,o.state=s;break}}this.updateTaskList()},e.prototype.updateTaskList=function(){for(var t=this.guildTaskInfos.source,e=t.length-1;e>=0;e--)0==t[e].stdTask.type&&t.splice(e,1);t.sort(this.taskInfosSortFunc),this.guildTaskInfos.replaceAll(t),this.postGuildTaskUpdate()},e.prototype.sendGetTaskAward=function(t){var e=this.getBytes(21);e.writeByte(t),this.sendToServer(e)},e.prototype.sendManageList=function(){this.sendBaseProto(22)},e.prototype.postManageList=function(t){this.records=[];for(var e=t.readInt(),i=0;e>i;i++)this.parserManage(t)},e.prototype.doManage=function(t){},e.prototype.sendConCount=function(){this.sendBaseProto(24)},e.prototype.postConCount=function(t){for(var e=t.readUnsignedByte(),i=0;e>i;i++)this._conCount[i]=t.readInt()},e.prototype.sendMyGuildInfo=function(){this.sendBaseProto(25)},e.prototype.postMyGuildInfo=function(t){this.myCon=t.readInt(),this.myTotalCon=t.readInt(),this.myOffice=t.readUnsignedByte()},e.prototype.sendGuildMessage=function(t){var e=this.getBytes(26);e.writeString(t),this.sendToServer(e),ReportData.getIns().reportChat(t,6)},e.prototype.doGuildMessage=function(t){var e=new GuildMessageInfo;if(e.parserMessage(t),-1==Friends.ins().indexOfBlackList(e.roleId)){if(this.guildMessageInfoData.length>=50){var i=this.guildMessageInfoData.removeItemAt(0);Chat.ins().removeAllChatMsg(i)}this.guildMessageInfoData.addItem(e),Chat.ins().insertAllChatMsg(e),Chat.ins().postNewChatMsg(e),1==e.type&&e.roleId!=Actor.actorID&&(this.hasNewMsg=!0)}if(1==e.type){var i=new ChatInfoData(null);i.name=e.name,i.type=7,i.str=e.content,Chat.ins().postNewChatMsg(i)}2==e.type&&this.postGuildBossHaveRelive(!0,e.content)},e.prototype.postGetNewGuildMessage=function(t){return t},e.prototype.postGuildBossHaveRelive=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.sendAllGuildMessage=function(){this.isFirstGetMessageInfo&&(this.isFirstGetMessageInfo=!1,this.sendBaseProto(27))},e.prototype.postAllGuildMessage=function(t){this.guildMessageInfoData.removeAll();for(var e=t.readInt(),i=0;e>i;i++){var s=new GuildMessageInfo;s.parserMessage(t),-1==Friends.ins().indexOfBlackList(s.roleId)&&(this.guildMessageInfoData.addItem(s),Chat.ins().insertAllChatMsg(s))}this.guildMessageInfoData.length&&Chat.ins().postNewChatMsg(this.guildMessageInfoData.getItemAt(this.guildMessageInfoData.length-1))},e.prototype.sendAddGuildLimit=function(t,e){var i=this.getBytes(28);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doAddGuildlimit=function(t){this.isAuto=t.readUnsignedByte(),this.attrLimit=t.readInt()},e.prototype.sendToFire=function(t,e){var i=this.getBytes(30);i.writeShort(t),this.sendToServer(i),this.sendToFireCount.push([t,e])},e.prototype.postUpdateFire=function(t){this.fireDic=this.fireDic||{};var e=t.readShort(),i=t.readInt(),s=this.fireDic.fireLvl!=e||this.fireDic.fireVal!=i;if(this.fireDic.fireLvl=e,this.fireDic.fireVal=i,s)for(var n=GlobalConfig.GuildConfig,o=UserBag.ins().getBagItemById(n.bonfireItem),a=o?o.count:0,r=0;r<this.sendToFireCount.length;r++)if(a==this.sendToFireCount[r][1]){for(;r>=0;){var h=this.sendToFireCount.shift()[0];UserTips.ins().showCenterTips("行会总篝火值 +"+5*h+" 个人行会贡献 +"+30*h),r-=1}break}},e.prototype.sendGuildChangeName=function(t){var e=this.getBytes(31);e.writeString(t),this.sendToServer(e)},e.prototype.parserManage=function(t){if(this.records){var e="",i=DateUtils.getFormatBySecond(.001*DateUtils.formatMiniDateTime(t.readUnsignedInt()),8);i=StringUtils.complementByChar(i,16);var s=t.readUnsignedByte(),n=t.readInt(),o=t.readInt(),a=(t.readInt(),t.readString());t.readString();switch(s){case 1:e=i+"  ["+a+"]加入工会";break;case 2:e=i+"  ["+a+"]离开工会";break;case 3:e=i+"  ["+a+"]被任命副会长";break;case 4:e=i+"  ["+a+"]成为新的会长";break;case 5:e=i+"  ["+a+"]发起弹劾";break;case 6:e=i+"  ["+a+"]公会副本进度首通";break;case 7:e=i+"  ["+a+"]捐献了"+o+(2==n?"元宝":"金币");break;case 8:e=i+"  ["+a+"]把"+GlobalConfig.GuildConfig.buildingNames[n-1]+"升级到"+o+"级";break;case 9:var r=GlobalConfig.ItemConfig[n];e=i+"  ["+a+"]在公会商店获得了<font color="+ItemConfig.getQualityColor(r)+">"+r.name+"</font>";break;case 10:e=i+"  <font color='#35e62d'>公会强盗已经全部击杀</font>";break;case 11:e=i+"  ["+a+"]被降职了"}this.records.unshift(e)}},e.prototype.hasApplys=function(){return this.myOffice>=GuildOffice.GUILD_FUBANGZHU&&this.hasApply},e.prototype.clearGuildInfo=function(){this.guildID=0,this.guildName="",this.guildListInfos=[],this._guildMembers=[],this.applyGuilds=[],this.pageMax=1,this.hasNewMsg=!1},e.prototype.removeMsgWithId=function(t){for(var e=[],i=0;i<this.guildMessageInfoData.length;i++){var s=this.guildMessageInfoData.getItemAt(i);s.roleId!=t&&e.push(s)}this.guildMessageInfoData.source=e,this.guildMessageInfoData.refresh()},e.prototype.initTaskInfos=function(){if(null==this.guildTaskInfos){var t=[],e=GlobalConfig.GuildTaskConfig;for(var i in e)if(e.hasOwnProperty(i)){var s=e[i],n=new GuildTaskInfo;n.taskID=s.id,n.param=0,n.state=0,n.stdTask=s,t.push(n)}this.guildTaskInfos.replaceAll(t)}},e.prototype.taskInfosSortFunc=function(t,e){if(t.state==e.state)return t.taskID<e.taskID?-1:t.taskID>e.taskID?1:0;if(2==t.state)return 1;if(2==e.state)return-1;if(2!=t.state&&2!=e.state){if(t.taskID<e.taskID)return-1;if(t.taskID>e.taskID)return 1}return 0},e.prototype.getMemberNum=function(){return this._guildMembers.length},e.prototype.getGuildMembers=function(t){return 0==t||this._memberSortType==t?this._guildMembers:1==t?this._guildMembers.sort(this.memberSortFunc):2==t?this._guildMembers.sort(this.memberSortFunc2):this._guildMembers},e.prototype.getOfficeNum=function(t){for(var e=this._guildMembers.length,i=0,s=0;e>s;s++){var n=this._guildMembers[s];n.office==t&&i++}return i},e.prototype.canAppointFHZ=function(){return this.getOfficeNum(GuildOffice.GUILD_FUBANGZHU)<GlobalConfig.GuildConfig.posCounts[this.guildLv-1][1]},e.prototype.memberSortFunc=function(t,e){return t.office>e.office?-1:t.office<e.office?1:t.office==e.office?t.contribution==e.contribution?0:t.contribution>e.contribution?-1:1:0},e.prototype.memberSortFunc2=function(t,e){return t.curContribution==e.curContribution?0:t.curContribution>e.curContribution?-1:1},e.prototype.checkIsInGuild=function(t){for(var e in this._guildMembers){var i=this._guildMembers[e];if(i.roleID==t)return!0}return!1},e.prototype.startCheckShow=function(){GuildWar.ins().getModel().checkinAppoint()?(ViewManager.ins().closeTopLevel(),ViewManager.ins().open(GuildWarUiInfo)):ViewManager.ins().close(GuildWarUiInfo)},e.prototype.isUpGradeBuilding=function(){if(e.ins().myOffice<GuildOffice.GUILD_FUBANGZHU)return!1;for(var t=[GuildBuilding.GUILD_HALL,GuildBuilding.GUILD_LIANGONGFANG],i=0;i<t.length;i++){var s=t[i],n=e.ins().getBuildingLevels(s-1)||0,o=GlobalConfig.GuildLevelConfig[s],a=0,r=null,h=null,l=0;for(var c in o)if(o.hasOwnProperty(c)){var u=o[c];a=u.level>a?u.level:a,u.level==n&&(r=u),u.level==n+1&&(h=u)}if((r||h||s==GuildBuilding.GUILD_LIANGONGFANG)&&h&&a>n&&(l=h.upFund),!(s==GuildBuilding.GUILD_HALL&&n>=a||s!=GuildBuilding.GUILD_HALL&&n>=e.ins().guildLv||e.ins().money<l))return!0}return!1},e}(BaseSystem);__reflect(Guild.prototype,"Guild");var GameSystem;!function(t){t.guild=Guild.ins.bind(Guild)}(GameSystem||(GameSystem={}));var GuildBoss=function(t){function e(){var e=t.call(this)||this;return e.leftTimes=0,e.canChallenge=0,e.isKilled=0,e.passId=0,e.challengeTime=0,e.bossHP=0,e.otherGuildId=0,e.otherGuildName="",e.otherGuildBossHp=0,e.winnerId=0,e.guildRankDic=[],e.guildPersonRankDic=[],e.guildBossState=0,e.sysId=PackageID.GuildBoss,e.regNetMsg(1,e.postGuildBossInfoChange),e.regNetMsg(2,e.doRewardRecord),e.regNetMsg(3,e.postGuildBossDetailChange),e.regNetMsg(4,e.doGuildChallengeBack),e.regNetMsg(5,e.postGuildBossRankInfoChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postGuildBossInfoChange=function(t){this.leftTimes=t.readInt();var e=t.readUnsignedByte();this.passRecord=[];for(var i=0;e>i;i++)this.passRecord[t.readByte()]=t.readByte();this.canChallenge=t.readByte()},e.prototype.doRewardRecord=function(t){this.isKilled=t.readByte();for(var e=t.readInt(),i=[],s=0;e>s;s++){var n=new RewardData;n.parser(t),i.push(n)}TimerManager.ins().doTimer(800,1,function(){ResultManager.ins().create(GameMap.fbType,1,i,"获得奖励如下：")},this)},e.prototype.postGuildBossDetailChange=function(t){this.passId=t.readInt();var e=t.readInt();this.challengeTime=GameServer.serverTime+1e3*e,this.bossHP=t.readInt(),this.otherGuildId=t.readInt(),this.otherGuildName=t.readString(),this.otherGuildBossHp=t.readInt(),this.winnerId=t.readInt()},e.prototype.doGuildChallengeBack=function(t){this.guildBossState=t.readInt(),0==this.guildBossState?(this.leftTimes--,this.postChallengeSuccess()):5==this.guildBossState&&this.sendGetBossInfo()},e.prototype.postGuildBossRankInfoChange=function(t){var e=t.readInt(),i=t.readByte();this.guildRankDic[e]=[],this.guildPersonRankDic[e]=[];for(var s=0;i>s;s++){var n=new guildBossRankData;n.name=t.readString(),n.damage=t.readInt(),n.rank=s+1,this.guildRankDic[e].push(n)}i=t.readInt();for(var s=0;i>s;s++){var n=new guildBossRankData;n.name=t.readString(),n.damage=t.readInt(),n.devote=t.readInt(),n.rank=s+1,this.guildPersonRankDic[e].push(n)}},e.prototype.sendChallengeBoss=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendGetBossReward=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetBossInfo=function(){this.sendBaseProto(3)},e.prototype.sendGetBossRankInfo=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.getBossRewardState=function(){for(var t in e.ins().passRecord)if(1==e.ins().passRecord[t])return!0;return!1},e.prototype.getBossChallenge=function(){if(!this.isOpen())return!1;if(e.ins().leftTimes<=0)return!1;for(var t in e.ins().passRecord)if(0==e.ins().passRecord[t])return!0;return!1},e.prototype.isOpen=function(){return new Date(GameServer.serverTime).getDay()!=GlobalConfig.GuildBossConfig.notOpenDayOfWeek},e.prototype.postChallengeSuccess=function(){},e}(BaseSystem);__reflect(GuildBoss.prototype,"GuildBoss");var guildBossRankData=function(){function t(){this.name="",this.damage=0,this.rank=0,this.devote=0}return t}();__reflect(guildBossRankData.prototype,"guildBossRankData");var GameSystem;!function(t){t.guildboss=GuildBoss.ins.bind(GuildBoss)}(GameSystem||(GameSystem={}));var GuildFB=function(t){function e(){var e=t.call(this)||this;return e.bossTimer=1,e.sysId=PackageID.GuildFB,e.regNetMsg(1,e.doGuildFBInfo),e.regNetMsg(2,e.doGuildFBRankInfo),e.regNetMsg(3,e.doGuildFBMaxGKInfo),e.regNetMsg(4,e.doGuildFBGKInfo),e.regNetMsg(5,e.doGuildFBChangeInfo),e.regNetMsg(6,e.doGuildFBRewardInfo),e.regNetMsg(7,e.postGuildFBBossInfo),e.regNetMsg(8,e.postGuildFBBossTimerEndInfo),e.regNetMsg(9,e.postGuildFBSweepEnd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getGkDatas=function(t){return void 0===t&&(t=-1),-1==t?this._gkDatas:this._gkDatas[t]},e.prototype.doGuildFBInfo=function(t){this.fbNum=t.readShort(),this.sweep=t.readByte(),this.sweepNum=t.readShort(),this.tongguan=t.readByte(),this.zuwei=t.readByte(),this.nextFb=t.readByte(),this.postGuildFubenInfo()},e.prototype.postGuildFubenInfo=function(){},e.prototype.doGuildFBRankInfo=function(t){this.rankDatas=[];for(var e=t.readByte(),i=0;e>i;i++){var s=new GuildFBRankInfo;s.rank=i+1,s.name=t.readString(),s.guanka=t.readShort(),this.rankDatas.push(s)}this.postGuildFubenInfo()},e.prototype.doGuildFBMaxGKInfo=function(t){this.isMaxGK=t.readByte(),0!=this.isMaxGK&&(this.maxName=t.readString(),this.maxCareer=t.readByte(),this.maxSex=t.readByte(),this.maxNum=t.readShort(),this.maxZhuwei=t.readByte()),this.postGuildFubenInfo()},e.prototype.doGuildFBGKInfo=function(t){this.fbgkNum=t.readShort();var e=t.readByte();this._gkDatas=[];for(var i=0;e>i;i++)this._gkDatas.push(t.readString());this.postGuildFubenInfo(),this.postGuildFubenRoleInfo()},e.prototype.postGuildFubenRoleInfo=function(){},e.prototype.doGuildFBChangeInfo=function(t){this.change=t.readByte(),ViewManager.ins().getView(GuildActivityWin)&&ViewManager.ins().getView(GuildActivityWin).isShow()&&(1==this.change?this.sendGuildFBRankInfo():2==this.change&&this.sendGuildFBMaxGKInfo(),this.change=0)},e.prototype.doGuildFBRewardInfo=function(t){this.rewardNum=t.readShort(),this.rewardRoleNum=t.readShort(),this.postGuildFubenInfo()},e.prototype.postGuildFBBossInfo=function(t){this.bossGKNum=t.readShort()},e.prototype.postGuildFBBossTimerEndInfo=function(t){this.bossGKNum=t.readShort(),this.bossTimer=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.postGuildFBSweepEnd=function(t){},e.prototype.sendGuildFBRankInfo=function(){this.sendBaseProto(2)},e.prototype.sendGuildFBMaxGKInfo=function(){this.sendBaseProto(3)},e.prototype.sendGuildFBGKRoleInfo=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.sendGuildFBChallange=function(){this.sendBaseProto(5)},e.prototype.sendGuildFBSweep=function(){this.sendBaseProto(6)},e.prototype.sendGuildFBZhuwei=function(){this.sendBaseProto(7)},e.prototype.sendGuildFBReward=function(){this.sendBaseProto(8)},e.prototype.hasbtn=function(){return GameServer.serverOpenDay>0&&(0==this.sweep&&this.fbNum>0||0==this.tongguan&&this.rewardNum>0)},Object.defineProperty(e.prototype,"bossTimerEnd",{get:function(){return this.bossTimer+egret.getTimer()},enumerable:!0,configurable:!0}),e}(BaseSystem);__reflect(GuildFB.prototype,"GuildFB");var GameSystem;!function(t){t.guildfb=GuildFB.ins.bind(GuildFB)}(GameSystem||(GameSystem={}));var GuildRedPoint=function(t){function e(){var e=t.call(this)||this;return e.hanghui=!1,e.sendReward=!1,e.redBag=!1,e.sczb=!1,e.hhdt=!1,e.gldt=!1,e.hhBoss=!1,e.dayReward=!1,e.guildFire=!1,e.roleTabs={},e.roleSkillTabs={},e.liangongRed=!1,e.roleTabs={},e.roleSkillTabs={},e.associated(e.postDayReward,GuildWar.ins().postDayRewardInfo),e.associated(e.postSczb,e.postDayReward,e.postRedBag),e.associated(e.postSendReward,GuildWar.ins().postAssignsReward,GuildWar.ins().postSendRewardSuccess),e.associated(e.postRedBag,GuildWar.ins().postRedBagInfo),e.associated(e.postHhdt,Guild.ins().postApplyInfos,Guild.ins().postJoinGuild,Guild.ins().postMyGuildInfo,e.postLianGongRedPoint,e.postGldt),e.associated(e.postGldt,Guild.ins().postUpBuilding,Guild.ins().postManageList,Guild.ins().postGuildMoney,Guild.ins().postMyGuildInfo),e.associated(e.postHanghui,e.postSendReward,e.postSczb,e.postHhdt,e.postGuildFire,e.postLianGongRedPoint,Actor.ins().postLevelChange,GuildFB.ins().postGuildFubenInfo,GuildRobber.ins().postGuildRobberInfo,GuildWar.ins().postGuildWarStarInfo,Guild.ins().postGuildInfo,e.postHanghuiBoss),e.associated(e.postHanghuiBoss,GuildBoss.ins().postGuildBossDetailChange,GuildBoss.ins().postGuildBossInfoChange),e.associated(e.postGuildFire,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,Guild.ins().postUpdateFire),e.associated(e.postLianGongRedPoint,Guild.ins().postLearnGuildSkill,Guild.ins().postUpBuilding,Guild.ins().postGuildSkillInfo,Guild.ins().postMyGuildInfo),e}return __extends(e,t),e.prototype.postGuildFire=function(){var t=this.guildFire,e=GlobalConfig.GuildConfig,i=UserBag.ins().getBagItemById(e.bonfireItem);return i&&i.count>=(e.bonfirecaution||1)?this.guildFire=!0:this.guildFire=!1,this.guildFire!=t},e.prototype.postHhdt=function(){var t=this.hhdt;return this.hhdt=Guild.ins().hasApplys()||this.gldt,this.hhdt!=t},e.prototype.postGldt=function(){var t=this.gldt;return this.gldt=Guild.ins().isUpGradeBuilding(),this.gldt!=t},e.prototype.postDayReward=function(){var t=this.dayReward;return this.dayReward=GuildWar.ins().getModel().canGetDay&&!GuildWar.ins().getModel().getDayReward,this.dayReward!=t},e.prototype.postSczb=function(){var t=this.sczb;return this.sczb=this.dayReward||this.redBag,this.sczb!=t},e.prototype.postRedBag=function(){var t=this.redBag;return this.redBag=GuildWar.ins().getModel().isHaveRedBag(),this.redBag!=t},e.prototype.postSendReward=function(){var t=this.sendReward;return this.sendReward=GuildWar.ins().getModel().canSendReward,this.sendReward!=t},e.prototype.postHanghui=function(){var t=this.hanghui,e=!1;return GuildFB.ins().hasbtn()&&(e=!0),(void 0==Guild.ins().guildID||0==Guild.ins().guildID)&&Actor.level>69&&(e=!0),this.hanghui=e||this.sendReward||this.redBag||this.sczb||this.hhBoss||this.guildFire||this.liangongRed||GuildWar.ins().getModel().isWatStart||this.hhdt,this.hanghui!=t},e.prototype.postHanghuiBoss=function(){var t=this.hhBoss;return this.hhBoss=GuildBoss.ins().getBossRewardState()||GuildBoss.ins().getBossChallenge(),this.hhBoss!=t},e.prototype.postLianGongRedPoint=function(){this.liangongRed=!1;for(var t=e.Tab_LianGong,i=SubRoles.ins().subRolesLen,s=0;i>s;s++){var n=SubRoles.ins().getSubRoleByIndex(s);
if(n){var o=Guild.ins().getSkllInfoByIndex(n.index);if(o){this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][s]=!1;for(var a=1;3>=a;a++){this.roleSkillTabs[s]||(this.roleSkillTabs[s]={}),this.roleSkillTabs[s][a]=!1;var r=GlobalConfig.GuildCommonSkillConfig[a].length,h=o.guildSkillInfo[a-1].level;if(!(h>=r)){var l=this.getCommonSkillDP(a,h+1);if(l&&!(l.contribute>Guild.ins().myCon||Actor.gold<l.money)){var c=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1),u=1>c||h>=GlobalConfig.GuildConfig.commonSkillLevels[c-1];u||(this.roleSkillTabs[s][a]=!0,this.liangongRed=!0)}}}for(var p in this.roleSkillTabs[s])if(this.roleSkillTabs[s][p]){this.roleTabs[t][s]=!0;break}}}}},e.prototype.getCommonSkillDP=function(t,e){var i=GlobalConfig.GuildCommonSkillConfig[t];if(0==e)return i[1];for(var s in i){var n=i[s];if(n.level==e)return n}return null},e}(BaseSystem);GuildRedPoint.Tab_LianGong=0,__reflect(GuildRedPoint.prototype,"GuildRedPoint");var GameSystem;!function(t){GuildRedPoint.ins.bind(GuildRedPoint)}(GameSystem||(GameSystem={}));var GuildRobber=function(t){function e(){var e=t.call(this)||this;return e.robberNum=0,e.robberTotal=0,e.robberDealNum=0,e._robberList=[],e.robberChanllge=0,e.isUpdateRobber=!1,e.sysId=PackageID.GuildRobber,e.regNetMsg(1,e.doGuildRobberInfo),e.regNetMsg(2,e.doGuildRobberStarts),e.regNetMsg(3,e.doGuildRobberSX),e.regNetMsg(4,e.doGuildRobberChangller),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRobberList=function(t){return void 0===t&&(t=-1),-1==t?this._robberList:this._robberList[t]},e.prototype.doGuildRobberInfo=function(t){if(this.robberNum=t.readByte(),this.robberNum>0){this.robberTotal=t.readByte(),this.robberDealNum=t.readByte(),this._robberList=[];for(var e=0;e<this.robberTotal;e++){var i=new RobberStartInfo;i.robberStart=t.readByte(),i.robberType=t.readByte(),this._robberList.push(i)}}this.postGuildRobberInfo()},e.prototype.postGuildRobberInfo=function(){},e.prototype.doGuildRobberStarts=function(t){var e=t.readByte();if(this._robberList.length>0){var i=this._robberList[e-1];i.robberStart=t.readByte()}this.robberDealNum=t.readByte(),this.postGuildRobberInfo()},e.prototype.doGuildRobberSX=function(t){this.robberNum=t.readByte(),ViewManager.ins().getView(GuildMap)?this.sendRobberInfo():this.isUpdateRobber=!0},e.prototype.doGuildRobberChangller=function(t){this.robberChanllge=t.readByte()},e.prototype.sendRobberInfo=function(){this.sendBaseProto(1)},e.prototype.sendRobberChanger=function(t){var e=this.getBytes(2);e.writeByte(t),this.sendToServer(e)},e.prototype.hasbtn=function(){return this.robberTotal>0&&this.robberTotal>this.robberDealNum},e}(BaseSystem);__reflect(GuildRobber.prototype,"GuildRobber");var GameSystem;!function(t){t.guildrobber=GuildRobber.ins.bind(GuildRobber)}(GameSystem||(GameSystem={}));var GuildStore=function(t){function e(){var e=t.call(this)||this;return e.guildStoreLv=0,e.guildStoreNum=0,e._recordInfoAry=[],e._guildStoreItemData=[],e.sysId=PackageID.GuildStore,e.regNetMsg(1,e.postGuildStoreInfo),e.regNetMsg(2,e.postGuildStoreBoxInfo),e.regNetMsg(3,e.postGuildStoreBox),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRecordInfoAry=function(t){return void 0===t&&(t=-1),-1==t?this._recordInfoAry:this._recordInfoAry[t]},e.prototype.getGuildStoreItemData=function(t){return void 0===t&&(t=-1),-1==t?this._guildStoreItemData:this._guildStoreItemData[t]},e.prototype.postGuildStoreInfo=function(t){this.guildStoreLv=t.readByte(),this.guildStoreNum=t.readByte()},e.prototype.postGuildStoreBoxInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var s=new GuildStoreRecordInfo;s.times=t.readInt(),s.roleName=t.readString(),s.itemId=t.readInt(),this._recordInfoAry.length>=50&&this._recordInfoAry.pop(),this._recordInfoAry.unshift(s)}},e.prototype.postGuildStoreBox=function(t){var e=t.readByte();this._guildStoreItemData=[];for(var i=0;e>i;i++){var s=new GuildStoreItemData;s.itemId=t.readInt(),s.num=t.readInt(),this._guildStoreItemData.push(s)}this.guildStoreNum-=1},e.prototype.doGuildStoreAddBoxInfo=function(t){this._recordInfo=new GuildStoreRecordInfo,this._recordInfo.roleName=t.readString(),this._recordInfo.itemId=t.readInt()},e.prototype.getGuildStoreInfo=function(){this.sendBaseProto(1)},e.prototype.sendGuildStoreBoxInfo=function(){var t=this.getBytes(2);null==this._recordInfoAry||0==this._recordInfoAry.length?t.writeInt(0):t.writeInt(this.getRecordInfoAry(0).times),this.sendToServer(t)},e.prototype.sendGuildStoreBox=function(){this.sendBaseProto(3)},e}(BaseSystem);__reflect(GuildStore.prototype,"GuildStore");var GameSystem;!function(t){t.guildstore=GuildStore.ins.bind(GuildStore)}(GameSystem||(GameSystem={}));var GuildWar=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.GuildWar,e.regNetMsg(1,e.postRedBagInfo),e.regNetMsg(2,e.doSendRedBack),e.regNetMsg(3,e.doRobRedBack),e.regNetMsg(4,e.postJoinPlayBack),e.regNetMsg(5,e.doPlayNextCard),e.regNetMsg(6,e.doGetPointInfo),e.regNetMsg(7,e.doGetGongXunChange),e.regNetMsg(8,e.doGuildRankinfo),e.regNetMsg(9,e.postGuildPersonalRank),e.regNetMsg(10,e.doGuildWarKillInfo),e.regNetMsg(11,e.doGuildWarCityOwn),e.regNetMsg(12,e.postDayRewardInfo),e.regNetMsg(14,e.doMyActivityRankInfo),e.regNetMsg(15,e.postFlagInfoChange),e.regNetMsg(17,e.doGuildWarResult),e.regNetMsg(18,e.doHuDunInfoChange),e.regNetMsg(19,e.postAssignsReward),e.regNetMsg(20,e.postSendRewardSuccess),e.regNetMsg(21,e.postWinGuildInfo),e.regNetMsg(22,e.postGuildWarStarInfo),e.regNetMsg(23,e.doGuildWarDoorHuDun),e.regNetMsg(24,e.doLotteryInfo),e.regNetMsg(25,e.doGetMyPoint),e.regNetMsg(26,e.doRankInfoChange),e.regNetMsg(27,e.doChangeAttrHandle),e.regNetMsg(28,e.doChangeShowList),e.regNetMsg(29,e.doPointRewardInfo),e.regNetMsg(31,e.doDoorEndtime),e.regNetMsg(32,e.doTalkMaxPoint),e.regNetMsg(33,e.postKillHuman),e.regNetMsg(34,e.postHeFuBelong),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getModel=function(){return this._guildWarModel||(this._guildWarModel=new GuildWarModel),this._guildWarModel},e.prototype.requestSendRedBag=function(t,e){var i=this.getBytes(2);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.requestRobRedBag=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.requestJoinAc=function(){var t=this.getBytes(4);this.sendToServer(t)},e.prototype.requestPlayNextMap=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.requestGuildRank=function(){var t=this.getBytes(8);this.sendToServer(t)},e.prototype.requestOwnGuildRank=function(){var t=this.getBytes(9);this.sendToServer(t)},e.prototype.postGuildPersonalRank=function(t){for(var e=[],i=t.readInt(),s=0;i>s;s++){var n=new RankGuildInfo;n.parse(t),e[s]=n}return e},e.prototype.requestDayReward=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.requestOwnMyGuildRank=function(){var t=this.getBytes(14);this.sendToServer(t)},e.prototype.requestStartGetFlag=function(){var t=this.getBytes(16);this.sendToServer(t)},e.prototype.requestWinGuildInfo=function(){var t=this.getBytes(21);this.sendToServer(t)},e.prototype.postRedBagInfo=function(t){this.getModel().getRedbagInfo(t)},e.prototype.doSendRedBack=function(t){t.readBoolean()&&(ViewManager.ins().close(RedBagWin),UserTips.ins().showTips("|C:0x35e62d&T:发送红包成功|"))},e.prototype.doRobRedBack=function(t){t.readBoolean()&&(ViewManager.ins().close(RedBagWin),ViewManager.ins().open(RedBagDetailsWin,1))},e.prototype.postJoinPlayBack=function(t){var e=t.readBoolean();this.getModel().doorDie=t.readBoolean(),this.getModel().rewardFlag=t.readByte(),e&&(ViewManager.ins().close(GuildWarMainWin),ViewManager.ins().close(GuildMap))},e.prototype.doPlayNextCard=function(t){},e.prototype.doGetPointInfo=function(t){this.getModel().ownPoint=t.readInt(),this.getModel().guildPoint=t.readInt();var e=t.readInt();e>0&&UserTips.ins().showTips("获得 "+e+" 积分"),this.postPointUpdate()},e.prototype.postPointUpdate=function(){},e.prototype.doGetGongXunChange=function(t){this.getModel().gongXun=t.readInt(),this.postPointUpdate()},e.prototype.doGuildRankinfo=function(t){this.getModel().decodeGuildRankInfo(t)},e.prototype.doGuildWarKillInfo=function(t){var e=t.readInt();this.getModel().killName=t.readString(),this.getModel().killGuild=t.readString(),ViewManager.ins().open(GuileWarReliveWin,2,e)},e.prototype.doGuildWarCityOwn=function(t){this.getModel().cityOwn=t.readString(),this.postCityownChange()},e.prototype.postCityownChange=function(){},e.prototype.doMyActivityRankInfo=function(t){this.getModel().decodeMyGuildRankInfo(t)},e.prototype.postDayRewardInfo=function(t){this.getModel().canGetDay=t.readBoolean(),this.getModel().getDayReward=t.readBoolean(),this.getModel().rewardDay=t.readInt()},e.prototype.postFlagInfoChange=function(t){this.getModel().flagAcId=0,this.getModel().flagStatu=t.readShort(),0==this.getModel().flagStatu?this.getModel().endTime=t.readInt():2==this.getModel().flagStatu&&(this.getModel().flagName=t.readString(),this.getModel().flagAcId=t.readInt(),this.getModel().endTime=t.readInt(),this.getModel().flagGuild=t.readString(),this.getModel().flagAcId==Actor.actorID&&UserTips.ins().showTips("开始采集"))},e.prototype.doGuildWarResult=function(t){this.getModel().decodeGulidWarResult(t)},e.prototype.doHuDunInfoChange=function(t){this.postHudunInfo(t.readInt(),t.readInt())},e.prototype.postHudunInfo=function(t,e){return[t,e]},e.prototype.postAssignsReward=function(t){this.getModel().guildWarRank=t.readInt(),this.getModel().canSendReward=t.readBoolean(),this.getModel().rewardFlag=t.readByte()},e.prototype.sendFenReward=function(t,e){var i=this.getModel().sendNumList,s=this.getBytes(20);s.writeInt(t);for(var n=1;t>=n;n++){s.writeInt(n);var o=n-1,a=e[o].length;s.writeInt(a);for(var r=0;a>r;r++){var h=e[o][r];s.writeInt(h.roleID),s.writeInt(i[o][r])}}this.sendToServer(s)},e.prototype.postSendRewardSuccess=function(t){t.readBoolean()&&(ViewManager.ins().close(SelectMemberRewardWin),this.getModel().canSendReward=!1,UserTips.ins().showTips("奖励已分配完"))},e.prototype.postWinGuildInfo=function(t){this.getModel().winGuildInfo||(this.getModel().winGuildInfo=new WinGuildInfo),this.getModel().winGuildInfo.parse(t)},e.prototype.postGuildWarStarInfo=function(t){this.getModel().isWatStart=t.readBoolean(),this.getModel().startTime=t.readInt(),this.getModel().acEndTime=t.readInt()},e.prototype.doGuildWarDoorHuDun=function(t){UserBoss.ins().curShield=t.readInt(),UserBoss.ins().postShieldPer()},e.prototype.doLotteryInfo=function(t){UserBoss.ins().worldPrize=t.readInt(),ViewManager.ins().open(WorldBossJiangLiWin,1)},e.prototype.sendPlayLotteryInfo=function(){var t=this.getBytes(25);this.sendToServer(t)},e.prototype.doRankInfoChange=function(t){this.getModel().rankListChange(t)},e.prototype.doChangeAttrHandle=function(t){if(14==GameMap.fbType){var e=t.readDouble();this.getModel().attHandle!=e&&(this.getModel().attHandle=e,EntityShowMgr.ins().showHideSomeOne(e),debug.log("add-----------:"+e)),this.postWeixieChange(1)}},e.prototype.postWeixieChange=function(t){return t},e.prototype.postGuildRedPointChange=function(t){return t},e.prototype.doChangeShowList=function(t){if(14==GameMap.fbType){var e=t.readDouble();this.getModel().changeWeiXieList(e,!1),this.getModel().changecanPlayList(e,!1),this.getModel().setMyGuildNum(e,!1),this.getModel().attHandle&&this.getModel().attHandle==e&&(this.getModel().attHandle=0,debug.log("cancel------------:"+e))}},e.prototype.doPointRewardInfo=function(t){this.getModel().decodePointRewardInfo(t)},e.prototype.sendPointReward=function(){var t=this.getBytes(30);this.sendToServer(t)},e.prototype.doDoorEndtime=function(t){this.getModel().doEndDoorTime(t.readByte())},e.prototype.doGetMyPoint=function(t){var e=t.readShort();UserBoss.ins().postLotteryRan(e)},e.prototype.postLotteryPoint=function(t){return t},e.prototype.doTalkMaxPoint=function(t){var e=t.readInt(),i=t.readString();UserBoss.ins().postLotteryResult(i,e)},e.prototype.postKillHuman=function(t){var e=t.readInt();return e},e.prototype.postHeFuBelong=function(t){var e=t.readShort();this.GuildNameBelongs=[];for(var i=0;e>i;i++){var s=t.readString();this.GuildNameBelongs.push(s)}},e.prototype.sendHeFuBelong=function(){this.sendBaseProto(34)},e.prototype.postLotteryMaxPost=function(t,e){return[t,e]},e.prototype.postMyRankChange=function(){},e.prototype.postPointRewardChange=function(){},e.prototype.postCanplayChange=function(){},e.prototype.postRankListChange=function(){},e.prototype.postGuildNumChange=function(){},e.prototype.postSendListChange=function(){},e.prototype.postRankInfo=function(){},e}(BaseSystem);__reflect(GuildWar.prototype,"GuildWar");var GameSystem;!function(t){t.guildwar=GuildWar.ins.bind(GuildWar)}(GameSystem||(GameSystem={}));var GuildApplyInfo=function(){function t(){}return t}();__reflect(GuildApplyInfo.prototype,"GuildApplyInfo");var GuildFBModel=function(){function t(){this.bossTimer=1}return t.prototype.parserBaseInfo=function(t){this.fbNum=t.readShort(),this.sweep=t.readByte(),this.sweepNum=t.readShort(),this.tongguan=t.readByte(),this.zuwei=t.readByte(),this.nextFb=t.readByte()},t.prototype.parserRankInfo=function(t){this.rankDatas=[];for(var e=t.readByte(),i=0;e>i;i++){var s=new GuildFBRankInfo;s.rank=i+1,s.name=t.readString(),s.guanka=t.readShort(),this.rankDatas.push(s)}},t.prototype.parserMaxGkInfo=function(t){this.isMaxGK=t.readByte(),0!=this.isMaxGK&&(this.maxName=t.readString(),this.maxCareer=t.readByte(),this.maxSex=t.readByte(),this.maxNum=t.readShort(),this.maxZhuwei=t.readByte())},t.prototype.parserGkInfo=function(t){this.fbgkNum=t.readShort();var e=t.readByte();this.gkDatas=[];for(var i=0;e>i;i++)this.gkDatas.push(t.readString())},t.prototype.parserRewardInfo=function(t){this.rewardNum=t.readShort(),this.rewardRoleNum=t.readShort()},t.prototype.hasbtn=function(){return GameServer.serverOpenDay>0&&(0==this.sweep&&this.fbNum>0||0==this.tongguan&&this.rewardNum>0)},Object.defineProperty(t.prototype,"bossTimerEnd",{get:function(){return this.bossTimer+egret.getTimer()},enumerable:!0,configurable:!0}),t}();__reflect(GuildFBModel.prototype,"GuildFBModel");var GuildFBRankInfo=function(){function t(){}return t}();__reflect(GuildFBRankInfo.prototype,"GuildFBRankInfo");var GuildListInfo=function(){function t(){}return t}();__reflect(GuildListInfo.prototype,"GuildListInfo");var GuildMemberInfo=function(){function t(){this.level=0,this.zsLevel=0}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.vipLevel=t.readInt(),this.attack=t.readInt(),this.sex=t.readUnsignedByte(),this.job=t.readUnsignedByte(),this.name=t.readString(),this.zsLevel=t.readInt(),this.score=t.readInt(),this.winRate=t.readInt()/1e4,this.KfArenaCount=t.readUnsignedByte(),this.isJoinkfArena=1==t.readUnsignedByte()},t.prototype.copyData=function(t){for(var e in t)this[e]=t[e]},t}();__reflect(GuildMemberInfo.prototype,"GuildMemberInfo");var GuildMessageInfo=function(){function t(){}return t.prototype.parserMessage=function(t){this.type=t.readUnsignedByte(),this.content=t.readString(),1==this.type&&(this.roleId=t.readInt(),this.name=t.readString(),this.job=t.readUnsignedByte(),this.sex=t.readUnsignedByte(),this.vipLevel=t.readInt(),this.monthCard=t.readUnsignedByte(),this.office=t.readUnsignedByte(),this.zsLevel=t.readUnsignedByte(),this.lv=t.readShort(),this.guildName=t.readString())},t}();__reflect(GuildMessageInfo.prototype,"GuildMessageInfo");var GuildSkillInfo=function(){function t(){}return t}();__reflect(GuildSkillInfo.prototype,"GuildSkillInfo");var GuildStoreItemData=function(){function t(){}return t}();__reflect(GuildStoreItemData.prototype,"GuildStoreItemData");var GuildStoreModel=function(){function t(){this.guildStoreLv=0,this.recordInfoAry=[],this.recordMax=50}return t.prototype.parserBaseInfo=function(t){this.guildStoreLv=t.readByte(),this.guildStoreNum=t.readByte()},t.prototype.parserRecordInfo=function(t){var e,i=t.readByte(),s=[];if(null!=this.recordInfoAry&&this.recordInfoAry.length>0&&this.recordInfoAry.length+i>this.recordMax){var n=this.recordMax-i>0?this.recordMax-i:0;this.recordInfoAry.length=n}for(var o=0;i>o;o++)e=new GuildStoreRecordInfo,e.times=t.readInt(),e.roleName=t.readString(),e.itemId=t.readInt(),s.push(e);this.recordInfoAry=s.concat(this.recordInfoAry)},t.prototype.parserBoxItemInfo=function(t){var e=t.readByte();this.guildStoreItemData=[];for(var i=0;e>i;i++){var s=new GuildStoreItemData;s.itemId=t.readInt(),s.num=t.readInt(),this.guildStoreItemData.push(s)}},t.prototype.parserRecord=function(t){this.recordInfo=new GuildStoreRecordInfo,this.recordInfo.roleName=t.readString(),this.recordInfo.itemId=t.readInt()},t}();__reflect(GuildStoreModel.prototype,"GuildStoreModel");var GuildStoreRecordInfo=function(){function t(){}return t}();__reflect(GuildStoreRecordInfo.prototype,"GuildStoreRecordInfo");var GuildTaskInfo=function(){function t(){}return t}();__reflect(GuildTaskInfo.prototype,"GuildTaskInfo");var GuildWarModel=function(){function t(){this.guildPoint=0,this.ownPoint=0,this.gongXun=0,this.rewardDay=1,this.remainYB=-1,this.robYbNum=0,this.guildRankList=[],this.killName="",this.killGuild="",this.cityOwn="虚位以待",this.myRankList=[],this.weixieList=[],this.canPlayList=[],this.flagStatu=0,this.endTime=0,this.flagName="",this.flagAcId=0,this.flagGuild="",this.canClick=!0,this._canSendReward=!1,this.rewardIndex=0,this.sendList=[],this.sendNumList=[],this.rewardFlag=0,this.winGuildInfo=new WinGuildInfo,this.guildWarNumDaXie=["日","一","二","三","四","五","六"],this.rankList=[],this._doorEndtime=0,this.attHandle=0,this.myGuildPointRank=[],this.guildHandleList=[],this.guildNum=0}return t.prototype.creatGuildRankReward=function(t,e){void 0===e&&(e=-1),this.rewardList=[];var i=GlobalConfig.GuildBattleDistributionAward[t];for(var s in i)if(!i[s].rewardFlag||this.rewardFlag==GuildFlag.hf){if(Number(s)==e+1)return i[s].awardShow;var n=i[s].awardShow;for(var o in n)this.checkIsHave(n[o])}return this.rewardList},t.prototype.creatGuildRewardList=function(){if(this.configList)return this.configList;this.configList=[];var t=GlobalConfig.GuildBattleDistributionAward;for(var e in t)-1==this.configList.lastIndexOf(t[e][1].rank)&&this.configList.push(t[e][1].rank);return this.configList},t.prototype.checkIsHave=function(t){for(var e=!1,i=this.rewardList.length,s=0;i>s;s++){var n=this.rewardList[s];n.id==t.id&&n.type==t.type&&(e=!0,this.rewardList[s].count+=t.count)}e||this.rewardList.push(t)},t.prototype.getRedbagInfo=function(t){this.remainYB=t.readInt(),this.canSend=t.readBoolean(),this.canRod=t.readBoolean(),this.sendYbNum=t.readInt(),this.maxRedNum=t.readInt(),this.remainRedNum=t.readInt();var e=t.readInt();this.rebList=[];for(var i,s=0;e>s;s++)i=new GuildRedRobInfo,i.parse(t),Actor.actorID==i.acId&&(this.robYbNum=i.robNum),this.rebList.push(i)},t.prototype.isHaveRedBag=function(){return this.canSend||this.canRod},t.prototype.checkinAppoint=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),!GuildWar.ins().getModel().isWatStart||0==GameMap.fubenID||0==Guild.ins().guildID)return!1;var i=GlobalConfig.GuildBattleLevel;for(var s in i)if(i[s].fbId==GameMap.fubenID)return 0==t?!0:e&&i[s].id>=t?!0:i[s].id==t?!0:!1;return!1},t.prototype.decodeGuildRankInfo=function(t){this.lastGuildName=t.readString();var e=(t.readByte(),t.readInt());this.guildRankList=[];for(var i,s=0;e>s;s++)i=new RankGuildInfo,i.parse(t),this.guildRankList.push(i);GuildWar.ins().postRankInfo()},t.prototype.getNextMapName=function(t){void 0===t&&(t=1);var e=(GameMap.fubenID,GlobalConfig.GuildBattleLevel),i=1;for(var s in e)t==e[s].id&&(i=t);return e[i].name},t.prototype.getIntoNextMapGongxun=function(){var t=GameMap.fubenID,e=GlobalConfig.GuildBattleLevel,i=1;for(var s in e)if(t==e[s].fbId){if(!(e[s].id<4))return 0;i=e[s].id+1}return e[i].feats},t.prototype.getMapLevelInfo=function(){var t=GameMap.fubenID,e=GlobalConfig.GuildBattleLevel,i=1;for(var s in e)t==e[s].fbId&&(i=e[s].id);return e[i]},t.prototype.decodeMyGuildRankInfo=function(t){var e=t.readInt();this.myRankList=[];for(var i,s=0;e>s;s++)i=new MyRankGuildInfo,i.parse(t),this.myRankList.push(i);GuildWar.ins().postMyRankChange()},t.prototype.changeWeiXieList=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),Actor.handle!=t){var s=this.checkListElements(t,this.weixieList);e?-1==s&&(this.weixieList.push(t),UserTips.ins().showTips("|C:0xf3311e&T:"+i+" 正在攻击你|")):-1!=s&&this.weixieList.splice(s,1),GuildWar.ins().postWeixieChange(0)}},t.prototype.changecanPlayList=function(t,e){if(void 0===e&&(e=!0),Actor.handle!=t){var i=this.checkListElements(t,this.canPlayList);e?-1==i&&this.canPlayList.push(t):-1!=i&&this.canPlayList.splice(i,1),GuildWar.ins().postCanplayChange()}},t.prototype.decodeGulidWarResult=function(t){ViewManager.ins().open(GuildWarResultWin,t.readString(),t.readInt(),t.readInt(),t.readInt(),t.readInt())},t.prototype.checkListElements=function(t,e){if(e.length<=0)return-1;for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1},t.prototype.getRewardByPoint=function(t){var e=[];if(!this.dataList){this.dataList=[];var i=GlobalConfig.GuildBattlePersonalAward;for(var s in i)this.dataList.push(i[s])}for(var n=this.dataList.length,o=0;n>o;o++)t>=this.dataList[o].integral&&(e=e.concat(this.dataList[o].award));return e},t.prototype.getMyPointReward=function(){var t,e=GlobalConfig.GuildBattlePersonalAward;for(var i in e)if(t=e[i],t.id==this.pointInfo.id)return t;return null},t.prototype.getMaxReward=function(){var t,e,i=GlobalConfig.GuildBattlePersonalAward,s=0;for(var n in i)t=i[n],t.integral>s&&(s=t.integral,e=t);return e},Object.defineProperty(t.prototype,"clickTime",{get:function(){return this._clickTime},set:function(t){this.canClick=!1,this._clickTime=t,TimerManager.ins().remove(this.endTimeChangeStatu,this),TimerManager.ins().doTimer(1e3,this._clickTime,this.endTimeChangeStatu,this)},enumerable:!0,configurable:!0}),t.prototype.endTimeChangeStatu=function(){--this._clickTime,this._clickTime<=0&&(this.canClick=!0,TimerManager.ins().remove(this.endTimeChangeStatu,this))},Object.defineProperty(t.prototype,"canSendReward",{get:function(){return Guild.ins().myOffice==GuildOffice.GUILD_BANGZHU&&this._canSendReward},set:function(t){this._canSendReward=t},enumerable:!0,configurable:!0}),t.prototype.getCanSendNumByRank=function(t){void 0===t&&(t=-1);var e=GlobalConfig.GuildBattleDistributionAward[this.guildWarRank],i=0;for(var s in e)if(!e[s].rewardFlag||this.rewardFlag==GuildFlag.hf){if(s==t+1+"")return e[s].count;++i}return i},t.prototype.checkISSendAll=function(){for(var t=this.getCanSendNumByRank(),e=0;t>e;e++){var i=this.getCanSendNumByRank(e);if(!this.sendList[e])return UserTips.ins().showTips("|C:0xf3311e&T:|请先选择需要分配奖励的成员"),!1;for(var s=0,n=0;n<this.sendNumList[e].length;n++)s+=this.sendNumList[e][n];if(i>s)return UserTips.ins().showTips("|C:0xf3311e&T:|请先选择需要分配奖励的成员"),!1;for(var n=0;n<this.sendList[e].length;n++)if(!Guild.ins().checkIsInGuild(this.sendList[e][n].roleID))return UserTips.ins().showTips("|C:0xf3311e&T:|"+this.sendList[e][n].name+" 已退出公会"),!1}return!0},Object.defineProperty(t.prototype,"acEndTime",{get:function(){return this._acEndTime},set:function(t){this._acEndTime=t,this._acEndTime>0&&(TimerManager.ins().remove(this.reduceTime,this),TimerManager.ins().doTimer(1e3,t,this.reduceTime,this))},enumerable:!0,configurable:!0}),t.prototype.reduceTime=function(){--this._acEndTime,this._acEndTime<=0&&TimerManager.ins().remove(this.reduceTime,this)},t.prototype.setOpenDesc=function(){if(0==this.startTime)return"";var t=new Date(1e3*this.startTime);return t.getMonth()+1+"月"+t.getDate()+"号(周"+this.guildWarNumDaXie[t.getDay()]+")20:00开启龙城争霸"},t.prototype.getCdByType=function(t){if(0==GameMap.fubenID)return 0;var e=GlobalConfig.GuildBattleLevel;for(var i in e)if(e[i].fbId==GameMap.fubenID&&(1==t||3==t))return e[i].switchSceneCd;return 0},t.prototype.getIsShowGuildWarBtn=function(){if(0==this.startTime||GlobalConfig.GuildBattleConst.openLevel>Actor.level)return 0;var t=new Date(1e3*this.startTime),e=new Date(GameServer.serverTime);return t.getDate()==e.getDate()&&(e.getHours()<20||20==e.getHours()&&e.getMinutes()<=15)||this.isWatStart?1:0},t.prototype.rankListChange=function(t){var e=t.readInt();this.rankList=[];for(var i,s=0;e>s;s++)i=new WarRankInfo,i.parse(t),this.rankList.push(i);GuildWar.ins().postRankListChange()},t.prototype.decodePointRewardInfo=function(t){this.pointInfo||(this.pointInfo=new PointRewarddInfo),this.pointInfo.parse(t),GuildWar.ins().postPointRewardChange()},t.prototype.getSelectDataByIndex=function(t){var e,i,s=[];if(this.sendList&&this.sendList[t]&&this.sendList[t].length>0){e=this.sendList[t],i=this.sendNumList[t];for(var n=void 0,o=0;o<e.length;o++)n=new SelectInfoData,n.data=e[o],n.num=i[o],s.push(n)}return s},t.prototype.getMyPointRankReward=function(t){var e=GlobalConfig.GuildBattlePersonalRankAward;for(var i in e)if(e[i].rank==t)return e[i].award;return[]},t.prototype.doEndDoorTime=function(t){this._doorEndtime=t,TimerManager.ins().remove(this.timeDo,this),TimerManager.ins().doTimer(1e3,this._doorEndtime,this.timeDo,this)},t.prototype.timeDo=function(){--this._doorEndtime,this._doorEndtime<=0&&(this._doorEndtime=0,TimerManager.ins().remove(this.timeDo,this))},Object.defineProperty(t.prototype,"doorEndtime",{get:function(){return this._doorEndtime},enumerable:!0,configurable:!0}),t.prototype.getMyGuildPointRank=function(){var t,e,i=Guild.ins().getGuildMembers(0),s=i.length;this.myGuildPointRank=[];for(var n=0;s>n;n++)t=i[n],e=new SelectInfoData,e.data=t,e.num=this.getPointByAcId(t.roleID),this.myGuildPointRank.push(e);return this.myGuildPointRank.sort(this.sort),this.myGuildPointRank},t.prototype.getPointByAcId=function(t){for(var e=this.myRankList.length,i=0;e>i;i++)if(this.myRankList[i].roleID==t)return this.myRankList[i].point;return 0},t.prototype.sort=function(t,e){var i=t.num,s=e.num;return i>s?-1:s>i?1:0},t.prototype.setMyGuildNum=function(t,e){void 0===e&&(e=!0);var i=this.checkListElements(t,this.guildHandleList);e?-1==i&&this.guildHandleList.push(t):i>-1&&this.guildHandleList.splice(i,1),this.guildNum=this.guildHandleList.length,GuildWar.ins().postGuildNumChange()},t.prototype.clearGuildWarList=function(){this.checkinAppoint()&&(this.weixieList=[],this.canPlayList=[],this.attHandle=0,this.guildHandleList=[])},t}();__reflect(GuildWarModel.prototype,"GuildWarModel");var GuildRedRobInfo=function(){function t(){}return t.prototype.parse=function(t){this.robNum=t.readInt(),this.robName=t.readString(),this.acId=t.readInt()},t}();__reflect(GuildRedRobInfo.prototype,"GuildRedRobInfo");var RankGuildInfo=function(){function t(){}return t.prototype.parse=function(t){this.guildName=t.readString(),this.ownName=t.readString(),this.guildPoint=t.readInt()},t}();__reflect(RankGuildInfo.prototype,"RankGuildInfo");var MyRankGuildInfo=function(){function t(){}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.myName=t.readString(),this.mapName=t.readString(),this.point=t.readInt(),this.attr=t.readInt(),this.office=t.readInt(),this.job=t.readInt(),this.sex=t.readInt()},t}();__reflect(MyRankGuildInfo.prototype,"MyRankGuildInfo");var WinGuildInfo=function(){function t(){this.guildId=0,this.guildName="",this.guildOwnName="",this.guildOwnId=0,this.guildOwnJob=0,this.guildOwnSex=0,this.clothID=0,this.wapenId=0,this.wingOpen=0,this.winId=0}return t.prototype.parse=function(t){this.guildId=t.readInt(),this.guildName=t.readString(),this.guildOwnName=t.readString(),this.guildOwnId=t.readInt(),this.guildOwnJob=t.readByte(),this.guildOwnSex=t.readByte(),this.clothID=t.readInt(),this.wapenId=t.readInt(),this.wingOpen=t.readInt(),this.winId=t.readInt()},t}();__reflect(WinGuildInfo.prototype,"WinGuildInfo");var WarRankInfo=function(){function t(){}return t.prototype.parse=function(t){this.name=t.readString(),this.point=t.readInt()},t}();__reflect(WarRankInfo.prototype,"WarRankInfo");var PointRewarddInfo=function(){function t(){}return t.prototype.parse=function(t){this.isCan=t.readBoolean(),this.id=t.readInt(),this.point=t.readInt()},t}();__reflect(PointRewarddInfo.prototype,"PointRewarddInfo");var GuildFlag;!function(t){t[t.act=0]="act",t[t.hf=1]="hf",t[t.kf=2]="kf"}(GuildFlag||(GuildFlag={}));var SelectInfoData=function(){function t(){}return t}();__reflect(SelectInfoData.prototype,"SelectInfoData");var GuildRoleSkillInfo=function(){function t(){this.guildSkillInfo=[],this.practiceSkillInfo=[]}return t}();__reflect(GuildRoleSkillInfo.prototype,"GuildRoleSkillInfo");var RobberStartInfo=function(){function t(){}return t}();__reflect(RobberStartInfo.prototype,"RobberStartInfo");var GuildBossDetailWin=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="GuildBossTipSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.addTouchEvent(this.chanllage,this.onTap),this.addTouchEvent(this.chanllageOme,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.rankBtn,this.onTap),this.observe(GuildBoss.ins().postGuildBossDetailChange,this.setView),this.observe(GuildBoss.ins().postGuildBossInfoChange,this.upInfo),this.observe(GuildBoss.ins().postChallengeSuccess,this.challengeSuccess),this.observe(GuildBoss.ins().postGuildBossRankInfoChange,this.setRank),this.upInfo(),GuildBoss.ins().sendGetBossRankInfo(this.index+1)},e.prototype.upInfo=function(){GuildBoss.ins().sendGetBossInfo()},e.prototype.setView=function(){this.chanllagecount.text="挑战次数"+GuildBoss.ins().leftTimes+"/"+GlobalConfig.GuildBossConfig.dayTimes;var t=GuildBoss.ins().passId;this.chanllagecount.visible=GuildBoss.ins().isOpen()&&t==this.index,this.chanllage.visible=GuildBoss.ins().isOpen()&&this.index<=t,this.cantchanllage.visible=GuildBoss.ins().isOpen()&&!this.chanllage.visible;var e=GlobalConfig.GuildBossInfoConfig[this.index+1],i=GlobalConfig.MonstersConfig[e.boss.monId];this.bossname.text=i.name,this.bossImage.source=e.ShowImg;for(var s=GuildBoss.ins().passRecord[this.index+1],n=0;n<e.passAwards.length;n++)this["itemicon"+n].isShowName(!1),this["itemicon"+n].data=e.passAwards[n];for(var o=GlobalConfig.GuildBossHpAwardsConfig[this.index+1],n=3;7>n;n++)this["itemicon"+n].isShowName(!1),this["itemicon"+n].data=o[n-2].awards[0];if(this.index<t)this.bosshp.value=0,this.bosshp.maximum=0,this.rewardBar.value=100,this.rewardBar.maximum=100;else if(this.index==t){var a=0;a=Math.ceil((i.hp-GuildBoss.ins().bossHP)/i.hp*1e4)/100>>0,this.bosshp.maximum=100,this.bosshp.value=a,this.rewardBar.value=100-a,this.rewardBar.maximum=100}else this.bosshp.value=100,this.bosshp.maximum=100,this.rewardBar.value=0,this.rewardBar.maximum=100;this.chanllage.enabled=!0,this.chanllage.x=166,this.chanllageOme.visible=!1,0==s||this.bosshp.value?Guild.ins().guildLv>=GlobalConfig.GuildBossConfig.radisLv&&this.chanllage.visible&&(this.chanllageOme.visible=!0,this.chanllage.x=54):1==s?this.chanllage.label="领 取":(this.chanllage.label="已领取",this.chanllage.enabled=!1),this.state.visible=!GuildBoss.ins().isOpen(),this.state.visible&&(this.cantchanllage.visible=this.chanllageOme.visible=this.chanllage.visible=!1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.chanllageOme:case this.chanllage:if(0==GuildBoss.ins().passRecord[this.index+1]||this.bosshp.value){if(GuildBoss.ins().challengeTime>GameServer.serverTime)return void UserTips.ins().showTips("|C:0x35e62d&T:正在挑战中，请稍后|");if(GuildBoss.ins().leftTimes<=0)return void UserTips.ins().showTips("没有挑战次数");GuildBoss.ins().sendChallengeBoss(t.currentTarget==this.chanllageOme?1:0)}else"领 取"==this.chanllage.label&&GuildBoss.ins().sendGetBossReward(this.index+1);break;case this.rankBtn:ViewManager.ins().open(GuildBossRankWin,this.index);break;case this.bgClose:ViewManager.ins().close(e)}},e.prototype.challengeSuccess=function(){ViewManager.ins().close(GuildBossWin),ViewManager.ins().close(GuildMap),ViewManager.ins().close(e)
},e.prototype.setRank=function(){for(var t=GuildBoss.ins().guildRankDic[this.index+1],e=GlobalConfig.GuildBossInfoConfig[this.index+1],i=GlobalConfig.MonstersConfig[e.boss.monId],s=0;3>s;s++)if(t&&t[s]){this["rankGroup"+s].visible=!0,this["guildname"+s].text=t[s].name;var n=0,o=Math.ceil(t[s].damage/i.hp*1e4)/100;n=o>100?100:o,this["hpbar"+s].value=n,this["hpbar"+s].maximum=100,this["bosshpbg"+s].visible=this["hpbar"+s].visible=!0}else this["bosshpbg"+s].visible=this["hpbar"+s].visible=!1},e}(BaseEuiView);__reflect(GuildBossDetailWin.prototype,"GuildBossDetailWin"),ViewManager.ins().reg(GuildBossDetailWin,LayerManager.UI_Popup);var GuildBossItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBossItemSkin",e.bosshp.maximum=100,e.bosshp.slideDuration=0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GuildBoss.ins().passId,e=this.data+1,i=GlobalConfig.GuildBossInfoConfig[e],s=GlobalConfig.MonstersConfig[i.boss.monId];if(this.bossImage.source=i.ShowImg,this.data<t){this.bossname.textColor=10458221,this.bosshp.value=0;var n=GuildBoss.ins().passRecord[e];this.passImg.visible=!0,this.redPoint0.visible=GuildBoss.ins().isOpen()&&1==n}else this.data==t?(this.bossname.textColor=13746831,this.bosshp.value=Math.ceil((s.hp-GuildBoss.ins().bossHP)/s.hp*1e4)/100>>0,this.redPoint0.visible=GuildBoss.ins().isOpen()&&GuildBoss.ins().leftTimes>0?!0:!1,this.passImg.visible=!1):(this.bossname.textColor=13746831,this.bosshp.value=100,this.redPoint0.visible=!1,this.passImg.visible=!1);this.bossname.text=e+"."+s.name},e.prototype.isOpen=function(){return(new Date).getDay()!=GlobalConfig.GuildBossConfig.notOpenDayOfWeek},e}(BaseItemRender);__reflect(GuildBossItemRender.prototype,"GuildBossItemRender");var GuildBossRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBossHarmItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.rank.text=this.data.rank,this.playerName.text=this.data.name,this.harm.text=this.data.damage;var t,e=!1,i=GlobalConfig.GuildBossRankConfig;for(var s in i){if(i[s].srank<=this.data.rank&&i[s].erank>=this.data.rank){e=!0,this.reward.text=i[s].awards[0].count+"";break}0==i[s].srank&&0==i[s].erank&&(t=i[s])}e||(this.reward.text=t.awards[0].count+"")},e}(BaseItemRender);__reflect(GuildBossRankItemRender.prototype,"GuildBossRankItemRender");var GuildBossRankWin=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="GuildBossHarmSkin",e.isTopLevel=!0,e.list.itemRenderer=GuildBossRankItemRender,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.setView=function(){for(var t=[],e=GuildBoss.ins().guildPersonRankDic[this.index+1]||[],i=0;i<e.length;i++)e[i]&&(e[i].name==Actor.myName&&(this.myData=e[i]),t.push(e[i]));this.list.dataProvider=new eui.ArrayCollection(t),this.myData?(this.qiansan.visible=!0,this.myrank.visible=!0,this.myname.visible=!0,this.myharm.visible=!0,this.myreword.visible=!0,this.myData.rank<=3?this.qiansan.source="guildpaihang"+this.myData.rank:this.qiansan.source="",this.myrank.text=this.myData.rank+"",this.myname.text=this.myData.name,this.myharm.text=this.myData.damage+"",this.myreword.text=GuildBoss.ins().leftTimes+"/"+GlobalConfig.GuildBossConfig.dayTimes):(this.qiansan.visible=!1,this.myrank.visible=!1,this.myname.visible=!1,this.myharm.visible=!1,this.myreword.visible=!1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuildBossRankWin.prototype,"GuildBossRankWin"),ViewManager.ins().reg(GuildBossRankWin,LayerManager.UI_Popup);var GuildBossWin=function(t){function e(){var e=t.call(this)||this;return e.bossLen=0,e.itemLen=6,e.arrCount=0,e.currentArr=[],e.currentIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="guildBossSkin",this.itemArr=[];for(var e=0;6>e;e++)this.itemArr.push(this["bossItem"+e]);this.bossLen=CommonUtils.getObjectLength(GlobalConfig.GuildBossInfoConfig),this.arrCount=0,this.bossArr=[];for(var i=0;i<this.bossLen;i++)this.bossArr[this.arrCount]||(this.bossArr[this.arrCount]=[]),i<(this.arrCount+1)*this.itemLen?this.bossArr[this.arrCount].push(i):i==(this.arrCount+1)*this.itemLen&&(this.arrCount++,this.bossArr[this.arrCount]=[],this.bossArr[this.arrCount].push(i))},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.imgleft,this.onTap),this.addTouchEvent(this.imgRight,this.onTap);for(var i=0;i<this.itemLen;i++)this.addTouchEvent(this.itemArr[i],this.onItemTap);this.observe(GuildBoss.ins().postGuildBossDetailChange,this.setView),this.observe(GuildBoss.ins().postGuildBossInfoChange,this.setView),this.observe(GuildBoss.ins().postChallengeSuccess,this.challengeSuccess),this.currentIndex=this.getRuleIndex(),GuildBoss.ins().sendGetBossInfo()},e.prototype.getRuleIndex=function(){var t=Object.keys(GlobalConfig.GuildBossInfoConfig).length,e=GuildBoss.ins().passId;return e>=t&&(e-=1),Math.floor(e/this.itemLen)},e.prototype.setView=function(){var t=GuildBoss.ins().passId+1,e=Object.keys(GlobalConfig.GuildBossInfoConfig).length;t=t>=e?e:t,this.currentArr=this.bossArr[this.currentIndex];var i=GlobalConfig.GuildBossInfoConfig[t];this.fightboss.source=i.ShowImg;for(var s=0;s<this.itemLen;s++)null!=this.currentArr[s]?(this.itemArr[s].data=this.currentArr[s],this.itemArr[s].visible=!0):this.itemArr[s].visible=!1;this.selfname.text=Guild.ins().guildName,this.enemyname.text=GuildBoss.ins().otherGuildName;var n=CommonUtils.getObjectLength(GlobalConfig.GuildBossInfoConfig),o=GuildBoss.ins().passId+1>n?n:GuildBoss.ins().passId+1,a=GlobalConfig.GuildBossInfoConfig[o],r=GlobalConfig.MonstersConfig[a.boss.monId],h=0,l=0;h=Math.ceil((r.hp-GuildBoss.ins().bossHP)/r.hp*1e4)/100,this.sbhpbar.value=h,this.sbhpbar.maximum=100,this.ebhpbar.value=l,this.ebhpbar.maximum=100,this.state.visible=!GuildBoss.ins().isOpen(),this.currentIndex?this.currentIndex==this.arrCount?(this.imgleft.visible=!0,this.imgRight.visible=!1):(this.imgleft.visible=!0,this.imgRight.visible=!0):(this.imgleft.visible=!1,this.imgRight.visible=!0)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.imgleft:this.currentIndex--,this.currentIndex<=0&&(this.imgleft.visible=!1),this.setView(),this.imgRight.visible=!0;break;case this.imgRight:this.currentIndex++,this.currentIndex>=this.arrCount&&(this.imgRight.visible=!1),this.setView(),this.imgleft.visible=!0}},e.prototype.onItemTap=function(t){ViewManager.ins().open(GuildBossDetailWin,t.currentTarget.data)},e.prototype.challengeSuccess=function(){ViewManager.ins().close(e),ViewManager.ins().close(GuildMap)},e}(BaseEuiView);__reflect(GuildBossWin.prototype,"GuildBossWin"),ViewManager.ins().reg(GuildBossWin,LayerManager.UI_Popup);var GuildActityItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildActityItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){switch(t){case this.goBtn0:this.conBtnOnCLick()}},e.prototype.conBtnOnCLick=function(){var t=this.data;return GuildRobber.ins().robberTotal-GuildRobber.ins().robberDealNum<=0?void UserTips.ins().showTips("|C:0xf3311e&T:公会兽人军团已经全部被击杀了！|"):void(1==t.id&&ViewManager.ins().close(GuildActivityWin))},e.prototype.dataChanged=function(){var t=this.data;if(t){if(t.id&&(this.taskIcon.source="guildActity_"+t.id),t.context){var e=t.context;if(t.openDay&&GameServer.serverOpenDay<t.openDay-1){var i=TextFlowMaker.getCStr(t.openDay);e=e.replace("\n","|C:0x35e62d&S:14&T:（开服第"+i+"天开启）|\n")}this.nameLab.textFlow=TextFlowMaker.generateTextFlow1(e)}1==t.id&&(this.descLab.text="本轮剩余强盗："+(GuildRobber.ins().robberTotal-GuildRobber.ins().robberDealNum)+"/"+GuildRobber.ins().robberTotal)}},e}(BaseItemRender);__reflect(GuildActityItemRender.prototype,"GuildActityItemRender");var GuildActityPanel=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e.name="公会活动",e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="GuildActitySkin",this.list.itemRenderer=GuildActityItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData(),this.addTouchEvent(this.list,this.onListTouch)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.list,this.onListTouch)},e.prototype.updateData=function(){var t=[];for(var e in GlobalConfig.GuildActivityConfig){var i=GlobalConfig.GuildActivityConfig[e];t.push(i)}this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.parent;e.onTap(t.target)}},e}(BaseView);__reflect(GuildActityPanel.prototype,"GuildActityPanel");var GuildActivityWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildActivityBgSkin",this.tab.dataProvider=this.viewStack,this.activityPanel=new GuildActityPanel},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||UserTips.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,GameServer.serverOpenDay>=GlobalConfig.GuildActivityConfig[1].openDay-1&&this.viewStack.addChild(this.activityPanel),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(GuildFB.ins().postGuildFubenInfo,this.updateRedpoint),this.viewStack.getElementAt(this.lastSelect).open(),this.updateRedpoint()},e.prototype.updateRedpoint=function(){this.redPoint1.visible=GuildFB.ins().hasbtn()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e}(BaseEuiView);__reflect(GuildActivityWin.prototype,"GuildActivityWin"),ViewManager.ins().reg(GuildActivityWin,LayerManager.UI_Main);var GuildAppltListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberApplyItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("工会战期间,不允许对申请玩家进行操作",function(){},this);switch(t){case this.ok:var e=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0,i=e?GlobalConfig.GuildConfig.affairMember[e-1]:0;if(Guild.ins().getMemberNum()>=GlobalConfig.GuildConfig.maxMember[Guild.ins().guildLv-1]+i)return void UserTips.ins().showTips("|C:0xf3311e&T:公会成员已满|");Guild.ins().sendProcessJoin(this.data.roleID,1);break;case this.cancel:Guild.ins().sendProcessJoin(this.data.roleID,0)}},e.prototype.dataChanged=function(){if(this.data instanceof GuildApplyInfo){var t=this.data;t.vipLevel>0?this.nameLab.x=162:this.nameLab.x=109;var e="<font color='#C2BAA5'>"+t.name+"</font>";this.nameLab.textFlow=(new egret.HtmlTextParser).parser(e),this.attack0.text=t.attack+"",this.myFace.source="head_"+t.job+t.sex,this.vipTitle.visible=t.vipLevel>0}},e}(BaseItemRender);__reflect(GuildAppltListItemRender.prototype,"GuildAppltListItemRender");var GuildApplyListWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberApplySkin",e.list.itemRenderer=GuildAppltListItemRender,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.attrNum.restrict="0-9",this.attrNum.maxChars=8},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onListTouch),this.observe(Guild.ins().postApplyInfos,this.updateList),Guild.ins().sendApplyInfos(),this.addTouchEvent(this.checkBoxs,this.onTap),this.addChangeEvent(this.attrNum,this.onTxtChange),this.checkBoxs.selected=1==Guild.ins().isAuto,this.attrNum.text=Guild.ins().attrLimit+""},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.list,this.onListTouch),this.removeTouchEvent(this.checkBoxs,this.onTap),this.attrNum.removeEventListener(egret.Event.CHANGE,this.onTxtChange,this),this.removeObserve()},e.prototype.onTxtChange=function(t){Guild.ins().sendAddGuildLimit(this.checkBoxs.selected?1:0,parseInt(this.attrNum.text))},e.prototype.updateList=function(t){t.sort(this.sort),this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;e.onTap(t.target)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.checkBoxs:this.onTxtChange(null)}},e.prototype.sort=function(t,e){return t.attack>e.attack?-1:t.attack<e.attack?1:0},e}(BaseEuiView);__reflect(GuildApplyListWin.prototype,"GuildApplyListWin"),ViewManager.ins().reg(GuildApplyListWin,LayerManager.UI_Main);var GuildApplyWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.dataArr=new eui.ArrayCollection([]),e.skinName="GuildApplySkin",e.list.itemRenderer=GuildListItemRender,e.list.dataProvider=e.dataArr,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.createBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onListTouch),this.observe(Guild.ins().postGuildList,this.updateList),Guild.ins().sendGuildList()},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;e.onTap()}},e.prototype.updateList=function(){this.noGuild.visible=0==Guild.ins().guildListInfos.length,this.dataArr.replaceAll(Guild.ins().guildListInfos)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.createBtn:ViewManager.ins().open(GuildCreateWin)}},e.prototype.destoryView=function(){t.prototype.destoryView.call(this);for(var e=0;e<this.list.numElements;e++)this.list.getElementAt(e)&&this.list.getElementAt(e).destruct()},e}(BaseEuiView);__reflect(GuildApplyWin.prototype,"GuildApplyWin"),ViewManager.ins().reg(GuildApplyWin,LayerManager.UI_Popup);var GuildBuildItemRender=function(t){function e(){var e=t.call(this)||this;return e._maxLevel=0,e._curLevel=0,e._nextMoney=0,e.skinName="GuildManageItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){switch(t){case this.upBtn:var e=this.data;if(Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU)return void UserTips.ins().showTips("仅会长可操作");if(e==GuildBuilding.GUILD_HALL&&this._curLevel>=this._maxLevel)return void UserTips.ins().showTips("等级已满");if(e!=GuildBuilding.GUILD_HALL&&this._curLevel>=Guild.ins().guildLv)return void UserTips.ins().showTips("请先升级管理大厅");if(Guild.ins().money<this._nextMoney)return void UserTips.ins().showTips("资金不足");Guild.ins().sendUpBuilding(e)}},e.prototype.dataChanged=function(){var t=this.data;this.buildImg.visible=1==t,this._curLevel=Guild.ins().getBuildingLevels(t-1)||0;var e=GlobalConfig.GuildLevelConfig[t],i=null,s=null;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];this._maxLevel=o.level>this._maxLevel?o.level:this._maxLevel,o.level==this._curLevel&&(i=o),o.level==this._curLevel+1&&(s=o)}(i||s||t==GuildBuilding.GUILD_LIANGONGFANG)&&(this.nameLab.text=GlobalConfig.GuildConfig.buildingNames[t-1],this.levelLab.text="等级 "+(null==this._curLevel?0:this._curLevel),s&&this._curLevel<this._maxLevel?(this._nextMoney=s.upFund,this.upLevelLab.text=t==GuildBuilding.GUILD_HALL?"":"升级要求：管理大厅达到"+(this._curLevel+1)+"级",this.money.text=Guild.ins().money+"/"+s.upFund,this.needMoney.text="需资金："+s.upFund,this.progress.maximum=s.upFund,this.progress.value=Guild.ins().money,this.progress.visible=!0):(this.upLevelLab.text="等级已满",i?this.money.text=Guild.ins().money+"/"+i.upFund:this.money.text="已满级",this.needMoney.text="",this.progress.visible=!1),this.buildingLab.text=GlobalConfig.GuildConfig.buildingTips[t-1]),this.manege.source="guildmn"+t+"_png",t==GuildBuilding.GUILD_SHOP&&(this.progress.visible=this.progressbg.visible=this.progressblack.visible=this.levelLab.visible=this.needMoney.visible=this.money.visible=!1,this.upBtn.touchEnabled=!1,this.upBtn.label="敬请期待",this.upBtn.currentState="disabled",this.upBtn.verticalCenter=0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){var t=this.data;return t==GuildBuilding.GUILD_SHOP?void(this.redPoint.visible=!1):Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU?void(this.redPoint.visible=!1):t==GuildBuilding.GUILD_HALL&&this._curLevel>=this._maxLevel?void(this.redPoint.visible=!1):t!=GuildBuilding.GUILD_HALL&&this._curLevel>=Guild.ins().guildLv?void(this.redPoint.visible=!1):Guild.ins().money<this._nextMoney?void(this.redPoint.visible=!1):void(this.redPoint.visible=!0)},e}(BaseItemRender);__reflect(GuildBuildItemRender.prototype,"GuildBuildItemRender");var GuildChangeNameView=function(t){function e(){var e=t.call(this)||this;return e.skinName="guildNameChange",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.sureBtn:this.onChangeName()}},e.prototype.onChangeName=function(){""==this.input.text?UserTips.ins().showTips("请输入行会名字"):(Guild.ins().sendGuildChangeName(this.input.text),ViewManager.ins().close(this))},e}(BaseEuiView);__reflect(GuildChangeNameView.prototype,"GuildChangeNameView"),ViewManager.ins().reg(GuildChangeNameView,LayerManager.UI_Popup);var GuildConWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildConSkin",this.desc0.text="捐献"+GlobalConfig.GuildDonateConfig[1].count+"元宝",this.desc1.text="捐献"+GlobalConfig.GuildDonateConfig[2].count+"金币",this.info0.text="贡献 +"+GlobalConfig.GuildDonateConfig[1].awardContri+"	资金 +"+GlobalConfig.GuildDonateConfig[1].awardFund,this.info1.text="贡献 +"+GlobalConfig.GuildDonateConfig[2].awardContri+"	资金 +"+GlobalConfig.GuildDonateConfig[2].awardFund},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.update=function(){var t=GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv],e=GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv+1],i=Guild.ins().getConCount();i[0]<=0?(e&&e-t>0?this.count0.textFlow=(new egret.HtmlTextParser).parser("<font color='#f3311e'>VIP"+(UserVip.ins().lv+1)+"</font>额外捐献"+(e-t)+"次"):this.count0.text=t-i[0]+"/"+GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv],this.btn0.enabled=!1):(this.btn0.enabled=!0,this.count0.text=t-i[0]+"/"+GlobalConfig.GuildDonateConfig[1].dayCount[UserVip.ins().lv]),this.btn1.enabled=i[1]>0,this.count1.text=GlobalConfig.GuildDonateConfig[2].dayCount-i[1]+"/"+GlobalConfig.GuildDonateConfig[2].dayCount},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Guild.ins().postConCount,this.update),Guild.ins().sendConCount(),0==UserVip.ins().lv?this.btn0.label="成为VIP":this.btn0.label="捐 献"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.btn0,this.onTap),this.removeTouchEvent(this.btn1,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){var e=Guild.ins().getConCount();switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.btn0:0==UserVip.ins().lv?ViewManager.ins().open(VipWin):e[0]<=0?UserTips.ins().showTips("次数不足"):Actor.yb>=GlobalConfig.GuildDonateConfig[1].count?Guild.ins().sendCon(1):(UserTips.ins().showTips("元宝不足"),ViewManager.ins().close(this));break;case this.btn1:e[1]<=0?UserTips.ins().showTips("次数不足"):Actor.gold>=GlobalConfig.GuildDonateConfig[2].count?Guild.ins().sendCon(2):UserTips.ins().showTips("金币不足");break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildConWin.prototype,"GuildConWin"),ViewManager.ins().reg(GuildConWin,LayerManager.UI_Popup);var GuildCreateWin=function(t){function e(){var e=t.call(this)||this;return e.selectLevel=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildBuildSkin",this.leftLab.textFlow=(new egret.HtmlTextParser).parser(this.formatLab(1)),this.rightLab.textFlow=(new egret.HtmlTextParser).parser(this.formatLab(2))},e.prototype.changeSelect=function(t){this.selectLevel=t,this.selectBmp.x=1==this.selectLevel?this.bg1.x:this.bg2.x},e.prototype.formatLab=function(t){var e=GlobalConfig.GuildCreateConfig,i=GlobalConfig.GuildConfig,s=e[t].vipLv,n=s>0?"<font color='#3a8fee'>(VIP"+s+"可创建)</font>":"",o=0==e[t].award?"\n":"\n返还<font color='#0FEE27'>"+e[t].award.toString()+"</font>公会贡献",a="<font color='#FFDB00' size='20'>"+e[t].level.toString()+"级</font>公会\n"+n+"\n容纳<font color='#0FEE27'>"+i.maxMember[t-1]+"</font>公会成员"+o+"\n\n创建消耗:<font color='#FFDB00'>"+e[t].moneyCount.toString()+"</font>元宝",r="<font color='#DFD1B5' size='16'>"+a+"</font>";return r},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.leftLab,this.onTap),this.addTouchEvent(this.rightLab,this.onTap),this.addTouchEvent(this.okBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.okBtn:var i=GlobalConfig.GuildCreateConfig,s=i[this.selectLevel],n=i[s.level].vipLv;if(UserVip.ins().lv<n)return void UserTips.ins().showTips("vip等级不足");""==this.textInput.text?UserTips.ins().showTips("请输入行会名字"):Actor.yb<s.moneyCount?(UserTips.ins().showTips("元宝不足"),ViewManager.ins().close(this)):WarnWin.show("你将消耗"+s.moneyCount+"元宝，创建"+s.level+"级公会["+this.textInput.text+"]，确定创建？",function(){Guild.ins().sendGuildCreate(e.selectLevel,e.textInput.text)},this);break;case this.leftLab:this.changeSelect(1);break;case this.rightLab:this.changeSelect(2)}},e}(BaseEuiView);__reflect(GuildCreateWin.prototype,"GuildCreateWin"),ViewManager.ins().reg(GuildCreateWin,LayerManager.UI_Popup);var GuildEventItenRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildEventItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if("string"==typeof this.data){var t=this.data;t&&""!=t&&(this.info.textFlow=(new egret.HtmlTextParser).parser(t))}},e}(BaseItemRender);__reflect(GuildEventItenRender.prototype,"GuildEventItenRender");var GuildFirePanel=function(t){function e(){var e=t.call(this)||this;return e.itemCount=0,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.give,this.onGive),this.observe(Guild.ins().postUpdateFire,this.update),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.give,this.onGive),this.removeObserve()},e.prototype.update=function(){var t=Guild.ins().fireDic;t.fireLvl>0?this.firestar.visible=!0:this.firestar.visible=!1;for(var e=0;;){if(!this["lv"+e])break;this["lv"+e].visible=t.fireLvl>=e,this["fire"+e]&&(this["fire"+e].visible=t.fireLvl==e),e+=1}var i=GlobalConfig.GuildBonFireConfig[t.fireLvl],s=GlobalConfig.GuildBonFireConfig[t.fireLvl+1];i?(this.progressBar.maximum=i.value,this.progressBar.value=t.fireVal):(this.progressBar.maximum=100,this.progressBar.value=100);var n=GlobalConfig.GuildConfig,o=UserBag.ins().getBagItemById(n.bonfireItem);o?(this.count.text=""+o.count,this.cha.textColor=this.count.textColor=3532333,this.itemCount=o.count,this.redPoint.visible=!0):(this.count.text="0",this.cha.textColor=this.count.textColor=16711680,this.itemCount=0,this.redPoint.visible=!1),s?(this.desc1.textFlow=TextFlowMaker.generateTextFlow1("每捐献 1 个柴火增加 |C:0x35E62D&T:"+n.bonfireValue+"| 点篝火值以及 |C:0x35E62D&T:"+n.bonfireReward[0].count+"| 点行会贡献"),this.desc2.textFlow=TextFlowMaker.generateTextFlow1("再捐献总计 |C:0x35E62D&T:"+(i.value-t.fireVal)/n.bonfireValue+"| 个柴火可增加 |C:0x35E62D&T:"+s.reward+"| 行会资金")):(this.desc1.textFlow=TextFlowMaker.generateTextFlow1("每捐献 1 个柴火增加 |C:0x35E62D&T:"+n.bonfireValue+"| 点篝火值以及 |C:0x35E62D&T:"+n.bonfireReward[0].count+"| 点行会贡献"),this.desc2.textFlow=TextFlowMaker.generateTextFlow1("篝火值已达到最大 次日可增加 |C:0x35E62D&T:"+i.reward+"| 行会资金"))},e.prototype.onGive=function(){if(this.itemCount>0){var t=GlobalConfig.GuildConfig.bonfirecount;this.itemCount<t&&(t=this.itemCount),this.itemCount-=t,Guild.ins().sendToFire(t,this.itemCount)}else UserTips.ins().showTips("道具不足")},e}(BaseView);__reflect(GuildFirePanel.prototype,"GuildFirePanel");var GuildListItem2Render=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildListItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildListInfo){var t=this.data,e=GlobalConfig.GuildConfig;if(t&&e){t.guildRank<4?(this.numImg.source="guildshop_json.guildpaihang"+t.guildRank,this.numLab.visible=!1,this.numImg.visible=!0):(this.numLab.text=t.guildRank+"",this.numLab.visible=!0,this.numImg.visible=!1),this.nameLab.textFlow=(new egret.HtmlTextParser).parser(t.guildName),this.member0.text=""+t.guildLevel,this.president.text=t.guildPresident;var i=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0,s=i?GlobalConfig.GuildConfig.affairMember[i-1]:0;this.member.text=t.guildMember+"/"+(e.maxMember[t.guildLevel-1]+s),this.attrLab.text=""+t.attr}}},e}(BaseItemRender);__reflect(GuildListItem2Render.prototype,"GuildListItem2Render");var GuildListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ApplyItemSkin",e}return __extends(e,t),e.prototype.onTap=function(){if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("工会战期间,不允许申请加入公会",function(){},this);var t=this.data;if(-1==Guild.ins().applyGuilds.indexOf(t.guildID)){if(this.data.attr>Actor.power)return void UserTips.ins().showTips("|C:0xf3311e&T:战斗力过低|");this.applyBtn.enabled=!1,this.applyBtn.label="已申请",Guild.ins().applyGuilds.push(t.guildID),Guild.ins().sendJoinGuild(t.guildID)}},e.prototype.dataChanged=function(){if(this.data instanceof GuildListInfo){var t=this.data,e=GlobalConfig.GuildConfig;if(t&&e){this.numLab.text=t.guildRank+"",this.nameLab.textFlow=(new egret.HtmlTextParser).parser(t.guildName+("<font color='#0FEE27'>(Lv."+t.guildLevel+")</font>")),this.president.text=t.guildPresident;var i=t.commentLv?GlobalConfig.GuildConfig.affairMember[t.commentLv-1]:0;this.member.textColor=t.guildMember<e.maxMember[t.guildLevel-1]+i?5226466:15937822,this.member.text=t.guildMember+"/"+(e.maxMember[t.guildLevel-1]+i);var s=CommonUtils.overLength(t.attr);this.attrLabel.visible=s?!0:!1,s&&(this.attrLabel.text="战力要求："+s),Guild.ins().applyGuilds.indexOf(t.guildID)>-1?(this.applyBtn.enabled=!1,this.applyBtn.label="已申请"):(this.applyBtn.enabled=!0,this.applyBtn.label="申请")}}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(GuildListItemRender.prototype,"GuildListItemRender");var GuildMap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="GuildSkin",this.list.itemRenderer=GuildMapMemberItemRender,this.guildWarEffect2=new MovieClip,this.guildRewardEff=new MovieClip,this.guildRewardEff.touchEnabled=!0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.manageBtn,this.onTap),this.addTouchEvent(this.practiseBtn,this.onTap),this.addTouchEvent(this.shopBtn,this.onTap),this.addTouchEvent(this.cityBtn,this.onTap),this.addTouchEvent(this.chatBtn,this.onTap),this.addTouchEvent(this.guildRewardEff,this.onTap),this.observe(GuildRedPoint.ins().postGuildFire,this.updateRedpoint),this.observe(GuildBoss.ins().postGuildBossDetailChange,this.updateRedpoint),Guild.ins().sendMyGuildInfo(),GuildWar.ins().requestGuildRank(),GuildBoss.ins().sendGetBossInfo(),this.updateRedpoint(),GuildRobber.ins().isUpdateRobber&&(GuildRobber.ins().isUpdateRobber=!1,GuildRobber.ins().sendRobberInfo()),this.observe(GuildWar.ins().postGuildWarStarInfo,this.refushGuildwarEffect),this.refushGuildwarEffect(),this.observe(GuildRedPoint.ins().postSendReward,this.updateSendBtnStatu),this.updateSendBtnStatu(),this.observe(GuildRedPoint.ins().postSczb,this.updateGuildPoint),this.updateGuildPoint(),this.observe(GuildRedPoint.ins().postHhdt,this.hhdtRed),this.hhdtRed(),this.observe(GuildRedPoint.ins().postHanghuiBoss,this.updateBossPoint),this.updateBossPoint(),this.observe(Guild.ins().postGuildMembers,this.updateList),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.guildWarEffect2),DisplayUtils.removeFromParent(this.guildRewardEff)},e.prototype.hhdtRed=function(){this.redPoint0.visible=GuildRedPoint.ins().hhdt},e.prototype.updateRedpoint=function(){this.redPoint1.visible=GuildRedPoint.ins().guildFire||GuildRedPoint.ins().liangongRed},e.prototype.updateGuildPoint=function(){this.redPoint2.visible=GuildRedPoint.ins().sczb},e.prototype.updateBossPoint=function(){this.redPoint3.visible=GuildRedPoint.ins().hhBoss},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.ins().getGuildMembers(2))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.practiseBtn:ViewManager.ins().close(e),ViewManager.ins().open(GuildSkillWin);break;case this.manageBtn:ViewManager.ins().close(e),ViewManager.ins().open(GuildWin);break;case this.cityBtn:GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(e),ViewManager.ins().open(GuildWarMainWin);break;case this.shopBtn:ViewManager.ins().open(GuildBossWin);break;case this.chatBtn:ViewManager.ins().open(ChatWin);break;case this.guildRewardEff:ViewManager.ins().open(SelectMemberRewardWin)}},e.prototype.updateSendBtnStatu=function(){GuildRedPoint.ins().sendReward?(this.guildRewardEff.playFile(RES_DIR_EFF+"giftShake",-1),this.reward.addChild(this.guildRewardEff)):DisplayUtils.removeFromParent(this.guildRewardEff)},e.prototype.refushGuildwarEffect=function(){GuildWar.ins().getModel().isWatStart?(this.guildWarEffect2.playFile(RES_DIR_EFF+"swordSparkEff",-1),this.guildWarEffect2.x=28,this.guildWarEffect2.y=30,this.cityBtn.addChild(this.guildWarEffect2)):DisplayUtils.removeFromParent(this.guildWarEffect2)
},e}(BaseEuiView);__reflect(GuildMap.prototype,"GuildMap"),ViewManager.ins().reg(GuildMap,LayerManager.UI_Popup);var GuildMapMemberItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="gongxianitemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var t=this.data;t&&(this.nameLab.text=t.name,this.office.text=GuildLanguage.guildOffice[t.office],this.conLab.text=t.curContribution+"")}},e}(BaseItemRender);__reflect(GuildMapMemberItemRender.prototype,"GuildMapMemberItemRender");var GuildMemberItem1Render=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var t=this.data;t&&(this.nameLab.text=t.name,this.office.text=GuildLanguage.guildOffice[t.office],this.conLab.text=t.contribution+"",this.monthcard.visible=!1,this.vip.removeChildren(),this.vip.visible=t.vipLevel>0,this.vipTitle.visible=t.vipLevel>0,t.vipLevel<10?this.vipNum=BitmapNumber.ins().createNumPic(t.vipLevel,"vip_v"):(this.vipNum=BitmapNumber.ins().createNumPic(1,"vip_v"),this.vipNum0=BitmapNumber.ins().createNumPic(0,"vip_v"),this.vipNum0.x=33,this.vipNum0.y=-1,this.vip.addChild(this.vipNum0)),this.vipNum.x=18,this.vipNum.y=-1,this.vip.addChild(this.vipNum))}},e}(BaseItemRender);__reflect(GuildMemberItem1Render.prototype,"GuildMemberItem1Render");var GuildMemberItem2Render=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberItem2Skin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(e)},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.target instanceof eui.Button||e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.onTap=function(t){if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("工会战期间,不允许禅让/降职/任命副会长/踢出操作",function(){},this);var e=this.data,i=e.roleID;switch(t){case this.impeachBtn:WarnWin.show("是否消耗"+GlobalConfig.GuildConfig.impeachCost+"元宝弹劾会长？（弹劾后成为会长）",function(){Actor.yb>=GlobalConfig.GuildConfig.impeachCost?Guild.ins().sendDemise():UserTips.ins().showTips("元宝不足")},this);break;case this.demiseBtn:WarnWin.show("是否禅让会长职位给["+e.name+"]",function(){Guild.ins().sendChangeOffice(i,GuildOffice.GUILD_BANGZHU)},this);break;case this.downBtn:WarnWin.show("是否免除["+e.name+"]副会长之职",function(){Guild.ins().sendChangeOffice(i,GuildOffice.GUILD_MEMBER)},this);break;case this.kickBtn:WarnWin.show("确定将["+e.name+"]踢出公会？",function(){Guild.ins().sendKick(i)},this);break;case this.appointBtn:WarnWin.show("确定任命["+e.name+"]为副会长？",function(){Guild.ins().canAppointFHZ()?Guild.ins().sendChangeOffice(i,GuildOffice.GUILD_FUBANGZHU):UserTips.ins().showTips("副会长人数已达上限")},this);break;default:ViewManager.ins().open(PlayerTipsWin,this.data)}},e.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var t=this.data;this.nameLab.textFlow=(new egret.HtmlTextParser).parser("["+GuildLanguage.guildOffice[t.office]+"]<font color='#DFDCDC'>"+t.name+"</font>"),this.conLab.text="贡献度："+t.contribution,this.attack.text="战斗力："+t.attack,this.face.source="head_"+t.job+t.sex,this.headBG.source=ChatListItemRenderer.HEAD_BG[t.sex];var e=0,i=Guild.ins().myOffice;switch(i==GuildOffice.GUILD_BANGZHU||i==GuildOffice.GUILD_FUBANGZHU?(this.onLine.visible=!0,t.downTime>0?(e=.001*(GameServer.serverTime-DateUtils.formatMiniDateTime(t.downTime)),this.onLine.textFlow=TextFlowMaker.generateTextFlow1("|C:0xf3311e&T:"+DateUtils.getFormatBySecond(e,7))):this.onLine.textFlow=(new egret.HtmlTextParser).parser("<font color='#13CE0C'>在线</font>")):this.onLine.visible=!1,this.group1.visible=!1,this.group2.visible=!1,this.group3.visible=!1,this.impeachBtn.visible=e>=432e3,this.vip.removeChildren(),this.vip.visible=t.vipLevel>0,this.vipTitle.visible=t.vipLevel>0,t.vipLevel<10?this.vipNum=BitmapNumber.ins().createNumPic(t.vipLevel,"vip_v"):(this.vipNum=BitmapNumber.ins().createNumPic(1,"vip_v"),this.vipNum0=BitmapNumber.ins().createNumPic(0,"vip_v"),this.vipNum0.x=33,this.vipNum0.y=-1,this.vip.addChild(this.vipNum0)),this.vipNum.x=18,this.vipNum.y=-1,this.vip.addChild(this.vipNum),i){case GuildOffice.GUILD_BANGZHU:if(t.office==GuildOffice.GUILD_BANGZHU)break;t.office==GuildOffice.GUILD_FUBANGZHU?this.group2.visible=!0:(this.group3.visible=!0,this.appointBtn.visible=!0);break;case GuildOffice.GUILD_FUBANGZHU:if(t.office==GuildOffice.GUILD_BANGZHU)this.group1.visible=!0;else{if(t.office==GuildOffice.GUILD_FUBANGZHU)break;this.group3.visible=!0,this.appointBtn.visible=!1}break;case GuildOffice.GUILD_ZHANGLAO:case GuildOffice.GUILD_HUFA:case GuildOffice.GUILD_TANGZHU:t.office==GuildOffice.GUILD_BANGZHU&&(this.group1.visible=!0)}}},e}(BaseItemRender);__reflect(GuildMemberItem2Render.prototype,"GuildMemberItem2Render");var GuildMosterPanel=function(t){function e(){var e=t.call(this)||this;return e.bossmc=new MovieClip,e.bossmc.scaleX=-.5,e.bossmc.scaleY=.5,e.bossmc.x=0,e.bossmc.y=0,e.addChild(e.bossmc),e.staticMc=new MovieClip,e.addChild(e.staticMc),e.staticMc.y=-60,e.addTouchEvent(e,e.onTap),e}return __extends(e,t),e.prototype.onTap=function(t){return 1==this.start.robberStart?void UserTips.ins().showTips("|C:0xf3311e&T:正在被挑战中|"):(GuildRobber.ins().sendRobberChanger(this.index),void ViewManager.ins().close(GuildMap))},e.prototype.update=function(t,e,i){this.start=t;var s="";this.bossmc.playFile(RES_DIR_EFF+("monster"+s+"_"+i+"s"),-1),this.index=e+1,this.staticMc.playFile(RES_DIR_EFF+(0==t.robberStart?"ketiaozhan":"zhandouzhong"),-1)},e}(BaseView);__reflect(GuildMosterPanel.prototype,"GuildMosterPanel");var GuildNoticeWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildNoticeSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.saveBtn,this.onTap),this.addTouchEvent(this.bgrect,this.onTap),this.textInput.text=Guild.ins().notice},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.saveBtn,this.onTap),this.removeTouchEvent(this.bgrect,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn1:case this.bgrect:ViewManager.ins().close(this);break;case this.saveBtn:Guild.ins().notice=this.textInput.text,Guild.ins().sendChangeNotice(this.textInput.text),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildNoticeWin.prototype,"GuildNoticeWin"),ViewManager.ins().reg(GuildNoticeWin,LayerManager.UI_Main);var GuildShopPanel=function(t){function e(){var e=t.call(this)||this;return e.isOpenEff=!1,e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="GuildStoreWinSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.guildshopkaiqi,this.onTap),this.addTouchEvent(this.useBtn,this.onTap),this.addTouchEvent(this.guildMore,this.onTap),GuildStore.ins().getGuildStoreInfo(),GuildStore.ins().sendGuildStoreBoxInfo(),this.observe(GuildStore.ins().postGuildStoreInfo,this.onupdateData),this.observe(GuildStore.ins().postGuildStoreBox,this.onItemInfo),this.observe(GuildStore.ins().postGuildStoreBoxInfo,this.onReadInfo),this.onupdateData(),this.guildshopitem_7.visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.guildshopkaiqi,this.onTap),this.removeTouchEvent(this.useBtn,this.onTap),this.removeTouchEvent(this.guildMore,this.onTap),this.removeObserve()},e.prototype.onupdateData=function(){if(GuildStore.ins().guildStoreLv>0){this.guildshopopen.visible=!0,this.guildshopclose.visible=!1,this.guildshopclose.touchEnabled=!1,this.guildshopopen.touchEnabled=!0,GlobalConfig.GuildStoreConfig.needContrib>Guild.ins().myCon?this.guildshoplabel.textFlow=(new egret.HtmlTextParser).parser(Guild.ins().myCon+""):this.guildshoplabel.textFlow=(new egret.HtmlTextParser).parser(Guild.ins().myCon+""),this.guildshopxiaolabel.text=""+GlobalConfig.GuildStoreConfig.needContrib;var t=GlobalConfig.GuildStoreConfig.time[GuildStore.ins().guildStoreLv-1],e=GlobalConfig.GuildStoreConfig.time[GuildStore.ins().guildStoreLv],i="";i=GuildStore.ins().guildStoreNum<=0?"<font color='#f3311e'>"+GuildStore.ins().guildStoreNum+"/"+t+"</font>":GuildStore.ins().guildStoreNum+"/"+t,e?this.guildshopshengyulabel.textFlow=(new egret.HtmlTextParser).parser("本日剩余次数:"+i):this.guildshopshengyulabel.textFlow=(new egret.HtmlTextParser).parser("本日剩余次数:"+i)}else this.guildshopopen.visible=!1,this.guildshopopen.touchEnabled=!1,this.guildshopclose.touchEnabled=!0,this.guildshopclose.visible=!0,this.guildshopkaiqi.textFlow=(new egret.HtmlTextParser).parser("<u>前往提升</u>");for(var s in GlobalConfig.GuildStoreConfig.item)this["guildshopitem_"+s].data=GlobalConfig.GuildStoreConfig.item[s];this.guildMore.textFlow=(new egret.HtmlTextParser).parser("<u>更多记录</u>")},e.prototype.onReadInfo=function(){var t=GuildStore.ins().getRecordInfoAry();if(t.length>0){this.record.visible=!0;var e=GlobalConfig.ItemConfig[t[0].itemId],i=ItemConfig.getQualityColor(e);if(this.record.textFlow=(new egret.HtmlTextParser).parser(t[0].roleName+" 获得了 <font color="+i+">"+e.name+"</font>"),t.length>1){this.record1.visible=!0;var s=GlobalConfig.ItemConfig[t[1].itemId];this.record1.textFlow=(new egret.HtmlTextParser).parser(t[1].roleName+" 获得了 <font color="+i+">"+s.name+"</font>")}if(t.length>2){this.record2.visible=!0;var n=GlobalConfig.ItemConfig[t[2].itemId];this.record2.textFlow=(new egret.HtmlTextParser).parser(t[2].roleName+" 获得了 <font color="+i+">"+n.name+"</font>")}}else this.record.visible=!1,this.record1.visible=!1,this.record2.visible=!1},e.prototype.onItemInfo=function(){this.guildshopitem_7.visible=!0;var t=GuildStore.ins().getGuildStoreItemData(0);this.guildshopitem_7.num=t.num,this.guildshopitem_7.data=t.itemId,this.onupdateData()},e.prototype.startEff=function(){var t=this;this.guildshopitem_7.visible=!1,this.isOpenEff=!0,this.openBoxEff=new MovieClip,this.openBoxEff.x=232,this.openBoxEff.y=287,this.openBoxEff.playFile(RES_DIR_EFF+"kaibaoxiang",1,function(){GuildStore.ins().sendGuildStoreBox(),t.isOpenEff=!1}),this.addChild(this.openBoxEff)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.guildshopkaiqi:ViewManager.ins().open(GuildWin,1);break;case this.useBtn:if(GuildStore.ins().guildStoreNum<=0)return void UserTips.ins().showTips("|C:0xf3311e&T:本日剩余次数为0|");if(GlobalConfig.GuildStoreConfig.needContrib>Guild.ins().myCon)return void UserTips.ins().showTips("|C:0xf3311e&T:贡献度不足|");if(UserBag.ins().getSurplusCount()<=0)return void UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请先清理背包|");0==this.isOpenEff&&this.startEff();break;case this.guildMore:ViewManager.ins().open(GuildShopRecordWin)}},e}(BaseComponent);__reflect(GuildShopPanel.prototype,"GuildShopPanel");var GuildShopRecordItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildStoreItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildStoreRecordInfo){var t=GlobalConfig.ItemConfig[this.data.itemId];t?this.rank.textFlow=(new egret.HtmlTextParser).parser(this.data.roleName+"   获得了   <font color="+ItemConfig.getQualityColor(t)+">"+t.name+"</font>"):this.rank.text=""}},e}(BaseItemRender);__reflect(GuildShopRecordItemRender.prototype,"GuildShopRecordItemRender");var GuildShopRecordWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildStoreInfoSkin",this.list.itemRenderer=GuildShopRecordItemRender,this.arrList=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.arrList.replaceAll(GuildStore.ins().getRecordInfoAry()),this.list.dataProvider=this.arrList},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn1:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildShopRecordWin.prototype,"GuildShopRecordWin"),ViewManager.ins().reg(GuildShopRecordWin,LayerManager.UI_Main);var GuildSkillPanel=function(t){function e(){var e=t.call(this)||this;return e.selectBmpX=[0,34,165,293],e.selectBmpY=[0,239,13,239],e.curRole=0,e.selectIconID=2,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.learnLab.textFlow=(new egret.HtmlTextParser).parser("无法升级技能，请先提升练功房等级  <a href=\"event:\"><font color='#0FEE27'><u>前往提升</u></font></a>")},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||UserTips.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.praBtn,this.onTap),this.addTouchEvent(this.skillBmp1,this.onTap),this.addTouchEvent(this.skillBmp2,this.onTap),this.addTouchEvent(this.skillBmp3,this.onTap),this.learnLab.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.observe(Guild.ins().postGuildSkillInfo,this.update),this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo),this.observe(GameLogic.ins().postSubRoleChange,this.updateRole),this.observe(Guild.ins().postGuildInfo,this.update),this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRedPoint),Guild.ins().sendGuildSkillInfo(),Guild.ins().sendMyGuildInfo(),this.praBtnMc.touchEnabled=!1,this.update()},e.prototype.close=function(){},e.prototype.updateRedPoint=function(){GuildRedPoint.ins().roleSkillTabs[this.curRole]||(GuildRedPoint.ins().roleSkillTabs[this.curRole]={},GuildRedPoint.ins().roleSkillTabs[this.curRole][1]=!1,GuildRedPoint.ins().roleSkillTabs[this.curRole][2]=!1,GuildRedPoint.ins().roleSkillTabs[this.curRole][3]=!1),this.redPoint1.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][1],this.redPoint2.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][2],this.redPoint3.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][3],this.updateMc()},e.prototype.onLink=function(){ViewManager.ins().open(GuildWin,1)},e.prototype.updateRole=function(){Guild.ins().sendGuildSkillInfo()},e.prototype.updateMyInfo=function(){this.praCon.text=""+Guild.ins().myCon},e.prototype.update=function(t){void 0===t&&(t=-1),this.curRole=t>-1?t:this.curRole,this.updateMyInfo(),this.updateRedPoint(),this.selectSkill(this.selectIconID)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.skillBmp1:this.selectSkill(1),this.selectSkillBmp.source="guildskill_1";break;case this.skillBmp2:this.selectSkill(2),this.selectSkillBmp.source="guildskill_2";break;case this.skillBmp3:this.selectSkill(3),this.selectSkillBmp.source="guildskill_3";break;case this.praBtn:this.learnBtnOnClick()}},e.prototype.learnBtnOnClick=function(){var t=Guild.ins().getSkllInfoByIndex(this.curRole);if(!Assert(t.guildSkillInfo[this.selectSkillID-1],"行会技能学习报错 curRole:"+this.curRole+",selectSkillID:"+this.selectSkillID)){var e=t.guildSkillInfo[this.selectSkillID-1].level,i=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1),s=GlobalConfig.GuildCommonSkillConfig[this.selectSkillID].length,n=e>=s?null:this.getCommonSkillDP(this.selectSkillID,e+1);return 0==i||e>=GlobalConfig.GuildConfig.commonSkillLevels[i-1]?void UserTips.ins().showTips("达到上限，请先提升练功房"):n.contribute>Guild.ins().myCon?void UserTips.ins().showTips("贡献不足"):Actor.gold<n.money?void UserTips.ins().showTips("金币不足"):void Guild.ins().sendLearnGuildSkill(this.curRole,this.selectSkillID)}},e.prototype.selectSkill=function(t){this.selectIconID=t,this.selectBmp.x=this.selectBmpX[t],this.selectBmp.y=this.selectBmpY[t],this.selectPraSkill(t)},e.prototype.getTotalPower=function(){for(var t=Guild.ins().getSkllInfoByIndex(this.curRole),e=0,i=1;4>i;i++){var s=t.guildSkillInfo[this.selectSkillID-1].level;if(s>0){var n=this.getCommonSkillDP(i,s);e+=UserBag.getAttrPower(n.attrs)}}return e},e.prototype.selectPraSkill=function(t){this.praGroup.visible=!0,this.selectSkillID=t,this.selectSkillType=1;var e=Guild.ins().getSkllInfoByIndex(this.curRole);if(e){var i=e.guildSkillInfo[this.selectSkillID-1].level,s=this.getCommonSkillDP(this.selectSkillID,i),n=this.getCommonSkillLength(this.selectSkillID),o=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1);if(this.praCurBase.textColor=0==i?7526155:14605776,this.praCurBase.text=0==i?"未学习":AttributeData.getAttStr(s.attrs,0,1,"：",!0),this.praName.text=GlobalConfig.GuildConfig.commonSkillNames[this.selectSkillID-1],this.learnLab.visible=1>o||i>=GlobalConfig.GuildConfig.commonSkillLevels[o-1],this.praBtn.visible=!this.learnLab.visible,n>i){var a=this.getCommonSkillDP(this.selectSkillID,i+1);this.praNextLab.text=AttributeData.getAttStr(a.attrs,0,1,"：",!0);var r=Guild.ins().myCon>=a.contribute?"DEDDD0":"f3311e",h="<font color='#"+r+"'>"+a.contribute+"</font>";this.praCost.textFlow=(new egret.HtmlTextParser).parser(h),this.praCost0.text=a.money+"",this.praCost0.textColor=Actor.gold>=a.money?14605776:15937822,this.updateMc()}else this.praNextLab.text="已满级",this.praCost.text="0",this.praCost0.text="0",this.praCost0.textColor=14605776,DisplayUtils.removeFromParent(this.mc);this.lvTxt.text="等级"+i}},e.prototype.updateMc=function(){return!GuildRedPoint.ins().roleSkillTabs[this.curRole][this.selectSkillID]||this.learnLab.visible?void DisplayUtils.removeFromParent(this.mc):(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.mc.x=this.praBtnMc.width/2,this.mc.y=this.praBtnMc.height/2,this.praBtnMc.addChild(this.mc)),void this.mc.playFile(RES_DIR_EFF+"chargeff1",-1))},e.prototype.getCommonSkillDP=function(t,e){var i=GlobalConfig.GuildCommonSkillConfig[t];if(0==e)return i[1];for(var s in i){var n=i[s];if(n.level==e)return n}return null},e.prototype.getCommonSkillLength=function(t){var e=GlobalConfig.GuildCommonSkillConfig[t],i=0;for(var s in e)i++;return i},e}(BaseComponent);__reflect(GuildSkillPanel.prototype,"GuildSkillPanel");var GuildSkillShopWin=function(){function t(){}return t}();__reflect(GuildSkillShopWin.prototype,"GuildSkillShopWin");var GuildSkillWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildSkillSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(GuildRedPoint.ins().postGuildFire,this.updateRed),this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRoleRedPoint),this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRed),this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,this.addChangeEvent(this.roleSelect,this.update),this.viewStack.getElementAt(this.lastSelect).open(),this.guildskill.curRole=this.roleSelect.getCurRole(),this.updateRed(),this.updateRoleRedPoint()},e.prototype.setSelectedIndex=function(t){this.selectedIndex(this.viewStack.selectedIndex)},e.prototype.selectedIndex=function(t){void 0!=this.lastSelect&&this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=t,this.viewStack.getElementAt(this.lastSelect).open(),0==this.lastSelect?this.roleSelect.openRole():this.roleSelect.hideRole()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.guildskill.close(),this.guildcampfire.close(),ViewManager.ins().open(GuildMap)},e.prototype.update=function(){this.guildskill&&this.guildskill.update(this.roleSelect.getCurRole())},e.prototype.updateRed=function(){this.redPoint1.visible=GuildRedPoint.ins().guildFire,this.redPoint0.visible=GuildRedPoint.ins().liangongRed},e.prototype.updateRoleRedPoint=function(){for(var t=[!1,!1,!1],e=0;e<t.length;e++)this.roleSelect.showRedPoint(e,t[e]);for(var e=0;1>e;e++)if(GuildRedPoint.ins().roleTabs[e])for(var i=0;i<SubRoles.ins().subRolesLen;i++)this.roleSelect.showRedPoint(i,GuildRedPoint.ins().roleTabs[e][i])},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Guild.ins().getSkllInfoByIndex(0)||Guild.ins().fireDic?!0:(UserTips.ins().showTips("网络不佳，请稍后"),!1)},e}(BaseEuiView);__reflect(GuildSkillWin.prototype,"GuildSkillWin"),ViewManager.ins().reg(GuildSkillWin,LayerManager.UI_Main);var GuildTaskItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildTaskItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){switch(t){case this.conBtn:case this.goBtn:this.conBtnOnCLick()}},e.prototype.conBtnOnCLick=function(){var t=this.data;switch(t.stdTask.type){case 31:t.param>=t.stdTask.target?UserTips.ins().showTips("本日捐献次数已满"):Actor.yb>=t.stdTask.param?Guild.ins().sendCon(t.stdTask.conID):UserTips.ins().showTips("元宝不足");break;case 32:t.param>=t.stdTask.target?UserTips.ins().showTips("本日捐献次数已满"):Actor.gold>=t.stdTask.param?Guild.ins().sendCon(t.stdTask.conID):UserWarn.ins().setBuyGoodsWarn(1);break;case 33:t.param>=t.stdTask.target?UserTips.ins().showTips("本日捐献次数已满"):UserBag.ins().getBagGoodsCountById(0,t.stdTask.param)>=1?Guild.ins().sendCon(t.stdTask.conID):UserTips.ins().showTips("道具不足");break;default:GameGuider.guidance(t.stdTask.controlTarget[0],t.stdTask.controlTarget[1])}},e.prototype.goBtnOnClick=function(){var t=this.data;switch(t.state){case 0:GameGuider.guidance(t.stdTask.controlTarget[0],t.stdTask.controlTarget[1]);break;case 1:Guild.ins().sendGetTaskAward(t.taskID);break;case 2:}},e.prototype.dataChanged=function(){if(this.data instanceof GuildTaskInfo){var t=this.data;if(t)if(this.taskIcon.source="guildtask_"+t.taskID,this.nameLab.text=t.stdTask.name,this.descLab.text=t.stdTask.desc,this.conGroup.visible=!0,this.getGroup.visible=!1,this.numLab.text=t.param+"/"+t.stdTask.target,this.conBtn.enabled=t.param<t.stdTask.target,t.param<t.stdTask.target)switch(t.stdTask.type){case 31:case 32:case 33:this.conBtn.label="捐 献";break;default:this.conBtn.label="前 往"}else this.conBtn.label="完 成"}},e}(BaseItemRender);__reflect(GuildTaskItemRender.prototype,"GuildTaskItemRender");var GuildWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBgSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.tab.dataProvider=this.viewStack},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||UserTips.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&t.length>0?this.lastSelect=t[0]:this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(GuildRedPoint.ins().postGldt,this.updateRedPoint),Guild.ins().sendMyGuildInfo(),Guild.ins().sendGuildMembers(),this.updateRedPoint(),this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.viewStack.getElementAt(this.lastSelect).close(),ViewManager.ins().open(GuildMap)},e.prototype.onTap=function(t){t.currentTarget},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.updateRedPoint=function(){this.redPoint1.visible=GuildRedPoint.ins().gldt},e}(BaseEuiView);__reflect(GuildWin.prototype,"GuildWin"),ViewManager.ins().reg(GuildWin,LayerManager.UI_Main);var DailyAwardPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DailyAwardSkin",this.isTopLevel=!0,this.list.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.list.dataProvider=new eui.ArrayCollection(GlobalConfig.GuildBattleDayAward[GuildWar.ins().getModel().rewardDay].award),GuildWar.ins().getModel().getDayReward?(this.sure.label="已领取",this.sure.enabled=!1):(this.sure.label="领取",this.sure.enabled=!0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn1:ViewManager.ins().close(e);break;case this.sure:if(GuildWar.ins().getModel().getDayReward)return void UserTips.ins().showTips("|C:0xf3311e&T:已领取奖励，无法再次领取|");if(!GuildWar.ins().getModel().canGetDay)return void UserTips.ins().showTips("|C:0xf3311e&T:龙城占领公会才能领取每日奖励|");GuildWar.ins().requestDayReward(GuildWar.ins().getModel().rewardDay),ViewManager.ins().close(e);break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DailyAwardPanel.prototype,"DailyAwardPanel"),ViewManager.ins().reg(DailyAwardPanel,LayerManager.UI_Main);var DailypresidentAwardPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DailypresidentAwardSkin",this.list.itemRenderer=ItemBase,this.dataArr=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap);var i=GlobalConfig.GuildBattleConst.occupationAward;this.dataArr.source=i,this.list.dataProvider=this.dataArr},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DailypresidentAwardPanel.prototype,"DailypresidentAwardPanel"),ViewManager.ins().reg(DailypresidentAwardPanel,LayerManager.UI_Main);var GuildWarMainWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.redEff=new MovieClip,this.enterEff=new MovieClip,this.titleEff=new MovieClip,this.skinName="GuildWarMainSkin",this.roleEff=new MovieClip,this.player.addChild(this.roleEff)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.practiseBtn,this.onTap),this.addTouchEvent(this.redBag,this.onTap),this.addTouchEvent(this.play,this.onTap),this.addTouchEvent(this.practiseBtn2,this.onTap),this.addTouchEvent(this.practiseBtn0,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.practiseBtn1,this.onTap),this.observe(GuildWar.ins().postDayRewardInfo,this.refushRewardStatu),this.observe(GuildWar.ins().postGuildRedPointChange,this.refushRewardStatu),this.observe(GuildWar.ins().postJoinPlayBack,this.refushStartEffect),this.practiseBtn1.visible=GuildWar.ins().getModel().guildRankList.length>0&&!GuildWar.ins().getModel().isWatStart,this.refushPanelInfo(),this.refushStartEffect(),this.refushTitleEffect(),this.observe(GuildRedPoint.ins().postRedBag,this.updateRedBag),this.observe(GuildRedPoint.ins().postDayReward,this.updateRedBag),this.updateRedBag()},e.prototype.updateRedBag=function(){this.redBag.visible=GuildRedPoint.ins().redBag,this.redPoint0.visible=GuildRedPoint.ins().dayReward},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().open(GuildMap)},e.prototype.refushPanelInfo=function(){GuildWar.ins().getModel().isWatStart?this.openDesc.text="":this.openDesc.text=GuildWar.ins().getModel().setOpenDesc(),this.refushRewardStatu(),this.refushWinGuild()},e.prototype.refushStartEffect=function(){GuildWar.ins().getModel().isWatStart?(this.enterEff.playFile(RES_DIR_EFF+"chargeff1",-1),this.enterEff.x=this.play.width>>1,this.enterEff.y=this.play.height>>1,this.play.addChild(this.enterEff)):DisplayUtils.removeFromParent(this.enterEff)},e.prototype.refushTitleEffect=function(){this.titleEff.playFile(RES_DIR_EFF+"chenghaolcbz",-1),this.titleGroup.addChild(this.titleEff)},e.prototype.refushRewardStatu=function(){GuildWar.ins().getModel().canSend||GuildWar.ins().getModel().canRod?(this.redEff.playFile(RES_DIR_EFF+"actIconCircle",-1),this.redEff.x=this.redEff.y=28,this.redBag.addChild(this.redEff)):DisplayUtils.removeFromParent(this.redEff)},e.prototype.refushWinGuild=function(){var t=GuildWar.ins().getModel().winGuildInfo.guildId>0;if(this.guildOwn.visible=t,this.guildName.visible=t,this.roleEff.visible=t,this.none.visible=!t,t){var e=GuildWar.ins().getModel().winGuildInfo;this.guildName.text=e.guildName,this.guildOwn.text=e.guildOwnName;var i=1==e.guildOwnSex?"junzhunv":"junzhunan";this.roleEff.playFile(RES_DIR_EFF+i,-1)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.practiseBtn:ViewManager.ins().open(GuildWarRewardWin);break;case this.redBag:GuildWar.ins().getModel().canRod||GuildWar.ins().getModel().canSend?ViewManager.ins().open(RedBagWin):ViewManager.ins().open(RedBagDetailsWin);break;case this.play:if(!GuildWar.ins().getModel().isWatStart)return void UserTips.ins().showTips("|C:0xf3311e&T:活动未开启|");ViewManager.ins().close(GuildMap),ViewManager.ins().close(e),GuildWar.ins().requestJoinAc();break;case this.practiseBtn0:ViewManager.ins().open(DailypresidentAwardPanel);break;case this.practiseBtn2:ViewManager.ins().open(DailyAwardPanel);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,8);break;case this.practiseBtn1:ViewManager.ins().open(GuildWarRewardWin,0,1)}},e}(BaseEuiView);__reflect(GuildWarMainWin.prototype,"GuildWarMainWin"),ViewManager.ins().reg(GuildWarMainWin,LayerManager.UI_Main);var GuildWarMemWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildWarMemSkin",this.list.itemRenderer=GuildWarMemListRenderer,this.data=new eui.ArrayCollection,this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.dataProvider=this.data,this.observe(GuildWar.ins().postMyRankChange,this.refushList),GuildWar.ins().requestOwnMyGuildRank(),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeObserve()},e.prototype.refushList=function(){this.data.replaceAll(GuildWar.ins().getModel().myRankList)},e.prototype.onTap=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(GuildWarMemWin.prototype,"GuildWarMemWin"),ViewManager.ins().reg(GuildWarMemWin,LayerManager.UI_Popup);
var GuildWarResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="GuildWarResultSkin",this.closeBtn.label="确定",this.list1.itemRenderer=ItemBase,this.list2.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.guildName.text=""==t[0]?"虚位以待":t[0],this.myPoint.text=t[1]+"",this.guildPoint.text=""+t[2],this.guildRank.text="第"+t[3]+"名",this.myRank.text=t[4]>0?"第"+t[4]+"名":"未上榜";var i=GuildWar.ins().getModel().getRewardByPoint(t[1]),s=GuildWar.ins().getModel().getMyPointRankReward(t[4]);this.list1.dataProvider=new eui.ArrayCollection(s.concat(i)),this.list2.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().creatGuildRankReward(t[3])),this.s=10,this.addTouchEvent(this.closeBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap)},e.prototype.onTap=function(){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(GuildWarResultWin.prototype,"GuildWarResultWin"),ViewManager.ins().reg(GuildWarResultWin,LayerManager.UI_Popup);var GuildWarRewardWin=function(t){function e(){var e=t.call(this)||this;return e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildWarRewardSkin",this.isTopLevel=!0},e.prototype.addPanelList=function(){this.guildInteRankInfo=new GuildInteRankInfo,this.viewStack.addChild(this.guildInteRankInfo),this.personalInteRankInfo=new PersonalInteRankInfo,this.viewStack.addChild(this.personalInteRankInfo),this.guildInteRewardInfo=new GuildInteRewardInfo,this.viewStack.addChild(this.guildInteRewardInfo),this.personInteRewardInfo=new PersonInteRewardInfo,this.viewStack.addChild(this.personInteRewardInfo),this.cruPanel=this.viewStack.getChildAt(0),this.tab.dataProvider=this.viewStack},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&t[1]&&(this.type=t[1]),this.addPanelList(),t&&t[0]?this.viewStack.selectedIndex=t[0]:this.viewStack.selectedIndex=0,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.tab,this.onTabTouch),this.cruPanel.open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.cruPanel.close(),this.viewStack.removeChildren(),this.type=0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e.prototype.onTabTouch=function(t){this.cruPanel&&this.cruPanel.close(),this.cruPanel=this.viewStack.selectedChild,this.cruPanel.open()},e}(BaseEuiView);__reflect(GuildWarRewardWin.prototype,"GuildWarRewardWin"),ViewManager.ins().reg(GuildWarRewardWin,LayerManager.UI_Main);var GuildWarRulesWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RuleTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bigBg,this.onTap),this.addTouchEvent(this.bg,this.onTap),this.addTouchEvent(this.attr,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.cruIndex=GuildWar.ins().getModel().getMapLevelInfo().id,this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bigBg,this.onTap),this.removeTouchEvent(this.bg,this.onTap),this.removeTouchEvent(this.attr,this.onTap),this.removeTouchEvent(this.leftBtn,this.onTap),this.removeTouchEvent(this.rightBtn,this.onTap)},e.prototype.refushInfo=function(){var t=GlobalConfig.GuildBattleLevel,e=t[this.cruIndex];this.mapName.text=e.name,this.attr.textFlow=TextFlowMaker.generateTextFlow(e.help),this.rightBtn.visible=this.cruIndex<4,this.leftBtn.visible=this.cruIndex>1},e.prototype.onTap=function(t){switch(t.currentTarget){case this.leftBtn:--this.cruIndex,this.refushInfo();break;case this.rightBtn:++this.cruIndex,this.refushInfo();break;case this.bigBg:ViewManager.ins().close(e);break;default:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuildWarRulesWin.prototype,"GuildWarRulesWin"),ViewManager.ins().reg(GuildWarRulesWin,LayerManager.UI_Main);var GuildwarTipsPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GameTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap)},e.prototype.onTap=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(GuildwarTipsPanel.prototype,"GuildwarTipsPanel"),ViewManager.ins().reg(GuildwarTipsPanel,LayerManager.UI_Main);var GuildWarUiInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildWarUiSkin",this.clickEffc=new MovieClip,this.pointEff=new MovieClip,this.pointEff.x=61,this.pointEff.y=34,this.list1.itemRenderer=GuildWarMemberHeadRender,this.list2.itemRenderer=GuildWarMemberHeadRender,this.sceneBar.maximum=300,this.sceneBar.labelFunction=function(){return""},this.bloodBar1.slideDuration=0,this.bloodBar.labelDisplay.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.Nextchengnei,this.onTap),this.addTouchEvent(this.Nextchengnei0,this.onTap),this.addTouchEvent(this.Nextdianqian,this.onTap),this.addTouchEvent(this.Nexthuanggong,this.onTap),this.observe(GameLogic.ins().postEnterMap,this.refushShowInfo),this.observe(GuildWar.ins().postPointUpdate,this.refushPoint),this.observe(GuildWar.ins().postPointRewardChange,this.refushPointReward),this.addTouchEvent(this.seeRank,this.onTap),this.observe(GuildWar.ins().postCityownChange,this.cityOwnChange),this.addTouchEvent(this.seeMyGuild,this.onTap),this.observe(GuildWar.ins().postWeixieChange,this.refushWeixieList),this.observe(GuildWar.ins().postCanplayChange,this.refushcanPlayList),this.addTouchEvent(this.list1,this.listTap),this.addTouchEvent(this.list2,this.listTap),this.addTouchEvent(this.btn,this.onTap),this.addTouchEvent(this.palaceFlag,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.mon,this.onTap),this.addTouchEvent(this.guid2,this.onTap),this.addTouchEvent(this.taskTraceBtn,this.onTap),this.observe(GuildWar.ins().postFlagInfoChange,this.refushFlagStatu),this.observe(GuildWar.ins().postHudunInfo,this.hudunChange),this.observe(GuildWar.ins().postRankListChange,this.rankListChange),this.observe(GuildWar.ins().postGuildNumChange,this.refushGuildNum),this.observe(GuildWar.ins().postJoinPlayBack,this.doorStatuChange),this.observe(GuildWar.ins().postKillHuman,this.showSkill),this.observe(GameLogic.ins().postEntityHpChange,this.updateHP),this.observe(GameLogic.ins().postChangeTarget,this.updateTarget),this.addTouchEvent(this.ruleDesc,this.onTap),this.belongGroup.visible=!1,this.ruleDesc.textFlow=(new egret.HtmlTextParser).parser("<u>玩法说明</u>"),this.refushShowInfo(),this.refushPoint(),this.cityOwnChange(),this.refushWeixieList(),this.refushcanPlayList(),this.rankListChange(),this.doorStatuChange(),this.refushFlagStatu(),this.refushGuildNum()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().isShow(GuileWarReliveWin)&&ViewManager.ins().close(GuileWarReliveWin),ViewManager.ins().isShow(TargetPlayerBigBloodPanel)&&ViewManager.ins().close(TargetPlayerBigBloodPanel),this.currAttackHandle=0,TimerManager.ins().removeAll(this),DisplayUtils.removeFromParent(this.clickEffc),DisplayUtils.removeFromParent(this.pointEff),this.clearRendererItem()},e.prototype.refushShowInfo=function(){var t=this;this.gongxun.visible=GuildWar.ins().getModel().checkinAppoint(2),this.mon.visible=GuildWar.ins().getModel().checkinAppoint(2),this.bar1.y=this.mon.visible?99:30,this.flagGroup.visible=GuildWar.ins().getModel().checkinAppoint(4),this.flag.visible=GuildWar.ins().getModel().checkinAppoint(4),this.flag.y=103,this.scene.text=GuildWar.ins().getModel().getNextMapName(0),this.guid.visible=GuildWar.ins().getModel().checkinAppoint(2)&&GuildWar.ins().getModel().getIntoNextMapGongxun()>GuildWar.ins().getModel().gongXun,this.guid.visible?(this.clickEffc.playFile(RES_DIR_EFF+"tapCircle"),this.clickEffc.x=this.guid.x-23,this.clickEffc.y=this.guid.y+this.guid.height/2-5,this.addChild(this.clickEffc)):DisplayUtils.removeFromParent(this.clickEffc);var e=GuildWar.ins().getModel().getMapLevelInfo();this.sceneBar.value=100*(e.id-1),this.weijihuo1.visible=!(e.id>=1),this.jihuo1.visible=e.id>=1,this.weijihuo2.visible=!(e.id>=2),this.jihuo2.visible=e.id>=2,this.weijihuo3.visible=!(e.id>=3),this.jihuo3.visible=e.id>=3,this.hgweijihuo.visible=!(e.id>=4),this.hgjh.visible=e.id>=4,this.Nextdianqian.visible=!1,this.Nextchengnei.visible=1==e.id,this.Nexthuanggong.visible=3==e.id,this.Nextchengnei0.visible=3==e.id,4==e.id&&(this.Nextdianqian.visible=!0),this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4),TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().acEndTime,function(){t.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4)},this)},e.prototype.refushGuildNum=function(){this.comNum.text=GuildWar.ins().getModel().guildNum+"人"},e.prototype.refushPoint=function(){this.guildPoint.text=GuildWar.ins().getModel().guildPoint+"",this.ownPoint.text=GuildWar.ins().getModel().ownPoint+"",this.point.text=GuildWar.ins().getModel().gongXun+"/"+GuildWar.ins().getModel().getIntoNextMapGongxun();var t=GuildWar.ins().getModel().getMapLevelInfo();GuildWar.ins().getModel().gongXun>=GuildWar.ins().getModel().getIntoNextMapGongxun()?2==t.id&&(this.Nextdianqian.visible=!0,this.point.visible=!1,this.gongxun.visible=!1):4!=t.id&&(this.Nextdianqian.visible=!1,this.point.visible=!0),this.refushPointReward(),this.doorStatuChange()},e.prototype.refushPointReward=function(){var t=GuildWar.ins().getModel().getMyPointReward();if(t){this.taskTraceName0.y=16;var e="积分目标：\r"+GuildWar.ins().getModel().ownPoint+"/"+t.integral;e+=GuildWar.ins().getModel().pointInfo.isCan?StringUtils.addColor("(完成)","#35e62d"):"",this.taskTraceName0.textFlow=(new egret.HtmlTextParser).parser(e);t.award[0];GuildWar.ins().getModel().pointInfo.isCan?(this.taskTraceBtn.visible=!0,this.pointEff.playFile(RES_DIR_EFF+"actIconCircle",-1),this.taskTraceBtn.addChild(this.pointEff)):DisplayUtils.removeFromParent(this.pointEff)}else this.taskTraceAwards0.visible=!1,DisplayUtils.removeFromParent(this.pointEff),this.taskTraceBtn.visible=!1;this.scorePoint.visible=this.pointEff.parent?!0:!1},e.prototype.cityOwnChange=function(){this.guildName.text=""==GuildWar.ins().getModel().cityOwn?"虚位以待":GuildWar.ins().getModel().cityOwn},e.prototype.refushWeixieList=function(t){void 0===t&&(t=0),this.list2.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().weixieList),1==t&&this.refushcanPlayList(),this.weixie.visible=GuildWar.ins().getModel().checkinAppoint(2,!0)&&GuildWar.ins().getModel().weixieList.length>0},e.prototype.refushcanPlayList=function(t){t=t||GuildWar.ins().getModel().canPlayList,this.list1.dataProvider=new eui.ArrayCollection(t),this.attList.visible=GuildWar.ins().getModel().checkinAppoint(2,!0)&&(t.length>0||this.mon.visible)},e.prototype.doorStatuChange=function(){this.Nextchengnei.enabled=GuildWar.ins().getModel().doorDie},e.prototype.rankListChange=function(){for(var t,e=GuildWar.ins().getModel().rankList,i=0;3>i;i++)t=e[i],t?(this["rankName"+(i+1)].text=t.name,this["rankPoint"+(i+1)].text=t.point+""):(this["rankName"+(i+1)].text="暂无",this["rankPoint"+(i+1)].text="0")},e.prototype.refushFlagStatu=function(){if(TimerManager.ins().remove(this.runTime,this),this.hudun1.visible=!1,0==GuildWar.ins().getModel().flagStatu?(this.clearTimeBar(),this.runTime(),TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().endTime,this.runTime,this)):1==GuildWar.ins().getModel().flagStatu?(this.clearTimeBar(),this.timeDesc.text="当前皇旗可采集"):(this.runTime(),this.bloodBar.maximum=GlobalConfig.GuildBattleConst.gatherTime,TimerManager.ins().doTimer(1e3,GuildWar.ins().getModel().endTime,this.runTime,this),this.hudun1.visible=!0),this.palaceFlag.enabled=1==GuildWar.ins().getModel().flagStatu,this.flagStatu.visible=2==GuildWar.ins().getModel().flagStatu&&!this.flagGroup.visible,this.flagStatu.visible){var t=egret.Tween.get(this.flagStatu);this.flagStatu.x=480,t.to({x:106},500).call(function(){},this)}},e.prototype.clearTimeBar=function(){this.bloodBar.maximum=0,this.bloodBar.value=0,this.bloodBar.labelFunction=function(){return""}},e.prototype.hudunChange=function(t){this.hudun.maximum=t[1],this.hudun.value=t[0],this.hudun.labelFunction=function(){return Math.ceil(100*t[0]/t[1])+"%"}},e.prototype.runTime=function(){if(--GuildWar.ins().getModel().endTime,GuildWar.ins().getModel().endTime>=0)if(2!=GuildWar.ins().getModel().flagStatu)this.timeDesc.text=Math.floor(GuildWar.ins().getModel().endTime/60)+"分"+GuildWar.ins().getModel().endTime%60+"秒后可采集";else if(this.timeDesc.text=GuildWar.ins().getModel().flagName+" 采集中.....",this.bloodBar.value=GuildWar.ins().getModel().endTime,this.bloodBar.labelFunction=function(){return"采集成功剩余时间："+Math.floor(GuildWar.ins().getModel().endTime/60)+"分"+GuildWar.ins().getModel().endTime%60+"秒"},this.flagStatu.visible){var t="<font color = '#FFB82A'>"+GuildWar.ins().getModel().flagName+"</font>采集皇旗中（<font color = '#35e62d'>"+Math.floor(GuildWar.ins().getModel().endTime/60)+"分"+GuildWar.ins().getModel().endTime%60+"</font>秒）";this.flagTime.textFlow=(new egret.HtmlTextParser).parser(t),this.guildName1.text="公会："+GuildWar.ins().getModel().flagGuild}GuildWar.ins().getModel().endTime<=0&&TimerManager.ins().remove(this.runTime,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.Nextchengnei:case this.Nextchengnei0:case this.Nextdianqian:case this.Nexthuanggong:if(""!=GuildWar.ins().getModel().killName)return void UserTips.ins().showTips("|C:0xf3311e&T:复活状态，不能切换地图|");if(GuildWar.ins().getModel().getIntoNextMapGongxun()>GuildWar.ins().getModel().gongXun)return void UserTips.ins().showTips("|C:0xf3311e&T:战功不满足条件，不能进入下一层|");if(!GuildWar.ins().getModel().doorDie)return void UserTips.ins().showTips("|C:0xf3311e&T:击破城门后可进入下一关|");var e=1;t.currentTarget==this.Nextchengnei||t.currentTarget==this.Nextchengnei0?e=2:t.currentTarget==this.Nextdianqian?e=3:t.currentTarget==this.Nexthuanggong&&(e=4),ViewManager.ins().open(GuileWarReliveWin,1,e);break;case this.seeRank:ViewManager.ins().open(GuildWarRewardWin);break;case this.seeMyGuild:ViewManager.ins().open(GuildWarMemWin);break;case this.btn:"down"==this.btn.currentState?this.refushcanPlayList([]):this.refushcanPlayList();break;case this.palaceFlag:0!=GuildWar.ins().getModel().flagStatu?GuildWar.ins().requestStartGetFlag():UserTips.ins().showTips("|C:0xf3311e&T:皇旗当前不可采集|");break;case this.mon:this.clickEffc.playFile(RES_DIR_EFF+"tapCircle",1),this.addChild(this.clickEffc),GameLogic.ins().postChangeAttrPoint(0),this.guid.visible=!1;break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,7);break;case this.taskTraceBtn:GuildWar.ins().getModel().pointInfo.isCan&&GuildWar.ins().sendPointReward();break;case this.guid2:ViewManager.ins().open(GuildwarTipsPanel)}},e.prototype.listTap=function(t){if(t.target.parent instanceof GuildWarMemberHeadRender){var e=t.target.parent;if(e.showEffect(),!GuildWar.ins().getModel().canClick)return;if(GuildWar.ins().getModel().flagAcId==Actor.actorID)return void WarnWin.show("采集中攻击玩家会导致采集<font color='#FFB82A'>进度归0</font>，确定要攻击玩家嘛？",function(){GameLogic.ins().postChangeAttrPoint(e.data),EntityShowMgr.ins().showHideSomeOne(e.data)},this);GameLogic.ins().postChangeAttrPoint(e.data),this.guid.visible&&DisplayUtils.removeFromParent(this.clickEffc),this.guid.visible=!1,GuildWar.ins().getModel().attHandle!=e.data&&EntityShowMgr.ins().showHideSomeOne(e.data)}},e.prototype.clearRendererItem=function(){for(var t=this.list1.numChildren,e=0;t>e;e++){var i=this.list1.getChildAt(e);i.clearEffect()}t=this.list2.numChildren;for(var e=0;t>e;e++){var i=this.list2.getChildAt(e);i.clearEffect()}},e.prototype.showSkill=function(t){if(!t)return egret.Tween.removeTweens(this.lzlabel),egret.Tween.removeTweens(this.skillGroup),void(this.skillGroup.visible=!1);this.skillGroup.visible&&(egret.Tween.removeTweens(this.lzlabel),egret.Tween.removeTweens(this.skillGroup)),this.skillGroup.visible=!0,this.skillGroup.alpha=1,this.lzlabel.scaleX=this.lzlabel.scaleY=1,this.lzlabel.text=t+"";var e=this;egret.Tween.get(this.lzlabel).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(e.skillGroup).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(e.lzlabel),egret.Tween.removeTweens(e.skillGroup),e.skillGroup.visible=!1})})},e.prototype.updateTarget=function(){var t=GuildWar.ins().getModel().getMapLevelInfo();if(1==t.id?this.belongGroup.visible=!1:this.belongGroup.visible=!0,0==GameLogic.ins().currAttackHandle&&(this.belongGroup.visible=!1),0!=GameLogic.ins().currAttackHandle&&this.currAttackHandle!=GameLogic.ins().currAttackHandle){this.currAttackHandle=GameLogic.ins().currAttackHandle;var e=void 0,i=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(i&&i.length>0){e=i[0].infoModel;var s=e.name,n=s.split("\n");s=n[1]?n[1]:n[0],this.belongNameTxt0.textFlow=TextFlowMaker.generateTextFlow(s),this.roleHead0.source="yuanhead"+e.job+e.sex,this.changeHp()}}this.belongGroup.visible&&this.changeHp()},e.prototype.updateHP=function(t){var e=t[0];t[1],t[2],t[3];e&&e.infoModel.masterHandle==this.currAttackHandle&&this.changeHp()},e.prototype.changeHp=function(){var t=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(t&&t.length>0){for(var e=t.length,i=0,s=0,n=0,o=0,a=0;e>a;a++){var r=t[a];if(r){var h=r.infoModel.getAtt(AttributeType.atHp)||0,l=r.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=h,s+=l;var c=r.infoModel.getAtt(AttributeType.cruNeiGong)||0,u=r.infoModel.getAtt(AttributeType.maxNeiGong)||0;n+=c,o+=u}}this.neigongBar1.maximum=o,this.neigongBar1.value=n,this.bloodBar1.maximum=s,this.bloodBar1.value=i,0>=i&&(this.belongGroup.visible=!1)}},e}(BaseEuiView);__reflect(GuildWarUiInfo.prototype,"GuildWarUiInfo"),ViewManager.ins().reg(GuildWarUiInfo,LayerManager.UI_Main);var GuileWarReliveWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SwitchCDSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(this.type=t[0],this.sceneIndex=t[1],this.type){case 1:this.currentState="switch",this.defaultStr="秒后自动切换区域",this.s=GuildWar.ins().getModel().getCdByType(this.type);break;case 2:this.currentState="revive",this.defaultStr="秒后在龙城城门复活",this.s=t[1];break;case 3:this.currentState="exit",this.defaultStr="秒后自动退出活动",this.s=GuildWar.ins().getModel().getCdByType(this.type)}this.addTouchEvent(this.closeBtn,this.onTap),this.timeDown.text=""+this.s+this.defaultStr,TimerManager.ins().remove(this.updateCloseBtnLabel,this),TimerManager.ins().doTimer(1e3,this.s,this.updateCloseBtnLabel,this),this.refushMapInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),TimerManager.ins().remove(this.updateCloseBtnLabel,this),1!=this.type&&(GuildWar.ins().getModel().killName="")},e.prototype.refushMapInfo=function(){1==this.type?this.mapName.text=GuildWar.ins().getModel().getNextMapName(this.sceneIndex):2==this.type&&(this.killName.text="你被 "+GuildWar.ins().getModel().killName+" 玩家击败！",this.guildName.text="所属公会："+GuildWar.ins().getModel().killGuild+" ")},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&(1==this.type&&GuildWar.ins().requestPlayNextMap(this.sceneIndex),3==this.type&&UserFb.ins().sendExitFb(),ViewManager.ins().close(e)),this.timeDown.text=""+this.s+this.defaultStr},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuileWarReliveWin.prototype,"GuileWarReliveWin"),ViewManager.ins().reg(GuileWarReliveWin,LayerManager.UI_Main);var GuildInteRankInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRankSkin",e.name="公会排行",e.list.itemRenderer=GuildInteRankItemRenderer,e.data=new eui.ArrayCollection([]),e.model=GuildWar.ins().getModel(),e.lastName.text=e.model.isWatStart?"本届排行":"上届排行",e.lastNameJie.text=e.model.isWatStart?"本届攻城结果":"上届攻城结果",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.dataProvider=this.data,this.observe(GuildWar.ins().postRankInfo,this.refushList),GuildWar.ins().requestGuildRank()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.refushList=function(){this.data.replaceAll(this.model.guildRankList),this.model.guildRankList.length>0?this.guildName.text=this.model.guildRankList[0].guildName:this.guildName.text="虚位以待"},e}(BaseView);__reflect(GuildInteRankInfo.prototype,"GuildInteRankInfo");var GuildInteRewardInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRewardSkin",e.name="公会奖励",e.dataArr=new eui.ArrayCollection,e.dataArr1=new eui.ArrayCollection,e.itemList.itemRenderer=ItemBase,e.list1.itemRenderer=GuildInteRewardItemRenderer,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GuildWar.ins().getModel().creatGuildRewardList();this.dataArr1.source=i,this.list1.dataProvider=this.dataArr1;var s=GlobalConfig.GuildBattleConst.occupationAward;this.dataArr.source=s,this.itemList.dataProvider=this.dataArr},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataArr.source=null,this.dataArr1.source=null},e}(BaseView);__reflect(GuildInteRewardInfo.prototype,"GuildInteRewardInfo");var PersonalInteRankInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="PersonalInteRankSkin",e.name="个人排行",e.list.itemRenderer=GuildInteRankItemRenderer,e.data=new eui.ArrayCollection([]),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.dataProvider=this.data,this.observe(GuildWar.ins().postGuildPersonalRank,this.refushList),GuildWar.ins().requestOwnGuildRank()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.refushList=function(t){this.data.replaceAll(t)},e}(BaseView);__reflect(PersonalInteRankInfo.prototype,"PersonalInteRankInfo");var PersonInteRewardInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="PersonInteRewardSkin",e.name="个人奖励",e.list.itemRenderer=PersonRewardRenderer,e.list1.itemRenderer=GuildInteRewardItemRenderer,e.dataArr=new eui.ArrayCollection,e.dataArr1=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!this.dataList){this.dataList=[];var i=GlobalConfig.GuildBattlePersonalAward;for(var s in i)this.dataList.push(i[s])}if(this.dataArr.source=this.dataList,this.list.dataProvider=this.dataArr,!this.dataList1){this.dataList1=[];var i=GlobalConfig.GuildBattlePersonalRankAward;for(var s in i)this.dataList1.push(i[s])}this.dataArr1.source=this.dataList1,this.list1.dataProvider=this.dataArr1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(PersonInteRewardInfo.prototype,"PersonInteRewardInfo");var RedBagDetailsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RedBagDetailsSkin",this.list.itemRenderer=RedBagRenderer,this.effect=new MovieClip,this.effect.x=244,this.effect.y=300},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.num.text=GuildWar.ins().getModel().robYbNum+"",this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().rebList),t[0]&&(this.effect.playFile(RES_DIR_EFF+"yanhuaeff",1),this.addChild(this.effect))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),DisplayUtils.removeFromParent(this.effect)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(RedBagDetailsWin.prototype,"RedBagDetailsWin"),ViewManager.ins().reg(RedBagDetailsWin,LayerManager.UI_Main);var RedBagWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RedBagWinSkin",this.model=GuildWar.ins().getModel(),this.num1.restrict="0-9",this.num2.restrict="0-9"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.rob,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.send,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.btn2,this.onTap),this.addTouchEvent(this.btn3,this.onTap),this.addTouchEvent(this.btn4,this.onTap),this.addTouchEvent(this.btn5,this.onTap),this.addTouchEvent(this.btn6,this.onTap),this.addChangeEvent(this.num1,this.onTxtChange),this.addChangeEvent(this.num2,this.onTxtChange),this.model.canRod?(this.currentState="rob",this.refushInfo()):(this.currentState="send",this.refushSendInfo())},e.prototype.onTxtChange=function(t){var e=this,i=1;switch(t.currentTarget){case this.num1:i=1;break;case this.num2:i=2}TimerManager.ins().doTimer(500,1,function(){e.checkInputChange(i)},this)},e.prototype.checkInputChange=function(t){var e;switch(t){case 1:e=Number(this.num1.text),e>this.sendYBMaxNum&&(e=this.sendYBMaxNum),this.sendYb=e,this.num1.text=this.sendYb+"";break;case 2:e=Number(this.num2.text),e>this.sendMaxNum&&(e=this.sendMaxNum),this.sendNum=e,this.num2.text=this.sendNum+""}this.checkPercentage()},e.prototype.refushSendInfo=function(){this.sendYb=this.sendYBMaxNum=this.model.remainYB,this.sendMaxNum=this.sendNum=Guild.ins().getMemberNum(),this.price.setPrice(this.sendYb),this.num1.text=this.sendYb+"",this.num2.text=this.sendNum+""},e.prototype.refushInfo=function(){this.remainBag.text=this.model.remainRedNum+"/"+this.model.maxRedNum},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.rob:GuildWar.ins().requestRobRedBag();break;case this.send:GuildWar.ins().requestSendRedBag(this.sendYb,this.sendNum);break;case this.btn1:--this.sendYb,this.sendYb<this.sendNum&&(this.sendYb=this.sendNum),this.num1.text=this.sendYb+"";break;case this.btn2:++this.sendYb,this.sendYb>this.sendYBMaxNum&&(this.sendYb=this.sendYBMaxNum),this.num1.text=this.sendYb+"";break;case this.btn3:--this.sendNum,this.sendNum<1&&(this.sendNum=1),this.num2.text=this.sendNum+"";break;case this.btn4:++this.sendNum,this.sendNum>this.sendMaxNum&&(this.sendNum=this.sendMaxNum),this.num2.text=this.sendNum+"";break;case this.btn5:this.sendYb=this.sendYBMaxNum,this.num1.text=this.sendYb+"";break;case this.btn6:this.sendNum=this.sendMaxNum,this.num2.text=this.sendNum+""}},e.prototype.checkPercentage=function(){this.sendYb<this.sendNum&&(this.sendYb=this.sendNum,this.num1.text=this.sendYb+"")},e}(BaseEuiView);__reflect(RedBagWin.prototype,"RedBagWin"),ViewManager.ins().reg(RedBagWin,LayerManager.UI_Main);var GuildInteRankItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRankItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.rank.text=this.itemIndex+1+"",this.guildName.text=this.data.guildName,this.guildOwn.text=this.data.ownName,this.point.text=this.data.guildPoint},e}(BaseItemRender);__reflect(GuildInteRankItemRenderer.prototype,"GuildInteRankItemRenderer");var GuildInteRewardItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRewardItemSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){this.itemIndex<3?(this.numImg.visible=!0,this.rankLabel.visible=!1,this.numImg.source="guildshop_json.guildpaihang"+(this.itemIndex+1)):(this.numImg.visible=!1,this.rankLabel.visible=!0,this.rankLabel.text="第"+(this.itemIndex+1)+"名"),this.data.rank?this.list.dataProvider=new eui.ArrayCollection(this.data.award):this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().creatGuildRankReward(this.data))},e}(BaseItemRender);__reflect(GuildInteRewardItemRenderer.prototype,"GuildInteRewardItemRenderer");var GuildWarMemListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="WarMemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.face.source="head_"+this.data.job+this.data.sex,this.nameLab.text="["+GuildLanguage.guildOffice[this.data.office]+"]",this.nameLab0.text=this.data.myName,this.conLab.text=this.data.point+"",this.attack.text=this.data.attr+"",this.onLine.text=""==this.data.mapName?"不在龙城":this.data.mapName},e}(BaseItemRender);__reflect(GuildWarMemListRenderer.prototype,"GuildWarMemListRenderer");var MemberItem3Renderer=function(t){function e(){var e=t.call(this)||this;return e.chooseNum=1,e.skinName="MemberItem3Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof SelectInfoData){var t=this.data;this.job.textFlow=(new egret.HtmlTextParser).parser("["+GuildLanguage.guildOffice[t.data.office]+"]"),this.nameLable.text=t.data.name,this.payNum.text=""+t.num,this.attr.text=""+t.data.attack,this.face.source="head_"+t.data.job+t.data.sex,this.headBg.source="touxiangkuang"+t.data.sex}this.checkBoxs.selected=!1,this.btn1.visible=this.btn2.visible=this.num1.visible=this.inputBg.visible=!1},e}(BaseItemRender);__reflect(MemberItem3Renderer.prototype,"MemberItem3Renderer");var SelectRewardItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="SelectRewardItemSkin",e.choosePeople.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.list.itemRenderer=GuildWarMemberHeadRender,e.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GuildWar.ins().getModel().creatGuildRankReward(GuildWar.ins().getModel().guildWarRank,this.itemIndex);this.goods.data=t[0],this.boxname.text=GlobalConfig.ItemConfig[t[0].id].name,this.sendNum=GuildWar.ins().getModel().getCanSendNumByRank(this.itemIndex);var e=GuildWar.ins().getModel().getSelectDataByIndex(this.itemIndex),i=0;if(e.length>0)for(var s in e)i+=e[s].num;this.chooseNum.text=i+"/"+this.sendNum,this.list.dataProvider=new eui.ArrayCollection(e)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.choosePeople:GuildWar.ins().getModel().rewardIndex=this.itemIndex,ViewManager.ins().open(SelectMemberPanelWin,this.itemIndex,this.sendNum);break;case this.rightBtn:var e=this.list.layout.gap,i=this.list.getChildAt(0);if(!i)return;var s=i.width+e,n=Math.ceil(this.list.width/s);if(this.index=Math.ceil(this.list.scrollH/s),this.index+n>=this.list.numElements)return;this.index++,egret.Tween.removeTweens(this.list);
var o=egret.Tween.get(this.list);o.to({scrollH:s*this.index},100);break;case this.leftBtn:if(e=this.list.layout.gap,i=this.list.getChildAt(0),!i)return;if(s=i.width+e,n=Math.ceil(this.list.width/s),this.index=Math.ceil(this.list.scrollH/s),this.index<=0)return;this.index--,egret.Tween.removeTweens(this.list),o=egret.Tween.get(this.list),o.to({scrollH:s*this.index},100)}},e}(BaseItemRender);__reflect(SelectRewardItemRenderer.prototype,"SelectRewardItemRenderer");var SelectMemberPanelWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SelectMemberPanelSkin",this.list.itemRenderer=MemberItem3Renderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.maxNum=t[1],this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),GuildWar.ins().getModel().sendList[this.index]=[],GuildWar.ins().getModel().sendNumList[this.index]=[],this.selectList=[],this.numList=[],this.selectItemList=[],this.chooseNum.text="已选择 "+this.countNum()+"/"+this.maxNum,this.sureBtn.enabled=this.selectList.length==this.maxNum,this.refushList()},e.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().getMyGuildPointRank())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.list,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap),GuildWar.ins().postSendListChange()},e.prototype.countNum=function(){var t=0;if(this.selectItemList)for(var e in this.selectItemList)t+=this.selectItemList[e].chooseNum;return t},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.sureBtn:this.toNumList(),GuildWar.ins().getModel().sendList[this.index]=this.selectList,GuildWar.ins().getModel().sendNumList[this.index]=this.numList,ViewManager.ins().close(e);break;case this.list:var i=t.target.parent;if(i&&i.data){var s=this.selectItemList.lastIndexOf(i);switch(t.target){case i.btn1:--i.chooseNum,i.chooseNum<1&&(i.chooseNum=1);break;case i.btn2:if(this.countNum()>=this.maxNum)return void UserTips.ins().showTips("|C:0xf3311e&T:分配人数已满|");++i.chooseNum;break;default:if(s>=0)i.checkBoxs.selected=!1,i.chooseNum=0,this.selectItemList.splice(s,1);else{if(this.countNum()>=this.maxNum)return i.checkBoxs.selected=!1,void UserTips.ins().showTips("|C:0xf3311e&T:分配人数已满|");i.checkBoxs.selected=!0,this.selectItemList.push(i),i.chooseNum=1}}i.num1.text=i.chooseNum+"",this.setAddInfoShow(i,i.checkBoxs.selected),this.chooseNum.text="已选择 "+this.countNum()+"/"+this.maxNum,this.sureBtn.enabled=this.countNum()==this.maxNum}}},e.prototype.setAddInfoShow=function(t,e){void 0===e&&(e=!1),t.btn1.visible=t.btn2.visible=t.num1.visible=t.inputBg.visible=e},e.prototype.toNumList=function(){if(this.selectItemList)for(var t in this.selectItemList)this.selectList.push(this.selectItemList[t].data.data),this.numList.push(this.selectItemList[t].chooseNum)},e}(BaseEuiView);__reflect(SelectMemberPanelWin.prototype,"SelectMemberPanelWin"),ViewManager.ins().reg(SelectMemberPanelWin,LayerManager.UI_Popup);var SelectMemberRewardWin=function(t){function e(){var e=t.call(this)||this;return e.dataLen=[],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SelectMemberRewardSkin",this.list.itemRenderer=SelectRewardItemRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];GuildWar.ins().requestOwnMyGuildRank(),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.sendReward,this.onTap),this.observe(GuildWar.ins().postSendListChange,this.refushList),this.refushPanelInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.sendReward,this.onTap),this.removeObserve(),ViewManager.ins().open(GuildMap)},e.prototype.refushPanelInfo=function(){this.rankLabel.text="本次龙城争霸公会排名：第"+GuildWar.ins().getModel().guildWarRank+"名",this.dataLen.length=GuildWar.ins().getModel().getCanSendNumByRank(),this.refushList()},e.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(this.dataLen)},e.prototype.onTap=function(t){var i=this;switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.sendReward:TimerManager.ins().doTimer(100,1,function(){GuildWar.ins().getModel().checkISSendAll()&&GuildWar.ins().sendFenReward(i.dataLen.length,GuildWar.ins().getModel().sendList)},this)}},e}(BaseEuiView);__reflect(SelectMemberRewardWin.prototype,"SelectMemberRewardWin"),ViewManager.ins().reg(SelectMemberRewardWin,LayerManager.UI_Popup);var HeartMethod=function(t){function e(){var e=t.call(this)||this;return e._proShowList=[],e.sysId=PackageID.HeartMethod,e.regNetMsg(1,e.postHeartInfo),e.regNetMsg(2,e.postHeartUpLevel),e.regNetMsg(5,e.postOneKeyDecompose),e.HeartMethodInfo=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"proShowList",{get:function(){return this._proShowList.length||(this._proShowList=GlobalConfig.HeartMethodBaseConfig.proShowList),this._proShowList},enumerable:!0,configurable:!0}),e.ins=function(){return t.ins.call(this)},e.prototype.heartOpenCondition=function(t){var e=GlobalConfig.HeartMethodConfig[t];return e.openCondition?GameServer.serverOpenDay+1<e.openCondition.day?!1:UserZs.ins().lv<e.openCondition.zs?!1:!0:!0},e.prototype.heartUpCondition=function(t,e){var i=GlobalConfig.HeartMethodConfig[e];if(!i.upGradeCondition)return!0;var s=this.HeartMethodInfo[t];if(!s)return!1;var n=s[e];if(!n)return!1;for(var o=0,a=0;a<n.slots.length;a++)n.slots[a]&&o++;return o<i.upGradeCondition?!1:!0},e.prototype.checkOpen=function(){return GameServer.serverOpenDay<GlobalConfig.HeartMethodBaseConfig.serverDay-1?!1:UserZs.ins().lv<GlobalConfig.HeartMethodBaseConfig.zsLv?!1:!0},e.prototype.getHeartCfg=function(t,e){void 0===e&&(e=!1);var i=GlobalConfig.HeartMethodStarConfig;if(Assert(i,"HeartMethodStarConfig is null"))return null;var s=e?t.configID+1:t.configID;return i[s]},e.prototype.calcHeartSlotValue=function(t,e){var i=[];return i},e.prototype.getHeartSlotItemIdWear=function(t,e,i){var s=this.HeartMethodInfo[t];if(!s)return 0;var n=s[e];if(!n)return 0;var o=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);o.sort(this.changeSort);for(var a in o){var r=GlobalConfig.HeartMethodStarConfig[o[a].configID];if(r.heartmethodId==e){var h=o[a].itemConfig,l=h.level?h.level:0,c=h.zsLevel?h.zsLevel:0;if(!(Actor.level<l||UserZs.ins().lv<c)){var u=this.getSuitPosFromItemId(o[a].configID);if(i==u)return o[a].configID}}}return 0},e.prototype.getHeartSlotItemId=function(t,e,i){var s=this.HeartMethodInfo[t];if(!s)return 0;var n=s[e];return n&&n.slots[i-1]?n.slots[i-1]:0},e.prototype.calcHeartSlotChange=function(t,e,i){var s=this.HeartMethodInfo[t];if(!s)return 0;var n=s[e];if(!n)return 0;var o=GlobalConfig.HeartMethodStarConfig[i];if(!o)return 0;var a=n.slots.indexOf(i);if(-1==a)return 0;var r=this.getSuitPosFromItemId(i);if(!r)return 0;var h=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);h.sort(this.changeSort);for(var l in h)if(GlobalConfig.HeartMethodStarConfig[h[l].configID].posSort==r&&GlobalConfig.HeartMethodStarConfig[h[l].configID].heartmethodId==e){var c=GlobalConfig.ItemConfig[h[l].configID],u=c.level?c.level:0,p=c.zsLevel?c.zsLevel:0;if(!(Actor.level<u||UserZs.ins().lv<p)){var d=GlobalConfig.HeartMethodStarConfig[c.id];if(d.quality>o.quality)return c.id;if(d.quality==o.quality&&d.star>o.star)return c.id}}return 0},e.prototype.changeSort=function(t,e){if(ItemConfig.getQuality(t.itemConfig)>ItemConfig.getQuality(e.itemConfig))return-1;var i=GlobalConfig.HeartMethodStarConfig[t.configID],s=GlobalConfig.HeartMethodStarConfig[e.configID];return i.star>s.star?-1:1},e.prototype.getSuitPosFromItemId=function(t){var e=GlobalConfig.HeartMethodStarConfig[t];return e?e.posSort:0},e.prototype.calcHeartSlotCost=function(t){var e=!1,i=GlobalConfig.HeartMethodStarConfig[t];if(!i||!i.nextItem)return e;var s=UserBag.ins().getBagItemById(i.costItem);return s&&s.count>=i.costNum&&(e=!0),e},e.prototype.calcHeartTotalValue=function(t,e){for(var i=this.proShowList,s=[],n=0;n<i.length;n++)s.push(0);var o=this.HeartMethodInfo[t];if(!o||!o[e])return s;for(var a=this.calcHeartAttrs(t,e),n=0;n<i.length;n++)if(i[n].filter){var r=this.calcHeartSkillLevel(t,e);if(r){var h=GlobalConfig.HeartMethodSuitConfig[e][r];h&&i[n].id==h.attr[0].type&&(s[n]+=h.attr[0].value/100)}}else{for(var l=0;l<o[e].slots.length;l++){var c=o[e].slots[l],u=GlobalConfig.HeartMethodStarConfig[c];if(u)for(var p=0;p<u.attr.length;p++)i[n].id==u.attr[p].type&&(s[n]+=u.attr[p].value)}for(var d=0;d<a.length;d++)if(i[n].id==a[d].type){s[n]+=a[d].value;break}}return s},e.prototype.getHeartSuitCount=function(t,e,i){var s=this.HeartMethodInfo[t];if(!s||!s[e])return 0;for(var n=0,o=0;o<s[e].slots.length;o++){var a=s[e].slots[o];if(a){var r=GlobalConfig.HeartMethodStarConfig[a];r.quality>=i&&n++}}return n},e.prototype.calcHeartSkillLevel=function(t,e){var i=0,s=this.HeartMethodInfo[t];if(!s||!s[e])return i;for(var n,o=0;o<s[e].slots.length;o++){var a=s[e].slots[o];if(!a)return 0;var r=GlobalConfig.HeartMethodStarConfig[a];if(r){var h=r.quality;(!n||n>h)&&(n=h)}}return n&&(i=n),i},e.prototype.calcHeartAttrs=function(t,e){var i=this.HeartMethodInfo[t],s=[];if(!i||!i[e]||!i[e].id)return s;var n=i[e],o=GlobalConfig.HeartMethodStageConfig[n.id];if(o&&o[n.stage]){var a=o[n.stage].attr;for(var r in a){var h=new AttributeData;h.type=a[r].type,h.value=a[r].value,s.push(h)}}var l=GlobalConfig.HeartMethodLevelConfig[n.id];if(l&&l[n.lv]){var a=l[n.lv].attr;for(var r in a){for(var c=!1,u=0;u<s.length;u++)if(s[u].type==a[r].type){s[u].value+=a[r].value,c=!0;break}if(!c){var h=new AttributeData;h.type=a[r].type,h.value=a[r].value,s.push(h)}}}return s},e.prototype.calcHeartAttrsNext=function(t,e){var i=this.HeartMethodInfo[t],s=[];if(!i||!i[e]||!i[e].id)return s;var n=i[e],o=GlobalConfig.HeartMethodStageConfig[n.id],a=GlobalConfig.HeartMethodLevelConfig[n.id],r=[],h=[];if(n.isUp?(r=o[n.stage+1]?o[n.stage+1].attr:o[n.stage].attr,h=a[n.lv].attr):(r=o[n.stage].attr,h=a[n.lv+1]?a[n.lv+1].attr:a[n.lv].attr),r&&r.length){var l=r;for(var c in l){var u=new AttributeData;u.type=l[c].type,u.value=l[c].value,s.push(u)}}if(h.length){var l=h;for(var c in l){for(var p=!1,d=0;d<s.length;d++)if(s[d].type==l[c].type){s[d].value+=l[c].value,p=!0;break}if(!p){var u=new AttributeData;u.type=l[c].type,u.value=l[c].value,s.push(u)}}}return s},e.prototype.calcHeartCost=function(t,e){var i=null,s=this.HeartMethodInfo[t];if(!s||!s[e]||!s[e].id||this.isHeartMax(t,e)||s[e].isUp)return i;var n=GlobalConfig.HeartMethodLevelConfig[s[e].id][s[e].lv+1];return n&&(i={itemid:n.costItem,count:n.costNum}),i},e.prototype.isHeartMax=function(t,e){var i=this.HeartMethodInfo[t];if(!i||!i[e]||!i[e].id)return!1;var s=GlobalConfig.HeartMethodLevelConfig[i[e].id][i[e].lv+1];return s?!1:!0},e.prototype.getAttrStrByType=function(t){var e="";for(var i in this.proShowList)if(this.proShowList[i].id==t){e=this.proShowList[i].name;break}return e},e.prototype.sendHeartUpLevel=function(t,e,i){var s=this.getBytes(3);s.writeByte(t),s.writeShort(e),s.writeShort(i),this.sendToServer(s)},e.prototype.sendHeartChange=function(t,e,i,s){var n=this.getBytes(4);n.writeByte(t),n.writeShort(e),n.writeShort(i),n.writeInt(s),this.sendToServer(n)},e.prototype.sendOneKeyDecompose=function(t,e){var i=e.length,s=this.getBytes(5);s.writeShort(t),s.writeInt(i);for(var n=0;i>n;n++)s.writeInt(e[n].configID);this.sendToServer(s)},e.prototype.postHeartInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte();this.HeartMethodInfo[s]||(this.HeartMethodInfo[s]={});for(var n=t.readShort(),o=0;n>o;o++){var a=t.readShort(),r=t.readShort(),h=t.readByte(),l=t.readShort(),c=new HearMethodData;c.id=a,c.lv=r,c.stage=h;for(var u=0;l>u;u++){var p=t.readInt();c.slots.push(p)}this.HeartMethodInfo[s][a]=c}}},e.prototype.postHeartUpLevel=function(t){var e=t.readUnsignedByte();this.HeartMethodInfo[e]||(this.HeartMethodInfo[e]={});var i,s=t.readShort();this.HeartMethodInfo[e][s]?i=this.HeartMethodInfo[e][s]:(i=new HearMethodData,i.id=s);var n=t.readShort();i.lv=n;var o=t.readByte();i.stage=o;var a=t.readShort();i.slots=[];for(var r=0;a>r;r++){var h=t.readInt();i.slots.push(h)}this.HeartMethodInfo[e][s]=i},e.prototype.postOneKeyDecompose=function(t){var e=t.readByte(),i=0,s=0;return e&&(i=t.readShort(),s=t.readShort()),[e,i,s]},e}(BaseSystem);__reflect(HeartMethod.prototype,"HeartMethod");var HearMethodData=function(){function t(){this.id=0,this.lv=0,this.stage=0,this.slots=[]}return Object.defineProperty(t.prototype,"stage",{get:function(){return this.isUp?Math.floor(this.lv/10):Math.floor(this.lv/10)+1},set:function(t){this.isUp=t},enumerable:!0,configurable:!0}),t}();__reflect(HearMethodData.prototype,"HearMethodData");var HeartTypeData=function(){function t(){}return t}();__reflect(HeartTypeData.prototype,"HeartTypeData");var GameSystem;!function(t){t.heartmethod=HeartMethod.ins.bind(HeartMethod)}(GameSystem||(GameSystem={}));var HeartMethodRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleTabs={},e.roleTabs={},e.redPoint=!1,e.associated(e.postHeartMethodRedPoint,e.postHeartRoleRedPoint),e.associated(e.postHeartRoleRedPoint,HeartMethod.ins().postHeartInfo,HeartMethod.ins().postHeartUpLevel,HeartMethod.ins().postOneKeyDecompose,UserBag.ins().postItemCountChange,UserZs.ins().postZsLv,GameLogic.ins().postSubRoleChange),e}return __extends(e,t),e.prototype.postHeartMethodRedPoint=function(){var t=this.redPoint;if(!HeartMethod.ins().checkOpen())return this.redPoint=!1,t!=this.redPoint;for(var e=0;e<SubRoles.ins().subRolesLen;e++)if(this.roleTabs[e])for(var i in this.roleTabs[e])if(this.roleTabs[e][i])return this.redPoint=!0,this.redPoint;return this.redPoint=!1,t!=this.redPoint},e.prototype.postHeartRoleRedPoint=function(){if(HeartMethod.ins().checkOpen())for(var t=0;t<SubRoles.ins().subRolesLen;t++){this.roleTabs[t]||(this.roleTabs[t]={});var e=HeartMethod.ins().HeartMethodInfo[t];e||(e={});for(var i in GlobalConfig.HeartMethodConfig){var s=e[i];if(s)if(this.roleTabs[t][s.id]||(this.roleTabs[t][s.id]=!1),s.id){if(this.roleTabs[t][s.id]=!1,!HeartMethod.ins().heartOpenCondition(s.id))continue;var n=HeartMethod.ins().calcHeartCost(t,s.id);if(n){var o=UserBag.ins().getBagItemById(n.itemid),a=o?o.count:0;if(this.roleTabs[t][s.id]=a>=GlobalConfig.HeartMethodStageConfig[s.id][s.stage].normalCostTip,this.roleTabs[t][s.id]){if(HeartMethod.ins().heartUpCondition(t,s.id))continue;this.roleTabs[t][s.id]=!1}}if(s.isUp&&!HeartMethod.ins().isHeartMax(t,s.id)){this.roleTabs[t][s.id]=!0;continue}var r=GlobalConfig.HeartMethodConfig[s.id];t:for(var h=0;h<r.posList.length;h++){var l=HeartMethod.ins().getHeartSlotItemId(t,s.id,h+1);if(l)if(HeartMethod.ins().calcHeartSlotCost(l))this.roleTabs[t][s.id]=!0;else for(var c=0;c<s.slots.length;c++){var u=s.slots[c],p=HeartMethod.ins().calcHeartSlotChange(t,s.id,u);if(this.roleTabs[t][s.id]=p?!0:!1,p)break t}else{var d=HeartMethod.ins().getHeartSlotItemIdWear(t,s.id,h+1);if(this.roleTabs[t][s.id]=d?!0:!1,d)break}}if(this.roleTabs[t][s.id])continue}else this.roleTabs[t][s.id]=!0;else HeartMethod.ins().heartOpenCondition(GlobalConfig.HeartMethodConfig[i].id)?this.roleTabs[t][GlobalConfig.HeartMethodConfig[i].id]=!0:this.roleTabs[t][GlobalConfig.HeartMethodConfig[i].id]=!1}}},e.prototype.checkHeartRedPoint=function(t,e){return this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][e]?!0:!1},e}(BaseSystem);__reflect(HeartMethodRedPoint.prototype,"HeartMethodRedPoint");var GameSystem;!function(t){t.heartmethodredpoint=HeartMethodRedPoint.ins.bind(HeartMethodRedPoint)}(GameSystem||(GameSystem={}));var HeartMethodAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=[],e.skinName="heartmethodAttrSkin",e.isTopLevel=!0,e.proShowList=HeartMethod.ins().proShowList,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.heartId=t[1],this.setRoleAttr(this.curRole);var i=SubRoles.ins().subRolesLen;i>1&&(this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.addTouchEndEvent(this.bg,this.onMove)),this.addTouchEndEvent(this,this.otherClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=SubRoles.ins().subRolesLen;i>1&&(this.removeTouchEvent(this.leftBtn,this.onTouch),this.removeTouchEvent(this.rightBtn,this.onTouch),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200)):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200))}},e.prototype.moveAttr=function(t){var e,i=egret.Tween.get(this.attrGroup);e=t>0?0:242,i.to({x:this.attrGroup.x+t,alpha:0},200).to({x:e},200).to({x:80,alpha:1},200)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.leftBtn:this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200));break;case this.rightBtn:this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200))}},e.prototype.setRoleAttr=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);this.job.source="op_"+e.job;for(var i="",s="",n=0,o=0,a=HeartMethod.ins().calcHeartTotalValue(e.index,this.heartId),r=0;r<this.proShowList.length;r++)o=this.proShowList[r].id,n=a[r],n&&(i+=this.proShowList[r].id==AttributeType.atZhuiMingPro?n+"%":n+"",s+=HeartMethod.ins().getAttrStrByType(o)+":",r<this.proShowList.length-1&&(i+="\n",s+="\n"));this.attr.text=i,this.attrName.text=s,this.setBtn()},e.prototype.setBtn=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,3>t?this.rightBtn.visible=!1:this.rightBtn.visible=!0):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(HeartMethodAttrWin.prototype,"HeartMethodAttrWin"),ViewManager.ins().reg(HeartMethodAttrWin,LayerManager.UI_Popup);var HeartMethodDecomposeItemData=function(){function t(){this.itemData=null,this.isSelected=!1}return t}();__reflect(HeartMethodDecomposeItemData.prototype,"HeartMethodDecomposeItemData");var HeartMethodDecomposeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.cb.touchChildren=!1,this.cb.touchEnabled=!1;var t=this.data,e=t.itemData;if(e&&e instanceof ItemData){var i=HeartMethod.ins().getHeartCfg(e);i?this.itemIcon.data=e:this.resetView()}else this.resetView();this.cb.selected=t.isSelected},e.prototype.resetView=function(){this.itemIcon.data=null},e.prototype.playEffect=function(){!this.cb.selected},e}(eui.ItemRenderer);__reflect(HeartMethodDecomposeItemRenderer.prototype,"HeartMethodDecomposeItemRenderer");var HeartMethodDecomposePanel=function(t){function e(){var e=t.call(this)||this;return e.cardList=null,e.cardCollection=null,e.checkBoxNum=4,e.itemListScrollV=0,e.resolveIng=!1,e._addNum=0,e._chipNum=0,e.skinName="heartmethodDecomposeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.itemList.itemRenderer=HeartMethodDecomposeItemRenderer,this.itemList.useVirtualLayout=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.checkBoxNum;i++)this["cb"+i]&&this.addTouchEvent(this["cb"+i],this.onCBTap);this.addTouchEvent(this.decomposeBtn,this.onTap),this.addTouchEvent(this.itemList,this.onListTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(HeartMethod.ins().postOneKeyDecompose,this.onDecomposeResult),this.heartId=t[0],this.initCardList(),this.resetCheckBox(),this.updateShatter()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.cleanCardList()},e.prototype.onDecomposeResult=function(t){var e=this;if(t[0]){t[1],t[2];TimerManager.ins().doTimer(500,1,function(){e.initCardList(),e.updateShatter(),e.updateAddShatter(),e.resolveIng=!1},this)}else UserTips.ins().showTips("分解失败，请稍后再试")},e.prototype.playEffect=function(){for(var t=this.itemList.numChildren,e=0;t>e;e++){var i=this.itemList.getChildAt(e);i&&i.playEffect()}},e.prototype.onShatterChange=function(){this.updateShatter()},e.prototype.onListTap=function(t){if(t&&t.currentTarget){var e=this.itemList.selectedIndex;if(0>e)return;var i=this.itemList.getVirtualElementAt(e);if(i&&i instanceof HeartMethodDecomposeItemRenderer&&i.cb){var s=i.data;s&&(s.isSelected=!s.isSelected,this.cardCollection.itemUpdated(s))}this.itemList.selectedIndex=-1,this.updateAddShatter()}},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.decomposeBtn:this.decomposeHeart();break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.decomposeHeart=function(){if(!this.resolveIng){if(this.cardList&&this.cardList.length>0){for(var t=[],e=0,i=this.cardList;e<i.length;e++){var s=i[e];s&&s.isSelected&&s.itemData&&s.itemData.itemConfig&&t.push(s.itemData)}if(t.length>0)return this.resolveIng=!0,void HeartMethod.ins().sendOneKeyDecompose(this.heartId,t)}UserTips.ins().showTips("当前无选择任何心法")}},e.prototype.onCBTap=function(t){if(t&&t.currentTarget){var e=t.currentTarget;if(e&&e instanceof eui.CheckBox)for(var i=null,s=0;s<this.checkBoxNum;s++)if(i=this["cb"+s],i&&i===e)return void this.setQualitySelected(s+1,e.selected)}},e.prototype.updateShatter=function(){var t=GlobalConfig.HeartMethodConfig[this.heartId].splitItem,e=GlobalConfig.ItemConfig[t];this.suipianIcon.source=e.icon+"_png";var i=UserBag.ins().getBagItemById(e.id);this.suipianNum.text=(i?i.count:0)+""},e.prototype.updateAddShatter=function(){var t=0,e=null;if(this.cardList&&this.cardList.length>0)for(var i=0,s=this.cardList;i<s.length;i++){var n=s[i];n&&n.isSelected&&n.itemData&&n.itemData.itemConfig&&(e=HeartMethod.ins().getHeartCfg(n.itemData),e&&(t+=e.splitNum))}this._addNum=t,this.suipianAdd.text=t?"+"+t:""},e.prototype.setQualitySelected=function(t,e){if(0>t)for(var i=0,s=this.cardList;i<s.length;i++){var n=s[i];n.itemData&&n.itemData.itemConfig&&(n.isSelected=!1)}else for(var o=0,a=this.cardList;o<a.length;o++){var n=a[o];n.itemData&&n.itemData.itemConfig&&ItemConfig.getQuality(n.itemData.itemConfig)==t&&(n.isSelected=e)}for(var r=this.cardCollection.length,h=0;r>h;h++)this.cardCollection.itemUpdated(this.cardList[h]);this.updateAddShatter()},e.prototype.getCheckBoxSelected=function(t){var e=this["cb"+(t-1)];return e?e.selected:!1},e.prototype.resetCheckBox=function(t){void 0===t&&(t=1);for(var e=null,i=0;i<this.checkBoxNum;i++)e=this["cb"+i],e&&e instanceof eui.CheckBox&&(e.selected=i+1==t);this.setQualitySelected(t,!0)},e.prototype.selectHeartItem=function(t){for(var e=[],i=0;i<t.length;i++){var s=GlobalConfig.HeartMethodStarConfig[t[i].configID];this.heartId==s.heartmethodId&&e.push(t[i])}return e},e.prototype.initCardList=function(){this.cleanCardList(),this.cardList=[];var t=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18),e=this.selectHeartItem(t);if(e&&e.length>0){for(var i=null,s=0,n=e;s<n.length;s++)for(var o=n[s],a=0;a<o.count;a++)i=new HeartMethodDecomposeItemData,i.itemData=o,this.cardList.push(i);this.cardList.sort(this.sortList)}this.cardCollection=new eui.ArrayCollection(this.cardList),this.itemList.dataProvider=this.cardCollection},e.prototype.cleanCardList=function(){this.cardList=null,this.cardCollection=null,this.itemList.dataProvider=null},e.prototype.sortList=function(t,e){var i=ItemConfig.getQuality(t.itemData.itemConfig),s=ItemConfig.getQuality(e.itemData.itemConfig);if(i>s)return-1;if(s>i)return 1;var n=HeartMethod.ins().getHeartCfg(t.itemData),o=HeartMethod.ins().getHeartCfg(e.itemData);return n.star>o.star?-1:1},e}(BaseEuiView);__reflect(HeartMethodDecomposePanel.prototype,"HeartMethodDecomposePanel"),ViewManager.ins().reg(HeartMethodDecomposePanel,LayerManager.UI_Popup);var HeartMethodDisplay=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodItemIconSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof ItemData){var t=this.data,e=GlobalConfig.ItemConfig[t.itemConfig.id];this.itemIcon.setData(e);var i=ItemConfig.getQualityColor(e);this.nameTF.textFlow=TextFlowMaker.generateTextFlow1("|C:"+i+"&T:"+e.name)}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(HeartMethodDisplay.prototype,"HeartMethodDisplay");var HeartMethodItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&this.data&&(this.data.itemid?(this.itemIcon.setData(GlobalConfig.ItemConfig[this.data.itemid]),this.itemIcon.visible=!0,this.blank.visible=!1):(this.itemIcon.visible=!1,this.blank.source=this.data.blank,this.blank.visible=!0),this.redPoint.visible=this.data.redPoint)},e}(BaseItemRender);__reflect(HeartMethodItemRenderer.prototype,"HeartMethodItemRenderer");var HeartMethodSkillTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodSkillTipSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.observe(HeartMethod.ins().postHeartUpLevel,this.updateUI),this.roleId=t[0],this.heartId=t[1],this.updateUI()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateUI=function(){var t,e=HeartMethod.ins().calcHeartSkillLevel(this.roleId,this.heartId),i=GlobalConfig.HeartMethodSuitConfig[this.heartId],s=Object.keys(i).length;e?e>=s?(this.currentState="max",t=i[s]):(this.currentState="normal",t=i[e]):(this.currentState="initial",t=i[1]),this.validateNow();var n=GlobalConfig.HeartMethodConfig[this.heartId];n&&(this.skillName.text=n.name,this.skillShow.source=n.skillShowPic+"_png");var o=ItemBase.QUALITY_COLOR[t.level];this.curskillDesc0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:【"+t.skillname+"】");var a="",r=HeartMethod.ins().getHeartSuitCount(this.roleId,this.heartId,t.level),h=GlobalConfig.HeartMethodConfig[this.heartId].posList.length;if(a="("+r+"/"+h+")","initial"==this.currentState)this.curskillDesc2.text=this.getColorDesc(t.level)+a,this.curskillDesc3.text=t.skilldesc;else if("normal"==this.currentState){var l=i[e+1];this.curskillDesc3.text=t.skilldesc,r=HeartMethod.ins().getHeartSuitCount(this.roleId,this.heartId,l.level),a="("+r+"/"+h+")",o=ItemBase.QUALITY_COLOR[l.level],this.nextskillTitle0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:【"+l.skillname+"】"),this.nextskillTitle2.text=this.getColorDesc(l.level)+a,this.nextskillTitle3.text=l.skilldesc}else"max"==this.currentState&&(this.nextskillTitle0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:【"+t.skillname+"】"),this.nextskillTitle3.text=t.skilldesc)},e.prototype.getColorDesc=function(t){var e="";switch(t){case 0:e="白色";break;case 1:e="绿色";break;case 2:e="紫色";break;case 3:e="橙色";break;case 4:e="红色"}return e&&(e="收集一套"+e+"心法残页激活"),e},e}(BaseEuiView);__reflect(HeartMethodSkillTips.prototype,"HeartMethodSkillTips"),ViewManager.ins().reg(HeartMethodSkillTips,LayerManager.UI_Popup);var HeartMethodTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.addTouchEvent(this.addStar,this.onClick),this.addTouchEvent(this.replace,this.onClick),this.observe(HeartMethod.ins().postHeartUpLevel,this.updateUI),this.roleId=t[0],this.heartId=t[1],this.id=t[2],this.updateUI()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeTouchEvent(this.addStar,this.onClick),this.removeTouchEvent(this.replace,this.onClick),DisplayUtils.removeFromParent(this.starList),this.starList=null},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.addStar:if(this.isMax)return void UserTips.ins().showTips("已满星");this.isAdd?HeartMethod.ins().sendHeartUpLevel(this.roleId,this.heartId,this.pId):UserTips.ins().showTips("|C:0xff0000&T:材料不足");break;case this.replace:var e=HeartMethod.ins().calcHeartSlotChange(this.roleId,this.heartId,this.id);if(!e)return void UserTips.ins().showTips("没有更好的部位被替换");if(!this.pId)return void UserTips.ins().showTips("道具:"+this.id+"套装部位数据异常");HeartMethod.ins().sendHeartChange(this.roleId,this.heartId,this.pId,e)}},e.prototype.updateUI=function(){if(this.pId=HeartMethod.ins().getSuitPosFromItemId(this.id),this.pId){this.id=HeartMethod.ins().HeartMethodInfo[this.roleId][this.heartId].slots[this.pId-1];var t=GlobalConfig.HeartMethodStarConfig[this.id];if(t){this.icon.source=t.bigIcon,this.mc||(this.mc=new MovieClip),this.mc.parent||this.effGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+t.effect,-1);var e=GlobalConfig.ItemConfig[this.id];this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:"+ItemConfig.getQualityColor(e)+"&T:"+e.name);var i=UserBag.getAttrPower(t.attr);this.powerPanel.setPower(i);for(var s="",n="",o=0;o<HeartMethod.ins().proShowList.length;o++)for(var a=0;a<t.attr.length;a++)if(HeartMethod.ins().proShowList[o].id==t.attr[a].type){var r=HeartMethod.ins().getAttrStrByType(t.attr[a].type);if(!r)continue;if(!t.attr[a].value)continue;s+=r,n+="+"+t.attr[a].value,s+="\n",n+="\n"}if(s){var h=s.lastIndexOf("\n");s=s.substring(0,h)}if(n){var h=n.lastIndexOf("\n");n=n.substring(0,h)}this.attr.text=s,this.value.text=n;var l="";if(this.isMax=!1,t.nextItem){var c=GlobalConfig.ItemConfig[t.costItem];if(c){var u=ItemConfig.getQualityColor(c);l="|C:0xFFFFCC&T:消耗 |C:"+u+"&T:"+c.name+"|C:0xFFFFCC&T: X"+t.costNum,this.cost.textFlow=TextFlowMaker.generateTextFlow1(l)}this.isAdd=HeartMethod.ins().calcHeartSlotCost(this.id)}else this.isMax=!0,this.isAdd=!1;this.cost.visible=l?!0:!1;var p=GlobalConfig.HeartMethodPosConfig[t.posId][t.quality];if(p){var d=Object.keys(p).length-1;this.starList?this.starList.setlistLength(d,t.star):(this.starList=new StarList(d),this.starList.horizontalCenter=0,this.starList.y=0,this.starGroup.addChild(this.starList)),this.starList.setStarNum(t.star)}this.updateRedPoint()}}},e.prototype.updateRedPoint=function(){this.redPoint1.visible=this.isAdd,this.redPoint2.visible=HeartMethod.ins().calcHeartSlotChange(this.roleId,this.heartId,this.id)?!0:!1},e}(BaseEuiView);__reflect(HeartMethodTips.prototype,"HeartMethodTips"),ViewManager.ins().reg(HeartMethodTips,LayerManager.UI_Popup);var HeartMethodWin=function(t){function e(){var e=t.call(this)||this;return e.heartPages=[],e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.stopIconTween(),this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.stopIconTween(),this.addTouchEvent(this.xiangxishuxing,this.onTap),this.addTouchEvent(this.skill,this.onTap),this.addTouchEvent(this.fenjie,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.activeBtn0,this.onTap),this.addTouchEvent(this.boostBtn,this.onTap),this.addTouchEvent(this.getItemTxt0,this.onTap),this.observe(HeartMethodRedPoint.ins().postHeartRoleRedPoint,this.updateUI);for(var i=0;5>i;i++)this.addTouchEvent(this["item"+(i+1)],this.onSlot);var s=t&&t[0]?t[0]:0;this.curRole=s,this.heartId=t&&t[1]?t[1]:1,this.init(),this.updateUI()},e.prototype.onSlot=function(t){for(var e=this.getHeartId(this.heartPos),i=0;5>i;i++)if(t.currentTarget==this["item"+(i+1)]){var s=HeartMethod.ins().getHeartSlotItemId(this.curRole,e,i+1);if(s)ViewManager.ins().open(HeartMethodTips,this.curRole,e,s);else{var n=UserBag.ins().getBagGoodsByType(ItemType.TYPE_18);n.sort(HeartMethod.ins().changeSort);var o=!1;for(var a in n){var r=GlobalConfig.HeartMethodStarConfig[n[a].configID];if(r.heartmethodId==e){var h=GlobalConfig.HeartMethodConfig[e].posList.indexOf(r.posId);if(-1!=h&&h==i){o=!0,HeartMethod.ins().sendHeartChange(this.curRole,e,i+1,r.posItem);break}}}o||UserTips.ins().showTips("身上没有适合的道具穿戴")}break}},e.prototype.onTap=function(t){var e=this.getHeartId(this.heartPos);switch(t.currentTarget){case this.boostBtn:if("narmal"==this.currentState){if(!HeartMethod.ins().heartUpCondition(this.curRole,e))return void UserTips.ins().showTips("|C:0xff0000&T:条件不足");if(!this.isHeartUp)return void UserTips.ins().showTips("|C:0xff0000&T:材料不足");HeartMethod.ins().sendHeartUpLevel(this.curRole,e,0)}else"stage"==this.currentState&&HeartMethod.ins().sendHeartUpLevel(this.curRole,e,0);break;case this.activeBtn0:this.isAct=!0,HeartMethod.ins().sendHeartUpLevel(this.curRole,e,0);break;case this.xiangxishuxing:ViewManager.ins().open(HeartMethodAttrWin,this.curRole,e);break;case this.skill:ViewManager.ins().open(HeartMethodSkillTips,this.curRole,e);break;case this.fenjie:ViewManager.ins().open(HeartMethodDecomposePanel,e);break;case this.leftBtn:var i=this.getHeartId(this.heartPos-1),s=GlobalConfig.HeartMethodConfig[i];s?(this.heartPos--,this.heartId=i,this.updateUI()):UserTips.ins().showTips("没有上一个心法");break;case this.rightBtn:var n=this.getHeartId(this.heartPos+1),o=GlobalConfig.HeartMethodConfig[n];o?(this.heartPos++,this.heartId=n,this.updateUI()):UserTips.ins().showTips("没有下一个心法");break;case this.getItemTxt0:if(this.conditionDesc.visible){var a=GlobalConfig.HeartMethodConfig[this.getHeartId(this.heartPos)];UserWarn.ins().setBuyGoodsWarn(a.posGainGuide)}else UserWarn.ins().setBuyGoodsWarn(this.costId)}},e.prototype.init=function(){this.showGroupY=this.showGroup.y,this.showGroupMoveY=this.showGroupY-10,this.heartPages=[];for(var t in GlobalConfig.HeartMethodConfig)this.heartPages.push(GlobalConfig.HeartMethodConfig[t]);this.heartPages.sort(function(t,e){return t.sort<e.sort?-1:1}),this.heartPos=0;for(var e=0;e<this.heartPages.length;e++)if(this.heartPages[e].id==this.heartId){this.heartPos=e;break}},e.prototype.getHeartId=function(t){return this.heartPages[t]?this.heartPages[t].id:0},e.prototype.updateUI=function(){this.updateAct(),this.updateState(),this.updatePower(),this.updateHeart(),this.updateRedPoint(),this.updateBtn()},e.prototype.updateAct=function(){this.isAct&&Activationtongyong.show(0,GlobalConfig.HeartMethodConfig[this.heartId].name,GlobalConfig.HeartMethodConfig[this.heartId].pic),this.isAct=!1},e.prototype.updateBtn=function(){this.leftBtn.visible=this.rightBtn.visible=!0;var t=this.getHeartId(this.heartPos-1),e=GlobalConfig.HeartMethodConfig[t];e?HeartMethod.ins().heartOpenCondition(t)||(this.redPoint2.visible=this.leftBtn.visible=!1):this.redPoint2.visible=this.leftBtn.visible=!1,t=this.getHeartId(this.heartPos+1),e=GlobalConfig.HeartMethodConfig[t],e?HeartMethod.ins().heartOpenCondition(t)||(this.redPoint3.visible=this.rightBtn.visible=!1):this.redPoint3.visible=this.rightBtn.visible=!1,t=this.getHeartId(this.heartPos),e=GlobalConfig.HeartMethodConfig[t];var i=e.openCondition?e.openCondition.zs:GlobalConfig.HeartMethodBaseConfig.zsLv;this.sysDescText0.text=e.openTips+"\n\n"+i+"转可学习"},e.prototype.updateState=function(){var t=this.getHeartId(this.heartPos),e=HeartMethod.ins().HeartMethodInfo[this.curRole];e&&e[t]&&e[t].id?HeartMethod.ins().isHeartMax(this.curRole,t)?this.currentState="max":e[t].isUp?this.currentState="stage":this.currentState="narmal":this.currentState="open",this.validateNow()},e.prototype.updatePower=function(){for(var t=this.getHeartId(this.heartPos),e=HeartMethod.ins().proShowList,i=HeartMethod.ins().calcHeartTotalValue(this.curRole,t),s=[],n=0;n<e.length;n++){var o=new AttributeData;o.type=e[n].id,o.value=i[n],s.push(o)}var a=UserBag.getAttrPower(s),r=HeartMethod.ins().HeartMethodInfo[this.curRole];if(r){var h=r[t];if(h){var l=GlobalConfig.HeartMethodLevelConfig[t][h.lv];if(l){var c=l.power?l.power:0;a+=c}}}var u=HeartMethod.ins().calcHeartSkillLevel(this.curRole,t);if(u){var p=GlobalConfig.HeartMethodSuitConfig[t][u],d=p.power?p.power:0;a+=d}this.powerPanel.setPower(a)},e.prototype.updateHeart=function(){var t=this.getHeartId(this.heartPos),e=HeartMethod.ins().HeartMethodInfo[this.curRole],i=GlobalConfig.HeartMethodConfig[t];if(i){this.bigIcon.source=i.pic,this.bigEff||(this.bigEff=new MovieClip),this.bigEff.parent||this.effGroup.addChild(this.bigEff);var s=HeartMethod.ins().calcHeartSkillLevel(this.curRole,t);if(s){var n=GlobalConfig.HeartMethodSuitConfig[t][s];this.bigEff.playFile(RES_DIR_EFF+n.inside,-1)}else this.bigEff.playFile(RES_DIR_EFF+i.inside,-1)}if(e&&e[t]?(this.heartmethodStage.visible=!0,this.heartmethodStage.setValue(e[t].stage),this.xinfaName.text=i?i.name:""):this.heartmethodStage.visible=!1,i&&e&&e[t]){for(var o=0;o<i.posList.length;o++){var a=i.posList[o],r=!1,h=HeartMethod.ins().getHeartSlotItemId(this.curRole,t,o+1);if(r=h?!0:!1,h){for(var l=!0,c=0;c<e[t].slots.length;c++){var u=e[t].slots[c],p=HeartMethod.ins().calcHeartSlotChange(this.curRole,t,u);r=p?!0:!1,!r&&u&&(r=HeartMethod.ins().calcHeartSlotCost(u));var d=GlobalConfig.HeartMethodStarConfig[u];if(d&&d.posId==a){l=!1,this["item"+(o+1)].data={itemid:u,redPoint:r};break}}l&&(ErrorLog.Assert(!l,"Bug定位:角色id:"+this.curRole+" 心法id:"+t+" 部位索引:"+(o+1)+" 部位id:"+a+" itemId:"+h+"数据异常"),this["item"+(o+1)].data=null)}else{var g=HeartMethod.ins().getHeartSlotItemIdWear(this.curRole,t,o+1);r=g?!0:!1,this["item"+(o+1)].data={blank:i.blankIcon[o],redPoint:r}}}var f=HeartMethod.ins().calcHeartAttrs(this.curRole,t),v=HeartMethod.ins().calcHeartAttrsNext(this.curRole,t);this.curAtt0.text=AttributeData.getAttStr(f,0,1,"："),this.nextAtt0.text=AttributeData.getAttStr(v,0,1,"：");var y=HeartMethod.ins().calcHeartCost(this.curRole,t);this.redPoint0.visible=!1,this.isHeartUp=!1;var m=void 0;if(y){this.costId=y.itemid;var T=this.getItemTxt0.text;this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+T),this.icon0.source=GlobalConfig.ItemConfig[y.itemid].icon+"_png",m=UserBag.ins().getBagItemById(y.itemid);var b="";m&&m.count>=y.count?(b="|C:0x00ff00&T:",this.redPoint0.visible=m.count>=GlobalConfig.HeartMethodStageConfig[t][e[t].stage].normalCostTip,this.isHeartUp=!0):b="|C:0xff0000&T:";var C=m?m.count:0;this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(""+b+C+"|C:0xD1C28F&T:/"+y.count)}this.redPoint0.visible||(this.redPoint0.visible=e[t].isUp?!0:!1),"max"==this.currentState?this.redPoint0.visible=!1:"narmal"==this.currentState&&this.conditionDesc&&(HeartMethod.ins().heartUpCondition(this.curRole,t)?this.costGroup0.visible=!0:this.costGroup0.visible=!1,this.conditionDesc.visible=!this.costGroup0.visible,this.conditionDesc.visible&&(this.redPoint0.visible=!1,this.conditionDesc.text="需要集齐"+i.upGradeCondition+"个心法部位,才能修炼")),this.starList||(this.starList=new StarList(10),this.starList.horizontalCenter=0,this.starList.y=0,this.starGroup.addChild(this.starList));var I=e[t].lv;I>0?this.starList.setStarNum(I%10==0?10:I%10):this.starList.setStarNum(0),I>0&&I%10==0&&(e[t].isUp?this.starList.setStarNum(10):this.starList.setStarNum(0))}},e.prototype.updateRedPoint=function(){var t=this.getHeartId(this.heartPos-1),e=this.getHeartId(this.heartPos+1),i=GlobalConfig.HeartMethodConfig[t];if(i){for(var s=!1,n=t;n>0&&(HeartMethod.ins().heartOpenCondition(n)&&(s=HeartMethodRedPoint.ins().checkHeartRedPoint(this.curRole,n)),!s);n--);this.redPoint2.visible=s}else this.redPoint2.visible=!1;var o=GlobalConfig.HeartMethodConfig[e];if(o){for(var s=!1,a=CommonUtils.getObjectLength(GlobalConfig.HeartMethodConfig),n=e;a>=n&&(HeartMethod.ins().heartOpenCondition(n)&&(s=HeartMethodRedPoint.ins().checkHeartRedPoint(this.curRole,n)),!s);n++);this.redPoint3.visible=s}else this.redPoint3.visible=!1;var r=this.getHeartId(this.heartPos);this.redPoint.visible=!1;var h=GlobalConfig.HeartMethodConfig[r];this.skill.source=h.skillButton},e.prototype.playIconTween=function(){this.showGroup.y=this.showGroupY,egret.Tween.removeTweens(this.bigIcon),egret.Tween.get(this.bigIcon,{loop:!0}).to({y:this.showGroupMoveY},1e3).to({y:this.showGroupY},1e3)},e.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.showGroup)},e}(BaseView);__reflect(HeartMethodWin.prototype,"HeartMethodWin");var Heirloom=function(t){function e(){var e=t.call(this)||this;return e.huntTimes=0,e.huntBoxInfo=[],e.huntHope=0,e.huntFreeTimes=0,e.huntRecords=[],e.upRequest=!1,e.sysId=PackageID.Heirloom,e.regNetMsg(1,e.postHeirloomInfo),e.regNetMsg(4,e.doHuntBack),e.regNetMsg(5,e.postHuntRecord),e.regNetMsg(7,e.postHuntBoxInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkRedPoint=function(){if(UserZs.ins().lv<3)return!1;for(var t=SubRoles.ins().subRolesLen,e=!1,i=0;t>i;i++){for(var s=SubRoles.ins().getSubRoleByIndex(i),n=0;8>n;n++){var o=s.heirloom.getInfoBySolt(n),a=void 0;a=o.lv?GlobalConfig.HeirloomEquipConfig[o.slot][o.lv]:GlobalConfig.HeirloomEquipFireConfig[n+1];var r=0,h=0;if(a){var l=a.expend;if(!l)continue;var c=UserBag.ins().getBagItemById(l.id);if(r=c?c.count:0,h=l.count,r>=h){e=!0;break}}}if(e)break}return e},e.prototype.sendHeirloomAdd=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendHeirloomAct=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendHeirloomUpLevel=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeByte(e),this.upRequest=!0,this.sendToServer(i)},e.prototype.postHeirloomInfo=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=t.readUnsignedByte(),n=SubRoles.ins().getSubRoleByIndex(e);n&&n.heirloom.update(i,s)},e.prototype.sendHunt=function(t){var e=this.getBytes(4);e.writeByte(t),this.sendToServer(e)},e.prototype.sendHuntRecord=function(){this.sendBaseProto(5)},e.prototype.sendHuntAward=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.doHuntBack=function(t){for(var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=[],n=0;i>n;n++)s[n]=[t.readInt(),t.readUnsignedByte()];ViewManager.ins().isShow(HuntResultWin)?this.postHuntResult(e,s,2):(ViewManager.ins().open(HuntResultWin,e,s,2),this.postHuntResult(e,s,2))},e.prototype.postHuntResult=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postHuntRecord=function(t){this.huntRecords=[];for(var e=t.readUnsignedByte(),i=0;e>i;i++)this.huntRecords[i]=[t.readString(),t.readInt()];this.huntRecords.reverse()},e.prototype.postHuntBoxInfo=function(t){var i=t.readInt();this.huntTimes=t.readInt(),this.huntHope=t.readInt(),this.huntFreeTimes=t.readShort();var s,n=0;for(var o in GlobalConfig.HeirloomTreasureRewardConfig)s=GlobalConfig.HeirloomTreasureRewardConfig[o],this.huntBoxInfo[n]=i>>s.id&1?e.ISNGET:this.huntTimes>=s.needTime?e.CANGET:e.UNGET,n++},e.prototype.getIsGetBox=function(){return-1!=this.huntBoxInfo.indexOf(e.CANGET)||this.huntFreeTimes>0},e.prototype.isHeirloomHuntOpen=function(){return UserZs.ins().lv>=GlobalConfig.HeirloomTreasureConfig.openZSlevel&&GameServer.serverOpenDay>=GlobalConfig.HeirloomTreasureConfig.openDay},e}(BaseSystem);Heirloom.UNGET=0,Heirloom.CANGET=1,Heirloom.ISNGET=2,__reflect(Heirloom.prototype,"Heirloom");var GameSystem;!function(t){t.heirloom=Heirloom.ins.bind(Heirloom)}(GameSystem||(GameSystem={}));var HeirloomData=function(){function t(){this.heirloomData=[]}return t.prototype.parser=function(t){for(var e=0;8>e;e++){var i=t.readInt();this.heirloomData[e]||(this.heirloomData[e]=new HeirloomInfo),this.heirloomData[e].setInfo(e+1,i)}},t.prototype.update=function(t,e){if(!(0>=t||t>8)){var i=this.heirloomData[t-1];i&&i.setInfo(t,e)}},t.prototype.getData=function(){return this.heirloomData},t.prototype.getInfoBySolt=function(t){if(t>=0&&8>t){var e=this.heirloomData[t];if(e)return e}return null},t.getInfoBySoltFirst=function(t){if(t>=0&&8>t){var e=GlobalConfig.HeirloomEquipConfig[t+1][1];return e}return null},t.getEquipName=function(t){var e="";switch(t+1){case HeirloomSlot.wq:e="武器";break;case HeirloomSlot.tk:e="头盔";break;case HeirloomSlot.yf:e="衣服";break;case HeirloomSlot.xl:e="项链";break;case HeirloomSlot.hw:e="护腕";break;case HeirloomSlot.yd:e="腰带";break;case HeirloomSlot.jz:e="戒指";break;case HeirloomSlot.xz:e="鞋子"}return e},t.prototype.getSuitConfig=function(t){for(var e=t.heirloom.getData(),i=0,s=!0,n=0;n<e.length;n++){var o=e[n];0==n&&(i=o.lv),!o.lv&&s&&(s=!1),o.lv<=i&&(i=o.lv)}var a;return s&&(a=GlobalConfig.HeirloomEquipSetConfig[i]),a},t}();__reflect(HeirloomData.prototype,"HeirloomData");var HeirloomSlot;!function(t){t[t.wq=1]="wq",t[t.tk=2]="tk",t[t.yf=3]="yf",t[t.xl=4]="xl",t[t.hw=5]="hw",t[t.yd=6]="yd",t[t.jz=7]="jz",t[t.xz=8]="xz"}(HeirloomSlot||(HeirloomSlot={}));var HeirloomInfo=function(){function t(){this.slot=0,this.lv=0,this.expend={id:0,count:0},this.attr=[],this.icon=0,this.name="",this.image="",this.model="",this.skillicon="",this.skillname="",this.skilldesc="",this.attr_add=0}return t.prototype.setInfo=function(t,e){if(t>0&&e>0){var i=GlobalConfig.HeirloomEquipConfig[t][e];Assert(i,"HeirloomInfo setInfo error! slot:"+t+",lv:"+e),this.slot=i.slot,this.lv=i.lv,this.expend=i.expend,this.attr=i.attr,this.icon=i.icon,this.name=i.name,this.image=i.image,this.model=i.model,this.skillicon=i.skillicon,this.skillname=i.skillname,this.skilldesc=i.skilldesc,this.attr_add=i.attr_add}},t}();__reflect(HeirloomInfo.prototype,"HeirloomInfo");var HeirloomCom=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomCom",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.curIndex=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserBag.ins().postItemDel,this.updateData),this.observe(UserBag.ins().postItemCountChange,this.updateData),this.observe(Heirloom.ins().postHeirloomInfo,this.updateData),this.addTouchEvent(this.rect,this.onClick),this.addTouchEvent(this.getItemTxt0,this.onClick),this.addTouchEvent(this.jihuo0,this.onClick);for(var i=0;8>i;i++)this.addTouchEvent(this["item"+i],this.onTap);this.initData()},e.prototype.initData=function(){this.model.visible=!1;for(var t=0;8>t;t++){var e=HeirloomData.getInfoBySoltFirst(t);this["item"+t].data={pos:t,info:e},this["item"+t].cleanEff()}this.item0.selectIcon.visible=!0;var i=HeirloomData.getInfoBySoltFirst(0);this.setModel(i),this.setCost(i)},e.prototype.updateData=function(){var t=this.curIndex,e=HeirloomData.getInfoBySoltFirst(t);this["item"+t].data={pos:t,info:e},this["item"+t].cleanEff(),this.setCost(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;8>i;i++)this.removeTouchEvent(this["pos"+i],this.onTap);this.removeTouchEvent(this.rect,this.onClick),this.removeTouchEvent(this.getItemTxt0,this.onClick),this.removeTouchEvent(this.jihuo0,this.onClick),this.removeObserve(),this.removeAni()},e.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni),this.modelAni=null},e.prototype.onClick=function(t){var e,i;switch(t.currentTarget){case this.rect:ViewManager.ins().close(this);break;case this.getItemTxt0:i=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1],ViewManager.ins().open(ShopGoodsWarn).setData(i.expend.id);break;case this.jihuo0:if(i=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1],(this.curIndex+1==HeirloomSlot.wq||this.curIndex+1==HeirloomSlot.yf)&&(e=UserBag.ins().getBagItemById(i.item)))return void UserTips.ins().showTips("|C:0x00ff00&T:已拥有该道具 请激活穿戴");e=UserBag.ins().getBagItemById(i.expend.id);var s=e?e.count:0;s>=i.expend.count?Heirloom.ins().sendHeirloomAdd(this.curIndex+1):UserTips.ins().showTips("材料不足")}},e.prototype.onTap=function(t){for(var e=0;8>e;e++)switch(this["item"+e].selectIcon.visible=!1,t.currentTarget){case this["item"+e]:if(this.curIndex==e){this["item"+e].selectIcon.visible=!0;break}this.curIndex=e,this["item"+e].selectIcon.visible=!0;var i=HeirloomData.getInfoBySoltFirst(e);this.setModel(i),this.setCost(i)}},e.prototype.setModel=function(t){var e="";if(t)return e=t.model,this.modelAni?void this.modelAni.playFile(RES_DIR_EFF+e,-1):(this.modelAni=new MovieClip,this.modelAni.playFile(RES_DIR_EFF+e,-1),this.modelAni.x=this.model.x+this.model.width/2,this.modelAni.y=this.model.y+this.model.height/2,void this.model.parent.addChildAt(this.modelAni,this.model.parent.getChildIndex(this.model)))},e.prototype.setCost=function(t){if(t){var e=GlobalConfig.HeirloomEquipItemConfig[t.slot],i=e.expend,s=GlobalConfig.ItemConfig[i.id];if(s){this.icon0.source=s.icon.toString()+"_png";var n=UserBag.ins().getBagItemById(i.id),o=n?n.count:0,a=o,r="";r=a>=i.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel0.textFlow=TextFlowMaker.generateTextFlow("<font color="+r+">"+a+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+i.count+"</font> ");var h="|U&T:获取宝钻";t.slot==HeirloomSlot.wq?h="|U&T:获取传世之刃":t.slot==HeirloomSlot.yf&&(h="|U&T:获取传世神甲"),this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow(h)}}},e}(BaseEuiView);__reflect(HeirloomCom.prototype,"HeirloomCom"),ViewManager.ins().reg(HeirloomCom,LayerManager.UI_Popup);var HeirloomDownItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.configID=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.itemConfig,e=GlobalConfig.HeirloomEquipItemConfig;for(var i in e)if(e[i].item==t.id){var s=e[i].pos,n=GlobalConfig.HeirloomEquipConfig[s][1];this.itemicon.data={pos:s,info:n},this.itemicon.cleanEff();var o=GlobalConfig.ItemConfig[e[i].downitem.id],a=o.name?o.name:"传世宝钻";this.desc.text=a+" x"+e[i].downitem.count;break}this.tip.visible=this.data.isSuggest,this.equipName.text=t.name,this.equipName.textColor=ItemConfig.getQualityColor(t)},e}(BaseItemRender);__reflect(HeirloomDownItemRenderer.prototype,"HeirloomDownItemRenderer");var HeirloomDownView=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomDownSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listData=new eui.ArrayCollection,this.equipList.itemRenderer=HeirloomDownItemRenderer,this.equipList.dataProvider=this.listData,this.gainList.itemRenderer=GainGoodsItem,this.goList=new eui.ArrayCollection,this.gainList.dataProvider=this.goList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.observe(UserBag.ins().postItemDel,this.updateData),this.observe(UserBag.ins().postItemCountChange,this.updateData),this.observe(UserBag.ins().postUseItemSuccess,this.updateData),this.addTouchEvent(this,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.curInfo=t[0],this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this,this.onTap),this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.removeObserve()},e.prototype.getHeirloomSource=function(){for(var t=UserBag.ins().getBagEquipsByQuality(5,UserBag.BAG_DESC_TYPE_HEIR,UserBag.BAG_TYPE_OTHTER),e=0;e<t.length;e++){t[e].isSuggest=!0;for(var i=0;3>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i);if(!s)break;var n=GlobalConfig.HeirloomEquipItemConfig,o=!1;for(var a in n)if(n[a].item==t[e]._configID){var r=n[a].pos,h=s.heirloom.getInfoBySolt(r-1);h&&h.lv>0?o=!1:(t[e].isSuggest=!1,o=!0);break}if(o)break}}return t.sort(function(t,e){var i=GlobalConfig.ItemConfig[t.configID],s=GlobalConfig.ItemConfig[e.configID];return 1==t.isSuggest&&0==e.isSuggest?1:0==t.isSuggest&&1==e.isSuggest?-1:i.id<s.id?1:i.id>s.id?-1:0}),t},e.prototype.getHeirloomGoSource=function(){if(this.itemList)return this.itemList;var t,e=UserBag.ins().getBagItemById(200141);if(e)t=GlobalConfig.GainItemConfig[e._configID];else{if(!this.curInfo)return this.itemList;var i=0;i=this.curInfo.expend?this.curInfo.expend.id:GlobalConfig.HeirloomEquipConfig[this.curInfo.slot][this.curInfo.lv-1].expend.id,t=GlobalConfig.GainItemConfig[i]}return t?(this.gainList.dataProvider=new eui.ArrayCollection(t.gainWay),this.itemList=t.gainWay):(this.gainList.dataProvider=new eui.ArrayCollection([]),this.itemList=[]),this.itemList},e.prototype.updateData=function(){var t,e;t=this.getHeirloomSource(),e=this.getHeirloomGoSource(),e=e?e:[],this.listData.source=t,this.goList.source=e;var i=e.length;this.refushPos(i)},e.prototype.refushPos=function(t){this.contrain.height=60*t,this.equipScroller.height=310+60*(3-t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button)switch(t.target.name){case"breakDown":this.onHandler(t.target.parent.data)}}},e.prototype.onHandler=function(t){for(var e=[t],i=0;i<e.length&&(!e[i]||!UserBag.ins().sendUseItem(e[i]._configID,e[i].count));i++);},e.prototype.onGo=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2]),ViewManager.ins().close(this))}},e}(BaseEuiView);__reflect(HeirloomDownView.prototype,"HeirloomDownView"),ViewManager.ins().reg(HeirloomDownView,LayerManager.UI_Popup);var HeirloomEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomitemtips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.index=t[1],this.curRole&&this.curRole.heirloom&&(this.info=this.curRole.heirloom.getInfoBySolt(this.index)),this.info&&this.info.lv||(this.info=GlobalConfig.HeirloomEquipConfig[this.index+1][1]),this.addTouchEndEvent(this.bgClose,this.onClick),this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.init=function(){this.equipItem.data={pos:this.index,info:this.info},this.equipItem.setTipsVisible(),this.equipName.text=this.info.name,this.slot.text=HeirloomData.getEquipName(this.index);var t=this.setBasicsDesc();this.setSpecialDesc(),this.setSkillDesc();var e=Math.floor(UserBag.getAttrPower(t));this.power.text="评分:"+e,this.curRole&&(e=this.curRole.getHeirloomSlotPower(this.index)),this.powerPanel.setPower(e)},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.setBasicsDesc=function(){for(var t=[],e=0;e<this.info.attr.length&&!(e>3);e++){var i=new AttributeData,s=this.info.attr[e],n=AttributeData.getAttrStrByType(s.type);n+="+"+s.value,this["value"+e].text=n,i.type=s.type,i.value=s.value,t.push(i)}return t},e.prototype.setSpecialDesc=function(){for(var t=4;t<this.info.attr.length;t++)if(this["value"+t]){var e=this.info.attr[t],i=AttributeData.getAttrStrByType(e.type);i+="+"+e.value,this["value"+t].text=i}var s=HeirloomData.getEquipName(this.index);s+="部件所有属性+"+this.info.attr_add+"%",this.value6.text=s},e.prototype.setSkillDesc=function(){var t="";t=this.info.skillname?this.info.skillname+"\n"+this.info.skilldesc:"无",this.skilldesc.textFlow=TextFlowMaker.generateTextFlow1(t)},e}(BaseEuiView);__reflect(HeirloomEquipTipsWin.prototype,"HeirloomEquipTipsWin"),ViewManager.ins().reg(HeirloomEquipTipsWin,LayerManager.UI_Popup);var HeirloomSkillItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="heirloomTipsSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2];this.addTouchEndEvent(this,this.onClick),this.setData(i,s,n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t,e,i){this.itemIcon.setSkillData(t),this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(e),this.description.textFlow=TextFlowMaker.generateTextFlow1(i)},e}(BaseEuiView);__reflect(HeirloomSkillItem.prototype,"HeirloomSkillItem"),ViewManager.ins().reg(HeirloomSkillItem,LayerManager.UI_Popup);var HeirloomSuit=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomSuit",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.model1=new MovieClip,this.model1.x=this.eff1.x,this.model1.y=this.eff1.y,this.eff1.parent.addChild(this.model1),this.model2=new MovieClip,this.model2.x=this.eff2.x,this.model2.y=this.eff2.y,this.eff2.parent.addChild(this.model2)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onClick);var i=t[0];this.curRole=SubRoles.ins().getSubRoleByIndex(i),this.setData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),DisplayUtils.removeFromParent(this.model1),DisplayUtils.removeFromParent(this.model2),this.model1=null,this.model2=null},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(){var t=this.curRole.heirloom.getData();if(!t)return null;var e=this.getMinEquipLv(t),i=this.getInfoMation(t,e);this.setCurSuit(e,i.str1,i.lv1),this.setNextSuit(e,i.str2,i.lv2)},e.prototype.setCurSuit=function(t,e,i){if(!t){for(var s=0;8>s;s++)this["desc"+s].visible=!1,this["attr"+s].visible=!1;return this.informationname0.visible=!1,this.num0.visible=!1,void(this.name0.text="当前没有激活套装效果")}this.informationname0.textFlow=TextFlowMaker.generateTextFlow(e);for(var n=t?t:1,o=GlobalConfig.HeirloomEquipSetConfig[n],s=0;s<o.attr.length;s++){var a=o.attr[s];8>i&&(this["attr"+s].textColor=ColorUtil.GRAY_COLOR2,this["desc"+s].textColor=ColorUtil.GRAY_COLOR2),this["desc"+s].text=this.getAttrName(a.type);var r=a.value;a.type==AttributeType.atCritEnhance&&(r+=15e3);var h="+"+r;s>=4&&(r/=100,h="+"+r+"%"),this["attr"+s].text=h,this["attr"+s].x=this["desc"+s].x+this["desc"+s].width}for(var s=o.attr.length;8>s;s++)this["cgroup"+s].visible=!1;this.name0.text=o.name,this.num0.text="（"+i+"/8）",this.model1.playFile(RES_DIR_EFF+o.neff,-1)},e.prototype.setNextSuit=function(t,e,i){this.informationname1.textFlow=TextFlowMaker.generateTextFlow(e);var s=t?t+1:1,n=GlobalConfig.HeirloomEquipSetConfig[s];if(n){for(var o=0;o<n.attr.length;o++){var a=n.attr[o];this["ndesc"+o].text=this.getAttrName(a.type);var r=a.value;a.type==AttributeType.atCritEnhance&&(r+=15e3);var h="+"+r;o>=4&&(r/=100,h="+"+r+"%"),this["nattr"+o].text=h,this["nattr"+o].x=this["ndesc"+o].x+this["ndesc"+o].width}for(var o=n.attr.length;8>o;o++)this["ngroup"+o].visible=!1;this.name1.text=n.name,this.num1.text="（"+i+"/8）",this.model2.playFile(RES_DIR_EFF+n.neff,-1)}else{this.name1.text="没有下级可预览",this.num1.visible=!1,this.informationname1.visible=!1;for(var o=0;8>o;o++)this["ngroup"+o].visible=!1}},e.prototype.getInfoMation=function(t,e){for(var i="",s="",n=0,o=0,a=e?e+1:1,r=0;r<t.length;r++){var h=t[r],l=HeirloomData.getEquipName(r);h.lv?(h.lv>=e?(n++,i+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+l+"|   "):i+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"|   ",h.lv>=a?(o++,s+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+l+"|   "):s+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"|   "):(i+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"|   ",s+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"|   ")}return{str1:i,str2:s,lv1:n,lv2:o}},e.prototype.getMinEquipLv=function(t){for(var e=0,i=!0,s=0;s<t.length;s++){var n=t[s];0==s&&(e=n.lv),!n.lv&&i&&(i=!1),n.lv<=e&&(e=n.lv)}if(!i)for(var s=0;8>s;s++)this["desc"+s].textColor=ColorUtil.GRAY_COLOR2,this["attr"+s].textColor=ColorUtil.GRAY_COLOR2;return e},e.prototype.getAttrName=function(t){var e="";switch(t){case AttributeType.atAttack:e="攻击";break;case AttributeType.atMaxHp:e="生命";break;case AttributeType.atDef:e="物防";break;case AttributeType.atRes:e="魔防";break;case AttributeType.atRoleDamageEnhance:e="攻击玩家伤害加深";break;case AttributeType.atRoleDamageReduction:e="受到玩家伤害减免";break;case AttributeType.atCritEnhance:e="暴击伤害加强";break;case AttributeType.atPenetrate:e="穿透（无视防御）"}return e},e}(BaseEuiView);__reflect(HeirloomSuit.prototype,"HeirloomSuit"),ViewManager.ins().reg(HeirloomSuit,LayerManager.UI_Popup);var HeirloomWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloom",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.icon0.visible=!1,this.curIndex=0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return UserZs.ins().lv<3?(UserTips.ins().showTips("传世装备3转开启"),!1):!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t?t[0]:0;this.roleSelect.setCurRole(i),this.observe(UserBag.ins().postItemDel,this.updateData),this.observe(UserBag.ins().postItemCountChange,this.updateData),this.observe(Heirloom.ins().postHeirloomInfo,this.updateData),this.addChangeEvent(this.roleSelect,this.switchRole);for(var s=0;8>s;s++)this.addTouchEvent(this["pos"+s],this.onTap);this.addTouchEvent(this.rightBtn,this.onClick),this.addTouchEvent(this.leftBtn,this.onClick),this.addTouchEvent(this.getItemTxt,this.onClick),this.addTouchEvent(this.jihuo,this.onClick),this.addTouchEvent(this.attrSet,this.onClick),this.addTouchEvent(this.neatSet,this.onClick),this.addTouchEvent(this.skill,this.onSkill),this.addTouchEvent(this.icon0.parent,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.initData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;8>i;i++)this.removeTouchEvent(this["pos"+i],this.onTap);this.removeTouchEvent(this.rightBtn,this.onClick),this.removeTouchEvent(this.leftBtn,this.onClick),this.removeTouchEvent(this.getItemTxt,this.onClick),this.removeTouchEvent(this.jihuo,this.onClick),this.removeTouchEvent(this.attrSet,this.onClick),this.removeTouchEvent(this.neatSet,this.onClick),this.removeTouchEvent(this.skill,this.onSkill),this.roleSelect.removeEventListener(egret.Event.CHANGE,this.switchRole,this),this.removeTouchEvent(this.icon0.parent,this.onClick),this.removeTouchEvent(this.closeBtn,this.onClick),this.removeObserve(),this.removeAni(),this.clearEff()},e.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni),this.modelAni=null},e.prototype.onSkill=function(t){switch(t.currentTarget){case this.skill:ViewManager.ins().open(HeirloomSkillItem,this.skill.itemIcon.imgIcon.source,this.skill.skillname,this.skill.skilldesc)}},e.prototype.onClick=function(t){switch(t.target){case this.leftBtn:this.leftBtn.visible=!1,this.rightBtn.visible=!0,this.pre();break;case this.rightBtn:this.rightBtn.visible=!1,this.leftBtn.visible=!0,this.next();break;case this.getItemTxt:var i=0;
if("获取传世之刃"==this.getItemTxt.text?i=HeirloomSlot.wq:"获取传世神甲"==this.getItemTxt.text&&(i=HeirloomSlot.yf),i){var s=GlobalConfig.HeirloomEquipItemConfig[i];return void ViewManager.ins().open(ShopGoodsWarn).setData(s.item)}if("合成道具"==this.getItemTxt.text)ViewManager.ins().open(HeirloomCom);else{var n=this.roleSelect.getCurRole(),o=SubRoles.ins().getSubRoleByIndex(n),a=o.heirloom.getInfoBySolt(this.curIndex);ViewManager.ins().open(HeirloomDownView,a)}break;case this.jihuo:var r=this.getInitInfo(),h=this.roleSelect.getCurRole(),l=SubRoles.ins().getSubRoleByIndex(h),c=l.heirloom.getInfoBySolt(this.curIndex),u=this.curIndex+1;if(c&&c.lv>0){var p=this.check(r);if(p==e.Heir_TIPS_1)Heirloom.ins().sendHeirloomUpLevel(h,u);else if(p==e.Heir_TIPS_2)UserTips.ins().showTips("已满级");else{var s=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];ViewManager.ins().open(ShopGoodsWarn).setData(s.expend.id)}}else{var p=this.check(r);if(p==e.Heir_TIPS_1)Heirloom.ins().sendHeirloomAct(h,u);else{var s=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];ViewManager.ins().open(ShopGoodsWarn).setData(s.item)}}break;case this.attrSet:var d=this.roleSelect.getCurRole();ViewManager.ins().open(RoleAttrWin,d);break;case this.neatSet:var g=this.roleSelect.getCurRole();ViewManager.ins().open(HeirloomSuit,g);break;case this.icon0.parent:var f=this.roleSelect.getCurRole(),v=SubRoles.ins().getSubRoleByIndex(f);ViewManager.ins().open(HeirloomEquipTipsWin,v,this.curIndex);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.pre=function(){var t=this.getInitInfo();this.setHeirloom(this.curIndex,e.Heir_LRBtn,t)},e.prototype.next=function(){var t=this.getInitInfo(),i=this.curIndex+1,s=t.lv?t.lv+1:t.lv+2,n=this.getSlotInfoByLv(i,s);this.setHeirloom(this.curIndex,e.Heir_LRBtn,n)},e.prototype.onTap=function(t){for(var i=this.roleSelect.getCurRole(),s=SubRoles.ins().getSubRoleByIndex(i),n=0;8>n;n++)switch(this["pos"+n].setSelectIconVisible(!1),t.currentTarget){case this["pos"+n]:if(this.curIndex==n){this["pos"+n].setSelectIconVisible(!0),ViewManager.ins().open(HeirloomEquipTipsWin,s,n);break}this.curIndex=n,this.setHeirloom(n,e.Heir_Select),this["pos"+n].setSelectIconVisible(!0)}},e.prototype.updateData=function(){var t=Heirloom.ins().upRequest;this.setHeirloom(this.curIndex,e.Heir_Select,null,t),t&&(Heirloom.ins().upRequest=!1),this.setSuitLvIcon(),this.setRedPoint(),this.updateRedPoint(),this.setPower();var i=EntityManager.ins().getMainRole(this.roleSelect.getCurRole());i&&i.setHeirloomSuitEff()},e.prototype.updateRedPoint=function(){for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){for(var i=!1,s=0;8>s;s++){var n=this.getInitInfoEx(e,s),o=void 0;o=n.lv?GlobalConfig.HeirloomEquipConfig[n.slot][n.lv]:GlobalConfig.HeirloomEquipFireConfig[s+1];var a=0,r=0;if(o){var h=o.expend;if(!h)continue;var l=UserBag.ins().getBagItemById(h.id);a=l?l.count:0,r=h.count}if(a>=r){i=!0;break}i=!1}this.roleSelect.showRedPoint(t,i)}}},e.prototype.initData=function(){for(var t=this.getInitInfo(),i=0;8>i;i++)this.setHeirloom(i,e.Heir_Init,t);this.pos0.setSelectIconVisible(!0),this.setSuitLvIcon(),this.setRedPoint(),this.setPower(),this.updateRedPoint()},e.prototype.switchRole=function(){this.curIndex=0,this.initData()},e.prototype.setHeirloom=function(t,i,s,n){var o;if(i==e.Heir_Init)o=s;else if(i==e.Heir_Select){if(o=this.getInitInfo(t),!o.lv){var a=GlobalConfig.HeirloomEquipConfig[t+1][1];o.skillname=a.skillname,o.skilldesc=a.skilldesc,o.skillicon=a.skillicon,o.name=a.name}}else o=s;if(o&&(this.setModel(i,t,o),this.setUI(i,t,o),this.setDesc(i,t,o),this.setCost(i,t,o)),i!=e.Heir_LRBtn){if(i==e.Heir_Init&&t>0&&(o=this.getInitInfo(t)),!o.lv){var a=GlobalConfig.HeirloomEquipConfig[t+1][1];o.name=a.name}this["pos"+t].selectIcon.visible=!1,this["pos"+t].data={pos:t,info:o,uplevel:n}}if(i==e.Heir_Init&&0==t||i==e.Heir_LRBtn||i==e.Heir_Select){var a=GlobalConfig.HeirloomEquipConfig[t+1][1];o.skillicon&&(a=o),a.skillicon&&(this.skill.visible=!0,this.skill.data={pos:t,info:o,icon:a.skillicon,skillname:a.skillname,skilldesc:a.skilldesc},this.skill.cleanEff())}},e.prototype.setUI=function(t,i,s){var n;if(t==e.Heir_Init){if(i>0)return}else if(t==e.Heir_Select){if(this.curIndex!=i)return}else if(t==e.Heir_LRBtn)return void(this.itemName.text=s.name);if(n=s,n.expend&&n.lv?this.rightBtn.visible=!0:this.rightBtn.visible=!1,this.leftBtn.visible=!1,t==e.Heir_LRBtn&&(n=this.getInitInfo()),n.lv>0){this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow("|U&T:分解道具"),this.jihuo.label="升  级";var o=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1],a=UserBag.ins().getBagItemById(o.item);a?this.setEff():this.clearEff()}else{this.clearEff();var r="合成道具",o=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];if(o.pos==HeirloomSlot.wq){var a=UserBag.ins().getBagItemById(o.item);a&&(r="获取传世之刃")}else if(o.pos==HeirloomSlot.yf){var a=UserBag.ins().getBagItemById(o.item);a&&(r="获取传世神甲")}this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow("|U&T:"+r),this.jihuo.label="激  活"}n.skillicon?(this.skill.visible=!0,this.skill.data={pos:i,info:n,icon:n.skillicon,skillname:n.skillname,skilldesc:n.skilldesc},this.skill.cleanEff()):this.skill.visible=!1,this.itemName.text=n.name},e.prototype.setEff=function(){this.resolveMc||(this.resolveMc=new MovieClip),this.resolveMc.parent||(this.getItemTxt.parent.addChild(this.resolveMc),this.resolveMc.playFile(RES_DIR_EFF+"chargeff1",-1),this.resolveMc.touchEnabled=!1,this.resolveMc.scaleY=.6,this.resolveMc.scaleX=.6),this.resolveMc.x=this.getItemTxt.x+38,this.resolveMc.y=this.getItemTxt.y+9},e.prototype.clearEff=function(){DisplayUtils.removeFromParent(this.resolveMc)},e.prototype.setModel=function(t,i,s){var n,o="";if(t==e.Heir_Init){if(i>0)return}else if(t==e.Heir_Select&&this.curIndex!=i)return;if(this.removeAni(),n=s,n&&n.lv>0)o=n.model;else{var a=GlobalConfig.HeirloomEquipConfig[i+1][1];o=a.model}return this.modelAni?void this.modelAni.playFile(RES_DIR_EFF+o,-1):(this.modelAni=new MovieClip,this.modelAni.playFile(RES_DIR_EFF+o,-1),this.modelAni.x=this.icon0.x+this.icon0.width/2,this.modelAni.y=this.icon0.y+this.icon0.height/2,void this.icon0.parent.addChildAt(this.modelAni,this.icon0.parent.getChildIndex(this.icon0)))},e.prototype.setDesc=function(t,i,s){var n;if(t==e.Heir_Init){if(i>0)return}else if(t==e.Heir_Select&&this.curIndex!=i)return;n=s;var o,a=[];n&&n.lv>0?a=n.attr:(o=GlobalConfig.HeirloomEquipConfig[i+1][1],a=o.attr);for(var r=0;6>r;r++)switch(a[r].type){case AttributeType.atAttack:this.desc0.text="攻击",this.attr0.text="+"+a[r].value;break;case AttributeType.atMaxHp:this.desc1.text="生命",this.attr1.text="+"+a[r].value;break;case AttributeType.atDef:this.desc2.text="物防",this.attr2.text="+"+a[r].value;break;case AttributeType.atRes:this.desc3.text="法防",this.attr3.text="+"+a[r].value;break;case AttributeType.atCrit:case AttributeType.atCritHurt:this.desc4.text="暴击",this.attr4.text="+"+a[r].value;break;case AttributeType.cruNeiGong:case AttributeType.maxNeiGong:this.desc5.text="内功",this.attr5.text="+"+a[r].value}var h=n.slot?n.slot:o.slot,l="";switch(h){case HeirloomSlot.wq:l="武器";break;case HeirloomSlot.tk:l="头盔";break;case HeirloomSlot.yf:l="衣服";break;case HeirloomSlot.xl:l="项链";break;case HeirloomSlot.hw:l="手镯";break;case HeirloomSlot.yd:l="腰带";break;case HeirloomSlot.jz:l="戒指";break;case HeirloomSlot.xz:l="鞋子"}var c=n.attr_add?n.attr_add:o.attr_add;this.desc6.text=l+"部件所有属性",this.attr6.text="+"+c+"%",this.attr6.x=this.desc6.x+this.desc6.width+20},e.prototype.setCost=function(t,i,s){var n;if(t==e.Heir_Init){if(i>0)return;n=s}else if(t==e.Heir_Select){if(this.curIndex!=i)return;n=s}else t==e.Heir_LRBtn&&(n=this.getInitInfo());var o;if(o=n.lv>0?GlobalConfig.HeirloomEquipConfig[n.slot][n.lv]:GlobalConfig.HeirloomEquipFireConfig[i+1]){var a=o.expend;if(this.jihuo.visible=!0,this.expendLabel.text="消耗: ",!a)return this.expendLabel.text="",this.countLabel.text="已满级",void(this.jihuo.visible=!1);var r=GlobalConfig.ItemConfig[a.id];if(!r)return;this.icon.source=r.icon.toString()+"_png";var h=UserBag.ins().getBagItemById(a.id),l=h?h.count:0,c="";c=l>=a.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+c+">"+l+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+a.count+"</font> ")}},e.prototype.check=function(t){var i,s=0,n=0;if(i=t.lv>0?GlobalConfig.HeirloomEquipConfig[t.slot][t.lv]:GlobalConfig.HeirloomEquipFireConfig[this.curIndex+1]){var o=i.expend;if(!o)return e.Heir_TIPS_2;var a=GlobalConfig.ItemConfig[o.id];if(!a)return e.Heir_TIPS_0;var r=UserBag.ins().getBagItemById(o.id);s=r?r.count:0,n=o.count}return s>=n?e.Heir_TIPS_1:e.Heir_TIPS_0},e.prototype.getInitInfoEx=function(t,e){var i=e,s=t.heirloom.getInfoBySolt(i);return s},e.prototype.getInitInfo=function(t){var e=null!=t?t:this.curIndex,i=this.roleSelect.getCurRole(),s=SubRoles.ins().getSubRoleByIndex(i),n=s.heirloom.getInfoBySolt(e);return n},e.prototype.getSlotInfoByLv=function(t,e){var i=this.roleSelect.getCurRole(),s=(SubRoles.ins().getSubRoleByIndex(i),GlobalConfig.HeirloomEquipConfig[t][e]);return s},e.prototype.setSuitLvIcon=function(){for(var t=this.roleSelect.getCurRole(),e=SubRoles.ins().getSubRoleByIndex(t),i=e.heirloom.getData(),s=0,n=!0,o=0;o<i.length;o++){var a=i[o];0==o&&(s=a.lv),!a.lv&&n&&(n=!1),a.lv<=s&&(s=a.lv)}this.neatSet.currentState=s.toString()},e.prototype.setRedPoint=function(){for(var t=!1,e=0;8>e;e++){var i=this.getInitInfo(e),s=void 0;s=i.lv?GlobalConfig.HeirloomEquipConfig[i.slot][i.lv]:GlobalConfig.HeirloomEquipFireConfig[e+1];var n=0,o=0;if(s){var a=s.expend;if(!a){this["pos"+e].redPoint.visible=!1;continue}var r=UserBag.ins().getBagItemById(a.id);n=r?r.count:0,o=a.count}if(n>=o?this["pos"+e].redPoint.visible=!0:this["pos"+e].redPoint.visible=!1,!this["pos"+e].redPoint.visible){var h=GlobalConfig.HeirloomEquipItemConfig[s.slot],r=UserBag.ins().getBagItemById(h.item);this["pos"+e].redPoint.visible=r?!0:!1}t||(t=this["pos"+e].redPoint.visible)}if(t){var l=this.roleSelect.getCurRole();this.roleSelect.showRedPoint(l,t)}},e.prototype.setPower=function(){var t=this.roleSelect.getCurRole(),e=SubRoles.ins().getSubRoleByIndex(t).getAllHeirloomPower();this.powerPanel.setPower(e)},e}(BaseEuiView);HeirloomWin.Heir_Init=1,HeirloomWin.Heir_Select=2,HeirloomWin.Heir_LRBtn=3,HeirloomWin.Heir_TIPS_0=0,HeirloomWin.Heir_TIPS_1=1,HeirloomWin.Heir_TIPS_2=2,__reflect(HeirloomWin.prototype,"HeirloomWin"),ViewManager.ins().reg(HeirloomWin,LayerManager.UI_Main);var HejiProgressData=function(){function t(){this.id=0,this.progress=0}return t.prototype.parser=function(t){this.id=t.readByte(),this.progress=t.readUnsignedInt()},t}();__reflect(HejiProgressData.prototype,"HejiProgressData");var HejiUseMgr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.register=function(t){this.root=t,this.reset(),this.root.getSkillLvl()&&this.start()},e.prototype.unregister=function(t){this.root=null,this.reset(),this.stop()},e.prototype.start=function(){this.stop(),TimerManager.ins().doTimer(1e3,0,this.updateTime,this)},e.prototype.stop=function(){TimerManager.ins().remove(this.updateTime,this)},e.prototype.updateTime=function(){this.cool>0&&(this.cool-=1)},e.prototype.getSkillData=function(){if(!this.root.getSkillLvl())return null;var t=GlobalConfig.TogetherHitConfig[this.root.getSkillLvl()],e=this.getRoles()[0];if(!e)return null;if(!Assert(t,"使用合击，合击等级："+this.root.getSkillLvl())){var i=GlobalConfig.SkillsConfig[t.skill_id[e.job-1]];return new SkillData(i.id)}},e.prototype.getRoles=function(){return this.root.getRoles()||[]},e.prototype.getMaster=function(){for(var t=this.getRoles(),e=0;e<t.length;e++)if(t[e].getAtt(AttributeType.atHp)>0)return EntityManager.ins().getEntityByHandle(t[e].handle);return null},e.prototype.canUse=function(){return this.cool<=0},e.prototype.useSuccess=function(){this.cool=60},e.prototype.reset=function(){this.cool=7},e}(BaseClass);__reflect(HejiUseMgr.prototype,"HejiUseMgr");var PunchEquipListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchEquipChangeSkinItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.itemConfig){var t=this.data,e=(t.att,GlobalConfig.EquipConfig[t.configID]),i="",s="";this.now.visible=!1;var n=0;for(var o in AttributeData.translate)if(e[o]&&!(e[o]<=0)){var a=new AttributeData(AttributeData.translate[o],e[o]),r="";r=AttributeData.getAttStrByType(a,0,"  "),i+=n%2==0?StringUtils.complementByChar(r,32):r+"\n",n++}this.attr1.textFlow=(new egret.HtmlTextParser).parser(i),s=e.baseAttr1?AttributeData.getAttStrByType(e.baseAttr1,1,""):AttributeData.getExtAttStrByType(e.exAttr1,1,""),this.attr2.text=s,this.changeBtn.visible=!0,this.nameTxt.text=t.itemConfig.name}},e.prototype.setBtnStatu=function(){this.changeBtn.visible=!1,this.now.visible=!0},e}(eui.ItemRenderer);__reflect(PunchEquipListItem.prototype,"PunchEquipListItem");var PunchEquipAttrWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchEquipAttrSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.setView=function(){for(var t=[],e=[],i=0;8>i;i++){var s=UserSkill.ins().equipListData[i];for(var n in s.att)if(0!=s.att[n].type&&0!=s.att[n].value){var o=s.att[n];t[o.type]?t[o.type]+=o.value:t[o.type]=o.value}if(s.configID){var a=GlobalConfig.EquipConfig[s.configID];for(var r in AttributeData.translate)if(a[r]&&!(a[r]<=0)){var h=Role.getAttrTypeByName(r);t[h]?t[h]+=a[r]:t[h]=a[r]}a.baseAttr1&&(t[a.baseAttr1.type]?t[a.baseAttr1.type]+=a.baseAttr1.value:t[a.baseAttr1.type]=a.baseAttr1.value),a.baseAttr2&&(t[a.baseAttr2.type]?t[a.baseAttr2.type]+=a.baseAttr2.value:t[a.baseAttr2.type]=a.baseAttr2.value),a.exAttr1&&(e[a.exAttr1.type]?e[a.exAttr1.type]+=a.exAttr1.value:e[a.exAttr1.type]=a.exAttr1.value),a.exAttr2&&(e[a.exAttr2.type]?e[a.exAttr2.type]+=a.exAttr2.value:e[a.exAttr2.type]=a.exAttr2.value)}}var l="",c="",u=0,p=0;for(var d in t){if(p=Number(d),u=t[d],c=AttributeData.getAttrStrByType(p),c.length<3&&(c=AttributeData.inserteBlank(c,4)),p>1&&9>p)l+=7==p||8==p?c+"："+u/100+"%":c+"："+u;else{if(!(p>12&&15>p||p>15))continue;l+=p==AttributeType.atCritEnhance?c+"："+(u/100+150)+"%":c+"："+u/100+"%"}l+="\n"}for(var d in e)p=Number(d),u=e[d],c=AttributeData.getExtAttrStrByType(p),l+=c+"："+u/100+"%",l+="\n";""==l&&(l="无"),this.baseAttr.text=l,this.anigroup.height=this.baseAttr.height+150},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchEquipAttrWin.prototype,"PunchEquipAttrWin"),ViewManager.ins().reg(PunchEquipAttrWin,LayerManager.UI_Popup);var PunchEquipChooseWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchEquipChangeSkin",this.list.itemRenderer=PunchEquipListItem,this.wearItem=new PunchEquipListItem,this.itemGroup.addChild(this.wearItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.pos=t[0];var i=t[1],s=UserSkill.ins().equipListData[this.pos];this.wearItem.data=s,this.wearItem.setBtnStatu(),this.itemList=UserBag.ins().getHejiEquipsByType(this.pos),this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemTap,this),this.addTouchEvent(this.bgClose,this.onTap),this.observe(UserSkill.ins().postHejiEquipChange,this.changeEquipSuccess),1==i?(this.scroll.y=232,this.scroll.height=410,this.wearItem.visible=!0):(this.scroll.y=50,this.scroll.height=590,this.wearItem.visible=!1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemTap,this),this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.changeEquipSuccess=function(){ViewManager.ins().close(e)},e.prototype.itemTap=function(t){var e=UserSkill.ins().equipListData[this.pos],i=t.item;if(e){if(e.itemConfig&&i.itemConfig.useCond!=e.itemConfig.id){var s=GlobalConfig.ItemConfig[e.itemConfig.id+10];return void UserTips.ins().showTips("|C:0xff0000&T:请先更换"+s.name)}}else if(i.itemConfig.useCond){var s=GlobalConfig.ItemConfig[91e4+this.pos+1];return void UserTips.ins().showTips("|C:0xff0000&T:必须装备前一个等级的符文，才可进行装备")}var n=i.itemConfig.level?i.itemConfig.level:0,o=i.itemConfig.zsLevel?i.itemConfig.zsLevel:0;return o>UserZs.ins().lv||n>Actor.level?void UserTips.ins().showTips("|C:0xff0000&T:符文需要"+o+"转"+n+"级可进行装备"):void UserSkill.ins().sendDressHejiEquip(i.handle,this.pos)},e.prototype.onTap=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchEquipChooseWin.prototype,"PunchEquipChooseWin"),ViewManager.ins().reg(PunchEquipChooseWin,LayerManager.UI_Main);var PunchEquipDetailWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offY=150,e.data=null,e.duanwei=["高","初","中"],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchEquipTipsSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.forgeGroup.visible=t[1],this.forgeGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.observe(UserSkill.ins().postHejiEquipChange,this.refushInfo),this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.forgeGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.removeObserve()},e.prototype.refushInfo=function(){var t,e="",i="";t=this.data.itemConfig;var s=0;s=this.data.point,this.score.text="评分："+s;var n=0;this.powerPanel.setPower(Math.floor(s*(100+n)/100));for(var o=this.data.att,a=0;a<o.length;a++)if(0!=o[a].type){var r=AttributeData.getAttrNameByAttrbute(o[a],!0);e+=r+"\n"}for(var h=this.data.extAtt,l=!1,c=0;c<h.length;c++)if(0!=h[c].type){l=!0;var r=AttributeData.getAttrNameByAttrbute(h[c],!0);i+=r+"\n"}l?(this.tupoDesc.visible=!0,this.group.height=600,this.forgeGroup.y=530):(this.tupoDesc.visible=!1,this.group.height=600-this.offY,this.forgeGroup.y=530-this.offY),this.desc1.text="基础属性:",this.nameLabel.text=t.name,this.nameLabel.textColor=ItemConfig.getQualityColor(t),this.itemIcon.setData(t);t.level%3;this.lv.text=t.zsLevel>0?"等级："+t.zsLevel+"转":"等级："+t.level+"级",this.attr1.text=e,this.attr0.text=i},e.prototype.onTap=function(t){switch(t.target){case this.forgeGroup:ViewManager.ins().close(e),ViewManager.ins().open(PunchEquipChooseWin,this.data.itemConfig.subType,1);break;default:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(PunchEquipDetailWin.prototype,"PunchEquipDetailWin"),ViewManager.ins().reg(PunchEquipDetailWin,LayerManager.UI_Main);var PunchEquipForge=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){var t=this.getItemTxt.text;this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+t),this.maxPos=8,this.mcs=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.getItemTxt,this.onClick),this.addTouchEvent(this.btn,this.onClick),this.observe(UserSkill.ins().postUpgradeForge,this.UpgradeForgeCallback),this.observe(UserEquip.ins().postSmeltEquipComplete,this.callback),this.updateDate()},e.prototype.callback=function(){this.updateDate()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.getItemTxt,this.onClick),this.removeTouchEvent(this.btn,this.onClick),DisplayUtils.removeFromParent(this.mc);for(var i=0;i<this.mcs.length;i++)DisplayUtils.removeFromParent(this.mcs[i])},e.prototype.onClick=function(t){switch(t.currentTarget){case this.getItemTxt:UserWarn.ins().setBuyGoodsWarn(909998);break;case this.btn:var e=UserSkill.ins().getPunchForge().calcSelectPos(),i=UserSkill.ins().getPunchForge().isUpgradePunchForge(e);if(i==PunchEquipForgeData.TYPE_NO)return void UserTips.ins().showTips("|C:0xff0000&T:碎片不足");if(i==PunchEquipForgeData.TYPE_MAX)return void UserTips.ins().showTips("|C:0x00ff00&T:已满级");UserSkill.ins().sendUpgradeForge(e)}},e.prototype.UpgradeForgeCallback=function(){this.updateDate(!0)},e.prototype.updateDate=function(t){for(var e=UserSkill.ins().getPunchForge().calcSelectPos(),i=0,s=PunchEquipForgeData.TYPE_MAX,n=0;n<this.maxPos;n++){var o=UserSkill.ins().getPunchForge().isUpgradePunchForge(e);if(o!=PunchEquipForgeData.TYPE_MAX){s=0;break}}s==PunchEquipForgeData.TYPE_MAX?this.currentState="full":(this.currentState="normal",i=UserSkill.ins().getPunchForge().getPunchLevel(e)),this.validateNow(),this.setSelect(e),this.setEff(),this.updateAttrDesc(e,i),this.updateCost(e,i),this.setPower(),t&&this.setPosEff(e)},e.prototype.setPosEff=function(t){var e=t-1;0>e&&(e=this.maxPos-1),this.mcs[e]||(this.mcs[e]=new MovieClip),this.mcs[e].parent||this["eff"+e].addChild(this.mcs[e]),this.mcs[e].playFile(RES_DIR_EFF+"forgeSuccess",1)},e.prototype.setSelect=function(t){for(var e=0;e<this.maxPos;e++)this["pEquip"+e].visible=!1,this["pELv"+e].text="+"+UserSkill.ins().getPunchForge().getPunchLevel(e);"normal"==this.currentState&&(this["pEquip"+t].visible=!0)},e.prototype.setEff=function(){return"normal"!=this.currentState?void DisplayUtils.removeFromParent(this.mc):UserSkill.ins().canSolve()?(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.getItemTxt.parent.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"chargeff1",-1),this.mc.touchEnabled=!1,this.mc.scaleY=.5,this.mc.scaleX=.6),this.mc.x=0,void(this.mc.y=0)):void DisplayUtils.removeFromParent(this.mc)},e.prototype.updateAttrDesc=function(t,e){if("full"==this.currentState){for(var i=UserSkill.ins().getPunchForge().getSuitlevel(),s=GlobalConfig.PunchEquipMasterConfig[i],n=UserSkill.ins().getPunchForge().getAttributeData(),o=0;o<n.length;o++)if(this["attr"+o]){for(var a="",r=0,h=0;h<n.length;h++)if(n[h].type==n[o].type){r=n[h].value;break}r+=s.attr&&s.attr[o]?s.attr[o].value:0,a=AttributeData.getAttrStrByType(n[o].type),a+="+",a+=r,this["attr"+o].text=a}var l="";return l="合击伤害减免",l+=s.exattr[0].value/100,void(this.exattr0.text=l+"%")}var c=GlobalConfig.PunchEquipConfig[t][e];if(c){var i=UserSkill.ins().getPunchForge().getSuitlevel(),s=GlobalConfig.PunchEquipMasterConfig[i],u=!0;if(!s){u=!1;for(var p in GlobalConfig.PunchEquipMasterConfig){s=GlobalConfig.PunchEquipMasterConfig[p];break}}for(var d=UserSkill.ins().getPunchForge().getPosNextLevelConfig(t),n=UserSkill.ins().getPunchForge().getAttributeData(),o=0;o<c.attr.length;o++)if(this["attr"+o]){for(var a="",r=0,h=0;h<n.length;h++)if(n[h].type==c.attr[o].type){r=n[h].value;break}if(r+=s.attr&&s.attr[o]?s.attr[o].value:0,a=AttributeData.getAttrStrByType(c.attr[o].type),a+="+",a+=r,this["attr"+o].text=a,d&&this["arrow"+o]&&this["addAttr"+o]&&d.attr[o].value){this["addAttr"+o].visible=this["arrow"+o].visible=!0;var g="";g+=r+(d.attr[o].value-c.attr[o].value),this["addAttr"+o].text=g,this["arrow"+o].x=this["attr"+o].x+this["attr"+o].width,this["addAttr"+o].x=this["arrow"+o].x+this["arrow"+o].width}else this["addAttr"+o].visible=this["arrow"+o].visible=!1}var f=void 0,v=void 0,l="";if(l="合击伤害减免",u?(l+=s.exattr[0].value/100,f=UserSkill.ins().getPunchForge().getNextSuitlevel(),v=GlobalConfig.PunchEquipMasterConfig[f]):(l+=0,v=s,f=i),this.exattr0.text=l+"%",this.arrow4.x=this.exattr0.x+this.exattr0.width+this.arrow4.width,this.exattr1.x=this.arrow4.x+this.arrow4.width,v){this.exattr1.text=v.exattr[0].value/100+"%",this.exattr2.x=this.exattr1.x+this.exattr1.width;var y=Math.floor(UserSkill.ins().getPunchForge().level/this.maxPos);this.exattr2.text="(注灵等级达到 "+y+"/"+f+")"}}else{var n=UserSkill.ins().getPunchForge().getAttributeData();c=GlobalConfig.PunchEquipConfig[t][1];for(var o=0;o<c.attr.length;o++)if(this["attr"+o]){for(var a="",r=0,h=0;h<n.length;h++)if(n[h].type==c.attr[o].type){r=n[h].value;break}if(a=AttributeData.getAttrStrByType(c.attr[o].type),a+="+",a+=r,this["attr"+o].text=a,this["arrow"+o]&&this["addAttr"+o]&&c.attr[o].value){this["addAttr"+o].visible=this["arrow"+o].visible=!0;var g="";g+=c.attr[o].value,this["addAttr"+o].text=g,this["arrow"+o].x=this["attr"+o].x+this["attr"+o].width,this["addAttr"+o].x=this["arrow"+o].x+this["arrow"+o].width}else this["addAttr"+o].visible=this["arrow"+o].visible=!1}var s=void 0;for(var p in GlobalConfig.PunchEquipMasterConfig){s=GlobalConfig.PunchEquipMasterConfig[p];break}var l="";l="合击伤害减免",l+=0,this.exattr0.text=l+"%",this.arrow4.x=this.exattr0.x+this.exattr0.width+this.arrow4.width,this.exattr1.x=this.arrow4.x+this.arrow4.width,s&&(this.exattr1.text=s.exattr[0].value/100+"%",this.exattr2.x=this.exattr1.x+this.exattr1.width,this.exattr2.text="(注灵等级达到 0/"+s.level+")")}},e.prototype.updateCost=function(t,e){var i;i=t||e?UserSkill.ins().getPunchForge().getPosNextLevelConfig(t):GlobalConfig.PunchEquipConfig[0][1],i||(i=GlobalConfig.PunchEquipConfig[t][1]),this.costicon.source=RewardData.getCurrencyRes(i.cost.id);var s="",n=UserSkill.ins().getPunchForge().isUpgradePunchForge(t);n==PunchEquipForgeData.TYPE_OK?(s=ColorUtil.GREEN_COLOR,this.redPoint.visible=!0):(this.redPoint.visible=!1,s=ColorUtil.RED_COLOR);var o=0;i.cost.id==MoneyConst.punch1?o=Actor.togeatter1:i.cost.id==MoneyConst.punch2&&(o=Actor.togeatter2),this.costcount.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+o+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+i.cost.count+"</font> ")},e.prototype.setPower=function(){var t=UserSkill.ins().getPunchForge().getAttributeData(),e=UserBag.getAttrPower(t),i=UserSkill.ins().getPunchForge().getSuitlevel(),s=GlobalConfig.PunchEquipMasterConfig[i];s&&s.attr&&(e+=UserBag.getAttrPower(s.attr),e+=s.exPower),e*=SubRoles.ins().subRolesLen,this.powerPanel.setPower(e)},e}(BaseView);__reflect(PunchEquipForge.prototype,"PunchEquipForge");var PunchExchangeBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchExchangeBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.btnText.text=this.data.config.name,this.redPoint.visible=UserSkill.ins().getPunchExchangePageRedPoint(this.data.index)},e.prototype.setBtnStatu=function(){},e}(eui.ItemRenderer);__reflect(PunchExchangeBtn.prototype,"PunchExchangeBtn");var PunchExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.count=0,e.exchangeNum=0,e.skinName="PunchExchangeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.count<e.exchangeNum?(UserTips.ins().showTips("|C:0x35e62d&T:材料数量不足|"),void ViewManager.ins().open(ShopGoodsWarn).setData(e.data.exchangeMaterial[0].id==MoneyConst.punch1?909998:909999)):UserBag.ins().getSurplusCount()<1?void UserTips.ins().showTips("背包已满"):void UserSkill.ins().sendExchangeHejiEquip(e.data.id)},this),this.itemIcon0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){var t=GlobalConfig.ItemConfig[this.data.getItem.id],e=this.data.exchangeMaterial[0];this.exchangeNum=e.count,e.id==MoneyConst.punch1?this.count=Actor.togeatter1:this.count=Actor.togeatter2,this.icon.source=RewardData.getCurrencyRes(e.id),this.redPoint.visible=UserSkill.ins().getPunchExchangeItemRedPoint(this.data.id);this.data.zsLevel>0?this.data.zsLevel+"转":this.data.level+"级";this.nameLab.text=t.name;var i=this.count<this.exchangeNum?"#F3311E":"#35E62D";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+i+"'>"+this.count+"</font><font color = '#9F946D'>/"+this.exchangeNum+"</font>"),this.itemConfig=t,this.itemIcon0.setData(t),this.data.zsLevel>0?this.goBtn.visible=UserZs.ins().lv>=this.data.zsLevel:this.goBtn.visible=Actor.level>=this.data.level},e.prototype.onClick=function(){if(this.itemConfig)switch(ItemConfig.getType(this.itemConfig)){case 5:ViewManager.ins().open(HejiEquipTipsWin,{id:this.itemConfig.id},!1,!0);break;default:UserTips.ins().showTips("没有找到道具类型提示页")}},e.prototype.setBtnStatu=function(){},e}(eui.ItemRenderer);__reflect(PunchExchangeItem.prototype,"PunchExchangeItem");var PunchExchangeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchExchangeSkin",this.goturn.textFlow=[{text:"碎片兑换",style:{underline:!0}}],this.exchangelist.itemRenderer=PunchExchangeItem,this.equiplist.itemRenderer=PunchExchangeBtn,this.initMenu()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.equiplist.addEventListener(egret.Event.CHANGING,this.checkIsOpen,this),this.observe(Actor.ins().postUpdateTogeatter,this.onListChange),this.addTouchEvent(this.goturn,this.onTap),this.equiplist.selectedIndex=this.currentSelect,this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.equiplist.removeEventListener(egret.TouchEvent.CHANGING,this.checkIsOpen,this),this.removeTouchEvent(this.goturn,this.onTap),this.removeObserve()},e.prototype.onListChange=function(t){this.currentSelect=this.equiplist.selectedIndex,this.refushInfo()},e.prototype.initMenu=function(){this.menuArr=[],this.exchangeArr=[];var t=GlobalConfig.TogetherHitEquipPageConfig,e=0,i=UserSkill.ins().getMaxzLv();for(var s in t){var n=t[s].id[0],o=GlobalConfig.TogetherHitEquipExchangeConfig[n];if(o.zsLevel>i[0]||o.level>i[1])break;this.menuArr.push({config:t[s],index:+s}),this.exchangeArr[e]=[];for(var a in t[s].id){var r=GlobalConfig.TogetherHitEquipExchangeConfig[t[s].id[a]];this.exchangeArr[e].push(r)}e++}},e.prototype.refushInfo=function(){this.suipian.text=""+Actor.togeatter1,this.suipian1.text=""+Actor.togeatter2,this.equiplist.dataProvider=new eui.ArrayCollection(this.menuArr);var t=this.exchangeArr[this.currentSelect];this.exchangelist.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.goturn&&ViewManager.ins().open(PunchTransformWin)},e.prototype.checkIsOpen=function(t){var e=t.target,i=this.exchangeArr[e.selectedIndex][0],s=i.zsLevel||0,n=i.level,o=!0;if(!o){var a=Actor.level>=n?s+"转开启":n+"级开启";return UserTips.ins().showTips(a+"开启"),t.$cancelable=!0,void t.preventDefault()}this.onListChange(null)},e}(BaseEuiView);__decorate([callLater],PunchExchangeWin.prototype,"onListChange",null),__reflect(PunchExchangeWin.prototype,"PunchExchangeWin"),ViewManager.ins().reg(PunchExchangeWin,LayerManager.UI_Main);var PunchExtShowWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colorWhite="#f8b141",e.colorGray="#444134",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchExtShowSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.setView=function(){var t="",e=GlobalConfig.TogetherHitEquipQmConfig,i=UserSkill.ins().qimingAttrDic,s=new Object,n=0;for(var o in i)s=i[o],n=Number(o);var a=s?CommonUtils.getObjectLength(s):0,r=this.colorWhite,h=!1;for(var l in e)for(var c in e[l]){var u=e[l][c];t+=0!=Number(l)?"<font color="+this.colorWhite+">"+l+"转套装属性(三角色时):</font>\n":"<font color="+this.colorWhite+">"+c+"级套装属性(三角色时):</font>\n";
var o=0,p=1e4*Number(l)+Number(c);for(var d in u){u[d].exAttr;p>n?(r=this.colorGray,h=!0):p==n&&o+1>a&&(r=this.colorGray,h=!0),t+="<font color="+r+">"+u[d].num+"件套："+this.getDescTextFlow(u[d].desc,!h)+"</font>\n",o++,3==o&&(t+="\n")}}this.baseAttr.textFlow=(new egret.HtmlTextParser).parser(t)},e.prototype.getDescTextFlow=function(t,e){for(var i=TextFlowMaker.generateTextFlow1(t),s="",n=0,o=i;n<o.length;n++){var a=o[n];s+=e&&a.style&&void 0!=a.style.textColor?"<font color="+a.style.textColor+">"+a.text+"</font>":a.text}return s},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchExtShowWin.prototype,"PunchExtShowWin"),ViewManager.ins().reg(PunchExtShowWin,LayerManager.UI_Main);var PunchResWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="PunchResSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.smeltEquips=[],this.smeltEquips.length=9,this.itemList.itemRenderer=SmeltEquipItem,this.dataInfo=new eui.ArrayCollection(this.smeltEquips),this.itemList.dataProvider=this.dataInfo},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.itemList,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(UserEquip.ins().postSmeltEquipComplete,this.smeltComplete),this.observe(UserEquip.ins().postEquipCheckList,this.setItemList),this.setItemData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.smeltBtn,this.onTap),this.removeTouchEvent(this.itemList,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.smeltComplete=function(){for(var t=this.itemList.numChildren;t--;)this.itemList.getChildAt(t).playEff();this.setItemData()},e.prototype.setItemData=function(){this.smeltEquips=UserBag.ins().getHejiOutEquips(),this.dataInfo.replaceAll(this.smeltEquips)},e.prototype.setItemList=function(t){this.dataInfo.replaceAll(t),this.itemList.dataProvider=this.dataInfo},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:UserEquip.ins().sendSmeltEquip(0,this.smeltEquips);break;case this.itemList:var i=t.target;if(i&&i.data){var s=this.smeltEquips.indexOf(i.data);s>=0&&(this.smeltEquips.splice(s,1),i.data=null)}break;case this.bgClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(PunchResWin.prototype,"PunchResWin"),ViewManager.ins().reg(PunchResWin,LayerManager.UI_Popup);var PunchSkillItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchSkillItem",e}return __extends(e,t),e.prototype.setData=function(t){this.iconBG.source=t.id+"_png"},e}(BaseComponent);__reflect(PunchSkillItemRender.prototype,"PunchSkillItemRender");var PunchSkillTipsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchskillTips"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.setView=function(){var t=GlobalConfig.TogetherHitConfig[UserSkill.ins().hejiLevel],e=SubRoles.ins().getSubRoleByIndex(0),i=new SkillData(t.skill_id[e.job-1]);this.skillitem.setData(i),this.nameLabel0.text=i.name,this.desc0.text=i.desc;var s=UserSkill.ins().qimingValueDic,n=0;for(var o in s){var a=s[o].value/100,r=void 0;r=2>n?StringUtils.substitute(UserSkill.descArr[n],"|C:0x00ff00&T:"+3*a+"%|"):StringUtils.substitute(UserSkill.descArr[n],"|C:0x00ff00&T:"+a+"%|"),this["desc"+o].textFlow=TextFlowMaker.generateTextFlow1(r),n++}0==n&&(this.desc3.text="无")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchSkillTipsWin.prototype,"PunchSkillTipsWin"),ViewManager.ins().reg(PunchSkillTipsWin,LayerManager.UI_Popup);var PunchTransformWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchTransformSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(Actor.ins().postUpdateTogeatter,this.checkChange),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve()},e.prototype.checkChange=function(t){t&&2==t.type&&this.update()},e.prototype.update=function(){this.count0.text=Actor.togeatter2+"",this.count1.text="0",this.changeBar.value=0,this.changeBar.maximum=Actor.togeatter2,this.transformBtn.enabled=Actor.togeatter2>0,this.quicklytransformBtn.enabled=!1},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.transformBtn:UserSkill.ins().sendChangeTogeatterHigh(Actor.togeatter2);break;case this.quicklytransformBtn:UserSkill.ins().sendChangeTogeatterHigh(this.changeBar.value);break;case this.add:this.changeBar.value<Actor.togeatter2?(this.changeBar.value++,this.count1.text=this.changeBar.value*GlobalConfig.TogerherHitBaseConfig.TogExgRate+"",this.quicklytransformBtn.enabled=!0):0==Actor.togeatter2?UserTips.ins().showTips("高级符文碎片不足"):UserTips.ins().showTips("已达到最大转换数量");break;case this.minus:this.changeBar.value>0&&(this.changeBar.value--,this.count1.text=this.changeBar.value*GlobalConfig.TogerherHitBaseConfig.TogExgRate+""),this.changeBar.value<=0&&(this.quicklytransformBtn.enabled=!1)}},e}(BaseEuiView);__reflect(PunchTransformWin.prototype,"PunchTransformWin"),ViewManager.ins().reg(PunchTransformWin,LayerManager.UI_Main);var Hint=function(t){function e(){var e=t.call(this)||this;return e.presceneid=-1,e.prefbId=-1,e.killType=0,e.picKillBoss="",e.observe(GameLogic.ins().postEnterMap,e.postSeceneIn),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkHint=function(t,i,s,n){if(!t){switch(i){case e.TARTYPE_WELCOME:return this.showHint(i),!0;case e.TARTYPE_KILL_BOSS:for(var o in GlobalConfig.HintConfig){var a=GlobalConfig.HintConfig[o];if(a.target[0].guanqiaId==n.gqid)return this.showHint(i,a.image),!0}}return!1}if(t){var r=this.HitConfig(t,i);if(null!=r)return this.showHint(i,r),!0}else for(var o in s){var h=s[o],r=this.HitConfig(h,i);if(null!=r)return this.showHint(i,r),!0}return!1},e.prototype.HitConfig=function(t,i){var s=t;for(var n in GlobalConfig.HintConfig){var o=GlobalConfig.HintConfig[n];if(o.targetType==i)switch(i){case e.TARTYPE_ACH_BEF:if(s.achievementId==o.target[0].achievementId&&s.taskId==o.target[0].taskId&&o.target[0].isfull&&o.target[0].isfull>0&&UserBag.ins().getSurplusCount())return o.image;break;case e.TARTYPE_ACH_AFT:if(s.achievementId==o.target[0].achievementId&&s.taskId==o.target[0].taskId)return o.image;break;case e.TARTYPE_SCE_IN:if(GameMap.mapID==o.target[0].sceneid&&GameMap.fubenID==o.target[0].fbId&&this.presceneid==o.target[0].presceneid&&this.prefbId==o.target[0].prefbId)return o.image}}return null},e.prototype.showHint=function(t,i){if(!i&&t==e.TARTYPE_WELCOME){var s=GlobalConfig.HintConfig[1];return i=s.image,void UserTips.ins().showHintTips(i)}i&&""!=i&&UserTips.ins().showHintTips(i)},e.prototype.postWelcome=function(){this.checkHint(null,e.TARTYPE_WELCOME)},e.prototype.postAchievementBef=function(t){t&&this.checkHint(t,e.TARTYPE_ACH_BEF)},e.prototype.postAchievementAft=function(t){if(t){var i;for(var s in GlobalConfig.AchievementTaskConfig){var n=GlobalConfig.AchievementTaskConfig[s];if(n.achievementId==t.achievementId&&n.taskId==t.id){i=n;break}}i&&this.checkHint(i,e.TARTYPE_ACH_AFT)}},e.prototype.postSeceneIn=function(){-1==this.presceneid&&(this.presceneid=GameMap.mapID),-1==this.prefbId&&(this.prefbId=GameMap.fubenID);var t=GlobalConfig.ScenesConfig[GameMap.mapID];t&&(this.checkHint(t,e.TARTYPE_SCE_IN),this.presceneid=GameMap.mapID,this.prefbId=GameMap.fubenID)},e.prototype.postKillBoss=function(t){this.checkHint(t,e.TARTYPE_KILL_BOSS)},e.prototype.postKillBossEx=function(t){this.checkHint(null,e.TARTYPE_KILL_BOSS,null,{gqid:t})},e}(BaseSystem);Hint.TARTYPE_WELCOME=1,Hint.TARTYPE_ACH_BEF=2,Hint.TARTYPE_ACH_AFT=3,Hint.TARTYPE_SCE_IN=4,Hint.TARTYPE_KILL_BOSS=5,__reflect(Hint.prototype,"Hint");var GameSystem;!function(t){t.hint=Hint.ins.bind(Hint)}(GameSystem||(GameSystem={}));var HintTargetData=function(){function t(){}return t}();__reflect(HintTargetData.prototype,"HintTargetData");var Hungu=function(t){function e(){var e=t.call(this)||this;return e.hunShouFBTimes=0,e.hunShouFBPassID=0,e.sysId=PackageID.Hungu,e.regNetMsg(1,e.postHunguInfo),e.regNetMsg(2,e.postHunguItems),e.regNetMsg(3,e.postHunyu),e.regNetMsg(4,e.postHunguItemUpgrade),e.regNetMsg(6,e.postSweepHunShouFB),e.regNetMsg(7,e.postHunShouFBInfo),e.regNetMsg(8,e.postHunShouFBEndTime),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"hunguData",{get:function(){return this._hunguData||(this._hunguData=[]),this._hunguData},enumerable:!0,configurable:!0}),e.prototype.checkOpen=function(){return GameServer.serverOpenDay<GlobalConfig.HunGuConf.openserverday-1?!1:UserZs.ins().lv<GlobalConfig.HunGuConf.openzhuanshenglv?!1:!0},e.prototype.checkShowOpen=function(){return GameServer.serverOpenDay<GlobalConfig.HunGuConf.openserverday-1?!1:UserZs.ins().lv<GlobalConfig.HunGuConf.showzhuanshenglv?!1:!0},e.prototype.getHunguItemsPos=function(t){var e=-1,i=GlobalConfig.ItemConfig[t];return i&&(e=ItemConfig.getSubType(i)),e},e.prototype.getHunguItemsList=function(t){for(var e=[],i=UserBag.ins().getBagGoodsByType(ItemType.TYPE_24),s=0;s<i.length;s++)this.getHunguItemsPos(i[s].itemConfig.id)==t&&e.push(i[s]);return e.sort(function(t,e){var i=GlobalConfig.HunGuEquip[t.configID],s=GlobalConfig.HunGuEquip[e.configID];return i.stage>s.stage?-1:1}),e},e.prototype.getHunyuRedPoint=function(t,e){if(!this.hunguData[t])return!1;for(var i=0;i<this.hunguData[t].items[e].hunyu.length;i++){var s=this.getHunyuKongRedPoint(t,e,i);if(s)return!0}return!1},e.prototype.getHunyuKongRedPoint=function(t,e,i){if(!this.hunguData[t])return!1;if(!this.hunguData[t].items[e].itemId||i+1>GlobalConfig.HunGuEquip[this.hunguData[t].items[e].itemId].hunyuNum)return!1;var s=GlobalConfig.HunGuConf.hunyuType[e][i],n=this.hunguData[t].items[e].hunyu[i],o=GlobalConfig.HunYuEquip[s][n+1];if(!o)return!1;if(o.cost){var a=UserBag.ins().getBagItemById(o.cost.id);if(a&&a.count>=o.cost.count)return!0}else{var r=GlobalConfig.HunGuConf.unlockCost[i+1];if(Actor.yb>=r)return!0}return!1},e.prototype.getHunguPosHyPower=function(t,e){var i=0;if(!this.hunguData[t]||!this.hunguData[t].items[e].itemId)return i;var s=GlobalConfig.HunGuEquip[this.hunguData[t].items[e].itemId];if(!s)return i;for(var n=s.hunyuNum,o=0;n>o;o++){var a=GlobalConfig.HunGuConf.hunyuType[e][o],r=this.hunguData[t].items[e].hunyu[o],h=GlobalConfig.HunYuEquip[a][r];if(h){i+=UserBag.getAttrPower(h.attrs,SubRoles.ins().getSubRoleByIndex(t));var l=h.expower?h.expower:0;i+=l}}return i},e.prototype.getHunguItemPower=function(t){var e=0,i=GlobalConfig.HunGuEquip[t];if(i){e+=UserBag.getAttrPower(i.attrs);var s=i.expower?i.expower:0;e+=s}return e},e.prototype.getHunguPosPower=function(t,e,i,s){var n=0;if(!this.hunguData[t])return n;var o=0;s&&(o+=this.getHunguPosHyPower(t,e));var a=[],r=this.hunguData[t].items[e].itemId,h=GlobalConfig.HunGuEquip[r];if(h){n+=UserBag.getAttrPower(h.attrs,SubRoles.ins().getSubRoleByIndex(t));var l=h.expower?h.expower:0;if(n+=l,i)for(var c=0;c<h.attrs.length;c++){for(var u=!1,p=0;p<a.length;p++)if(a[p].type==h.attrs[c].type){a[p].value+=h.attrs[c].value,u=!0;break}u||a.push(new AttributeData(h.attrs[c].type,h.attrs[c].value))}}var d=[];if(i){var g=[];for(var f in i)for(var c in i[f])if(i[f][c].count.length>=+c){var v=i[f][c].stage,y=GlobalConfig.HunGuSuit[f][c][v];y&&y.specialAttrs&&g.push(y.specialAttrs/1e4)}g.length||g.push(0);for(var f=0;f<g.length;f++)for(var c=0;c<a.length;c++)d[c]||(d[c]=new AttributeData(a[c].type,0)),d[c].value+=a[c].value*g[f]}return n+=o+UserBag.getAttrPower(d)},e.prototype.getResonancePower=function(t){var e=0;if(!this.hunguData[t])return e;var i=this.getSuitData(t);for(var s in i)for(var n in i[s]){var o=i[s][n].stage;if(o){var a=i[s][n].count;if(!(a.length<+n)){var r=GlobalConfig.HunGuSuit[s][n][o];r.attrs&&(e+=UserBag.getAttrPower(r.attrs,SubRoles.ins().getSubRoleByIndex(t)));var h=r.expower?r.expower:0;e+=h}}}return e},e.prototype.getSuitData=function(t){var e={};if(!this.hunguData[t])return e;var i=[];for(var s in GlobalConfig.HunGuConf.suit)if(GlobalConfig.HunGuSuit[s]){i[+s]=[];for(var n in GlobalConfig.HunGuConf.suit[s]){var o=GlobalConfig.HunGuConf.suit[s][n],a=this.hunguData[t].items[o].itemId;a&&i[+s].push(GlobalConfig.HunGuEquip[a])}i[+s].sort(function(t,e){return t.stage>e.stage?-1:1})}for(var n in GlobalConfig.HunGuSuit){e[n]={};for(var r in GlobalConfig.HunGuSuit[n]){e[n][r]={},e[n][r].count=[],e[n][r].stage=0;for(var h=0;+r>h&&i[+n][h];h++)e[n][r].count.push(i[+n][h].id),e[n][r].stage||(e[n][r].stage=i[+n][h].stage),e[n][r].stage>i[+n][h].stage&&(e[n][r].stage=i[+n][h].stage)}}return e},e.prototype.getHunguPosName=function(t){return GlobalConfig.HunGuConf.hunguName[t]},e.prototype.getHunguItemQualityName=function(t,e){var i="",s=e;switch(s||(s=GlobalConfig.HunGuEquip[t]?GlobalConfig.HunGuEquip[t].stage:1),s){case 1:i="凡品";break;case 2:i="中品";break;case 3:i="上品";break;case 4:i="极品";break;case 5:i="神品"}return i},e.prototype.calcHunguTotalValue=function(t){var e=[],i=this.hunguData[t];if(!i)return e;for(var s=[],n=0;n<i.items.length;n++){var o=i.items[n].itemId,a=GlobalConfig.HunGuEquip[o];if(a){for(var r=0;r<a.attrs.length;r++){for(var h=!1,l=0;l<s.length;l++)if(s[l].type==a.attrs[r].type){s[l].value+=a.attrs[r].value,h=!0;break}h||s.push(new AttributeData(a.attrs[r].type,a.attrs[r].value))}for(var r=0;r<i.items[n].hunyu.length;r++)if(i.items[n].hunyu[r])for(var c=GlobalConfig.HunGuConf.hunyuType[n][r],u=i.items[n].hunyu[r],p=GlobalConfig.HunYuEquip[c][u],d=0;d<p.attrs.length;d++){for(var h=!1,l=0;l<e.length;l++)if(e[l].type==p.attrs[d].type){e[l].value+=p.attrs[d].value,h=!0;break}h||e.push(new AttributeData(p.attrs[d].type,p.attrs[d].value))}}}var g=this.getSuitData(t),f=[];for(var n in g)for(var r in g[n])if(g[n][r].count.length>=+r){var v=g[n][r].stage,y=GlobalConfig.HunGuSuit[n][r][v];if(y&&y.attrs)for(var d=0;d<y.attrs.length;d++){for(var h=!1,l=0;l<e.length;l++)if(e[l].type==y.attrs[d].type){e[l].value+=y.attrs[d].value,h=!0;break}h||e.push(new AttributeData(y.attrs[d].type,y.attrs[d].value))}y&&y.specialAttrs&&f.push(y.specialAttrs/1e4)}for(var n=0;n<f.length;n++)for(var r=0;r<s.length;r++)s[r].value*=1+f[n];for(var d=0;d<s.length;d++){for(var h=!1,l=0;l<e.length;l++)if(e[l].type==s[d].type){e[l].value+=s[d].value,e[l].value=Math.floor(e[l].value),h=!0;break}h||e.push(new AttributeData(s[d].type,Math.floor(s[d].value)))}return e},e.prototype.getAttrStrByType=function(t){var e="";switch(t){case AttributeType.atMaxHp:e="生       命";break;case AttributeType.atAttack:e="攻       击";break;case AttributeType.atDef:e="物       防";break;case AttributeType.atRes:e="魔       防"}return e},e.prototype.getCurHunguId=function(t,i){var s=e.ins(),n=s.hunguData[t];if(!n)return 0;var o=n.items[i];return o?o.itemId:0},e.prototype.getNextHunguId=function(t,i){var s=e.ins(),n=s.hunguData[t];if(!n)return 0;var o=n.items[i];return o?GlobalConfig.HunGuEquip[o.itemId].nextId:0},e.prototype.getNextHunyuLvConfig=function(t,e,i){if(!this.hunguData[t])return null;var s=GlobalConfig.HunGuConf.hunyuType[e][i],n=this.hunguData[t].items[e].hunyu[i];return GlobalConfig.HunYuEquip[s][n+1]},e.prototype.getUpgradeRedPoint=function(t){var e=GlobalConfig.HunGuEquip[t];if(!e||!e.addStageCost)return!1;var i=UserBag.ins();for(var s in e.addStageCost){var n=i.getBagItemById(e.addStageCost[s].id);if(!n||n.count<e.addStageCost[s].count)return!1}return!0},e.prototype.sendHunguItems=function(t,e,i){var s=this.getBytes(2);s.writeByte(t),s.writeByte(e),s.writeInt(i),this.sendToServer(s)},e.prototype.sendHunyu=function(t,e,i){var s=this.getBytes(3);s.writeByte(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.sendHunguItemUpgrade=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postHunguInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte(),n=t.readByte(),o=void 0;o=this.hunguData[s]?this.hunguData[s]:new HunguData;for(var a=0;n>a;a++){o.items[a].itemId=t.readInt();for(var r=t.readByte(),h=0;r>h;h++)o.items[a].hunyu[h]=t.readInt()}this.hunguData[s]=o}},e.prototype.postHunguItems=function(t){var e=t.readByte(),i=t.readByte(),s=t.readInt();this.hunguData[e]||(this.hunguData[e]=new HunguData);var n=this.hunguData[e],o=n.items[i].itemId;n&&(n.items[i].itemId=s),0==o&&0!=s&&this.postNothing2Wear(1,i),0==s&&0!=o&&this.postWear2Noting(0,i)},e.prototype.postNothing2Wear=function(t,e){return[t,e]},e.prototype.postWear2Noting=function(t,e){return[t,e]},e.prototype.postHunyu=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte(),n=t.readInt();this.hunguData[e]&&(this.hunguData[e].items[i].hunyu[s-1]=n)},e.prototype.postHunguItemUpgrade=function(t){var e=t.readByte(),i=t.readByte(),s=t.readInt();this.hunguData[e]&&(this.hunguData[e].items[i].itemId=s),this.postNothing2Wear(1,i)},e.prototype.enterHunShouFB=function(){this.sendBaseProto(5)},e.prototype.sweepHunShouFB=function(){this.sendBaseProto(6)},e.prototype.postSweepHunShouFB=function(t){var e=t.readInt();this.hunShouFBTimes=t.readInt();for(var i,s=t.readInt(),n=[],o=0;s>o;o++)i=new RewardData,i.type=t.readInt(),i.id=t.readInt(),i.count=t.readInt(),n.push(i);ViewManager.ins().open(HunShouSweepWin,e,n)},e.prototype.postHunShouFBInfo=function(t){this.hunShouFBPassID=t.readInt(),this.hunShouFBTimes=GlobalConfig.HunGuConf.dayRewardCount-t.readInt()},e.prototype.postHunShouFBEndTime=function(t){this._hunShouFBEndTime=t.readInt()},e.prototype.getHunShouFbLeftTime=function(){return Math.floor((1e3*this._hunShouFBEndTime+1e3*DateUtils.SECOND_2010-GameServer.serverTime)/1e3)},e.prototype.isHunShouFBOpen=function(){return UserZs.ins().lv>=GlobalConfig.HunGuConf.needZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.HunGuConf.fbOpenDay},e.prototype.showHunShouFB=function(){return UserZs.ins().lv>=GlobalConfig.HunGuConf.showZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.HunGuConf.fbOpenDay},e.prototype.showHunShouRed=function(){return this.isHunShouFBOpen()?this.hunShouFBTimes>0:!1},e}(BaseSystem);__reflect(Hungu.prototype,"Hungu");var GameSystem;!function(t){t.hungu=Hungu.ins.bind(Hungu)}(GameSystem||(GameSystem={}));var HunguRedPoint=function(t){function e(){var e=t.call(this)||this;return e.itemPoints=[],e.roleTabs=[],e.redPoint=!1,e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,Hungu.ins().postHunguInfo,Hungu.ins().postHunguItems,Hungu.ins().postHunyu,Hungu.ins().postHunguItemUpgrade,UserBag.ins().postItemCountChange,UserZs.ins().postZsLv,GameLogic.ins().postSubRoleChange),e}return __extends(e,t),e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=(Hungu.ins(),0);3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e)for(var i=0;i<GlobalConfig.HunGuConf.equipCount&&(this.roleTabs[t]=this.HunguItemRedPoint(e.index,i),!this.roleTabs[t]);i++);else this.roleTabs[t]=!1}return!0},e.prototype.HunguItemRedPoint=function(t,e){var i=Hungu.ins(),s=!1,n=i.getHunguItemsList(e);return!n.length||i.hunguData[t]&&i.hunguData[t].items[e].itemId?(s=i.getHunyuRedPoint(t,e),s?!0:i.hunguData[t]&&i.hunguData[t].items[e].itemId&&(s=i.getUpgradeRedPoint(i.hunguData[t].items[e].itemId))?s:s):s=!0},e}(BaseSystem);__reflect(HunguRedPoint.prototype,"HunguRedPoint");var GameSystem;!function(t){t.hunguRedPoint=HunguRedPoint.ins.bind(HunguRedPoint)}(GameSystem||(GameSystem={}));var HunguData=function(){function t(){}return Object.defineProperty(t.prototype,"items",{get:function(){if(!this._items){this._items=[];for(var t=0;t<GlobalConfig.HunGuConf.equipCount;t++){var e=new HungguItems;this._items.push(e)}}return this._items},set:function(t){this._items=t},enumerable:!0,configurable:!0}),t}();__reflect(HunguData.prototype,"HunguData");var HungguItems=function(){function t(){this.itemId=0,this.hunyu=[];for(var t=0;t<GlobalConfig.HunGuConf.hunyuCount;t++)this.hunyu.push(0)}return t}();__reflect(HungguItems.prototype,"HungguItems");var HGPOS;!function(t){t[t.ITEM0=0]="ITEM0",t[t.ITEM1=1]="ITEM1",t[t.ITEM2=2]="ITEM2",t[t.ITEM3=3]="ITEM3",t[t.ITEM4=4]="ITEM4",t[t.ITEM5=5]="ITEM5",t[t.ITEM6=6]="ITEM6",t[t.ITEM7=7]="ITEM7"}(HGPOS||(HGPOS={}));var HunguAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=[],e.skinName="heartmethodAttrSkin",e.isTopLevel=!0,e.proShowList=[2,4,5,6],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.setRoleAttr(this.curRole);var i=SubRoles.ins().subRolesLen;i>1&&(this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.addTouchEndEvent(this.bg,this.onMove)),this.addTouchEndEvent(this,this.otherClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=SubRoles.ins().subRolesLen;i>1&&(this.removeTouchEvent(this.leftBtn,this.onTouch),this.removeTouchEvent(this.rightBtn,this.onTouch),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200)):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200))}},e.prototype.moveAttr=function(t){var e,i=egret.Tween.get(this.attrGroup);e=t>0?0:242,i.to({x:this.attrGroup.x+t,alpha:0},200).to({x:e},200).to({x:80,alpha:1},200)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.leftBtn:this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200));break;case this.rightBtn:this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200))}},e.prototype.setRoleAttr=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);this.job.source="op_"+e.job;for(var i="",s="",n=0,o=0,a=Hungu.ins().calcHunguTotalValue(e.index),r=0;r<this.proShowList.length;r++){o=this.proShowList[r],n=0;for(var h=0;h<a.length;h++)if(a[h].type==o){n=a[h].value;break}i+=Math.floor(n)+"",s+=Hungu.ins().getAttrStrByType(o)+":",r<this.proShowList.length-1&&(i+="\n",s+="\n")}this.attr.text=i,this.attrName.text=s,this.setBtn()},e.prototype.setBtn=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,3>t?this.rightBtn.visible=!1:this.rightBtn.visible=!0):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(HunguAttrWin.prototype,"HunguAttrWin"),ViewManager.ins().reg(HunguAttrWin,LayerManager.UI_Popup);var HunguChooseEquipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e.roleSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="hunguChooseSkin",this.list.itemRenderer=HunguEquipChooseItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.observe(Hungu.ins().postHunguItems,this.HunguItemsCallback),this.roleSelect=t[0],this.pos=t[1];var i=0;this.itemGroup.visible=!1,Hungu.ins().hunguData[this.roleSelect]&&(this.itemGroup.visible=!0,i=Hungu.ins().hunguData[this.roleSelect].items[this.pos].itemId,i&&(this.scroll.y=160,this.scroll.height=410,this.wearItem=new HunguEquipChooseItem,this.itemGroup.addChild(this.wearItem),this.wearItem.data={id:i,roleId:this.roleSelect},this.wearItem.setWearVisible(!0))),this.itemList=this.getHunguItemList(this.roleSelect,this.pos),this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.validateNow()},e.prototype.HunguItemsCallback=function(){ViewManager.ins().close(this)},e.prototype.getHunguItemList=function(t,e){for(var i=UserBag.ins().getBagGoodsByType(ItemType.TYPE_24),s=[],n=0;n<i.length;n++){var o=Hungu.ins().getHunguItemsPos(i[n].itemConfig.id);o==e&&s.push({id:i[n].configID,roleId:this.roleSelect})}return s.sort(function(t,e){var i=GlobalConfig.HunGuEquip[t.id],s=GlobalConfig.HunGuEquip[e.id];return i.stage>s.stage?-1:1}),s},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(HunguChooseEquipWin.prototype,"HunguChooseEquipWin"),ViewManager.ins().reg(HunguChooseEquipWin,LayerManager.UI_Popup);var HunguEquipChooseItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguChooseItem",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data&&this.data.id&&!isNaN(this.data.roleId)){var t=UserBag.getAttrPower(GlobalConfig.HunGuEquip[this.data.id].attrs),e=GlobalConfig.HunGuEquip[this.data.id].expower;e=e?e:0,t+=e,this.now.visible=!1,this.power.text="评分："+t;var i=GlobalConfig.ItemConfig[this.data.id],s=ItemConfig.getQualityColor(i);this.quality.textFlow=TextFlowMaker.generateTextFlow1("|C:"+s+"&T:"+Hungu.ins().getHunguItemQualityName(i.id)),this.itemIcon.setData(i);for(var n=0;3>n;n++)if(this["group"+n]&&this["attr"+n])if(GlobalConfig.HunGuEquip[this.data.id].attrs[n]){if(this["group"+n].parent||this.addChild(this["group"+n]),this["attr"+n].text=AttributeData.getAttrNameByAttrbute(GlobalConfig.HunGuEquip[this.data.id].attrs[n],!0),this["betterArrow"+n]&&this["forgeAttr"+n]){this["betterArrow"+n].visible=this["forgeAttr"+n].visible=!1;var o=ItemConfig.getSubType(i);if(Hungu.ins().hunguData[this.data.roleId]&&Hungu.ins().hunguData[this.data.roleId].items[o].itemId){for(var a=Hungu.ins().hunguData[this.data.roleId].items[o].itemId,r=0;r<GlobalConfig.HunGuEquip[a].attrs.length;r++)if(GlobalConfig.HunGuEquip[a].attrs[r].type==GlobalConfig.HunGuEquip[this.data.id].attrs[n].type){GlobalConfig.HunGuEquip[a].attrs[r].value>GlobalConfig.HunGuEquip[this.data.id].attrs[n].value&&(this["betterArrow"+n].visible=this["forgeAttr"+n].visible=!0);break}}else this["betterArrow"+n].visible=this["forgeAttr"+n].visible=!0,this["forgeAttr"+n].text="+"+GlobalConfig.HunGuEquip[this.data.id].attrs[n].value}}else DisplayUtils.removeFromParent(this["group"+n])}},e.prototype.setWearVisible=function(t){void 0===t&&(t=!1),this.now.visible=t,this.changeBtn.visible=!this.now.visible},e.prototype.onClick=function(){var t=GlobalConfig.ItemConfig[this.data.id],e=ItemConfig.getSubType(t);Hungu.ins().sendHunguItems(this.data.roleId,e,this.data.id)},e}(eui.ItemRenderer);__reflect(HunguEquipChooseItem.prototype,"HunguEquipChooseItem");var HunguGroupItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguGroupItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.qualityName.textFlow=TextFlowMaker.generateTextFlow1(this.data.qualityName),this.posName.textFlow=TextFlowMaker.generateTextFlow1(this.data.posName);for(var t=0;3>t;t++)this["suit"+t]&&this.data.suits[t]?this["suit"+t].textFlow=TextFlowMaker.generateTextFlow1(this.data.suits[t]):DisplayUtils.removeFromParent(this["suit"+t])}},e}(BaseItemRender);__reflect(HunguGroupItem.prototype,"HunguGroupItem");var HunguGroupWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguGroupSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.roleId=t[0],this.id=t[1],this.updateShow()},e.prototype.updateShow=function(){this.itemData=[],this.init();var t=Hungu.ins().getSuitData(this.roleId);if(CommonUtils.getObjectLength(t)&&t[this.id]){this.itemData=[],this.suit2="",this.suit4="",this.suit6="";var e=this.getPosColorName(this.id),i=[];for(var s in t[this.id])-1==i.indexOf(t[this.id][s].stage)&&i.push(t[this.id][s].stage);for(var n="",o=0;o<i.length;o++){var a=i[o];n=GlobalConfig.HunGuConf.suitName[this.id-1][1>=a?0:a-1];var r=[],h=[];for(var s in GlobalConfig.HunGuSuit[this.id]){for(var l=0;l<t[this.id][s].count.length;l++){var c=t[this.id][s].count[l],u=ItemConfig.getSubType(GlobalConfig.ItemConfig[c]);-1==r.indexOf(u)&&r.push(u)}var p=GlobalConfig.HunGuSuit[this.id][s][a],d=0;d=t[this.id][s].stage==a&&t[this.id][s].count.length>=+s?ColorUtil.GREEN_COLOR_N:ColorUtil.GRAY_COLOR2,p||(p=GlobalConfig.HunGuSuit[this.id][s][1]),p.dec&&h.push("|C:"+d+"&T:"+s+"件:"+p.dec)}for(var g="",s=0;s<e.length;s++){var d=0;d=-1==r.indexOf(e[s])?ColorUtil.GRAY_COLOR2:ColorUtil.GREEN_COLOR_N,g+="|C:"+d+"&T:"+Hungu.ins().getHunguPosName(e[s])+"  "}this.itemData.push({qualityName:n,posName:g,suits:h})}if(1==i.length){var f=!0;if(Hungu.ins().hunguData[this.roleId])for(var s in Hungu.ins().hunguData[this.roleId].items)if(-1!=e.indexOf(Number(s))){var c=Hungu.ins().hunguData[this.roleId].items[s].itemId;if(!c||GlobalConfig.HunGuEquip[c].stage!=i[0]){f=!1;break}}if(f){var v=[];for(var s in GlobalConfig.HunGuSuit[this.id])if(t[this.id][+s]){var y=CommonUtils.getObjectLength(GlobalConfig.HunGuSuit[this.id][+s]),m=t[this.id][+s].stage;if(m!=y){for(var T=m+1,b=GlobalConfig.HunGuConf.suitName[this.id-1][1>=T?0:T-1],g="",l=0;l<e.length;l++)g+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+Hungu.ins().getHunguPosName(e[l])+"  ";for(var l in GlobalConfig.HunGuSuit[this.id]){var p=GlobalConfig.HunGuSuit[this.id][l][T];p.dec&&v.push("|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"件:"+p.dec)}this.itemData.push({qualityName:b,posName:g,suits:v});break}}}}}for(var s=0;s<this.itemData.length;s++){var C=new HunguGroupItem;C.data={qualityName:this.itemData[s].qualityName,posName:this.itemData[s].posName,suits:this.itemData[s].suits},this.content.addChild(C)}},e.prototype.getPosColorName=function(t){for(var e=[],i=0;i<GlobalConfig.HunGuConf.suit[t].length;i++)e.push(GlobalConfig.HunGuConf.suit[t][i]);return e},e.prototype.init=function(t){void 0===t&&(t=this.id);var e=1==t?"特殊":"魂骨",i="【凡品"+e+"共鸣】",s=GlobalConfig.HunGuConf.suit[t],n="";this.suit2="",this.suit4="",this.suit6="";for(var o=0;o<s.length;o++)n+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+Hungu.ins().getHunguPosName(s[o])+"  ";var a=[];for(var r in GlobalConfig.HunGuSuit[t]){var h=GlobalConfig.HunGuSuit[t][r][1];if(h.specialAttrs)a.push("|C:"+ColorUtil.GRAY_COLOR2+"&T:"+r+"件:装备基础属性+"+h.specialAttrs/100+"%");else{for(var l="",c=0;c<h.attrs.length;c++)l+=AttributeData.getAttrStrByType(h.attrs[c].type)+"+"+h.attrs[c].value+"  ";h.dec&&a.push("|C:"+ColorUtil.GRAY_COLOR2+"&T:"+r+"件:"+h.dec)}}this.itemData.push({qualityName:i,posName:n,suits:a})},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e
}(BaseEuiView);__reflect(HunguGroupWin.prototype,"HunguGroupWin"),ViewManager.ins().reg(HunguGroupWin,LayerManager.UI_Popup);var HunguItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunyuItemSkin",e}return __extends(e,t),e.prototype.setData=function(t){this.config=t,t&&(this.icon.source=t.icon+"_png")},e}(BaseComponent);__reflect(HunguItemIcon.prototype,"HunguItemIcon");var HunguStageWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguStageSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleId=t[0],this.pos=t[1],this.getItemList.itemRenderer=ItemBase,this.addTouchEvent(this.lvUpBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.observe(Hungu.ins().postHunguItemUpgrade,this.updateUI),this.attrNow=[this.attr1Now0,this.attr2Now0,this.attr3Now0],this.arrtNext=[this.attr1Next0,this.attr2Next0,this.attr3Next0],this.updateUI()},e.prototype.updateUI=function(){var t=Hungu.ins(),e=t.getCurHunguId(this.roleId,this.pos),i=t.getNextHunguId(this.roleId,this.pos),s=GlobalConfig.HunGuEquip[e],n=GlobalConfig.HunGuEquip[i];for(var o in this.attrNow)s&&s.attrs[o]?(this.attrNow[o].visible=!0,this.attrNow[o].text=this.parserStr(s.attrs[o])):this.attrNow[o].visible=!1,n&&n.attrs[o]?(this.arrtNext[o].visible=!0,this.arrtNext[o].text=this.parserStr(n.attrs[o])):this.arrtNext[o].visible=!1;var a=s&&s.hunyuNum?s.hunyuNum:0,r=n&&n.hunyuNum?n.hunyuNum:0;if(this.hunyuNow.text="魂玉数量："+a,this.hunyuNext.text="魂玉数量："+r,this.redPoint.visible=t.getUpgradeRedPoint(s&&s.id?s.id:0),s&&s.addStageCost){this.getItemList.dataProvider=new eui.ArrayCollection(s.addStageCost),this.getItemList.validateNow();for(var o=0;o<this.getItemList.numElements;o++){var h=this.getItemList.getVirtualElementAt(o),l=this.getItemList.dataProvider.getItemAt(o),c=ColorUtil.GREEN_COLOR_N,u=UserBag.ins().getBagItemById(l.id),p=u?u.count:0;p<l.count&&(c=ColorUtil.RED_COLOR_N),h.setName("|C:"+c+"&T:"+p+"/"+l.count)}}if(s){this.nowItemIcon.data=s.id,this.nowItemIcon.isShowJob(!1),this.nowItemIcon.showNum(!1);var d=0;d+=UserBag.getAttrPower(s.attrs);var g=s.expower?s.expower:0;d+=g,this.powerPanel0.setPower(d)}if(n){this.nextItemIcon.data=n.id,this.nextItemIcon.isShowJob(!1),this.nextItemIcon.showNum(!1);var d=0;d+=UserBag.getAttrPower(n.attrs);var g=n.expower?n.expower:0;d+=g,this.powerPanel1.setPower(d)}},e.prototype.parserStr=function(t){return AttributeData.getAttrStrByType(t.type)+":"+t.value},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.lvUpBtn:this.redPoint.visible?Hungu.ins().sendHunguItemUpgrade(this.roleId,this.pos):UserTips.ins().showTips("材料不足");break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(HunguStageWin.prototype,"HunguStageWin"),ViewManager.ins().reg(HunguStageWin,LayerManager.UI_Popup);var HunguTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguTipsSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currentState=t[0]?"shenshang":"putong",this.validateNow(),this.addTouchEvent(this.bgClose,this.onTap),"shenshang"==this.currentState&&(this.addTouchEvent(this.takeoffBtn,this.onTap),this.addTouchEvent(this.changeBtn,this.onTap),this.addTouchEvent(this.hunyuBtn,this.onTap),this.wear=!0),this.observe(Hungu.ins().postHunguItems,this.HunguItemsCallback),this.observe(Hungu.ins().postHunguItemUpgrade,this.HunguItemUpgradeCallback),this.roleId=t[1],this.itemId=t[2],this.updateUI()},e.prototype.HunguItemsCallback=function(){ViewManager.ins().close(this)},e.prototype.HunguItemUpgradeCallback=function(){var t=ItemConfig.getSubType(GlobalConfig.ItemConfig[this.itemId]);this.itemId=Hungu.ins().hunguData[this.roleId].items[t].itemId,this.updateUI()},e.prototype.updateUI=function(){var t=GlobalConfig.ItemConfig[this.itemId];this.equipIcon.setData(t);var e=ItemConfig.getQualityColor(t);this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1("|C:"+e+"&T:"+t.name);var i=ItemConfig.getQuality(t);this.quali.source=i>0?"quali"+i:"",this.toubuhungu.textFlow=TextFlowMaker.generateTextFlow1(""+Hungu.ins().getHunguPosName(ItemConfig.getSubType(t))),this.fanpin.textFlow=TextFlowMaker.generateTextFlow1(""+Hungu.ins().getHunguItemQualityName(t.id)),this.tongyong.textFlow=TextFlowMaker.generateTextFlow1(""+Role.getJobNameByJob(ItemConfig.getJob(t)));var s=0,n=Hungu.ins().getSuitData(this.roleId);s+=this.wear?Hungu.ins().getHunguPosPower(this.roleId,ItemConfig.getSubType(t),n,!0):Hungu.ins().getHunguItemPower(t.id),this.powerPanel.setPower(s);for(var o=[],a=[],r=[],h=GlobalConfig.HunGuEquip[this.itemId],l=0;l<h.attrs.length;l++){for(var c=!1,u=0;u<o.length;u++)if(o[u].type==h.attrs[l].type){o[u].value+=h.attrs[l].value,c=!0;break}c||o.push(new AttributeData(h.attrs[l].type,h.attrs[l].value))}if(this.wear&&Hungu.ins().hunguData[this.roleId]){var p=[];for(var d in n)for(var l in n[d])if(n[d][l].count.length>=+l){var g=n[d][l].stage,f=GlobalConfig.HunGuSuit[d][l][g];f&&f.specialAttrs&&p.push(f.specialAttrs/1e4)}if(p.length)for(var d=0;d<p.length;d++)for(var l=0;l<o.length;l++)a.push(new AttributeData(o[l].type,Math.floor(o[l].value*p[d])));this.updateRedPoint();for(var d=0;d<Hungu.ins().hunguData[this.roleId].items[ItemConfig.getSubType(t)].hunyu.length;d++){var v=Hungu.ins().hunguData[this.roleId].items[ItemConfig.getSubType(t)].hunyu[d],y=GlobalConfig.HunGuConf.hunyuType[ItemConfig.getSubType(t)][d],m=GlobalConfig.HunYuEquip[y][v];if(m)for(var l=0;l<m.attrs.length;l++){for(var c=!1,u=0;u<r.length;u++)if(r[u].type==m.attrs[l].type){r[u].value+=m.attrs[l].value,c=!0;break}c||r.push(new AttributeData(m.attrs[l].type,m.attrs[l].value))}}}for(var T=[2,4,5,6],b=0,C=0,d=0;d<T.length;d++){if(this["attr"+d]&&this["forgeAttr"+d]&&(this["attr"+d].visible=this["forgeAttr"+d].visible=!1),this["starAttr"+d]&&(this["starAttr"+d].visible=!1),this["attr"+b]&&this["forgeAttr"+b]){this["attr"+b].visible=this["forgeAttr"+b].visible=!1;for(var l=0;l<o.length;l++)if(o[l].type==T[d]){this["attr"+b].visible=!0,this["attr"+b].text=AttributeData.getAttStr(o[l],0,1,":"),"shenshang"==this.currentState&&a[l]&&(this["forgeAttr"+b].visible=!0,this["forgeAttr"+b].text="+"+a[l].value);break}this["attr"+b].visible&&b++}if(this["starAttr"+C]){this["starAttr"+C].visible=!1;for(var l=0;l<r.length;l++)if(r[l].type==T[d]){this["starAttr"+C].visible=!0,this["starAttr"+C].text=AttributeData.getAttStr(r[l],0,1,":");break}this["starAttr"+C].visible&&C++}}for(var d=0;3>=d;d++)this["attr"+d]&&!this["attr"+d].visible&&DisplayUtils.removeFromParent(this["attr"+d].parent),this["starAttr"+d]&&!this["starAttr"+d].visible&&DisplayUtils.removeFromParent(this["starAttr"+d]);this.starAttr.numElements<=1&&DisplayUtils.removeFromParent(this.starAttr)},e.prototype.updateRedPoint=function(){var t=GlobalConfig.ItemConfig[this.itemId],e=ItemConfig.getSubType(t);this.changeRedPoint.visible=Hungu.ins().getUpgradeRedPoint(t.id),this.forgeRedPoint.visible=Hungu.ins().getHunyuRedPoint(this.roleId,e)},e.prototype.onTap=function(t){var e=GlobalConfig.ItemConfig[this.itemId],i=ItemConfig.getSubType(e);switch(t.currentTarget){case this.takeoffBtn:if("shenshang"!=this.currentState)return void UserTips.ins().showTips("不在身上卸载异常");if(Hungu.ins().hunguData[this.roleId]&&Hungu.ins().hunguData[this.roleId].items[i])return void Hungu.ins().sendHunguItems(this.roleId,i,0);UserTips.ins().showTips("没有可卸载的装备");break;case this.changeBtn:Hungu.ins().getNextHunguId(this.roleId,i)?ViewManager.ins().open(HunguStageWin,this.roleId,i):UserTips.ins().showTips("已满级");break;case this.hunyuBtn:if("shenshang"!=this.currentState)return void UserTips.ins().showTips("不在身上魂玉异常");ViewManager.ins().open(HunyuWin,this.roleId,this.itemId);break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(HunguTipsWin.prototype,"HunguTipsWin"),ViewManager.ins().reg(HunguTipsWin,LayerManager.UI_Popup);var HunguWin=function(t){function e(){var e=t.call(this)||this;return e.wireEffs=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cleanWireEff();for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++)this.cleanEff(i)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.getItemTxt0,this.onTap),this.addTouchEvent(this.executeBtn,this.onTap),this.addTouchEvent(this.executeBtn0,this.onTap),this.addTouchEvent(this.xiangxishuxing,this.onTap),this.addTouchEvent(this.fenjie,this.onTap);for(var i=0;i<GlobalConfig.HunGuConf.equipCount;i++)this.addTouchEvent(this["equip"+i],this.onSelect);this.observe(HunguRedPoint.ins().postRoleRedPoint,this.updateUI),this.observe(Hungu.ins().postNothing2Wear,this.HunguItemsResult),this.observe(Hungu.ins().postWear2Noting,this.HunguItemsResult),this.roleId=t[0],this.pos=t[1],this.initEff(),this.updateUI()},e.prototype.initEff=function(){this.posXian0=[this.HGliangxianzhi0,this.HGliangxianxie0],this.posXian1=[this.HGliangxianzhi1],this.posXian2=[this.HGliangxianzhi2,this.HGliangxianxie2],this.posXian3=[this.HGliangxianzhi3,this.HGliangxianxie3],this.posXian4=[this.HGliangxianzhi4,this.HGliangxianxie4],this.posXian5=[this.HGliangxianzhi5,this.HGliangxianxie5],this.posXian6=[this.HGliangxianzhi6,this.HGliangxianxie6],this.posXian7=[this.HGliangxianzhi7,this.HGliangxianxie7],this.effectPos=[this.effectPos0,this.effectPos1,this.effectPos2,this.effectPos3,this.effectPos4,this.effectPos5,this.effectPos6,this.effectPos7],this.liangdian=[this.liangdian0,this.liangdian1,this.liangdian2,this.liangdian3,this.liangdian4,this.liangdian5,this.liangdian6,this.liangdian7];var t=new MovieClip;t.playFile(RES_DIR_EFF+"hguieffect1",-1),this.effect1quanshen.addChild(t),this.updateEff()},e.prototype.updateEff=function(){var t=Hungu.ins().hunguData[this.roleId];if(t){for(var e=!0,i=0;8>i;i++)if(t.items[i].itemId){for(var s in this["posXian"+i])this["posXian"+i][s].visible=!0;this.liangdian[i].visible=!0}else e=!1;var n=[null,this.effect2toubu,this.effect3xia];for(var o in GlobalConfig.HunGuConf.suit){var a=+o;if(a&&n[a]){var r=Hungu.ins().getSuitData(this.roleId);for(var i in r[a])if(!(r[a][i].count.length<+i)){var h=r[a][i].stage,l=GlobalConfig.HunGuSuit[a][i][h];if(l.effectId){var c=void 0;n[a].numElements?c=n[a].getChildAt(0):(c=new MovieClip,n[a].addChild(c)),c.playFile(RES_DIR_EFF+l.effectId,-1)}}}}}},e.prototype.onSelect=function(t){for(var e=0;e<GlobalConfig.HunGuConf.equipCount;e++)if(this["equip"+e]&&(this["equip"+e].select.visible=!1,t.currentTarget==this["equip"+e])){this.pos=e,this["equip"+e].select.visible=!0;var i=Hungu.ins().hunguData[this.roleId];if(i&&i.items[e].itemId)ViewManager.ins().open(HunguTipsWin,!0,this.roleId,i.items[e].itemId);else{var s=Hungu.ins().getHunguItemsList(e);s.length?Hungu.ins().sendHunguItems(this.roleId,e,s[0].configID):UserTips.ins().showTips("未拥有当前部位魂骨")}}},e.prototype.updateUI=function(){for(var t=Hungu.ins(),e=t.getResonancePower(this.roleId),i=t.getSuitData(this.roleId),s=0;s<GlobalConfig.HunGuConf.equipCount;s++)this.updateItem(s),e+=t.getHunguPosPower(this.roleId,s,i,!0),this.powerPanel0.setPower(e);this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt0.text)},e.prototype.updateItem=function(t){void 0===t&&(t=0);var e=this["equip"+t];if(e){var i=Hungu.ins(),s=e.itemIcon;s.imgJob.visible=!1,e.level.visible=!1,s.imgIcon.source="hungu"+t,e.select.visible=this.pos==t?!0:!1,s.imgBg.source=1>=t?"wupingkuangNB":"quality0";var n=i.hunguData[this.roleId];if(n&&n.items[t].itemId){var o=n.items[t].itemId,a=GlobalConfig.ItemConfig[o];s.imgIcon.source=a.icon+"_png"}else for(var r in this["posXian"+t])this["posXian"+t][r].visible=!1;e.redPoint.visible=this.getRedPoint(t)}},e.prototype.getRedPoint=function(t){return HunguRedPoint.ins().HunguItemRedPoint(this.roleId,t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.getItemTxt0:UserWarn.ins().setBuyGoodsWarn(GlobalConfig.HunGuConf.gainItemId);break;case this.executeBtn:ViewManager.ins().open(HunguGroupWin,this.roleId,1);break;case this.executeBtn0:ViewManager.ins().open(HunguGroupWin,this.roleId,2);break;case this.xiangxishuxing:ViewManager.ins().open(HunguAttrWin,this.roleId);break;case this.fenjie:ViewManager.ins().open(SmeltItemTotalWin,this.getSmeltList())}},e.prototype.getSmeltList=function(){var t=[],e=GlobalConfig.HunGuConf.canFenjieItem;for(var i in e){var s=UserBag.ins().getBagItemById(e[i]);s&&t.push(s)}return t},e.prototype.HunguItemsResult=function(t){var e=t[0],i=t[1];e?this.playEff(i):this.cleanEff(i)},e.prototype.cleanEff=function(t){void 0===t&&(t=0);for(var e in this["posXian"+t])this["posXian"+t][e].visible=!1;this.liangdian[t].visible=!1;var i=0;for(var e in GlobalConfig.HunGuConf.suit)if(-1!=GlobalConfig.HunGuConf.suit[e].indexOf(t)){i=+e;break}var s=[null,this.effect2toubu,this.effect3xia];s[i]&&s[i].removeChildren()},e.prototype.playEff=function(t){void 0===t&&(t=0);var e=1e3,i=[],s=0;for(var n in this["posXian"+t])s+=this["posXian"+t][n].width,this["posXian"+t][n].scrollRect=new egret.Rectangle(0,0,0,this["posXian"+t][n].height),this["posXian"+t][n].visible=!0;var o=0;for(var n in this["posXian"+t])Number(n)==this["posXian"+t].length-1?i[n]=e-o:(i[n]=this["posXian"+t][n].width/s*e,o+=i[n]);this.playWireEff(this["posXian"+t],i,0,t);var a=[null,this.effect2toubu,this.effect3xia],r=0;for(var n in GlobalConfig.HunGuConf.suit)if(-1!=GlobalConfig.HunGuConf.suit[n].indexOf(t)){r=+n;break}if(a[r]){var h=Hungu.ins().getSuitData(this.roleId);for(var n in h[r])if(!(h[r][n].count.length<+n)){var l=h[r][n].stage,c=GlobalConfig.HunGuSuit[r][n][l];if(c.effectId){var u=void 0;a[r].numElements?u=a[r].getChildAt(0):(u=new MovieClip,a[r].addChild(u)),u.playFile(RES_DIR_EFF+c.effectId,-1)}}}},e.prototype.playWireEff=function(t,e,i,s){var n=this;if(void 0===i&&(i=0),void 0===s&&(s=0),t[i]){var o=egret.Tween.get(t[i].scrollRect);o.to({width:t[i].width},e[i]).call(function(){if(egret.Tween.removeTweens(o),t[i].scrollRect.width=t[i].width,i++,i>=t.length){var a=new MovieClip;a.playFile(RES_DIR_EFF+"hguieffect0",1),n.effectPos[s].addChild(a),n.liangdian[s].visible=!0}else n.playWireEff(t,e,i,s)},this),this.wireEffs[s]||(this.wireEffs[s]=[]),this.wireEffs[s][i]&&egret.Tween.removeTweens(this.wireEffs[s][i]),this.wireEffs[s][i]=o}},e.prototype.cleanWireEff=function(){if(this.wireEffs)for(var t=0;t<this.wireEffs.length;t++)if(this.wireEffs[t])for(var e in this.wireEffs[t])egret.Tween.removeTweens(this.wireEffs[t][e])},e}(BaseView);__reflect(HunguWin.prototype,"HunguWin");var HunyuWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguJewelSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().close(HunguTipsWin),this.addTouchEvent(this.executeBtn0,this.onTap),this.addTouchEvent(this.executeBtn,this.onTap),this.addTouchEvent(this.getItemTxt0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Hungu.ins().postHunyu,this.updateShow),this.observe(Hungu.ins().postHunyu,this.playEff);for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++)this.addTouchEvent(this["equip"+i],this.onSelect);this.roleId=t[0],this.itemId=t[1],this.kong=t[2]||0,this["equip"+this.kong].select.visible=!0,this.updateShow()},e.prototype.onSelect=function(t){for(var e=0;e<GlobalConfig.HunGuConf.hunyuCount;e++){var i=this["equip"+e];if(i.select.visible=!1,i&&t.currentTarget==i){var s=GlobalConfig.ItemConfig[this.itemId],n=ItemConfig.getSubType(s);if(e+1>GlobalConfig.HunGuEquip[Hungu.ins().hunguData[this.roleId].items[n].itemId].hunyuNum){var o=Hungu.ins().getHunguItemQualityName(0,e+1);o&&UserTips.ins().showTips("融合"+o+"魂骨后开启"),this["equip"+this.kong].select.visible=!0}else this.kong!=e?(i.select.visible=!0,this.kong=e,this.updateShow()):i.select.visible=!0}}},e.prototype.updateShow=function(){this.updateAct(),this.updateUI(),this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt0.text)},e.prototype.playEff=function(){var t=this["equip"+this.kong];if(t){var e=new MovieClip;e.playFile(RES_DIR_EFF+"forgeSuccess",1),t.eff.addChild(e)}},e.prototype.updateUI=function(){this.hide(),this.updateItems()},e.prototype.updateItems=function(){var t=this.equip,e=t.itemIcon,i=GlobalConfig.ItemConfig[this.itemId];e.setData(i);for(var s=ItemConfig.getSubType(i),n=Hungu.ins(),o=0;o<GlobalConfig.HunGuConf.hunyuCount;o++){var a=this["equip"+o],r=a.openText;if(a){var h=n.getHunyuKongRedPoint(this.roleId,s,o);a.redPoint.visible=h;var l=a.itemIcon;l.icon.visible=!1,a.kejihuo.visible=!1,l.lock.visible=!1,r.visible=!1,a.level.visible=!1,a.lvBg.visible=!0;var c=GlobalConfig.HunGuEquip[n.hunguData[this.roleId].items[s].itemId].hunyuNum;if(o+1>c)if(l.lock.visible=!0,o==c){r.visible=!0;var u=Hungu.ins().getHunguItemQualityName(0,o+1);u&&(r.text=u+"开启")}else a.lvBg.visible=!1;else{a.level.visible=!0,l.icon.visible=!0;var p=n.hunguData[this.roleId].items[s].hunyu[o];if(p){var d=GlobalConfig.HunGuConf.hunyuType[s][o];l.icon.source=GlobalConfig.HunYuEquip[d][p].icon,a.level.text=p+"级"}else a.level.text="0级",h&&(a.kejihuo.visible=!0,l.icon.visible=!1,a.lvBg.visible=!1,a.level.visible=!1)}}}var g=0;if(n.hunguData[this.roleId]&&n.hunguData[this.roleId].items[s].hunyu)for(var f=GlobalConfig.HunGuConf.hunyuType[s][this.kong],o=0;o<n.hunguData[this.roleId].items[s].hunyu.length;o++){var v=n.hunguData[this.roleId].items[s].hunyu[o],y=GlobalConfig.HunYuEquip[f][v];if(y){g+=UserBag.getAttrPower(y.attrs,SubRoles.ins().getSubRoleByIndex(this.roleId));var m=y.expower?y.expower:0;g+=m}}this.powerPanel0.setPower(g);var T=GlobalConfig.HunGuConf.hunyuType[s][this.kong];if("activation"==this.currentState){var b=GlobalConfig.HunYuEquip[T][1],C=GlobalConfig.HunGuConf.unlockCost[this.kong+1],I=ColorUtil.RED_COLOR_N;if(!this.kong&&b.cost){this.actRMB=!1,C=b.cost.count;var w=UserBag.ins().getBagItemById(b.cost.id),_=w?w.count:0;_>=C&&(I=ColorUtil.GREEN_COLOR_N),this.icon0.source=GlobalConfig.ItemConfig[b.cost.id].icon+"_png",this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+I+"&T:"+_+"|/"+C)}else this.actRMB=!0,this.icon0.source="szyuanbao",Actor.yb>=C&&(I=ColorUtil.GREEN_COLOR_N),this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+I+"&T:"+Actor.yb+"|/"+C);this.name0.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][1].name),this.att0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][1].attrs,1)}else if("max"==this.currentState){var v=n.hunguData[this.roleId].items[s].hunyu[this.kong];this.name1.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][v].name),this.att1.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][v].attrs,1)}else{var v=n.hunguData[this.roleId].items[s].hunyu[this.kong];this.curname.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][v].name),this.curAtt0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][v].attrs,1),this.nextname.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][v+1].name),this.nextAtt0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][v+1].attrs,1);var S=Hungu.ins().getNextHunyuLvConfig(this.roleId,s,this.kong);if(S){var I=ColorUtil.RED_COLOR_N,B=S.cost.count,w=UserBag.ins().getBagItemById(S.cost.id),E=w?w.count:0;E>=B&&(I=ColorUtil.GREEN_COLOR_N),this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+I+"&T:"+E+"|/"+B),this.icon1.source=GlobalConfig.ItemConfig[S.cost.id].icon+"_png"}}},e.prototype.hide=function(){var t=this.equip,e=t.itemIcon;t.level.visible=!1;for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){var s=this["equip"+i];e=s.itemIcon,s.level.visible=!1}},e.prototype.updateAct=function(){var t=Hungu.ins(),e=GlobalConfig.ItemConfig[this.itemId],i=ItemConfig.getSubType(e);if(t.hunguData[this.roleId]&&t.hunguData[this.roleId].items[i].hunyu[this.kong]){var s=GlobalConfig.HunGuConf.hunyuType[i][this.kong],n=t.hunguData[this.roleId].items[i].hunyu[this.kong];n>=CommonUtils.getObjectLength(GlobalConfig.HunYuEquip[s])?this.currentState="max":this.currentState="upgrade"}else this.currentState="activation";this.validateNow()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.executeBtn0:if("activation"==this.currentState)if(this.actRMB){var e=GlobalConfig.HunGuConf.unlockCost[this.kong+1];if(Actor.yb>=e){var i=GlobalConfig.ItemConfig[this.itemId],s=ItemConfig.getSubType(i);Hungu.ins().sendHunyu(this.roleId,s,this.kong+1)}else UserTips.ins().showTips("元宝不足")}else{var n=GlobalConfig.ItemConfig[this.itemId],o=ItemConfig.getSubType(n),a=GlobalConfig.HunGuConf.hunyuType[o][this.kong],r=GlobalConfig.HunYuEquip[a][1],h=UserBag.ins().getBagItemById(r.cost.id),l=h?h.count:0;l>=r.cost.count?Hungu.ins().sendHunyu(this.roleId,o,this.kong+1):UserTips.ins().showTips("材料不足")}else UserTips.ins().showTips("非可激活状态");break;case this.executeBtn:if("upgrade"==this.currentState){var i=GlobalConfig.ItemConfig[this.itemId],s=ItemConfig.getSubType(i),c=Hungu.ins().getNextHunyuLvConfig(this.roleId,s,this.kong);if(c&&c.cost){var h=UserBag.ins().getBagItemById(c.cost.id),u=h?h.count:0;u>=c.cost.count?Hungu.ins().sendHunyu(this.roleId,s,this.kong+1):UserTips.ins().showTips("材料不足")}else UserTips.ins().showTips("魂玉消耗数据异常")}else UserTips.ins().showTips("非可升级状态");break;case this.getItemTxt0:if("upgrade"==this.currentState){var i=GlobalConfig.ItemConfig[this.itemId],s=ItemConfig.getSubType(i),p=GlobalConfig.HunGuConf.hunyuType[s][this.kong],d=Hungu.ins().hunguData[this.roleId].items[s].hunyu[this.kong],c=GlobalConfig.HunYuEquip[p][d+1];c&&c.cost&&UserWarn.ins().setBuyGoodsWarn(c.cost.id)}else UserTips.ins().showTips("非获取道具状态");break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(HunyuWin.prototype,"HunyuWin"),ViewManager.ins().reg(HunyuWin,LayerManager.UI_Main);var KFData=function(){function t(){}return t}();__reflect(KFData.prototype,"KFData");var KFDropRecordData=function(){function t(t){this.type=t.readShort(),this.type==KFDropType.KF_BOSS?this.kfBossData(t):this.type==KFDropType.DEVILDOM&&this.devildomData(t)}return t.prototype.kfBossData=function(t){this.time=t.readInt(),this.roleId=t.readInt(),this.servId=t.readInt(),this.nick=t.readString(),this.sceneName=t.readString(),this.bossName=t.readString(),this.goodsId=t.readInt(),this.time=Math.floor(DateUtils.formatMiniDateTime(this.time)/DateUtils.MS_PER_SECOND)},t.prototype.devildomData=function(t){this.time=t.readInt(),this.servId=t.readInt(),this.guildName=t.readString(),this.bossName=t.readString(),this.goodsId=t.readInt(),this.time=Math.floor(DateUtils.formatMiniDateTime(this.time)/DateUtils.MS_PER_SECOND)},t}();__reflect(KFDropRecordData.prototype,"KFDropRecordData");var KFDropType;!function(t){t[t.KF_BOSS=1]="KF_BOSS",t[t.DEVILDOM=2]="DEVILDOM"}(KFDropType||(KFDropType={}));var DevildomRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=0,e.redPoints=[],e.associated(e.postRedPoint,DevildomSys.ins().postBossInfo,DevildomSys.ins().postInfo),e}return __extends(e,t),e.prototype.postRedPoint=function(){this.redPoint=0;var t=DevildomSys.ins();if(t.isOpen()){for(var e in t.killedState)this.redPoints[e]=!(t.killedState[e]||t.historyId&&t.historyId!=e);this.redPoint=this.redPoints.indexOf(!0)>-1?1:0}},e}(BaseSystem);__reflect(DevildomRedPoint.prototype,"DevildomRedPoint");var GameSystem;!function(t){t.devildomRedPoint=DevildomRedPoint.ins.bind(DevildomRedPoint)}(GameSystem||(GameSystem={}));var DevildomSys=function(t){function e(){var e=t.call(this)||this;return e.refTime=[],e.dropRecordDataList=[],e.sysId=PackageID.Devildom,e.regNetMsg(1,e.postBossInfo),e.regNetMsg(2,e.postAscriptionChange),e.regNetMsg(3,e.postRevive),e.regNetMsg(7,e.doResult),e.regNetMsg(8,e.postInfo),e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType==UserFb.FB_TYPE_DEVILDOM_BOSS?e.postEnterFb():GameMap.lastFbTyp==UserFb.FB_TYPE_DEVILDOM_BOSS&&e.postQuiKFb()}),e.observe(UserBoss.ins().postBossAppear,function(){e.isDevildomBattle&&ViewManager.ins().open(BossBelongPanel)}),e}return __extends(e,t),e.prototype.postBossInfo=function(t){var e=t.readShort();this.killedState=[];for(var i=[],s=0;e>s;s++){var n=t.readShort(),o=t.readInt(),a=t.readBoolean();this.killedState[n]=a,i[n]=o}this.historyId&&this.refTime[this.historyId]&&i[this.historyId]!=this.refTime[this.historyId]&&(this.historyId=0),this.refTime=i.concat()},e.prototype.postAscriptionChange=function(t){var e=t.readDouble(),i=t.readDouble(),s="";if(e>0){var n=EntityManager.ins().getMasterList(e);n&&n[0]&&n[0].infoModel&&(s=n[0].infoModel.name)}UserBoss.ins().postBelongChange(i,e,s)},e.prototype.postRevive=function(t){var e=t.readInt(),i=t.readDouble();if(e>0)ViewManager.ins().open(DevildomReliveWin,e,i);else if(ViewManager.ins().close(DevildomReliveWin),KFServerSys.ins().isKF){var s=Actor.yb-GlobalConfig.CrossBossBase.rebornCost;Actor.ins().postYbChange(s)}},e.prototype.doResult=function(t){for(var e=t.readString(),i=t.readDouble(),s=t.readBoolean(),n=t.readShort(),o=[],a=0;n>a;a++){var r=new RewardData;r.type=t.readInt(),r.id=t.readInt(),r.count=t.readInt(),o.push(r)}n=t.readShort();for(var h=[],a=0;n>a;a++){var l=t.readInt();h.push(GlobalConfig.AuctionItem[l].item)}ViewManager.ins().open(DevildomResultWin,i,e,s,h,o)},e.prototype.postInfo=function(t){this.historyId=t.readShort();var e=t.readShort();this.enterCD=1e3*e+egret.getTimer()},e.prototype.sendClearReliveCD=function(){this.sendBaseProto(3)},e.prototype.sendCleanBelong=function(){this.sendBaseProto(4)},e.prototype.sendEnter=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.postEnterFb=function(){this.isDevildomBattle=!0},e.prototype.postQuiKFb=function(){this.isDevildomBattle=!1,ViewManager.ins().close(BossBelongPanel)},e.prototype.isOpen=function(){return GameServer.isOpenLF&&GameServer.serverOpenDay+1>=GlobalConfig.DevilBossBase.openDay&&this.isHfTerm()},e.prototype.isHfTerm=function(){var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime)+GlobalConfig.DevilBossBase.hefuTimeLimit*DateUtils.MS_PER_DAY;return GameServer.serverTime-t>0},e}(BaseSystem);__reflect(DevildomSys.prototype,"DevildomSys");var GameSystem;!function(t){t.devildomSys=DevildomSys.ins.bind(DevildomSys)}(GameSystem||(GameSystem={}));var DevildomBossTab=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.id){var t=DevildomSys.ins();this.itemIcon.source="invasion_boss_head"+(this.data.id-1),this.nameLabel.text=GlobalConfig.DevilBossConfig[this.data.id].bossName,this.redPoint.visible=DevildomRedPoint.ins().redPoints[this.data.id],this.state.visible=t.killedState[this.data.id]}},e}(BaseItemRender);__reflect(DevildomBossTab.prototype,"DevildomBossTab");var DevildomBossModel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getCurBossIdByIndex=function(t){var e=GlobalConfig.DevilBossConfig[t].openBossList;return e[0]||e[1]},e.prototype.getCurFbIndex=function(){var t=DevildomSys.ins();if(t.historyId)return t.historyId-1;var e=[];for(var i in t.killedState)t.killedState[i]||e.push(i);return e.length>0?e[MathUtils.limit(0,e.length)>>0]-1:MathUtils.limit(0,3)>>0},e}(BaseClass);__reflect(DevildomBossModel.prototype,"DevildomBossModel");var DevildomBelongAwardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionBelongSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.saleReward0.itemRenderer=ItemBase,this.belongReward0.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.BG,this.onCloseWin),this.addTouchEvent(this.tipGroup1,this.onCloseWin),this.belongReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongAwards)),this.saleReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongSaleAwards))},e.prototype.onCloseWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DevildomBelongAwardWin.prototype,"DevildomBelongAwardWin"),ViewManager.ins().reg(DevildomBelongAwardWin,LayerManager.UI_Popup);var DevildomBossAwardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionJiangLiTishiSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.belongReward1.itemRenderer=ItemBase,this.saleReward1.itemRenderer=ItemBase,this.belongReward0.itemRenderer=ItemBase,this.saleReward0.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onCloseWin),this.addTouchEvent(this.giveUp,this.onCloseWin),this.belongReward1.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongAwards)),this.saleReward1.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.belongSaleAwards)),this.belongReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partAwards)),this.saleReward0.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partSaleAwards))},e.prototype.onCloseWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DevildomBossAwardWin.prototype,"DevildomBossAwardWin"),ViewManager.ins().reg(DevildomBossAwardWin,LayerManager.UI_Popup);var DevildomPartAwardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionPartSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.saleReward.itemRenderer=ItemBase,this.belongReward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.BG,this.onCloseWin),this.addTouchEvent(this.tipGroup0,this.onCloseWin),this.belongReward.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partAwards)),this.saleReward.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.DevilBossBase.partSaleAwards))},e.prototype.onCloseWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DevildomPartAwardWin.prototype,"DevildomPartAwardWin"),ViewManager.ins().reg(DevildomPartAwardWin,LayerManager.UI_Popup);var DevildomReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin",this.aliveNum=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.reliveBtn,this.onRelive),this.addTouchEvent(this.exitBtn,this.onTap),this.setWin(t[0],t[1])},e.prototype.setWin=function(t,e){if(e>0){var i=EntityManager.ins().getEntityByHandle(e),s="";if(i){var n=EntityManager.ins().getEntityByHandle(i.infoModel.masterHandle);s=i instanceof CharRole?i.infoModel.name:i.infoModel.masterHandle&&n?""+n.infoModel.name:"Boss"+i.infoModel.name}this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+s+"|击败"),this.alive.visible=!1,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1")}this.reliveBtn.label=GlobalConfig.DevilBossBase.rebornCost+"原地复活",this.reliveTimesTxt.text=t+"秒",this.remainM=t,TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒"
},e.prototype.overTime=function(){ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.exitBtn:UserFb.ins().sendExitFb()}},e.prototype.onRelive=function(t){return this.aliveNum?void DevildomSys.ins().sendClearReliveCD():void(GlobalFun.checkMoney(GlobalConfig.DevilBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活")&&DevildomSys.ins().sendClearReliveCD())},e}(BaseEuiView);__reflect(DevildomReliveWin.prototype,"DevildomReliveWin"),ViewManager.ins().reg(DevildomReliveWin,LayerManager.UI_Popup);var DevildomResultWin=function(t){function e(){var e=t.call(this)||this;return e.quitTime=30,e.skinName="KFInvasionResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.saleList.itemRenderer=ItemBase,this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onCloseWin);var i=EntityManager.ins().getEntityByHandle(t[0]);if(i){var s=i.infoModel,n=s.name;n=StringUtils.replaceStr(n,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(n+"【"+s.guildName+"】"),this.roleIcon.icon="yuanhead"+s.job+s.sex}else this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(""+t[1]);this.roleIcon.jobImg.visible=!1,t[2]||(this.rewardLabel.text="我的参与奖：");var o=t[3];this.saleList.dataProvider=new eui.ArrayCollection(o),0==o.length&&(this.saleLabel.text="行会拍卖品：无");var a=t[4];this.rewardList.dataProvider=new eui.ArrayCollection(a),TimerManager.ins().doTimer(1e3,this.quitTime+1,this.onTimer,this),this.onTimer()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this)},e.prototype.onCloseWin=function(){ViewManager.ins().close(this),UserFb.ins().sendExitFb()},e.prototype.onTimer=function(){this.closeBtn.label="确定("+--this.quitTime+")",this.quitTime<=0&&this.onCloseWin()},e}(BaseEuiView);__reflect(DevildomResultWin.prototype,"DevildomResultWin"),ViewManager.ins().reg(DevildomResultWin,LayerManager.UI_Popup);var DevildomWin=function(t){function e(){var e=t.call(this)||this;return e.MAX_LEN=4,e.TAB_W=92,e.isTopLevel=!0,e.skinName="KFInvasionSkin",e}return __extends(e,t),e.prototype.initUI=function(){var t=Object.keys(GlobalConfig.DevilBossConfig).length;this.leftGroup.visible=t>this.MAX_LEN,this.rightGroup.visible=t>this.MAX_LEN,this.refreshTime.text=GlobalConfig.DevilBossBase.startTime[0]+":"+GlobalConfig.DevilBossBase.startTime[1],this.bossBody=new MovieClip,this.bossBody.x=0,this.bossBody.y=0,this.bossGroup.addChild(this.bossBody),this.menuList.itemRenderer=DevildomBossTab,this.menuData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.seeRule,this.onTouch),this.addTouchEvent(this.challengeBtn,this.onTouch),this.addTouchEvent(this.belongBtn,this.onTouch),this.addTouchEvent(this.partBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.addChangeEvent(this.menuList,this.onChoose),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(DevildomSys.ins().postBossInfo,this.initData),this.dataSys=DevildomSys.ins();var i=isNaN(t[0])?0:t[0];this.menuList.selectedIndex=i,this.selectBoss(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.initData=function(){this.menuData.replaceAll(CommonUtils.objectToArray(GlobalConfig.DevilBossConfig))},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-this.MAX_LEN)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.menuList.dataProvider.length<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1)},e.prototype.onTouch=function(t){var e=this;switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[38].text);break;case this.challengeBtn:var i=(this.dataSys.enterCD-egret.getTimer())/1e3>>0;if(i>0)return void UserTips.ins().showTips("|C:0xf3311e&T:"+i+"秒后可以进入！");var s=GlobalConfig.DevilBossConfig[this.menuList.selectedItem.id],n=s.levelLimit/1e3>>0;if(n>UserZs.ins().lv)return void UserTips.ins().showTips("|C:0xf3311e&T:转生等级到达"+n+"级可进去！");var o=s.levelLimit%1e3;if(o>Actor.level)return void UserTips.ins().showTips("|C:0xf3311e&T:人物等级到达"+o+"级可进去！");if(DevildomSys.ins().historyId){if(DevildomSys.ins().historyId!=this.menuList.selectedItem.id)return void UserTips.ins().showTips("|C:0xf3311e&T:您已进入"+GlobalConfig.DevilBossConfig[DevildomSys.ins().historyId].bossName+"地图，无法再进入此魔君地图！");DevildomSys.ins().sendEnter(this.menuList.selectedItem.id)}else WarnWin.show("魔君刷新后，只可进入其中一位魔君的地图且不可改变，是否进入？",function(){e.dataSys.sendEnter(e.menuList.selectedItem.id)},this);break;case this.closeBtn:ViewManager.ins().close(this);break;case this.belongBtn:ViewManager.ins().open(DevildomBelongAwardWin);break;case this.partBtn:ViewManager.ins().open(DevildomPartAwardWin);break;case this.leftBtn:var a=this.TAB_W*this.MAX_LEN,r=this.menuList.scrollH-a;r=Math.round(r/this.TAB_W)*this.TAB_W,0>r&&(r=0),this.menuList.scrollH=r;break;case this.rightBtn:a=this.TAB_W*this.MAX_LEN,r=this.menuList.scrollH+a,r=Math.round(r/this.TAB_W)*this.TAB_W,r>this.menuList.contentWidth-this.menuScroller.width&&(r=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=r}},e.prototype.onChoose=function(t){this.selectBoss(this.menuList.selectedIndex)},e.prototype.selectBoss=function(t){var e=this.menuList.selectedItem.id,i=DevildomBossModel.ins().getCurBossIdByIndex(e),s=GlobalConfig.MonstersConfig[i],n="monster"+s.avatar+"_3s";this.bossBody.playFile(RES_DIR_MONSTER+n,-1),this.bossName.source="invasion_boss_name"+t,this.challengeBtn.enabled=this.dataSys.killedState.length>0&&!this.dataSys.killedState[e]},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=DevildomSys.ins().isOpen();return GameServer.isOpenLF?DevildomSys.ins().isHfTerm()?GameServer.serverOpenDay+1<GlobalConfig.DevilBossBase.openDay&&UserTips.ins().showTips("|C:0xf3311e&T:开服"+GlobalConfig.DevilBossBase.openDay+"天后可参与魔界入侵玩法"):UserTips.ins().showTips("|C:0xf3311e&T:合服期间不可进入"):UserTips.ins().showTips("|C:0xf3311e&T:开启跨服后可参与魔界入侵玩法"),i},e}(BaseEuiView);__reflect(DevildomWin.prototype,"DevildomWin"),ViewManager.ins().reg(DevildomWin,LayerManager.UI_Main);var KfArenaData=function(){function t(t){t&&this.readData(t)}return t.prototype.readData=function(t){this.servId=t.readInt(),this.playerName=t.readString(),this.killNum=t.readShort(),this.aidNum=t.readShort(),this.collectNum=t.readShort(),this.curScore=t.readShort(),this.curGetScore=t.readShort(),this.totalScore=t.readShort(),this.isFirstKiller=t.readBoolean(),this.isFirstCollect=t.readBoolean(),this.isMvp=t.readBoolean(),this.isOnWin=t.readBoolean(),this.isDeserter=t.readBoolean()},t.prototype.readRankData=function(t){this.servId=t.readInt(),this.playerName=t.readString(),this.killNum=t.readShort(),this.aidNum=t.readShort(),this.collectNum=t.readShort(),this.curScore=t.readShort(),this.totalScore=t.readShort()},t}();__reflect(KfArenaData.prototype,"KfArenaData");var KfArenaNoticeData=function(){function t(t){var e=t.readShort();1==e||3==e?(this.servId=t.readInt(),this.name=t.readString()):(this.killerServId=t.readInt(),this.killerName=t.readString(),this.deadServId=t.readInt(),this.deadName=t.readString()),this.noticeId=t.readShort()}return t}();__reflect(KfArenaNoticeData.prototype,"KfArenaNoticeData");var KfArenaRankData=function(){function t(t){this.rank=t.readInt(),this.playerId=t.readInt(),this.score=t.readInt(),this.vip=t.readInt(),this.playerName=t.readString(),this.dan=t.readInt(),this.servId=t.readInt()}return t}();__reflect(KfArenaRankData.prototype,"KfArenaRankData");var KfArenaRoleVo=function(){function t(){this.curMonth=new kfArenaMark,this.history=new kfArenaMark,this.power=0,this.winRate=0}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.serverId=t.readInt(),this.isonline=0!=t.readInt(),this.duanLevel=t.readInt(),this.score=t.readInt(),this.curMonth.parse(t),this.history.parse(t),this.power=t.readInt(),this.winRate=t.readInt()/100,this.roleName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.cloth=t.readInt(),this.weapon=t.readInt(),this.wingLv=t.readInt(),this.wingState=t.readByte(),this.pos1=t.readInt(),this.pos2=t.readInt(),this.pos3=t.readInt(),this.zs=t.readInt(),this.lv=t.readInt()},t.prototype.isLeader=function(){return KfArenaSys.ins().leaderID==this.roleID},t}();__reflect(KfArenaRoleVo.prototype,"KfArenaRoleVo");var kfArenaMark=function(){function t(){}return t.prototype.parse=function(t){this.win=t.readInt(),this.ping=t.readInt(),this.fail=t.readInt()},t}();__reflect(kfArenaMark.prototype,"kfArenaMark");var KFInviteData=function(){function t(){}return t.prototype.parse=function(t){this.roleId=t.readInt(),this.name=t.readString(),this.power=t.readInt(),this.score=t.readInt(),this.winRate=t.readInt()/100},t}();__reflect(KFInviteData.prototype,"KFInviteData");var KFInviteType;!function(t){t[t.Friend=0]="Friend",t[t.Guild=1]="Guild"}(KFInviteType||(KFInviteType={}));var KfArenaBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName="BtnTab0Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelDisplay.text=this.data},e}(BaseItemRender);__reflect(KfArenaBtn.prototype,"KfArenaBtn");var KfArenaDataItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof KfArenaData&&(this.rankTxt.text=this.data.rank+"",this.nameTxt.text=this.data.playerName+"",this.kaTxt.text=this.data.killNum+"/10",this.collectionTxt.text=this.data.collectNum+"",this.scoreTxt.text=this.data.curScore+"",this.arenaPointTxt.text=this.data.curGetScore+"",this.arenaScoreTxt.text=this.data.totalScore+"",this.mvp.visible=this.data.isMvp,this.data.isOnWin?this.tags.visible=!0:this.data.isDeserter?this.tags.visible=!0:this.tags.visible=!1)},e}(BaseItemRender);__reflect(KfArenaDataItem.prototype,"KfArenaDataItem");var KfArenaDuanItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaDuanItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.dwImg.source=""+t.mail.head,this.dwName.text=""+t.mail.context,this.reward.dataProvider=new eui.ArrayCollection(t.mail.tAwardList)}},e}(BaseItemRender);__reflect(KfArenaDuanItemRender.prototype,"KfArenaDuanItemRender");var KfArenaJoinItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaJoinItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=ItemBase,this.rewardList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){if(this.data){this.redPoint.visible=!1,this.get.visible=!1,this.target.text=""+this.data.count;var t=KfArenaSys.ins().dflState;1==(t>>this.data.id&1)?this.get.visible=!0:KfArenaSys.ins().dflCount>=this.data.count&&(this.redPoint.visible=!0),this.rewardList.dataProvider=new eui.ArrayCollection(this.data.award)}},e.prototype.onTap=function(t){this.redPoint.visible&&KfArenaSys.ins().sendJoinRewards(this.data.id)},e.prototype.destruct=function(){this.rewardList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(KfArenaJoinItemRender.prototype,"KfArenaJoinItemRender");var kfArenaMemberItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="kfArenaMemberItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemData=new GuildMemberInfo,this.inviteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){this.data instanceof GuildMemberInfo&&(this.itemData=this.data),this.data&&(this.nameLab.text=this.itemData.name,this.powerLab.text="战力："+CommonUtils.overLength(this.itemData.attack),this.scoreLab.text="积分："+this.itemData.score,this.winRateLab.text="胜率："+this.itemData.winRate+"%",this.face.source="head_"+this.itemData.job+this.itemData.sex,this.vipTitle.visible=0!=this.itemData.vipLevel)},e.prototype.onTap=function(t){KfArenaSys.ins().sendInvite(this.itemData.roleID)},e.prototype.destruct=function(){this.inviteBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(kfArenaMemberItemRender.prototype,"kfArenaMemberItemRender");var KfArenaRankItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof KfArenaRankData&&(this.data.rank<=3?(this.rankImg.source="paihang"+this.data.rank,this.rankTxt.visible=!1,this.rankImg.visible=!0):(this.rankTxt.text=this.data.rank+"",this.rankTxt.visible=!0,this.rankImg.visible=!1),this.player.text=this.data.playerName,this.score.text=this.data.score+"",this.seasonTitle.text=KfArenaSys.ins().duanName[this.data.dan],this.serverId.text="S"+this.data.servId,this.vip.visible=this.data.vip>0,GlobalConfig.CrossArenaBase.rankAward[this.data.rank]?(this.reward.data=GlobalConfig.CrossArenaBase.rankAward[this.data.rank].mail.tAwardList[0],this.reward.visible=!0):this.reward.visible=!1)},e}(BaseItemRender);__reflect(KfArenaRankItemRender.prototype,"KfArenaRankItemRender");var KfArenaRoleItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbRoleItem",e.touchEnabled=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){switch(t.target){case this.invite:case this.nomember:ViewManager.ins().open(KfArenaInviteWin);break;case this.body:this.data.roleID!=Actor.actorID&&ViewManager.ins().open(kfArenaCheckWin,this.data)}},e.prototype.dataChanged=function(){if(this.data){this.nomember.visible=this.invite.visible=!1,this.body.visible=this.position.visible=this.weapon.visible=!0;var t=this.data;this.onlineLabel.visible=!t.isonline,this.roleName.text=t.roleName,this.position.source=t.isLeader()?"tfb_leader":null,this.body.source=this.weapon.source=this.wing.source=null;var e=GlobalConfig.EquipConfig[t.cloth];if(e){var i=e.appearance;i&&i.indexOf("[job]")>-1&&(i=i.replace("[job]",t.job+"")),this.body.source=(t.cloth>0?i+"_":"body"+t.job+"00_")+t.sex+"_c_png"}var s=GlobalConfig.EquipConfig[t.weapon];if(s){var i=s.appearance;i&&i.indexOf("[job]")>-1&&(i=i.replace("[job]",t.job+"")),this.weapon.source=t.weapon>0?i+"_"+t.sex+"_c_png":""}this.wing.visible=!0;var n=GlobalConfig.WingLevelConfig[t.wingLv];n&&(this.wing.source=t.wingLv>=0?n.appearance+"_png":""),t.pos1>0&&(this.body.source=this.getZhuangbanById(t.pos1).res+"_"+t.sex+"_c_png"),t.pos2>0&&(this.weapon.source=this.getZhuangbanById(t.pos2).res+"_"+t.sex+"_c_png"),t.pos3>0&&(this.wing.source=this.getZhuangbanById(t.pos3).res+"_png"),this.body.source||(this.body.source="body000_"+t.sex+"_c_png")}else this.nomember.visible=this.invite.visible=!0,this.body.visible=this.position.visible=this.weapon.visible=this.wing.visible=!1,this.roleName.text="虚位以待"},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(KfArenaRoleItemRender.prototype,"KfArenaRoleItemRender");var KfArenaRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redpoint_1=0,e.redpoint_2=0,e.redpoint_3=0,e.associated(e.postRedPoint,KfArenaSys.ins().postJoinRewards,KfArenaSys.ins().postPlayerInfo),e}return __extends(e,t),e.prototype.postRedPoint=function(){this.redpoint_1=this.redpoint_2=this.redpoint_3=this.redpoint=0;var t=KfArenaSys.ins();return t.isOpen()?(this.redpoint_1=t.times,this.redpoint_2=t.getJoinRedPoint(),this.redpoint_3=t.getDuanRedPoint(),this.redpoint=this.redpoint_1+this.redpoint_2+this.redpoint_3,this.redpoint):0},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(KfArenaRedPoint.prototype,"KfArenaRedPoint");var GameSystem;!function(t){t.kfArenaRedPoint=KfArenaRedPoint.ins.bind(KfArenaRedPoint)}(GameSystem||(GameSystem={}));var KfArenaSys=function(t){function e(){var e=t.call(this)||this;return e.isKFArena=!1,e.times=0,e.duanLevel=0,e.score=0,e.leaderID=0,e.inviteDataList=[],e.worldTimeCd=0,e.flagHandle=10011010110,e.flagCD=0,e.duanName=["青铜","白银","黄金","白金","钻石","王者"],e.dflCount=0,e._openLeftTime=0,e._openTimer=0,e.isStartIng=0,e.sysId=PackageID.KfArena,e.regNetMsg(1,e.postPlayerInfo),e.regNetMsg(2,e.postTeamInfo),e.regNetMsg(5,e.postReceiveInvitation),e.regNetMsg(7,e.postBack),e.regNetMsg(9,e.postRefFlag),e.regNetMsg(10,e.doCollectFlag),e.regNetMsg(11,e.postRelive),e.regNetMsg(13,e.postFbInfo),e.regNetMsg(14,e.doResult),e.regNetMsg(16,e.postMacthState),e.regNetMsg(17,e.postChangeScore),e.regNetMsg(19,e.postDataInfo),e.regNetMsg(20,e.postKfArenaGuilds),e.regNetMsg(21,e.postNotice),e.regNetMsg(23,e.postJoinRewards),e.regNetMsg(26,e.postOpenKfArena),e.regNetMsg(25,e.postRank),e.observe(GameLogic.ins().postEnterMap,e.changeScene),e}return __extends(e,t),e.prototype.sendCreateTeam=function(){this.sendBaseProto(1)},e.prototype.postPlayerInfo=function(t){this.times=t.readInt(),this.duanLevel=t.readInt(),this.score=t.readInt(),this.curMouth||(this.curMouth=new kfArenaMark),this.curMouth.parse(t),this.history||(this.history=new kfArenaMark),this.history.parse(t)},e.prototype.sendPersonalMatch=function(){this.sendBaseProto(2)},e.prototype.postTeamInfo=function(t){this.leaderID=t.readInt(),this.macthState=t.readInt();var e=t.readInt();this.tfMembers=[];for(var i=0;e>i;i++){var s=new KfArenaRoleVo;this.tfMembers[i]=s,s.parse(t)}this.isTFCaptain=Actor.actorID==this.leaderID},e.prototype.sendLeaveTeam=function(){this.sendBaseProto(3)},e.prototype.sendStartMacth=function(){this.sendBaseProto(4)},e.prototype.sendCancelMacth=function(){this.sendBaseProto(16)},e.prototype.sendGuilds=function(t){var e=this.getBytes(20);e.writeInt(t),this.sendToServer(e)},e.prototype.sendInvite=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e),this.postKfArenaDelID(t)},e.prototype.postKfArenaDelID=function(t){return t},e.prototype.postReceiveInvitation=function(t){var e=new KFInviteData;e.parse(t),this.checkInviteByID(e.roleId)||this.inviteDataList.push(e),this.inviteDataList.length>0&&ViewManager.ins().open(kfReceiveInviteWin,0)},e.prototype.checkInviteByID=function(t){for(var e=0;e<this.inviteDataList.length;e++)if(this.inviteDataList[e].roleId==t)return!0;return!1},e.prototype.sendWorldInvite=function(){this.sendBaseProto(6)},e.prototype.sendRespondInvite=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postBack=function(t){var e=t.readInt();switch(e){case 1:ViewManager.ins().open(KfArenaWin,1)}},e.prototype.postMacthState=function(t){this.macthState=t.readInt()},e.prototype.postKfArenaGuilds=function(t){var e=t.readInt(),i=t.readInt();if(e==KFInviteType.Guild){this.guildDataList=[];for(var s=0;i>s;s++){var n=new GuildMemberInfo;n.parse(t),this.guildDataList.push(n)}}else if(e==KFInviteType.Friend){this.friendsDataList=[];for(var s=0;i>s;s++){var n=new GuildMemberInfo;n.parse(t),this.friendsDataList.push(n)}}return e},e.prototype.getDataList=function(t){var e,i=[];if(e=t==KFInviteType.Friend?this.friendsDataList:this.guildDataList,!e)return i;for(var s=0;s<e.length;s++)if(e[s].roleID!=Actor.actorID){var n=new GuildMemberInfo;n.copyData(e[s]),i.push(n)}return i},e.prototype.sendJoinTeam=function(t){var e=this.getBytes(18);e.writeInt(t),this.sendToServer(e)},e.prototype.sendOutTeam=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.postRefFlag=function(t){t.readDouble();this.flagCD=1e3*t.readInt()+egret.getTimer(),this.flagHandle=10011010110},e.prototype.doCollectFlag=function(t){var e=t.readDouble(),i=t.readInt();e&&e==Actor.handle&&i?(ViewManager.ins().open(CollectWin,e,i),GameLogic.ins().currAttackHandle=0):ViewManager.ins().close(CollectWin)},e.prototype.sendCollectFlag=function(){this.sendBaseProto(10)},e.prototype.postRelive=function(t){var e=t.readInt(),i=t.readDouble();ViewManager.ins().open(KfArenaReliveWin,e,i)},e.prototype.postFbInfo=function(t){var e=t.readInt();this.myCampId=t.readByte(),this.scoreA=t.readInt(),this.scoreB=t.readInt(),ViewManager.ins().open(KfArenaFightWin,(DateUtils.formatMiniDateTime(e)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0)},e.prototype.doResult=function(t){for(var e=t.readInt(),i=t.readInt(),s=t.readShort(),n=[],o=0;s>o;o++){var a=new KfArenaData(t);a.rank=o+1,n.push(a)}var r=[];s=t.readShort();for(var o=0;s>o;o++){var h=new RewardData;h.type=t.readInt(),h.id=t.readInt(),h.count=t.readInt(),r.push(h)}ViewManager.ins().open(KfArenaResultWin,e,i,n,r)},e.prototype.enterBattle=function(){this.sendBaseProto(15)},e.prototype.postChangeScore=function(t){this.scoreA=t.readInt(),this.scoreB=t.readInt()},e.prototype.postDataInfo=function(t){for(var e=t.readShort(),i=[],s=0;e>s;s++){var n=new KfArenaData;n.readRankData(t),i.push(n)}return ViewManager.ins().isShow(KfArenaInfoWin)||ViewManager.ins().open(KfArenaInfoWin,i),i},e.prototype.sendDataInfo=function(){this.sendBaseProto(19)},e.prototype.postNotice=function(t){return new KfArenaNoticeData(t)},e.prototype.postRank=function(t){this.rankDataList=[];for(var e=t.readInt(),i=0;e>i;i++)this.rankDataList.push(new KfArenaRankData(t));this.ownRank=t.readInt()},e.prototype.sendRank=function(){this.sendBaseProto(25)},e.prototype.getIsJoinTeam=function(){return 0!=this.leaderID},e.prototype.changeScene=function(){GameMap.fbType==UserFb.FB_TYPE_KF_ARENA?this.isKFArena=!0:GameMap.lastFbTyp==UserFb.FB_TYPE_KF_ARENA&&(this.isKFArena=!1,this.flagHandle=0)},e.prototype.getDuanAwards=function(){var t=GlobalConfig.CrossArenaBase.everyDayAward;for(var e in t)if(t[e].metal==this.duanLevel)return t[e].award;return null},e.prototype.getDuanName=function(){return this.duanName[this.duanLevel-1]},e.prototype.isOpen=function(){var t=GlobalConfig.CrossArenaBase.openDay<=GameServer.serverOpenDay+1&&UserZs.ins().lv>=GlobalConfig.CrossArenaBase.zhuanshengLevel;return t&&(1==this.isStartIng||0==this.isStartIng&&this._openLeftTime>0)?!0:!1},e.prototype.sendDailyRewards=function(){this.sendBaseProto(23)},e.prototype.sendJoinRewards=function(t){var e=this.getBytes(24);e.writeInt(t),this.sendToServer(e)},e.prototype.postJoinRewards=function(t){this.yesterdayDuan=t.readInt(),this.dailyState=t.readInt(),this.dflCount=t.readInt(),this.dflState=t.readInt()},e.prototype.postOpenKfArena=function(t){this.isStartIng=t.readInt(),this._openLeftTime=t.readInt(),this._openTimer=egret.getTimer()},e.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3},e.prototype.getDuanRedPoint=function(){return 0==this.dailyState?1:0},e.prototype.getJoinRedPoint=function(){var t=GlobalConfig.CrossArenaBase.peakAwards,i=1,s=0;for(var n in t)1!=(this.dflState>>i&1)&&e.ins().dflCount>=t[n].count&&s++,i++;return s},e}(BaseSystem);__reflect(KfArenaSys.prototype,"KfArenaSys");var GameSystem;!function(t){t.kfArenaSys=KfArenaSys.ins.bind(KfArenaSys)}(GameSystem||(GameSystem={}));var kfArenaCheckWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="kfArenaCheckSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.outBtn,this.onTouch),this.addTouchEvent(this.checkBtn,this.onTouch),this.data=t[0],this.update()},e.prototype.update=function(){this.currentState=KfArenaSys.ins().isTFCaptain?"normal":"check",this.nameLab.text=this.data.roleName,this.powerLab.text="战力："+CommonUtils.overLength(this.data.power),this.scoreLab.text="积分："+this.data.score,this.winRateLab.text="胜率："+this.data.winRate+"%",this.face.source="head_"+this.data.job+this.data.sex},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:break;case this.outBtn:KfArenaSys.ins().sendOutTeam(this.data.roleID);break;case this.checkBtn:UserReadPlayer.ins().sendFindPlayer(this.data.roleID,this.data.serverId)}ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(kfArenaCheckWin.prototype,"kfArenaCheckWin"),ViewManager.ins().reg(kfArenaCheckWin,LayerManager.UI_Popup);var KfArenaDuanPanel=function(t){function e(){var e=t.call(this)||this;return e.name="段位",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listArray=new eui.ArrayCollection,this.list.itemRenderer=KfArenaDuanItemRender,this.list.dataProvider=this.listArray,this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.rewardList,this.onTouch),this.observe(KfArenaSys.ins().postJoinRewards,this.update),this.update()},e.prototype.update=function(){this.listArray.source=GlobalConfig.CrossArenaBase.finalAward,this.rewardList.dataProvider=new eui.ArrayCollection(KfArenaSys.ins().getDuanAwards()),this.dw.text=KfArenaSys.ins().getDuanName(),this.redPoint.visible=0==KfArenaSys.ins().dailyState,this.get.visible=1==KfArenaSys.ins().dailyState},e.prototype.onTouch=function(t){KfArenaSys.ins().sendDailyRewards()},e}(BaseEuiView);__reflect(KfArenaDuanPanel.prototype,"KfArenaDuanPanel");var KfArenaFightWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaFightSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.bigTimeGroup.visible=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.modeSys=KfArenaSys.ins(),this.addTouchEvent(this.seeRule,this.onTouch),this.addTouchEvent(this.infoBtn,this.onTouch),this.observe(this.modeSys.postChangeScore,this.upScore),this.startTime=t[0],this.startCountDown(this.startTime),this.upScore()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.upScore=function(){this.blueScore.text=this.modeSys.scoreA+"",this.redScore.text=this.modeSys.scoreB+""},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text);break;case this.infoBtn:KfArenaSys.ins().sendDataInfo()}},e.prototype.startCountDown=function(t){this.timeGo(),t>0&&(this.bigTimeGroup.visible=!0,TimerManager.ins().doTimer(1e3,t+1,this.timeGo,this))},e.prototype.timeGo=function(){this.startTime>0?(this.countDown.text=this.startTime+"",this.startTime--):this.bigTimeGroup.visible=!1},e}(BaseEuiView);__reflect(KfArenaFightWin.prototype,"KfArenaFightWin"),ViewManager.ins().reg(KfArenaFightWin,LayerManager.UI_Popup);var KfArenaInfoWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=KfArenaDataItem,this.itemDt=new eui.ArrayCollection,this.list.dataProvider=this.itemDt},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.sureBtn,this.onTouch),this.observe(KfArenaSys.ins().postRankInfo,this.updata),this.updata(t[0])},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.sureBtn:ViewManager.ins().close(this)}},e.prototype.updata=function(t){var e=KfArenaSys.ins();this.blueScore.text=e.scoreA+"",this.redScore.text=e.scoreB+"",this.itemDt.replaceAll(t)},e}(BaseEuiView);__reflect(KfArenaInfoWin.prototype,"KfArenaInfoWin"),ViewManager.ins().reg(KfArenaInfoWin,LayerManager.UI_Popup);var KfArenaInviteWin=function(t){function e(){var e=t.call(this)||this;return e.friendList=[],e.guildList=[],e.type=0,e.cdTime=30,e.skinName="kfInviteSkin",e.isTopLevel=!0,e.listView.itemRenderer=kfArenaMemberItemRender,e.worldInvite.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.worldInvite.text+"</u>"),e.listArray=new eui.ArrayCollection,e.listView.dataProvider=e.listArray,e.tab.itemRenderer=KfArenaBtn,e.updateTabRedPt(),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tab.selectedIndex=0,this.addTouchEvent(this.closeBtn0,this.onTouch),this.addTouchEvent(this.worldInvite,this.onTouch),this.addTouchEvent(this.tab,this.onTabClick),this.observe(KfArenaSys.ins().postKfArenaDelID,this.update),this.observe(KfArenaSys.ins().postKfArenaGuilds,this.updateGuild),this.type=KFInviteType.Friend,KfArenaSys.ins().sendGuilds(0),KfArenaSys.ins().sendGuilds(1)},e.prototype.updateGuild=function(t){switch(t){case KFInviteType.Friend:this.friendList=KfArenaSys.ins().getDataList(t);break;case KFInviteType.Guild:this.guildList=KfArenaSys.ins().getDataList(t)}this.setType(this.type)},e.prototype.onTabClick=function(t){void 0===t&&(t=null),this.setType(this.tab.selectedIndex)},e.prototype.updateTabRedPt=function(){this.tab.dataProvider=new ArrayCollection(["好  友","帮  派"])},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn0:ViewManager.ins().close(this);break;case this.worldInvite:var e=egret.getTimer(),i=(KfArenaSys.ins().worldTimeCd-e)/1e3>>0;i>0?UserTips.ins().showTips(i+"秒后可再次世界邀请"):(KfArenaSys.ins().worldTimeCd=e+1e3*this.cdTime,KfArenaSys.ins().sendWorldInvite(),UserTips.ins().showTips("邀请发送成功"))}},e.prototype.update=function(t){for(var e=this.friendList.length-1;e>=0;e--)this.friendList[e].id==t&&this.friendList.splice(e,1);for(var e=this.guildList.length-1;e>=0;e--)this.guildList[e].roleID==t&&this.guildList.splice(e,1);this.setType(this.type)},e.prototype.setType=function(t){switch(this.type=t,t){case KFInviteType.Friend:this.listArray.source=this.friendList,this.noPlayer.visible=0==this.friendList.length;break;case KFInviteType.Guild:this.listArray.source=this.guildList,this.noPlayer.visible=0==this.guildList.length}},e}(BaseEuiView);__reflect(KfArenaInviteWin.prototype,"KfArenaInviteWin"),ViewManager.ins().reg(KfArenaInviteWin,LayerManager.UI_Popup);var KfArenaJoinPanel=function(t){function e(){var e=t.call(this)||this;return e.name="参与",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listArray=new eui.ArrayCollection,this.list.itemRenderer=KfArenaJoinItemRender,this.list.dataProvider=this.listArray},e.prototype.open=function(){this.observe(KfArenaSys.ins().postJoinRewards,this.update),this.update()},e.prototype.update=function(){var t=GlobalConfig.CrossArenaBase.peakAwards,e=[],i=1;for(var s in t)t[s].id=i,e.push(t[s]),i++;this.listArray.source=e,this.myRecord.text=KfArenaSys.ins().dflCount},e.prototype.close=function(){},e}(BaseEuiView);__reflect(KfArenaJoinPanel.prototype,"KfArenaJoinPanel");var KfArenaMacthPanel=function(t){function e(){var e=t.call(this)||this;return e.name="匹配",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.memberArr=[this.leader,this.member1,this.member2],this.dailyTime.text=""+GlobalConfig.CrossArenaBase.joinCount,this.maxTime.text=""+GlobalConfig.CrossArenaBase.maxJoinCount},e.prototype.open=function(){this.addTouchEvent(this.disBtn,this.onTouch),this.addTouchEvent(this.macthBtn,this.onTouch),this.observe(KfArenaSys.ins().postPlayerInfo,this.updateInfo),this.observe(KfArenaSys.ins().postTeamInfo,this.update),this.observe(KfArenaSys.ins().postMacthState,this.update),this.update()
},e.prototype.update=function(){this.updateMember(),this.updateInfo(),this.updateBtnState()},e.prototype.updateMember=function(){this.roleGroup.visible=KfArenaSys.ins().getIsJoinTeam();for(var t=0,e=this.memberArr;t<e.length;t++){var i=e[t];i.data=null}var s=KfArenaSys.ins().tfMembers,n=1;if(s&&s.length)for(var o=0;o<s.length;o++){var a=s[o],r=a.isLeader();r?this.leader.data=a:(this.memberArr[n].data=a,n++)}},e.prototype.updateInfo=function(){var t=KfArenaSys.ins();this.duanLabel.text="当前段位："+t.getDuanName(),this.scoreLabel.text="当前积分："+t.duanLevel,this.curMonthLabel.text="当前战绩："+t.curMouth.win+"胜"+t.curMouth.ping+"平"+t.curMouth.fail+"败",this.historyLabel.text="历史战绩："+t.history.win+"胜"+t.history.ping+"平"+t.history.fail+"败",this.countLabel.text=""+t.times,this.macthingLabel.visible=1==t.macthState},e.prototype.updateBtnState=function(){KfArenaSys.ins().getIsJoinTeam()?(KfArenaSys.ins().isTFCaptain?this.disBtn.label="解散战队":this.disBtn.label="离开战队",1==KfArenaSys.ins().macthState?this.macthBtn.label="取消匹配":this.macthBtn.label="开始匹配"):(this.disBtn.label="创建战队",this.macthBtn.label="单人匹配")},e.prototype.onTouch=function(t){if(0==KfArenaSys.ins().isStartIng)return void UserTips.ins().showCenterTips("每日12:00-12:30、22:00-22:30");switch(t.target){case this.disBtn:if(!KfArenaSys.ins().getIsJoinTeam())return void KfArenaSys.ins().sendCreateTeam();KfArenaSys.ins().sendLeaveTeam();break;case this.macthBtn:if(1==KfArenaSys.ins().macthState)return KfArenaSys.ins().isTFCaptain?void KfArenaSys.ins().sendCancelMacth():void UserTips.ins().showCenterTips("只有队长才可以取消匹配");if(!KfArenaSys.ins().getIsJoinTeam())return void KfArenaSys.ins().sendPersonalMatch();if(!KfArenaSys.ins().isTFCaptain)return void UserTips.ins().showCenterTips("只有队长才可以开始匹配");KfArenaSys.ins().sendStartMacth()}},e}(BaseEuiView);__reflect(KfArenaMacthPanel.prototype,"KfArenaMacthPanel");var KfArenaRankPanel=function(t){function e(){var e=t.call(this)||this;return e.name="排行",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=KfArenaRankItemRender,this.rankDatas=new eui.ArrayCollection,this.list.dataProvider=this.rankDatas,this.rank0.index=0,this.rank1.index=1,this.rank2.index=2,this.firstGroup.visible=!1,this.state.visible=!0,this.serverId0.text="",this.vip0.visible=!1,this.firstNameTxt0.text="",this.score0.text="",this.seasonTitle0.text=""},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KfArenaSys.ins().postRank,this.upData),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayer),KfArenaSys.ins().sendRank()},e.prototype.upData=function(){var t=KfArenaSys.ins().rankDataList.shift();this.rankDatas.replaceAll(KfArenaSys.ins().rankDataList),this.selfPos0.text=KfArenaSys.ins().ownRank,t&&(this.firstGroup.visible=!0,this.state.visible=!1,this.reward0.data=GlobalConfig.CrossArenaBase.rankAward[t.rank].mail.tAwardList[0],this.serverId0.text="S"+t.servId,this.vip0.visible=t.vip>0,this.firstNameTxt0.text=t.playerName,this.score0.text=t.score+"",this.seasonTitle0.text=KfArenaSys.ins().duanName[t.dan],UserReadPlayer.ins().sendFindPlayer(t.playerId,t.servId))},e.prototype.openOtherPlayer=function(t){this.rank0.data={otherPlayerData:t},this.rank1.data={otherPlayerData:t},this.rank2.data={otherPlayerData:t}},e}(BaseEuiView);__reflect(KfArenaRankPanel.prototype,"KfArenaRankPanel");var KfArenaReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e.skinName="WorldBossGoldSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.reliveBtn.visible=!1,this.alive.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setWin(t[0],t[1])},e.prototype.setWin=function(t,e){if(e>0){var i=EntityManager.ins().getEntityByHandle(e),s="";if(i){var n=EntityManager.ins().getEntityByHandle(i.infoModel.masterHandle);s=i instanceof CharRole?i.infoModel.name:i.infoModel.masterHandle&&n?""+n.infoModel.name:"Boss"+i.infoModel.name}this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+s+"|击败")}this.reliveTimesTxt.text=t+"秒",TimerManager.ins().remove(this.refushLabel,this),this.remainM=t,TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒"},e.prototype.overTime=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(KfArenaReliveWin.prototype,"KfArenaReliveWin"),ViewManager.ins().reg(KfArenaReliveWin,LayerManager.UI_Popup);var KfArenaResultWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.extrReward.itemRenderer=ItemBase,this.list.itemRenderer=KfArenaDataItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.sureBtn,this.onTouch),this.blueScore.text=t[0],this.redScore.text=t[1],this.list.dataProvider=new eui.ArrayCollection(t[2]),this.extrReward.dataProvider=new eui.ArrayCollection(t[3]),TimerManager.ins().doTimer(1e3,this.quitTime,this.onTime,this)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.sureBtn:this.onExit()}},e.prototype.onTime=function(){this.quitTime>0?(this.quitTime--,this.leaveInfo.text=this.quitTime+"s后自动离开战场"):this.onExit()},e.prototype.onExit=function(){ViewManager.ins().close(this),UserFb.ins().sendExitFb()},e}(BaseEuiView);__reflect(KfArenaResultWin.prototype,"KfArenaResultWin"),ViewManager.ins().reg(KfArenaResultWin,LayerManager.UI_Popup);var KfArenaWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.viewStack.selectedIndex=0,this.tab.dataProvider=this.viewStack},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tab.selectedIndex=this.viewStack.selectedIndex=t[0],this.addTouchEvent(this.closeBtn,this.onTouch),this.addChangeEvent(this.tab,this.onTabTouch),this.addTouchEvent(this.seeRule,this.onTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.observe(KfArenaRedPoint.ins().postRedPoint,this.redPointEx),this.setOpenIndex(this.tab.selectedIndex),this.redPointEx()},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text)}},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex),this.redPointEx()},e.prototype.setOpenIndex=function(t){switch(t){case e.Page_Select_Rank:this.rankPanel.open();break;case e.Page_Select_Macth:this.macthPanel.open();break;case e.Page_Select_Join:this.joinPanel.open();break;case e.Page_Select_Duan:this.duanPanel.open()}},e.prototype.redPointEx=function(){this.redPoint0.visible=!1,this.redPoint1.visible=KfArenaRedPoint.ins().redpoint_1>0,this.redPoint2.visible=KfArenaRedPoint.ins().redpoint_2>0,this.redPoint3.visible=KfArenaRedPoint.ins().redpoint_3>0},e}(BaseEuiView);KfArenaWin.Page_Select_Rank=0,KfArenaWin.Page_Select_Macth=1,KfArenaWin.Page_Select_Join=2,KfArenaWin.Page_Select_Duan=3,__reflect(KfArenaWin.prototype,"KfArenaWin"),ViewManager.ins().reg(KfArenaWin,LayerManager.UI_Main);var kfReceiveInviteWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="kfReceiveInviteSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.inviteData=KfArenaSys.ins().inviteDataList[this.index],this.addTouchEvent(this.notBtn,this.onTouch),this.addTouchEvent(this.sureBtn,this.onTouch),this.update()},e.prototype.update=function(){this.nameLabel.text=this.inviteData.name,this.powerLabel.text="战力："+this.inviteData.power,this.scoreLabel.text="积分："+this.inviteData.score,this.winRateLabel.text="胜率"+this.inviteData.winRate+"%"},e.prototype.onTouch=function(t){switch(t.target){case this.notBtn:KfArenaSys.ins().sendRespondInvite(this.inviteData.roleId,0),KfArenaSys.ins().inviteDataList.slice(this.index,1),ViewManager.ins().close(this);break;case this.sureBtn:KfArenaSys.ins().sendRespondInvite(this.inviteData.roleId,1),KfArenaSys.ins().inviteDataList.slice(this.index,1),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(kfReceiveInviteWin.prototype,"kfReceiveInviteWin"),ViewManager.ins().reg(kfReceiveInviteWin,LayerManager.UI_Popup);var KFBattleRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint1=0,e.redPoint2=0,e.redPoint=0,e.associated(e.postRedPoint1,WJBattlefieldSys.ins().postInfo),e.associated(e.postRedPoint2,KFBossRedpoint.ins().postRedPoint),e.associated(e.postRedPoint,e.postRedPoint1,e.postRedPoint2),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint1=function(){return WJBattlefieldSys.ins().overCounts>0?(this.redPoint1=1,!0):!1},e.prototype.postRedPoint2=function(){return this.redPoint2=KFBossRedpoint.ins().redpoint,this.redPoint2},e.prototype.postRedPoint=function(){return this.redPoint=this.redPoint1+this.redPoint2,this.redPoint},e}(BaseSystem);__reflect(KFBattleRedPoint.prototype,"KFBattleRedPoint");var GameSystem;!function(t){t.kfBattleRedpoint=KFBattleRedPoint.ins.bind(KFBattleRedPoint)}(GameSystem||(GameSystem={}));var KFBossData=function(){function t(){}return t}();__reflect(KFBossData.prototype,"KFBossData");var KFBossInfoData=function(){function t(t){this.dpId=t.readShort(),this.serverId=t.readShort(),this.bossRefTimer=1e3*t.readInt()+egret.getTimer(),this.flagRefTimer=1e3*t.readInt()+egret.getTimer(),8==this.dpId&&(this.flagRefTimer=Number.MAX_VALUE+egret.getTimer())}return t}();__reflect(KFBossInfoData.prototype,"KFBossInfoData");var KFBossRedpoint=function(t){function e(){var e=t.call(this)||this;return e.redpoints=[],e.associated(e.postRedPoint,KFBossSys.ins().postBossInfo,KFBossSys.ins().postBossRevive,KFBossSys.ins().postInfo),e}return __extends(e,t),e.prototype.postRedPoint=function(){if(this.redpoints=[],this.redpoint=0,!KFBossSys.ins().isOpen())return 0;for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];if(i){var s=(i.dpId,GlobalConfig.CrossBossConfig[i.dpId]),n=UserZs.ins().lv>=s.levelLimit[0]/1e3&&UserZs.ins().lv<=s.levelLimit[1]/1e3;n&&(n=i.flagRefTimer-egret.getTimer()<0&&KFBossSys.ins().flagTimes>0||i.bossRefTimer-egret.getTimer()<0&&KFBossSys.ins().bossTimes>0),this.redpoints[i.dpId]=n?1:0}}return this.redpoint=this.redpoints.indexOf(1)>-1?1:0,this.redpoint},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(KFBossRedpoint.prototype,"KFBossRedpoint");var GameSystem;!function(t){t.kfBossRedpoint=KFBossRedpoint.ins.bind(KFBossRedpoint)}(GameSystem||(GameSystem={}));var KFBossSys=function(t){function e(){var e=t.call(this)||this;return e.fbInfo=[],e.isKFBossBattle=!1,e.dropRecordDataList=[],e.dropBestRecordDataList=[],e.sysId=PackageID.KFBoss,e.regNetMsg(1,e.postBossInfo),e.regNetMsg(2,e.postAscriptionChange),e.regNetMsg(3,e.postRevive),e.regNetMsg(5,e.postBossRevive),e.regNetMsg(7,e.postRefFlag),e.regNetMsg(8,e.postCollectFlag),e.regNetMsg(9,e.postInfo),e.regNetMsg(10,e.doResult),e.regNetMsg(11,e.postDropList),e.regNetMsg(12,e.postBroadcastResult),e.observe(UserBoss.ins().postBossAppear,function(){e.isKFBossBattle&&ViewManager.ins().open(BossBelongPanel)}),e.observe(UserBoss.ins().postBossDisappear,function(){e.isKFBossBattle&&ViewManager.ins().close(BossBelongPanel)}),e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType==UserFb.FB_TYPE_KF_BOSS?e.postEnterKFBossFb():GameMap.lastFbTyp==UserFb.FB_TYPE_KF_BOSS&&e.postQuiKFBossFb()}),e}return __extends(e,t),e.prototype.postBossInfo=function(t){var e=t.readShort();this.fbInfo=[];for(var i=0;e>i;i++){var s=new KFBossInfoData(t);this.fbInfo[s.dpId]=s}},e.prototype.postAscriptionChange=function(t){var e=t.readDouble(),i=t.readDouble(),s="";if(e>0){var n=EntityManager.ins().getMasterList(e);n&&n[0]&&n[0].infoModel&&(s=n[0].infoModel.name)}UserBoss.ins().postBelongChange(i,e,s)},e.prototype.postRevive=function(t){var e=t.readInt(),i=t.readDouble();if(e>0)ViewManager.ins().open(KFBossReliveWin,e,i);else if(ViewManager.ins().close(KFBossReliveWin),KFServerSys.ins().isKF){var s=Actor.yb-GlobalConfig.CrossBossBase.rebornCost;Actor.ins().postYbChange(s)}},e.prototype.postBossRevive=function(t){var e=t.readShort(),i=t.readShort();this.fbInfo[i]&&(1==e?this.fbInfo[i].flagRefTimer=egret.getTimer():2==e&&(this.fbInfo[i].bossRefTimer=egret.getTimer()))},e.prototype.postRefFlag=function(t){this.flagHandle=t.readDouble(),this.flagCD=1e3*t.readInt()+egret.getTimer(),GameMap.fubenID!=GlobalConfig.CrossBossConfig[8].fbid?this.flagHandle=100010100101:this.flagHandle=0},e.prototype.postCollectFlag=function(t){var e=t.readDouble(),i=t.readInt();e&&e==Actor.handle&&i?(ViewManager.ins().open(CollectWin,e,i),GameLogic.ins().currAttackHandle=0):ViewManager.ins().close(CollectWin)},e.prototype.postInfo=function(t){this.flagTimes=t.readShort(),this.bossTimes=t.readShort();var e=t.readShort();this.enterCD=1e3*e+egret.getTimer()},e.prototype.doResult=function(t){for(var e=t.readShort(),i=[],s=t.readShort(),n=1==e,o=0;s>o;o++){var a=new RewardData;a.type=t.readInt(),a.count=t.readInt(),a.id=t.readInt(),i.push(a),0==a.type&&1!=a.id&&2!=a.id&&a.id!=MoneyConst.rune||n||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(EntityManager.ins().getNoDieRole().x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(EntityManager.ins().getNoDieRole().y/GameMap.CELL_SIZE),a])}if(n)ResultManager.ins().create(GameMap.fbType,i,n);else{var r=function(){ResultManager.ins().create(GameMap.fbType,i,n)};DropHelp.start(),DropHelp.addCompleteFunc(r,this)}},e.prototype.postDropList=function(t){this.dropRecordDataList=[],this.dropBestRecordDataList=[];for(var e=t.readShort(),i=0;e>i;i++)this.dropRecordDataList.push(new KFDropRecordData(t));e=t.readShort();for(var i=0;e>i;i++){var s=new KFDropRecordData(t);s.isBest=!0,this.dropBestRecordDataList.push(s)}},e.prototype.postBroadcastResult=function(t){var e=t.readInt(),i=t.readString(),s=t.readDouble(),n=EntityManager.ins().getEntityByHandle(s);if(!n||n.action==EntityAction.DIE||n==EntityManager.ins().getNoDieRole())return"S"+e+i;for(var o=[],a=t.readShort(),r=0;a>r;r++){var h=new RewardData;h.type=t.readInt(),h.id=t.readInt(),h.count=t.readInt(),o.push(h),0==h.type&&1!=h.id&&2!=h.id&&h.id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(n.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(n.y/GameMap.CELL_SIZE),h])}var l=function(){};return DropHelp.start(n),DropHelp.addCompleteFunc(l,this),"S"+e+i},e.prototype.postEnterKFBossFb=function(){this.isKFBossBattle=!0,ViewManager.ins().isShow(BossBloodPanel)&&ViewManager.ins().open(BossBloodPanel),ViewManager.ins().close(KFBossShowWin),ViewManager.ins().open(KFBossSceneWin)},e.prototype.postQuiKFBossFb=function(){ViewManager.ins().close(BossBelongPanel),this.isKFBossBattle=!1,this.flagHandle=0,ViewManager.ins().close(KFBossReliveWin),ViewManager.ins().close(KFBossSceneWin)},e.prototype.sendBossInfo=function(){this.sendBaseProto(1)},e.prototype.sendClearReliveCD=function(){this.sendBaseProto(3)},e.prototype.sendCleanBelong=function(){this.sendBaseProto(4)},e.prototype.sendEnter=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.sendCollectFlag=function(){this.sendBaseProto(8)},e.prototype.sendDropList=function(){this.sendBaseProto(11)},e.ins=function(){return t.ins.call(this)},e.prototype.isOpen=function(){return GlobalConfig.CrossBossBase.limitZsLv||(GlobalConfig.CrossBossBase.limitZsLv=5),GlobalConfig.CrossBossBase.openDay<=GameServer.serverOpenDay+1&&UserZs.ins().lv>=GlobalConfig.CrossBossBase.limitZsLv},e}(BaseSystem);__reflect(KFBossSys.prototype,"KFBossSys");var GameSystem;!function(t){t.kfBossSys=KFBossSys.ins.bind(KFBossSys)}(GameSystem||(GameSystem={}));var KFBossReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin",this.aliveNum=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.reliveBtn,this.onRelive),this.addTouchEvent(this.exitBtn,this.onTap),this.setWin(t[0],t[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().close(WorldBossCdWin)},e.prototype.setWin=function(t,e){if(e>0){var i=EntityManager.ins().getEntityByHandle(e),s="";if(i){var n=EntityManager.ins().getEntityByHandle(i.infoModel.masterHandle);s=i instanceof CharRole?i.infoModel.name:i.infoModel.masterHandle&&n?""+n.infoModel.name:"Boss"+i.infoModel.name}this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+s+"|击败"),this.alive.visible=!1,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1")}this.reliveBtn.label=GlobalConfig.CrossBossBase.rebornCost+"原地复活",this.reliveTimesTxt.text=t+"秒",TimerManager.ins().remove(this.refushLabel,this),this.remainM=t,TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒"},e.prototype.overTime=function(){ViewManager.ins().close(this),ViewManager.ins().close(WorldBossCdWin)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.exitBtn:UserFb.ins().sendExitFb()}},e.prototype.onRelive=function(t){return this.aliveNum?void KFBossSys.ins().sendClearReliveCD():void(GlobalFun.checkMoney(GlobalConfig.CrossBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活")&&KFBossSys.ins().sendClearReliveCD())},e}(BaseEuiView);__reflect(KFBossReliveWin.prototype,"KFBossReliveWin"),ViewManager.ins().reg(KFBossReliveWin,LayerManager.UI_Popup);var KFBossResultWin=function(t){function e(){var e=t.call(this)||this;return e._quitTime=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CityResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.closeBtn,this.onTap),this.bg.source="win_png",this.closeBtn.label="确定",this.title.source="win_02",this.roleTitleLabel.text=e[1]?"旗子归属者：":"BOSS归属者",this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"yanhuaeff",1);var s=Actor.myName;s=StringUtils.replaceStr(s,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(s),this.labelItem.text="我的归属奖：";var n=SubRoles.ins().getSubRoleByIndex(0);n&&(this.roleIcon.icon="yuanhead"+n.job+n.sex),this.roleIcon.jobImg.visible=!1;var o=e[0];o&&this.setRewardList(o),this._quitTime=6,TimerManager.ins().doTimer(1e3,this._quitTime+1,this.onTimer,this),this.onTimer()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],s=[],n=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemConfig.getType(r))0==t[a].type?t[a].id==MoneyConst.soul?n.push(t[a]):e.push(t[a]):s.push(t[a]);else if(i.length){for(var h=!1,l=0;l<i.length;l++)if(i[l].id==t[a].id){i[l].count+=t[a].count,h=!0;break}h||i.push(t[a])}else i.push(t[a])}s.sort(this.RuleSortByItem),o=n.concat(e,i,s),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap)},e.prototype.onTimer=function(){this.closeBtn.label="确定("+--this._quitTime+")",this._quitTime<=0&&ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemConfig.getQuality(i),o=ItemConfig.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);__reflect(KFBossResultWin.prototype,"KFBossResultWin"),ViewManager.ins().reg(KFBossResultWin,LayerManager.UI_Popup);var KFBossSceneWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="kfBossSceneSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KFBossSys.ins().postBroadcastResult,this.bossEnd),this.endGroup.visible=!1;var i=GameMap.fubenID;for(var s in GlobalConfig.CrossBossConfig)if(i==GlobalConfig.CrossBossConfig[s].fbid){var n=GlobalConfig.CrossBossConfig[s],o=KFBossSys.ins().fbInfo[n.id];this.nameTxt.text="跨服战场"==n.sceneName?"S."+o.serverId+"跨服战场":"苍月岛";break}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this),Tween.removeTweens(this.endGroup)},e.prototype.bossEnd=function(t){var e=this;GameMap.fbType==UserFb.FB_TYPE_KF_BOSS&&(this.endGroup.visible=!0,this.endGroup.alpha=1,this.winnerName.text="最终归属者是："+t,TimerManager.ins().doTimer(1e4,1,function(){Tween.get(e.endGroup).to({alpha:0},300).call(function(){e.endGroup.visible=!1})},this))},e}(BaseEuiView);__reflect(KFBossSceneWin.prototype,"KFBossSceneWin"),ViewManager.ins().reg(KFBossSceneWin,LayerManager.UI_Main);var KFBossShowWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFBossShowSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.boss.touchEnabled=!1,this.boss.touchChildren=!1,this.dropRewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.challengeBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.fbId=t[0],this.dp=GlobalConfig.CrossBossConfig[this.fbId],this.showAward(),this.showBoss(),this.bossName.source="kf_name_"+this.dp.bossId},e.prototype.showAward=function(){var t=this.dp.belongRewardshow;this.dropRewardList.dataProvider=new eui.ArrayCollection(t.concat())},e.prototype.showBoss=function(){this.bossMc||(this.bossMc=ObjectPool.pop("MovieClip"),this.bossMc.scaleX=-1,this.bossMc.scaleY=1,this.bossMc.x=78,this.bossMc.y=50,this.boss.addChild(this.bossMc));var t=this.dp.bossId,e=GlobalConfig.MonstersConfig[t];this.bossMc.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.challengeBtn:var e=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;if(e>0)return void UserTips.ins().showTips("|C:0xf3311e&T:"+e+"秒后可以进入！");if(UserZs.ins().lv<this.dp.levelLimit[0]/1e3||UserZs.ins().lv>this.dp.levelLimit[1]/1e3)return void UserTips.ins().showTips("|C:0xf3311e&T:需要转生等级到达"+(this.dp.levelLimit[0]/1e3>>0)+"转！");KFBossSys.ins().sendEnter(this.fbId)}},e}(BaseEuiView);__reflect(KFBossShowWin.prototype,"KFBossShowWin"),ViewManager.ins().reg(KFBossShowWin,LayerManager.UI_Popup);var KFBossUIWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFbossUISkin",e.attackList.itemRenderer=TargetMemberHeadRender,e.attackedList.itemRenderer=TargetMemberHeadRender,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(KFBossUIWin.prototype,"KFBossUIWin"),ViewManager.ins().reg(KFBossUIWin,LayerManager.UI_Main);var KFBossWin=function(t){function e(){var e=t.call(this)||this;e.MAX=8,e.isTopLevel=!0,e.skinName="KFBossSkin",e.MAX=CommonUtils.getObjectLength(GlobalConfig.CrossBossConfig);for(var i=1;i<=e.MAX;i++){e["island"+i].island.source="kf_boss_area"+i,e["island"+i].touchChildren=!1,e["island"+i].filters=FilterUtil.ARRAY_GRAY_FILTER;var s=GlobalConfig.CrossBossConfig[i],n=[s.levelLimit[0]/1e3>>0,s.levelLimit[1]/1e3>>0];e["island"+i].info.text=n[0]+"转-"+n[1]+"转",e["island"+i].info.textColor=n[0]<=UserZs.ins().lv&&UserZs.ins().lv<=n[1]?ColorUtil.GREEN:ColorUtil.RED,e["island"+i].serverInfo.visible=!1}return e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(KFBossSys.ins().postBossInfo,this.refData),this.observe(KFBossSys.ins().postBossRevive,this.refData),this.observe(KFBossRedpoint.ins().postRedPoint,this.refRedpoint),this.upCurState(),KFBossSys.ins().sendBossInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this)},e.prototype.upCurState=function(){KFBossSys.ins().fbInfo[6]?this.currentState="6":KFBossSys.ins().fbInfo[7]?this.currentState="7":this.currentState="5",this.refData(),this.refRedpoint()},e.prototype.refData=function(){this.flagTimes.text=KFBossSys.ins().flagTimes+"",this.bossTimes.text=KFBossSys.ins().bossTimes+"";for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];if(i){var s=i.dpId;if(this["island"+s]){GlobalConfig.CrossBossConfig[i.dpId];if(this["island"+s].serverInfo.visible=!0,this["island"+s].headGroup.visible=!1,this["island"+s].head.source="",this["island"+s].name=i.dpId,this["island"+s].filters=[],i.serverId)if(this["island"+s].serverInfo.visible=!0,this["island"+s].serverName.text=""+(i.serverId==LocationProperty.srvid?"本服":"S."+i.serverId+"服"),i.serverId==LocationProperty.srvid){this["island"+s].headGroup.visible=!0;var n=SubRoles.ins().getSubRoleByIndex(0);this["island"+s].head.source="yuanhead"+n.job+n.sex}else this["island"+s].serverName.x=13;else this["island"+s].serverInfo.visible=!1}}}TimerManager.ins().remove(this.onTimer,this),TimerManager.ins().doTimer(1e3,0,this.onTimer,this),this.onTimer()},e.prototype.onTimer=function(){for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];if(i&&0!=i.bossRefTimer){var s=GlobalConfig.CrossBossConfig[i.dpId],n=(i.bossRefTimer-egret.getTimer())/1e3>>0,o="";n>0&&(o="\n"+DateUtils.getFormatBySecond(n)),this["island"+i.dpId].info.text=(s.levelLimit[0]/1e3>>0)+"转-"+(s.levelLimit[1]/1e3>>0)+"转"+o}}},e.prototype.refRedpoint=function(){for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];i&&this["island"+i.dpId]&&(this["island"+i.dpId].redPoint.visible=KFBossRedpoint.ins().redpoints[i.dpId])}},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text);break;case this.closeBtn:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Component){var e=parseInt(t.target.name);if(!e)return void UserTips.ins().showTips("|C:0xf3311e&T:暂未开启!");ViewManager.ins().open(KFBossShowWin,e)}}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=KFBossSys.ins().isOpen();return i||UserTips.ins().showTips("|C:0xf3311e&T:条件不够，不可进入"),i},e}(BaseEuiView);__decorate([callLater],KFBossWin.prototype,"refData",null),__decorate([callLater],KFBossWin.prototype,"refRedpoint",null),__reflect(KFBossWin.prototype,"KFBossWin"),ViewManager.ins().reg(KFBossWin,LayerManager.UI_Main);var KFServerSys=function(t){function e(){var e=t.call(this)||this;return e.isLinkingKF=!1,e.curServerType=ServerType.bsCommSrv,e.sysId=PackageID.Login,e.regNetMsg(9,e.doSwitchServer),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.linkingKFState=function(t){this.isLinkingKF=t,t?ViewManager.ins().open(ServerSwitchIngWin):ViewManager.ins().close(ServerSwitchIngWin)},e.prototype.doSwitchServer=function(t){var e=this;this.kfSrvid=t.readInt(),this.kfIp=t.readString(),this.kfPort=t.readInt(),this.kfLoginKey=t.readString(),this.curServerType=t.readInt(),this.linkingKFState(!0),TimerManager.ins().doTimer(500,1,function(){e.connectKFServer()},this)},e.prototype.sendKFLogin=function(){var t=this.getBytes(9);t.writeInt(Actor.actorID),t.writeString(this.kfLoginKey),t.writeString(LocationProperty.pf),this.sendToServer(t)},Object.defineProperty(e.prototype,"isKF",{get:function(){return this.curServerType>ServerType.bsCommSrv},enumerable:!0,configurable:!0}),e.prototype.connectKFServer=function(){GameSocket.ins().close(),GameSocket.ins().newSocket(),GameSocket.ins().getSocket().connected?this.sendKFLogin():(debug.log("kf connect to "+this.kfIp+" ,port: "+this.kfPort),GameSocket.ins().connect(this.kfIp,this.kfPort)),WJBattlefieldSys.postSwitchServer()},e.prototype.closeSocket=function(){this.curServerType=ServerType.bsCommSrv,this.kfSrvid=LocationProperty.srvid},e.prototype.checkIsKFBattle=function(t){return this.isKF&&t&&UserTips.ins().showTips(t),this.isKF},e}(BaseSystem);__reflect(KFServerSys.prototype,"KFServerSys");var ServerType;!function(t){t[t.bsCommSrv=0]="bsCommSrv",t[t.bsBattleSrv=1]="bsBattleSrv",t[t.bsMainBattleSrv=2]="bsMainBattleSrv",t[t.bsLianFuSrv=3]="bsLianFuSrv"}(ServerType||(ServerType={}));var KFBattleWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="KFFieldWinSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=t[0]?t[0]:0,this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.seeRule,this.onTouch),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.setOpenIndex(this.oldIndex),this.observe(KFBattleRedPoint.ins().postRedPoint,this.refRedpoint),this.observe(KfArenaRedPoint.ins().postRedPoint,this.refRedpoint),this.refRedpoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.viewStack.getElementAt(this.oldIndex)&&this.viewStack.getElementAt(this.oldIndex).close()},e.prototype.onTabTouch=function(t){var e=this.tab.selectedIndex;this.setOpenIndex(e)},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.kffieldPanel.open();break;case 1:this.kffieldRecordPanel.open();break;case 2:this.rankPanel.open()}this.oldIndex!=t?this.tab.selectedIndex!=this.viewStack.selectedIndex&&(this.viewStack.getElementAt(this.oldIndex).close(),this.oldIndex=t):this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(e);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text)}},e.prototype.refRedpoint=function(){this.redPoint0.visible=KFBattleRedPoint.ins().redPoint>0||KfArenaRedPoint.ins().redpoint>0,this.redPoint1.visible=!1},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e}(BaseEuiView);__reflect(KFBattleWin.prototype,"KFBattleWin"),ViewManager.ins().reg(KFBattleWin,LayerManager.UI_Main);var KFBattlListPanel=function(t){function e(){var e=t.call(this)||this;return e.count=1,e.name="跨服",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){this.addTouchEvent(this,this.onTap),this.refRedpoint()},e.prototype.onTap=function(t){switch(t.target){case this.btn0:ViewManager.ins().open(WJBattlefieldWin);break;case this.helpLink0:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[25].text)}},e.prototype.refRedpoint=function(){for(var t=0;t<this.count;t++)this["redPoint"+t].visible=KFBattleRedPoint.ins()["postRedPoint"+(t+1)]()
},e}(BaseComponent);__reflect(KFBattlListPanel.prototype,"KFBattlListPanel");var KffieldPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this,this.onTouch),this.observe(KFBattleRedPoint.ins().postRedPoint,this.refRedPoint),this.observe(DevildomRedPoint.ins().postRedPoint,this.refRedPoint),this.observe(KfArenaRedPoint.ins().postRedPoint,this.refRedPoint),this.initData(),this.refRedPoint()},e.prototype.close=function(){this.$onClose(),DisplayUtils.removeFromParent(this.kfBossMc)},e.prototype.onTouch=function(t){switch(t.target){case this.island0:ViewManager.ins().open(KFBossWin);break;case this.island1:ViewManager.ins().open(KfArenaWin);break;case this.island2:break;case this.island3:ViewManager.ins().open(DevildomWin,DevildomBossModel.ins().getCurFbIndex())}},e.prototype.initData=function(){var t=this;this.island0.currentState="unlock",this.island0.title.source="kf_function_boss",this.island0.island.source="",this.island3.currentState="unlock",egret.callLater(function(){t.island3.title.source="kf_function_invasion",t.island3.island.source="kf_field_invasion"},this),this.kfBossMc||(this.kfBossMc=new MovieClip,this.kfBossMc.scaleX=this.kfBossMc.scaleY=.45,this.kfBossMc.x=0,this.kfBossMc.y=35),this.island0.boossGroup.addChild(this.kfBossMc);var e=GlobalConfig.CrossBossBase.showBoss?GlobalConfig.CrossBossBase.showBoss:"monster10041_3s";this.kfBossMc.playFile(RES_DIR_MONSTER+e,-1),egret.callLater(function(){t.island1.title.source="kf_function_invasion",t.island1.island.source="kf_field_invasion"},this),this.island1.currentState="unlock",this.island2.currentState="lock"},e.prototype.refRedPoint=function(){this.island0.redPoint.visible=KFBattleRedPoint.ins().redPoint2,this.island1.redPoint.visible=KfArenaRedPoint.ins().redpoint,this.island3.redPoint.visible=DevildomRedPoint.ins().redPoint},e}(BaseView);__reflect(KffieldPanel.prototype,"KffieldPanel");var KffieldRecordItemReder=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof KFDropRecordData){if(this.dropTime.text=DateUtils.getFormatBySecond(this.data.time,DateUtils.TIME_FORMAT_15),this.data.type==KFDropType.KF_BOSS){var t="|C:39423&T:"+this.data.nick+"|",e=GlobalConfig.ItemConfig[this.data.goodsId],i=ItemConfig.getQualityColor(e),s="|C:"+i+"&T:["+e.name+"]|",n=t+"在"+this.data.sceneName+"击杀|C:0xff0000&T:"+this.data.bossName+"|，获得极品"+s,o=TextFlowMaker.generateTextFlow1(n);o[0].style.href="event:"+this.data.roleId+"_"+this.data.servId,o[0].style.underline=!0,o[4].style.href="event:"+this.data.goodsId,o[4].style.underline=!0,this.record.textFlow=o}else if(this.data.type==KFDropType.DEVILDOM){var t="|C:65280&T:S."+this.data.servId+" "+this.data.guildName+"行会|",a=GlobalConfig.AuctionItem[this.data.goodsId].item.id,e=GlobalConfig.ItemConfig[a],i=ItemConfig.getQualityColor(e),s="|C:"+i+"&T:["+e.name+"]|",n=t+"在|C:0xFF00FF&T:魔界入侵|击杀|C:0xff0000&T:"+this.data.bossName+"|，获得行会拍卖品"+s,o=TextFlowMaker.generateTextFlow1(n);o[6].style.href="event:"+a,o[6].style.underline=!0,this.record.textFlow=o}this.best.visible=this.data.isBest,this.record.width=this.best.visible?380:418,this.record.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)}},e.prototype.onLink=function(t){var e=t.text.split("_");if(e.length>1)UserReadPlayer.ins().sendFindPlayer(parseInt(e[0]),parseInt(e[1]));else{var i=GlobalConfig.ItemConfig[t.text],s=ItemConfig.getType(i);void 0!=i&&i&&void 0!=s&&(ItemConfig.isEquip(i)?ViewManager.ins().open(EquipDetailedWin,1,void 0,i.id):s==ItemType.TYPE_21?ZhanLing.ins().ZhanLingItemTips(i.id):s==ItemType.TYPE_22?ViewManager.ins().open(ZhanlingZBTipWin,i.id):ViewManager.ins().open(ItemDetailedWin,0,i.id))}},e.prototype.removeFromStage=function(){this.record.removeEventListener(egret.TextEvent.LINK,this.onLink,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)},e}(BaseItemRender);__reflect(KffieldRecordItemReder.prototype,"KffieldRecordItemReder");var KffieldRecordPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listDt=new eui.ArrayCollection,this.list.itemRenderer=KffieldRecordItemReder,this.list.dataProvider=this.listDt},e.prototype.open=function(){this.observe(KFBossSys.ins().postDropList,this.upList),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.upList(),KFBossSys.ins().sendDropList()},e.prototype.openOtherPlayerView=function(t){var e=ViewManager.ins().open(RRoleWin,t);e.hideEx(2)},e.prototype.upList=function(){var t=KFBossSys.ins().dropBestRecordDataList;t=t.concat(KFBossSys.ins().dropRecordDataList),this.listDt.replaceAll(t)},e}(BaseView);__reflect(KffieldRecordPanel.prototype,"KffieldRecordPanel");var PeakedData=function(){function t(){}return t}();PeakedData.STATE_TYPE_CN=["","","","16进8强","8进4强","半决赛","决赛",""],PeakedData.STATE_TYPE_AWARD_CN=["","","参与奖","16强","8强","4强","亚军","冠军"],PeakedData.STATE_ICON_CN=["","报名","淘汰赛","8强赛","4强赛","半决赛","决赛","跨服赛"],PeakedData.STATE_KF_TYPE_CN=["","","64进32强","32进16强","16进8强","8进4强","半决赛","决赛",""],PeakedData.STATE_KF_TYPE_AWARD_CN=["","参与奖","64强","32强","16强","8强","4强","亚军","冠军"],PeakedData.STATE_KF_ICON_CN=["跨服赛","淘汰赛","32强赛","16强赛","8强赛","4强赛","半决赛","决赛"],PeakedData.SERV_CN=["本服赛","跨服赛"],__reflect(PeakedData.prototype,"PeakedData");var PeakPlayerData=function(){function t(t){t&&this.readBaseData(t)}return t.prototype.readBaseData=function(t,e){void 0===e&&(e=!1);var i=t.readByte();this.playerList=[];for(var s=0;i>s;s++){var n=new PeakPlayerInfo;e?n.readKFData(t):n.readData(t),this.playerList.push(n)}this.winId=t.readInt(),i=t.readByte(),this.reportList=[];for(var s=0;i>s;s++)this.reportList.push(t.readInt())},t.prototype.readToData=function(t){this.winId=t.readInt();var e=t.readByte();this.reportList=[];for(var i=0;e>i;i++)this.reportList.push(t.readInt())},t}();__reflect(PeakPlayerData.prototype,"PeakPlayerData");var PeakPlayerInfo=function(){function t(t){this.serverId=0,t&&this.readData(t)}return t.prototype.readData=function(t){this.roleId=t.readInt(),this.playerName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.pos=t.readByte()},t.prototype.readKFData=function(t){this.roleId=t.readInt(),this.serverId=t.readInt(),this.playerName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.pos=t.readByte()},t}();__reflect(PeakPlayerInfo.prototype,"PeakPlayerInfo");var PeakTopRankData=function(){function t(t){t&&this.readData(t)}return t.prototype.readData=function(t){this.playerId=t.readInt(),this.playerName=t.readString(),this.servId=t.readInt(),this.likeNum=t.readInt()},t}();__reflect(PeakTopRankData.prototype,"PeakTopRankData");var PeakBetData=function(){function t(t){t&&this.readData(t)}return t.prototype.readData=function(t){this.status=t.readByte(),this.playerId=t.readInt(),this.batNum=t.readInt()},t}();__reflect(PeakBetData.prototype,"PeakBetData");var PeakBattleReportData=function(){function t(){}return t}();__reflect(PeakBattleReportData.prototype,"PeakBattleReportData");var KonckReportData=function(){function t(){}return t.prototype.readBFData=function(t){this.id=t.readInt(),this.player=t.readString(),this.result=t.readByte()},t.prototype.readKFData=function(t){this.id=t.readInt(),this.player=t.readString(),this.servId=t.readInt(),this.result=t.readByte()},t}();__reflect(KonckReportData.prototype,"KonckReportData");var BF_PeakStatus;!function(t){t[t.None=0]="None",t[t.SignUp=1]="SignUp",t[t.Knockout=2]="Knockout",t[t.Prom16=3]="Prom16",t[t.Prom8=4]="Prom8",t[t.Prom4=5]="Prom4",t[t.Finals=6]="Finals",t[t.Over=7]="Over"}(BF_PeakStatus||(BF_PeakStatus={}));var KF_PeakStatus;!function(t){t[t.None=0]="None",t[t.Knockout=1]="Knockout",t[t.Prom64=2]="Prom64",t[t.Prom32=3]="Prom32",t[t.Prom16=4]="Prom16",t[t.Prom8=5]="Prom8",t[t.Prom4=6]="Prom4",t[t.Finals=7]="Finals",t[t.Over=8]="Over"}(KF_PeakStatus||(KF_PeakStatus={}));var PeakedHelp=function(){function t(){}return t.calcTimerNode=function(){var t=GlobalConfig.PeakRaceBase,e=GlobalConfig.PeakRaceTime,i=PeakedSys.ins();this.bfStatusTimer=[],this.kfStatusTimer=[];var s=Math.floor(DateUtils.formatMiniDateTime(i.curStateTime)/DateUtils.MS_PER_SECOND);PeakedSys.ins().bfStatus>=BF_PeakStatus.Finals&&PeakedSys.ins().bfStatusIsEnd&&(GlobalConfig.PeakRaceBase.interval||(GlobalConfig.PeakRaceBase.interval=14),s-=GlobalConfig.PeakRaceBase.interval*DateUtils.MS_PER_DAY/DateUtils.MS_PER_SECOND),this.bfStatusTimer[BF_PeakStatus.None]=s,this.bfStatusTimer[BF_PeakStatus.Over]=s+t.crossRelTime;for(var n=1;n<=BF_PeakStatus.Finals;n++)this.bfStatusTimer[n]=s+e[n].relTime;e=GlobalConfig.PeakRaceCrossTime,this.kfStatusTimer[KF_PeakStatus.None]=s;for(var o=1;o<=KF_PeakStatus.Finals;o++)this.kfStatusTimer[o]=s+e[o].relTime},t.getTimerRuleStr=function(){var t=GlobalConfig.PeakRaceBase,e="|C:"+ColorUtil.GREEN+"&T:",i="1、报名等级：达到"+e+t.needZsLv+"|转\n",s=DateUtils.TIME_FORMAT_13,n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.SignUp],s),o=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Knockout],s);return i+="2、报名时间："+e+n+"|到"+e+o+"|\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Knockout],s),i+="3、淘汰赛："+e+n+"|举行，所有报名玩家争夺16强席位\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom16],s),i+="4、八强赛："+e+n+"|举行\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom8],s),i+="5、四强赛："+e+n+"|举行\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom4],s),i+="6、半决赛："+e+n+"|举行\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Finals],s),i+="7、决赛："+e+n+"|举行\n"},t.getKFTimerRuleStr=function(){var t="|C:"+ColorUtil.GREEN+"&T:",e="1、报名条件：单服16强自动报名\n",i=DateUtils.TIME_FORMAT_13,s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Knockout],i);return e+="2、淘汰赛："+t+s+"|举行，决出64强\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom64],i),e+="3、32强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom32],i),e+="4、16强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom16],i),e+="4、八强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom8],i),e+="5、四强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom4],i),e+="6、半决赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Finals],i),e+="7、决赛："+t+s+"|举行\n"},t.calcEliminateWinNum=function(){var t=0;if(PeakedSys.ins().isKf())for(var e=0,i=PeakedSys.ins().kfKonckReportList;e<i.length;e++){var s=i[e];s.result&&t++}else for(var n=0,o=PeakedSys.ins().bfKonckReportList;n<o.length;n++){var s=o[n];s.result&&t++}return t},t.getPlayerData=function(t,e){var i=PeakedSys.ins();return t==this.PK_GROUP_1?i.player16List[e-1]:t==this.PK_GROUP_2?i.player8List[e-1]?i.player8List[e-1]:this.findLastDt(e,i.player16List):t==this.PK_GROUP_3?i.player4List[e-1]?i.player4List[e-1]:this.findLastDt(e,i.player8List):i.player2Data?i.player2Data:this.findLastDt(e,i.player4List)},t.getKFPlayerData=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=!1);var n=PeakedSys.ins();return t==this.PK_GROUP_1?s?n.kfPlayer16List[e-1]?n.kfPlayer16List[e-1]:this.findLastDt(e,n.kfPlayer64List):n.kfPlayer64List.slice(8*i,8*i+8)[e-1]:t==this.PK_GROUP_2?s?n.kfPlayer8List[e-1]?n.kfPlayer8List[e-1]:this.findLastDt(e,n.kfPlayer16List):n.kfPlayer32List.slice(4*i,4*i+4)[e-1]?n.kfPlayer32List.slice(4*i,4*i+4)[e-1]:this.findLastDt(e,n.kfPlayer64List.slice(8*i,8*i+8)):t==this.PK_GROUP_3?s?n.kfPlayer4List[e-1]?n.kfPlayer4List[e-1]:this.findLastDt(e,n.kfPlayer8List):n.kfPlayer16List.slice(2*i,2*i+2)[e-1]?n.kfPlayer16List.slice(2*i,2*i+2)[e-1]:this.findLastDt(e,n.kfPlayer32List.slice(4*i,4*i+4)):n.kfPlayer2Data?n.kfPlayer2Data:this.findLastDt(e,n.kfPlayer4List)},t.findLastDt=function(t,e){if(e&&e[2*(t-1)+1]){var i=e[2*(t-1)>>0].winId,s=e[2*(t-1)+1>>0].winId,n=new PeakPlayerData;return n.playerList=[],n.playerList.push(this.findPlayerDtById(i)),n.playerList.push(this.findPlayerDtById(s)),n.reportList=[],n}return null},t.findPlayerDtById=function(t,e){e||(e=PeakedSys.ins().isKf()?PeakedSys.ins().kfPlayer64List:PeakedSys.ins().player16List);for(var i=0,s=e;i<s.length;i++)for(var n=s[i],o=0,a=n.playerList;o<a.length;o++){var r=a[o];if(t==r.roleId)return r}},t.checkIsWinById=function(e,i,s){s||(s=PeakedSys.ins().isKf()?t.getPlayerListByStage(i):t.getPlayerListByStage(i));for(var n=0,o=s;n<o.length;n++){var a=o[n];if(e==a.winId)return!0}return!1},t.getPlayerListByStage=function(t){if(PeakedSys.ins().isKf())switch(t){case KF_PeakStatus.Knockout:case KF_PeakStatus.Prom64:return PeakedSys.ins().kfPlayer64List;case KF_PeakStatus.Prom32:return PeakedSys.ins().kfPlayer32List;case KF_PeakStatus.Prom16:return PeakedSys.ins().kfPlayer16List;case KF_PeakStatus.Prom8:return PeakedSys.ins().kfPlayer8List;case KF_PeakStatus.Prom4:return PeakedSys.ins().kfPlayer4List;case KF_PeakStatus.Finals:return[PeakedSys.ins().kfPlayer2Data]}else switch(t){case BF_PeakStatus.Prom16:case BF_PeakStatus.Knockout:return PeakedSys.ins().player16List;case BF_PeakStatus.Prom8:return PeakedSys.ins().player8List;case BF_PeakStatus.Prom4:return PeakedSys.ins().player4List;case BF_PeakStatus.Finals:return[PeakedSys.ins().player2Data]}},t.countMyRecordData=function(){for(var t=PeakedSys.ins().player16List,e=PeakedSys.ins().player8List,i=PeakedSys.ins().player4List,s=PeakedSys.ins().player2Data,n=function(t,e,i){for(var s=t.playerList.length,n=0;s>n;n++){var o=t.playerList[n];if(o.roleId==Actor.actorID){var a=s>1?t.playerList[0==n?1:0].playerName:"轮空";if(0==t.reportList.length&&!t.playerList[1]&&i<PeakedSys.ins().bfStatus){var r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=1,r.round=0,e.push(r)}else for(var h=0,l=0,c=t.reportList;l<c.length;l++){var u=c[l],r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=u==Actor.actorID?1:0,r.round=++h,e.push(r)}break}}},o=[],a=0,r=t;a<r.length;a++){var h=r[a];n(h,o,BF_PeakStatus.Prom16)}for(var l=0,c=e;l<c.length;l++){var h=c[l];n(h,o,BF_PeakStatus.Prom8)}for(var u=0,p=i;u<p.length;u++){var h=p[u];n(h,o,BF_PeakStatus.Prom4)}return n(s,o,BF_PeakStatus.Finals),o},t.countKFMyRecordData=function(){for(var t=PeakedSys.ins().kfPlayer64List,e=PeakedSys.ins().kfPlayer32List,i=PeakedSys.ins().kfPlayer16List,s=PeakedSys.ins().kfPlayer8List,n=PeakedSys.ins().kfPlayer4List,o=PeakedSys.ins().kfPlayer2Data,a=function(t,e,i){for(var s=t.playerList.length,n=0;s>n;n++){var o=t.playerList[n];if(o.roleId==Actor.actorID){var a=s>1?t.playerList[0==n?1:0].playerName:"轮空";if(0==t.reportList.length&&!t.playerList[1]&&i<PeakedSys.ins().kfStatus){var r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=1,r.round=0,e.push(r)}else for(var h=0,l=0,c=t.reportList;l<c.length;l++){var u=c[l],r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=u==Actor.actorID?1:0,r.round=++h,e.push(r)}break}}},r=[],h=0,l=t;h<l.length;h++){var c=l[h];a(c,r,KF_PeakStatus.Prom64)}for(var u=0,p=e;u<p.length;u++){var c=p[u];a(c,r,KF_PeakStatus.Prom32)}for(var d=0,g=i;d<g.length;d++){var c=g[d];a(c,r,KF_PeakStatus.Prom16)}for(var f=0,v=s;f<v.length;f++){var c=v[f];a(c,r,KF_PeakStatus.Prom8)}for(var y=0,m=n;y<m.length;y++){var c=m[y];a(c,r,KF_PeakStatus.Prom4)}return a(o,r,KF_PeakStatus.Finals),r},t.findBetInfoById=function(t,e,i){if(!i){var s=PeakedSys.ins().isKf();i=s?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo}if(!i)return null;for(var n=0,o=i;n<o.length;n++){var a=o[n];if(a.playerId==t&&a.status==e)return a}return null},t.getStatusByGroup=function(t){if(PeakedSys.ins().isKf())if(PeakedSys.ins().isKFSixteen())switch(t){case this.PK_GROUP_1:return KF_PeakStatus.Prom16;case this.PK_GROUP_2:return KF_PeakStatus.Prom8;case this.PK_GROUP_3:return KF_PeakStatus.Prom4;case this.PK_GROUP_4:return KF_PeakStatus.Finals}else switch(t){case this.PK_GROUP_1:return KF_PeakStatus.Prom64;case this.PK_GROUP_2:return KF_PeakStatus.Prom32}else switch(t){case this.PK_GROUP_1:return BF_PeakStatus.Prom16;case this.PK_GROUP_2:return BF_PeakStatus.Prom8;case this.PK_GROUP_3:return BF_PeakStatus.Prom4;case this.PK_GROUP_4:return BF_PeakStatus.Finals}},t.checkIsBet=function(t,e){for(var i=parseInt(e),s=PeakedSys.ins().isKf(),n=0,o=t;n<o.length;n++){var a=o[n];if(a){var r=this.findBetInfoById(a.roleId,this.getStatusByGroup(parseInt(e)));if(r)if(s)if(PeakedSys.ins().isKFSixteen()){if(i==this.PK_GROUP_1&&r.status==KF_PeakStatus.Prom16)return!0;if(i==this.PK_GROUP_2&&r.status==KF_PeakStatus.Prom8)return!0;if(i==this.PK_GROUP_3&&r.status==KF_PeakStatus.Prom4)return!0;if(i==this.PK_GROUP_4&&r.status==KF_PeakStatus.Finals)return!0}else{if(i==this.PK_GROUP_1&&r.status==KF_PeakStatus.Prom64)return!0;if(i==this.PK_GROUP_2&&r.status==KF_PeakStatus.Prom32)return!0}else{if(i==this.PK_GROUP_1&&r.status==BF_PeakStatus.Prom16)return!0;if(i==this.PK_GROUP_2&&r.status==BF_PeakStatus.Prom8)return!0;if(i==this.PK_GROUP_3&&r.status==BF_PeakStatus.Prom4)return!0;if(i==this.PK_GROUP_4&&r.status==BF_PeakStatus.Finals)return!0}}}return!1},t.findPlayerIndexById=function(t,e){for(var i=0;i<e.length;i++)if(e[i].roleId==t)return i;return-1},t.setImgGroupSource=function(t,e){for(var i=0;i<t.numChildren;i++){var s=t.getChildAt(i);s&&(s.source=e)}},t.statusIsOver=function(t,e){return e?PeakedSys.ins().kfStatus>t||PeakedSys.ins().kfStatus==t&&0!=PeakedSys.ins().kfStatusIsEnd:PeakedSys.ins().bfStatus>t||PeakedSys.ins().bfStatus==t&&0!=PeakedSys.ins().bfStatusIsEnd},t.statusIsOverByGroup=function(e){var i=!1;return PeakedSys.ins().isKf()?PeakedSys.ins().isKFSixteen()?i=e==this.PK_GROUP_1?t.statusIsOver(KF_PeakStatus.Prom16,!1):e==this.PK_GROUP_2?t.statusIsOver(KF_PeakStatus.Prom8,!1):e==this.PK_GROUP_3?t.statusIsOver(KF_PeakStatus.Prom4,!1):t.statusIsOver(KF_PeakStatus.Finals,!1):e==this.PK_GROUP_1?i=t.statusIsOver(KF_PeakStatus.Prom64,!1):e==this.PK_GROUP_2&&(i=t.statusIsOver(KF_PeakStatus.Prom32,!1)):i=e==this.PK_GROUP_1?t.statusIsOver(BF_PeakStatus.Prom16,!1):e==this.PK_GROUP_2?t.statusIsOver(BF_PeakStatus.Prom8,!1):e==this.PK_GROUP_3?t.statusIsOver(BF_PeakStatus.Prom4,!1):t.statusIsOver(BF_PeakStatus.Finals,!1),i},t.pushPlayerList=function(e,i,s,n){if(e[2*n]){var o=t.findPlayerDtById(e[2*n].winId,i);o&&s.push(o)}if(e[2*n+1]){var o=t.findPlayerDtById(e[2*n+1].winId,i);o&&s.push(o)}},t.isSixteenById=function(t){for(var e=0,i=PeakedSys.ins().player16List;e<i.length;e++){var s=i[e];if(s)for(var n=0,o=s.playerList;n<o.length;n++){var a=o[n];if(a.roleId==t)return!0}}return!1},t.sortBetFun=function(t,e){return t.status>e.status?1:t.status<e.status?-1:0},t.findKFGroupById=function(t){for(var e=0,i=0,s=PeakedSys.ins().kfPlayer64List;i<s.length;i++)for(var n=s[i],o=0,a=n.playerList;o<a.length;o++){var r=a[o];if(r.roleId==t)return e/16>>0;e++}return-1},t.findBetKFGroup=function(){for(var t=PeakedSys.ins().kfStatus,e=0,i=PeakedSys.ins().kfBetInfo;e<i.length;e++){var s=i[e];if(s.status==KF_PeakStatus.Prom64&&t==KF_PeakStatus.Knockout||s.status==KF_PeakStatus.Prom32&&t==KF_PeakStatus.Prom64)return this.findKFGroupById(s.playerId)}return-1},t.canSupport=function(){var t=this.kfStatusTimer[KF_PeakStatus.None]+DateUtils.DAYS_PER_WEEK*DateUtils.SECOND_PER_DAY;return GameServer.serverTime/DateUtils.MS_PER_SECOND>t&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Finals&&PeakedSys.ins().kfStatusIsEnd?!1:!0},t}();PeakedHelp.PK_GROUP_1=1,PeakedHelp.PK_GROUP_2=2,PeakedHelp.PK_GROUP_3=3,PeakedHelp.PK_GROUP_4=4,__reflect(PeakedHelp.prototype,"PeakedHelp");var PeakAwardItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.awardslist.itemRenderer=ItemBase},e.prototype.dataChanged=function(){this.data instanceof PeakRaceTime?this.typeLabel.text=PeakedData.STATE_TYPE_AWARD_CN[this.data.status]:this.data instanceof PeakRaceCrossTime&&(this.typeLabel.text=PeakedData.STATE_KF_TYPE_AWARD_CN[this.data.status]);var t=GlobalConfig.MailIdConfig[this.data.loseMail];this.awardslist.dataProvider=new eui.ArrayCollection(t.attachment)},e}(BaseItemRender);__reflect(PeakAwardItemRender.prototype,"PeakAwardItemRender");var PeakKnockoutItemItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.infoLabel.text=(this.data.servId?"跨服":"单服")+"淘汰赛第"+this.data.round+"场",this.playerName.text=this.data.player?this.data.player:"轮空",this.playerName.name=this.data.id,this.data.result?(this.result.textColor=ColorUtil.GREEN,this.result.text="胜利"):(this.result.textColor=ColorUtil.RED,this.result.text="失败"))},e}(BaseItemRender);__reflect(PeakKnockoutItemItemRender.prototype,"PeakKnockoutItemItemRender");var PeakMyBattleRecordItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.playerName){var t=this.data.round?"第"+this.data.round+"场":"";PeakedSys.ins().isKf()?this.roundInfo.text=""+PeakedData.SERV_CN[1]+PeakedData.STATE_KF_TYPE_CN[this.data.stateType]+" "+t:this.roundInfo.text=""+PeakedData.SERV_CN[0]+PeakedData.STATE_TYPE_CN[this.data.stateType]+" "+t,this.enemyLabel.text=this.data.playerName,this.result.text=this.data.result?"胜利":"失败",this.result.textColor=this.data.result?ColorUtil.GREEN:ColorUtil.RED}},e}(BaseItemRender);__reflect(PeakMyBattleRecordItemRender.prototype,"PeakMyBattleRecordItemRender");var PeakMyBetItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof PeakBetData){PeakedSys.ins().isKf()?this.round.text=PeakedData.SERV_CN[1]+PeakedData.STATE_KF_TYPE_CN[this.data.status]:this.round.text=PeakedData.SERV_CN[0]+PeakedData.STATE_TYPE_CN[this.data.status];var t=PeakedHelp.findPlayerDtById(this.data.playerId),e="";e=PeakedHelp.statusIsOver(this.data.status,PeakedSys.ins().isKf())?PeakedHelp.checkIsWinById(this.data.playerId,this.data.status)?"|C:"+ColorUtil.GREEN+"&T:获利"+this.data.batNum+"筹码|":"|C:"+ColorUtil.RED+"&T:损失"+this.data.batNum+"筹码|":PeakedHelp.checkIsWinById(this.data.playerId,this.data.status)?"|C:"+ColorUtil.GREEN+"&T:获利"+this.data.batNum+"筹码|":"等待结果中...",this.infoLabel.textFlow=TextFlowMaker.generateTextFlow1("下注【"+t.playerName+"】 "+this.data.batNum+"筹码，"+e)}},e}(BaseItemRender);__reflect(PeakMyBetItemRender.prototype,"PeakMyBetItemRender");var PeakTopRankItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof PeakTopRankData&&(this.nameLabel.text=this.data.playerName,this.score.text=this.data.likeNum*GlobalConfig.PeakRaceBase.likeScore+"",this.supportBtn.visible=PeakedHelp.canSupport(),PeakedSys.ins().kideNum>=GlobalConfig.PeakRaceBase.likeCount&&(this.supportBtn.enabled=!1),this.data.rank<=3?(this.rankImg.source="paihang"+this.data.rank,this.rank.text=""):(this.rank.text=this.data.rank+"",this.rankImg.source=""))},e}(BaseItemRender);__reflect(PeakTopRankItemRender.prototype,"PeakTopRankItemRender");var PeakViewBattleReportItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data?(this.roundTxt.text="第"+this.data.round+"局",this.player.text=this.data.winer,this.noOpen.visible=!1,this.infoGroup.visible=!0):(this.noOpen.visible=!0,this.infoGroup.visible=!1)},e}(BaseItemRender);__reflect(PeakViewBattleReportItemRender.prototype,"PeakViewBattleReportItemRender");var PeakedRedpoint=function(t){function e(){var e=t.call(this)||this;return e.redpoint1=0,e.redpoint2=0,e.redpoint3=0,e.redpoint=0,e.associated(e.postRedPoint,PeakedSys.ins().postSignUp,PeakedSys.ins().postState,PeakedSys.ins().postWorship,PeakedSys.ins().postKFInfoList,UserZs.ins().postZsLv),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){return this.redpoint1=0,this.redpoint2=0,this.redpoint3=0,this.redpoint=0,PeakedSys.ins().isOpen()?UserZs.ins().lv<GlobalConfig.PeakRaceBase.needZsLv?this.redpoint:(PeakedSys.ins().bfStatus==BF_PeakStatus.SignUp&&0==PeakedSys.ins().isSignUp&&PeakedSys.ins().canSignUp()&&(this.redpoint1=1),PeakedSys.ins().isKf()&&PeakedHelp.canSupport()?(PeakedSys.ins().kfStatus>KF_PeakStatus.Knockout||PeakedSys.ins().kfStatus==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd)&&(this.redpoint2=GlobalConfig.PeakRaceBase.likeCount-PeakedSys.ins().kideNum):(PeakedSys.ins().bfStatus>BF_PeakStatus.Knockout||PeakedSys.ins().bfStatus==BF_PeakStatus.Knockout&&PeakedSys.ins().bfStatusIsEnd)&&PeakedSys.ins().bfStatus<BF_PeakStatus.Over&&PeakedHelp.canSupport()&&(this.redpoint2=GlobalConfig.PeakRaceBase.likeCount-PeakedSys.ins().kideNum),this.redpoint3=PeakedSys.ins().worshipNum<GlobalConfig.PeakRaceBase.mobaiNum&&PeakedSys.ins().kfPlayer2Data&&PeakedSys.ins().kfPlayer2Data.winId&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd?1:0,this.redpoint=this.redpoint1+this.redpoint2+this.redpoint3,this.redpoint):this.redpoint},e}(BaseSystem);__reflect(PeakedRedpoint.prototype,"PeakedRedpoint");var GameSystem;!function(t){t.peakedRedpoint=PeakedRedpoint.ins.bind(PeakedRedpoint)}(GameSystem||(GameSystem={}));var PeakedSys=function(t){function e(){var e=t.call(this)||this;return e.player16List=[],e.player8List=[],e.player4List=[],e.topRankInfoList=[],e.betInfo=[],e.myBattleReportList=[],e.bfStatusIsEnd=0,e.kfStatusIsEnd=0,e.bfKonckReportList=[],e.kfPlayer64List=[],e.kfPlayer32List=[],e.kfPlayer16List=[],e.kfPlayer8List=[],e.kfPlayer4List=[],e.kfKonckReportList=[],e.kfTopRankInfoList=[],e.kfBetInfo=[],e.myKFBattleReportList=[],e.crossScene=1e4,e.sysId=PackageID.PKCompetition,e.regNetMsg(0,e.postState),e.regNetMsg(1,e.postSignUp),e.regNetMsg(2,e.doPKResult),e.regNetMsg(3,e.postEliminateReportData),e.regNetMsg(4,e.postBFInfoList),e.regNetMsg(5,e.postTopRank),e.regNetMsg(7,e.postBetInfo),e.regNetMsg(8,e.postKFEliminateReportData),e.regNetMsg(9,e.postKFInfoList),e.regNetMsg(10,e.postKFTopRank),e.regNetMsg(12,e.postKFBetInfo),e.regNetMsg(13,e.doFbCountDown),e.regNetMsg(14,e.postWorship),e.observe(GameLogic.ins().postEnterMap,function(){e.isCrossScene()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postState=function(t){var i=this;if(t&&(this.bfStatus=t.readByte(),this.bfStatusIsEnd=t.readByte(),this.kfStatus=t.readByte(),this.kfStatusIsEnd=t.readByte(),0==this.bfStatus&&(this.isSignUp=0)),this.bfStatus==BF_PeakStatus.Finals&&this.bfStatusIsEnd){var s=1e3*PeakedHelp.bfStatusTimer[BF_PeakStatus.Over]-GameServer.serverTime;this.kfStatus>KF_PeakStatus.None&&(s=0),0>=s?this.bfStatus=BF_PeakStatus.Over:TimerManager.ins().doTimer(s,1,function(){i.bfStatus=BF_PeakStatus.Over,PeakedHelp.calcTimerNode(),i.postState(null)},this)}PeakedHelp.calcTimerNode(),e.ins().isKf()&&e.ins().sendKFBetInfo()},e.prototype.postSignUp=function(t){return this.isSignUp=t.readByte(),this.kideNum=t.readInt(),Actor.ins().postChip(t.readNumber()),this.curStateTime=t.readInt(),this.worshipNum=t.readByte(),PeakedHelp.calcTimerNode(),this.isSignUp},e.prototype.doPKResult=function(t){var e=t.readByte(),i=t.readString();ViewManager.ins().open(PeakedFBResult,e,i)},e.prototype.postEliminateReportData=function(t){this.bfKonckRound=t.readShort(),this.bfKonckNextTimer=t.readInt(),this.bfKonckSurplusNum=t.readShort(),this.bfKonckReportList=[];for(var e=t.readShort(),i=0;e>i;i++){var s=new KonckReportData;s.readBFData(t),s.round=i+1,this.bfKonckReportList.push(s)}},e.prototype.postBFInfoList=function(t){var e;this.player16List=[];for(var i=t.readByte(),s=0;i>s;s++)e=new PeakPlayerData,e.readBaseData(t),this.player16List.push(e);this.player8List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.player16List,this.player16List,e.playerList,s),e.readToData(t),this.player8List.push(e);this.player4List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.player8List,this.player16List,e.playerList,s),e.readToData(t),this.player4List.push(e);this.player2Data=new PeakPlayerData,this.player2Data.playerList=[],PeakedHelp.pushPlayerList(this.player4List,this.player16List,this.player2Data.playerList,0),this.player2Data.readToData(t),this.myBattleReportList=PeakedHelp.countMyRecordData()},e.prototype.postTopRank=function(t){var e=t.readShort();this.topRankInfoList=[];for(var i=0;e>i;i++){var s=new PeakTopRankData(t);s.rank=i+1,this.topRankInfoList.push(s)}},e.prototype.postBetInfo=function(t){var e=t.readByte();this.betInfo=[];for(var i=0;e>i;i++){var s=new PeakBetData(t);this.betInfo.push(s)}ViewManager.ins().isShow(PeakBetWin)&&UserTips.ins().showTips("恭喜您，下注成功"),ViewManager.ins().close(PeakBetWin)},e.prototype.postKFEliminateReportData=function(t){this.kfKonckRound=t.readShort(),this.kfKonckNextTimer=t.readInt(),this.kfKonckSurplusNum=t.readShort(),this.kfKonckReportList=[];for(var e=t.readShort(),i=0;e>i;i++){var s=new KonckReportData;s.readKFData(t),s.round=i+1,this.kfKonckReportList.push(s)}},e.prototype.postKFInfoList=function(t){var e;this.kfPlayer64List=[];for(var i=t.readByte(),s=0;i>s;s++)e=new PeakPlayerData,e.readBaseData(t,!0),this.kfPlayer64List.push(e);this.kfPlayer32List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer64List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer32List.push(e);this.kfPlayer16List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer32List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer16List.push(e);this.kfPlayer8List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer16List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer8List.push(e);this.kfPlayer4List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer8List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer4List.push(e);this.kfPlayer2Data=new PeakPlayerData,this.kfPlayer2Data.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer4List,this.kfPlayer64List,this.kfPlayer2Data.playerList,0),this.kfPlayer2Data.readToData(t),this.myKFBattleReportList=PeakedHelp.countKFMyRecordData()},e.prototype.postKFTopRank=function(t){var e=t.readShort();this.kfTopRankInfoList=[];for(var i=0;e>i;i++){var s=new PeakTopRankData(t);s.rank=i+1,this.kfTopRankInfoList.push(s)}},e.prototype.postKFBetInfo=function(t){var e=t.readByte();this.kfBetInfo=[];for(var i=0;e>i;i++){var s=new PeakBetData(t);this.kfBetInfo.push(s)}ViewManager.ins().isShow(PeakBetWin)&&UserTips.ins().showTips("恭喜您，下注成功"),ViewManager.ins().close(PeakBetWin)},e.prototype.doFbCountDown=function(t){var e=t.readInt(),i=Math.floor((DateUtils.formatMiniDateTime(e)-GameServer.serverTime)/1e3);egret.log(i),i>0&&ViewManager.ins().open(FBCountDown,i)},e.prototype.postWorship=function(t){this.worshipNum=t.readByte(),GlobalConfig.PeakRaceBase.mobaiChips||(GlobalConfig.PeakRaceBase.mobaiChips=1e3),UserTips.ins().showCenterTips("膜拜成功，筹码+"+GlobalConfig.PeakRaceBase.mobaiChips)},e.prototype.sendSignUp=function(){this.sendBaseProto(1)},e.prototype.sendEliminateReport=function(){this.sendBaseProto(3)},e.prototype.sendBFInfoList=function(){this.sendBaseProto(4)},e.prototype.sendTopRank=function(){this.sendBaseProto(5)},e.prototype.sendToLikes=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.sendBet=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendKFEliminateReport=function(){this.sendBaseProto(8)},e.prototype.sendKFInfoList=function(){this.sendBaseProto(9)},e.prototype.sendKFTopRank=function(){this.sendBaseProto(10)},e.prototype.sendKFToLikes=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)
},e.prototype.sendKFBet=function(t,e){var i=this.getBytes(12);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendKFBetInfo=function(){this.sendBaseProto(13)},e.prototype.sendWorship=function(){this.sendBaseProto(14)},e.prototype.isOpen=function(){var t=OpenSystem.ins().checkSysOpen(SystemType.RING),e=Object.keys(GlobalConfig.ActorExRingConfig).length,i=SpecialRing.ins().ringActiNum<e;return GameServer.serverOpenDay>=GlobalConfig.PeakRaceBase.openDay&&t&&!i?!0:!1},e.prototype.isKf=function(){return this.bfStatus==BF_PeakStatus.Over&&0!=this.bfStatusIsEnd},e.prototype.canSignUp=function(){1e3*PeakedHelp.bfStatusTimer[BF_PeakStatus.Knockout]-GameServer.serverTime;return!0},e.prototype.isKFSixteen=function(){return this.kfStatus>KF_PeakStatus.Prom32||this.kfStatus==KF_PeakStatus.Prom32&&0!=this.kfStatusIsEnd},e.prototype.isCrossScene=function(){2==this.crossScene&&ViewManager.ins().open(PeakedMainWin),this.crossScene++},e}(BaseSystem);__reflect(PeakedSys.prototype,"PeakedSys");var GameSystem;!function(t){t.pkCompetitionSys=PeakedSys.ins.bind(PeakedSys)}(GameSystem||(GameSystem={}));var PeakAwardPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.curServList.itemRenderer=PeakAwardItemRender,this.kfServList.itemRenderer=PeakAwardItemRender,this._listDt1=new eui.ArrayCollection,this._listDt2=new eui.ArrayCollection,this.curServList.dataProvider=this._listDt1,this.kfServList.dataProvider=this._listDt2},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=[];for(var s in GlobalConfig.PeakRaceTime){var n=GlobalConfig.PeakRaceTime[s];n.loseMail&&i.push(n)}var o=new PeakRaceTime;o.loseMail=GlobalConfig.PeakRaceBase.winMail,o.status=BF_PeakStatus.Over,i.push(o),i.reverse(),this._listDt1.replaceAll(i),i=[];for(var s in GlobalConfig.PeakRaceCrossTime){var n=GlobalConfig.PeakRaceCrossTime[s];n.loseMail&&i.push(n)}var a=new PeakRaceCrossTime;a.loseMail=GlobalConfig.PeakRaceBase.crossWinMail,a.status=KF_PeakStatus.Over,i.push(a),i.reverse(),this._listDt2.replaceAll(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(PeakAwardPanel.prototype,"PeakAwardPanel");var PeakChipMallPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.listView.itemRenderer=HonorMarketItemRenderer,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.getWay,this.onGetway),this.observe(Shop.ins().postRefresMedalMessage,this.updateData),this.observe(Actor.ins().postChip,this.callback),this.observe(Shop.ins().postUpdateBuyMedal,this.callback),Shop.ins().sendMedalMessage()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.$onClose(),this.removeTouchEvent(this.getWay,this.onGetway)},e.prototype.callback=function(){Shop.ins().sendMedalMessage()},e.prototype.onGetway=function(){},e.prototype.updateData=function(){var t=[],e=GlobalConfig.FeatsStore;for(var i in e)if(2!=e[i].shopType){var s=!0;if(e[i].buyType==FEATS_TYPE.forever&&Shop.ins().medalData)for(var n in Shop.ins().medalData.exchangeCount)if(e[i].index==Number(n)&&e[i].daycount){Shop.ins().medalData.exchangeCount[n]>=e[i].daycount&&(s=!1);break}s&&t.push(e[i])}this.dataArr.replaceAll(t),this.myLabel.text=Actor.chip+"";var o=this.getWay.text;this.getWay.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+o)},e}(BaseView);__reflect(PeakChipMallPanel.prototype,"PeakChipMallPanel");var PeakedFBResult=function(t){function e(){var e=t.call(this)||this;return e.AUTO_QUIT_TIME=5,e._curTime=0,e.skinName="PeakedNessResultSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.quitBtn,this.onQuit);var i=t[1];t[0]?(this.bg.source="win_png",this.result.source="win_02",this.resultImg.source="peakness_win",this.win.visible=!0,this.lose.visible=!1,this.winPlayer.text=i):(this.bg.source="lost_png",this.result.source="lost_02",this.resultImg.source="peakness_lose",this.win.visible=!1,this.lose.visible=!0,this.losePlayer.text=i),TimerManager.ins().doTimer(1e3,this.AUTO_QUIT_TIME,this.onTick,this),this._curTime=this.AUTO_QUIT_TIME,this.onTick()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.onTick,this)},e.prototype.onTick=function(){this.quitBtn.label="退出("+--this._curTime+")",this._curTime<0&&this.onQuit()},e.prototype.onQuit=function(){UserFb.ins().sendExitFb(),ViewManager.ins().close(e),PeakedSys.ins().isKf()?PeakedSys.ins().crossScene=1:TimerManager.ins().doTimer(300,1,function(){ViewManager.ins().open(PeakedMainWin)},this)},e}(BaseEuiView);__reflect(PeakedFBResult.prototype,"PeakedFBResult"),ViewManager.ins().reg(PeakedFBResult,LayerManager.UI_Popup);var PeakedMainWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="PeakednessWinSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=t[0]?t[0]:0,this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addTouchEvent(this.help,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.setOpenIndex(this.oldIndex),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedpoint)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.viewStack.getElementAt(this.oldIndex)&&this.viewStack.getElementAt(this.oldIndex).close()},e.prototype.openOtherPlayerView=function(t){if(4!=this.oldIndex){var e=ViewManager.ins().isShow(PeakTopRankWin);e&&ViewManager.ins().close(PeakTopRankWin);var i=ViewManager.ins().open(RRoleWin,t);i.hideEx(1),i.closeFun=function(){e&&ViewManager.ins().open(PeakTopRankWin)}}},e.prototype.onTabTouch=function(t){var e=this.tab.selectedIndex;this.setOpenIndex(e)},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.peakedPanel.open();break;case 1:this.peakAwardPanel.open();break;case 2:this.peakedMallPanel.open();break;case 3:this.peakChipMallPanel.open();break;case 4:this.worshipChampionPanel.open()}this.oldIndex!=t?(this.viewStack.getElementAt(this.oldIndex).close(),this.oldIndex=t):this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.onTouch=function(t){switch(t.target){case this.help:var e=PeakedSys.ins().isKf()?32:31;ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[e].text);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.refRedpoint=function(){this.redPoint0.visible=PeakedRedpoint.ins().redpoint1>0,this.redPoint1.visible=!1,this.redPoint2.visible=!1,this.redPoint3.visible=!1,this.redPoint4.visible=PeakedRedpoint.ins().redpoint3>0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return PeakedSys.ins().isOpen()?!0:(UserTips.ins().showTips("巅峰战绩未开启！"),!1)},e}(BaseEuiView);__reflect(PeakedMainWin.prototype,"PeakedMainWin"),ViewManager.ins().reg(PeakedMainWin,LayerManager.UI_Main);var PeakedMallPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.listView.itemRenderer=HonorMarketItemRenderer,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.getWay,this.onGetway),this.observe(Shop.ins().postRefresMedalMessage,this.updateData),this.observe(Shop.ins().postUpdateBuyMedal,this.callback),Shop.ins().sendMedalMessage()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.getWay,this.onGetway),this.$onClose()},e.prototype.callback=function(){Shop.ins().sendMedalMessage()},e.prototype.onGetway=function(){},e.prototype.updateData=function(){var t=[],e=GlobalConfig.FeatsStore;for(var i in e)if(1!=e[i].shopType){var s=!0;if(e[i].buyType==FEATS_TYPE.forever&&Shop.ins().medalData)for(var n in Shop.ins().medalData.exchangeCount)if(e[i].index==Number(n)&&e[i].daycount){Shop.ins().medalData.exchangeCount[n]>=e[i].daycount&&(s=!1);break}s&&t.push(e[i])}this.dataArr.replaceAll(t),this.myLabel.text=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.PeakRaceBase.exchangeItems[0])+""},e}(BaseView);__reflect(PeakedMallPanel.prototype,"PeakedMallPanel");var PeakedPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PeakedSys.ins().postState,this.upCurState),this.upCurState()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.$onClose(),this._curPanel&&(this._curPanel.close(),DisplayUtils.removeFromParent(this._curPanel))},e.prototype.upCurState=function(){if(this._curPanel&&(this._curPanel.close(),DisplayUtils.removeFromParent(this._curPanel)),PeakedSys.ins().isKf()){var t=PeakedSys.ins().kfStatus;switch(t==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd&&(t=KF_PeakStatus.Prom64),t){case KF_PeakStatus.None:case KF_PeakStatus.Knockout:this.signupPanel||(this.signupPanel=new SignupPanel),this._curPanel=this.signupPanel;break;case KF_PeakStatus.Prom64:case KF_PeakStatus.Prom32:case KF_PeakStatus.Prom16:case KF_PeakStatus.Prom8:case KF_PeakStatus.Prom4:case KF_PeakStatus.Finals:this.sixteenPanel||(this.sixteenPanel=new SixteenPanel),this._curPanel=this.sixteenPanel}}else{var t=PeakedSys.ins().bfStatus;switch(t==BF_PeakStatus.Knockout&&(PeakedSys.ins().bfStatusIsEnd?t=BF_PeakStatus.Prom16:PeakedSys.ins().isSignUp||(UserTips.ins().showTips("您未报名，请等决出16强后再来查看"),t=BF_PeakStatus.SignUp)),t){case BF_PeakStatus.None:case BF_PeakStatus.SignUp:case BF_PeakStatus.Knockout:this.signupPanel||(this.signupPanel=new SignupPanel),this._curPanel=this.signupPanel;break;case BF_PeakStatus.Prom16:case BF_PeakStatus.Prom8:case BF_PeakStatus.Prom4:case BF_PeakStatus.Finals:case BF_PeakStatus.Over:this.sixteenPanel||(this.sixteenPanel=new SixteenPanel),this._curPanel=this.sixteenPanel}}this._curPanel&&(this.addChild(this._curPanel),this._curPanel.open())},e}(BaseView);__reflect(PeakedPanel.prototype,"PeakedPanel");var SignupPanel=function(t){function e(){var e=t.call(this)||this;return e.curKonckRound=0,e.skinName="SignupSkin",e.left=0,e.right=0,e.top=0,e.bottom=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.eliminateInfoList.itemRenderer=PeakKnockoutItemItemRender,this._eliminateInfoDt=new eui.ArrayCollection,this.eliminateInfoList.dataProvider=this._eliminateInfoDt,this.rewardList.itemRenderer=ItemBase;var t=DateUtils.getFormatBySecond(GlobalConfig.PeakRaceBase.KnockOutTime,DateUtils.TIME_FORMAT_10);this.info.text="淘汰赛负"+GlobalConfig.PeakRaceBase.signUpLose+"场出局,每场间隔"+t},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.observe(PeakedSys.ins().postState,this.upCurState),this.observe(PeakedSys.ins().postSignUp,this.upSignUpState),this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedPoint),this.observe(PeakedSys.ins().postEliminateReportData,this.upEliminateReport),this.observe(PeakedSys.ins().postKFEliminateReportData,this.upEliminateReport),this.addTouchEvent(this.signUpBtn,this.onTouch),this.addTouchEvent(this.eliminateInfoList,this.onTouch),PeakedRedpoint.ins().postRedPoint(),PeakedSys.ins().isKf()){var i=PeakedSys.ins().kfStatus;i==KF_PeakStatus.Knockout&&0==PeakedSys.ins().kfStatusIsEnd?(this.observe(PeakedSys.ins().postBFInfoList,this.upCurState),PeakedSys.ins().sendBFInfoList()):this.upCurState()}else this.upCurState()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.$onClose(),this.removeTouchEvent(this.signUpBtn,this.onTouch),this.removeTouchEvent(this.eliminateInfoList,this.onTouch),TimerManager.ins().remove(this.onTime,this)},e.prototype.onTouch=function(t){switch(t.target){case this.signUpBtn:PeakedRedpoint.ins().redpoint1>0?PeakedSys.ins().sendSignUp():PeakedSys.ins().bfStatus!=BF_PeakStatus.Knockout||PeakedSys.ins().isSignUp?UserZs.ins().lv<GlobalConfig.PeakRaceBase.needZsLv?UserTips.ins().showTips("需要转生等级到达"+GlobalConfig.PeakRaceBase.needZsLv):UserTips.ins().showTips("当前不在报名时间"):UserTips.ins().showTips("当前的报名时间已过！");break;case this.eliminateInfoList:break;default:if(t.target instanceof eui.Label&&t.target.parent instanceof PeakKnockoutItemItemRender&&t.target.name){var e=t.target.parent.data;e?UserReadPlayer.ins().sendFindPlayer(t.target.name,e.servId):UserReadPlayer.ins().sendFindPlayer(t.target.name)}}},e.prototype.upCurState=function(){if(PeakedSys.ins().isKf()){var t=PeakedSys.ins().kfStatus;switch(t==KF_PeakStatus.Knockout&&0==PeakedSys.ins().kfStatusIsEnd&&(PeakedSys.ins().isSignUp?PeakedHelp.isSixteenById(Actor.actorID)||(UserTips.ins().showTips("您未进入单服16强，请等决出64强后再来查看"),t=KF_PeakStatus.None):(UserTips.ins().showTips("您未报名，请等决出64强后再来查看"),t=KF_PeakStatus.None)),t){case KF_PeakStatus.None:this.signGroup.visible=!0,this.knockoutGroup.visible=!1,this.signUpBtn.visible=!1,this.signed.visible=!1,this.signUpRuleTxt.textFlow=TextFlowMaker.generateTextFlow(PeakedHelp.getKFTimerRuleStr()),this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.PeakRaceBase.croosRewards);break;case KF_PeakStatus.Knockout:this.signGroup.visible=!1,this.knockoutGroup.visible=!0,this.signUpBtn.visible=!1,this.signed.visible=!1,PeakedSys.ins().sendKFEliminateReport();break;case KF_PeakStatus.Prom64:case KF_PeakStatus.Prom32:case KF_PeakStatus.Prom16:case KF_PeakStatus.Prom8:case KF_PeakStatus.Prom4:case KF_PeakStatus.Finals:}}else{var t=PeakedSys.ins().bfStatus;switch(t!=BF_PeakStatus.Knockout||PeakedSys.ins().isSignUp||(t=BF_PeakStatus.SignUp),t){case BF_PeakStatus.None:case BF_PeakStatus.SignUp:this.signGroup.visible=!0,this.knockoutGroup.visible=!1,PeakedSys.ins().isSignUp?(this.signed.visible=!0,this.signUpBtn.visible=!1):(this.signUpBtn.label="报名",this.signed.visible=!1),this.signUpRuleTxt.textFlow=TextFlowMaker.generateTextFlow(PeakedHelp.getTimerRuleStr()),this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.PeakRaceBase.singleRewards);break;case BF_PeakStatus.Knockout:this.signGroup.visible=!1,this.knockoutGroup.visible=!0,PeakedSys.ins().sendEliminateReport();break;case BF_PeakStatus.Prom16:case BF_PeakStatus.Prom8:case BF_PeakStatus.Prom4:case BF_PeakStatus.Finals:}}},e.prototype.upSignUpState=function(t){void 0===t&&(t=-1),PeakedSys.ins().isSignUp&&(this.signed.visible=!0,this.signUpBtn.visible=!1,-1!=t&&UserTips.ins().showTips("成功报名巅峰赛季"))},e.prototype.upEliminateReport=function(){var t=PeakedSys.ins(),e=t.isKf()?t.kfKonckReportList:t.bfKonckReportList;this.curKonckRound=t.isKf()?t.kfKonckRound:t.bfKonckRound;var i=t.isKf()?t.kfKonckSurplusNum:t.bfKonckSurplusNum;this._eliminateInfoDt.replaceAll(e),DisplayUtils.scrollerToBottom(this.eliminateListScroller);var s="，我的战绩：",n=PeakedHelp.calcEliminateWinNum();if(e.length-n>=GlobalConfig.PeakRaceBase.signUpLose)s="|C:"+ColorUtil.RED+"&T:(您已经被淘汰)|",this.nextStartCountdownLabel.visible=!1,this.state2.visible=!1;else{var o=this.curKonckRound-n<0?0:this.curKonckRound-n;s+=n+"胜"+o+"负",TimerManager.ins().remove(this.onTime,this),TimerManager.ins().doTimer(1e3,0,this.onTime,this),this.onTime(!0),this.state2.visible=!0}this.eliminateInfoLabel.textFlow=TextFlowMaker.generateTextFlow1("当前淘汰赛第"+this.curKonckRound+"轮，剩余"+i+"人 "+s)},e.prototype.onTime=function(t){void 0===t&&(t=!1);var e=PeakedSys.ins().isKf()?PeakedSys.ins().kfKonckNextTimer:PeakedSys.ins().bfKonckNextTimer,i=Math.floor((DateUtils.formatMiniDateTime(e)-GameServer.serverTime)/1e3);i>0?this.nextStartCountdownLabel.text=DateUtils.getFormatBySecond(i):(TimerManager.ins().remove(this.onTime,this),this.nextStartCountdownLabel.text="")},e.prototype.refRedPoint=function(){this.redPoint.visible=PeakedRedpoint.ins().redpoint1>0},e}(BaseView);__decorate([callLater],SignupPanel.prototype,"upCurState",null),__reflect(SignupPanel.prototype,"SignupPanel");var SixteenPanel=function(t){function e(){var e=t.call(this)||this;return e._curGroup=0,e.MAX=16,e.PK_GROUP_0=0,e.PK_GROUP_1=1,e.PK_GROUP_2=2,e.PK_GROUP_3=3,e.hasBed=!1,e.lastStatus=0,e.skinName="SixteenSkin",e.left=0,e.right=0,e.top=0,e.bottom=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this._linkGroupList=[],this._linkGroupList[this.PK_GROUP_0]=[],this._linkGroupList[this.PK_GROUP_1]=[],this._linkGroupList[this.PK_GROUP_2]=[],this._linkGroupList[this.PK_GROUP_3]=[],this._vsBtnList=[],this._vsBtnList[this.PK_GROUP_1]=[],this._vsBtnList[this.PK_GROUP_2]=[],this._vsBtnList[this.PK_GROUP_3]=[],this._playerLabelList=[];for(var t=1;t<=this.MAX;t++){var e=this["actState_1_"+t],i=this["actState_2_"+t],s=this["actState_3_"+t];e&&(e.name=this.PK_GROUP_1+"_"+t,e.currentState="view",this._vsBtnList[this.PK_GROUP_1].push(e),e.visible=!1),i&&(i.name=this.PK_GROUP_2+"_"+t,i.currentState="view",this._vsBtnList[this.PK_GROUP_2].push(i),i.visible=!1),s&&(s.name=this.PK_GROUP_3+"_"+t,s.currentState="view",this._vsBtnList[this.PK_GROUP_3].push(s),s.visible=!1),this["player"+(t-1)].text="---",this["player"+(t-1)].name="",this._playerLabelList.push(this["player"+(t-1)]);var n=this["link_0_"+t],o=this["link_1_"+t],a=this["link_2_"+t],r=this["link_3_"+t];n&&this._linkGroupList[this.PK_GROUP_0].push(n),o&&this._linkGroupList[this.PK_GROUP_1].push(o),a&&this._linkGroupList[this.PK_GROUP_2].push(a),r&&this._linkGroupList[this.PK_GROUP_3].push(r),this.finals.touchChildren=!1}this.groupBtnSelect0.touchEnabled=!1,this.groupBtnSelect1.touchEnabled=!1,this.groupBtnSelect2.touchEnabled=!1,this.groupBtnSelect3.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PeakedSys.ins().postState,this.upCurState),this.observe(PeakedSys.ins().postBetInfo,this.refBetState),this.observe(PeakedSys.ins().postKFBetInfo,this.refBetState),this.observe(PeakedSys.ins().postBFInfoList,this.upSixteenData),this.observe(PeakedSys.ins().postKFInfoList,this.upSixteenData),this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedpoint);for(var i=0,s=this._vsBtnList;i<s.length;i++){var n=s[i];if(n)for(var o=0,a=n;o<a.length;o++){var r=a[o];this.addTouchEvent(r,this.onTouchBtn)}}for(var h=0,l=this._playerLabelList;h<l.length;h++){var c=l[h];this.addTouchEvent(c,this.onTouchPlayer)}this.addTouchEvent(this.myRecord,this.onTouch),this.addTouchEvent(this.myBet,this.onTouch),this.addTouchEvent(this.topRank,this.onTouch),this.addTouchEvent(this.groupBtn1,this.onChargeTab),this.addTouchEvent(this.groupBtn2,this.onChargeTab),this.addTouchEvent(this.groupBtn3,this.onChargeTab),this.addTouchEvent(this.groupBtn0,this.onChargeTab),this.addTouchEvent(this.finals,this.onTouch),this.addTouchEvent(this.vewChampScore,this.onTouch),this.clearGroupSelect(),PeakedRedpoint.ins().postRedPoint(),this.upCurState()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0,s=this._vsBtnList;i<s.length;i++){var n=s[i];if(n)for(var o=0,a=n;o<a.length;o++){var r=a[o];this.removeTouchEvent(r,this.onTouchBtn)}}for(var h=0,l=this._playerLabelList;h<l.length;h++){var c=l[h];this.removeTouchEvent(c,this.onTouchPlayer)}this.removeTouchEvent(this.myRecord,this.onTouch),this.removeTouchEvent(this.myBet,this.onTouch),this.removeTouchEvent(this.topRank,this.onTouch),this.removeTouchEvent(this.groupBtn1,this.onChargeTab),this.removeTouchEvent(this.groupBtn2,this.onChargeTab),this.removeTouchEvent(this.groupBtn3,this.onChargeTab),this.removeTouchEvent(this.groupBtn0,this.onChargeTab),this.removeTouchEvent(this.finals,this.onTouch),this.removeTouchEvent(this.vewChampScore,this.onTouch),this.$onClose(),this.peakEff.stop(),DisplayUtils.removeFromParent(this.peakEff)},e.prototype.upCurState=function(){this.peakEff||(this.peakEff=new MovieClip,this.peakEff.x=83,this.peakEff.y=283,this.peakEff.touchEnabled=!1),this.peakEff.playFile(RES_DIR_EFF+"dianfengjuesai",-1),this.competion.addChild(this.peakEff),this.peakEff.visible=!0,PeakedSys.ins().isKf()?(PeakedSys.ins().isKFSixteen()?this.currentState="kf":(this.currentState="kf_four",this.peakEff.stop(),DisplayUtils.removeFromParent(this.peakEff)),this.upKf16Data()):this.currentState="bf",this.upStateData()},e.prototype.upStateData=function(){var t=0;if(PeakedSys.ins().isKf()){var e=PeakedSys.ins().kfStatus;e==KF_PeakStatus.Finals&&0!=PeakedSys.ins().kfStatusIsEnd?(this.singleTimeInfoLabel.text="",this.timerGroup.visible=!1):(PeakedSys.ins().kfStatusIsEnd&&e++,t=PeakedHelp.kfStatusTimer[e],this.singleTimeInfoLabel.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_13)+" "+PeakedData.STATE_KF_TYPE_CN[e]),PeakedSys.ins().sendKFInfoList()}else{var e=PeakedSys.ins().bfStatus;if(0==e)return;e==BF_PeakStatus.Finals&&0!=PeakedSys.ins().bfStatusIsEnd?(this.singleTimeInfoLabel.text="",this.timerGroup.visible=!1):(PeakedSys.ins().bfStatusIsEnd&&e++,t=PeakedHelp.bfStatusTimer[e],this.singleTimeInfoLabel.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_13)+" "+PeakedData.STATE_TYPE_CN[e]),PeakedSys.ins().sendBFInfoList()}if(this.timerGroup.visible)for(var i=1;5>=i;i++)this["gameTime"+i+"Txt"].text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_14),t+=GlobalConfig.PeakRaceBase.promInterval},e.prototype.refBetState=function(){var t=PeakedSys.ins().bfStatus,e=PeakedSys.ins().kfStatus,i=PeakedSys.ins().isKf();if(i?(e!=this.lastStatus&&(this.hasBed=!1),this.lastStatus=e):(t!=this.lastStatus&&(this.hasBed=!1),this.lastStatus=t),t=PeakedSys.ins().bfStatusIsEnd?t+1:t,e=PeakedSys.ins().kfStatusIsEnd?e+1:e,PeakedSys.ins().bfStatus+1!=BF_PeakStatus.Finals&&PeakedSys.ins().kfStatus+1!=KF_PeakStatus.Finals||!PeakedSys.ins().bfStatusIsEnd)this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:查看比分");else{var s=void 0;s=i?PeakedHelp.getKFPlayerData(4,1,this._curGroup,PeakedSys.ins().isKFSixteen()):PeakedHelp.getPlayerData(4,1),s&&PeakedHelp.checkIsBet(s.playerList,"4")?this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:已下注"):this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:决赛下注")}i?this.vewChampScore.visible=e>KF_PeakStatus.Prom4:this.vewChampScore.visible=t>BF_PeakStatus.Prom4;for(var n in this._vsBtnList){var o=!1;if(i)if(PeakedSys.ins().isKFSixteen()){o=n==this.PK_GROUP_1+""&&e==KF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&e==KF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&e==KF_PeakStatus.Prom4;for(var a=0,r=this._vsBtnList[n];a<r.length;a++){var h=r[a];h.visible=n==this.PK_GROUP_1+""&&e>=KF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&e>=KF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&e>=KF_PeakStatus.Prom4}}else{o=n==this.PK_GROUP_1+""&&e==KF_PeakStatus.Prom64||n==this.PK_GROUP_2+""&&e==KF_PeakStatus.Prom32;for(var l=0,c=this._vsBtnList[n];l<c.length;l++){var h=c[l];h.visible=n==this.PK_GROUP_1+""&&e>=KF_PeakStatus.Prom64||n==this.PK_GROUP_2+""&&e>=KF_PeakStatus.Prom32}}else{o=n==this.PK_GROUP_1+""&&t==BF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&t==BF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&t==BF_PeakStatus.Prom4;for(var u=0,p=this._vsBtnList[n];u<p.length;u++){var h=p[u];h.visible=n==this.PK_GROUP_1+""&&t>=BF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&t>=BF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&t>=BF_PeakStatus.Prom4}}o=i?o&&0!=PeakedSys.ins().kfStatusIsEnd:o&&0!=PeakedSys.ins().bfStatusIsEnd;for(var d=0,g=this._vsBtnList[n];d<g.length;d++){var h=g[d];if(h)if(o){var f=h.name.split("_"),s=void 0;if(s=i?PeakedHelp.getKFPlayerData(+f[0],+f[1],this._curGroup,PeakedSys.ins().isKFSixteen()):PeakedHelp.getPlayerData(+f[0],+f[1]),s&&PeakedHelp.checkIsBet(s.playerList,n)){h.currentState="beted",this.hasBed=!0;break}h.currentState="bet"}else h.currentState="view"}if(o&&this.hasBed)for(var v=0,y=this._vsBtnList[n];v<y.length;v++){var h=y[v];"bet"==h.currentState&&(h.currentState="view")}}},e.prototype.upSixteenData=function(){if(PeakedSys.ins().isKf()){if("kf_four"==this.currentState){var t=PeakedHelp.findBetKFGroup();t>-1?this._curGroup=t:this._curGroup=PeakedHelp.findKFGroupById(Actor.actorID),this._curGroup=this._curGroup<0?0:this._curGroup,this["groupBtnSelect"+this._curGroup]&&(this["groupBtnSelect"+this._curGroup].visible=!0)}this.upKf16Data()}else this.up16Data(PeakedSys.ins().player16List)},e.prototype.upKf16Data=function(){PeakedSys.ins().isKFSixteen()?this.up16Data(PeakedSys.ins().kfPlayer16List):PeakedSys.ins().kfPlayer64List&&this.up16Data(PeakedSys.ins().kfPlayer64List.slice(this._curGroup*this.MAX>>1,this._curGroup*this.MAX+this.MAX>>1))},e.prototype.up16Data=function(t){if(this.clearPlayer(),t)for(var e=0;e<this.MAX;e++)if(e%2==0){var i=t[e/2];i&&i.playerList[0]&&(this["player"+e].text=""+i.playerList[0].playerName,this["player"+e].name=i.playerList[0].playerName+"_"+i.playerList[0].roleId,i.playerList[0].roleId==Actor.actorID?this["player"+e].textColor=ColorUtil.GREEN:this["player"+e].textColor=16298305),i&&i.playerList[1]&&(this["player"+(e+1)].text=""+i.playerList[1].playerName,this["player"+(e+1)].name=i.playerList[1].playerName+"_"+i.playerList[1].roleId,i.playerList[1].roleId==Actor.actorID?this["player"+(e+1)].textColor=ColorUtil.GREEN:this["player"+(e+1)].textColor=16298305)}var s;if(PeakedSys.ins().isKf()){if(PeakedSys.ins().isKFSixteen()){var n=PeakedSys.ins().kfPlayer2Data;n&&(s=PeakedHelp.findPlayerDtById(n.winId,PeakedSys.ins().kfPlayer64List))}}else{var n=PeakedSys.ins().player2Data;n&&(s=PeakedHelp.findPlayerDtById(n.winId,PeakedSys.ins().player16List))}s?(this.championFace.source="yuanhead"+s.job+s.sex,this.championNameLabel.text=s.playerName,this.championNameLabel.name=s.playerName+"_"+s.roleId,this.competion.visible=!1,this.finals.visible=!0):(this.championFace.source="",this.championNameLabel.text="",this.championNameLabel.name="",this.competion.visible=!0,this.finals.visible=!1),this.upLink(),this.refBetState()},e.prototype.upLink=function(){this.clearLink();var t=PeakedSys.ins(),e=[];e=t.isKf()?PeakedSys.ins().isKFSixteen()?[t.kfPlayer16List,t.kfPlayer8List,t.kfPlayer4List,[t.kfPlayer2Data]]:[t.kfPlayer64List.slice(this._curGroup*this.MAX>>1,this._curGroup*this.MAX+this.MAX>>1),t.kfPlayer32List.slice(this._curGroup*this.MAX>>2,this._curGroup*this.MAX+this.MAX>>2),t.kfPlayer16List.slice(this._curGroup*this.MAX>>3,this._curGroup*this.MAX+this.MAX>>3),t.kfPlayer8List.slice(this._curGroup*this.MAX>>4,this._curGroup*this.MAX+this.MAX>>4)]:[t.player16List,t.player8List,t.player4List,[t.player2Data]];for(var i=0,s=0,n=e;s<n.length;s++){var o=n[s];if(o&&this._linkGroupList[i].length>0)for(var a=0,r=0,h=o;r<h.length;r++){var l=h[r];l&&(0==PeakedHelp.findPlayerIndexById(l.winId,l.playerList)?PeakedHelp.setImgGroupSource(this._linkGroupList[i][2*a],"line_light"):1==PeakedHelp.findPlayerIndexById(l.winId,l.playerList)&&PeakedHelp.setImgGroupSource(this._linkGroupList[i][2*a+1],"line_light"),a++)}i++}},e.prototype.onTouchPlayer=function(t){var e=t.target;if(e.name){var i=e.name.split("_");if(Actor.myName==i[0])return void ViewManager.ins().open(RoleWin);var s=PeakedHelp.findPlayerDtById(+i[1]);s?UserReadPlayer.ins().sendFindPlayer(i[1],s.serverId):UserReadPlayer.ins().sendFindPlayer(i[1])}},e.prototype.onTouchBtn=function(t){var e=t.target.parent,i=e.name,s=i.split("_");switch(e.currentState){case"view":ViewManager.ins().open(PeakViewBattleReportWin,+s[0],+s[1],this._curGroup);break;case"bet":ViewManager.ins().open(PeakBetWin,+s[0],+s[1],this._curGroup);break;case"beted":}},e.prototype.onTouch=function(t){switch(t.target){case this.finals:var e=this.championNameLabel.name.split("_");if(Actor.myName==e[0])return void ViewManager.ins().open(RoleWin);var i=PeakedHelp.findPlayerDtById(+e[1]);i?UserReadPlayer.ins().sendFindPlayer(e[1],i.serverId):UserReadPlayer.ins().sendFindPlayer(e[1]);break;case this.vewChampScore:"查看比分"==this.vewChampScore.text?ViewManager.ins().open(PeakViewBattleReportWin,4,1,this._curGroup):"决赛下注"==this.vewChampScore.text&&ViewManager.ins().open(PeakBetWin,4,1,this._curGroup);break;case this.myRecord:ViewManager.ins().open(PeakMyBattleRecordWin,this._curGroup);break;case this.myBet:ViewManager.ins().open(PeakMyBetRecordWin);break;case this.topRank:ViewManager.ins().open(PeakTopRankWin)}},e.prototype.onChargeTab=function(t){switch(this.clearGroupSelect(),t.target){case this.groupBtn0:this._curGroup=0,this.groupBtnSelect0.visible=!0,this.upKf16Data();break;case this.groupBtn1:this._curGroup=1,this.groupBtnSelect1.visible=!0,this.upKf16Data();break;case this.groupBtn2:this._curGroup=2,this.groupBtnSelect2.visible=!0,this.upKf16Data();break;case this.groupBtn3:this._curGroup=3,this.groupBtnSelect3.visible=!0,this.upKf16Data()}},e.prototype.refRedpoint=function(){this.topRankRedpoint.visible=PeakedRedpoint.ins().redpoint2>0},e.prototype.clearLink=function(){for(var t=0;t<this.MAX;t++)this._linkGroupList[this.PK_GROUP_0][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_0][t],"line_black"),this._linkGroupList[this.PK_GROUP_1][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_1][t],"line_black"),this._linkGroupList[this.PK_GROUP_2][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_2][t],"line_black"),this._linkGroupList[this.PK_GROUP_3][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_3][t],"line_black")},e.prototype.clearPlayer=function(){for(var t=1;t<=this.MAX;t++)this["player"+(t-1)].text="",this["player"+(t-1)].name=""},e.prototype.clearGroupSelect=function(){this.groupBtnSelect0.visible=!1,this.groupBtnSelect1.visible=!1,this.groupBtnSelect2.visible=!1,this.groupBtnSelect3.visible=!1},e}(BaseView);__decorate([callLater],SixteenPanel.prototype,"upStateData",null),__decorate([callLater],SixteenPanel.prototype,"upKf16Data",null),__reflect(SixteenPanel.prototype,"SixteenPanel");var PeakBetWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="BetSkin",e.numLabel.restrict="0-9",e.numLabel.maxChars=8,e.arrow0.visible=!1,e.arrow1.visible=!1,e.aPlayerGroup=e.face0.parent,e.aPlayerGroup.touchChildren=!1,e.bPlayerGroup=e.face1.parent,e.bPlayerGroup.touchChildren=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.tipGroup,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.betBtn,this.onTouch),this.addTouchEvent(this.maxBtn,this.onTouch),this.addTouchEvent(this.aPlayerGroup,this.onTouch),this.addTouchEvent(this.bPlayerGroup,this.onTouch),this.addChangeEvent(this.numLabel,this.changeInput);var i=t[0],s=t[1],n=PeakedSys.ins().isKFSixteen(),o=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(i,s,t[2],n):PeakedHelp.getPlayerData(i,s);if(o){var a=o.playerList[0];this.face0.source=a?"yuanhead"+a.job+a.sex:"",this.name0.text=a?a.playerName:"---",this.select0.name=a?a.roleId+"":"";var r=o.playerList[1];this.face1.source=r?"yuanhead"+r.job+r.sex:"",this.name1.text=r?r.playerName:"---",this.select1.name=r?r.roleId+"":""}this.select0.visible=this.select1.visible=!1;var h=Actor.chip,l=PeakedSys.ins().isKf()?GlobalConfig.PeakRaceCrossTime[PeakedSys.ins().kfStatus+1].maxBett:GlobalConfig.PeakRaceTime[PeakedSys.ins().bfStatus+1].maxBett;this._maxNum=h>l?l:h,this.changeInput(null)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.tipGroup,this.onTouch),this.removeTouchEvent(this.bgClose,this.onTouch),this.removeTouchEvent(this.betBtn,this.onTouch),this.removeTouchEvent(this.maxBtn,this.onTouch),this.addChangingEvent(this.numLabel,this.changeInput)
},e.prototype.changeInput=function(t){var e=parseInt(this.numLabel.text);null==t&&(e=this._maxNum),0>e?e=0:e>this._maxNum&&(e=this._maxNum),this.numLabel.text=e+""},e.prototype.onTouch=function(t){switch(t.target){case this.tipGroup:case this.bgClose:ViewManager.ins().close(this);break;case this.betBtn:var e=parseInt(this.numLabel.text);if(this._curId){if(0>=e)return void UserTips.ins().showTips("筹码不够");PeakedSys.ins().isKf()?PeakedSys.ins().sendKFBet(this._curId,e):PeakedSys.ins().sendBet(this._curId,e)}else UserTips.ins().showTips("请先选择需要下注的玩家");break;case this.maxBtn:this.changeInput(null);break;case this.aPlayerGroup:this.select0.name&&(this.select0.visible=!0,this.select1.visible=!1,this.arrow0.visible=!0,this.arrow1.visible=!1,this._curId=parseInt(this.select0.name));break;case this.bPlayerGroup:this.select1.name&&(this.select1.visible=!0,this.select0.visible=!1,this.arrow0.visible=!1,this.arrow1.visible=!0,this._curId=parseInt(this.select1.name))}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=PeakedSys.ins().isKFSixteen(),o=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(i,s,t[2],n):PeakedHelp.getPlayerData(i,s);return o&&o.playerList.length>1?!0:o&&1==o.playerList.length?(UserTips.ins().showTips("人数不足，无法下注！"),!1):(UserTips.ins().showTips("本轮轮空,无法下注！"),!1)},e}(BaseEuiView);__reflect(PeakBetWin.prototype,"PeakBetWin"),ViewManager.ins().reg(PeakBetWin,LayerManager.UI_Popup);var PeakMyBattleRecordWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){this.skinName="MyRecordSkin",this.list.itemRenderer=PeakMyBattleRecordItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose),this.addTouchEvent(this.tipGroup,this.onClose),this.addTouchEvent(this.list,this.onTouchList);var i=[];PeakedSys.ins();PeakedSys.ins().isKf()?(i=PeakedSys.ins().myKFBattleReportList,i=PeakedHelp.countKFMyRecordData()):i=PeakedSys.ins().myBattleReportList,this.list.dataProvider=new eui.ArrayCollection(i),DisplayUtils.scrollerToBottom(this.scrollerList)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.onTouchList=function(t){if(t.target instanceof eui.Label&&t.target.parent instanceof PeakMyBattleRecordItemRender){var e=t.target.parent.data;e&&UserReadPlayer.ins().sendFindPlayer(e.roleId)}},e}(BaseEuiView);__reflect(PeakMyBattleRecordWin.prototype,"PeakMyBattleRecordWin"),ViewManager.ins().reg(PeakMyBattleRecordWin,LayerManager.UI_Popup);var PeakMyBetRecordWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){this.skinName="MyBetRecordSkin",this.list.itemRenderer=PeakMyBetItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose),this.addTouchEvent(this.tipGroup,this.onClose),this.observe(PeakedSys.ins().postKFBetInfo,this.updata),this.updata()},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.updata=function(){var t=[],e=0,i=0,s=PeakedSys.ins().isKf()?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo;if(s)for(var n=0,o=s;n<o.length;n++){var a=o[n];e+=a.batNum,t.push(a),PeakedHelp.statusIsOver(a.status,PeakedSys.ins().isKf())&&(PeakedHelp.checkIsWinById(a.playerId,a.status)?i+=a.batNum:i-=a.batNum)}var r=i>0?"，|C:"+ColorUtil.GREEN+"&T:获利："+i+"|":"|C:"+ColorUtil.RED+"&T:损失："+-i+"筹码|";0==i&&(r="");var h="你已经下注"+t.length+"场比赛，下注总额: |C:"+ColorUtil.GREEN+"&T:"+e+"|筹码"+r;this.infoLabel.textFlow=TextFlowMaker.generateTextFlow1(h),t.sort(PeakedHelp.sortBetFun),this.list.dataProvider=new eui.ArrayCollection(t),DisplayUtils.scrollerToBottom(this.scrollerList)},e}(BaseEuiView);__reflect(PeakMyBetRecordWin.prototype,"PeakMyBetRecordWin"),ViewManager.ins().reg(PeakMyBetRecordWin,LayerManager.UI_Popup);var PeakTopRankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SupportRankSkin",e}return __extends(e,t),e.prototype.initUI=function(){this.list.itemRenderer=PeakTopRankItemRender,this._listDt=new eui.ArrayCollection,this.list.dataProvider=this._listDt},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PeakedSys.ins().postSignUp,this.onSingUp),this.observe(PeakedSys.ins().postTopRank,this.upList),this.observe(PeakedSys.ins().postKFTopRank,this.upList),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.tipGroup,this.onTouch),this.addTouchEvent(this.list,this.onTouch),this.onSingUp()},e.prototype.onSingUp=function(){PeakedSys.ins().isKf()?PeakedSys.ins().sendKFTopRank():PeakedSys.ins().sendTopRank()},e.prototype.upList=function(){PeakedSys.ins().isKf()?this._listDt.replaceAll(PeakedSys.ins().kfTopRankInfoList):this._listDt.replaceAll(PeakedSys.ins().topRankInfoList)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.tipGroup:ViewManager.ins().close(this);break;default:if(t.target.parent instanceof PeakTopRankItemRender){var e=t.target.parent.data;t.target instanceof eui.Button?PeakedSys.ins().isKf()?PeakedSys.ins().sendKFToLikes(e.playerId):PeakedSys.ins().sendToLikes(e.playerId):t.target instanceof eui.Label&&UserReadPlayer.ins().sendFindPlayer(e.playerId,e.servId)}}},e}(BaseEuiView);__reflect(PeakTopRankWin.prototype,"PeakTopRankWin"),ViewManager.ins().reg(PeakTopRankWin,LayerManager.UI_Popup);var PeakViewBattleReportWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){this.skinName="WarReportSkin",this.list.itemRenderer=PeakViewBattleReportItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose);var i=t[0],s=t[1],n=PeakedSys.ins().isKFSixteen(),o=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(i,s,t[2],n):PeakedHelp.getPlayerData(i,s),a=[],r=0,h=0,l=GlobalConfig.PeakRaceBase.promWin;if(l||(l=3),o)if(0==o.playerList.length)this.AnameTxt.text="无选手",this.BnameTxt.text="无选手";else{o.playerList[0]&&(this.AnameTxt.text=o.playerList[0].playerName),o.playerList[1]?this.BnameTxt.text=o.playerList[1].playerName:this.BnameTxt.text="轮空";for(var c=PeakedHelp.statusIsOverByGroup(i),u=0;5>u;u++){var p=void 0;if(o.reportList[u])p={},p.winer=PeakedHelp.findPlayerDtById(o.reportList[u]).playerName,p.round=u+1,o.reportList[u]==o.playerList[0].roleId?r++:h++;else if(c)continue;if(a[u]=p,r>=l||h>=l)break}}else this.AnameTxt.text="无选手",this.BnameTxt.text="无选手";o&&0==o.reportList.length&&!o.playerList[1]&&(r=l),this.score.text=r+"."+h,this.list.dataProvider=new eui.ArrayCollection(a)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PeakViewBattleReportWin.prototype,"PeakViewBattleReportWin"),ViewManager.ins().reg(PeakViewBattleReportWin,LayerManager.UI_Popup);var WorshipChampionPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.praiseGroup0.touchChildren=!1,this.praiseGroup1.touchChildren=!1,this.praiseGroup2.touchChildren=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Actor.ins().postChip,this.upData),this.observe(PeakedSys.ins().postWorship,this.upData),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.addTouchEvent(this.shipBtn,this.onTouch),this.addTouchEvent(this.praiseGroup0,this.onTouch),this.addTouchEvent(this.praiseGroup1,this.onTouch),this.addTouchEvent(this.praiseGroup2,this.onTouch),this.isEff=!1,this.initData(),this.upData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._openOtherWin=!1,this.titleMc&&(this.titleMc.destroy(),this.titleMc=null),this.$onClose(),TimerManager.ins().removeAll(this),DisplayUtils.removeFromParent(this.weaponEff0),DisplayUtils.removeFromParent(this.weaponEff1),DisplayUtils.removeFromParent(this.weaponEff2),DisplayUtils.removeFromParent(this.bodyEff0),DisplayUtils.removeFromParent(this.bodyEff1),DisplayUtils.removeFromParent(this.bodyEff2),this.yanHuaMc&&(this.yanHuaMc.destroy(),this.yanHuaMc=null)},e.prototype.initData=function(){if(PeakedSys.ins().kfPlayer2Data&&PeakedSys.ins().kfPlayer2Data.winId&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd){var t=PeakedHelp.findPlayerDtById(PeakedSys.ins().kfPlayer2Data.winId);t&&UserReadPlayer.ins().sendFindPlayer(t.roleId,t.serverId),this.shipBtn.enabled=!0,this.chipLabel.visible=!0,this.countLabel.visible=!0}else this.shipBtn.enabled=!1,this.chipLabel.visible=!1,this.countLabel.visible=!1;for(var e=0;3>e;e++)this["praiseGroup"+e].visible=!1;this.name0.text="暂无",this.chipLabel.text="筹码：+"+GlobalConfig.PeakRaceBase.mobaiChips,this.titleMc||(this.titleMc=ObjectPool.pop("MovieClip"),this.titleMc.x=this.titleMcGroup.x,this.titleMc.y=this.titleMcGroup.y),this.titleGroup.addChild(this.titleMc);var i=RES_DIR_EFF+"chenghao1qiang";this.titleMc.playFile(i,-1)},e.prototype.upData=function(){var t=GlobalConfig.PeakRaceBase;t.mobaiNum||(t.mobaiNum=10);var e=PeakedSys.ins().worshipNum<t.mobaiNum?ColorUtil.GREEN_COLOR_N:ColorUtil.RED,i="膜拜：|C:"+e+"&T:"+PeakedSys.ins().worshipNum+"/"+t.mobaiNum;this.countLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.isEff&&this.playYHEff()},e.prototype.playYHEff=function(){this.yanHuaMc&&(this.yanHuaMc.destroy(),this.yanHuaMc=null),this.yanHuaMc=new MovieClip,this.yanHuaMc.x=270,this.yanHuaMc.y=335,this.addChildAt(this.yanHuaMc,this.numChildren+1),this.yanHuaMc.playFile(RES_DIR_EFF+"yanhuaeff",2),this.isEff=!1},e.prototype.onTouch=function(t){switch(t.target){case this.shipBtn:if(PeakedSys.ins().worshipNum>=GlobalConfig.PeakRaceBase.mobaiNum)return void UserTips.ins().showTips("今日膜拜次数已用完！");if(!PeakedSys.ins().kfPlayer2Data.winId)return void UserTips.ins().showTips("当前没有可膜拜的冠军！");this.isEff=!0,PeakedSys.ins().sendWorship();break;case this.praiseGroup0:case this.praiseGroup1:case this.praiseGroup2:var e=PeakedHelp.findPlayerDtById(PeakedSys.ins().kfPlayer2Data.winId);e&&UserReadPlayer.ins().sendFindPlayer(e.roleId,e.serverId)}},e.prototype.openOtherPlayerView=function(t){if(this.otherPlayerData=t,this._openOtherWin){var e=ViewManager.ins().open(RRoleWin,t);e.hideEx(1),this._openOtherWin=!1}else{this.startShowZhanling(),this._openOtherWin=!0;for(var i=0;i<t.roleData.length;i++){this["praiseGroup"+i].visible=!0;var s=t.roleData[i],n=s.zhuangbei,o=void 0,a=n[0],r=n[1],h=s.getEquipByIndex(0),l=h.item.configID,c=s.getEquipByIndex(2),u=c.item.configID;if(this["weaponImg"+i].source=null,this["bodyImg"+i].source=null,this["name"+i].text="S."+t.serverId+t.name,l>0){var p=GlobalConfig.EquipConfig[l].appearance;p&&p.indexOf("[job]")>-1&&(p=p.replace("[job]",s.job+"")),this["weaponImg"+i].source=p+"_"+s.sex+"_c_png"}if(u>0){var p=GlobalConfig.EquipConfig[u].appearance;p&&p.indexOf("[job]")>-1&&(p=p.replace("[job]",s.job+"")),this["bodyImg"+i].source=p+"_"+s.sex+"_c_png",o=!0}o||(this["bodyImg"+i].source="body000_"+s.sex+"_c_png"),r>0&&(this["weaponImg"+i].source=this.getZhuangbanById(r).res+"_"+s.sex+"_c_png"),a>0&&(this["bodyImg"+i].source=this.getZhuangbanById(a).res+"_"+s.sex+"_c_png"),this["wingImg"+i].source=null;var d=s.wingsData,g=n[2];g>0?this["wingImg"+i].source=GlobalConfig.ZhuangBanId[g].res+"_png":d.openStatus&&(this["wingImg"+i].source=GlobalConfig.WingLevelConfig[d.lv].appearance+"_png"),this.setEffect(s.getEquipByIndex(2).item.configID,"bPos"+i+"_",s.sex,this["bodyEffect"+i],this["bodyEff"+i]),this.setEffect(s.getEquipByIndex(0).item.configID,"wPos"+i+"_",s.sex,this["weaponEffect"+i],this["weaponEff"+i])}}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.setEffect=function(t,e,i,s,n){n||(n=new MovieClip);var o=GlobalConfig.EquipWithEffConfig[t+"_"+i];o?(n.scaleX=n.scaleY=o.scaling,n.parent||s.addChild(n),n.x=this[e+i].x+o.offX,n.y=this[e+i].y+o.offY,n.playFile(RES_DIR_EFF+o.inShowEff,-1)):n.parent&&n.parent.removeChild(n)},e.prototype.showZhanling=function(t){var e=t.zhanlingID,i=t.zhanlingLevel;if(!(0>i)){var s=GlobalConfig.ZhanLingLevel[e][i];this.warfileName=s.appearance,this.warMc||(this.warMc=new MovieClip,this.warMc.x=450,this.warMc.y=220,this.praiseGroup0.addChildAt(this.warMc,0),this.warMc.playFile(RES_DIR_MONSTER+this.warfileName+"_4s",-1),this.warMc.touchEnabled=!1);var n=GlobalConfig.ZhanLingConfig.anchorOffset||[];this.warMc.anchorOffsetX=n[0]||0,this.warMc.anchorOffsetY=n[1]||0,TimerManager.ins().remove(this.startShowZhanling,this),TimerManager.ins().doTimer(200,1,this.playZhanLingAttack,this)}},e.prototype.playZhanLingAttack=function(){var t=this;if(this.warMc){var e=RES_DIR_MONSTER+this.warfileName+"_4"+EntityAction.ATTACK;this.warMc.playFile(e,1,function(){var e=RES_DIR_MONSTER+t.warfileName+"_4"+EntityAction.STAND;t.warMc.playFile(e,-1,null,!1),TimerManager.ins().remove(t.playZhanLingAttack,t),TimerManager.ins().doTimer(2800,1,t.hideZhanling,t)},!1)}},e.prototype.hideZhanling=function(){var t=this;this.warMc&&egret.Tween.get(this.warMc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){DisplayUtils.removeFromParent(t.warMc),t.warMc.destroy(),t.warMc=null,TimerManager.ins().remove(t.hideZhanling,t),TimerManager.ins().doTimer(7e3,1,t.startShowZhanling,t)})},e.prototype.startShowZhanling=function(){this.showZhanling(this.otherPlayerData)},e}(BaseView);__reflect(WorshipChampionPanel.prototype,"WorshipChampionPanel");var CollectWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="CollectSkin",e.progressBar.labelFunction=function(t,e){return""},e}return __extends(e,t),e.prototype.childrenCreated=function(){this.progressBar.value=0,this.progressBar.visible=!1,this.bgmc=new MovieClip,this.bgmc.playFile(RES_DIR_EFF+"jindutiaoeff1",-1),this.bgmc.scaleY=2,this.bgmc.scaleX=1.25,this.effGroup.width=260,this.effGroup.height=50,this.effGroup.scrollEnabled=!0,this.effGroup.addChild(this.bgmc)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.state.text=Actor.myName+" 正在采集中...",Tween.removeTweens(this.effGroup),this.effGroup.width=0,Tween.get(this.effGroup).to({width:260},1e3*t[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Tween.removeTweens(this.effGroup)},e}(BaseEuiView);__reflect(CollectWin.prototype,"CollectWin"),ViewManager.ins().reg(CollectWin,LayerManager.UI_Popup);var ReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e.skinName="ReliveSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.remainM=t[0];var i=t[1];i&&(this.killTips.textFlow=(new egret.HtmlTextParser).parser("你被"+StringUtils.addColor(""+i,"#23C42A")+"击败")),this.reliveTimesTxt.text=this.remainM+"秒",TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒",this.remainM<=0&&this.overTime()},e.prototype.overTime=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ReliveWin.prototype,"ReliveWin"),ViewManager.ins().reg(ReliveWin,LayerManager.UI_Popup);var ServerSwitchIngWin=function(t){function e(){var e=t.call(this)||this;return e.symbolStrs=[".","..","..."],e._tick=0,e.skinName="KFSwitchServerSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this._tick=0,TimerManager.ins().doTimer(500,0,function(){t._tick++,t.switchLabel.text="服务器切换中"+t.symbolStrs[t._tick%3]},this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this)},e}(BaseEuiView);__reflect(ServerSwitchIngWin.prototype,"ServerSwitchIngWin"),ViewManager.ins().reg(ServerSwitchIngWin,LayerManager.UI_Popup);var SmallMapPanel=function(t){function e(e,i){void 0===e&&(e=200);var s=t.call(this)||this;return s._fixedMaxNum=0,s._limit_width=200,s._limit_height=0,s.R_Scale=.58,s.MOVE_DELAY=300,s.flagRes=["wj_gray_flag_icon","wj_green_flag_icon","wj_red_flag_icon"],s.entityRes=["wj_green_point","wj_blue_point"],e&&(s._limit_width=e),i&&(s._limit_height=i),s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.signList=[],this.initUI()},e.prototype.onMapComplete=function(t){this._limit_width?this.R_Scale=this._limit_width/this.mapBg.width:this._limit_height&&(this.R_Scale=this._limit_height/this.mapBg.height),this.mapBg.width*=this.R_Scale,this.mapBg.height*=this.R_Scale,this.frameImg.width=this.mapBg.width,this.frameImg.height=this.mapBg.height,this.initFixedP()},e.prototype.open=function(t){this._curSceneType=t,this.observe(GameLogic.ins().postCreateOtherEntity,this.calcPlayMainEntityList),this.observe(WJBattlefieldSys.ins().postRefCampFlag,this.refreshFixedP),this.calcPlayMainEntityList(),this.refreshCoordinate(),this.refreshFixedP(),TimerManager.ins().doTimer(this.MOVE_DELAY,0,this.refreshCoordinate,this)},e.prototype.close=function(){this.removeObserve(),this.signList=[],TimerManager.ins().remove(this.refreshCoordinate,this)},e.prototype.initUI=function(){switch(this._fixedList=[],this._curSceneType){case SmallSceneType.WJBattle:this._fixedMaxNum=3;for(var t=0;t<this._fixedMaxNum;t++){this._fixedList[t]=new eui.Image,this._fixedList[t].source=this.flagRes[0],this._fixedList[t].anchorOffsetX=this._fixedList[t].width>>1,this._fixedList[t].anchorOffsetY=this._fixedList[t].height;var e=GlobalConfig.WujiBaseConfig.flagPoint[t];this._fixedList[t].x=e.x*GameMap.CELL_SIZE/10*this.R_Scale,this._fixedList[t].y=e.y*GameMap.CELL_SIZE/10*this.R_Scale,this.addChild(this._fixedList[t])}}this.mapBg=new eui.Image,this.mapBg.source="map/"+GameMap.getFileName()+"/small.jpg",this.mapBg.addEventListener(egret.Event.COMPLETE,this.onMapComplete,this),this.addChildAt(this.mapBg,0)},e.prototype.initFixedP=function(){switch(this._curSceneType){case SmallSceneType.WJBattle:for(var t=0;t<this._fixedMaxNum;t++){var e=GlobalConfig.WujiBaseConfig.flagPoint[t];this._fixedList[t].x=e.x*GameMap.CELL_SIZE/10*this.R_Scale,this._fixedList[t].y=e.y*GameMap.CELL_SIZE/10*this.R_Scale}}},e.prototype.refreshFixedP=function(){switch(this._curSceneType){case SmallSceneType.WJBattle:for(var t=0;t<this._fixedMaxNum;t++)WJBattlefieldSys.ins().flagInfos[t+1]?this._fixedList[t].source=100==WJBattlefieldSys.ins().flagInfos[t+1]?this.flagRes[1]:this.flagRes[2]:this._fixedList[t].source=this.flagRes[0]}},e.prototype.refreshCoordinate=function(){},e.prototype.calcPlayMainEntityList=function(){var t={},e={},i=EntityManager.ins().getAllEntity();for(var s in i){var n=i[s];if(n&&n.infoModel){if(n.infoModel.type!=EntityType.Role)continue;var o=n.infoModel;e[o.name]||(e[o.name]=[]),e[o.name].push(n)}}for(var a in e){var r=e[a];r.sort(function(t,e){return t.infoModel.job<e.infoModel.job?-1:t.infoModel.job>e.infoModel.job?1:0});var h=r[0];t[h.infoModel.handle]=h}return this._entityList=t,t},e}(BaseView);__reflect(SmallMapPanel.prototype,"SmallMapPanel");var SmallSceneType;!function(t){t[t.WJBattle=0]="WJBattle"}(SmallSceneType||(SmallSceneType={}));var WJBattleData=function(){function t(){this.isFirstKiller=0,this.isMVP=0,this.isResult=!1}return t.prototype.readResultData=function(t){this.servId=t.readInt(),this.playerName=t.readString(),this.camp=t.readInt(),this.killNum=t.readInt(),this.killedNum=t.readInt(),this.assistsNum=t.readInt(),this.collectFlagNum=t.readInt(),this.isFirstKiller=t.readByte(),this.isMVP=t.readByte()},t.prototype.readViewData=function(t){this.servId=t.readInt(),this.playerName=t.readString(),this.camp=t.readInt(),this.killNum=t.readInt(),this.killedNum=t.readInt(),this.assistsNum=t.readInt(),this.collectFlagNum=t.readInt(),this.isFirstKiller=t.readByte()},t.prototype.readMyData=function(t){this.killNum=t.readInt(),this.killedNum=t.readInt(),this.assistsNum=t.readInt(),this.collectFlagNum=t.readInt()},t}();__reflect(WJBattleData.prototype,"WJBattleData");var WJCampType;!function(t){t[t.ME=100]="ME",t[t.ENEMY=200]="ENEMY"}(WJCampType||(WJCampType={}));var WJBattleChatItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.msg.text=this.data},e}(BaseItemRender);__reflect(WJBattleChatItem.prototype,"WJBattleChatItem");var WJBattleDataItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof WJBattleData){var t=this.data;t.isResult?this.currentState="result":this.currentState="data",this.nickLabel.text=t.playerName,this.numLabel.text=t.killNum+"/"+t.killedNum+"/"+t.assistsNum,this.collectFlagLabel.text=t.collectFlagNum+"",this.firstKillImg.visible=t.isFirstKiller>0,this.mvpImg.visible=t.isMVP>0,this.mvpImg.source=t.camp==WJBattlefieldSys.ins().myCampId?"wj_mvp_green":"wj_mvp_red",this.honorLabel.text="",this.bg.source=t.camp==WJBattlefieldSys.ins().myCampId?"wj_data_item_bg2":"wj_data_item_bg1"}},e}(BaseItemRender);__reflect(WJBattleDataItem.prototype,"WJBattleDataItem");var WJBattleNoticeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.txtLabel.text=this.data},e}(BaseItemRender);__reflect(WJBattleNoticeItem.prototype,"WJBattleNoticeItem");var WJBattleSChatItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.msg.text=this.data},e}(BaseItemRender);__reflect(WJBattleSChatItem.prototype,"WJBattleSChatItem");var WJBattlefieldTrusteeshipAi=function(t){function e(){var e=t.call(this)||this;return e.AI_INTERVAL=1e3,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.startAi=function(){WJBattlefieldSys.ins().isWJBattle&&(MessageCenter.addListener(MapView.moveComplete,this.moveEnd,this),TimerManager.ins().doTimer(this.AI_INTERVAL,0,this.runLogic,this),this.state=TrusteeshipAiState.Normal)},e.prototype.closeAi=function(){MessageCenter.ins().removeAll(this),TimerManager.ins().remove(this.runLogic,this);var t=EntityManager.ins().getNoDieRole();t.stopMove(),t.playAction(EntityAction.STAND)},e.prototype.runLogic=function(){var t=EntityManager.ins().getNoDieRole();if(t.AI_STATE==AI_State.Stand)switch(this.state){case TrusteeshipAiState.Normal:var e=this.findCanCollectFlag();if(e)if(this.checkCanCollectByDis(e)){this.state=TrusteeshipAiState.Collect;for(var i=0;3>i;i++){var s=WJBattlefieldSys.ins().flagInfos[i+1];if(!s||s!=WJBattlefieldSys.ins().myCampId){var n=this.findNearFlag();n&&GameLogic.ins().postChangeAttrPoint(n);break}}}else GameMap.moveTo(e.x,e.y);else{var o=this.findCampFlag();GameMap.moveTo(o.x,o.y)}break;case TrusteeshipAiState.Collect:break;case TrusteeshipAiState.Attack:var a=this.checkNearbyEnemy();a&&a.infoModel?GameLogic.ins().postChangeAttrPoint(a.infoModel.handle):this.state=TrusteeshipAiState.Normal}},e.prototype.moveEnd=function(t){if(t.team==Team.My){var e=this.findCanCollectFlag();e?this.state=TrusteeshipAiState.Collect:this.state=TrusteeshipAiState.Attack}},e.prototype.findCanCollectFlag=function(){for(var t=[],e=3,i=EntityManager.ins().getNoDieRole(),s=0;e>s;s++){var n={};n.distance=MathUtils.getDistance(i.x,i.y,n.x,n.y),t.push(n)}var o=function(t,e){return t.distance>e.distance?1:t.distance<e.distance?-1:0};return t.sort(o),t.length?t[0]:null},e.prototype.findCampFlag=function(){for(var t=[],e=3,i=(EntityManager.ins().getNoDieRole(),0);e>i;i++){var s={};t.push(s)}return t.length?t[MathUtils.limit(0,t.length-1)]:null},e.prototype.findNearFlag=function(){var t=[],e=EntityManager.ins().getNoDieRole();if(!e)return 0;for(var i=0,s=WJBattlefieldSys.ins().flagHandle;i<s.length;i++){var n=s[i],o=WJBattlefieldSys.ins().flagHandle[n],a=EntityManager.ins().getEntityByHandle(o);if(a&&a.infoModel){if(WJBattlefieldSys.ins().flagInfos[n]&&WJBattlefieldSys.ins().flagInfos[n]==WJBattlefieldSys.ins().myCampId)continue;var r=MathUtils.getDistance(a.x,a.y,e.x,e.y);t[WJBattlefieldSys.ins().flagHandle.indexOf(o)]=r}}return t.sort(Algorithm.sortAsc),t[1]?WJBattlefieldSys.ins().flagHandle[t[1]]:0},e.prototype.checkNearbyEnemy=function(){for(var t=EntityManager.ins().getNoDieRole(),e=6,i=EntityManager.ins().screeningTargetByPos(t,!1,4,e),s=i.length-1;s>-1;s--)i[s]&&i[s].infoModel&&i[s].infoModel.camp==WJBattlefieldSys.ins().myCampId&&i.splice(s,1);return i.length?i[MathUtils.limit(0,i.length-1)]:null},e.prototype.checkCanCollectByDis=function(t){var e=EntityManager.ins().getNoDieRole(),i=MathUtils.getDistance(e.x,e.y,t.x,t.y);return 50>=i},e}(BaseClass);__reflect(WJBattlefieldTrusteeshipAi.prototype,"WJBattlefieldTrusteeshipAi");var TrusteeshipAiState;!function(t){t[t.Normal=0]="Normal",t[t.Collect=1]="Collect",t[t.Attack=2]="Attack"}(TrusteeshipAiState||(TrusteeshipAiState={}));var WJBattlefieldDataWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WJBattleDataSkin",e.currentState="data",e}return __extends(e,t),e.prototype.initUI=function(){this.myList.itemRenderer=WJBattleDataItem,this._myScore=BitmapNumber.ins().createNumPic(0,"1",5),this._myScore.x=95,this._myScore.y=100,this.group.addChild(this._myScore),this._enemyScore=BitmapNumber.ins().createNumPic(0,"1",5),this._enemyScore.x=300,this._enemyScore.y=100,this.group.addChild(this._enemyScore)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch);var i=t[0],s=t[1];this.myList.dataProvider=new eui.ArrayCollection(i),this.enemyList.dataProvider=new eui.ArrayCollection(s),BitmapNumber.ins().changeNum(this._myScore,WJBattlefieldSys.ins().campAScores,"1",5),BitmapNumber.ins().changeNum(this._enemyScore,WJBattlefieldSys.ins().campBScores,"1",5)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];WatcherUtil.removeFromArrayCollection(this.myList.dataProvider),this.myList.dataProvider=null,WatcherUtil.removeFromArrayCollection(this.enemyList.dataProvider),this.enemyList.dataProvider=null},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WJBattlefieldDataWin.prototype,"WJBattlefieldDataWin"),ViewManager.ins().reg(WJBattlefieldDataWin,LayerManager.UI_Popup);var WJBattlefieldMainUI=function(t){function e(){var e=t.call(this)||this;return e.flagRes=["wj_gray_flag","wj_green_flag","wj_red_flag"],e.skinName="WJBattleMainUISkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sChatBtn,this.onTouch),this.addTouchEvent(this.flag1,this.onTouch),this.addTouchEvent(this.flag2,this.onTouch),this.addTouchEvent(this.flag3,this.onTouch),this.addTouchEvent(this.sChatList,this.sendChat),this.addTouchEvent(this.viewArea,this.onTouch),this.observe(WJBattlefieldSys.ins().postChatInfo,this.pushChatInfo),this.observe(WJBattlefieldSys.ins().postMyData,this.upMydata),this.observe(WJBattlefieldSys.ins().postRefCampScores,this.refScores),this.observe(WJBattlefieldSys.ins().postRefCampFlag,this.refFlag),this.minMap.open(SmallSceneType.WJBattle),this.startActTime(),this.upMydata(),this.refScores(),this.refFlag(),ViewManager.ins().isShow(UIView2)&&ViewManager.ins().getView(UIView2).isHideNavBtn(!1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.minMap.close(),ViewManager.ins().close(TargetListPanel),TimerManager.ins().removeAll(this),ViewManager.ins().isShow(UIView2)&&ViewManager.ins().getView(UIView2).isHideNavBtn(!0)},e.prototype.initUI=function(){this.sChatList.itemRenderer=WJBattleSChatItem,this.chatList.itemRenderer=WJBattleChatItem,this.minMap=new SmallMapPanel,this.smallMapGroup.addChild(this.minMap),this._sChatData=new eui.ArrayCollection,this.sChatList.dataProvider=this._sChatData,this._chatData=new eui.ArrayCollection,this.chatList.dataProvider=this._chatData,this.winTermLabel.text="积分率先达到"+GlobalConfig.WujiBaseConfig.winScore+"获胜",this._sChatData.replaceAll(GlobalConfig.WujiBaseConfig.quickChat),this.myScoreBar.maximum=GlobalConfig.WujiBaseConfig.winScore,this.enemyScoreBar.maximum=GlobalConfig.WujiBaseConfig.winScore},e.prototype.upMydata=function(t){this.killTxt.text=t?t.killNum+"":"0",this.deadTxt.text=t?t.killedNum+"":"0",this.collectTxt.text=t?t.collectFlagNum+"":"0",this.assistsTxt.text=t?t.assistsNum+"":"0"},e.prototype.refScores=function(){this.myScoreLabel.text=WJBattlefieldSys.ins().campAScores+"",this.enemyScoreLabel.text=WJBattlefieldSys.ins().campBScores+"",this.myScoreBar.value=WJBattlefieldSys.ins().campAScores,this.enemyScoreBar.value=WJBattlefieldSys.ins().campBScores},e.prototype.refFlag=function(){for(var t=0;3>t;t++){var e=WJBattlefieldSys.ins().flagInfos[t];e?this["flag"+(t+1)].icon=e==WJBattlefieldSys.ins().myCampId?this.flagRes[1]:this.flagRes[2]:this["flag"+(t+1)].icon=this.flagRes[0]}},e.prototype.onTouch=function(t){switch(t.target){case this.sChatBtn:this.sChatGroup.visible=!this.sChatGroup.visible;break;case this.flag1:GameLogic.ins().postChangeAttrPoint(WJBattlefieldSys.ins().flagHandle[1]);break;case this.flag2:GameLogic.ins().postChangeAttrPoint(WJBattlefieldSys.ins().flagHandle[2]);break;case this.flag3:GameLogic.ins().postChangeAttrPoint(WJBattlefieldSys.ins().flagHandle[3]);break;case this.viewArea:WJBattlefieldSys.ins().sendViewDataInfo()}},e.prototype.sendChat=function(t){if(t.target instanceof WJBattleSChatItem){var e=t.target;e.bg.scaleX=e.bg.scaleY=.9,WJBattlefieldSys.ins().sendChatInfo(t.target.data),this.sChatGroup.visible=!1}},e.prototype.startActTime=function(){TimerManager.ins().doTimer(1e3,0,this.onTick,this)},e.prototype.onTick=function(){var t=WJBattlefieldSys.ins().getEndTime();this.overTimerLabel.text=DateUtils.getFormatBySecond(t)},e.prototype.pushChatInfo=function(t){this._chatData.addItem(t),this._chatData.length>3&&this._chatData.removeItemAt(0)},e}(BaseEuiView);__reflect(WJBattlefieldMainUI.prototype,"WJBattlefieldMainUI"),ViewManager.ins().reg(WJBattlefieldMainUI,LayerManager.UI_Popup);var WJBattlefieldMatchPanel=function(t){function e(){var e=t.call(this)||this;return e.matchTick=0,e.matchingStrs=[".","..","..."],e.skinName="WJBattleMatchSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.cancelBtn,this.onTouch),this.addTouchEvent(this.minBtn,this.onTouch),this.startMatch()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this)},e.prototype.miniUI=function(){ViewManager.ins().close(this),WJBattlefieldSys.ins().matchingTime=this.matchTick-egret.getTimer()/1e3},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.cancelBtn:WJBattlefieldSys.ins().sendCancelMatch();break;case this.minBtn:this.miniUI()}},e.prototype.startMatch=function(){var t=this;this.matchTick=WJBattlefieldSys.ins().getMatchingTime(),this.overTimersLabel.text=DateUtils.getFormatBySecond(this.matchTick>>1),TimerManager.ins().doTimer(500,0,function(){t.matchTick++,t.matchLabel.text="匹配中"+t.matchingStrs[t.matchTick%3],t.overTimersLabel.text=DateUtils.getFormatBySecond(t.matchTick>>1)},this)},e}(BaseEuiView);__reflect(WJBattlefieldMatchPanel.prototype,"WJBattlefieldMatchPanel"),ViewManager.ins().reg(WJBattlefieldMatchPanel,LayerManager.UI_Popup);var WJBattlefieldResultWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WJBattleDataSkin",e.currentState="result",e}return __extends(e,t),e.prototype.initUI=function(){this.myList.itemRenderer=WJBattleDataItem,this._myScore=BitmapNumber.ins().createNumPic(0,"1",5),this._myScore.x=95,this._myScore.y=100,this.group.addChild(this._myScore),this._enemyScore=BitmapNumber.ins().createNumPic(0,"1",5),this._enemyScore.x=300,this._enemyScore.y=100,this.group.addChild(this._enemyScore),this.addExclusionWin(egret.getQualifiedClassName(WJBattlefieldDataWin))
},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.upData(t[0],t[1],t[2],t[3])},e.prototype.upData=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2],o=t[3];this.myList.dataProvider=new eui.ArrayCollection(n),this.enemyList.dataProvider=new eui.ArrayCollection(o),BitmapNumber.ins().changeNum(this._myScore,i,"1",5),BitmapNumber.ins().changeNum(this._enemyScore,s,"1",5),i>s?(this.myResult.source="wjBattle_json.wj_winning",this.enemyResult.source="wjBattle_json.wj_fail"):(this.enemyResult.source="wjBattle_json.wj_winning",this.myResult.source="wjBattle_json.wj_fail")},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.quitBtn:UserFb.ins().sendExitFb()}},e}(BaseEuiView);__decorate([callLater],WJBattlefieldResultWin.prototype,"upData",null),__reflect(WJBattlefieldResultWin.prototype,"WJBattlefieldResultWin"),ViewManager.ins().reg(WJBattlefieldResultWin,LayerManager.UI_Popup);var WJBattlefieldStartCountdownPanel=function(t){function e(){var e=t.call(this)||this;return e._maxCount=3,e.skinName="WJBattleStartTipSkin",e}return __extends(e,t),e.prototype.initUI=function(){this._count=BitmapNumber.ins().createNumPic(0,"8",5),this._count.x=105,this._count.y=350,this.addChild(this._count)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().doTimer(1e3,this._maxCount+1,this.countdownFun,this),this.countdownFun()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.countdownFun,this)},e.prototype.countdownFun=function(){return this._maxCount<=0?void ViewManager.ins().close(this):(BitmapNumber.ins().changeNum(this._count,this._maxCount,"8",5),void this._maxCount--)},e}(BaseEuiView);__reflect(WJBattlefieldStartCountdownPanel.prototype,"WJBattlefieldStartCountdownPanel"),ViewManager.ins().reg(WJBattlefieldStartCountdownPanel,LayerManager.UI_Popup);var WJBattlefieldWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WJBattleSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.getAwardBtn,this.onTouch),this.addTouchEvent(this.matchBtn,this.onTouch),this.addTouchEvent(this.shopLink,this.onTouch),this.addTouchEvent(this.viewArea,this.onTouch),this.upData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.initUI=function(){this.awardList.itemRenderer=ItemBase,this.shopLink.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.shopLink.text)},e.prototype.upData=function(){this.timesLabel.text="剩余参与次数："+WJBattlefieldSys.ins().overCounts},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.getAwardBtn:break;case this.matchBtn:0==WJBattlefieldSys.ins().matchingTime?WJBattlefieldSys.ins().sendMatch(this.autoCheckBox.selected):ViewManager.ins().open(WJBattlefieldMatchPanel);break;case this.shopLink:ViewManager.ins().open(ShopWin);break;case this.viewArea:WJBattlefieldSys.ins().sendViewDataInfo()}},e}(BaseEuiView);__reflect(WJBattlefieldWin.prototype,"WJBattlefieldWin"),ViewManager.ins().reg(WJBattlefieldWin,LayerManager.UI_Main);var WJBattleMinMapPanel=function(t){function e(){var e=t.call(this)||this;return e.flagRes=["wj_gray_flag_icon","wj_green_flag_icon","wj_red_flag_icon"],e.entityRes=["wj_green_point","wj_blue_point"],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.signList=[]},e.prototype.open=function(){TimerManager.ins().doTimer(300,0,this.refreshCoordinate,this),this.observe(WJBattlefieldSys.ins().postRefCampFlag,this.refreshFlag,this)},e.prototype.close=function(){TimerManager.ins().removeAll(this),this.removeObserve(),this.signList=[]},e.prototype.refreshFlag=function(){for(var t=0;3>t;t++)WJBattlefieldSys.ins().flagInfos[t+1]?this["flag"+(t+1)].source=100==WJBattlefieldSys.ins().flagInfos[t+1]?this.flagRes[1]:this.flagRes[2]:this["flag"+(t+1)].source=this.flagRes[0]},e.prototype.refreshCoordinate=function(){var t=EntityManager.ins().getAllEntity();for(var e in t){var i=t[e];if(i.infoModel&&!this.signList[i.infoModel.handle]){var s=!1;if(s);else{var n=new eui.Image(this.entityRes[0]);n.x=i.x/10>>0,n.y=i.y/10>>0,this.addChild(n),this.signList[i.infoModel.handle]=n}}this.signList[i.infoModel.handle].x=i.x/10>>0,this.signList[i.infoModel.handle].y=i.y/10>>0}},e}(BaseView);__reflect(WJBattleMinMapPanel.prototype,"WJBattleMinMapPanel");var WJBattlefieldSys=function(t){function e(){var e=t.call(this)||this;return e.campAScores=0,e.campBScores=0,e.flagInfos=[],e.overCounts=0,e.matchingTime=0,e.isWJBattle=!1,e.isActiveQuit=!1,e.sysId=PackageID.WJBattle,e.regNetMsg(0,e.postStateInfo),e.regNetMsg(1,e.postMatchData),e.regNetMsg(2,e.doCancelMatch),e.regNetMsg(3,e.postEnterFbInfo),e.regNetMsg(4,e.doBattleResult),e.regNetMsg(5,e.postRefCampScores),e.regNetMsg(6,e.postRefCampFlag),e.regNetMsg(7,e.postFirstKiller),e.regNetMsg(8,e.postInfo),e.regNetMsg(9,e.postChatInfo),e.regNetMsg(10,e.doViewDataInfo),e.regNetMsg(11,e.postRemain),e.regNetMsg(12,e.postMyData),e.observe(GameLogic.ins().postEnterMap,function(){e.isWJBattle&&52e3!=GameMap.fubenID&&e.quitWJBattle()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postStateInfo=function(t){this.isOpen=t.readByte()>0?!0:!1,this._prepStartTime=t.readInt(),this._startTime=t.readInt(),this._endTime=t.readInt()},e.prototype.postMatchData=function(t){ViewManager.ins().open(WJBattlefieldMatchPanel)},e.prototype.doCancelMatch=function(t){ViewManager.ins().close(WJBattlefieldMatchPanel),e.ins().matchingTime=0},e.prototype.postEnterFbInfo=function(t){t.readInt();this.myCampId=t.readInt(),this.campAScores=t.readInt(),this.campBScores=t.readInt(),this.flagHandle=[];for(var i=t.readByte(),s=0;i>s;s++)this.flagHandle[t.readByte()]=t.readDouble();this.isWJBattle=!0,e.ins().matchingTime=0,ViewManager.ins().close(WJBattlefieldWin),ViewManager.ins().open(WJBattlefieldMainUI),ViewManager.ins().open(WJBattlefieldStartCountdownPanel),KFServerSys.ins().linkingKFState(!1)},e.prototype.doBattleResult=function(t){var e=t.readInt(),i=t.readInt();this.resultMyInfoData=[],this.resultEnemyInfoData=[];for(var s=t.readByte(),n=0;s>n;n++){var o=new WJBattleData;o.readResultData(t),o.isResult=!0,o.camp==this.myCampId?this.resultMyInfoData.push(o):this.resultEnemyInfoData.push(o)}ViewManager.ins().open(WJBattlefieldResultWin,e,i,this.resultMyInfoData,this.resultEnemyInfoData)},e.prototype.postRefCampScores=function(t){this.campAScores=t.readInt(),this.campBScores=t.readInt()},e.prototype.postRefCampFlag=function(t){var e=t.readByte();this.flagInfos[e]=t.readInt()},e.prototype.postFirstKiller=function(t){},e.prototype.postInfo=function(t){var e=this;this.overCounts=t.readInt();var i=t.readByte();i&&!this.isActiveQuit&&WarnWin.show("您有正在进行的玩法，是否立刻返回？",function(){e.sendEnter()},this,null,null,"sure"),this.isActiveQuit=!1},e.prototype.postChatInfo=function(t){var e=t.readInt(),i=t.readString(),s=t.readString(),n="s"+e+"."+i+":"+s;return n},e.prototype.doViewDataInfo=function(t){for(var e=t.readByte(),i=[],s=[],n=0;e>n;n++){var o=new WJBattleData;o.readViewData(t),o.isResult=!1,o.camp==this.myCampId?i.push(o):s.push(o)}ViewManager.ins().open(WJBattlefieldDataWin,i,s)},e.prototype.postRemain=function(t){var e=t.readShort();ViewManager.ins().open(ReliveWin,e,"敌方")},e.prototype.postMyData=function(t){return this.myData=new WJBattleData,this.myData.readMyData(t),this.myData},e.prototype.sendMatch=function(t){var e=this.getBytes(1);e.writeShort(t?1:0),this.sendToServer(e)},e.prototype.sendEnter=function(){this.sendBaseProto(3)},e.prototype.sendCancelMatch=function(){this.sendBaseProto(2)},e.prototype.sendChatInfo=function(t){var e=this.getBytes(9);e.writeString(t),this.sendToServer(e)},e.prototype.sendViewDataInfo=function(){this.sendBaseProto(10)},e.prototype.quitWJBattle=function(){this.isWJBattle=!1,this.myCampId=0,this.campAScores=0,this.campBScores=0,ViewManager.ins().close(WJBattlefieldMainUI),ViewManager.ins().close(WJBattlefieldResultWin),this.isActiveQuit=!0},e.postSwitchServer=function(){ViewManager.ins().close(WJBattlefieldMatchPanel)},e.prototype.getPrepStartTimeStamp=function(){return this._prepStartTime-egret.getTimer()},e.prototype.getStartTime=function(){return Math.floor((DateUtils.formatMiniDateTime(this._startTime)-GameServer.serverTime)/1e3)},e.prototype.getEndTime=function(){return Math.floor((DateUtils.formatMiniDateTime(this._endTime)-GameServer.serverTime)/1e3)},e.prototype.getMatchingTime=function(){return 0==this.matchingTime?0:this.matchingTime+egret.getTimer()/1e3>>0},e}(BaseSystem);__reflect(WJBattlefieldSys.prototype,"WJBattlefieldSys");var GameSystem;!function(t){t.wjBattlefieldSys=WJBattlefieldSys.ins.bind(WJBattlefieldSys)}(GameSystem||(GameSystem={}));var WJBattleRedPoint=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(BaseSystem);__reflect(WJBattleRedPoint.prototype,"WJBattleRedPoint");var GameSystem;!function(t){WJBattleRedPoint.ins.bind(WJBattleRedPoint)}(GameSystem||(GameSystem={}));var KuaFuRankData=function(){function t(){this.actorId=0,this.rmb=0,this.rank=0,this.serverId=0,this.roleName="",this.job=0,this.sex=0}return t}();__reflect(KuaFuRankData.prototype,"KuaFuRankData");var KfCostRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostRankItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(t){},e.prototype.dataChanged=function(){this.data&&this.data instanceof KuaFuRankData&&(this.pos.text=this.data.rank+"",this.player.text="s"+this.data.serverId+"."+this.data.roleName,this.value.text="已消费："+this.data.rmb)},e}(BaseItemRender);__reflect(KfCostRankItemRender.prototype,"KfCostRankItemRender");var KfCostRankRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostRewardItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.reward.itemRenderer=ItemBase},e.prototype.onClick=function(t){},e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.pos.text=t.rank+"",this.need.text=t.desc,this.reward.dataProvider=new eui.ArrayCollection(t.rewards)}},e}(BaseItemRender);__reflect(KfCostRankRewardItemRender.prototype,"KfCostRankRewardItemRender");var KfRankPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.actorIds=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postKuaFuRank,this.updateData),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.addTouchEvent(this.rechargeBtn,this.onClick),TimerManager.ins().doTimer(1e3,0,this.setTime,this),this.activityID=t[0],this.list.itemRenderer=KfCostRankItemRender,this.listdata=new eui.ArrayCollection,this.list.dataProvider=this.listdata,Activity.ins().sendKuaFuRank(this.activityID)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.rechargeBtn:ViewManager.ins().open(Recharge1Win)}},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=t.GetRankList();if(e.length?this.currentState="normal":this.currentState="none",this.validateNow(),this.myNumber.text=t.mycost+"",this.myRanking.text="未上榜","none"!=this.currentState){var i=[],s=e.length>3?e.length:3;this.actorIds=[];for(var n=0,o=0;s>o;o++){var a=e[o];if(3>o){if(a&&a.actorId){var r={actorId:a.actorId,serverId:a.serverId};this.actorIds.push(r),this["playName"+o].text="s"+a.serverId+"."+a.roleName,this["recharge"+o].text="已消费："+a.rmb,this["playName"+o].visible=this["recharge"+o].visible=!0}else{var r={actorId:0,serverId:0};this.actorIds.push(r),this["playName"+o].visible=this["recharge"+o].visible=!1}this["rank"+o].data=null}else a&&i.push(a);a&&Actor.actorID==a.actorId&&(n=a.rank)}for(var h=0;h<this.actorIds.length;h++)this.actorIds[h]&&this.actorIds[h].actorId&&UserReadPlayer.ins().sendFindPlayer(this.actorIds[h].actorId,this.actorIds[h].serverId);this.listdata.replaceAll(i),this._time=t.getleftTime(),this.myNumber.text=t.mycost+"",this.myRanking.text=n?n+"":"未上榜";var l=this.list.parent;l.stopAnimation(),this.list.scrollV=0,this.setTime()}}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.actorIds.length;e++)this.actorIds[e].actorId==t.id&&(this["rank"+e].data={otherPlayerData:t})},e}(BaseComponent);__reflect(KfRankPanel.prototype,"KfRankPanel");var KfRankRewardPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.list.itemRenderer=KfCostRankRewardItemRender,this.listdata=new eui.ArrayCollection,this.list.dataProvider=this.listdata,this.updateData()},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=GlobalConfig.ActivityType19Config[this.activityID],i=[];for(var s in e){var n="";n=e[s].range[0]==e[s].range[1]?""+e[s].range[0]:e[s].range[0]+"-"+e[s].range[1];var o=e[s].condition?"（消费≥"+e[s].condition+"元宝即可参与本排行）":"",a=e[s].rewards,r={rank:n,desc:o,rewards:a};i.push(r)}this.listdata.replaceAll(i),this._time=t.getleftTime();var h=this.list.parent;h.stopAnimation(),this.list.scrollV=0,this.setTime();var l=GlobalConfig.ActivityConfig[this.activityID];this.actInfo.textFlow=TextFlowMaker.generateTextFlow1(""+l.desc)}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(BaseComponent);__reflect(KfRankRewardPanel.prototype,"KfRankRewardPanel");var Ladder=function(t){function e(){var e=t.call(this)||this;return e.isCanReward=!1,e.upLevel=0,e.upId=0,e.upWin=0,e.todayBuyTime=0,e.upWeekRank=0,e.upRankList=[],e._actorInfo=[],e.sysId=PackageID.Ladder,e.regNetMsg(1,e.doLadderInfo),e.regNetMsg(2,e.doGetPlayer),e.regNetMsg(3,e.doPlayResule),e.regNetMsg(5,e.postRankInfoList),e.regNetMsg(6,e.doChallageNum),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getActorInfo=function(t){return void 0===t&&(t=-1),-1==t?this._actorInfo:this._actorInfo[t]},e.prototype.sendGetSomeOne=function(){this.sendBaseProto(2)},e.prototype.sendStarPlay=function(t,e){var i=this.getBytes(3);i.writeInt(e),i.writeInt(t),this.sendToServer(i),this._actorInfo=[]},e.prototype.sendGetWeekReward=function(){this.sendBaseProto(4)},e.prototype.sendGetRankInfo=function(){this.sendBaseProto(5)},e.prototype.sendBuyChallgeTime=function(){this.sendBaseProto(6)},e.prototype.doLadderInfo=function(t){this.docodeInfo(t)},e.prototype.postTadderChange=function(){},e.prototype.doGetPlayer=function(t){var e=t.readInt(),i=t.readInt();this._actorInfo.length=0,this._actorInfo.push(e,i),i>0&&(this._actorInfo.push(t.readString()),this._actorInfo.push(t.readByte()),this._actorInfo.push(t.readByte()),this._actorInfo.push(t.readInt()),this._actorInfo.push(t.readInt()))},e.prototype.doPlayResule=function(t){this.doPlayResult(t)},e.prototype.postRankInfoList=function(t){var e=Rank.ins().getRankModel(RankDataType.TYPE_LADDER),i=t.readShort();e.getDataList().length=i;var s=e.getDataList(),n=0;for(n=0;i>n;++n)this.setRankData(s,n,t);var o=this.getMyRankInfo(s);for(e.selfPos=o?o.pos:0,this.upRankList=[],this.upweekLength=0,i=t.readShort(),n=0;i>n;++n)this.setRankData(this.upRankList,n,t,!0);return this.fillingList(),e},e.prototype.setRankData=function(t,e,i,s){void 0===s&&(s=!1),e in t||(t[e]=new RankDataLadder),t[e].parser(i,null),t[e].pos=e+1,s&&t[e].id==Actor.actorID&&(this.upWeekRank=t[e].pos)},e.prototype.doChallageNum=function(t){this.todayBuyTime=t.readInt()},e.prototype.docodeInfo=function(t){this.isOpen=t.readBoolean(),this.level=t.readInt(),this.nowId=t.readInt(),this.challgeNum=t.readInt();var i=t.readInt();this.challgeCd=1e3*i+egret.getTimer(),this.winNum=t.readInt(),this.lianWin=t.readBoolean(),this.playUpTime=t.readBoolean(),this.playUpTime&&(this.isCanReward=t.readBoolean(),this.upLevel=t.readInt(),this.upId=t.readInt(),this.upWin=t.readInt()),e.ins().postTadderChange()},e.prototype.doPlayResult=function(t){for(var e,i=t.readBoolean(),s=t.readShort(),n=[],o=0;s>o;o++)e=new RewardData,e.parser(t),n.push(e);var a=t.readInt(),r=t.readInt(),h=t.readInt();TimerManager.ins().doTimer(1e3,1,function(){ViewManager.ins().open(LadderResultWin,i,n.reverse(),a,r,h)},this)},e.prototype.fillingList=function(){0==this.upweekLength&&(this.upweekLength=this.checkObjListLength());var t=this.upweekLength-this.upRankList.length;if(t>0)for(var e=1;t>e;e++)this.upRankList.push(null);this.configList||(this.configList=this.cloneConfigDataList(GlobalConfig.TianTiDanConfig),this.configList.reverse())},e.prototype.getUpRankList=function(){var t=[];for(var e in this.upRankList)this.upRankList[e]&&t.push(this.upRankList[e]);return t},e.prototype.checkObjListLength=function(){for(var t=1;200>t;t++)if(!GlobalConfig.TianTiRankAwardConfig[t+""])return t;return 0},e.prototype.getMyRankInfo=function(t){for(var e=0;e<t.length;e++)if(t[e].id==Actor.actorID)return t[e];return null},e.prototype.getLevelDuanWeiLength=function(t){var e=0,i=GlobalConfig.TianTiDanConfig;for(var s in i[t+""])i[t+""][s]&&e++;return e},e.prototype.getDuanWeiDesc=function(){var t="",e=this.getLevelConfig();return e&&(t=e.showLevel+this.getZhongwenNumber(e.showDan)+"段"),t},e.prototype.getLevelConfig=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=-1),-1==t&&(t=this.level),-1==e&&(e=this.nowId);var i=GlobalConfig.TianTiDanConfig;for(var s in i[t+""])if(i[t+""][s].id==e)return i[t+""][s];return null},e.prototype.creatRewardData=function(t){var e;return e=new RewardData,e.count=t.count,e.type=t.type,e.id=t.id,e},e.prototype.getZhongwenNumber=function(t){var e="";switch(t){case 1:e="一";break;case 2:e="二";break;case 3:e="三";break;case 4:e="四";break;case 5:e="五";break;case 6:e="六";break;case 7:e="七";break;case 8:e="八";break;case 9:e="九";break;case 10:e="十"}return e},e.prototype.cloneConfigDataList=function(t){var e,i=[];for(var s in t)for(var n in t[s])e=new TianTiDanConfig,e.level=parseInt(s),e.id=t[s][n].id,e.showStar=t[s][n].showStar,e.showDan=t[s][n].showDan,e.showLevel=t[s][n].showLevel,e.winAward=t[s][n].winAward,e.danAward=t[s][n].danAward,this.checkIshaveOne(i,e)&&i.push(e);return i},e.prototype.checkRedShow=function(){return this.challgeNum>0&&this.isOpen?1:0},e.prototype.checkIshaveOne=function(t,e){for(var i=t.length,s=0;i>s;s++)if(t[s].level==e.level)return!1;return!0},e.prototype.getStatuByLevel=function(t){var e;switch(t){case 1:e=3;break;case 2:e=4;break;case 3:e=5;break;case 4:e=0}return e},e}(BaseSystem);__reflect(Ladder.prototype,"Ladder");var GameSystem;!function(t){t.ladder=Ladder.ins.bind(Ladder)}(GameSystem||(GameSystem={}));var LadderChallengeWin=function(t){function e(){var e=t.call(this)||this;return e.roleInfoList=[[[2,1],[1,0]],[[1,0],[3,1]],[[3,1],[2,0]],[[2,0],[3,1]]],e.sendCount=0,e.skinName="ChallengeSkin",e}return __extends(e,t),e.prototype.initUI=function(){this.tweenObj={index:0},this.otherHead.scrollRect=new egret.Rectangle(-1,-1,84,84),this.scrollHead.scrollRect=new egret.Rectangle(-1,-56,84,84),this.otherMask=this.otherHead.scrollRect,this.scrollMask=this.scrollHead.scrollRect,this.posY=this.otherMask.y,this.posYImg=this.scrollHead.y,this.posYScroll=this.scrollMask.y},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Rank.ins().postRankingData,this.updataHeadInfo),Ladder.ins().sendGetSomeOne(),this.setMyHead(),this.startScrollHead(),this.ingImg.visible=!0,this.enterTime.visible=!1,PlayFun.ins().closeAuto()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.stopScrollHead(),this.removeObserve(),this.ingImg.visible=!0,this.enterTime.visible=!1},e.prototype.setMyHead=function(){var t=SubRoles.ins().getSubRoleByIndex(0);this.myhead.source="head_"+t.job+t.sex;var e=Ladder.ins().getLevelConfig();this.myname.text=Actor.myName,this.mylv.text=""+e.showLevel+(e.showDan||"")+"段"},e.prototype.startScrollHead=function(){this.rollTime=0,this.otherMask.y=this.posY,this.scrollMask.y=this.posYScroll,this.scrollHead.y=this.posYImg,this.refushROllInfo(0),egret.Tween.get(this.tweenObj,{loop:!0}).to({index:this.rollTime+1},20).call(this.startScroll,this)},e.prototype.stopScrollHead=function(){egret.Tween.removeTweens(this.tweenObj)},e.prototype.startScroll=function(){this.otherMask.y+=2,this.scrollMask.y+=2,this.scrollHead.y-=1,this.otherHead.scrollRect=this.otherMask,this.scrollHead.scrollRect=this.scrollMask,this.rollTime++,this.rollTime%27==0&&(this.otherMask.y=this.posY,this.scrollMask.y=this.posYScroll,this.scrollHead.y=this.posYImg,this.refushROllInfo(this.rollTime/27),this.rollTime/27==4&&(this.scrollHead.source="",this.rollOver()))},e.prototype.updataHeadInfo=function(t){t.type==RankDataType.TYPE_POWER&&t.type==RankDataType.TYPE_BAOSHI&&t.type==RankDataType.TYPE_LONGHUN&&t.type==RankDataType.TYPE_WING&&t.type==RankDataType.TYPE_BOOK&&t.type==RankDataType.TYPE_ZS&&t.type==RankDataType.TYPE_SCORE&&t.type==RankDataType.TYPE_POWER&&this.refushROllInfo(0)},e.prototype.rollOver=function(){this.stopScrollHead(),this.ingImg.visible=!1,this.enterTime.visible=!0,this.rollTime=3,this.enterTime.text="进入倒计时"+this.rollTime+"秒",0==Ladder.ins().getActorInfo(1)&&0==Ladder.ins().getActorInfo(0)?(UserTips.ins().showTips("|C:0xf3311e&T:未匹配到对手|"),ViewManager.ins().close(this)):TimerManager.ins().doTimer(1e3,0,this.refushLabel,this)},e.prototype.refushLabel=function(){this.rollTime--,this.enterTime.text="进入倒计时"+this.rollTime+"秒",this.rollTime<1&&(this.sendStarPlay(),TimerManager.ins().remove(this.refushLabel,this))},e.prototype.refushROllInfo=function(t){if(t>3)return void this.showPointPlayerInfo();var e=Ladder.ins().level,i=Math.floor(Math.random()*Ladder.ins().getLevelDuanWeiLength(e)),s=Ladder.ins().getLevelConfig(e,i);this.otherlv.text=""+s.showLevel+(s.showDan||"")+"段";var n=this.roleInfoList[t];this.otherHead.source="head_"+n[0][0]+n[0][1],this.scrollHead.source="head_"+n[1][0]+n[1][1];var o=this.getRankListOne()},e.prototype.showPointPlayerInfo=function(){var t=Ladder.ins().getActorInfo();if(0!=t.length&&(0!=t[1]||0!=t[0])){this.otherHead.source="head_"+t[3]+t[4],this.scrollHead.source="";var e=Ladder.ins().getLevelConfig(t[5],t[6]);this.otherlv.text=""+e.showLevel+(e.showDan||"")+"段",this.othername.textFlow=TextFlowMaker.generateTextFlow1(t[2])}},e.prototype.sendStarPlay=function(){Ladder.ins().sendStarPlay(Ladder.ins().getActorInfo(1),Ladder.ins().getActorInfo(0)),ViewManager.ins().close(LadderWin),ViewManager.ins().close(this)},e.prototype.getRankListOne=function(){var t=Rank.ins().getRankModel(RankDataType.TYPE_POWER);if(t&&t.getDataList().length<=0)return this.sendCount<2?(Rank.ins().sendGetRankingData(RankDataType.TYPE_POWER),this.sendCount++,null):null;this.sendCount=0;var e=t.getDataList(),i=e[Math.floor(Math.random()*e.length)];return i&&i.id==Actor.actorID?1==e.length?i:this.getRankListOne():i},e}(BaseEuiView);__reflect(LadderChallengeWin.prototype,"LadderChallengeWin"),ViewManager.ins().reg(LadderChallengeWin,LayerManager.UI_Popup);var LadderInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.name="天梯",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){this.buyTime.textFlow=(new egret.HtmlTextParser).parser("<u>购买匹配次数</u>"),this.showNomber.textFlow=(new egret.HtmlTextParser).parser("<u>查看排名</u>"),this.showReward.textFlow=(new egret.HtmlTextParser).parser("<u>查看奖励</u>"),this.showNomber0.textFlow=(new egret.HtmlTextParser).parser("<u>上周排名</u>"),this.addTouchEvent(this.flowPlayer,this.onTap),this.addTouchEvent(this.buyTime,this.onTap),this.addTouchEvent(this.showNomber,this.onTap),this.addTouchEvent(this.showReward,this.onTap),this.addTouchEvent(this.showNomber0,this.onTap),this.observe(Ladder.ins().postTadderChange,this.tadderInfoChange),this.observe(Ladder.ins().postRankInfoList,this.tadderInfoChange),Ladder.ins().sendGetRankInfo(),this.tadderInfoChange()},e.prototype.$onClose=function(){t.prototype.$onClose.call(this),TimerManager.ins().removeAll(this)},e.prototype.updateTime=function(){var t=Ladder.ins().challgeNum,e=GlobalConfig.TianTiConstConfig.maxRestoreChallengesCount,i=t>0?"2ECA22":"f3311e",s=Math.round((Ladder.ins().challgeCd-egret.getTimer())/1e3);s=0>=s?0:s;var n=t>=e?"(2小时恢复1次)":"(恢复倒计时："+DateUtils.getFormatBySecond(s)+")";this.lastNum.textFlow=(new egret.HtmlTextParser).parser('<font color="#'+i+'">剩余次数：'+t+"/"+e+' <font color="#7E6437">'+n+"</font></font>")},e.prototype.tadderInfoChange=function(){TimerManager.ins().remove(this.updateTime,this),TimerManager.ins().doTimer(500,0,this.updateTime,this),this.updateTime();var t=Rank.ins().rankModel[RankDataType.TYPE_LADDER];t&&(this.winNum0.text=t.selfPos>0?""+t.selfPos:"未上榜"),this.winNum.text=""+Ladder.ins().winNum,this.duanwei.text=Ladder.ins().getDuanWeiDesc();var e=Ladder.ins().getLevelConfig();e&&(this.rewardList.dataProvider=new eui.ArrayCollection(e.danAward)),this.winImg.visible=Ladder.ins().lianWin,this.starInfo.updataStarInfo(e),this.starInfo.setLvAndRank(e),this.noOpenDesc.visible=!Ladder.ins().isOpen,this.openInfo.visible=Ladder.ins().isOpen},e.prototype.onTap=function(t){switch(ViewManager.ins().close(LimitTaskView),t.currentTarget){case this.flowPlayer:if(UserFb.ins().checkInFB())return;if(Ladder.ins().challgeNum<=0)return void UserTips.ins().showTips("|C:0xf3311e&T:挑战次数不足|");if(ViewManager.ins().isShow(LadderChallengeWin))return;ViewManager.ins().open(LadderChallengeWin);break;case this.buyTime:if(Ladder.ins().todayBuyTime==GlobalConfig.TianTiConstConfig.maxBuyChallengesCount)return void UserTips.ins().showTips("|C:0xf3311e&T:今日购买次数已达上限|");if(Actor.yb<GlobalConfig.TianTiConstConfig.buyChallengesCountYuanBao)return void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");WarnWin.show("确定花费<font color='#FFB82A'>"+GlobalConfig.TianTiConstConfig.buyChallengesCountYuanBao+"元宝</font>购买1次王者争霸挑战次数吗？\n"+("今日已购买："+Ladder.ins().todayBuyTime+"/"+GlobalConfig.TianTiConstConfig.maxBuyChallengesCount),function(){Ladder.ins().sendBuyChallgeTime()},this);break;case this.showReward:ViewManager.ins().open(LadderRewardShowWin);break;case this.showNomber:ViewManager.ins().open(LadderLastRankWin,1);break;case this.showNomber0:Ladder.ins().upLevel>0?ViewManager.ins().open(LadderLastRankWin,0):UserTips.ins().showTips("|C:0xf3311e&T:暂无上周排行数据|")}},e}(BaseComponent);__reflect(LadderInfoPanel.prototype,"LadderInfoPanel");var LadderLastRankWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="ladderinforankingskin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list.itemRenderer=LadderRankItemRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.setPanelInfo(i),this.titleDesc.text=1==i?"本周排名":"上周排名",this.rankDesc.text=1==i?"我的战绩":"我的上周战绩"},e.prototype.close=function(){},e.prototype.setPanelInfo=function(t){var e=Ladder.ins().getLevelConfig();if(1==t){var i=Rank.ins().rankModel[RankDataType.TYPE_LADDER];this.list.dataProvider=new eui.ArrayCollection(i.getDataList()?i.getDataList():[]),this.myRank.text=i.selfPos>0?"排名："+i.selfPos:"排名：未上榜",this.WinNum.text="净胜场："+Ladder.ins().winNum+"场",this.myDwIng.source="ladder_rank_"+Ladder.ins().level,e=Ladder.ins().getLevelConfig()}else this.list.dataProvider=new eui.ArrayCollection(Ladder.ins().getUpRankList()),this.myRank.text=Ladder.ins().upWeekRank>0?"排名："+Ladder.ins().upWeekRank:"排名：未上榜",this.WinNum.text="净胜场："+Ladder.ins().upWin+"场",this.myDwIng.source="ladder_rank_"+Ladder.ins().upLevel,e=Ladder.ins().getLevelConfig(Ladder.ins().upLevel,Ladder.ins().upId);e.showDan>0?(this.levelBg.visible=!0,this.level.source="laddergradnum_"+e.showDan):(this.levelBg.visible=!1,this.level.source=null)},e}(BaseEuiView);__reflect(LadderLastRankWin.prototype,"LadderLastRankWin"),ViewManager.ins().reg(LadderLastRankWin,LayerManager.UI_Main);var LadderRankItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="TiantiRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t.pos<=3?(this.rankImg.source="paihang"+t.pos,this.rank.text=""):(this.rank.text=t.pos+"",this.rankImg.source=""),this.nameLabel.text=t.player,this.winNum.text=t.winNum+"场",this.dwImg.source="ladder_rank_"+t.challgeLevel;var e=Ladder.ins().getLevelConfig(t.challgeLevel,t.challgeId);e&&e.showDan>0?(this.level.source="laddergradnum_"+e.showDan,this.levelBg.visible=!0):(this.level.source=null,this.levelBg.visible=!1)},e}(BaseItemRender);__reflect(LadderRankItemRenderer.prototype,"LadderRankItemRenderer");var LadderResultWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ladderresultwinskin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listData=new eui.ArrayCollection,this.mc=new MovieClip,this.mc.scaleX=this.mc.scaleY=1.2,this.starList.addChildAt(this.mc,0)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.isWin=e[0];var s=e[1],n=e[2],o=e[3],a=e[4];this.bg.source=this.isWin?"win_png":"lost_png",this.result.source=this.isWin?"win_02":"lost_02",this.sureBtn.name=this.isWin?"领取奖励":"退出",this.s=5,this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,5,this.updateCloseBtnLabel,this),this.listData.source=s,this.list.dataProvider=this.listData,this.refushStarInfo(n,o,a),this.addTouchEvent(this.sureBtn,this.onTap),this.playEffect()},e.prototype.playEffect=function(){this.isWin&&(this.mc.playFile(RES_DIR_EFF+"laddercircle",-1),this.mc.x=this.starList.width>>1,this.mc.y=this.starList.height>>1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.sureBtn,this.onTap),egret.Tween.removeTweens(this.starList),DisplayUtils.removeFromParent(this.mc),GameMap.fubenID>0&&(UserFb.ins().sendExitFb(),ViewManager.ins().open(LadderWin,1))},e.prototype.refushStarInfo=function(t,e,i){var s=Ladder.ins().getLevelConfig(t,e);this.upLevel=t,this.upId=e,this.starList.updataStarInfo(s),this.lastlevel=s.showDan,this.lastRank=s.level,this.star1.visible=!1,this.star2.visible=!1;for(var n=0;i>n;n++)this["star"+(n+1)].visible=!0,this["star"+(n+1)].currentState=this.isWin?"light":"black";if(this.upStar.visible=Ladder.ins().getLevelConfig().showDan>0,i>0){var o=this,a=function(){TimerManager.ins().remove(a,o),o.setStarInfoChange(s.showStar,i)};TimerManager.ins().doTimer(500,1,a,o)}},e.prototype.setStarInfoChange=function(t,e){e>0&&this.starList.upStarStatu(t+1,e,this.isWin)},e.prototype.cheackIsChangeLevel=function(t){var e=this;if(this.upLevel!=Ladder.ins().level||this.upId!=Ladder.ins().nowId){var i=egret.Tween.get(this.starList);i.to({alpha:1},300).call(function(){e.isWin&&t>=1&&e.starList.upStarStatu(1,t,e.isWin);var i=Ladder.ins().getLevelConfig(),s=i.showDan,n=i.level;e.lastRank<n?(e.starList.showRankUp(n),e.starList.showLvUp(s)):e.lastlevel<s?e.starList.showLvDown(s):e.lastlevel>s&&e.starList.showLvUp(s),e.starList.updataStarInfo(i,!1),egret.Tween.removeTweens(e.starList)},this)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sureBtn:ViewManager.ins().close(this)
}},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.sureBtn.label=this.sureBtn.name+"("+this.s+"s)"},e}(BaseEuiView);__reflect(LadderResultWin.prototype,"LadderResultWin"),ViewManager.ins().reg(LadderResultWin,LayerManager.UI_Popup);var LadderRewardShowWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="ladderinforewardskin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list0.itemRenderer=LastWeekRankItemRenderer,this.list1.itemRenderer=ItemBase},e.prototype.open=function(){this.setPanelInfo()},e.prototype.close=function(){},e.prototype.setPanelInfo=function(){var t=Ladder.ins().upRankList;t.length>5&&(t=t.slice(0,5)),this.list0.dataProvider=new eui.ArrayCollection(t);var e=Ladder.ins().configList,i=this.getRewardDataList(e);if(this.list1.dataProvider=new eui.ArrayCollection(i),this.winNum.text="净胜场："+Ladder.ins().upWin+"场",this.winNum0.text="排名："+(Ladder.ins().upWeekRank>0?""+Ladder.ins().upWeekRank:"未上榜"),Ladder.ins().playUpTime){this.upImg.source="ladder_rank_"+Ladder.ins().upLevel;var s=Ladder.ins().getLevelConfig(Ladder.ins().upLevel,Ladder.ins().upId);s.showDan>0?(this.levelbg.visible=!0,this.level.source="laddergradnum_"+s.showDan):(this.levelbg.visible=!1,this.level.source=null)}else this.upImg.source="ladder_rank_1",this.level.source="laddergradnum_5"},e.prototype.getRewardDataList=function(t){for(var e=[],i=0;i<t.length;i++)e=e.concat(t[i].danAward);return e},e.openCheck=function(){return Ladder.ins().configList?!0:(UserTips.ins().showTips("网络不佳，请稍后"),!1)},e}(BaseEuiView);__reflect(LadderRewardShowWin.prototype,"LadderRewardShowWin"),ViewManager.ins().reg(LadderRewardShowWin,LayerManager.UI_Main);var LadderWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ladderwinskin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.help,this.onTap),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.selectIndexChange),this.addChangingEvent(this.tab,this.checkIsBack),this.addTouchEvent(this.closeBtn,this.onTap),this.observe(Mine.ins().postRedPoint,this.updateMineRedPoint),this.observe(UserFb.ins().postShowRedChange,this.refushredPoint),this.observe(Hungu.ins().postHunShouFBInfo,this.refushredPoint),this.observe(Hungu.ins().postSweepHunShouFB,this.refushredPoint);var i=t[0]?t[0]:0;this.tab.selectedIndex=i,this.viewStack.selectedIndex=i,this.selectIndexChange(),this.refushredPoint(),Hungu.ins().showHunShouFB()?this.viewStack.numElements<5&&(this.viewStack.addChild(this.challengeHunshou),this.redGroup.addChild(this.redPoint5),this.redPoint5.visible=Hungu.ins().showHunShouRed()):this.viewStack.numElements>=5&&(this.viewStack.removeChild(this.challengeHunshou),DisplayUtils.removeFromParent(this.redPoint5))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.Event.CHANGING,this.onTabTouching,this.tab)},e.prototype.selectIndexChange=function(t){switch(void 0===t&&(t=null),this.tab.selectedIndex){case 0:this.zaoyu.open();break;case 1:this.ladder.open();break;case 2:this.wakuang.open();break;case 3:this.teamfb.open();break;case 4:this.challengeHunshou.open()}this.title.source="biaoti_jingji"+this.tab.selectedIndex},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return 3!=t||UserFb.ins().isTeamFBOpen()?4!=t||Hungu.ins().isHunShouFBOpen()?!0:(UserTips.ins().showTips("达到"+GlobalConfig.HunGuConf.needZsLv+"转且开服第"+GlobalConfig.HunGuConf.fbOpenDay+"天开启"),!1):(UserTips.ins().showTips("组队副本达到"+GlobalConfig.TeamFuBenBaseConfig.needZsLv+"转且开服第"+GlobalConfig.TeamFuBenBaseConfig.openDay+"天开启"),!1)},e.prototype.refushredPoint=function(){this.redPoint1.visible=!!Encounter.ins().isHasRed(),this.redPoint2.visible=Ladder.ins().isCanReward||Ladder.ins().isOpen?Ladder.ins().challgeNum>0:!1,this.redPoint3.visible=Mine.redpointCheck(),this.redPoint4.visible=UserFb.ins().checkTFRed(),this.redPoint5.visible=Hungu.ins().showHunShouRed()},e.prototype.updateMineRedPoint=function(t){this.redPoint3.visible=!!t},e.prototype.onTap=function(t){switch(t.currentTarget){case this.help:0==this.tab.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,10):1==this.tab.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,4):2==this.tab.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,14):4==this.tab.selectedIndex&&ViewManager.ins().open(ZsBossRuleSpeak,37);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.checkIsBack=function(t){var i=t.target;e.openCheck([i.selectedIndex])?ViewManager.ins().close(LimitTaskView):(t.$cancelable=!0,t.preventDefault())},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0;if(0==i){var s=GlobalConfig.SkirmishBaseConfig.openLevel,n=UserFb.ins().guanqiaID>=s;return n||UserTips.ins().showTips("通关到第"+s+"关开启遭遇战"),n}if(1==i){var s=GlobalConfig.TianTiConstConfig.openLevel,n=Actor.level>=s;return n||UserTips.ins().showTips(s+"级开启"),n}if(2==i){var n=Mine.openCheck(!0);return n}if(3==i){var n=!0;return n}if(4==i){var n=!0;return n}},e}(BaseEuiView);__reflect(LadderWin.prototype,"LadderWin"),ViewManager.ins().reg(LadderWin,LayerManager.UI_Main);var LastWeekRankItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.index=this.itemIndex+1,this.index<=3?(this.rankImg.source="paihang"+this.index,this.rank.text=""):(this.rank.text=this.index+"",this.rankImg.source=""),this.data instanceof RankDataLadder){var t=this.data;this.dwImg.source="ladder_rank_"+t.challgeLevel,this.nameLabel.text=t.player,this.winNum.text=t.winNum+"场",this.head.source="head_"+t.job+t.sex;var e=Ladder.ins().getLevelConfig(t.challgeLevel,t.challgeId);this.item1.data=Ladder.ins().creatRewardData(GlobalConfig.TianTiRankAwardConfig[this.index+""].award[0]),this.level.text=e.showDan+"",this.setlevelInfo(t.challgeLevel<4),1==this.index}else if(this.data instanceof TianTiDanConfig){var i=this.data;this.winNum.text="",this.nameLabel.text=i.showLevel+"段位",this.item1.data=Ladder.ins().creatRewardData(i.danAward[0]),this.setlevelInfo(!0),this.dwImg.source="ladder_rank_"+i.level,this.level.text=i.showDan+"",this.setlevelInfo(!1),this.rankImg.source="",this.rank.text=""}else this.winNum.text="",this.nameLabel.text="钻石段位第"+this.index+"名",this.item1.data=Ladder.ins().creatRewardData(GlobalConfig.TianTiRankAwardConfig[this.index+""].award[0]),this.dwImg.source="ladder_rank_4",this.setlevelInfo(!1),1==this.index},e.prototype.setlevelInfo=function(t){this.levelBg.visible=this.level.visible=t},e}(BaseItemRender);__reflect(LastWeekRankItemRenderer.prototype,"LastWeekRankItemRenderer");var LevelUpWayWin=function(t){function e(){var e=t.call(this)||this;return e.gainWay=[["通关关卡","GuanQiaRewardWin",0,3],["通天塔","FbWin",2,5],["击杀附近的人","LadderWin",0,4],["经验副本","FbWin",1,5]],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="LevelUpWaySkin",this.gainList.itemRenderer=GainGoodsItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.gainList.dataProvider=new eui.ArrayCollection(this.gainWay),this.gainList.validateNow();for(var i=0;i<this.gainList.numElements;i++){var s=this.gainList.getElementAt(i);if(s){var n=!1,o=void 0,a=void 0,r=void 0;0>=i?n=!0:1==i?(n=UserZs.ins().lv>=GlobalConfig.FbChallengeConfig[1].zsLevelLimit&&Actor.level>=GlobalConfig.FbChallengeConfig[1].levelLimit,o=GlobalConfig.FbChallengeConfig[1].levelLimit,a=GlobalConfig.FbChallengeConfig[1].zsLevelLimit):2==i?(n=UserFb.ins().guanqiaID>=GlobalConfig.SkirmishBaseConfig.openLevel,r=GlobalConfig.SkirmishBaseConfig.openLevel):3==i&&(n=Actor.level>=GlobalConfig.ExpFubenBaseConfig.openLv,o=GlobalConfig.ExpFubenBaseConfig.openLv),s.gainData(n,this.gainWay[i][3],{needLv:o,needZs:a,guanka:r})}}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){var i=t.item;if(null!=t.item){var s=ViewManager.ins().viewOpenCheck(i[1],i[2]);if(s){if(ViewManager.ins().closeTopLevel(),"GuanQiaRewardWin"==i[1])return UserFb.ins().guanqiaID<UserFb.AUTO_GUANQIA?(UserFb.ins().setAutoPk(),void ViewManager.ins().close(e)):(PlayFun.ins().openAuto(),GameGuider.challengeBoss(),void ViewManager.ins().close(e));GameGuider.guidance(i[1],i[2]),ViewManager.ins().close(e)}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(LevelUpWayWin.prototype,"LevelUpWayWin"),ViewManager.ins().reg(LevelUpWayWin,LayerManager.UI_Popup);var LiLian=function(t){function e(){var e=t.call(this)||this;return e.lilianReward=0,e.nobilityIsUpGrade=0,e.nobilityLv=0,e.xunzhangJF=0,e.liLianExpDay=0,e.liLianExpDayReward=0,e.jadeLv=0,e.isShow=!1,e.isXZShow=!1,e.skillCfgList=[],e.sysId=PackageID.Train,e.regNetMsg(1,e.postLilianData),e.regNetMsg(5,e.postNobilityData),e.regNetMsg(3,e.postTrainsDayAward),e.regNetMsg(10,e.postJadeLv),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendLilianUpgrade=function(){this.sendBaseProto(1)},e.prototype.sendNobilityUpgrade=function(){this.sendBaseProto(6)},e.prototype.sendNobilityStageUpgrade=function(){this.sendBaseProto(7)},e.prototype.sendGetLilianReward=function(){this.sendBaseProto(2)},e.prototype.postLilianData=function(t){var e=t.readInt();this.liLianExp=t.readInt(),this.lilianReward=t.readInt(),this.liLianExpDay=t.readInt(),this.liLianExpDayReward=t.readInt();var i=!1;return(e>this.liLianLv||this.checkShowRedPoint2())&&(i=!0),this.liLianLv=e,UserTask.ins().postUpdataTaskPoint(),i&&this.upDateRole(),this.getTraining?{flag:!1}:{flag:!0}},e.prototype.upDateRole=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=EntityManager.ins().getMainRole(e);if(i){var s=SubRoles.ins().getSubRoleByIndex(e);s.lilianLv=this.liLianLv,i.setCharName(s.guildAndName),i.setLilian(s.lilianUrl)}}},e.prototype.postNobilityData=function(t){this.isXZShow=!1;var e=t.readInt(),i=this.nobilityLv!=e;return this.nobilityLv=e,{refush:i}},e.prototype.postTrainsDayAward=function(t){var e=t.readBoolean();return this.getTraining=!1,e},e.prototype.sendTrainsDayAward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.setXunzhangJF=function(t){if(this.xunzhangJF!=t){if(this.xunzhangJF>0){var e=t-this.xunzhangJF,i=parseInt(e.toString());if(i>0){var s="|C:0xffd93f&T:获得"+i+"成就积分|";UserTips.ins().showTips(s)}}this.xunzhangJF=t}},e.prototype.getLiLianStast=function(){return this.getLilianShenGongStast()?!0:this.getNobilityIsUpGrade()&&!this.getNobilityIsMaxLevel?this.getNobilityIsUpGrade():Artifact.ins().showRedPoint()?!0:UserTask.ins().getIsHaveChengjiuReward()?!0:this.checkJueWeiOpen()&&this.getNobilityIsUpGrade()&&!this.getNobilityIsMaxLevel()?!0:this.checkJadeRed()?!0:this.checkShowRedPoint2()},e.prototype.checkJueWeiOpen=function(){var t=GlobalConfig.TrainBaseConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.checkXunZhangOpen=function(){var t=GlobalConfig.KnighthoodBasicConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.checkBookOpen=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOOK)},e.prototype.checkShowRedPoint2=function(){if(this.lilianReward<=0)return!1;var t=GlobalConfig.GuanYinAwardConfig[this.lilianReward];return this.liLianLv>=t.level},e.prototype.getLilianActiveState=function(){var t=GlobalConfig.TrainBaseConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.getLilianShenGongStast=function(){if(!this.getLilianActiveState())return!1;var t=GlobalConfig.TrainLevelConfig[this.liLianLv+1];return t&&this.liLianExp>=t.exp?!0:this.checkShowRedPoint2()},e.prototype.getLilianBtnState=function(){if(!this.getLilianActiveState())return!1;var t=GlobalConfig.TrainLevelConfig[this.liLianLv+1];return t&&this.liLianExp>=t.exp?!0:!1},e.prototype.getNobilityIsUpGrade=function(){for(var t=GlobalConfig.KnighthoodConfig[this.nobilityLv],e=0;e<t.achievementIds.length;e++){var i=t.achievementIds[e].taskId;if(i>0){var s=UserTask.ins().getAchieveByTaskId(i);if(!s)return!1;var n=UserTask.ins().getAchieveConfById(s.id);if(n.target>s.value)return!1}}return!0},e.prototype.getNobilityIsMaxLevel=function(){var t=GlobalConfig.KnighthoodConfig[this.nobilityLv+1];return t?!1:!0},e.prototype.getAllChengjiuData=function(){if(this._achievementTaskAllConfig)return this._achievementTaskAllConfig;this._achievementTaskAllConfig=[];var t=GlobalConfig.AchievementTaskConfig;for(var i in GlobalConfig.AchievementTaskConfig)t[i].achievementType>0&&this._achievementTaskAllConfig.push(t[i]);return this._achievementTaskAllConfig.sort(e.sort),this._achievementTaskAllConfig},e.sort=function(t,e){return t.achievementType>e.achievementType?1:t.achievementType<e.achievementType?-1:0},e.prototype.getChengjiuData=function(t){for(var e=this.getAllChengjiuData(),i=[],s=0,n=e;s<n.length;s++){var o=n[s];o.achievementType==t&&i.push(o)}return i},e.prototype.chengjiuMaxData=function(){if(this._chengjiuMaxData)return this._chengjiuMaxData;this._chengjiuMaxData=[];for(var t=this.getAllChengjiuData(),e=-1,i=0,s=t;i<s.length;i++){var n=s[i];e!=n.achievementType&&(e=n.achievementType,this._chengjiuMaxData.push(e))}return this._chengjiuMaxData},e.prototype.getPower=function(){return GlobalConfig.TrainLevelConfig[this.liLianLv].power},e.prototype.getCruLevelSkillCfg=function(t){void 0===t&&(t=!1);var e=GlobalConfig.TrainLevelAwardConfig;if(this.skillCfgList.length<=0)for(var i in e)this.skillCfgList.push(e[i]);for(var s=null,n=0,o=this.skillCfgList;n<o.length;n++){var i=o[n];if(i.level>this.liLianLv){s=i;break}}if(t)return s;var a=s?s.id-1:0;return e[a]},e.prototype.postGetLilianReward=function(t){return t},e.prototype.getTrainDayAwardConfigs=function(t){var e=Object.keys(GlobalConfig.TrainDayAwardConfig);e.sort(this.setSortTrainAwards);for(var i=0;i<e.length;i++)if(t>=Number(e[i]))return GlobalConfig.TrainDayAwardConfig[e[i]];return null},e.prototype.jadeUpgrade=function(){this.sendBaseProto(10)},e.prototype.setSortTrainAwards=function(t,e){return Number(t)>Number(e)?-1:1},e.prototype.isGetTrainDayAward=function(t){var e=this.getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(!e||!e[t])return!1;if(this.liLianExpDayReward>>t&1);else if(this.liLianExpDay>=e[t].score)return!0;return!1},e.prototype.isGetTrainDayAwardAll=function(){if(!this.getLilianActiveState())return!1;var t=this.getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(!t)return!1;for(var e in t)if(this.liLianExpDayReward>>+e&1);else if(this.liLianExpDay>=t[+e].score)return!0;return!1},e.prototype.postJadeLv=function(t){this.jadeLv=t.readInt()},e.prototype.isJadeMax=function(){return this.jadeLv>=Object.keys(GlobalConfig.YuPeiConfig).length-1},e.prototype.checkJadeRed=function(){return!1},e}(BaseSystem);__reflect(LiLian.prototype,"LiLian");var GameSystem;!function(t){t.lilian=LiLian.ins.bind(LiLian)}(GameSystem||(GameSystem={}));var ChengjiuPanel=function(t){function e(){var e=t.call(this)||this;return e._chengjiuData=[],e.skinName="ChengjiuPanelSkin",e.name="成就",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=ChengjiuItem,this.list.dataProvider=this.listArrColl=new eui.ArrayCollection,this.tab.itemRenderer=ChengjiuTagItem,this.tabArrColl=new eui.ArrayCollection(LiLian.ins().chengjiuMaxData()),this.tab.dataProvider=this.tabArrColl,this.tab.visible=!1},e.prototype.open=function(){this.addTouchEvent(this.list,this.onTab),this.addChangeEvent(this.tab,this.onTabChange),this.observe(UserTask.ins().postTaskChangeData,this.updateAchieve),this.tab.visible=!0,this.tab.selectedIndex=0,this.updateAchieve()},e.prototype.close=function(){this.removeTouchEvent(this.list,this.onTab),this.removeObserve()},e.prototype.onTab=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;switch(e.btn.labelDisplay.text){case"前往":GameGuider.taskGuidance(e.id,1);break;case"领取":UserTask.ins().sendGetAchieve(e.achievementId)}}},e.prototype.onTabChange=function(t){this.listArrColl.source=UserTask.ins().getChengjiuDataByType(this.tab.selectedItem)},e.prototype.updateAchieve=function(){this.tabArrColl.replaceAll(LiLian.ins().chengjiuMaxData()),this.nextCanTab(this.tab.selectedItem),this.listArrColl.source=UserTask.ins().getChengjiuDataByType(this.tab.selectedItem)},e.prototype.nextCanTab=function(t){if(!this.canReceive(t)){for(var e=this.tab.selectedIndex,i=0,s=this.tab.numChildren;s>i;i++)if(this.tab.selectedIndex=i,this.canReceive(this.tab.selectedItem))return;this.tab.selectedIndex=e}},e.prototype.canReceive=function(t){var e=UserTask.ins().getChengjiuDataByType(t);for(var i in e)if(1==e[i].state)return!0;return!1},e}(BaseView);__reflect(ChengjiuPanel.prototype,"ChengjiuPanel");var ChengjiuTagItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChengjiuTagSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.nameImg.source="task_json.name_"+this.data,this.redPoint.visible=UserTask.ins().getIsHaveChengjiuRewardBytype(this.data)},e}(BaseItemRender);__reflect(ChengjiuTagItem.prototype,"ChengjiuTagItem");var ChengjiuItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChengjiuItemSkin",e.mc=e.mc||new MovieClip,e.mc.x=e.btn.x+46,e.mc.y=e.btn.y+45,e.mc.scaleY=.8,e.mc.scaleX=.9,e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=UserTask.ins().getAchieveConfById(this.data.id);this.id=this.data.id,this.achievementId=this.data.achievementId,this.list.dataProvider=new eui.ArrayCollection(e.awardList),this.titleTF.textFlow=TextFlowMaker.generateTextFlow(e.name);var i="进度：|C:0x35e62d&T:"+CommonUtils.overLengthChange(this.data.value)+"/"+CommonUtils.overLengthChange(e.target)+"|";switch(this.progressTF.textFlow=TextFlowMaker.generateTextFlow(i),this.btn.visible=!0,this.mc&&this.mc.parent&&DisplayUtils.removeFromParent(this.mc),this.data.state){case 0:this.btn.labelDisplay.text="前往",this.btn.enabled=!0,0==e.control&&(this.btn.visible=!1);break;case 1:this.btn.labelDisplay.text="领取",this.btn.enabled=!0,this.mc&&(this.mc.playFile(RES_DIR_EFF+"normalbtn",-1),this.addChild(this.mc));break;case 2:this.btn.labelDisplay.text="已完成",this.btn.enabled=!1}},e}(BaseItemRender);__reflect(ChengjiuItem.prototype,"ChengjiuItem");var JadeItem=function(t){function e(){var e=t.call(this)||this;return e.perLevel=11,e._oldLevel=-1,e._oldJade=0,e._mcList=[],e}return __extends(e,t),e.prototype.setLevel=function(t,e){var i=this;if(t!=this._oldLevel){this._oldLevel=t;var s=Math.floor(t/(9*this.perLevel)),n=(Math.floor(t/this.perLevel)+1)%9;this.skinName="YuPei"+s+"Skin",0==n&&(n=9),this._nexMc&&this._nexMc.parent&&this._nexMc.parent.removeChild(this._nexMc);for(var o,a,r=1;9>=r;r++){if(o=this._mcList[r-1],o&&o.parent&&o.parent.removeChild(o),this._oldJade!=s&&o&&o.stop(),r>1&&(this["line"+(r-2)].visible=!1),a=!1,n>=r)if(n>r||t%this.perLevel==10){if(o||(o=new MovieClip,this._mcList[r-1]=o),this["processEff"+(r-1)].addChild(o),r==n&&e){if(!o.isPlaying){var h=egret.Tween.get(this);o.playFile(RES_DIR_EFF+"bally3",1,null,!1),h.wait(800).call(function(){i._mcList[n-1].playFile(RES_DIR_EFF+"ballb2",-1)})}}else o.isPlaying||o.playFile(RES_DIR_EFF+"ballb2",-1);r>1&&(this["line"+(r-2)].visible=!0)}else a=!0;else a=!this._nexMc||!this._nexMc.parent;a&&(this._nexMc||(this._nexMc=new MovieClip),this["processEff"+(r-1)].addChild(this._nexMc),this._nexMc.isPlaying||this._nexMc.playFile(RES_DIR_EFF+"ballb1",-1),r>1&&(this["line"+(r-2)].visible=!0))}this._oldJade=s}},e.prototype.close=function(){t.prototype.close.call(this),Tween.removeTweens(this);for(var e=this._mcList.length,i=0;e>i;i++)this._mcList[i].dispose(),this._mcList[i]=null;this._mcList.length=0,this._mcList=null,this._nexMc&&(this._nexMc.dispose(),this._nexMc=null)},e}(BaseComponent);__reflect(JadeItem.prototype,"JadeItem");var JadePanel=function(t){function e(){var e=t.call(this)||this;return e._starList=null,e._oldLevel=0,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._starList=new StarList(10),this._starList.x=15,this._starList.y=0,this.starGroup.addChild(this._starList),this._iconY=this.yupei.y,this._iconMoveY=this.yupei.y-10},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._oldLevel=LiLian.ins().jadeLv,this.observe(LiLian.ins().postJadeLv,this.update),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.addTouchEvent(this,this.onTouch),this.update(),this.playIconTween()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onTouch),this.stopIconTween()},e.prototype.playIconTween=function(){this.yupei.y=this._iconY,egret.Tween.removeTweens(this.yupei),egret.Tween.get(this.yupei,{loop:!0}).to({y:this._iconMoveY},1e3).to({y:this._iconY},1e3)},e.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.yupei)},e.prototype.update=function(){var t,e=LiLian.ins().jadeLv,i=[],s=GlobalConfig.YuPeiConfig[e],n=0;for(var o in s.attrs)t=s.attrs[o],t.type==AttributeType.atYuPeiDeterDam&&(n=Math.floor(t.value/1e4*100)),i.push(new AttributeData(t.type,t.value));this.powerPanel.setPower(UserBag.getAttrPower(i));var a=Math.floor(e/GlobalConfig.YuPeiBasicConfig.perLevel)+1;this.stairImg.setValue(a);var r,h=LiLian.ins().isJadeMax();if(h)this.maxGroup.visible=!1,this.maxLevel.visible=this.maxShowGroup.visible=!0,this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："));else{this.maxGroup.visible=!0,r=this._oldLevel!=e,this._starList.setStarNum(e%GlobalConfig.YuPeiBasicConfig.perLevel,r?1:0),this._oldLevel=e,this.updateMaterial(),this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"：")),i=[];var l=GlobalConfig.YuPeiConfig[e+1];for(var o in l.attrs)i.push(new AttributeData(l.attrs[o].type,l.attrs[o].value));this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："))}this.yupei.setLevel(e,r&&e%GlobalConfig.YuPeiBasicConfig.perLevel==10)},e.prototype.updateMaterial=function(){var t=LiLian.ins().isJadeMax();if(!t){var e=LiLian.ins().jadeLv,i="";this._materialEn=!0;var s=GlobalConfig.YuPeiConfig[e];if(s.item_id>0){var n=GlobalConfig.ItemConfig[s.item_id],o=UserBag.ins().getBagItemById(s.item_id),a=o?o.count:0;i="拥有"+n.name+":|C:"+(a<s.count?"0xFF0000":"0x00FF00")+"&T:"+a+"|/"+s.count,this._materialEn=a>=s.count}this.material.textFlow=TextFlowMaker.generateTextFlow1(i),this.redPoint.visible=LiLian.ins().checkJadeRed(),this.upgradeBtn.label=this._materialEn?e%GlobalConfig.YuPeiBasicConfig.perLevel==10?"升阶":"升级":"获得材料",this.upgradeBtn.visible=!t}},e.prototype.onTouch=function(t){switch(t.target){case this.upgradeBtn:if(!this._materialEn)return void UserWarn.ins().setBuyGoodsWarn(GlobalConfig.YuPeiConfig[LiLian.ins().jadeLv].item_id);LiLian.ins().jadeUpgrade();break;case this.closeBtn:ViewManager.ins().close(LiLianWin);break;case this.deter:ViewManager.ins().open(JadeSkillWin)}},e}(BaseEuiView);__reflect(JadePanel.prototype,"JadePanel");var JadeSkillWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="YupeiSkillTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose);var i=GlobalConfig.YuPeiConfig[LiLian.ins().jadeLv],s="0";for(var n in i.attrs)if(i.attrs[n].type==AttributeType.atYuPeiDeterDam){s=(i.attrs[n].value/100).toFixed(1);break}this.content.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.YuPeiBasicConfig.deterDesc.replace("{0}",s+"%"))},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(JadeSkillWin.prototype,"JadeSkillWin"),ViewManager.ins().reg(JadeSkillWin,LayerManager.UI_Main);var LiLianItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LiLianItemSkin",e.isClose=!1,e.goOnTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.goOnTxt.text+"</u></a>"),e.goOnTxt.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.DailyConfig[t.id];this.nameTxt.text=e.name,this.descTxt.textFlow=TextFlowMaker.generateTextFlow("|C:0x35e62d&T:"+t.value+"/"+e.target+"|"),this.liLianNumTxt.text=e.trainExp+"历练",t.state>0?(this.sureImg.visible=!0,this.goOnTxt.visible=!1):(this.sureImg.visible=!1,this.goOnTxt.visible=!0),(1==t.id||3==t.id||4==t.id||5==t.id||6==t.id||7==t.id||8==t.id||9==t.id||10==t.id)&&(this.isClose=!0)}},e}(BaseItemRender);__reflect(LiLianItem.prototype,"LiLianItem");var LiLianTips=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="LiLianTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeObserve()},e.prototype.setPanel=function(){var t=LiLian.ins().getCruLevelSkillCfg(),e=LiLian.ins().getCruLevelSkillCfg(!0);if(t){this.skillIcon.source=t.icon+"",this.skillName.text=t.skillname,this.cruDesc.textFlow=TextFlowMaker.generateTextFlow(t.desc);var i=GlobalConfig.TrainLevelConfig[t.level],s="·"+i.trainName;this.currTrainName.textFlow=TextFlowMaker.generateTextFlow(s)}if(e){this.nextDesc.textFlow=TextFlowMaker.generateTextFlow(e.desc);var n=GlobalConfig.TrainLevelConfig[e.level],o="·"+n.trainName;this.nextTrainName.textFlow=TextFlowMaker.generateTextFlow(o)}else this.nextDesc.text=""},e.prototype.onTap=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(LiLianTips.prototype,"LiLianTips"),ViewManager.ins().reg(LiLianTips,LayerManager.UI_Popup);var LiLianWin=function(t){function e(){var i=t.call(this)||this;return i.oldIndex=e.JUEWEI,i.skinName="LiLianWinSkin",i.isTopLevel=!0,i}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this);var i=e.JUEWEI;LiLian.ins().checkJueWeiOpen()||(i=e.SHENQI),this.viewStack.selectedIndex=i,this.tab.dataProvider=this.viewStack,this.tab.validateNow()},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=void 0==t[0]?e.SHENQI:t[0];switch(s){case e.SHENQI:break;case e.JUEWEI:if(!LiLian.ins().checkJueWeiOpen())return UserTips.ins().showTips("激活神器 霸者之证 后开启"),!1;break;case e.XUNZHANG:if(!LiLian.ins().checkXunZhangOpen())return UserTips.ins().showTips("激活神器 太初勋章 后开启"),!1;break;case e.BOOK:if(!LiLian.ins().checkBookOpen())return UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOOK)),!1;break;case e.WEIWANG:if(!WeiWangCC.ins().isOpen)return UserTips.ins().showTips("开服第"+GlobalConfig.PrestigeBase.openDay+"天"+GlobalConfig.PrestigeBase.openLevel+"级开启"),!1}return!0},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTapTouching),this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.help,this.onTouch),this.observe(LiLian.ins().postLilianData,this.delayRedPoint),this.observe(LiLian.ins().postNobilityData,this.delayRedPoint),this.observe(UserTask.ins().postTaskChangeData,this.delayRedPoint),this.observe(Artifact.ins().postNewArtifactUpdate,this.delayRedPoint),this.observe(Artifact.ins().postNewArtifactInit,this.delayRedPoint),this.observe(BookRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(BookRedPoint.ins().postLvlUp,this.delayRedPoint),this.observe(Box.ins().postUpdateData,this.delayRedPoint),this.observe(Box.ins().postUpdateFreeBox,this.delayRedPoint),this.observe(LiLian.ins().postJadeLv,this.delayRedPoint),this.observe(UserBag.ins().postItemAdd,this.delayRedPoint),this.observe(UserBag.ins().postItemChange,this.delayRedPoint);var s=e.JUEWEI;LiLian.ins().checkJueWeiOpen()||(s=e.SHENQI),t[0]&&(s=t[0]),this._ext=t[1],this.help.visible=!1,this.setOpenTabIndex(s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.viewStack.numChildren,s=0;i>s;s++)this.viewStack.getChildAt(s).close();var n=ViewManager.ins().getView(UIView2);n&&n.closeNav(UIView2.NAV_LILIAN)},e.prototype.setOpenTabIndex=function(t){this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.setOpenIndex(t),this.setRedPoint()},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:}},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case e.SHENQI:this.artifactWin.open();break;case e.JUEWEI:LiLian.ins().checkJueWeiOpen()?this.liLianPanel.open():(UserTips.ins().showTips("激活神器 霸者之证 后开启"),this.tab.selectedIndex=this.oldIndex);break;case e.XUNZHANG:LiLian.ins().checkXunZhangOpen()?this.xunzhangPanel.open():(UserTips.ins().showTips("激活神器 太初勋章 后开启"),this.tab.selectedIndex=this.oldIndex);break;case e.BOOK:LiLian.ins().checkBookOpen()?this._ext?(this.bookPanel.open(this._ext),this._ext=null):this.bookPanel.open():(UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOOK)),this.tab.selectedIndex=this.oldIndex);break;case e.WEIWANG:WeiWangCC.ins().isOpen?this.WeiWang.open():(UserTips.ins().showTips("开服第"+GlobalConfig.PrestigeBase.openDay+"天"+GlobalConfig.PrestigeBase.openLevel+"级开启"),this.tab.selectedIndex=this.oldIndex)}this.oldIndex=this.tab.selectedIndex},e.prototype.delayRedPoint=function(){TimerManager.ins().isExists(this.setRedPoint,this)||TimerManager.ins().doTimer(60,1,this.setRedPoint,this)},e.prototype.setRedPoint=function(){var t=LiLian.ins();this.redPoint0.visible=Artifact.ins().showRedPoint(),this.redPoint1.visible=t.getLilianShenGongStast()||t.isGetTrainDayAwardAll();var e=LiLian.ins().getNobilityIsMaxLevel();this.redPoint2.visible=t.checkXunZhangOpen()&&t.getNobilityIsUpGrade()&&!e,this.redPoint3.visible=BookRedPoint.ins().redpoint||BookRedPoint.ins().canLvlUp,this.redPoint4.visible=!1},e.prototype.onTapTouching=function(t){return e.openCheck(t.currentTarget.selectedIndex)?void ViewManager.ins().close(LimitTaskView):void t.preventDefault()},e}(BaseEuiView);LiLianWin.SHENQI=1,LiLianWin.JUEWEI=0,LiLianWin.XUNZHANG=2,LiLianWin.BOOK=3,LiLianWin.WEIWANG=4,__reflect(LiLianWin.prototype,"LiLianWin"),ViewManager.ins().reg(LiLianWin,LayerManager.UI_Main);var NewLilianWin=function(t){function e(){var e=t.call(this)||this;return e.barbc=new ProgressBarEff,e.name="爵位",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=LiLianItem,this.itemList.itemRenderer=ItemBase,this.barbc.setWidth(525),this.barbc.x=3,this.barbc.y=-15,this.expGroup.addChild(this.barbc),this.eff=new MovieClip,this.eff.x=468,this.eff.y=47,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.item4.isShowName(!1),this.trainMc={}
},e.prototype.open=function(){this.addTouchEvent(this.list,this.onListTouch),this.addTouchEvent(this.upgradeBtn,this.onUpgrade),this.addTouchEvent(this.UplevelBtn0,this.onActive),this.addTouchEvent(this.reward,this.sendGetReward),this.observe(UserTask.ins().postTaskChangeData,this.setWinData),this.observe(LiLian.ins().postLilianData,this.onListChange),this.observe(LiLian.ins().postTrainsDayAward,this.updateProgress);for(var t=1;4>=t;t++)this.addTouchEvent(this["isget"+t],this.onGiftClick);this.barbc.reset(),this.setWinData(),this.showActPanel(),this.activeTipsTxt0.text="激活神器 霸者之证 可开启爵位晋升之路"},e.prototype.close=function(){this.removeTouchEvent(this.list,this.onListTouch),this.removeTouchEvent(this.upgradeBtn,this.onUpgrade),this.removeTouchEvent(this.UplevelBtn0,this.onActive),this.removeTouchEvent(this.reward,this.sendGetReward),DisplayUtils.removeFromParent(this.eff);for(var t in this.trainMc)DisplayUtils.removeFromParent(this.trainMc[t]);for(var t=1;4>=t;t++)this.removeTouchEvent(this["isget"+t],this.onGiftClick)},e.prototype.sendGetReward=function(){UserBag.ins().getSurplusCount()>=1?LiLian.ins().sendGetLilianReward():UserTips.ins().showTips("|C:0xff0000&T:背包已满，请清理背包|")},e.prototype.showActPanel=function(){this.Activation.visible=!1,this.showAct.visible=!this.Activation.visible},e.prototype.onActive=function(t){switch(t.currentTarget){case this.UplevelBtn0:LiLian.ins().getLilianActiveState()||(UserTips.ins().showTips("激活神器 霸者之证 后开启"),t.$cancelable=!0,t.preventDefault())}},e.prototype.onGiftClick=function(t){for(var e=1;4>=e;e++)if(t.currentTarget==this["isget"+e]){var i=this["gift"+e].getItemIcon();LiLian.ins().getTraining=!0,this.flyItem(i),LiLian.ins().sendTrainsDayAward(e);break}},e.prototype.flyItem=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.onUpgrade=function(t){var e=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];if(e){var i=LiLian.ins().liLianExp;i>=e.exp?LiLian.ins().sendLilianUpgrade():UserTips.ins().showTips("|C:0xf3311e&T:历练不足，无法升级|")}},e.prototype.onSeeSkill=function(t){ViewManager.ins().open(LiLianTips)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Label){var e=t.target.parent;e.isClose||ViewManager.ins().close(LiLianWin),FbWin.isClose=e.isClose,GameGuider.taskGuidance(e.data.id,0),ViewManager.ins().close(LimitTaskView)}},e.prototype.onListChange=function(t){var e=t.flag;if(e&&(this.lilianUpgradeSuccess(),this.setWinData()),this.showActPanel(),LiLian.ins().isShow){var i=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1],s="juewei_"+i.type+"_1";Activationtongyong.show(0,i.trainName,s+"_png")}},e.prototype.setWinData=function(){var t=LiLian.ins().liLianLv;this._totalPower=LiLian.ins().getPower(),this.powerPanel.setPower(this._totalPower);var e=GlobalConfig.TrainLevelConfig[t];if(!ErrorLog.Assert(e,"LiLianPanel  config is null  lv = "+t)){var i=e.type>14?14:e.type;this.imgMedal.source="juewei_1_"+i+"_png",this.levelImg.source=e.img?e.img:"juewei_0_"+i+"_png",this.levelLabel.text=e.trainlevel+"等";LiLian.ins().getCruLevelSkillCfg();this.attrTxt.text=AttributeData.getAttStr(e.attrAward,0,1,"：");var s=GlobalConfig.TrainLevelConfig[t+1];if(s){for(var n="",o=0;o<s.attrAward.length;o++)n+=s.attrAward[o].value,o<s.attrAward.length-1&&(n+="\n");this.nextTxt.text=n,this.itemList.dataProvider=new eui.ArrayCollection(s.itemAward),this.currentState="nomax";var a=1==e.trainlevel?s.trainName:"";this.levelLabel0.text=s.trainlevel+"等"+a}else this.currentState="max",this.itemList.dataProvider=new eui.ArrayCollection([]);this.expChange();var r=UserTask.ins().task;this.list.dataProvider=new eui.ArrayCollection(r),this.list.validateNow(),this.addRewardRefush(),this.updateProgress()}},e.prototype.addRewardRefush=function(){if(LiLian.ins().lilianReward>0){this.addReward.visible=!0;var t=LiLian.ins().lilianReward,e=GlobalConfig.GuanYinAwardConfig,i=e[t];if(Assert(i,"获取神功达标奖励异常"))return;var s=new ItemData;s.configID=i.award.id,this.item4.data=s,this.reward.visible=this.reward.enabled=LiLian.ins().checkShowRedPoint2(),this.tipsGroup.visible=!this.reward.visible,this.targetLevel.text=i.level-LiLian.ins().liLianLv+""}else this.addReward.visible=!1,this.reward.enabled=!1,this.tipsGroup.visible=!1},e.prototype.expChange=function(){var t=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];t||(t=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv]);var e=t.exp,i=LiLian.ins().liLianExp,s=i>=e;s?(this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.upInfo.addChild(this.eff)):DisplayUtils.removeFromParent(this.eff),this.barbc.setData(i,e),this.redPoint.visible=LiLian.ins().getLilianBtnState(),this.redPoint0.visible=LiLian.ins().checkShowRedPoint2()},e.prototype.lilianUpgradeSuccess=function(){for(var t=this.itemList.dataProvider.length,e=[],i=0;t>i;i++){var s=this.itemList.getVirtualElementAt(i);e.push(s.getItemSoure())}LiLian.ins().postGetLilianReward(e)},e.prototype.updateProgress=function(){var t=LiLian.ins().getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(t){this.lilianed.text=LiLian.ins().liLianExpDay+"";for(var e in t){var i=t[e];if(i){this["lilian"+e].text=i.score+"历练";GlobalConfig.ItemConfig[i.reward[0].id];if(this["gift"+e].data={id:i.reward[0].id,type:i.reward[0].type,count:i.reward[0].count},this["gift"+e].isShowName(!1),this["bar"+e].maximum=100,this["lingqu"+e].touchEnabled=!1,LiLian.ins().liLianExpDayReward>>i.id&1)this["bar"+e].value=100,this["lingqu"+e].visible=!0,this["isget"+e].touchEnabled=!1;else if(this["lingqu"+e].visible=!1,LiLian.ins().liLianExpDay>=i.score)this["bar"+e].value=100,this["isget"+e].touchEnabled=!0;else{var s=t[Number(e)-1],n=LiLian.ins().liLianExpDay,o=i.score;s&&(n=LiLian.ins().liLianExpDay-s.score,o=i.score-s.score),n=n>0?n:0,this["bar"+e].value=Math.floor(n/o*100),this["isget"+e].touchEnabled=!1}this.updateTrainEff(i.id)}}}},e.prototype.updateTrainEff=function(t){this.trainMc[t]||(this.trainMc[t]=new MovieClip);var e=LiLian.ins().isGetTrainDayAward(t);this["redPoint"+t].visible=e,e?this.trainMc[t].parent||(this["eff"+t].parent.addChild(this.trainMc[t]),this.trainMc[t].playFile(RES_DIR_EFF+"openRole1",-1),this.trainMc[t].x=this["eff"+t].x,this.trainMc[t].y=this["eff"+t].y):DisplayUtils.removeFromParent(this.trainMc[t])},e}(BaseEuiView);__reflect(NewLilianWin.prototype,"NewLilianWin"),ViewManager.ins().reg(NewLilianWin,LayerManager.UI_Popup);var NobilityItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="NobilityItemSkin",e.goOnTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.goOnTxt.text+"</u></a>"),e.goOnTxt.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=UserTask.ins().getAchieveConfById(t.id),i=e.name+"|C:0x35e62d&T:("+t.value+"/"+e.target+")|";this.nameTxt.textFlow=TextFlowMaker.generateTextFlow(i),t.state>0?(this.sureImg.visible=!0,this.goOnTxt.visible=!1):(this.sureImg.visible=!1,this.goOnTxt.visible=Boolean(e.control))}},e}(BaseItemRender);__reflect(NobilityItem.prototype,"NobilityItem");var NobilityPanel=function(t){function e(){var e=t.call(this)||this;return e._totalPower=0,e.skinName="NobilitySkin",e.name="爵位",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=NobilityItem,this.totalPower=BitmapNumber.ins().createNumPic(0,"1"),this.totalPower.x=182,this.totalPower.y=63,this.addChild(this.totalPower),this.promoteeff=new MovieClip,this.promoteeff.x=214,this.promoteeff.y=260},e.prototype.open=function(){this.addTouchEvent(this.list,this.onListTouch),this.addTouchEvent(this.sureBtn,this.onUpgrade),this.observe(UserTask.ins().postTaskChangeData,this.setData),this.observe(LiLian.ins().postNobilityData,this.setData),this.setData()},e.prototype.close=function(){this.removeTouchEvent(this.list,this.onListTouch),this.removeTouchEvent(this.sureBtn,this.onUpgrade),this.removeObserve()},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Label){var e=t.target.parent;GameGuider.taskGuidance(e.data.id,1)}},e.prototype.onUpgrade=function(t){LiLian.ins().getNobilityIsUpGrade()?LiLian.ins().sendNobilityUpgrade():UserTips.ins().showTips("|C:0xf3311e&T:任务条件没达成，无法升级|")},e.prototype.setData=function(){var t=LiLian.ins().nobilityLv;t>=0&&null!=t?t:t=0;var e=GlobalConfig.KnighthoodConfig[t];this.lvTxt.text=e.desc,this.attrTxt.text=AttributeData.getAttStr(e.attrs,0,1,"：");var i=UserBag.getAttrPower(e.attrs);i>this._totalPower&&this._totalPower>0&&this.playEff(),this._totalPower=i,BitmapNumber.ins().changeNum(this.totalPower,this._totalPower*SubRoles.ins().subRolesLen,"1");for(var s=[],n=0;n<e.achievementIds.length;n++)s.push(UserTask.ins().getAchieveByTaskId(e.achievementIds[n].taskId));this.list.dataProvider=new eui.ArrayCollection(s);var o=GlobalConfig.KnighthoodConfig[t+1];o?(this.nextAttrTxt.text=AttributeData.getAttStr(o.attrs,0,1,"："),LiLian.ins().getNobilityIsUpGrade()?(this.mc=this.mc||new MovieClip,this.mc.x=215,this.mc.y=507,this.mc.playFile(RES_DIR_EFF+"normalbtn",-1),this.addChild(this.mc)):this.mc&&DisplayUtils.removeFromParent(this.mc)):(this.mc&&DisplayUtils.removeFromParent(this.mc),this.nextGroup.visible=!1,this.lvTxt.horizontalCenter=0,this.attrTitleTxt.horizontalCenter=0,this.attrTxt.horizontalCenter=0,this.completely.visible=!0)},e.prototype.playEff=function(){this.promoteeff.playFile(RES_DIR_EFF+"promoteeff",1),this.addChild(this.promoteeff)},e}(BaseView);__reflect(NobilityPanel.prototype,"NobilityPanel");var WeiWangItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="WeiWangItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.title.source=t.res,this.value.text=t.exp+""},e}(BaseItemRender);__reflect(WeiWangItemRender.prototype,"WeiWangItemRender");var WeiWangOverViewWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WeiWangOverViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=WeiWangItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onOtherClose),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onOtherClose)},e.prototype.update=function(){for(var t=[],e=Object.keys(GlobalConfig.PrestigeLevel).length,i=1;e>=i;i++)t.push(GlobalConfig.PrestigeLevel[i]);this.list.dataProvider=new eui.ArrayCollection(t.reverse())},e.prototype.onOtherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(WeiWangOverViewWin.prototype,"WeiWangOverViewWin"),ViewManager.ins().reg(WeiWangOverViewWin,LayerManager.UI_Popup);var WeiWangPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text),this.findItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.findItemTxt.text),this.overViewTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.overViewTxt.text)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(Actor.ins().postWeiWang,this.update),this.observe(WeiWangCC.ins().postWeiWangBack,this.updateBack),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.observe(Rank.ins().postRankingData,this.updateRank),this.update(),this.updateBack(),Rank.ins().sendGetRankingData(RankDataType.TYPE_WEIWANG),this.updateRank(Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG))},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve(),this.removeEffect(),this._topThree&&(this._topThree.length=0),this._topThree=null},e.prototype.updateRank=function(t){if(!t||t.type==RankDataType.TYPE_WEIWANG){var e,i,s=t?t.getDataList():null,n=s?s.length:0;this._topThree=[];for(var o=1;3>=o;o++)i=o-1,n>=o?(e=s[i],this["praiseGroup"+i].visible=!0,this["name"+i].text=e.player,this._topThree[i]=e.id,this["bodyImg"+i].name=e.id+"",UserReadPlayer.ins().sendFindPlayer(e.id)):(this["praiseGroup"+i].visible=!1,this["name"+i].text="暂无");i=this._topThree.indexOf(Actor.actorID),this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrestigeBase.skillTips[-1==i?0:i+1])}},e.prototype.update=function(){this._weiWangCfg=WeiWangCC.ins().getWeiWangCfg(Actor.weiWang);var t=this._weiWangCfg.level==Object.keys(GlobalConfig.PrestigeLevel).length;this.notMaxGroup.visible=!t,this.maxShowGroup.visible=t;var e=[];for(var i in this._weiWangCfg.attr)e.push(new AttributeData(this._weiWangCfg.attr[i].type,this._weiWangCfg.attr[i].value));var s;if(t)this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(e,0,1,"："));else{this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(e,0,1,"：")),e=[],s=GlobalConfig.PrestigeLevel[this._weiWangCfg.level+1];for(var i in s.attr)e.push(new AttributeData(s.attr[i].type,s.attr[i].value));this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(e,0,1,"："))}this._weiWangCfg.retrieve?this.info.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrestigeBase.recycle.replace("{0}",this._weiWangCfg.retrieve+"")):this.info.text="",this.expBar.maximum=s?s.exp:this._weiWangCfg.exp,this.expBar.value=Actor.weiWang,this.expLabel.text=Actor.weiWang+"/"+(Actor.weiWang>this.expBar.maximum?"???":this.expBar.maximum),this.myTitle.source=this._weiWangCfg.res},e.prototype.updateBack=function(){this.findItemTxt.visible=WeiWangCC.ins().weiWangBack>0,this.findItemTxt.visible?(this._backEff||(this._backEff=ObjectPool.pop("MovieClip")),this._backEff.parent||(this.findItemTxt.parent.addChild(this._backEff),this._backEff.x=this.findItemTxt.x+this.findItemTxt.width/2,this._backEff.y=this.findItemTxt.y+this.findItemTxt.height/2,this._backEff.touchEnabled=!1,this._backEff.scaleY=.5,this._backEff.scaleX=.6),this._backEff.isPlaying||this._backEff.playFile(RES_DIR_EFF+"chargeff1",-1)):this.removeEffect()},e.prototype.removeEffect=function(){this._backEff&&(DisplayUtils.removeFromParent(this._backEff),this._backEff.destroy(),this._backEff=null)},e.prototype.onTouch=function(t){switch(t.target){case this.getItemTxt:UserWarn.ins().setBuyGoodsWarn(MoneyConst.weiWang);break;case this.findItemTxt:WarnWin.show("是否确定花费"+WeiWangCC.ins().weiWangBack*GlobalConfig.PrestigeBase.cost+"元宝找回"+WeiWangCC.ins().weiWangBack+"点威望值？",function(){Actor.yb<WeiWangCC.ins().weiWangBack*GlobalConfig.PrestigeBase.cost?UserTips.ins().showTips("元宝不足，请充值！"):WeiWangCC.ins().sendFindWeiWang()},this);break;case this.overViewTxt:ViewManager.ins().open(WeiWangOverViewWin);break;case this.closeBtn:ViewManager.ins().close(LiLianWin);break;case this.title0:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[0]);break;case this.title1:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[1]);break;case this.title2:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[2]);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[24].text);break;case this.bodyImg0:case this.bodyImg1:case this.bodyImg2:this._openOtherWin=!0,UserReadPlayer.ins().sendFindPlayer(Number(t.target.name));break;case this.checkBtn:ViewManager.ins().open(RankingWin,RankDataType.TYPE_WEIWANG)}},e.prototype.openOtherPlayerView=function(t){if(this._openOtherWin)ViewManager.ins().open(RRoleWin,t),this._openOtherWin=!1;else{var e=this._topThree.indexOf(t.id);if(0>e)return;var i=t.roleData[0],s=i.zhuangbei,n=void 0,o=s[0],a=s[1],r=i.getEquipByIndex(0),h=r.item.configID,l=i.getEquipByIndex(2),c=l.item.configID;if(this["weaponImg"+e].source=null,this["bodyImg"+e].source=null,h>0){var u=GlobalConfig.EquipConfig[h].appearance;u&&u.indexOf("[job]")>-1&&(u=u.replace("[job]",i.job+"")),this["weaponImg"+e].source=u+"_"+i.sex+"_c_png"}if(c>0){var u=GlobalConfig.EquipConfig[c].appearance;u&&u.indexOf("[job]")>-1&&(u=u.replace("[job]",i.job+"")),this["bodyImg"+e].source=u+"_"+i.sex+"_c_png",n=!0}n||(this["bodyImg"+e].source="body000_"+i.sex+"_c_png"),a>0&&(this["weaponImg"+e].source=this.getZhuangbanById(a).res+"_"+i.sex+"_c_png"),o>0&&(this["bodyImg"+e].source=this.getZhuangbanById(o).res+"_"+i.sex+"_c_png"),this["wingImg"+e].source=null;var p=i.wingsData,d=s[2];d>0?this["wingImg"+e].source=GlobalConfig.ZhuangBanId[d].res+"_png":p.openStatus&&(this["wingImg"+e].source=GlobalConfig.WingLevelConfig[p.lv].appearance+"_png")}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e}(BaseEuiView);__reflect(WeiWangPanel.prototype,"WeiWangPanel");var WeiWangTitleTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WeiWangTitleTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onOtherClose),this.title.source=t[0].res,this.content.textFlow=TextFlowMaker.generateTextFlow1(t[0].des)},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onOtherClose)},e.prototype.onOtherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(WeiWangTitleTipsWin.prototype,"WeiWangTitleTipsWin"),ViewManager.ins().reg(WeiWangTitleTipsWin,LayerManager.UI_Popup);var XunzhangPanel=function(t){function e(){var e=t.call(this)||this;return e.lastEffId=0,e.name="勋章",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.starList=new StarList(10,0,60),this.starList.x=-5,this.starList.y=-40,this.starList.scaleX=.7,this.starList.scaleY=.7,this.eff=new MovieClip,this.eff.x=255,this.eff.y=680,this.eff.scaleX=1.2,this.eff.scaleY=1,this.eff.touchEnabled=!1,this.taskList.itemRenderer=XunZhangTaskItemRenderer,this.XunzhangEff=new MovieClip,this.xunzhangMcGroup.addChild(this.XunzhangEff)},e.prototype.open=function(){this.group.addChild(this.starList),this.addTouchEvent(this.btn,this.onTab),this.addTouchEvent(this.UplevelBtn1,this.onTab),this.observe(LiLian.ins().postNobilityData,this.update),this.observe(UserTask.ins().postTaskChangeData,this.setTaskList),this.taskList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListTouch,this),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.btn,this.onTab),this.removeObserve(),this.taskList.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onListTouch,this),DisplayUtils.removeFromParent(this.eff)},e.prototype.onListTouch=function(t){var e=t.target.parent;e.data&&GameGuider.taskGuidance(e.data.id,1)},e.prototype.onTab=function(t){switch(t.currentTarget){case this.btn:this.onBtnDeal()}},e.prototype.onBtnDeal=function(){LiLian.ins().getNobilityIsUpGrade()?LiLian.ins().sendNobilityUpgrade():UserTips.ins().showTips("|C:0xf3311e&T:任务未完成，无法升级|")},e.prototype.setTaskList=function(){var t=LiLian.ins().nobilityLv,e=GlobalConfig.KnighthoodConfig[t];if(this.nameTF.text=e.type,this.lastEffId!=e.effid){if(!GlobalConfig.DefineEff[e.effid])return void egret.log(e.effid+"特效ID出错啦");var i=GlobalConfig.DefineEff[e.effid].souce;this.XunzhangEff.playFile(RES_DIR_EFF+i,-1),this.lastEffId=e.effid,this.stageImg.source="jieji"+e.effid%100+"_png"}for(var s=[],n=0;n<e.achievementIds.length;n++){var o=e.achievementIds[n].taskId;o>0&&s.push(UserTask.ins().getAchieveByTaskId(o))}this.taskList.dataProvider=new eui.ArrayCollection(s)},e.prototype.showActPanel=function(){this.Activation.visible=!1,this.showAct.visible=!this.Activation.visible},e.prototype.update=function(t){var e=!1;e=t?t.refush:!1,this.showActPanel();var i=LiLian.ins().nobilityLv,s=GlobalConfig.KnighthoodConfig[i];if(LiLian.ins().isXZShow){var n=s.effid;Activationtongyong.show(0,s.desc,"j"+n+"_png"),LiLian.ins().isXZShow=!1}if(!LiLian.ins().checkJueWeiOpen())return this.com1.visible=!1,this.com2.visible=!1,void(this.group.visible=!1);this.com1.visible=!0,this.com2.visible=!0,this.group.visible=!0,this.nameTF.text=s.type;var o=GlobalConfig.KnighthoodBasicConfig.perLevel,a=Math.ceil((i-o)/(o+1)+1),r=i-(o+(a-2)*(o+1)+1);if(this.starList.setStarNum(r,Number(e)),this.btn.label="升级勋章",i>0&&(i-o)%(o+1)==0&&(this.btn.label="升阶"),DisplayUtils.removeFromParent(this.eff),0==i){for(var h=this.taskList.numChildren>0,l=0;l<this.taskList.numChildren;l++){var c=this.taskList.getChildAt(l);if("goon"==c.currentState){h=!1;break}}h?(this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.showAct.addChild(this.eff)):DisplayUtils.removeFromParent(this.eff)}this.com1.updateInfo1(s,this.starList.starNum),s=GlobalConfig.KnighthoodConfig[i+1],this.btn.visible=!0,this.manjiTF.visible=!1,this.com2.visible=!0,this.arrow.visible=!0,s?(this.com1.x=10,this.com2.updateInfo2(s,this.starList.starNum)):(this.btn.visible=!1,this.manjiTF.visible=!0,this.com2.visible=!1,this.arrow.visible=!1,this.com1.x=137),this.setTaskList()},e.prototype.getPower=function(){var t=LiLian.ins().nobilityLv,e=GlobalConfig.KnighthoodConfig[t];return UserBag.getAttrPower(e.attrs)},e}(BaseEuiView);__reflect(XunzhangPanel.prototype,"XunzhangPanel");var XunzhangItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.updateInfo1=function(t,e,i){void 0===i&&(i=!1);var s=t.attrs,n=AttributeData.getAttStr1(s,AttributeFormat.FORMAT_1());if(t.exattrs&&t.exattrs.length>0)for(var o=0;o<t.exattrs.length;o++)n+="\n",n+=AttributeData.getExAttrNameByAttrbute(t.exattrs[o],!0)+"\n";this.attrTxt.textFlow=TextFlowMaker.generateTextFlow(n),this.addNameTF(this.nameTF,t,e,i)},e.prototype.updateInfo2=function(t,e,i){void 0===i&&(i=!1);var s=t.attrs,n=AttributeData.getAttStr1(s,AttributeFormat.FORMAT_2());if(t.exattrs&&t.exattrs.length>0){n+="\n";for(var o=0;o<t.exattrs.length;o++)n+=AttributeData.getExAttrNameByAttrbute(t.exattrs[o],!0,"：",3532333)+"\n"}this.attrTxt.textFlow=TextFlowMaker.generateTextFlow(n),this.addNameTF(this.nameTF,t,e+1,i)},e.prototype.addNameTF=function(t,e,i,s){void 0===s&&(s=!1),t&&(i>9&&(i=9),s&&(i=0),t.text=e.desc)},e}(BaseComponent);__reflect(XunzhangItem.prototype,"XunzhangItem");var XunZhangTaskItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="XunzhangTaskSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=UserTask.ins().getAchieveConfById(t.id);this.nameTF.textFlow=TextFlowMaker.generateTextFlow(e.name);var i=Math.min(t.value,e.target);this.expLabel.text=i+"/"+e.target,this.expBar.maximum=e.target,this.expBar.value=i,this.taskIcon.source="xunzhang"+t.achievementId+"_png",t.value>=e.target?this.currentState="done":this.currentState="goon"}},e}(BaseItemRender);__reflect(XunZhangTaskItemRenderer.prototype,"XunZhangTaskItemRenderer");var WeiWangCC=function(t){function e(){var e=t.call(this)||this;return e._weiWangBack=0,e.sysId=PackageID.WeiWang,e.regNetMsg(1,e.postWeiWangBack),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postWeiWangBack=function(t){this._weiWangBack=t.readInt()},Object.defineProperty(e.prototype,"weiWangBack",{get:function(){return this._weiWangBack},enumerable:!0,configurable:!0}),e.prototype.sendFindWeiWang=function(){this.sendBaseProto(2)},e.prototype.getWeiWangCfg=function(t){for(var e=Object.keys(GlobalConfig.PrestigeLevel).length,i=1;e>=i;i++)if(t<GlobalConfig.PrestigeLevel[i].exp)return GlobalConfig.PrestigeLevel[i-1];return GlobalConfig.PrestigeLevel[t?e:1]},Object.defineProperty(e.prototype,"isOpen",{get:function(){return Actor.level<GlobalConfig.PrestigeBase.openLevel||GameServer.serverOpenDay<GlobalConfig.PrestigeBase.openDay-1?!1:!0},enumerable:!0,configurable:!0}),e}(BaseSystem);__reflect(WeiWangCC.prototype,"WeiWangCC");var GameSystem;!function(t){t.weiWang=WeiWangCC.ins.bind(WeiWangCC)}(GameSystem||(GameSystem={}));var JadeDataNew=function(){function t(){this.lv=0,this.exp=0,this._isUpdate=!0}return t.prototype.parser=function(t){this.lv=t.readShort(),this.exp=t.readShort();var e=t.readShort();this.danDate=new Object;for(var i=0;e>i;i++)this.danDate[t.readInt()]=t.readShort();this._isUpdate=!0},t.prototype.parserOther=function(t){this.lv=t.readShort(),this._isUpdate=!0},t.prototype.getSkillList=function(){if(this._isUpdate){this._isUpdate=!1,this._skillList=[];var t=JadeNew.ins().getSkillsByLv(this.lv);if(t)for(var e=0,i=t;e<i.length;e++){var s=i[e];this._skillList.push(new SkillData(s))}}return this._skillList},t}();__reflect(JadeDataNew.prototype,"JadeDataNew");var JadeNew=function(t){function e(){var e=t.call(this)||this;return e.jadeData=[],e.sysId=PackageID.JadeNew,e.regNetMsg(1,e.postJadeData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postJadeData=function(t){var e=t.readShort(),i=this.jadeData[e];return i||(i=new JadeDataNew,this.jadeData[e]=i),i.parser(t),e},e.prototype.sendUseDan=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendUpgrade=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getJadeDataByID=function(t){return this.jadeData&&this.jadeData.length?this.jadeData[t]:null},e.prototype.isJadeMax=function(t){var e=this.getJadeDataByID(t);return e?e.lv>=Object.keys(GlobalConfig.JadePlateLevelConfig).length-1:!1},e.prototype.checkRed=function(){for(var t=0;3>t;t++)if(this.checkRedByRoleID(t))return!0;return!1},e.prototype.checkOpen=function(){return Actor.level<GlobalConfig.JadePlateBaseConfig.openlv?!1:GameServer.serverOpenDay<GlobalConfig.JadePlateBaseConfig.openDay-1?!1:!0},e.prototype.checkRedByRoleID=function(t){if(!this.checkOpen())return!1;if(!SubRoles.ins().getSubRoleByIndex(t))return!1;var e=this.getJadeDataByID(t);if(!e)return!1;if(this.isJadeMax(t))return!1;var i,s=e.lv,n=0;for(var o in GlobalConfig.JadePlateBaseConfig.itemInfo)i=UserBag.ins().getBagItemById(+o),n+=+GlobalConfig.JadePlateBaseConfig.itemInfo[o]*(i?i.count:0);if(n+e.exp>=GlobalConfig.JadePlateLevelConfig[s].exp)return!0;var a,r=Math.floor(s/GlobalConfig.JadePlateBaseConfig.perLevel)+1,h=0,l=0,c=0;for(var o in GlobalConfig.JadePlateBaseConfig.upgradeInfo)if(i=UserBag.ins().getBagItemById(+o),l=i?i.count:0,h=e.danDate&&e.danDate[o]?+e.danDate[o]:0,a=GlobalConfig.JadePlateLevelConfig[(r-1)*GlobalConfig.JadePlateBaseConfig.perLevel],c=a.upgradeItemInfo&&a.upgradeItemInfo[o]?+a.upgradeItemInfo[o]:0,c>h&&l)return!0;return!1},e.prototype.getSkillsByLv=function(t){var e=Math.floor(t/GlobalConfig.JadePlateBaseConfig.perLevel)+1,i=GlobalConfig.JadePlateLevelConfig[(e-1)*GlobalConfig.JadePlateBaseConfig.perLevel],s=i.skillIdList?i.skillIdList.length:0;if(0>=s)return null;for(var n,o=GlobalConfig.JadePlateBaseConfig.skillUnlock.length,a=[],r=0;o>r;r++)for(var h=0;s>h;h++)n=i.skillIdList[h],n==GlobalConfig.JadePlateBaseConfig.skillUnlock[r].id&&n>100&&a.push(n);return a.length?a:null},e}(BaseSystem);__reflect(JadeNew.prototype,"JadeNew");var GameSystem;!function(t){t.jadeNew=JadeNew.ins.bind(JadeNew)}(GameSystem||(GameSystem={}));var LongHun=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.LoongSoul,e.regNetMsg(1,e.postDateUpdate),e.regNetMsg(2,e.postStageUpgrade),e.regNetMsg(3,e.postStageActive),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(1);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postDateUpdate=function(t){var i=t.readShort(),s=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(i),o=t.readInt(),a=t.readInt(),r=0;switch(s+1){case e.TYPE_LONG_HUN:r=n.loongSoulData.level==o?0:1,n.loongSoulData.level=o,n.loongSoulData.exp=a;break;case e.TYPE_HU_DUN:n.shieldData.level=o,n.shieldData.exp=a;break;case e.TYPE_XUE_YU:n.xueyuData.level=o,n.xueyuData.exp=a}return r},e.prototype.sendStageUpgrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postStageUpgrade=function(t){var i=t.readShort(),s=t.readShort(),n=t.readInt(),o=SubRoles.ins().getSubRoleByIndex(i);switch(s+1){case e.TYPE_LONG_HUN:o.loongSoulData.stage=n;break;case e.TYPE_HU_DUN:o.shieldData.stage=n;break;case e.TYPE_XUE_YU:o.xueyuData.stage=n}},e.prototype.sendStageActive=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postStageActive=function(t){var i=t.readShort(),s=t.readShort(),n=t.readByte(),o=SubRoles.ins().getSubRoleByIndex(i);switch(s+1){case e.TYPE_LONG_HUN:o.loongSoulData.state=n;break;case e.TYPE_HU_DUN:o.shieldData.state=n;break;case e.TYPE_XUE_YU:o.xueyuData.state=n}Activationtongyong.show(0,"龙魂","jlonghun_01_png")},e.prototype.canShowRedPointByType=function(t,i){var s=SubRoles.ins().getSubRoleByIndex(t);if(!s)return!1;var n=0,o=null,a=null,r=null;switch(i){case e.TYPE_LONG_HUN:if(0==s.loongSoulData.state){var h=GlobalConfig.LoongSoulBaseConfig.openlv;return Actor.level<h?!1:!0}o=GlobalConfig.LoongSoulConfig[s.loongSoulData.level],a=GlobalConfig.LoongSoulConfig[s.loongSoulData.level+1],r=GlobalConfig.LoongSoulStageConfig[s.loongSoulData.stage],n=s.loongSoulData.exp;break;case e.TYPE_HU_DUN:o=GlobalConfig.ShieldConfig[s.shieldData.level],a=GlobalConfig.ShieldConfig[s.shieldData.level+1],r=GlobalConfig.ShieldStageConfig[s.shieldData.stage],n=s.shieldData.exp}if(!a)return!1;if(this.assert(o&&r,"config or stageConfig is null"))return!1;var l=UserBag.ins().getBagGoodsCountById(0,o.itemId);return void 0==r.normalCostTip?!1:l>=r.normalCostTip},e.prototype.canShowRedPointInRole=function(t){for(var i=[e.TYPE_LONG_HUN],s=0,n=i;s<n.length;s++){var o=n[s];if(this.canShowRedPointByType(t,o))return!0}return!1},e.prototype.canShowRedPointInAll=function(){for(var t=0;3>t;t++)if(this.canShowRedPointInRole(t))return!0;return HeartMethodRedPoint.ins().redPoint?!0:HunguRedPoint.ins().redPoint?!0:!1},e.prototype.canUpgradeByType=function(t,i){var s=SubRoles.ins().getSubRoleByIndex(t);if(s){var n=null,o=null;switch(i){case e.TYPE_LONG_HUN:n=GlobalConfig.LoongSoulConfig[s.loongSoulData.level],o=GlobalConfig.LoongSoulStageConfig[s.loongSoulData.stage];break;case e.TYPE_HU_DUN:n=GlobalConfig.ShieldConfig[s.shieldData.level],o=GlobalConfig.ShieldStageConfig[s.shieldData.stage]}var a=UserBag.ins().getBagGoodsCountById(0,n.itemId);return a>0}return!1},e.prototype.canUpgradeinAll=function(){for(var t=[e.TYPE_LONG_HUN,e.TYPE_HU_DUN,e.TYPE_XUE_YU],i=0;3>i;i++)for(var s=0,n=t;s<n.length;s++){var o=n[s];if(1==this.canUpgradeByType(i,o))return!0}return!1},e.prototype.canGradeupLoongSoul=function(t){for(var e=[!1,!1,!1],i=SubRoles.ins().subRolesLen,s=0;i>s;s++)e[s]=this.canShowRedPointInRole(s);return e},e.prototype.assert=function(t,e){return Assert(t,"["+egret.getQualifiedClassName(this)+"] "+e)},e}(BaseSystem);LongHun.TYPE_LONG_HUN=2,LongHun.TYPE_HU_DUN=3,LongHun.TYPE_XUE_YU=4,__reflect(LongHun.prototype,"LongHun");var GameSystem;!function(t){t.longhun=LongHun.ins.bind(LongHun)}(GameSystem||(GameSystem={}));var LongHunData=function(){function t(){this.level=0,this.stage=0,this.exp=0,this.state=0}return t.prototype.parser=function(t){this.stage=t.readInt(),this.level=t.readInt(),this.exp=t.readInt(),this.state=t.readByte()},t.getLongHunAllLevel=function(){for(var t=0,e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i).loongSoulData;t+=s.level}return t},t}();__reflect(LongHunData.prototype,"LongHunData");var JadeNewPanel=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e._oldLevel=0,e._curMaterail=-1,e._oneKeyUp=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._iconY=this.yupei.y,this._iconMoveY=this.yupei.y-10,this.yupei.perLevel=GlobalConfig.JadePlateBaseConfig.perLevel,this._danInfo=[];
var e,i=0;for(var s in GlobalConfig.JadePlateBaseConfig.upgradeInfo)this["up"+i].name=i,e=GlobalConfig.ItemConfig[s],this["up"+i].source=e.icon+"_png",this._danInfo.push({id:+s,used:0,curMax:0,jade:0,count:0}),i++;this._materialInfo=[],i=0;for(var s in GlobalConfig.JadePlateBaseConfig.itemInfo)this["checkBoxs"+i].name=i,e=GlobalConfig.ItemConfig[s],this["lvImg"+i].source=e.icon+"_png",this["lvImg"+i].name=s,this._materialInfo.push({id:+s,count:0,addExp:+GlobalConfig.JadePlateBaseConfig.itemInfo[s]}),i++;for(i=0;5>i;i++)this["skillIcon"+i].name=i,this["skillIcon"+i].touchEnabled=!0,this["skillIcon"+i].touchChildren=!1;this._expBar=new ProgressBarEff,this._expBar.setWidth(525),this.barGroup.addChild(this._expBar),this._expBar.x=-15,this._expBar.y=-10},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&t.length&&(this._curRole=t[0]),this._jadeData=JadeNew.ins().getJadeDataByID(this._curRole),this._jadeData&&(this._oldLevel=this._jadeData.lv,this.observe(JadeNew.ins().postJadeData,this.jadeChange),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.addTouchEvent(this,this.onTouch),this.reset(),this.update(),this.playIconTween(),this.initCheckBoxs())},e.prototype.initCheckBoxs=function(){var t=this._materialInfo.length;this._curMaterail=0;for(var e=0;t>e;e++)if(this._materialInfo[e].count){this._curMaterail=e;break}this["checkBoxs"+this._curMaterail].selected=!0},e.prototype.reset=function(){this._curMaterail=-1,this.stopOneKyUp(),this.checkBoxs0.selected=this.checkBoxs1.selected=this.checkBoxs2.selected=!1,this.stopIconTween(),this._expBar.reset()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onTouch),this.stopIconTween(),this._curMaterail=-1,this.stopOneKyUp()},e.prototype.jadeChange=function(t){this._curRole==t&&(this._jadeData=JadeNew.ins().getJadeDataByID(this._curRole),this.update())},e.prototype.playIconTween=function(){this.yupei.y=this._iconY,egret.Tween.removeTweens(this.yupei),egret.Tween.get(this.yupei,{loop:!0}).to({y:this._iconMoveY},1e3).to({y:this._iconY},1e3)},e.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.yupei)},e.prototype.update=function(){var t,e=this._jadeData.lv,i=[],s=GlobalConfig.JadePlateLevelConfig[e];for(var n in s.attrs)t=s.attrs[n],i.push(new AttributeData(t.type,t.value));i=this.addDanAtt(i),this.powerPanel.setPower(UserBag.getAttrPower(i,SubRoles.ins().getSubRoleByIndex(this._curRole)));var o=Math.floor(e/GlobalConfig.JadePlateBaseConfig.perLevel)+1;this.lv.text=this.getNumStr(o)+"阶"+this.getNumStr(e%GlobalConfig.JadePlateBaseConfig.perLevel)+"级";var a,r=JadeNew.ins().isJadeMax(this._curRole);if(this.maxShowGroup.visible=this.maxLevel.visible=r,this.updateMaterial(),r)this.maxGroup.visible=!1,this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："));else{this.maxGroup.visible=!0,a=this._oldLevel!=e,this._oldLevel=e,this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"：")),i=[];var h=GlobalConfig.JadePlateLevelConfig[e+1];for(var n in h.attrs)i.push(new AttributeData(h.attrs[n].type,h.attrs[n].value));i=this.addDanAtt(i),this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："))}Math.floor(e/(9*GlobalConfig.JadePlateBaseConfig.perLevel));this.yupei.setLevel(e,a&&e%GlobalConfig.JadePlateBaseConfig.perLevel==10),e%GlobalConfig.JadePlateBaseConfig.perLevel==10?this.barGroup.visible=!1:(this.barGroup.visible=!0,this._expBar.getMaxValue()!=s.exp?this._expBar.setData(this._jadeData.exp,s.exp):this._expBar.setValue(this._jadeData.exp)),s=GlobalConfig.JadePlateLevelConfig[(o-1)*GlobalConfig.JadePlateBaseConfig.perLevel];for(var l=GlobalConfig.JadePlateBaseConfig.skillUnlock.length,c=s.skillIdList?s.skillIdList.length:0,u=0;l>u;u++){this["blackImg"+u].visible=!0;for(var p=0;c>p;p++)s.skillIdList[p]==GlobalConfig.JadePlateBaseConfig.skillUnlock[u].id&&(this["blackImg"+u].visible=!1)}},e.prototype.getNumStr=function(t){var e=[];if(Math.floor(t/10)){var i=Math.floor(t/10);i>1&&e.push(i),e.push(10),t%10!=0&&e.push(t%10)}else e.push(t%10);for(var s="",n=e.length,o=0;n>o;o++)switch(e[o]){case 0:s+="零";break;case 1:s+="一";break;case 2:s+="二";break;case 3:s+="三";break;case 4:s+="四";break;case 5:s+="五";break;case 6:s+="六";break;case 7:s+="七";break;case 8:s+="八";break;case 9:s+="九";break;case 10:s+="十"}return s},e.prototype.addDanAtt=function(t){if(this._jadeData.danDate&&Object.keys(this._jadeData.danDate).length){var e=t.concat(),i=void 0,s=void 0;for(var n in this._jadeData.danDate){if(i=GlobalConfig.JadePlateBaseConfig.upgradeInfo[n],i.precent)for(var o=e.length,a=0;o>a;a++)e[a].type!=AttributeType.atHuiXinDamage&&t.push(new AttributeData(e[a].type,Math.floor(e[a].value*+this._jadeData.danDate[n]*i.precent/1e4)));if(i.attr){s=i.attr.length;for(var r=0;s>r;r++)t.push(new AttributeData(i.attr[r].type,i.attr[r].value*+this._jadeData.danDate[n]))}}e=[],s=t.length;for(var h=new Object,l=0;s>l;l++)void 0==h[t[l].type]&&(h[t[l].type]=0),h[t[l].type]+=t[l].value;for(var n in h)e.push(new AttributeData(+n,+h[n]));return e}return t},e.prototype.updateMaterial=function(){for(var t,e,i,s=this._jadeData.lv,n=this._danInfo.length,o=Math.floor(s/GlobalConfig.JadePlateBaseConfig.perLevel)+1,a=0;n>a;a++)t=this._danInfo[a],e=UserBag.ins().getBagItemById(t.id),t.count=e?e.count:0,t.used=this._jadeData.danDate&&this._jadeData.danDate[t.id]?+this._jadeData.danDate[t.id]:0,t.jade=o,i=GlobalConfig.JadePlateLevelConfig[(o-1)*GlobalConfig.JadePlateBaseConfig.perLevel],t.curMax=i.upgradeItemInfo&&i.upgradeItemInfo[t.id]?+i.upgradeItemInfo[t.id]:0,this["used"+a].text=t.used,this["redPoint"+a].visible=t.used<t.curMax&&t.count;n=this._materialInfo.length;for(var r,h=0,a=0;n>a;a++)r=this._materialInfo[a],e=UserBag.ins().getBagItemById(r.id),r.count=e?e.count:0,this["lvNum"+a].textFlow=TextFlowMaker.generateTextFlow1("|C:"+(r.count?65280:16711680)+"&T:"+r.count),h+=r.addExp*r.count;this.normal.visible=s%GlobalConfig.JadePlateBaseConfig.perLevel!=10,this.upLv.visible=!this.normal.visible,this.upgradeBtn0.visible=this.upgradeBtn.visible},e.prototype.onTouch=function(t){switch(t.target){case this.upgradeBtn:this.onUpgrade();break;case this.upgradeBtn0:this.onUpgrade(!0);break;case this.upgradeBtn1:this.onUpgrade();break;case this.up0:case this.up1:case this.up2:var e=this._danInfo[t.target.name];e.used<e.curMax&&e.count?JadeNew.ins().sendUseDan(this._curRole,e.id):ViewManager.ins().open(JadeUpTipsWin,e);break;case this.checkBoxs0:case this.checkBoxs1:case this.checkBoxs2:this._oneKeyUp&&this.stopOneKyUp();var i=+t.target.name;this._curMaterail=-1;for(var s=void 0,n=0;3>n;n++)s=this["checkBoxs"+n],n==i?this._curMaterail=s.selected?i:-1:s.selected=!1;break;case this.skillIcon0:case this.skillIcon1:case this.skillIcon2:case this.skillIcon3:case this.skillIcon4:var o=GlobalConfig.JadePlateBaseConfig.skillUnlock[t.target.name];ViewManager.ins().open(YupeiSkillTipsWin,o.name,o.desc);break;case this.lvImg0:case this.lvImg1:case this.lvImg2:ViewManager.ins().open(ItemDetailedWin,0,t.target.name)}},e.prototype.onUpgrade=function(t){if(void 0===t&&(t=!1),t&&this._oneKeyUp)return void this.stopOneKyUp();if(this._oneKeyUp&&this.stopOneKyUp(),this._jadeData.lv%GlobalConfig.JadePlateBaseConfig.perLevel==10)JadeNew.ins().sendUpgrade(this._curRole,this._materialInfo[0].id);else if(-1==this._curMaterail)UserTips.ins().showTips("请先选择需要消耗的道具");else if(this._materialInfo[this._curMaterail].count<=0)UserTips.ins().showTips("|C:16711680&T:材料不足"),UserWarn.ins().setBuyGoodsWarn(this._materialInfo[this._curMaterail].id);else{var e=this._materialInfo[this._curMaterail].count;e>1&&t?(TimerManager.ins().doTimer(150,e,this.sendUp,this,this.stopOneKyUp,this),this.upgradeBtn0.label="停  止",this._oneKeyUp=!0):JadeNew.ins().sendUpgrade(this._curRole,this._materialInfo[this._curMaterail].id)}},e.prototype.stopOneKyUp=function(){this._oneKeyUp=!1,this.upgradeBtn0.label="一键升级",TimerManager.ins().remove(this.sendUp,this)},e.prototype.sendUp=function(){return this._jadeData.lv%GlobalConfig.JadePlateBaseConfig.perLevel==10?void this.stopOneKyUp():void JadeNew.ins().sendUpgrade(this._curRole,this._materialInfo[this._curMaterail].id)},e}(BaseEuiView);__reflect(JadeNewPanel.prototype,"JadeNewPanel");var JadeUpTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="YuPeiUpTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch);var i=t[0],s=GlobalConfig.ItemConfig[i.id];this.itemIcon.setData(s),this.nameLabel.text=s.name,this.use.text=i.used+"/"+i.curMax,this.num.text=i.count+"",this.attr.textFlow=TextFlowMaker.generateTextFlow1(s.desc);var n,o,a=Math.floor((Object.keys(GlobalConfig.JadePlateLevelConfig).length-1)/GlobalConfig.JadePlateBaseConfig.perLevel)+1,r=!1;for(o=i.jade;a>=o;o++)if(n=GlobalConfig.JadePlateLevelConfig[(o-1)*GlobalConfig.JadePlateBaseConfig.perLevel],n.upgradeItemInfo&&n.upgradeItemInfo[i.id]&&+n.upgradeItemInfo[i.id]>i.curMax){r=!0;break}r?(this.info.visible=!0,this.num0.text=o+"阶"):this.info.visible=!1},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(JadeUpTipsWin.prototype,"JadeUpTipsWin"),ViewManager.ins().reg(JadeUpTipsWin,LayerManager.UI_Main);var YupeiSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="YupeiSkillTipsNewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.nameLabel.text=t[0],this.description.textFlow=TextFlowMaker.generateTextFlow1(t[1]),this.addTouchEvent(this.bgClose,this.onTouch)},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(YupeiSkillTipsWin.prototype,"YupeiSkillTipsWin"),ViewManager.ins().reg(YupeiSkillTipsWin,LayerManager.UI_Main);var LongHunWin=function(t){function e(){var e=t.call(this)||this;return e.starList=null,e.barbc=new ProgressBarEff,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.barbc.setWidth(525),this.barbc.x=-15,this.barbc.y=-12,this.expGroup.addChild(this.barbc),this.mc=new MovieClip,this.mc.x=240,this.mc.y=400,this.starList=new StarList(10),this.starList.x=15,this.starList.y=0,this.starGroup.addChild(this.starList),this.iconY=this.icon.y,this.iconMoveY=this.iconY-10,this.eff=new MovieClip,this.eff.x=this.activeBtnMc.width/2,this.eff.y=this.activeBtnMc.height/2,this.eff.scaleX=1.17,this.eff.touchEnabled=!1,this.activeBtnMc.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t&&t[0]?t[0]:0;this.curRole=i,this.index=LongHun.TYPE_LONG_HUN,this.addTouchEvent(this.upgradeBtn,this.onTap),this.addTouchEvent(this.activeBtn,this.onTap),this.observe(UserBag.ins().postItemAdd,this.roleChange),this.observe(LongHun.ins().postDateUpdate,this.roleChange),this.observe(LongHun.ins().postStageUpgrade,this.roleChange),this.observe(LongHun.ins().postStageActive,this.roleChange),this.barbc.reset(),this.maxShowGroup.visible=!1,this.roleChange(),this.onTabChange(),this.playIconTween()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.stopIconTween(),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.colorCanvas0,this.onTap),this.removeTouchEvent(this.upgradeBtn,this.onTap),DisplayUtils.removeFromParent(this.eff),this.removeObserve()},e.prototype.roleSelectChange=function(t){this.roleChange()},e.prototype.playIconTween=function(){this.icon.y=this.iconY,egret.Tween.removeTweens(this.icon),egret.Tween.get(this.icon,{loop:!0}).to({y:this.iconMoveY},1e3).to({y:this.iconY},1e3)},e.prototype.stopIconTween=function(){egret.Tween.removeTweens(this.icon)},e.prototype.onTabChange=function(t){void 0===t&&(t=null),this.roleChange()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.colorCanvas0:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.upgradeBtn:"提升"==this.upgradeBtn.label?this.sendUpgrade():"升阶"==this.upgradeBtn.label?this.sendStageUpgrade():this.openBuyGoods();break;case this.activeBtn:var e=GlobalConfig.LoongSoulBaseConfig.openlv;Actor.level>=e?this.sendStageActive():UserTips.ins().showTips("等级达到"+e+"级可激活")}},e.prototype.onTaps=function(t){if(null!=this._config){var e=GlobalConfig.VipConfig[this.index>2?13:14].attrAddition.percent;e=this.index==LongHun.TYPE_XUE_YU?0:e;var i=[];this._config.attr.forEach(function(t){i.push(t.value*e/100>>0)}),ViewManager.ins().open(ForgeTipsWin,i,AttributeData.getAttStr(this._config.attr,1,1,""))}},e.prototype.maxControll=function(t){this.maxGroup.visible=t,this.material.visible=t,this.barbc.visible=t,this.powerPanel.visible=!0,this.maxLevel.visible=!t,this.activeGroup.visible=!1,this.stairImg.visible=!0,this.maxShowGroup.visible=!t,t?(this.curAtt.x=62,this.curAtt.y=408):(this.curAtt.x=170,this.curAtt.y=408)},e.prototype.sendUpgrade=function(){LongHun.ins().sendUpGrade(this.curRole,this.index-1)},e.prototype.sendStageUpgrade=function(){LongHun.ins().sendStageUpgrade(this.curRole,this.index-1)},e.prototype.openBuyGoods=function(){UserWarn.ins().setBuyGoodsWarn(this._config.itemId,this._missingNum)},e.prototype.sendStageActive=function(){LongHun.ins().sendStageActive(this.curRole,this.index-1)},e.prototype.updateStageInfo=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);switch(this.index){case LongHun.TYPE_LONG_HUN:this._stageConfig=GlobalConfig.LoongSoulStageConfig[t.loongSoulData.stage];break;case LongHun.TYPE_HU_DUN:this._stageConfig=GlobalConfig.ShieldStageConfig[t.shieldData.stage];break;case LongHun.TYPE_XUE_YU:this._stageConfig=GlobalConfig.XueyuStageConfig[t.xueyuData.stage]}this.icon.source=this._stageConfig.icon},e.prototype.roleChange=function(t){void 0===t&&(t=0),this.updateStageInfo();var e,i=0,s=0,n=SubRoles.ins().getSubRoleByIndex(this.curRole),o=null;if(this.index==LongHun.TYPE_HU_DUN)if(i=n.shieldData.level,s=n.shieldData.exp,this._config=GlobalConfig.ShieldConfig[i],e=GlobalConfig.ShieldConfig[i+1],UserVip.ins().lv>=13){this.addTouchEvent(this.vipLabel,this.onTaps);var a=AttributeData.getAttrStrAdd(this._config.attr,13);this.curAtt.text=AttributeData.getAttStr(a,0,1,"：")}else o=AttributeData.AttrAddition(this._config.attr,this._stageConfig.attr),this.curAtt.text=AttributeData.getAttStr(o,0,1,"：");else if(this.index==LongHun.TYPE_LONG_HUN){i=n.loongSoulData.level,s=n.loongSoulData.exp;if(this._config=GlobalConfig.LoongSoulConfig[i],e=GlobalConfig.LoongSoulConfig[i+1],this.stairImg.setValue(n.loongSoulData.stage+1),UserVip.ins().lv>=14){var a=AttributeData.getAttrStrAdd(this._config.attr,14);this.curAtt.text=AttributeData.getAttStr(a,0,1,"：")}else o=AttributeData.AttrAddition(this._config.attr,this._stageConfig.attr),this.curAtt.text=AttributeData.getAttStr(o,0,1,"：");this.maxCurAtt.text=this.curAtt.text}i>0?this.starList.setStarNum(i%10==0?10:i%10,t):this.starList.setStarNum(0);var r=GlobalConfig.LoongSoulBaseConfig.openlv;this.sysDescText.text="开启龙魂获得大量攻击防御\n\n"+r+"级可开启",this.barbc.setData(s,this._config.exp);var h=UserBag.getAttrPower(this._config.attr);this.powerPanel.setPower(h);var l=CommonUtils.getObjectLength(GlobalConfig.LoongSoulConfig)-1;if(n.loongSoulData.state){if(i==l)return void this.maxControll(!1);this.maxControll(!0)}else this.maxGroup.visible=!1,this.material.visible=!1,this.barbc.visible=!1,this.maxLevel.visible=!1,this.stairImg.visible=!1,this.activeGroup.visible=!0,this.powerPanel.visible=!1,this.redPoint.visible=!1,Actor.level>=r?(this.activeBtn.enabled=!0,this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.activeBtnMc.addChild(this.eff),this.redPoint.visible=!0):(this.activeBtn.enabled=!1,DisplayUtils.removeFromParent(this.eff));var c=UserBag.ins().getBagGoodsCountById(0,this._config.itemId);GlobalConfig.ItemConfig[this._config.itemId].name;this.upgradeBtn.label=1>c?"获得材料":"提升",c<this._stageConfig.normalCost?this._missingNum=this._stageConfig.normalCost-c:this._missingNum=0;var u="";u=c>=this._stageConfig.normalCost?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.material.textFlow=TextFlowMaker.generateTextFlow("拥有碎片:<font color="+u+">"+c+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this._stageConfig.normalCost+"</font> "),this.material.visible=!0,this.showStageUpgradeBtn(i);var p,d,g=0,f="升阶"==this.upgradeBtn.label,v=f?this._config:e;this.index==LongHun.TYPE_LONG_HUN?(p=AttributeData.getAttrStrAdd(v.attr,13),g=f?n.loongSoulData.stage+1:n.loongSoulData.stage,d=GlobalConfig.LoongSoulStageConfig[g]):this.index==LongHun.TYPE_HU_DUN?(p=AttributeData.getAttrStrAdd(v.attr,14),g=f?n.shieldData.stage+1:n.shieldData.stage,d=GlobalConfig.ShieldStageConfig[g]):this.index==LongHun.TYPE_XUE_YU&&(p=AttributeData.getAttrStrAdd(v.attr,15),g=f?n.xueyuData.stage+1:n.xueyuData.stage,d=GlobalConfig.XueyuStageConfig[g]),p=AttributeData.AttrAddition(p,d.attr),this.nextAtt.text=AttributeData.getAttStr(p,0,1,"：")},e.prototype.showStageUpgradeBtn=function(t){var e=0,i=SubRoles.ins().getSubRoleByIndex(this.curRole);switch(this.index){case LongHun.TYPE_LONG_HUN:e=i.loongSoulData.stage;break;case LongHun.TYPE_HU_DUN:e=i.shieldData.stage;break;case LongHun.TYPE_XUE_YU:e=i.xueyuData.stage}t>0&&t%10==0&&(t/10-1>=e?(this.upgradeBtn.label="升阶",this.material.visible=!1,this.starList.setStarNum(10),this.barbc.visible=!1):(this.starList.setStarNum(0),this.barbc.visible=!0))},e}(BaseView);__reflect(LongHunWin.prototype,"LongHunWin");var TreasureWin=function(t){function e(){var e=t.call(this)||this;return e.lastSelect=0,e.skinName="TreasureWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.viewStack.numChildren,s=0;i>s;s++)this.viewStack.getChildAt(s).close();this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.observe(HeartMethodRedPoint.ins().postHeartMethodRedPoint,this.showRoleRedPoint),this.observe(ShenshouRedpoint.ins().postRedPoint,this.showTabRedPoint),this.lastSelect=t[0]||0,this.curRole=t[1]||0,this.viewStack.selectedIndex=this.lastSelect,this.roleSelect.setCurRole(this.curRole),this.setOpenIndex(this.viewStack.selectedIndex),this.observe(UserBag.ins().postItemAdd,this.delayRedPoint),this.observe(UserBag.ins().postItemChange,this.delayRedPoint),this.observe(Actor.ins().postLevelChange,this.delayRedPoint),this.observe(JadeNew.ins().postJadeData,this.delayRedPoint),this.observe(LongHun.ins().postDateUpdate,this.delayRedPoint),this.observe(LongHun.ins().postStageUpgrade,this.delayRedPoint),this.observe(LongHun.ins().postStageActive,this.delayRedPoint),this.observe(HunguRedPoint.ins().postRedPoint,this.showTabRedPoint),this.checkYuPeiRed(),this.checkPanel()},e.prototype.checkPanel=function(){Hungu.ins().checkShowOpen()?(this.HunguPanel.parent||this.viewStack.addChild(this.HunguPanel),this.redPoint4.parent&&this.redPointGroup.addChild(this.redPoint4)):(DisplayUtils.removeFromParent(this.HunguPanel),DisplayUtils.removeFromParent(this.redPoint4))},e.prototype.delayRedPoint=function(){TimerManager.ins().isExists(this.checkYuPeiRed,this)||TimerManager.ins().doTimer(60,1,this.checkYuPeiRed,this)},e.prototype.checkYuPeiRed=function(){this.redPoint0.visible=!1;for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=LongHun.ins().canShowRedPointInRole(t);if(e){this.redPoint0.visible=e;break}}this.redPoint1.visible=JadeNew.ins().checkRed(),this.showRoleRedPoint()},e.prototype.onTabTouching=function(t){e.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setRoleId=function(t){this.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.help:this.viewStack.selectedIndex==e.Longhun||(this.viewStack.selectedIndex==e.Yupei?ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[30].text):this.viewStack.selectedIndex==e.Xinfa?ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[27].text):this.viewStack.selectedIndex==e.Hungu&&ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[36].text));break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.lastSelect=t,this.help.visible=!0,this.roleSelect.currentState="yhead";var i=[];switch(this.viewStack.selectedIndex){case e.Longhun:this.title.source="biaoti_longhun",this.help.visible=!1;break;case e.Yupei:this.title.source="biaoti_yupei";break;case e.Xinfa:if(this.title.source="heartmethodName",void 0!=this.lastSelect){var s=this.viewStack.getElementAt(this.lastSelect);s&&(i[0]=s.heartId)}break;case e.Shenshou:this.help.visible=!1,this.title.source="biaoti_shoushen",this.roleSelect.currentState="nohead";break;case e.Hungu:this.title.source="hunguName",i[0]=HGPOS.ITEM0}void 0!=this.lastSelect&&this.viewStack.getElementAt(this.lastSelect).close(),this.viewStack.getElementAt(this.lastSelect).open(this.curRole,i[0]),this.showRoleRedPoint()},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.checkIsOpen=function(t){return t!=e.Yupei||JadeNew.ins().checkOpen()?t!=e.Xinfa||HeartMethod.ins().checkOpen()?t!=e.Shenshou||ShenshouModel.ins().checkOpen()?t!=e.Hungu||Hungu.ins().checkOpen()?!0:(UserTips.ins().showTips("开服第"+GlobalConfig.HunGuConf.openserverday+"天并达到"+GlobalConfig.HunGuConf.openzhuanshenglv+"转开启"),!1):(UserTips.ins().showTips("开服第"+GlobalConfig.ShenShouConfig.openserverday+"天并达到"+GlobalConfig.ShenShouConfig.openzhuanshenglv+"转开启"),!1):(UserTips.ins().showTips("开服第"+GlobalConfig.HeartMethodBaseConfig.serverDay+"天并达到"+GlobalConfig.HeartMethodBaseConfig.zsLv+"转开启"),!1):(UserTips.ins().showTips("开服第"+GlobalConfig.JadePlateBaseConfig.openDay+"天并达到"+GlobalConfig.JadePlateBaseConfig.openlv+"级开启"),!1)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.showTabRedPoint=function(){this.redPoint2.visible=HeartMethodRedPoint.ins().redPoint,this.redPoint3.visible=ShenshouRedpoint.ins().redpoint,this.redPoint4.visible=HunguRedPoint.ins().redPoint},e.prototype.showRoleRedPoint=function(){var t=SubRoles.ins().subRolesLen;switch(this.viewStack.selectedIndex){case e.Longhun:for(var i=0;t>i;i++)this.roleSelect.showRedPoint(i,LongHun.ins().canShowRedPointInRole(i));break;case e.Yupei:for(var i=0;t>i;i++)this.roleSelect.showRedPoint(i,JadeNew.ins().checkRedByRoleID(i));break;case e.Xinfa:for(var i=0;t>i;i++){var s=!1;for(var n in HeartMethodRedPoint.ins().roleTabs[i])if(HeartMethodRedPoint.ins().roleTabs[i][n]){s=!0;break}this.roleSelect.showRedPoint(i,s)}break;case e.Hungu:for(var i=0;t>i;i++){var s=HunguRedPoint.ins().roleTabs[i];this.roleSelect.showRedPoint(i,s)}}this.showTabRedPoint()},e}(BaseEuiView);TreasureWin.Longhun=0,TreasureWin.Yupei=1,TreasureWin.Xinfa=2,TreasureWin.Shenshou=3,TreasureWin.Hungu=4,__reflect(TreasureWin.prototype,"TreasureWin"),ViewManager.ins().reg(TreasureWin,LayerManager.UI_Main);var MailData=function(){function t(){}return t.prototype.parser=function(t){this.disposeData(t),this.item=[],this.text=t.readString();for(var e=t.readInt(),i=0;e>i;i++){var s=new RewardData;s.parser(t),this.item.push(s)}},t.prototype.disposeData=function(t){this.handle=t.readInt(),this.title=t.readString(),this.times=t.readInt(),this.type=t.readInt(),this.receive=t.readInt()},t}();__reflect(MailData.prototype,"MailData");var UserMail=function(t){function e(){var e=t.call(this)||this;return e.currentMailHandle=0,e.mailData=[],e._mailListData=new eui.ArrayCollection,e.sysId=PackageID.Mail,e.regNetMsg(1,e.doMailData),e.regNetMsg(2,e.doMailDetailedData),e.regNetMsg(3,e.doDeleteMail),e.regNetMsg(4,e.doGetItemMail),e.regNetMsg(5,e.doAddMail),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"mailListData",{get:function(){return this.mailData.sort(this.mailSort2),this._mailListData.source=this.mailData,this._mailListData},enumerable:!0,configurable:!0}),e.prototype.sendMailContentData=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetItem=function(t){var e=this.getBytes(4);e.writeInt(t.length);for(var i=0;i<t.length;i++)e.writeInt(t[i]);this.sendToServer(e)},e.prototype.doMailData=function(t){this.parser(t,1),this.postMailData()},e.prototype.postMailData=function(){},e.prototype.doMailDetailedData=function(t){var i=new MailData;i.parser(t);for(var s=0;s<this.mailData.length;s++)if(this.mailData[s].handle==i.handle){this.mailData.splice(s,1,i);break}this.currentMailHandle=i.handle,e.ins().isAllReceive||ViewManager.ins().open(MailDetailedWin),this.postMailDetail(i)},e.prototype.postMailDetail=function(t){return t},e.prototype.doDeleteMail=function(t){this.deleteMailDataByHandle(t.readInt()),this.postMailData()},e.prototype.doGetItemMail=function(t){this.setMailListData(t)},e.prototype.postGetItemFromMail=function(){},e.prototype.doAddMail=function(t){this.parser(t,0),this.postMailData()},e.prototype.parser=function(t,e){if(e){this.mailData=[];for(var i=t.readInt(),s=0;i>s;s++){var n=new MailData;n.disposeData(t),this.mailData.push(n)}this.mailSort(1)}else{var n=new MailData;n.disposeData(t),this.mailData.unshift(n)}},e.prototype.getMailDataByHandle=function(t){for(var e=0,i=this.mailData;e<i.length;e++){var s=i[e];if(s.handle==t)return s}return null},e.prototype.deleteMailDataByHandle=function(t){for(var e=0;e<this.mailData.length;e++)if(this.mailData[e].handle==t)return void this.mailData.splice(e,1)},e.prototype.getMailByReceive=function(t){void 0===t&&(t=0);for(var e=[],i=this.mailData.length-1;i>=0;i--)this.mailData[i].receive==t&&e.push(this.mailData[i]);return e},e.prototype.getUnreadMail=function(){for(var t=0,e=this.mailData.length-1;e>=0;e--){var i=this.mailData[e];(0==i.type||0==i.receive)&&(t+=1)}return t},e.prototype.getCurrentMail=function(){return this.getMailDataByHandle(this.currentMailHandle)},e.prototype.setMailListData=function(t){for(var e=t.readInt(),i=0;e>i;i++)for(var s=t.readInt(),n=0,o=this.mailData;n<o.length;n++){var a=o[n];if(a.handle==s){a.type=t.readInt(),a.receive=t.readInt(),this.postMailDetail(a);break}}this.postGetItemFromMail()},e.prototype.sortDesc=function(t,e){var i=t.times,s=e.times;return Algorithm.sortDesc(i,s)},e.prototype.sortAsc=function(t,e){var i=t.times,s=e.times;return Algorithm.sortAsc(i,s)},e.prototype.mailSort=function(t){var e=this.mailData;return t?e.sort(this.sortDesc):e.sort(this.sortAsc),e},e.prototype.mailSort2=function(t,e){var i=0;return i=Algorithm.sortAsc(t.type,e.type),0!=i?i:0==t.receive&&0!=e.receive?-1:0!=t.receive&&0==e.receive?1:(i=Algorithm.sortDesc(t.times,e.times),0!=i?i:i)},e}(BaseSystem);__reflect(UserMail.prototype,"UserMail");var GameSystem;!function(t){t.usermail=UserMail.ins.bind(UserMail)}(GameSystem||(GameSystem={}));var MailDetailedWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MailContentSkin",this.itemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.rect,this.onTap),this.textLabel.addEventListener(egret.TextEvent.LINK,this.linkClick,this),this.addTouchEvent(this.receiveBtn,this.onTap),this.observe(UserMail.ins().postGetItemFromMail,this.setMailData),this.setMailData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.linkClick=function(t){var e=t.text.split(","),i=e.slice(1);e[0]&&(ViewManager.ins().open(e[0],i[0]?i:null),ViewManager.ins().close(this),ViewManager.ins().close(FriendBgWin))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.receiveBtn:var e=[];e.push(UserMail.ins().currentMailHandle),UserMail.ins().sendGetItem(e);case this.closeBtn:case this.closeBtn0:case this.rect:ViewManager.ins().close(this)}},e.prototype.otherClose=function(t){var e=this.background;t.localX>=e.x&&t.localX<=e.x+e.width&&t.localY>=e.y&&t.localY<=e.y+e.height||ViewManager.ins().close(this)},e.prototype.setMailData=function(){var t=UserMail.ins().getCurrentMail();this.textLabel.textFlow=TextFlowMaker.generateTextFlow1(t.text),this.setReceiveBtn(t.receive,t.item.length>0),this.itemList.dataProvider=new eui.ArrayCollection(t.item)},e.prototype.setReceiveBtn=function(t,e){void 0===e&&(e=!1);var i="";this.receiveBtn.visible=t>=0,i=t?"已领取":"领取附件",this.receiveBtn.label=i,this.receiveBtn.enabled=!Boolean(t),this.receiveBtn.visible=e,this.desc.visible=!e},e}(BaseEuiView);__reflect(MailDetailedWin.prototype,"MailDetailedWin"),ViewManager.ins().reg(MailDetailedWin,LayerManager.UI_Popup);var MailItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MailItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.dataChanged=function(){var t=this.data;if(t instanceof MailData){var e="|C:0xA89C88&T:"+t.title+"|";e=e+"|C:"+(t.type?"0X5b5b5b":"0X00cc33")+"&T:"+(t.type?"(已读)":"(未读)")+"|",this.nameLabel.textFlow=TextFlowMaker.generateTextFlow(e),this.dateLabel.text=DateUtils.getFormatBySecond(t.times,2),this.treasure.source=0==t.receive?"220003_png":""}},e}(BaseItemRender);__reflect(MailItem.prototype,"MailItem");var MailWin=function(t){function e(){var e=t.call(this)||this;return e.name="邮件",e}return __extends(e,t),e.prototype.childrenCreated=function(){this._mails=[],this.mailList.itemRenderer=MailItem,this.mailScroller.viewport=this.mailList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.allReceiveBtn,this.onTap),this.addTouchEvent(this.mailList,this.onSendMail),this.observe(UserMail.ins().postMailDetail,this.setOpenMail),this.observe(UserMail.ins().postGetItemFromMail,this.mailCall),this.setMailData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];WatcherUtil.removeFromArrayCollection(this.mailList.dataProvider),this.mailList.dataProvider=null},e.prototype.mailCall=function(){if(UserMail.ins().isAllReceive)for(var t=0;t<this._mails.length;t++)UserMail.ins().sendMailContentData(this._mails[t].handle)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.allReceiveBtn:UserMail.ins().isAllReceive=!0;for(var e=[],i=UserMail.ins().getMailByReceive(),s=0;s<i.length;s++)e.push(i[s].handle);UserMail.ins().sendGetItem(e)}},e.prototype.onSendMail=function(t){if(t){UserMail.ins().isAllReceive=!1;var e=t.target.parent;if(e){var i=e.data;i&&UserMail.ins().sendMailContentData(i.handle)}}},e.prototype.setMailData=function(){this._mails=UserMail.ins().mailData,this.mailList.dataProvider=new eui.ArrayCollection(this._mails),this.allReceiveBtn.visible=Boolean(UserMail.ins().getMailByReceive().length),UserMail.ins().mailData.length>0&&(this.noMailTip.visible=!1)},e.prototype.setOpenMail=function(t){for(var e=0;e<this.mailList.numChildren;e++){var i=this.mailList.getChildAt(e);if(i.data.handle==t.handle)return void(i.data=t)}},e}(BaseComponent);__reflect(MailWin.prototype,"MailWin");var MergeCC=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)
},e.prototype.isOpen=function(){return SamsaraModel.ins().isOpen()||ZhanLingModel.ins().ZhanLingOpen()||Rune.ins().isOpen()},e.prototype.redPoint=function(){var t=!1;return SamsaraModel.ins().isOpen()&&(t=SamsaraModel.ins().isCanCompose()),!t&&ZhanLingModel.ins().ZhanLingOpen()&&(t=this.isZlCanMerge()),!t&&Rune.ins().isOpen()&&(t=Rune.ins().isRuneCanMerge()),t},e.prototype.getMergeMenu=function(){var t=GlobalConfig.MergeTotal,e=Actor.level,i=UserZs.ins().lv,s=[];for(var n in t)t[n].type==MergeType.SamsareEquip?SamsaraModel.ins().isOpen()&&s.push(t[n]):t[n].type==MergeType.ZhanlingEquip?ZhanLingModel.ins().ZhanLingOpen()&&s.push(t[n]):(t[n].openZs||0)<=i&&(t[n].openLv||0)<=e&&s.push(t[n]);return s.sort(this.sortMenu),s},e.prototype.getMergeSecMenu=function(t){var e=GlobalConfig.MergeConfig[t],i=Actor.level,s=UserZs.ins().lv,n=[];for(var o in e)(e[o].openZs||0)<=s&&(e[o].openLv||0)<=i&&n.push(e[o]);return n.sort(this.sortMenu),n},e.prototype.sortMenu=function(t,e){return t.sort<e.sort?-1:t.sort>e.sort?1:0},e.prototype.getListData=function(t,e){var i=GlobalConfig.MergeTotal[t],s=GlobalConfig.MergeConfig[t][e];return i.type==MergeType.SamsareEquip?SamsaraModel.ins().composeEquipMap[s.lv][s.openZs]:i.type==MergeType.ZhanlingEquip?this.getZlMergeEquipByLv(s.lv):i.type==MergeType.Rune?Rune.ins().getRuneMergeEquipByLv(s.lv):[]},e.prototype.isCanMergeById=function(t){var e=GlobalConfig.MergeTotal[t].type,i=!1;switch(e){case MergeType.SamsareEquip:i=SamsaraModel.ins().isCanTypeCompose(t);break;case MergeType.ZhanlingEquip:i=this.isZlCanMerge();break;case MergeType.Rune:i=Rune.ins().isRuneCanMerge()}return i},e.prototype.isCanMergeByIndex=function(t,e){var i=GlobalConfig.MergeTotal[t].type,s=!1;switch(i){case MergeType.SamsareEquip:s=SamsaraModel.ins().isCanZsLvCompose(GlobalConfig.MergeConfig[t][e].lv,GlobalConfig.MergeConfig[t][e].openZs);break;case MergeType.ZhanlingEquip:s=this.isZlCanMergeByIndex(t,e);break;case MergeType.Rune:s=Rune.ins().isRuneCanMergeByType(e)}return s},e.prototype.getCanMergeTargetId=function(t,e){var i=GlobalConfig.MergeTotal[t].type,s=0;switch(i){case MergeType.SamsareEquip:var n=GlobalConfig.MergeConfig[t][e];s=SamsaraModel.ins().getComposeEquipId(n.lv,n.openZs);break;case MergeType.ZhanlingEquip:s=this.getZlCanMergeTargetId(t,e)}return s},e.prototype.isCanMergeTargetId=function(t,e){if(t==MergeType.SamsareEquip){var i=GlobalConfig.ReincarnateEquipCompose[e];return SamsaraModel.ins().isCanEquipCompose(i.material.id)}return t==MergeType.ZhanlingEquip?this.isZlEquipIdCanMerge(e):t==MergeType.Rune?Rune.ins().isRuneCanMergeByID(e):!1},e.prototype.getZlMergeEquipByLv=function(t){if(!this._zlMergeEquip){this._zlMergeEquip={};var e=GlobalConfig.ZhanLingEquip;for(var i in e)this._zlMergeEquip[e[i].level]||(this._zlMergeEquip[e[i].level]=[]),this._zlMergeEquip[e[i].level].push({type:MergeType.ZhanlingEquip,id:e[i].id})}return this._zlMergeEquip[t+1]},e.prototype.getZlCanMergeTargetId=function(t,e){for(var i=GlobalConfig.MergeConfig[t][e].lv,s=this.getZlMergeEquipByLv(i),n=0,o=s;n<o.length;n++){var a=o[n];if(this.isZlEquipIdCanMerge(a.id))return a.id}return 0},e.prototype.isZlCanMerge=function(){var t=GlobalConfig.ZhanLingEquip;for(var e in t)if(this.isZlEquipIdCanMerge(e))return!0;return!1},e.prototype.isZlCanMergeByIndex=function(t,e){return!!this.getZlCanMergeTargetId(t,e)},e.prototype.isZlEquipIdCanMerge=function(t){var e=GlobalConfig.ZhanLingEquip[t],i=e.mat;if(i){var s=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,i[0].id)+this.getZlHadEquipCount(i[0].id);if(s>=i[0].count)return!0}return!1},e.prototype.getZlHadEquipCount=function(t){var e=GlobalConfig.ZhanLingEquip[t];return ZhanLingModel.ins().getZhanLingDataByItem(0,e.pos)==t?1:0},e}(BaseSystem);__reflect(MergeCC.prototype,"MergeCC");var MergeType;!function(t){t[t.SamsareEquip=1]="SamsareEquip",t[t.ZhanlingEquip=2]="ZhanlingEquip",t[t.Rune=3]="Rune"}(MergeType||(MergeType={}));var GameSystem;!function(t){t.mergeCC=MergeCC.ins.bind(MergeCC)}(GameSystem||(GameSystem={}));var ComposeMenuItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=ComposeSecMenuItem,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this)},e.prototype.onListChange=function(){var t=this.list.selectedItem,e=ViewManager.ins().getView(BagWin).reinComposePanel;e.updateView(t.id,t.index,MergeCC.ins().getCanMergeTargetId(t.id,t.index)),e.unSelectList(),this.list.getVirtualElementAt(this.list.selectedIndex).setSelect(!0)},e.prototype.selectList=function(t){this.list.selectedIndex=t;var e=this.list.getVirtualElementAt(this.list.selectedIndex);e.selected=!0,e.setSelect(!0)},e.prototype.dataChanged=function(){var t=this.data;this.list.dataProvider=new ArrayCollection(MergeCC.ins().getMergeSecMenu(t.id)),this.redPoint.visible=MergeCC.ins().isCanMergeById(t.id),this.rein_equips.source=t.btn_source},e}(BaseItemRender);__reflect(ComposeMenuItem.prototype,"ComposeMenuItem");var ComposePanel=function(t){function e(){var e=t.call(this)||this;return e._id=-1,e._index=-1,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){this.list.itemRenderer=ComposeMenuItem,this.list0.itemRenderer=SamsaraComposeItem,this._listData=new eui.ArrayCollection,this.list0.dataProvider=this._listData,this._tabListData=new eui.ArrayCollection,this.list.dataProvider=this._tabListData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserBag.ins().postItemAdd,this.buffUpdata),this.observe(UserBag.ins().postItemDel,this.buffUpdata),this.observe(UserBag.ins().postItemChange,this.buffUpdata),this.initView(),this.updateState(),void 0!=t[0]&&void 0!=t[1]&&void 0!=t[2]&&this.selectList(t[0],t[1],t[2])},e.prototype.initView=function(){this._tabListData.source=MergeCC.ins().getMergeMenu()},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e.prototype.buffUpdata=function(){TimerManager.ins().remove(this.updateState,this),TimerManager.ins().doTimer(100,1,this.updateState,this)},e.prototype.updateState=function(){if(0!=this._tabListData.length){this._tabListData.refresh();var t=this._id,e=this._index,i=0;if(-1==this._id||-1==this._index){for(var s=0;s<this._tabListData.length;s++){t=this._tabListData.getItemAt(s).id;for(var n=MergeCC.ins().getMergeSecMenu(t),o=0;o<n.length;o++)if(i=MergeCC.ins().getCanMergeTargetId(n[o].id,n[o].index)){e=n[o].index;break}if(i)break}if(!i){t=this._tabListData.getItemAt(0).id;var n=MergeCC.ins().getMergeSecMenu(t);e=n[0].index}}else i=MergeCC.ins().getCanMergeTargetId(t,e);this.updateView(t,e,i)}},e.prototype.updateView=function(t,e,i){void 0===i&&(i=0),this._id=t,this._index=e;var s=MergeCC.ins().getListData(t,e);this._listData.source=s,this.refushBarList(i)},e.prototype.refushBarList=function(t){if(!t)return void(this.contentScroller.viewport.scrollV=0);for(var e=this.list0.dataProvider,i=0;i<e.length;i++)if(t==e.getItemAt(i).id){this.contentScroller.viewport.validateNow();var s=101*i;s>this.contentScroller.viewport.contentHeight-this.contentScroller.viewport.height&&(s=this.contentScroller.viewport.contentHeight-this.contentScroller.height),0>s&&(s=0),this.contentScroller.viewport.scrollV=s;break}},e.prototype.unSelectList=function(){for(var t=this.list.dataProvider.length,e=0;t>e;e++)for(var i=this.list.getVirtualElementAt(e),s=i.list,n=0;n<s.dataProvider.length;n++){var o=s.getVirtualElementAt(n);o&&o.setSelect(!1)}},e.prototype.selectList=function(t,e,i){for(var s,n=0,o=0;o<this._tabListData.length;o++){var a=this._tabListData.getItemAt(o).type;if(t==a){n=o,s=this._tabListData.getItemAt(o).id;break}}var r=this.list.getVirtualElementAt(n),h=r.list,l=h.getVirtualElementAt(e-1);l&&l.setSelect(!0),this.updateView(s,e,l.data.id)},e.prototype.close=function(){this.removeObserve(),this._id=-1,this._index=-1},e}(BaseComponent);__reflect(ComposePanel.prototype,"ComposePanel");var ComposeSecMenuItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.lv.text=""+t.btn_name,this.redPoint.visible=MergeCC.ins().isCanMergeByIndex(t.id,t.index);var e=ViewManager.ins().getView(BagWin).reinComposePanel;e.id==t.id&&e.index==t.index&&this.setSelect(!0)},e.prototype.setSelect=function(t){this.chosen.visible=t},e}(BaseItemRender);__reflect(ComposeSecMenuItem.prototype,"ComposeSecMenuItem");var Millionaire=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Millionaire,e.regNetMsg(1,e.postMillionaireInfo),e.regNetMsg(2,e.postTurnDice),e.regNetMsg(3,e.postRoundReward),e.regNetMsg(4,e.postOverAllReward),e.regNetMsg(5,e.postMillionaireUpdate),e.dice=0,e.gridId=0,e.round=0,e.roundReward=0,e.randomGridById=0,e.randomGridByRewardId=0,e.rewardIdByGrids=[],e.isStrideStart=0,e.dicePoint=0,e.autoTurnDice=0,e.isAutoGo=!1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postMillionaireInfo=function(t){this.dice=t.readShort(),this.gridId=t.readShort(),this.round=t.readShort(),this.roundReward=t.readInt(),this.randomGridById=t.readShort(),this.randomGridByRewardId=t.readUnsignedByte();for(var e=t.readShort(),i=1;e>=i;i++){var s=t.readShort();this.rewardIdByGrids[i]=s}var n=GlobalConfig.RichManGridConfig[this.gridId];n&&2==n.action},e.prototype.postTurnDice=function(t){this.isStrideStart=t.readUnsignedByte(),this.gridId=t.readShort(),this.dicePoint=t.readUnsignedByte()},e.prototype.postRoundReward=function(t){t.readUnsignedByte();this.roundReward=t.readInt()},e.prototype.postOverAllReward=function(t){this.randomGridById=t.readShort(),this.randomGridByRewardId=t.readUnsignedByte()},e.prototype.postMillionaireUpdate=function(t){this.dice=t.readShort(),this.round=t.readShort(),this.roundReward=t.readInt()},e.prototype.sendMillionaireInfo=function(){this.sendBaseProto(1)},e.prototype.sendTurnDice=function(){this.sendBaseProto(2)},e.prototype.sendRoundReward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.getRedPoint=function(){if(!MillionaireWin.isOpen())return!1;if(this.dice>0)return!0;for(var t in GlobalConfig.RichManRoundAwardConfig)if(!(this.roundReward>>Number(t)&1)&&this.round>=GlobalConfig.RichManRoundAwardConfig[t].round)return!0;return!1},e}(BaseSystem);__reflect(Millionaire.prototype,"Millionaire");var GameSystem;!function(t){t.millionaire=Millionaire.ins.bind(Millionaire)}(GameSystem||(GameSystem={}));var MillionaireData=function(t){function e(){var e=t.call(this)||this;return e.dice=0,e.gridId=0,e.round=0,e.roundReward=0,e.randomGridById=0,e.randomGridByRewardId=0,e.rewardIdByGrids=[],e.isStrideStart=0,e.dicePoint=0,e.autoTurnDice=0,e.isAutoGo=!1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.parser=function(t){this.dice=t.readShort(),this.gridId=t.readShort(),this.round=t.readShort(),this.roundReward=t.readInt(),this.randomGridById=t.readShort(),this.randomGridByRewardId=t.readUnsignedByte();for(var e=t.readShort(),i=1;e>=i;i++){var s=t.readShort();this.rewardIdByGrids[i]=s}var n=GlobalConfig.RichManGridConfig[this.gridId];n&&2==n.action},e.prototype.parserTurnDice=function(t){this.isStrideStart=t.readUnsignedByte(),this.gridId=t.readShort(),this.dicePoint=t.readUnsignedByte()},e.prototype.parserRoundReward=function(t){this.roundReward=t.readInt()},e.prototype.parserOverAllReward=function(t){this.randomGridById=t.readShort(),this.randomGridByRewardId=t.readUnsignedByte()},e.prototype.parserMillionaireUpdate=function(t){this.dice=t.readShort(),this.round=t.readShort(),this.roundReward=t.readInt()},e.prototype.getRedPoint=function(){if(!MillionaireWin.isOpen())return!1;if(this.dice>0)return!0;for(var t in GlobalConfig.RichManRoundAwardConfig)if(!(this.roundReward>>Number(t)&1)&&this.round>=GlobalConfig.RichManRoundAwardConfig[t].round)return!0;return!1},e}(BaseClass);__reflect(MillionaireData.prototype,"MillionaireData");var MillionaireItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="richmanItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isEffing=!1,this.startX=this.itemicon.x,this.startY=this.itemicon.y},e.prototype.setHide=function(){this.itemicon.alpha=1,this.itemicon.source="",this.shadow.visible=!1,this.itemicon.x=this.startX,this.itemicon.y=this.startY},e.prototype.setHideEff=function(){var t=new eui.Image(this.itemicon.source);t.x=this.startX,t.y=this.startY,t.width=this.itemicon.width,t.height=this.itemicon.height,this.itemicon.parent.addChild(t),GameLogic.ins().postFlyItemEx(t),this.setHide()},e.prototype.dataChanged=function(){this.shadow.visible=!0;var t=this.data.index;if(-1==this.data.rewardId)return this.itemicon.source="",void(this.shadow.visible=!1);var i=this.data.rewardId-1,s=GlobalConfig.RichManGridConfig[t];if(s){var n;if(s.exparam)for(var o in s.exparam)if(Number(o)==Millionaire.ins().round){n=s.exparam[o];break}return n?void this.setImgSouce(n):void(s.action==e.ACTION_1?(t=Millionaire.ins().randomGridById,t&&(s=GlobalConfig.RichManGridConfig[t],i=Millionaire.ins().randomGridByRewardId-1),n=s.param[i],this.setImgSouce(n)):s.action==e.ACTION_2?(t=Millionaire.ins().randomGridById,t?(s=GlobalConfig.RichManGridConfig[t],i=Millionaire.ins().randomGridByRewardId-1,n=s.param[i],this.setImgSouce(n)):this.itemicon.source="richman_json.richiman_random"):s.action==e.ACTION_3?this.itemicon.source="richman_json.richiman_teleport":s.action==e.ACTION_4&&(this.itemicon.source="richman_json.richman_dice6"))}},e.prototype.setImgSouce=function(t){var e=0;if(t.type){var i=GlobalConfig.ItemConfig[t.id];i&&(this.itemicon.source=i.icon+"_png")}else switch(this.itemicon.source=RewardData.getCurrencyRes(t.id),t.id){case MoneyConst.yuanbao:e=5;break;case MoneyConst.gold:e=0;break;case MoneyConst.soul:e=2;break;case MoneyConst.piece:e=2,this.itemicon.source=RewardData.CURRENCY_RES[t.id]}},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);MillionaireItem.ACTION_1=1,MillionaireItem.ACTION_2=2,MillionaireItem.ACTION_3=3,MillionaireItem.ACTION_4=4,__reflect(MillionaireItem.prototype,"MillionaireItem");var MillionaireRole=function(t){function e(i){var s=t.call(this)||this;return s.preName="",s.shadow=new eui.Image("richman_shadow"),s.shadow.x=s.x-18,s.shadow.y=s.y-5,s.addChild(s.shadow),s.state=MillionaireView.DIR_UP,s.roleType=e.STOP,s.sex=i?i:0,s.initModel(),s}return __extends(e,t),e.prototype.initModel=function(){this.model=new MovieClip,this.addChild(this.model),this.prefix="body100",this.model1=new MovieClip,this.addChild(this.model1),this.prefix1="",this.model2=new MovieClip,this.addChild(this.model2),this.prefix2="",this.model3=new MovieClip,this.addChild(this.model3),this.prefix3="",this.model4=new MovieClip,this.addChild(this.model4),this.prefix4="",this.weightLayers=[],this.weightLayers[MillionaireView.DIR_UP]=CharEffect.FRAME_ODER[0],this.weightLayers[MillionaireView.DIR_RIGHT]=CharEffect.FRAME_ODER[2],this.weightLayers[MillionaireView.DIR_LEFT]=CharEffect.FRAME_ODER[6],this.weightLayers[MillionaireView.DIR_DOWN]=CharEffect.FRAME_ODER[4],this.setMovieFromWeight();var t=EntityManager.ins().getMainRole(0);if(t){var e=t.infoModel,i=e.equipsData[2].item.configID;if(e.zhuangbei[0]>0){var s=GlobalConfig.ZhuangBanId[e.zhuangbei[0]].res;this.prefix=s}else if(i>0){if(GlobalConfig.EquipConfig[i]){var s=GlobalConfig.EquipConfig[i].appearance;this.prefix=s}}else this.prefix="body000";if(i=e.getEquipByIndex(0).item.configID,e.zhuangbei[1]>0){var s=GlobalConfig.ZhuangBanId[e.zhuangbei[1]].res;this.prefix1=s}else if(i>0&&GlobalConfig.EquipConfig[i]){var s=GlobalConfig.EquipConfig[i].appearance;this.prefix1=s}if(e.zhuangbei[2]>0){var s=GlobalConfig.ZhuangBanId[e.zhuangbei[2]].res;this.prefix2=s}else e.wingsData.openStatus&&GlobalConfig.WingLevelConfig[e.wingsData.lv]&&(this.prefix2=GlobalConfig.WingLevelConfig[e.wingsData.lv].appearance);if(e.heirloom){var n=e.heirloom.getSuitConfig(e);n&&n.weff&&(this.prefix3=n.weff)}if(e.weapons&&e.weapons.weaponsId>0){var s=GlobalConfig.WeaponSoulConfig[e.weapons.weaponsId].outside[e.job-1];this.prefix4=s}}},e.prototype.setMovieFromWeight=function(){this.setWeight(this.state)},e.prototype.setWeight=function(t){for(var e=this.weightLayers[t],i=0;i<e.length;i++){var s=this.getMoviceByWeight(e[i]);s&&this.setChildIndex(s,i)}},e.prototype.getMoviceByWeight=function(t){var e;switch(t){case CharMcOrder.BODY:e=this.model;break;case CharMcOrder.WEAPON:e=this.model1;break;case CharMcOrder.WING:e=this.model2;break;case CharMcOrder.SOUL:e=this.model4}return e},e.prototype.destory=function(){DisplayUtils.removeFromParent(this.model),DisplayUtils.removeFromParent(this.model1),DisplayUtils.removeFromParent(this.model2),DisplayUtils.removeFromParent(this.model3),DisplayUtils.removeFromParent(this.model4)},Object.defineProperty(e.prototype,"stateName",{get:function(){this.model.scaleX=1;var t="";switch(this.state){case MillionaireView.DIR_UP:t=this.roleType?"0r":"0s";break;case MillionaireView.DIR_RIGHT:t=this.roleType?"2r":"2s";break;case MillionaireView.DIR_DOWN:t=this.roleType?"4r":"4s";break;case MillionaireView.DIR_LEFT:this.model.scaleX=-1,t=this.roleType?"2r":"2s"}return this.model1.scaleX=this.model.scaleX,this.model2.scaleX=this.model.scaleX,this.model4.scaleX=this.model.scaleX,t},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){this.preName!=this.stateName&&(this.preName=this.stateName,this.prefix&&this.model.playFile(RES_DIR_BODY+this.prefix+"_"+this.sex+"_"+this.stateName,-1),this.prefix1&&this.model1.playFile(RES_DIR_WEAPON+this.prefix1+"_"+this.sex+"_"+this.stateName,-1),this.prefix2&&this.model2.playFile(RES_DIR_WING+this.prefix2+"_"+this.stateName,-1),this.prefix3&&this.model3.playFile(RES_DIR_EFF+this.prefix3,-1),this.prefix4&&this.model4.playFile(RES_DIR_WEAPON+this.prefix4+"_"+this.stateName,-1),this.setMovieFromWeight())},e}(egret.DisplayObjectContainer);MillionaireRole.STOP=0,MillionaireRole.ACTION=1,__reflect(MillionaireRole.prototype,"MillionaireRole");var MillionaireTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="richmanRewardSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Millionaire.ins().postRoundReward,this.callbackRoundReward),this.addTouchEndEvent(this.bgClose,this.onClick),this.addTouchEndEvent(this.getreward,this.onClick),this.pos=t[0],this.getlabel.touchEnabled=!1,this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.callbackRoundReward=function(){this.init()},e.prototype.init=function(){var t=GlobalConfig.RichManRoundAwardConfig[this.pos];t&&(Millionaire.ins().roundReward>>this.pos&1?(this.counttext.visible=!1,this.getreward.visible=!0,this.getreward.touchEnabled=!1,this.getlabel.visible=this.getreward.visible,this.getlabel.text="已领取",this.getreward.source="btn42"):(this.getreward.touchEnabled=!0,this.getlabel.text="领取",this.getreward.source="btn40",Millionaire.ins().round>=t.round?(this.counttext.visible=!1,this.getreward.visible=!this.counttext.visible,this.getlabel.visible=this.getreward.visible):(this.counttext.visible=!0,this.getreward.visible=!this.counttext.visible,this.getlabel.visible=this.getreward.visible)),this.count.text=""+(t.round-Millionaire.ins().round),this.partname.text="第"+t.round+"圈奖励",this.itemIcon.data={type:t.award[0].type,id:t.award[0].id,count:t.award[0].count})},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.getreward:var e=GlobalConfig.RichManRoundAwardConfig[this.pos];e&&(Millionaire.ins().roundReward>>this.pos&1?UserTips.ins().showTips("|C:0xff0000&T:已领取"):Millionaire.ins().round>=e.round?Millionaire.ins().sendRoundReward(this.pos):UserTips.ins().showTips("|C:0xff0000&T:所需圈数:"+e.round))}},e}(BaseEuiView);__reflect(MillionaireTipsWin.prototype,"MillionaireTipsWin"),ViewManager.ins().reg(MillionaireTipsWin,LayerManager.UI_Popup);var DIRECTION;!function(t){t[t.LEFT_TOP=1]="LEFT_TOP",t[t.TOP_MID=2]="TOP_MID",t[t.RIGHT_TOP=3]="RIGHT_TOP",t[t.LEFT_MID=4]="LEFT_MID",t[t.RIGHT_MID=5]="RIGHT_MID",t[t.LEFT_DOWN=6]="LEFT_DOWN",t[t.DOWN_MID=7]="DOWN_MID",t[t.RIGHT_DOWN=8]="RIGHT_DOWN",t[t.MOVING=9]="MOVING"}(DIRECTION||(DIRECTION={}));var MillionaireView=function(t){function e(){var e=t.call(this)||this;return e.step=3,e.count=0,e.gridList=[],e.curGridId=Millionaire.ins().gridId?Millionaire.ins().gridId:1,e.nextPos=e.curGridId,e.cameraWidth=GlobalConfig.RichManBaseConfig.cameraWidth,e.cameraHeight=GlobalConfig.RichManBaseConfig.cameraHeight,e.updateStop=!0,e.countDown=0,e.aniTime=0,e.dictime=10,e.count=0,e.effing=!1,e.btnUp=!1,e.stepNum=0,e.isUpdateRandom=!1,e.step=GlobalConfig.RichManBaseConfig.speed,e.diceimg=!1,e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateMillionaire,this),this.gridList=[],this.roleModel.destory(),DisplayUtils.removeFromParent(this.masksp)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Millionaire.ins().postMillionaireInfo,this.callbackMillionaireInfo),this.observe(Millionaire.ins().postTurnDice,this.callbackTurnDice),this.observe(Millionaire.ins().postOverAllReward,this.callbackOverAllReward),this.createMap(),this.createRole(),this.initPos(),TimerManager.ins().remove(this.updateMillionaire,this),TimerManager.ins().doTimer(this.dictime,0,this.updateMillionaire,this)},e.prototype.callbackMillionaireInfo=function(){},e.prototype.callbackTurnDice=function(){Millionaire.ins().isStrideStart?(this.nextPos=1,this.stepNum=Millionaire.ins().dicePoint-(this.gridList.length-this.curGridId)):this.nextPos=this.curGridId+Millionaire.ins().dicePoint;var t=GlobalConfig.RichManGridConfig[this.nextPos];t&&t.action==MillionaireItem.ACTION_3||1!=this.nextPos&&(this.nextPos=Millionaire.ins().gridId),Millionaire.ins().isAutoGo?this.countDown=0:this.countDown=GlobalConfig.RichManBaseConfig.diceTime,this.updateStop=!1},e.prototype.callbackOverAllReward=function(){this.isUpdateRandom=!0},e.prototype.updateMapEx=function(){var t=this;this.updateEff(function(){t.updateMap()})},e.prototype.updateMapOnly=function(){var t=this.curGridId;this.gridList[t].setHideEff(),Millionaire.ins().rewardIdByGrids[t]=-1},e.prototype.updateEff=function(t){this.aniTime=.5,this.effing=!0;var e=this;this.arrEff=[];for(var i=function(t){var i=s.gridList[t];if(GlobalConfig.RichManGridConfig[t].action==MillionaireItem.ACTION_3||GlobalConfig.RichManGridConfig[t].action==MillionaireItem.ACTION_4)return s.arrEff[t]=!0,"continue";if(s.arrEff[t]=!1,i){if(i.isEffing)return e.arrEff[t]=!0,"continue";egret.Tween.get(i.itemicon).to({scaleX:0,scaleY:0},1e3*s.aniTime).call(function(){egret.Tween.removeTweens(i.itemicon),e.arrEff[t]=!0})}},s=this,n=1;n<=this.gridList.length-1;n++)i(n);this.callfunc=t},e.prototype.getDirection=function(){if(this.mapGroup.width<=this.cameraWidth&&this.mapGroup.height<=this.cameraHeight)return DIRECTION.LEFT_TOP;var t=new egret.Point;t.x=this.gridList[this.curGridId].x,t.y=this.gridList[this.curGridId].y;var e=Math.floor(t.x+this.gridList[this.curGridId].width/2),i=Math.floor(t.y+this.gridList[this.curGridId].height/2);return e>=Math.floor(this.cameraWidth/2)&&i>=Math.floor(this.cameraHeight/2)&&e<=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&i<=Math.floor(this.mapGroup.height-this.cameraHeight/2)?DIRECTION.MOVING:e<=Math.floor(this.cameraWidth/2)&&i<=Math.floor(this.cameraHeight/2)?DIRECTION.LEFT_TOP:e>=Math.floor(this.cameraWidth/2)&&e<=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&i<=Math.floor(this.cameraHeight/2)?DIRECTION.TOP_MID:e>=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&i<=Math.floor(this.cameraHeight/2)?DIRECTION.RIGHT_TOP:e<=Math.floor(this.cameraWidth/2)&&i>=Math.floor(this.cameraHeight/2)&&i<=Math.floor(this.mapGroup.height-this.cameraHeight/2)?DIRECTION.LEFT_MID:e>=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&i>=Math.floor(this.cameraHeight/2)&&i<=Math.floor(this.mapGroup.height-this.cameraHeight/2)?DIRECTION.RIGHT_MID:e<=Math.floor(this.cameraWidth/2)&&i>=Math.floor(this.mapGroup.height-this.cameraHeight/2)?DIRECTION.LEFT_DOWN:e>=Math.floor(this.cameraWidth/2)&&e<=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&i>=Math.floor(this.mapGroup.height-this.cameraHeight/2)?DIRECTION.DOWN_MID:e>=Math.floor(this.mapGroup.width-this.cameraWidth/2)&&i>=Math.floor(this.mapGroup.height-this.cameraHeight/2)?DIRECTION.RIGHT_DOWN:0},e.prototype.initPos=function(){this.mapGroup.x=0,this.mapGroup.y=0;var t=this.gridList[this.curGridId].localToGlobal();this.globalToLocal(t.x,t.y,t);var e=this.getDirection();e==DIRECTION.MOVING?(this.mapGroup.x=this.cameraWidth/2-t.x-this.gridList[this.curGridId].width/2,this.mapGroup.y=this.cameraHeight/2-t.y-this.gridList[this.curGridId].height/2):e==DIRECTION.LEFT_TOP?(this.mapGroup.x=0,this.mapGroup.y=0):e==DIRECTION.TOP_MID?(this.mapGroup.x=-t.x+this.cameraWidth/2-this.gridList[this.curGridId].width/2,this.mapGroup.y=0):e==DIRECTION.RIGHT_TOP?(this.mapGroup.x=this.cameraWidth-this.mapGroup.width-this.gridList[this.curGridId].width/2,this.mapGroup.y=0):e==DIRECTION.LEFT_MID?(this.mapGroup.x=0,this.mapGroup.y=-t.y+this.cameraHeight/2-this.gridList[this.curGridId].height/2):e==DIRECTION.RIGHT_MID?(this.mapGroup.x=this.cameraWidth-this.mapGroup.width-this.gridList[this.curGridId].width/2,this.mapGroup.y=-t.y+this.cameraHeight/2-this.gridList[this.curGridId].height/2):e==DIRECTION.LEFT_DOWN?(this.mapGroup.x=0,this.mapGroup.y=this.cameraHeight-this.mapGroup.height-this.gridList[this.curGridId].height/2):e==DIRECTION.DOWN_MID?(this.mapGroup.x=-t.x+this.cameraWidth/2-this.gridList[this.curGridId].width/2,this.mapGroup.y=this.cameraHeight-this.mapGroup.height-this.gridList[this.curGridId].height/2):e==DIRECTION.RIGHT_DOWN&&(this.mapGroup.x=this.cameraWidth-this.mapGroup.width-this.gridList[this.curGridId].width/2,this.mapGroup.y=this.cameraHeight-this.mapGroup.height-this.gridList[this.curGridId].height/2),t=this.gridList[this.curGridId].localToGlobal(),this.globalToLocal(t.x,t.y,t),this.roleModel.x=t.x+this.roleModel.width/2,this.roleModel.y=t.y+this.roleModel.height/2},e.prototype.createRole=function(){var t=SubRoles.ins().getSubRoleByIndex(0);this.roleModel=new MillionaireRole(t.sex);var e=GlobalConfig.RichManGridConfig[this.curGridId];e&&(this.roleModel.state=e.dir),this.roleModel.width=53,this.roleModel.height=91,this.roleModel.x=this.roleModel.x+this.roleModel.width/2,this.roleModel.y=this.roleModel.y+this.roleModel.height/2,this.roleModel.updateModel(),this.addChild(this.roleModel)},e.prototype.createMap=function(){this.mapGroup||(this.mapGroup=new eui.Group,this.mapGroup.x=0,this.mapGroup.y=0,this.addChild(this.mapGroup));for(var t=1;t<=Millionaire.ins().rewardIdByGrids.length-1;t++){var i=GlobalConfig.RichManGridConfig[t];if(i){if(1==t){var s=new MillionaireItem;s.x=0,s.y=0,s.data={rewardId:Millionaire.ins().rewardIdByGrids[t],index:t},this.mapGroup.addChild(s),this.gridList[t]=s;continue}var n=GlobalConfig.RichManGridConfig[t-1];if(!n)continue;var o=new MillionaireItem;switch(o.data={rewardId:Millionaire.ins().rewardIdByGrids[t],index:t},this.gridList[t]=o,this.mapGroup.addChild(o),n.dir){case e.DIR_UP:o.x=this.gridList[t-1].x,o.y=this.gridList[t-1].y-this.gridList[t-1].height;break;case e.DIR_RIGHT:o.x=this.gridList[t-1].x+this.gridList[t-1].width,o.y=this.gridList[t-1].y;break;case e.DIR_DOWN:o.x=this.gridList[t-1].x,o.y=this.gridList[t-1].y+this.gridList[t-1].height;break;case e.DIR_LEFT:o.x=this.gridList[t-1].x-this.gridList[t-1].width,o.y=this.gridList[t-1].y}}}if(this.sortGrid(),!this.masksp){this.masksp=new egret.Sprite;var a=new egret.Shape;a.graphics.beginFill(16776960),a.graphics.drawRect(this.mapGroup.x,this.mapGroup.y-70,this.cameraWidth,this.cameraHeight+70),a.graphics.endFill(),this.masksp.addChild(a),this.addChild(this.masksp),this.mapGroup.mask=this.masksp}},e.prototype.updateMap=function(){for(var t=1;t<=this.gridList.length-1;t++)this.gridList[t].data={rewardId:Millionaire.ins().rewardIdByGrids[t],index:t},this.gridList[t].itemicon.scaleX=1,this.gridList[t].itemicon.scaleY=1},e.prototype.sortGrid=function(){this.mapGroup.$children.sort(this.sortF)},e.prototype.sortF=function(t,e){return t.y>e.y?1:t.y<e.y?-1:0},e.prototype.updateMillionaire=function(){if(this.countDown)return this.count+=this.dictime/100,this.count>=1&&(this.countDown-=.1,this.count=0),void(this.countDown<=0&&(this.countDown=0,this.count=0,this.diceimg=!1));if(this.effing){for(var t=!0,e=1;e<=this.arrEff.length-1;e++)if(!this.arrEff[e]){t=!1;break}return void(t&&(this.callfunc&&"function"==typeof this.callfunc&&this.callfunc(),this.effing=!1,this.callfunc=null,this.stepNum>0&&(this.nextPos+=this.stepNum,this.stepNum=0),this.curGridId==this.nextPos&&(this.btnUp=!1)))}this.updateStop||this.roleModel&&(this.checkRoleType(),this.roleModel.roleType==MillionaireRole.ACTION?this.Action():this.Stop())},e.prototype.checkRoleType=function(){this.curGridId!=this.nextPos&&(this.roleModel.roleType=MillionaireRole.ACTION)},e.prototype.getMoveGridId=function(){if(this.curGridId!=this.nextPos){var t=this.gridList[this.curGridId].localToGlobal();if(this.globalToLocal(t.x,t.y,t),t.x+this.roleModel.width/2==this.roleModel.x&&t.y+this.roleModel.height/2==this.roleModel.y){this.curGridId+=1,this.curGridId>this.gridList.length-1&&(this.curGridId=1);var e=GlobalConfig.RichManGridConfig[this.curGridId-1];e&&(this.roleModel.state=e.dir)}}return this.roleModel.updateModel(),this.curGridId},e.prototype.Stop=function(){this.updateStop=!0,this.roleModel.updateModel()},e.prototype.Action=function(){this.updateStop=!1;var t=this.getMoveGridId(),i=this.gridList[t].localToGlobal();this.globalToLocal(i.x,i.y,i);var s=0,n=0;switch(this.roleModel.state){case e.DIR_LEFT:case e.DIR_RIGHT:this.roleModel.x!=i.x+this.roleModel.width/2&&(s=i.x-this.roleModel.x+this.roleModel.width/2);break;case e.DIR_UP:case e.DIR_DOWN:this.roleModel.y!=i.y+this.roleModel.height/2&&(n=i.y-this.roleModel.y+this.roleModel.height/2)}Math.abs(s)>this.step&&(s=this.getStepPixel(this.roleModel.state)),Math.abs(n)>this.step&&(n=this.getStepPixel(this.roleModel.state));var o,a,r=this.getDirection();r!=DIRECTION.LEFT_TOP&&r!=DIRECTION.LEFT_MID&&r!=DIRECTION.LEFT_DOWN&&r!=DIRECTION.RIGHT_TOP&&r!=DIRECTION.RIGHT_MID&&r!=DIRECTION.RIGHT_DOWN&&r!=DIRECTION.TOP_MID&&r!=DIRECTION.DOWN_MID||!((r==DIRECTION.LEFT_TOP||r==DIRECTION.LEFT_MID||r==DIRECTION.LEFT_DOWN)&&(this.roleModel.state==e.DIR_RIGHT||this.roleModel.state==e.DIR_LEFT)&&this.mapGroup.x>=0||(r==DIRECTION.RIGHT_TOP||r==DIRECTION.RIGHT_MID||r==DIRECTION.RIGHT_DOWN)&&(this.roleModel.state==e.DIR_LEFT||this.roleModel.state==e.DIR_RIGHT)&&this.mapGroup.x<=-this.mapGroup.width+this.cameraWidth||(r==DIRECTION.TOP_MID||r==DIRECTION.DOWN_MID)&&this.roleModel.state==e.DIR_RIGHT&&this.roleModel.x+this.roleModel.width/2<this.cameraWidth/2||(r==DIRECTION.TOP_MID||r==DIRECTION.DOWN_MID)&&this.roleModel.state==e.DIR_LEFT&&this.roleModel.x+this.roleModel.width/2>this.cameraWidth/2)?(o=this.mapGroup,s=-s,a=!1):(o=this.roleModel,a=!0);var h,l=o.x+s;r!=DIRECTION.LEFT_TOP&&r!=DIRECTION.TOP_MID&&r!=DIRECTION.RIGHT_TOP&&r!=DIRECTION.LEFT_DOWN&&r!=DIRECTION.DOWN_MID&&r!=DIRECTION.RIGHT_DOWN&&r!=DIRECTION.LEFT_MID&&r!=DIRECTION.RIGHT_MID||!((r==DIRECTION.LEFT_TOP||r==DIRECTION.TOP_MID||r==DIRECTION.RIGHT_TOP)&&(this.roleModel.state==e.DIR_DOWN||this.roleModel.state==e.DIR_UP)&&this.mapGroup.y>=0||(r==DIRECTION.LEFT_DOWN||r==DIRECTION.DOWN_MID||r==DIRECTION.RIGHT_DOWN)&&(this.roleModel.state==e.DIR_UP||this.roleModel.state==e.DIR_DOWN)&&this.mapGroup.y<=-this.mapGroup.height+this.cameraHeight||(r==DIRECTION.LEFT_MID||r==DIRECTION.RIGHT_MID)&&this.roleModel.state==e.DIR_DOWN&&this.roleModel.y+this.roleModel.height/2<this.cameraHeight/2||(r==DIRECTION.LEFT_MID||r==DIRECTION.RIGHT_MID)&&this.roleModel.state==e.DIR_UP&&this.roleModel.y+this.roleModel.height/2>this.cameraHeight/2)?(o=this.mapGroup,n=-n,h=!1):(o=this.roleModel,h=!0);
var c=o.y+n;return s||n?(this.roleModel.roleType=MillionaireRole.ACTION,a?this.roleModel.x+this.roleModel.width/2<this.cameraWidth/2&&l+this.roleModel.width/2>this.cameraWidth/2||this.roleModel.x+this.roleModel.width/2>this.cameraWidth/2&&l+this.roleModel.width/2<this.cameraWidth/2?this.roleModel.x=this.cameraWidth/2-this.roleModel.width/2:this.roleModel.x=l:this.mapGroup.x=l,void(h?this.roleModel.y+this.roleModel.height/2<this.cameraHeight/2&&c+this.roleModel.height/2>this.cameraHeight/2||this.roleModel.y+this.roleModel.height/2>this.cameraHeight/2&&c+this.roleModel.height/2<this.cameraHeight/2?this.roleModel.y=this.cameraHeight/2-this.roleModel.height/2:this.roleModel.y=c:this.mapGroup.y=c)):(this.roleModel.roleType=MillionaireRole.STOP,this.doSometing(),void this.roleModel.updateModel())},e.prototype.doSometing=function(){var t=GlobalConfig.RichManGridConfig[this.curGridId];if(t){if(1==this.curGridId)return this.updateMapOnly(),void this.updateMapEx();if(t.action==MillionaireItem.ACTION_1)this.updateMapOnly();else if(t.action==MillionaireItem.ACTION_2){if(Millionaire.ins().randomGridById<=0)return void UserTips.ins().showCenterTips("踩中随机命运异常 检查4号消息是否有返回过");if(this.isUpdateRandom)this.isUpdateRandom=!1,this.updateMapEx();else{if(-1==Millionaire.ins().rewardIdByGrids[this.curGridId])return void(this.btnUp=!1);this.updateMapOnly()}}else t.action==MillionaireItem.ACTION_3?(this.nextPos=Millionaire.ins().gridId,this.curGridId=this.nextPos,this.initPos()):t.action==MillionaireItem.ACTION_4&&this.updateMapOnly();this.btnUp=!1}},e.prototype.getStepPixel=function(t){switch(t){case e.DIR_UP:return-this.step;case e.DIR_DOWN:return this.step;case e.DIR_RIGHT:return this.step;case e.DIR_LEFT:return-this.step}},e.prototype.checkCamera=function(t,i){if(i==DIRECTION.MOVING)return!0;switch(t){case e.DIR_UP:if(this.roleModel.y+this.roleModel.height/2>this.cameraHeight/2)return!1;break;case e.DIR_DOWN:if(this.roleModel.y+this.roleModel.height/2<this.cameraHeight/2)return!1;break;case e.DIR_RIGHT:if(this.roleModel.x+this.roleModel.width/2<this.cameraWidth/2)return!1;break;case e.DIR_LEFT:if(this.roleModel.x+this.roleModel.width/2>this.cameraWidth/2)return!1}return!0},e.prototype.destoryView=function(){t.prototype.destoryView.call(this),this.close()},e}(BaseEuiView);MillionaireView.DIR_UP=1,MillionaireView.DIR_RIGHT=2,MillionaireView.DIR_DOWN=3,MillionaireView.DIR_LEFT=4,__reflect(MillionaireView.prototype,"MillionaireView");var MillionaireWin=function(t){function e(){var e=t.call(this)||this;return e.isShowDice=!1,e.skinName="richmanSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.isOpen=function(){return GameServer.serverOpenDay<7?!1:!0},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=e.isOpen();return s||UserTips.ins().showTips("开服第二周开启"),s},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.addTouchEvent(this.go,this.onClick),this.addTouchEvent(this.autoGo,this.onClick),this.addTouchEvent(this.arrowleft,this.onClick),this.addTouchEvent(this.arrowright,this.onClick),this.observe(Millionaire.ins().postMillionaireInfo,this.callbackInfo),this.observe(Millionaire.ins().postTurnDice,this.callbackTurnDice),this.observe(Millionaire.ins().postRoundReward,this.callbackRoundReward),this.observe(Millionaire.ins().postMillionaireUpdate,this.callbackMillionaireUpdate),this.touchGroup.touchEnabled=!1,this.reward.touchEnabled=!1,this.paycount.touchEnabled=!1,this.y1.touchEnabled=!1,this.y2.touchEnabled=!1,this.touchMoving=!1,this.dice.visible=!1;for(var s=1;8>=s;s++)this.addTouchEvent(this["box"+s],this.onTab);var n=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;if(e.MaxBoxGroup=Math.floor(n/4),Millionaire.ins().isAutoGo=!1,this.startBoxId=0,this.beginPoint=0,this.touchMoving=!1,this.ewtime=300,this.actCircle=[],this.dicenum=1,this.isShowDice=!1,!this.masksp){this.masksp=new egret.Sprite;var o=new egret.Shape;o.graphics.beginFill(16776960),o.graphics.drawRect(this.group1.x,this.group1.y,this.group1.width,this.group1.height),o.graphics.endFill(),this.masksp.addChild(o),this.reward.addChild(this.masksp),this.reward.mask=this.masksp}this.init(),this.millionaireView.open(),TimerManager.ins().remove(this.updateMillionaire,this),TimerManager.ins().doTimer(100,0,this.updateMillionaire,this)},e.prototype.updateMillionaire=function(){return this.millionaireView.diceimg?(this.dice.visible=!0,void(this.isShowDice&&this.millionaireView.countDown<=GlobalConfig.RichManBaseConfig.diceTime/2?this.dice.source="richman_dice"+Millionaire.ins().dicePoint:(this.dice.source="richman_dice"+this.dicenum,this.dicenum++,this.dicenum>6&&(this.dicenum=1)))):(this.isShowDice=!1,this.dice.visible=!1,this.dicenum=1,void(Millionaire.ins().isAutoGo&&this.turnDice()))},e.prototype.callbackMillionaireUpdate=function(){this.init()},e.prototype.callbackInfo=function(){this.init()},e.prototype.callbackTurnDice=function(){this.isShowDice=!0,this.init()},e.prototype.callbackRoundReward=function(){UserTips.ins().showTips("|C:0x00ff00&T:领取成功"),this.init()},e.prototype.init=function(){this.checkStartIndex(),this.startBoxId=this.startBoxId?this.startBoxId:1,this.dicecount.text=Millionaire.ins().dice+"",this.count.text="当前圈数： "+(Millionaire.ins().round+1),this.paycount.text=GlobalConfig.RichManBaseConfig.dicePrice+"",this.setBoxPos()},e.prototype.setProgressBar=function(){for(var t=Millionaire.ins().round,e=(GlobalConfig.RichManRoundAwardConfig[Object.keys(GlobalConfig.RichManRoundAwardConfig).length].round,0),i=4*(this.startBoxId-1),s=100,n=i,o=0;i+4>n;n++,o++){var a=n+1;if(o)if(this["bar"+(o-1)]&&this["bar"+(o-1)].value<100)this["bar"+o].value=0,this["bar"+o].labelFunction=function(){return""};else{var r=GlobalConfig.RichManRoundAwardConfig[a],h=GlobalConfig.RichManRoundAwardConfig[a-1],l=r.round-h.round,c=t-h.round;c=c>0?c:0;var u=c/l;e=u>=1?s:Math.floor(s*u),this["bar"+o].value=e>=100?100:e,this["bar"+o].labelFunction=function(){return""}}}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.go:this.turnDice();break;case this.autoGo:Millionaire.ins().isAutoGo=!Millionaire.ins().isAutoGo,this.autoGo.label=Millionaire.ins().isAutoGo?"停止":"自动掷骰子";break;case this.arrowleft:this.MoveLeft();break;case this.arrowright:this.MoveRight()}},e.prototype.turnDice=function(){var t=this;if(!this.millionaireView.effing&&!this.millionaireView.btnUp)if(Millionaire.ins().dice>0)Millionaire.ins().sendTurnDice(),this.millionaireView.btnUp=!0,Millionaire.ins().isAutoGo||(this.millionaireView.diceimg=!0);else if(Millionaire.ins().autoTurnDice)this.cost();else{if(Millionaire.ins().isAutoGo)return void this.cost();WarnWin.show("是否消费"+GlobalConfig.RichManBaseConfig.dicePrice+"元宝投掷一次?",function(){t.cost()},this,function(){SysSetting.ins().setBool(SysSetting.DICE,!1),Millionaire.ins().autoTurnDice=0},this,"check")}},e.prototype.cost=function(){Actor.yb>=GlobalConfig.RichManBaseConfig.dicePrice?(Millionaire.ins().sendTurnDice(),this.millionaireView.btnUp=!0,Millionaire.ins().isAutoGo||(this.millionaireView.diceimg=!0),this.flyRMB(GlobalConfig.RichManBaseConfig.dicePrice)):(UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),Millionaire.ins().isAutoGo=!1,this.millionaireView.btnUp=!1,this.autoGo.label="自动掷骰子")},e.prototype.onTab=function(t){for(var e=1;8>=e;e++)if(t.currentTarget==this["box"+e]){this.getReward(e);break}},e.prototype.getReward=function(t){ViewManager.ins().open(MillionaireTipsWin,t)},e.prototype.onBegin=function(t){this.touchMoving||(this.beginPoint=t.stageX)},e.prototype.onEnd=function(t){if(!this.touchMoving&&0!=this.beginPoint){var e=t.stageX-this.beginPoint;Math.abs(e)<5||this.Moving(e)}},e.prototype.Moving=function(t){0>t?this.MoveRight():this.MoveLeft()},e.prototype.MoveRight=function(){var t=this;this.touchMoving=!0;var i=this;if(this.startBoxId>=e.MaxBoxGroup)return this.touchMoving=!1,this.arrowright.visible=!1,void(this.arrowleft.visible=!this.arrowright.visible);this.startBoxId++,this.startBoxId>=e.MaxBoxGroup&&(this.startBoxId=e.MaxBoxGroup,this.arrowright.visible=!1,this.arrowleft.visible=!this.arrowright.visible);for(var s=function(s){egret.Tween.get(n["group"+s]).to({x:n["group"+s].x-n["group"+s].width},n.ewtime).call(function(){egret.Tween.removeTweens(i["group"+s]),s==e.MaxBoxGroup&&(i.setBoxPos(),i.touchMoving=!1,t.arrowleft.visible=!0)})},n=this,o=1;o<=e.MaxBoxGroup;o++)s(o)},e.prototype.MoveLeft=function(){var t=this;this.touchMoving=!0;var i=this;if(this.startBoxId<=1){this.touchMoving=!1,this.arrowleft.visible=!1,this.arrowright.visible=!this.arrowleft.visible;var s=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;return void(1==Math.floor(s/4)&&(this.arrowright.visible=!1))}if(this.startBoxId--,this.startBoxId<=1){this.startBoxId=1,this.arrowleft.visible=!1,this.arrowright.visible=!this.arrowleft.visible;var s=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;1==Math.floor(s/4)&&(this.arrowright.visible=!1)}for(var n=function(s){egret.Tween.get(o["group"+s]).to({x:o["group"+s].x+o["group"+s].width},o.ewtime).call(function(){egret.Tween.removeTweens(i["group"+s]),s==e.MaxBoxGroup&&(i.setBoxPos(),i.touchMoving=!1,t.arrowright.visible=!0)})},o=this,a=1;a<=e.MaxBoxGroup;a++)n(a)},e.prototype.setBoxPos=function(){for(var t=1;t<=e.MaxBoxGroup;t++)if(1!=t){var i=t-this.startBoxId;this["group"+t].x=this["group"+(t-1)].x+this["group"+t].width*i}else this["group"+t].x=48;for(var t=1;t<=e.MaxBoxGroup;t++)if(t==this.startBoxId)this["group"+t].x=48;else if(t<this.startBoxId){var i=this.startBoxId-t,s=t-1>0?t-1:1;this["group"+t].x=this["group"+s].x-this["group"+t].width*i}else{var i=t-this.startBoxId;this["group"+t].x=this["group"+(t-1)].x+this["group"+t].width*i}this.updateRewardUI()},e.prototype.updateRewardUI=function(){for(var t=4*(this.startBoxId-1),e=0,i=t;t+4>i;i++){var s=i+1;if(Millionaire.ins().roundReward>>s&1)this["box"+e+"desc"].textFlow=TextFlowMaker.generateTextFlow1("|C:0x35E62D&T:已领取"),this.clearEff(e);else{var n=GlobalConfig.RichManRoundAwardConfig[s].round;this["box"+e+"desc"].textFlow=TextFlowMaker.generateTextFlow1("|C:0xD1C28F&T:第"+n+"圈"),this.updateEff(e,n)}e++}this.setProgressBar()},e.prototype.updateEff=function(t,e){Millionaire.ins().round>=e?(this.actCircle[t]||(this.actCircle[t]=new MovieClip),this.actCircle[t].parent||this.reward.addChild(this.actCircle[t]),this.actCircle[t].x=this["box"+t+"under"].x+40,this.actCircle[t].y=this["box"+t+"under"].y+50,this.actCircle[t].playFile(RES_DIR_EFF+"actIconCircle",-1)):DisplayUtils.removeFromParent(this.actCircle[t])},e.prototype.clearEff=function(t){DisplayUtils.removeFromParent(this.actCircle[t])},e.prototype.checkStartIndex=function(){for(var t=1;t<=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;t++){var i=GlobalConfig.RichManRoundAwardConfig[t];if(i&&!(Millionaire.ins().roundReward>>t&1)){this.startBoxId=Math.floor(t/5)+1;break}}if(this.startBoxId<=1){this.arrowleft.visible=!1,this.arrowright.visible=!this.arrowleft.visible;var s=Object.keys(GlobalConfig.RichManRoundAwardConfig).length;1==Math.floor(s/4)&&(this.arrowright.visible=!1)}else this.startBoxId>=e.MaxBoxGroup?(this.arrowleft.visible=!0,this.arrowright.visible=!this.arrowleft.visible):(this.arrowleft.visible=!0,this.arrowright.visible=!0)},e.prototype.flyRMB=function(t){var e=new eui.BitmapLabel;e.font="num_2_fnt",e.y=this.roleSelect.y+10,e.x=this.roleSelect.x+490,e.scaleX=e.scaleY=1.5,e.text="-"+t,this.roleSelect.parent.addChild(e),egret.Tween.get(e).to({y:e.y+50},1e3).call(function(){DisplayUtils.removeFromParent(e)})},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.go,this.onClick),this.removeTouchEvent(this.autoGo,this.onClick),this.millionaireView.close();for(var i=1;8>=i;i++)this.removeTouchEvent(this["box"+i],this.onTab);TimerManager.ins().remove(this.updateMillionaire,this);for(var i=0;i<this.actCircle.length;i++)this.actCircle[i]&&DisplayUtils.removeFromParent(this.actCircle[i]);DisplayUtils.removeFromParent(this.masksp),this.masksp=null,this.removeObserve()},e}(BaseEuiView);MillionaireWin.MaxBoxGroup=2,__reflect(MillionaireWin.prototype,"MillionaireWin"),ViewManager.ins().reg(MillionaireWin,LayerManager.UI_Main);var Mine=function(t){function e(){var e=t.call(this)||this;return e.mineStartTime=0,e.mineEndTime=0,e.hasNewRecord=!1,e.sysId=PackageID.Mine,e.regNetMsg(1,e.postMineBaseInfo),e.regNetMsg(2,e.postRefresh),e.regNetMsg(3,e.postStartMine),e.regNetMsg(4,e.postInitScene),e.regNetMsg(6,e.postMineRecord),e.regNetMsg(7,e.doReqResult),e.regNetMsg(8,e.postFightBackResult),e.regNetMsg(9,e.postEnemyAppear),e.regNetMsg(11,e.postSceneUpdate),e.regNetMsg(13,e.postRobResult),e.regNetMsg(15,e.postFinished),e.regNetMsg(16,e.postRecordHasUpdate),e.regNetMsg(17,e.postRoleInfo),e.observe(GameLogic.ins().postEnterMap,e.onEnterMap),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onEnterMap=function(){GameMap.sceneInMine()&&this.hasNewRecord&&!this.finishedData&&ViewManager.ins().open(MineRecordWin)},e.openCheck=function(t){var e=GlobalConfig.CaiKuangConfig.openServerDay;if(e>GameServer.serverOpenDay+1)return t&&UserTips.ins().showTips("开服第"+e+"天开启"),!1;var i=GlobalConfig.CaiKuangConfig.openLevel,s=Actor.level>=i;return s?s:(t&&UserTips.ins().showTips(i+"级开启"),!1)},e.redpointCheck=function(){var t=this.openCheck();if(!t)return t;var i=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;return e.ins().finishedData||e.ins().mineCount<GlobalConfig.CaiKuangConfig.maxOpenKuangCount+i&&e.ins().isOverTime()||e.ins().hasNewRecord?t:!1},e.prototype.isOverTime=function(){return e.ins().mineEndTime?GameServer.serverTime>e.ins().mineEndTime?!0:!1:!0},e.prototype.postRedPoint=function(){return e.redpointCheck()?1:0},e.prototype.postMineFightState=function(t){return t},e.prototype.postMineBaseInfo=function(t){this.mineCount=t.readShort(),this.robCount=t.readShort(),this.mineId=t.readInt(),this.mineFreshCount=t.readInt(),this.mineQuaCount=t.readInt(),this.mineEndTime=DateUtils.formatMiniDateTime(t.readInt()),this.mineId||(this.finishedData=null),e.ins().postRedPoint()},e.prototype.postRefresh=function(t){this.mineId=t.readInt(),this.mineFreshCount=t.readInt();var i=t.readInt();if(i>this.mineQuaCount){var s=GlobalConfig.KuangYuanConfig[e.ins().mineId],n=Math.floor(s.maxTimes/s.baseTime);UserTips.ins().showTips("升级失败，祝福值+"+n)}this.mineQuaCount=i},e.prototype.postStartMine=function(t){this.mineCount=t.readShort(),e.ins().postRedPoint()},e.prototype.postInitScene=function(t){MineData.ins().parser(t)},e.prototype.postMineRecord=function(t){var i=t.readShort();this.mineRecords=this.mineRecords||[],this.mineRecords.length=i;for(var s=0;i>s;s++)this.mineRecords[s]=this.mineRecords[s]||new MineRecord,this.mineRecords[s].parser(t);this.hasNewRecord=!1,e.ins().postRedPoint()},e.prototype.doReqResult=function(t){var e=t.readBoolean();e?MineFight.ins().start({type:0,id:this.robData.configID,actorID:this.robData.actorID}):UserTips.ins().showTips("不可掠夺")},e.prototype.postFightBackResult=function(t){for(var e=t.readBoolean(),i=t.readInt(),s=0,n=this.mineRecords;s<n.length;s++){var o=n[s];if(o.index==i){o.isBeatHim=e?1:0;break}}},e.prototype.postEnemyAppear=function(t){var e=new MineEnemyModel;return e.parser(t),e},e.prototype.postSceneUpdate=function(t){var e=ObjectPool.pop("MineSceneInfo");e.parser(t),e.handler(),e.destroy()},e.prototype.postRobResult=function(t){this.robCount=t.readShort()},e.prototype.postFinished=function(t){this.mineStartTime=0,this.mineEndTime=0,this.finishedData={},this.finishedData.configID=t.readShort(),this.finishedData.beRob=[];for(var i=t.readShort(),s=0;i>s;s++){var n={};n.name=t.readString(),n.win=t.readBoolean(),this.finishedData.beRob.push(n)}this.openRobWin(),e.ins().postRedPoint()},e.prototype.openRobWin=function(){GameMap.sceneInMine()&&!MineFight.ins().isFighting&&this.finishedData&&ViewManager.ins().open(MineRobWin,this.finishedData)},e.prototype.postRecordHasUpdate=function(t){return this.hasNewRecord=!0,e.ins().postRedPoint(),1},e.prototype.postRoleInfo=function(t){var e=t.readDouble();return e},e.prototype.sendIntoMine=function(){this.sendBaseProto(1)},e.prototype.sendRefresh=function(t){if(!t)return void this.sendBaseProto(2);var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.sendStart=function(){this.sendBaseProto(3)},e.prototype.sendGetAward=function(t){void 0===t&&(t=!1);var e=this.getBytes(5);e.writeShort(t?1:0),this.sendToServer(e)},e.prototype.sendGetRecord=function(){this.sendBaseProto(6)},e.prototype.sendRob=function(t){this.robData=t;var e=t.actorID,i=this.getBytes(7);i.writeInt(e),this.sendToServer(i)},e.prototype.sendFightBack=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.sendFightBackResult=function(t,e){var i=this.getBytes(10);i.writeInt(t?1:0),i.writeInt(e),this.sendToServer(i)},e.prototype.sendQuickFinish=function(){this.sendBaseProto(12)},e.prototype.sendRobResult=function(t,e,i){var s=this.getBytes(13);s.writeInt(t?1:0),this.sendToServer(s)},e.prototype.sendSceneChange=function(t){var e=this.getBytes(14);e.writeShort(t?1:0),this.sendToServer(e)},e.prototype.sendGetRolePower=function(t){var e=this.getBytes(17);e.writeInt(t),this.sendToServer(e)},e}(BaseSystem);__reflect(Mine.prototype,"Mine");var GameSystem;!function(t){t.mine=Mine.ins.bind(Mine)}(GameSystem||(GameSystem={}));var MineData=function(t){function e(){var e=t.call(this)||this;return e.isShowTransfer=!0,e.mines=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.parser=function(t){this.index=t.readShort(),this.isExitUp=!!t.readShort(),this.isExitDown=!!t.readShort();var e=t.readShort();this.removeAll();for(var i=0;e>i;i++)this.mines[i]=ObjectPool.pop("MineModel"),this.mines[i].parser(t),this.checkIsMyMine(this.mines[i]),this.updateMineConfig(this.mines[i]);this.resetRole(),this.createTransfer(),this.createEntity(),this.showAwardWin()},e.prototype.showAwardWin=function(){Mine.ins().finishedData&&ViewManager.ins().open(MineRobWin,Mine.ins().finishedData)},e.prototype.resetRole=function(){EntityManager.ins().resetRole();for(var t=SubRoles.ins().subRolesLen,e=1;t>e;e++){var i=SubRoles.ins().roles[e],s=EntityManager.ins().getEntityByHandle(i.handle);s&&(s.visible=!1)}},e.prototype.createTransfer=function(){if(this.isShowTransfer){GlobalConfig.CaiKuangConfig.transPos;if(this.isExitUp){var t=EntityManager.ins().getTransferById(0);t?(t.infoModel.index=this.index-1,t.updateModel()):this.addTransfer(0,this.index-1)}else EntityManager.ins().removeTransferById(0);if(this.isExitDown){var t=EntityManager.ins().getTransferById(1);t?(t.infoModel.index=this.index+1,t.updateModel()):this.addTransfer(1,this.index+1)}else EntityManager.ins().removeTransferById(1)}},e.prototype.showTransfer=function(t){this.isShowTransfer=t,t?this.createTransfer():(EntityManager.ins().removeTransferById(0),EntityManager.ins().removeTransferById(1))},e.prototype.addTransfer=function(t,e){var i=GlobalConfig.CaiKuangConfig.transPos,s=new TransferModel;s.configID=t,s.index=e;var n=i[s.configID];s.x=n.x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),s.y=n.y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),EntityManager.ins().createEntity(s)},e.prototype.createEntity=function(){for(var t=0,e=this.mines;t<e.length;t++){var i=e[t];GameLogic.ins().createEntityByModel(i)}TimerManager.ins().isExists(this.updateTime,this)||TimerManager.ins().doTimer(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){for(var t=0,e=this.mines;t<e.length;t++){var i=e[t],s=EntityManager.ins().getMineByIndex(i.index);s&&s.updateTime()}},e.prototype.getMineByIndex=function(t,e){for(var i=0,s=this.mines;i<s.length;i++){var n=s[i];if(n.index==t)return e&&e!=n.actorID?null:n}},e.prototype.add=function(t){this.remove(t.index),e.ins().mines.push(t),this.checkIsMyMine(t),this.updateMineConfig(t),GameLogic.ins().createEntityByModel(t)},e.prototype.updateMineConfig=function(t){var e=GlobalConfig.CaiKuangConfig.kuangPos,i=e[t.index-1];t.x=i.x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),t.y=i.y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),t.dir=i.d},e.prototype.checkIsMyMine=function(t){return t.actorID==Actor.actorID?(this.myMine=t.clone(this.myMine),Mine.ins().mineStartTime=this.myMine.startTime,Mine.ins().mineEndTime=this.myMine.endTime,!0):!1},e.prototype.getIsCanAtk=function(t){return t.actorID==Actor.actorID?!1:e.ins().getMineByIndex(t.index,t.actorID)?t.isBeFight?!1:t.beFightActorID.length>=GlobalConfig.CaiKuangConfig.maxBeRobCount?!1:t.beFightActorID.indexOf(Actor.actorID)>=0?!1:Mine.ins().robCount>=GlobalConfig.CaiKuangConfig.maxRobCount?!1:!0:!1},e.prototype.remove=function(t){for(var e in this.mines){var i=this.mines[e];if(i.index==t){this.mines.splice(parseInt(e),1),EntityManager.ins().removeMineByIndex(t);break}}},e.prototype.removeAll=function(){for(;this.mines.length;){var t=this.mines.pop();EntityManager.ins().removeMineByIndex(t.index)}TimerManager.ins().removeAll(this)},e}(BaseClass);__reflect(MineData.prototype,"MineData");var MineEnemyModel=function(){function t(){this.subRole=[],this.hejiLvl=0,this.weiWang=0}return t.prototype.parser=function(t){this.lv=t.readShort(),this.zsLv=t.readShort(),this.name=t.readString();for(var e=t.readShort(),i=0;e>i;i++){var s=this.subRole[i]=new Role;s.parser(t),s.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData,this.fireRing.parser(t),this.hejiLvl=t.readInt(),this.weiWang=t.readInt(),MineFight.ins().createEnemy(this)},t.prototype.getJobRoles=function(){var t=[].concat(this.subRole);return t.sort(function(t,e){return t.job<e.job?-1:1}),t},t}();__reflect(MineEnemyModel.prototype,"MineEnemyModel");var MineFight=function(t){function e(){var e=t.call(this)||this;return e.isFighting=0,e.range=4,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.start=function(t){if(!this.isFighting){this.isFighting=1,this.handles=[],this._data=t;var e=EntityManager.ins().getAllEntity(),i=EntityManager.ins().getNoDieRole();for(var s in e){var n=e[s].infoModel;n&&(0==t.type&&n.type==EntityType.Mine&&n.actorID==t.actorID||e[s]!=i&&(e[s].visible=!1))}this.setShowUI(!1),UserSkill.ins().setHejiCD(6e3),this.enemyPoints=this.getEnemyPoint(),this.startPos={x:i.x,y:i.y};for(var o=DirUtil.get8DirBy2Point(this.startPos,{x:GameMap.grip2Point(this.enemyPoints[0][0]),y:GameMap.grip2Point(this.enemyPoints[0][1])}),a=0;a<SubRoles.ins().subRolesLen;a++){var r=EntityManager.ins().getJobMainRole(a);if(!r)break;if(0==a)r.x=this.startPos.x,r.y=this.startPos.y;else{var h=GameMap.getPosRangeRandom(this.startPos.x,this.startPos.y,DirUtil.dirOpposit(o),a);r.x=GameMap.grip2Point(h[0]),r.y=GameMap.grip2Point(h[1])}r.dir=o,r.visible=!0,r.AI_STATE=AI_State.Stand,this.playTransferEffect(r),this.handles.push(r.infoModel.handle),RoleAI.ins().add(r)}GameLogic.ins().postMoveCamera()}},e.prototype.stop=function(){if(this.isFighting){this.isFighting=0,this._model=null,HejiUseMgr.ins().unregister(this),TimerManager.ins().removeAll(this);var t=EntityManager.ins().getAllEntity();for(var e in t)t[e].infoModel&&t[e].infoModel.type!=EntityType.Monster&&(t[e].visible=!0);for(var i=0;i<this.handles.length;i++){var e=this.handles[i];EntityManager.ins().removeByHandle(e)}this.resetRole(),this.setShowUI(!0),RoleAI.ins().stop(),RoleAI.ins().clearAIList(),GameMap.sceneInMine()&&Mine.ins().finishedData&&ViewManager.ins().open(MineRobWin,Mine.ins().finishedData),GameLogic.ins().postMoveCamera()}},e.prototype.resetRole=function(){MineData.ins().resetRole();var t=SubRoles.ins().getSubRoleByIndex(0),e=EntityManager.ins().getEntityByHandle(t.handle);e.x=this.startPos.x,e.y=this.startPos.y,e.AI_STATE=AI_State.Stand},e.prototype.fightEnd=function(t){t?this.fightWin():this.fightFail()},e.prototype.fightWin=function(){var t=this,e=this._data.id,i=GlobalConfig.KuangYuanConfig[e],s=this.getAward(i);s=this.getCountAward(s);for(var n=0,o=s;n<o.length;n++){var a=o[n];0!=a.type&&Encounter.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,a)}var r=EntityManager.ins().getAllEntity(),h=function(t){var e=r[t].infoModel;return e?0==l._data.type&&e.type==EntityType.Mine&&e.actorID==l._data.actorID?(egret.Tween.get(r[t]).to({alpha:0},1e3).call(function(){r[t].visible=!1,r[t].alpha=1}),"break"):void 0:"continue"},l=this;for(var c in r){var u=h(c);if("break"===u)break}var p=function(){t.sendToServer(!0),TimerManager.ins().doTimer(1e3,1,t.stop,t);for(var e=EntityManager.ins().getEntityByTeam(Team.My),i=0,s=e;i<s.length;i++){var n=s[i];n.stopMove(),n instanceof CharRole?t.playTransferEffect(n):EntityManager.ins().removeByHandle(n.infoModel.handle)}SoundUtil.ins().playEffect(SoundUtil.SCENE)};DropHelp.addCompleteFunc(p,this),DropHelp.start()},e.prototype.fightFail=function(){var t=this;this.sendToServer(!1),Encounter.ins().postFightResult(0),TimerManager.ins().doTimer(2e3,1,function(){t.stop()},this)},e.prototype.sendToServer=function(t){0==this._data.type?Mine.ins().sendRobResult(t,this._data.id,this._data.actorID):Mine.ins().sendFightBackResult(t,this._data.index)},e.prototype.setShowUI=function(t){GameMap.sceneInMine()&&(MineData.ins().showTransfer(t),Mine.ins().postMineFightState(t?1:0))},e.prototype.getRoles=function(){return this._model?this._model.subRole:null},e.prototype.getSkillLvl=function(){return this._model?this._model.hejiLvl:0},e.prototype.getIsWeiShe=function(t){if(!this._model)return!1;var e=this._model;return t?Actor.weiWang>e.weiWang:Actor.weiWang<e.weiWang},e.prototype.getWeiSheHurt=function(t){if(!this.getIsWeiShe(t))return 0;var e=Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG),i="";i=t?Actor.myName:this._model&&this._model.subRole[0].name;var s=0;if(e)for(var n=0;3>n;n++){var o=e.getDataList(n);if(o&&o.player==i){s=o.pos;break}}return GlobalConfig.PrestigeBase.rankDeterDam[s-1]||GlobalConfig.PrestigeBase.normalDeterDam},e.prototype.createEnemy=function(t){this._model=t;var e=t.getJobRoles(),i=EntityManager.ins().getNoDieRole();HejiUseMgr.ins().register(this);for(var s=0;s<e.length;s++){var n=e[s];n.masterHandle=10*n.masterHandle,n.type=EntityType.Role;var o=this.enemyPoints[s]||GameMap.getPosRangeRandom(i.x,i.y,i.dir,this.range+s);o?(n.x=GameMap.grip2Point(o[0]),n.y=GameMap.grip2Point(o[1])):(n.x=i.x,n.y=i.y),n.dir=DirUtil.dirOpposit(i.dir);var a=GameLogic.ins().createEntityByModel(n,Team.WillEntity);a.dir=DirUtil.dirOpposit(i.dir),a.AI_STATE=AI_State.Stand,a.updateNeiGong(),this.playTransferEffect(a),this.handles.push(n.handle),RoleAI.ins().add(a)}RoleAI.ins().start()},e.prototype.playTransferEffect=function(t){var e=new MovieClip;e.playFile(RES_DIR_SKILLEFF+"skill208",1),t.addChild(e),t.playAction(EntityAction.ATTACK)},e.prototype.getAward=function(t){for(var e=t.rewards,i=[],s=t.robPrecent,n=0;n<e.length;n++){var o=new RewardData;o.type=e[n].type,o.id=e[n].id,o.count=Math.ceil(e[n].count*s/100),1==this._data.type&&(o.count*=2),i.push(o)}return i},e.prototype.getCountAward=function(t){for(var e=[],i=0,s=t;i<s.length;i++)for(var n=s[i];n.count>0;){var o=new RewardData;o.type=n.type,o.id=n.id,o.count=n.count>10?10:n.count,e.push(o),n.count-=10}return e},e.prototype.getEnemyPoint=function(){for(var t=EntityManager.ins().getNoDieRole(),e=GameMap.point2Grip(t.x),i=GameMap.point2Grip(t.y),s=[],n=0,o=0,a=Math.random()>.5,r=0;8>r;r++){for(var h=a?r:7-r,l=this.range;l<this.range+3;l++){var c=GameMap.getPosRangeByDir(e,i,h,l);c[2]&&(s[h]=s[h]||[],s[h].push(c))}if(s[h]&&s[h].length>=3)return s[h]}for(var r=0;r<s.length;r++)s[r]&&s[r].length>o&&(o=s[r].length,n=r);return s[n]},e}(BaseClass);__reflect(MineFight.prototype,"MineFight",["IHejiUse"]);var MineRecord=function(){function t(){}return t.prototype.parser=function(e){this.index=e.readShort(),this.type=e.readByte(),this.time=DateUtils.formatMiniDateTime(e.readInt()),this.type==t.TYPE_BEROB?(this.configID=e.readByte(),this.fighterActorID=e.readInt(),this.fighterName=e.readString(),this.fighterIsWin=e.readByte(),this.isBeatHim=e.readByte(),this.fighterJob=e.readByte(),this.fighterSex=e.readByte(),this.fighterPower=e.readInt()):(this.configID=e.readByte(),this.robActorID=e.readInt(),this.robMasterName=e.readString(),this.robIsWin=e.readByte())},t}();MineRecord.TYPE_BEROB=1,MineRecord.TYPE_ROB=2,__reflect(MineRecord.prototype,"MineRecord");var MineSceneUpdate;!function(t){t[t.fighting=1]="fighting",t[t.finished=2]="finished",t[t.addNew=3]="addNew",t[t.scene=4]="scene",t[t.updateMine=5]="updateMine",t[t.userInfo=6]="userInfo"}(MineSceneUpdate||(MineSceneUpdate={}));var MineSceneInfo=function(){function t(){}return t.prototype.parser=function(t){this.index=t.readShort(),this.type=t.readShort(),this.type==MineSceneUpdate.fighting?this.state=t.readByte():this.type==MineSceneUpdate.addNew?(this.mine=ObjectPool.pop("MineModel"),this.mine.parser(t)):this.type==MineSceneUpdate.scene?(this.sceneIndex=t.readShort(),this.isExitUp=!!t.readShort(),this.isExitDown=!!t.readShort()):this.type==MineSceneUpdate.updateMine?this.actorId=t.readInt():this.type==MineSceneUpdate.userInfo&&(this.mine=MineData.ins().getMineByIndex(this.index),this.mine&&this.mine.parser(t))},t.prototype.handler=function(){if(this.type==MineSceneUpdate.fighting){var t=MineData.ins().getMineByIndex(this.index);if(t){t.isBeFight=1==this.state;var e=EntityManager.ins().getMineByIndex(this.index);e&&e.updateTitleState()}}else if(this.type==MineSceneUpdate.finished)MineData.ins().remove(this.index);else if(this.type==MineSceneUpdate.addNew)MineData.ins().add(this.mine);else if(this.type==MineSceneUpdate.scene)MineData.ins().isExitUp=this.isExitUp,MineData.ins().isExitDown=this.isExitDown,MineData.ins().index=this.sceneIndex,MineData.ins().createTransfer();else if(this.type==MineSceneUpdate.updateMine){var t=MineData.ins().getMineByIndex(this.index);if(t){t.beFightActorID.push(this.actorId);var e=EntityManager.ins().getMineByIndex(this.index);e&&e.updateTitleState()}}else if(this.type==MineSceneUpdate.userInfo){var e=EntityManager.ins().getMineByIndex(this.index);e&&e.updateModel()}},t.prototype.destroy=function(){this.mine=null,ObjectPool.push(this)},t}();__reflect(MineSceneInfo.prototype,"MineSceneInfo");var MineChoseWorkerRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChoseWorkerItemSkin",e.reward.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.nameTxt.text=e.name,this.nameTxt.textColor=e.color;var i=[].concat(e.rewards);e.rewardItem&&e.rewardItem.length?(i=i.concat(e.rewardItem),this.label.visible=!0,this.noRobBg.visible=!0):(this.label.visible=!1,this.noRobBg.visible=!1),this.reward.dataProvider=new eui.ArrayCollection(i);var s=GlobalConfig.NpcBaseConfig[e.npcId];this.worker.source=s.icon,e.id==(Mine.ins().mineId||1)?(this.arrow.visible=!0,this.selectedImg.visible=!0):(this.arrow.visible=!1,this.selectedImg.visible=!1)},e}(BaseItemRender);__reflect(MineChoseWorkerRender.prototype,"MineChoseWorkerRender");var MineChoseWorkerWin=function(t){function e(){var e=t.call(this)||this;return e._cost=0,e.skinName="ChoseWorkerSin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.record.itemRenderer=MineChoseWorkerRender},e.prototype.open=function(){this.observe(Mine.ins().postRefresh,this.update),this.addTouchEvent(this.advance,this.onTap),this.addTouchEvent(this.start,this.onTap),this.initList(),this.update()},e.prototype.onTap=function(t){var e=this,i=t.currentTarget;if(i==this.advance){if(!this.openCheck())return;if(this.isMaxLevel())return void UserTips.ins().showCenterTips("已满级");var s=this.checkBox.selected?1:2;if(this.checkBox.selected){var n=UserBag.ins().getBagItemById(GlobalConfig.CaiKuangConfig.needItem.id);if(!n||n.count<GlobalConfig.CaiKuangConfig.needItem.count)return void UserTips.ins().showTips("|C:0xff0000&T:道具不足")}else if(Actor.yb<this._cost)return void UserTips.ins().showTips("元宝不足");Mine.ins().sendRefresh(s)}else if(i==this.start){if(!this.openCheck())return;
if(!this.isMaxLevel())return void WarnWin.show("当前不是最高品质，是否确认挖矿？",function(){Mine.ins().sendStart(),e.checkBox.selected=!1,ViewManager.ins().close(e)},this);Mine.ins().sendStart(),ViewManager.ins().close(this)}},e.prototype.initList=function(){var t=GlobalConfig.KuangYuanConfig,e=[];for(var i in t)e.push(t[i]);this.record.dataProvider=new eui.ArrayCollection(e),this._lastMineId=Mine.ins().mineId},e.prototype.update=function(){var t=GlobalConfig.CaiKuangConfig.refreshCost,e=t.length,i=Mine.ins().mineFreshCount,s=i>=e?t[e-1]:t[i];this._cost=s,this.yuanbaoNum.text=""+s;var n=UserBag.ins().getBagItemById(GlobalConfig.CaiKuangConfig.needItem.id),o=65280;(!n||n.count<GlobalConfig.CaiKuangConfig.needItem.count)&&(o=16711680);var a=n?n.count+"":"0";this.num1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+a),this.needlabel.text="/"+GlobalConfig.CaiKuangConfig.needItem.count;var r=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0,h=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+r,l=Mine.ins().mineCount;if(l>=h?this.countTxt.textFlow=TextFlowMaker.generateTextFlow1("今日采矿次数：|C:0xff0000&T:"+(h-l)+"/"+h+"|"):this.countTxt.textFlow=TextFlowMaker.generateTextFlow1("今日采矿次数：|C:0x00ff00&T:"+(h-l)+"/"+h+"|"),Mine.ins().mineId){var c=GlobalConfig.KuangYuanConfig[Mine.ins().mineId];this.expBar0.maximum=c.maxTimes,this.expBar0.value=Math.ceil(c.maxTimes/c.baseTime*Mine.ins().mineQuaCount)}else this.expBar0.maximum=10,this.expBar0.value=0;this.isMaxLevel()&&(this.expBar0.maximum=10,this.expBar0.value=0),this._lastMineId!=Mine.ins().mineId&&(this.record.dataProvider.refresh(),this._lastMineId=Mine.ins().mineId)},e.prototype.isMaxLevel=function(){var t=Mine.ins().mineId+1;return GlobalConfig.KuangYuanConfig[t]?!1:!0},e.prototype.openCheck=function(){var t=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;return Mine.ins().mineCount>=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+t?(UserTips.ins().showCenterTips("|C:0xff0000&T:今日挖掘次数已满|"),!1):Mine.ins().mineStartTime?(UserTips.ins().showCenterTips("|C:0xff0000&T:正在挖掘中，请耐心等候|"),!1):!0},e.prototype.close=function(){},e.openCheck=function(){return Mine.ins().mineId||Mine.ins().sendRefresh(),MineData.ins().mines.length>=GlobalConfig.CaiKuangConfig.maxKuangCount?(UserTips.ins().showCenterTips("|C:0xff0000&T:当前矿洞已满，请前往别的矿洞|"),!1):!0},e}(BaseEuiView);__reflect(MineChoseWorkerWin.prototype,"MineChoseWorkerWin"),ViewManager.ins().reg(MineChoseWorkerWin,LayerManager.UI_Main);var MineDoneRecordRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="DoneRecordItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.name,i=this.data.win,s=GlobalConfig.KuangYuanConfig[Mine.ins().finishedData.configID],n=s.color;i?this.des0.textFlow=TextFlowMaker.generateTextFlow1(e+"掠夺了我的|C:"+n+"&T:"+s.name+"|"):this.des0.textFlow=TextFlowMaker.generateTextFlow1(e+"掠夺我的|C:"+n+"&T:"+s.name+"|失败")},e}(BaseItemRender);__reflect(MineDoneRecordRender.prototype,"MineDoneRecordRender");var MinePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.go,this.onTap),this.observe(Mine.ins().postRedPoint,this.updateRedPoint),this.update()},e.prototype.update=function(){var t=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0,e=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+t,i=Mine.ins().mineCount;this.workNum.text="挖掘次数："+(e-i)+"/"+e;var s=GlobalConfig.CaiKuangConfig.maxRobCount,n=Mine.ins().robCount;this.plunderNum.text="掠夺次数："+(s-n)+"/"+s,this.redPoint.visible=Mine.redpointCheck()},e.prototype.updateRedPoint=function(t){this.redPoint.visible=!!t},e.prototype.onTap=function(t){UserFb.ins().checkInFB()||Mine.ins().sendIntoMine()},e}(BaseEuiView);__reflect(MinePanel.prototype,"MinePanel");var MineRecordRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlunderRecordItemSkin",e.revenge.textFlow=[{text:"我要复仇",style:{underline:!0}}],e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=GlobalConfig.KuangYuanConfig[e.configID],s=i.color;this.time.text=DateUtils.getFormatBySecond(e.time/1e3>>0,DateUtils.TIME_FORMAT_2),this.revenge.visible=!1,this.revenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),e.type==MineRecord.TYPE_BEROB?e.fighterIsWin?(this.des.textFlow=TextFlowMaker.generateTextFlow1("|C:0x18a5eb&T:"+e.fighterName+"|掠夺了我的|C:"+s+"&T:"+i.name+"|"),this.revenge.visible=!0,e.isBeatHim?(this.revenge.textFlow=[{text:"已复仇"}],this.revenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)):(this.revenge.textFlow=[{text:"我要复仇",style:{underline:!0}}],this.revenge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this))):this.des.textFlow=TextFlowMaker.generateTextFlow1("|C:0x18a5eb&T:"+e.fighterName+"|掠夺我的|C:"+s+"&T:"+i.name+"|失败"):e.robIsWin?this.des.textFlow=TextFlowMaker.generateTextFlow1("我成功掠夺了|C:0x18a5eb&T:"+e.robMasterName+"|的|C:"+s+"&T:"+i.name+"|"):this.des.textFlow=TextFlowMaker.generateTextFlow1("我掠夺|C:0x18a5eb&T:"+e.robMasterName+"|的|C:"+s+"&T:"+i.name+"|失败")},e.prototype.onTap=function(){ViewManager.ins().open(MineRobWin,this.data)},e}(BaseItemRender);__reflect(MineRecordRender.prototype,"MineRecordRender");var MineRecordWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlunderRecordSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.record.itemRenderer=MineRecordRender},e.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap),this.observe(Mine.ins().postMineRecord,this.update),Mine.ins().sendGetRecord(),this.update()},e.prototype.update=function(){this.record.dataProvider=new eui.ArrayCollection(Mine.ins().mineRecords)},e.prototype.onTap=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(MineRecordWin.prototype,"MineRecordWin"),ViewManager.ins().reg(MineRecordWin,LayerManager.UI_Popup);var MineRobWin=function(t){function e(){var e=t.call(this)||this;return e._stateIndex=0,e._states=["plunder","revenge","done"],e.skinName="HandleSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.robaward.itemRenderer=ItemBase,this.awardList.itemRenderer=ItemBase,this.recordList.itemRenderer=MineDoneRecordRender,this.addTouchEvent(this.handleBtn,this.onTap),this.addTouchEvent(this["double"],this.onTap)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.observe(Mine.ins().postRoleInfo,this.updateInfo),this._data=t[0],this.update()},e.prototype.updateInfo=function(t){0==this._stateIndex?this.power.text=""+t:1==this._stateIndex&&(this.enemyPower.text=""+t)},e.prototype.update=function(){this._data instanceof MineRecord?(this._stateIndex=1,Mine.ins().sendGetRolePower(this._data.fighterActorID)):this._data instanceof MineModel?(this._stateIndex=0,Mine.ins().sendGetRolePower(this._data.actorID)):this._stateIndex=2,this.currentState=this._states[this._stateIndex];var t=GlobalConfig.KuangYuanConfig[this._data.configID];if(0==this._stateIndex){var e=this._data;this.Title.textColor=t.color,this.Title.text=t.name+"（可掠夺）",this.owner.text=e.name,this.power.text=e.power+"",this.gang.text=e.guildName||"无";var i=GlobalConfig.CaiKuangConfig.maxRobCount;this.workNum.text="剩余次数："+(i-Mine.ins().robCount)+"/"+i,this.awardList.dataProvider=new eui.ArrayCollection(this.getAward(t))}else if(1==this._stateIndex){var e=this._data;this.enemy.text=e.fighterName,this.enemyPower.text=e.fighterPower+"",this.myFace0.source="head_"+e.fighterJob+e.fighterSex,this.time.text=DateUtils.getFormatBySecond(e.time/1e3>>0,DateUtils.TIME_FORMAT_2),this.robaward.dataProvider=new eui.ArrayCollection(this.getAward(t))}else{this.getAwardTxt(t);var s=GlobalConfig.NpcBaseConfig[t.npcId];this.worker.source=s.icon,this.nameTxt.text=t.name,this.nameTxt.textColor=t.color,this.cost.text=GlobalConfig.CaiKuangConfig.doubleCost+"",Mine.ins().finishedData.beRob.length?this.noRob.visible=!1:this.noRob.visible=!0,this.recordList.dataProvider=new eui.ArrayCollection(Mine.ins().finishedData.beRob)}},e.prototype.getAward=function(t){for(var e=t.rewards,i=[],s=t.robPrecent,n=0;n<e.length;n++){var o=new RewardData;o.type=e[n].type,o.id=e[n].id,o.count=Math.ceil(e[n].count*s/100),i.push(o)}return i},e.prototype.getAwardTxt=function(t){var e=[].concat(t.rewards);t.rewardItem&&(e=e.concat(t.rewardItem));for(var i=0,s=0,n=Mine.ins().finishedData.beRob;s<n.length;s++){var o=n[s];o.win&&(i+=1)}for(var a="",r="",h=0;h<e.length;h++){if(0==e[h].type)a+=RewardData.getCurrencyName(e[h].id);else{var l=GlobalConfig.ItemConfig[e[h].id];a+=l.name}if(a+="x"+e[h].count+"\n",i&&h<t.rewards.length){var c=Math.ceil(e[h].count*t.robPrecent/100)*i;r+="-"+c+"\n"}}this.reward.text=a,this.minus.text=r},e.prototype.onTap=function(t){var i=this,s=t.currentTarget;if(s==this.bgClose)2!=this._stateIndex&&ViewManager.ins().close(this);else if(s==this.handleBtn){if(1==this._stateIndex)Mine.ins().sendFightBack(this._data.index),MineFight.ins().start({type:1,id:this._data.configID,index:this._data.index});else if(0==this._stateIndex){if(!e.openCheck(this._data))return;Mine.ins().sendRob(this._data)}else Mine.ins().sendGetAward();ViewManager.ins().close(this),ViewManager.ins().close(MineRecordWin)}else if(s==this["double"]){if(Actor.yb<GlobalConfig.CaiKuangConfig.doubleCost)return void UserTips.ins().showTips("元宝不足",function(){ViewManager.ins().close(i),UserFb.ins().sendExitFb()});Mine.ins().sendGetAward(!0),ViewManager.ins().close(this),ViewManager.ins().close(MineRecordWin)}},e.prototype.close=function(){},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];if(i instanceof MineModel){if(i.actorID==Actor.actorID)return!1;if(Mine.ins().robCount>=GlobalConfig.CaiKuangConfig.maxRobCount)return UserTips.ins().showCenterTips("|C:0xff0000&T:今日掠夺次数已用完|"),!1;if(i.beFightActorID.indexOf(Actor.actorID)>=0)return UserTips.ins().showCenterTips("|C:0xff0000&T:当前矿工已被自己掠夺过|"),!1;if(!MineData.ins().getMineByIndex(i.index,i.actorID))return UserTips.ins().showCenterTips("矿工已消失"),!1;if(i.beFightActorID.length>=GlobalConfig.CaiKuangConfig.maxBeRobCount)return UserTips.ins().showCenterTips("当前矿工已被掠夺完"),!1;if(i.isBeFight)return UserTips.ins().showCenterTips("当前矿工正在被别人掠夺"),!1}return!0},e}(BaseEuiView);__reflect(MineRobWin.prototype,"MineRobWin"),ViewManager.ins().reg(MineRobWin,LayerManager.UI_Popup);var MineScenePanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="WaKuangFbSkin",e}return __extends(e,t),e.prototype.open=function(){this.quickFinish.textFlow=[{text:"快速完成",style:{underline:!0}}],this.addTouchEvent(this.quickFinish,this.onTap),this.addTouchEvent(this.xiangqing,this.onTap),this.addTouchEvent(this.wakuang,this.onTap),this.observe(Mine.ins().postMineBaseInfo,this.updateBase),this.observe(Mine.ins().postInitScene,this.updateScene),this.observe(Mine.ins().postSceneUpdate,this.updateScene),this.observe(Mine.ins().postRecordHasUpdate,this.recordHasUpdate),this.observe(Mine.ins().postMineRecord,this.recordHasUpdate),this.observe(Mine.ins().postMineFightState,this.updateScene),this.observe(Mine.ins().postStartMine,this.MineRedPoint),this.observe(Mine.ins().postFinished,this.MineRedPoint),this.updateScene()},e.prototype.close=function(){TimerManager.ins().removeAll(this)},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.quickFinish?this.openQuick():e==this.xiangqing?ViewManager.ins().open(MineRecordWin):e==this.wakuang&&ViewManager.ins().open(MineChoseWorkerWin)},e.prototype.openQuick=function(){var t=Math.floor((1e3*this._totalTime+Mine.ins().mineStartTime-GameServer.serverTime)/1e3),e=Math.ceil(t/60),i=GlobalConfig.CaiKuangConfig.quickCost*e;if(!(0>=i)){if(Actor.yb<i)return void UserTips.ins().showTips("元宝不足");var s="确定消耗<font color='#FFB82A'>"+i+"元宝</font>快速完成挖矿？";WarnWin.show(s,function(){Mine.ins().sendQuickFinish()},this)}},e.prototype.updateBase=function(){var t=MineData.ins().myMine;if(MineFight.ins().isFighting?this.recordGroup.visible=!1:this.recordGroup.visible=!0,this.wakuangGroup.visible=this.recordGroup.visible,!Mine.ins().isOverTime()&&t){this.myGroup.visible=!0;var e=GlobalConfig.KuangYuanConfig[t.configID];this._totalTime=e.needTime,this.addTime()}else this.removeTime(),this.myGroup.visible=!1},e.prototype.updateScene=function(){var t=MineData.ins();this.nameTxt.text="比奇矿洞"+t.index,this.workerNum.text="矿工："+t.mines.length+"人",this.recordHasUpdate(Mine.ins().hasNewRecord),this.MineRedPoint(),this.updateBase()},e.prototype.recordHasUpdate=function(t){this.redPoint.visible=!!t},e.prototype.MineRedPoint=function(){var t=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;this.redPoint1.visible=Mine.ins().mineCount<GlobalConfig.CaiKuangConfig.maxOpenKuangCount+t&&Mine.ins().isOverTime()},e.prototype.addTime=function(){TimerManager.ins().isExists(this.timeHandler,this)||TimerManager.ins().doTimer(1e3,0,this.timeHandler,this)},e.prototype.timeHandler=function(){var t=Math.floor((Mine.ins().mineEndTime-GameServer.serverTime)/1e3);t>=0&&(this.time.text="（"+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3)+"）")},e.prototype.removeTime=function(){TimerManager.ins().remove(this.timeHandler,this)},e}(BaseEuiView);__reflect(MineScenePanel.prototype,"MineScenePanel"),ViewManager.ins().reg(MineScenePanel,LayerManager.UI_Main);var MoveCC=function(t){function e(){var e=t.call(this)||this;return e.observe(MapView.onGridClick,e.mapClick),e.observe(MapView.moveComplete,e.touchTarget),e}return __extends(e,t),e.prototype.mapClick=function(t){var e=t.target,i=t.x,s=t.y;if((GameMap.sceneInMine()||TargetListCC.ins().isShow)&&(!BattleCC.ins().isBattle()||BattleCC.ins().canMove())&&(!GwBoss.ins().isGwBoss&&!GwBoss.ins().isGwTopBoss||GwBoss.ins().canMove())&&!DarkMjBoss.ins().isDarkBoss){this.findTarget=e;var n=EntityManager.ins().getNoDieRole();if(null!=n&&!n.isHardStraight){if((CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss)&&CityCC.ins().sendStopAI(),(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena)&&GameLogic.ins().stopAI(),e&&e.infoModel&&(e.infoModel.type==EntityType.Npc||e.infoModel.type==EntityType.Mine)){var o=GameMap.getPosRangeRandom(e.x,e.y,DirUtil.get8DirBy2Point(e,n));i=o[0]*GameMap.CELL_SIZE+Math.floor(MathUtils.limit(.2,1)*GameMap.CELL_SIZE),s=o[1]*GameMap.CELL_SIZE+Math.floor(MathUtils.limit(.2,1)*GameMap.CELL_SIZE)}GameMap.moveTo(i,s)}}},e.prototype.touchTarget=function(t){if(t.team==Team.My){if(this.findTarget&&this.findTarget.infoModel)if(this.findTarget.infoModel.type==EntityType.Npc){var e=EntityManager.ins().getNoDieRole();if(null==e||e.isHardStraight)return;var i=GameMap.CELL_SIZE,s=SysSetting.ins().getValue("mapClickTx")*i,n=SysSetting.ins().getValue("mapClickTy")*i;if(!(Math.abs(e.x-s)<=i&&Math.abs(e.y-n)<=i))return;var o=GlobalConfig.NpcBaseConfig[this.findTarget.infoModel.configID],a=o.controlTarget;a&&a[0]&&ViewManager.ins().open(a[0])}else this.findTarget.infoModel.type==EntityType.Mine?ViewManager.ins().open(MineRobWin,this.findTarget.infoModel):this.findTarget.infoModel.type==EntityType.Transfer&&GameMap.sceneInMine()&&Mine.ins().sendSceneChange(this.findTarget.infoModel.configID);this.findTarget=null}},e}(BaseSystem);__reflect(MoveCC.prototype,"MoveCC");var GameSystem;!function(t){t.movecc=MoveCC.ins.bind(MoveCC)}(GameSystem||(GameSystem={}));var NeiGongModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.neiGongList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.canUp=function(){if(UserFb.ins().guanqiaID<GlobalConfig.NeiGongBaseConfig.openGuanqia)return!1;for(var t=Math.min(SubRoles.ins().subRolesLen,this.neiGongList.length),e=0;t>e;e++)if(this.canUpById(e))return!0;return!1},e.prototype.canUpById=function(t){if(this.neiGongList[t]){if(UserFb.ins().guanqiaID<=GlobalConfig.NeiGongBaseConfig.openGuanqia)return!1;if(this.neiGongList[t].stage>=GlobalConfig.NeiGongBaseConfig.maxStage)return!1;if(this.neiGongList[t].canMix||this.neiGongList[t].getCanLevelUp())return!0}return!1},e}(BaseClass);__reflect(NeiGongModel.prototype,"NeiGongModel");var NeiGongData=function(){function t(){this.roleId=0,this.level=0,this.stage=0,this.exp=0}return t.prototype.parse=function(t){this.level=t.readInt(),this.stage=t.readInt(),this.exp=t.readInt();GlobalConfig.NeiGongStageConfig[this.stage][this.level];this.canMix=this.level>0&&this.level%GlobalConfig.NeiGongBaseConfig.levelPerStage==0},t.prototype.getCanLevelUp=function(){var t=GlobalConfig.NeiGongStageConfig[this.stage][this.level];if(!t)return!1;var e=t.totalExp-this.exp,i=Math.ceil(e/t.addExp);return Actor.gold>=i*t.costMoney&&Actor.gold>=1e6},t}();__reflect(NeiGongData.prototype,"NeiGongData");var NeiGong=function(t){function e(){var e=t.call(this)||this;return e.isActList={},e.isShow=!1,e.ngList={},e.sysId=PackageID.NeiGong,e.regNetMsg(1,e.postNeiGongDataChange),e.regNetMsg(3,e.postNeiGongAct),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postNeiGongDataChange=function(t){var e=t.readShort();NeiGongModel.ins().neiGongList[e]||(NeiGongModel.ins().neiGongList[e]=new NeiGongData);var i=NeiGongModel.ins().neiGongList[e];i.roleId=e,i.parse(t);var s=t.readBoolean();this.isActList[e]||(this.isActList[e]={}),this.isActList[e].act=s?1:0,this.ngList[e]=s?1:0},e.prototype.postNeiGongAct=function(t){var e=t.readShort(),i=t.readInt();this.ngList[e]=i,this.isActList[e].isShow=!1,0==this.isActList[e].act&&1==i&&(this.isActList[e].isShow=!0),this.isActList[e].act=i},e.prototype.sendNeiGongUpLevel=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendNeiGongUpStage=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.sendNeiGongAct=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e}(BaseSystem);__reflect(NeiGong.prototype,"NeiGong");var GameSystem;!function(t){t.neigong=NeiGong.ins.bind(NeiGong)}(GameSystem||(GameSystem={}));var NeiGongWin=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.canUp=!1,e.isLights=[],e.effs={},e.starPoint=[],e.isNext=!1,e.isAutoUp=!1,e.signLevel=0,e.mcPos=[[52,77,0],[47,55,18],[55,30,36],[75,12,54],[110,0,72],[75,15,108],[100,30,126],[110,60,144],[100,90,162],[85,120,180]],e.toHeight=0,e.mcWidth=160,e.mcHeight=160,e._currHeight=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.upLevelMc=new MovieClip,this.stageImg=BitmapNumber.ins().createNumPic(0,"ng0"),this.stageImg.x=25,this.stageImg.y=12,this.stageGroup.addChild(this.stageImg),this._shap=new egret.Shape,this.lineGroup.addChild(this._shap),this.lineBg.mask=this._shap,this._shap.x=this._shap.y=this.lineGroup.width>>1,this._shap.rotation=-196,this.circleMc=new MovieClip,this.circleMc.x=80,this.circleMc.y=75,this.mcGroup.addChild(this.circleMc),this.moveInMc=new MovieClip,this.moveInMc.x=70,this.moveInMc.y=65,this.ball.addChild(this.moveInMc),this.stageMc=new MovieClip,this.stageMc.x=52,this.stageMc.y=32,this.stageGroup.addChild(this.stageMc),this._ballShap=new egret.Shape,this.mcGroup.addChild(this._ballShap);for(var t=NeiGongModel.ins().neiGongList[this.curRole],e=t?t.level:0,i=0;10>i;i++){var s=new egret.Point(this["eff_"+i].x,this["eff_"+i].y);this.starPoint[i]=s,this.isLights[i]=e>i}this.eff=new MovieClip,this.eff.x=this.UplevelBtn0.x+this.UplevelBtn0.width/2,this.eff.y=this.UplevelBtn0.y+this.UplevelBtn0.height/2,this.eff.scaleX=1.15,this.eff.scaleY=1,this.eff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.lastLevel=-1,this.circleMc.playFile(RES_DIR_EFF+"neigongzhongjianeff",-1),this.moveInMc.parent||this.ball.addChild(this.moveInMc),this.circleMc.mask=this._ballShap,this.addTouchEvent(this.upBtn,this.onClick),this.addTouchEvent(this.mixBtn,this.onClick),this.addTouchEvent(this.oneKeyUp,this.onClick),this.addTouchEvent(this.UplevelBtn0,this.onClick),this.observe(NeiGong.ins().postNeiGongDataChange,this.refushPanelInfo),this.observe(Actor.ins().postLevelChange,this.setBtnStatuBarinfo),this.observe(NeiGong.ins().postNeiGongAct,this.showActPanel),this.refushPanelInfo(!0),this.showActPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.removeTouchEvent(this.upBtn,this.onClick),this.removeTouchEvent(this.mixBtn,this.onClick),this.removeTouchEvent(this.oneKeyUp,this.onClick),this.seteffectPost();for(var i in this.effs)DisplayUtils.removeFromParent(this.effs[i]),this.effs[i]&&egret.Tween.removeTweens(this.effs[i]);DisplayUtils.removeFromParent(this.eff),this.stopAutoUp()},e.openCheck=function(){var t=GlobalConfig.NeiGongBaseConfig.openLevel;return Actor.level<t?(UserTips.ins().showTips(t+"级开启内功"),!1):!0},e.prototype.showActPanel=function(){if(NeiGong.ins().isActList[this.curRole].isShow){NeiGong.ins().isActList[this.curRole].isShow=!1,Activationtongyong.show(0,"内功","jneigong_png");var t=EntityManager.ins().getMainRole(this.curRole);t&&t.updateNeiGong()}this.showAct.visible=NeiGong.ins().ngList[this.curRole]>0,this.showAct.visible?(this.Activation.visible=!1,DisplayUtils.removeFromParent(this.eff)):(this.Activation.visible=!0,this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.eff.parent||this.UplevelBtn0.parent.addChild(this.eff));var e=GlobalConfig.NeiGongBaseConfig.openGuanqia;UserFb.ins().guanqiaID<=e&&(this.redPointAct0.visible=!1),this.activeTipsTxt0.text="闯关达到 第"+(e+1)+" 即可激活内功"},e.prototype.onChange=function(){this.stopAutoUp(),this.refushPanelInfo()},e.prototype.refushPanelInfo=function(t){this.data=NeiGongModel.ins().neiGongList[this.curRole],this.data&&(this.cruLevelCfg=GlobalConfig.NeiGongStageConfig[this.data.stage][this.data.level],this.cruLevelCfg&&(this.lastLevel!=this.data.level&&this.effectShow(t),this.lastLevel=this.data.level,this.setAttrCost(),this.setPowerShow(),this.setBtnStatuBarinfo(),this.seteffectPost()))},e.prototype.setPowerShow=function(){this._totalPower=UserBag.getAttrPower(this.cruLevelCfg.attribute),this.powerPanel.setPower(this._totalPower)},e.prototype.setAttrCost=function(){this.stageImg.x=this.data.stage<10?40:25,BitmapNumber.ins().changeNum(this.stageImg,this.data.stage,"ng0");var t=0,e=GlobalConfig.MonthCardConfig.neiGongGoldPrecent/100,i=Recharge.ins().getIsForeve()?1-e:1;this.data.canMix||(t=Math.floor(this.cruLevelCfg.costMoney*i));var s="";s=Actor.gold>=t?"|C:0x35e62d&T:":"|C:0xf3311e&T:",this.canUp=Actor.gold>=t,this.costlable.textFlow=TextFlowMaker.generateTextFlow(s+t);var n=this.cruLevelCfg.attribute;n.sort(AttributeData.sortAttribute);for(var o=n.length,a=0;3>a;a++)this["attr"+a].text=o>a?AttributeData.getAttStrByType(n[a],1):"";var r=0,h=0;this.data.level==GlobalConfig.NeiGongBaseConfig.levelPerStage?(r=this.data.stage+1,h=0):(r=this.data.stage,h=this.data.level+1);var l=GlobalConfig.NeiGongStageConfig[r],c=l?l[h]:null;if(c){var u="",p=c.attribute;p.sort(AttributeData.sortAttribute);for(var a=0;3>a;a++){if(o>a){var d=n[a];u=this.getAttrByType(p,d)}this["addAttr"+a].text=u,this["arrow"+a].visible=""!=u}this.isNext=!0}else{for(var a=0;3>a;a++)this["addAttr"+a].text="",this["arrow"+a].visible=!1;this.isNext=!1}},e.prototype.effectShow=function(t){for(var e=this.data.level,i=0;10>i;i++)this["point_"+i].source=i>=e?"neigongzhuzi2":"neigongzhuzi1";e>0?DisplayUtils.drawCir(this._shap,(this.lineGroup.width>>1)+2,212*(e-1)/9):this._shap.graphics.clear();for(var i in this.effs)DisplayUtils.removeFromParent(this.effs[i]),this.effs[i]=null;if(t)for(var s=NeiGongModel.ins().neiGongList[this.curRole],n=s?s.level:0,i=0;10>i;i++)this.isLights[i]=n>i;for(var i=0;e>i;i++){var o=this.effs[i]||new MovieClip;o.x=1,o.y=30,o.scaleX=1,o.scaleY=1,this.effs[i]=o,this["eff_"+i].addChild(o),this.isLights[i]?o.playFile(RES_DIR_EFF+"feishengfire",-1):(this.isLights[i]=!0,this.moveEffectOut(i))}},e.prototype.setBtnStatuBarinfo=function(){var t=this.data.canMix;this.upBtn.visible=!t&&this.isNext,this.mixBtn.visible=t,this.redPoint1.visible=!1,this.redPoint0.visible=!1,this.costInfo.visible=!t&&this.isNext,this.maxDesc.visible=!this.isNext,t?(this.expLabel.text="",this.upDataExpMcBall(this.cruLevelCfg.totalExp,this.cruLevelCfg.totalExp)):this.cruLevelCfg&&(this.upDataExpMcBall(this.data.exp,this.cruLevelCfg.totalExp),this.expLabel.text=this.data.exp+"/"+this.cruLevelCfg.totalExp)},e.prototype.onClick=function(t){var e=this;if(!this.isNext)return void UserTips.ins().showTips("内功已满级");switch(t.target){case this.upBtn:this.canUp?(NeiGong.ins().sendNeiGongUpLevel(this.curRole),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)):Shop.openBuyGoldWin(!1)||UserTips.ins().showTips("金币不足");break;case this.mixBtn:this.moveEffectIn(),TimerManager.ins().doTimer(400,1,function(){NeiGong.ins().sendNeiGongUpStage(e.curRole),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)},this);break;case this.oneKeyUp:if(this.isAutoUp)this.stopAutoUp();else{if(!this.canUp)return void UserTips.ins().showTips("金币不足");this.isAutoUp=!0,this.oneKeyUp.label="停 止",TimerManager.ins().doTimer(300,0,this.autoUpStar,this)}break;case this.UplevelBtn0:NeiGong.ins().sendNeiGongAct(this.curRole)}},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,this.oneKeyUp&&(this.oneKeyUp.label="一键修炼"),TimerManager.ins().remove(this.autoUpStar,this)},e.prototype.autoUpStar=function(){this.canUp&&0==this.data.canMix&&this.isNext?(NeiGong.ins().sendNeiGongUpLevel(this.curRole),SoundUtil.ins().playEffect(SoundUtil.SKILL_UP)):this.stopAutoUp()},e.prototype.moveEffectOut=function(t){var e=this,i=egret.Tween.get(this.eff_9);i.call(function(){e.moveInMc.playFile(RES_DIR_EFF+"neigongbaozhaeff",1,null,!1)},this).wait(100).call(function(){DisplayUtils.removeFromParent(e.upLevelMc),e.ball.addChild(e.upLevelMc),e.upLevelMc.x=e.mcPos[t][0],e.upLevelMc.y=e.mcPos[t][1],e.upLevelMc.rotation=e.mcPos[t][2],e.upLevelMc.playFile(RES_DIR_EFF+"piaodongqipaohuang",1,function(){e.effs[t]&&e.effs[t].playFile(RES_DIR_EFF+"feishengfire",-1);for(var i=e.data.level,s=0;10>s;s++)e["point_"+s].source=s>=i?"neigongzhuzi2":"neigongzhuzi1";i>0?DisplayUtils.drawCir(e._shap,(e.lineGroup.width>>1)+2,212*(i-1)/9):e._shap.graphics.clear()},!0)},this)},e.prototype.moveEffectIn=function(){var t=this;for(var e in this.effs){var i=egret.Tween.get(this["eff_"+e]);i.to({x:280,y:320,scaleX:1,scaleY:1},390).to({alpha:0},10)}for(var e=0;10>e;e++)this.isLights[e]=!1;var s=egret.Tween.get(this.eff_9);s.wait(400).call(function(){t.moveInMc.playFile(RES_DIR_EFF+"neigongbaozhaeff",1,null,!1)},this).call(function(){t.stageMc.parent||t.stageGroup.addChild(t.stageMc),t.stageMc.playFile(RES_DIR_EFF+"neigongshengjieff",1,function(){DisplayUtils.removeFromParent(t.stageMc)})},this);for(var e=0;10>e;e++)this["point_"+e].source="neigongzhuzi2"},e.prototype.getAttrByType=function(t,e){for(var i=t.length,s=0;i>s;s++)if(t[s].type==e.type&&t[s].value!=e.value)return" "+AttributeData.getAttStrByType(t[s],1,"",!1,!1);return""},e.prototype.seteffectPost=function(){for(var t=this.data?this.data.level:0,e=0;10>e;e++){var i=this.starPoint[e];i&&(this["eff_"+e].x=t>e?i.x:280,this["eff_"+e].y=t>e?i.y:320,this["eff_"+e].scaleX=1,this["eff_"+e].scaleY=1,this["eff_"+e].alpha=1)}},e.prototype.upDataExpMcBall=function(t,e){DisplayUtils.drawrect(this._ballShap,this.mcWidth,this.mcHeight),this.toHeight=this.mcHeight*(t/e),this.currHeight=this.toHeight>=this.mcHeight?this.mcHeight:this.toHeight},Object.defineProperty(e.prototype,"currHeight",{get:function(){return this._currHeight},set:function(t){this._currHeight=t;var e=this.mcHeight-Math.floor(this._currHeight),i=egret.Tween.get(this._ballShap);i.to({y:e},200).call(function(){},this)},enumerable:!0,configurable:!0}),e.prototype.destoryView=function(){},e}(BaseView);__reflect(NeiGongWin.prototype,"NeiGongWin");var NewEquip=function(t){function e(){var e=t.call(this)||this;return e.observe(UserEquip.ins().postEquipChange,e.callBack),e.equipsList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.check=function(){return OpenSystem.ins().checkSysOpen(SystemType.NEWEQUIP)?!0:!1},e.prototype.callBack=function(){},e.prototype.addItem=function(t){if(t&&this.check()){var e=ItemConfig.getSubType(t.itemConfig),i=ItemConfig.getJob(t.itemConfig),s=SubRoles.ins().getSubRoleByIndex(0);if(s.job==i&&UserZs.ins().lv>=(t.itemConfig.zsLevel||0)&&Actor.level>=(t.itemConfig.level||1)){for(var n=!1,o=0;o<this.equipsList.length;o++){var a=this.equipsList[o],r=ItemConfig.getSubType(a.itemConfig);if(0==o&&e==r){if(e==r){n=!0,this.compareEquip(a,t)&&this.equipsList.push(t);break}}else if(e==r){n=!0,this.compareEquip(a,t)&&(this.equipsList[o]=t);break}}if(!n){var h=s.equipsData[e];h&&h.item&&h.item.itemConfig?this.compareEquip(h.item,t)&&this.equipsList.push(t):this.equipsList.push(t)}}}},e.prototype.compareEquip=function(t,e){var i=t.point,s=e.point;return s>i},e}(BaseSystem);__reflect(NewEquip.prototype,"NewEquip");var GameSystem;!function(t){t.newEquip=NewEquip.ins.bind(NewEquip)}(GameSystem||(GameSystem={}));var NewEquipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="newEquipSkin",e.time=5,e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.go,this.onEvent),this.removeObserve(),TimerManager.ins().remove(this.updateTime,this),this.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];NewEquip.ins().equipsList.length&&(this.addTouchEvent(this.go,this.onEvent),this.observe(UserEquip.ins().postEquipChange,this.callBack),NewEquip.ins().check()&&(TimerManager.ins().isExists(this.updateTime,this)||(this.tick=this.time,TimerManager.ins().doTimer(1e3,0,this.updateTime,this))))},e.prototype.updateTime=function(){this.init(),this.visible=!0},e.prototype.callBack=function(){},e.prototype.init=function(){if(this.tick<=0){if(0==NewEquip.ins().equipsList.length)return void this.close();this.tick=this.time}NewEquip.ins().equipsList.length>0&&(this.go.label="装备("+this.tick+")",this.itemdata=NewEquip.ins().equipsList[0],this.itemdata&&this.itemdata.itemConfig&&(this.equip.data=this.itemdata._configID,this.equip.isShowName(!1),this.equipName.text=this.itemdata.itemConfig.name,this.equipName.textColor=ItemConfig.getQualityColor(this.itemdata.itemConfig),this.powerCount.text=this.itemdata.point+"")),this.tick--,this.tick<=0&&this.sendWear()},e.prototype.onEvent=function(t){switch(t.target){case this.go:this.sendWear()}},e.prototype.sendWear=function(){if(this.itemdata){var t=ItemConfig.getSubType(this.itemdata.itemConfig);UserEquip.ins().sendWearEquipment(this.itemdata.handle,t,0),NewEquip.ins().equipsList.shift(),0==NewEquip.ins().equipsList.length&&this.close(),this.tick=this.time}},e}(BaseView);__reflect(NewEquipWin.prototype,"NewEquipWin");var NewRoleWin=function(t){function e(){var e=t.call(this)||this;return e.roleBody=[["op_zs0_png","op_zs1_png"],["op_fs0_png","op_fs1_png"],["op_ds0_png","op_ds1_png"]],e.roleWeapon=["","",""],e.rolePos=[[100,0,1,3],[-4,79,.7,2],[336,79,.7,2]],e.beginPoint=0,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="OpenRoleSkin",this.roles=[this.role0,this.role1,this.role2];var e=SubRoles.ins().getSubRoleByIndex(0);e&&e.sex?(this.sexBtn0.selected=!0,this.sexBtn1.selected=!1):(this.sexBtn0.selected=!1,this.sexBtn1.selected=!0),this.updateRole()},e.prototype.updateRole=function(){for(var t=0;t<this.roles.length;t++)this.setRole(this.roles[t],t)},e.prototype.setRole=function(t,e){var i=this.sexBtn0.selected?0:1;t.weapon.source=this.roleWeapon[e],t.job.source="op_"+(e+1);for(var s,n=SubRoles.ins().subRolesLen,o=0;n>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(a.job==e+1){s=!0,i=a.sex;
break}}t.body.source=this.roleBody[e][i],t.openedImg.visible=s},e.prototype.setNeedTxt=function(){var t,e,i=SubRoles.ins().subRolesLen,s=GlobalConfig.NewRoleConfig[i],n="";s.zsLevel?(n=s.zsLevel+"转",this.canOpen=UserZs.ins().lv>=s.zsLevel,t=this.canOpen?3532333:15937822,n='<font color="#'+t.toString(16)+'">'+n+"</font>"):(n=s.level+"级",this.canOpen=Actor.level>=s.level,t=this.canOpen?3532333:15937822,n='<font color="#'+t.toString(16)+'">'+n+"</font>"),s.vip&&(e=UserVip.ins().lv>=s.vip,this.canOpen=this.canOpen||e,t=e?3532333:15937822,n+=' 或 <font color="#'+t.toString(16)+'">VIP'+s.vip+"</font>"),this.needTxt.textFlow=(new egret.HtmlTextParser).parser("解锁需要："+n)},e.prototype.selectJob=function(t,e){var i=this;void 0===e&&(e=!1);for(var s=function(s){var o=(t+t+s)%3;if(e)n.roles[s].x=n.rolePos[o][0],n.roles[s].y=n.rolePos[o][1],n.roles[s].scaleX=n.roles[s].scaleY=n.rolePos[o][2];else{var a=egret.Tween.get(n.roles[s]);a.to({x:n.rolePos[o][0],y:n.rolePos[o][1],scaleX:n.rolePos[o][2],scaleY:n.rolePos[o][2]},500).call(function(){i.roles[s].touchEnabled=0!=o},n)}0==o&&(n.roleGroup.addChild(n.roles[s]),n.openBtn.visible=!n.roles[s].openedImg.visible)},n=this,o=0;3>o;o++)s(o)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.updateRole(),this.setNeedTxt();for(var i=[0,1,2],s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=i.indexOf(o.job-1);a>-1&&i.splice(a,1)}this.job=i[0]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},e.prototype.onBegin=function(t){this.stop||(this.beginPoint=t.stageX)},e.prototype.onMove=function(t){if(0!=this.beginPoint){var e=t.stageX-this.beginPoint;if(!(Math.abs(e)<5)){var i=this.job-e/Math.abs(e);if(i=i>2?i-3:0>i?i+3:i,this.addTouchEndEvent(this,this.onEnd),Math.abs(e)>=120)return this.job=i,this.beginPoint=0,void this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this);for(var s=0;3>s;s++){var n=this.roles[s],o=(i+i+s)%3,a=(this.job+this.job+s)%3,r=MathUtils.getRadian2(this.rolePos[a][0],this.rolePos[a][1],this.rolePos[o][0],this.rolePos[o][1]),h=MathUtils.getAngle(r),l=MathUtils.getDirMove(h,Math.abs(e));n.x=this.rolePos[a][0]+l.x,n.y=this.rolePos[a][1]+l.y;var c=Math.abs(e)/MathUtils.getDistance(this.rolePos[a][0],this.rolePos[a][1],this.rolePos[o][0],this.rolePos[o][1]);n.scaleX=n.scaleY=this.rolePos[a][2]-(this.rolePos[a][2]-this.rolePos[o][2])*c}}}},e.prototype.onEnd=function(t){this.job=this.job,this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},e.prototype.onTap=function(t){switch(t.target){case this.openBtn:if(!this.canOpen){var e=SubRoles.ins().subRolesLen,i=GlobalConfig.NewRoleConfig[e],s=WarnWin.show("VIP等级不足，VIP"+i.vip+"可以提前开启第"+(e+1)+"角色，是否前往开启？",null,null,function(){ViewManager.ins().open(VipWin,i.vip)},this);return void s.setBtnLabel("取消","前往")}GameLogic.ins().sendNewRole(this.job+1,this.sexBtn0.selected?0:1),ViewManager.ins().close(LimitTaskView);case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.sexBtn0:this.sexBtn1.selected=!1,this.updateRole();break;case this.sexBtn1:this.sexBtn0.selected=!1,this.updateRole();break;default:var n=this.roles.indexOf(t.target);n>-1&&!this.stop&&(this.job=n)}},Object.defineProperty(e.prototype,"job",{get:function(){return this._job},set:function(t){var e=this;this._job=t,this.stop=!0,this.selectJob(t),TimerManager.ins().doTimer(500,1,function(){e.stop=!1},this)},enumerable:!0,configurable:!0}),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return SubRoles.ins().subRolesLen>=3?!1:(ViewManager.ins().close(LiLianWin),!0)},e}(BaseEuiView);__reflect(NewRoleWin.prototype,"NewRoleWin"),ViewManager.ins().reg(NewRoleWin,LayerManager.UI_Main);var actor=GameSystem.actor,Notice=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Notice,e.regNetMsg(1,e.doNotice),e.regNetMsg(2,e.doNoticeOpen),TimerManager.ins().doTimer(3e3,1,e.checkUpdata,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkUpdata=function(){if(GlobalConfig.UpdateRemindConfig.appearTime&&GlobalConfig.UpdateRemindConfig.disappearTime&&!(1e3*UserZs.ins().lv+Actor.level<GlobalConfig.UpdateRemindConfig.appearLv||GameServer.serverOpenDay+1<GlobalConfig.UpdateRemindConfig.serverDayLimit)){var t=GameServer.serverTime;DateUtils.formatStrTimeToMs(GlobalConfig.UpdateRemindConfig.appearTime)<=t&&t<DateUtils.formatStrTimeToMs(GlobalConfig.UpdateRemindConfig.disappearTime)&&ViewManager.ins().open(UpdateRemindWin,GlobalConfig.UpdateRemindConfig.lotteryNotice)}},e.prototype.doNotice=function(t){var e=t.readShort(),i=t.readString(),s=t.readUnsignedByte();1==e?0==s&&ViewManager.ins().open(NoticeView).showNotice(i):2==e&&(this.data||(this.data=new ChatInfoData(null)),this.data.str=i,this.data.type=7),3==e&&ViewManager.ins().open(NoticeView).showNotice(i),Chat.ins().postSysChatMsg(new ChatSystemData(e,i))},e.prototype.doNoticeOpen=function(t){UserFuLi.ins().isOpenNotice=t.readBoolean(),e.ins().postGameNotice()},e.prototype.setNoticeOPen=function(){this.sendBaseProto(2)},e.prototype.postGameNotice=function(){},e}(BaseSystem);__reflect(Notice.prototype,"Notice");var GameSystem;!function(t){t.notice=Notice.ins.bind(Notice)}(GameSystem||(GameSystem={}));var NoticeView=function(t){function e(){var e=t.call(this)||this;return e.list=[],e.startX=0,e.endX=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.frame=new eui.Image,this.frame.source="zjmgonggaobg",this.frame.width=480,this.frame.height=28,this.frame.y=240,this.frame.x=StageUtils.ins().getWidth()/2-this.frame.width/2,this.addChild(this.frame),this.frame.visible=!1,this.touchChildren=!1,this.touchEnabled=!1,this.startX=this.frame.x+this.frame.width,this.endX=this.frame.x},e.prototype.showNotice=function(t){this.frame.visible=!0;var e=new eui.Label;e.size=20,e.textColor=16705792,e.stroke=1,e.strokeColor=0,e.x=this.startX,e.y=this.frame.y+4,e.textFlow=TextFlowMaker.generateTextFlow(t),this.addChild(e),this.list.push(e),e.visible=!1,1==this.list.length&&this.tweenLab()},e.prototype.tweenLab=function(){var t=this,e=this.list[0],i=this.endX-e.width,s=egret.Tween.get(e);e.visible=!0,s.to({x:i},20*e.width).call(function(){t.removeChild(e),t.list.shift(),t.list.length<1?t.frame.visible=!1:t.tweenLab()},this)},e}(BaseEuiView);__reflect(NoticeView.prototype,"NoticeView"),ViewManager.ins().reg(NoticeView,LayerManager.UI_Tips);var UpdateRemindWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="updateRemindSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onTouch);var i=t[0];i&&i!=this.skinName&&(this.skinName=i)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.btn:ViewManager.ins().close(this),t.target==this.btn&&ViewManager.ins().open(FuliWin,4)}},e}(BaseEuiView);__reflect(UpdateRemindWin.prototype,"UpdateRemindWin"),ViewManager.ins().reg(UpdateRemindWin,LayerManager.UI_Popup);var EffectivenessTip=function(t){function e(){var e=t.call(this)||this;return e.showType=0,e.skinName="CheckEfficienSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.showType=t[0]?t[0]:0,this.update(),this.addTouchEvent(this,this.onTap),TimerManager.ins().doTimer(3e3,1,this.playTween,this)},e.prototype.playTween=function(){var t=this;if(this.showType,0){var e=egret.Tween.get(this);e.to({alpha:0},1e3).call(function(){t.alpha=1,ViewManager.ins().close(t)},this)}else{var i=egret.Tween.get(this.mainGroup);i.to({scaleX:0,scaleY:0,horizontalCenter:170,top:52},500).call(function(){ViewManager.ins().close(t)})}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];UserFb.ins().showAni=!1,this.removeTouchEvent(this,this.onTap),TimerManager.ins().remove(this.playTween,this),egret.Tween.removeTweens(this.mainGroup),egret.Tween.removeTweens(this)},e.prototype.onTap=function(t){this.removeTouchEvent(this,this.onTap),TimerManager.ins().remove(this.playTween,this),this.playTween()},e.prototype.update=function(){UserFb.ins().guanqiaID;UserFb.ins().expEff==UserFb.ins().expEffLast?this.groupExp.visible=!1:(this.groupExp.visible=!0,this.curExp.text=UserFb.ins().expEffLast+"",this.nextExp.text=UserFb.ins().expEff+""),UserFb.ins().goldEff==UserFb.ins().goldEffLast?this.groupGold.visible=!1:(this.groupGold.visible=!0,this.curMoney.text=UserFb.ins().goldEffLast+"",this.nextMoney.text=UserFb.ins().goldEff+""),this.showType?(this.groupGold.visible=this.groupExp.visible=!1,this.groupInfoGold.visible=this.groupInfoExp.visible=!0,this.nextInfoExp.text=UserFb.ins().expEff+"",this.nextInfoMoney.text=UserFb.ins().goldEff+"",this.descTxt.text="关卡效率"):(this.groupGold.visible=this.groupExp.visible=!0,this.groupInfoGold.visible=this.groupInfoExp.visible=!1,this.descTxt.text="关卡效率提升")},e}(BaseEuiView);__reflect(EffectivenessTip.prototype,"EffectivenessTip"),ViewManager.ins().reg(EffectivenessTip,LayerManager.UI_Main);var OfflineRewardWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.skinName="OfflineRewardSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.okBtn,this.onClick),this.arr=t[0],this.coin=t[1];for(var i=0;i<this.coin.length;i++)if(this.coin[i].id==MoneyConst.soul){this.arr.push(this.coin[i].count);break}this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.okBtn,this.onClick)},e.prototype.update=function(){if(this.time.text="离线时间："+DateUtils.getFormatBySecond(this.arr[0],DateUtils.TIME_FORMAT_9),this.exp.text=""+this.arr[1],this.money.text=""+this.arr[2],this.equipNum.text=""+(this.arr[3]+this.arr[4]),this.jinglianshiNum.text=""+(this.arr[6]?this.arr[6]:0),0==this.arr[4]?this.bagFull.visible=!1:(this.bagFull.visible=!0,this.bagFull.textFlow=(new egret.HtmlTextParser).parser("背包已满，自动熔炼<a color=0x35e62d>"+this.arr[4]+"</a>件装备")),this.arr[5].length>0){for(var t=0;t<this.arr[5].length;t++){var e=this.arr[5][t];1==e.type?(this.label4.text=e.gold,this.label6.text=e.exp):2==e.type?(this.label3.text=e.gold,this.label5.text=e.exp):3==e.type?(this.exp.text=""+(this.arr[1]+e.exp),this.arr[2]+=e.gold):4==e.type&&(this.exp.text=""+(this.arr[1]+e.exp),this.arr[2]+=e.gold)}this.money.text=""+this.arr[2]}},e.prototype.onClick=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(OfflineRewardWin.prototype,"OfflineRewardWin"),ViewManager.ins().reg(OfflineRewardWin,LayerManager.UI_Main2);var OpenSystem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkSysOpen=function(t){var e=GlobalConfig.OpenSystemConfig[t];return e&&e.judge?e.than?UserZs.ins().lv<=e.openzs&&Actor.level<=e.openlevel&&UserFb.ins().guanqiaID<=e.opencheck:UserZs.ins().lv>=e.openzs&&Actor.level>=e.openlevel&&UserFb.ins().guanqiaID>=e.opencheck:t==SystemType.FIRSTCHARGE&&"2"==LocationProperty.pfid?!0:!1},e.prototype.getNoOpenTips=function(t){var e=GlobalConfig.OpenSystemConfig[t],i="";return e&&(e.judge?e.than||(UserZs.ins().lv<e.openzs&&(i+=e.openzs+"转"),Actor.level<e.openlevel&&(i+=e.openlevel+"级"),UserFb.ins().guanqiaID<e.opencheck&&(i+="通过第"+e.opencheck+"关"),""!=i&&(i+="开启"+e.funName)):i=e.funName+"未开启"),i},e}(BaseSystem);__reflect(OpenSystem.prototype,"OpenSystem");var PaoDianCC=function(t){function e(){var e=t.call(this)||this;return e._openLeftTime=0,e._openTimer=0,e._enterCD=0,e._enterCDTimer=0,e._leftTime=0,e._areaId=0,e._shenBingExp=0,e._jadeChips=0,e.sysId=PackageID.PaoDian,e.observe(GameLogic.ins().postEnterMap,e.mapChange),e.regNetMsg(1,e.postEnterSuccess),e.regNetMsg(2,e.postBelongChange),e.regNetMsg(3,e.doEnterCD),e.regNetMsg(4,e.postOpenInfo),e.regNetMsg(5,e.doRelive),e.regNetMsg(6,e.postMyInfo),e.regNetMsg(7,e.postAreaChange),e.regNetMsg(8,e.doResult),e}return __extends(e,t),Object.defineProperty(e.prototype,"areaId",{get:function(){return this._areaId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shenBingExp",{get:function(){return this._shenBingExp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jadeChips",{get:function(){return this._jadeChips},enumerable:!0,configurable:!0}),e.prototype.mapChange=function(){GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId&&this.enterBattle(),this._isPaoDian&&GameMap.fubenID!=GlobalConfig.PassionPointConfig.fbId&&this.escBattle(),this.gotoNpc&&GameMap.fbType==UserFb.FB_TYPE_CITY&&(this.gotoNpc=!1,GameMap.myMoveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete),GameMap.moveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE))},e.prototype.findComplete=function(){ViewManager.ins().open(PaoDianNpcTalkWin)},e.prototype.enterBattle=function(){this._isPaoDian=!0,ViewManager.ins().isShow(PaoDianWin)||ViewManager.ins().open(PaoDianWin),ViewManager.ins().close(PaoDianNpcTalkWin)},e.prototype.escBattle=function(){this._isPaoDian=!1,ViewManager.ins().close(PaoDianWin)},e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"isPaoDian",{get:function(){return this._isPaoDian},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this._isOpen},enumerable:!0,configurable:!0}),e.prototype.enterPaoDian=function(){this.sendBaseProto(1)},e.prototype.postEnterSuccess=function(t){this._leftTime=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)},e.prototype.postBelongChange=function(t){this._belongs=[];var e=t.readInt();this._belongs.length=e;for(var i=0;e>i;i++)this._belongs[i]={id:t.readShort(),handler:t.readDouble()}},e.prototype.doEnterCD=function(t){this._enterCD=t.readInt(),this._enterCDTimer=egret.getTimer()},e.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)},e.prototype.postOpenInfo=function(t){this._isOpen=t.readBoolean(),this._openLeftTime=t.readInt(),this._openTimer=egret.getTimer()},e.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3},e.prototype.sendReLive=function(){this.sendBaseProto(5)},e.prototype.doRelive=function(t){UserBoss.ins().reliveTime=t.readInt(),UserBoss.ins().killerHandler=t.readDouble(),ViewManager.ins().close(TargetPlayerBigBloodPanel),UserBoss.ins().reliveTime>0?(UserBoss.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.sendCheckMyInfo=function(){this.sendBaseProto(6)},e.prototype.postMyInfo=function(t){this._shenBingExp=t.readInt(),this._jadeChips=t.readInt()},e.prototype.postAreaChange=function(t){this._areaId=t.readShort()},e.prototype.doResult=function(t){var e=t.readInt(),i=[];i.length=e;for(var s=0;e>s;s++)i[s]=new PaoDianRankVo(t);ViewManager.ins().open(PaoDianResultWin,i)},e.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level+1e3*UserZs.ins().lv>=GlobalConfig.PassionPointConfig.openLv},e.prototype.getBelongById=function(t){if(!this._belongs||0==this._belongs.length)return null;for(var e=this._belongs.length,i=0;e>i;i++)if(this._belongs[i].id==t)return this._belongs[i];return null},e}(BaseSystem);__reflect(PaoDianCC.prototype,"PaoDianCC");var GameSystem;!function(t){t.paoDianCC=PaoDianCC.ins.bind(PaoDianCC)}(GameSystem||(GameSystem={}));var PaoDianCurrentWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointCurrentTipsSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose),this.observe(PaoDianCC.ins().postMyInfo,this.update),this.observe(PaoDianCC.ins().postAreaChange,this.update),this.update()},e.prototype.update=function(){this.yupeiNum.text="威望"+PaoDianCC.ins().jadeChips,this.gwexpNum.text="经验"+PaoDianCC.ins().shenBingExp;var t=GlobalConfig.PassionPointAwardConfig[PaoDianCC.ins().areaId];this.currentArea.text=t?t.times+"倍区域":"";var e=t?t.reward[1].count:0;e=Math.floor(e/1e3)/10,this.Speed.text=GlobalConfig.PassionPointConfig.efficiencyDesc.replace("{0}",(t?t.reward[0].count:0)+"").replace("{1}",e+""),this.currentArea.textColor=this.yupeiNum.textColor=this.gwexpNum.textColor=this.Speed.textColor=t?t.color:this.Speed.textColor},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose),this.removeObserve()},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PaoDianCurrentWin.prototype,"PaoDianCurrentWin"),ViewManager.ins().reg(PaoDianCurrentWin,LayerManager.Main_View);var PaoDianIconItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointResultAwardSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.icon.source=this.data[0];var t=this.data[1];t=Math.floor(t/1e3)/10,this.count.text=0==t?"0":t+"万"},e}(BaseItemRender);__reflect(PaoDianIconItemRender.prototype,"PaoDianIconItemRender");var PaoDianNpcTalkWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onGoto),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)},e.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PassionPointConfig.desc),this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[20].text),this.redPoint.visible=PaoDianCC.ins().isOpen},e.prototype.onGoto=function(t){if(t.target==this.goTo){if(!PaoDianCC.ins().isOpen)return void UserTips.ins().showTips(GlobalConfig.PassionPointConfig.openTips);var e=GlobalConfig.PassionPointConfig.openLv;if(Actor.level+1e3*UserZs.ins().lv<e)return void UserTips.ins().showTips((1e3>e?e+"级":e%1e3==0?e/1e3+"转":e/1e3+"转"+e%1e3+"级")+"可参与激情泡点");var i=PaoDianCC.ins().getEnterCD();if(i>0)return void UserTips.ins().showTips(i+"秒后才可进入激情泡点");PaoDianCC.ins().enterPaoDian()}else t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PaoDianNpcTalkWin.prototype,"PaoDianNpcTalkWin"),ViewManager.ins().reg(PaoDianNpcTalkWin,LayerManager.UI_Main);var PaoDianResultItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointResultItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.award.itemRenderer=PaoDianIconItemRender},e.prototype.dataChanged=function(){var t=this.data;this.ranking.text=t.rank+"",this.roleName.text=t.roleName,this.guild.text=t.unionName,this.award.dataProvider=new ArrayCollection([["ZSprestige",t.jadeChips],["ZSexp",t.shenBingExp]])},e}(BaseItemRender);__reflect(PaoDianResultItemRender.prototype,"PaoDianResultItemRender");var PaoDianResultWin=function(t){function e(){var e=t.call(this)||this;return e._time=5,e.skinName="PointResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rankList.itemRenderer=PaoDianResultItemRender,this.myRewarrd.itemRenderer=PaoDianIconItemRender,this._arrayCollect=new ArrayCollection,this.myRewarrd.dataProvider=this._arrayCollect},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(PaoDianCC.ins().postMyInfo,this.updateMyScore),this.timerGroup.visible=!0,this.info.text=this._time+"",TimerManager.ins().doTimer(1e3,5,this.repeat,this),this.updateMyScore(),this.rankList.dataProvider=new eui.ArrayCollection(t[0])},e.prototype.updateMyScore=function(){this._arrayCollect.source=[["ZSprestige",PaoDianCC.ins().jadeChips],["ZSexp",PaoDianCC.ins().shenBingExp]]},e.prototype.repeat=function(){this._time--,this._time>0?this.info.text=this._time+"":this.timerGroup.visible=!1},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:UserFb.ins().sendExitFb(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PaoDianResultWin.prototype,"PaoDianResultWin"),ViewManager.ins().reg(PaoDianResultWin,LayerManager.UI_Main);var PaoDianWin=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e._stateList=["one","two","three","","five"],e.skinName="PointFightSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(PaoDianCC.ins().postEnterSuccess,this.updateTime),this.observe(PaoDianCC.ins().postBelongChange,this.update),this.observe(PaoDianCC.ins().postAreaChange,this.updateCurrentArea),this.update(),this.updateTime(),this.updateCurrentArea()},e.prototype.update=function(){for(var t,e,i,s,n,o=0;5>o;o++)t=GlobalConfig.PassionPointConfig.expPoint[o],e=t[2],i=PaoDianCC.ins().getBelongById(e),s=this["area"+o],s.name=i?i.handler+"":t[0]+","+t[1],this["occupy"+o].visible=null==i,i?(n=EntityManager.ins().getEntityBymasterhHandle(i.handler),n?(this["name"+o].text=n.infoModel.name,this["guild"+o].text=n.infoModel.guildName):(this["name"+o].text="",this["guild"+o].text="")):(this["name"+o].text="",this["guild"+o].text="")},e.prototype.updateTime=function(){TimerManager.ins().remove(this.repeat,this),this._leftTime=PaoDianCC.ins().getLeftTime(),this._leftTime>0?(TimerManager.ins().doTimer(1e3,0,this.repeat,this),this.repeat()):this.wholeLeftTime.text=""},e.prototype.repeat=function(){return this._leftTime<=0?(this.wholeLeftTime.text="",void TimerManager.ins().remove(this.repeat,this)):(this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4),void this._leftTime--)},e.prototype.updateCurrentArea=function(){var t=GlobalConfig.PassionPointAwardConfig[PaoDianCC.ins().areaId];this.currentArea.currentState=this._stateList[t?t.times-1:0]},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve(),TimerManager.ins().remove(this.repeat,this)},e.prototype.onTouch=function(t){switch(t.target){case this.area0:case this.area1:case this.area2:case this.area3:case this.area4:var e=t.target.name.split(",");1==e.length?GameLogic.ins().postChangeAttrPoint(Number(e[0])):(GameLogic.ins().stopAI(),SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameMap.moveTo(Number(e[0])*GameMap.CELL_SIZE,Number(e[1])*GameMap.CELL_SIZE));break;case this.currentArea:PaoDianCC.ins().sendCheckMyInfo(),ViewManager.ins().open(PaoDianCurrentWin);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[20].text)}},e}(BaseEuiView);__reflect(PaoDianWin.prototype,"PaoDianWin"),ViewManager.ins().reg(PaoDianWin,LayerManager.Main_View);var PaoDianRankVo=function(){function t(t){this.rank=t.readShort(),this.roleName=t.readString(),this.unionName=t.readString(),this.shenBingExp=t.readInt(),this.jadeChips=t.readInt()}return t}();__reflect(PaoDianRankVo.prototype,"PaoDianRankVo");var PlatFormID=function(){function t(){}return t}();PlatFormID.SDK_TYPE=window.ourPlatform,PlatFormID.WAN_BA="WAN_BA",PlatFormID.QQ_BROWSER="2000001",PlatFormID.ZHI_SHANG="2000003",PlatFormID.FENG_KUANG="2000004",PlatFormID.AI_WEI_YOU="2000005",PlatFormID.GE_TUI="2000006",PlatFormID.XIN_LANG="2000007",PlatFormID.$9G="2000012",PlatFormID.QUN_HEI="2000013",PlatFormID.$1758="2000014",__reflect(PlatFormID.prototype,"PlatFormID");var LoadingScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(BaseScene);__reflect(LoadingScene.prototype,"LoadingScene");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var WanbaLoading=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.bg=new eui.Image,this.bg.source=RES.getRes("wbbg_jpg"),this.addChildAt(this.bg,0),this.progress=new eui.Image,this.progress.width=.1,this.progress.source=RES.getRes("wbProgress_png"),this.progress.scale9Grid=new egret.Rectangle(5,2,3,1),this.progress.x=110,this.progress.y=583,this.addChild(this.progress),this.icon=new eui.Image,this.icon.source=RES.getRes("wbIcon_png"),this.icon.anchorOffsetX=10,this.icon.anchorOffsetY=11,this.icon.x=this.progress.x+this.progress.width,this.icon.y=this.progress.y+(this.progress.height>>1),this.addChild(this.icon)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];egret.startTick(this.iconRotation,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];egret.stopTick(this.iconRotation,this)},e.prototype.iconRotation=function(t){return this.icon.rotation+=5,!1},e.prototype.setProgress=function(t,e){var i=t/e;this.progress.width=257*i,this.icon.x=this.progress.x+this.progress.width,this.icon.y=this.progress.y+(this.progress.height>>1)},e}(LoadingView);__reflect(WanbaLoading.prototype,"WanbaLoading");var PfActivity=function(t){function e(){var e=t.call(this)||this;return e.wxInviteCount=0,e.focusState=-1,e.shareState=-1,e.isShowGameDesktop=0,e.sysId=PackageID.pfActivity,e.regNetMsg(1,e.doWanBaGift),e.regNetMsg(3,e.doZhiShangData),e.regNetMsg(4,e.doWeiXinInviteGift),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){var t=this;this.sendWanBaGift(),window.isFocus(),window.isShare(),window.isShowGameDesktop(function(e){SysSetting.ins().getValue("isSaveGameDesktop")&&(e=0),t.postGameDesktop(e)})},e.prototype.postGuanZhu=function(t){this.focusState=t,1==this.focusState&&this.sendGuanZhuGift()},e.prototype.postShare=function(t){this.shareState=t},e.prototype.postGameDesktop=function(t){return this.isShowGameDesktop=t,t},e.prototype.saveGameDesktop=function(){var t=this;window.saveGameDesktop(function(){SysSetting.ins().setValue("isSaveGameDesktop",1),t.postGameDesktop(0)})},e.prototype.doWanBaGift=function(t){ViewManager.ins().open(WanBaGiftWin,t.readByte(),t.readBoolean())},e.prototype.sendWanBaGift=function(){LocationProperty.gifi&&this.sendBaseProto(1)},e.prototype.sendGuanZhuGift=function(){this.sendBaseProto(2)},e.prototype.doZhiShangData=function(t){LocationProperty.appid==PlatFormID.ZHI_SHANG&&ReportData.getIns().reportUrl(LocationProperty.callUrl)},e.prototype.sendWeiXinInviteGift=function(){this.sendBaseProto(4)},e.prototype.doWeiXinInviteGift=function(t){e.ins().wxInviteCount=t.readInt(),e.ins().inviteTime=t.readInt(),this.postInviteInfoUpdate()},e.prototype.postInviteInfoUpdate=function(){},e.prototype.copyMsgToBoard=function(t){if(document&&document.createElement){var e=document.createElement("input");return e.value=t,document.body.appendChild(e),e.select(),e.setSelectionRange(0,e.value.length),document.execCommand("Copy"),document.body.removeChild(e),!0}return!1},e}(BaseSystem);__reflect(PfActivity.prototype,"PfActivity");var GameSystem;!function(t){t.pfactivity=PfActivity.ins.bind(PfActivity)}(GameSystem||(GameSystem={}));var FocusWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="UpToDesktopSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.focusBtn,this.onTap),this.initList()},e.prototype.initList=function(){var t=GlobalConfig.WeiXiGuanZhuConst.awards;this.reward.itemRenderer=ItemBase,this.reward.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.focusBtn:window.showQRCode&&window.showQRCode(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(FocusWin.prototype,"FocusWin"),ViewManager.ins().reg(FocusWin,LayerManager.UI_Popup);var FranchiseWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SpecialCardSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Recharge.ins().postFranchiseInfo,this.setView),this.addTouchEvent(this.btn1,this.onTap),this.feng.visible?(this.btn1.visible=!1,this.first&&(this.first.visible=!1)):(Recharge.ins().franchise>0?(TimerManager.ins().doTimer(1e3,0,this.setTimeLbel,this),this.setTimeLbel(),this.btn1.visible=!0,this.setView()):(this.btn1.visible=!0,TimerManager.ins().remove(this.setTimeLbel,this),this.first&&(this.first.visible=Recharge.ins().firstBuy?!0:!1)),this.leftTime.visible=Recharge.ins().franchise>0?!0:!1),this.setIconEff(),this.depictLabel.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrivilegeData.rightDesc)},e.prototype.setView=function(){Recharge.ins().franchiseget?(this.btn1.currentState="up",this.btn1.touchEnabled=!0,this.btn1.label="领取奖励"):(this.btn1.label="已领取",this.btn1.currentState="disabled",this.btn1.touchEnabled=!1),this.first&&(this.first.visible=!1)},e.prototype.setTimeLbel=function(){var t=Recharge.ins().franchise,e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,1);e="<font color='#35e62d'>剩余时间:"+e+"</font>",this.leftTime.textFlow=(new egret.HtmlTextParser).parser(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.removeTouchEvent(this.btn1,this.onTap),TimerManager.ins().remove(this.setTimeLbel,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn1:"领取奖励"!=this.btn1.label?Recharge.ins().showReCharge(1001):Recharge.ins().sendGetFranchise()}},e.prototype.setIconEff=function(){var t=GlobalConfig.TitleConf[17];if(t){t.eff?(this.mc||(this.mc=new MovieClip),this.mc.parent||this.titleMcGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"chenghaozztq_big",-1)):(this.titleImg||(this.titleImg=new eui.Image(t.img)),this.titleImg.parent||this.titleMcGroup.addChild(this.titleImg));var e=0;e=3*UserBag.getAttrPower(t.attrs),this.powerPanel.setPower(e)}},e}(BaseView);__reflect(FranchiseWin.prototype,"FranchiseWin");var MonthCardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MonthCardSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Recharge.ins().postUpdateRecharge,this.setView),this.addTouchEvent(this.btn1,this.onTap),this.feng.visible?this.btn1.visible=!1:(Recharge.ins().monthDay>0?(TimerManager.ins().doTimer(1e3,0,this.setTimeLbel,this),this.setTimeLbel(),this.btn1.visible=!1):(this.btn1.visible=!0,TimerManager.ins().remove(this.setTimeLbel,this)),this.leftTime.visible=Recharge.ins().monthDay>0?!0:!1,this.setView())},e.prototype.setView=function(){this.first.visible=!Setting.ins().getValue(ClientSet.firstMonthCard)},e.prototype.setTimeLbel=function(){var t=Recharge.ins().monthDay,e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,1);e="<font color='#35e62d'>剩余时间:"+e+"</font>",this.leftTime.textFlow=(new egret.HtmlTextParser).parser(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.removeObserve(),this.removeTouchEvent(this.btn1,this.onTap),TimerManager.ins().remove(this.setTimeLbel,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn1:Recharge.ins().showReCharge(1e3)}},e}(BaseView);__reflect(MonthCardWin.prototype,"MonthCardWin");var WanBaGiftWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GiftNoticeSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1];this.currentState=s?"success":"fail",this.addTouchEvent(this.okBtn,this.onTap);for(var n=GlobalConfig.WanBaGiftbagBasic[i],o="",a=0;a<n.items.length;a++)o+=0==n.items[a].type?RewardData.getCurrencyName(n.items[a].id):GlobalConfig.ItemConfig[n.items[a].id].name,o+="×"+n.items[a].count,a+1<n.items.length&&(o+="、");this.text.text=o},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.okBtn,this.onTap)},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(WanBaGiftWin.prototype,"WanBaGiftWin"),ViewManager.ins().reg(WanBaGiftWin,LayerManager.UI_Main);var WeiBoShareWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WeiboShareSkin",this.input.textDisplay.size=16,this.input.textDisplay.lineSpacing=0,this.input.textDisplay.multiline=!0,this.input.textDisplay.wordWrap=!0,this.input.textDisplay.height=171,this.input.textDisplay.maxChars=40},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.fxBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.fxBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.fxBtn:if(this.input.text.length<=0)return void UserTips.ins().showTips("请输入分享内容");window.weiboShare(this.input.text,LocationProperty.openID,LocationProperty.openKey);case this.closeBtn1:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WeiBoShareWin.prototype,"WeiBoShareWin"),ViewManager.ins().reg(WeiBoShareWin,LayerManager.UI_Popup);var YqWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="InviteFriendsSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateInfo(),TimerManager.ins().doTimer(1e3,0,this.updateInfo,this),this.observe(PfActivity.ins().postInviteInfoUpdate,this.updateInfo),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.fxBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateInfo,this),this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.fxBtn,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn1:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.fxBtn:ViewManager.ins().open(WeiBoShareWin)}},e.prototype.updateInfo=function(){if(PfActivity.ins().wxInviteCount>=3)return void ViewManager.ins().close(this);var t=3;this.count.text="("+PfActivity.ins().wxInviteCount+"/"+t+")",this.fxBtn.enabled=PfActivity.ins().wxInviteCount<t;var e=GlobalConfig.SDKConfig.shareReward,i=e[0];if(0==i.type)this.icon.source=RewardData.getCurrencyRes(i.id);else{var s=GlobalConfig.ItemConfig[i.id];s&&(this.icon.source=s.icon+"_png")}if(this.item.source=this.icon.source,this.ybCountTxt.text=""+i.count,PfActivity.ins().wxInviteCount){var n=DateUtils.formatMiniDateTime(PfActivity.ins().inviteTime)-GameServer.serverTime;this.time.text=n>0?DateUtils.getFormatBySecond(n/1e3)+"后可再次邀请":""}else this.time.text=""},e}(BaseEuiView);__reflect(YqWin.prototype,"YqWin"),ViewManager.ins().reg(YqWin,LayerManager.UI_Popup);var PlayerAttrModel=function(){function t(){this.module=0,this.soldierPower=0,this.magePower=0,this.immortalPower=0}return t}();__reflect(PlayerAttrModel.prototype,"PlayerAttrModel");var PlayerAttrManager=function(t){function e(){var e=t.call(this)||this;return e.moduleAry=[],e.count=0,e.roleIndex=0,e.descAry=[],e.attrData=[],e.dressPower=0,e.dressCount=9,e.score=0,e.power=0,e.specialPower=0,e.descAry.push("总装备"),e.descAry.push("装备分"),e.descAry.push("传世"),e.descAry.push("龙魂"),e.descAry.push("战纹"),e.descAry.push("装扮"),e.descAry.push("称号"),e.descAry.push("合击"),e.descAry.push("转生"),e.descAry.push("羽毛"),e.descAry.push("两个戒指"),e.descAry.push("烈焰戒指"),e.descAry.push("烈焰戒指技能"),e.descAry.push("官印"),e.descAry.push("内功"),e.descAry.push("经脉"),e.descAry.push("秘籍"),e.descAry.push("爵位"),e.descAry.push("神器"),e.descAry.push("勋章"),e.descAry.push("图鉴"),e.descAry.push("强化"),e.descAry.push("精炼"),e.descAry.push("铸造"),e.descAry.push("兵魂"),e.descAry.push("行会技能"),e.descAry.push("VIP"),e.descAry.push("等级"),e}return __extends(e,t),e.prototype.doSave=function(t,e,i){var s;if("function"==typeof window.Blob)s=new Blob([t],{type:e});else{var n=window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder,o=new n;o.append(t),s=o.getBlob(e)}var a=window.URL||window.webkitURL,r=a.createObjectURL(s),h=document.createElement("a");if("download"in h){h.style.visibility="hidden",h.href=r,h.download=i,document.body.appendChild(h);var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!0),h.dispatchEvent(l),document.body.removeChild(h)}else navigator.msSaveBlob?navigator.msSaveBlob(s,i):location.href=r},e.prototype.save=function(t,e){this.doSave(t,"text/latex",e+".txt")},e.prototype.getAttrStr=function(){for(var t="",e=this.attrData.length,i=0;e>i;i++){var s=this.attrData[i];t+=this.descAry[s.module]+"	"+s.soldierPower+"	"+s.magePower+"	"+s.immortalPower+"\n"}return t},e.prototype.getModuleIndex=function(t){for(var e=this.descAry.length,i=0;e>i;i++)if(this.descAry[i]==t)return i;return 0},e.prototype.updateData=function(t,e,i){var s=this.getModuleIndex(t);void 0==i&&(i=0);var n=SubRoles.ins().getSubRoleByIndex(i).job,o=this.attrData[s];switch(void 0==o&&(o=new PlayerAttrModel),n){case JobConst.ZhanShi:o.soldierPower=e;break;case JobConst.FaShi:o.magePower=e;break;case JobConst.DaoShi:o.immortalPower=e}o.module=s,this.attrData[s]=o},e.prototype.isHaveRole=function(t){return t<SubRoles.ins().subRolesLen},e.prototype.getAttr=function(){var t=this;ViewManager.ins().open(LiLianWin,3),TimerManager.ins().doTimerDelay(850,0,1,function(){t.updateData("图鉴",Book.ins().getBookPowerNumEx()),ViewManager.ins().close(LiLianWin)},this),TimerManager.ins().doTimerDelay(850,0,1,function(){ViewManager.ins().open(LiLianWin,2),TimerManager.ins().doTimerDelay(860,0,1,function(){var e=ViewManager.ins().getView(LiLianWin);t.updateData("勋章",e.xunzhangPanel.getPower()),ViewManager.ins().close(LiLianWin)},t)},this),TimerManager.ins().doTimerDelay(1e3,0,1,function(){ViewManager.ins().open(LiLianWin,1)},this),TimerManager.ins().doTimerDelay(1150,0,1,function(){for(var e=parseInt(Artifact.ins().getMaxIndex()+""),i=0,s=0;e>s&&(Artifact.ins().getNewArtifactBy(s+1).open||0!=Artifact.ins().getNewArtifactPower(s+1));s++)i+=Artifact.ins().getNewArtifactPower(s+1);t.updateData("神器",i)},this),TimerManager.ins().doTimerDelay(1500,0,1,function(){ViewManager.ins().close(LiLianWin),ViewManager.ins().open(LiLianWin)},this),TimerManager.ins().doTimerDelay(1600,0,1,function(){t.updateData("爵位",LiLian.ins().getPower()),ViewManager.ins().close(LiLianWin)},this),TimerManager.ins().doTimerDelay(1700,0,1,function(){ViewManager.ins().open(DressWin,0,3),TimerManager.ins().doTimerDelay(10,0,1,function(){t.updateData("称号",Title.ins().getTotalPower(),0),ViewManager.ins().close(DressWin)},t)},this),TimerManager.ins().doTimerDelay(1800,0,1,function(){ViewManager.ins().open(DressWin,1,3),TimerManager.ins().doTimerDelay(20,0,1,function(){t.updateData("称号",Title.ins().getTotalPower(),1),ViewManager.ins().close(DressWin)},t)},this),TimerManager.ins().doTimerDelay(1900,0,1,function(){ViewManager.ins().open(DressWin,2,3),TimerManager.ins().doTimerDelay(20,0,1,function(){t.updateData("称号",Title.ins().getTotalPower(),2),ViewManager.ins().close(DressWin)},t)},this),TimerManager.ins().doTimerDelay(2e3,0,1,function(){ViewManager.ins().open(GuildSkillWin,0),TimerManager.ins().doTimerDelay(20,0,1,function(){var e=ViewManager.ins().getView(GuildSkillWin);t.updateData("行会技能",e.guildskill.getTotalPower(),0),ViewManager.ins().close(GuildSkillWin)},t)},this),TimerManager.ins().doTimerDelay(2100,0,1,function(){ViewManager.ins().open(GuildSkillWin,1),TimerManager.ins().doTimerDelay(20,0,1,function(){var e=ViewManager.ins().getView(GuildSkillWin);t.updateData("行会技能",e.guildskill.getTotalPower(),1),ViewManager.ins().close(GuildSkillWin)},t)},this),TimerManager.ins().doTimerDelay(2200,0,1,function(){ViewManager.ins().open(GuildSkillWin,2),TimerManager.ins().doTimerDelay(20,0,1,function(){var e=ViewManager.ins().getView(GuildSkillWin);t.updateData("行会技能",e.guildskill.getTotalPower(),2),ViewManager.ins().close(GuildSkillWin),ViewManager.ins().close(GuildMap),ViewManager.ins().open(RoleWin,0),t.getRoleInfo()},t)},this),this.updateData("VIP",this.getVipPower());for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i).job,n=this.getRolePower(Actor.level,s);this.updateData("等级",n,i)}},e.prototype.getVipPower=function(){var t=0;if(UserVip.ins().lv>0){var e=GlobalConfig.VipConfig[UserVip.ins().lv];t=UserBag.getAttrPower(e.attrAddition)}return t},e.prototype.getRolePower=function(t,e){var i,s=0;for(var n in GlobalConfig.RoleConfig)if(n==t.toString())for(var o in GlobalConfig.RoleConfig[n])o==e.toString()&&(i=GlobalConfig.RoleConfig[n][o],s=this.getAttrPower(i));return s},e.prototype.getAttrPower=function(t){var e=[];e.push(new AttributeData(AttributeType.atHp,t.hp)),e.push(new AttributeData(AttributeType.atMp,t.mp)),e.push(new AttributeData(AttributeType.atAttack,t.atk)),e.push(new AttributeData(AttributeType.atDef,t.def)),e.push(new AttributeData(AttributeType.atRes,t.res)),e.push(new AttributeData(AttributeType.atCrit,t.crit)),e.push(new AttributeData(AttributeType.atTough,t.tough)),e.push(new AttributeData(AttributeType.atAttackSpeed,t.as)),e.push(new AttributeData(AttributeType.atMoveSpeed,t.ms));var i=0;return i=UserBag.getAttrPower(e)},e.prototype.getRoleInfo=function(){var t=this;TimerManager.ins().doTimerDelay(20,0,1,function(){var e=ViewManager.ins().getView(RoleWin),i=e.roleInfoPanel;TimerManager.ins().doTimerDelay(10,0,1,function(){i["item"+t.count].showPower(),TimerManager.ins().doTimerDelay(20,0,1,function(){var e=ViewManager.ins().getView(EquipDetailedWin);void 0!=e&&("官印"==e.getType()?t.updateData("官印",e.getPower(),t.roleIndex):(t.score+=e.getScore(),t.power+=e.getPower()),ViewManager.ins().close(EquipDetailedWin)),t.count++,t.count<9?t.getRoleInfo():(t.updateData("总装备",t.power,t.roleIndex),t.updateData("装备分",t.score,t.roleIndex),t.count=0,t.power=0,t.score=0,t.roleIndex++,ViewManager.ins().close(RoleWin),TimerManager.ins().doTimerDelay(20,0,1,function(){t.roleIndex<3?(ViewManager.ins().open(RoleWin,0,t.roleIndex),t.getRoleInfo()):(t.count=0,t.roleIndex=0,t.getSpecialRingPower())},t))},t)},t)},this)},e.prototype.getSpecialRingPower=function(){var t=this;ViewManager.ins().open(SpecialRingWin,this.count,this.roleIndex),TimerManager.ins().doTimerDelay(20,0,1,function(){var e=ViewManager.ins().getView(SpecialRingWin);TimerManager.ins().doTimerDelay(10,0,1,function(){t.specialPower+=e.getPower(),ViewManager.ins().close(SpecialRingWin),t.count++,t.count<2?t.getSpecialRingPower():(t.updateData("两个戒指",t.specialPower,t.roleIndex),t.specialPower=0,t.count=0,t.roleIndex++,TimerManager.ins().doTimerDelay(20,0,1,function(){t.roleIndex<3?(ViewManager.ins().open(SpecialRingWin,t.count,t.roleIndex),t.getSpecialRingPower()):(t.count=0,t.roleIndex=0,t.delayRun())},t))},t)},this)},e.prototype.delayRun=function(){this.moduleAry.push({tips:"烈焰戒指",cls:FireRingWin}),this.moduleAry.push({tips:"烈焰戒指技能",cls:FireRingWin,param:1}),this.addRoleAttr({tips:"龙魂",cls:TreasureWin}),this.addRoleNextAttr({tips:"内功",cls:SkillWin,param:1}),this.addRoleNextAttr({tips:"经脉",cls:SkillWin,param:2}),this.addRoleNextAttr({tips:"秘籍",cls:SkillWin,param:3}),this.addRoleNextAttr({tips:"强化",cls:ForgeWin,param:0}),this.addRoleNextAttr({tips:"精炼",cls:ForgeWin,param:1}),this.addRoleNextAttr({tips:"铸造",cls:ForgeWin,param:2}),this.addRoleNextAttr({tips:"兵魂",cls:ForgeWin,param:3}),this.moduleAry.push({tips:"合击",cls:RoleWin,param:1}),this.moduleAry.push({tips:"转生",cls:RoleWin,param:2}),this.addRoleNextAttr({tips:"羽毛",cls:RoleWin,param:3}),this.addRoleAttr({tips:"传世",cls:HeirloomWin}),this.addRoleAttr({tips:"战纹",cls:RuneWin}),this.addRoleNextAttr({tips:"装扮",cls:DressWin,param:0}),this.addRoleNextAttr({tips:"装扮",cls:DressWin,param:1}),this.addRoleNextAttr({tips:"装扮",cls:DressWin,param:2}),this.onGetAttr()},e.prototype.addRoleAttr=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)this.moduleAry.push({tips:t.tips,cls:t.cls,roleIndex:i,param:i})},e.prototype.addRoleNextAttr=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)this.moduleAry.push({tips:t.tips,cls:t.cls,roleIndex:i,param:[t.param,i]})},e.prototype.onGetAttr=function(){var t=this;this.moduleAry.length&&(this.data=this.moduleAry.shift(),void 0!=this.data.param?this.data.param instanceof Array?ViewManager.ins().open(this.data.cls,this.data.param[0],this.data.param[1]):ViewManager.ins().open(this.data.cls,this.data.param):ViewManager.ins().open(this.data.cls),TimerManager.ins().doTimerDelay(100,0,1,function(){t.getPlayerAttr()},this))},e.prototype.getPlayerAttr=function(){var t=ViewManager.ins().getView(this.data.cls);this.getValue(t,this.data,this.data.cls),this.onGetAttr()},e.prototype.getValue=function(t,e,i){for(var s=0;s<t.numChildren;s++){var n=t.getChildAt(s);if(n instanceof PowerPanel){if(n.visible){var o=0;if(this.data.roleIndex&&(o=this.data.roleIndex),"装扮"==this.data.tips)this.dressCount--,this.dressPower+=n.power,0==this.dressCount&&(this.updateData(this.data.tips,this.dressPower,o),this.dressPower=0,this.dressCount=9,this.save(this.getAttrStr(),Actor.myName+"的战斗力"));else{var a=0;n.power&&(a=n.power),this.updateData(this.data.tips,a,o)}}return void ViewManager.ins().close(i)}if(n instanceof egret.DisplayObjectContainer)if(n instanceof eui.ViewStack){var r=n.selectedChild;r&&this.getValue(r,e,i)}else this.getValue(n,e,i)}ViewManager.ins().close(i)},e.ins=function(){return t.ins.call(this)},e}(BaseClass);__reflect(PlayerAttrManager.prototype,"PlayerAttrManager");var ActivityForeshowModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getForeshow=function(){for(var t in GlobalConfig.NewFuncNoticeConfig){var e=GlobalConfig.NewFuncNoticeConfig[t],i=this.checkOpenTime(e.open,e.close);if(i&&Actor.level>=e.openLv)return e}return null},e.prototype.checkOpenTime=function(t,e){var i=GameServer.serverOpenDay>=t&&GameServer.serverOpenDay<e;return i},e.prototype.getRemainTime=function(){var t=0,e=this.getForeshow();if(e){var i=new Date(DateUtils.formatMiniDateTime(GameServer._serverZeroTime));i.setDate(i.getDate()+e.close),i.setHours(0,0,0,0);var s=i.getTime(),n=(new Date).getTime();t=s-n,0>t&&(t=0)}return t/=1e3},e}(BaseClass);__reflect(ActivityForeshowModel.prototype,"ActivityForeshowModel");var PlayFunShow;!function(t){t[t.topMain=1]="topMain",t[t.leftGroup=2]="leftGroup",t[t.rightGroup=4]="rightGroup",t[t.downGroup=8]="downGroup",t[t.topGroup=16]="topGroup"}(PlayFunShow||(PlayFunShow={}));var PlayFun=function(t){function e(){var i=t.call(this)||this;return i.showTipsObj=null,i.observe(UserBoss.ins().postBossData,i.publicBossRelive),i.observe(UserFb.ins().postAddEnergy,i.updateAutoPk),i.observe(GameLogic.ins().postEnterMap,function(){var t=GameMap.fubenID;if(!CityCC.ins().isCity){if(!t||GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS)return ViewManager.ins().isShow(PlayFunView)||ViewManager.ins().open(PlayFunView),void(GameMap.fbType==UserFb.FB_TYPE_GUANQIABOSS?i.postShowViews(PlayFunShow.topMain):i.postShowViews(e.showAll));ViewManager.ins().close(PlayFunView)}}),i}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.closeAuto=function(){var t=ViewManager.ins().getView(PlayFunView);t&&(t.autoPkBoss.selected=!1),this.updateAutoPk()},e.prototype.openAuto=function(){var t=ViewManager.ins().getView(PlayFunView);t&&(t.autoPkBoss.selected=!0),this.updateAutoPk()},e.prototype.publicBossRelive=function(t){var e=t[0],i=t[1],s=ViewManager.ins().getView(PlayFunView);s&&s.publicBossRelive(e,i)},e.prototype.upDataWillBoss=function(t){var e=ViewManager.ins().getView(PlayFunView);e&&e.upDataWillBoss(t)},e.prototype.updateAutoPk=function(){if(!UserFb.ins().bossIsChallenged){var t=UserFb.ins().energy,e=UserFb.ins().currentEnergy,i=ViewManager.ins().getView(PlayFunView);i&&i.autoPkBoss.selected&&e>=t?UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?(i.autoPkBoss.selected=!1,UserTips.ins().showTips("背包剩余空位不足，请先清理"),this.removePkArrowTips()):UserFb.ins().guanqiaID<GlobalConfig.InstanceBaseConfig.maxCheckPoint?this.addPkArrowTips():(UserTips.ins().showCenterTips("当前已达最大关卡"),this.removePkArrowTips()):this.removePkArrowTips()}},e.prototype.postShowViews=function(t,e){return void 0===e&&(e=!1),[t,e]},e.prototype.addPkArrowTips=function(){var t=this,e=ViewManager.ins().getView(PlayFunView);e&&!this.showTipsObj&&(this.showTipsObj={},e.showTaskTips("能量已满，即将自动挑战关卡BOSS"),egret.Tween.get(this.showTipsObj).wait(1500).call(function(){e.autoPkBoss.selected&&(GameLogic.ins().startPkBoss(),t.removePkArrowTips())}))},e.prototype.removePkArrowTips=function(){this.showTipsObj&&(egret.Tween.removeTweens(this.showTipsObj),this.showTipsObj=null)},e}(BaseSystem);PlayFun.showAll=PlayFunShow.topMain|PlayFunShow.leftGroup|PlayFunShow.rightGroup|PlayFunShow.downGroup|PlayFunShow.topGroup,__reflect(PlayFun.prototype,"PlayFun");var GameSystem;!function(t){t.playfun=PlayFun.ins.bind(PlayFun)}(GameSystem||(GameSystem={}));var PlayFunView=function(t){function e(){var e=t.call(this)||this;return e.ruleList={},e.ruleParent={},e.ruleIdList={},e.ruleEff={},e.taskEffTypes=[],e.preRecharge=!1,e.preVip=!1,e.lastEnergy=-1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.destoryView=function(){},e.prototype.initData=function(){CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold),CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb),this.nameTxt.text=Actor.myName,this.expChange(),BitmapNumber.ins().changeNum(this.power,Actor.power,"8",5),this.vipNum.x=UserVip.ins().lv>=10?this.vipImg0.x+this.vipImg0.width+5:this.vipNum.x=this.vipImg0.x+this.vipImg0.width+10,BitmapNumber.ins().changeNum(this.vipNum,UserVip.ins().lv,"zv0",8),this.upDataVipBtnRedPoint()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="PlayFunSkin",this.showViewList={},this.showViewList[PlayFunShow.topMain]=this.topMain,this.showViewList[PlayFunShow.leftGroup]=this.leftGroup,this.showViewList[PlayFunShow.rightGroup]=this.rightGroup,this.showViewList[PlayFunShow.downGroup]=this.downGroup,this.showViewList[PlayFunShow.topGroup]=this.topGroup,this.rulePos={0:this.downGroup,1:this.iconGroup,2:this.leftGroup,3:this.rightGroup},this.flameMC=new MovieClip,this.flameMC.x=72,this.flameMC.y=21,this.flameGroup.addChildAt(this.flameMC,0),this.power=BitmapNumber.ins().createNumPic(0,"8",5),this.power.scaleX=this.power.scaleY=.8,this.power.x=this.fightImg.x+53,this.power.y=this.fightImg.y+4,this.flameGroup.addChild(this.power),this.guanQicMc=new MovieClip,this.guanQicMc.touchEnabled=!1,this.expBallMc=new MovieClip,this.expBallMc.x=80,this.expBallMc.y=86,this.expBallMc.touchEnabled=!1,this.guanQiaLineMc=new MovieClip,this.guanQiaLineMc.x=83,this.guanQiaLineMc.y=107,this.guanQiaLineMc.touchEnabled=!1,this.taskAsseptMc=new MovieClip,this.taskAsseptMc.x=140,this.taskAsseptMc.y=-50,this.taskAsseptMc.touchEnabled=!1,this.taskComMc=new MovieClip,this.taskComMc.x=140,this.taskComMc.y=-80,this.taskComMc.touchEnabled=!1;var e=SubRoles.ins().getSubRoleByIndex(0);this.face.source="yuanhead"+e.job+e.sex,this.vipNum=BitmapNumber.ins().createNumPic(UserVip.ins().lv,"zv0",8),this.vipNum.x=UserVip.ins().lv>=10?this.vipImg0.x+this.vipImg0.width+5:this.vipNum.x=this.vipImg0.x+this.vipImg0.width+10,this.vipNum.y=this.vipImg0.y,this.vipGroup.addChild(this.vipNum),this.guanqiaBar.slideDuration=0,this.publicBossRelive(!1),RuleIconBase.update=this.updateRule.bind(this),RuleIconBase.updateShow=this.updateRuleAndSort.bind(this),this.initRuleList()},e.prototype.initRuleList=function(){var t=GlobalConfig.PlayFunConfig;for(var e in t){var i=t[e],s=egret.getDefinitionByName(i.cls);s?this.addRuleList(new s(i.id)):alert("功能入口配置错误，id:"+e+" cls:"+i.cls)}this.groupGuanqia.touchEnabled=!1,this.addRuleList(new GuangqiaIconRule(0,this.groupGuanqia)),this.addRuleList(new TaskTraceIconRule(0,this.taskTraceBtn)),this.hejiRule=new HejiIconRule(0,this.hejiguide),this.addRuleList(this.hejiRule)},e.prototype.addRuleList=function(t){if(this.ruleList[t.hashCode]=t,t.id&&(this.ruleIdList[t.id]=t),t.tar&&t.tar.parent)this.ruleParent[t.hashCode]=t.tar.parent,t.tar.parent.removeChild(t.tar);else{var e=GlobalConfig.PlayFunConfig[t.id];this.ruleParent[t.hashCode]=this.rulePos[e.pos]}},e.prototype.showViews=function(t){for(var e=t[0],i=t[1],s=1;PlayFunShow[s];){var n=(e&s)==s;this.showView(s,i?!n:n),s*=2}},e.prototype.showView=function(t,e){this.showViewList[t].visible=e},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn_toolbar,this.onTap),this.addTouchEvent(this.autoPkBoss,this.onChange),this.addTouchEvent(this.vipBtn0,this.onTap),this.addTouchEvent(this.taskTraceBtn,this.onTaskTrace),this.addTouchEvent(this.guanqiaBtn,this.onTaskTrace),this.addTouchEvent(this.guanqiaBtn,this.guanqiaBtnClick),this.addTouchEvent(this.face,this.onTap),this.addTouchEvent(this.expGroup,this.onTap),this.addTouchEvent(this.mapName0,this.onTap),this.observe(GameLogic.ins().postEnterMap,this.upDataGuanqia),this.observe(UserFb.ins().postGuanqiaInfo,this.upDataGuanQiaInfo),this.observe(UserTask.ins().postUpdteTaskTrace,this.changeTaskTrace),this.observe(UserTask.ins().postUpdteTaskTrace,this.updateTaskState),this.observe(UserFb.ins().postGuanKaIdChange,this.guanqiaChange),this.observe(GameLogic.ins().postSubRoleChange,this.initData),this.observe(Actor.ins().postGoldChange,this.initData),this.observe(Actor.ins().postYbChange,this.initData),this.observe(Actor.ins().postNameChange,this.initData),this.observe(Actor.ins().postPowerChange,this.initData),this.observe(GameLogic.ins().postExpMc,this.addExpFlyMc),this.observe(UserFb.ins().postAddEnergy,this.upDataGuanqia),this.observe(UserFb.ins().postPlayWarm,this.warmWord),this.observe(UserVip.ins().postUpdateVipData,this.initData),this.observe(UserVip.ins().postUpdataExp,this.upDataVipBtnRedPoint),this.observe(UserVip.ins().postUpdateVipAwards,this.upDataVipBtnRedPoint),this.observe(UserVip.ins().postUpdateWeekAwards,this.upDataVipBtnRedPoint),this.observe(Actor.ins().postLevelChange,this.updateHeadRedPoint),this.observe(GameLogic.ins().postLevelBarChange,this.updateLevelBar),this.observe(Actor.ins().postExp,this.checkGuide),this.observe(PlayFun.ins().postShowViews,this.showViews),this.observe(UserFb.ins().postTeamFbFlowarRecords,this.updateFlower),this.observe(UserFb.ins().postAutoPk,this.GuanQiaEffLogic),this.observe(UserFb.ins().postAutoPk2,this.GuanQiaEffLogic),this.addTouchEvent(this.recharge1,this.onTap),this.addTouchEvent(this.recharge2,this.onTap),this.initData(),this.upDataGuanQiaInfo(),this.changeTaskTrace(),this.addRuleEvent(),this.updateRules(),this.upDataWillBoss(Encounter.ins().willBossID),this.updateHeadRedPoint(),HBSystem.ins().updateHongBao(),this.flameMC.playFile(RES_DIR_EFF+"zhanduolibeijing",-1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeGuanQiaEnergy(),this.removeRuleEvent(),this.hongbao.removeChildren(),DisplayUtils.removeFromParent(this._flowerShowItem)},e.prototype.expChange=function(t){var e=t||Actor.level,i=UserZs.ins()?UserZs.ins().lv:0,s="|C:0xF1D715&T:"+(i?i+"转":"")+"|";s=s+e+"级",this.lvTxt.textFlow=TextFlowMaker.generateTextFlow(s)},e.prototype.hideBtn=function(){this.iconGroup.visible=!this.btn_toolbar.selected},e.prototype.addRuleEvent=function(){for(var t in this.ruleList){var e=this.ruleList[t];e.addShowEvents(),e.isShow&&(e.addRedEvents(),ResourceMgr.ins().reloadContainer(e.tar))}},e.prototype.removeRuleEvent=function(){for(var t in this.ruleList){var e=this.ruleList[t];e.removeEvents()}},e.prototype.updateRules=function(){TimerManager.ins().isExists(this.startUpdateRule,this)||TimerManager.ins().doTimer(60,1,this.startUpdateRule,this)},e.prototype.startUpdateRule=function(){var t=!1;for(var e in this.ruleList){var i=this.ruleList[e],s=this.updateShow(i);s&&(t=!0),!s&&i.isShow&&this.updateRule(i)}t&&this.sortBtnList(),this.checkGuide()},e.prototype.checkGuide=function(){DieGuide.ins().checkFirstChargeOrVIPWin()},e.prototype.updateRuleAndSort=function(t){TimerManager.ins().doTimer(100,1,function(){this.updateShow(t)&&this.sortBtnList(t)},this)},e.prototype.updateShow=function(t){var e,i=t.checkShowIcon();if(KFServerSys.ins().isLinkingKF&&(i=!1),t.isShow==i)return!1;if(t.isShow=i,i){t.addRedEvents(),e=t.getTar(),e.addEventListener(egret.TouchEvent.TOUCH_TAP,t.tapExecute,t);var s=this.ruleParent[t.hashCode];s.addChild(e),ResourceMgr.ins().reloadContainer(e),this.updateRule(t)}else t.removeRedEvents(),e=t.tar,e&&(e.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.tapExecute,t),DisplayUtils.removeFromParent(e),DisplayUtils.removeFromParent(this.ruleEff[e.hashCode]));return!0},e.prototype.updateRule=function(t){var e=0,i=t.getTar();i.redPoint&&(e=t.checkShowRedPoint(),i.redPoint.visible=e);var s=t.getEffName(e);if(s)if(this.ruleEff[i.hashCode]&&this.ruleEff[i.hashCode].parent)this.ruleEff[i.hashCode].play(-1);else{var n=this.getEff(i.hashCode,s);n.x=t.effX,n.y=t.effY,i.addChildAt(n,100)}else DisplayUtils.removeFromParent(this.ruleEff[i.hashCode])},e.prototype.getEff=function(t,e){return this.ruleEff[t]=this.ruleEff[t]||new MovieClip,e&&this.ruleEff[t].playFile(RES_DIR_EFF+e,-1),this.ruleEff[t]},e.prototype.onChange=function(t){UserFb.ins().guanqiaID<=10?(UserTips.ins().showTips("通关到第10关开启"),this.autoPkBoss.selected=!1):this.autoPkBoss.selected?UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?(UserTips.ins().showTips("背包剩余空位不足，请先清理"),this.autoPkBoss.selected=!1):UserFb.ins().guanqiaID<UserFb.AUTO_GUANQIA?(UserTips.ins().showTips("|C:0xff0000&T:挑战至"+UserFb.AUTO_GUANQIA+"关开启"),this.autoPkBoss.selected=!1):UserFb.ins().guanqiaID>=GlobalConfig.InstanceBaseConfig.maxCheckPoint?(UserTips.ins().showCenterTips("当前已达最大关卡"),this.autoPkBoss.selected=!1):(this.GuanQiacleanEff(),PlayFun.ins().openAuto()):PlayFun.ins().closeAuto(),t.stopPropagation(),t.stopImmediatePropagation()},e.prototype.guanqiaChange=function(){this.maskImg.visible=UserFb.ins().guanqiaID<=10},e.prototype.onTaskTrace=function(t){var e=UserTask.ins().taskTrace;if(e&&0==e.state){var i=UserTask.ins().getAchieveConfById(e.id);switch(i.control){case GuideType.ChallengeBoss:case GuideType.AutoPk:if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return;UserFb.ins().currentEnergy<UserFb.ins().energy&&this.showTaskTips("能量未满无法挑战，请继续清怪。"),i.control==GuideType.AutoPk&&Hint.ins().postKillBoss(i);break;case GuideType.KillDeer:var s="正在完成清怪任务，还差|C:0xf8b141&T:"+(i.target-e.value)+"|个。";this.showTaskTips(s)}}},e.prototype.guanqiaBtnClick=function(t){return UserFb.ins().guanqiaID>=GlobalConfig.InstanceBaseConfig.maxCheckPoint?void UserTips.ins().showCenterTips("当前已达最大关卡"):void(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):UserFb.ins().currentEnergy>=UserFb.ins().energy&&(this.GuanQiacleanEff(),UserFb.ins().autoPk(),UserFb.ins().firstAutoGuilder=UserFb.ins().guanqiaID==UserFb.AUTO_GUANQIA-1))},e.prototype.showTaskTips=function(t){UserTips.ins().showTaskTips(t)},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.willBossPrompt:ViewManager.ins().open(BossWin,1);break;case this.btn_toolbar:this.hideBtn();break;case this.recharge1:var i=Recharge.ins().getRechargeData(0);i&&2==i.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win);break;case this.recharge2:Shop.openBuyGoldWin();break;case this.vipBtn0:ViewManager.ins().open(VipWin);break;case this.face:ViewManager.ins().open(SettingView),this.headRedPoint.visible&&(Setting.ins().setValue(ClientSet.headRed,1),this.updateHeadRedPoint());break;case this.expGroup:case this.mapName0:ViewManager.ins().open(EffectivenessTip,1)}},e.prototype.changeTaskTrace=function(){var t=UserTask.ins().taskTrace;if(t){var e=UserTask.ins().getAchieveConfById(t.id);if(!e)return void console.log("任务配置"+t.id+"不存在！");switch(79==e.type?this.taskTraceAwards.textFlow=TextFlowMaker.generateTextFlow("|C:0x40df38&T:"+e.desc+"|"):this.taskTraceAwards.text=""+e.desc,t.state){case 0:var i=e.target,s=t.value;79==e.type&&(s=0,i=1),36==e.type&&(s-=1,i-=1),this.taskTraceName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0xf3311e&T: ("+s+"/"+i+")|"),0==t.value&&GameGuider.stopTaskEffect(),GameGuider.startTaskEffect();break;case 1:this.taskTraceName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0x35e62d&T: (已完成)|"),GameGuider.stopTaskEffect(),GameGuider.startTaskEffect()}var n=egret.Tween.get(this.taskTraceAwards);n.to({x:this.taskTraceAwards.x+100,alpha:0},200).to({x:0},200).to({x:61,alpha:1},200);var o=egret.Tween.get(this.taskTraceName);o.to({x:this.taskTraceName.x+100,alpha:0},200).to({x:0},200).to({x:61,alpha:1},200)}else GameGuider.stopTaskEffect()},e.prototype.updateTaskState=function(){var t=UserTask.ins().taskTrace;t&&(1==t.state?this.taskAsseptMc.parent?this.taskEffTypes.indexOf(1)<0&&this.taskEffTypes.push(1):this.taskComMc.parent||this.addTaskEffectIndex(1):0==t.state&&0==t.value&&(this.taskComMc.parent?this.taskEffTypes.indexOf(0)<0&&this.taskEffTypes.push(0):this.taskAsseptMc.parent||this.addTaskEffectIndex(0)))},e.prototype.addTaskEffectIndex=function(t){var e=this;0==t?(this.taskTraceBtn.addChild(this.taskAsseptMc),this.taskAsseptMc.playFile(RES_DIR_EFF+"receive",1,function(){TimerManager.ins().doNext(function(){e.taskEffTypes.length&&e.addTaskEffectIndex(e.taskEffTypes.shift())},e)}),SoundUtil.ins().playEffect(SoundUtil.TASK),this.taskAsseptMc.y=-50):1==t&&(this.taskTraceBtn.addChild(this.taskComMc),this.taskComMc.playFile(RES_DIR_EFF+"complete",1,function(){TimerManager.ins().doNext(function(){e.taskEffTypes.length&&e.addTaskEffectIndex(e.taskEffTypes.shift())},e)}),this.taskComMc.y=-80)},e.prototype.upDataGuanQiaInfo=function(){this.expTxt.textFlow=TextFlowMaker.generateTextFlow("|C:0x35e62d&T:"+UserFb.ins().expEff+"|/小时"),this.mapName0.textFlow=TextFlowMaker.generateTextFlow("第|C:0x35e62d&T:"+UserFb.ins().guanqiaID+"|关"),this.upDataGuanqia()},e.prototype.upDataGuanqia=function(){var t=UserFb.ins().guanqiaID;t>=0&&GameMap.sceneInMain()?(this.upDataExpMcBall(UserFb.ins().currentEnergy,UserFb.ins().energy),UserFb.ins().energy&&UserFb.ins().currentEnergy>=UserFb.ins().energy?this.guanQicMc&&!this.guanQicMc.parent&&(this.guanQicMc.playFile(RES_DIR_EFF+"guankabtn",-1),this.guanqiaEff0.addChild(this.guanQicMc),this.guanqiaEff0.touchEnabled=this.guanQicMc.touchEnabled=!1):(UserFb.ins().energy>0&&this.lastEnergy!=UserFb.ins().currentEnergy&&-1!=this.lastEnergy&&this.playGuanQiaDoorMc(),DisplayUtils.removeFromParent(this.guanQicMc)),this.lastEnergy=UserFb.ins().currentEnergy):(DisplayUtils.removeFromParent(this.guanQicMc),this.lastEnergy=-1),t<UserFb.AUTO_GUANQIA?this.pkBossBtnGroup.visible=!1:this.pkBossBtnGroup.visible=!0
},e.prototype.removeGuanQiaEnergy=function(){DisplayUtils.removeFromParent(this.guanQicMc),UserFb.ins().currentEnergy=0},e.prototype.upDataExpMcBall=function(t,e){this.setGuanQiaBar(t,e)},e.prototype.upDataWillBoss=function(t){t?(this.willBossPrompt=this.willBossPrompt||new MovieClip,this.willBossPrompt.playFile(RES_DIR_EFF+"zaoyuBoss",-1),this.willBossPrompt.y=500,this.willBossPrompt.x=330,this.willBossPrompt.touchEnabled=!0,this.addTouchEvent(this.willBossPrompt,this.onTap),this.addChild(this.willBossPrompt)):this.willBossPrompt&&(DisplayUtils.removeFromParent(this.willBossPrompt),this.removeTouchEvent(this.willBossPrompt,this.onTap))},e.prototype.updateHeadRedPoint=function(){Actor.level>=30&&!Setting.ins().getValue(ClientSet.headRed)?this.headRedPoint.visible=!0:this.headRedPoint.visible=!1},e.prototype.updateLevelBar=function(t){this.expChange(t)},e.prototype.publicBossRelive=function(t,e){if(void 0===e&&(e=""),t||!e||e==this.reliveBossLab.name){var i=UserBoss.ins().checkBossIconShow(),s=t&&i&&GameMap.sceneInMain();PlayFun.ins().newBossRelive=this.newBossRelive.visible=s,this.reliveBossLab.name=t?e:"1",s&&(this.reliveBossLab.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor(""+e,"#35e62d")+"刷新了！"))}},e.prototype.sortRule=function(t,e){var i=GlobalConfig.PlayFunConfig[t.id],s=GlobalConfig.PlayFunConfig[e.id];return i.sort<s.sort?-1:1},e.prototype.sortBtnList=function(t){void 0===t&&(t=null);var e=-1;if(t){var i=GlobalConfig.PlayFunConfig[t.id];if(!i)return;e=i.pos}var s={};-1==e?(s[0]=[],s[1]=[[],[],[]],s[2]=[],s[3]=[]):1!=e?s[e]=[]:s[e]=[[],[],[]];var n=GlobalConfig.PlayFunConfig,o=this.ruleIdList;for(var a in n){var r=o[a];if(r.isShow){var i=n[a],h=i.pos;(-1==e||e==h)&&(1==h?s[h][i.layer-1].push(r):s[h].push(r))}}for(var l in s)if("1"==l)for(var c in s[l])s[l][c].sort(this.sortRule);else s[l].sort(this.sortRule);var u,p,d=this.width-156,g=0,f=0,v=0,y=0;if(-1==e||1==e){p=s[1];for(var m=0;m<p.length;m++){m>y&&(y=m,f=0);for(var l=0;l<p[m].length;l++)u=p[m][l].tar,u.parent.setChildIndex(u,0),u.x=d-80*f,u.y=g+80*y,f+=1,f>5&&(y+=1,f=0)}}if(-1==e||2==e){f=0,v=0,p=s[2];for(var l=0;l<p.length;l++){var r=p[l];u=r.tar,u.parent.setChildIndex(u,v),v+=1,r.getConfig().noMove||(u.left=10,u.top=502-76*f,f++)}}if(-1==e||3==e){f=0,v=0,p=s[3];for(var l=0;l<p.length;l++){var r=p[l];u=r.tar,u.parent.setChildIndex(u,v),v+=1,r.getConfig().noMove||(u.right=0,u.bottom=300+65*f,f++)}}if(-1==e||0==e){v=0,p=s[0];for(var l=0;l<p.length;l++)u=p[l].tar,u.parent.setChildIndex(u,v),v+=1}},e.prototype.addExpFlyMc=function(t){var e=this;if(GameMap.fbType!=UserFb.FB_TYPE_EXP){if(!UserFb.ins().checkGuanqiaIconShow())return void UserFb.ins().postAddEnergy();var i=new eui.Image;i.source="point",i.anchorOffsetX=20,i.anchorOffsetY=20;var s=ViewManager.gamescene.map,n=this.localToGlobal();s.globalToLocal(n.x,n.y,n),i.x=t.x-n.x,i.y=t.y-n.y,this.addChild(i);var o=this.groupGuanqia.x+60,a=this.groupGuanqia.y+60,r=egret.Tween.get(i);r.to({x:o,y:a,alpha:.5},600).call(function(){UserFb.ins().postAddEnergy(),e.removeChild(i),egret.Tween.removeTweens(i)},this);var h=egret.Tween.get(i,{loop:!0});h.to({rotation:i.rotation+360},800)}},e.prototype.playGuanQiaDoorMc=function(){this.eyesMc||(this.eyesMc=new MovieClip),this.eyesMc.parent||this.guanqiaEff1.addChild(this.eyesMc),this.eyesMc.playFile(RES_DIR_EFF+"guankaeye",1)},e.prototype.warmWord=function(t){var e=this;t?GameMap.sceneInMain()&&(this.bossWarmMc=this.bossWarmMc||new MovieClip,this.bossWarmMc.touchEnabled=!1,this.mcGroup.addChildAt(this.bossWarmMc,0),this.mcGroup.visible=!0,this.aniShadow(),this.bossWarmMc.playFile(RES_DIR_EFF+"bosscaution",2,function(){e.removeShadow()}),this.removeGuanQiaEnergy()):(this.mcGroup.visible=!1,egret.Tween.removeTweens(this.alphaGroup),this.bossWarmMc&&(DisplayUtils.removeFromParent(this.bossWarmMc),this.bossWarmMc=null))},e.prototype.aniShadow=function(){var t=this;this.warmImage.visible=!0;var e=egret.Tween.get(this.warmImage);this.warmImage.alpha=.23,e.to({alpha:1},300).wait(2200).to({alpha:0},350).call(function(){egret.Tween.removeTweens(t.warmImage)}),this.levelNum.text=UserFb.ins().guanqiaID+"",this.alphaGroup.alpha=.2,egret.Tween.removeTweens(this.alphaGroup),egret.Tween.get(this.alphaGroup,{loop:!0}).to({alpha:1},625).to({alpha:.2},625),TimerManager.ins().doTimer(3500,1,this.removeShadow,this)},e.prototype.removeShadow=function(){this.warmImage.visible=!1,this.mcGroup.visible=!1,egret.Tween.removeTweens(this.alphaGroup),TimerManager.ins().remove(this.removeShadow,this)},e.prototype.upDataVipBtnRedPoint=function(){this.redPointVip0.visible=UserVip.ins().getVipState()},e.prototype.setDieGuide=function(t){switch(t){case DieGuide.RECHARGE:this.preRecharge=this.recharge.visible=!0,this.cz.source="swyd_firstrecharge_png",this.cz.touchEnabled=this.recharge.touchEnabled=!1;break;case DieGuide.VIP:this.preVip=this.vip.visible=!0,this.v.source="swyd_vip_png",this.v.touchEnabled=this.vip.touchEnabled=!1}},e.prototype.setGuanQiaBar=function(t,e){var i=t,s=e;i>=s&&(i=s),this.guanqiaBar.value=i,this.guanqiaBar.maximum=s,this.guanqiaBar.labelFunction=function(){return""}},e.prototype.GuanQiaEffLogic=function(){var t=this;if(this.guanqiaBtn&&0==UserFb.ins().showAutoPk){if(UserFb.ins().showAutoPk=1,!this.arrow){this.arrow=new GuideArrow,this.arrow.touchEnabled=!1,this.arrow.lab.text="点击挑战关卡",this.addChild(this.arrow);var e=this.guanqiaBtn.localToGlobal();this.globalToLocal(e.x,e.y,e),this.arrow.x=e.x,this.arrow.y=e.y+this.guanqiaBtn.height/2,this.eff||(this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"guideff",-1),this.groupGuanqia.addChild(this.eff),this.eff.x=this.guanqiaBtn.x+this.guanqiaBtn.width/2,this.eff.y=this.guanqiaBtn.y+this.guanqiaBtn.height/2),egret.Tween.get(this.arrow,{loop:!0}).to({x:this.arrow.x+40},1e3).to({x:this.arrow.x},1e3),egret.Tween.get(this,{loop:!1}).wait(5e3).call(function(){UserFb.ins().showAutoPk=-1,DisplayUtils.removeFromParent(t.eff),DisplayUtils.removeFromParent(t.arrow),t.arrow&&egret.Tween.removeTweens(t.arrow),t.arrow=null,t.eff=null})}}else if(this.pkBossBtnGroup&&0==UserFb.ins().showAutoPk2&&(UserFb.ins().showAutoPk2=1,!this.arrow)){this.arrow=new GuideArrow,this.arrow.touchEnabled=!1,this.arrow.lab.text="点击自动挑战关卡",this.addChild(this.arrow);var e=this.pkBossBtnGroup.localToGlobal();this.globalToLocal(e.x,e.y,e),this.arrow.x=e.x,this.arrow.y=e.y+this.pkBossBtnGroup.height/2,this.eff||(this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"guideff",-1),this.groupGuanqia.addChild(this.eff),this.eff.x=this.pkBossBtnGroup.x+this.pkBossBtnGroup.width/2,this.eff.y=this.pkBossBtnGroup.y+this.pkBossBtnGroup.height/2),egret.Tween.get(this.arrow,{loop:!0}).to({x:this.arrow.x+40},1e3).to({x:this.arrow.x},1e3),egret.Tween.get(this,{loop:!1}).wait(5e3).call(function(){UserFb.ins().showAutoPk2=-1,DisplayUtils.removeFromParent(t.eff),DisplayUtils.removeFromParent(t.arrow),t.arrow&&egret.Tween.removeTweens(t.arrow),t.arrow=null,t.eff=null})}},e.prototype.GuanQiacleanEff=function(){UserFb.ins().showAutoPk=-1,UserFb.ins().showAutoPk2=-1,DisplayUtils.removeFromParent(this.eff),DisplayUtils.removeFromParent(this.arrow),this.arrow&&egret.Tween.removeTweens(this.arrow),this.arrow=null,this.eff=null},e.prototype.updateFlower=function(){return this._flowerShowItem?(this._flowerShowItem.parent||this.flower.addChild(this._flowerShowItem),void this._flowerShowItem.showEffect()):(this._flowerShowItem=new FlowerShowItem,void this.flower.addChild(this._flowerShowItem))},e.prototype.removeFlowerItem=function(){DisplayUtils.removeFromParent(this._flowerShowItem)},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__decorate([callLater],PlayFunView.prototype,"initData",null),__reflect(PlayFunView.prototype,"PlayFunView"),ViewManager.ins().reg(PlayFunView,LayerManager.Main_View);var ActivityExIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,UserBag.ins().postItemAdd,UserBag.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.HFACTIVITY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(!s.pageStyle&&s.timeType==ActivityDataFactory.TimeType_Total&&s.isOpenActivity())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(!i.pageStyle&&i.timeType==ActivityDataFactory.TimeType_Total&&i.isOpenActivity()&&i.canReward()&&i.specialState())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ActivityExWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ActivityExIconRule.prototype,"ActivityExIconRule");var ActivityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s.updateMessage=[Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return GameServer.serverOpenDay<7?e&&(e.icon="zjmkaifu"):e&&(e.icon="zjmhuodong"),e},e.prototype.checkShowIcon=function(){if(GameServer.serverOpenDay<7?this.tar&&(this.tar.icon="zjmkaifu"):this.tar&&(this.tar.icon="zjmhuodong"),!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(!s.pageStyle&&s.timeType!=ActivityDataFactory.TimeType_Total&&s.isOpenActivity()&&!s.getHide())return!0}t=PActivity.ins().activityData;for(var i in t){var s=t[i];if(s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(!i.pageStyle&&i.timeType!=ActivityDataFactory.TimeType_Total&&i.isOpenActivity()&&i.canReward())return 1}t=PActivity.ins().activityData;for(var e in t){var i=t[e];if(i.isOpenActivity()&&i.canReward())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ActivityWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ActivityIconRule.prototype,"ActivityIconRule");var AuctionIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[UserZs.ins().postZsData],s.updateMessage=[Auction.ins().postListData,Auction.ins().postAuctionResult,Auction.ins().postBuyResult,Auction.ins().postUpdate],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return Auction.ins().isAuctionOpen()?!0:!1},e.prototype.checkShowRedPoint=function(){return Auction.ins().checkRed()&&this.firstTap?1:0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):"actIconCircle"},e.prototype.tapExecute=function(){ViewManager.ins().open(AuctionWin),Auction.ins().sendGetList(0),this.firstTap&&(Auction.ins().checkRed()&&(this.firstTap=!1),this.update())},e}(RuleIconBase);__reflect(AuctionIconRule.prototype,"AuctionIconRule");var BattleIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._time=0,s.showMessage=[Actor.ins().postLevelChange,BattleCC.ins().postOpenInfo],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);if(this._timeTxt=new eui.Label,this._timeTxt.x=0,this._timeTxt.y=70,this._timeTxt.width=70,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,this._timeTxt.textColor=65280,e.addChild(this._timeTxt),BattleCC.ins().isOpen)this._timeTxt.text="进行中";else{var i=BattleCC.ins().getOpenLeftTime();i>0&&(this._time=i,this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4),TimerManager.ins().isExists(this.setRepeat,this)||TimerManager.ins().doTimer(1e3,0,this.setRepeat,this))}return e},e.prototype.checkShowIcon=function(){if(TimerManager.ins().removeAll(this),!OpenSystem.ins().checkSysOpen(SystemType.BATTLE))return!1;if(BattleCC.ins().isOpen)return!0;var t=BattleCC.ins().getOpenLeftTime();return t>0?(this._time=t,TimerManager.ins().isExists(this.setRepeat,this)||TimerManager.ins().doTimer(1e3,0,this.setRepeat,this),!0):!1},e.prototype.setRepeat=function(){this._time--,this._time>0?this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4):(this._timeTxt.text="进行中",TimerManager.ins().removeAll(this))},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"actIconCircle"},e.prototype.tapExecute=function(){ViewManager.ins().open(FbWin,3),this.update()},e}(RuleIconBase);__reflect(BattleIconRule.prototype,"BattleIconRule");var BBSIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.appid==PlatFormID.QQ_BROWSER},e.prototype.tapExecute=function(){window.openTopicCircle()},e}(RuleIconBase);__reflect(BBSIconRule.prototype,"BBSIconRule");var BossIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace,ZsBoss.ins().postBossOpen,GameLogic.ins().postEnterMap],s.updateMessage=[UserBoss.ins().postWorldBoss,UserBoss.ins().postWorldNotice,ZsBoss.ins().postBossList,UserBoss.ins().postBossData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return UserBoss.ins().checkBossIconShow()},e.prototype.checkShowRedPoint=function(){return PlayFun.ins().newBossRelive||UserFb.isCanChallenge()||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_QMBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_WORLDBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_HOMEBOSS)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_SHENYU)||UserBoss.ins().checkWorldBossRedPoint(UserBoss.BOSS_SUBTYPE_DARKBOSS)?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BossWin),UserBoss.ins().postBossData(!1)},e}(RuleIconBase);BossIconRule.OpenTaskIndex=41,__reflect(BossIconRule.prototype,"BossIconRule");var BoxIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[Box.ins().postUpdateData,Actor.ins().postLevelChange,Box.ins().postUpdateFreeBox],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,BoxModel.ins().checkCanTake()?this.alertText.text="可领取":(this.startTime(),this.runTime()),e},e.prototype.startTime=function(){TimerManager.ins().isExists(this.runTime,this)||TimerManager.ins().doTimer(1e3,0,this.runTime,this)},e.prototype.removeTime=function(){TimerManager.ins().remove(this.runTime,this)},e.prototype.runTime=function(){var t=BoxModel.ins().getMinBoxTime();t==Number.MAX_VALUE?(this.alertText.text="",this.removeTime()):0>=t?(this.alertText.text="可领取",this.removeTime(),this.update()):this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12)},e.prototype.checkShowIcon=function(){return!1},e.prototype.checkShowRedPoint=function(){var t=BoxModel.ins().checkRedPointShow()||BookRedPoint.ins().redpoint;return t?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BoxBgWin)},e.prototype.getEffName=function(t){},e}(RuleIconBase);__reflect(BoxIconRule.prototype,"BoxIconRule");var CDkeyIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange],s.updateMessage=[UserFuLi.ins().postMoneyInfoChange,Notice.ins().postGameNotice,DailyCheckIn.ins().postCheckInData,Activity.ins().postSevendayIsAwards,Recharge.ins().postFranchiseInfo,Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FULI)},e.prototype.checkShowRedPoint=function(){return DailyCheckIn.ins().showRedPoint()||Activity.ins().getSevenDayStast()||Recharge.ins().franchise&&Recharge.ins().franchiseget||Activity.ins().checkNoticeRed()?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(FuliWin),this.update()},e}(RuleIconBase);__reflect(CDkeyIconRule.prototype,"CDkeyIconRule");var CelebrationIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.CELEBRATION))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.CELEBRATION&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.CELEBRATION&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(CelebrationWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(CelebrationIconRule.prototype,"CelebrationIconRule");var ChatMessageIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ChatWin)},e}(RuleIconBase);__reflect(ChatMessageIconRule.prototype,"ChatMessageIconRule");var ChristmasIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.CHRISTMAS))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.CHRISTMAS&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.CHRISTMAS&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ChristmasDayWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(ChristmasIconRule.prototype,"ChristmasIconRule");var CityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return GameMap.sceneInMain()&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){if(!GameServer.serverOpenDay)return void UserTips.ins().showTips("|C:0xff0000&T:暂未开放，开服第二天开启");if(OpenSystem.ins().checkSysOpen(SystemType.CITY)&&GameMap.sceneInMain())return Encounter.ins().isEncounter()?void UserTips.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|"):void(CityCC.ins().enterCD<1?CityCC.ins().sendEnter():UserTips.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城"))},e.prototype.getEffName=function(t){},e}(RuleIconBase);__reflect(CityIconRule.prototype,"CityIconRule");var CityMonsterIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._shap=new egret.Shape,s._radius=0,s.showMessage=[Actor.ins().postLevelChange,GameApp.ins().postZeroInit],s.updateMessage=[CityCC.ins().postBossInfo,CityCC.ins().postCityBossId],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.monHead=e.monHead,this.process=e.process,this._radius=e.width>>1,this._shap.x=this._radius,this._shap.y=this._radius,this._shap.rotation=-90,e.addChild(this._shap),this.process.mask=this._shap,e},e.prototype.checkShowIcon=function(){return this.updateIcon(),GameServer.serverOpenDay&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)},e.prototype.checkShowRedPoint=function(){return this.updateIcon(),CityCC.ins().cityBossId},e.prototype.tapExecute=function(){ViewManager.ins().open(CityBossView)},e.prototype.getEffName=function(t){},e.prototype.updateIcon=function(){var t=CityCC.ins().cityBossId;if(0==t){var e=CityCC.ins().getMaxKillNumBoss(),i=e[0],s=e[1];t=i,this.curAngle=MathUtils.toInteger(360*s)}else this.curAngle=360;GlobalConfig.MonstersConfig[t]&&this.monHead&&(this.monHead.source="monhead"+GlobalConfig.MonstersConfig[t].head+"_png")},Object.defineProperty(e.prototype,"curAngle",{set:function(t){DisplayUtils.drawCir(this._shap,this._radius,t)},enumerable:!0,configurable:!0}),e}(RuleIconBase);__reflect(CityMonsterIconRule.prototype,"CityMonsterIconRule");var CollectionIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.appid==PlatFormID.QQ_BROWSER||LocationProperty.appid==PlatFormID.XIN_LANG},e.prototype.tapExecute=function(){window.sendToDesktop()},e}(RuleIconBase);__reflect(CollectionIconRule.prototype,"CollectionIconRule");var DesktopIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[PfActivity.ins().postGameDesktop],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FOCUS)&&!!PfActivity.ins().isShowGameDesktop},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){PfActivity.ins().saveGameDesktop()},e}(RuleIconBase);__reflect(DesktopIconRule.prototype,"DesktopIconRule");var DoubleElevenIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postSpecials],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLEELEVEN))return!1;var t=Activity.ins().doubleElevenData;for(var e in t)if(t[e].isOpenActivity())return!0;return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().doubleElevenData;for(var e in t){var i=t[e];if(i.canReward())if(-1!=Activity.ins().doubleElevenSpecialIDs.indexOf(i.id)){if(i.isSpecialOpen())return 1}else if(i.isOpenActivity())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(DoubleEleventWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(DoubleElevenIconRule.prototype,"DoubleElevenIconRule");var DoubleTwelveActivityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,Activity.ins().postActivityIsGetAwards],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLE_TWELVE))return!1;var t=Activity.ins().doubleTwelveData;for(var e in t)if(t[e].isOpenActivity())return!0;return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().doubleTwelveData;for(var e in t)if(t[e].isOpenActivity()&&9==t[e].type)for(var i=0;3>i;i++)if(Activity.ins().isGetRollReward(t[e].id,i))return 1;return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(DoubleTwelveWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(DoubleTwelveActivityIconRule.prototype,"DoubleTwelveActivityIconRule");var DoubleTwelveRechargeIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.time=0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,e},e.prototype.runTime=function(){var t=this.time;this.time-=1,t>0?this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12):(this.alertText.text="",TimerManager.ins().remove(this.runTime,this),this.updateShow())},e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.DOUBLE_TWELVE_RECHARGE))return!1;var t=Activity.ins().doubleTwelveRechargeData;for(var e in t)if(t[e].isOpenActivity()){var i=t[Activity.ins().doubleTwelveRechargeIDAry[0]];return i&&(TimerManager.ins().remove(this.runTime,this),this.time=i.getLeftTime(),TimerManager.ins().doTimer(1e3,0,this.runTime,this)),!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().doubleTwelveRechargeData;for(var e in t)if(t[e].canReward())return 1;return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(DoubleTwelveRechargeWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(DoubleTwelveRechargeIconRule.prototype,"DoubleTwelveRechargeIconRule");var ExpGoldIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=s.updateMessage=[UserVip.ins().postUpdateVipAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return 0==(UserVip.ins().state>>2&1)},e.prototype.checkShowRedPoint=function(){var t=0==(UserVip.ins().state>>2&1)&&UserVip.ins().lv>=3;return t?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(Vip3Win),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ExpGoldIconRule.prototype,"ExpGoldIconRule");var FbBtnIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,UserTask.ins().postUpdteTaskTrace],s.updateMessage=[FbRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FB)&&!UserFb.ins().pkGqboss},e.prototype.checkShowRedPoint=function(){return FbRedPoint.ins().redpoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(FbWin)},e}(RuleIconBase);__reflect(FbBtnIconRule.prototype,"FbBtnIconRule");var FengceIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FENGCE)},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(FengceActivityWin)},e}(RuleIconBase);__reflect(FengceIconRule.prototype,"FengceIconRule");var FirstRechargeIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx],s.updateMessage=[Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx],s}return __extends(e,t),e.prototype.createTar=function(){t.prototype.createTar.call(this);var e=Recharge.ins().getRechargeData(0);return 2!=e.num?this.tar.icon="zjmshouchong":e.isAwards?this.tar.icon="zjmlibao":this.tar.icon="zjmshouchong2",this.tar},e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE))return!1;if(Recharge.ins().getCurDailyRechargeIsAllGet())return!1;if(this.tar){var t=Recharge.ins().getRechargeData(0);2!=t.num?this.tar.icon="zjmshouchong":t.isAwards?this.tar.icon="zjmlibao":this.tar.icon="zjmshouchong2"}return!0},e.prototype.checkShowRedPoint=function(){var t=0,e=Recharge.ins().getRechargeData(0);if(1==e.num)t=e.num;else if(2==e.num){var i=Recharge.ins().getCurRechargeConfig();for(var s in i){var n=e.isAwards>>i[s].index&1;if(0==n&&e.curDayPay>=i[s].pay)return 1}}return t},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){var t=Recharge.ins().getRechargeData(0);2==t.num?ViewManager.ins().open(Recharge2Win):ViewManager.ins().open(Recharge1Win)},e}(RuleIconBase);__reflect(FirstRechargeIconRule.prototype,"FirstRechargeIconRule");var FocusIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,PfActivity.ins().postGuanZhu],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FOCUS)&&0==PfActivity.ins().focusState},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.tapExecute=function(){ViewManager.ins().open(FocusWin)},e}(RuleIconBase);__reflect(FocusIconRule.prototype,"FocusIconRule");var FriendsIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!1,s.showMessage=[Actor.ins().postLevelChange],s.updateMessage=[Friends.ins().postFriendChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return Actor.level>=70},e.prototype.checkShowRedPoint=function(){var t=0;if(Object.keys(Friends.ins().newMsg).length>0)for(var e in Friends.ins().newMsg){var i=Friends.ins().newMsg[e];if(1==i){t++;break}}return Friends.ins().appList.length>0&&t++,t},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){Actor.level<GlobalConfig.FriendLimit.sysLv?UserTips.ins().showTips(GlobalConfig.FriendLimit.sysLv+"级开启好友功能"):ViewManager.ins().open(FriendBgWin)},e}(RuleIconBase);__reflect(FriendsIconRule.prototype,"FriendsIconRule");var FuncNoticeIconRule=function(t){function e(e){var i=t.call(this,e)||this;return i.funcNoticeLastLv=0,i.showMessage=[UserFb.ins().postGuanKaIdChange],i}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=UserFb.ins().guanqiaID,e=FuncNoticeWin.getFuncNoticeConfigById(t);if(!e)return!1;var i=e.openLv-t<=10;return i&&(e.openLv-t==0&&(t-this.funcNoticeLastLv==1&&UserTips.ins().showFuncNotice(t),e=FuncNoticeWin.getFuncNoticeConfigById(t+1),(!e||e.openLv-t>10)&&(i=!1)),i&&this.tar&&this.updateButton()),this.funcNoticeLastLv=t,i},e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.updateButton(),e},e.prototype.updateButton=function(){var t=UserFb.ins().guanqiaID,e=FuncNoticeWin.getFuncNoticeConfigById(t);
this.tar.iconDisplay.source="yg_"+e.index+"0",this.tar.txt.text=e.openLv+"关开启",2==e.index?(this.tar.iconDisplay.x=15,this.tar.iconDisplay.y=0):(this.tar.iconDisplay.x=3,this.tar.iconDisplay.y=-30)},e.prototype.tapExecute=function(){var t=UserFb.ins().guanqiaID,e=FuncNoticeWin.getFuncNoticeConfigById(t);e.openLv-t==0&&(t+=1),UserTips.ins().showFuncNotice(t)},e}(RuleIconBase);__reflect(FuncNoticeIconRule.prototype,"FuncNoticeIconRule");var FunctionOpenIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,GameApp.ins().postZeroInit],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70;var i=ActivityForeshowModel.ins().getForeshow();return i&&(this.dataCfg=i,GameServer.serverOpenDay>=i.close?this.alertText.text="":(this.time=this.getLeftTime(),this.runTime(),TimerManager.ins().doTimer(1e3,0,this.runTime,this)),e.icon=i.icon),e},e.prototype.getLeftTime=function(){var t=0;if(GameServer.serverOpenDay<this.dataCfg.close){var e=new Date(GameServer.serverTime),i=this.dataCfg.close-GameServer.serverOpenDay;e.setDate(e.getDate()+i),e.setHours(0,0,0,0),t=Math.floor((e.getTime()-GameServer.serverTime)/1e3)}return t},e.prototype.runTime=function(){var t=this.time;this.time-=1,t>0?this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12):(this.alertText.text="",TimerManager.ins().remove(this.runTime,this),this.updateShow())},e.prototype.checkShowIcon=function(){var t=!1,e=ActivityForeshowModel.ins().getForeshow();return e&&(t=!0),t},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ActivityForeshowWin)},e}(RuleIconBase);__reflect(FunctionOpenIconRule.prototype,"FunctionOpenIconRule");var GodWeaponIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserZs.ins().postZsLv,Actor.ins().postLevelChange,GameApp.ins().postZeroInit],s.updateMessage=[GodWeaponRedPoint.ins().postGodWeapon],s}return __extends(e,t),e.prototype.checkShowRedPoint=function(){var t=GodWeaponRedPoint.ins().godWeaponRed?1:0;return t},e.prototype.checkShowIcon=function(){return Actor.level>=GlobalConfig.GodWeaponBaseConfig.noticeOpenLv&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay?!0:!1},e.prototype.tapExecute=function(){ViewManager.ins().open(GodWeaponWin)},e}(RuleIconBase);__reflect(GodWeaponIconRule.prototype,"GodWeaponIconRule");var GuangqiaIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.canChallen=!1,s.showMessage=[GameLogic.ins().postEnterMap,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace,UserFb.ins().postAutoPk,UserFb.ins().postAutoPk2],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return UserFb.ins().checkGuanqiaIconShow()&&GameMap.sceneInMain()},e.prototype.upDateGuanqiaWroldReward=function(){var t=UserFb.ins().getWorldGuanQia();return UserFb.ins().isReceiveBox(t)?1:0},e.prototype.getEffName=function(t){var e="";return e},e.prototype.tapExecute=function(){},e}(RuleIconBase);__reflect(GuangqiaIconRule.prototype,"GuangqiaIconRule");var GuildIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange],s.updateMessage=[GuildRedPoint.ins().postHanghui],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return Actor.level>=GlobalConfig.GuildConfig.openLevel},e.prototype.checkShowRedPoint=function(){return GuildRedPoint.ins().hanghui},e.prototype.tapExecute=function(){Actor.level>=GlobalConfig.GuildConfig.openLevel?void 0==Guild.ins().guildID||0==Guild.ins().guildID?ViewManager.ins().open(GuildApplyWin):ViewManager.ins().open(GuildMap):UserTips.ins().showTips(GlobalConfig.GuildConfig.openLevel+"级开启")},e}(RuleIconBase);__reflect(GuildIconRule.prototype,"GuildIconRule");var GuildWarIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GuildWar.ins().postGuildWarStarInfo],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return 1==GuildWar.ins().getModel().getIsShowGuildWarBtn()},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){return void 0==Guild.ins().guildID||0==Guild.ins().guildID?void UserTips.ins().showTips("|C:0xf3311e&T:加入公会后才能参与龙城争霸活动|"):(GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(GuildMap),void ViewManager.ins().open(GuildWarMainWin))},e}(RuleIconBase);__reflect(GuildWarIconRule.prototype,"GuildWarIconRule");var GuildWarRedBagIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[GuildRedPoint.ins().postRedBag],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(RedBagWin)},e}(RuleIconBase);__reflect(GuildWarRedBagIconRule.prototype,"GuildWarRedBagIconRule");var GuoQingIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=new Date(GameServer.serverTime),e=t.getFullYear(),i=t.getMonth()+1,s=t.getDate();return 2017==e&&(9==i&&30==s||10==i&&9>s)},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"actIconCircle"},e.prototype.tapExecute=function(){ViewManager.ins().open(GuoActivityWin)},e}(RuleIconBase);__reflect(GuoQingIconRule.prototype,"GuoQingIconRule");var HappySevenDayIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s._activityID=0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.HAPPYSEVENDAY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.HAPPYSEVENDAY&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.HAPPYSEVENDAY&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(HappySevenDayWin,this._activityID),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(HappySevenDayIconRule.prototype,"HappySevenDayIconRule");var HejiIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;s.showMessage=[UserTask.ins().postUpdteTaskTrace],s.playPunView=ViewManager.ins().getView(PlayFunView);var n=SubRoles.ins().getSubRoleByIndex(0);s.guangquan=i.guangquan,s.questNumber=i.questNumber,s.skillName=i.skillName,s.Img=i.Img,s.bgimg=i.bgimg,s.imggroup=i.imggroup,s.eff=i.eff,s.skillName.source="8000"+n.job+"_png",s.questNumber.text="0",s.Img.source="7"+n.job+"000_png",s.bgimg.source="7"+n.job+"000b_png",s.mc=new MovieClip,s.eff.addChild(s.mc),s.prossY=0;var o=s.Img.localToGlobal();s.imggroup.globalToLocal(o.x,o.y,o),s.masksp=new egret.Sprite;var a=new egret.Shape;a.graphics.beginFill(16777215),a.graphics.drawRect(o.x,o.y,s.Img.width,s.Img.height),a.graphics.endFill(),s.prossY=o.y+s.Img.height,s.masksp.y=s.prossY,s.masksp.addChild(a),s.imggroup.addChild(s.masksp),s.Img.mask=s.masksp;var r=s.updatekStep();return s.updatePross(r),s}return __extends(e,t),e.prototype.checkShowIcon=function(){return UserTask.ins().taskTrace?UserFb.ins().pkGqboss?!1:UserTask.ins().taskTrace.id>=TargetWin.TASKID?(this.mc.parent&&DisplayUtils.removeFromParent(this.mc),!1):!0:!1},e.prototype.updatekStep=function(t){if(!UserTask.ins().taskTrace)return 0;if(UserTask.ins().taskTrace.id>=TargetWin.TASKID)return 0;var e=function(e){if(UserTask.ins().taskTrace.id==GlobalConfig.AchievementTaskConfig[e].taskId){var s=GlobalConfig.AchievementTaskConfig[e].index,n=s;t&&(n=s+1),i.questNumber.text=TargetWin.TASKID%100-n+1+"";var o=i;return i.showEff(function(){o.updatePross(s)}),t?{value:s>0?s:0}:{value:1>=s?0:s}}},i=this;for(var s in GlobalConfig.AchievementTaskConfig){var n=e(s);if("object"==typeof n)return n.value}return 0},e.prototype.showEff=function(t){var e=this.playPunView.taskTraceName,i=e.localToGlobal();this.playPunView.globalToLocal(i.x,i.y,i),this.jumpmc||(this.jumpmc=new MovieClip,this.jumpmc.playFile(RES_DIR_EFF+"bally2",-1)),this.jumpmc.parent||this.playPunView.addChild(this.jumpmc),this.jumpmc.x=i.x+this.playPunView.taskTraceBtn.width/2,this.jumpmc.y=i.y,i=this.playPunView.hejiguide.localToGlobal(),this.playPunView.globalToLocal(i.x,i.y,i);var s=this;egret.Tween.get(this.jumpmc).to({x:i.x+s.playPunView.hejiguide.width/2,y:i.y+s.playPunView.hejiguide.height/2},600).call(function(){s.mc.parent||s.eff.addChild(s.mc),s.mc.playFile(RES_DIR_EFF+"guidecircle",1,function(){DisplayUtils.removeFromParent(s.mc)}),egret.Tween.removeTweens(s.jumpmc),DisplayUtils.removeFromParent(s.jumpmc),t&&"function"==typeof t&&t()})},e.prototype.updatePross=function(t){if(this.masksp){var e=t,i=TargetWin.TASKID%100,s=e/i;s=s>=1?1:s,this.masksp.y=this.prossY-Math.abs(this.prossY)*s}},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(TargetWin,TargetWin.HEJI),Artifact.ins().showGuide=-2e3},e.prototype.getEffName=function(t){},e}(RuleIconBase);__reflect(HejiIconRule.prototype,"HejiIconRule");var KaiMenHongIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.KAIMENHONG))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.KAIMENHONG&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.KAIMENHONG&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(KaiMenWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(KaiMenHongIconRule.prototype,"KaiMenHongIconRule");var KFArenaRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._time=0,s.showMessage=[UserZs.ins().postZsData,KfArenaSys.ins().postMacthState,KfArenaSys.ins().postOpenKfArena],s.updateMessage=[KfArenaRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.x=0,this._timeTxt.y=70,this._timeTxt.width=70,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,this._timeTxt.textColor=65280,e.addChild(this._timeTxt),this.setState(),e},e.prototype.setRepeat=function(){this._time--,this._time>0?this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4):(KfArenaSys.ins().isStartIng=1,1==KfArenaSys.ins().macthState?this._timeTxt.text="匹配中":this._timeTxt.text="进行中",TimerManager.ins().removeAll(this))},e.prototype.checkShowIcon=function(){var t=KfArenaSys.ins().isOpen();return this.setState(),t},e.prototype.setState=function(){var t=KfArenaSys.ins().isOpen();if(t&&this.tar)if(1==KfArenaSys.ins().macthState)this._timeTxt.text="匹配中";else if(1==KfArenaSys.ins().isStartIng)this._timeTxt.text="进行中";else{var e=KfArenaSys.ins().getOpenLeftTime();e>0&&(this._time=e,this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4),TimerManager.ins().isExists(this.setRepeat,this)||TimerManager.ins().doTimer(1e3,0,this.setRepeat,this))}},e.prototype.checkShowRedPoint=function(){return KfArenaRedPoint.ins().redpoint},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"actIconCircle"},e.prototype.tapExecute=function(){ViewManager.ins().open(KfArenaWin,1)},e}(RuleIconBase);__reflect(KFArenaRule.prototype,"KFArenaRule");var KFIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserZs.ins().postZsData],s.updateMessage=[KFBattleRedPoint.ins().postRedPoint,DevildomRedPoint.ins().postRedPoint,KfArenaRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=KFBossSys.ins().isOpen();return t},e.prototype.checkShowRedPoint=function(){return KFBattleRedPoint.ins().redPoint||DevildomRedPoint.ins().redPoint||KfArenaRedPoint.ins().redpoint},e.prototype.tapExecute=function(){ViewManager.ins().open(KFBattleWin)},e}(RuleIconBase);__reflect(KFIconRule.prototype,"KFIconRule");var LabaBossIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;if(OpenSystem.ins().checkSysOpen(SystemType.LABA)){if(s.activityData=Activity.ins().checkLabaBossData(),!s.activityData)return s;s.actId=s.activityData.id}return s.showMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,this.activityData.isOpenActivity()&&!this.activityData.IsEnd()&&(TimerManager.ins().isExists(this.runTime,this)||TimerManager.ins().doTimer(1e3,0,this.runTime,this),TimerManager.ins().isExists(this.updateActivity,this)||TimerManager.ins().doTimer(3e4,0,this.updateActivity,this)),e},e.prototype.updateActivity=function(){this.activityData&&Activity.ins().sendChangePage(this.activityData.id)},e.prototype.runTime=function(){if(this.actId){if(this.activityData=Activity.ins().getActivityDataById(this.actId),!this.activityData)return TimerManager.ins().remove(this.runTime,this),void TimerManager.ins().remove(this.updateActivity,this);if(this.activityData.IsEnd())return this.alertText.text="今天刷新完",TimerManager.ins().remove(this.runTime,this),void TimerManager.ins().remove(this.updateActivity,this);var t=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND),e=this.activityData.getEndTimer();if(t>=e)return void(this.alertText.text="已结束");var i=this.activityData.getStartTimer();if(this.activityData.isGoIn)this.alertText.text="已刷新";else{var s=i-t;s>0?this.alertText.text=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_12):this.alertText.text="刷新中"}}},e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.LABA)&&this.activityData?this.activityData.IsEnd()?!1:this.activityData.go2BossFb()?!0:!1:!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){return this.activityData?this.activityData.IsEnd()?void UserTips.ins().showTips("已经全部消灭，请期待下次！"):void(this.activityData.go2BossFb()?Activity.ins().sendReward(this.activityData.id,this.activityData.index):UserTips.ins().showTips("未到刷新时间")):void 0},e}(RuleIconBase);__reflect(LabaBossIconRule.prototype,"LabaBossIconRule");var LabaIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LABA))return!1;var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.LABA&&i.isOpenActivity()&&!i.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.LABA&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){OpenSystem.ins().checkSysOpen(SystemType.LABA)&&(ViewManager.ins().open(LabaWin),this.firstTap&&(this.firstTap=!1,this.update()))},e}(RuleIconBase);__reflect(LabaIconRule.prototype,"LabaIconRule");var LadderBtnIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace],s.updateMessage=[Ladder.ins().postTadderChange,Encounter.ins().postEncounterDataChange,Mine.ins().postRedPoint,KFBattleRedPoint.ins().postRedPoint,UserFb.ins().postShowRedChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return UserFb.ins().guanqiaID>=GlobalConfig.SkirmishBaseConfig.openLevel&&!Encounter.ins().isGuiding&&!UserFb.ins().pkGqboss},e.prototype.checkShowRedPoint=function(){var t=Encounter.ins().isHasRed();return t?t:Ladder.ins().checkRedShow()?1:Mine.redpointCheck()?1:UserFb.ins().checkTFRed()?1:Hungu.ins().showHunShouRed()?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(LadderWin,0)},e}(RuleIconBase);__reflect(LadderBtnIconRule.prototype,"LadderBtnIconRule");var LimitTaskIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserZs.ins().postZsData],s.updateMessage=[UserTask.ins().postUpdteLimitTaskData],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,0==UserTask.ins().limitTaskState?this.alertText.text="点击开放":(this.runTime(),TimerManager.ins().doTimer(1e3,0,this.runTime,this)),e},e.prototype.runTime=function(){var t=UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3);t>=0?this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12):(this.alertText.text="活动结束",TimerManager.ins().remove(this.runTime,this),this.updateShow())},e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LIMITTASK))return!1;var t=GlobalConfig.LimitTimeConfig[UserTask.ins().currTaskListsId];if(!t)return!1;if(UserTask.ins().limitTaskEndTime>0)if(UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)<0){if(!GlobalConfig.LimitTimeConfig[UserTask.ins().currTaskListsId+1])return ViewManager.ins().close(LimitTaskView),!1}else if(!GlobalConfig.LimitTimeConfig[UserTask.ins().currTaskListsId+1]&&8==UserTask.ins().limitTaskCount)return this.updateShow(),TimerManager.ins().doTimer(1500,1,function(){ViewManager.ins().close(LimitTaskView)},this),!1;return-1!=UserTask.ins().limitTaskState&&UserTask.ins().limitTaskEndTime>0?!0:!0},e.prototype.checkShowRedPoint=function(){return UserTask.ins().getLimitTaskRed()},e.prototype.tapExecute=function(){ViewManager.ins().open(LimitTaskView)},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"actIconCircle"},e}(RuleIconBase);__reflect(LimitTaskIconRule.prototype,"LimitTaskIconRule");var LongTaiTouIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LONGTAITOU))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.LONGTAITOU&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.LONGTAITOU&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(LongTaiTouWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(LongTaiTouIconRule.prototype,"LongTaiTouIconRule");var MaBiIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,UserVip.ins().postUpdateVipAwards],s.updateMessage=[UserVip.ins().postUpdataExp],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.MABI)&&!(UserVip.ins().state>>2&1)},e.prototype.checkShowRedPoint=function(){return UserVip.ins().lv>=3?1:0},e.prototype.getEffName=function(t){return this.firstTap?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){this.firstTap=!1,this.update(),ViewManager.ins().open(Vip3MWin,3)},e}(RuleIconBase);__reflect(MaBiIconRule.prototype,"MaBiIconRule");var MailIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserMail.ins().postMailData,UserMail.ins().postGetItemFromMail,UserMail.ins().postMailDetail],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=UserMail.ins().getUnreadMail();return 0>=t?!1:!0},e.prototype.checkShowRedPoint=function(){return UserMail.ins().mailData?1:0},e.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))},e.prototype.tapExecute=function(){ViewManager.ins().open(FriendBgWin,4)},e}(RuleIconBase);__reflect(MailIconRule.prototype,"MailIconRule");var MallIconRule=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange],s.updateMessage=[ShopRedPoint.ins().postShopRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.MALL)},e.prototype.checkShowRedPoint=function(){return ShopRedPoint.ins().shopRedPoint||!ShopRedPoint.ins().nfirstLogin?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(ShopWin),ShopRedPoint.ins().nfirstLogin=!0,this.update()},e}(RuleIconBase);__reflect(MallIconRule.prototype,"MallIconRule");var MapIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=s.updateMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.WORLDMAP)},e.prototype.checkShowRedPoint=function(){var t=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward-1],e=GlobalConfig.ChaptersRewardConfig[UserFb.ins().guanqiaReward];if(!e)return 0;var i=t?e.needLevel-t.needLevel:e.needLevel,s=UserFb.ins().guanqiaID-(t?t.needLevel:0)-1;if(s>=i)return 1;var n=GlobalConfig.WorldRewardConfig;for(var o in n)if(UserFb.ins().guanqiaID>n[o].needLevel&&!UserFb.ins().isGetReceiveBox(n[o].id))return 1;return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(GuanQiaWordMapWin)},e}(RuleIconBase);__reflect(MapIconRule.prototype,"MapIconRule");var MonthCardIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,UserExpGold.ins().postExpUpdate],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=!0;return Recharge.ins().monthDay>0&&Recharge.ins().franchise>0&&(t=!1),OpenSystem.ins().checkSysOpen(SystemType.MONTHCARD)&&t},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){var t=2;Recharge.ins().monthDay>0&&(t=3),ViewManager.ins().open(FuliWin,t),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(MonthCardIconRule.prototype,"MonthCardIconRule");var NewWorldBossIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=s.updateMessage=[UserBoss.ins().postNewBossOpen],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,UserBoss.ins().newWorldBossData.startTime?(this.runTime(),TimerManager.ins().isExists(this.runTime,this)||TimerManager.ins().doTimer(1e3,0,this.runTime,this)):this.alertText.text="活动结束",e},e.prototype.runTime=function(){var t=Math.floor((UserBoss.ins().newWorldBossData.startTime-GameServer.serverTime)/1e3);t>=0?this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12):1e3*GlobalConfig.NewWorldBossBaseConfig.bossTime+UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime?this.alertText.text="":(this.alertText.text="活动结束",TimerManager.ins().remove(this.runTime,this),this.updateShow())},e.prototype.checkShowIcon=function(){if(!GameServer.serverOpenDay)return!1;var t=UserBoss.ins().newWorldBossData.isOpen;return t&&UserBoss.ins().newWorldBossData.startTime&&(TimerManager.ins().isExists(this.runTime,this)||TimerManager.ins().doTimer(1e3,0,this.runTime,this)),t},e.prototype.checkShowRedPoint=function(){return GameServer.serverTime>UserBoss.ins().newWorldBossData.startTime&&1e3*GlobalConfig.NewWorldBossBaseConfig.bossTime+UserBoss.ins().newWorldBossData.startTime>GameServer.serverTime?1:0},e.prototype.getEffName=function(){return this.checkShowRedPoint()?(this.effX=38,this.effY=38,"actIconCircle"):""},e.prototype.tapExecute=function(){ViewManager.ins().open(NewWorldBossWin)},e}(RuleIconBase);__reflect(NewWorldBossIconRule.prototype,"NewWorldBossIconRule");var NewYearIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,Activity.ins().postActivityIsGetAwards],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.NEWYEAR))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.NEWYEAR&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.NEWYEAR&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(NewYearWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(NewYearIconRule.prototype,"NewYearIconRule");var PaoDianIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._time=0,s.showMessage=[Actor.ins().postLevelChange,PaoDianCC.ins().postOpenInfo],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);if(this._timeTxt=new eui.Label,this._timeTxt.x=0,this._timeTxt.y=70,this._timeTxt.width=70,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,this._timeTxt.textColor=65280,e.addChild(this._timeTxt),PaoDianCC.ins().isOpen)this._timeTxt.text="进行中";else{var i=PaoDianCC.ins().getOpenLeftTime();i>0&&(this._time=i,this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4),TimerManager.ins().isExists(this.setRepeat,this)||TimerManager.ins().doTimer(1e3,0,this.setRepeat,this))}return e},e.prototype.checkShowIcon=function(){if(TimerManager.ins().removeAll(this),!OpenSystem.ins().checkSysOpen(SystemType.PAODIAN))return!1;if(PaoDianCC.ins().isOpen)return!0;var t=PaoDianCC.ins().getOpenLeftTime();return t>0?(this._time=t,TimerManager.ins().isExists(this.setRepeat,this)||TimerManager.ins().doTimer(1e3,0,this.setRepeat,this),!0):!1},e.prototype.setRepeat=function(){this._time--,this._time>0?this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4):(this._timeTxt.text="进行中",TimerManager.ins().removeAll(this))},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"actIconCircle"},e.prototype.tapExecute=function(){ViewManager.ins().open(FbWin,3),this.update()},e}(RuleIconBase);__reflect(PaoDianIconRule.prototype,"PaoDianIconRule");var PartnerIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[Actor.ins().postLevelChange,GameLogic.ins().postSubRoleChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return SubRoles.ins().subRolesLen<3},e.prototype.checkShowRedPoint=function(){var t=SubRoles.ins().subRolesLen,e=GlobalConfig.NewRoleConfig[t];if(!e)return 0;var i=e.zsLevel?UserZs.ins().lv:Actor.level,s=e.zsLevel?e.zsLevel:e.level;return i>=s||UserVip.ins().lv>=e.vip?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(NewRoleWin)},e}(RuleIconBase);__reflect(PartnerIconRule.prototype,"PartnerIconRule");var PeakedIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,SpecialRing.ins().postActiveRing,GameApp.ins().postZeroInit,UserZs.ins().postZsLv],s.updateMessage=[PeakedRedpoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.update=function(){t.prototype.update.call(this),this.tar.txt&&(PeakedSys.ins().isKf()?PeakedSys.ins().kfStatusIsEnd&&PeakedSys.ins().kfStatus<KF_PeakStatus.Finals?this.tar.txt.text=PeakedData.STATE_KF_ICON_CN[PeakedSys.ins().kfStatus+1]:this.tar.txt.text=PeakedData.STATE_KF_ICON_CN[PeakedSys.ins().kfStatus]:PeakedSys.ins().bfStatusIsEnd&&PeakedSys.ins().bfStatus<BF_PeakStatus.Finals?this.tar.txt.text=PeakedData.STATE_ICON_CN[PeakedSys.ins().bfStatus+1]:this.tar.txt.text=PeakedData.STATE_ICON_CN[PeakedSys.ins().bfStatus])},e.prototype.checkShowIcon=function(){return PeakedSys.ins().isOpen()},e.prototype.checkShowRedPoint=function(){return PeakedRedpoint.ins().redpoint},e.prototype.tapExecute=function(){ViewManager.ins().open(PeakedMainWin)},e}(RuleIconBase);__reflect(PeakedIconRule.prototype,"PeakedIconRule");var RankIconRule=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.RANK)},e.prototype.checkShowRedPoint=function(){return OpenSystem.ins().checkSysOpen(SystemType.RANK)?0:Rank.ins().canPraiseInAll()?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(RankingWin)},e}(RuleIconBase);__reflect(RankIconRule.prototype,"RankIconRule");var RingIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,SpecialRing.ins().postActiveRing],s.updateMessage=[SpecialRing.ins().postActiveRing,UserBag.ins().postItemDel,UserBag.ins().postItemAdd],s
}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=OpenSystem.ins().checkSysOpen(SystemType.RING);if(t){var e=Object.keys(GlobalConfig.ActorExRingConfig).length;t=SpecialRing.ins().ringActiNum<e}return t},e.prototype.checkShowRedPoint=function(){var t=SpecialRing.ins().checkHaveUpRing();return t?1:0},e.prototype.getEffName=function(){},e.prototype.tapExecute=function(){SpecialRing.ins().checkRingOpen()?ViewManager.ins().open(RingInfoView):UserTips.ins().showTips("激活神器 神龙之戒 后开启")},e}(RuleIconBase);__reflect(RingIconRule.prototype,"RingIconRule");var BaseSpriteLayer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BaseSpriteLayer.prototype,"BaseSpriteLayer");var RuneIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserZs.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=RuneConfigMgr.ins().getOtherCfg();return UserZs.ins().lv>=t.zsLevel},e.prototype.getEffName=function(){},e.prototype.tapExecute=function(){var t=RuneConfigMgr.ins().getOtherCfg(),e=UserZs.ins().lv>=t.zsLevel;return e?void ViewManager.ins().open(RuneWin):void UserTips.ins().showTips(t.zsLevel+"转开启战纹系统")},e}(RuleIconBase);__reflect(RuneIconRule.prototype,"RuneIconRule");var SanbaIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SANBA))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.SANBA&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.SANBA&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(SanbaWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(SanbaIconRule.prototype,"SanbaIconRule");var SevenDayIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postSevendayIsAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postSevendayIsAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return Actor.level>=10&&Activity.ins().getSevenDayLogIsVisible()},e.prototype.checkShowRedPoint=function(){return Activity.ins().getSevenDayStast()?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(SevenDayLogWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(SevenDayIconRule.prototype,"SevenDayIconRule");var ShareIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[PfActivity.ins().postInviteInfoUpdate,PfActivity.ins().postShare,Actor.ins().postLevelChange],s.updateMessage=[PfActivity.ins().postInviteInfoUpdate],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.SHARE)&&-1!=PfActivity.ins().shareState&&PfActivity.ins().wxInviteCount<3},e.prototype.checkShowRedPoint=function(){var t=DateUtils.formatMiniDateTime(PfActivity.ins().inviteTime)-GameServer.serverTime;TimerManager.ins().removeAll(this);var e=0>=t?1:0;return e||TimerManager.ins().doTimer(t,1,this.updateTime,this),e},e.prototype.updateTime=function(){this.update()},e.prototype.tapExecute=function(){ViewManager.ins().open(YqWin)},e}(RuleIconBase);__reflect(ShareIconRule.prototype,"ShareIconRule");var ShenQiIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,UserTask.ins().postUpdteTaskTrace,Artifact.ins().postNewArtifactInit,Artifact.ins().postNewArtifactUpdate,Artifact.ins().postGuide],s}return __extends(e,t),e.prototype.checkShowIcon=function(){this.updateInfo();var t=OpenSystem.ins().checkSysOpen(SystemType.SHENQIGUIDE)&&!UserFb.ins().pkGqboss&&UserFb.ins().guanqiaID<340;return t},e.prototype.updateInfo=function(){var t,e=UserFb.ins().getCurrentReward(),i=UserFb.ins().getNextReward();if(e)t=e[0],UserFb.ins().getMapReward(),this.pretips&&this.pretips==t.id||(this.pretips=t.id,UserTips.ins().showItemTips(t.id));else if(i&&(t=i[0],this.labelChapter)){var s="再战|C:0x40df38&T:"+UserFb.ins().getNextNeedChapter()+"|关";this.labelChapter.textFlow=TextFlowMaker.generateTextFlow1(s)}t&&this.tar&&this.setReward(t)},e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.labelInfo=e.labelInfo,this.imgInfo=e.imgInfo,this.imgName=e.imgName,this.imgItem=e.imgItem,this.labelChapter=e.labelChapter,this.groupEff=e.groupEff,this.updateInfo(),e},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(TargetWin,TargetWin.SEHNQI),Artifact.ins().showGuide=-2e3},e.prototype.setReward=function(t){var e=Artifact.ins().getConfByChipId(t.id);e&&(this.imgName.source=e.imgName,this.imgItem.source=e.img,this.imgInfo.source=e.simpleDesc,this.labelInfo.text=e.buttonDesc)},e.prototype.getEffName=function(t){},e}(RuleIconBase);__reflect(ShenQiIconRule.prototype,"ShenQiIconRule");var SpringBeginIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange,UserBag.ins().postItemDel],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SPRINGBEGIN))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.SPRINGBEGIN&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.SPRINGBEGIN&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(SpringBeginWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(SpringBeginIconRule.prototype,"SpringBeginIconRule");var SpringEightDayIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s._activityID=0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SPRINGEIGHTDAY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(SpringEightDayWin,this._activityID),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(SpringEightDayIconRule.prototype,"SpringEightDayIconRule");var SpringFestivalIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange,UserBag.ins().postItemDel],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SPRINGFESTIVAL))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.SPRINGFESTIVAL&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.SPRINGFESTIVAL&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(SpringFestivalWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(SpringFestivalIconRule.prototype,"SpringFestivalIconRule");var SuperVipIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[UserVip.ins().postSuperVipData,Actor.ins().postLevelChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.SUPERVIP)&&UserVip.ins().superVipData?UserVip.ins().superVipData.enabled:!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(SuperVipWin)},e}(RuleIconBase);__reflect(SuperVipIconRule.prototype,"SuperVipIconRule");var TaskTraceIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.currentEff="",s.showMessage=[UserTask.ins().postUpdteTaskTrace,Actor.ins().postLevelChange,GameLogic.ins().postEnterMap],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=UserTask.ins().getTaskState()&&!UserFb.ins().pkGqboss;return t},e.prototype.getEffName=function(t){var e,i=UserTask.ins().taskTrace;if(i)switch(i.state){case 0:e="achieveCom",this.effX=130,this.effY=35;break;case 1:e="GWOpenEff",this.effX=140,this.effY=32}if(this.currentEff!=e){var s=ViewManager.ins().getView(PlayFunView);s.ruleEff[this.tar.hashCode]&&(DisplayUtils.removeFromParent(s.ruleEff[this.tar.hashCode]),s.ruleEff[this.tar.hashCode]=null)}return this.currentEff=e,e},e.prototype.tapExecute=function(){var t=UserTask.ins().taskTrace;if(0==t.state)GameGuider.taskGuidance(t.id,1),GuideUtils.ins().updateByClick();else{UserTask.ins().sendGetAchieve(t.achievementId),UserTask.ins().postParabolicItem(),Hint.ins().postAchievementAft(t),UserTask.ins().getAchieveConfById(t.id+1)||UserTips.ins().showTips("已完成所有任务!");var e=ViewManager.ins().getView(PlayFunView);e.hejiRule.updatekStep(!0)}this.update()},e}(RuleIconBase);__reflect(TaskTraceIconRule.prototype,"TaskTraceIconRule");var ThanksIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.THANKS))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.THANKS&&s.isOpenActivity())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.THANKS&&i.isOpenActivity()&&i.canReward()&&i.specialState())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ThanksGivingWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ThanksIconRule.prototype,"ThanksIconRule");var TotalRechargeIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.activityId=0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Recharge.ins().postUpdateRecharge],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,this.runTime(),this.addTime(),e},e.prototype.addTime=function(){TimerManager.ins().doTimer(1e3,0,this.runTime,this)},e.prototype.removeTime=function(){TimerManager.ins().remove(this.runTime,this)},e.prototype.runTime=function(){var t=Activity.ins().activityData;if(!this.activityId)for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.TOTALRECHARGE&&i.isOpenActivity()&&!i.getHide()){this.activityId=+e;break}}if(!this.activityId)return void(this.alertText.text="");var s=t[this.activityId];if(!s)return void(this.alertText.text="");var n=s.getLeftTime();if(n>0)this.alertText.text=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_12);else{var o=ViewManager.ins().getView(PlayFunView);o&&(this.removeTime(),this.update())}},e.prototype.checkShowIcon=function(){if(this.removeTime(),!OpenSystem.ins().checkSysOpen(SystemType.DOUBLE_TWELVE_RECHARGE))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.TOTALRECHARGE&&s.isOpenActivity()&&!s.getHide()){this.activityId=+i;var n=t[this.activityId];if(n.getLeftTime()>0)return this.addTime(),!0}}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.TOTALRECHARGE&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(TotalRechargeWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(TotalRechargeIconRule.prototype,"TotalRechargeIconRule");var TreasureIconRule=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this,e,i)||this;return s.showMessage=[UserZs.ins().postZsLv,Actor.ins().postLevelChange,UserFb.ins().postGuanqiaInfo,UserFb.ins().postGuanKaIdChange,GameServer.ins().postServerOpenDay],s.updateMessage=[UserBag.ins().postItemAdd,UserBag.ins().postHuntStore,Heirloom.ins().postHuntBoxInfo],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.TREASURE)},e.prototype.checkShowRedPoint=function(){return Setting.ins().getValue(ClientSet.firstClickTreasure)!=new Date(GameServer.serverTime).getDate()?1:Boolean(UserBag.ins().getHuntGoods(0).length)||Boolean(UserBag.ins().getHuntGoods(1).length)||Rune.ins().getIsGetBox()||Heirloom.ins().isHeirloomHuntOpen()&&(Boolean(UserBag.ins().getHuntGoods(2).length)||Heirloom.ins().getIsGetBox())||RuneRedPointMgr.ins().checkCanExchange()?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(TreasureHuntWin);var t=new Date(GameServer.serverTime).getDate();Setting.ins().getValue(ClientSet.firstClickTreasure)!=t&&(Setting.ins().setValue(ClientSet.firstClickTreasure,t),this.update())},e}(RuleIconBase);__reflect(TreasureIconRule.prototype,"TreasureIconRule");var VersionCeleIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange,UserBag.ins().postItemDel],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.VERSIONCEL))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.VERSIONCELE&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.VERSIONCELE&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(VersionCeleWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(VersionCeleIconRule.prototype,"VersionCeleIconRule");var VipGiftIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,UserVip.ins().postVipGiftBuy],s.updateMessage=[UserVip.ins().postUpdateVipData,UserVip.ins().postVipGiftBuy,Recharge.ins().postUpdateRechargeEx,Actor.ins().postYbChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.VIPGIFT))return!1;for(var t=Object.keys(GlobalConfig.VipGiftConfig).length,e=UserVip.ins().vipGiftState,i=1;t>=i;i++){var s=GlobalConfig.VipGiftConfig[i].hfTimes;if(s=s?s:0,GameServer._hefuCount>=s&&0==(1&e[i-1].state))return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=UserVip.ins().lv;for(var e in GlobalConfig.VipGiftConfig){var i=GlobalConfig.VipGiftConfig[e],s=i.hfTimes;if(s=s?s:0,t>=i.vipLv&&GameServer._hefuCount>=s&&UserVip.ins().getVipGiftRedPoint(+e))return 1}return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(VipGiftWin)},e}(RuleIconBase);__reflect(VipGiftIconRule.prototype,"VipGiftIconRule");var WJBattleIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){return WJBattlefieldSys.ins().isOpen},e.prototype.checkShowRedPoint=function(){return KFBattleRedPoint.ins().redPoint1},e.prototype.tapExecute=function(){ViewManager.ins().open(WJBattlefieldWin)},e}(RuleIconBase);__reflect(WJBattleIconRule.prototype,"WJBattleIconRule");var XiaoNianIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.XIAONIAN))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.XIAONIAN&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.XIAONIAN&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(XiaoNianWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(XiaoNianIconRule.prototype,"XiaoNianIconRule");var YBZhuanPanIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.activityId=0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=70,this.runTime(),this.addTime(),e},e.prototype.addTime=function(){TimerManager.ins().doTimer(1e3,0,this.runTime,this)},e.prototype.removeTime=function(){TimerManager.ins().remove(this.runTime,this)},e.prototype.runTime=function(){var t=Activity.ins().activityData;if(!this.activityId)for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.YBZHUANPAN&&i.isOpenActivity()&&!i.getHide()){this.activityId=+e;break}}if(!this.activityId)return void(this.alertText.text="");var s=t[this.activityId];if(!s)return void(this.alertText.text="");s.getLeftTime()||this.removeTime();var n=s.getRemainTime();this.alertText.text=n},e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.CHRISTMAS))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.YBZHUANPAN&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.YBZHUANPAN&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(YBZhuanPanWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(YBZhuanPanIconRule.prototype,"YBZhuanPanIconRule");var YqBtnIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[PfActivity.ins().postInviteInfoUpdate],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=!0;return PfActivity.ins().wxInviteCount>=3&&(t=!1),t&&e.isShowIcon},e.prototype.tapExecute=function(){ViewManager.ins().open(YqWin)},e}(RuleIconBase);YqBtnIconRule.isShowIcon=!1,__reflect(YqBtnIconRule.prototype,"YqBtnIconRule");var ZhanLingIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,UserBag.ins().postItemAdd,UserBag.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.ZHANLING))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.ZHANLING&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.ZHANLING&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"actIconCircle"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ZhanLingACTWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(ZhanLingIconRule.prototype,"ZhanLingIconRule");var ActivityForeshowWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="NewFuncNoticeSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addCustomEvent(),this.updateView()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.closeBtn,this.closeWin),TimerManager.ins().doTimerDelay(1e3,1e3,0,this.refreshTime,this)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.updateView=function(){var t=ActivityForeshowModel.ins().getForeshow();t&&(this.activityImg.source=t.pic),this.refreshTime()},e.prototype.refreshTime=function(){var t=DateUtils.getFormatBySecond(ActivityForeshowModel.ins().getRemainTime());this.daojishi0.text=t},e}(BaseEuiView);__reflect(ActivityForeshowWin.prototype,"ActivityForeshowWin"),ViewManager.ins().reg(ActivityForeshowWin,LayerManager.UI_Main);var SubRole=function(){function t(){this.pos1=0,this.pos2=0,this.pos3=0}return t.prototype.parser=function(t){this.job=t.readByte(),this.sex=t.readByte(),this.clothID=t.readInt(),this.swordID=t.readInt(),this.wingLevel=t.readInt(),0==t.readInt()&&(this.wingLevel=-1),this.pos1=t.readInt(),this.pos2=t.readInt(),this.pos3=t.readInt()},t}();__reflect(SubRole.prototype,"SubRole");var PraiseData=function(){function t(){this.subRole=[]}return t.prototype.getLastMobaiNum=function(){var t=UserZs.ins().lv>0?1e3*UserZs.ins().lv:Actor.level,e=GlobalConfig.MorshipConfig[t].count;return e-this.praiseTime},t.prototype.parser=function(t){if(this.id=t.readInt(),this.id>0){this.name=t.readString(),this.ce=t.readDouble(),this.level=t.readShort(),this.zhuan=t.readShort(),this.vipLevel=t.readShort();for(var e=t.readShort(),i=0;e>i;i++)this.subRole[i]=new SubRole,this.subRole[i].parser(t)}},t.prototype.getRoleByJob=function(t){if(t>0)for(var e in this.subRole)if(this.subRole[e].job==t)return this.subRole[e];return this.subRole[0]},t}();__reflect(PraiseData.prototype,"PraiseData");var DelayOptManager=function(t){function e(){var e=t.call(this)||this;return e.TIME_THRESHOLD=2,e._delayOpts=[],egret.startTick(e.runCachedFun,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.addDelayOptFunction=function(t,e,i,s,n){this._delayOpts.push({fun:e,funPara:i,thisObj:t,callBack:s,para:n})},e.prototype.clear=function(){this._delayOpts.length=0},e.prototype.runCachedFun=function(t){if(0==this._delayOpts.length)return!1;for(var e,i=egret.getTimer();this._delayOpts.length&&(e=this._delayOpts.shift(),e.funPara?e.fun.call(e.thisObj,e.funPara):e.fun.call(e.thisObj),e.callBack&&(void 0!=e.para?e.callBack.call(e.thisObj,e.para):e.callBack()),!(egret.getTimer()-i>this.TIME_THRESHOLD)););return!1},e}(BaseClass);__reflect(DelayOptManager.prototype,"DelayOptManager");var RankDataBook=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readDouble()},e}(RankDataBase);__reflect(RankDataBook.prototype,"RankDataBook");var RankDataLadder=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.id=t.readInt(),this.player=t.readString(),this.challgeLevel=t.readInt(),this.challgeId=t.readInt(),this.winNum=t.readInt(),this.job=t.readByte(),this.sex=t.readByte()},e}(RankDataBase);__reflect(RankDataLadder.prototype,"RankDataLadder");var RankDataLongHun=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataLongHun.prototype,"RankDataLongHun");var RankDataScore=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readDouble()},e}(RankDataBase);__reflect(RankDataScore.prototype,"RankDataScore");var RankDataSkirmish=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(e,i){t.prototype.parser.call(this,e,i);for(var s in GlobalConfig.SkirmishRankConfig){var n=GlobalConfig.SkirmishRankConfig[s];if(n.minRank<=this.pos&&this.pos<=n.maxRank)return this.reward=n.rewards[0].count,void(this.money=n.rewards[1].count)}this.money=this.reward=0},e}(RankDataBase);__reflect(RankDataSkirmish.prototype,"RankDataSkirmish");var RankDataWeiWang=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.weiWang=t.readInt()},e}(RankDataBase);__reflect(RankDataWeiWang.prototype,"RankDataWeiWang");var RankDataWing=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataWing.prototype,"RankDataWing");var RankDataZhuan=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataZhuan.prototype,"RankDataZhuan");var RankDataZhuZao=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataZhuZao.prototype,"RankDataZhuZao");var Rank=function(t){function e(){var e=t.call(this)||this;return e.rankModel=[],e.rankTypeList=[],e.sysId=PackageID.Ranking,e.regNetMsg(1,e.postRankingData),e.regNetMsg(2,e.postPraiseData),e.regNetMsg(3,e.postPraiseResult),e.regNetMsg(4,e.postAllPraiseData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendGetAllPraiseData()},e.prototype.sendGetRankingData=function(t){void 0===t&&(t=0);var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.postRankingData=function(t){var e=this.getRankModel(t.readShort());return e.parser(t),e},e.prototype.sendGetPraiseData=function(t){void 0===t&&(t=0);var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.postPraiseData=function(t){var i=e.ins().getRankModel(t.readShort());return i.praise.praiseTime=t.readShort(),i.praise.parser(t),i.type},e.prototype.sendGetAllPraiseData=function(){this.sendBaseProto(4)},e.prototype.postAllPraiseData=function(t){for(var i=t.readShort(),s=0;i>s;s++){var n=e.ins().getRankModel(t.readShort());n.praise.praiseTime=t.readShort()}},e.prototype.sendPraise=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.postPraiseResult=function(t){var i=e.ins().getRankModel(t.readShort());return i.praise.praiseTime=t.readShort(),[i.type,i.praise.getLastMobaiNum()]},e.prototype.getRankModel=function(t){if(!(t in this.rankModel)){var e=void 0;e=t==RankDataType.TYPE_SKIRMISH?RankDataSkirmish:t==RankDataType.TYPE_LADDER?RankDataLadder:t==RankDataType.TYPE_BAOSHI?RankDataZhuZao:t==RankDataType.TYPE_LONGHUN?RankDataLongHun:t==RankDataType.TYPE_WING?RankDataWing:t==RankDataType.TYPE_BOOK?RankDataBook:t==RankDataType.TYPE_ZS?RankDataZhuan:t==RankDataType.TYPE_SCORE?RankDataScore:t==RankDataType.TYPE_WEIWANG?RankDataWeiWang:RankDataBase,this.rankModel[t]=new RankModel(t,e)}return this.rankModel[t]},e.prototype.canPraiseByType=function(t){return!1},e.prototype.canPraiseInAll=function(){this.rankTypeList.length<=0&&(this.rankTypeList=[RankDataType.TYPE_POWER,RankDataType.TYPE_SKIRMISH,RankDataType.TYPE_LEVEL,RankDataType.TYPE_LILIAN,RankDataType.TYPE_XUNZHANG]);for(var t=0,e=this.rankModel;t<e.length;t++){var i=e[t];if(i&&this.rankTypeList.lastIndexOf(i.type)>-1&&i.praise&&i.praise.praiseTime<1)return!0}return!1},e}(BaseSystem);
__reflect(Rank.prototype,"Rank");var RankModel=function(){function t(t,e){this.type=t,this._dataClass=e,this._dataList=[],this.praise=new PraiseData}return t.prototype.getDataList=function(t){return void 0===t&&(t=-1),-1==t?this._dataList:this._dataList[t]},t.prototype.parser=function(t){var e=RankDataType.ITEMS[this.type],i=t.readShort();this._dataList.length=i;for(var s=0;i>s;++s)s in this._dataList||(this._dataList[s]=new this._dataClass),this._dataList[s].parser(t,e);this.selfPos=t.readShort()},t}();__reflect(RankModel.prototype,"RankModel");var GameSystem;!function(t){t.rank=Rank.ins.bind(Rank)}(GameSystem||(GameSystem={}));var RankDataType;!function(t){t.TYPE_POWER=0,t.TYPE_ARENA=1,t.TYPE_SKIRMISH=2,t.TYPE_PASS=3,t.TYPE_COPY=4,t.TYPE_LEVEL=5,t.TYPE_WING=16,t.TYPE_JOB_ZS=7,t.TYPE_JOB_FS=8,t.TYPE_JOB_DS=9,t.TYPE_LILIAN=10,t.TYPE_LADDER=11,t.TYPE_BAOSHI=12,t.TYPE_ZHANLING=13,t.TYPE_LONGHUN=14,t.TYPE_XUNZHANG=15,t.TYPE_XIAOFEI=-1,t.TYPE_BOOK=17,t.TYPE_ZS=18,t.TYPE_SCORE=19,t.TYPE_HF_XIAOFEI=21,t.TYPE_WEIWANG=22,t.TYPE_XIAYI=23,t.DATA_POS="pos",t.DATA_ID="id",t.DATA_PLAYER="player",t.DATA_LEVEL="level",t.DATA_ZHUAN="zhuan",t.DATA_VIP="vip",t.DATA_MONTH="month",t.DATA_POWER="power",t.DATA_COUNT="count",t.DATA_EXP="exp",t.DATA_JOB="job",t.DATA_SEX="sex",t.DATA_WEIWANG="weiWang",t.ITEMS=[],t.ITEMS[t.TYPE_POWER]=t.ITEMS[t.TYPE_WING]=t.ITEMS[t.TYPE_JOB_ZS]=t.ITEMS[t.TYPE_JOB_FS]=t.ITEMS[t.TYPE_JOB_DS]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH,t.DATA_POWER],t.ITEMS[t.TYPE_SKIRMISH]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_JOB,t.DATA_SEX,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_COUNT,t.DATA_MONTH],t.ITEMS[t.TYPE_LEVEL]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH],t.ITEMS[t.TYPE_PASS]=t.ITEMS[t.TYPE_COPY]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_POWER,t.DATA_VIP,t.DATA_COUNT,t.DATA_MONTH],t.ITEMS[t.TYPE_LILIAN]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH,t.DATA_COUNT,t.DATA_EXP],t.ITEMS[t.TYPE_XUNZHANG]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH,t.DATA_COUNT],t.ITEMS[t.TYPE_XIAYI]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_VIP,t.DATA_COUNT],t.readFunc={},t.readFunc[t.DATA_JOB]=t.readFunc[t.DATA_SEX]="readByte",t.readFunc[t.DATA_POS]=t.readFunc[t.DATA_LEVEL]=t.readFunc[t.DATA_ZHUAN]=t.readFunc[t.DATA_VIP]=t.readFunc[t.DATA_MONTH]="readShort",t.readFunc[t.DATA_ID]=t.readFunc[t.DATA_POWER]=t.readFunc[t.DATA_COUNT]=t.readFunc[t.DATA_EXP]="readInt",t.readFunc[t.DATA_POWER]="readDouble",t.readFunc[t.DATA_PLAYER]="readString"}(RankDataType||(RankDataType={}));var UserReadPlayer=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Default,e.regNetMsg(16,e.postPlayerResult),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendFindPlayer=function(t,e){void 0===e&&(e=0);var i=this.getBytes(16);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postPlayerResult=function(t){var i=e.ins().otherPlayerData;return i||(i=new OtherPlayerData),i.parser(t),i},e}(BaseSystem);__reflect(UserReadPlayer.prototype,"UserReadPlayer");var OtherPlayerData=function(){function t(){this.roleData=[],this.lilianLv=0,this.zhanlingID=0,this.zhanlingLevel=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.serverId=t.readInt(),this.name=t.readString(),this.level=t.readShort(),this.vipLevel=t.readShort(),this.zhuan=t.readShort(),this.lilianLv=t.readInt(),this.ce=t.readDouble(),this.guildId=t.readInt(),this.guildName=t.readString(),this.zhanlingID=t.readInt(),this.zhanlingLevel=t.readInt();for(var e=t.readShort(),i=0;e>i;i++)this.roleData[i]=new Role,this.roleData[i].parser(t)},t}();__reflect(OtherPlayerData.prototype,"OtherPlayerData");var GameSystem;!function(t){t.userreadplayer=UserReadPlayer.ins.bind(UserReadPlayer)}(GameSystem||(GameSystem={}));var FbAndLevelsRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="FbRankItemSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openDetail,this)},e.prototype.close=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openDetail,this)},e.prototype.dataChanged=function(){this.rank.text=this.data[RankDataType.DATA_POS]+"",this.monthcard.visible=1==this.data[RankDataType.DATA_MONTH];var t=this.data[RankDataType.DATA_VIP];this.vipImg.visible=t>0,this.vip.removeChildren(),t>0&&this.vip.addChild(BitmapNumber.ins().createNumPic(t,"5")),this.nameLabel.text=this.data[RankDataType.DATA_PLAYER],this.zhanli.text=CommonUtils.overLength(this.data[RankDataType.DATA_POWER]),this.ce.text=this.data[RankDataType.DATA_COUNT]+"关"},e.prototype.openDetail=function(){UserReadPlayer.ins().sendFindPlayer(this.data.playId)},e}(BaseItemRender);__reflect(FbAndLevelsRankItem.prototype,"FbAndLevelsRankItem");var FbAndLevelsRankWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="FbRankSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.title.source="fbRankSkin_"+t[0];var i=Rank.ins().rankModel[t[0]];this.rank.text=0<i.selfPos&&i.selfPos<=1e3?i.selfPos+"":"未上榜",this.list.itemRenderer=FbAndLevelsRankItem,this.list.dataProvider=new eui.ArrayCollection(i.getDataList()),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(FbAndLevelsRankWin.prototype,"FbAndLevelsRankWin"),ViewManager.ins().reg(FbAndLevelsRankWin,LayerManager.UI_Popup);var RankingWin=function(t){function e(){var e=t.call(this)||this;return e.firstId=0,e.skinName="RankSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.praiseBtn.touchEnabled=!0,this.praiseBtn.icon="xphb_json.phb_2",this.list.itemRenderer=RankItemRenderer,this.tab.itemRenderer=RankTabItemRenderer,this.mobaiEff=new MovieClip,this.mobaiEff.x=35,this.mobaiEff.y=-35,this.mobaiEff.scaleX=this.mobaiEff.scaleY=.65;var e=new eui.ArrayCollection,i=[];this.tab.dataProvider=e;var s=new RankItemVo;s.name="战力排行",s.type=RankDataType.TYPE_POWER,i.push(s),s=new RankItemVo,s.name="等级排行",s.type=RankDataType.TYPE_LEVEL,s.skin="RankItemLevelSkin",i.push(s),s=new RankItemVo,s.name="神功排行",s.type=RankDataType.TYPE_LILIAN,s.skin="RankItemLilianSkin",i.push(s),s=new RankItemVo,s.name="威望排行",s.type=RankDataType.TYPE_WEIWANG,s.skin="RankItemPrestigeSkin",i.push(s),s=new RankItemVo,s.name="侠义排行",s.type=RankDataType.TYPE_XIAYI,s.skin="RankItemXiayiSkin",i.push(s),e.source=i,e.replaceAll(i)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.praiseBtn,this.onClick),this.addTouchEvent(this.list,this.onClick),this.addChangeEvent(this.tab,this.onClick),this.addTouchEvent(this.firstGroup,this.onClick),this.addTouchEvent(this.praiseGroup,this.onClick),this.addTouchEvent(this.praiseGroup2,this.onClick),this.addTouchEvent(this.praiseGroup3,this.onClick),this.addTouchEvent(this.help,this.onClick),this.setOpenType(void 0==t[0]?-1:t[0]),this.observe(UserReadPlayer.ins().postPlayerResult,this.openOtherPlayerView),this.observe(Rank.ins().postRankingData,this.updateList),this.observe(Rank.ins().postPraiseResult,this.refushMoBaiStatu),this.observe(Rank.ins().postPraiseData,this.updatePraise),this.observe(Rank.ins().postAllPraiseData,this.updateTab),Rank.ins().sendGetAllPraiseData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._weaponEff0&&DisplayUtils.removeFromParent(this._weaponEff0),this._weaponEff1&&DisplayUtils.removeFromParent(this._weaponEff1),this._weaponEff2&&DisplayUtils.removeFromParent(this._weaponEff2),this._bodyEff0&&DisplayUtils.removeFromParent(this._bodyEff0),this._bodyEff1&&DisplayUtils.removeFromParent(this._bodyEff1),this._bodyEff2&&DisplayUtils.removeFromParent(this._bodyEff2),WatcherUtil.removeFromArrayCollection(this.tab.dataProvider)},e.prototype.updateList=function(t){if(t.type==this._type){this.selfPos.text=0<t.selfPos&&t.selfPos<=1e3?t.selfPos+"":"未上榜";var e=t.getDataList();this.list.dataProvider=new eui.ArrayCollection(e.slice(1)),this.refushMoBaiStatu(),this.refushFirstInfo(t.getDataList(0)),e&&!e.length?this.state.visible=!0:this.state.visible=!1,this.titleMcGroup.visible=this.titleImg.visible=this.firstGroup.visible=!this.state.visible}},e.prototype.refushFirstInfo=function(t){if(t){this.firstId=t.id,this.firstNameTxt.text=t.player,this.vip.visible=t.vip>0;var e="";if(Rank.ins().curType==RankDataType.TYPE_XUNZHANG){var i=GlobalConfig.KnighthoodConfig[t.count];e=i.type}else if(Rank.ins().curType==RankDataType.TYPE_LILIAN){var i=GlobalConfig.TrainLevelConfig[t.count];e=i.trainlevel+"等"+i.trainName}else e=Rank.ins().curType==RankDataType.TYPE_SKIRMISH?"杀意："+t.count:Rank.ins().curType==RankDataType.TYPE_XIAYI?"魅力值："+t.count:t[RankDataType.DATA_LEVEL]+"级";Rank.ins().curType==RankDataType.TYPE_WEIWANG?(this.weiwang.visible=!0,this.weiwang.source=WeiWangCC.ins().getWeiWangCfg(t.weiWang).res,this.firstLevelTxt.visible=!1):(this.firstLevelTxt.visible=!0,this.weiwang.visible=!1),this.firstLevelTxt.text=e}else this.firstId=0,this.weiwang.visible=!1},e.prototype.updateValue=function(t,e,i){switch(e){case RankDataType.DATA_VIP:return;case RankDataType.DATA_MONTH:return;case RankDataType.DATA_LEVEL:i=(t[RankDataType.DATA_ZHUAN]?t[RankDataType.DATA_ZHUAN]+"转":"")+i+"级";break;case RankDataType.DATA_COUNT:}this.firstLevelTxt.text=i},e.prototype.refushMoBaiStatu=function(){Rank.ins().canPraiseByType(this._type)?(this.praiseBtn.icon="xphb_json.phb_2",this.mobaiEff.playFile(RES_DIR_EFF+"huoban",-1),this.mobai.addChild(this.mobaiEff)):(this.praiseBtn.icon="xphb_json.phb_23",DisplayUtils.removeFromParent(this.mobaiEff)),this.updateTab()},e.prototype.setOpenType=function(t){var e=this.tab.dataProvider,i=0;if(e)for(var s=0;s<e.length;s++){var n=e.getItemAt(s);if(n.type==t){i=s;break}}this.setOpenIndex(i)},e.prototype.setOpenIndex=function(t){this.tab.selectedIndex=t;var e=this.tab.selectedItem;e?(this._type=e.type,Rank.ins().curType=this._type,RankItemRenderer.dataFormat=e,this.selfPos.text=null,this.list.dataProvider=null,this.list.itemRendererSkinName=e.skin||"RankItemPowerSkin"):(this._type=0,Rank.ins().curType=this._type,RankItemRenderer.dataFormat=null,this.selfPos.text=null,this.list.dataProvider=null,this.list.itemRendererSkinName="RankItemPowerSkin"),this._type==RankDataType.TYPE_LADDER?Ladder.ins().sendGetRankInfo():Rank.ins().sendGetRankingData(this._type),Rank.ins().sendGetPraiseData(this._type)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.praiseBtn:Rank.ins().rankModel[this._type].praise.praiseTime<1?Rank.ins().sendPraise(this._type):UserTips.ins().showTips("|C:0xf3311e&T:已膜拜|");break;case this.list:this.list.selectedItem&&(this._openOtherWin=!0,UserReadPlayer.ins().sendFindPlayer(this.list.selectedItem[RankDataType.DATA_ID]));break;case this.tab:this.setOpenIndex(this.tab.selectedIndex);break;case this.firstGroup:case this.praiseGroup:case this.praiseGroup2:case this.praiseGroup3:this.firstId&&(this._openOtherWin=!0,UserReadPlayer.ins().sendFindPlayer(this.firstId));break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[21].text)}},e.prototype.openOtherPlayerView=function(t){this._openOtherWin&&(this._openOtherWin=!1,ViewManager.ins().open(RRoleWin,t))},e.prototype.updatePraise=function(t){var e;if(Rank.ins().rankModel[t].praise.id>0){for(var i=0;3>i;i++)if(e=Rank.ins().rankModel[t].praise.subRole[i]){var s=GlobalConfig.EquipConfig[e.clothID];if(s){var n=s.appearance;n&&n.indexOf("[job]")>-1&&(n=n.replace("[job]",e.job+"")),this["bodyImg"+i].source=(e.clothID>0?n+"_":"body"+e.job+"00_")+e.sex+"_c_png"}else this["bodyImg"+i].source="body000_"+e.sex+"_c_png";var o=GlobalConfig.EquipConfig[e.swordID];if(o){var n=GlobalConfig.EquipConfig[e.swordID].appearance;n&&n.indexOf("[job]")>-1&&(n=n.replace("[job]",e.job+"")),this["weaponImg"+i].source=this.hideWeapon(e.swordID,e.sex)?"":e.swordID>0?n+"_"+e.sex+"_c_png":""}else this["weaponImg"+i].source="";var a=GlobalConfig.WingLevelConfig[e.wingLevel];a?this["wingImg"+i].source=e.wingLevel>=0?a.appearance+"_png":"":this["wingImg"+i].source="",e.pos1>0?(this["bodyImg"+i].source=this.getZhuangbanById(e.pos1).res+"_"+e.sex+"_c_png",DisplayUtils.removeFromParent(this["_bodyEff"+i])):(this["_bodyEff"+i]||(this["_bodyEff"+i]=new MovieClip),this.setWeaponEffect(e.clothID,"bPos"+i+"_",e.sex,this["bodyEffect"+i],this["_bodyEff"+i])),e.pos2>0?(this["weaponImg"+i].source=this.getZhuangbanById(e.pos2).res+"_"+e.sex+"_c_png",DisplayUtils.removeFromParent(this["_weaponEff"+i])):(this["_weaponEff"+i]||(this["_weaponEff"+i]=new MovieClip),this.setWeaponEffect(e.swordID,"wPos"+i+"_",e.sex,this["weaponEffect"+i],this["_weaponEff"+i])),e.pos3>0&&(this["wingImg"+i].source=this.getZhuangbanById(e.pos3).res+"_png")}else this["bodyImg"+i].source="body00_png",this["weaponImg"+i].source="",this["wingImg"+i].source="",this["_weaponEff"+i]&&DisplayUtils.removeFromParent(this["_weaponEff"+i]),this["_bodyEff"+i]&&DisplayUtils.removeFromParent(this["_bodyEff"+i]);this.refushMoBaiStatu()}else for(var i=0;3>i;i++)this["bodyImg"+i].source="body00_png",this["weaponImg"+i].source="",this["wingImg"+i].source="",DisplayUtils.removeFromParent(this["_weaponEff"+i]),DisplayUtils.removeFromParent(this["_bodyEff"+i]);this.updateTab()},e.prototype.updateTab=function(){var t=this.tab.selectedIndex;this.tab.selectedIndex=t},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Actor.level;return 60>i?(UserTips.ins().showTips("60级开启排行榜"),!1):!0},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.hideWeapon=function(t,e){return GlobalConfig.EquipWithEffConfig[t+"_"+e]?!0:!1},e.prototype.setWeaponEffect=function(t,e,i,s,n){var o=GlobalConfig.EquipWithEffConfig[t+"_"+i];o?(n.scaleX=n.scaleY=o.scaling,n.parent||s.addChild(n),n.x=this[e+i].x+o.offX,n.y=this[e+i].y+o.offY,n.playFile(RES_DIR_EFF+o.inShowEff,-1)):n.parent&&n.parent.removeChild(n)},e}(BaseEuiView);__reflect(RankingWin.prototype,"RankingWin"),ViewManager.ins().reg(RankingWin,LayerManager.UI_Main);var RankItemVo=function(){function t(){}return t}();__reflect(RankItemVo.prototype,"RankItemVo");var RankTabItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="BtnTab3Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.labelDisplay.text=this.data.name},e}(BaseItemRender);__reflect(RankTabItemRenderer.prototype,"RankTabItemRenderer");var RRoleAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=[1,2,3,4,5,6,7,AttributeType.atCritEnhance,8,9,10,11,12,13,14,15,16],e.skinName="RoleAttrSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._otherPlayerData=t[1],this.curRole=t[0],this.setRoleAttr(this.curRole);var i=this._otherPlayerData.roleData.length;i>1&&(this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.addTouchEndEvent(this.bg,this.onMove)),this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.closeBtn,this.onClose),this.addTouchEvent(this.bgClose,this.onClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this._otherPlayerData.roleData.length;i>1&&(this.removeTouchEvent(this.leftBtn,this.onTouch),this.removeTouchEvent(this.rightBtn,this.onTouch),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this),this.removeTouchEvent(this.closeBtn,this.onClose),this.removeTouchEvent(this.bgClose,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200)):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200))}},e.prototype.moveAttr=function(t){var e,i=egret.Tween.get(this.attrGroup);e=t>0?0:242,i.to({x:this.attrGroup.x+t,alpha:0},200).to({x:e},200).to({x:80,alpha:1},200)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.leftBtn:this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200));break;case this.rightBtn:this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200))}},e.prototype.setRoleAttr=function(t){var e=this._otherPlayerData.roleData[t];this.job.source="op_"+e.job;for(var i="",s=0,n=0,o=0;o<this.proShowList.length;o++){if(n=this.proShowList[o],s=e.attributeData[n],n>1&&9>n)i+=7==n||8==n?s/100+"%":s;else{if(!(n>12&&15>n||n>15))continue;n==AttributeType.atCritEnhance&&(s+=e.getAtt(AttributeType.atHuiXinDamage),s+=1e4),i+=s/100+"%"}o<this.proShowList.length-1&&(i+="\n")}this.attr.text=i,this.setBtn()},e.prototype.setBtn=function(){var t=this._otherPlayerData.roleData.length;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,3>t?this.rightBtn.visible=!1:this.rightBtn.visible=!0):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(RRoleAttrWin.prototype,"RRoleAttrWin"),ViewManager.ins().reg(RRoleAttrWin,LayerManager.UI_Popup);var RRoleInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.beforeIndex=-1,e.name="角色",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.touchEnabled=!1,this.touchChildren=!0,this.groupRole.touchEnabled=!1,this.groupRoleNext.touchEnabled=!1,this.groupRole.touchChildren=!1,this.groupRoleNext.touchChildren=!1,this.equips=[];for(var t=0;t<EquipPos.MAX;t++)this.equips[t]=this["item"+t],this.equips[t].touchEnabled=!0,this.equips[t].isShowJob(!1),this.equips[t].isShowTips(!1);this.suitEff1=new MovieClip,this.suitEff1.x=this.suitImg.x,this.suitEff1.y=this.suitImg.y,this.suitEff=new MovieClip,this.suitEff5=new MovieClip,this.suitEff6=new MovieClip,this.suitEff7=new MovieClip,this.suitEff8=new MovieClip,this.suitEff9=new MovieClip,this.suitEff10=new MovieClip},e.prototype.clear=function(){this.beforeIndex=-1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._otherPlayerData=t[0],this.addTouchEvent(this.roleInfoItem0,this.onClick),this.addTouchEvent(this.roleInfoItem1,this.onClick),this.addTouchEvent(this.juesexiangxi,this.onClick),this.updateRing(),this.updataEquip(!1),this.updateSamsaraEquip(),this.clearChangeEff(),-1!=this.beforeIndex?this.roleChange(this.beforeIndex,this.curRole):(this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setSuit(this.curRole,this.suitImg,this.suitEff1),this.setWing()),this.beforeIndex=this.curRole},e.prototype.close=function(){egret.Tween.removeTweens(this.groupRole),egret.Tween.removeTweens(this.groupRoleNext),DisplayUtils.removeFromParent(this.suitEff),DisplayUtils.removeFromParent(this.suitEff5),DisplayUtils.removeFromParent(this.suitEff6),DisplayUtils.removeFromParent(this.suitEff7),DisplayUtils.removeFromParent(this.suitEff8),DisplayUtils.removeFromParent(this.suitEff9),DisplayUtils.removeFromParent(this.suitEff10),this.roleInfoItem0.destory(),this.roleInfoItem1.destory(),TimerManager.ins().remove(this.hideZhanling,this),TimerManager.ins().remove(this.playZhanLingAttack,this),TimerManager.ins().remove(this.startShowZhanling,this)},e.prototype.clearChangeEff=function(){egret.Tween.removeTweens(this.groupRole),egret.Tween.removeTweens(this.groupRoleNext),this.groupRole.x=0,this.groupRoleNext.x=580,this.groupRole.alpha=1,this.groupRoleNext.alpha=0,this.groupRoleNext.visible=!1,this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setSuit(this.curRole,this.suitImg,this.suitEff1),this.setWing(this.curRole,this.wingImg)},e.prototype.roleChange=function(t,e){if(t==e)return void this.clearChangeEff();this.groupRoleNext.visible=!0,this.setWing(t,this.wingImg),this.setWing(e,this.nextWingImg),this.setSuit(t,this.suitImg,this.suitEff1),this.setRole(t,this.bodyImg,this.weaponImg),this.setRole(e,this.nextBodyImg,this.nextWeaponImg),this.setWeaponEffect(t,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(e,"nwsef",this.nsoulEff,this.suitEff6),this.setWeaponEffect(t,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setWeaponEffect(e,"nbodyEffect",this.nbodyEff,this.suitEff8,2);var i=egret.Tween.get(this.groupRole),s=egret.Tween.get(this.groupRoleNext);e>t?(this.groupRoleNext.x=580,i.to({x:-580,alpha:0},600),s.to({x:0,alpha:1},600).call(this.clearChangeEff,this)):(this.groupRoleNext.x=-580,i.to({x:580,alpha:0},600),s.to({x:0,alpha:1},600).call(this.clearChangeEff,this))},e.prototype.updateRing=function(){var t=this._otherPlayerData.roleData[this.curRole].exRingsData;t[0]>0?(this.roleInfoItem0.setImgSource(0,1),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality4")):(this.roleInfoItem0.setImgSource(0,0),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality0")),t[1]>0?(this.roleInfoItem1.setImgSource(1,1),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality4")):(this.roleInfoItem1.setImgSource(1,0),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality0"))},e.prototype.updataEquip=function(t){void 0===t&&(t=!0);var e=this._otherPlayerData.roleData[this.curRole];this.setEquip(e)},e.prototype.updateSamsaraEquip=function(){for(var t=this._otherPlayerData.zhuan,e=this._otherPlayerData.level,i=1e3*t+e,s=i>=GlobalConfig.ReincarnationBase.openLevel,n=9;13>n;n++)this["item"+n].visible=s},e.prototype.setEquip=function(t){if(t){var e=t.getEquipLen();this.weaponImg.source="";for(var i=0;e>i;i++){var s=t.getEquipByIndex(i);if(this.equips[i].setModel(t),this.equips[i].setIndex(i),this.equips[i].data=s.item,0==s.item.configID?(this.equips[i].setItemImg(i>EquipPos.MAX?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[i]),this.equips[i].isShowTips(!1)):this.equips[i].isShowTips(!0),i>=EquipPos.HAT&&i<=EquipPos.SHIELD)s.soulLv>0?this["item"+i].setSoul(!0):this["item"+i].setSoul(!1);else if(i>=EquipPos.WEAPON&&i<=EquipPos.SHOE){var n=this["item"+i].getItemIcon();n.extreme.visible=ExtremeEquipModel.ins().getZhiZunLvByRoleID(t,i)>0}}this.powerPanel.setPower(t.power),this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)}},e.prototype.setRole=function(t,e,i){e.source=null,i.source=null;var s,n=this._otherPlayerData.roleData[t],o=n.zhuangbei,a=o[0],r=o[1],h=n.getEquipByIndex(0),l=h.item.configID,c=n.getEquipByIndex(2),u=c.item.configID,p=n.getEquipByIndex(0).item.configID;if(l>0){var d=GlobalConfig.EquipConfig[l].appearance;d&&d.indexOf("[job]")>-1&&(d=d.replace("[job]",n.job+"")),i.source=GlobalConfig.EquipWithEffConfig[p+"_"+n.sex]?null:d+"_"+n.sex+"_c_png"}if(u>0){var d=GlobalConfig.EquipConfig[u].appearance;d&&d.indexOf("[job]")>-1&&(d=d.replace("[job]",n.job+"")),e.source=d+"_"+n.sex+"_c_png",s=!0}s||(e.source="body000_"+n.sex+"_c_png"),r>0&&(i.source=this.getZhuangbanById(r).res+"_"+n.sex+"_c_png"),a>0&&(e.source=this.getZhuangbanById(a).res+"_"+n.sex+"_c_png"),this.setWeaponsSuit(n)},e.prototype.setSuit=function(t,e,i){DisplayUtils.removeFromParent(i);var s=this._otherPlayerData.roleData[t],n=s.heirloom.getSuitConfig(s);if(n){i.parent||e.parent.addChildAt(i,e.parent.getChildIndex(e));var o=GlobalConfig.HeirloomEquipSetConfig[n.lv];i.playFile(RES_DIR_EFF+o.neff,-1)}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.onClick=function(t){switch(t.currentTarget){case this.juesexiangxi:ViewManager.ins().open(RRoleAttrWin,this.curRole,this._otherPlayerData);break;case this.roleInfoItem0:ViewManager.ins().open(RSpecialRingWin,0,this.curRole,this._otherPlayerData);break;case this.roleInfoItem1:ViewManager.ins().open(RSpecialRingWin,1,this.curRole,this._otherPlayerData)}},e.prototype.setWing=function(t,e){void 0===t&&(t=this.curRole),void 0===e&&(e=this.wingImg),e.source=null;var i=this._otherPlayerData.roleData[t].wingsData,s=this._otherPlayerData.roleData[this.curRole].zhuangbei[2];s>0?e.source=GlobalConfig.ZhuangBanId[s].res+"_png":i.openStatus?e.source=GlobalConfig.WingLevelConfig[i.lv].appearance+"_png":e.source=""},e.prototype.setWeaponsSuit=function(t){var e=t.weapons.weaponsId,i=t.hideWeapons();if(!i&&e){this.suitEff.x=this["sef"+t.job].x,this.suitEff.y=this["sef"+t.job].y,this.suitEff.rotation=this["sef"+t.job].rotation,this.suitEff.parent||this.soulEff.addChild(this.suitEff);var s=GlobalConfig.WeaponSoulConfig[e];this.suitEff.playFile(RES_DIR_EFF+s.inside[t.job-1],-1)}else this.suitEff.parent&&this.suitEff.parent.removeChild(this.suitEff)},e.prototype.setWeaponEffect=function(t,e,i,s,n){void 0===n&&(n=0);var o=this._otherPlayerData.roleData[t],a=o.getEquipByIndex(n).item.configID,r=GlobalConfig.EquipWithEffConfig[a+"_"+o.sex];DisplayUtils.removeFromParent(s);var h=o.zhuangbei,l=s;l==this.suitEff5?0==o.sex?DisplayUtils.removeFromParent(this.suitEff9):l=this.suitEff9:l==this.suitEff6&&(0==o.sex?DisplayUtils.removeFromParent(this.suitEff10):l=this.suitEff10),r&&(0==n&&h[1]<=0||2==n&&h[0]<=0)?(l.x=this[e+o.sex].x+r.offX,l.y=this[e+o.sex].y+r.offY,l.rotation=this[e+o.sex].rotation,l.scaleX=l.scaleY=r.scaling,l.playFile(RES_DIR_EFF+r.inShowEff,-1),i.addChild(l)):DisplayUtils.removeFromParent(l)},e.prototype.showZhanling=function(t){var e=t.zhanlingID,i=t.zhanlingLevel;if(!(0>i)){var s=GlobalConfig.ZhanLingLevel[e][i];this.fileName=s.appearance,this.warMc||(this.warMc=new MovieClip,this.warMc.x=190,this.warMc.y=220,this.powerPanel.addChildAt(this.warMc,1),this.warMc.playFile(RES_DIR_MONSTER+this.fileName+"_4s",-1),this.warMc.touchEnabled=!1);var n=GlobalConfig.ZhanLingConfig.anchorOffset||[];this.warMc.anchorOffsetX=n[0]||0,this.warMc.anchorOffsetY=n[1]||0,TimerManager.ins().remove(this.startShowZhanling,this),TimerManager.ins().doTimer(200,1,this.playZhanLingAttack,this)}},e.prototype.playZhanLingAttack=function(){var t=this;if(this.warMc){var e=RES_DIR_MONSTER+this.fileName+"_4"+EntityAction.ATTACK;this.warMc.playFile(e,1,function(){var e=RES_DIR_MONSTER+t.fileName+"_4"+EntityAction.STAND;t.warMc.playFile(e,-1,null,!1),TimerManager.ins().remove(t.playZhanLingAttack,t),TimerManager.ins().doTimer(2800,1,t.hideZhanling,t)},!1)}},e.prototype.hideZhanling=function(){var t=this;this.warMc&&egret.Tween.get(this.warMc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){t.powerPanel.removeChild(t.warMc),t.warMc.destroy(),t.warMc=null,TimerManager.ins().remove(t.hideZhanling,t),TimerManager.ins().doTimer(7e3,1,t.startShowZhanling,t)})},e.prototype.startShowZhanling=function(){this.showZhanling(this._otherPlayerData)},e}(BaseView);__reflect(RRoleInfoPanel.prototype,"RRoleInfoPanel");var RRoleSelectPanel=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.skinName="RoleSelectPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.roles=[this.role0,this.role1,this.role2]},e.prototype.open=function(){this.setCurRole(0),this.addTouchEvent(this,this.onClick)},Object.defineProperty(e.prototype,"otherPlayerData",{set:function(t){this._otherPlayerData=t,this.updateRole()},enumerable:!0,configurable:!0}),e.prototype.getCurRole=function(){return this._curRole},e.prototype.setCurRole=function(t){this._curRole=t;for(var e=0;e<this.roles.length;e++){var i=this.roles[e];i.selected=e==t}this.dispatchEventWith(egret.Event.CHANGE,!1,this._curRole)},e.prototype.onClick=function(t){var e=this.roles.indexOf(t.target);if(e>-1){var i=t.target;this._otherPlayerData.roleData[e]?this.setCurRole(e):i.selected=!1}},e.prototype.updateRole=function(){for(var t,e,i=0;i<this.roles.length;i++)t=this.roles[i],e=this._otherPlayerData.roleData[i],e?(t.jobImg.visible=!0,t.jobImg.source="job"+e.job+"Item",t.icon="yuanhead"+e.job+e.sex):(t.icon="",t.jobImg.visible=!1)},e.prototype.close=function(){this.removeTouchEvent(this,this.onClick)},e}(BaseView);__reflect(RRoleSelectPanel.prototype,"RRoleSelectPanel");var RRoleWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="RRoleWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.viewStack.selectedIndex=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.otherPlayerData=t[0],this.roleSelect.otherPlayerData=this.otherPlayerData,this.nameTxt.text=this.otherPlayerData.name,this.roleSelect.open(),this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(PeakedSys.ins().postSignUp,this.upLikeDt),this.roleSelect.setCurRole(0),this.setRoleInfo(),this.upLikeDt(),this.roleInfoPanel.showZhanling(this.otherPlayerData)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onClick),this.roleInfoPanel.clear(),this.closeFun&&this.closeFun()},e.prototype.destoryView=function(){t.prototype.destoryView.call(this),this.roleSelect.close(),this.roleInfoPanel.close()},e.prototype.upLikeDt=function(){this.likeBtn&&(this.likeBtn.enabled=PeakedSys.ins().kideNum<GlobalConfig.PeakRaceBase.likeCount&&PeakedRedpoint.ins().redpoint2>0)},e.prototype.setRoleInfo=function(){var t=this,e=this.otherPlayerData.roleData[0],i="[S"+this.otherPlayerData.serverId+"]";this.otherPlayerData.serverId&&this.otherPlayerData.serverId!=LocationProperty.srvid||(i=""),this.nameTxt.text=this.otherPlayerData.name+i,egret.callLater(function(){t.guildNameText.x=t.nameTxt.x+t.nameTxt.textWidth+10},this),this.guildNameText.text=this.otherPlayerData.guildName?"公会："+this.otherPlayerData.guildName:"";var s=this.otherPlayerData.zhuan?this.otherPlayerData.zhuan+"转":"";this.levelText.text=""+s+this.otherPlayerData.level+"级",this.headIcon.source="head_"+e.job+e.sex;var n=this.otherPlayerData.lilianLv,o=GlobalConfig.TrainLevelConfig[n];this.jueweiIcon.source="juewei_1_"+o.type+"_png"},e.prototype.onChange=function(t){this.setView(this.roleSelect.getCurRole())},e.prototype.setView=function(t){void 0===t&&(t=0),this.roleInfoPanel.curRole=this.roleSelect.getCurRole(),this.roleInfoPanel.open(this.otherPlayerData)
},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);var e=ViewManager.ins().getView(UIView2);e&&e.closeNav(UIView2.NAV_ROLE);break;case this.likeBtn:PeakedSys.ins().isKf()?PeakedSys.ins().sendKFToLikes(this.otherPlayerData.id):PeakedSys.ins().sendToLikes(this.otherPlayerData.id)}},e.prototype.hideEx=function(t){switch(void 0===t&&(t=1),t){case 1:this.roleInfoPanel.juesexiangxi.visible=!1,this.roleInfoPanel.powerPanel.visible=!1,this.likeBtn&&(this.likeBtn.visible=!0);break;case 2:this.roleInfoPanel.juesexiangxi.visible=!1,this.roleInfoPanel.powerPanel.visible=!1,this.likeBtn&&(this.likeBtn.visible=!1)}},e}(BaseEuiView);__reflect(RRoleWin.prototype,"RRoleWin"),ViewManager.ins().reg(RRoleWin,LayerManager.UI_Main);var RSpecialRingWin=function(t){function e(){var e=t.call(this)||this;return e.ringLv=0,e.skinName="RingTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.iconMc=new MovieClip,this.iconMc.x=170,this.iconMc.y=160,this.gainList0.itemRenderer=RingGainItem,this.btnUse.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],null==t[1]&&(t[1]=0),this._otherPlayerData=t[2],this.roleSelect.setCurRole(t[1]),this.iconMc&&!this.iconMc.parent&&this.mcGroup.addChild(this.iconMc),this.addTouchEvent(this.colorCanvas0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addChangeEvent(this.roleSelect,this.roleChange),this.gainList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);var i=GlobalConfig.ExRingConfig[this.index],s=GlobalConfig.GainItemConfig[i.costItem];this.gainList0.dataProvider=new eui.ArrayCollection(s.gainWay),this.roleChange()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.colorCanvas0,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.roleSelect.removeEventListener(egret.Event.CHANGE,this.roleChange,this),this.gainList0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),DisplayUtils.removeFromParent(this.iconMc),this.removeObserve()},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&GameGuider.guidance(e[1],e[2],!0)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this)}},e.prototype.showIcon=function(){var t=this.index?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+t,-1)},e.prototype.roleChange=function(t){void 0===t&&(t=!1);var e=this.roleSelect.getCurRole();this.ringLv=this._otherPlayerData.roleData[e].getExRingsData(this.index),this.showIcon();var i=GlobalConfig.ExRingConfig[this.index],s=(GlobalConfig["ExRing"+this.index+"Config"][0],GlobalConfig["ExRing"+this.index+"Config"][1]);if(0==this.ringLv?(this.currentState="lock",this.tips.source="tjweijihuo"):(this.currentState="actived",this.tips.source="tjyijihuo"),s){for(var n="",o=0,a=0,r=0,h="",l=0;l<s.attrAward.length;l++)a=s.attrAward[l].type,15!=a&&13!=a&&(n=AttributeData.getAttrStrByType(a),o=s.attrAward[l].value,n.length<3&&(n=AttributeData.inserteBlank(n,7)),this["attr"+r].text=n+"：",a>1&&9>a?h=7==a||8==a?o/100+"%":o.toString():(a>12&&15>a||a>15)&&(h=a==AttributeType.atCritEnhance?o/100+150+"%":o/100+"%"),this["value"+r].text=h,r++);var c=UserBag.getAttrPower(s.attrAward);this.powerPanel.setPower(c),this.powerPanel.setMcVisible(!1),this.validateNow();var u=GlobalConfig.ItemConfig[i.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(u.desc),this.nameLabel.text=""+i.name}},e}(BaseEuiView);__reflect(RSpecialRingWin.prototype,"RSpecialRingWin"),ViewManager.ins().reg(RSpecialRingWin,LayerManager.UI_Main);var Recharge=function(t){function e(){var e=t.call(this)||this;return e._rechargeData=[],e.flag=0,e.forevetCard=0,e.recharge_type=0,e.franchiseflag=0,e.franchiseget=0,e.firstBuy=0,e.sysId=PackageID.Recharge,e.regNetMsg(1,e.postRecharge1Data),e.regNetMsg(2,e.changeRecharge1Data),e.regNetMsg(6,e.getRecharge2Data),e.regNetMsg(7,e.changeRecharge2Data),e.regNetMsg(8,e.postUpDataItem),e.regNetMsg(9,e.postRechargeTotalDay),e.regNetMsg(20,e.postGetMonthDay),e.regNetMsg(11,e.postFranchiseInfo),e.regNetMsg(12,e.postMuchDayRecReward),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRechargeData=function(t){return void 0===t&&(t=-1),-1==t?this._rechargeData:this._rechargeData[t]||new RechargeData},e.prototype.getCurRechargeConfig=function(){var t=this.getRechargeData(0),e=CommonUtils.getObjectLength(GlobalConfig.DailyRechargeConfig);if(t.day<=e)return GlobalConfig.DailyRechargeConfig[t.day];var i=t.day-e;return e=CommonUtils.getObjectLength(GlobalConfig.LoopRechargeConfig),i=i%e||e,GlobalConfig.LoopRechargeConfig[i]},e.prototype.getCurDailyRechargeIsAllGet=function(){for(var t=e.ins().getRechargeData(0),i=e.ins().getCurRechargeConfig(),s=CommonUtils.getObjectLength(i),n=0;s>n;n++){var o=t.isAwards>>n&1?!0:!1;if(!o)return!1}return!0},e.prototype.sendGetAwards=function(t,e){var i=this.getBytes(0==t?2:7);i.writeShort(e),this.sendToServer(i)},e.prototype.postRecharge1Data=function(t){this.recharge(t,0)},e.prototype.changeRecharge1Data=function(){var t=this.getBytes(2);this.sendToServer(t)},e.prototype.postUpdateRechargeEx=function(t){return{type:t}},e.prototype.postUpdateRecharge=function(t){return t},e.prototype.getDayReward=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.getRecharge2Data=function(t){},e.prototype.changeRecharge2Data=function(t){var i=this.getRechargeData(1);i&&(i.change(t),e.ins().postUpdateRecharge(1))},e.prototype.getRechargeTotalAward=function(t){var e=this.getBytes(8);e.writeShort(t),this.sendToServer(e)},e.prototype.recharge=function(t,i){if(this._rechargeData[i]||(this._rechargeData[i]=new RechargeData),this._rechargeData[i].parser(t,i),0==i){var s=e.ins().getCurDailyRechargeIsAllGet();s&&ViewManager.ins().close(Recharge2Win)}e.ins().postUpdateRechargeEx(i),this.recharge_type=i},e.prototype.postUpDataItem=function(t){this.costList=t.readInt()},e.prototype.postRechargeTotalDay=function(t){this.rechargeTotal={},this.rechargeTotal.hasGetDays=[];for(var e=t.readShort(),i=0;e>i;i++)this.rechargeTotal.hasGetDays.push(t.readShort());this.rechargeTotal.totalDay=t.readShort()},e.prototype.postGetMonthDay=function(t){var e=t.readUnsignedInt();e>0?this.monthDay=e:this.monthDay=0,e>0&&(this.flag=2),this.forevetCard=t.readInt(),!Setting.ins().getValue(ClientSet.firstMonthCard)&&(this.monthDay>0||this.getIsForeve())&&Setting.ins().setValue(ClientSet.firstMonthCard,1)},e.prototype.getOrderByIndex=function(t){void 0===t&&(t=0);var e=this.costList>>t&1;return e},Object.defineProperty(e.prototype,"monthDay",{get:function(){return this._monthDay},set:function(t){this._monthDay!=t&&(this._monthDay=t,TimerManager.ins().remove(this.downTime,this),this._monthDay>0&&TimerManager.ins().doTimer(1e3,this._monthDay,this.downTime,this))},enumerable:!0,configurable:!0}),e.prototype.downTime=function(){this._monthDay-=1},e.prototype.getAddBagGrid=function(){return this.monthDay>0?100:0},e.prototype.getAddBagFranchiseGrid=function(){return this.franchise>0?100:0},e.prototype.showReCharge=function(t){return OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE)?(WarnWin.show("正在拉起支付...\n如果长时间无响应，请尝试刷新网页重新购买",function(){},this)+window.open("/lt/zf", function () {}, this),void(window.showRecharge?window.showRecharge(t,Actor.actorID,{actorName:Actor.myName,actorLevel:Actor.level}):(alert("未接入支付接口"),ViewManager.ins().close(WarnWin)))):void UserTips.ins().showTips("充值已屏蔽")},e.prototype.getIsForeve=function(){return 2==e.ins().forevetCard},e.prototype.sendGetFranchise=function(){this.sendBaseProto(10)},e.prototype.postFranchiseInfo=function(t){var e=t.readUnsignedInt();e>0?this.franchise=e:this.franchise=0,this.franchiseget=t.readByte(),this.firstBuy=t.readByte()},Object.defineProperty(e.prototype,"franchise",{get:function(){return this._franchise},set:function(t){this._franchise!=t&&(this._franchise=t,TimerManager.ins().remove(this.franchiseTime,this),this._franchise>0&&TimerManager.ins().doTimer(1e3,this._franchise,this.franchiseTime,this))},enumerable:!0,configurable:!0}),e.prototype.franchiseTime=function(){this._franchise-=1},e.prototype.getRechargeList=function(){var t=GlobalConfig.RechargeDaysAwardsConfig,i=[],s={},n={};for(var o in t)s[t[o].sum]||(s[t[o].sum]=[]),n[t[o].sum]||(n[t[o].sum]=0),e.ins().rechargeTotal.hasGetDays.indexOf(t[o].id)>=0&&n[t[o].sum]++,s[t[o].sum].push(t[o]);for(var o in n){if(i.length)break;if(!(n[o]>=CommonUtils.getObjectLength(s[o])))for(var a in s[o])i.push(s[o][a])}return i},e.prototype.sendMuchDayRecReward=function(){this.sendBaseProto(11)},e.prototype.postMuchDayRecReward=function(t){this.mRecNum=t.readInt(),this.mReward=t.readByte(),this.mDayNum=t.readShort()},e}(BaseSystem);__reflect(Recharge.prototype,"Recharge");var RechargeData=function(){function t(){}return t.prototype.parser=function(t,e){this.day=t.readShort()+1,this.curDayPay=t.readInt(),this.num=t.readInt(),this.isAwards=t.readInt()},t.prototype.change=function(t){this.num=t.readInt(),this.isAwards=t.readInt()},t.checkOpenWin=function(){var t=Recharge.ins().getRechargeData(0);t&&t.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win)},t}();__reflect(RechargeData.prototype,"RechargeData");var GameSystem;!function(t){t.recharge=Recharge.ins.bind(Recharge)}(GameSystem||(GameSystem={}));var RechargeRewardData=function(){function t(){}return t}();__reflect(RechargeRewardData.prototype,"RechargeRewardData");var ChargeFirstWin=function(t){function e(){var e=t.call(this)||this;return e.barbc=new ProgressBarEff,e.skinName="ChargeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.list.itemRenderer=ChargeItemRenderer,this.scrollBar.viewport=this.list;var e=GlobalConfig.RechargeItemsConfig,i=[];for(var s in e)i.push(e[s]);this.list.dataProvider=new eui.ArrayCollection(i),this.barbc.setWidth(340),this.barbc.x=80,this.barbc.y=12,this.topGroup.addChild(this.barbc),this.vipValue=BitmapNumber.ins().createNumPic(0,"vip_v",5),this.vipValue.x=36,this.vipValue.y=39,this.vipGroup.addChild(this.vipValue)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.vipBtn,this.onTap),this.observe(Recharge.ins().postUpDataItem,this.refushInfo),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.barbc.reset(),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.vipBtn,this.onTap),this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.removeObserve()},e.prototype.onListTap=function(t){var e=t.item;Recharge.ins().showReCharge(e.id)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.vipBtn:ViewManager.ins().open(VipWin)}},e.prototype.refushInfo=function(){for(var t=this.list.dataProvider,e=0;e<t.length;e++){var i=t.getItemAt(e);t.itemUpdated(i)}this.setView()},e.prototype.setView=function(){var t=UserVip.ins().lv,e=GlobalConfig.VipConfig[t+1],i=0,s="",n=UserVip.ins().exp;if(e){i=e.needYb-n;s="再充值|C:0xFFAA24&T:"+i+"元宝|成为|C:0xFFAA24&T:VIP"+(t+1)+"|",this.barbc.setData(n,e.needYb)}else s="VIP等级已满",this.barbc.max();BitmapNumber.ins().changeNum(this.vipValue,t,"vip_v",3),10>t?(this.vipValue.x=36,this.vipValue.y=39):(this.vipValue.x=26,this.vipValue.y=39),this.tipsText.textFlow=TextFlowMaker.generateTextFlow(s)},e}(BaseEuiView);__reflect(ChargeFirstWin.prototype,"ChargeFirstWin"),ViewManager.ins().reg(ChargeFirstWin,LayerManager.UI_Popup);var ChargeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChargeItemSkin",e.totalPower=BitmapNumber.ins().createNumPic(0,"vip_v",5),e.totalPower.x=0,e.totalPower.y=0,e.moneyGroup.addChild(e.totalPower),e}return __extends(e,t),e.prototype.dataChanged=function(){this.refushInfo()},e.prototype.refushInfo=function(){this.gain0.text=this.data.itemName,this.gain1.text=this.data.desc,this.yuanbaoImg.source=this.data.icon;var t=this.data.cash;this.pay.text="￥"+t,Recharge.ins().getOrderByIndex(this.data.id)?BitmapNumber.ins().changeNum(this.totalPower,this.data.amount,"vip_v",3):BitmapNumber.ins().changeNum(this.totalPower,this.data.award,"vip_v",3),this.moneyGroup.width=this.totalPower.width,this.invalidateState()},e.prototype.getCurrentState=function(){var t="up";return Recharge.ins().getOrderByIndex(this.data.id)?this.selected&&(t="down"):(t="firstUp",this.selected&&(t="fistDown")),t},e}(BaseItemRender);__reflect(ChargeItemRenderer.prototype,"ChargeItemRenderer");var ChargeTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChargeTipsSkin"},e}(BaseEuiView);__reflect(ChargeTipsWin.prototype,"ChargeTipsWin"),ViewManager.ins().reg(ChargeTipsWin,LayerManager.UI_Tips);var Recharge1Win=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.setSkinName(),this.btnArr=[];for(var e=0;4>e;e++)this.btnArr.push(this["chong"+e]);this.eff=new MovieClip,this.eff.x=this.buyed.x+77,this.eff.y=this.buyed.y+32,this.eff.scaleX=1.15,this.eff.scaleY=1.5,this.eff.touchEnabled=!1},e.prototype.setSkinName=function(){this.skinName="FirstChargeSkin"},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE))return UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.FIRSTCHARGE)),!1;var i=Recharge.ins().getRechargeData(0);if(!t[0]){if(2==i.num){var s=Recharge.ins().getCurDailyRechargeIsAllGet();return s?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge2Win),!1}return!0}return 2==i.num?(ViewManager.ins().open(t[0][0]),!1):!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.closeCB),this.addTouchEvent(this.buyed,this.onTouch);for(var i=0;i<this.btnArr.length;i++)this.addTouchEvent(this.btnArr[i],this.onTouch);this.observe(Recharge.ins().postUpdateRechargeEx,this.setWinData);var s=ViewManager.ins().getView(PlayFunView);s&&(s.preRecharge=s.recharge.visible=!1);var n=SubRoles.ins().getSubRoleByIndex(0).job,o=this.getRechargeRewardDatas(n);if(o)for(var a=0;a<o.length;a++){var r=o[a],h={id:r.id,type:r.type,count:r.count};this["item"+(a+1)].data=h}var l=GlobalConfig.FirstRechargeClientConfig;for(var c in l)if(l[c].job==n){this.weapImg.source=l[c].weaponshow+"_png",this.roleImg.source=l[c].bodyshow+"_png";break}var u=0;for(var c in GlobalConfig.FirstRechargeConfig){var p=GlobalConfig.FirstRechargeConfig[c];this.btnArr[u].rmb.text=p.paydesc,this.btnArr[u].yuanbao.text=p.payReturn,this.btnArr[u].money=p.pay,u++}this.setWinData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.eff),egret.Tween.removeTweens(this),this.cleanEff()},e.prototype.closeCB=function(t){ViewManager.ins().close(this)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.buyed:if(UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);Recharge.ins().changeRecharge1Data();break;default:for(var e=0;4>e;e++)if(t.currentTarget==this.btnArr[e]){var i=this.btnArr[e].money;for(var s in GlobalConfig.RechargeItemsConfig)if(i==GlobalConfig.RechargeItemsConfig[s].amount){Recharge.ins().showReCharge(GlobalConfig.RechargeItemsConfig[s].id);break}break}}},e.prototype.onBtnTouch=function(t){this.btnArr.indexOf(t.target)},e.prototype.onTabTouch=function(t){t.currentTarget.selectedIndex!=this._index&&(this._index=t.currentTarget.selectedIndex,this.setWinData())},e.prototype.setEff=function(t){switch(t){case 0:break;case 1:this.cleanEff()}},e.prototype.cleanEff=function(){for(var t=0;6>t;t++)egret.Tween.removeTweens(this["item"+(t+1)])},e.prototype.setWinData=function(t){var i=this,s=t?t.type:Recharge.ins().recharge_type;if(this._data=Recharge.ins().getRechargeData(s),this._data.num){if(1==this._data.num){this.buyed.visible=!0,this.unbuy.visible=!1;for(var n=0;6>n;n++)this["item"+(n+1)].visible=!0;this.eff.parent||(this.buyGroup.addChild(this.eff),this.eff.x=this.buyed.width/2,this.eff.y=this.buyed.height/2,this.eff.touchEnabled=this.buyGroup.touchEnabled=!1,this.eff.playFile(RES_DIR_EFF+"chongzhi",-1)),this.setEff(0)}else if(2==this._data.num){this.buyed.visible=!1,this.unbuy.visible=!1,DisplayUtils.removeFromParent(this.eff),this.cleanEff();for(var o=ViewManager.ins().getView(UIView2),a=o.getBagBtn(),r=function(t){var e=egret.Tween.get(h["item"+(t+1)]);e.to({x:a.x,y:a.y},1e3).call(function(){i["item"+(t+1)].visible=!1})},h=this,n=0;5>n;n++)r(n);var l=egret.Tween.get(this);l.wait(1e3).call(function(){ViewManager.ins().close(e)})}}else{this.buyed.visible=!1,this.unbuy.visible=!0;for(var n=0;6>n;n++)this["item"+(n+1)].visible=!0;DisplayUtils.removeFromParent(this.eff),this.setEff(0)}},e.prototype.getRechargeRewardDatas=function(t){var e=GlobalConfig.FirstRechargeClientConfig;for(var i in e)if(e[i].job==t){var s=e[i].RechargeRewardData;return s}return null},e.prototype.getRemindByIndex=function(t){return 1==(Recharge.ins().getRechargeData(0).isAwards>>t&1)},e}(BaseEuiView);__reflect(Recharge1Win.prototype,"Recharge1Win"),ViewManager.ins().reg(Recharge1Win,LayerManager.UI_Main);var Recharge2Win=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyChargeSkin2",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.totalPower=BitmapNumber.ins().createNumPic(0,"vip_v",5),this.totalPower.x=0,this.totalPower.y=0,this.moneyGroup.addChild(this.totalPower),this.eff=new MovieClip,this.eff.x=this.goUpBtn.x+103,this.eff.y=this.goUpBtn.y+24,this.eff.scaleX=1.45,this.eff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.goUpBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Recharge.ins().postUpdateRechargeEx,this.setWinData);var i=ViewManager.ins().getView(PlayFunView);i&&(i.preRecharge=i.recharge.visible=!1),this.setWinData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.goUpBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),DisplayUtils.removeFromParent(this.eff),egret.Tween.removeTweens(this),this.removeObserve()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(e);break;case this.goUpBtn:"领取大礼包"==this.goUpBtn.label?this.currData&&this.getReward():"充点小钱玩玩"==this.goUpBtn.label&&ViewManager.ins().open(ChargeFirstWin)}},e.prototype.getReward=function(){this.playGet(void 0,this.currData),Recharge.ins().getDayReward(this.currData.index)},e.prototype.playGet=function(t,e){for(var i=ViewManager.ins().getView(UIView2),s=i.getBagBtn(),n=s.x-50,o=s.y-this.mainGroup.y-110,a=function(t){var e=new ItemBase;e.data=r["item"+(t+1)].data,e.x=r["item"+(t+1)].x,e.y=r["item"+(t+1)].y,r["item"+(t+1)].parent.addChild(e);var i=egret.Tween.get(e);i.to({x:n,y:o,scaleX:0,scaleY:0},500).call(function(){DisplayUtils.removeFromParent(e)})},r=this,h=0;4>h;h++)a(h)},e.prototype.setWinData=function(){var t=Recharge.ins().getRechargeData(0),e=Recharge.ins().getCurRechargeConfig();this.currData=null;var i=Number.MAX_VALUE;for(var s in e){var n=t.isAwards>>e[s].index&1;!n&&i>e[s].pay&&(i=e[s].pay,this.currData=e[s])}if(this.currData||(this.currData=e[0]),this.currData){var o=this.currData.pay-t.curDayPay;o>0?(this.goUpBtn.label="充点小钱玩玩",DisplayUtils.removeFromParent(this.eff)):(this.goUpBtn.label="领取大礼包",this.eff.parent||(this.goUpBtn.parent.addChildAt(this.eff,this.getChildIndex(this.goUpBtn)),this.eff.playFile(RES_DIR_EFF+"chongzhi",-1))),this.setItem(),BitmapNumber.ins().changeNum(this.totalPower,0>o?0:o,"vip_v",3)}this.initPos()},e.prototype.setItem=function(){for(var t=0;t<this.currData.awardList.length;t++){var e=this.currData.awardList[t];this["item"+(t+1)].data=e,this["item"+(t+1)].visible=!0,this["item"+(t+1)].scaleX=this["item"+(t+1)].scaleY=1,this["item"+(t+1)].x=90*t,this["item"+(t+1)].y=0}},e.prototype.initPos=function(){this.totalPower.x=(this.moneyGroup.width-this.totalPower.width)/2},e}(BaseEuiView);__reflect(Recharge2Win.prototype,"Recharge2Win"),ViewManager.ins().reg(Recharge2Win,LayerManager.UI_Popup);var Recharge3Win=function(t){function e(){var e=t.call(this)||this;return e._oneDay=DateUtils.HOURS_PER_DAY*DateUtils.SECOND_PER_HOUR,e.activityID=20,e.stateDic={},e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="TotalChargeActSkin",this.name="累计充值",this.list.itemRenderer=TotalChargeActItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setWinData(),this.observe(Recharge.ins().postUpdateRecharge,this.setWinData),this.addTouchEvent(this.recharge,this.onTabTouch)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.recharge,this.onTabTouch),this.removeObserve()},e.prototype.onTabTouch=function(t){switch(t.currentTarget){case this.recharge:ViewManager.ins().open(ChargeFirstWin)}},e.prototype.setWinData=function(){this._data=Recharge.ins().getRechargeData(1),this.desc.text="已累计充值"+this._data.num+"元宝";var t=GlobalConfig.ChongZhi2Config[this._data.day/DateUtils.DAYS_PER_WEEK>=1?2:1][this._data.day%7],e=[];for(var i in t)e.push(t[i]),this.stateDic[t[i].index]=this._data.isAwards>>t[i].index&1;e=e.sort(this.sort),this.list.dataProvider=new eui.ArrayCollection(e);var s=GameServer.serverTime/1e3-60*(new Date).getTimezoneOffset();s>this._oneDay&&(s-=this._oneDay);var n=this._oneDay-s%this._oneDay,o=Math.floor(n/DateUtils.SECOND_PER_HOUR),a=Math.floor(n%DateUtils.SECOND_PER_HOUR/60);this.date.text=o+"时"+a+"分"},e.prototype.sort=function(t,e){var i=t.pay,s=e.pay;return 0==this.stateDic[t.index]&&1==this.stateDic[e.index]?-1:1==this.stateDic[t.index]&&0==this.stateDic[e.index]?1:i>s?1:s>i?-1:0},e}(BaseView);__reflect(Recharge3Win.prototype,"Recharge3Win"),ViewManager.ins().reg(Recharge3Win,LayerManager.UI_Main);var TotalChargeActItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TotalChargeActItemSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){this.price.setType(MoneyConst.yuanbao);var t=this.data,e=Recharge.ins().getRechargeData(1).num;this._index=t.index,this.price.setPrice(t.pay),this.list.dataProvider=new eui.ArrayCollection(t.awardList);var i=this.getRemindByIndex(this._index);e>=t.pay?i?(this.rewardBtn.visible=!1,this.rewardedTip.visible=!0):(this.rewardBtn.visible=!0,this.rewardedTip.visible=!1,this.rewardBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)):this.rewardBtn.visible=this.rewardedTip.visible=!1},e.prototype.getRemindByIndex=function(t){return 1==(Recharge.ins().getRechargeData(1).isAwards>>t&1)},e.prototype.onClick=function(){Recharge.ins().sendGetAwards(1,this._index),this.rewardBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(TotalChargeActItem.prototype,"TotalChargeActItem");var RenameWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="NameChangeSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap),this.input.text=""},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.sureBtn:0==this.input.text.length?UserTips.ins().showTips("您尚未输入名字！"):null!=UserBag.ins().getBagItemById(ItemConst.RENAME)&&GameLogic.ins().sendRename(this.input.text)}},e}(BaseEuiView);__reflect(RenameWin.prototype,"RenameWin"),ViewManager.ins().reg(RenameWin,LayerManager.UI_Popup);var ReportData=function(){function t(){this.isComplete=!1,this.httpRequest=new egret.HttpRequest,this.httpRequestUrl=[]}return t.getIns=function(){return this._ins=this._ins||new t,this._ins},t.prototype.report=function(e,i){var s=LocationProperty.roleCount;if(i=i||t.LOAD,!(i==t.LOAD&&0!=s||i==t.ERROR&&e==this.lastErrMsg)){this.lastErrMsg=e;var n=navigator.userAgent.toLowerCase();n=/iphone|ipad|ipod/.test(n)?"1":/android/.test(n)?"2":"0";var o=md5.hex_md5(md5.hex_md5(i+"027a47eabf1ebcb409b7fe680ff69008")),a="&data=";a+=LocationProperty.pfid,a+="|"+LocationProperty.srvid,a+="|"+LocationProperty.openID,a+="|"+i,a+="|"+e,a+="|"+LocationProperty.isnew,a+="|"+n,a+="|"+LocationProperty.login_ip,a+="|"+DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2),a+="|"+LocationProperty.appid,i!=t.ERROR&&(a+="|"+Actor.level||1),this.reportUrl(LocationProperty.loadurl+"/report?appv=1.0&counter="+i+"&key="+o+a)}},t.prototype.reportChat=function(t,e){if(!LocationProperty.isLocation){if(window.reportChat){var i={serverid:LocationProperty.srvid,qid:LocationProperty.openID,actorid:Actor.actorID,name:Actor.myName,chattype:e,content:t,chatdate:DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2),ip:LocationProperty.login_ip,pf:LocationProperty.pf};return void window.reportChat(i)}var s="chat";t=t.replace(/\|/g,"、");var n=md5.hex_md5(md5.hex_md5(s+"027a47eabf1ebcb409b7fe680ff69008")),o="&data=";o+=LocationProperty.srvid,o+="|"+LocationProperty.openID,o+="|"+Actor.actorID,o+="|"+Actor.myName,o+="|"+e,o+="|"+t,o+="|"+DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2),o+="|"+LocationProperty.login_ip,o+="|"+LocationProperty.pf,this.reportUrl(LocationProperty.loadurl+"/report?appv=1.0&counter="+s+"&key="+n+o)}},t.prototype.advice=function(t,e,i){var s=function(t){this.httpRequest.removeEventListener(egret.Event.COMPLETE,s,this);var n=t.currentTarget;"true"==n.response||"true\n"==n.response?(UserTips.ins().showTips("提交问题成功！"),e.call(i)):UserTips.ins().showTips("网络出故障，请重新提交问题！")};this.httpRequest.addEventListener(egret.Event.COMPLETE,s,this);var n=navigator.userAgent.toLowerCase();n=/iphone|ipad|ipod/.test(n)?"1":/android/.test(n)?"2":"0";var o="gm";t=t.replace(/\|/g,"、");var a="&data=";a+=LocationProperty.pfid,a+="|"+LocationProperty.srvid,a+="|"+LocationProperty.openID,a+="|"+o,a+="|"+t,a+="|"+LocationProperty.isnew,a+="|"+n,a+="|"+LocationProperty.login_ip,a+="|"+DateUtils.getFormatBySecond(Math.floor((GameServer.serverTime||Date.now())/1e3),2),a+="|"+LocationProperty.appid,a+="|"+Actor.level,this.reportUrl(LocationProperty.loadurl+"/report?appv=1.0&counter="+o+"&key=d413074da338f01ab95010fac6f0c81a"+a)},t.prototype.roleUp=function(){window.roleUp(Actor.actorID,Actor.myName,Actor.level)},t.prototype.enterGame=function(){window.enterGame(Actor.actorID,Actor.myName,Actor.level)},t.prototype.createRole=function(t){window.createRole(t)},t.prototype.advice1=function(t,e,i){var s=function(t){this.httpRequest.removeEventListener(egret.Event.COMPLETE,s,this);var n=t.currentTarget;"ok"==n.response?(UserTips.ins().showTips("提交问题成功！"),e.call(i)):UserTips.ins().showTips("网络出故障，请重新提交问题！")};this.httpRequest.addEventListener(egret.Event.COMPLETE,s,this),t=t.replace(/@/g,""),t=t.replace(/#/g,"");var n="&serverid="+LocationProperty.srvid;n+="&sign="+md5.hex_md5(""+(LocationProperty.srvid||0)+Actor.actorID+"enter_reportfeedbackqiyaohudongyule!@#"),n+="&actorid="+Actor.actorID,n+="&actorname="+Actor.myName,n+="&feedcnt="+t,n+="&openid="+LocationProperty.openID,n+="&userlevel="+Actor.level,n+="&viplevel="+UserVip.ins().lv,n+="&appid="+LocationProperty.appid,this.reportUrl(LocationProperty.loadurl+"/api/load?counter=enter_report"+n)},t.prototype.reportUrl=function(t,e){var i=new HrInfo;i.url=t,i.method=e,this.httpRequestUrl.push(i),this.sendReportUrl()},t.prototype.sendReportUrl=function(){if(0==this.isComplete&&this.httpRequestUrl.length>0){var t=this.httpRequestUrl[0].url,e=this.httpRequestUrl[0].method;this.httpRequest.open(t,e?e:egret.HttpMethod.GET),this.httpRequest.send(),this.isComplete=!0,this.httpRequest.addEventListener(egret.Event.COMPLETE,this.onGetComplete,this),this.httpRequest.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this)}},t.prototype.onGetComplete=function(t){this.isComplete=!1,this.httpRequestUrl.shift(),this.sendReportUrl()},t.prototype.onGetIOError=function(t){this.isComplete=!1,this.sendReportUrl()},t}();ReportData.LOAD="load",ReportData.GM="gm",ReportData.ERROR="error",__reflect(ReportData.prototype,"ReportData");var HrInfo=function(){function t(){}return t}();__reflect(HrInfo.prototype,"HrInfo");var EquipsData=function(){function t(){}return t.prototype.parser=function(t){this.strengthen=t.readInt(),this.spiritLv=t.readInt(),this.gem=t.readInt(),this.item=new ItemData,this.item.parser(t),this.zhuling=t.readInt(),this.soulLv=t.readInt(),this.bless=t.readInt(),this.spiritExp=t.readInt()},t}();__reflect(EquipsData.prototype,"EquipsData");var JingMaiData=function(){function t(){}return t.prototype.parser=function(t){this.level=t.readInt(),this.stage=t.readInt()},t.prototype.jingMaiCanUp=function(){var t=GlobalConfig.JingMaiStageConfig[this.stage];if(t.stage>=GlobalConfig.JingMaiCommonConfig.stageMax)return!1;var e=GlobalConfig.JingMaiLevelConfig[this.level],i=UserBag.ins().getBagGoodsCountById(0,e.itemId);return i>=e.count},t}();__reflect(JingMaiData.prototype,"JingMaiData");var PunchEquipForgeData=function(){function t(){this.data=[]}return t.prototype.parser=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readShort(),n=t.readInt();if(this.data[s])this.data[s].id=s,this.data[s].level=n;else{var o=new PunchEquipData;o.id=s,o.level=n,this.data[s]=o}}},Object.defineProperty(t.prototype,"level",{get:function(){for(var t=0,e=0;e<this.data.length;e++){var i=this.data[e];t+=i.level}return t},enumerable:!0,configurable:!0}),t.prototype.getSuitlevel=function(){var t=0;for(var e in GlobalConfig.PunchEquipMasterConfig){var i=GlobalConfig.PunchEquipMasterConfig[e];Math.floor(this.level/8)>=i.level&&(t=i.level)}return t},t.prototype.getNextSuitlevel=function(){var t=0;for(var e in GlobalConfig.PunchEquipMasterConfig){var i=GlobalConfig.PunchEquipMasterConfig[e];if(i.level>Math.floor(this.level/8)){t=i.level;break}}return t},t.prototype.getPunchLevel=function(t){return this.data[t].level},t.prototype.getCurCost=function(){for(var t,e,i=!0,s=0;8>s;s++){var n=this.data[s];s?e<n.level&&(i=!1,t=s,e=n.level):(t=s,e=n.level)}return i&&(t=0,e++),GlobalConfig.PunchEquipConfig[t][e]},t.prototype.getNextConfig=function(t){var e=t+1,i=this.getPunchLevel(t);return e>7&&(e=0,i=this.getPunchLevel(e)+1),GlobalConfig.PunchEquipConfig[e][i]},t.prototype.getPosNextLevelConfig=function(t){var e=this.getPunchLevel(t);return e++,GlobalConfig.PunchEquipConfig[t][e]},t.prototype.isShowPunchEquipForge=function(){for(var t=UserSkill.ins().equipListData,e=0;e<t.length;e++){var i=t[e];if(!i.itemConfig||!i.itemConfig.zsLevel||i.itemConfig.zsLevel<4)return!1}return!0},t.prototype.isUpgradePunchForge=function(e){var i=1;if(this.data[e]&&(i=this.data[e].level),!GlobalConfig.PunchEquipConfig[e][i+1])return t.TYPE_MAX;i||(i=1);var s=GlobalConfig.PunchEquipConfig[e][i+1],n=0;return s.cost.id==MoneyConst.punch1?n=Actor.togeatter1:s.cost.id==MoneyConst.punch2&&(n=Actor.togeatter2),n>=s.cost.count?t.TYPE_OK:t.TYPE_NO
},t.prototype.calcSelectPos=function(){for(var t,e,i=!0,s=0;8>s;s++)if(this.data[s]){var n=this.data[s];s?e>n.level&&(i=!1,t=s,e=n.level):(t=s,e=n.level)}return i&&(t=0,e++),t},t.prototype.getRedPoint=function(){if(!this.isShowPunchEquipForge())return!1;for(var e=0,i=8,s=0;i>s;s++){var n=this.isUpgradePunchForge(s);if(n==t.TYPE_NO)return!1;n==t.TYPE_MAX&&e++}return e==i?!1:!0},t.prototype.getAttributeData=function(){for(var t=[],e=0;e<this.data.length;e++){var i=this.data[e].id,s=this.data[e].level,n=GlobalConfig.PunchEquipConfig[i][s];if(n)for(var o=0;o<n.attr.length;o++)if(t.length){for(var a=!1,r=0;r<t.length;r++)t[r].type==n.attr[o].type&&(a=!0,t[r].value+=n.attr[o].value);if(!a){var h=new AttributeData;h.type=n.attr[o].type,h.value=n.attr[o].value,t.push(h)}}else{var h=new AttributeData;h.type=n.attr[o].type,h.value=n.attr[o].value,t.push(h)}}return t},t}();PunchEquipForgeData.TYPE_NO=0,PunchEquipForgeData.TYPE_OK=1,PunchEquipForgeData.TYPE_MAX=2,__reflect(PunchEquipForgeData.prototype,"PunchEquipForgeData");var PunchEquipData=function(){function t(){}return t}();__reflect(PunchEquipData.prototype,"PunchEquipData");var WingsData=function(){function t(){this.openStatus=0,this.clearTime=0,this.aptitudeDan=0,this.flyUpDan=0}return t.prototype.getEquipByIndex=function(t){return this.equipdata[t]},Object.defineProperty(t.prototype,"equipsLen",{get:function(){return this.equipdata.length},enumerable:!0,configurable:!0}),t.prototype.parser=function(t){this.parserBoost(t),this.parserOpenStatus(t),this.parserClearTime(t),this.parserDans(t)},t.prototype.parserBoost=function(t){this.lv=t.readInt(),this.exp=t.readUnsignedInt()},t.prototype.parserOpenStatus=function(t){this.openStatus=t.readInt()},t.prototype.parserClearTime=function(t){this.clearTime=t.readUnsignedInt()},t.prototype.parserDans=function(t){this.aptitudeDan=t.readShort(),this.flyUpDan=t.readShort()},t.prototype.parserWingEqupip=function(t){this.equipdata=[];for(var e,i=0;4>i;i++)e=new EquipsData,e.parser(t),this.equipdata.push(e)},t.prototype.getImgSource=function(){return this.lv>Wing.WingMaxLv||this.lv<0?"":GlobalConfig.WingLevelConfig[this.lv].appearance+"_png"},t.getWingAllLevel=function(){for(var t=0,e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i).wingsData;t+=s.lv,s.openStatus&&(t+=1)}return t},t}();__reflect(WingsData.prototype,"WingsData");var UserEquip=function(t){function e(){var e=t.call(this)||this;return e.isFind=!1,e.sysId=PackageID.Equip,e.regNetMsg(1,e.doUpDataEquip),e.regNetMsg(2,e.postSmeltEquipComplete),e.regNetMsg(3,e.doGrewupEquipResult),e.regNetMsg(4,e.doGrewupEquipResult),e.regNetMsg(5,e.postAddSpirit),e.regNetMsg(7,e.postAddSoul),e.regNetMsg(8,e.postZhiZunUpgrade),e.observe(UserBag.ins().postItemChange,e.delayCheckHaveCan),e.observe(UserBag.ins().postItemAdd,e.delayCheckHaveCan),e.observe(UserBag.ins().postItemDel,e.delayCheckHaveCan),e.observe(UserBag.ins().postHuntStore,e.delayCheckHaveCan),e.observe(Actor.ins().postLevelChange,e.delayCheckHaveCan),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.upgradeZhiZunEquip=function(t,e){var i=this.getBytes(8);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postZhiZunUpgrade=function(t){var e=t.readShort(),i=t.readShort(),s=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(e).getEquipByIndex(i);n.soulLv=s},e.prototype.sendWearEquipment=function(t,e,i){var s=this.getBytes(1);s.writeDouble(t),s.writeShort(i),s.writeShort(e),this.sendToServer(s)},e.prototype.sendSmeltEquip=function(t,e){var i=this.getBytes(2);i.writeInt(t);var s=i.position;i.position+=4;for(var n=0,o=0;o<e.length;o++)null!=e[o]&&(i.writeDouble(e[o].handle),++n);return 0==n?!1:(i.position=s,i.writeInt(n),this.sendToServer(i),!0)},e.prototype.doUpDataEquip=function(t){var e=t.readShort(),i=t.readShort(),s=new ItemData;s.parser(t);var n=SubRoles.ins().getSubRoleByIndex(e),o=n.getEquipByIndex(i);if(o.item=s,this.postEquipChange(),0==i||2==i){var a=EntityManager.ins().getEntityByHandle(n.handle);a&&a.updateModel()}},e.prototype.postEquipChange=function(){},e.prototype.postSmeltEquipComplete=function(t){var e=t.readInt();if(0==e)return void UserTips.ins().showTips("|C:0xf3311e&T:熔炼失败！|");for(var i=(t.readInt(),t.readInt()),s=[],n=0;i>n;n++){var o={};o.itemId=t.readInt(),o.count=t.readInt(),s.push(o)}return s},e.contrastEquip=function(t,e){if(!t||0==t.handle)return e;if(!e||0==e.handle)return t;var i=t.point,s=e.point;return s>i?e:t},e.prototype.postEquipCheckList=function(t){return t},e.prototype.getEquipsByJobNPos=function(t,e){for(var i=SubRoles.ins().subRolesLen,s=0;i>s;s++){var n=SubRoles.ins().getSubRoleByIndex(s);if(n.job==t)return n.getEquipByIndex(e)}return null},e.prototype.getEquipConfigIDByPosAndQuality=function(t,e,i){void 0===i&&(i=1);for(var s=UserZs.ins().lv||0,n=Actor.level,o=1e5+1+1e4*t+100*e+1e3*i,a=2;99>a;a++){var r=1e5+a+1e4*t+100*e+1e3*i,h=GlobalConfig.ItemConfig[r];if(void 0==h)break;var l=h.zsLevel?h.zsLevel:0,c=h.level?h.level:1;if(!(s>=l&&n>=c))break;o=r}return o},e.prototype.getEquipConfigIDByPosAndQualityByLegend=function(t,e,i,s){void 0===s&&(s=1);for(var n=UserZs.ins().lv||0,o=Actor.level,a=1e5+1+1e4*e+100*i+1e3*s,r=SubRoles.ins().getSubRoleByIndex(t),h=r.getEquipByIndex(e),l=1;99>l;l++){var c=1e5+l+1e4*e+100*i+1e3*s,u=GlobalConfig.ItemConfig[c];if(void 0==u)break;var p=u.zsLevel?u.zsLevel:0,d=u.level?u.level:1;if(!(n>=p&&o>=d))break;if(h&&h.item.configID){var g=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[c]);if(h.item.point<g){a=c;break}}else a=c}return a},e.prototype.getEquipConfigIDByPosAndQualityByGod=function(t,e,i,s){void 0===s&&(s=1);for(var n=UserZs.ins().lv||0,o=Actor.level,a=1e5+1+1e4*e+100*i+1e3*s,r=t.getEquipByIndex(e),h=2;99>h;h++){var l=1e5+h+1e4*e+100*i+1e3*s,c=GlobalConfig.ItemConfig[l];if(void 0==c)break;var u=c.zsLevel?c.zsLevel:0,p=c.level?c.level:1;if(!(n>=u&&o>=p))break;if(r&&r.item.configID){var d=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[l]);if(r.item.point<d){a=l;break}}else a=l}return a},e.prototype.checkEquipsIsWear=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i);if(s.job==ItemConfig.getJob(t.itemConfig)||0==ItemConfig.getJob(t.itemConfig))for(var n=s.getEquipLen(),o=0;n>o;o++)if(t.handle==s.getEquipByIndex(o).item.handle)return!0}return!1},e.prototype.doGrewupEquipResult=function(t){var e=t.readShort(),i=t.readInt(),s=t.readInt();4==ItemConfig.getQuality(GlobalConfig.ItemConfig[s])?this.postMixEquip(e,i,s):this.postMixGodEquip(e,i,s)},e.prototype.postMixEquip=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postMixGodEquip=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.sendGrewupEquip=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendMixEquip=function(t,e,i){var s=this.getBytes(4);s.writeShort(t),s.writeInt(e),s.writeInt(i),this.sendToServer(s)},e.prototype.delayCheckHaveCan=function(){TimerManager.ins().isExists(this.postCheckHaveCan,this)||TimerManager.ins().doTimer(60,1,this.postCheckHaveCan,this)},e.prototype.postCheckHaveCan=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e&&(this.isFind=this.checkRedPoint(4,e),!this.isFind);e++);if(!this.isFind)for(var i=0;t>i;i++)for(var e=0;8>e;e++)if(this.isFind=this.setOrangeEquipItemState(e,SubRoles.ins().getSubRoleByIndex(i)),this.isFind)return 1;if(!this.isFind){for(var e=0;t>e&&(this.isFind=this.checkRedPoint(5,e),!this.isFind);e++);if(!this.isFind)for(var i=0;t>i;i++)for(var e=0;2>e;e++)if(this.isFind=this.setLegendEquipItemUpState(e>0?2:0,SubRoles.ins().getSubRoleByIndex(i)),this.isFind=this.setLegendEquipItemState(e>0?2:0,SubRoles.ins().getSubRoleByIndex(i))||this.isFind,this.isFind)return 1}return this.isFind||(this.isFind=Boolean(UserBag.ins().getHuntGoods(0).length)),this.isFind?1:0},e.prototype.checkRedPointEx=function(t,e){for(var i=UserBag.ins().getBagEquipsByQuality(t),s=i.length,n=0;s>n;n++){var o=void 0,a=void 0;if(!isNaN(e)&&(o=ItemConfig.getJob(i[n].itemConfig),a=SubRoles.ins().getSubRoleByIndex(e),a.job!=o))return!1;if(!a)return!1;var r=this.getEquipConfigIDByPosAndQualityByGod(a,ItemConfig.getSubType(i[n].itemConfig),ItemConfig.getQuality(i[n].itemConfig)),h=GlobalConfig.ItemConfig[r];if(h){var l=i[n].itemConfig.zsLevel?i[n].itemConfig.zsLevel:0,c=i[n].itemConfig.level?i[n].itemConfig.level:0,u=h.zsLevel?h.zsLevel:0,p=h.level?h.level:0,d=1e4*l+c,g=1e4*u+p;if(g>d){if(4!=t)return!0;var f=UserBag.ins().getBagGoodsCountById(0,r),v=GlobalConfig.LegendComposeConfig[r],y=v?v.count:0;if(f>=y)return!0}}}return!1},e.prototype.checkRedPointExOrg=function(t,e){var i=UserBag.ins().getBagEquipsByQuality(t),s=i.length;if(s)this.checkRedPoint(t,e);else if(isNaN(e)){if(this.IsEnoughChip(e))return!0}else for(var n=0;n<SubRoles.ins().subRolesLen;n++)if(this.IsEnoughChip(n))return!0;return!1},e.prototype.IsEnoughChip=function(t){for(var e=[EquipPos.WEAPON,EquipPos.CLOTHES],i=SubRoles.ins().getSubRoleByIndex(t),s=0;s<e.length;s++){var n=this.getMixConfig(i.index,e[s]);if(n){var o=n.count,a=n.itemId,r=UserBag.ins().getBagGoodsCountById(0,a);if(r>=o)return!0}}return!1},e.prototype.getMixConfig=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t),s=this.getEquipConfigIDByPosAndQualityByLegend(i.index,e,5),n=GlobalConfig.LegendComposeConfig[s];return n},e.prototype.checkRedPoint=function(t,e){for(var i=UserBag.ins().getBagEquipsByQuality(t),s=i.length,n=0;s>n;n++){var o=void 0,a=void 0;if(!isNaN(e)&&(o=ItemConfig.getJob(i[n].itemConfig),a=SubRoles.ins().getSubRoleByIndex(e),a.job!=o))return!1;if(!a)return!1;var r=this.getEquipConfigIDByPosAndQualityByGod(a,ItemConfig.getSubType(i[n].itemConfig),ItemConfig.getQuality(i[n].itemConfig)),h=GlobalConfig.ItemConfig[r];if(h){var l=i[n].itemConfig.zsLevel?i[n].itemConfig.zsLevel:0,c=i[n].itemConfig.level?i[n].itemConfig.level:0,u=h.zsLevel?h.zsLevel:0,p=h.level?h.level:0,d=1e4*l+c,g=1e4*u+p;if(g>d)return!0}}return!1},e.prototype.setOrangeEquipItemState=function(t,i){var s,n=i.getEquipByIndex(t);s=n.item.itemConfig&&ItemConfig.getQuality(n.item.itemConfig)<4?null:GlobalConfig.ItemConfig[n.item.configID+1];var o=0,a=0;if(n.item.itemConfig&&4==ItemConfig.getQuality(n.item.itemConfig)&&n.item.itemConfig.zsLevel>=13)return!1;if(n.item.itemConfig&&5==ItemConfig.getQuality(n.item.itemConfig))return!1;if(null!=s&&(s.level>Actor.level||s.zsLevel>UserZs.ins().lv))return!1;if(void 0!=s&&0!=n.item.handle&&4==ItemConfig.getQuality(n.item.itemConfig)&&1!=n.item.itemConfig.level&&-1==UserBag.fitleEquip.indexOf(n.item.configID)){var r=GlobalConfig.LegendLevelupConfig[n.item.configID];r&&(o=r.count,a=r.itemId)}else{var h=e.ins().getEquipConfigIDByPosAndQualityByGod(i,t,4,i.job),l=i.getEquipByIndex(t);if(l&&l.item.configID){var c=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[h]);if(l.item.point>c)return!1}var u=GlobalConfig.LegendComposeConfig[h];u&&(o=u.count,a=u.itemId)}var p=UserBag.ins().getBagGoodsCountById(0,a);return p>=o},e.prototype.setLegendEquipItemState=function(t,e){var i=e.getEquipByIndex(t),s=null,n=ItemConfig.getQuality(i.item.itemConfig);if(i.item.itemConfig&&5==n){if(i.item.itemConfig.zsLevel>=10)return!1;s=GlobalConfig.ItemConfig[i.item.configID+1]}else s=null;var o=0,a=0;if(null!=s&&s.zsLevel>UserZs.ins().lv)return!1;if(null!=s&&0!=i.item.handle&&5==n){var r=GlobalConfig.LegendLevelupConfig[i.item.configID];o=r.count,a=r.itemId}else{var h=this.getEquipConfigIDByPosAndQualityByLegend(e.index,t,5),l=GlobalConfig.LegendComposeConfig[h];if(!l)return!1;o=l.count,a=l.itemId}var c=UserBag.ins().getBagGoodsCountById(0,a);return UserZs.ins().lv>=3?c>=o:!1},e.prototype.setLegendEquipItemUpState=function(t,e){var i=e.getEquipByIndex(t),s=GlobalConfig.ItemConfig[i.item.configID+1],n=ItemConfig.getQuality(i.item.itemConfig);if(void 0==s&&0!=i.item.handle&&5==n)return!1;if(void 0!=s&&0!=i.item.handle&&5==n){var o=e.getEquipByIndex(t).item.configID,a=GlobalConfig.ItemConfig[o+1];if(a.level>Actor.level||a.zsLevel>UserZs.ins().lv)return!1;var r=GlobalConfig.LegendLevelupConfig[o],h=UserBag.ins().getBagGoodsCountById(0,r.itemId);return h>=r.count}return!1},e.prototype.getLegendEquipItemUpMax=function(t){for(var e=0;8>e;e++)if(0==e||2==e){var i=SubRoles.ins().getSubRoleByIndex(t).getEquipByIndex(e);if(!i)return!0;var s=GlobalConfig.ItemConfig[i.item.configID+1],n=ItemConfig.getQuality(i.item.itemConfig);if(void 0!=s||0==i.item.handle||5!=n)return!1}return!0},e.prototype.requestAddSpirit=function(t,e,i){var s=this.getBytes(5);s.writeShort(t),s.writeShort(e),s.writeShort(i.length);for(var n=0;n<i.length;n++)s.writeDouble(i[n]);this.sendToServer(s)},e.prototype.postAddSpirit=function(t){var e=t.readShort(),i=t.readShort(),s=t.readShort(),n=t.readInt(),o=SubRoles.ins().getSubRoleByIndex(e).getEquipByIndex(i);o.spiritLv=s,o.spiritExp=n},e.prototype.requestAddSoul=function(t,e){var i=this.getBytes(7);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postAddSoul=function(t){var e=t.readShort(),i=t.readShort(),s=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(e).getEquipByIndex(i);n.soulLv=s},e}(BaseSystem);UserEquip.FOEGE_MAX=8,__reflect(UserEquip.prototype,"UserEquip");var GameSystem;!function(t){t.userEquip=UserEquip.ins.bind(UserEquip)}(GameSystem||(GameSystem={}));var UserJingMai=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.JingMai,e.regNetMsg(1,e.doUpData),e.regNetMsg(4,e.doBigUpLevel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendBoost=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendUpgrade=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.doUpData=function(t){var e=t.readShort();SubRoles.ins().getSubRoleByIndex(e).jingMaiData.parser(t),this.postUpdate()},e.prototype.postUpdate=function(){},e.prototype.sendBigUpLevel=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.doBigUpLevel=function(t){var e,i=t.readInt();if(i)e="道具不足够";else{var s=t.readInt();s||(e="使用成功，经脉等阶+1")}e&&UserTips.ins().showTips(e)},e.prototype.canGradeupJingMai=function(){for(var t,e=[!1,!1,!1],i=0,s=0,n=SubRoles.ins().subRolesLen,o=0;n>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(t=GlobalConfig.JingMaiLevelConfig[a.jingMaiData.level],i=t.count){var r=UserBag.ins().getBagGoodsCountById(0,200103);if(r){e[o]=!0;break}s=UserBag.ins().getBagGoodsCountById(0,t.itemId),e[o]=s>=i}else e[o]=!1}return e},e}(BaseSystem);__reflect(UserJingMai.prototype,"UserJingMai");var GameSystem;!function(t){t.userJingMai=UserJingMai.ins.bind(UserJingMai)}(GameSystem||(GameSystem={}));var UserRole=function(t){function e(){var e=t.call(this)||this;return e.timeID=0,e.canChangeEquips=[[],[],[]],e.observe(UserBag.ins().postItemChange,e.startCheckHaveCan),e.observe(UserBag.ins().postItemAdd,e.startCheckHaveCan),e.observe(UserBag.ins().postItemDel,e.startCheckHaveCan),e.observe(Actor.ins().postLevelChange,e.startCheckHaveCan),e.observe(GameLogic.ins().postSubRoleChange,e.startCheckHaveCan),e.observe(UserEquip.ins().postEquipChange,e.startCheckHaveCan),e.observe(JadeNew.ins().postJadeData,e.startCheckHaveCan),e.observe(LyMark.ins().postMarkData,e.startCheckHaveCan),e.observe(Wing.ins().postUseDanSuccess,e.startCheckHaveCan),e.observe(Wing.ins().postWingUpgrade,e.startCheckHaveCan),e.observe(Actor.ins().postGoldChange,e.delayShowNavBtnRedPoint),e.observe(GameLogic.ins().postRuneExchange,e.delayShowNavBtnRedPoint),e.observe(GameLogic.ins().postRuneShatter,e.delayShowNavBtnRedPoint),e.observe(UserBag.ins().postHuntStore,e.delayShowNavBtnRedPoint),e.observe(UserFb.ins().postFbRingInfo,e.delayShowNavBtnRedPoint),e}return __extends(e,t),e.prototype.startCheckHaveCan=function(t,e){var i=this;void 0===t&&(t=!1),void 0===e&&(e=-1),this.timeID||(this.timeID=1,TimerManager.ins().doTimer(50,1,function(){i.checkHaveCan(t,e)},this))},e.ins=function(){return t.ins.call(this)},e.prototype.checkHaveCan=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=-1),this.timeID=0;var i=UserBag.ins().getBagEquipByType(0);if(i){for(var s=SubRoles.ins(),n=e>=0?e:0,o=e>=0?e+1:s.subRolesLen,a=[[],[],[]],r=s.subRolesLen,h=0;r>h;h++)for(var l=0,c=s.getSubRoleByIndex(h).equipsData;l<c.length;l++){var u=c[l];a[h].push(u.item)}for(var p=0,d=i;p<d.length;p++)for(var g=d[p],f=n;o>f;f++){var v=ItemConfig.getJob(g.itemConfig);if((0==v||SubRoles.ins().getSubRoleByIndex(f).job==v)&&!(UserZs.ins().lv<g.itemConfig.zsLevel||Actor.level<g.itemConfig.level)){var y=UserBag.ins().getLowEquipIndex(a[f],ItemConfig.getSubType(g.itemConfig));y>=0&&(a[f][y]=this.contrastEquip(a[f][y]||s.getSubRoleByIndex(f).equipsData[y].item,g))}}for(var m=a.length,h=0;m>h;h++){for(var f=0;f<a[h].length;f++)this.canChangeEquips[h][f]=!1,a[h][f]&&a[h][f].handle!=s.getSubRoleByIndex(h).equipsData[f].item.handle&&(t&&e==h?(UserEquip.ins().sendWearEquipment(a[h][f].handle,f,e),this.canChangeEquips[h][f]=!1):this.canChangeEquips[h][f]=!0);this.canChangeEquips[h].indexOf(!0)<0&&(this.canChangeEquips[h].length=0)}this.showNavBtnRedPoint()}},e.prototype.contrastEquip=function(t,e){if(!t||0==t.handle)return e;if(!e||0==e.handle)return t;var i=t.point,s=e.point;return s>i?e:t},e.prototype.getCanChangeEquips=function(){for(var t=0;t<this.canChangeEquips.length;t++)for(var e=0;e<this.canChangeEquips[t].length;e++)if(this.canChangeEquips[t][e])return!0;return!1},e.prototype.delayShowNavBtnRedPoint=function(){TimerManager.ins().isExists(this.showNavBtnRedPoint,this)||TimerManager.ins().doTimer(60,1,this.showNavBtnRedPoint,this)},e.prototype.showNavBtnRedPoint=function(t){void 0===t&&(t=!1);for(var e=0;e<this.canChangeEquips.length;e++){for(var i=0;i<this.canChangeEquips[e].length;i++)if(this.canChangeEquips[e][i]){t=!0;break}if(t)break}if(!t&&SamsaraModel.ins().isCanAddSpirit()&&(t=!0),!t&&OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||SpecialRing.ins().fireRingRedPoint()||LyMark.ins().checkRed())&&(t=!0),!t&&UserSkill.ins().canHejiEquip()&&(t=!0),!t&&UserSkill.ins().canExchange()&&(t=!0),!t&&UserSkill.ins().canSolve()&&(t=!0),!t&&LongHun.ins().canShowRedPointInAll()?t=!0:!t&&UserZs.ins().canOpenZSWin()&&!UserZs.ins().isMaxLv()&&(UserZs.ins().canGet()>0||UserZs.ins().canUpgrade())?t=!0:(!t&&this.and(Wing.ins().canGradeupWing())||this.and(Wing.ins().canItemGradeupWing())||Wing.ins().isHaveActivationWing())&&(t=!0),!t&&Dress.ins().redPoint()&&(t=!0),!t&&RuneRedPointMgr.ins().checkAllSituation(!1)&&(t=!0),!t){for(var s=SubRoles.ins().subRolesLen,n=0;s>n;n++){for(var o=SubRoles.ins().getSubRoleByIndex(n),e=0;8>e;e++){this["equip"+e];if(t=UserEquip.ins().setOrangeEquipItemState(e,o),!t&&2>e&&(t=UserEquip.ins().setLegendEquipItemState(e>0?2:0,o)),t){var a=UserBag.ins().checkEqRedPoint(e,o);t=null!=a?a:t}if(t)break}if(t)break}if(!t)for(var e=0;s>e&&!(t=UserEquip.ins().checkRedPointEx(5,e));e++);t||(t=UserBag.ins().getLegendHasResolve()),t||(t=Boolean(UserBag.ins().getHuntGoods(0).length))}t||(t=SubRoles.ins().isLockRole()),t||(t=GodWingRedPoint.ins().getGodWingRedPoint()),t||(t=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||SamsaraModel.ins().isCanUpgradeSoul()),t||(t=JadeNew.ins().checkRed()),t||(t=Wing.ins().canUseFlyUp()),t||(t=Wing.ins().canUseAptitude()),this.postRoleHint(t)},e.prototype.postRoleHint=function(t){return t?1:0},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.seekRoleItem=function(){for(var t=!1,e=UserBag.ins().getBagItemNum(0),i=0;e>i;i++){if(t)return t;var s=UserBag.ins().getBagGoodsByIndex(0,i);switch(s.itemConfig.id){case 200001:break;case 200004:t=this.roleHint(5);break;case 200013:t=this.roleHint(0);break;case 200014:t=this.roleHint(1)}}return t},e.prototype.roleHint=function(t){for(var e=SubRoles.ins().subRolesLen,i=!1,s=0;e>s;s++){var n=SubRoles.ins().getSubRoleByIndex(s);if(i=this.roleHintCheck(n,t))return i}return i},e.prototype.roleHintCheck=function(t,e){var i=1,s=0,n=0,o=0;switch(e){case 0:i=t.getExRingsData(0);var a=GlobalConfig.ExRing0Config[i];if(i>=1)return!1;a&&(s=a.cost,o=GlobalConfig.ExRingConfig[0].costItem);break;case 1:i=t.getExRingsData(1);var r=GlobalConfig.ExRing1Config[i];if(i>=1)return!1;r&&(s=r.cost,o=GlobalConfig.ExRingConfig[1].costItem);break;case LongHun.TYPE_LONG_HUN:i+=t.loongSoulData.level;var h=GlobalConfig.LoongSoulConfig[i],l=GlobalConfig.LoongSoulStageConfig[t.loongSoulData.stage];h&&(s=l.normalCost,o=h.itemId);break;case LongHun.TYPE_HU_DUN:i+=t.shieldData.level;var c=GlobalConfig.ShieldConfig[i],u=GlobalConfig.ShieldStageConfig[t.loongSoulData.stage];c&&(s=u.normalCost,o=c.itemId);break;case 5:i=t.jingMaiData.level;var p=GlobalConfig.JingMaiLevelConfig[i];p&&(s=p.count,o=p.itemId)}return s&&(n=UserBag.ins().getBagGoodsCountById(0,o),n>=s)?!0:!1},e.prototype.setCanChange=function(){var t=ViewManager.ins().getView(RoleWin);t&&(t.roleInfoPanel.setCanChange(this.canChangeEquips),t.canChangeEquips=this.canChangeEquips)},e}(BaseSystem);UserRole.oneKeyOpenLevel=60,__reflect(UserRole.prototype,"UserRole");var GameSystem;!function(t){t.userRole=UserRole.ins.bind(UserRole)}(GameSystem||(GameSystem={}));var UserSkill=function(t){function e(){var e=t.call(this)||this;return e.hejiLevel=-1,e.hejiCD=0,e.hejiEnable=!1,e.isFirst=!0,e.fieldUse=!1,e.equipListData=[],e.hejiProgressList=[],e.reduceCD=0,e.sysId=PackageID.Skill,e.regNetMsg(1,e.doSkillResult),e.regNetMsg(2,e.postDoBuff),e.regNetMsg(3,e.postDoRemoveBuff),e.regNetMsg(6,e.doAddEffect),e.regNetMsg(7,e.doRemoveEffect),e.regNetMsg(4,e.postSkillUpgrade),e.regNetMsg(5,e.postSkillUpgradeAll),e.regNetMsg(9,e.postHejiInfo),e.regNetMsg(10,e.doHejiEquipInfo),e.regNetMsg(11,e.doHejiEquipUpdate),e.regNetMsg(12,e.doHejiUpdateInfo),e.regNetMsg(13,e.postUpgradeForge),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getPunchForge=function(){return this.punchEquipForge||(this.punchEquipForge=new PunchEquipForgeData),this.punchEquipForge},e.prototype.sendUseSkill=function(t,e,i){var s=this.getBytes(1);s.writeDouble(t),s.writeDouble(e),s.writeInt(i),this.sendToServer(s)},e.prototype.doSkillResult=function(t){var e=t.readDouble(),i=t.readInt(),s=t.readDouble(),n=EntityManager.ins().getEntityByHandle(e);if(n){var o=EntityManager.ins().getEntityByHandle(s);if(o&&(!o.parent&&n.isMy&&EntityShowMgr.ins().showHideSomeOne(s),!n.parent&&o.isMy&&EntityShowMgr.ins().showHideSomeOne(e),n.parent)){var a=new SkillData(i),r=0;7==Math.floor(i/1e4)&&(r=DamageTypes.Heji);var h,l=t.readShort();n.isMy&&(o.showBlood(!0),o.showName(!0)),o.isMy&&(n.showBlood(!0),n.showName(!0));for(var c=[],u=[],p=0;l>p;p++)h=t.readDouble(),u=[h],c[p]=u;AIUtil.ins().userSkill(n,o,a),n instanceof CharRole&&GuildWar.ins().getModel().checkinAppoint(2,!0)&&SubRoles.ins().getIsMyPlayer(s)&&n.infoModel.name&&GuildWar.ins().getModel().changeWeiXieList(n.infoModel.masterHandle,!0,n.infoModel.name)}}},e.prototype.postDoBuff=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var s=ObjectPool.pop("EntityBuff");s.effConfig=GlobalConfig.EffectsConfig[t.readInt()],s.value=0,s.addTime=egret.getTimer(),i.addBuff(s)}},e.prototype.postDoRemoveBuff=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var s=GlobalConfig.EffectsConfig[t.readInt()].group;i.hasBuff(s)&&i.removeBuff(i.buffList[s])}},e.prototype.doAddEffect=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var s=t.readInt();i.addEffect(s)}},e.prototype.doRemoveEffect=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);i&&i.removeEffect(t.readInt())},e.prototype.sendGrewUpSkill=function(t,e){var i=this.getBytes(4);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postSkillUpgrade=function(t){var e=t.readShort(),i=t.readShort(),s=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(e),o=n.skillsData[i].lv;return n.skillsData[i]=SkillData.getSkillByJob(n.job,i+1,s),0==o&&0!=s&&UserTips.ins().showSkillTips(n.skillsData[i].configID),[e,i,s]},e.prototype.sendGrewUpAllSkill=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=0);var s=this.getBytes(5);s.writeShort(e?1:0),s.writeShort(t),s.writeShort(i),this.sendToServer(s)},e.prototype.postSkillUpgradeAll=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),s=i.skillsData;i.skillsData=[];for(var n=0;5>n;n++)i.skillsData.push(SkillData.getSkillByJob(i.job,n+1,t.readShort()));return[s,e]},e.prototype.postHejiInfo=function(t){var e=t.readUnsignedInt(),i=t.readUnsignedInt(),s=!1;return-1==this.hejiLevel&&1==e&&(s=!0),this.hejiLevel!=e&&(this.hejiLevel=e,this.postHejiUpdate()),this.setHejiCD(i),{isAct:s}},e.prototype.doHejiEquipInfo=function(t){this.equipListData=[];for(var e,i=0;8>i;i++)e=new ItemData,e.parser(t),this.equipListData.push(e);this.setQimingInfo(),this.postHejiEquipChange()},e.prototype.setQimingInfo=function(){if(this.qimingEquipDic={},!this.qmArr){this.qmArr=[];var t=GlobalConfig.TogetherHitEquipQmConfig;for(var e in t)for(var i in t[e])if(!isNaN(Number(e))&&!isNaN(Number(i))){var s=1e4*Number(e)+Number(i);this.qmArr.push(s)}}for(var n in this.equipListData)if(0!=this.equipListData[n].configID)for(var o=this.equipListData[n].itemConfig,a=1e4*(o.zsLevel||0)+o.level,r=0;r<this.qmArr.length;r++)if(!(a<this.qmArr[r])){var i=this.qmArr[r];this.qimingEquipDic[i]?this.qimingEquipDic[i].num++:(this.qimingEquipDic[i]={num:0},this.qimingEquipDic[i].num=1)}this.setQmAttr()},e.prototype.setQmAttr=function(){var t=GlobalConfig.TogetherHitEquipQmConfig;this.qimingAttrDic={};for(var e in this.qimingEquipDic){var i=Math.floor(Number(e)/1e4),s=Math.floor(Number(e)%1e4),n=this.qimingEquipDic[e].num,o=t[i][s];if(o)for(var a in o)n>=Number(a)&&(this.qimingAttrDic[e]||(this.qimingAttrDic[e]={}),this.qimingAttrDic[e][a]=o[a])}this.qimingValueDic={};for(var e in this.qimingAttrDic)for(var r in this.qimingAttrDic[e]){var h=this.qimingAttrDic[e][r],l=h.exAttr[0];this.qimingValueDic[r]||(this.qimingValueDic[r]=new Object),this.qimingValueDic[r].value||(this.qimingValueDic[r].value=0),this.qimingValueDic[r].type=l.type,this.qimingValueDic[r].value+=l.value}},e.prototype.doHejiEquipUpdate=function(t){var e=t.readShort(),i=new ItemData;i.parser(t),this.equipListData[e]=i,this.setQimingInfo(),this.postHejiEquipChange()},e.prototype.checkHejiOpen=function(){var t=GlobalConfig.TogerherHitBaseConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.canHejiEquip=function(){if(e.ins().hejiLevel<=0)return!1;if(Actor.level<e.HEJI_SHOW_LEVEL)return!1;if(!this.equipListData)return!1;for(var t=0;t<this.equipListData.length;t++)if(this.checkIsHaveBestEquip(t))return!0;return!1},e.prototype.canExchange=function(){if(e.ins().hejiLevel<=0)return!1;if(Actor.level<e.HEJI_SHOW_LEVEL)return!1;var t,i=this.getMaxzLv();for(var s in this.equipListData){var n=this.equipListData[s];if(n&&n.configID)for(var o=+s+1;;o+=8){var a=GlobalConfig.TogetherHitEquipExchangeConfig[o];if(!a)break;var r=n.itemConfig.level?n.itemConfig.level:0,h=n.itemConfig.zsLevel?n.itemConfig.zsLevel:0,l=a.level,c=a.zsLevel,u=a.getItem.id;if(!(r>=l&&h>=c||u%1e4<=n.configID%1e4||l>Actor.level||c>UserZs.ins().lv)){if(c>i[0]||l>i[1])break;if(c>=h&&l>=r){if(t=a.exchangeMaterial[0].count,a.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=t)return!0;if(a.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=t)return!0}}}else{var p=GlobalConfig.TogetherHitEquipExchangeConfig[Number(s)+1];if(p){if(t=p.exchangeMaterial[0].count,p.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=t)return!0;if(p.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=t)return!0}}}return!1},e.prototype.getMaxzLv=function(){var t=0,i=0,s=0,n=e.ins().qimingEquipDic;for(var o in n)+o>t&&(t=+o);if(i=Math.floor(t/1e4),s=t%1e4,0==t||8==n[t].num){var a=GlobalConfig.TogetherHitEquipQmConfig,r=[];for(var h in a)r.push(+h);r.sort(function(t,e){return e>t?-1:1}),0==t?i=r[0]:(i=r[r.indexOf(i)+1],void 0==i&&(i=r[r.length-1]));for(var l in a[i])s=+l}return[i,s]},e.prototype.getPunchExchangePageRedPoint=function(t){var e,i=this.getMaxzLv();for(var s in this.equipListData){var n=this.equipListData[s];if(n&&n.configID){if(1==t)continue;var o=+s+1+8*(t-2),a=GlobalConfig.TogetherHitEquipExchangeConfig[o],r=a.getItem.id;if(r!=n.configID)continue;var h=+s+1+8*(t-1);if(a=GlobalConfig.TogetherHitEquipExchangeConfig[h]){var l=n.itemConfig.level?n.itemConfig.level:0,c=n.itemConfig.zsLevel?n.itemConfig.zsLevel:0,u=a.level,p=a.zsLevel,d=a.getItem.id;if(l>=u&&c>=p)continue;if(d%1e4<=n.configID%1e4)continue;if(u>Actor.level||p>UserZs.ins().lv)continue;if(p>i[0]||u>i[1])continue;if(p>=c&&u>=l){if(e=a.exchangeMaterial[0].count,a.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=e)return!0;if(a.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=e)return!0}}}else if(1==t){var g=GlobalConfig.TogetherHitEquipExchangeConfig[Number(s)+1];if(g){if(e=g.exchangeMaterial[0].count,g.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=e)return!0;if(g.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=e)return!0}}}return!1},e.prototype.getPunchExchangeItemRedPoint=function(t){var e,i=(t-1)%8,s=Math.ceil(t/8),n=this.equipListData[i];if(1==s){if(n&&n.configID)return!1}else{if(!n||!n.configID)return!1;var o=GlobalConfig.TogetherHitEquipExchangeConfig[t-8];if(o.getItem.id!=n.configID)return!1}var a=GlobalConfig.TogetherHitEquipExchangeConfig[t];if(a){if(a.zsLevel>UserZs.ins().lv||a.level>Actor.level)return!1;if(e=a.exchangeMaterial[0].count,a.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=e)return!0;if(a.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=e)return!0}return!1},e.prototype.canAcitve=function(){return!1},e.prototype.canSolve=function(){if(e.ins().hejiLevel<=0)return!1;if(Actor.level<e.HEJI_SHOW_LEVEL)return!1;var t=[];return UserBag.ins().checkHejiEquipsTodestroy(t),t.length?!0:!1},e.prototype.doHejiUpdateInfo=function(t){var e=t.readByte();this.hejiProgressList=[];for(var i=0;e>i;i++){var s=new HejiProgressData;s.parser(t),this.hejiProgressList[s.id-1]=s}},e.prototype.setHejiCD=function(t){if(void 0===t&&(t=0),this.hejiLevel>0){var i=e.ins().getHejiSkillId();this.reduceCD=0;var s=EntityManager.ins().getMainRole(0);s&&s.infoModel&&s.infoModel.getExAtt(ExAttributeType.eatTogetherHitCdSub)>0&&(this.reduceCD=s.infoModel.getExAtt(ExAttributeType.eatTogetherHitCdSub)/1e4*i.cd),-1==t?this.hejiCD=GameServer.serverTime+i.cd-this.reduceCD:this.hejiCD=GameServer.serverTime+t,this.postHejiStartCD()}},e.prototype.getHejiSkillId=function(){var t=GlobalConfig.TogetherHitConfig[e.ins().hejiLevel],i=SubRoles.ins().getSubRoleByIndex(0);if(!i)return new SkillData(GlobalConfig.SkillsConfig[t.skill_id[0]].id);var s=GlobalConfig.SkillsConfig[t.skill_id[i.job-1]];return new SkillData(s.id)},e.prototype.getHejiSkillIdIcon=function(){var t=GlobalConfig.TogetherHitConfig[e.ins().hejiLevel],i=SubRoles.ins().getSubRoleByIndex(0);i||(i={job:1});var s=GlobalConfig.SkillsConfig[t.skill_id[i.job-1]],n=1e3*Math.floor(s.id/1e3)+"_png";return n},e.prototype.getSkillIdIcon=function(t){var e=GlobalConfig.SkillsConfig[t],i=1e3*Math.floor(e.id/1e3)+"_png";return i},e.prototype.sendGrewUpHejiSkill=function(){this.sendBaseProto(9)},e.prototype.sendUseHejiSkill=function(){this.sendBaseProto(10)},e.prototype.sendDressHejiEquip=function(t,e){var i=this.getBytes(11);i.writeDouble(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendExchangeHejiEquip=function(t){var e=this.getBytes(12);e.writeShort(t),this.sendToServer(e)},e.prototype.getWearEquipsData=function(t){return this.equipListData[t]?this.equipListData[t]:null},e.prototype.getSkillLimitLevel=function(){return UserZs.ins().lv>0?80+10*UserZs.ins().lv:Actor.level>80?80:Actor.level
},e.prototype.getSingleSkillGrewUpCost=function(t,e){var i=this.getSkillLimitLevel(),s=SubRoles.ins().getSubRoleByIndex(t).skillsData[e],n=Actor.gold,o=0;if(s.lv>0){for(var a=s.lv;i>a;a++){var r=GlobalConfig.SkillsUpgradeConfig[a].cost;if(o+r>n)return o;o+=r}return o}return 0},e.prototype.canGrewupSkill=function(){for(var t=[],e=this.getSkillLimitLevel(),i=SubRoles.ins().subRolesLen,s=0;i>s;s++)for(var n=SubRoles.ins().getSubRoleByIndex(s),o=0;o<n.skillsData.length;o++){var a=n.skillsData[o];if(a.lv>0&&e>a.lv){var r=GlobalConfig.SkillsUpgradeConfig[a.lv].cost;if(Actor.gold>=r){t[s]=!0;break}}}return t},e.prototype.canGrewupAllSkills=function(t){for(var i=this.getSkillLimitLevel(),s=SubRoles.ins().getSubRoleByIndex(t).skillsData,n=!1,o=Actor.gold,a=0;a<s.length;a++){var r=s[a];if(0!=r.configID){var h=GlobalConfig.SkillsUpgradeConfig[r.lv];h&&o>=h.cost&&r.configID!=i&&(n=!0)}}if(n){for(var a=0;5>a;a++){var r=s[a];if(r.lv>0&&r.lv<e.ins().getSkillLimitLevel()){var l=e.ins().getSingleSkillGrewUpCost(t,a);if(l>0)return!0}}return!1}return n},e.prototype.postShowSkillWord=function(t){return t},e.prototype.postHejiUpdate=function(){},e.prototype.postHejiStartCD=function(){},e.prototype.postHejiRemove=function(){},e.prototype.postHejiEquipChange=function(){},e.prototype.checkIsHaveBestEquip=function(t,e){void 0===e&&(e=-1);var i=this.equipListData[t],s=UserBag.ins().getHejiEquipsByType(t);if(s.length>0)for(var n=void 0,o=200,a=0;a<s.length;a++){n=s[a];var r=n.itemConfig.level?n.itemConfig.level:0,h=n.itemConfig.zsLevel?n.itemConfig.zsLevel:0;if(n.itemConfig.level<=o&&(r<=Actor.level||h<=UserZs.ins().lv)&&n.itemConfig.level<=Actor.level&&h<=UserZs.ins().lv){var l=0;if(!i||0==i.configID){if(n.itemConfig.useCond)continue;return!0}l=i.point;var c=n.point;if(c>l&&n.itemConfig.useCond==i.itemConfig.id)return!0}}return!1},e.prototype.sendUpgradeForge=function(t){var e=this.getBytes(13);e.writeShort(t),this.sendToServer(e)},e.prototype.postUpgradeForge=function(t){this.getPunchForge().parser(t)},e.prototype.sendChangeTogeatterHigh=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e.prototype.isHejiSkill=function(t){for(var e in GlobalConfig.TogetherHitConfig)if(GlobalConfig.TogetherHitConfig[e].skill_id.indexOf(t)>=0)return!0;return!1},e}(BaseSystem);UserSkill.MAX_LEVEL=200,UserSkill.ACTIVE_LEVEL=10,UserSkill.HEJI_SKILL=7e4,UserSkill.HEJI_SHOW_LEVEL=60,UserSkill.descArr=["合击技能对角色伤害+%s","合击技能对怪物伤害+%s","怒气恢复速度+%s"],__reflect(UserSkill.prototype,"UserSkill");var GameSystem;!function(t){t.userskill=UserSkill.ins.bind(UserSkill)}(GameSystem||(GameSystem={}));var SHORT_SKILLID;!function(t){t[t.MAGIC=24]="MAGIC",t[t.CURE=32]="CURE",t[t.POISONING=33]="POISONING",t[t.ARMOR=34]="ARMOR",t[t.SUMMON=35]="SUMMON"}(SHORT_SKILLID||(SHORT_SKILLID={}));var SkillConst=function(){function t(){}return t}();SkillConst.EFF_SKY_BALL=53001,SkillConst.HEJI_SKILLS=[71001,72001,73001],__reflect(SkillConst.prototype,"SkillConst");var RoleAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=[1,2,3,4,5,6,7,AttributeType.atCritEnhance,8,9,10,11,12,13,14,15,16],e.skinName="RoleAttrSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.setRoleAttr(this.curRole);var i=SubRoles.ins().subRolesLen;i>1&&(this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.addTouchEndEvent(this.bg,this.onMove)),this.addTouchEndEvent(this,this.otherClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=SubRoles.ins().subRolesLen;i>1&&(this.removeTouchEvent(this.leftBtn,this.onTouch),this.removeTouchEvent(this.rightBtn,this.onTouch),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200)):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200))}},e.prototype.moveAttr=function(t){var e,i=egret.Tween.get(this.attrGroup);e=t>0?0:242,i.to({x:this.attrGroup.x+t,alpha:0},200).to({x:e},200).to({x:80,alpha:1},200)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.leftBtn:this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200));break;case this.rightBtn:this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200))}},e.prototype.setRoleAttr=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);this.job.source="op_"+e.job;for(var i="",s=0,n=0,o=0;o<this.proShowList.length;o++){if(n=this.proShowList[o],s=e.attributeData[n],n>1&&9>n)i+=7==n||8==n?s/100+"%":s;else{if(!(n>12&&15>n||n>15))continue;n==AttributeType.atCritEnhance&&(s+=e.getAtt(AttributeType.atHuiXinDamage),s+=1e4),i+=s/100+"%"}o<this.proShowList.length-1&&(i+="\n")}this.attr.text=i,this.setBtn()},e.prototype.setBtn=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,3>t?this.rightBtn.visible=!1:this.rightBtn.visible=!0):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(RoleAttrWin.prototype,"RoleAttrWin"),ViewManager.ins().reg(RoleAttrWin,LayerManager.UI_Popup);var RoleChooseEquipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e.roleSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="RoleChooseEquipSkin",this.list.itemRenderer=RoleEquipChooseItem,this.wearItem=new RoleEquipChooseItem,this.itemGroup.addChild(this.wearItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleSelect=t[0],this.pos=t[1];var i=SubRoles.ins().getSubRoleByIndex(this.roleSelect),s=i.getEquipDataByPos(this.pos);this.wearItem.setUpImage(!1),this.wearItem.data=s.item,this.wearItem.setBtnStatu();var n=0;if(s&&0!=s.item.configID){this.scroll.y=170,this.scroll.height=400,this.wearItem.visible=!0,n=s.item.point;var o=0==ItemConfig.getJob(s.item.itemConfig)?i.job:ItemConfig.getJob(s.item.itemConfig);UserBag.ins().setEquipPowerDic(o,ItemConfig.getSubType(s.item.itemConfig),n)}else this.scroll.y=50,this.scroll.height=520,this.wearItem.visible=!1;this.itemList=UserBag.ins().getEquipByPos(this.roleSelect,this.pos),this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.validateNow(),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this,this.itemTap)},e.prototype.itemTap=function(t){if("changeBtn"==t.target.name){var e=t.target.parent.data;if(e&&e instanceof ItemData){var i=Actor.level,s=UserZs.ins().lv;if(e.itemConfig&&!(s>=(e.itemConfig.zsLevel||0)&&i>=(e.itemConfig.level||1)))return 5==ItemConfig.getQuality(e.itemConfig)?void UserTips.ins().showTips("|C:0xF3311E&T:"+e.itemConfig.name+"）达到"+e.itemConfig.zsLevel+"转"+(e.itemConfig.level||1)+"级可穿戴|"):void UserTips.ins().showTips("|C:0xF3311E&T:等级不足，无法穿戴|");UserEquip.ins().sendWearEquipment(e.handle,this.pos,this.roleSelect),ViewManager.ins().close(this),SoundUtil.ins().playEffect(SoundUtil.EQUIP)}}},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e.prototype.sortFun=function(t,e){var i=UserBag.ins().getEquipAttrs(t),s=UserBag.getAttrPower(i),n=UserBag.ins().getEquipAttrs(e),o=UserBag.getAttrPower(n);return o>s?1:s>o?-1:0},e}(BaseEuiView);__reflect(RoleChooseEquipWin.prototype,"RoleChooseEquipWin"),ViewManager.ins().reg(RoleChooseEquipWin,LayerManager.UI_Popup);var RoleChooseItemWin=function(t){function e(){var e=t.call(this)||this;return e.initMc(),e.skinName="weaponSoulUse",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.id=t[0],this.addTouchEvent(this,this.onClick),this.addTouchEvent(this.btntupo,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.observe(Weapons.ins().postWeaponsFlexibleCount,this.otherClose),this.init(),this.setCurRole(this.id)},e.prototype.init=function(){this.roles=[this.role1,this.role2,this.role3];for(var t=0;2>t;t++){var e=this.roleMovie[t];this.roles[t+1].addChild(e)}this.updateRole(),this.updateSelect(this.id)},e.prototype.getCurRole=function(){return this.id},e.prototype.setCurRole=function(t){this.id=t;for(var e=0;e<this.roles.length;e++){var i=this.roles[e];i.selected=e==t}this.dispatchEventWith(egret.Event.CHANGE,!1,this.id)},e.prototype.initMc=function(){this.roleMovie=[];for(var t=0;2>t;t++){var e=new MovieClip;e.x=44,e.y=44,e.touchEnabled=!1,this.roleMovie.push(e)}},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.btntupo:var e=SubRoles.ins().getSubRoleByIndex(this.id);if(!e)return void UserTips.ins().showTips("角色数据异常");if(e.weapons.flexibleCount-1>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum)return void UserTips.ins().showTips("每角色兵魂之灵最大使用上限为"+GlobalConfig.WeaponSoulBaseConfig.maxItemNum);Weapons.ins().sendWeaponsFlexibleCount(this.id)}},e.prototype.onClick=function(t){var e=this.roles.indexOf(t.target);e>-1&&this.changeRole(e)},e.prototype.changeRole=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);e?(this.setCurRole(t),this.updateSelect(t)):(ViewManager.ins().open(NewRoleWin),this.roles[t].selected=!1,ViewManager.ins().close(this))},e.prototype.updateSelect=function(t){for(var e=1;3>=e;e++)t+1==e?this["selectrole"+e].visible=!0:this["selectrole"+e].visible=!1;var i=SubRoles.ins().getSubRoleByIndex(t);this.btntupo.visible=i.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum;var s=i.weapons.flexibleCount;s=s?s-1:1,s=s>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum?GlobalConfig.WeaponSoulBaseConfig.maxItemNum:s;var n=GlobalConfig.WeaponSoulItemAttr[s],o=i.weapons.flexibleCount?s+1:s,a=GlobalConfig.WeaponSoulItemAttr[o],r=i.weapons.flexibleCount?s:0;r=r>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum?GlobalConfig.WeaponSoulBaseConfig.maxItemNum:r,this.curUse.text=r+"",this.nextUse.visible=!0;for(var e=0;4>e;e++)this["name"+e].text=AttributeData.getAttrStrByType(n.attr[e].type),this["tpattr"+e].text=i.weapons.flexibleCount?n.attr[e].value:0,a?(this.nextUse.text=o+"",this["ntpattr"+e].visible=this["dir"+e].visible=!0,this["ntpattr"+e].text=a.attr[e].value):(this["ntpattr"+e].visible=this["dir"+e].visible=!1,this.nextUse.visible=!1);this.dir.visible=this.nextUse.visible,this.material.data=GlobalConfig.WeaponSoulBaseConfig.itemid},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateRole=function(){for(var t,e,i=this.roles.length,s=0;i>s;s++){if(t=this.roles[s],e=SubRoles.ins().getSubRoleByIndex(s))t.jobImg.visible=!0,t.jobImg.source="job"+e.job+"Item",t.stageImg.visible=!1,t.stageImg.source="",t.icon="yuanhead"+e.job+e.sex,this.roleMovie[s-1]&&DisplayUtils.removeFromParent(this.roleMovie[s-1]);else{var n=GlobalConfig.NewRoleConfig[s];if(!n){var o=egret.getQualifiedClassName(this.parent);Assert(!1,"角色索引"+s+"不存在，出错类："+o);continue}t.jobImg.visible=!1,t.stageImg.visible=!0,n.zsLevel?UserZs.ins().lv<n.zsLevel?t.stageImg.source="toujiesuo"+n.zsLevel:t.stageImg.source="toujiesuo":Actor.level<n.level?t.stageImg.source="toujiesuo"+n.level:t.stageImg.source="toujiesuo",n.vip&&UserVip.ins().lv>=n.vip&&(t.stageImg.source="toujiesuo"),t.icon=""}this.roleMovie[s-1]&&"toujiesuo"==t.stageImg.source&&t.stageImg.visible&&(this.roleMovie[s-1].playFile(RES_DIR_EFF+"juesejiesuo",-1),this.showRedPoint(s,!0))}},e.prototype.showRedPoint=function(t,e){null!=this.roles&&(this.roles[t].redPoint.visible=e)},e.prototype.otherClose=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RoleChooseItemWin.prototype,"RoleChooseItemWin"),ViewManager.ins().reg(RoleChooseItemWin,LayerManager.UI_Popup);var RoleEquipChooseItem=function(t){function e(){var e=t.call(this)||this;return e.showUpimage=!0,e.skinName="RoleChooseEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.itemConfig){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);var t=this.data;this.itemIcon.setData(this.data.itemConfig),this.nameTxt.text=t.itemConfig.name,this.nameTxt.textColor=ItemConfig.getQualityColor(this.data.itemConfig);var e=UserBag.ins().getEquipAttrs(this.data),i=(GlobalConfig.EquipConfig[this.data.itemConfig.id],0),s=this.data.point+i;this.power.text="评分："+s;var n=ItemConfig.getSubType(this.data.itemConfig);this.upImg.x=this.power.x+this.power.textWidth+10;var o=Actor.level>=(this.data.itemConfig.level||1)&&UserZs.ins().lv>=(this.data.itemConfig.zsLevel||0),a=o?"0x35E62D":"0xfe4444";if(n==EquipPos.DZI)this.levelStrText.text="等阶:",this.levelText.text=UserBag.ins().getGuanyinLevel(t.itemConfig);else{this.levelStrText.text="等级:";var r=isNaN(this.data.itemConfig.zsLevel)?(this.data.itemConfig.level||1)+"级":this.data.itemConfig.zsLevel+"转";this.levelText.textFlow=TextFlowMaker.generateTextFlow("|C:"+a+"&T:"+r+"|")}var h=0;if(this.now.visible=!this.showUpimage,this.data.itemConfig.job)h=ItemConfig.getJob(this.data.itemConfig);else{var l=ViewManager.ins().getView(RoleChooseEquipWin),c=l.roleSelect,u=SubRoles.ins().getSubRoleByIndex(c);h=u.job}var p=UserBag.ins().getEquipPowerDic(h,n);if(s>p&&this.showUpimage&&o){this.upImg.visible=!0;var d=egret.Tween.get(this.upImg,{loop:!0});d.to({y:this.upImg.y-3},250).to({y:this.upImg.y+3},250)}else this.upImg.visible=!1;0==this.itemIndex&&this.showUpimage&&o&&s>p?(this.best.visible=!0,this.best.x=this.upImg.x+this.upImg.width+9):this.best.visible=!1;for(var g="",f=0;f<e.length;f++)if(0!=e[f].type&&0!=e[f].value){var r=AttributeData.getAttrNameByAttrbute(e[f],!0);g+=r+"\n"}this.attr1.textFlow=(new egret.HtmlTextParser).parser(g),UserZs.ins().lv<(this.data.itemConfig.zsLevel||0)||Actor.level<(this.data.itemConfig.level||1)?this.changeBtn.visible=!1:this.changeBtn.visible=!0}},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),egret.Tween.removeTweens(this.upImg)},e.prototype.setUpImage=function(t){this.showUpimage=t},e.prototype.setBtnStatu=function(){this.changeBtn.visible=!1,this.now.visible=!0},e}(eui.ItemRenderer);__reflect(RoleEquipChooseItem.prototype,"RoleEquipChooseItem");var RoleWin=function(t){function e(){var e=t.call(this)||this;return e.roleIndex=0,e.oldIndex=0,e.roleSelectVis=!0,e.skinName="RoleWinSkin",e.isTopLevel=!0,e.addExclusionWin(egret.getQualifiedClassName(SmeltEquipTotalWin)),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=t[0]?t[0]:0,this.addTouchEvent(this,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(UserRole.ins().postRoleHint,this.delayRedPoint),this.observe(UserZs.ins().postZsData,this.delayRedPoint),this.observe(Actor.ins().postLevelChange,this.delayRedPoint),this.observe(Actor.ins().postUpdateTogeatter,this.delayRedPoint),this.observe(UserFb.ins().postGuanKaIdChange,this.delayRedPoint),this.observe(UserSkill.ins().postUpgradeForge,this.delayRedPoint),this.observe(UserBag.ins().postItemAdd,this.delayRedPoint),this.observe(UserBag.ins().postItemChange,this.delayRedPoint),this.observe(UserBag.ins().postItemDel,this.delayRedPoint),this.observe(JadeNew.ins().postJadeData,this.delayRedPoint),this.observe(LyMark.ins().postMarkData,this.delayRedPoint),this.observe(Wing.ins().postUseDanSuccess,this.delayRedPoint),this.observe(Wing.ins().postWingUpgrade,this.delayRedPoint),this.observe(SamsaraCC.ins().postSamsaraInfo,this.delayRedPoint),this.addTouchEvent(this.help,this.onClick),this.roleIndex=t[1]?t[1]:0;var i=this.viewStack.selectedIndex;this.roleSelect.setCurRole(this.roleIndex),4==i&&this.roleSelect.hideRole(),this.setOpenIndex(i),this.redPoint()},e.prototype.openSamsara=function(){var t=this.viewStack.getChildIndex(this.reincarnationPanel);0>t&&this.viewStack.addChild(this.reincarnationPanel),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=42,this.redPoint4.visible=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||!SamsaraModel.ins().isMaxSamsara(Actor.samsaraLv)&&SamsaraModel.ins().isCanUpgradeSoul()},e.prototype.inactiveSamsara=function(){var t=this.viewStack.getChildIndex(this.reincarnationPanel);t>=0&&this.viewStack.removeChildAt(t),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=104,this.redPoint4.visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=ViewManager.ins().getView(UIView2);i&&i.closeNav(UIView2.NAV_ROLE);for(var s=this.viewStack.numChildren,n=0;s>n;n++)this.viewStack.getChildAt(n).close()},e.prototype.checkIsOpen=function(t){GlobalConfig.TogetherHitConfig[1];if(1==t){if(!UserSkill.ins().checkHejiOpen())return UserTips.ins().showTips("激活神器 火龙之心 后开启"),this.roleSelect.visible=this.roleSelectVis,!1}else if(2==t){if(Actor.level<GlobalConfig.ZhuanShengConfig.level)return UserTips.ins().showTips(GlobalConfig.ZhuanShengConfig.level+"级开启转生"),!1}else if(3==t&&Actor.level<GlobalConfig.WingCommonConfig.openLevel)return UserTips.ins().showTips("羽翼"+GlobalConfig.WingCommonConfig.openLevel+"级开启"),!1;return!0},e.prototype.onTabTouch=function(t){var e=this.tab.selectedIndex;4==e&&this.roleSelect.hideRole(),this.setOpenIndex(e)},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.setRoleId=function(t){this.roleInfoPanel.curRole=this.wingPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setTabSelectedIndex=function(t){this.tab.selectedIndex=t,this.oldIndex=t,this.setOpenIndex(t)},e.prototype.setOpenIndex=function(t){if(this.roleSelectVis=this.roleSelect.visible,this.oldIndex&&3==this.oldIndex&&this.oldIndex!=t&&this.getWingPanelInfo())return this.doOpenHintWin(1,this.tab.selectedIndex),void(this.tab.selectedIndex=this.oldIndex);switch(1!=t&&this.hejiPanel.close(),this.help.visible=!1,t){case 0:this.biaoti.source="biaoti_juese",this.roleSelect.openRole(),this.roleInfoPanel.open();break;case 1:this.biaoti.source="biaoti_heji",this.roleSelect.hideRole(),this.hejiPanel.open();break;case 2:Actor.level>=GlobalConfig.ZhuanShengConfig.level?(this.biaoti.source="biaoti_zhuansheng",this.roleSelect.hideRole(),this.zsPanel.open(),this.zsPanel.setData()):(UserTips.ins().showTips(GlobalConfig.ZhuanShengConfig.level+"级开启转生"),this.tab.selectedIndex=this.viewStack.selectedIndex);break;case 3:Actor.level>=GlobalConfig.WingCommonConfig.openLevel?(this.biaoti.source="biaoti_yuyi",this.roleSelect.openRole(),this.wingPanel.open()):(UserTips.ins().showTips("羽翼"+GlobalConfig.WingCommonConfig.openLevel+"级开启"),this.tab.selectedIndex=this.viewStack.selectedIndex);break;case 4:this.reincarnationPanel.open(),this.tab.selectedIndex=this.viewStack.selectedIndex=4,this.help.visible=!0}this.oldIndex!=t?this.tab.selectedIndex!=this.viewStack.selectedIndex&&(this.viewStack.getElementAt(this.oldIndex).close(),this.oldIndex=t):this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.redPoint()},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);var e=ViewManager.ins().getView(UIView2);e&&e.closeNav(UIView2.NAV_ROLE);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,22)}},e.prototype.delayRedPoint=function(){TimerManager.ins().isExists(this.redPoint,this)||TimerManager.ins().doTimer(60,1,this.redPoint,this)},e.prototype.redPoint=function(){var t=[UserZs.ins().canOpenZSWin()&&!UserZs.ins().isMaxLv()&&(UserZs.ins().canGet()>0||UserZs.ins().canUpgrade())],e=this.canWingEquip(),i=UserSkill.ins().canHejiEquip()||UserSkill.ins().canExchange()||UserSkill.ins().canSolve()||UserSkill.ins().canAcitve(),s=this.canEquip(),n=(SamsaraModel.ins().isOpen(),OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||SpecialRing.ins().fireRingRedPoint()||LyMark.ins().checkRed())),o=[s,i,t,e];this.redPoint0.visible=this.and(s)||n||SubRoles.ins().isLockRole()||SamsaraModel.ins().isOpen()&&SamsaraModel.ins().isCanAddSpirit()||JadeNew.ins().checkRed()||ShenshouRedpoint.ins().redpoint,this.redPoint1.visible=i||UserSkill.ins().getPunchForge().getRedPoint(),this.redPoint2.visible=this.and(t),this.redPoint3.visible=this.and(e)||this.and(Wing.ins().canGradeupWing())||this.and(Wing.ins().canItemGradeupWing())||Wing.ins().isHaveActivationWing()||GodWingRedPoint.ins().getGodWingRedPoint(),this.redPoint3.visible=Actor.level>=GlobalConfig.WingCommonConfig.openLevel?this.redPoint3.visible:!1;for(var a=SubRoles.ins().subRolesLen,r=0;a>r;r++){var h=!1;this.tab.selectedIndex<4&&(o[this.tab.selectedIndex][r]&&(h=!0),this.roleSelect.showRedPoint(r,h))}SamsaraModel.ins().isOpen()?(this.openSamsara(),this.setSamsaraEquipVisible(!0)):(this.inactiveSamsara(),this.setSamsaraEquipVisible(!1))},e.prototype.setSamsaraEquipVisible=function(t){this.roleInfoPanel&&4==this.viewStack.selectedIndex&&this.roleInfoPanel.skinName&&(this.roleInfoPanel.item9.visible=t,this.roleInfoPanel.item10.visible=t,this.roleInfoPanel.item11.visible=t,this.roleInfoPanel.item12.visible=t)},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.canWingEquip=function(){for(var t=[!1,!1,!1],e=Wing.ins().canGradeupWing(),i=Wing.ins().canItemGradeupWing(),s=Wing.ins().canRoleOpenWing(),n=SubRoles.ins().subRolesLen,o=0;n>o;o++)GlobalConfig.WingCommonConfig.openLevel>Actor.level?t[o]=!1:s[o]?t[o]=!0:((e[o]||i[o])&&(t[o]=!0),Wing.ins().canUseAptitudeByRoleID(o)&&(t[o]=!0),Wing.ins().canUseFlyUpByRoleID(o)&&(t[o]=!0));return t},e.prototype.canEquip=function(){var t=[!1,!1,!1];if(this.canChangeEquips&&this.canChangeEquips[0].length||(this.canChangeEquips=UserRole.ins().canChangeEquips),this.canChangeEquips)for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=this.canChangeEquips[i];for(var n in s)if(s[n]){t[i]=!0;break}if(0==t[i])for(var o=0;5>o;o++){var a=[];if(a=o>1?LongHun.ins().canGradeupLoongSoul(o):SpecialRing.ins().canGradeupRing(o),a[i]){t[i]=a[i];break}}for(var r=SubRoles.ins().getSubRoleByIndex(i),h=!1,l=0;8>l;l++){if(h=UserEquip.ins().setOrangeEquipItemState(l,r),!h&&2>l&&(h=UserEquip.ins().setLegendEquipItemState(l>0?2:0,r)),h){var c=UserBag.ins().checkEqRedPoint(i,r);h=null!=c?c:h}if(h)break}h||(h=UserEquip.ins().checkRedPointEx(4,i)),h||(h=UserEquip.ins().checkRedPointEx(5,i)),h||(h=Boolean(UserBag.ins().getHuntGoods(0).length)),h&&(t[i]=h),t[i]||(t[i]=SamsaraModel.ins().checkRoleCanAddSpirit(i))}return t},e.prototype.getWingPanelInfo=function(){if(!this.isShow())return!1;if(3!=this.oldIndex)return!1;for(var t,e=SubRoles.ins().roles.length,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i).wingsData;t&&0!=t.clearTime?t.clearTime>s.clearTime&&s.clearTime>0&&(t=s):t=s}return this.wingData=t,t.clearTime>0&&Wing.hint},e.prototype.doOpenHintWin=function(t,e){void 0===e&&(e=0),ViewManager.ins().open(WingHintWin,t,e,this.wingData)},e.prototype.getEquipGrid=function(t){return this.validateNow(),this.roleInfoPanel.getEquipItem(t)},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(RoleWin.prototype,"RoleWin"),ViewManager.ins().reg(RoleWin,LayerManager.UI_Main);var StarItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="StarItemSkin",e}return __extends(e,t),e.prototype.isShow=function(t){this.starImg.source=t?"star2":""},e.prototype.isShowFull=function(t){this.fullStarImg.source=t?"star1":""},e}(BaseView);__reflect(StarItem.prototype,"StarItem");var StarList=function(t){function e(e,i,s,n){void 0===e&&(e=10),void 0===i&&(i=0),void 0===s&&(s=50),void 0===n&&(n=1);var o=t.call(this)||this;o._statListLength=e,o._starNum=i,o.list=[];for(var a=0;a<o._statListLength;a++){var r=new StarItem;r.x=a*s+10,o.addChild(r),a<=o._starNum-1&&r.isShow(1),r.isShowFull(n),o.list.push(r)}return o.mc=new MovieClip,o.mc.scaleX=1.5,o.mc.scaleY=1.5,o}return __extends(e,t),e.prototype.setStarNum=function(t,e){if(void 0===e&&(e=0),this._starNum!=t){this._starNum=t;for(var i=0;i<this._statListLength;i++)i<=this._starNum-1?(this.list[i].isShow(1),1==e&&i==this._starNum-1&&(this.mc.x=this.list[i].x+24,this.mc.y=this.list[i].y+28,this.mc.parent||this.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"minusstar",1))):this.list[i].isShow(0)}},Object.defineProperty(e.prototype,"starNum",{get:function(){return this._starNum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listLength",{get:function(){return this._statListLength},enumerable:!0,configurable:!0}),e.prototype.setlistLength=function(t,e,i,s){void 0===t&&(t=10),void 0===e&&(e=0),void 0===i&&(i=50),void 0===s&&(s=1);for(var n=this._statListLength;t>n;n++){var o=new StarItem;o.x=n*i+10,this.addChild(o),e-1>=n&&o.isShow(1),o.isShowFull(s),this.list.push(o)}this._statListLength=t},e}(BaseView);__reflect(StarList.prototype,"StarList");var WingHintWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WingWarnTips"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.up,this.onClick),this.addTouchEvent(this.BG,this.onClick),this.type=t[0],this.index=t[1],this.data=t[2],this.lastTimeDown=Math.floor((DateUtils.formatMiniDateTime(this.data.clearTime)-GameServer.serverTime)/1e3),this.lastTimeDown=(DateUtils.formatMiniDateTime(this.data.clearTime)-GameServer.serverTime)/1e3,this.lastTimeDown=Math.max(0,this.lastTimeDown),this.desc.textFlow=TextFlowMaker.generateTextFlow("你的羽翼有祝福值：|C:0xf8b141&T:"+this.data.exp+"|,将在|C:0xf3311e&T:"+DateUtils.getFormatBySecond(this.lastTimeDown,1)+"|清空，请尽快升阶?")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onClick),this.removeTouchEvent(this.up,this.onClick),this.removeTouchEvent(this.BG,this.onClick)},e.prototype.onClick=function(t){switch(ViewManager.ins().close(e),t.currentTarget){case this.closeBtn:if(1==this.type){var i=ViewManager.ins().getView(RoleWin);i.setTabSelectedIndex(this.index)}else 2==this.type&&ViewManager.ins().close(RoleWin)}Wing.hint=!this.nextHint.selected},e}(BaseEuiView);__reflect(WingHintWin.prototype,"WingHintWin"),ViewManager.ins().reg(WingHintWin,LayerManager.UI_Popup);var WingSkillItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.skinName="WingSkillItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.skillIcon.visible=!0,this.skillIcon.source=this.data+"_png",this.blackImg.visible=!1)},e}(BaseItemRender);__reflect(WingSkillItemRender.prototype,"WingSkillItemRender");var WingSkillTipPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WingSkillTipsPanel"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.addTouchEndEvent(this,this.otherClose),this.setData(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t){var e=new SkillData(t);e.name&&(this.nameLabel.text=e.name),e.desc&&(this.description.textFlow=TextFlowMaker.generateTextFlow(e.desc)),this.BG.height=170+this.description.height},e}(BaseEuiView);__reflect(WingSkillTipPanel.prototype,"WingSkillTipPanel"),ViewManager.ins().reg(WingSkillTipPanel,LayerManager.UI_Popup);var Wing=function(t){function e(){var e=t.call(this)||this;return e.timeID=0,e.godWing=[],e.isListen=!1,e.sysId=PackageID.Wing,e.regNetMsg(1,e.doUpDataWing),e.regNetMsg(2,e.doBoost),e.regNetMsg(3,e.postWingWear),e.regNetMsg(4,e.postActivate),e.regNetMsg(5,e.postGodWingData),e.regNetMsg(8,e.postUseDanSuccess),e.regNetMsg(11,e.postWingEquip),e.observe(UserBag.ins().postItemAdd,e.startCheckHaveCan),e.observe(UserBag.ins().postItemDel,e.startCheckHaveCan),e.observe(GameLogic.ins().postSubRoleChange,e.startCheckHaveCan),e.observe(Actor.ins().postLevelChange,e.startCheckHaveCan),e.observe(e.postWingUpgrade,e.startCheckHaveCan),e.observe(UserBag.ins().postItemChange,e.startCheckHaveCan),e.observe(e.postUseDanSuccess,e.startCheckHaveCan),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initConfig=function(){if(!this.wingSkillDic){this.wingSkillDic=[];var t=GlobalConfig.WingLevelConfig;for(var e in t)t[e].pasSkillId&&this.wingSkillDic.push(t[e].pasSkillId)}},e.prototype.getWingSkillByIndex=function(t){return this.initConfig(),this.wingSkillDic[t]},e.prototype.startCheckHaveCan=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=-1),this.isListen||(this.isListen=!0,TimerManager.ins().doTimerDelay(3e3,1e3,1,this.showNavBtnRedPoint,this))},e.prototype.sendBoost=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendUpgrade=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.sendActivate=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.dressWingEquip=function(t,e,i){var s=this.getBytes(11);s.writeDouble(e),s.writeShort(t),s.writeShort(i),this.sendToServer(s)},e.prototype.sendBigUpLevel=function(t){var e=this.getBytes(12);e.writeInt(t),this.sendToServer(e)},e.prototype.doBigUpLevel=function(t){var e,i=t.readInt();if(i)e="道具不足够";else{t.readInt()}UserTips.ins().showTips(e)},e.prototype.doUpDataWing=function(t){var e=t.readShort();SubRoles.ins().getSubRoleByIndex(e).wingsData.parser(t)},e.prototype.doBoost=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e).wingsData.lv;SubRoles.ins().getSubRoleByIndex(e).wingsData.parserBoost(t);var s=0,n=t.readInt();if(SubRoles.ins().getSubRoleByIndex(e).wingsData.parserClearTime(t),s=t.readShort(),this.postBoost(s,n),i!=SubRoles.ins().getSubRoleByIndex(e).wingsData.lv){var o=GlobalConfig.WingLevelConfig[SubRoles.ins().getSubRoleByIndex(e).wingsData.lv];o.pasSkillId,SubRoles.ins().getSubRoleByIndex(e).setWingSkill();var a=EntityManager.ins().getMainRole(e);a&&a.updateModel(),this.postWingUpgrade(),Activationtongyong.show(1,o.name,"j"+o.appearance+"_png")}this.postWingTime()},e.prototype.postBoost=function(t,e){return[t,e]},e.prototype.postWingUpgrade=function(){},e.prototype.postActivate=function(t){var e=t.readShort();SubRoles.ins().getSubRoleByIndex(e).wingsData.parserOpenStatus(t);var i=GlobalConfig.WingLevelConfig[0];Activationtongyong.show(0,i.name,"j"+i.appearance+"_png");var s=EntityManager.ins().getMainRole(e);s&&s.updateModel()},e.prototype.postWingEquip=function(t){var e=t.readShort(),i=t.readShort(),s=new ItemData;
s.parser(t),SubRoles.ins().getSubRoleByIndex(e).wingsData.getEquipByIndex(i).item=s;var n=EntityManager.ins().getMainRole(e);n&&n.updateModel()},e.prototype.postWingTime=function(){},e.prototype.showNavBtnRedPoint=function(){this.isListen=!1;var t=!1;Actor.level;return Actor.level>=GlobalConfig.WingCommonConfig.openLevel&&!t&&this.and(this.canGradeupWing())?void UserRole.ins().showNavBtnRedPoint(!0):this.canUseFlyUp()?void UserRole.ins().showNavBtnRedPoint(!0):this.canUseAptitude()?void UserRole.ins().showNavBtnRedPoint(!0):void UserRole.ins().showNavBtnRedPoint(!1)},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.getLevelBySkill=function(t){if(!this.wingSkillLevelDic){this.wingSkillLevelDic=[];var e=GlobalConfig.WingLevelConfig;for(var i in e)e[i].pasSkillId>0&&this.wingSkillLevelDic.push(e[i].level)}return this.wingSkillLevelDic[t]?this.wingSkillLevelDic[t]:0},e.prototype.canGradeupWing=function(){var t=[!1,!1,!1];return t},e.prototype.canItemGradeupWing=function(){for(var t=[!1,!1,!1],i=e.WingMaxLv,s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n).wingsData.openStatus;if(o){var a=SubRoles.ins().getSubRoleByIndex(n).wingsData.lv;if(i>a&&a<e.WingExpRedPoint){var r=GlobalConfig.WingLevelConfig[a];if(Assert(r,"get WingLevelConfig null "+a))continue;var h=UserBag.ins().getBagGoodsCountById(0,r.itemId);t[n]=r.itemNum<=h}else t[n]=!1;if(!t[n]){var l=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.WingCommonConfig.levelItemid);t[n]=l>0&&a==e.WingExpRedPoint}}}return t},e.prototype.isHaveActivationWing=function(t){void 0===t&&(t=-1);var e=Actor.level,i=GlobalConfig.WingCommonConfig.openLevel;if(i>e)return!1;var s=SubRoles.ins().subRolesLen;if(-1==t)for(var n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n).wingsData;if(!o.openStatus)return!0}else{var o=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(!o.openStatus)return!0}return!1},e.prototype.canRoleOpenWing=function(){for(var t=[!1,!1,!1],e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i).wingsData.openStatus;t[i]=!s&&Actor.level>=16}return t},e.prototype.sendWingWear=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postWingWear=function(t){var e=t.readBoolean();return e},e.prototype.postGodWingData=function(t){var e=t.readShort();this.godWing[e]||(this.godWing[e]=new GodWingData),this.godWing[e].parser(t)},e.prototype.sendUseDan=function(t,e){var i=this.getBytes(8);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postUseDanSuccess=function(t){var e=SubRoles.ins().getSubRoleByIndex(t.readByte()).wingsData,i=t.readByte(),s=t.readShort();0==i?e.aptitudeDan=s:e.flyUpDan=s},e.prototype.canUseFlyUp=function(){for(var t=SubRoles.ins().roles.length,e=0;t>e;e++)if(this.canUseFlyUpByRoleID(e))return!0;return!1},e.prototype.canUseFlyUpByRoleID=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);if(e.wingsData&&1==e.wingsData.openStatus&&e.wingsData.flyUpDan<GlobalConfig.WingLevelConfig[e.wingsData.lv].flyPill){var i=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId),s=i?i.count:0;if(s)return!0}return!1},e.prototype.canUseAptitude=function(){for(var t=SubRoles.ins().roles.length,e=0;t>e;e++)if(this.canUseAptitudeByRoleID(e))return!0;return!1},e.prototype.canUseAptitudeByRoleID=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);if(e.wingsData&&1==e.wingsData.openStatus&&e.wingsData.aptitudeDan<GlobalConfig.WingLevelConfig[e.wingsData.lv].attrPill){var i=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId),s=i?i.count:0;if(s)return!0}return!1},e.prototype.userDans=function(t){for(var e,i,s,n=SubRoles.ins().roles.length,o=null,a=null,r=0,h=0,l=t==GlobalConfig.WingCommonConfig.attrPillId,c=0;n>c;c++)e=SubRoles.ins().getSubRoleByIndex(c),1==e.wingsData.openStatus?(i=GlobalConfig.WingLevelConfig[e.wingsData.lv],s=l&&e.wingsData.aptitudeDan>=i.attrPill||!l&&e.wingsData.flyUpDan>=i.flyPill,s?h++:(o||(o=e),e.wingsData.lv>o.wingsData.lv&&(o=e),a||(a=e),l&&e.wingsData.aptitudeDan>o.wingsData.aptitudeDan&&(a=e),!l&&e.wingsData.flyUpDan>o.wingsData.flyUpDan&&(a=e))):r++;if(r>=n)return void UserTips.ins().showTips("所有角色均未开启羽翼");if(h>=n)return void UserTips.ins().showTips("所有角色羽翼"+(l?"资质":"飞升")+"已满级");var u=o.index;o.index!=a.index&&o.wingsData.lv==a.wingsData.lv&&(u=a.index),ViewManager.ins().open(RoleWin,3,u)},e.prototype.sendWingCompose=function(t,e,i){var s=t,n=this.getBytes(6);n.writeShort(s),n.writeInt(e),1==s&&n.writeInt(i),this.sendToServer(n)},e.prototype.sendResetGodWing=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getCurLevelItemId=function(t,e){var i,s;return this.godWing[t]&&(s=this.godWing[t].getLevel(e))?i=GlobalConfig.GodWingLevelConfig[s][e]:null},e.prototype.getNextLevelItemId=function(t,e){var i;return i=this.godWing[t].getLevel(e),i=i?this.getNextLevel(i):0,GlobalConfig.GodWingLevelConfig[i]?GlobalConfig.GodWingLevelConfig[i][e]:null},e.prototype.quickComposeRedPoint=function(t,i){var s=e.ins().getGodWing(t).getLevel(i),n=this.getNextLevel(s);if(!n)return!1;var o=GlobalConfig.GodWingLevelConfig[n][i];return this.checkGodWingLevel(t,o.itemId)&&this.checkGodWingItem(t,o.itemId,i)?!0:!1},e.prototype.wearItemRedPoint=function(t,e){return this.checkSlotLevel(t,e)?!0:!1},e.prototype.gridRedPoint=function(t,e){return this.wearItemRedPoint(t,e)?!0:this.quickComposeRedPoint(t,e)},e.prototype.isWearGodWing=function(t){var i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;for(var s=1;s<=e.GodWingMaxSlot;s++)if(this.gridRedPoint(i.index,s))return!0;return!1},e.prototype.checkSlot=function(t,i){var s=e.ins().getGodWing(t).getLevel(i);return s?!0:!1},e.prototype.getWearItem=function(t,i){for(var s=e.ins().getGodWing(t).getLevel(i),n=UserBag.ins().getBagGoodsByType(ItemType.TYPE_16),o=0;o<n.length;o++){var a=GlobalConfig.GodWingItemConfig[n[o].configID];if(this.checkGodWingLevel(t,a.itemId)&&a.slot==i&&a.level>s)return a.itemId}return 0},e.prototype.checkSlotLevel=function(t,i){for(var s=e.ins().getGodWing(t).getLevel(i),n=UserBag.ins().getBagGoodsByType(ItemType.TYPE_16),o=0;o<n.length;o++){var a=GlobalConfig.GodWingItemConfig[n[o].configID];if(this.checkGodWingLevel(t,a.itemId)&&a.slot==i&&a.level>s)return!0}return!1},e.prototype.checkGodWingLevel=function(t,e){var i=GlobalConfig.GodWingItemConfig[e],s=0,n=SubRoles.ins().getSubRoleByIndex(t).wingsData;return s+=n.lv,n.openStatus&&(s+=1),s>=i.level?!0:!1},e.prototype.checkGodWingItem=function(t,e,i){var s=GlobalConfig.GodWingItemConfig[e],n=s.composeItem.count,o=0,a=UserBag.ins().getBagItemById(s.composeItem.id);if(a&&(o=a.count),i){var r=this.getGodWing(t).getLevel(i);r&&(n-=1)}return o>=n?!0:!1},e.prototype.isQuicComposeGodWing=function(t,i){var s=SubRoles.ins().getSubRoleByIndex(t);if(!s)return!1;var n=this.godWing[t].getLevel(i);if(n||(n=this.getStartLevel(i)),!n)return!1;var o=0,a=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(o+=a.lv,a.openStatus&&(o+=1),n>o)return!1;var r=e.ins().getGodWing(t).getLevel(i);if(r&&(n=this.getNextLevel(n),!n))return!1;var h=GlobalConfig.GodWingLevelConfig[n][i].itemId,l=GlobalConfig.GodWingItemConfig[h],c=l.composeItem.count,u=0,p=UserBag.ins().getBagItemById(l.composeItem.id);p&&(u=p.count);var d=e.ins().getGodWing(t).getLevel(i);if(d){var g=GlobalConfig.GodWingLevelConfig[d][i];g.itemId==l.composeItem.id&&(u+=1)}return u>=c?!0:!1},e.prototype.isComposeGodWingOnly=function(t){var e=GlobalConfig.GodWingItemConfig[t],i=e.composeItem.count,s=0,n=UserBag.ins().getBagItemById(e.composeItem.id);return n&&(s=n.count),s>=i?!0:!1},e.prototype.isComposeGodWingAll=function(){for(var t in GlobalConfig.GodWingSuitConfig)for(var i=GlobalConfig.GodWingSuitConfig[t],s=1;s<=e.GodWingMaxSlot;s++){var n=GlobalConfig.GodWingLevelConfig[i.lv][s];if(this.isComposeGodWingOnly(n.itemId))return!0}return!1},e.prototype.isComposeGodWingLevel=function(t,e){var i=GlobalConfig.GodWingLevelConfig[t][e];return this.isComposeGodWingOnly(i.itemId)?!0:!1},e.prototype.isComposeGodWingSlot=function(t,e){var i=GlobalConfig.GodWingSuitConfig[t],s=GlobalConfig.GodWingLevelConfig[i.lv][e];return this.isComposeGodWingOnly(s.itemId)?!0:!1},e.prototype.isComposeGodWing=function(t){for(var e=(SubRoles.ins().subRolesLen,0);3>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);if(i)for(var s=this.calcGodWingSlot(e),n=0;n<s.length;n++){var o=GlobalConfig.GodWingLevelConfig[s[n].level][s[n].slot];if(t){var a=0,r=SubRoles.ins().getSubRoleByIndex(e).wingsData;if(a+=r.lv,r.openStatus&&(a+=1),a<o.level)continue}var h=GlobalConfig.GodWingItemConfig[o.itemId],l=h.composeItem.id,c=UserBag.ins().getBagItemById(l),u=h.composeItem.count,p=c?c.count:0;if(p>=u)return!0}}return!1},e.prototype.calcGodWingSlot=function(t){for(var i=[],s=1;s<=e.GodWingMaxSlot;s++){var n=e.ins().getGodWing(t).getLevel(s),o={slot:0,level:0};o.slot=s,n||(n=this.getStartLevel(s)),o.level=n,i.push(o)}return i},e.prototype.getStartLevel=function(t){for(var e in GlobalConfig.GodWingLevelConfig){var i=GlobalConfig.GodWingLevelConfig[e];for(var s in i)if(i[s].slot==t)return i[s].level}return 0},e.prototype.getPreLevel=function(t){var e=0;for(var i in GlobalConfig.GodWingLevelConfig)if(e){if(Number(i)==t)return e;e=Number(i)}else e=Number(i);return e},e.prototype.getNextLevel=function(t){var e=[];for(var i in GlobalConfig.GodWingLevelConfig)e.push(+i);e.sort(function(t,e){return e>t?-1:1});for(var s=0,n=e;s<n.length;s++){var o=n[s];if(o>t)return o}return 0},e.prototype.getNameFromSlot=function(t){var e="";switch(t){case 1:e="飞羽";break;case 2:e="纤羽";break;case 3:e="绒羽";break;case 4:e="翎羽"}return e},e.prototype.getGodWing=function(t){return this.godWing[t]||(this.godWing[t]=new GodWingData),this.godWing[t]},e}(BaseSystem);Wing.WingMaxLv=9,Wing.WingExpRedPoint=3,Wing.GodWingMaxSlot=4,Wing.hint=!0,__reflect(Wing.prototype,"Wing");var GodWingData=function(){function t(){this.data={}}return t.prototype.parser=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readShort(),n=t.readInt();this.data[s]={slot:s,level:n}}},t.prototype.getLevel=function(t){return this.data[t]?this.data[t].level:0},t.prototype.getData=function(){return this.data},t.prototype.getSuitLevel=function(){var t=Number.MAX_VALUE,e=0;for(var i in this.data)this.data[i].level<t&&(e=this.data[i].slot,t=this.data[i].level);if(!e)return 0;var s=GlobalConfig.GodWingLevelConfig[t][e];if(!s)return 0;var n=[];for(var o in GlobalConfig.GodWingItemConfig){var a=GlobalConfig.GodWingItemConfig[o];if(n.length>=Wing.GodWingMaxSlot)break;a.level>=s.level&&s.slot!=a.slot&&this.data[a.slot]&&this.data[a.slot].level>=a.level&&n.push(a.itemId)}return n.length>=Wing.GodWingMaxSlot-1?t:0},t.prototype.getSuitSum=function(){var t=this.getSuitLevel(),e=0;for(var i in this.data)this.data[i].level>=t&&e++;return e},t}();__reflect(GodWingData.prototype,"GodWingData");var GameSystem;!function(t){t.wing=Wing.ins.bind(Wing)}(GameSystem||(GameSystem={}));var RuneConfigMgr=function(t){function e(){var e=t.call(this)||this;return e.exchangeList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getBaseCfg=function(t,e){void 0===e&&(e=!1);var i=GlobalConfig.RuneBaseConfig;if(Assert(i,"RuneBaseConfigs is null"))return null;var s=e?t.configID+1:t.configID;return i[s]},e.prototype.getBaseCfgByItemConfig=function(t){var e=GlobalConfig.RuneBaseConfig;return Assert(e,"RuneBaseConfigs is null")?null:e[t.id]},e.prototype.getConverCfgByItemConfig=function(t){var e=GlobalConfig.RuneConverConfig;return Assert(e,"RuneConverConfigs is null")?null:e[t.configID]},e.prototype.getLockCfg=function(t){var e=GlobalConfig.RuneLockPosConfig;return Assert(e,"RuneLockPosConfigs is null")?null:e[t]},e.prototype.getNameCfg=function(t){var e=GlobalConfig.RuneNameConfig;return Assert(e,"RuneNameConfigs is null")?null:e[t]},e.prototype.getOtherCfg=function(){var t=GlobalConfig.RuneOtherConfig;return Assert(t,"RuneOtherConfig is null")?null:t},e.prototype.getcfgAttrData=function(t,e){if(void 0===e&&(e=!0),!t)return"";var i="";return i+=this.getAttrNamesByList(t.attr,0,e),i+=this.getAttrNamesByList(t.equipAttr,1,e),i+=this.getAttrNamesByList(t.exAttr,2,e),i+=this.getAttrNamesByList(t.specialAttr,3,e)},e.prototype.getAttrNamesByList=function(t,e,i){var s="";if(!t||t.length<=0)return"";switch(e){case 0:for(var n in t)t[n]&&(s+=i?AttributeData.getAttrStrByType(t[n].type)+"\n":"+"+t[n].value+"\n");break;case 1:for(var n in t)t[n]&&(s+=i?AttributeData.getEEquipAttrStrByType(t[n].type)+"\n":"+"+t[n].value+"%\n");break;case 2:for(var n in t)t[n]&&(s+=i?AttributeData.getExtAttrStrByType(t[n].type)+"\n":"+"+t[n].value+"\n");break;case 3:for(var n in t)t[n]&&(s+=i?(1==t[n].type?"金币":"经验")+"\n":"+"+t[n].value+"%\n")}return s},e.prototype.getcfgAttrDesc=function(t,e){if(void 0===e&&(e=!1),!t)return"";var i="";return i+=this.getAttrDescByList(t.attr,0,e),i+=this.getAttrDescByList(t.equipAttr,1,e),i+=this.getAttrDescByList(t.exAttr,2,e),i+=this.getAttrDescByList(t.specialAttr,3,e),i.lastIndexOf("\n")==i.length-1&&(i=i.substring(0,i.length-1)),i},e.prototype.getAttrDescByList=function(t,e,i){void 0===i&&(i=!1);var s="";if(!t||t.length<=0)return"";switch(e){case 0:for(var n in t)t[n]&&(i?5==t[n].type||(s+=6==t[n].type?"物防、魔防 +"+t[n].value+"\n":AttributeData.getAttrNameByAttrbute(t[n],!0," + ")+"\n"):s+=AttributeData.getAttrNameByAttrbute(t[n],!0," + ")+"\n");break;case 1:for(var n in t)t[n]&&(s+=AttributeData.getEEquipAttrStrByType(t[n].type)+"  +"+t[n].value+"%\n");break;case 2:for(var n in t)t[n]&&(s+=AttributeData.getExAttrNameByAttrbute(t[n],!0," + ")+"\n");break;case 3:for(var n in t)t[n]&&(s+=(1==t[n].type?"金币":"经验")+"  +"+t[n].value+"%\n")}return s},e.prototype.getAttrByList=function(t,e,i){void 0===i&&(i=!1);var s="";if(!t||t.length<=0)return"";switch(e){case 0:for(var n in t)t[n]&&(s+=AttributeData.getAttrNameByAttrbute(t[n],!0,"：",!1,16298305)+"\n");break;case 1:for(var n in t)t[n]&&(s+=AttributeData.getEEquipAttrStrByType(t[n].type)+"：|C:16298305&T:"+t[n].value+"%\n");break;case 2:for(var n in t)t[n]&&(s+=AttributeData.getExAttrNameByAttrbute(t[n],!0,"：",16298305)+"\n");break;case 3:for(var n in t)t[n]&&(s+=(1==t[n].type?"金币":"经验")+"：|C:16298305&T:"+t[n].value+"%\n")}return s},e.prototype.getExchangeDataList=function(){if(this.exchangeList.length>0)return this.exchangeList;var t=GlobalConfig.RuneConverConfig;for(var e in t)this.exchangeList.push(t[e]);return this.exchangeList.sort(this.sortExchange),this.exchangeList},e.prototype.sortExchange=function(t,e){return t.checkpoint<e.checkpoint?-1:t.checkpoint>e.checkpoint?1:t.id-e.id},e}(BaseClass);__reflect(RuneConfigMgr.prototype,"RuneConfigMgr");var RuneDataMgr=function(t){function e(){var e=t.call(this)||this;return e.posIsWear=null,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRoleRune=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);return e?e.runeDatas:null},e.prototype.getRune=function(t,e){var i=this.getRoleRune(t);return i?i[e]:null},e.prototype.replaceRune=function(t,e,i){var s=this.getRoleRune(t);s&&e>=0&&(s[e].configID=i)},e.prototype.getMinRune=function(t,e){void 0===e&&(e=!1);var i=this.getRoleRune(t);if(!i)return null;for(var s=[],n=0;n<i.length;n++)i[n].itemConfig&&s.push(i[n]);if(s.sort(function(t,e){if(t.itemConfig.id%100<e.itemConfig.id%100)return-1;if(t.itemConfig.id%100>e.itemConfig.id%100)return 1;var i=ItemConfig.getQuality(t.itemConfig),s=ItemConfig.getQuality(e.itemConfig);return i>s?-1:s>i?1:0}),e)for(var o=0,a=s;o<a.length;o++){var r=a[o];if(RuneRedPointMgr.ins().checkSingleUpgrade(r))return r}return s[0]},e}(BaseClass);__reflect(RuneDataMgr.prototype,"RuneDataMgr");var RuneDecomposeItemData=function(){function t(){this.itemData=null,this.isSelected=!1}return t}();__reflect(RuneDecomposeItemData.prototype,"RuneDecomposeItemData");var RuneRedPointMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkSingleUpgrade=function(t){if(!this.checkOpen())return!1;var e=t.itemConfig;if(this.assert(e,"ItemConfig("+t.configID+")"))return!1;var i=RuneConfigMgr.ins().getBaseCfg(t,!0);if(!i)return!1;var s=RuneConfigMgr.ins().getBaseCfg(t);if(this.assert(s,"RuneBaseConfig"))return!1;var n=Actor.runeShatter;return n>=s.expend},e.prototype.checkRoleUpgrade=function(t){if(!this.checkOpen())return!1;var e=RuneDataMgr.ins().getRoleRune(t);if(e)for(var i=0,s=e;i<s.length;i++){var n=s[i];if(n&&n.itemConfig&&n.itemConfig.id>0&&this.checkSingleUpgrade(n))return!0}return!1},e.prototype.checkAllUpgrade=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkRoleUpgrade(e))return!0;return!1},e.prototype.checkSingleReplace=function(t,e){return!1},e.prototype.checkRoleReplace=function(t){if(!this.checkOpen())return!1;var e=RuneDataMgr.ins().getRoleRune(t);if(e)for(var i=0,s=e;i<s.length;i++){var n=s[i];if(n&&n.itemConfig&&n.itemConfig.id>0&&this.checkSingleReplace(t,n))return!0}return!1},e.prototype.checkAllReplace=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkRoleReplace(e))return!0;return!1},e.prototype.checkSingleInlay=function(t,e){if(!this.checkOpen())return!1;var i=RuneConfigMgr.ins().getLockCfg(e);if(this.assert(i,"RuneLockPosConfig("+e+")"))return!1;var s=i.lockLv,n=SkyLevelModel.ins().cruLevel;if(n>s){var o=RuneDataMgr.ins().getRune(t,e);if(o&&o.configID<=0)for(var a=UserBag.ins().getBagGoodsBySort(1),r=0,h=RuneDataMgr.ins().getRoleRune(t),l=!0,c=0,u=a;c<u.length;c++){var p=u[c];if(p&&(r=ItemConfig.getSubType(p.itemConfig),r>0&&h)){if(l=!0)for(var d=0,g=h;d<g.length;d++){var f=g[d];if(f&&f.itemConfig&&f.itemConfig.id>0&&r==ItemConfig.getSubType(f.itemConfig)){l=!1;break}}if(l)return!0}}}return!1},e.prototype.checkRoleInlay=function(t){if(!this.checkOpen())return!1;for(var e=0;e<RuneConfigMgr.ins().getOtherCfg().maxEquip;e++)if(this.checkSingleInlay(t,e))return!0;return!1},e.prototype.checkAllInlay=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkRoleInlay(e))return!0;return!1},e.prototype.checkRoleAllSituation=function(t){if(!this.checkOpen())return!1;var e=this.checkRoleInlay(t);return e||(e=this.checkRoleUpgrade(t)),e||(e=this.checkRoleReplace(t)),e},e.prototype.checkAllSituation=function(t){if(void 0===t&&(t=!0),!this.checkOpen())return!1;var e=this.checkAllInlay();return e||(e=this.checkAllUpgrade()),e||(e=this.checkAllReplace()),t&&(e||(e=this.checkCanExchange())),e},e.prototype.checkCanExchange=function(){for(var t=RuneConfigMgr.ins().getExchangeDataList(),e=0;e<t.length;e++){var i=t[e];if(Actor.runeExchange>=i.conversion)return!0}return!1},e.prototype.checkOpen=function(){return Actor.level>=RuneConfigMgr.ins().getOtherCfg().zsLevel},e.prototype.assert=function(t,i){return Assert(t,"["+egret.getQualifiedClassName(e)+"] "+i+"is null")},e}(BaseClass);__reflect(RuneRedPointMgr.prototype,"RuneRedPointMgr");var Rune=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Rune,e.regNetMsg(1,e.doInlay),e.regNetMsg(2,e.doUpgrade),e.regNetMsg(3,e.doOneKeyDecompose),e.regNetMsg(5,e.postHuntRuneInfo),e.regNetMsg(6,e.postBestListInfo),e.regNetMsg(8,e.postRuneBoxGift),e.regNetMsg(10,e.postDelRune),e.boxs=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendInlay=function(t,e,i){var s=this.getBytes(1);s.writeShort(t),s.writeShort(e),s.writeDouble(i),this.sendToServer(s)},e.prototype.doInlay=function(t){var e=Boolean(t.readShort()),i=0,s=0,n=0;e&&(i=t.readShort(),s=t.readShort(),n=t.readInt()),this.postInlayResult([e,i,s,n])},e.prototype.postInlayResult=function(t){return t},e.prototype.sendUpgrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.doUpgrade=function(t){var e=Boolean(t.readByte());if(e){var i=t.readShort(),s=t.readShort(),n=t.readInt();RuneDataMgr.ins().replaceRune(i,s,n),this.postUpgradeResult([e,i,n,s])}},e.prototype.postUpgradeResult=function(t){return t},e.prototype.sendOneKeyDecompose=function(t){var e=t.length,i=this.getBytes(3);i.writeInt(e);for(var s=0;e>s;s++)i.writeInt(t[s].configID);this.sendToServer(i)},e.prototype.doOneKeyDecompose=function(t){var e=Boolean(t.readByte()),i=t.readInt();this.postOneKeyDecomposeResult([e,i])},e.prototype.postOneKeyDecomposeResult=function(t){return t},e.prototype.sendExchangeRune=function(t){var e=this.getBytes(4);e.writeUnsignedInt(t),this.sendToServer(e)},e.prototype.sendHuntRune=function(t){var e=this.getBytes(5);e.writeShort(t),this.sendToServer(e)},e.prototype.postHuntRuneInfo=function(t){for(var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=[],n=0;i>n;n++)s[n]=[t.readInt(),t.readUnsignedByte()];ViewManager.ins().isShow(HuntResultWin)?Hunt.ins().postHuntResult(e,s,1):ViewManager.ins().open(HuntResultWin,e,s,1)},e.prototype.postBestListInfo=function(t){for(var e=t.readUnsignedByte(),i=[],s=0;e>s;s++)i[s]=[t.readString(),t.readInt()];return i.reverse(),i},e.prototype.sendRuneBoxGift=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.postRuneBoxGift=function(t){this.RuneRewards=t.readInt(),this.runeCount=t.readInt(),this.hope=t.readInt();var i=0;for(var s in GlobalConfig.FuwenTreasureRewardConfig){var n=GlobalConfig.FuwenTreasureRewardConfig[s];this.boxs[i]=this.RuneRewards>>n.id&1?e.ISNGET:this.runeCount>=n.needTime?e.CANGET:e.UNGET,i++}},e.prototype.getIsGetBox=function(){for(var t=0;t<e.BoxSum;t++)switch(e.ins().boxs[t]){case e.UNGET:break;case e.CANGET:return!0;case e.ISNGET:}return!1},e.prototype.sendRuneMerge=function(t){var e=this.getBytes(9);e.writeInt(t),this.sendToServer(e)},e.prototype.postDelRune=function(t){var e=RuneDataMgr.ins().getRune(t.readInt(),t.readInt());e.init()},e.prototype.isOpen=function(){var t=GlobalConfig.MergeTotal[4];return(t.openZs||0)<=UserZs.ins().lv&&(t.openLv||0)<=Actor.level?!0:!1},e.prototype.getRuneMergeEquipByLv=function(t){var e=[],i=GlobalConfig.RuneComposeConfig;for(var s in i)i[s].mixId[1]==t&&e.push({type:MergeType.Rune,id:i[s].id});return e},e.prototype.isRuneCanMergeByID=function(t){var e=GlobalConfig.RuneComposeConfig[t],i=(e.material,UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,e.material[0])),s=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,e.material[1]),n=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.RuneOtherConfig.goldItemId);return i>0&&s>0&&n>=e.count?!0:!1},e.prototype.isRuneCanMergeByType=function(t){var e=GlobalConfig.RuneComposeConfig;for(var i in e)if(e[i].mixId[1]==t&&this.isRuneCanMergeByID(e[i].id))return!0;return!1},e.prototype.isRuneCanMerge=function(){var t=GlobalConfig.RuneComposeConfig;for(var e in t)if(this.isRuneCanMergeByID(t[e].id))return!0;return!1},e.prototype.getRuneMergeByID=function(t){var e=GlobalConfig.RuneComposeConfig;for(var i in e){var s=e[i];for(var n in s.material)if(s.material[n]==t)return s}return null},e.prototype.getIsMergeByID=function(t){var e=GlobalConfig.ItemConfig[t],i=GlobalConfig.RuneComposeConfig;for(var s in i){var n=GlobalConfig.ItemConfig[s];if(ItemConfig.getSubType(e)==ItemConfig.getSubType(n))return!0}return!1},e.prototype.getMergeIndexByType=function(t,e){var i=GlobalConfig.RuneComposeConfig,s=0;for(var n in i)if(i[n].mixId[1]==t){if(e==i[n].id)return s;s++}return s},e.prototype.isEquipMerge=function(t,e,i){var s=this.isMergeId(t),n=GlobalConfig.RuneComposeConfig[s];if(!n)return!1;var o=(GlobalConfig.ItemConfig[t],RuneDataMgr.ins().getRoleRune(e));if(!o)return!1;for(var a,r=RuneDataMgr.ins().getRune(e,i),h=o.length,l=0;h>l;l++){var c=o[l];if(a=RuneConfigMgr.ins().getBaseCfg(c))for(var u=this.getIsEquipMerge(n.checkMaterial,s),p=0;p<u.length;p++){var d=GlobalConfig.ItemConfig[u[p]];if(ItemConfig.getSubType(d)==ItemConfig.getSubType(c.itemConfig)&&r){if(r.configID<=0&&(this.getIsMergeByID(t)||this.getRoleIsHasMerge(u,e)))return!0;if(r.itemConfig){var g=this.getCurIsType(u,ItemConfig.getSubType(r.itemConfig));if(g&&(this.getIsMergeByID(t)||this.getRoleIsHasMerge(u,e)))return!0}}}}return!1},e.prototype.getRoleIsHasMerge=function(t,e){var i=RuneDataMgr.ins().getRoleRune(e);if(!i)return!1;for(var s,n=i.length,o=0;n>o;o++){var a=i[o];if(s=RuneConfigMgr.ins().getBaseCfg(a),s&&this.getIsMergeByID(s.id))for(var r=0;r<t.length;r++){var h=GlobalConfig.ItemConfig[t[r]];if(ItemConfig.getSubType(a.itemConfig)==ItemConfig.getSubType(h))return!0}}return!1},e.prototype.getCurIsType=function(t,e){for(var i=!0,s=0;s<t.length;s++){var n=GlobalConfig.ItemConfig[t[s]];if(ItemConfig.getSubType(n)==e){i=!1;break}}return i},e.prototype.getIsEquipMerge=function(t,e){for(var i=[],s=0;s<t.length;s++)i.push(t[s]);return i.push(e),i},e.prototype.isMergeId=function(t){var e=t,i=GlobalConfig.ItemConfig[t],s=GlobalConfig.RuneComposeConfig;for(var n in s){var o=GlobalConfig.ItemConfig[n];if(ItemConfig.getSubType(i)==ItemConfig.getSubType(o))return parseInt(n);for(var a in s[n].material){var r=GlobalConfig.ItemConfig[s[n].material[a]];if(ItemConfig.getSubType(i)==ItemConfig.getSubType(r))return parseInt(n)}}return e},e.prototype.isCanEquip=function(t,e,i,s){var n=GlobalConfig.ItemConfig[t],o=RuneDataMgr.ins().getRoleRune(e);if(!o)return!0;for(var a,r=o.length,h=0;r>h;h++){var l=o[h];if(a=RuneConfigMgr.ins().getBaseCfg(l),a&&l.itemConfig){var c=GlobalConfig.RuneComposeConfig[a.id];if(!c)continue;for(var u=c.checkMaterial,p=0;p<u.length;p++){var d=GlobalConfig.ItemConfig[u[p]];if(ItemConfig.getSubType(d)==ItemConfig.getSubType(n)){if(0==i)return!1;var g=GlobalConfig.ItemConfig[i];if(ItemConfig.getSubType(g)==ItemConfig.getSubType(n))return!1}}}}return!0},e.prototype.getMergeRune=function(t,e,i){var s=this.isMergeId(t),n=(GlobalConfig.ItemConfig[t],GlobalConfig.RuneComposeConfig[s]),o=[];if(!n)return null;var a=RuneDataMgr.ins().getRoleRune(e);if(!a)return null;for(var r,h=a.length,l=0;h>l;l++){var c=a[l];if(r=RuneConfigMgr.ins().getBaseCfg(c))for(var u=this.getIsEquipMerge(n.checkMaterial,s),p=0;p<u.length;p++){var d=GlobalConfig.ItemConfig[u[p]];if(ItemConfig.getSubType(d)==ItemConfig.getSubType(c.itemConfig)&&i&&i.configID!=r.id&&this.getIsMergeByID(t))return o=["更换"+GlobalConfig.ItemConfig[n.id].name+"将同时脱下"+GlobalConfig.ItemConfig[r.id].name,""+l]}}return null},e}(BaseSystem);Rune.UNGET=0,Rune.CANGET=1,Rune.ISNGET=2,Rune.BoxSum=5,__reflect(Rune.prototype,"Rune");var GameSystem;!function(t){t.rune=Rune.ins.bind(Rune)}(GameSystem||(GameSystem={}));var RunePanel=function(t){function e(){var e=t.call(this)||this;return e.runeList=null,e.curRole=0,e.selectedIndex=0,e.upgradeDifference=0,e.selectItem=null,e.openNum=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initRunes()},e.prototype.initRunes=function(){this.runeList=[];for(var t=8,e=null,i=0;t>i;i++)e=this["rune"+i],e&&this.runeList.push(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.runeList.length;this.selectedIndex=isNaN(t[1])?this.selectedIndex:t[1],this.selectedIndex<0&&(this.selectedIndex=0),this.selectedIndex>=i&&(this.selectedIndex=i-1),this.addTouchEvent(this.replace,this.onTap),this.addTouchEvent(this.uplevel,this.onTap),this.addTouchEvent(this.runeBook,this.onTap),this.addTouchEvent(this.bookBtn,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.btn2,this.onTap),this.observe(Rune.ins().postInlayResult,this.onInlayResult),this.observe(Rune.ins().postUpgradeResult,this.onUpgradeResult),this.observe(UserZs.ins().postZsData,this.onLevelUp),this.observe(Actor.ins().postPowerChange,this.onLevelUp),this.observe(GameLogic.ins().postRuneShatter,this.onShatterChange),this.observe(UserBag.ins().postItemAdd,this.onItemChange),this.observe(UserBag.ins().postItemDel,this.onItemChange),this.observe(UserBag.ins().postItemChange,this.onItemChange),this.observe(Rune.ins().postDelRune,this.onLevelUp),this.updateRunes(!0);for(var s=null,n=0;i>n;n++)s=this.runeList[n],s.init(),s&&s.currentState==RuneDisplay.SKIN_STATE_UNLOCK?(this.addTouchEvent(s,this.onRuneTap),this["linebg"+n]&&(this["linebg"+n].source="zwfwline2")):this["linebg"+n]&&(this["linebg"+n].source="zwfwline1");this.updateRuneDetail(),this.updateSelectedEffect(),this.showRuneRedPoint(),this.setNextOpenInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.replace,this.onTap),this.removeTouchEvent(this.uplevel,this.onTap),this.removeTouchEvent(this.runeBook,this.onTap),this.removeTouchEvent(this.bookBtn,this.onTap),this.removeTouchEvent(this.btn1,this.onTap),this.removeTouchEvent(this.btn2,this.onTap),this.removeObserve();for(var i=null,s=this.runeList.length,n=0;s>n;n++)i=this.runeList[n],i.close()},e.prototype.setNextOpenInfo=function(){var t=RuneConfigMgr.ins().getLockCfg(this.openNum);t?this.levelsay.text="通过第"+t.lockLv+"关开启下一凹槽":this.levelsay.text=""},e.prototype.onLevelUp=function(){this.updateRunes(),this.updateRuneDetail(),this.showRuneRedPoint(),this.showReplaceRedPoint()},e.prototype.onUpgradeResult=function(t){if(t[0]){UserTips.ins().showTips("升级战纹成功");var e=t[1];this.curRole=e,this.updateRunes(),this.updateRuneDetail(),this.showRuneRedPoint(),this.showReplaceRedPoint()}else UserTips.ins().showTips("升级战纹失败，请稍后再试")},e.prototype.onInlayResult=function(t){if(t[0]){UserTips.ins().showTips("镶嵌战纹成功");var e=t[1],i=t[2],s=t[3];RuneDataMgr.ins().replaceRune(e,i,s),this.curRole=e,this.updateRunes(),this.updateRuneDetail(),this.showRuneRedPoint(),this.showReplaceRedPoint()}else UserTips.ins().showTips("镶嵌战纹失败，请稍后重试")},e.prototype.onShatterChange=function(){this.updateRuneDetail(),this.showRuneRedPoint()},e.prototype.onItemChange=function(){this.showRuneRedPoint(),this.showReplaceRedPoint()},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.replace:this.showReplaceWin();break;case this.uplevel:this.upgradeRune();break;case this.runeBook:ViewManager.ins().open(RuneAttrWin,this.curRole);break;case this.bookBtn:ViewManager.ins().open(RuneBookWin);break;case this.btn1:ViewManager.ins().open(TreasureHuntWin,1);break;case this.btn2:ViewManager.ins().open(FbWin,2)}},e.prototype.upgradeRune=function(){var t=this.getRuneDisplay(this.selectedIndex);if(t)switch(t.currentState){case RuneDisplay.SKIN_STATE_LOCK:case RuneDisplay.SKIN_STATE_READY:UserTips.ins().showTips("请先解锁");break;case RuneDisplay.SKIN_STATE_UNLOCK:var e=this.getCurIC();if(e){var i=GlobalConfig.ItemConfig[e.id+1];i?this.upgradeDifference<=0?Rune.ins().sendUpgrade(this.curRole,this.selectedIndex):UserTips.ins().showTips("战纹精华不足，分解战纹可获得战纹精华"):UserTips.ins().showTips("战纹等级已满无法进行升级")}else UserTips.ins().showTips("请先镶嵌一个战纹")}},e.prototype.showReplaceWin=function(){var t=this.getRuneDisplay(this.selectedIndex);if(t)switch(t.currentState){case RuneDisplay.SKIN_STATE_LOCK:case RuneDisplay.SKIN_STATE_READY:UserTips.ins().showTips("请先解锁");break;case RuneDisplay.SKIN_STATE_UNLOCK:ViewManager.ins().open(RuneReplaceWin,this.selectedIndex,this.curRole,t.data,this.runeTypeList)}},e.prototype.onRuneTap=function(t){if(t&&t.currentTarget){var e=t.currentTarget;if(this.selectedIndex=e.pos,this.updateRuneDetail(),this.updateSelectedEffect(),this.showReplaceRedPoint(),e.currentState==RuneDisplay.SKIN_STATE_UNLOCK){var i=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);i&&i.configID<=0&&ViewManager.ins().open(RuneReplaceWin,this.selectedIndex,this.curRole,e.data,this.runeTypeList)}}},e.prototype.updateSelectedEffect=function(){if(this.runeList)for(var t=0,e=this.runeList;t<e.length;t++){var i=e[t];i&&i.showOrHideSelected(i.pos==this.selectedIndex)}},e.prototype.showLink=function(){this.linkGroup.visible=!1;var t=RuneDataMgr.ins().getRoleRune(this.curRole);if(t){for(var e,i=!0,s=this.runeList.length,n=0;s>n;n++){var o=t[n];if(e=RuneConfigMgr.ins().getBaseCfg(o)){i=!1;break}}this.linkGroup.visible=i}},e.prototype.updateRunes=function(t){var e=RuneDataMgr.ins().getRoleRune(this.curRole);
if(e){this.openNum=0,this.runeTypeList=[];var i=0,s=null,n=null,o=null,a=this.runeList.length,r=0;this.runeBook.visible=!1;for(var h=0;a>h;h++)s=e[h],n=RuneConfigMgr.ins().getBaseCfg(s),n&&(r+=UserBag.getAttrPower(n.attr)+(n.power||0)),o=this.runeList[h],s.configID&&s.itemConfig&&this.runeTypeList.push(ItemConfig.getSubType(s.itemConfig)),o&&(o.setPos(h),s&&s.itemConfig&&s.itemConfig.id>0?(o.setData(s),this.runeBook.visible=!0):o.cleanData(),o.currentState==RuneDisplay.SKIN_STATE_UNLOCK&&(this.openNum+=1),o.currentState==RuneDisplay.SKIN_STATE_LOCK?(i+=1,1==i?o.setLockTF(!0):o.setLockTF(!1)):o.setLockTF(!1));this.powerPanel.setPower(r),t&&this.setSelectedIndexRule(this.curRole),this.showLink()}},e.prototype.updateRuneDetail=function(){var t=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);if(this.selectItem=t,t&&t.configID>0){this.rune8.showName(!1),this.rune8.setData(t);var e=GlobalConfig.ItemConfig[t.itemConfig.id],i=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(e)];this.nuneName.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemConfig.getQualityColor(e)+"&T:"+i.runeName+"Lv."+e.id%100);var s=RuneConfigMgr.ins().getBaseCfg(t),n=this.getCurIC();if(!n||!s)return;this.up.visible=!0,this.showReplaceRedPoint();var o=null;o=RuneConfigMgr.ins().getBaseCfg(t,!0),o?(this.attrDesc.text=RuneConfigMgr.ins().getcfgAttrDesc(o),this.setCost(s),this.costImg.visible=!0,this.cost.x=328,this.arrow.visible=!0):(this.attrDesc.text="",this.costImg.visible=!1,this.arrow.visible=!1,this.cost.textFlow=TextFlowMaker.generateTextFlow("|C:0xf3311e&T:等级已满|"),this.cost.x=310),this.addAttr.text=RuneConfigMgr.ins().getcfgAttrDesc(s)}else this.up.visible=!1},e.prototype.setCost=function(t){if(t){var e=t.expend,i=Actor.runeShatter;this.upgradeDifference=e-i,this.upgradeDifference<0&&(this.upgradeDifference=0);var s="";s=i>=e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.cost.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+i+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+e+"</font> ")}},e.prototype.getRuneDisplay=function(t){return this.runeList?this.runeList[t]:null},e.prototype.getCurIC=function(){var t=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);if(t&&t.configID>0){var e=GlobalConfig.ItemConfig[t.configID];if(!this.assert(e,"ItemConfig("+t.configID+")"))return e}return null},e.prototype.showRuneRedPoint=function(){for(var t=!1,e=null,i=0,s=this.runeList;i<s.length;i++){var n=s[i];n&&(t=RuneRedPointMgr.ins().checkSingleInlay(this.curRole,n.pos),t||(e=n.data,e&&e instanceof ItemData&&e.configID>0&&(t=RuneRedPointMgr.ins().checkSingleUpgrade(e),t||(t=RuneRedPointMgr.ins().checkSingleReplace(this.curRole,e)))),n.redPoint.visible=t)}},e.prototype.showReplaceRedPoint=function(){var t=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);t&&t.configID>0?(this.redPointReplace.visible=RuneRedPointMgr.ins().checkSingleReplace(this.curRole,t),this.upRed&&(this.upRed.visible=RuneRedPointMgr.ins().checkSingleUpgrade(t))):(this.redPointReplace.visible=!1,this.upRed&&(this.upRed.visible=!1))},e.prototype.setSelectedIndexRule=function(t){var e=RuneDataMgr.ins().getMinRune(t,!0);if(e)for(var i=0;i<this.runeList.length;i++)if(this.runeList[i].getItemConfig()&&this.runeList[i].getItemConfig().id==e.configID){this.selectedIndex=this.runeList[i].pos;break}},e.prototype.assert=function(t,i){return Assert(t,"["+egret.getQualifiedClassName(e)+"] "+i+"is null!")},e}(BaseView);__reflect(RunePanel.prototype,"RunePanel");var RuneWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t&&t[0]?t[0]:0,s=t&&t[1]?t[1]:0;this.roleSelect.setCurRole(i),this.switchTab(s),this.addChangeEvent(this.roleSelect,this.onChange),this.addChangeEvent(this.tab,this.onTabTouch),this.addTouchEndEvent(this.closeBtn,this.onClick),this.observe(GameLogic.ins().postRuneExchange,this.refushRedPoint),this.observe(GameLogic.ins().postRuneShatter,this.refushRedPoint),this.observe(UserBag.ins().postHuntStore,this.refushRedPoint),this.observe(Rune.ins().postInlayResult,this.refushRedPoint),this.observe(Rune.ins().postUpgradeResult,this.refushRedPoint),this.setRoleId(this.roleSelect.getCurRole()),this.refushRedPoint()},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),ViewManager.ins().isShow(RuneBookWin)&&ViewManager.ins().close(RuneBookWin),this.runePanel.close(),this.decomPanel.close(),this.removeTouchEvent(this.closeBtn,this.onClick)},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole()),this.refushRedPoint()},e.prototype.switchTab=function(t){this.viewStack.selectedIndex=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.setRoleId=function(t){this.runePanel.curRole=this.decomPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.runePanel.open();break;case 1:this.decomPanel.open();break;case 2:}},e.prototype.refushRedPoint=function(){this.redPoint1.visible=RuneRedPointMgr.ins().checkAllSituation(!1);for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=RuneRedPointMgr.ins().checkRoleAllSituation(e);this.roleSelect.showRedPoint(e,i)}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.RuneOtherConfig.zsLevel;return Actor.level<i?(UserTips.ins().showTips(i+"级开启"),!1):!0},e}(BaseEuiView);__reflect(RuneWin.prototype,"RuneWin"),ViewManager.ins().reg(RuneWin,LayerManager.UI_Main);var RuneAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=null,e.curRole=0,e.skinName="RuneAttrsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.setAttrList=function(){this.proShowList=[];var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.runeDatas,i=GlobalConfig.RuneBaseConfig;if(!Assert(i,"RuneAttrTypeConfig is null"))for(var s in e){var n=e[s];if(n.configID){var o=i[n.configID];Assert(o,"cfg is null   id == "+n.configID)||this.setProShowList(o)}}},e.prototype.setProShowList=function(t){this.checkIsRepeat(t.attr,0),this.checkIsRepeat(t.equipAttr,1),this.checkIsRepeat(t.exAttr,2),this.checkIsRepeat(t.specialAttr,3)},e.prototype.checkIsRepeat=function(t,e){this.proShowList[e]||(this.proShowList[e]=[]);var i=this.proShowList[e];if(t){var s,n=!1;for(var o in t){s=t[o],n=!1;for(var a in i)i[a].type==s.type&&(i[a].value=i[a].value+s.value,n=!0);n||i.push(s)}}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=isNaN(t[0])?0:t[0],this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.closeBtn,this.onClose),this.addTouchEndEvent(this.bg,this.onMove),this.addTouchEndEvent(this,this.otherClose),this.setAttrList(),this.setAttrs(),this.setBtns()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];MessageCenter.ins().removeAll(this)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.leftBtn:this.curRole--,this.setAttrList(),this.setAttrs(),this.setBtns();break;case this.rightBtn:this.curRole++,this.setAttrList(),this.setAttrs(),this.setBtns()}},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<3&&(this.curRole++,this.setAttrList(),this.setAttrs(),this.setBtns()):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setAttrList(),this.setAttrs(),this.setBtns())}},e.prototype.setAttrs=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);if(t){this.job.source="op_"+t.job;for(var e="",i=this.imgGroup.numChildren-1;i>=0;i--){var s=this.imgGroup.getChildAt(i);DisplayUtils.removeFromParent(s),s=null}for(var n=0,o=0;o<this.proShowList.length;o++){var a=this.proShowList[o];e+=RuneConfigMgr.ins().getAttrByList(a,o);for(var r in a){var h=new eui.Image;h.source="tongyongdian",h.y=28*n+2,this.imgGroup.addChild(h),n++}}e.length<=0&&(e="暂无属性\n"),this.attr.textFlow=TextFlowMaker.generateTextFlow(e),this.mainGroup.height=this.attr.height+190}},e.prototype.setBtns=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,this.rightBtn.visible=t>=3):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(RuneAttrWin.prototype,"RuneAttrWin"),ViewManager.ins().reg(RuneAttrWin,LayerManager.UI_Popup);var RuneBookItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.keys=["red","orange","purple","green","white"],e.skinName="RuneOverViewItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t.title)this.currentState="title",this.lbName.text=t.title;else{var e=t.data;if(e){if(0==e.checkpoint)this.currentState="rune";else{this.currentState="nune_lock";var i=GlobalConfig.FbChallengeConfig[e.checkpoint];this.lbName.text="通关通天塔"+GlobalConfig.FbChNameConfig[i.group].name+"解锁"}for(var s=e.id,n=0;n<this.keys.length;n++){var o=s-100*n,a=this[this.keys[n]];a.setDataByItemConfig(GlobalConfig.ItemConfig[o])}}}},e}(BaseItemRender);__reflect(RuneBookItemRenderer.prototype,"RuneBookItemRenderer");var RuneBookItemData=function(){function t(t,e){this.data=t,this.title=e,this.data&&(this._itemConfig=GlobalConfig.ItemConfig[this.data.id])}return t.prototype.getItemConfig=function(){return this._itemConfig},t}();__reflect(RuneBookItemData.prototype,"RuneBookItemData");var RuneBookItemTipsWin=function(t){function e(){var e=t.call(this)||this;return e.QUALITY_LABEL_LIST=["零级","初级","中级","高级","顶级","神级"],e.SPECIAL_LABEL_LIST=["普通","特殊"],e.skinName="RuneGainTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){this.gainList.itemRendererSkinName="RuneGainTipsItemSkin",this.gainList.itemRenderer=GainGoodsNoSkinItem,t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.setData(t[0],t[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.resetView()},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onTouchList=function(t){var i=t.item;if(null!=t.item){var s=ViewManager.ins().viewOpenCheck(i[1],i[2]);s&&(GameGuider.guidance(i[1],i[2]),ViewManager.ins().close(e))}},e.prototype.setData=function(t,e){if(e){this.nameLabel.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemConfig.getQualityColor(e)+"'>"+e.name+"Lv."+(e.level||1)+"</font>"),this.itemIcon.setData(e);var i=GlobalConfig.RuneBaseConfig[e.id];this.attrName.text=RuneConfigMgr.ins().getcfgAttrData(i),this.attrValue.text=RuneConfigMgr.ins().getcfgAttrData(i,!1),0==t.checkpoint?this.attrDes.text="默认解锁":this.attrDes.text="通关通天塔"+GlobalConfig.FbChNameConfig[Math.round(t.checkpoint/10)].name+"解锁";var s=GlobalConfig.GainItemConfig[e.id],n=0;s?(this.gainList.dataProvider=new eui.ArrayCollection(s.gainWay),n=60*s.gainWay.length):this.gainList.dataProvider=new eui.ArrayCollection([])}else this.resetView()},e.prototype.resetView=function(){this.nameLabel.text="",this.itemIcon.setData(null)},e}(BaseEuiView);__reflect(RuneBookItemTipsWin.prototype,"RuneBookItemTipsWin"),ViewManager.ins().reg(RuneBookItemTipsWin,LayerManager.UI_Popup);var RuneBookWin=function(t){function e(){var e=t.call(this)||this;return e.dataCollection=null,e.skinName="RuneOverViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){this.nuneList.itemRenderer=RuneBookItemRenderer,t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.nuneList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.showList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cleanList(),this.nuneList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this)},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e.prototype.onListTap=function(t){var e=t.item;if(e&&e.data)for(var i=t.item,s=6;s>0&&i;){if(i.getItemConfig){var n=i.getItemConfig();ViewManager.ins().open(RuneBookItemTipsWin,e.data,n);break}i=i.parent,s-=1}},e.prototype.showList=function(){if(!this.dataCollection){var t=[];t.push(new RuneBookItemData(null,"默认解锁"));var e=RuneConfigMgr.ins().getExchangeDataList();for(var i in e)t.push(new RuneBookItemData(e[i]));this.dataCollection=new eui.ArrayCollection(t)}this.nuneList.dataProvider=this.dataCollection},e.prototype.cleanList=function(){this.dataCollection&&(this.dataCollection=null),this.nuneList.dataProvider=null},e}(BaseEuiView);__reflect(RuneBookWin.prototype,"RuneBookWin"),ViewManager.ins().reg(RuneBookWin,LayerManager.UI_Main);var RuneDecomposeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneSeletctItemSkin",e.mc=new MovieClip,e.mc.x=56,e.mc.y=64,e.mc.scaleX=1.5,e.mc.scaleY=1.5,e.addChild(e.mc),e}return __extends(e,t),e.prototype.dataChanged=function(){this.cb.touchChildren=!1,this.cb.touchEnabled=!1;var t=this.data,e=t.itemData;if(e&&e instanceof ItemData){var i=RuneConfigMgr.ins().getBaseCfg(e);i?(this.itemIcon.setData(e),this.power.text=RuneConfigMgr.ins().getcfgAttrDesc(i,!0)):this.resetView()}else this.resetView();this.cb.selected=t.isSelected},e.prototype.resetView=function(){this.itemIcon.setData(null),this.power.text=""},e.prototype.playEffect=function(){this.cb.selected&&this.mc.playFile(RES_DIR_EFF+"litboom",1)},e}(eui.ItemRenderer);__reflect(RuneDecomposeItemRenderer.prototype,"RuneDecomposeItemRenderer");var RuneDecomposePanel=function(t){function e(){var e=t.call(this)||this;return e.cardList=null,e.cardCollection=null,e.checkBoxNum=5,e.itemListScrollV=0,e.resolveIng=!1,e._addNum=0,e._chipNum=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.itemList.itemRenderer=RuneDecomposeItemRenderer,this.itemList.useVirtualLayout=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.checkBoxNum;i++)this["cb"+i]&&this.addTouchEvent(this["cb"+i],this.onCBTap);this.addTouchEvent(this.decomposeBtn,this.onTap),this.addTouchEvent(this.itemList,this.onListTap),this.observe(GameLogic.ins().postRuneShatter,this.onShatterChange),this.observe(GameLogic.ins().postRuneExchange,this.onShatterChange),this.observe(Rune.ins().postOneKeyDecomposeResult,this.onDecomposeResult),this.initCardList(),this.resetCheckBox(),this.updateShatter()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.cleanCardList()},e.prototype.onDecomposeResult=function(t){var e=this;if(t[0]){var i=t[1],s=t[2],n="",o=0;i>0?(n="普通",o=i):s>0&&(n="特殊",o=s),this._addNum&&UserTips.ins().showTips("分解成功，|C:0x35e62d&T:战纹精华x"+this._addNum+"|"),this._chipNum&&UserTips.ins().showTips("分解成功，|C:0x35e62d&T:战纹碎片x"+this._chipNum+"|"),this.playEffect(),TimerManager.ins().doTimer(500,1,function(){e.initCardList(),e.updateShatter(),e.updateAddShatter(),e.resolveIng=!1},this)}else UserTips.ins().showTips("分解失败，请稍后再试")},e.prototype.playEffect=function(){for(var t=this.itemList.numChildren,e=0;t>e;e++){var i=this.itemList.getChildAt(e);i&&i.playEffect()}},e.prototype.onShatterChange=function(){this.updateShatter()},e.prototype.onListTap=function(t){if(t&&t.currentTarget){var e=this.itemList.selectedIndex;if(0>e)return;var i=this.itemList.getVirtualElementAt(e);if(i&&i instanceof RuneDecomposeItemRenderer&&i.cb){var s=i.data;s&&(s.isSelected=!s.isSelected,this.cardCollection.itemUpdated(s))}this.itemList.selectedIndex=-1,this.updateAddShatter()}},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.decomposeBtn:this.decomposeRune()}},e.prototype.decomposeRune=function(){var t=this;if(!this.resolveIng){if(this.cardList&&this.cardList.length>0){for(var e=!1,i=null,s=null,n=[],o=0,a=this.cardList;o<a.length;o++){var r=a[o];r&&r.isSelected&&r.itemData&&r.itemData.itemConfig&&(n.push(r.itemData),i=RuneConfigMgr.ins().getBaseCfg(r.itemData),s=r.itemData.itemConfig,ItemConfig.getQuality(s)>=RuneConfigMgr.ins().getOtherCfg().maxQuality&&(e=!0))}if(e){var h="",l="",c="";e&&(l="<font color = '"+ItemBase.QUALITY_COLOR[RuneConfigMgr.ins().getOtherCfg().maxQuality]+"' size = '22'>顶级战纹</font>");var u=h+c+l,p="当前分解战纹包括"+u+"，是否继续进行分解";return void WarnWin.show(p,function(){t.resolveIng=!0,Rune.ins().sendOneKeyDecompose(n)},this)}if(n.length>0)return this.resolveIng=!0,void Rune.ins().sendOneKeyDecompose(n)}UserTips.ins().showTips("当前无选择任何战纹")}},e.prototype.onCBTap=function(t){if(t&&t.currentTarget){var e=t.currentTarget;if(e&&e instanceof eui.CheckBox)for(var i=null,s=0;s<this.checkBoxNum;s++)if(i=this["cb"+s],i&&i===e)return void this.setQualitySelected(s+1,e.selected)}},e.prototype.updateShatter=function(){var t=Actor.runeShatter;this.curLab.text=t.toString();var e=Actor.runeExchange;this.suipianNow.text=e.toString(),this.materialLab.text=""+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,ItemConst.JINGJIN)},e.prototype.updateAddShatter=function(){var t=0,e=0,i=0,s=null;GlobalConfig.ItemConfig[GlobalConfig.RuneOtherConfig.goldItemId].name;if(this.cardList&&this.cardList.length>0)for(var n=0,o=this.cardList;n<o.length;n++){var a=o[n];if(a&&a.isSelected&&a.itemData&&a.itemData.itemConfig&&(s=RuneConfigMgr.ins().getBaseCfg(a.itemData))){t+=s.gain,s.chip&&(e+=s.chip);var r=GlobalConfig.RuneComposeConfig[s.id];r&&(i+=r.count)}}this._addNum=t,this._chipNum=e,this.addLab.text=t>0?"+"+t+"  ":"",this.suipianAdd.text=e?"+"+e:"",this.materialLab.text=""+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,ItemConst.JINGJIN),this.addMaterialLab.text=i>0?"  +"+i:""},e.prototype.setQualitySelected=function(t,e){if(0>t)for(var i=0,s=this.cardList;i<s.length;i++){var n=s[i];n.itemData&&n.itemData.itemConfig&&(n.isSelected=!1)}else for(var o=0,a=this.cardList;o<a.length;o++){var n=a[o];n.itemData&&n.itemData.itemConfig&&ItemConfig.getQuality(n.itemData.itemConfig)==t&&(n.isSelected=e)}for(var r=this.cardCollection.length,h=0;r>h;h++)this.cardCollection.itemUpdated(this.cardList[h]);this.updateAddShatter()},e.prototype.getCheckBoxSelected=function(t){var e=this["cb"+(t-1)];return e?e.selected:!1},e.prototype.resetCheckBox=function(t){void 0===t&&(t=1);for(var e=null,i=0;i<this.checkBoxNum;i++)e=this["cb"+i],e&&e instanceof eui.CheckBox&&(e.selected=i+1==t);this.setQualitySelected(t,!0)},e.prototype.initCardList=function(){this.cleanCardList(),this.cardList=[];var t=UserBag.ins().getBagGoodsByType(6);if(t&&t.length>0){for(var e=null,i=0,s=t;i<s.length;i++)for(var n=s[i],o=0;o<n.count;o++)e=new RuneDecomposeItemData,e.itemData=n,this.cardList.push(e);this.cardList.sort(this.sortList)}this.cardCollection=new eui.ArrayCollection(this.cardList),this.itemList.dataProvider=this.cardCollection},e.prototype.cleanCardList=function(){this.cardList=null,this.cardCollection=null,this.itemList.dataProvider=null},e.prototype.sortList=function(t,e){var i=ItemConfig.getQuality(t.itemData.itemConfig),s=ItemConfig.getQuality(e.itemData.itemConfig);if(i>s)return-1;if(s>i)return 1;var n=RuneConfigMgr.ins().getBaseCfg(t.itemData),o=RuneConfigMgr.ins().getBaseCfg(e.itemData);if(n&&o){var a=n.id%100,r=o.id%100;if(a>r)return-1;if(r>a)return 1}return t.itemData.configID-e.itemData.configID},e}(BaseView);__reflect(RuneDecomposePanel.prototype,"RuneDecomposePanel");var RuneDisplay=function(t){function e(){var e=t.call(this)||this;return e.pos=-1,e.isShowName=!0,e}return __extends(e,t),e.prototype.init=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.noOpenTF,this.onTap)},e.prototype.close=function(){this.removeTouchEvent(this.noOpenTF,this.onTap)},e.prototype.onTap=function(t){var e=t.target;e==this.noOpenTF&&ViewManager.ins().open(FbWin,2)},e.prototype.setPos=function(t){this.pos=t;var i=RuneConfigMgr.ins().getLockCfg(t);if(!this.assert(i,"RuneLockPosConfig("+t+")")){var s=SkyLevelModel.ins().cruLevel,n=i.lockLv;s>n?this.currentState=e.SKIN_STATE_UNLOCK:this.currentState=e.SKIN_STATE_LOCK}},e.prototype.setLockTF=function(t){if(!(this.pos<0||this.currentState!=e.SKIN_STATE_LOCK&&this.currentState!=e.SKIN_STATE_READY)){var i=RuneConfigMgr.ins().getLockCfg(this.pos);if(!this.assert(i,"RuneLockPosConfig("+this.pos+")")){var s=null;if(this.pos>=1&&(s=RuneConfigMgr.ins().getLockCfg(this.pos-1)),s&&s.lockLv<=SkyLevelModel.ins().cruLevel&&t){var n=GlobalConfig.FbChallengeConfig[i.lockLv],o=SkyLevelModel.ins(),a=o.getNextOpenLevel(),r=0;a&&(r=a.layer);var h="|U:&C:0x35e62d&T:通关通天塔"+GlobalConfig.FbChNameConfig[n.group].name+r+"层开启";this.noOpenTF.textFlow=TextFlowMaker.generateTextFlow1(h)}else this.noOpenTF.text=""}}},e.prototype.setData=function(t){if(t&&!(t.itemConfig&&t.itemConfig.id<=0)){this.data=t;var e=GlobalConfig.ItemConfig[t.itemConfig.id];if(this._itemConfig=e,!this.assert(e,"ItemConfig("+t.itemConfig.id+")")){this.nameBG.visible=this.isShowName,this.nameTF.visible=this.isShowName,this.iconImg.source=e.icon+"_png";var i=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(e)];this.nameTF.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemConfig.getQualityColor(e)+"&T:"+i.runeName+"Lv."+e.id%100)}}},e.prototype.setDataByItemConfig=function(t){if(t){this._itemConfig=t,this.currentState=e.SKIN_STATE_UNLOCK,this.nameBG.visible=this.isShowName,this.nameTF.visible=this.isShowName,this.iconImg.source=t.icon+"_png";var i=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(t)];t.level&&0!=t.level?this.nameTF.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemConfig.getQualityColor(t)+"&T:"+i.runeName+" Lv."+t.level%100+"|"):this.nameTF.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemConfig.getQualityColor(t)+"&T:"+i.runeName+" Lv.1|")}},e.prototype.getItemConfig=function(){return this._itemConfig},e.prototype.cleanData=function(){this.data=null,this._itemConfig=null,this.iconImg.source=null,this.nameTF.text="",this.nameTF.visible=!1,this.nameBG.visible=!1},e.prototype.showOrHideSelected=function(t){this.selectedImg.visible=t},e.prototype.showName=function(t){this.isShowName=t},e.prototype.assert=function(t,i){return Assert(t,"["+egret.getQualifiedClassName(e)+"] "+i+"is null!")},e}(BaseComponent);RuneDisplay.SKIN_STATE_LOCK="lock",RuneDisplay.SKIN_STATE_READY="ready",RuneDisplay.SKIN_STATE_UNLOCK="unlock",__reflect(RuneDisplay.prototype,"RuneDisplay");var RuneExchangeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneExchangeItemSkin",e.goBtn.name="goBtn",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.ItemConfig[t.id];this.icon.setDataByItemConfig(e);var i=RuneConfigMgr.ins().getBaseCfgByItemConfig(e);this.descLab.text=RuneConfigMgr.ins().getcfgAttrDesc(i);var s=GlobalConfig.FbChallengeConfig[t.checkpoint];s?this.descLab1.text="通关通天塔"+GlobalConfig.FbChNameConfig[s.group].name+"解锁":this.descLab1.text="默认解锁";var n="";n=Actor.runeExchange>=t.conversion?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.nameLab0.textFlow=TextFlowMaker.generateTextFlow("<font color="+n+">"+Actor.runeExchange+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t.conversion+"</font> "),this.setEff(e)}else this.retView()},e.prototype.setEff=function(t){var e=ItemConfig.getQuality(t);5==e&&(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.parent||this.addChild(this.EquipEffect),this.EquipEffect.playFile(RES_DIR_EFF+"chuanqizbeff",-1),this.EquipEffect.x=this.effpos.x,this.EquipEffect.y=this.effpos.y,this.EquipEffect.scaleX=this.effpos.scaleX,this.EquipEffect.scaleY=this.effpos.scaleY)},e.prototype.close=function(){DisplayUtils.removeFromParent(this.EquipEffect)},e.prototype.retView=function(){this.descLab.text="",this.descLab1.text="",this.nameLab0.text="",this.icon.setData(null),this.close()},e}(eui.ItemRenderer);__reflect(RuneExchangeItemRenderer.prototype,"RuneExchangeItemRenderer");var RuneExchangePanel=function(t){function e(){var e=t.call(this)||this;return e._scrollV=0,e.skinName="RuneSkinExchange",e.menulist0.itemRenderer=RuneExchangeItemRenderer,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postRuneExchange,this.updateList),this.addTouchEvent(this.menulist0,this.onListTap),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve();for(var i=0;i<this.menulist0.numElements;i++){var s=this.menulist0.getVirtualElementAt(i);s.close()}},e.prototype.updateList=function(){var t=RuneConfigMgr.ins().getExchangeDataList();this.menulist0.dataProvider=new eui.ArrayCollection(t);var e=this.menulist0.parent;e.validateNow(),e.stopAnimation(),this.menulist0.scrollV=this._scrollV},e.prototype.onListTap=function(t){if("goBtn"==t.target.name){var e=this.menulist0.selectedItem;if(!e||e&&e.conversion>Actor.runeExchange)return UserWarn.ins().setBuyGoodsWarn(500008,e.conversion-Actor.runeExchange),void UserTips.ins().showTips("道具不足");if(!(SkyLevelModel.ins().lastPass||SkyLevelModel.ins().cruLevel>=e.checkpoint))return void UserTips.ins().showTips("通关等级不足");Rune.ins().sendExchangeRune(e.id),this._scrollV=this.menulist0.scrollV}},e}(BaseView);__reflect(RuneExchangePanel.prototype,"RuneExchangePanel");var RuneReplaceItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneEquipChangeSkinItem",e.changeBtn.name="changeBtn",e.changeBtn0.name="changeBtn",e.getBtn.name="getBtn",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.data;if(this.currentState="all",this.validateNow(),e&&e instanceof ItemData)if(e.configID){var i=RuneConfigMgr.ins().getBaseCfg(e);if(i){this.itemIcon.showName(!1),this.itemIcon.setData(e);var s=GlobalConfig.ItemConfig[e.itemConfig.id],n=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(s)];if(this.runeName.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemConfig.getQualityColor(s)+"&T:"+n.runeName+"Lv."+s.id%100),this.back.text="回收可得"+i.gain+"精华",this.attr.text=RuneConfigMgr.ins().getcfgAttrDesc(i),this.changeBtn.visible=t.canEquip&&RuneDataMgr.ins().posIsWear,this.changeBtn0.visible=t.canEquip&&!RuneDataMgr.ins().posIsWear,this.now.visible=!t.canEquip&&RuneDataMgr.ins().posIsWear&&RuneDataMgr.ins().posIsWear.configID==e.configID,this.already.visible=!t.canEquip&&RuneDataMgr.ins().posIsWear!=e,!this.already.visible){var o=ViewManager.ins().getView(RuneReplaceWin);o&&(this.already.visible=Rune.ins().isEquipMerge(e.configID,o.roleIndex,o.posIndex),this.changeBtn.visible=this.changeBtn0.visible=!this.already.visible)}}else this.resetView()}else this.setBtnStatu(),this.resetView();else this.resetView()},e.prototype.setBtnStatu=function(){null==this.data||null==this.data.data?(this.currentState="dis",this.itemIcon.currentState="emp"):this.data.data.configID?(this.currentState="all",this.changeBtn.visible=!1,this.changeBtn0.visible=!1,this.now.visible=!0,this.already.visible=!1):this.currentState="get"},e.prototype.getItemId=function(){return this.data&&this.data.data?this.data.data.configID:0},e.prototype.resetView=function(){this.itemIcon.setData(null),this.nameLab.text="",this.attr.text=""},e}(eui.ItemRenderer);__reflect(RuneReplaceItemRenderer.prototype,"RuneReplaceItemRenderer");var RuneReplaceItemData=function(){function t(t){this.data=t}return t}();__reflect(RuneReplaceItemData.prototype,"RuneReplaceItemData");var RuneReplaceSpecialItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t&&t instanceof ItemData){var e=RuneConfigMgr.ins().getBaseCfg(t);this.itemIcon.setData(t.itemConfig),this.nameLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemConfig.getQualityColor(t.itemConfig)+"'>"+t.itemConfig.name+"</font>"),e.attr?this.power.text="评分："+UserBag.getAttrPower(e.attr):this.power.text="评分："+e.power,this.numLab.text=t.count.toString(),this.specialEffLab.text=e.specialDesc}else this.resetView()},e.prototype.resetView=function(){this.itemIcon.setData(null),this.nameLab.text="",this.specialEffLab.text="",this.power.text="",this.numLab.text=""},e}(eui.ItemRenderer);__reflect(RuneReplaceSpecialItemRenderer.prototype,"RuneReplaceSpecialItemRenderer");var RuneReplaceWin=function(t){function e(){var e=t.call(this)||this;return e.posIndex=0,e.roleIndex=0,e.item=null,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RuneEquipChangeSkin",this.isTopLevel=!0,this.list.itemRenderer=RuneReplaceItemRenderer,this.myItem=new RuneReplaceItemRenderer,this.itemGroup.addChild(this.myItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.posIndex=isNaN(t[0])?0:t[0],this.roleIndex=isNaN(t[1])?0:t[1],this.item=t[2],this.runeTypeList=t[3],RuneDataMgr.ins().posIsWear=this.item,this.myItem.data=new RuneReplaceItemData(this.item),this.myItem.setBtnStatu(),this.addTouchEvent(this.list,this.onListTap),this.observe(Rune.ins().postInlayResult,this.onInlayResult),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];MessageCenter.ins().removeAll(this),this.list.dataProvider=null},e.prototype.onListTap=function(t){var e=this;if("changeBtn"!=t.target.name)return void("getBtn"==t.target.name&&ViewManager.ins().open(FbWin,2));var i=null,s=this.list.selectedItem;s&&(i=s.data);var n=!1;if(i&&i instanceof ItemData){var o=GlobalConfig.ItemConfig[i.configID],a=RuneDataMgr.ins().getRune(this.roleIndex,this.posIndex);if(a){var r=null;if(a.configID>0&&(r=RuneConfigMgr.ins().getBaseCfg(a)),r&&a.itemConfig&&ItemConfig.getSubType(o)==ItemConfig.getSubType(a.itemConfig));else{var h=RuneDataMgr.ins().getRoleRune(this.roleIndex);if(h)for(var l=null,c=0,u=h;c<u.length;c++){var p=u[c];if(p&&p.itemConfig&&p.itemConfig.id>0&&(l=GlobalConfig.ItemConfig[p.configID],l&&ItemConfig.getSubType(l)==ItemConfig.getSubType(o))){n=!0;break}}}}if(n||!Rune.ins().isCanEquip(i.configID,this.roleIndex,this.myItem.getItemId(),this.posIndex))return void UserTips.ins().showTips("每个角色同种属性的战纹只能镶嵌一个");var d=Rune.ins().getMergeRune(i.configID,this.roleIndex,this.item);if(d)return void WarnWin.show(d[0],function(){Rune.ins().sendInlay(e.roleIndex,e.posIndex,i.handle)},this);Rune.ins().sendInlay(this.roleIndex,this.posIndex,i.handle)}},e.prototype.updateList=function(){var t=UserBag.ins().getBagGoodsByType(6);if(t){for(var e=[],i=[],s=this.item&&this.item.itemConfig?ItemConfig.getSubType(this.item.itemConfig):-1,n=0,o=t;n<o.length;n++){var a=o[n];if(a&&RuneConfigMgr.ins().getBaseCfg(a)){var r=ItemConfig.getSubType(a.itemConfig);s==r||this.runeTypeList.indexOf(r)<0?s>-1&&this.item.configID==a.configID||(Rune.ins().isEquipMerge(a.configID,this.roleIndex,this.posIndex)?i.push(a):e.push(a)):i.push(a)}}e.sort(this.sortRunes),i.sort(this.sortRunes);var h=[].concat(e,i),l=new ItemData;h.push(l);for(var c=[],u=0;u<h.length;u++){var p=new RuneReplaceItemData(h[u]);p.canEquip=!1,u<e.length&&(p.canEquip=!0),c.push(p)
}this.list.dataProvider=new eui.ArrayCollection(c)}},e.prototype.sortRunes=function(t,e){var i=ItemConfig.getQuality(t.itemConfig),s=ItemConfig.getQuality(e.itemConfig);if(i>s)return-1;if(s>i)return 1;var n=RuneConfigMgr.ins().getBaseCfg(t),o=RuneConfigMgr.ins().getBaseCfg(e);if(n&&o){var a=n.id%100,r=o.id%100;if(a>r)return-1;if(r>a)return 1}return t.configID-e.configID},e.prototype.onInlayResult=function(t){t[0]&&ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(RuneReplaceWin.prototype,"RuneReplaceWin"),ViewManager.ins().reg(RuneReplaceWin,LayerManager.UI_Main);var ExchangeVO=function(){function t(){}return t}();__reflect(ExchangeVO.prototype,"ExchangeVO");var ReincarnationDemonLevel=function(){function t(){}return t}();__reflect(ReincarnationDemonLevel.prototype,"ReincarnationDemonLevel");var ReincarnationLinkLevel=function(){function t(){}return t}();__reflect(ReincarnationLinkLevel.prototype,"ReincarnationLinkLevel");var ReincarnationSoulLevel=function(){function t(){}return t}();__reflect(ReincarnationSoulLevel.prototype,"ReincarnationSoulLevel");var SamsaraModel=function(t){function e(){var e=t.call(this)||this;e.samsaraEquipMap={},e.composeEquipMap={},e.composeEquipTypes=[],e.equipCompose={};var i=GlobalConfig.ReincarnationBase;return e.samsaraDescAry=[i.hellsName,i.ghostsName,i.animalsName,i.demigodsName,i.humansName,i.godsName],e.initComposeEquip(),e.composeEquipTypes=e.getComposeMenu(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.isCanUpgrade=function(){if(!this.samsaraInfo)return!1;var t=this.samsaraInfo.lv,e=t+1,i=GlobalConfig.ReincarnationLevel[e],s=!1;return e<CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel)&&this.samsaraInfo.exp>=i.consume&&(s=!0),s},e.prototype.getExpExchangeTimes=function(){if(!this.samsaraInfo)return 0;var t=GlobalConfig.ReincarnationBase.levelExchangeTimes-this.samsaraInfo.expUpgradeNum;return t},e.prototype.getNormalExchangeTimes=function(){if(!this.samsaraInfo)return 0;var t=GlobalConfig.ReincarnationBase.normalItem.time-this.samsaraInfo.normalUpgradeNum;return t},e.prototype.getAdvancedExchangeTimes=function(){if(!this.samsaraInfo)return 0;var t=GlobalConfig.ReincarnationBase.advanceItem.time-this.samsaraInfo.advancedUpgradeNum;return t},e.prototype.isCanExpExchange=function(){var t=!1;return Actor.level>=GlobalConfig.ReincarnationBase.levelLimit&&this.getExpExchangeTimes()>0&&(t=!0),t},e.prototype.isCanItemExchange=function(){var t;return this.getNormalExchangeTimes()>0&&(t=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.ReincarnationBase.normalItem.id),t>0)?!0:this.getAdvancedExchangeTimes()>0&&(t=UserBag.ins().getBagGoodsCountById(0,GlobalConfig.ReincarnationBase.advanceItem.id),t>0)?!0:!1},e.prototype.isCanExchange=function(){return this.isMaxSamsara(Actor.samsaraLv)?!1:this.isCanExpExchange()||this.isCanItemExchange()},e.prototype.isOpen=function(){var t=1e3*UserZs.ins().lv+Actor.level;return t>=GlobalConfig.ReincarnationBase.openLevel},e.prototype.isMaxSamsara=function(t){var e=CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel),i=GlobalConfig.ReincarnationLevel[e-1];return t>=i.level},e.prototype.isSuit=function(t,e){for(var i=this.getEquipSamsaraLvByRole(t,e),s=EquipPos.HAT;s<EquipPos.MAX;s++)if(s!=t){var n=this.getEquipSamsaraLvByRole(s,e);if(i>n)return!1}return!0},e.prototype.lowSuitEquips=function(t,e){for(var i=[],s=this.getEquipSamsaraLvByRole(t,e),n=EquipPos.HAT;n<EquipPos.MAX;n++){var o=this.getEquipSamsaraLvByRole(n,e);s>o?i.push(0):i.push(1)}return i},e.prototype.getEquipSamsaraLvByRole=function(t,e){var i=e.getEquipByIndex(t);return i.item.itemConfig?this.getEquipSamsaraLv(i.item.itemConfig.id):0},e.prototype.getEquipSamsaraLv=function(t){var e=GlobalConfig.ItemConfig[t].zsLevel;return e},e.prototype.getReincarnateSuit=function(t){var e=GlobalConfig.ItemConfig[t].zsLevel;return GlobalConfig.ReincarnateSuit[e]},e.prototype.getSamsara=function(t){var e=0;return t>=7&&(e=Math.ceil((t-6)/6)),e},e.prototype.getSamsaraDesc=function(t){return this.samsaraDescAry[t]},e.prototype.getSamsaraLv=function(t){var e=0;return e=0==t?-1:Math.ceil((t-1)%6)},e.prototype.getSamsaraLvDesc=function(t){var e=t+1;return GlobalConfig.ReincarnationBase.state[e]},e.prototype.getAddSpiritEquips=function(t,e,i){void 0===i&&(i=10);var s=[],n=UserBag.ins().itemCount[1],o=t.getEquipByIndex(e);if(n&&!this.checkSpiritLvIsMax(o,e))for(var a in n)if(GlobalConfig.ReincarnateEquip[a]){var r=+a,h=this.isEquipCanAddSpirit(t,e,r);if(h)for(var l=n[a];l>0;){if(s.unshift(r),s.length>=i)return s;l--}}return s},e.prototype.isEquipCanAddSpirit=function(t,e,i){var s=t.getEquipByIndex(e),n=GlobalConfig.ItemConfig[s.item.itemConfig.id].zsLevel,o=GlobalConfig.ItemConfig[i].zsLevel;return o>n?!1:this.checkEquip(i)},e.prototype.checkEquip=function(t){var e=GlobalConfig.ItemConfig[t],i=ItemConfig.getJob(e),s=SubRoles.ins().getSubRoleByJob(i);if(s){var n=s.getEquipByIndex(ItemConfig.getSubType(e));if(n.item.itemConfig){var o=GlobalConfig.ItemConfig[n.item.itemConfig.id].zsLevel;if(o>=e.zsLevel){var a=this.getTargetShengEquipById(t,e.zsLevel);return this.checkNormalEquip(n,a)}}}return!1},e.prototype.checkNormalEquip=function(t,e){var i=t.item.point,s=new ItemData;s.configID=e;var n=s.point;return i>n},e.prototype.getTargetShengEquipById=function(t,e){var i=this.equipCompose[t];return i?this.getTargetShengEquipById(i.id,e):t},e.prototype.isCanAddSpirit=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)for(var i=SubRoles.ins().getSubRoleByIndex(e),s=EquipPos.HAT;s<EquipPos.MAX;s++){var n=i.getEquipByIndex(s);if(n.item.itemConfig){var o=this.getAddSpiritEquips(i,s,1);if(o.length>0)return!0}}return!1},e.prototype.checkRoleCanAddSpirit=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(t),i=EquipPos.HAT;i<EquipPos.MAX;i++){var s=e.getEquipByIndex(i);if(s.item.itemConfig){var n=this.getAddSpiritEquips(e,i,1);if(n.length>0)return!0}}return!1},e.prototype.checkEquipPosCanAddSpirit=function(t,e){var i=t.getEquipByIndex(e);if(i.item.itemConfig&&!this.checkSpiritLvIsMax(i,e)){var s=this.getAddSpiritEquips(t,e,1);if(s.length>0)return!0}return!1},e.prototype.checkSpiritLvIsMax=function(t,e){var i=t.spiritLv;return!GlobalConfig.ReincarnateSpirit[e][i+1]},e.prototype.getExtraPower=function(t,e,i){for(var s=0,n=0,o=EquipPos.HAT;o<=EquipPos.SHIELD;o++){var a=t.getEquipByIndex(o);if(a.item.itemConfig){var r=a.item.itemConfig.id;if(r&&GlobalConfig.EquipConfig[r].baseAttr1){var h=GlobalConfig.EquipConfig[r].baseAttr1;n+=h.value}}}if(i){var l=GlobalConfig.AttrPowerConfig,c=l[i];s=n*c.relate_power*e}return s},e.prototype.initComposeEquip=function(){for(var t=GlobalConfig.ReincarnationBase.headName,e=t.length,i=1;e>=i;i++)this.composeEquipMap[i]||(this.composeEquipMap[i]={});for(var s in GlobalConfig.ReincarnateEquipCompose){var n=GlobalConfig.ReincarnateEquipCompose[s];this.equipCompose[n.material.id]=n;var o=n.distinguishi,a=this.composeEquipMap[o],r=GlobalConfig.ItemConfig[n.id],h=r.zsLevel,l=a[h];l||(l=[]),l.push({type:MergeType.SamsareEquip,id:n.id}),a[h]=l,this.composeEquipMap[o]=a}},e.prototype.getComposeMenu=function(){for(var t=GlobalConfig.ReincarnationBase.headName,e=t.length,i=[],s=1;e>=s;s++)i.push(s);return i},e.prototype.getComposeZsList=function(t){var e=UserZs.ins().lv,i=GlobalConfig.ReincarnationBase.equipsList[t-1],s=[];for(var n in i)i[n]<=e&&s.push({type:t,zsLv:i[n]});return s},e.prototype.getComposeDesc=function(t){return GlobalConfig.ReincarnationBase.headName[t-1]},e.prototype.isCanCompose=function(){return this.getComposeEquipList().length>0},e.prototype.getComposeEquipId=function(t,e){var i=0,s=this.getComposeEquipList();for(var n in s){var o=s[n],a=this.getComposeTarget(o);if(GlobalConfig.ItemConfig[a].zsLevel==e&&GlobalConfig.ReincarnateEquipCompose[a].distinguishi==t)return o}return i},e.prototype.getComposeEquipList=function(){var t=[],e=UserBag.ins().itemCount[1];for(var i in e)if(this.equipCompose[i]){var s=+i,n=this.composeMaxEquip(s);n&&this.isCanWear(n)&&t.push(s)}return t},e.prototype.isCanWear=function(t){if(!t)return!1;var e=GlobalConfig.ItemConfig[t],i=1e3*UserZs.ins().lv+Actor.level,s=1e3*e.zsLevel+e.level;if(s>i)return!1;for(var n=ItemConfig.getJob(e),o=ItemConfig.getSubType(e),a=SubRoles.ins().subRolesLen,r=0;a>r;r++){var h=SubRoles.ins().getSubRoleByIndex(r);if(h.job==n){var l=h.getEquipByIndex(o),c=l.item.itemConfig;if(!c)return!0;var u=l.item.point,p=new ItemData;p.configID=t;var d=p.point;if(d>u)return!0}}return!1},e.prototype.composeMaxEquip=function(t){var e=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_EQUIP,t);if(e){var i=new RewardData;i.id=t,i.count=0;var s=this.composeEquip(i);if(s&&s.id!=t)return s.id}return 0},e.prototype.composeEquip=function(t){var e,i=t.id,s=t.count+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_EQUIP,i)+this.wearCount(i),n=this.equipCompose[i];return n&&s>=n.material.count?(e=new RewardData,e.id=n.id,e.count=Math.floor(s/n.material.count),this.composeEquip(e)):t},e.prototype.wearCount=function(t){for(var e=GlobalConfig.ItemConfig[t],i=ItemConfig.getJob(e),s=ItemConfig.getSubType(e),n=SubRoles.ins().subRolesLen,o=0;n>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(a.job==i){var r=a.getEquipByIndex(s),h=r.item.itemConfig;if(h&&h.id==t)return 1}}return 0},e.prototype.getRoleIndexByEquip=function(t){for(var e=GlobalConfig.ItemConfig[t],i=ItemConfig.getJob(e),s=ItemConfig.getSubType(e),n=SubRoles.ins().subRolesLen,o=0;n>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(a.job==i){var r=a.getEquipByIndex(s),h=r.item.itemConfig;if(h&&h.id==t)return o}}return-1},e.prototype.isCanTypeCompose=function(t){var e=this.getComposeEquipList();for(var i in e){var s=e[i],n=GlobalConfig.ReincarnateEquipCompose[this.getComposeTarget(s)];if(n.distinguishi==t)return!0}return!1},e.prototype.getComposeTarget=function(t){var e=this.equipCompose[t];return e?e.id:0},e.prototype.isCanZsLvCompose=function(t,e){var i=this.getComposeEquipList();for(var s in i){var n=i[s],o=this.getComposeTarget(n),a=GlobalConfig.ReincarnateEquipCompose[o],r=GlobalConfig.ItemConfig[o].zsLevel;if(e==r&&a.distinguishi==t)return!0}return!1},e.prototype.isCanEquipCompose=function(t){var e=this.getComposeEquipList();return e.indexOf(t)>=0},e.prototype.getReincarnationLinkLevel=function(t,e){for(var i in GlobalConfig.ReincarnationLinkLevel)if(i==t.toString())for(var s in GlobalConfig.ReincarnationLinkLevel[i])for(var n in GlobalConfig.ReincarnationLinkLevel[i][s])if(n==e.toString())return GlobalConfig.ReincarnationLinkLevel[i][s][n];return null},e.prototype.getSoulLinkDesc=function(t){var e;switch(t){case 11:e="生命";break;case 55:e="伤害加成";break;case 19:e="暴击伤害";break;case 56:e="暴击伤害减免率"}return e},e.prototype.getSoulMaxLevel=function(){return CommonUtils.getObjectLength(GlobalConfig.ReincarnationDemonLevel[EquipPos.HAT])},e.prototype.getSoulLinkLv=function(t,e,i){var s=this.getLinkEquipPos(e),n=t.getEquipByIndex(e),o=t.getEquipByIndex(s);return n&&o?Math.min(n.soulLv,o.soulLv):0},e.prototype.getLinkEquipPos=function(t){for(var e in GlobalConfig.ReincarnationLinkLevel)if(e==t.toString())for(var i in GlobalConfig.ReincarnationLinkLevel[e])return+i;return null},e.prototype.isCanUpgradeSoul=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)for(var i=EquipPos.HAT;i<=EquipPos.SHIELD;i++){var s=this.checkUpgradeSoul(SubRoles.ins().getSubRoleByIndex(e),i);if(s)return!0}return!1},e.prototype.checkUpgradeSoul=function(t,e){var i=t.getEquipByIndex(e),s=i.soulLv;if(s!=this.getSoulMaxLevel()&&i.item.itemConfig){var n=GlobalConfig.ReincarnationSoulLevel[t.job][e][s+1],o=UserBag.ins().getBagGoodsCountById(0,n.materialInfo.id);return o>=n.materialInfo.count}return!1},e}(BaseClass);__reflect(SamsaraModel.prototype,"SamsaraModel");var SamsaraVO=function(){function t(t,e,i,s,n){this.lv=t,this.exp=e,this.expUpgradeNum=i,this.normalUpgradeNum=s,this.advancedUpgradeNum=n}return t}();__reflect(SamsaraVO.prototype,"SamsaraVO");var SamsaraCC=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Samsara,e.regNetMsg(1,e.postSamsaraInfo),e.regNetMsg(4,e.postCompose),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.exchangeSamsaraExp=function(t){var e=this.getBytes(2);e.writeByte(t),this.sendToServer(e)},e.prototype.upgradeSamsaraLv=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.postSamsaraInfo=function(t){var e=SamsaraModel.ins().samsaraInfo?!1:!0,i=SamsaraModel.ins().samsaraInfo?SamsaraModel.ins().samsaraInfo.exp:0;if(SamsaraModel.ins().samsaraInfo=new SamsaraVO(t.readInt(),t.readInt(),t.readShort(),t.readShort(),t.readShort()),!e){var s=SamsaraModel.ins().samsaraInfo.exp-i;s&&UserTips.ins().showTips("|C:0x00ff00&T:获得业力"+s+"|")}},e.prototype.requestCompose=function(t,e){var i=this.getBytes(4);i.writeInt(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postCompose=function(t){},e}(BaseSystem);__reflect(SamsaraCC.prototype,"SamsaraCC");var GameSystem;!function(t){t.samsaraCC=SamsaraCC.ins.bind(SamsaraCC)}(GameSystem||(GameSystem={}));var SamsaraUpgradeType;!function(t){t[t.level=1]="level",t[t.normal=2]="normal",t[t.advanced=3]="advanced"}(SamsaraUpgradeType||(SamsaraUpgradeType={}));var AddSpiritView=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="ReincarnateSpiritSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lunhuiList.itemRenderer=ItemBase,this.addTouchEvent(this.upBtn,this.addSpirit),this.addTouchEvent(this.bgClose,this.closeWin),this.observe(UserEquip.ins().postAddSpirit,this.updateView),this.index=t[1],this.roleIndex=t[0],this.updateView()},e.prototype.updateView=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleIndex),e=t.getEquipByIndex(this.index);this.setData(e)},e.prototype.addSpirit=function(){var t=this.lunhuiList.dataProvider;if(SamsaraModel.ins().checkSpiritLvIsMax(this.equipData,this.index))return void UserTips.ins().showTips("装备附灵等级已满级");if(0==t.length)UserTips.ins().showTips("没有可以附灵的装备");else{for(var e=[],i=0;i<t.length;i++){var s=t.getItemAt(i),n=UserBag.ins().getFilterBagItemById(s,e,UserBag.BAG_TYPE_EQUIP);n&&n.handle&&e.push(n.handle)}e.length>0&&UserEquip.ins().requestAddSpirit(this.roleIndex,this.index,e)}},e.prototype.setData=function(t){this.equipData=t;var e=t.spiritLv;this.lvTxt.text="(Lv."+e+")";var i=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,e),s=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,e+1),n=0;this.attr4.text="0",this.attr5.text="0",this.attr6.text="0",this.attr7.text="0",i&&(n=UserBag.getAttrPower(i.attrs),this.attr4.text=i.attrs[0].value.toString(),this.attr5.text=i.attrs[1].value.toString(),this.attr6.text=i.attrs[2].value.toString(),this.attr7.text=i.attrs[3].value.toString()),this.powerPanel.setPower(n),e==CommonUtils.getObjectLength(GlobalConfig.ReincarnateSpirit[this.index])?(this.attrGroup2.visible=!1,this.expBar.maximum=100,this.expBar.value=100):(this.attrGroup2.visible=!0,this.attr8.text=s.attrs[0].value.toString(),this.attr9.text=s.attrs[1].value.toString(),this.attr10.text=s.attrs[2].value.toString(),this.attr11.text=s.attrs[3].value.toString(),this.expBar.maximum=s.consume,this.expBar.value=t.spiritExp),this.expLabel.text=this.expBar.value+"/"+this.expBar.maximum;var o=SubRoles.ins().getSubRoleByIndex(this.roleIndex),a=SamsaraModel.ins().getAddSpiritEquips(o,this.index);this.lunhuiList.dataProvider=new ArrayCollection(a),this.redPoint.visible=SamsaraModel.ins().checkEquipPosCanAddSpirit(o,this.index)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(AddSpiritView.prototype,"AddSpiritView"),ViewManager.ins().reg(AddSpiritView,LayerManager.UI_Popup);var GetSamsaraExpPanel=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="GainYeLiSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.redPoint1.visible=!1,this.redPoint2.visible=!1;var i=new RewardData;i.type=0,i.id=0,i.count=0,this.item0.data=i,this.item0.isShowName(!1),this.item1.isShowName(!1),this.item2.isShowName(!1),this.addTouchEvent(this.bgClose,this.closeWin),this.addTouchEvent(this.btn0,this.expUpgrade),this.addTouchEvent(this.btn1,this.normalUpgrade),this.addTouchEvent(this.btn2,this.advanceUpgrade),this.observe(SamsaraCC.ins().postSamsaraInfo,this.updateView),this.observe(Shop.ins().postBuyResult,this.updateView),this.observe(Shop.ins().postBuyCount,this.updateView),this.updateView()},e.prototype.expUpgrade=function(){this.btn0.enabled&&(Actor.level>=GlobalConfig.ReincarnationBase.levelLimit?(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp,SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.level)):UserTips.ins().showTips("等级达到"+GlobalConfig.ReincarnationBase.levelLimit+"级可以兑换"))},e.prototype.normalUpgrade=function(){"购买"==this.btn1.label?this.buy(1,GlobalConfig.ReincarnationBase.normalItem.id):(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp,SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.normal))},e.prototype.advanceUpgrade=function(){"购买"==this.btn2.label?this.buy(2,GlobalConfig.ReincarnationBase.advanceItem.id):(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp,SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.advanced))},e.prototype.buy=function(t,e){var i=this["priceIcon"+t].getPrice();if(Actor.yb<i)UserTips.ins().showTips("元宝不足"),ViewManager.ins().close(this);else{var s=CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",e);this.buyGoods(s.id)}},e.prototype.buyGoods=function(t){Shop.ins().shopData.checkBuyGoodsId(t)&&ViewManager.ins().open(BuyWin,t)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.updateView=function(){if(void 0!=this.lastYeli&&SamsaraModel.ins().samsaraInfo.exp-this.lastYeli>0&&(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp),Actor.level>=GlobalConfig.ReincarnationBase.levelLimit){var t=GlobalConfig.ReincarnationExchange[Actor.level];this.yeli0.text=t.value.toString(),this.redPoint0.visible=SamsaraModel.ins().getExpExchangeTimes()>0,this.btn0.enabled=SamsaraModel.ins().getExpExchangeTimes()>0,this.limit.visible=!1}else this.yeli0.text=GlobalConfig.ReincarnationExchange[GlobalConfig.ReincarnationBase.levelLimit].value.toString(),this.redPoint0.visible=!1,this.limit.visible=!0;this.toDay0.text=SamsaraModel.ins().getExpExchangeTimes().toString(),this.updateItem(GlobalConfig.ReincarnationBase.normalItem,1,SamsaraModel.ins().getNormalExchangeTimes()),this.updateItem(GlobalConfig.ReincarnationBase.advanceItem,2,SamsaraModel.ins().getAdvancedExchangeTimes())},e.prototype.updateItem=function(t,e,i){var s=GlobalConfig.ItemConfig[t.id];this["item"+e].data=t.id,this["toDay"+e].text=i.toString(),i>0?this["toDay"+e].textColor=65280:this["toDay"+e].textColor=16711680,this["yeli"+e].text=t.value.toString();var n=UserBag.ins().getBagGoodsCountById(0,t.id);n>0?(this["name"+e].text=s.name+" 剩余："+n+"个",this["priceIcon"+e].visible=!1,this["redPoint"+e].visible=i>0,this["btn"+e].label="立即使用"):(this["name"+e].text=s.name,this["priceIcon"+e].visible=!0,this["priceIcon"+e].setPrice(CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",t.id).price),this["redPoint"+e].visible=!1,this["btn"+e].label="购买")},e}(BaseEuiView);__reflect(GetSamsaraExpPanel.prototype,"GetSamsaraExpPanel"),ViewManager.ins().reg(GetSamsaraExpPanel,LayerManager.UI_Popup);var SamsaraComposeItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.compose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.compose1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.dataChanged=function(){var t=this.data;if(t){var e=void 0,i=void 0,s=void 0;if(t.type==MergeType.SamsareEquip)e=GlobalConfig.ReincarnateEquipCompose[t.id],i=e.material.id,s=e.material.count,this.currentState="state1";else if(t.type==MergeType.ZhanlingEquip)e=GlobalConfig.ZhanLingEquip[t.id],i=e.mat[0].id,s=e.mat[0].count,this.currentState="state1";else if(t.type==MergeType.Rune)return this.currentState="state2",void this.setState2Info(t.type,t.id);this.need.showName=!0,this.need.data=i,this.num.text=s.toString(),this.target.showName=!0,this.target.data=t.id;var n=MergeCC.ins().isCanMergeTargetId(t.type,t.id);this.redPoint.visible=n,n?this.content.filters=null:this.content.filters=FilterUtil.ARRAY_GRAY_FILTER}},e.prototype.onTouch=function(){if(this.redPoint.visible){var t=this.data,e=void 0;if(t.type==MergeType.SamsareEquip){e=GlobalConfig.ReincarnateEquipCompose[t.id];var i=SamsaraModel.ins().getRoleIndexByEquip(e.material.id);SamsaraCC.ins().requestCompose(t.id,i)}else t.type==MergeType.ZhanlingEquip&&ZhanLing.ins().sendZhanLingComposeItem(t.id)}else this.redPoint1.visible?this.data.type==MergeType.Rune&&Rune.ins().sendRuneMerge(this.data.id):UserTips.ins().showTips("|C:0xf3311e&T:材料不足|")},e.prototype.setState2Info=function(t,e){if(this.redPoint.visible=!1,this.need0.showName=!0,this.need1.showName=!0,this.need2.showName=!0,this.target1.showName=!0,t==MergeType.Rune){var i=GlobalConfig.RuneComposeConfig[e],s=GlobalConfig.RuneOtherConfig.goldItemId;this.need0.data=i.material[0],this.need1.data=i.material[1],this.need2.num=i.count,this.need2.data=s,this.target1.data=i.id;UserBag.ins()}var n=MergeCC.ins().isCanMergeTargetId(t,e);this.redPoint1.visible=n,this.compose1.enabled=n},e.prototype.onRemove=function(t){this.content&&(this.content.filters=null)},e}(BaseItemRender);__reflect(SamsaraComposeItem.prototype,"SamsaraComposeItem");var SamsaraComposeMenuItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=SamsaraComposeSecMenuItem,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this)},e.prototype.onListChange=function(){var t=this.list.selectedItem,e=ViewManager.ins().getView(BagWin).reinComposePanel;e.updateView(t.type,t.zsLv,SamsaraModel.ins().getComposeEquipId(t.type,t.zsLv)),e.unSelectList(),this.list.getElementAt(this.list.selectedIndex).setSelect(!0)},e.prototype.selectList=function(t){this.list.selectedIndex=t;var e=this.list.getElementAt(this.list.selectedIndex);e.selected=!0,e.setSelect(!0)},e.prototype.dataChanged=function(){var t=this.data;this.nameLabel.text=GlobalConfig.ReincarnationBase.headName[t-1]+".轮回装备",this.list.dataProvider=new ArrayCollection(SamsaraModel.ins().getComposeZsList(t)),this.redPoint.visible=SamsaraModel.ins().isCanTypeCompose(t),1==t?this.rein_equips.source="rein_equip_shen":this.rein_equips.source="rein_equip_sheng"},e}(BaseItemRender);__reflect(SamsaraComposeMenuItem.prototype,"SamsaraComposeMenuItem");var SamsaraComposeSecMenuItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.type,e=this.data.zsLv,i=SamsaraModel.ins().getComposeDesc(t);this.head.text=i,this.lv.text=e+"转装备",this.redPoint.visible=SamsaraModel.ins().isCanZsLvCompose(t,e);var s=ViewManager.ins().getView(BagWin).reinComposePanel;s.type==t&&s.zsLv==e&&this.setSelect(!0)},e.prototype.setSelect=function(t){this.chosen.visible=t},e}(BaseItemRender);__reflect(SamsaraComposeSecMenuItem.prototype,"SamsaraComposeSecMenuItem");var SamsaraComposePanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.list.itemRenderer=SamsaraComposeMenuItem,this.list0.itemRenderer=SamsaraComposeItem,this._listData=new eui.ArrayCollection,this.list0.dataProvider=this._listData,this._tabListData=new eui.ArrayCollection,this.list.dataProvider=this._tabListData},e.prototype.open=function(){this.updateState(),this.observe(UserBag.ins().postItemAdd,this.buffUpdata),this.observe(UserBag.ins().postItemDel,this.buffUpdata),this.observe(UserBag.ins().postItemCountChange,this.buffUpdata),this.observe(SamsaraCC.ins().postCompose,this.buffUpdata)},e.prototype.buffUpdata=function(){TimerManager.ins().remove(this.updateState,this),TimerManager.ins().doTimer(100,1,this.updateState,this)},e.prototype.updateState=function(){var t,e,i=SamsaraModel.ins().getComposeEquipList();if(i&&i.length>0){this.materialId=i[0];var s=SamsaraModel.ins().getComposeTarget(this.materialId),n=GlobalConfig.ItemConfig[s],o=GlobalConfig.ReincarnateEquipCompose[s];t=o.distinguishi,e=n.zsLevel}else this.materialId=0,t=1,e=GlobalConfig.ReincarnationBase.equipsList[0][0];this.zsLv=e,this.type=t,this._tabListData.source=SamsaraModel.ins().getComposeMenu(),this.updateView(t,e,this.materialId)},e.prototype.selectList=function(t,e){for(var i=t.list,s=i.dataProvider.length,n=0;s>n;n++){var o=i.getElementAt(n);if(o&&e==o.data.zsLv)return void t.selectList(n)}},e.prototype.unSelectList=function(){for(var t=this.list.dataProvider.length,e=0;t>e;e++)for(var i=this.list.getElementAt(e),s=i.list,n=0;n<s.dataProvider.length;n++){var o=s.getElementAt(n);o&&o.setSelect(!1)}},e.prototype.updateView=function(t,e,i){void 0===i&&(i=0);var s=SamsaraModel.ins().composeEquipMap[t][e];this._listData.source=s,this.refushBarList(i)},e.prototype.refushBarList=function(t){if(!t)return void(this.contentScroller.viewport.scrollV=0);for(var e=SamsaraModel.ins().getComposeTarget(this.materialId),i=this.list0.dataProvider,s=0;s<i.length;s++)if(e==i.getItemAt(s)){this.contentScroller.viewport.validateNow(),this.contentScroller.viewport.scrollV=101*s,this.contentScroller.viewport.contentHeight-this.contentScroller.viewport.scrollV<this.contentScroller.viewport.height&&(this.contentScroller.viewport.scrollV=this.contentScroller.viewport.contentHeight-this.contentScroller.height);break}},e.prototype.close=function(){this.removeObserve()},e}(BaseEuiView);__reflect(SamsaraComposePanel.prototype,"SamsaraComposePanel");var SamsaraEquipTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ReincarnateEquipTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(void 0!=t[1]){this.roleIndex=-1,this.roleModel=t[1],this.index=t[2];var i=t[0],s=!1;if(i>=0&&i<=SubRoles.ins().subRolesLen-1){var n=SubRoles.ins().getSubRoleByIndex(i);n.handle==this.roleModel.handle&&(s=!0,this.roleIndex=this.roleModel.index)}var o=this.roleModel.getEquipByIndex(this.index);this.setData(o),s?(this.addTouchEvent(this.spiritBtn,this.addSpirit),this.addTouchEvent(this.soulBtn,this.addSoul),this.spiritBtn.visible=!0,this.soulBtn.visible=!0):(this.spiritBtn.visible=!1,this.soulBtn.visible=!1)}else this.setTips(t[0]);this.addTouchEvent(this.bgClose,this.closeWin)},e.prototype.setTips=function(t){this.spiritBtn.visible=!1,this.soulBtn.visible=!1,this.redPoint.visible=!1,this.redPoint1.visible=!1;var e=GlobalConfig.ItemConfig[t];this.updateBaseView(e);var i=new ItemData;i.itemConfig=e;var s=ItemConfig.calculateBagItemScore(i);this.powerPanel.setPower(s),this.score.text="评分："+s;var n,o=ItemConfig.getSubType(e);o==EquipPos.HAT?(this.currentState="noSpirit0",n=!0):(n=!1,this.currentState="noSpirit1"),this.updateBaseAttr(t,n),this.setSoulAttr(0),this.setSoulLink(0,0);var a=[0,0,0,0];switch(o){case EquipPos.HAT:a[0]=1;break;case EquipPos.VIZARD:a[1]=1;break;case EquipPos.CLOAK:a[2]=1;break;case EquipPos.SHIELD:a[3]=1}this.setSuitAttr(e.id,a)},e.prototype.setData=function(t){this.soulBtn.visible=!0,this.spiritBtn.visible=!0,this.redPoint.visible=this.roleIndex>=0&&SamsaraModel.ins().checkEquipPosCanAddSpirit(this.roleModel,this.index),this.redPoint1.visible=this.roleIndex>=0&&SamsaraModel.ins().checkUpgradeSoul(this.roleModel,this.index);var e=t.item.itemConfig;this.updateBaseView(e,t.soulLv);var i,s=GlobalConfig.EquipConfig[e.id],n=t.spiritLv;if(0==n&&0==t.spiritExp)this.index==EquipPos.HAT?(this.currentState="noSpirit0",i=!0):(this.currentState="noSpirit1",i=!1);else{var o=n==CommonUtils.getObjectLength(GlobalConfig.ReincarnateSpirit[this.index]);this.index==EquipPos.HAT?(this.currentState="doSpirit0",i=!0):(this.currentState="doSpirit1",i=!1),this.setSpirit(t.spiritExp,t.spiritLv,o,i)}this.updateBaseAttr(e.id,i);var a=SamsaraModel.ins().lowSuitEquips(this.index,this.roleModel);this.setSuitAttr(e.id,a),this.score.text="评分："+t.item.point;for(var r=0,h=0;h<a.length;h++)a[h]&&r++;var l=4==r,c=SamsaraModel.ins().getReincarnateSuit(e.id),u=t.item.point;if(u=this.setSoulAttr(t.soulLv,e.id,u),u=this.setSoulLink(t.soulLv,SamsaraModel.ins().getSoulLinkLv(this.roleModel,this.index,t.soulLv),e.id,u),this.roleModel&&s&&s.baseAttr2){var p=s.baseAttr2.value/100;u+=SamsaraModel.ins().getExtraPower(this.roleModel,p,s.baseAttr2.type)}if(l&&(u+=UserBag.getAttrPower(c.attrs)),n>0){var d=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,n);u+=UserBag.getAttrPower(d.attrs)}u>>=0,this.powerPanel.setPower(u)},e.prototype.updateBaseView=function(t,e){void 0===e&&(e=0);var i=ItemConfig.getQuality(t),s=ItemConfig.getSubType(t),n=ItemConfig.getJob(t);if(this.nameLabel.text=t.name,e>0){var o="注魂";switch(e){case 1:o+="Ⅰ";break;case 2:o+="Ⅱ";break;case 3:o+="Ⅲ";break;case 4:o+="Ⅳ"}this.nameLabel.text=o+"."+t.name,this.itemIcon.setSoul(!0)}this.nameLabel.textColor=ItemConfig.getQualityColor(t),this.quali.source=i>0?"quali"+i:"",this.itemIcon.setData(t),this.type.text=Role.getEquipNameByType(s),this.lv.text=t.zsLevel+"转",this.lv.textColor=UserZs.ins().lv<t.zsLevel?15937822:3532333,this.career.text=Role.getJobNameByJob(n)},e.prototype.updateBaseAttr=function(t,e){var i=GlobalConfig.EquipConfig[t];this.attr0.text=i.atk.toString(),this.attr1.text=i.hp.toString(),this.attr2.text=i.def.toString(),this.attr3.text=i.res.toString(),this.attr4.text=i.baseAttr1.value.toString(),e&&(this.attr5.text=i.baseAttr2.value/100+"%")},e.prototype.setSuitAttr=function(t,e){var i=SamsaraModel.ins().getEquipSamsaraLv(t),s=SamsaraModel.ins().getSamsaraDesc(i-7),n=SamsaraModel.ins().getReincarnateSuit(t);this.suitName.text=s+"套装",this.attr12.text=this.getValue(n.attrs,AttributeType.atAttack),this.attr13.text=this.getValue(n.attrs,AttributeType.atMaxHp),this.attr14.text=this.getValue(n.attrs,AttributeType.atDef),this.attr15.text=this.getValue(n.attrs,AttributeType.atRes),this.attr16.text=n.exAttrs[0].value/100+"%";for(var o=e[0]?ColorUtil.GREEN_COLOR:"0xff0000",a=e[1]?ColorUtil.GREEN_COLOR:"0xff0000",r=e[2]?ColorUtil.GREEN_COLOR:"0xff0000",h=e[3]?ColorUtil.GREEN_COLOR:"0xff0000",l=0,c=0;c<e.length;c++)e[c]&&l++;this.suitState.textFlow=TextFlowMaker.generateTextFlow("<font color="+o+">"+Role.getEquipNameByType(EquipPos.HAT)+"、</font><font color="+a+">"+Role.getEquipNameByType(EquipPos.VIZARD)+"、</font><font color="+r+">"+Role.getEquipNameByType(EquipPos.CLOAK)+"、</font><font color="+h+">"+Role.getEquipNameByType(EquipPos.SHIELD)+"</font>");var u=4==l,p=u?ColorUtil.GREEN_COLOR_N:16711680;this.suitNum.textColor=p,this.suitNum.text="("+l+"/4)",this.setSuitAttrTextColor(u)},e.prototype.setSuitAttrTextColor=function(t){var e=t?16711935:6710886;this.attr12.textColor=e,this.attr13.textColor=e,this.attr14.textColor=e,this.attr15.textColor=e,this.attr16.textColor=e,this.attrDesc.textColor=e,this.attrDesc1.textColor=e},e.prototype.setSpirit=function(t,e,i,s){var n,o=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,e);n=i?"":"("+t+"/"+o.consume+")",this.spiritLv.text="Lv"+e,this.spiritCost.text=n,0==e?(this.attr6.text="0",this.attr7.text="0",this.attr8.text="0",this.attr9.text="0"):(this.attr6.text=this.getValue(o.attrs,AttributeType.atAttack),this.attr7.text=this.getValue(o.attrs,AttributeType.atMaxHp),this.attr8.text=this.getValue(o.attrs,AttributeType.atDef),this.attr9.text=this.getValue(o.attrs,AttributeType.atRes))},e.prototype.getValue=function(t,e){var i=CommonUtils.getObjectByAttr(t,"type",e);return i.value.toString()},e.prototype.addSpirit=function(){this.closeWin(),ViewManager.ins().open(AddSpiritView,this.roleIndex,this.index)
},e.prototype.addSoul=function(){this.closeWin(),ViewManager.ins().open(SamsaraSoulWin,this.roleIndex,this.index)},e.prototype.setSoulAttr=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0==t)this.soulDescLable.visible=!1,this.soulAddAttr0.text="",this.soulAddAttr1.text="",this.soulAddAttr2.text="",this.soulAddAttr3.text="",this.soulAddAttr4.text="";else{this.soulDescLable.visible=!0;var s=GlobalConfig.EquipConfig[e],n=s.atk,o=s.hp,a=s.def,r=s.res,h=s.baseAttr1.value,l=ItemConfig.getSubType(GlobalConfig.ItemConfig[e]),c=GlobalConfig.ReincarnationDemonLevel[l][t],u=c.precent/1e4;this.soulAddAttr0.text=Math.floor(n*u).toString(),this.soulAddAttr1.text=Math.floor(o*u).toString(),this.soulAddAttr2.text=Math.floor(a*u).toString(),this.soulAddAttr3.text=Math.floor(r*u).toString(),this.soulAddAttr4.text=Math.floor(h*u).toString();var p=0;if(s.baseAttr2&&(p=UserBag.getAttrPower([s.baseAttr2])),i=(i-p)*(1+u)+p,t>0){var d=GlobalConfig.ReincarnationSoulLevel[ItemConfig.getJob(GlobalConfig.ItemConfig[e])][l][t];i+=UserBag.getAttrPower(d.attrs)}i>>=0}return i},e.prototype.setSoulLink=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0),0==t?(this.chainGroup.parent&&this.chainGroup.parent.removeChild(this.chainGroup),this.soulGroup.parent&&this.soulGroup.parent.removeChild(this.soulGroup)):(this.chainGroup.parent||this.suitGroup.parent.addChild(this.soulGroup),this.soulGroup.parent||this.suitGroup.parent.addChild(this.soulGroup)),this.soulLv.text="Lv"+t;var n=e;if(0==e&&(n=1),this.chainLv.text="Lv"+n,i){var o=ItemConfig.getSubType(GlobalConfig.ItemConfig[i]);if(n>0){var a=SamsaraModel.ins().getReincarnationLinkLevel(o,n);this.chainPos.text="[魔魂"+Role.getEquipNameByType(a.secondSlot)+"]",this.chainAttr.text=SamsaraModel.ins().getSoulLinkDesc(a.attrs[0].type),this.chainValue.text=a.attrs[0].value/100+"%";var r=void 0;if(r=0==e?6710886:16776960,this.chainPos.textColor=r,this.chainAttr.textColor=r,this.chainState.textColor=r,this.chainValue.textColor=r,e>0){var h=this.roleModel,l=UserBag.getAttrPower([a.attrs[0]])+ItemConfig.relatePower(a.attrs[0],h);s+=l}}if(t>0){var c=GlobalConfig.ReincarnationDemonLevel[o][t],u=void 0,p=c.precent/100;p+=100,u=p+"%",this.soulAttr.text=u}}return s},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(SamsaraEquipTips.prototype,"SamsaraEquipTips"),ViewManager.ins().reg(SamsaraEquipTips,LayerManager.UI_Popup);var SamsaraPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.lvImgAry=[this.lv0,this.lv1,this.lv2,this.lv3,this.lv4,this.lv5],this.effectContainerAry=[this.eff0,this.eff1,this.eff2,this.eff3,this.eff4,this.eff5];for(var t in this.effectContainerAry){var e=new MovieClip;e.playFile(RES_DIR_EFF+"reincarnation_fire",-1),this.effectContainerAry[t].addChild(e)}this.ballEffect=new MovieClip,this.ballEffect.playFile(RES_DIR_EFF+"reincarnation_ball",-1),this.ball.addChild(this.ballEffect),this.labelEffect=new MovieClip,this.labelEffect.scaleX=.7,this.labelEffect.scaleY=.5,this.labelEffect.touchEnabled=!1,this.redPoint.visible=!1,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getItemTxt.text+"</u></a>")},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.getItemTxt,this.getItem),this.addTouchEvent(this.upBtn,this.upgrade),this.observe(SamsaraCC.ins().postSamsaraInfo,this.updateView),this.updateView()},e.prototype.upgrade=function(){this.isExpEnough?SamsaraCC.ins().upgradeSamsaraLv():UserTips.ins().showTips("业力不足")},e.prototype.getItem=function(){ViewManager.ins().open(GetSamsaraExpPanel)},e.prototype.getValue=function(t,e){var i=CommonUtils.getObjectByAttr(t,"type",e);return i.value.toString()},e.prototype.updateView=function(){var t=SamsaraModel.ins().samsaraInfo,e=t.lv,i=GlobalConfig.ReincarnationLevel[e],s=AttributeData.getAttStr(i.attrs,0,1,"  :  ");this.attr1.text=s;var n=3*UserBag.getAttrPower(i.attrs);this.powerPanel1.setPower(n);var o,a=e+1,r=a>=CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel);if(r)this.powerPanel0.setPower(n),this.attr0.text=s,this.yeliValue.text="已满级",o=1;else{var h=GlobalConfig.ReincarnationLevel[a],l=3*UserBag.getAttrPower(h.attrs);this.powerPanel2.setPower(l),s=AttributeData.getAttStr(h.attrs,0,1,"  :  "),this.attr2.text=s;var c=void 0,u=t.exp,p=h.consume;u>=p?(c=ColorUtil.GREEN_COLOR,this.isExpEnough=!0):(c=ColorUtil.RED_COLOR,this.isExpEnough=!1),this.yeliValue.textFlow=TextFlowMaker.generateTextFlow("<font color="+c+">"+u+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+p+"</font> "),o=u/p}this.setMaxSamsaraState(r),SamsaraModel.ins().isCanExchange()?this.addLabelEffect():this.removeLabelEffect();var d=SamsaraModel.ins().getSamsara(Actor.samsaraLv),g=SamsaraModel.ins().getSamsaraLv(Actor.samsaraLv),f=SamsaraModel.ins().getSamsaraDesc(d)+"·"+SamsaraModel.ins().getSamsaraLvDesc(g);this.lunhuiLv.text=f,this.setLvImgState(g),this.maskImage(o),this.redPoint.visible=this.upBtn.visible&&SamsaraModel.ins().isCanUpgrade()},e.prototype.setMaxSamsaraState=function(t){this.attrGroup0.visible=t,this.arrow.visible=!t,this.attrGroup1.visible=!t,this.attrGroup2.visible=!t,this.upBtn.visible=!t,this.getItemTxt.visible=!t,this.maxLevel.visible=t},e.prototype.setLvImgState=function(t){for(var e in this.lvImgAry)this.lvImgAry[e].visible=!1,this.effectContainerAry[e].visible=!1;for(var e=0;t>=e;e++)this.lvImgAry[e].visible=!0,this.effectContainerAry[e].visible=!0},e.prototype.addLabelEffect=function(){var t=this;TimerManager.ins().doNext(function(){DisplayUtils.removeFromParent(t.labelEffect),t.labelEffect.x=t.getItemTxt.x+t.getItemTxt.width/2,t.labelEffect.y=t.getItemTxt.y+t.getItemTxt.height/2,null==t.labelEffect.parent&&t.getItemTxt.parent.addChild(t.labelEffect),t.labelEffect.playFile(RES_DIR_EFF+"chargeff1",-1)},this)},e.prototype.maskImage=function(t){if(t>=1)return DisplayUtils.removeFromParent(this.masksp),void(this.masksp=null);var e=103;if(!this.masksp){this.masksp=new egret.Sprite;var i=new egret.Shape;i.graphics.beginFill(16776960),i.graphics.drawRect(this.ball.x-60,this.ball.y-45,120,e),i.graphics.endFill(),this.masksp.addChild(i),this.ball.parent.addChild(this.masksp),this.ball.mask=this.masksp}this.masksp.y=e*(1-t)},e.prototype.removeLabelEffect=function(){this.labelEffect.stop(),DisplayUtils.removeFromParent(this.labelEffect)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e}(BaseView);__reflect(SamsaraPanel.prototype,"SamsaraPanel");var SamsaraSoulWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ReincarnateSoulSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(UserEquip.ins().postAddSoul,this.updateView),this.addTouchEvent(this.soulBtn,this.addSoul),this.addTouchEvent(this.closeBtn,this.closeWin),this.roleIndex=t[0],this.subType=t[1],this.updateView()},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.addSoul=function(){UserEquip.ins().requestAddSoul(this.roleIndex,this.subType)},e.prototype.updateView=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleIndex),e=t.getEquipByIndex(this.subType);this.itemId=e.item.itemConfig.id;var i=t.getEquipByIndex(this.subType);this.soulLv=i.soulLv,this.soulLinkLv=SamsaraModel.ins().getSoulLinkLv(t,this.subType,i.soulLv);var s=GlobalConfig.ItemConfig[this.itemId],n=ItemConfig.getSubType(s),o=ItemConfig.getJob(s),a=SamsaraModel.ins().getSoulMaxLevel(),r=this.soulLv==a,h=this.soulLinkLv==a;if(this.nextSoulTextGroup.visible=!(0==this.soulLv||r),this.nextChainTextGroup.visible=!(0==this.soulLinkLv||h),this.nextChainTextGroup.visible){var l=SamsaraModel.ins().getReincarnationLinkLevel(n,this.soulLinkLv+1);this.nextChain0.text=l.attrs[0].value/100+"%"}if(this.nextSoulTextGroup.visible){var l=GlobalConfig.ReincarnationDemonLevel[n][this.soulLv+1];this.nextChain1.text=100+l.precent/100+"%"}var c=0;c=0==this.soulLinkLv?1:this.soulLinkLv;var u=0;u=0==this.soulLv?1:this.soulLv;var p=SamsaraModel.ins().getReincarnationLinkLevel(n,c);this.chainPos.text="[魔魂"+Role.getEquipNameByType(p.secondSlot)+"]",this.chainAttr.text=SamsaraModel.ins().getSoulLinkDesc(p.attrs[0].type),this.chainState.text="增加",this.chainValue.text=p.attrs[0].value/100+"%";var d,g=GlobalConfig.ReincarnationDemonLevel[n][u],f=g.precent/100;f+=100,d=f+"%",this.soulAttr.text=d;var v=GlobalConfig.ReincarnationSoulLevel[o][n][u],y=AttributeData.getAttStr(v.attrs,0,1,"  :  "),m=UserBag.getAttrPower(v.attrs);m+=this.getChainAddPower(this.soulLinkLv),m+=this.getSoulAddPower(e,this.soulLv),r||this.powerPanel0.setPower(m),0==this.soulLv?(this.attr0.text="攻击：0\n物防：0\n魔防：0\n生命：0\n神圣伤害：0",this.powerPanel0.setPower(0)):this.attr0.text=y;var T;if(r)this.attrGroup0.visible=!1,this.attrGroup1.visible=!1,this.attrGroup3.visible=!0,this.attr3.text=y,this.powerPanel3.setPower(m);else{this.attrGroup0.visible=!0,this.attrGroup1.visible=!0,this.attrGroup3.visible=!1,T=GlobalConfig.ReincarnationSoulLevel[o][n][this.soulLv+1];var b=AttributeData.getAttStr(T.attrs,0,1,"  :  ");this.attr1.text=b;var C=UserBag.getAttrPower(T.attrs);C+=this.getChainAddPower(this.soulLinkLv+1),C+=this.getSoulAddPower(e,this.soulLv+1),this.powerPanel1.setPower(C)}this.chainLv0.text="Lv"+c,this.soulLvText.text="Lv"+u;var I=v.materialInfo.id,w=UserBag.ins().getBagGoodsCountById(0,I),_=!1;T&&(_=w>=T.materialInfo.count),this.materialLabel.text=GlobalConfig.ItemConfig[I].name,this.costImg.source=GlobalConfig.ItemConfig[I].icon+"_png",this.num.text=w.toString(),T?this.needNum.text="/"+T.materialInfo.count.toString():this.needNum.text="/0",this.soulBtn.enabled=_&&!r,_?this.num.textColor=ColorUtil.GREEN_COLOR_N:this.num.textColor=ColorUtil.RED_COLOR_N,this.redPoint.visible=_&&!r,this.arrow0.visible=!r,this.rein_title.source="rein_demon_soul_"+o+n},e.prototype.getChainAddPower=function(t){if(0==t)return 0;var e=SamsaraModel.ins().getReincarnationLinkLevel(this.subType,t),i=SubRoles.ins().getSubRoleByIndex(this.roleIndex),s=UserBag.getAttrPower([e.attrs[0]])+ItemConfig.relatePower(e.attrs[0],i);return s>>0},e.prototype.getSoulAddPower=function(t,e){if(0==e)return 0;var i=GlobalConfig.ReincarnationDemonLevel[this.subType][e],s=i.precent/1e4,n=ItemConfig.getBaseAttrData(t.item.itemConfig);return UserBag.getAttrPower(n)*s>>0},e.prototype.getValue=function(t,e){var i=CommonUtils.getObjectByAttr(t,"type",e);return i.value.toString()},e}(BaseEuiView);__reflect(SamsaraSoulWin.prototype,"SamsaraSoulWin"),ViewManager.ins().reg(SamsaraSoulWin,LayerManager.UI_Main);var GameServer=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Default,e.regNetMsg(23,e.postServerOpenDay),e.regNetMsg(14,e.doServerTime),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e,"serverTime",{get:function(){return e._serverTime+egret.getTimer()},enumerable:!0,configurable:!0}),e.setServerTime=function(t){e._serverTime=DateUtils.formatMiniDateTime(t)-egret.getTimer()},e.prototype.postServerOpenDay=function(t){e.serverOpenDay=t.readInt(),e._serverZeroTime=t.readInt(),e._serverHeZeroTime=t.readInt(),e._hefuCount=t.readInt(),e.isOpenLF=t.readBoolean()},e.prototype.doServerTime=function(t){e.setServerTime(t.readUnsignedInt())},e}(BaseSystem);__reflect(GameServer.prototype,"GameServer");var GameSystem;!function(t){t.gameServer=GameServer.ins.bind(GameServer)}(GameSystem||(GameSystem={}));var SceneManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.clear=function(){var t=this._currScene;t&&(t.onExit(),this._currScene=void 0)},e.prototype.runScene=function(t){if(null==t)return void Log.trace("runScene:scene is null");var e=this._currScene;e&&(e.onExit(),e=void 0);var i=new t;i.onEnter(),this._currScene=i},e.prototype.getCurrScene=function(){return this._currScene},e.prototype.getSceneName=function(){return this._currScene?egret.getQualifiedClassName(this._currScene):""},e}(BaseClass);SceneManager.CREATE_ROLE="CreateRoleScene",SceneManager.MAIN="MainScene",__reflect(SceneManager.prototype,"SceneManager");var SettingView=function(t){function e(){var e=t.call(this)||this;return e.skinName="settingskin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.cbSound,this.onTouch),this.addTouchEvent(this.cbShake,this.onTouch),this.addTouchEvent(this.cbHeji,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.cbSound.selected=SysSetting.ins().getBool(SysSetting.SOUND_EFFECT),this.cbShake.selected=SysSetting.ins().getBool(SysSetting.SHAKE_WIN),this.cbHeji.selected=SysSetting.ins().getBool(SysSetting.AUTO_HEJI)},e.prototype.onTouch=function(t){var e=t.currentTarget;e==this.cbSound?(SysSetting.ins().setBool(SysSetting.SOUND_EFFECT,e.selected),UserTips.ins().showTips("")):e==this.cbShake?SysSetting.ins().setBool(SysSetting.SHAKE_WIN,e.selected):e==this.cbHeji?SysSetting.ins().setBool(SysSetting.AUTO_HEJI,e.selected):e==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(SettingView.prototype,"SettingView"),ViewManager.ins().reg(SettingView,LayerManager.UI_Popup);var SysSetting=function(t){function e(){var e=t.call(this)||this;return e._storage={},e._tempStorage={},e.defaultValue={sound_effect:1,shake_win:1,auto_heji:0,dice:0},e.init(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.setItem=function(t,i){this._storage[t]!=i&&(this._storage[t]=i,t==e.SOUND_EFFECT?SoundManager.ins().setEffectOn(this.getBool(t)):t==e.SHAKE_WIN?DisplayUtils.setShakeOn(this.getBool(t)):t==e.DICE&&(Millionaire.ins().autoTurnDice=i),TimerManager.ins().isExists(this.storage,this)||TimerManager.ins().doNext(this.storage,this))},e.prototype.getItem=function(t){return this._storage[t]},e.prototype.setBool=function(t,e){this.setItem(t,e?1:0)},e.prototype.getBool=function(t){return!!this.getItem(t)},e.prototype.setValue=function(t,e){this._tempStorage[t]=e},e.prototype.getValue=function(t){return this._tempStorage[t]},e.prototype.init=function(){try{var t=egret.localStorage.getItem(this.getStorageKey());t?this._storage=JSON.parse(t)||{}:this._storage={}}catch(e){console.log(e),this._storage={}}this.initValue()},e.prototype.initValue=function(){for(var t in this.defaultValue)void 0==this._storage[t]&&(this._storage[t]=this.defaultValue[t]);SoundManager.ins().setEffectOn(this.getBool(e.SOUND_EFFECT)),DisplayUtils.setShakeOn(this.getBool(e.SHAKE_WIN))},e.prototype.storage=function(){try{var t=JSON.stringify(this._storage);egret.localStorage.setItem(this.getStorageKey(),t)}catch(e){}},e.prototype.getStorageKey=function(){return Actor.actorID+""||"game_longlin"},e}(BaseClass);SysSetting.SOUND_EFFECT="sound_effect",SysSetting.SHAKE_WIN="shake_win",SysSetting.AUTO_HEJI="auto_heji",SysSetting.DICE="dice",__reflect(SysSetting.prototype,"SysSetting");var GameSystem;!function(t){t.syssetting=SysSetting.ins.bind(Setting)}(GameSystem||(GameSystem={}));var SevenDayIconBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showDetail=function(){},e.prototype.onClick=function(){},e}(ItemBase);__reflect(SevenDayIconBase.prototype,"SevenDayIconBase");var FrameTick=function(){function t(){this.list=[]}return t.prototype.tick=function(t){this.list[t]=TimerManager.ins().getFrameId()},t.prototype.isTick=function(t){return this.list[t]==TimerManager.ins().getFrameId()},t.prototype.checkAndTick=function(t){return this.isTick(t)?!0:(this.tick(t),!1)},t}();__reflect(FrameTick.prototype,"FrameTick");var SevenDayLogItem=function(t){function e(){var e=t.call(this)||this;return e.day=0,e.state=0,e.skinName="SevenDayLogItemSkin",e.awardsList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t&&(this.day=t.day,this.dayTxt.text="第"+e.ChineseNum[this.day]+"天",Activity.ins().dayNum>=this.day?this.getRemindByIndex(this.day)?(this.sureBtn.visible=!1,this.sureImg.visible=!0):(this.sureBtn.visible=!0,this.sureImg.visible=!1):(this.sureBtn.visible=!1,this.sureImg.visible=!1),this.awardsList.dataProvider=new eui.ArrayCollection(t.rewards))},e.prototype.getRemindByIndex=function(t){return 1==(Activity.ins().isAwards>>t&1)},e}(BaseItemRender);SevenDayLogItem.ChineseNum=["零","一","二","三","四","五","六","七","八","九"],__reflect(SevenDayLogItem.prototype,"SevenDayLogItem");var SevenDayLogWin=function(t){function e(){var e=t.call(this)||this;e.itemary=[],e.dayindex=0,e.itemList=[],e.skinName="act14logSkin",e.itemary=[],e.itemList=[];for(var i=0;14>i;i++)e.itemList[i]=e["dayNum"+(i+1)],e.itemList[i].touchEnabled=!1;return e}return __extends(e,t),e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.addTouchEvent(this.suerBtn,this.onTouch);for(var s=0;14>s;s++)this.addTouchEvent(this.itemList[s],this.itemTouch);this.observe(Activity.ins().postSevendayAwardCallback,this.setList),this.observe(Activity.ins().postSevendayIsAwards,this.changeList),this.changeList(),this.showRedPoint();var n=e[0];n&&this.setList(n),this.dayindex>7&&TimerManager.ins().doNext(function(){t.scroller.viewport.scrollV=t.scroller.viewport.contentHeight-t.scroller.height},this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.onTouch),DisplayUtils.removeFromParent(this.btnMC);for(var i=0;14>i;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.removeObserve()},e.prototype.changeList=function(){var t=0,e=Activity.ins().dayNum;t=e>=14?13:e;for(var i=1;t>=i;i++){var s=GlobalConfig.LoginRewardsConfig[i];if(s&&e>=s.day&&0==(Activity.ins().isAwards>>s.day&1))return void this.setList(i-1)}this.setList(t)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.suerBtn:Activity.ins().dayNum>=this.day?Activity.ins().sendGetSevenDayAwards(this.day):UserTips.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data-1)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),this.dayindex=t;var e;CommonUtils.getObjectLength(GlobalConfig.LoginRewardsConfig);e=GlobalConfig.LoginRewardsConfig[t+1].rewards,this.day=GlobalConfig.LoginRewardsConfig[t+1].day;var i=0;i=Activity.ins().dayNum,this.daylabel.text="登陆天数："+i,this.daylabel.visible=!0;var s=1==(Activity.ins().isAwards>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t+1)+"天奖励详情",this.suerBtn.visible=!0,Activity.ins().dayNum>=this.day?s?(this.daylabel.visible=!1,this.suerBtn.visible=!1,this.redPoint.visible=!1):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=this.suerBtn.width/2,this.btnMC.y=this.suerBtn.height/2,this.btnMC.playFile(RES_DIR_EFF+"chargeff1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var n=0;n<e.length;n++){var o=new ItemBase;this.group1.addChild(o),o.data=e[n],this.itemary.push(o)}for(var n=0;14>n;n++)this.itemList[n].data=n+1,n==t||13==n&&13==t?this.itemList[n].setSelectImg(!0):this.itemList[n].setSelectImg(!1);this.showRedPoint()},e.prototype.showRedPoint=function(){},e}(BaseView);__reflect(SevenDayLogWin.prototype,"SevenDayLogWin");var ShenshouData=function(){function t(t){this.equipIDs=[],this.state=0;for(var e=1;5>=e;e++)this.equipIDs[e]=0;t&&this.readData(t)}return t.prototype.readData=function(t){this.id=t.readByte(),this.equipIDs=[];for(var e=t.readByte(),i=0;e>i;i++)this.equipIDs[i+1]=t.readInt();this.state=t.readByte(),this.equipIDs.indexOf(0)>-1&&this.state!=ShenshouState.State_Has&&(this.state=ShenshouState.State_No)},t.prototype.checkState=function(){this.state!=ShenshouState.State_Has&&(this.equipIDs.indexOf(0)>-1?this.state=ShenshouState.State_No:this.state=ShenshouState.State_Can)},t}();__reflect(ShenshouData.prototype,"ShenshouData");var ShenshouEquipData=function(){function t(){}return t}();__reflect(ShenshouEquipData.prototype,"ShenshouEquipData");var ShenshouState;!function(t){t[t.State_No=2]="State_No",t[t.State_Can=0]="State_Can",t[t.State_Has=1]="State_Has"}(ShenshouState||(ShenshouState={}));var ShenshouModel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.findCanWearEquips=function(t,e){var i=UserBag.ins().getBagGoodsByType(ItemType.TYPE_23),s=[],n=0,o=ShenshouSys.ins().dataList[t];o&&o.equipIDs[e]&&(n=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[o.equipIDs[e]].attrs));for(var a=0,r=i;a<r.length;a++){var h=r[a],l=this.getEquipQuality(h.configID);UserBag.getAttrPower(GlobalConfig.ShenShouEquip[h.configID].attrs);if(ItemConfig.getSubType(h.itemConfig)==e-1&&GlobalConfig.ShenShouBase[t].minLevel[e-1]<=l){var c=new ShenshouEquipData;c.id=h.configID,c.pos=e,c.shenshuId=t;var u=GlobalConfig.ShenShouEquip[h.configID];c.sortIndex=UserBag.getAttrPower(u.attrs),c.best=c.sortIndex>n,s.push(c)}}return s.sort(this.compareFun),s},e.prototype.checkEquipScore=function(t,e){var i=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[t].attrs),s=UserBag.getAttrPower(GlobalConfig.ShenShouEquip[e].attrs);return i>=s},e.prototype.compareFun=function(t,e){return t.sortIndex>e.sortIndex?-1:t.sortIndex<e.sortIndex?1:0},e.prototype.calcEquipScore=function(t){var e=this.getDataById(t),i=0;if(e)for(var s=1;s<=e.equipIDs.length;s++){var n=GlobalConfig.ShenShouEquip[e.equipIDs[s]];n&&(i+=UserBag.getAttrPower(n.attrs),n.expower&&(i+=n.expower))}return i},e.prototype.getDataById=function(t){var e=ShenshouSys.ins().dataList[t];return e},e.prototype.getAttrValue=function(t,e){var i=this.getDataById(t);if(i){var s=0;for(var n in i.equipIDs)if(n){var o=GlobalConfig.ShenShouEquip[i.equipIDs[n]];if(o)for(var a=0,r=o.attrs;a<r.length;a++){var h=r[a];e==h.type&&(s+=h.value)}}return s}return 0},e.prototype.getCurStatus=function(t){var e=this.getDataById(t);return e?e.state:ShenshouState.State_No},e.prototype.getCurBattle=function(){var t=0;for(var e in ShenshouSys.ins().dataList)ShenshouSys.ins().dataList[e].state==ShenshouState.State_Has&&t++;return t},e.prototype.getCountBattle=function(){return GlobalConfig.ShenShouConfig.minCount+ShenshouSys.ins().maxLimit},e.prototype.isCanBattle=function(){return this.getCurBattle()<this.getCountBattle()},e.prototype.getNowAttr=function(t){for(var e=[],i=0;i<t.attrs.length;i++){var s=new AttributeData(t.attrs[i].type,t.attrs[i].value-t.starattrs[i].value);e.push(s)}return e},e.prototype.getEquipLv=function(t){return parseInt((t+"").slice(4,7))},e.prototype.getEquipQuality=function(t){return parseInt((t+"").slice(2,4))},e.prototype.getEquipBaseId=function(t){return 1e3*(t/1e3>>0)+1},e.prototype.checkOpen=function(){return UserZs.ins().lv>=GlobalConfig.ShenShouConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.ShenShouConfig.openserverday},e}(BaseClass);ShenshouModel.EQUIPE_QUALITY_CN=["平凡","精良","史诗","传奇","神话"],__reflect(ShenshouModel.prototype,"ShenshouModel");var ShenshouRedpoint=function(t){function e(){var e=t.call(this)||this;return e.redpointEquips1=[],e.redpointEquips2=[],e.redpoints=[],e.redpoint=!1,e.associated(e.postRedPoint,e.postRedPoint1,e.postRedPoint2,ShenshouSys.ins().postBattleState),e.associated(e.postRedPoint1,ShenshouSys.ins().postInfo,UserBag.ins().postItemAdd,UserBag.ins().postItemDel,UserBag.ins().postItemCountChange),e.associated(e.postRedPoint2,ShenshouSys.ins().postInfo,ShenshouSys.ins().postUpdateExp,ShenshouSys.ins().postWearEquip),e}return __extends(e,t),e.prototype.postRedPoint=function(){if(!ShenshouModel.ins().checkOpen())return this.redpoint=!1,0;this.redpoints=[];for(var t in GlobalConfig.ShenShouBase)if(this.redpoints[t]=this.redpointEquips1[t]&&this.redpointEquips1[t].indexOf(1)>-1,!this.redpoints[t]&&this.redpointEquips2[t]&&(this.redpoints[t]=this.redpointEquips2[t].indexOf(1)>-1),!this.redpoints[t]){var e=ShenshouModel.ins().getDataById(parseInt(t));this.redpoints[t]=e&&e.state==ShenshouState.State_Can&&ShenshouModel.ins().isCanBattle()}return this.redpoint=this.redpoints.indexOf(!0)>-1,this.redpoint?1:0},e.prototype.postRedPoint1=function(){if(!ShenshouModel.ins().checkOpen())return void(this.redpointEquips1=[]);for(var t in GlobalConfig.ShenShouBase){var e=ShenshouSys.ins().dataList[t];this.redpointEquips1[t]=[];for(var i=1;i<=GlobalConfig.ShenShouConfig.posCount;i++){var s=ShenshouModel.ins().findCanWearEquips(+t,i);s.length>0?(this.redpointEquips1[t][i]=1,e&&e.equipIDs[i]&&ShenshouModel.ins().checkEquipScore(e.equipIDs[i],s[0].id)&&(this.redpointEquips1[t][i]=0)):this.redpointEquips1[t][i]=0}}},e.prototype.postRedPoint2=function(){if(!ShenshouModel.ins().checkOpen())return void(this.redpointEquips2=[]);for(var t in ShenshouSys.ins().dataList){var e=ShenshouSys.ins().dataList[t];this.redpointEquips2[t]=[];for(var i=1;5>=i;i++)e.equipIDs[i]&&this.getForgeRedpoint(e.equipIDs[i],ShenshouSys.ins().exp)&&e.state!=ShenshouState.State_No?this.redpointEquips2[t][i]=1:this.redpointEquips2[t][i]=0}},e.prototype.getForgeRedpoint=function(t,e){return GlobalConfig.ShenShouEquip[t+1]&&e>=GlobalConfig.ShenShouEquip[t].exp},e}(BaseSystem);__reflect(ShenshouRedpoint.prototype,"ShenshouRedpoint");var GameSystem;!function(t){t.shenshouRedpoint=ShenshouRedpoint.ins.bind(ShenshouRedpoint)}(GameSystem||(GameSystem={}));var ShenshouSys=function(t){function e(){var e=t.call(this)||this;return e.maxLimit=0,e.dataList={},e.exp=0,e.sysId=PackageID.Shenshou,e.regNetMsg(1,e.postInfo),e.regNetMsg(2,e.postWearEquip),e.regNetMsg(4,e.postBattleState),e.regNetMsg(5,e.postBattleMaxLimit),e.regNetMsg(6,e.postUpdateExp),e.regNetMsg(7,e.postUpEquip),e.regNetMsg(8,e.postDepartEquip),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var s=new ShenshouData(t);this.dataList[s.id]=s}this.maxLimit=t.readByte(),this.exp=t.readInt()},e.prototype.postWearEquip=function(t){var e=t.readByte(),i=t.readByte(),s=t.readInt();if(this.dataList[e])this.dataList[e].equipIDs[i]=s;else{var n=new ShenshouData;n.equipIDs[i]=s,n.id=e,this.dataList[e]=n}this.dataList[e].checkState(),ViewManager.ins().close(ShenshouWearEquipWin)},e.prototype.postBattleState=function(t){this.dataList[t.readByte()].state=t.readByte()},e.prototype.postBattleMaxLimit=function(t){this.maxLimit=t.readByte(),ViewManager.ins().close(ShenshouDanUseWin)},e.prototype.postUpdateExp=function(t){var e=this.exp;this.exp=t.readInt(),this.exp-e>0&&UserTips.ins().showTips("|C:0xffd93f&T:兽神精魄  +"+(this.exp-e)+"|")},e.prototype.postUpEquip=function(t){var e=t.readByte(),i=t.readByte(),s=t.readInt();return this.dataList[e].equipIDs[i]=s,s},e.prototype.postDepartEquip=function(t){},e.prototype.sendWearEquip=function(t,e,i){var s=this.getBytes(2);s.writeByte(t),s.writeByte(e),s.writeInt(i),this.sendToServer(s)},e.prototype.sendComposeEquip=function(t){for(var e=this.getBytes(3),i=t.length;--i>0;)e.writeInt(t[i]);this.sendToServer(e)},e.prototype.sendBattle=function(t){var e=this.getBytes(4);e.writeByte(t),this.sendToServer(e)},e.prototype.sendUpLimitMax=function(){this.sendBaseProto(5)},e.prototype.sendUpEquip=function(t,e){var i=this.getBytes(7);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendDepartEquip=function(t){var e=this.getBytes(8),i=t.length;e.writeByte(i);for(var s=0;i>s;s++)e.writeInt(t[s]);this.sendToServer(e)},e}(BaseSystem);__reflect(ShenshouSys.prototype,"ShenshouSys");var GameSystem;!function(t){t.shenshouSys=ShenshouSys.ins.bind(ShenshouSys)}(GameSystem||(GameSystem={}));var ShenshouDanUseWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SsItemUseTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.useBtn,this.onTouch),this.addTouchEvent(this.cancelBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch);var i=t[0];this.itemIcon.data=i.id,this.ownCount.text="(当前拥有"+UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem)+"个）",this.itemIcon.hideName()},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.cancelBtn:ViewManager.ins().close(this);break;case this.useBtn:ShenshouSys.ins().sendUpLimitMax()}},e}(BaseEuiView);__reflect(ShenshouDanUseWin.prototype,"ShenshouDanUseWin"),ViewManager.ins().reg(ShenshouDanUseWin,LayerManager.UI_Popup);var SoundBg=function(t){function e(){var e=t.call(this)||this;return e._currBg="",e}return __extends(e,t),e.prototype.stop=function(){this._currSoundChannel&&this.removeSoundChannel(this._currSoundChannel),this._currSoundChannel=null,this._currSound=null,this._currBg=""},e.prototype.play=function(t){if(this._currBg!=t){this.stop(),this._currBg=t;var e=this.getSound(t);e&&this.playSound(e)}},e.prototype.touchPlay=function(){if(this._currSoundChannel&&this._currSound){var t=this._currSoundChannel.position;this.removeSoundChannel(this._currSoundChannel),this._currSoundChannel=this._currSound.play(t,1),this.addSoundChannel(this._currSoundChannel)}},e.prototype.playSound=function(t){this._currSound=t,this._currSoundChannel=this._currSound.play(0,1),this.addSoundChannel(this._currSoundChannel)},e.prototype.onSoundComplete=function(){this._currSoundChannel&&this.removeSoundChannel(this._currSoundChannel),this.playSound(this._currSound)},e.prototype.addSoundChannel=function(t){t.volume=this._volume,t.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)},e.prototype.removeSoundChannel=function(t){t.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),t.stop()},e.prototype.setVolume=function(t){this._volume=t,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},e.prototype.loadedPlay=function(t){if(this._currBg==t){var e=RES.getRes(t);if(!e)return;this.playSound(e)}},e.prototype.checkCanClear=function(t){return this._currBg!=t},e}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var ShenshouEquipItem1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.playDepartMc=function(){this.mc||(this.mc=new MovieClip),this.mc.x=43,this.mc.y=44,this.mc.scaleX=1.5,this.mc.scaleY=1.5,this.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"litboom",1)},e.prototype.dataChanged=function(){if(!isNaN(this.data)&&this.data){this.itemConfig=GlobalConfig.ItemConfig[this.data],this.nameTxt.text="",this.imgBg.source="quality"+ItemConfig.getQuality(this.itemConfig),this.imgIcon.source=this.itemConfig.icon+"_png";var t=ShenshouModel.ins().getEquipLv(this.itemConfig.id)-1;this.equipLv.text=t>0?"+"+t:""}},e}(ShenshouEquipItem);__reflect(ShenshouEquipItem1.prototype,"ShenshouEquipItem1");var ShenshouEquipTip=function(t){function e(){var e=t.call(this)||this;return e.posType=["血瞳","魔躯","妖尾","圣角","鬼爪"],e.skinName="shenshouEquipTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.changeBtn,this.onTouch),this.addTouchEvent(this.takeoffBtn,this.onTouch),this.addTouchEvent(this.forgeBtn,this.onTouch),this.shenshouId=t[0],this.pos=t[1],this.shenshouId){this.refRedpoint();var i=ShenshouModel.ins().getDataById(this.shenshouId);i.state==ShenshouState.State_No&&(this.forgeBtn.visible=!1)}else this.changeBtn.visible=!1,this.forgeBtn.visible=!1,this.takeoffBtn.visible=!1,this.changeRedPoint.visible=!1,this.forgeRedPoint.visible=!1,this.anigroup.height=505;this.itemDp=GlobalConfig.ItemConfig[t[2]],this.initUi()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.initUi=function(){var t=ItemConfig.getQuality(this.itemDp);this.quali.source=t?"quali"+t:"",this.equipIcon.data=this.itemDp.id,this.equipIcon.hideName(),this.nameTxt.text=this.itemDp.name,this.nameTxt.textColor=ItemConfig.getQualityColor(this.itemDp),this.type.text=this.posType[ItemConfig.getSubType(this.itemDp)],this.lv.text=ShenshouModel.ins().getEquipLv(this.itemDp.id)+"级",this.career.text="兽神";
var e=GlobalConfig.ShenShouEquip[this.itemDp.id],i=UserBag.getAttrPower(e.attrs);e.expower&&(i+=e.expower),this.powerPanel.setPower(i*SubRoles.ins().subRolesLen);for(var s=GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(this.itemDp.id)],n=ShenshouModel.ins().getNowAttr(s),o=0;3>o;o++)if(n[o]){this["attr"+(o+1)].visible=!0,this["attr"+(o+1)].text=AttributeData.getAttStrByType(n[o],0,":");var a=e.attrs[o].value-s.attrs[o].value;this["forgeAttr"+(o+1)].visible=s&&s.id!=e.id&&a>0,s&&s.id!=e.id&&a>0&&(this["forgeAttr"+(o+1)].text="+"+a)}else this["attr"+(o+1)].visible=!1,this["forgeAttr"+(o+1)].visible=!1;for(var o=0;3>o;o++)e.starattrs[o]?(this["starAttr"+(o+1)].visible=!0,this["starAttr"+(o+1)].text=AttributeData.getAttStrByType(e.starattrs[o],0,":")):this["starAttr"+(o+1)].visible=!1},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:break;case this.changeBtn:ViewManager.ins().open(ShenshouWearEquipWin,this.shenshouId,this.pos,this.itemDp.id);break;case this.takeoffBtn:if(ShenshouModel.ins().getDataById(this.shenshouId).state==ShenshouState.State_Has)return void UserTips.ins().showCenterTips("请先取消出战");ShenshouSys.ins().sendWearEquip(this.shenshouId,this.pos,0);break;case this.forgeBtn:ViewManager.ins().open(ShenshouForgeWin,this.shenshouId,this.pos,this.itemDp)}ViewManager.ins().close(this)},e.prototype.refRedpoint=function(){this.changeRedPoint.visible=ShenshouRedpoint.ins().redpointEquips1[this.shenshouId]&&ShenshouRedpoint.ins().redpointEquips1[this.shenshouId][this.pos],this.forgeRedPoint.visible=ShenshouRedpoint.ins().redpointEquips2[this.shenshouId]&&ShenshouRedpoint.ins().redpointEquips2[this.shenshouId][this.pos]},e}(BaseEuiView);__reflect(ShenshouEquipTip.prototype,"ShenshouEquipTip"),ViewManager.ins().reg(ShenshouEquipTip,LayerManager.UI_Popup);var ShenshouForgeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SsEquipForgeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=ShenshouEquipItem1,this.listDt=new eui.ArrayCollection,this.list.dataProvider=this.listDt,this.nowList=[],this.exp.value=0,this.exp.labelFunction=function(t,e){return ShenshouSys.ins().exp+"/"+e}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.shenshouId=t[0],this.pos=t[1],this.curItemDp=t[2],this.filterList=[],this.addTouchEvent(this.departBtn,this.onTouch),this.addTouchEvent(this.lvUpBtn,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.list,this.onList),this.observe(ShenshouSys.ins().postUpEquip,this.onUpEquip),this.observe(ShenshouSys.ins().postUpdateExp,this.refUIData),this.observe(ShenshouSys.ins().postDepartEquip,this.onDecompose),this.observe(ShenshouRedpoint.ins().postRedPoint2,this.refRedpoint),this.refRedpoint(),this.refUIData(),this.refList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.forgetMC)},e.prototype.onUpExp=function(){this.exp.value=ShenshouSys.ins().exp,this.exp.maximum=GlobalConfig.ShenShouEquip[this.curItemDp.id].exp,this.exp.value=ShenshouSys.ins().exp,this.exp.labelDisplay.text=ShenshouSys.ins().exp+"/"+this.exp.maximum},e.prototype.onUpEquip=function(t){this.curItemDp=GlobalConfig.ItemConfig[t],this.refUIData(),this.forgetMC||(this.forgetMC=new MovieClip,this.forgetMC.x=62,this.forgetMC.y=62),this.forgetMC.playFile(RES_DIR_EFF+"forgeSuccess",1),this.iconGroup.addChild(this.forgetMC)},e.prototype.refUIData=function(){var t=GlobalConfig.ShenShouEquip[this.curItemDp.id];this.curScore=UserBag.getAttrPower(t.attrs),t.expower&&(this.curScore+=t.expower),this.powerPanel.setPower(this.curScore*SubRoles.ins().subRolesLen),this.equipName.text=this.curItemDp.name,this.equipName.textColor=ItemConfig.getQualityColor(this.curItemDp),this.itemIcon.data=this.curItemDp.id,this.itemIcon.hideName();var e=ShenshouModel.ins().getEquipLv(this.curItemDp.id);this.attrPanel.lvNow.text="Lv."+e,this.attrPanel.lvNext.text="Lv."+(e+1),this.maxExpImg.visible=!1,this.maxExpTxt.visible=!1;var i=GlobalConfig.ShenShouEquip[this.curItemDp.id+1];i||(this.lvUpBtn.enabled=!1,this.attrPanel.currentState="max",this.exp.visible=!1,this.maxExpImg.visible=!0,this.maxExpTxt.visible=!0);for(var s=0;3>s;s++)t.attrs[s]?(this.attrPanel["attr"+(s+1)+"Now"].visible=!0,this.attrPanel["attr"+(s+1)+"Next"].visible=i&&i.attrs[s],this.attrPanel["attr"+(s+1)+"Now"].text=AttributeData.getAttStrByType(t.attrs[s],0,":"),i&&i.attrs[s]&&(this.attrPanel["attr"+(s+1)+"Next"].text=AttributeData.getAttStrByType(i.attrs[s],0,":"))):(this.attrPanel["attr"+(s+1)+"Next"].visible=!1,this.attrPanel["attr"+(s+1)+"Now"].visible=!1);this.onUpExp()},e.prototype.onDecompose=function(){for(var t=this.list.numChildren,e=0;t>e;e++){var i=this.list.getChildAt(e);i&&i.playDepartMc()}TimerManager.ins().doTimer(500,1,this.refList,this)},e.prototype.refList=function(){var t=UserBag.ins().getBagGoodsByType(ItemType.TYPE_23);this.nowList=[];for(var e=13;--e>=0;)if(t[e])if(t[e].count>1)for(var i=0;i<t[e].count;i++)this.filterList.indexOf(t[e].configID)>-1||!this.checkCurEquip(t[e].configID)||this.nowList.push(t[e].configID);else{if(this.filterList.indexOf(t[e].configID)>-1||!this.checkCurEquip(t[e].configID))continue;this.nowList.push(t[e].configID)}this.listDt.replaceAll(this.nowList)},e.prototype.checkCurEquip=function(t){var e=GlobalConfig.ShenShouEquip[t],i=e?UserBag.getAttrPower(e.attrs):0;return this.curScore>=i},e.prototype.onList=function(t){t.target instanceof ShenshouEquipItem1&&-1==this.filterList.indexOf(t.target.data)&&this.filterList.push(t.target.data),this.refList()},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.lvUpBtn:if(ShenshouSys.ins().exp<this.exp.maximum)return void UserTips.ins().showCenterTips("当前兽神精魄不足，无法升级！");ShenshouSys.ins().sendUpEquip(this.shenshouId,this.pos);break;case this.departBtn:if(!this.nowList.length)return void UserTips.ins().showCenterTips("当前没有可分解的装备");ShenshouSys.ins().sendDepartEquip(this.nowList)}},e.prototype.refRedpoint=function(){this.rightRed.visible=ShenshouRedpoint.ins().redpointEquips2[this.shenshouId][this.pos]},e}(BaseEuiView);__decorate([callLater],ShenshouForgeWin.prototype,"onUpExp",null),__decorate([callLater],ShenshouForgeWin.prototype,"refRedpoint",null),__reflect(ShenshouForgeWin.prototype,"ShenshouForgeWin"),ViewManager.ins().reg(ShenshouForgeWin,LayerManager.UI_Popup);var ShenshouInfoPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setID=function(t){this.curId=t,this.currentState=""+t},e.prototype.close=function(){this.stopBeatAnimat()},e.prototype.refEquipData=function(){for(var t=0;t<GlobalConfig.ShenShouConfig.posCount;t++){var e=t+1;this["item"+t].name=e;var i=ShenshouModel.ins().getDataById(this.curId);i&&i.equipIDs[e]?this["item"+t].data=i.equipIDs[e]:this["item"+t].setPosData(this.curId,e)}},e.prototype.refState=function(t){var e=this,i="";switch(this.stopBeatAnimat(),this.shenshouImg.source=i,t){case ShenshouState.State_No:i="ss_"+this.curId+"b_png";break;case ShenshouState.State_Can:i="ss_"+this.curId+"b_png";break;case ShenshouState.State_Has:this.startBeatAnimat(),i="ss_"+this.curId+"a_png"}egret.callLater(function(){e.shenshouImg.source=i},this)},e.prototype.startBeatAnimat=function(){this.imgCopy||(this.imgCopy=new eui.Image),this.imgCopy.touchEnabled=!1,this.imgCopy.source="ss_"+this.curId+"a_png",this.imgCopy.visible=!1,this.addChild(this.imgCopy),TimerManager.ins().doTimer(4e3,0,this.runTween,this),TimerManager.ins().doTimer(500,1,this.runTween,this)},e.prototype.runTween=function(){this.imgCopy.visible=!0,this.imgCopy.alpha=0,this.imgCopy.scaleX=this.imgCopy.scaleY=1,this.imgCopy.x=this.shenshouImg.x+(this.shenshouImg.width>>1),this.imgCopy.y=this.shenshouImg.y+(this.shenshouImg.height>>1),this.imgCopy.anchorOffsetX=this.shenshouImg.width>>1,this.imgCopy.anchorOffsetY=this.shenshouImg.height>>1,this.imgCopy.top=this.shenshouImg.top,this.imgCopy.horizontalCenter=this.shenshouImg.horizontalCenter,Tween.get(this.imgCopy).to({alpha:1},250).to({alpha:0,scaleX:1.2,scaleY:1.2},2e3,egret.Ease.cubicInOut)},e.prototype.stopBeatAnimat=function(){TimerManager.ins().remove(this.runTween,this),this.imgCopy&&(Tween.removeTweens(this.imgCopy),this.imgCopy.visible=!1)},e}(BaseView);__reflect(ShenshouInfoPanel.prototype,"ShenshouInfoPanel");var ShenshouSkillTip=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenshouSkillTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch);var i=t[0];this.quali.source=i.quality?"quali"+i.quality:"",this.equipIcon.skillQuality.source="quality"+i.quality,this.equipIcon.skillImg.source=i.icon,this.equipIcon.skillName.text="",this.nameTxt.text=i.name,this.targetTxt.text=1==i.target?"所有出战神兽生效":"仅本体出战神兽生效",this.targetTxt0.textFlow=TextFlowMaker.generateTextFlow1(i.desc)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShenshouSkillTip.prototype,"ShenshouSkillTip"),ViewManager.ins().reg(ShenshouSkillTip,LayerManager.UI_Tips);var ShenshouTab=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.id){var t=ShenshouModel.ins().getDataById(this.data.id);this.redPoint.visible=ShenshouRedpoint.ins().redpoints[this.data.id],this.activityImg.visible=t&&t.state==ShenshouState.State_Has,t&&t.state!=ShenshouState.State_No?this.btnName.source=GlobalConfig.ShenShouBase[this.data.id].activeImg:this.btnName.source=GlobalConfig.ShenShouBase[this.data.id].iconImg}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.select.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(ShenshouTab.prototype,"ShenshouTab");var ShenshouWearEquipItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.dataChanged=function(){if(this.data instanceof ShenshouEquipData){this.itemIcon.data=this.data.id;var t=GlobalConfig.ItemConfig[this.data.id];this.quality.text=ShenshouModel.EQUIPE_QUALITY_CN[ItemConfig.getQuality(t)],this.quality.textColor=ItemConfig.getQualityColor(t),this.now.visible=!1,this.best.visible=!1,this.changeBtn.visible=!0,this.data.sortIndex==Number.MAX_VALUE&&(this.now.visible=!0,this.changeBtn.visible=!1),this.data.best&&(this.best.visible=!0);for(var e=GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(this.data.id)],i=GlobalConfig.ShenShouEquip[this.data.id],s=ShenshouModel.ins().getDataById(this.data.shenshuId),n=s?GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(s.equipIDs[this.data.pos])]:null,o=0;3>o;o++)i.attrs[o]?(this["attr"+o].visible=!0,this["attr"+o].text=AttributeData.getAttStrByType(e.attrs[o],0,":"),this["betterArrow"+o].visible=!n||n&&e.attrs[o].value>n.attrs[o].value,i.attrs[o].value>e.attrs[o].value?(this["forgeAttr"+o].visible=!0,this["forgeAttr"+o].text="+"+(i.attrs[o].value-e.attrs[o].value)):this["forgeAttr"+o].visible=!1):(this["attr"+o].visible=!1,this["betterArrow"+o].visible=!1,this["forgeAttr"+o].visible=!1);var a=UserBag.getAttrPower(i.attrs);i.expower&&(a+=i.expower),this.power.text="评分："+3*a}},e}(BaseItemRender);__reflect(ShenshouWearEquipItem.prototype,"ShenshouWearEquipItem");var ShenshouWearEquipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SsEquipChooseSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.list,this.onTouch),this.list.itemRenderer=ShenshouWearEquipItem,this.listDt=new eui.ArrayCollection,this.list.dataProvider=this.listDt,this.shenshouId=t[0],this.pos=t[1];var i=ShenshouModel.ins().findCanWearEquips(this.shenshouId,this.pos);if(i.length>0){if(t[2]){var s=new ShenshouEquipData;s.pos=this.pos,s.shenshuId=this.shenshouId,s.sortIndex=Number.MAX_VALUE,s.id=t[2],i.splice(0,0,s)}this.listDt.replaceAll(i),this.tipLabel2.visible=!1}else this.tipLabel2.visible=!0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button&&t.target.parent instanceof ShenshouWearEquipItem){var e=t.target.parent.data;ShenshouSys.ins().sendWearEquip(this.shenshouId,this.pos,e.id)}}},e}(BaseEuiView);__reflect(ShenshouWearEquipWin.prototype,"ShenshouWearEquipWin"),ViewManager.ins().reg(ShenshouWearEquipWin,LayerManager.UI_Popup);var ShenshouWin=function(t){function e(){var e=t.call(this)||this;return e.curId=1,e.MAX_SKILL=4,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.listMenu.itemRenderer=ShenshouTab,this.listMenuDt=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.ShenShouBase)),this.listMenu.dataProvider=this.listMenuDt},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.rightBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.activityBtn,this.onTouch),this.addTouchEvent(this.shenshouItem,this.onTouch),this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.listMenu,this.onTouchMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange);for(var i=1;i<=this.MAX_SKILL;i++)this.addTouchEvent(this["skill"+i],this.onTouch);this.observe(ShenshouRedpoint.ins().postRedPoint,this.refRedPoint),this.observe(ShenshouSys.ins().postWearEquip,this.refEquipData),this.observe(ShenshouSys.ins().postUpEquip,this.refEquipData),this.observe(ShenshouSys.ins().postInfo,this.refData),this.observe(ShenshouSys.ins().postBattleState,this.refData),this.listMenu.selectedIndex=0,this.showUI(this.curId),this.onChange(),this.refRedPoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.shenshouItem.close()},e.prototype.onTouchMenu=function(t){this.curId=t.item.id,this.showUI(this.curId)},e.prototype.onChange=function(){this.listMenu.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.listMenu.scrollH>88*(this.listMenu.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.listMenu.dataProvider.length<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.refArrowRedpoint()},e.prototype.showUI=function(t){for(var e=ShenshouModel.ins(),i=(ShenshouSys.ins(),e.getDataById(t),GlobalConfig.ShenShouBase[t]),s=0;s<this.MAX_SKILL;s++)if(i.skill&&i.skill[s]){this["skill"+(s+1)].visible=!0,this["skill"+(s+1)].touchChildren=!1;var n=GlobalConfig.ShenShouSkill[i.skill[s]];this["skill"+(s+1)].name=i.skill[s],this["skill"+(s+1)].skillImg.source=n.icon,this["skill"+(s+1)].skillName.text=n.name,this["skill"+(s+1)].skillQuality.source="quality"+n.quality}else this["skill"+(s+1)].visible=!1;this.shenshouItem.setID(t),this.refEquipData()},e.prototype.refEquipData=function(){var t=ShenshouModel.ins();this.shenshouItem.refEquipData(),this.attr1.text="+"+t.getAttrValue(this.curId,AttributeType.atAttack),this.attr2.text="+"+t.getAttrValue(this.curId,AttributeType.atMaxHp),this.attr3.text="+"+t.getAttrValue(this.curId,AttributeType.atDef),this.attr4.text="+"+t.getAttrValue(this.curId,AttributeType.atRes),this.powerPanel.setPower(ShenshouModel.ins().calcEquipScore(this.curId)*SubRoles.ins().subRolesLen),this.refEquipRedpoint(),this.refData()},e.prototype.refData=function(){var t=ShenshouModel.ins();ShenshouSys.ins();this.fightCount.text="当前出战："+t.getCurBattle()+"/"+t.getCountBattle();var e=t.getCurStatus(this.curId);switch(this.shenshouItem.refState(e),e){case ShenshouState.State_No:this.activityBtn.enabled=!1,this.activityBtn.label="出战";break;case ShenshouState.State_Can:this.activityBtn.enabled=!0,this.activityBtn.label="出战";break;case ShenshouState.State_Has:this.activityBtn.enabled=!0,this.activityBtn.label="取消出战"}this.listMenuDt.replaceAll(CommonUtils.objectToArray(GlobalConfig.ShenShouBase))},e.prototype.refArrowRedpoint=function(){if(this.rightRed.visible=!1,this.leftRed.visible=!1,this.leftBtn.visible){var t=ShenshouRedpoint.ins().redpoints.slice(0,4);this.leftRed.visible=t.indexOf(!0)>-1}if(this.rightBtn.visible){var t=ShenshouRedpoint.ins().redpoints.slice(5,9);this.rightRed.visible=t.indexOf(!0)>-1}},e.prototype.refRedPoint=function(){this.refArrowRedpoint(),this.listMenuDt.replaceAll(CommonUtils.objectToArray(GlobalConfig.ShenShouBase)),this.refEquipRedpoint()},e.prototype.refEquipRedpoint=function(){for(var t=0;t<GlobalConfig.ShenShouConfig.posCount;t++)ShenshouRedpoint.ins().redpointEquips1[this.curId]&&ShenshouRedpoint.ins().redpointEquips1[this.curId][t+1]||ShenshouRedpoint.ins().redpointEquips2[this.curId]&&ShenshouRedpoint.ins().redpointEquips2[this.curId][t+1]?this.shenshouItem["item"+t].redPoint.visible=!0:this.shenshouItem["item"+t].redPoint.visible=!1},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.rightBtn:i=this.listMenu.scrollH+e,i=92*Math.round(i/92),i>this.listMenu.contentWidth-this.listScroller.width&&(i=this.listMenu.contentWidth-this.listScroller.width),this.listMenu.scrollH=i,this.onChange();break;case this.leftBtn:i=this.listMenu.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.listMenu.scrollH=i,this.onChange();break;case this.activityBtn:if(ShenshouModel.ins().getCurStatus(this.curId)==ShenshouState.State_Can){var s=ShenshouModel.ins().getCurBattle();if(s<GlobalConfig.ShenShouConfig.maxCount&&UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem)&&s>=ShenshouModel.ins().getCountBattle())return void ViewManager.ins().open(ShenshouDanUseWin,GlobalConfig.ItemConfig[GlobalConfig.ShenShouConfig.battleCountItem]);if(s>=ShenshouModel.ins().getCountBattle())return void UserTips.ins().showCenterTips("兽神的出战总量已经达到上限")}ShenshouSys.ins().sendBattle(this.curId);break;default:if("shenshouEquipItem"==t.target.skinName){var n=parseInt(t.target.name);t.target.data?ViewManager.ins().open(ShenshouEquipTip,this.curId,n,t.target.data):ViewManager.ins().open(ShenshouWearEquipWin,this.curId,n)}else("shenshouSkillItem"==t.target.parent.skinName||"shenshouSkillItem"==t.target.skinName)&&ViewManager.ins().open(ShenshouSkillTip,GlobalConfig.ShenShouSkill[t.target.name])}},e}(BaseView);__decorate([callLater],ShenshouWin.prototype,"refEquipData",null),__reflect(ShenshouWin.prototype,"ShenshouWin");var FeatsStoreData=function(){function t(t,e){this.exchangeCount=[];for(var i,s,n=0;t>n;n++)i=e.readInt(),s=e.readInt(),this.exchangeCount[i]=s}return t.prototype.checkHonorBuy=function(t){var e=GlobalConfig.FeatsStore[t];if(Actor.chip<e.costMoney.count)return!1;switch(e.buyType){case FEATS_TYPE.day:if(this.exchangeCount[e.index-1]>=e.daycount)return!0;break;case FEATS_TYPE.infinite:return!0;case FEATS_TYPE.forever:if(this.exchangeCount[e.index-1]>=e.daycount)return!0}return!1},t.prototype.checkHonorRedPoint=function(){for(var t in GlobalConfig.FeatsStore){var e=this.checkHonorBuy(GlobalConfig.FeatsStore[t].goods[0].id);if(e)return!0}return!1},t}();__reflect(FeatsStoreData.prototype,"FeatsStoreData");var FEATS_TYPE;!function(t){t[t.day=1]="day",t[t.infinite=2]="infinite",t[t.forever=3]="forever"}(FEATS_TYPE||(FEATS_TYPE={}));var FEATS_SHOP_TYPE;!function(t){t[t.Money=1]="Money",t[t.Item=2]="Item"}(FEATS_SHOP_TYPE||(FEATS_SHOP_TYPE={}));var SoundEffects=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.play=function(t){var e=this.getSound(t);e&&this.playSound(e)},e.prototype.playSound=function(t){var e=t.play(0,1);e.volume=this._volume},e.prototype.setVolume=function(t){this._volume=t},e.prototype.loadedPlay=function(t){var e=RES.getRes(t);e&&this.playSound(e)},e}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var BlackMarketItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.goodsID=0,e.skinName="BlackMarketItem",e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,i=t.item,s=GlobalConfig.ItemConfig[i.configID];this.goodsID=t.id;var n="";if(n=2==t.costType?t.costNum+"":t.costNum>1e5?Math.floor(t.costNum/1e4)+"万":t.costNum+"",this.money.text=n,this.itemName.text=s.name,this.itemName.textColor=ItemConfig.getQualityColor(s),s.zsLevel&&s.zsLevel>0?this.level.text="("+s.zsLevel+"转)":s.level&&s.level>0?this.level.text="(Lv."+s.level+")":this.level.text="",this.level.x=this.itemName.x+this.itemName.width,this.num.text=1==i.count?"":i.count+"",this.moneyIcon.source=e.moneyTypeToIcon[t.costType],this.itemIcon.setData(s),0!=ItemConfig.getJob(s)){var o=UserBag.ins().calculationScore(t.item);o>0?(this.arrowIcon.visible=!0,this.CEKey.visible=!0,this.CEValue.visible=!0,this.CEValue.text=o+""):(this.arrowIcon.visible=!1,this.CEKey.visible=!1,this.CEValue.visible=!1)}else this.arrowIcon.visible=!1,this.CEKey.visible=!1,this.CEValue.visible=!1;var a=ShopEquipData.discountDic[t.discountType];if(a)this.discount.source=a.res,this.wuzhe.visible=!1;else{var r=GlobalConfig.EquipItemConfig[this.goodsID];this.discount.source=r.discountImg,this.wuzhe.visible=!1}},e.prototype.showTip=function(){for(var t,e=Shop.ins().shopData,i=e.getShopEquipDataLength(),s=null,n=0;i>n;n++)if(s=e.getShopEquipDataByIndex(n),null!=s&&s.id==this.goodsID){t=s.item.configID;break}void 0==t&&new Error("竟然没有找到该商品ID");var o=GlobalConfig.ItemConfig[t],a=ItemConfig.getType(o);void 0!=a&&(0==a?ViewManager.ins().open(EquipDetailedWin,1,this.data.item.handle,o.id):ViewManager.ins().open(ItemDetailedWin,0,o.id,this.data.item.count))},e}(BaseItemRender);BlackMarketItemRenderer.moneyTypeToIcon=["占位","szjinbi","szyuanbao"],__reflect(BlackMarketItemRenderer.prototype,"BlackMarketItemRenderer");var BlackMarketPanel=function(t){function e(){var e=t.call(this)||this;return e.name="神秘商店",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.listView.itemRenderer=BlackMarketItemRenderer,this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.buyAllItemBtn,this.buyAllItem),this.addTouchEvent(this.refreshShopBtn,this.refreshShop),this.addTouchEvent(this.goodsOverView,this.onClick),this.observe(Shop.ins().postUpdateShopData,this.updateData),this.observe(Shop.ins().postBuyResult,this.buyResultCB),this.observe(ShopRedPoint.ins().postBlackMarketRedPoint,this.updateRedPoint),this.price.text=GlobalConfig.StoreCommonConfig.refreshYuanBao+"";var i=this.goodsOverView.text;this.goodsOverView.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+i),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buyAllItemBtn,this.buyAllItem),this.removeTouchEvent(this.refreshShopBtn,this.refreshShop),this.removeTouchEvent(this,this.onTap),this.removeTouchEvent(this.goodsOverView,this.onClick),this.removeObserve(),TimerManager.ins().removeAll(this)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.goodsOverView:ViewManager.ins().open(ShopBestTips)}},e.prototype.updateRedPoint=function(){this.redPoint.visible=ShopRedPoint.ins().blackMarketRedPoint},e.prototype.buyAllItem=function(t){for(var e=[],i=0,s=0,n=0,o=Shop.ins().shopData,a=o.getShopEquipDataLength(),r=null,h=0,l=0;a>l;l++)if(r=o.getShopEquipDataByIndex(l),null!=r){if(0==ItemConfig.getType(r.item.itemConfig)){if(h=UserBag.ins().calculationScore(r.item),!(h>0))continue;n+=1}e.push([r.id,1]),1==r.costType?i+=r.costNum:s+=r.costNum}if(UserBag.ins().getSurplusCount()<n){var c="背包已满，无法全部购买";return void UserTips.ins().showTips(c)}return Actor.gold<i?void UserWarn.ins().setBuyGoodsWarn(1):Actor.yb<s?void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"):0==i&&0==s?void UserTips.ins().showTips("|C:0xf3311e&T:没有物品可买！|"):void Shop.ins().sendBuy(2,e)},e.prototype.refreshShop=function(t){if(Shop.ins().shopData.times>GlobalConfig.StoreCommonConfig.refreshLimit)return void UserTips.ins().showTips("|C:0xf3311e&T:今日刷新次数已用完！|");if(Shop.ins().shopData.refushTime<=0)Shop.ins().sendRefreshShop();else{var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.StoreCommonConfig.refreshItem),i=e?e.count:0;if(i)Shop.ins().sendRefreshShop();else{if(Actor.yb<GlobalConfig.StoreCommonConfig.refreshYuanBao)return void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");Shop.ins().sendRefreshShop()}}},e.prototype.onTap=function(t){if("buy"==t.target.name){if(UserBag.ins().getSurplusCount()<=0){var e="背包已满，无法购买";return void UserTips.ins().showTips(e)}var i=t.target.parent.goodsID,s=Shop.ins().shopData.getShopEquipDataById(i);if(Assert(s,"神秘商店找不到物品："+i))return;if(1==s.costType){if(Actor.gold<s.costNum)return void UserWarn.ins().setBuyGoodsWarn(1)}else if(Actor.yb<s.costNum)return void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");var n=s.item,o=ItemConfig.getJob(n.itemConfig),a=ItemConfig.getType(n.itemConfig);if(0==a&&0!=o){var r=UserBag.ins().calculationScore(n);if(r>0){var h=[i,1];Shop.ins().sendBuy(2,[h])}else WarnWin.show("购买失败\n\n<font color='#f3311e'>该装备评分过低无法购买</font>",function(){},this,null,null,"sure")}else{var h=[i,1];Shop.ins().sendBuy(2,[h])}}},e.prototype.buyResultCB=function(t){1==t?UserTips.ins().showTips("购买成功"):UserTips.ins().showTips("|C:0xf3311e&T:购买失败|"),this.updateOthersUI()},e.prototype.updateOthersUI=function(){var t=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.StoreCommonConfig.refreshItem),e=t?t.count:0,i="";i=e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.keylabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+e+"</font> "),Shop.ins().shopData.refushTime<=0?this.refreshShopBtn.label="免费刷新":this.refreshShopBtn.label="刷   新"},e.prototype.updateData=function(){for(var t=[],e=Shop.ins().shopData,i=e.getShopEquipDataLength(),s=null,n=0;i>n;n++)s=e.getShopEquipDataByIndex(n),null!=s&&t.push(s);this.listView.dataProvider=new eui.ArrayCollection(t),TimerManager.ins().isExists(this.refushEndTime,this)||(TimerManager.ins().doTimer(1e3,Shop.ins().shopData.refushTime,this.refushEndTime,this),this.refushEndTime()),t.length<=0?this.noGoods.visible=!0:this.noGoods.visible=!1,this.point.text="我的积分："+Shop.ins().shopData.point,this.updateOthersUI(),this.updateRedPoint()},e.prototype.refushEndTime=function(){this.tip.text="下批商品刷新时间："+DateUtils.getFormatBySecond(Shop.ins().shopData.refushTime),this.tipsBg.visible=this.tip.visible=this.costGroup.visible=!0,Shop.ins().shopData.refushTime<=0&&(this.tipsBg.visible=this.tip.visible=this.costGroup.visible=!1)},e}(BaseComponent);__reflect(BlackMarketPanel.prototype,"BlackMarketPanel"),ViewManager.ins().reg(BlackMarketPanel,LayerManager.UI_Main);var BuySpecialWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BuySpecialSkin",this.num=3},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.add1Btn,this.onTap),this.addTouchEvent(this.add10Btn,this.onTap),this.addTouchEvent(this.sub1Btn,this.onTap),this.addTouchEvent(this.sub10Btn,this.onTap),this.addTouchEvent(this.buyBtn,this.buy),this.addTouchEvent(this.bgClose,this.onTap),this.addChangeEvent(this.numLabel,this.inputOver),this.num=3,this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.add1Btn,this.onTap),this.removeTouchEvent(this.add10Btn,this.onTap),this.removeTouchEvent(this.sub1Btn,this.onTap),this.removeTouchEvent(this.sub10Btn,this.onTap),this.removeTouchEvent(this.buyBtn,this.buy),this.removeTouchEvent(this.bgClose,this.onTap),this.numLabel.removeEventListener(egret.Event.CHANGE,this.inputOver,this)},e.prototype.updateView=function(){this.numLabel.text=this.num+"",this.unitPrice.text=""+GlobalConfig.GuardGodWeaponConf.sSummonCost[0],this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sub10Btn:this.num-=10;break;case this.sub1Btn:this.num-=1;break;case this.add10Btn:this.num+=10;break;case this.add1Btn:this.num+=1;break;case this.bgClose:ViewManager.ins().close(this)}this.num<0&&(this.num=0),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.inputOver()},e.prototype.closeCB=function(t){ViewManager.ins().close(BuyWin)},e.prototype.buy=function(t){Actor.yb>=parseInt(this.allPrice.text)?(UserFb.ins().sendShSweep(parseInt(this.numLabel.text)),ViewManager.ins().close(this)):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.inputOver=function(t){this.num=parseInt(this.numLabel.text),(isNaN(this.num)||this.num<0)&&(this.num=0),this.num>3&&(this.num=3),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""},e}(BaseEuiView);__reflect(BuySpecialWin.prototype,"BuySpecialWin"),ViewManager.ins().reg(BuySpecialWin,LayerManager.UI_Popup);var BuyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BuySkin",this.num=1,this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.add1Btn,this.onTap),this.addTouchEvent(this.add10Btn,this.onTap),this.addTouchEvent(this.sub1Btn,this.onTap),this.addTouchEvent(this.sub10Btn,this.onTap),this.addTouchEvent(this.buyBtn,this.buy),this.addTouchEvent(this.bgClose,this.onTap),this.addChangeEvent(this.numLabel,this.inputOver),this.num=1,this.shopID=t[0],this.shopType=t[1]?t[1]:0,this.yuanbao0.visible=this.yuanbao1.visible=!0,(2==this.shopType||3==this.shopType)&&(this.yuanbao0.visible=this.yuanbao1.visible=!1,this.num=this.getChipNumRule(),this.honor0.source=2==this.shopType?"ZSchip":"204076_png",this.honor1.source=2==this.shopType?"ZSchip":"204076_png"),this.honor0.visible=this.honor1.visible=!this.yuanbao0.visible,this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.add1Btn,this.onTap),this.removeTouchEvent(this.add10Btn,this.onTap),this.removeTouchEvent(this.sub1Btn,this.onTap),this.removeTouchEvent(this.sub10Btn,this.onTap),this.removeTouchEvent(this.buyBtn,this.buy),this.removeTouchEvent(this.bgClose,this.onTap),this.numLabel.removeEventListener(egret.Event.CHANGE,this.inputOver,this)},e.prototype.getChipNumRule=function(){var t=GlobalConfig.FeatsStore[this.shopID],e=0;if(t.shopType==FEATS_SHOP_TYPE.Money){if(Actor.chip<t.costMoney.count)return this.maxNum=1,this.maxNum;e=Math.floor(Actor.chip/t.costMoney.count)}else if(t.shopType==FEATS_SHOP_TYPE.Item){var i=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,t.costItem.id);if(i<t.costItem.count)return this.maxNum=1,this.maxNum;e=Math.floor(i/t.costItem.count)}var s=0;if(!Shop.ins().medalData)return 0;var n=Shop.ins().medalData.exchangeCount[this.shopID];switch(n=n?n:0,t.buyType){case FEATS_TYPE.day:s=t.daycount-n,s=s>0?s:1,s=s>e?e:s;break;case FEATS_TYPE.infinite:s=e;break;case FEATS_TYPE.forever:s=t.daycount-n,s=s>0?s:1,s=s>e?e:s}return this.maxNum=s,this.maxNum},e.prototype.updateView=function(){var t,e;return 2!=this.shopType&&3!=this.shopType?(t=GlobalConfig.ItemStoreConfig[this.shopID],e=GlobalConfig.ItemConfig[t.itemId],this.itemIcon.setData(e),t.vipLimit?(this.maxNum=t.vipLimit[UserVip.ins().lv]-Shop.ins().shopData.getHadBuyCount(t.itemId),this.itemName0.text="还可购买"+this.maxNum+"次",this.itemName0.visible=!0):(this.maxNum=Number.MAX_VALUE,this.itemName0.visible=!1),this.num>this.maxNum&&(this.num=this.maxNum),this.unitPrice.text=t.price+"",this.allPrice.text=this.num*t.price+"",this.numLabel.text=this.num+"",this.itemName.text=e.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemConfig.getQuality(e)],this.used.text="（"+t.use+"）",void(this.used.x=this.itemName.x+this.itemName.width)):(this.itemName0.visible=!1,t=GlobalConfig.FeatsStore[this.shopID],e=GlobalConfig.ItemConfig[t.goods[0].id],this.itemIcon.setData(e),this.goodId=t.index,2==this.shopType?this.unitPrice.text=t.costMoney.count+"":3==this.shopType&&(this.unitPrice.text=t.costItem.count+""),this.allPrice.text=this.num*parseInt(this.unitPrice.text)+"",this.numLabel.text=this.num+"",this.itemName.text=e.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemConfig.getQuality(e)],void(this.used.text="（"+t.use+"）"))
},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sub10Btn:this.num-=10;break;case this.sub1Btn:this.num-=1;break;case this.add10Btn:this.num+=10;break;case this.add1Btn:this.num+=1;break;case this.bgClose:ViewManager.ins().close(this)}this.num<1&&(this.num=1),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.inputOver()},e.prototype.closeCB=function(t){ViewManager.ins().close(e)},e.prototype.buy=function(t){if(2==this.shopType)Actor.chip>=parseInt(this.allPrice.text)?(Shop.ins().sendBuyMedal(this.goodId,this.num),ViewManager.ins().close(this)):UserTips.ins().showTips("|C:0xf3311e&T:筹码不足|");else if(3==this.shopType){var e=GlobalConfig.FeatsStore[this.shopID];UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,e.costItem.id)>=parseInt(this.allPrice.text)?(Shop.ins().sendBuyMedal(this.goodId,this.num),ViewManager.ins().close(this)):UserTips.ins().showTips("|C:0xf3311e&T:巅峰令不足|")}else if(Actor.yb>=parseInt(this.allPrice.text)){var i=[this.shopID,this.num];Shop.ins().sendBuy(1,[i]),ViewManager.ins().close(this)}else UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.inputOver=function(t){this.num=parseInt(this.numLabel.text),(isNaN(this.num)||this.num<1)&&(this.num=1),this.num>9999&&(this.num=9999),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""},e}(BaseEuiView);__reflect(BuyWin.prototype,"BuyWin"),ViewManager.ins().reg(BuyWin,LayerManager.UI_Popup);var HonorMarketPanel=function(t){function e(){var e=t.call(this)||this;return e.name="功勋商店",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listView.itemRenderer=HonorMarketItemRenderer,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.listView.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.addTouchEndEvent(this.get,this.onClick),this.observe(Shop.ins().postRefresMedalMessage,this.updateData),this.observe(Actor.ins().postFeatsChange,this.callback),this.observe(Shop.ins().postUpdateBuyMedal,this.callback),Shop.ins().sendMedalMessage()},e.prototype.callback=function(){Shop.ins().sendMedalMessage()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.get,this.onClick),this.removeObserve()},e.prototype.updateData=function(){var t=[],e=GlobalConfig.FeatsStore;for(var i in e){var s=!0;if(e[i].buyType==FEATS_TYPE.forever)for(var n in Shop.ins().medalData.exchangeCount)if(e[i].index==Number(n)&&e[i].daycount){Shop.ins().medalData.exchangeCount[n]>=e[i].daycount&&(s=!1);break}s&&t.push(e[i])}this.dataArr.replaceAll(t),this.myAttrValue0.text=Actor.feats+"";var o=this.get.text;this.get.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+o)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.get:UserWarn.ins().setBuyGoodsWarn(7)}},e.prototype.onTap=function(t){},e}(BaseView);__reflect(HonorMarketPanel.prototype,"HonorMarketPanel"),ViewManager.ins().reg(HonorMarketPanel,LayerManager.UI_Main);var IntegrationItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShopPointItem",e.item=new ItemBase,e.item.x=21,e.item.y=8,e.item.isShowName(!1),e.addChild(e.item),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ItemConfig[t.itemId];if(void 0!=e){this.goodsID=t.index,this.money.text=CommonUtils.overLength(t.price),this.integration.text=CommonUtils.overLength(t.integral),this.itemName.text=e.name,this.itemName.textColor=ItemConfig.getQualityColor(e),this.used.text="",this.used.x=this.itemName.x+this.itemName.width;var i=new RewardData;i.id=e.id,i.count=t.count,i.type=t.type,this.item.data=i}},e}(BaseItemRender);__reflect(IntegrationItemRenderer.prototype,"IntegrationItemRenderer");var IntegrationPanel=function(t){function e(){var e=t.call(this)||this;return e.name="积分商店",e.skinName="ShopPointSkin",e.list.itemRenderer=IntegrationItemRenderer,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.observe(Shop.ins().postRefreshIntegrationSucc,this.buyResultCB),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.removeObserve()},e.prototype.buyResultCB=function(t,e){1==t[0]?UserTips.ins().showTips("购买成功"):UserTips.ins().showTips("|C:0xf3311e&T:购买失败|"),this.label1.text="我的积分："+CommonUtils.overLength(t[1])+"（在神秘商店购买商品或刷新获得）"},e.prototype.updateData=function(){var t=[],e=GlobalConfig.IntegralStore;for(var i in e)t.push(e[i]);this.list.dataProvider=new eui.ArrayCollection(t),this.label1.text="我的积分："+CommonUtils.overLength(Shop.ins().shopData.point)+"（在神秘商店购买商品或刷新获得）"},e.prototype.onTap=function(t){if("buy"==t.target.name){var e=t.target.parent.goodsID,i=GlobalConfig.IntegralStore,s=void 0;for(var n in i){var o=i[n];o.index==e&&(s=o)}if(1!=s.type&&UserBag.ins().getSurplusCount()<=0){var a="背包已满，无法购买";return void UserTips.ins().showTips(a)}if(Actor.yb<s.price)return void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");if(Shop.ins().shopData.point<s.integral)return void UserTips.ins().showTips("|C:0xf3311e&T:积分不足！|");Shop.ins().sendIntegrationShop(e)}},e}(BaseView);__reflect(IntegrationPanel.prototype,"IntegrationPanel");var ItemShopPanel=function(t){function e(){var e=t.call(this)||this;return e.name="道具商城",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listView.itemRenderer=ItemShopItemRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.observe(Shop.ins().postBuyCount,this.refreshList),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.removeObserve()},e.prototype.refreshList=function(){for(var t=this.listView.dataProvider.length,e=0;t>e;e++){var i=this.listView.dataProvider,s=i.getItemAt(e);i.itemUpdated(s)}},e.prototype.updateData=function(){var t=[],e=GlobalConfig.ItemStoreConfig;for(var i in e)t.push(e[i]);this.listView.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){if("buy"==t.target.name){var e=t.target.parent.goodsID;GlobalConfig.ItemStoreConfig[e];Shop.ins().shopData.checkBuyGoodsId(e)&&ViewManager.ins().open(BuyWin,e)}},e}(BaseView);__reflect(ItemShopPanel.prototype,"ItemShopPanel");var MedalShopItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="FeatsShopItem",e.item=new ItemBase,e.item.x=21,e.item.y=8,e.item.isShowName(!1),e.addChild(e.item),e.btnGet&&(e.btnGet.name="buy"),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.data=t.goods[0],this.itemName.text=this.item.getText(),this.itemName.textColor=this.item.getTextColor(),this.labelPrice.text=""+t.costMoney.count,t.daycount?(this.labelTimes.visible=!0,this.labelTimes.text="今日已兑换"+t.exchangeCount+"/"+t.daycount):this.labelTimes.visible=!1},e}(BaseItemRender);__reflect(MedalShopItemRenderer.prototype,"MedalShopItemRenderer");var MedalShopPanel=function(t){function e(){var e=t.call(this)||this;return e.coin=0,e.name="功勋商店",e.skinName="FeatsShopSkin",e.labelGetCoin.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.labelGetCoin.text+"</u></a>"),e.list.itemRenderer=MedalShopItemRenderer,e.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Shop.ins().sendMedalMessage(),this.observe(Shop.ins().postRefresMedalMessage,this.updataData),this.observe(Shop.ins().postUpdateBuyMedal,this.buyResult),this.addTouchEvent(this.list,this.onBuy),this.addTouchEvent(this.labelGetCoin,this.onGetCoin)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.list,this.onBuy),this.removeTouchEvent(this.labelGetCoin,this.onGetCoin),this.removeObserve()},e.prototype.updataData=function(){var t=GlobalConfig.FeatsStore,e=Shop.ins().medalData;for(var i in t){var s=e.exchangeCount[t[i].index];isNaN(s)?t[i].exchangeCount=0:t[i].exchangeCount=s}this.setListData(t)},e.prototype.onBuy=function(t){if("buy"==t.target.name){var e=Actor.feats,i=t.target.parent,s=i.data;if(s.exchangeCount>=s.daycount&&0!=s.daycount){var n="今日可兑换次数用完，请明日再试";UserTips.ins().showTips(n)}else if(s.costMoney.count>e){var n="功勋值不足，无法兑换物品";UserTips.ins().showTips(n)}else Shop.ins().sendBuyMedal(s.index,1)}},e.prototype.buyResult=function(t){var e="成功兑换，消耗",i=0,s=GlobalConfig.FeatsStore;for(var n in s)s[n].index==t[0]&&(s[n].exchangeCount=t[1],i=s[n].costMoney.count);e=e+i+"功勋",UserTips.ins().showTips(e),this.setListData(s)},e.prototype.setListData=function(t){var e=new eui.ArrayCollection;for(var i in t)e.addItem(t[i]);this.list.dataProvider=e;Actor.feats;this.labelCoin.text=Actor.feats.toString()},e.prototype.onGetCoin=function(t){ViewManager.ins().open(ShopGoodsWarn).setData(7,1)},e}(BaseView);__reflect(MedalShopPanel.prototype,"MedalShopPanel");var NobleShopItemRender=function(t){function e(){var e=t.call(this)||this;return e.shopType=2,e.goodsID=0,e.skinName="NobleshoSkinItemShopItem",e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.ItemConfig[t.itemId];this.goodsID=t.index;var i="";i=t.price>1e5?Math.floor(t.price/1e4)+"万":t.price+"",this.money0.text=i,i=t.showYuanBao>1e5?Math.floor(t.showYuanBao/1e4)+"万":t.showYuanBao+"",this.money.text=i,this.itemName.text=e.name,this.itemName.textColor=ItemConfig.getQualityColor(e),this.used.text="（"+t.use+"）",this.used.x=this.itemName.x+this.itemName.width,this.itemIcon&&this.itemIcon.setData&&this.itemIcon.setData(e)}},e.prototype.showTip=function(){var t,e=GlobalConfig.IntegralStore;e[this.goodsID]&&(t=e[this.goodsID].itemId),void 0==t&&new Error("竟然没有找到该商品ID");var i=GlobalConfig.ItemConfig[t];ViewManager.ins().open(ItemDetailedWin,0,i.id,1)},e}(BaseItemRender);__reflect(NobleShopItemRender.prototype,"NobleShopItemRender");var NobleShopPanel=function(t){function e(){var e=t.call(this)||this;return e.name="贵族商城",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listView.itemRenderer=NobleShopItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]&&this.listView.addEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.tipImg,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),this.removeTouchEvent(this.tipImg,this.onTap),this.listView.removeEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this)},e.prototype.updateData=function(){var t=[],e=GlobalConfig.IntegralStore;for(var i in e)t.push(e[i]);this.listView.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){if("buy"==t.target.name){var e=t.target.parent.goodsID,i=t.target.parent.shopType;Recharge.ins().getIsForeve()?ViewManager.ins().open(BuyWin,e,i):UserTips.ins().showTips("没有激活贵族特权无法购买")}else t.currentTarget==this.tipImg&&ViewManager.ins().open(FuliWin,2)},e.prototype.scrollBottom=function(){this.listView.removeEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this),this.listView.scrollV=this.listView.contentHeight-this.listView.height},e}(BaseView);__reflect(NobleShopPanel.prototype,"NobleShopPanel");var ShopBestTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="GoodsOverViewSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.shopList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick);var i=[];for(var s in GlobalConfig.TreasureOverViewConfig)i.push(GlobalConfig.TreasureOverViewConfig[s].itemId);this.shopList.dataProvider=new eui.ArrayCollection(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShopBestTips.prototype,"ShopBestTips"),ViewManager.ins().reg(ShopBestTips,LayerManager.UI_Popup);var ShopRedPoint=function(t){function e(){var e=t.call(this)||this;return e.shopRedPoint=!1,e.blackMarketRedPoint=!1,e.associated(e.postShopRedPoint,e.postBlackMarketRedPoint),e.associated(e.postBlackMarketRedPoint,Shop.ins().postUpdateShopData),e}return __extends(e,t),e.prototype.postShopRedPoint=function(){var t=this.shopRedPoint;return this.shopRedPoint=this.blackMarketRedPoint,this.shopRedPoint!=t},e.prototype.postBlackMarketRedPoint=function(){var t=this.blackMarketRedPoint;return this.blackMarketRedPoint=Shop.ins().shopData.refushTime<=0,this.blackMarketRedPoint!=t},e}(BaseSystem);__reflect(ShopRedPoint.prototype,"ShopRedPoint");var GameSystem;!function(t){ShopRedPoint.ins.bind(ShopRedPoint)}(GameSystem||(GameSystem={}));var ShopWin=function(t){function e(){var e=t.call(this)||this;return e.lastIndex=0,e.scrollBottom=!1,e.skinName="ShopSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.observe(UserBag.ins().postItemAdd,this.buyToUse),this.observe(ShopRedPoint.ins().postBlackMarketRedPoint,this.updateRedPoint),this.lastIndex=void 0==t[0]?this.lastIndex:t[0],t[1]&&(this.scrollBottom=t[1]),this.tab.selectedIndex=this.lastIndex,this.viewStack.selectedIndex=this.lastIndex,this.setOpenIndex(this.lastIndex),Shop.ins().postRefreshGoodsSuccess(!1),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.redPoint0.visible=ShopRedPoint.ins().blackMarketRedPoint},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.viewStack.numChildren,s=0;i>s;s++)this.viewStack.getChildAt(s).close()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.blackMarketPanel.open();break;case 1:this.itemShopPanel.open();break;case 2:this.honorMarketPanel.open()}this.lastIndex!=t?(this.viewStack.getElementAt(this.lastIndex).close(),this.lastIndex=t):this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.buyToUse=function(){Shop.ins().shopBuyArr||(Shop.ins().shopBuyArr=[]);for(var t=0;t<Shop.ins().shopBuyArr.length;t++){var e=Shop.ins().shopBuyArr[t];UserBag.ins().sendUseItem(e.id,e.count)}},e}(BaseEuiView);__reflect(ShopWin.prototype,"ShopWin"),ViewManager.ins().reg(ShopWin,LayerManager.UI_Main);var SkillData=function(){function t(t){this._specialCD=0,this.configID=t}return Object.defineProperty(t.prototype,"lv",{get:function(){return this._id%1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"job",{get:function(){return Math.floor(this._id%1e5/1e4)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return 1e3*Math.floor(this._id/1e3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this.id+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"configID",{get:function(){return this._id},set:function(t){this._id=t,this.config=GlobalConfig.SkillsConfig[t],this._preId=0/0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preId",{get:function(){return this._preId},set:function(t){this._preId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lv1ConfigID",{get:function(){return this.id+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castType",{get:function(){return isNaN(this.config.castType)?2:this.config.castType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetType",{get:function(){return isNaN(this.config.targetType)?2:this.config.targetType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){var t=this.config||GlobalConfig.SkillsConfig[this.lv1ConfigID];if(Assert(t,"技能id:"+this.configID+"找不到配置"))return"";var e=GlobalConfig.SkillsDescConfig[t.desc],i=e?e.desc:"";if(!i.length||!t.desc_ex)return i;for(var s=t.desc_ex.length,n=0;s>n;n++)i=i.replace("%s%",t.desc_ex[n]+"");return i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"affectRange",{get:function(){return isNaN(this.config.affectRange)?1:this.config.affectRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"affectCount",{get:function(){return isNaN(this.config.affectCount)?1:this.config.affectCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"calcType",{get:function(){return isNaN(this.config.calcType)?1:this.config.calcType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"herdMonRate",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?isNaN(t.herdMonRate)?100:t.herdMonRate:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"herdPlayerRate",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?isNaN(t.herdPlayerRate)?10:t.herdPlayerRate:10},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cd",{get:function(){if(this._specialCD)return this._specialCD;var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.cd:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specialCD",{set:function(t){this._specialCD=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPassive",{get:function(){return!!this.config.passive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rate",{get:function(){return this.config.passive&&this.config.passive.rate||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cond",{get:function(){return this.config.passive&&this.config.passive.cond||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castRange",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.castRange:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repelDistance",{get:function(){return this.config.repelDistance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"teleport",{get:function(){return this.config.teleport},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionType",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.actionType:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tarEff",{get:function(){return this.config.tarEff},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otarEff",{get:function(){return this.config.otarEff},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selfEff",{get:function(){return this.config.selfEff},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canUse",{get:function(){return this.config&&!!this.lv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"args",{get:function(){return this.config.args},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wordEff",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.wordEff:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effType",{get:function(){return this.config.effType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otherSkills",{get:function(){return this.config.otherSkills},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectId",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.effectId:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sound",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.sound:""},enumerable:!0,configurable:!0}),t.getSkillByJob=function(e,i,s){return void 0===i&&(i=1),void 0===s&&(s=1),new t(1e4*e+1e3*i+s)},Object.defineProperty(t.prototype,"descID",{get:function(){var t=GlobalConfig.SkillsConfig[this.configID]||GlobalConfig.SkillsConfig[this.lv1ConfigID];return t?t.desc:0},enumerable:!0,configurable:!0}),t}();__reflect(SkillData.prototype,"SkillData");var MijiItemEx=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiWithNameItemSkin",e.init(),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.miji.data=this.data;var t=GlobalConfig.MiJiSkillConfig[this.data],e=GlobalConfig.ItemConfig[t.item];this.nameTF.text=e.name}},e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){var t=GlobalConfig.MiJiSkillConfig[this.data];ViewManager.ins().open(PropGainTipsWin,0,t.item)},e}(BaseItemRender);__reflect(MijiItemEx.prototype,"MijiItemEx");var MijiLookItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiOverViewItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data)if("string"==typeof this.data)this.currentState="title","middle"==this.data?this.name1.text="中级秘籍":this.name1.text="高级秘籍";else if("object"==typeof this.data&&this.data.length){this.currentState="miji";for(var t=5,e=0;t>e;e++){var i=this.data[e];if(this["item"+e]&&i){this["item"+e].visible=!0,this["item"+e].data=i.id;var s=GlobalConfig.ItemConfig[i.item];this.name1.text=s.name}else this["item"+e].visible=!1}}},e}(BaseItemRender);__reflect(MijiLookItem.prototype,"MijiLookItem");var MijiLookWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiOverViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.list.itemRenderer=MijiLookItem;var i=[],s=[],n=[],o=[];for(var a in GlobalConfig.MiJiSkillConfig){var r=GlobalConfig.MiJiSkillConfig[a],h=GlobalConfig.ItemConfig[r.item];3==ItemConfig.getQuality(h)?(i.length||i.push("middle"),n.length<5?n.push(r):(i.push(n),n=[],n.push(r))):(s.length||s.push("high"),o.length<5?o.push(r):(s.push(o),o=[],o.push(r)))}n.length&&i.push(n),o.length&&s.push(o);var l=i.concat(s);this.list.dataProvider=new eui.ArrayCollection(l)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.setData=function(){},e}(BaseEuiView);__reflect(MijiLookWin.prototype,"MijiLookWin"),ViewManager.ins().reg(MijiLookWin,LayerManager.UI_Main);var SkillWin=function(t){function e(){var e=t.call(this)||this;return e.lastIndex=0,e.skinName="ZsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(UserBag.ins().postItemAdd,this.updateRedPoint),this.observe(UserBag.ins().postItemDel,this.updateRedPoint),this.observe(UserBag.ins().postItemChange,this.updateRedPoint),this.observe(NeiGong.ins().postNeiGongDataChange,this.updateRedPoint),this.observe(UserJingMai.ins().postUpdate,this.updateRedPoint),this.observe(Actor.ins().postGoldChange,this.updateRedPoint),this.observe(Actor.ins().postLevelChange,this.updateRedPoint),this.observe(UserSkill.ins().postSkillUpgradeAll,this.updateRedPoint),this.observe(UserMiji.ins().postBagUseMiji,this.onBagUseMiji),this.observe(ZhanLing.ins().postZhanLingComposeItem,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingInfo,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingUpExp,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingDrug,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingWear,this.updateRedPoint),this.checkPage();var s=void 0!=t[0]?t[0]:e.Panel_JINENG,n=t[1]?t[1]:0;this.viewStack.selectedIndex=this.tab.selectedIndex=s,this.roleSelect.setCurRole(n),this.setOpenIndex(s)},e.prototype.checkPage=function(){ZhanLingModel.ins().ZhanLingOpen()?(this.zhanlingPanel.parent||this.viewStack.addChild(this.zhanlingPanel),this["redPoint"+e.Panel_ZHANLING].parent||this.redPointGroup.addChild(this["redPoint"+e.Panel_ZHANLING])):(this.zhanlingPanel.parent&&this.viewStack.removeChild(this.zhanlingPanel),this["redPoint"+e.Panel_ZHANLING].parent&&DisplayUtils.removeFromParent(this["redPoint"+e.Panel_ZHANLING]))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().removeAll(this);var i=ViewManager.ins().getView(UIView2);i&&i.closeNav(UIView2.NAV_SKILL);for(var s=this.viewStack.numChildren,n=0;s>n;n++)this.viewStack.getChildAt(n).close()},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.onTabTouching=function(t){return e.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.setOpenIndex=function(t){var i,s;switch(this.roleSelect.openRole(),this.help.visible=!1,t){case e.Panel_JINENG:this.skillPanel.open(),this.skillTitle.source="biaoti_jineng";break;case e.Panel_NEIGONG:i=GlobalConfig.NeiGongBaseConfig.openLevel,s=GlobalConfig.NeiGongBaseConfig.openGuanqia,UserFb.ins().guanqiaID<=s?(UserTips.ins().showTips("通关"+s+"关开启"),t=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex):(this.neiGongPanel.open(this.roleSelect.getCurRole()),this.skillTitle.source="biaoti_neigong");break;case e.Panel_JINGMAI:i=GlobalConfig.JingMaiCommonConfig.openLevel,Actor.level<i?(UserTips.ins().showTips(i+"级开启"),t=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex):(this.jingMai.open(),this.skillTitle.source="biaoti_jingmai");break;case e.Panel_MIJI:var n=UserMiji.ZsLv;UserZs.ins().lv<n?(UserTips.ins().showTips(n+"转开启"),t=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex):(this.mijiPanel.open(),this.skillTitle.source="biaoti_miji");break;case e.Panel_ZHANLING:ZhanLingModel.ins().ZhanLingOpen()?(this.help.visible=!0,this.roleSelect.hideRole(),this.zhanlingPanel.open(),this.skillTitle.source="biaoti_zhanling"):UserTips.ins().showTips("开服第"+GlobalConfig.ZhanLingConfig.openserverday+"天并达到"+GlobalConfig.ZhanLingConfig.openzhuanshenglv+"转开启")}this.lastIndex!=t?(this.viewStack.getElementAt(this.lastIndex).close(),this.lastIndex=t):this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.updateRedPoint()},e.checkIsOpen=function(t){var i,s;switch(t){case e.Panel_JINENG:break;case e.Panel_NEIGONG:if(i=GlobalConfig.NeiGongBaseConfig.openLevel,s=GlobalConfig.NeiGongBaseConfig.openGuanqia,UserFb.ins().guanqiaID<=s)return UserTips.ins().showTips("通关"+s+"关开启"),!1;break;case e.Panel_JINGMAI:if(i=GlobalConfig.JingMaiCommonConfig.openLevel,Actor.level<i)return UserTips.ins().showTips(i+"级开启"),!1;break;case e.Panel_MIJI:var n=UserMiji.ZsLv;if(UserZs.ins().lv<n)return UserTips.ins().showTips(n+"转开启"),!1;break;case e.Panel_ZHANLING:if(!ZhanLingModel.ins().ZhanLingOpen())return UserTips.ins().showTips("开服第"+GlobalConfig.ZhanLingConfig.openserverday+"天并达到"+GlobalConfig.ZhanLingConfig.openzhuanshenglv+"转开启"),!1}return!0},e.prototype.updateRedPoint=function(){TimerManager.ins().isExists(this.updateRed,this)||TimerManager.ins().doTimer(100,1,this.updateRed,this)},e.prototype.onBagUseMiji=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)if(!UserMiji.ins().hasEquipMiji(t,i)){this.roleSelect.setCurRole(i),this.setRoleId(i);break}this.mijiPanel.onBagUseMiji(t)},e.prototype.updateRed=function(){this.redPoint0.visible=this.and(UserSkill.ins().canGrewupSkill()),this.redPoint1.visible=NeiGongModel.ins().canUp(),this.redPoint2.visible=this.jingMaiCanUp(),this.redPoint3.visible=UserMiji.ins().isMjiSum(),this.redPoint4.visible=ZhanLing.ins().checkRedPoint();var t=SubRoles.ins().subRolesLen;this.roleSelect.clearRedPoint();for(var i=0;t>i;i++){var s=void 0;if(this.tab.selectedIndex==e.Panel_JINENG)s=UserSkill.ins().canGrewupAllSkills(i);else if(this.tab.selectedIndex==e.Panel_NEIGONG)s=NeiGongModel.ins().canUpById(i);else if(this.tab.selectedIndex==e.Panel_JINGMAI){var n=SubRoles.ins().roles[i].jingMaiData;s=n.jingMaiCanUp()}else this.tab.selectedIndex==e.Panel_MIJI&&(s=UserMiji.ins().isMjiSum());this.roleSelect.showRedPoint(i,s)}},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.setRoleId=function(t){t!=this.skillPanel.curRole&&(this.neiGongPanel.curRole=this.mijiPanel.curRole=this.skillPanel.curRole=this.jingMai.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex))},e.prototype.and=function(t){for(var e=0,i=t;e<i.length;e++){var s=i[e];if(1==s)return!0}return!1},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.help:this.viewStack.selectedIndex==e.Panel_ZHANLING&&ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[35].text)}},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=t[0]||e.Panel_JINENG;return e.checkIsOpen(s)},e.prototype.jingMaiCanUp=function(){var t;for(var e in SubRoles.ins().roles)if(t=SubRoles.ins().roles[e].jingMaiData,t.jingMaiCanUp()){var i=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level>=i)return!0}return!1},e}(BaseEuiView);SkillWin.Panel_JINENG=0,SkillWin.Panel_NEIGONG=1,SkillWin.Panel_JINGMAI=2,SkillWin.Panel_MIJI=3,SkillWin.Panel_ZHANLING=4,__reflect(SkillWin.prototype,"SkillWin"),ViewManager.ins().reg(SkillWin,LayerManager.UI_Main);var SoundUtil=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._delayTime=0,e._delayStartTime=0,e._runTimeGap=700,e._runTimeStart=0,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.playRunSound=function(){egret.getTimer()-this._runTimeStart>=this._runTimeGap&&(this._runTimeStart=egret.getTimer(),SoundManager.ins().playEffect(e.RUN))},e.prototype.playRun=function(){egret.getTimer()-this._runTimeStart>this._runTimeGap+100&&this.playRunSound(),TimerManager.ins().isExists(this.playRunSound,this)||TimerManager.ins().doTimer(this._runTimeGap,0,this.playRunSound,this)},e.prototype.stopRun=function(){TimerManager.ins().remove(this.playRunSound,this)},e.prototype.playEffect=function(t){egret.getTimer()-this._delayStartTime<this._delayTime||SoundManager.ins().playEffect(t)},e.prototype.delayTime=function(t){this._delayTime=t,this._delayStartTime=egret.getTimer()},e}(BaseClass);SoundUtil.RUN="longlin_a_pd_mp3",SoundUtil.WINDOW="longlin_a_dkjm_mp3",SoundUtil.TASK="longlin_b_renwu_mp3",SoundUtil.LEVEL_UP="longlin_b_shengji_mp3",SoundUtil.SCENE="longlin_a_zyz_mp3",SoundUtil.EQUIP="longlin_a_chuandai_mp3",SoundUtil.CREATE_ROLE="longlin_a_chuangjue_mp3",SoundUtil.FORGE="longlin_a_qianghua_mp3",SoundUtil.SMELT="longlin_b_ronglian_mp3",SoundUtil.SKILL_UP="longlin_b_jineng_mp3",SoundUtil.WINDOW_OPEN=!1,__reflect(SoundUtil.prototype,"SoundUtil");
var LyMark=function(t){function e(){var e=t.call(this)||this;return e._lyMarkLv=0,e._lyMarkExp=0,e._isMax=!1,e.sysId=PackageID.LyMark,e.regNetMsg(1,e.postMarkData),e.regNetMsg(2,e.postUpgrade),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"lyMarkLv",{get:function(){return this._lyMarkLv},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lyMarkExp",{get:function(){return this._lyMarkExp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skills",{get:function(){return this._skills},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMax",{get:function(){return this._isMax},enumerable:!0,configurable:!0}),e.prototype.getSkillLvById=function(t){return!this._skills||this._skills.length<t?0:this._skills[t-1]},e.prototype.postMarkData=function(t){this._lyMarkLv=t.readShort(),this._lyMarkExp=t.readInt();var e=t.readByte();this._skills=[],this._skills.length=e;for(var i=0;e>i;i++)this._skills[i]=t.readShort();this._isMax=this._lyMarkLv>=Object.keys(GlobalConfig.FlameStampLevel).length},e.prototype.postUpgrade=function(t){var e=t.readByte();return[e]},e.prototype.sendUpgrade=function(){this.sendBaseProto(2)},e.prototype.sendUpSkill=function(t){var e=this.getBytes(3);e.writeByte(t),this.sendToServer(e)},e.prototype.sendCompound=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.checkOpen=function(){if(!SpecialRing.ins().isFireRingActivate())return!1;var t=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);return!t||t.level<GlobalConfig.FlameStamp.openLevel?!1:!0},e.prototype.checkRed=function(){if(!this.checkOpen())return!1;if(!e.ins().isMax){var t=GlobalConfig.FlameStampLevel[this.lyMarkLv];if(Assert(t,"LyMark lv:"+this.lyMarkLv+", exp:"+this.lyMarkExp))return!1;var i=UserBag.ins().getBagItemById(t.costItem),s=i?i.count:0,n=t.exp-this._lyMarkExp;if(s>=t.costCount&&s*GlobalConfig.FlameStampMat[t.costItem].exp>=n)return!0}for(var o,a,r=0;6>=r;r++)if(0!=r){a=e.ins().getSkillLvById(r+1);var h=a>=Object.keys(GlobalConfig.FlameStampEffect[r+1]).length;if(!h&&(o=GlobalConfig.FlameStampEffect[r+1][0>=a?1:a+1],o.costItem)){var i=(GlobalConfig.ItemConfig[o.costItem],UserBag.ins().getBagItemById(o.costItem)),s=i?i.count:0;if(s>=o.costCount&&e.ins().lyMarkLv>=o.stampLevel)return!0}}return!1},e.prototype.getCurSkillID=function(){for(var t,e,i=0,s=0,n=0;6>=n;n++)s=t=this.getSkillLvById(n+1),t||(t=1),e=GlobalConfig.FlameStampEffect[n+1][t],n+1!=1&&n+1!=2||!s||(i=e.skillId);return i},e.prototype.getCurSkillCD=function(){var t=this.getCurSkillID(),e=this.getSkillLvById(3),i=e?GlobalConfig.FlameStampEffect[3][e].reloadTime:0,s=GlobalConfig.SkillsDescConfig[GlobalConfig.SkillsConfig[t].desc];return s.cd-i},e}(BaseSystem);__reflect(LyMark.prototype,"LyMark");var GameSystem;!function(t){t.lyMark=LyMark.ins.bind(LyMark)}(GameSystem||(GameSystem={}));var BookSkillInfo=function(){function t(){this.itemId=0,this.num=0}return t}();__reflect(BookSkillInfo.prototype,"BookSkillInfo");var OtherFireRingData=function(){function t(){this.lyMarkLv=0,this.lyMarkSkills=[]}return t.prototype.parser=function(t){if(this.lv=t.readInt(),this.skillBooks=[],this.abilityItems=[],this.lv>0){for(var e=t.readShort(),i=0;e>i;i++){var s=new RingSkillInfo;s.position=t.readShort(),s.skillId=t.readShort(),s.skillLvl=t.readShort(),this.skillBooks.push(s)}for(var n=t.readShort(),i=0;n>i;i++){var o=t.readShort(),a=t.readShort();this.abilityItems[o]=a}this.lyMarkLv=t.readShort(),this.lyMarkSkills=[];var r=t.readByte();this.lyMarkSkills.length=r;for(var i=0;r>i;i++)this.lyMarkSkills[i]=t.readShort()}},t}();__reflect(OtherFireRingData.prototype,"OtherFireRingData");var RingSkillInfo=function(){function t(){this.position=0,this.skillId=0,this.skillLvl=0,this.isOpen=!1}return t}();__reflect(RingSkillInfo.prototype,"RingSkillInfo");var SpecialRingData=function(){function t(){this.id=0,this.level=0,this.exp=0,this.fight=0,this.order=0,this.isUnLock=0}return t.prototype.parser=function(t){this.id=t.readShort(),this.level=t.readShort(),this.exp=t.readInt(),this.fight=t.readByte(),this.isUnLock=t.readByte(),this.order=GlobalConfig.ActorExRingConfig[this.id].order},t}();__reflect(SpecialRingData.prototype,"SpecialRingData");var SoundManager=function(t){function e(){var e=t.call(this)||this;return e.bgOn=!0,e.effectOn=!0,e.bgVolume=.5,e.effectVolume=.5,e.bg=new SoundBg,e.bg.setVolume(e.bgVolume),e.effect=new SoundEffects,e.effect.setVolume(e.effectVolume),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.playEffect=function(t){this.effectOn&&this.effect.play(t)},e.prototype.playBg=function(t){this.currBg=t,this.bgOn&&this.bg.play(t)},e.prototype.stopBg=function(){this.bg.stop()},e.prototype.touchBg=function(){egret.Capabilities.isMobile&&"iOS"==egret.Capabilities.os&&this.bg.touchPlay()},e.prototype.setEffectOn=function(t){this.effectOn=t},e.prototype.setBgOn=function(t){this.bgOn=t,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},e.prototype.setBgVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.bgVolume=t,this.bg.setVolume(this.bgVolume)},e.prototype.getBgVolume=function(){return this.bgVolume},e.prototype.setEffectVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.effectVolume=t,this.effect.setVolume(this.effectVolume)},e.prototype.getEffectVolume=function(){return this.effectVolume},e}(BaseClass);SoundManager.CLEAR_TIME=18e4,__reflect(SoundManager.prototype,"SoundManager");var FireRingAbilityView=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRAbilitySkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.itemRenderer=FireRingAbilityItem,this.addTouchEndEvent(this.colorCanvas,this.otherClose);var i=[];for(var s in GlobalConfig.ActorExRingAbilityConfig)i.push(parseInt(s));this.list.dataProvider=new ArrayCollection(i)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(FireRingAbilityView.prototype,"FireRingAbilityView"),ViewManager.ins().reg(FireRingAbilityView,LayerManager.UI_Popup);var FireRingInfoPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isItemEnough=!1,e}return __extends(e,t),e.prototype.open=function(){this.addCustomEvent(),this.initView()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.showBtn,this.showDetail),this.addTouchEvent(this.lvupBtn,this.upStar),this.addTouchEvent(this.checkBtn,this.showAbility),this.addTouchEvent(this.ultraBtn,this.showUltra),this.observe(SpecialRing.ins().postSpicelRingUpdate,this.initView),this.observe(SpecialRing.ins().postSRStairUp,this.initView)},e.prototype.showUltra=function(){ViewManager.ins().open(RingUpgradeWin)},e.prototype.showAbility=function(){ViewManager.ins().open(FireRingAbilityView)},e.prototype.upStar=function(){10==this.starList.starNum?SpecialRing.ins().sendRingLevelUp(SpecialRing.FIRE_RING_ID):this.isItemEnough?SpecialRing.ins().sendSpicelRingUpdate(SpecialRing.FIRE_RING_ID):UserTips.ins().showTips("特戒碎片不足")},e.prototype.showDetail=function(){ViewManager.ins().open(RingDetailPanel,this.powerAttr)},e.prototype.initView=function(){var t=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),e=SpecialRing.ins().getRingStair(t.level),i=SpecialRing.ins().getRingStar(t.level),s=0;s=void 0==this.lastStar?0:this.lastStar<i?1:0,this.lastStar=i;var n=SpecialRing.ins().getRingConfigById(SpecialRing.FIRE_RING_ID,t.level),o=GlobalConfig.ItemConfig[n.costItem],a=SpecialRing.ins().getRingConfigById(SpecialRing.FIRE_RING_ID,t.level+1);this.lv.text=StringUtils.NumberToChinese(e)+"阶",this.costImg.source=o.icon+"_png";var r=UserBag.ins().getBagGoodsCountById(0,n.costItem),h="",l=n.cost;10==i?(r=0,l=0,this.costImg.visible=!1,this.costCount.visible=!1,this.costTitle.visible=!1,this.lvupBtn.label="升  阶"):(this.costImg.visible=!0,this.costCount.visible=!0,this.costTitle.visible=!0,this.lvupBtn.label="升  星"),r>=l?(h=ColorUtil.GREEN_COLOR,this.isItemEnough=!0):(h=ColorUtil.RED_COLOR,this.isItemEnough=!1),this.costCount.textFlow=TextFlowMaker.generateTextFlow("<font color="+h+">"+r+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+l+"</font> "),this.nowAttr.text=AttributeData.getAttStr(n.attrAward,0,1,"："),a?this.nextAttr.text=AttributeData.getAttStr(a.attrAward,0,1,"："):this.nextAttr.text="已满级",this.powerAttr=this.getRingTotalAttribute();var c=UserBag.getAttrPower(this.powerAttr);c*=SubRoles.ins().subRolesLen,this.power.setPower(c),this.starList||(this.starList=new StarList(10),this.starList.x=15,this.starGroup.addChild(this.starList)),this.starList.setStarNum(i,s),this.info.text=this.getNextStageAbility(e),SpecialRing.ins().getAbilityID()?(this.ultraBtn.icon="ability_0N",this.nameImg.source="ring_title2"):(this.ultraBtn.icon="ability_0L",this.nameImg.source="ring_title")},e.prototype.getRingTotalAttribute=function(){for(var t,e=function(e){var i=1;e==SpecialRing.FIRE_RING_ID&&(i=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level);var s=SpecialRing.ins().getRingConfigById(e,i);if(t)if(e==SpecialRing.FIRE_RING_ID){var n=CommonUtils.copyDataHandler(s.attrAward),o=SpecialRing.ins().getAbilityID();if(o){var a=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][o][SpecialRing.ins().abilityIds[o]];n.forEach(function(t,e){t.value*=1+a.attrPer/1e4,t.value=Math.round(t.value)})}t=AttributeData.AttrAddition(t,n)}else t=AttributeData.AttrAddition(t,s.attrAward);else t=s.attrAward},i=2;7>=i;i++)e(i);return t},e.prototype.getNextStageAbility=function(t){var e=t+1;2>e&&(e=2);var i=0;for(var s in GlobalConfig.ActorExRing7Config)GlobalConfig.ActorExRing7Config[s]instanceof ActorExRing7Config&&i++;for(var n=GlobalConfig.ActorExRing7Config[i],o=SpecialRing.ins().getRingStair(n.level);o>e;){var a=SpecialRing.ins().getNextStageSkillName(e);if(a)return e+"阶解锁"+SpecialRing.ins().getNextStageSkillName(e);e++}return""},e}(BaseComponent);__reflect(FireRingInfoPanel.prototype,"FireRingInfoPanel");var ArrayCollection=eui.ArrayCollection,FireRingSkillPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillId=0,e.isEoughItemUpgrade=!1,e.skillName="",e}return __extends(e,t),e.prototype.open=function(){this.initView(),this.addCustomEvent()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.opraBtn,this.opration),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.learnList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onLearnListChange,this),this.observe(SpecialRing.ins().postSkillInfo,this.refreshView)},e.prototype.opration=function(){var t=SpecialRing.ins().skillInfo[this.lastSelectIndex];0==t.skillId?SpecialRing.ins().requestLearnSkill(this.skillId,t.position):t.skillLvl==SpecialRing.ins().getSkillMaxLvl(t.skillId)?UserTips.ins().showTips(this.skillName+"已升至顶级"):this.isEoughItemUpgrade?SpecialRing.ins().requestUpgradeSkill(t.position):UserTips.ins().showTips(this.skillName+"数量不足")},e.prototype.onListChange=function(t){var e=SpecialRing.ins().skillInfo[this.list.selectedIndex];if(e.isOpen)this.updateView(t.itemIndex);else{var i=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level;SpecialRing.ins().getRingStair(i);if(i>=SpecialRing.GRID_OPEN_LEVEL){var s=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];Actor.yb>=s.skillGridYb?SpecialRing.ins().requestOpenGrid():UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")}else UserTips.ins().showTips(SpecialRing.GRID_OPEN_LEVEL+"阶开启")}},e.prototype.onLearnListChange=function(t){this.selectSkill(this.learnList.selectedIndex)},e.prototype.initView=function(){this.list.itemRenderer=FireRingSkillItem,this.learnList.itemRenderer=FireRingSkillBookItem,this.updateList(),this.updateView(0)},e.prototype.updateList=function(){this.list.dataProvider=new ArrayCollection(SpecialRing.ins().skillInfo)},e.prototype.refreshView=function(){this.updateList(),this.updateView(this.lastSelectIndex)},e.prototype.updateView=function(t){this.lastSelectIndex=t,this.list.selectedIndex=t,this.selectList();var e=SpecialRing.ins().skillInfo[t];if(e.skillId){this.currentState="upgrade",this.opraBtn.enabled=!0;var i=SpecialRing.ins().getActorExRingBookConfig(e.skillId,e.skillLvl);if(this.skillName=i.skillName,this.nextLv.visible=!0,this.opraBtn.visible=!0,this.nowLvDesc.textFlow=TextFlowMaker.generateTextFlow(i.skillDesc),e.skillLvl<SpecialRing.ins().getSkillMaxLvl(e.skillId)){this.nextLv.visible=!0;var s=SpecialRing.ins().getActorExRingBookConfig(e.skillId,e.skillLvl+1);this.nextLvDesc.textFlow=TextFlowMaker.generateTextFlow(s.skillDesc),this.cost.text="X"+s.num,this.needItem.data=s.itemId,this.isEoughItemUpgrade=UserBag.ins().getBagGoodsCountById(0,i.itemId)>=s.num,this.isEoughItemUpgrade?(this.cost.textColor=ColorUtil.GREEN_COLOR_N,this.updateRp.visible=!0):(this.cost.textColor=ColorUtil.RED_COLOR_N,this.updateRp.visible=!1),this.updateGroup.visible=!0}else this.isEoughItemUpgrade=!0,this.updateGroup.visible=!1,this.nextLv.visible=!1,this.updateRp.visible=!1}else this.currentState="study",this.learnList.dataProvider=new ArrayCollection(SpecialRing.ins().getStudyBook()),0==this.learnList.dataProvider.length?(this.nowLvDesc.visible=!1,this.nextLvDesc.visible=!1,this.opraBtn.enabled=!1,this.nobook.visible=!0):(this.nowLvDesc.visible=!0,this.nextLvDesc.visible=!0,this.opraBtn.enabled=!0,this.nobook.visible=!1,this.selectSkill(SpecialRing.ins().getFirstStudyBookIndex()));for(var n,o,a,r,h=SpecialRing.ins().skillInfo.length,l=0,c=0;h>c;c++)o=SpecialRing.ins().skillInfo[c],o.skillId>0&&(a=SpecialRing.ins().getActorExRingBookConfig(o.skillId,o.skillLvl),o.skillId<=4?n=n?AttributeData.AttrAddition(n,a.attr):a.attr:5==o.skillId?r=a.bookAttrPer:o.skillId>5&&a.exPower&&(l+=a.exPower));var u=l;n&&(r&&(n=AttributeData.AttrMultiply(n,r)),u+=UserBag.getAttrPower(n)),u*=SubRoles.ins().subRolesLen,this.power.setPower(u)},e.prototype.selectSkill=function(t){this.learnList.selectedIndex=t;var e=this.learnList.dataProvider.getItemAt(t),i=SpecialRing.ins().getSkillIdByItemId(e.id),s=SpecialRing.ins().getActorExRingBookConfig(i,1);this.skillId=i,this.nowLvDesc.textFlow=TextFlowMaker.generateTextFlow(s.skillDesc);var n=SpecialRing.ins().getActorExRingBookConfig(i,2);this.nextLvDesc.textFlow=TextFlowMaker.generateTextFlow(n.skillDesc),this.selectLearnList()},e.prototype.selectList=function(){for(var t=this.list.dataProvider.length,e=0;t>e;e++){var i=this.list.getElementAt(e);i&&(e!=this.list.selectedIndex?i.setSelect(!1):i.setSelect(!0))}},e.prototype.selectLearnList=function(){for(var t=this.learnList.dataProvider.length,e=0;t>e;e++){var i=this.learnList.getElementAt(e);i&&(e!=this.learnList.selectedIndex?i.setSelect(!1):i.setSelect(!0))}void 0!=this.learnList.selectedItem&&void 0!=this.learnList.selectedItem.id&&(this.opraBtn.enabled=SpecialRing.ins().isBookCanStudy(this.learnList.selectedItem.id))},e}(BaseComponent);__reflect(FireRingSkillPanel.prototype,"FireRingSkillPanel");var FireRingWin=function(t){function e(){var e=t.call(this)||this;return e.lastSelect=0,e.skinName="LYRingSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastSelect=t[0]||0,this.addChangingEvent(this.tab,this.onTabTouching),this.tab.addEventListener(egret.Event.CHANGE,this.setSelectedIndex,this),this.tab.selectedIndex=this.lastSelect,this.viewStack.selectedIndex=this.lastSelect,this.viewStack.getElementAt(this.lastSelect).open(),this.checkPoint(),this.observe(SpecialRing.ins().postSRStairUp,this.checkPoint),this.observe(SpecialRing.ins().postSkillInfo,this.checkPoint),this.observe(UserFb.ins().postFbRingInfo,this.checkPoint),this.observe(UserBag.ins().postItemAdd,this.checkPoint),this.observe(UserBag.ins().postItemDel,this.checkPoint),this.observe(UserBag.ins().postItemCountChange,this.checkPoint),this.observe(LyMark.ins().postMarkData,this.checkPoint)},e.prototype.close=function(){this.removeObserve(),this.removeEventListener(egret.Event.CHANGING,this.onTabTouching,this.tab),this.removeEventListener(egret.Event.CHANGE,this.setSelectedIndex,this),this.viewStack.getElementAt(this.lastSelect)&&this.viewStack.getElementAt(this.lastSelect).close()},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return 3!=t||LyMark.ins().checkOpen()?!0:(UserTips.ins().showTips("烈焰戒指达到"+GlobalConfig.FlameStamp.openLevel+"级开启"),!1)},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.checkPoint=function(){this.redPoint0.visible=SpecialRing.ins().checkHaveUpRing(),this.redPoint1.visible=SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill(),this.redPoint2.visible=SpecialRing.ins().fireRingRedPoint(),this.redPoint3.visible=LyMark.ins().checkRed()},e}(BaseEuiView);__reflect(FireRingWin.prototype,"FireRingWin"),ViewManager.ins().reg(FireRingWin,LayerManager.UI_Main);var FireRingAbilityItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ActorExRingAbilityConfig[t];this.nameTxt.text=e.abilityName,this.descLabel.textFlow=TextFlowMaker.generateTextFlow(e.abilityDesc),this.imgIcon.source=e.abilityIcon;var i=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),s=SpecialRing.ins().getRingStair(i.level);s>=e.ringLv?this.stateLabel.text="":(this.stateLabel.text="("+SpecialRing.ins().getUnLockStage(t)+"阶解锁)",this.stateLabel.textColor=ColorUtil.RED_COLOR_N)},e}(ItemRenderer);__reflect(FireRingAbilityItem.prototype,"FireRingAbilityItem");var FireRingFb=function(t){function e(){var e=t.call(this)||this;return e.isUse=!1,e.name="副本",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this,this.onTap),this.observe(UserFb.ins().postFbRingInfo,this.onUpdate),this.observe(UserBag.ins().postItemCountChange,this.UseToItem),this.onUpdate()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),DisplayUtils.removeFromParent(this.eff),this.eff=null},e.prototype.onUpdate=function(){this.isUse=!1;var t=UserFb.ins().fbRings,e=0;t.canTakeAward?(e=1,this.currentState="free"):Recharge.ins().franchise?UserFb.ins().fbRings.challengeTime>0?(this.currentState="sdget",e=1):(this.currentState="sdfb",e=0):(e=0,this.currentState="challenge"),this.validateNow(),this.onInitIndex(e)},e.prototype.UseToItem=function(){this.isUse&&(this.isUse=!1,UserFb.ins().sendChallengeFbRing())},e.prototype.getChangeNum=function(t){void 0==t&&(t=UserVip.ins().lv);var e=GlobalConfig.ActorExRingFubenConfig.freeCount;return(GlobalConfig.ActorExRingFubenConfig.vipCount[t]||0)+e},e.prototype.onInitIndex=function(t){var e=UserFb.ins().fbRings,i=GlobalConfig.ActorExRingFubenConfig.reward,s=i[0].count;if(0==t)if(this.lbTime.text="今日可挑战次数："+e.challengeTime,this.lbExp.text=""+s,e.challengeTime)this.btnChallenge.enabled=!0;else{for(var n=this.getChangeNum(),o=UserVip.ins().lv+1,a=this.getChangeNum(o);void 0!=a&&a>=n&&(o+=1,a=this.getChangeNum(o),void 0!=GlobalConfig.ActorExRingFubenConfig.vipCount[o]););a-n>0&&(this.lbTime.text="VIP"+o+"可挑战次数+"+(a-n))}else if(1==t){var r=GlobalConfig.ActorExRingFubenConfig.recPrice,h=0;for(var l in r){this["lbExp"+h].textFlow=TextFlowMaker.generateTextFlow1("  "+s*(+l+1));var c=GlobalConfig.ActorExRingFubenConfig.recPrice[l];this["gold"+h].setPrice(c),h+=1}Recharge.ins().franchise&&(this.lbSweepTime.text="今日可挑战次数："+e.challengeTime),0==Setting.ins().getValue(ClientSet.expFirst)&&(this.eff||(this.eff=new MovieClip,this.eff.scaleX=.75,this.eff.scaleY=.75,this.eff.touchEnabled=!1,this.eff.x=this.btnGet2.x+this.btnGet2.width/2,this.eff.y=this.btnGet2.y+this.btnGet2.height/2,this.eff.playFile(RES_DIR_EFF+"chargeff1",-1),this.g2.addChild(this.eff))),Actor.level<80?(this.g1.visible=this.g2.visible=!1,this.g0.horizontalCenter=0):(this.g1.visible=this.g2.visible=!0,this.g0.horizontalCenter=-182)}},e.prototype.onTap=function(t){var e=t.target,i=UserFb.ins().fbRings;if(this.checkBtnGet(e));else if(e==this.btnChallenge){if(UserFb.ins().checkInFB())return;if(i.challengeTime<=0){var s="",n=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,ItemConst.FIRE_FB);return n?(s="确定使用1个<font color='#FFB82A'>"+n.itemConfig.name+"</font>道具进入挑战？\n",void WarnWin.show(s,function(){this.isUse=!0,UserBag.ins().sendUseItem(n.configID,1)},this)):i.buyTime<(GlobalConfig.ActorExRingFubenConfig.vipCount[UserVip.ins().lv]||0)?(s="是否花费"+GlobalConfig.ActorExRingFubenConfig.vipcost+"元宝挑战烈焰副本？",void WarnWin.show(s,function(){UserFb.ins().sendChallengeFbRing()},this)):(s="|C:0xff0000&T:挑战次数不足,无法挑战",void UserTips.ins().showTips(s))}UserFb.ins().sendChallengeFbRing()}},e.prototype.checkBtnGet=function(t){var e=0;if(t==this.btnGet0?e=1:t==this.btnGet1?e=2:t==this.btnGet2&&(e=3),e>0){var i=GlobalConfig.ActorExRingFubenConfig.recPrice[e-1];if(Actor.yb<i)return void UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|");var s=UserFb.ins().fbRings;s.canTakeAward?UserFb.ins().sendFbRingTakeAward(e):Recharge.ins().franchise?UserFb.ins().sendRingSweep(e):UserFb.ins().sendFbRingTakeAward(e)}return e>0},e}(BaseView);__reflect(FireRingFb.prototype,"FireRingFb");var FireRingSkillBookItem=function(t){function e(){var e=t.call(this)||this;return e.isOpenSelectImg=!0,e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChangeHandler=function(){var t=this.data.count;t>0?(this.itemIcon.imgIcon.filters=null,this.itemIcon.imgBg.filters=null):(this.itemIcon.imgIcon.filters=FilterUtil.ARRAY_GRAY_FILTER,this.itemIcon.imgBg.filters=FilterUtil.ARRAY_GRAY_FILTER)},e.prototype.onRemove=function(){this.itemIcon&&(this.itemIcon.imgIcon.filters=null,this.itemIcon.imgBg.filters=null)},e}(ItemBase);__reflect(FireRingSkillBookItem.prototype,"FireRingSkillBookItem");var Algorithm=function(){function t(){}return t.sortAsc=function(t,e){return e>t?-1:t>e?1:0},t.sortAscAttr=function(e,i,s){var n;if(void 0==s)n=t.sortAsc(e,i);else{var o=e[s],a=i[s];n=a>o?-1:o>a?1:0}return n},t.sortDesc=function(t,e){return t>e?-1:e>t?1:0},t.sortDescAttr=function(e,i,s){var n;if(void 0==s)n=t.sortDesc(e,i);else{var o=e[s],a=i[s];n=o>a?-1:a>o?1:0}return n},t.binSearch=function(e,i,s){if(void 0===s&&(s=null),!e||0==e.length)return 0;s||(s=t.sortAsc);for(var n=0,o=e.length-1;o>=n;){var a=o+n>>1,r=e[a];s(r,i)<=0?n=a+1:o=a-1}return n},t.test=function(){for(var e=[],i=10,s=0;i>s;s++){var n=Math.floor(1e5*Math.random()),o=t.binSearch(e,n);e.splice(o,0,n)}e.length!=i&&debug.log("test fail!count is "+e.length+", except:"+i);for(var a=0,r=e;a<r.length;a++){var h=r[a];debug.log(h)}for(var s=0;s<e.length-1;s++)if(e[s]>e[s+1]){debug.log("test fail!index:"+s);break}},t}();__reflect(Algorithm.prototype,"Algorithm");var RingGainItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneGainTipsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.desc.text=this.data[0]},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(RingGainItem.prototype,"RingGainItem");var SpecialRingItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ringtogglebtn",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GlobalConfig.ActorExRingConfig[this.data.id];t&&(this.addEvent(),this.ringNameTxt.text=t.name,this.textBg.visible=this.data.level>0,this.data.level>0?(this.levelTxt.text=SpecialRing.ins().getRingStair(this.data.level)+"阶",this.openLv.text="",this.noopen.visible=!1,this.ringicon.source=t.icon):(this.levelTxt.text="",this.noopen.visible=!0,this.ringicon.source=t.icon+"a",t.openDay>0&&t.openVip>0?this.openLv.text="第"+t.openDay+"天或VIP"+t.openVip+"开启":t.openDay>0?this.openLv.text="第"+t.openDay+"天开启":t.openVip>0?this.openLv.text="VIP"+t.openVip+"开启":t.openYb>0&&(this.openLv.text=t.openYb+"元宝开启")),this.updateRedPoint())},e.prototype.addEvent=function(){this.isAddEvent||(this.isAddEvent=!0,MessageCenter.addListener(UserBag.ins().postItemAdd,this.updateRedPoint,this),MessageCenter.addListener(UserBag.ins().postItemDel,this.updateRedPoint,this),MessageCenter.addListener(UserBag.ins().postItemCountChange,this.updateRedPoint,this),MessageCenter.addListener(UserVip.ins().postUpdateVipData,this.updateRedPoint,this),MessageCenter.addListener(SpecialRing.ins().postActiveRing,this.updateRedPoint,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this))},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.destruct()},e.prototype.destruct=function(){MessageCenter.ins().removeAll(this),this.isAddEvent=!1},e.prototype.updateRedPoint=function(){this.data.level>0?this.actTxt.visible=!1:this.data.id==SpecialRing.FIRE_RING_ID?this.actTxt.visible=SpecialRing.ins().isFireRingCanActivate():this.actTxt.visible=SpecialRing.ins().checkCanActive(this.data.id),this.openLv.visible=!this.actTxt.visible,this.redPoint.visible=SpecialRing.ins().checkRedPoint(this.data.id,this.data.level)},e}(BaseItemRender);__reflect(SpecialRingItem.prototype,"SpecialRingItem");var StudySkillNeedItem=function(){function t(){}return t.prototype.setData=function(t){var e=GlobalConfig.ItemConfig[t];this.itemIcon.setData(e),this.nameTxt.text=e.name},t}();__reflect(StudySkillNeedItem.prototype,"StudySkillNeedItem");var LyMarkEffect=function(){function t(t,e){this._angle=.1,this._angles=[0,0,0,0,0,0,0],this._circleCenter={x:0,y:-72},this._a=60,this._b=30,this._oldBallNum=0,this._curTimes=0,this._isShowBall=!0,this._ring=t,this._infoModel=e,MessageCenter.addListener(LyMark.ins().postMarkData,this.dataChange,this),this.usedLyMarkSkill()}return t.prototype.dataChange=function(){this._infoModel&&this._infoModel.masterHandle==Actor.handle&&this.update()},Object.defineProperty(t.prototype,"_parent",{get:function(){return this._ring.parent},enumerable:!0,configurable:!0}),t.prototype.usedLyMarkSkill=function(){this.resetBalls(),TimerManager.ins().removeAll(this);var t=this.getSkillLvById(1);if(t){var e=GlobalConfig.FlameStampEffect[1][t];t=this.getSkillLvById(3);var i=t?GlobalConfig.FlameStampEffect[3][t].reloadTime:0,s=e.skillId,n=e.stamp;this.getSkillLvById(2)&&(t=this.getSkillLvById(2),s=GlobalConfig.FlameStampEffect[2][t].skillId,n=GlobalConfig.FlameStampEffect[2][t].stamp);var o=GlobalConfig.SkillsDescConfig[GlobalConfig.SkillsConfig[s].desc],a=(o.cd-i)/n>>0;TimerManager.ins().doTimer(a,n,this.doTimer,this),this._curTimes=0}},t.prototype.doTimer=function(){this._curTimes++,this.updateBalls(this._curTimes)},t.prototype.update=function(){for(var t,e,i=0,s=0,n=0;6>=n;n++)s=t=this.getSkillLvById(n+1),t||(t=1),e=GlobalConfig.FlameStampEffect[n+1][t],n+1!=1&&n+1!=2||!s||(i=e.stamp);this.updateBalls(i)},t.prototype.updateBalls=function(t){if(this._ring&&this._parent&&t&&this._oldBallNum!=t){this.resetBalls(),this._oldBallNum=t,this._balls||(this._balls=[],TimerManager.ins().doTimer(51,0,this.doCircle,this));for(var e=void 0,i=2*Math.PI/t,s=0;t>s;s++)e=ObjectPool.pop("MovieClip"),this._isShowBall&&this._parent.addChild(e),this._angles[s]=i*s,e.x=this._a*Math.cos(i*s)+this._circleCenter.x,e.y=this._b*Math.sin(i*s)+this._circleCenter.y,this._balls.push(e),e.playFile(RES_DIR_SKILLEFF+"skill6204a",-1)}},t.prototype.doCircle=function(){if(!this._balls)return void TimerManager.ins().remove(this.doCircle,this);if(this._isShowBall&&this._ring&&this._parent)for(var t,e,i=this._balls.length,s=0,n=0,o=0;i>o;o++)t=this._balls[o],t.x=this._a*Math.cos(this._angles[o])+this._circleCenter.x,t.y=this._b*Math.sin(this._angles[o])+this._circleCenter.y,this._angles[o]+=this._angle,this._angles[o]=this._angles[o]%(2*Math.PI),e=t.parent,s=e.getChildIndex(this._ring),n=e.getChildIndex(t),this._angles[o]>=2.5&&this._angles[o]<=6?n>s&&e.addChildAt(t,s):s>n&&e.addChildAt(t,e.numChildren)},t.prototype.resetBalls=function(){if(TimerManager.ins().remove(this.doCircle,this),this._oldBallNum=0,this._balls){for(var t=this._balls.length,e=0;t>e;e++)this._balls[e].destroy();this._balls=null}},t.prototype.getSkillLvById=function(t){var e=this._infoModel.masterHandle==Actor.handle?LyMark.ins().skills:this._infoModel.lyMarkSkills;return!e||e.length<t?0:e[t-1]},t.prototype.getLyMarkLv=function(){return this._infoModel.masterHandle==Actor.handle?LyMark.ins().lyMarkLv:this._infoModel.lyMarkLv},t.prototype.showBall=function(){if(!this._isShowBall&&(this._isShowBall=!0,this.updateBalls(this._curTimes),this._balls))for(var t=this._balls.length,e=0;t>e;e++)this._parent.addChild(this._balls[e])},t.prototype.hideBall=function(){this._isShowBall&&(this._isShowBall=!1,this.resetBalls())},t.prototype.destruct=function(){this.resetBalls(),TimerManager.ins().removeAll(this),this._ring=null,this._infoModel=null,MessageCenter.ins().removeAll(this)},t}();__reflect(LyMarkEffect.prototype,"LyMarkEffect");var LyMarkMixItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="markMixItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.MixBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){var t=this.data.cfg.costItem;this.limitLv.textFlow=TextFlowMaker.generateTextFlow1(this.data.cfg.mixDesc),this.cost.textFlow=TextFlowMaker.generateTextFlow1(t?"合成消耗："+("|C:"+(this.data.count?13746831:16711680)+"&T:"+this.data.itemName+" X"+this.data.cfg.costCount):""),this.stock.textFlow=TextFlowMaker.generateTextFlow1("当前拥有：|C:"+(this.data.itemCount?65280:16711680)+"&T:"+this.data.itemCount),this.MixBtn.label=t?"一键合成":"获取",this.MixBtn.enabled=!t||LyMark.ins().lyMarkLv>=this.data.cfg.limitLv,this.redpoint.visible=t&&LyMark.ins().lyMarkLv>=this.data.cfg.limitLv&&this.data.count>=this.data.cfg.costCount,this.itemIcon.data=this.data.cfg.itemId},e.prototype.onTap=function(t){this.data.cfg.costItem?this.data.count>=this.data.cfg.costCount?LyMark.ins().sendCompound(this.data.cfg.itemId):UserTips.ins().showTips("材料不足"):UserWarn.ins().setBuyGoodsWarn(this.data.cfg.itemId)},e.prototype.destruct=function(){this.MixBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(LyMarkMixItemRender.prototype,"LyMarkMixItemRender");var LyMarkMixWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="markMixSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=LyMarkMixItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(UserBag.ins().postItemAdd,this.update),this.observe(UserBag.ins().postItemChange,this.update),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve()},e.prototype.update=function(){this._collect||(this._collect=new ArrayCollection,this.list.dataProvider=this._collect);var t,e,i,s,n,o=[];for(var a in GlobalConfig.FlameStampMat)e=GlobalConfig.FlameStampMat[a],e.costItem?(t=UserBag.ins().getBagItemById(e.costItem),s=GlobalConfig.ItemConfig[e.costItem].name,i=t?t.count:0):(i=0,s=""),t=UserBag.ins().getBagItemById(e.itemId),n=t?t.count:0,o.push({cfg:e,count:i,itemName:s,itemCount:n});this._collect.source=o},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(LyMarkMixWin.prototype,"LyMarkMixWin"),ViewManager.ins().reg(LyMarkMixWin,LayerManager.UI_Main);var LyMarkPanel=function(t){function e(){var e=t.call(this)||this;return e._angle=.1,e._angles=[0,0,0,0,0,0,0],e._circleCenter={x:279,y:229},e._a=155,e._b=80,e._oldBallNum=0,e.expBar=new ProgressBarEff,e
}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mixItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.mixItemTxt.text),this.expBar.setWidth(470),this.expBar.x=-85,this.expBar.y=-15,this.schedule.addChild(this.expBar)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(LyMark.ins().postMarkData,this.update),this.observe(UserBag.ins().postItemAdd,this.updateMaterial),this.observe(UserBag.ins().postItemChange,this.updateMaterial),this.observe(LyMark.ins().postUpgrade,this.updateEff),this.addTouchEvent(this,this.onTouch),this._oldBallNum=0,this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve(),this._materailInfo=null,this.resetBalls(),this.clearRedEff(),this.expBar.reset()},e.prototype.resetBalls=function(){if(TimerManager.ins().removeAll(this),this._balls){for(var t=this._balls.length,e=0;t>e;e++)this._balls[e].destroy(),this._balls[e]=null;this._balls.length=0,this._balls=null}},e.prototype.update=function(){var t=LyMark.ins().isMax,e=LyMark.ins().lyMarkLv;this.currentState=t?"max":"normal",this.lvtxt.text="Lv."+LyMark.ins().lyMarkLv;var i=[],s=GlobalConfig.FlameStampLevel[e];for(var n in s.attrs)i.push(new AttributeData(s.attrs[n].type,s.attrs[n].value));var o=UserBag.getAttrPower(i);if(this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"：")),this.expBar.getMaxValue()!=s.exp?this.expBar.setData(LyMark.ins().lyMarkExp,s.exp):this.expBar.setValue(LyMark.ins().lyMarkExp),t)this.clearRedEff();else{i=[];var a=GlobalConfig.FlameStampLevel[e+1];for(var n in a.attrs)i.push(new AttributeData(a.attrs[n].type,a.attrs[n].value));this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："));var r=GlobalConfig.ItemConfig[s.costItem];this.costImg.source=r.icon+"_png",this.updateMaterial()}for(var h,l,c=0,u=0,p=0;6>=p;p++)u=h=LyMark.ins().getSkillLvById(p+1),h||(h=1),l=GlobalConfig.FlameStampEffect[p+1][h],this["skill"+p].setCfg(l),p+1!=1&&p+1!=2||!u||(c=l.stamp),u&&(o+=l.exPower);var d=SubRoles.ins().subRolesLen;if(this.power.setPower(o*d),c&&this._oldBallNum!=c){this.resetBalls(),this._oldBallNum=c,this._balls||(this._balls=[],TimerManager.ins().doTimer(51,0,this.doCircle,this));for(var g=void 0,f=2*Math.PI/c,p=0;c>p;p++)g=ObjectPool.pop("MovieClip"),this.img.parent.addChild(g),this._angles[p]=f*p,g.x=this._a*Math.cos(f*p)+this._circleCenter.x,g.y=this._b*Math.sin(f*p)+this._circleCenter.y,this._balls.push(g),g.playFile(RES_DIR_EFF+"lymarkeff",-1)}},e.prototype.doCircle=function(){if(!this._balls)return void TimerManager.ins().removeAll(this);for(var t,e,i=this._balls.length,s=0,n=0,o=0;i>o;o++)t=this._balls[o],t.x=this._a*Math.cos(this._angles[o])+this._circleCenter.x,t.y=this._b*Math.sin(this._angles[o])+this._circleCenter.y,this._angles[o]+=this._angle,this._angles[o]=this._angles[o]%(2*Math.PI),e=t.parent,s=e.getChildIndex(this.img),n=e.getChildIndex(t),this._angles[o]>=2.5&&this._angles[o]<=6?n>s&&e.addChildAt(t,3):s>n&&e.addChildAt(t,e.numChildren)},e.prototype.updateMaterial=function(){if(!LyMark.ins().isMax){var t=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv],e=UserBag.ins().getBagItemById(t.costItem),i=e?e.count:0;this.costCount.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(i<t.costCount?"0xFF0000":"0x00FF00")+"&T:"+i+"|/"+t.costCount),this._materailInfo={enough:i>=t.costCount,id:t.costItem};var s=t.exp-LyMark.ins().lyMarkExp;i>=t.costCount&&i*GlobalConfig.FlameStampMat[t.costItem].exp>=s?this._redEffect||(this._redEffect=ObjectPool.pop("MovieClip"),this._redEffect.touchEnabled=!1,this.lvupGroup.addChild(this._redEffect),this._redEffect.x=77,this._redEffect.y=28,this._redEffect.playFile(RES_DIR_EFF+"chargeff1",-1)):this.clearRedEff()}},e.prototype.clearRedEff=function(){this._redEffect&&(this._redEffect.destroy(),this._redEffect=null)},e.prototype.onTouch=function(t){switch(t.target){case this.lvupBtn:this._materailInfo.enough?LyMark.ins().sendUpgrade():UserTips.ins().showTips("材料不足");break;case this.mixItemTxt:ViewManager.ins().open(LyMarkMixWin);break;case this.skill0:case this.skill1:case this.skill2:case this.skill3:case this.skill4:case this.skill5:case this.skill6:ViewManager.ins().open(LyMarkSkillTipsWin,t.target.getCfg())}},e.prototype.updateEff=function(t){var e=t[0];if(e>1){var i=new eui.Image("xn_wingup"+e);i.horizontalCenter=0,i.verticalCenter=0,i.scaleX=i.scaleY=.5;var s=egret.Tween.get(i);s.to({scaleX:1.5,scaleY:1.5,alpha:0},500).call(function(){DisplayUtils.removeFromParent(i)},this),this.actEff.addChild(i)}},e}(BaseEuiView);__reflect(LyMarkPanel.prototype,"LyMarkPanel");var LyMarkSkillItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.touchChildren=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.setCfg=function(t){this._cfg=t,this.update()},e.prototype.getCfg=function(){return this._cfg},e.prototype.addToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),MessageCenter.addListener(LyMark.ins().postMarkData,this.update,this),MessageCenter.addListener(UserBag.ins().postItemAdd,this.update,this),MessageCenter.addListener(UserBag.ins().postItemChange,this.update,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)},e.prototype.removeStage=function(t){MessageCenter.ins().removeAll(this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)},e.prototype.update=function(){if(this._cfg){this.skillImg.source=this._cfg.icon,this.skillName.textFlow=TextFlowMaker.generateTextFlow1(this._cfg.skillname);var t=LyMark.ins().getSkillLvById(this._cfg.id);if(this.lock.visible=!t,this.redpoint.visible=!1,1!=this._cfg.id){var e=t>=Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;if(e)return;var i=GlobalConfig.FlameStampEffect[this._cfg.id][0>=t?1:t+1];if(i.costItem){var s=(GlobalConfig.ItemConfig[i.costItem],UserBag.ins().getBagItemById(i.costItem)),n=s?s.count:0;this.redpoint.visible=n>=i.costCount&&LyMark.ins().lyMarkLv>=i.stampLevel}}}},e}(eui.Component);__reflect(LyMarkSkillItem.prototype,"LyMarkSkillItem");var LyMarkSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="markSkillTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._cfg=t[0],this.addTouchEvent(this,this.onTouch),this.observe(LyMark.ins().postMarkData,this.resetCfg),this.observe(UserBag.ins().postItemAdd,this.updateData),this.observe(UserBag.ins().postItemChange,this.updateData),this.updateData()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch),this.removeObserve(),this._uiEffect&&(this._uiEffect.destroy(),this._uiEffect=null)},e.prototype.resetCfg=function(){var t=LyMark.ins().getSkillLvById(this._cfg.id);t||(t=1),this._cfg=GlobalConfig.FlameStampEffect[this._cfg.id][t],this.updateData()},e.prototype.updateData=function(){this.currentState="skill"+(this._cfg.id-1),this.skillImg.source=this._cfg.icon,this.nametxt.text=this._cfg.skillname;var t=LyMark.ins().getSkillLvById(this._cfg.id);if(this.lvtxt.text="Lv."+t,this.redpoint.visible=!1,this.nextLevel.text="",1==this._cfg.id){var e=0,i=LyMark.ins().getSkillLvById(3),s=i?GlobalConfig.FlameStampEffect[3][i].reloadTime:0,n=this._cfg.skillId,o=this._cfg.stamp;t?LyMark.ins().getSkillLvById(2)&&(i=LyMark.ins().getSkillLvById(2),n=GlobalConfig.FlameStampEffect[2][i].skillId,o=GlobalConfig.FlameStampEffect[2][i].stamp):s=0;var a=GlobalConfig.SkillsDescConfig[GlobalConfig.SkillsConfig[n].desc];e=(a.cd-s)/1e3>>0,this.keyDesctxt.text="充能时间："+e+"秒",this.skillDesctxt.textFlow=TextFlowMaker.generateTextFlow1(a.desc.replace("{0}","|C:65280&T:"+(e/o>>0)+"|").replace("{1}","|C:65280&T:"+o+"|")),this.damageDesctxt.textFlow=TextFlowMaker.generateTextFlow1(LyMark.ins().lyMarkLv?GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv].bulletDesc:"")}else{2==this._cfg.id||3==this._cfg.id||7==this._cfg.id?this.keyDesctxt.text="最大等级："+Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length:this.keyDesctxt.text="触发概率："+(GlobalConfig.EffectsConfig[4==this._cfg.id?this._cfg.selfEffId:this._cfg.effId].probabilityBuff/100>>0)+"%",this.skillDesctxt.textFlow=TextFlowMaker.generateTextFlow1(this._cfg.skillDesc);var r=t>=Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;if(this.cost.visible=!1,this.update.visible=!1,!r){var h=GlobalConfig.FlameStampEffect[this._cfg.id][0>=t?1:t+1];if(h.costItem){var l=GlobalConfig.ItemConfig[h.costItem];this.costImg.source=l.icon+"_png";var c=UserBag.ins().getBagItemById(h.costItem),o=c?c.count:0;this.costNum.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(o<h.costCount?16711680:13746831)+"&T:X "+h.costCount+"|"),this.redpoint.visible=o>=h.costCount&&LyMark.ins().lyMarkLv>=h.stampLevel,this._nextCfg=h,LyMark.ins().lyMarkLv>=h.stampLevel?(this.cost.visible=o<h.costCount,this.update.visible=!this.cost.visible):this.nextLevel.text="烈焰印记达到"+h.stampLevel+"级解锁升级"}else LyMark.ins().lyMarkLv<h.stampLevel&&(this.nextLevel.text="烈焰印记达到"+h.stampLevel+"级自动升级")}}this._uiEffect||(this._uiEffect=ObjectPool.pop("MovieClip"),this.uieff.addChild(this._uiEffect)),this._uiEffect.playFile(""+RES_DIR_EFF+this._cfg.uiEff,-1)},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.update:this.redpoint.visible?LyMark.ins().sendUpSkill(this._cfg.id):this._nextCfg.stampLevel>LyMark.ins().lyMarkLv?UserTips.ins().showTips("需要烈焰印记达到"+this._nextCfg.stampLevel+"级"):UserTips.ins().showTips("材料不足")}},e}(BaseEuiView);__reflect(LyMarkSkillTipsWin.prototype,"LyMarkSkillTipsWin"),ViewManager.ins().reg(LyMarkSkillTipsWin,LayerManager.UI_Main);var RingDetailPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRAttrSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.attrValue.text=AttributeData.getAttStr(i,0,1,"    ",!1,!1),this.addTouchEndEvent(this.bgClose,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RingDetailPanel.prototype,"RingDetailPanel"),ViewManager.ins().reg(RingDetailPanel,LayerManager.UI_Popup);var specialRing=GameSystem.specialRing,RingInfoView=function(t){function e(){var e=t.call(this)||this;return e.barbc=new ProgressBarEff,e.cruCostId=0,e.isAutoUp=!1,e.canUpdate=!1,e.FIRE_RING_ID=7,e.skinName="ring",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.barbc.setWidth(400),this.barbc.x=-15,this.barbc.y=25,this.barGroup.addChild(this.barbc),this.starList=new StarList(SpecialRing.perStar),this.starList.x=15,this.starList.y=0,this.star.addChild(this.starList),this.iconMc=new MovieClip,this.iconMc.x=0,this.iconMc.y=0,this.ringMcGroup.addChild(this.iconMc),this.reliveEff=new MovieClip,this.reliveEff.x=200,this.reliveEff.y=62,this.reliveEff.scaleX=1.15,this.baojiMc=new MovieClip,this.baojiMc.x=245,this.baojiMc.y=650,this.menuList.itemRenderer=SpecialRingItem,this.menuList.selectedIndex=0,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.ringget.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.ringget.text+"</u></a>"),this.upgradebtn.label="进阶",this.uplevel.label="升星",this.countTxt.textColor=ColorUtil.NORMAL_COLOR},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.uplevel,this.onTap),this.addTouchEvent(this.acivebtn,this.onTap),this.addTouchEvent(this.ringget,this.onTap),this.addTouchEvent(this.upgradebtn,this.onTap),this.addTouchEvent(this.goQuicklyOpen,this.onQuickOpen),this.observe(SpecialRing.ins().postUnLock,this.updateView),this.observe(UserTask.ins().postUpdateAchieve,this.updateView),this.observe(SpecialRing.ins().postSpicelRingUpdate,this.playEffect),this.observe(SpecialRing.ins().postActiveRing,this.showActivityView),this.observe(SpecialRing.ins().postActiveRing,this.updateView),this.observe(SpecialRing.ins().postSRStairUp,this.updateView),this.barbc.reset(),this.updateView(),this.setIcon()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.uplevel,this.onTap),this.removeTouchEvent(this.ringget,this.onTap),this.removeTouchEvent(this.acivebtn,this.onTap),this.removeTouchEvent(this.upgradebtn,this.onTap),DisplayUtils.removeFromParent(this.reliveEff),this.removeObserve(),this.isAutoUp&&this.stopAutoUp()},e.prototype.onQuickOpen=function(t){var e=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID],i=e.useYb;Actor.yb>=i?SpecialRing.ins().sendActiveRing(SpecialRing.FIRE_RING_ID,1):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.uplevel:this.warnShow();break;case this.acivebtn:this.currData.id==SpecialRing.FIRE_RING_ID?SpecialRing.ins().requestDeblock(this.currData.id):SpecialRing.ins().sendActiveRing(this.currData.id);break;case this.upgradebtn:UserTips.ins().showTips("排版优化 屏蔽升级功能");break;case this.ringget:UserWarn.ins().setBuyGoodsWarn(this.cruCostId)}},e.prototype.showActivityView=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActorExRingConfig[this.currData.id];this.currData.id==SpecialRing.FIRE_RING_ID?(ViewManager.ins().close(this),ViewManager.ins().open(FireRingWin)):this.upDateItem.apply(this,t),Activationtongyong.show(0,i.name,"j"+i.icon+"_png")},e.prototype.upDateItem=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0;t&&t[0]&&(i=t[0][0]);var s=SpecialRing.ins().getSpecialRingDataById(i),n=GlobalConfig.ActorExRingConfig[this.currData.id];this.menuListData.replaceItemAt(s,n.order-1),this.currData=s,this.updateDetail(!0)},e.prototype.playEffect=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.upDateItem.apply(this,e);var s=0,n=GlobalConfig.ActorExRingConfig[this.currData.id];e&&e[0]&&(s=e[0][1]);var o=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);s>0&&(this.baojiMc.playFile(RES_DIR_EFF+"moneytreecrit",1),this.addChild(this.baojiMc));var a=new eui.Label;a.size=14,a.textColor=3532333,a.width=450,a.textAlign=egret.HorizontalAlign.CENTER,a.x=19,a.y=420,a.text=n.name+"经验增加"+o.addPower,this.addChild(a);var r=egret.Tween.get(a);r.to({y:a.y-45},500).call(function(){t.removeChild(a)},this)},e.prototype.onClickMenu=function(t){var e=this.specialDatas[t.currentTarget.selectedIndex];e&&(this.barbc.reset(),this.currData=e,this.updateDetail(),this.setIcon())},e.prototype.setIcon=function(){var t=GlobalConfig.ActorExRingConfig[this.currData.id];if(!GlobalConfig.DefineEff[t.effid])return void egret.log(t.name+"特效ID出错啦");var e=GlobalConfig.DefineEff[t.effid].souce;this.iconMc.playFile(RES_DIR_EFF+e,-1)},e.prototype.updateView=function(){this.updateMenuList(),this.updateDetail()},e.prototype.updateMenuList=function(){if(this.specialDatas=CommonUtils.copyDataHandler(SpecialRing.ins().ringList),this.menuListData.source=this.specialDatas.sort(function(t,e){return Algorithm.sortAscAttr(t,e,"order")}),this.currData){for(var t in this.specialDatas)if(this.currData.id==this.specialDatas[t].id){this.currData=this.specialDatas[t];break}}else this.currData=this.specialDatas[0]},e.prototype.updateFuseView=function(){var t=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.price0.setPrice(t.useYb)},e.prototype.updateDetail=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ActorExRingConfig[this.currData.id],i=SpecialRing.ins().isFireRingActivate();if(i)this.currentState="tejie8",this.updateFuseView(),this.currData.id=this.FIRE_RING_ID;else if(this.currData.id==this.FIRE_RING_ID){this.currentState="disable",this.resetUI(),this.attrBg0.visible=!1,this.acivebtn.label="解封";var s=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.ringname.text=""+s.name,this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(s)),this.openDesc.text="第8天激活全部特戒后解锁",SpecialRing.ins().isFireRingCanActivate()?(this.acivebtn.visible=!0,this.openDesc.visible=!1,this.addReliveEff()):(this.acivebtn.visible=!1,this.openDesc.visible=!0,DisplayUtils.removeFromParent(this.reliveEff))}else{this.attrBg0.visible=!0,this.acivebtn.label="激活";var n=0==this.currData.level?1:this.currData.level,o=SpecialRing.ins().getRingConfigById(this.currData.id,n),a=SpecialRing.ins().getRingStair(this.currData.level);if(this.ringname.text=""+e.name,this.stageImg.setValue(a),this.currData.level>0)if(Actor.level>=e.needLevel&&UserZs.ins().lv>=e.needZs)SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)?this.currentState="open":this.currentState="final",this.setOpenInfo(t);else if(this.currentState="wait",this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(e)),this.openLevelDesc.text="达到"+(e.needZs>0?e.needZs+"转":"")+(e.needLevel>0?e.needLevel+"级":"")+"后特戒开启飞升",o.attrAward){this.setLayoutAttr(o);var r=UserBag.getAttrPower(o.attrAward);this.powerPanel.setPower(r)}else this.setLayoutAttr(o,!0),this.powerPanel.setPower(0);else{if(this.currentState="disable",o.attrAward){this.setLayoutAttr(o);var r=UserBag.getAttrPower(o.attrAward);this.powerPanel.setPower(r)}else this.setLayoutAttr(o,!0),this.powerPanel.setPower(0);this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(e));var h=SpecialRing.ins().checkRedPoint(this.currData.id,this.currData.level);if(h)this.openDesc.text="",this.acivebtn.visible=!0,this.addReliveEff();else{var l=GlobalConfig.ActorExRingConfig[this.currData.id];this.acivebtn.visible=!1,this.openDesc.text="第"+l.openDay+"天或VIP"+l.openVip+"开启",DisplayUtils.removeFromParent(this.reliveEff)}this.canUpdate=!1}this.skillname.text=o.SpecialRingSkin}},e.prototype.addReliveEff=function(){this.reliveEff.playFile(RES_DIR_EFF+"chargeff1",-1),this.reliveEff.parent||this.aciveGroup.addChild(this.reliveEff)},e.prototype.resetUI=function(){this.setLayoutAttr(null,!0),this.Explain0.text="",this.skillname.text="",this.openDesc.text=""},e.prototype.setLayoutAttr=function(t,e){for(var i=0;4>i;i++)if(e)this["attrLabel"+(i+1)].text="";else{var s=AttributeData.getAttStr(this.getAttrArray(t.attrAward),1),n=s.split("\n");this["attrLabel"+(i+1)].text=n[i]}},e.prototype.getAttrArray=function(t){for(var e=[11,12,23,24],i=[],s=0;s<t.length;s++)e.indexOf(t[s].type)<0&&i.push(t[s]);return i},e.prototype.setOpenInfo=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ActorExRingConfig[this.currData.id],i=0==this.currData.level?1:this.currData.level,s=SpecialRing.ins().getRingConfigById(this.currData.id,i);this.cruCostId=s.costItem,this.Explain0.textFlow=this.Explain.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(e));var n=UserBag.ins().getBagGoodsCountById(0,s.costItem);this.countTxt.text="需要"+GlobalConfig.ItemConfig[s.costItem].name+":";var o="";o=n>=s.cost?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.useTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+o+">"+n+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+s.cost+"</font> "),this.canUpdate=n>=s.cost;var a;this.upgradebtn.visible=!1,"final"!=this.currentState&&(this.uplevel.visible=!0);var r=SpecialRing.ins().getRingStar(this.currData.level);if(s.judgeup>0?(a=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1),this.currData.exp>=s.upPower?(this.starList.setStarNum(r,Number(t)),this.upgradebtn.visible=!0,this.uplevel.visible=!1,SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)?this.upgradebtn.label="进阶":this.upgradebtn.label="已满级"):this.starList.setStarNum(r,Number(t))):(a=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1),this.starList.setStarNum(r,Number(t))),a&&(a.attrAward?this.nextAttrLabel.text=AttributeData.getAttStr(this.getAttrArray(a.attrAward),1):this.nextAttrLabel.text=""),this.expBarChange(),s.attrAward){this.setLayoutAttr(s);var h=UserBag.getAttrPower(s.attrAward);this.powerPanel.setPower(h)}else this.setLayoutAttr(s,!0),this.attrLabel.text="",this.powerPanel.setPower(0)},e.prototype.warnShow=function(){if(!this.canUpdate){var t=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);return void UserTips.ins().showTips(GlobalConfig.ItemConfig[t.costItem].name+"不足")}var e=GlobalConfig.ActorExRingConfig[this.currData.id];Actor.level>=e.needLevel&&UserZs.ins().lv>=e.needZs||UserTips.ins().showTips(""+(e.needZs>0?e.needZs+"转":"")+(e.needLevel>0?e.needLevel+"级":"")+"可飞升"),SpecialRing.ins().sendSpicelRingUpdate(this.currData.id)},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,TimerManager.ins().remove(this.autoUpStar,this)},e.prototype.autoUpStar=function(){var t=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level),e=UserBag.ins().getBagGoodsCountById(0,t.costItem);e?SpecialRing.ins().sendSpicelRingUpdate(this.currData.id):(this.isAutoUp=!1,TimerManager.ins().remove(this.autoUpStar,this))},e.prototype.expBarChange=function(){var t=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level),e=t.upPower,i=this.currData.exp;i=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)?this.currData.exp>e?e:this.currData.exp:e,this.barbc.getMaxValue()!=e?this.barbc.setData(i,e):this.barbc.setValue(i)},e.prototype.countStrDesc=function(t){var e=0==this.currData.level?1:this.currData.level,i=SpecialRing.ins().getRingConfigById(this.currData.id,e),s=t.explain.split("$"),n="";if(s.length>0)for(var o=0;o<s.length;o++)if(Number(s[o])){var a=Number(s[o]),r=void 0;r=a/200>=1?i.extAttrAward:i.attrAward;for(var h in r)if(r[h].type==a%100){n+=a>200?AttributeData.getExtAttStrByType(r[h],0,"",!1,!1):AttributeData.getAttStrByType(r[h],0,"",!1,!1);break}}else n+=s[o];else n=t.explain;return n},e}(BaseEuiView);__reflect(RingInfoView.prototype,"RingInfoView"),ViewManager.ins().reg(RingInfoView,LayerManager.UI_Main);var RingTurnDisplayer=function(t){function e(){var e=t.call(this)||this;return e.gAngle=180,e.gHasReset=!0,e.gInitPos=!0,e.isMaxX=!1,e.isMaxY=!1,e.gemPos1=[64,-52,-68,-80,-84,-80,-64,-90,-50,-100,40,-110,64,-80,64,-52],e.mc=new MovieClip,e.gFollowItem=new egret.DisplayObjectContainer,e.addChild(e.gFollowItem),e.gCenterPos=new egret.Point,e.gTurnItem=new egret.DisplayObjectContainer,e.gTurnItem.addChild(e.mc),e.gFollowItem.addChild(e.gTurnItem),TimerManager.ins().doTimer(20,0,e.update,e),e}return __extends(e,t),e.prototype.setOwner=function(t){this.gOwner=t,this.gTurnTime=1e4+1e4*Math.random()+egret.getTimer(),this.gAngle=e.STAR_ANGLE,this.gStopTime=0},e.prototype.update=function(){this.gInitPos?(this.gFollowItem.x=e.TARGET_POINT_X,this.gFollowItem.y=e.TARGET_POINT_Y-this.gOwner.height,this.gInitPos=!1):(this.gFollowItem.x=this.gFollowItem.x-(this.gOwner.x-this.gOwnerLastX),this.gFollowItem.y=this.gFollowItem.y-(this.gOwner.y-this.gOwnerLastY)),this.gCenterPos=new egret.Point(this.effectX,this.effectY),this.moveCenterPoint(),this.gOwnerLastX=this.gOwner.x,this.gOwnerLastY=this.gOwner.y},e.prototype.setEffectXY=function(t){var e=this.gemPos1[2*t],i=this.gemPos1[2*t+1];this.effectX=e+Math.ceil(100*Math.random()-50),this.effectY=i+Math.ceil(100*Math.random()-50)},e.prototype.moveCenterPoint=function(){var t,i=this.gCenterPos.x-this.gFollowItem.x;0!=i&&(Math.abs(i)>e.MAX_DIS?(t=2*Math.ceil(Math.abs(i)*e.SPEED_RATIO)*3/2,i>0?i>t&&(this.gFollowItem.x=this.gFollowItem.x+t):0>i&&Math.abs(i)>t&&(this.gFollowItem.x=this.gFollowItem.x-t)):(this.isMaxX=!1,t=3*Math.ceil(Math.abs(i)*e.SPEED_RATIO)/2*1.35,i>0?i>t&&(this.gFollowItem.x=this.gFollowItem.x+t):0>i&&Math.abs(i)>t&&(this.gFollowItem.x=this.gFollowItem.x-t)));var s=this.gCenterPos.y-this.gFollowItem.y;0!=s&&(Math.abs(s)>e.MAX_DIS?(t=2*Math.ceil(Math.abs(s)*e.SPEED_RATIO)*3/2,s>=0?s>t&&(this.gFollowItem.y=this.gFollowItem.y+t):0>s&&Math.abs(s)>t&&(this.gFollowItem.y=this.gFollowItem.y-t)):(this.isMaxY=!1,t=3*Math.ceil(Math.abs(s)*e.SPEED_RATIO)/2*1.35,s>=0?s>t&&(this.gFollowItem.y=this.gFollowItem.y+t):0>s&&Math.abs(s)>t&&(this.gFollowItem.y=this.gFollowItem.y-t)))},e.prototype.setModel=function(t,e,i){if(this.infomodel=e,e.masterHandle&&e.masterHandle==Actor.handle){if(0>t||null==t)return;if(EntityManager.ins().getMainRole(0)&&EntityManager.ins().getMainRole(0).infoModel.handle!=e.handle)return}return e.masterHandle&&SpecialRing.ins().hasHanlder(e.masterHandle)?void(this.lastID!=t&&(this.showRing(t),this.lastID=t)):(this.showRing(t),void i.addChild(this))},e.prototype.showRing=function(t){this.mc.alpha=1,this.ringInfo=GlobalConfig.ActorExRingConfig[t];var e=GlobalConfig.MonstersConfig[this.ringInfo.avatarFileName];this.mc.playFile(RES_DIR_MONSTER+"monster"+e.avatar+"_0a",-1)},e.prototype.reset=function(){this.mc&&DisplayUtils.removeFromParent(this.mc),SpecialRing.ins().delHanlder(this.infomodel.masterHandle),this.gOwnerLastX=0,this.gOwnerLastY=0,this.gCenterPos.x=0,this.gCenterPos.y=0,this.gHasReset=!0,this.gInitPos=!0,this.gModelUrl="",TimerManager.ins().removeAll(this)},e}(egret.DisplayObjectContainer);RingTurnDisplayer.TARGET_POINT_X=95,RingTurnDisplayer.TARGET_POINT_Y=-40,RingTurnDisplayer.MAX_DIS=60,RingTurnDisplayer.STAR_ANGLE=0,RingTurnDisplayer.SPEED_RATIO=.015,__reflect(RingTurnDisplayer.prototype,"RingTurnDisplayer");var RingUpgradeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRUltraSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addBossImg=function(t){this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=this.ring0eff.width/2,this.bossImage.y=115,this.ring0eff.addChild(this.bossImage);var e=GlobalConfig.MonstersConfig[t];this.bossImage.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1)},e.prototype.addNextBossImg=function(t){this.nextBossImage=new MovieClip,this.nextBossImage.scaleX=-1,this.nextBossImage.scaleY=1,this.nextBossImage.x=this.ring1eff.width/2,this.nextBossImage.y=115,this.ring1eff.addChild(this.nextBossImage);var e=GlobalConfig.MonstersConfig[t];this.nextBossImage.playFile(RES_DIR_MONSTER+("monster"+e.avatar+"_3s"),-1)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.colorCanvas,this.otherClose);var i=SpecialRing.ins().getAbilityID();0==i&&(i=1);var s=SpecialRing.ins().abilityIds[i];s=s?s:1;var n=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][i][s],o=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID].monsterId,a=o+n.monId;this.abilityDesc.textFlow=TextFlowMaker.generateTextFlow(n.abilityDesc),this.addBossImg(o),this.addNextBossImg(a)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RingUpgradeWin.prototype,"RingUpgradeWin"),ViewManager.ins().reg(RingUpgradeWin,LayerManager.UI_Popup);var SpecialRingWin=function(t){function e(){var e=t.call(this)||this;return e.ringLv=0,e.skinName="RingTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.iconMc=new MovieClip,this.iconMc.x=170,this.iconMc.y=160,this.gainList0.itemRenderer=RingGainItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],null==t[1]&&(t[1]=0),this.roleSelect.setCurRole(t[1]),this.iconMc&&!this.iconMc.parent&&this.mcGroup.addChild(this.iconMc),this.addTouchEvent(this.btnUse,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.gainList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.addSpecialListener(),this.observe(UserBag.ins().postItemAdd,this.roleChange),this.observe(UserBag.ins().postItemChange,this.roleChange);var i=GlobalConfig.ExRingConfig[this.index],s=GlobalConfig.GainItemConfig[i.costItem];this.gainList0.dataProvider=new eui.ArrayCollection(s.gainWay),this.roleChange()},e.prototype.addSpecialListener=function(){this.observe(SpecialRing.ins().postRingUpdate,this.roleChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.colorCanvas0,this.onTap),this.removeTouchEvent(this.btnUse,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.gainList0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),DisplayUtils.removeFromParent(this.iconMc),this.removeObserve()},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&GameGuider.guidance(e[1],e[2],!0)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this);break;case this.btnUse:"激活"==this.btnUse.label?this.sendUpgrade():this.openBuyGoods()}},e.prototype.showIcon=function(){var t=this.index?"hushen":"mabi";this.iconMc.playFile(RES_DIR_EFF+t,-1)},e.prototype.roleChange=function(t){void 0===t&&(t=!1),this.setRedPoint();var e=this.roleSelect.getCurRole();this.ringLv=SubRoles.ins().getSubRoleByIndex(e).getExRingsData(this.index),this.showIcon();var i=GlobalConfig.ExRingConfig[this.index],s=GlobalConfig["ExRing"+this.index+"Config"][0],n=GlobalConfig["ExRing"+this.index+"Config"][1];if(0==this.ringLv){var o=(CommonUtils.getObjectLength(GlobalConfig["ExRing"+this.index+"Config"]),UserBag.ins().getBagGoodsCountById(0,i.costItem)),a="";a=o>=s.cost?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,o<s.cost?this.currentState="lock":this.currentState="active",this.validateNow(),this.tips.source="tjweijihuo"}else this.currentState="actived",this.validateNow(),this.tips.source="tjyijihuo";var r=0;if(n){for(var h="",l=0,c=0,u=0,p="",d=0;d<n.attrAward.length;d++)c=n.attrAward[d].type,15!=c&&13!=c&&(h=AttributeData.getAttrStrByType(c),l=n.attrAward[d].value,h.length<3&&(h=AttributeData.inserteBlank(h,7)),this["attr"+u].text=h+"：",c>1&&9>c?p=7==c||8==c?l/100+"%":l.toString():(c>12&&15>c||c>15)&&(p=c==AttributeType.atCritEnhance?l/100+150+"%":l/100+"%"),this["value"+u].text=p,u++);r=UserBag.getAttrPower(n.attrAward),r+=n.power,this.powerPanel.setPower(r),this.powerPanel.setMcVisible(!1);var g=GlobalConfig.ItemConfig[i.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(g.desc),this.nameLabel.text=""+i.name}},e.prototype.sendUpgrade=function(){SpecialRing.ins().sendUpGrade(this.index,this.roleSelect.getCurRole())},e.prototype.openBuyGoods=function(){UserWarn.ins().setBuyGoodsWarn(GlobalConfig.ExRingConfig[this.index].costItem)},e.prototype.setRedPoint=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);this.roleSelect.showRedPoint(e,UserRole.ins().roleHintCheck(i,this.index))}},e.prototype.getPower=function(){return"actived"==this.currentState?this.powerPanel.power:0},e}(BaseEuiView);__reflect(SpecialRingWin.prototype,"SpecialRingWin"),ViewManager.ins().reg(SpecialRingWin,LayerManager.UI_Main);var TargetListCC=function(t){function e(){var e=t.call(this)||this;return e.masterAtkTarget={},e.tipsCD=!1,e.attackMeHandles=[],e.canAttackHandles=[],e.observe(GameLogic.ins().postEntityHpChange,e.attackAndShowTip),e.observe(BattleCC.ins().postEnterSuccess,e.campChange),e.observe(GameLogic.ins().postAllAtkTarget,e.updateAtkTarget),e.observe(GameLogic.ins().postEnterMap,e.onEnterMap),e}return __extends(e,t),e.prototype.onEnterMap=function(){var t=this;this.masterAtkTarget={},this.attackMeHandles.length=0,this.canAttackHandles.length=0,TimerManager.ins().removeAll(this),ViewManager.ins().close(TargetListPanel),TimerManager.ins().doTimer(600,1,function(){t.isShow&&(TimerManager.ins().doTimer(1e3,0,t.update,t),t.update(),ViewManager.ins().open(TargetListPanel))},this)},Object.defineProperty(e.prototype,"isShow",{get:function(){return CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||DarkMjBoss.ins().isDarkBoss||WJBattlefieldSys.ins().isWJBattle||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena
},enumerable:!0,configurable:!0}),e.prototype.update=function(){this.isShow&&(this.postChangeCanAttackHandle(),this.updateAttackMe())},e.prototype.campChange=function(){if(BattleCC.ins().isBattle()){var t=void 0,e=EntityManager.ins().getAllEntity();for(var i in e)t=e[i],t&&t.infoModel&&t.infoModel.type==EntityType.Role&&(t.setCharName(t.infoModel.guildAndName),t.updateNameColor())}},e.prototype.postChangeCanAttackHandle=function(){var t,e=EntityManager.ins().getAllEntity();this.canAttackHandles.length=0;var i,s=!1,n=CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||DarkMjBoss.ins().isDarkBoss||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena;for(var o in e)if(t=e[o],i=t.infoModel)if(i.type==EntityType.Role)0==t.isSafety()&&i.getAtt(AttributeType.atHp)>0&&(BattleCC.ins().isBattle()?i.camp>0&&i.camp!=BattleCC.ins().camp&&this.updateCanAttackHandle(i.masterHandle,!0):DevildomSys.ins().isDevildomBattle?(!i.guildID||i.guildID&&i.guildID!=Guild.ins().guildID)&&this.updateCanAttackHandle(t.infoModel.masterHandle,!0):this.updateCanAttackHandle(i.masterHandle,!0));else if(i.type==EntityType.Monster&&i.getAtt(AttributeType.atHp)>0&&!s){if(n)continue;var a=GlobalConfig.MonstersConfig[i.configID];if(!a)continue;if(4==a.type||3==a.type)continue;if(!this.checkMonHead(a))continue;-1==GlobalConfig.CampBattleConfig.noAttack.indexOf(i.configID)&&(s=!0,this.updateCanAttackHandle(i.handle,!0,!0))}KFBossSys.ins().isKFBossBattle&&KFBossSys.ins().flagHandle&&KFBossSys.ins().flagTimes>0?this.updateCanAttackHandle(KFBossSys.ins().flagHandle,!0,!0):KfArenaSys.ins().isKFArena&&KfArenaSys.ins().flagHandle&&this.updateCanAttackHandle(KfArenaSys.ins().flagHandle,!0,!0)},e.prototype.checkMonHead=function(t){return!Assert(t.head,"怪物头像不存在1，id:"+t.id+",name:"+t.name)},e.prototype.updateAttackMe=function(){for(var t=0,e=this.attackMeHandles;t<e.length;t++){var i=e[t],s=EntityManager.ins().getMasterList(i);if(s&&0!=s.length){for(var n=!0,o=0,a=s;o<a.length;o++){var r=a[o];if(r&&r.infoModel&&r.infoModel.getAtt(AttributeType.atHp)>0){n=!1;break}}n&&this.postTargetList(i,0)}else this.postTargetList(i,0)}},e.prototype.clear=function(){this.attackMeHandles.length=0,this.canAttackHandles.length=0,GameLogic.ins().currAttackHandle=0,UserBoss.ins().monsterID=0},e.prototype.updateCanAttackHandle=function(t,e,i){void 0===i&&(i=!1);var s=EntityManager.ins().getRootMasterHandle(t);if(0!=s&&s!=Actor.handle){var n=this.canAttackHandles.indexOf(s);e&&-1==n?i?this.canAttackHandles.unshift(s):this.canAttackHandles.push(s):e||-1==n||this.canAttackHandles.splice(n,1)}},e.prototype.postTargetList=function(t,e){if(0!=t||0!=e){var i=EntityManager.ins().getRootMasterHandle(t),s=EntityManager.ins().getRootMasterHandle(e),n=this.attackMeHandles.indexOf(i);if(i==Actor.handle){var o=EntityManager.ins().getEntityByHandle(e);if(o&&o.infoModel&&o.infoModel.type==EntityType.CollectionMonst)return;o&&o.infoModel&&o.infoModel.getAtt(AttributeType.atHp)>0?GameLogic.ins().postChangeTarget(o.infoModel.type==EntityType.Monster?o.infoModel.handle:o.infoModel.masterHandle):(GameLogic.ins().postChangeTarget(0),ViewManager.ins().close(TargetPlayerBigBloodPanel)),ViewManager.ins().isShow(TargetListPanel)&&ViewManager.ins().getView(TargetListPanel).showTarget(0!=e)}else-1!=n&&0==s&&this.attackMeHandles.splice(n,1)}},e.prototype.attackAndShowTip=function(t){var e=t[0],i=t[1],s=(t[2],t[3]);if(this.isShow&&e&&i&&!(0>=s)&&(e.isMy||i.isMy)){var n=EntityManager.ins().getRootMasterHandle(i.infoModel.handle),o=EntityManager.ins().getRootMasterHandle(e.infoModel.handle);if(o!=Actor.handle&&n==Actor.handle)return void(0==GameLogic.ins().currAttackHandle||ViewManager.ins().isShow(TargetPlayerBigBloodPanel)||(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian?ViewManager.ins().open(TargetPlayerBigBloodPanel):CityCC.ins().isCity&&0==CityCC.ins().cityBossId&&ViewManager.ins().open(TargetPlayerBigBloodPanel)));var a=this.attackMeHandles.indexOf(n);-1==a&&o==Actor.handle&&n!=Actor.handle&&this.masterAtkTarget[n]==o&&i.infoModel.type==EntityType.Role&&(this.attackMeHandles.push(n),this.attackMeHandles.length>0&&(ViewManager.ins().isShow(TargetListPanel)||(ViewManager.ins().open(TargetListPanel),CityCC.ins().postChangeAttStatue(1))),this.postTargetList(0,0)),e.infoModel.isMy&&e.infoModel.getAtt(AttributeType.atHp)<=0&&!EntityManager.ins().getNoDieRole()&&ViewManager.ins().isShow(TargetListPanel)&&ViewManager.ins().getView(TargetListPanel).showTarget(!1)}},e.prototype.updateAtkTarget=function(t){var e=t[0],i=t[1],s=EntityManager.ins().getRootMasterHandle(e),n=EntityManager.ins().getRootMasterHandle(i);this.masterAtkTarget[s]=n},e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(TargetListCC.prototype,"TargetListCC");var GameSystem;!function(t){t.targetListCC=TargetListCC.ins.bind(TargetListCC)}(GameSystem||(GameSystem={}));var TargetListPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="TargetListSkin",e.list1.itemRenderer=WorldBossHeadRender,e.list2.itemRenderer=TargetMemberHeadRender,e.list3.itemRenderer=TargetMemberHeadRender,e.list2Dt=new eui.ArrayCollection,e.list2Dt.source=TargetListCC.ins().canAttackHandles,e.list2.dataProvider=e.list2Dt,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postChangeTarget,this.updateTarget),this.observe(TargetListCC.ins().postTargetList,this.updateBeAttackList),this.observe(TargetListCC.ins().postChangeCanAttackHandle,this.updateCanAttackList),this.update(),this.attackGroup0.visible=!1},e.prototype.update=function(){this.updateTarget(),this.updateBeAttackList(),this.updateCanAttackList()},e.prototype.showTarget=function(t){this.attackGroup0.visible=t},e.prototype.updateTarget=function(){if(this.attackGroup0.visible)if(this.list1.dataProvider){var t=this.list1.dataProvider;t.replaceAll([GameLogic.ins().currAttackHandle])}else this.list1.dataProvider=new eui.ArrayCollection([GameLogic.ins().currAttackHandle])},e.prototype.updateBeAttackList=function(){var t=TargetListCC.ins().attackMeHandles;if(this.beAttackGroup0.visible=t.length>0,this.beAttackGroup0.visible)if(this.list3.dataProvider){var e=this.list3.dataProvider;e.replaceAll(t)}else this.list3.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateCanAttackList=function(){var t=TargetListCC.ins().canAttackHandles;this.canAttackGroup0.visible=t.length>0,this.canAttackGroup0.visible&&this.list2Dt.replaceAll(TargetListCC.ins().canAttackHandles)},e}(BaseEuiView);__decorate([callLater],TargetListPanel.prototype,"updateTarget",null),__decorate([callLater],TargetListPanel.prototype,"updateBeAttackList",null),__decorate([callLater],TargetListPanel.prototype,"updateCanAttackList",null),__reflect(TargetListPanel.prototype,"TargetListPanel");var GameSystem;!function(t){t.targetlistpanel=function(){ViewManager.ins().reg(TargetListPanel,LayerManager.Main_View)}}(GameSystem||(GameSystem={}));var TargetMemberHeadRender=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.removeAttEffect()},e.prototype.onTap=function(t){isNaN(this.data)||(this.showEffect(),SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),KFBossSys.ins().flagHandle==parseInt(this.data)?KFBossSys.ins().flagCD-egret.getTimer()>0?UserTips.ins().showTips("|C:"+ColorUtil.RED+"&T:旗子未刷新！|"):KFBossSys.ins().sendCollectFlag():KfArenaSys.ins().flagHandle==parseInt(this.data)?KfArenaSys.ins().flagCD-egret.getTimer()>0?UserTips.ins().showTips("|C:"+ColorUtil.RED+"&T:旗子未刷新！|"):KfArenaSys.ins().sendCollectFlag():GameLogic.ins().postChangeAttrPoint(this.data))},e}(WorldBossHeadRender);__reflect(TargetMemberHeadRender.prototype,"TargetMemberHeadRender");var TargetPlayerBigBloodPanel=function(t){function e(){var e=t.call(this)||this;return e.curValue=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="TargetPlayerSmallBloodSkin",this.bloodBar.slideDuration=0,this.grayImg.source="bosshp2",this.grayImgMask=new egret.Rectangle(0,0,this.grayImg.width,this.grayImg.height),this.grayImg.mask=this.grayImgMask,e.GRAYIMG_WIDTH=this.grayImg.width,this.bloodBar.labelDisplay.visible=!1,this.playerBloodGroup.top=BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian?this.playerBloodGroup.top:60},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postEntityHpChange,this.updateHP),this.observe(GameLogic.ins().postChangeTarget,this.updateTarget),this.observe(GameLogic.ins().postOtherAttChange,this.updateAtt),this.updateTarget()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.grayImgMask&&egret.Tween.removeTweens(this.grayImgMask),this.currAttackHandle=0},e.prototype.changeHp=function(){var t=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(t&&t.length>0){for(var e=t.length,i=0,s=0,n=0,o=0,a=0;e>a;a++){var r=t[a];if(r){var h=r.infoModel.getAtt(AttributeType.atHp)||0,l=r.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=h,s+=l;var c=r.infoModel.getAtt(AttributeType.cruNeiGong)||0,u=r.infoModel.getAtt(AttributeType.maxNeiGong)||0;n+=c,o+=u}}BattleCC.ins().isBattle()&&(i=i/s*100,s=100),this.hudunbloodBar0.maximum=o,this.hudunbloodBar0.value=n,this.bloodBar.maximum=s,this.bloodBar.value=i,this.curValue=Math.floor(i/s*100),this.tweenBlood()}else{var p=EntityManager.ins().getEntityByHandle(this.currAttackHandle);p&&p.infoModel&&p.infoModel.type==EntityType.Monster&&(this.hudunbloodBar0.maximum=p.infoModel.getAtt(AttributeType.maxNeiGong)||0,this.hudunbloodBar0.value=p.infoModel.getAtt(AttributeType.cruNeiGong)||0,this.bloodBar.maximum=p.infoModel.getAtt(AttributeType.atMaxHp)||0,this.bloodBar.value=p.infoModel.getAtt(AttributeType.atHp)||0,this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100),this.tweenBlood())}},e.prototype.updateTarget=function(){if(0==GameLogic.ins().currAttackHandle&&ViewManager.ins().close(this),0!=this.currAttackHandle&&this.currAttackHandle!=GameLogic.ins().currAttackHandle&&(this.currAttackHandle=GameLogic.ins().currAttackHandle,0!=this.currAttackHandle)){var t=void 0,e=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(e&&e.length>0){t=e[0].infoModel;var i=t.name,s=i.split("\n");i=s[1]?s[1]:s[0],this.nameTxt.textFlow=TextFlowMaker.generateTextFlow(i),this.head.source="yuanhead"+t.job+t.sex,this.changeHp()}else{var n=EntityManager.ins().getEntityByHandle(this.currAttackHandle);if(n&&n.infoModel&&n.infoModel.type==EntityType.Monster){var o=GlobalConfig.MonstersConfig[n.infoModel.configID];this.nameTxt.textFlow=(new egret.HtmlTextParser).parser(o.name),this.head.source="monhead"+o.head+"_png",this.changeHp()}}}},e.prototype.updateHP=function(t){if(CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss){var e=t[0];t[1],t[2],t[3];!e||e.infoModel.masterHandle!=this.currAttackHandle&&e.infoModel.handle!=this.currAttackHandle||this.changeHp()}},e.prototype.updateAtt=function(t){t&&t.infoModel&&(CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian)&&(t.infoModel.masterHandle==this.currAttackHandle||t.infoModel.handle==this.currAttackHandle)&&this.changeHp()},e.prototype.tweenBlood=function(){var t=this,i=this.curValue*e.GRAYIMG_WIDTH/100,s=this;if(egret.Tween.removeTweens(this.grayImgMask),!(3>i)){var n=egret.Tween.get(this.grayImgMask,{onChange:function(){s.grayImg&&(s.grayImg.mask=t.grayImgMask)}},s);n.to({width:i-3},1e3).call(function(){0>=i&&(s.grayImgMask.width=0,egret.Tween.removeTweens(this.grayImgMask),ViewManager.ins().close(this))},s)}},e}(BaseEuiView);TargetPlayerBigBloodPanel.GRAYIMG_WIDTH=0,__reflect(TargetPlayerBigBloodPanel.prototype,"TargetPlayerBigBloodPanel");var GameSystem;!function(t){t.targetPlayerBigBloodPanel=function(){ViewManager.ins().reg(TargetPlayerBigBloodPanel,LayerManager.Main_View)}}(GameSystem||(GameSystem={}));var AchievementData=function(){function t(){}return t}();__reflect(AchievementData.prototype,"AchievementData");var LimitTaskData=function(){function t(){this.id=0,this.name="",this.desc="",this.target=0,this.control=0,this.type=0,this.state=0,this.progress=0}return t.prototype.setBaseData=function(t){this.id=t.id,this.name=t.name,this.desc=t.desc,this.target=t.target,this.awardList=t.awardList,this.control=t.control,this.controlTarget=t.controlTarget,this.type=t.type},t.prototype.parser=function(t){this.progress=t.readInt(),this.state=t.readByte()},t}();__reflect(LimitTaskData.prototype,"LimitTaskData");var TaskData=function(){function t(){}return t}();__reflect(TaskData.prototype,"TaskData");var UserTask=function(t){function e(){var e=t.call(this)||this;return e.limitTaskList=[],e.limitTaskDic={},e.limitTaskState=0,e.limitTaskCount=0,e.limitTaskEndTime=-1,e.currTaskListsId=-1,e.lastState=-1,e.sysId=PackageID.Task,e.regNetMsg(1,e.doTaskData),e.regNetMsg(2,e.doTaskChangeData),e.regNetMsg(3,e.doVitality),e.regNetMsg(4,e.doVitalityAwards),e.regNetMsg(5,e.doAchieveData),e.regNetMsg(7,e.doJoinAchieveData),e.regNetMsg(8,e.doAchieveChangeData),e.regNetMsg(9,e.doLimitDataChange),e.regNetMsg(10,e.doUpdateLimitData),e.achiEvement=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendGetTask=function(t){var e=this.getBytes(1);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetVitalityAwards=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetAchieve=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.doTaskData=function(t){this.task=[],this.vitalityAwards=[];for(var e=t.readInt(),i=0;e>i;i++){var s=new TaskData;s.id=t.readInt(),s.value=t.readInt(),s.state=t.readInt(),this.task.push(s)}this.vitality=t.readInt();for(var n=t.readInt(),i=0;n>i;i++){var o=new VitalityData;o.id=t.readInt(),o.state=t.readInt(),this.vitalityAwards.push(o)}this.sortTask()},e.prototype.doTaskChangeData=function(t){var i=t.readInt(),s=e.ins().getTaskDataById(i);ErrorLog.Assert(s,"UserTask  doTaskChangeData id  = "+i)||(s.value=t.readInt(),s.state=t.readInt(),e.ins().sortTask(),e.ins().postTaskChangeData())},e.prototype.postTaskChangeData=function(){},e.prototype.doVitality=function(t){this.vitality=t.readInt()},e.prototype.doVitalityAwards=function(t){var i=t.readInt(),s=this.getVitalityAwardsById(i);s.state=t.readInt(),e.ins().postTaskChangeData()},e.prototype.doAchieveData=function(t){this.achiEvement.length=0;for(var i=t.readInt(),s=0;i>s;s++){var n=new AchievementData;n.achievementId=t.readInt(),n.id=t.readInt(),n.state=t.readInt(),n.value=t.readInt();var o=this.getAchieveConfById(n.id);null==o?debug.warn("无法获得成就配置:"+n.id+"，请检查配置"):n.achievementType=o.achievementType,1e3==n.achievementId?(this.taskTrace=n,100003==this.taskTrace.id&&0==this.taskTrace.state,e.ins().postUpdteTaskTrace()):this.achiEvement.push(n)}this.sortAchiEvement(),this.postUpdateAchieve()},e.prototype.getTaskData=function(t,e){for(var i,s=this.achiEvement.length,n=0;s>n;n++){var o=this.achiEvement[n];if(o.achievementId==t&&o.id==e){i=o;break}}return i},e.prototype.getTaskTarget=function(t){var e=0,i=this.getAchieveConfById(t);return i&&(e=i.target),e},e.prototype.postUpdateAchieve=function(){},e.prototype.postUpdteTaskTrace=function(){},e.prototype.postUpdteLimitTaskData=function(t){return t},e.prototype.postLimitTaskEnd=function(){},e.prototype.doJoinAchieveData=function(t){this.changeAchieve(t)},e.prototype.doAchieveChangeData=function(t){this.changeAchieve(t)},e.prototype.doLimitDataChange=function(t){var i=t.readByte();if(this.limitTaskState=i,this.limitTaskCount=0,0==i)this.currTaskListsId=t.readInt(),this.initLimitTaskData(this.currTaskListsId);else if(1==i){this.currTaskListsId=t.readInt(),this.initLimitTaskData(this.currTaskListsId),this.limitTaskEndTime=t.readInt();var s=GlobalConfig.LimitTimeConfig[this.currTaskListsId];1==this.currTaskListsId&&s.time==this.limitTaskEndTime&&ViewManager.ins().open(LimitStartTipsView),this.limitTaskEndTime+=Math.floor(GameServer.serverTime/1e3);for(var n=t.readShort(),o=0;n>o;o++){var a=t.readInt();this.limitTaskDic[a].parser(t),2==this.limitTaskDic[a].state&&this.limitTaskCount++}}e.ins().postUpdteLimitTaskData()},e.prototype.initLimitTaskData=function(t){this.limitTaskList=[],this.limitTaskDic={};var e=GlobalConfig.LimitTimeConfig[t];for(var i in e.taskIds){var s=GlobalConfig.LimitTimeTaskConfig[e.taskIds[i]],n=new LimitTaskData;n.setBaseData(s),this.limitTaskList.push(n),this.limitTaskDic[n.id]=n}},e.prototype.doUpdateLimitData=function(t){var i=t.readInt(),s=this.limitTaskDic[i];return s?(s.parser(t),2==s.state&&this.limitTaskCount++,void e.ins().postUpdteLimitTaskData(s)):void debug.log("限时任务未初始化："+i)},e.prototype.sendGetLimitTask=function(){this.sendBaseProto(5)},e.prototype.sendGetLimitTaskReward=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.changeAchieve=function(t){var i,s=t.readInt();i=1e3==s?this.taskTrace:this.getAchieveDataById(s),ErrorLog.Assert(i,"UserTask  data is null  achievementId = "+s)||(i.id=t.readInt(),i.state=t.readInt(),i.value=t.readInt(),1e3==i.achievementId?e.ins().postUpdteTaskTrace():(this.sortAchiEvement(),e.ins().postTaskChangeData()))},e.prototype.getChengjiuDataByType=function(t){if(void 0==this.achiEvement)return void Log.trace("通过成就类型获取成就数据  achiEvement = null");for(var e=[],i=0;i<this.achiEvement.length;i++)this.achiEvement[i].achievementType==t&&e.push(this.achiEvement[i]);return this.sortAchievementAcByType(e)},e.prototype.sortAchievementAcByType=function(t){return t&&t.sort(function(t,e){return 2==t.state?1:2==e.state?-1:e.state-t.state}),t},e.prototype.getAchieveDataById=function(t){if(void 0==this.achiEvement)return void Log.trace("通过成就类型获取成就数据  achiEvement = null");for(var e=0;e<this.achiEvement.length;e++)if(this.achiEvement[e].achievementId==t)return this.achiEvement[e];return null},e.prototype.getAchieveByTaskId=function(t){for(var e=0;e<this.achiEvement.length;e++)if(this.achiEvement[e].id==t)return this.achiEvement[e];return null},e.prototype.getVitalityAwardsById=function(t){for(var e=0;e<this.vitalityAwards.length;e++)if(this.vitalityAwards[e].id==t)return this.vitalityAwards[e];return null},e.prototype.getTaskDataById=function(t){if(!this.task)return null;for(var e=0;e<this.task.length;e++)if(this.task[e].id==t)return this.task[e];return null},e.prototype.getAchieveConfById=function(t){var e,i=GlobalConfig.AchievementTaskConfig;for(e in i){var s=i[e];if(s.taskId==t)return s}return null},e.prototype.getAwardsConfigById=function(t){var e,i=GlobalConfig.DailyAwardConfig;for(e in i){var s=i[e];if(s.id==t)return s}return null},e.prototype.getTaskStast=function(){if(this.task){var t=void 0;for(t=0;t<this.task.length;t++)if(1==this.task[t].state)return void e.ins().postUpdataTaskPoint(!0);for(t=0;t<this.vitalityAwards.length;t++){var i=this.getAwardsConfigById(this.vitalityAwards[t].id);if(this.vitality>=i.valueLimit&&0==this.vitalityAwards[t].state)return void e.ins().postUpdataTaskPoint(!0)}for(t=0;t<this.achiEvement.length;t++)if(1==this.achiEvement[t].state)return void e.ins().postUpdataTaskPoint(!0);return void e.ins().postUpdataTaskPoint(!1)}},e.prototype.postUpdataTaskPoint=function(t){return t},e.prototype.sortTask=function(){if(this.task.length>2){this.task.sort(this.sort);for(var t=[],e=0;e<this.task.length;e++)0!=this.task[e].state&&(t.push(this.task[e]),this.task.splice(e,1),e--);t.length>0&&(this.task=this.task.concat(t))}},e.prototype.sort=function(t,e){var i=t.id,s=e.id;return s>i?-1:i>s?1:0},e.prototype.sortAchiEvement=function(){for(var t=0;t<this.achiEvement.length;t++){var e=this.achiEvement[t];1==e.state?(this.achiEvement.splice(t,1),this.achiEvement.unshift(e)):2==e.state&&(this.achiEvement.splice(t,1),this.achiEvement.push(e))}},e.prototype.getIsOpenChengjiu=function(){return Actor.level>=7},e.prototype.getIsHaveChengjiuReward=function(){if(!this.getIsOpenChengjiu())return!1;for(var t=LiLian.ins().chengjiuMaxData(),e=0,i=t;e<i.length;e++){var s=i[e],n=this.getChengjiuDataByType(s);if(void 0==n)return void Log.trace("是否有成就奖励可领取 datas = null");for(var o=0,a=n;o<a.length;o++){var r=a[o];if(1==r.state)return!0}}return!1},e.prototype.getIsHaveChengjiuRewardBytype=function(t){for(var e=this.getChengjiuDataByType(t),i=0,s=e;i<s.length;i++){var n=s[i];if(1==n.state)return!0}return!1},e.prototype.getTaskState=function(){var t=e.ins().taskTrace;if(t){var i=(e.ins().getAchieveConfById(t.id),e.ins().getAchieveConfById(t.id+1));return i||2!=t.state?!0:!1}return!1},e.prototype.getLimitTaskRed=function(){for(var t=0;t<e.ins().limitTaskList.length;t++)if(1==e.ins().limitTaskList[t].state)return 1;return 0},e.prototype.postParabolicItem=function(){},e.prototype.getLimitTimeId=function(t){for(var e in GlobalConfig.LimitTimeConfig){var i=GlobalConfig.LimitTimeConfig[e];if(-1!=i.taskIds.indexOf(t))return i.id}return 0},e}(BaseSystem);__reflect(UserTask.prototype,"UserTask");var GameSystem;!function(t){t.userTask=UserTask.ins.bind(UserTask)}(GameSystem||(GameSystem={}));var AchieveItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TaskItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=UserTask.ins().getAchieveConfById(t.id);this.taskImg.source="",this.taskName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0x35e62d&T:("+t.value+"/"+e.target+")|"),this.taskInfo.text=e.desc;var i=void 0,s=1;for(i in e.awardList)this["awards"+s++].setData(e.awardList[i]);switch(t.state){case 0:this.gotoBtn.visible=!0,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!1;break;case 1:this.gotoBtn.visible=!1,this.awardsBtn.visible=!0,this.completeImg.visible=this.completeLabel.visible=!1;break;case 2:this.gotoBtn.visible=!1,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!0}0==e.control&&(this.gotoBtn.visible=!1)}},e}(BaseItemRender);__reflect(AchieveItem.prototype,"AchieveItem");var AchievePanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="AchievePanelSkin",e.name="成就",e.list.itemRenderer=AchieveItem,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.list,this.onSendFunc),this.observe(UserTask.ins().postTaskChangeData,this.setPanel),this.setPanel()},e.prototype.close=function(){this.removeTouchEvent(this.list,this.onSendFunc),this.removeObserve()},e.prototype.onSendFunc=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;switch(t.target){case e.gotoBtn:GameGuider.taskGuidance(e.data.id,1);break;case e.awardsBtn:UserTask.ins().sendGetAchieve(e.data.achievementId)}}},e.prototype.setPanel=function(){this._achieve=UserTask.ins().achiEvement,this.list.dataProvider=new eui.ArrayCollection(this._achieve)},e}(BaseView);__reflect(AchievePanel.prototype,"AchievePanel");var GuideArrow2=function(t){function e(){var e=t.call(this)||this;return e.skinName="guideArrowSkin",e}return __extends(e,t),e.prototype.setDirection=function(t){egret.Tween.removeTweens(this),this.x=0,this.visible=!0,1==t?(this.currentState="right",egret.Tween.get(this,{loop:!0}).to({x:40},1e3).to({x:0},1e3)):(this.currentState="left",egret.Tween.get(this,{loop:!0}).to({x:-40},1e3).to({x:0},1e3))},e.prototype.setTips=function(t){this.lab.text=t},e.prototype.removeTweens=function(){egret.Tween.removeTweens(this)},e}(BaseEuiView);__reflect(GuideArrow2.prototype,"GuideArrow2");var LimitStartTipsView=function(t){function e(){var e=t.call(this)||this;return e.skinName="LimitStartTipsSkin",e.isTopLevel=!0,e.name="限时任务开始",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.btn,this.onStart)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.onStart=function(){ViewManager.ins().close(e),ViewManager.ins().open(LimitTaskView)},e}(BaseEuiView);__reflect(LimitStartTipsView.prototype,"LimitStartTipsView"),ViewManager.ins().reg(LimitStartTipsView,LayerManager.UI_Popup);var LimitTaskItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LimitTimeItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.goBtn.visible=!0,this.done.visible=!1,this.taskNameTxt.text=this.data.name,this.taskIcon.isShowName(!1),this.taskIcon.data=this.data.awardList[0],this.progTxt.text="("+this.data.progress+"/"+this.data.target+")",83==this.data.type&&(this.data.progress>=this.data.target?this.progTxt.text="1/1":this.progTxt.text="0/1"),this.progTxt.textColor=12849664,0==this.data.state?(this.stateTxt.text="进行中",this.goBtn.label="前往"):1==this.data.state?(this.stateTxt.text="可领取奖励",this.goBtn.label="领取",this.progTxt.textColor=4823887):2==this.data.state&&(this.stateTxt.text="已完成",this.goBtn.visible=!1,this.done.visible=!0,this.progTxt.textColor=4823887),this.redPoint.visible=1==this.data.state,this.taskIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTopIcon,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTopIcon=function(t){t.stopImmediatePropagation(),t.stopPropagation()},e.prototype.onTap=function(t){if(0==this.data.state){var e=this.data.controlTarget[1]?this.data.controlTarget[1]:0;if("GuanQiaRewardWin"==this.data.controlTarget[0])return void this.gotoQuanQia();ViewManager.ins().open(this.data.controlTarget[0],e)}else 1==this.data.state&&(UserBag.ins().getSurplusCount()<1?UserTips.ins().showTips("背包剩余空位不足，请先清理"):UserTask.ins().sendGetLimitTaskReward(this.data.id))},e.prototype.gotoQuanQia=function(){return UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH?(ViewManager.ins().closeTopLevel(),ViewManager.ins().open(BagFullTipsWin)):UserFb.ins().currentEnergy>=UserFb.ins().energy?(ViewManager.ins().closeTopLevel(),UserFb.ins().autoPk()):UserTips.ins().showTips("|C:0xf3311e&T:能量不足|"),!1},e}(BaseItemRender);__reflect(LimitTaskItem.prototype,"LimitTaskItem");var LimitTaskView=function(t){function e(){var e=t.call(this)||this;return e.skinName="limittime",e.name="限时任务",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.list,this.onTouch),this.addTouchEvent(this.viewBtn,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.observe(UserTask.ins().postUpdteLimitTaskData,this.setPanel),this.observe(UserTask.ins().postUpdteLimitTaskData,this.updateFly),this.setPanel()},e.prototype.close=function(){TimerManager.ins().remove(this.runTime,this)},e.prototype.onTouch=function(t){switch(t.target){case this.viewBtn:ViewManager.ins().open(RoleWin,1);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setPanel=function(){var t=this.sortList();this.list.dataProvider=new eui.ArrayCollection(t);var e=UserTask.ins().currTaskListsId,i=GlobalConfig.LimitTimeConfig[e];if(!i)return void UserTips.ins().showCenterTips("限时任务id:"+e+"不存在限时任务表中");var s="";s=i.openZhuan>0?i.openZhuan+"转":i.openLevel+"级";for(var n=["title0","title1","title2"],o=0;o<n.length;o++)o==e-1?this[n[o]].visible=!0:this[n[o]].visible=!1;for(var o=0;8>o;o++)this["item"+o].redPoint.visible=!1;this.link0.text=s,this.expBarChange(),this.itemChange(),this.updateAttr(),UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)>0?(this.runTime(),TimerManager.ins().doTimer(1e3,0,this.runTime,this)):this.time.text="活动已过期"},e.prototype.runTime=function(){var t=UserTask.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3);t>=0?this.time.text=DateUtils.getFormatBySecond(t,1):(this.time.text="活动已过期",TimerManager.ins().remove(this.runTime,this))},e.prototype.expBarChange=function(){var t=UserTask.ins().limitTaskList.length,e=UserTask.ins().limitTaskCount;this.expBar.maximum!=t&&(this.expBar.maximum=t),this.expBar.value=e,0==e?this.playAllEffect():this.removeAllEffect()},e.prototype.itemChange=function(){for(var t=UserTask.ins().limitTaskList,e=0;e<t.length;e++){var i=t[e],s=this["item"+e];2==i.state?s.visible=!1:s.visible=!0;var n=i.awardList[0];s.data=n,s.destruct(),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.updateAttr=function(){var t=GlobalConfig.TogetherHitEquipQmConfig,e=UserTask.ins().limitTaskList[0].awardList[0],i=GlobalConfig.ItemConfig[e.id],s=i.zsLevel||0;for(var n in t)if(n+""==s+""){for(var o in t[n]){var a=t[n][o];for(var r in a)r+""=="3"?this.link4.textFlow=TextFlowMaker.generateTextFlow1(a[r].desc):r+""=="5"?this.link6.textFlow=TextFlowMaker.generateTextFlow1(a[r].desc):this.link8.textFlow=TextFlowMaker.generateTextFlow1(a[r].desc)}break}},e.prototype.onTouchItem=function(t){var e=t.currentTarget,i=e.data;ViewManager.ins().open(HejiEquipTipsWin,i,!1)},e.prototype.sortList=function(){var t=UserTask.ins().limitTaskList;return t},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.list.itemRenderer=LimitTaskItem,this.time.text="",this.expBar.slideDuration=0,this.effArr=[];for(var e=0;8>e;e++){var i=new MovieClip;i.x=177,i.y=174,i.rotation=45*e,i.touchEnabled=!1,this.effArr.push(i)}},e.prototype.sort=function(t,e){var i=t.state,s=e.state;return Algorithm.sortAsc(i,s)},e.prototype.playAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent||(this.effArr[t].playFile(RES_DIR_EFF+"hejizbjihuoeff",-1),this.EffectGroup.addChild(this.effArr[t]))},e.prototype.removeAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent&&DisplayUtils.removeFromParent(this.effArr[t])},e.prototype.updateFly=function(t){if(t&&2==t.state){var e=UserTask.ins().limitTaskList.indexOf(t);e>=0&&this.addFly(e)}},e.prototype.addFly=function(t){var e=this["item"+t],i=new PunchEquipItemBase;i.currentState=e.currentState,i.anchorOffsetX=e.width/2,i.anchorOffsetY=e.height/2,i.scaleX=.53,i.scaleY=.53,i.alpha=.8;var s=e.parent,n=new egret.Point;s.parent.localToGlobal(s.x+.53*(e.x+e.width/2),s.y+.53*(e.y+e.height/2),n),this.globalToLocal(n.x,n.y,n),i.x=n.x,i.y=n.y,this.addChild(i);var o=UserTask.ins().limitTaskList[t].awardList[0];i.validateNow(),i.data=o;var a=ViewManager.ins().getView(UIView2),r=a.getToggleBtn(0),h=new egret.Point;r.parent.localToGlobal(r.x+r.width/2,r.y+r.height/2,h);var l=egret.Tween.get(i);l.to({scaleX:.8,scaleY:.8},300).to({x:n.x+30},50).to({x:n.x-30},50).to({x:n.x+30},50).to({x:n.x-30},50).to({x:n.x+30},50).to({x:n.x-30},50).to({x:n.x+30},50).to({x:n.x-30},50).to({x:n.x},25).to({x:h.x,y:h.y,scaleX:.15,scaleY:.15},800).call(function(){i.parent&&i.parent.removeChild(i)})},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return UserTask.ins().currTaskListsId>0?!0:(ViewManager.ins().open(BossWin,2),!1)},e}(BaseEuiView);__reflect(LimitTaskView.prototype,"LimitTaskView"),ViewManager.ins().reg(LimitTaskView,LayerManager.UI_Main);var TaskAlertWin=function(t){function e(){var e=t.call(this)||this;return e.CLOSE_TIME=40,e.timeCount=0,e.skinName="TaskSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.gotoBtn,this.onClick),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),TimerManager.ins().removeAll(this),this.removeTouchEvent(this.gotoBtn,this.onClick),egret.Tween.removeTweens(this.arrowGroup)},e.prototype.setView=function(){var t=UserTask.ins().taskTrace;if(t){var e=UserTask.ins().getAchieveConfById(t.id);switch(e&&(this.rewardList.dataProvider=new eui.ArrayCollection(e.awardList),79==e.type?this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(e.longdesc):this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(e.longdesc)),this.taskName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0xf3311e&T: ("+t.value+"/"+e.target+")|"),t.state){case 0:this.gotoBtn.label="前  往";
break;case 1:this.gotoBtn.label="领  取"}}var i=egret.Tween.get(this.arrowGroup,{loop:!0});i.to({y:this.arrowGroup.y-10},400).to({y:this.arrowGroup.y+10},400),TimerManager.ins().remove(this.onTimeCount,this),this.timeCount=this.CLOSE_TIME,TimerManager.ins().doTimer(1e3,this.timeCount,this.onTimeCount,this),this.timeText.text=this.timeCount+"秒后自动提交"},e.prototype.onTimeCount=function(){this.timeCount--,this.timeText.text=this.timeCount+"秒后自动提交",0==this.timeCount&&(TimerManager.ins().remove(this.onTimeCount,this),this.doTask())},e.prototype.onClick=function(t){switch(t.target){case this.gotoBtn:this.doTask()}},e.prototype.doTask=function(){var t=UserTask.ins().taskTrace;0==t.state?(GameGuider.taskGuidance(t.id,1),GuideUtils.ins().updateByClick()):(UserTask.ins().sendGetAchieve(t.achievementId),UserTask.ins().postParabolicItem(),Hint.ins().postAchievementAft(t),UserTask.ins().getAchieveConfById(t.id+1)||UserTips.ins().showTips("已完成所有任务!")),ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(TaskAlertWin.prototype,"TaskAlertWin"),ViewManager.ins().reg(TaskAlertWin,LayerManager.Game_Main);var TaskEffectView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this._effGroup=new eui.Group,this.addChild(this._effGroup),this._arrowGroup=new eui.Group,this.addChild(this._arrowGroup),this._effCir=new MovieClip,this._effGroup.addChild(this._effCir),this._arrow=new GuideArrow2,this._arrowGroup.addChild(this._arrow),this.touchChildren=!1,this.touchEnabled=!1},e.prototype.start=function(){TimerManager.ins().remove(this.update,this),TimerManager.ins().doTimer(500,0,this.update,this)},e.prototype.stop=function(){TimerManager.ins().remove(this.update,this),this.hide()},e.prototype.show=function(t){if(!this._isShow){this._isShow=!0;var e=ViewManager.ins().getView(PlayFunView);if(!e)return void this.hide();egret.Tween.removeTweens(this),this.alpha=0,egret.Tween.get(this).to({alpha:1},300);var i=e.taskTraceBtn;this.x=i.width>>1,this.y=i.height>>1,i.addChild(this),this._arrow.setDirection(0),this._effCir.playFile(RES_DIR_EFF+"guideff",-1)}this._arrow.setTips(t)},e.prototype.hide=function(){this._isShow&&(this._isShow=!1,this._arrow.removeTweens(),this.parent&&this.parent.removeChild(this))},e.prototype.isShow=function(){return this._isShow},e.prototype.update=function(){var t=UserTask.ins().taskTrace;if(t){for(var e=UserTask.ins().getAchieveConfById(t.id),i=["WelcomeWin"],s=0,n=i;s<n.length;s++){var o=n[s];if(ViewManager.ins().getView(o))return void this.hide()}e&&(0==t.state&&e.startwarning?this.show(e.startwarning):1==t.state&&e.finishwarning?this.show(e.finishwarning):this.hide())}},e}(egret.DisplayObjectContainer);__reflect(TaskEffectView.prototype,"TaskEffectView");var TaskItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TaskItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.DailyConfig[t.id];this.taskImg.source="",this.taskName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0x35e62d&("+e.activeValue+"活跃度)"),this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(e.desc+"|C:0x35e62d&("+t.value+"/"+e.target+")");var i=void 0,s=1;for(i in e.awardList)this["awards"+s++].setData(e.awardList[i]);switch(s>2?this.awards2.visible=!0:this.awards2.visible=!1,t.state){case 0:this.gotoBtn.visible=!0,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!1;break;case 1:this.gotoBtn.visible=!1,this.awardsBtn.visible=!0,this.completeImg.visible=this.completeLabel.visible=!1;break;case 2:this.gotoBtn.visible=!1,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!0}0==e.control&&(this.gotoBtn.visible=!1)}},e}(BaseItemRender);__reflect(TaskItem.prototype,"TaskItem");var VitalityData=function(){function t(){}return t}();__reflect(VitalityData.prototype,"VitalityData");var UserTips=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"view",{get:function(){return this._view&&this._view.parent||(ViewManager.ins().open(TipsView),this._view=ViewManager.ins().getView(TipsView)),this._view},enumerable:!0,configurable:!0}),e.prototype.showTips=function(t,e){if("元宝不足"==t||"|C:0xf3311e&T:元宝不足|"==t){var i=WarnWin.show("元宝不足，是否前往充值？",null,null,function(){var t=Recharge.ins().getRechargeData(0);t&&2==t.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win),e&&"function"==typeof e&&e()});return void i.setBtnLabel("取消","前往")}DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTips,t)},e.prototype.showCenterTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips,t)},e.prototype.showCenterTips2=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips2,t)},e.prototype.showCenterTips3=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips3,t)},e.prototype.showSceneTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showSceneTips,t)},e.prototype.showTaskTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTaskTips,t)},e.prototype.showAttrTips=function(t,e){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showAttrTips,[t,e])},e.prototype.showGoodEquipTips=function(t){this.view.showGoodEquipTip(t)},e.prototype.showSkillTips=function(t){this.view.showSkillTip(t)},e.prototype.showItemTips=function(t){this.view.showItemTip(t)},e.prototype.showHeartItemTips=function(t){this.view.showHeartItemTip(t)},e.prototype.showBoxTips=function(t){this.view.showBoxTip(t)},e.prototype.showBoostPower=function(t,e){ViewManager.ins().open(BoostPowerView).showBoostPower(t,e)},e.prototype.showFuncNotice=function(t){ViewManager.ins().open(FuncNoticeWin).showWin(t)},e.prototype.showRewardBox=function(t){this.view.showRewardBox(t)},e.prototype.showEverTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showEverTips,t)},e.prototype.showHintTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showHintTips,t)},e.prototype.showGoodRewardTips=function(t){this.view.showGoodRewardTip(t)},e}(BaseClass);__reflect(UserTips.prototype,"UserTips");var AttriteChangeView=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this._sp=new egret.Sprite,this.addChild(this._sp),this._bgImg=new eui.Image,this._sp.addChild(this._bgImg)},e.prototype.setLabelText=function(t,e){var i=this;this._sp.x=0,this._sp.alpha=1,this._bgImg.source="attr"+t;var s=BitmapNumber.ins().createNumPic(e,"attr",5);s.x=90,s.y=10,this._sp.addChild(s);var n=egret.Tween.get(this._sp);n.wait(1e3).to({alpha:0,x:-300},500).call(function(){BitmapNumber.ins().desstroyNumPic(s),s.x=0,s.y=0,DisplayUtils.removeFromParent(i)},this)},e}(BaseView);__reflect(AttriteChangeView.prototype,"AttriteChangeView");var BoostPowerView=function(t){function e(){var e=t.call(this)||this;return e.defaultValue=0,e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.horizontalCenter=100,this.bottom=-100,this.imgBg=new eui.Image,this.imgBg.source="zhandoulibg",this.imgBg.x=50,this.imgBg.y=438,this.addChild(this.imgBg),this.imgBg.alpha=1,this.imgBg.touchEnabled=!1,this.img=new eui.Image,this.img.source="zjmzhandouli",this.img.x=100,this.img.y=450,this.addChild(this.img),this.img.alpha=1,this.img.touchEnabled=!1,this.sp=new egret.Sprite,this.sp.x=180,this.sp.y=474,this.addChild(this.sp),this.lastTime=0,this.lastPower=0,this.clearShow()},e.prototype.showBoostPower=function(t,e){this.defaultValue=e,0==this.lastPower&&(this.lastPower=e),TimerManager.ins().doTimer(500,1,this.delayPowerUp,this)},e.prototype.clearShow=function(){this.sp.removeChildren(),egret.Tween.removeTweens(this.img),this.img.visible=!1,egret.Tween.removeTweens(this.imgBg),this.imgBg.visible=!1,TimerManager.ins().removeAll(this),egret.clearTimeout(this.ii),this.ii=0},e.prototype.delayPowerUp=function(){var t=this.lastPower?this.lastPower:this.defaultValue,e=Actor.power;e>t&&this.showPowerUp(t,e)},e.prototype.showPowerUp=function(t,e){var i=this;this.clearShow(),this.img.visible=!0,this.img.alpha=1,this.imgBg.visible=!0,this.imgBg.alpha=1;var s=BitmapNumber.ins().createNumPic(t,"8",5);s.y=-17,this.sp.addChild(s);var n=e-t;TimerManager.ins().doTimer(20,25,function(){var e=n;e+=Math.round(Math.random()*e);var i=t.toString(),o="";o=e.toString().length==i.length?e.toString().slice(1):e+"",i=i.charAt(0),i+=o,BitmapNumber.ins().changeNum(s,i,"8",5)},this,function(){BitmapNumber.ins().changeNum(s,Actor.power,"8",5);var t="+"+n,e=BitmapNumber.ins().createNumPic(t,"r0",5);BitmapNumber.ins().changeNum(e,t,"r0",5),e.x=s.x+s.width+10,e.y=s.y+30,i.sp.addChild(e);var o=200,a=2e3;i.lastPower=0;var r=egret.Tween.get(e);r.to({y:e.y-30},o).to({alpha:0},a).call(function(){DisplayUtils.removeFromParent(e)},i);var h=egret.Tween.get(s);h.wait(o).to({alpha:0},a).call(function(){DisplayUtils.removeFromParent(s)},i);var l=egret.Tween.get(i.img);l.wait(o).to({alpha:0},a).call(function(){i.img.visible=!1},i);var c=egret.Tween.get(i.imgBg);c.wait(o).to({alpha:0},a).call(function(){i.imgBg.visible=!1},i)},this)},e}(BaseEuiView);__reflect(BoostPowerView.prototype,"BoostPowerView"),ViewManager.ins().reg(BoostPowerView,LayerManager.UI_Tips);var CenterTipsItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"labelText",{set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+40,this.bg.source="zjmqipao",this.bg.visible=!0,this.lab.alpha=1,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.addToEvent||(this.addToEvent=!0,TimerManager.ins().doTimer(5e3,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelText2",{set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+40,this.bg.source="zjmqipao",this.bg.visible=!0,this.lab.alpha=1,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.addToEvent||(this.addToEvent=!0,TimerManager.ins().doTimer(1e3,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelText3",{set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+40,this.bg.source="zjmqipao",this.bg.visible=!0,this.lab.alpha=1,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.addToEvent||(this.addToEvent=!0,TimerManager.ins().doTimer(3e3,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),e}(TipsItem);__reflect(CenterTipsItem.prototype,"CenterTipsItem");var ChatTipsView=function(t){function e(){var e=t.call(this)||this;return e.showOver=!1,e.skinName="ChatMessage",e}return __extends(e,t),e.prototype.setData=function(t){this.lab.textFlow=TextFlowMaker.generateTextFlow(t.str),this.setshowTime()},e.prototype.setshowTime=function(){this.showOver||TimerManager.ins().remove(this.showOverInfo,this),TimerManager.ins().doTimer(5e3,1,this.showOverInfo,this)},e.prototype.showOverInfo=function(){this.showOver=!0,DisplayUtils.removeFromParent(this)},e}(eui.Component);__reflect(ChatTipsView.prototype,"ChatTipsView");var EverTipsItem=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="TipsSkin",e.lab.stroke=1,e.lab.strokeColor=0,e.bg.source="zjmqipao",e}return __extends(e,t),e.prototype.setIndex=function(t){this.index=t},Object.defineProperty(e.prototype,"labelText",{get:function(){return this._labelText},set:function(t){var e=this;this.bg.alpha=1,this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+80,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1;var i=egret.Tween.get(this.bg);i.to({y:0},500).wait(500).to({alpha:0},200).call(function(){DisplayUtils.removeFromParent(e)},this)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(EverTipsItem.prototype,"EverTipsItem");var FuncNoticeWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="FuncNoticeSkin"},e.prototype.showWin=function(t){this.curConfig=e.getFuncNoticeConfigById(t);var i=this.curConfig.openLv;t==i?this.sureBtn.icon="yg_002":this.sureBtn.icon="yg_001",this.bodyImg.source="yg_"+this.curConfig.index+"_png",this.txt.textFlow=TextFlowMaker.generateTextFlow("|C:0x35e62d&T:"+i+"|关开启"),this.addTouchEvent(this.sureBtn,this.onTouch)},e.prototype.onTouch=function(t){var e=t.target;if("yg_002"==e.icon){var i=this.curConfig.openPanel[0].toString(),s=this.curConfig.openPanel[1];GameGuider.guidance(i,s)}this.removeTouchEvent(this.sureBtn,this.onTouch),ViewManager.ins().close(this)},e.getFuncNoticeConfigById=function(t){var e=GlobalConfig.FuncNoticeConfig;for(var i in e)if(e[i].openLv>=t)return e[i];return null},e}(BaseEuiView);__reflect(FuncNoticeWin.prototype,"FuncNoticeWin"),ViewManager.ins().reg(FuncNoticeWin,LayerManager.UI_Tips);var HintTipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TipsSkin",e.lab.visible=!1,e.bg.visible=!1,e}return __extends(e,t),e.prototype.setTips=function(t){var e=this;this.pic.source=t+"_png",this.pic.alpha=0,this.pic.y=0;var i=egret.Tween.get(this.pic);i.to({alpha:1},500).wait(3e3).to({alpha:0},200).call(function(){DisplayUtils.removeFromParent(e)},this)},e}(BaseView);__reflect(HintTipsItem.prototype,"HintTipsItem");var SceneTipsItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"labelText",{set:function(t){var e=this;this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width,this.bg.visible=!1,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1,TimerManager.ins().doTimer(500,1,function(){DisplayUtils.removeFromParent(e)},this)},enumerable:!0,configurable:!0}),e}(TipsItem);__reflect(SceneTipsItem.prototype,"SceneTipsItem");var TipsEquipAlertPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=GlobalConfig.ItemConfig[t];this.item.setItemImg(e.icon+"_png"),this.item.isShowJob(!1),this.item.setImgBg(ItemConfig.getQuality(e)),this.desc.text=e.name,this.skillName.visible=!1,this.item.isShowName(!1),this.item.showNum(!1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsEquipAlertPanel.prototype,"TipsEquipAlertPanel");var TipsGoodEquip=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin",e.isUsing=!1,e.horizontalCenter=0,e.bgMc=new MovieClip,e.bgMc.x=142,e.bgMc.y=58,e.bgMc.touchEnabled=!1,e.addChild(e.bgMc),e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){if(this.bgMc.playFile(RES_DIR_EFF+"tekuangeff",1,null,!1),this.item.isShowName(!1),t instanceof ItemData){var e=ItemConfig.getQuality(t.itemConfig);this.item.showNum(!0),this.item.data=t,4==e?(this.desc.text="传说物品！",this.itemName.visible=!0):5==e&&(this.desc.text="传说物品！",this.itemName.visible=!0),7==ItemConfig.getType(t.itemConfig)&&(this.desc.text="恭喜获得:"),this.itemName.text=t.itemConfig.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[e]}else{this.desc.text="恭喜获得:";var i=t;this.item.setItemImg(i.imgClose),this.itemName.text=i.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[i.quality],this.item.showNum(!1)}},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsGoodEquip.prototype,"TipsGoodEquip");var TipsGoodReward=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){if(t instanceof RewardData)switch(t.id){case MoneyConst.yuanbao:this.desc.text="元宝",this.skillName.text=""+t.count,this.item.setItemImg(RewardData.CURRENCY_RES[t.id]),this.item.isShowName(!1),this.item.showNum(!1),this.item.isShowJob(!1)}},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsGoodReward.prototype,"TipsGoodReward");var TipsHeartEquipAlertPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponNoticeTip",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=GlobalConfig.ItemConfig[t];this.item.setItemImg(e.icon+"_png"),this.item.isShowJob(!1),this.item.setImgBg(ItemConfig.getQuality(e));var i=ItemConfig.getQualityColor(e);this.desc.textFlow=TextFlowMaker.generateTextFlow1("C:"+i+"&T:"+e.name),this.itemName.visible=!1,this.item.isShowName(!1),this.item.showNum(!1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsHeartEquipAlertPanel.prototype,"TipsHeartEquipAlertPanel");var AverageUtils=function(){function t(t){void 0===t&&(t=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=t}return t.prototype.push=function(t){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(t),this.numSum+=t,this.numsLen++},t.prototype.getValue=function(){return this.numSum/this.numsLen},t.prototype.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},t}();__reflect(AverageUtils.prototype,"AverageUtils");var TipsSkillAlertPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=new SkillData(t);this.item.setItemImg(e.icon),this.skillName.text=e.name,this.skillName.textColor=ItemBase.QUALITY_COLOR[4],this.item.isShowName(!1),this.item.showNum(!1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsSkillAlertPanel.prototype,"TipsSkillAlertPanel");var TipsView=function(t){function e(){var e=t.call(this)||this;return e.labCount=0,e.list=[],e.listCenter=[],e.centerList=[],e.taskTipsList=[],e.sceneList=[],e.attrList=[],e.everList=[],e.hintList=[],e.rewardTipList=[],e.goodEquipList=[],e.skillTipList=[],e.equipItemList=[],e.equipHeartItemList=[],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.touchChildren=!1,this.touchEnabled=!1,this.rewardTip=new TipsGoodReward,this.equipTip1=new TipsGoodEquip,this.skillTip1=new TipsSkillAlertPanel,this.equipTip=new TipsEquipAlertPanel,this.boxTip=new BoxGetHintTips,this.equipHeartTip=new TipsHeartEquipAlertPanel,this.observe(Actor.ins().postExp,this.showExp)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.showExp=function(t){t&&this.showTips("|C:0x23CA23&T:经验 +"+t+"|")},e.prototype.showHintTips=function(t){var e=ObjectPool.pop("HintTipsItem");e.verticalCenter=200,e.horizontalCenter=0,e.setTips(t),this.addChild(e),this.hintList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHintTip,this);for(var i=this.hintList.length-1;i>=0;i--){egret.Tween.removeTweens(this.hintList[i]);var s=egret.Tween.get(this.hintList[i]);s.to({verticalCenter:200+-30*i},300)}},e.prototype.removeHintTip=function(t){var e=this.hintList.indexOf(t.currentTarget);this.hintList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHintTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showEverTips=function(t){var e=ObjectPool.pop("EverTipsItem");e.x=t.x,e.y=t.y,e.labelText=t.str,this.addChild(e),this.everList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEverTip,this);for(var i=this.everList.length-1;i>=0;i--){egret.Tween.removeTweens(this.everList[i]);var s=egret.Tween.get(this.everList[i]);s.to({y:e.y-30*i},300)}},e.prototype.removeEverTip=function(t){var e=this.everList.indexOf(t.currentTarget);this.everList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEverTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showAttrTips=function(t){var e=ObjectPool.pop("AttriteChangeView");e.left=30,e.bottom=190,e.setLabelText(t[0],t[1]),this.addChild(e),this.attrList.unshift(e),e.once(egret.Event.REMOVED_FROM_STAGE,this.removeAttrTip,this);for(var i=this.attrList.length-1;i>=0;i--){egret.Tween.removeTweens(this.attrList[i]);var s=egret.Tween.get(this.attrList[i]);s.to({bottom:190+40*i},300)}},e.prototype.removeAttrTip=function(t){var e=this.attrList.indexOf(t.currentTarget);this.attrList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),ObjectPool.push(t.currentTarget)},e.prototype.showCenterTips=function(t){var e=ObjectPool.pop("CenterTipsItem");e.verticalCenter=0,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var s=egret.Tween.get(this.centerList[i]);s.to({verticalCenter:0+-30*i},500)}},e.prototype.removeCenterTip=function(t){var e=t.currentTarget,i=this.centerList.indexOf(e);this.centerList.splice(i,1),e.horizontalCenter=0/0,e.verticalCenter=0/0,egret.Tween.removeTweens(e),e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this),ObjectPool.push(e)},e.prototype.showCenterTips2=function(t){var e=ObjectPool.pop("CenterTipsItem");e.horizontalCenter=0,e.verticalCenter=-60,this.addChild(e),e.labelText2=t,this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip2,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var s=egret.Tween.get(this.centerList[i]);s.to({verticalCenter:-120-30*i},300)}},e.prototype.removeCenterTip2=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip2,this),e.horizontalCenter=0/0,e.verticalCenter=0/0;var i=this.centerList.indexOf(e);this.centerList.splice(i,1)},e.prototype.showCenterTips3=function(t){var e=ObjectPool.pop("CenterTipsItem");e.verticalCenter=0,e.horizontalCenter=0,e.labelText3=t,this.addChild(e),this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip3,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var s=egret.Tween.get(this.centerList[i]);s.to({verticalCenter:0+-30*i},500)}},e.prototype.removeCenterTip3=function(t){var e=t.currentTarget,i=this.centerList.indexOf(e);this.centerList.splice(i,1),e.horizontalCenter=0/0,e.verticalCenter=0/0,egret.Tween.removeTweens(e),e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this),ObjectPool.push(e)},e.prototype.showSceneTips=function(t){var e=ObjectPool.pop("SceneTipsItem");e.verticalCenter=-175,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.sceneList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeSceneTip,this);for(var i=this.sceneList.length-1;i>=0;i--){egret.Tween.removeTweens(this.sceneList[i]);var s=egret.Tween.get(this.sceneList[i]);s.to({verticalCenter:-175+-30*i},500)}},e.prototype.removeSceneTip=function(t){var e=this.sceneList.indexOf(t.currentTarget);this.sceneList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeSceneTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showTaskTips=function(t){var e=ObjectPool.pop("CenterTipsItem");e.bottom=232,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.taskTipsList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTaskTip,this);for(var i=this.taskTipsList.length-1;i>=0;i--){egret.Tween.removeTweens(this.taskTipsList[i]);var s=egret.Tween.get(this.taskTipsList[i]);s.to({bottom:232+30*i},500)}},e.prototype.removeTaskTip=function(t){var e=this.taskTipsList.indexOf(t.currentTarget);this.taskTipsList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTaskTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showTips=function(t){var e=ObjectPool.pop("TipsItem");e.left=0,e.bottom=190,this.addChild(e),e.labelText=t,this.list.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this);for(var i=this.list.length-1;i>=0;i--){egret.Tween.removeTweens(this.list[i]);var s=egret.Tween.get(this.list[i]);s.to({bottom:190+30*i},300)}},e.prototype.removeTipsItem=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this),e.left=0/0,e.bottom=0/0;var i=this.list.indexOf(e);this.list.splice(i,1),ObjectPool.push(e)},e.prototype.showGoodRewardTip=function(t){this.rewardTipList.push(t),TimerManager.ins().isExists(this.goodRewardTimer,this)||TimerManager.ins().doTimer(16,0,this.goodRewardTimer,this)},e.prototype.showGoodEquipTip=function(t){this.goodEquipList.push(t),TimerManager.ins().isExists(this.goodEquipTimer,this)||TimerManager.ins().doTimer(16,0,this.goodEquipTimer,this)},e.prototype.showBoxTip=function(t){var e=GlobalConfig.TreasureBoxConfig[t];this.goodEquipList.push(e),TimerManager.ins().isExists(this.goodEquipTimer,this)||TimerManager.ins().doTimer(16,0,this.goodEquipTimer,this)},e.prototype.goodRewardTimer=function(){var t=this;if(0==this.rewardTipList.length)return void TimerManager.ins().remove(this.goodEquipTimer,this);if(!this.isWait){var e;if(this.rewardTip.isUsing||(e=this.rewardTip),e){e.x=50,e.y=750,e.alpha=1,e.parent||this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.rewardTipList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.goodEquipTimer=function(){var t=this;if(0==this.goodEquipList.length)return void TimerManager.ins().remove(this.goodEquipTimer,this);if(!this.isWait){var e;if(this.equipTip1.isUsing||(e=this.equipTip1),e){e.x=50,e.y=750,e.alpha=1,e.parent||this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.goodEquipList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.showRewardBox=function(t){var e=GlobalConfig.TreasureBoxConfig[t];this.goodEquipList.push(e),TimerManager.ins().isExists(this.goodEquipTimer,this)||TimerManager.ins().doTimer(16,0,this.goodEquipTimer,this)},e.prototype.showSkillTip=function(t){this.skillTipList.push(t),TimerManager.ins().isExists(this.skillTipTimer,this)||TimerManager.ins().doTimer(16,0,this.skillTipTimer,this)},e.prototype.skillTipTimer=function(){var t=this;if(0==this.skillTipList.length)return void TimerManager.ins().remove(this.skillTipTimer,this);if(!this.isWait){var e;if(this.skillTip1.isUsing||(e=this.skillTip1),e){e.x=50,e.y=750,e.alpha=1,this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.skillTipList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.showItemTip=function(t){this.equipItemList.push(t),TimerManager.ins().isExists(this.itemTipTimer,this)||TimerManager.ins().doTimer(16,0,this.itemTipTimer,this)},e.prototype.itemTipTimer=function(){var t=this;if(0==this.equipItemList.length)return void TimerManager.ins().remove(this.itemTipTimer,this);if(!this.isWait){var e;if(this.equipTip.isUsing||(e=this.equipTip),e){e.x=50,e.y=750,e.alpha=1,this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.equipItemList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.showHeartItemTip=function(t){this.equipHeartItemList.push(t),TimerManager.ins().isExists(this.itemHeartTipTimer,this)||TimerManager.ins().doTimer(16,0,this.itemHeartTipTimer,this)},e.prototype.itemHeartTipTimer=function(){var t=this;if(0==this.equipHeartItemList.length)return void TimerManager.ins().remove(this.itemHeartTipTimer,this);if(!this.isWait){var e;if(this.equipHeartTip.isUsing||(e=this.equipHeartTip),e){e.x=50,e.y=713,e.alpha=1,this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.equipHeartItemList.pop();var i=egret.Tween.get(e);i.to({y:563},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e}(BaseEuiView);__reflect(TipsView.prototype,"TipsView"),ViewManager.ins().reg(TipsView,LayerManager.UI_Tips);var Title=function(t){function e(){var e=t.call(this)||this;return e.showTitleDic={},e.curSelectRole=0,e.sysId=PackageID.Title,e.regNetMsg(1,e.postListUpdate),e.regNetMsg(2,e.doAdd),e.regNetMsg(3,e.doRemove),e.regNetMsg(4,e.doUpdateShow),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getTotalPower=function(){for(var t=this.list.length,e=0,i=0;t>i;i++){var s=this.list.getItemAt(i);s.endTime>=0&&(e+=s.power)}return e},e.prototype.postUseTitle=function(t){return t},e.prototype.sendGetList=function(){this.sendBaseProto(1)},e.prototype.postListUpdate=function(t){for(var e={},i=t.readInt(),s=0;i>s;++s)e[t.readInt()]=t.readUnsignedInt();this.initList(e),this.showTitleDic={};for(var n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s);null!=o&&(this.showTitleDic[Number(s)]=o.title)}},e.prototype.doAdd=function(t){this.change(t.readInt(),t.readUnsignedInt())},e.prototype.doRemove=function(t){this.change(t.readInt(),-1)},e.prototype.sendChangeShow=function(t,e){var i=this.getBytes(4);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doUpdateShow=function(t){var e=EntityManager.ins().getEntityByHandle(t.readDouble());if(e&&(e.infoModel.title=t.readInt(),e.updateTitle(),e.team==Team.My)){var i=e.infoModel.index,s=0,n=this.showTitleDic[i]||0;e.infoModel;s=e.infoModel.title,this.showTitleDic[i]=s,this.postTitleShow(i,s,n)}},e.prototype.postTitleShow=function(t,e,i){return[t,e,i]},e.prototype.setTitle=function(t,e){for(var i in this.showTitleDic)if(this.showTitleDic[i]==e){this.sendChangeShow(Number(i),0);break}this.sendChangeShow(t,e)},e.prototype.sortFunc=function(t,e){return t.endTime<0==e.endTime<0?t.config.sort>e.config.sort?1:-1:t.endTime<0?1:-1},e.prototype.initList=function(t){this.timeDict=t,this.infoDict={},this._totalAttrs=[],this._totalAttrsText=new eui.ArrayCollection;var e=[],i=GlobalConfig.TitleConf;for(var s in i){var n=new TitleInfo(i[s]);if(n.config.Id in t){n.endTime=t[n.config.Id];for(var o in n.config.attrs)this._totalAttrs[n.config.attrs[o].type]=(this._totalAttrs[n.config.attrs[o].type]||0)+n.config.attrs[o].value}else n.endTime=-1;e[e.length]=this.infoDict[n.config.Id]=n,n.attrsTotal=this._totalAttrsText}e.sort(this.sortFunc),this.list=new eui.ArrayCollection(e),this.updateTotalAttrs()},e.prototype.change=function(t,e){if(this.infoDict&&t in this.infoDict&&t in this.timeDict!=e>=0){var i=this.infoDict[t];i.endTime=e,0>e?delete this.timeDict[t]:this.timeDict[t]=e,this.list.source.sort(this.sortFunc),this.list.refresh();for(var s=0>e?-1:1,n=0,o=i.config.attrs;n<o.length;n++){var a=o[n];this._totalAttrs[a.type]=(this._totalAttrs[a.type]||0)+s*a.value}this.updateTotalAttrs(),s>0&&this.autoWearTitle(i)}},e.prototype.updateTotalAttrs=function(){var t=this._totalAttrsText.source;t.length=0;for(var e in this._totalAttrs)this._totalAttrs[e]>0&&t.push(TitleInfo.formatAttr(Number(e),this._totalAttrs[e]));if(0==t.length)for(var i=this.infoDict[1].config.attrs,s=0,n=i;s<n.length;s++){var o=n[s];t.push(TitleInfo.formatAttr(o.type,0))}this._totalAttrsText.refresh()},e.prototype.autoWearTitle=function(t){if(17==t.config.Id&&t instanceof TitleInfo)for(var i=SubRoles.ins().subRolesLen,s=0;i>s;s++)if(!e.ins().showTitleDic[s]){e.ins().setTitle(s,t.config.Id);
break}},e}(BaseSystem);Title.TITLE_WIN_REFLASH_PANEL="TITLE_WIN_REFLASH_PANEL",Title.SIMLPE_HEIGHT=86,Title.EXPAND_HEIGHT=380,__reflect(Title.prototype,"Title");var GameSystem;!function(t){t.title=Title.ins.bind(Title)}(GameSystem||(GameSystem={}));var TitleInfo=function(){function t(t){this.config=t}return Object.defineProperty(t.prototype,"attrsText",{get:function(){if(!this._attrsText){for(var e=[],i=this.config.attrs.length;i--;)e[i]=t.formatAttr(this.config.attrs[i].type,this.config.attrs[i].value);this._attrsText=new eui.ArrayCollection(e),this.power=UserBag.getAttrPower(this.config.attrs)}return this._attrsText},enumerable:!0,configurable:!0}),t.formatAttr=function(t,e){return{h:AttributeData.getAttrStrByType(t)+"：",t:String(e),textColor:3532333}},t}();__reflect(TitleInfo.prototype,"TitleInfo");var TitleItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onTap=function(t){t.target==this.btnSet?Title.ins().postUseTitle(this.data):(this.currentState="expand"!=this.currentState?"expand":"simple",MessageCenter.ins().dispatch(Title.TITLE_WIN_REFLASH_PANEL,this,this.currentState))},e.prototype.dataChanged=function(){if(this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.data instanceof TitleInfo){var t=this.data;if(this.conditionTxt.text="获得条件："+t.config.condition,this.img.source=t.config.img,t.config.eff){this.titleMc||(this.titleMc=ObjectPool.pop("MovieClip"),this.titleMc.x=118,this.titleMc.y=30,this.addChildAt(this.titleMc,20));var i=RES_DIR_EFF+t.config.eff;this.titleMc.playFile(i,-1)}else this.titleMc&&(this.titleMc.destroy(),this.titleMc=null);if(t.endTime>=0){this.btnSet.label=t.config.Id==Title.ins().showTitleDic[Title.ins().curSelectRole]?"卸下":Title.ins().showTitleDic[Title.ins().curSelectRole]?"更换":"穿戴",this.btnSet.visible=!0,this.time.visible=!0;var s=DateUtils.formatMiniDateTime(t.endTime)/1e3;this.time.text=0==t.endTime?"有效期：永久":"有效期："+DateUtils.getFormatBySecond(s,2),this.labLack.visible=!1}else this.btnSet.visible=!1,this.time.visible=!1,this.labLack.visible=!0;"string"==typeof e.rareText[t.config.rare]&&(e.rareText[t.config.rare]=TextFlowMaker.generateTextFlow("稀有度：|C:"+e.rareText[t.config.rare])),this.labRare.textFlow=e.rareText[t.config.rare],this._power!=t.power&&(this._power&&BitmapNumber.ins().desstroyNumPic(this.power.getChildAt(0)),this.power.addChildAt(BitmapNumber.ins().createNumPic(t.power*SubRoles.ins().subRolesLen,"8"),0),this._power=t.power),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}else this.img.source="",this.conditionTxt.text="",this._power&&(this._power=0,BitmapNumber.ins().desstroyNumPic(this.power.getChildAt(0))),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),WatcherUtil.removeFromArrayCollection(this.attrs.dataProvider),WatcherUtil.removeFromArrayCollection(this.attrsTotal.dataProvider),this.attrs.dataProvider=null,this.attrsTotal.dataProvider=null},e}(BaseItemRender);TitleItem.rareText=["0xfbf8ee&T:普通","0x00ff3c&T:稀有","0x066eba&T:珍贵","0xd200ff&T:国器","0xf45601&T:无双"],__reflect(TitleItem.prototype,"TitleItem");var TitleWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="TitleSkin",this.list.itemRenderer=TitleItem,this.isTopLevel=!0},e}(BaseEuiView);__reflect(TitleWin.prototype,"TitleWin"),ViewManager.ins().reg(TitleWin,LayerManager.UI_Main);var BreakDownListItemData=function(){function t(){}return t}();__reflect(BreakDownListItemData.prototype,"BreakDownListItemData");var Hunt=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.TreasureHunt,e.regNetMsg(1,e.doHuntResult),e.regNetMsg(2,e.postBestListInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendHunt=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendHuntList=function(){this.sendBaseProto(2)},e.prototype.doHuntResult=function(t){for(var e=t.readShort(),i=t.readInt(),s=[],n=0;i>n;n++)s[n]=[t.readInt(),t.readInt()];ViewManager.ins().isShow(HuntResultWin)?this.postHuntResult(e,s,0):(ViewManager.ins().open(HuntResultWin,e,s,0),this.postHuntResult(e,s,0))},e.prototype.postHuntResult=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postBestListInfo=function(t){for(var e=t.readShort(),i=[],s=0;e>s;s++)i[s]=[t.readString(),t.readInt()];return i.reverse(),i},e}(BaseSystem);__reflect(Hunt.prototype,"Hunt");var GameSystem;!function(t){t.hunt=Hunt.ins.bind(Hunt)}(GameSystem||(GameSystem={}));var AdvanEquipWin=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.curSelectIndex=0,e.skinName="AdvanEquipWinSkin",e.panelArr=[e.orangeEquipPanel,e.legendEquipPanel,e.extremeEquipPanel],e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.viewStack.selectedIndex=e.ShenZhuang,this.tab.dataProvider=this.viewStack},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=t[0]?t[0]:e.ShenZhuang,n=t[1]?t[1]:e.ShenZhuang;this.roleSelect.setCurRole(n),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.observe(UserBag.ins().postItemChange,this.setRedPoint),this.observe(UserBag.ins().postItemAdd,this.setRedPoint),this.observe(UserBag.ins().postItemDel,this.setRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint),this.addChangeEvent(this.roleSelect,this.switchRole),this.setSelectedIndex(s),this.setRedPoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panelArr[this.curSelectIndex].close()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.switchRole=function(){var t=this.roleSelect.getCurRole();this.panelArr[this.curSelectIndex].setRoleId(t)},e.prototype.onTabTouching=function(t){return t.currentTarget.selectedIndex==e.XunBao?(ViewManager.ins().open(TreasureHuntWin,0),void t.preventDefault()):this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){switch(t){case e.ShenZhuang:break;case e.ChuanQi:break;case e.ZhiZun:if(!OpenSystem.ins().checkSysOpen(SystemType.ZHIZUN))return UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ZHIZUN)),!1}return!0},e.prototype.onTabTouch=function(t){this.panelArr[this.curSelectIndex].close();var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e),this.setRedPoint(),ViewManager.ins().close(LimitTaskView)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t;var e=this.roleSelect.getCurRole();this.panelArr[t].open(e),this.viewStack.selectedIndex=t},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Actor.level>=10?!0:(UserTips.ins().showTips("10级开启"),!1)},e.prototype.setRedPoint=function(){this.redPoint3.visible=this.redPoint2.visible=this.redPoint0.visible=this.redPoint1.visible=!1;for(var t=!1,i=SubRoles.ins().subRolesLen,s=0;i>s;s++){for(var n=0;8>n&&!(t=UserEquip.ins().setOrangeEquipItemState(n,SubRoles.ins().getSubRoleByIndex(s)));n++);this.roleSelect.showRedPoint(s,t),t&&(this.redPoint0.visible=t)}t=!1;for(var s=0;i>s;s++){for(var n=0;2>n;n++)if(t=UserEquip.ins().setLegendEquipItemUpState(n>0?2:0,SubRoles.ins().getSubRoleByIndex(s)),t=UserEquip.ins().setLegendEquipItemState(n>0?2:0,SubRoles.ins().getSubRoleByIndex(s))||t,1==n&&t){this.redPoint1.visible=t;break}this.viewStack.selectedIndex==e.ChuanQi&&this.roleSelect.showRedPoint(s,t)}if(0==this.redPoint1.visible&&(this.redPoint1.visible=UserEquip.ins().checkRedPointEx(5,this.roleSelect.getCurRole())||this.legendEquipPanel.setRedPoint()),this.redPoint2.visible=Boolean(UserBag.ins().getHuntGoods(0).length),this.viewStack.selectedIndex==e.ZhiZun){this.roleSelect.clearRedPoint();for(var n=0;n<SubRoles.ins().subRolesLen;n++){var o=SubRoles.ins().getSubRoleByIndex(n),a=ExtremeEquipModel.ins().getRedPointByJob(o.job);a&&this.roleSelect.showRedPoint(n,a)}}this.redPoint3.visible=ExtremeEquipModel.ins().getRedPoint()},e}(BaseEuiView);AdvanEquipWin.ShenZhuang=0,AdvanEquipWin.ChuanQi=1,AdvanEquipWin.ZhiZun=2,AdvanEquipWin.XunBao=3,__reflect(AdvanEquipWin.prototype,"AdvanEquipWin"),ViewManager.ins().reg(AdvanEquipWin,LayerManager.UI_Main);var BreakDownItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.configID=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemIcon.imgJob.visible=!1},e.prototype.dataChanged=function(){var t=this.data.itemConfig;if(t.zsLevel>0?this.level.text=t.zsLevel+"转":this.level.text=t.level?"Lv."+t.level:"Lv.1",this.itemIcon.setData(t),this.equipName.text=""+t.name,this.equipName.textColor=ItemConfig.getQualityColor(t),ItemConfig.getType(t)==ItemType.TYPE_9){var e=Book.ins().getDecomposeConfigByItemId(t.id),i=0;if(e)i=e.value;else{var s=GlobalConfig.DecomposeConfig[67];s&&(i=s.value)}this.desc.text="图鉴经验 x"+i,this.tip.visible=!0,this.tip.x=this.equipName.x+this.equipName.width,this.level.text=""}else{var n=GlobalConfig.EquipConfig[t.id];if(!n)return;var o=GlobalConfig.ItemConfig[n.stoneId];if(!o)return;this.desc.text=o.name+" x "+n.stoneNum,this.desc.textColor=this.equipName.textColor;var a=ItemConfig.getSubType(t),r=UserEquip.ins().getEquipConfigIDByPosAndQuality(a,ItemConfig.getQuality(t)),h=GlobalConfig.ItemConfig[r],l=t.zsLevel?t.zsLevel:0,c=h.zsLevel?h.zsLevel:0,u=t.level?t.level:0,p=h.level?h.level:0,d=1e4*l+u,g=1e4*c+p;g>d?UserZs.ins().lv>=c&&Actor.level>=p?this.tip.visible=!1:(this.tip.visible=!0,this.tip.x=this.equipName.x+this.equipName.width):this.tip.visible=!1}this.configID=this.data.handle},e}(BaseItemRender);__reflect(BreakDownItemRenderer.prototype,"BreakDownItemRenderer");var BreakDownListview=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BreakDownSkin",this.isTopLevel=!0,this.equipList.itemRenderer=BreakDownItemRenderer,this.listData=new eui.ArrayCollection,this.equipList.dataProvider=this.listData,this.gainList.itemRenderer=GainGoodsItem,this.goList=new eui.ArrayCollection,this.gainList.dataProvider=this.goList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(UserBag.ins().postItemDel,this.updateData),this.addTouchEvent(this,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.quality=t[0],this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this,this.onTap),this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.removeObserve()},e.prototype.updateData=function(){var t=UserBag.ins().getBagEquipsByQuality(this.quality);t.sort(function(t,e){var i=GlobalConfig.ItemConfig[t.configID],s=GlobalConfig.ItemConfig[e.configID];return i.zsLevel>s.zsLevel?1:i.zsLevel<s.zsLevel?-1:i.level>s.level?1:i.level<s.level?-1:0}),this.listData.source=t;var e=this.itemList[this.quality],i=e.length;this.goList.removeAll();for(var s=0;s<e.length;s++)this.goList.addItem(e[s]);this.refushPos(i)},e.prototype.refushPos=function(t){this.contrain.height=60*t,this.equipScroller.height=310+60*(3-t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button)switch(t.target.name){case"breakDown":UserEquip.ins().sendSmeltEquip(1,[t.target.parent.data])}}},e.prototype.onGo=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2]),ViewManager.ins().close(this))}},e}(BaseEuiView);__reflect(BreakDownListview.prototype,"BreakDownListview"),ViewManager.ins().reg(BreakDownListview,LayerManager.UI_Popup);var HuntBoxsTips=function(t){function e(){var e=t.call(this)||this;return e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="TreasureRuneGift"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],t.length>=2&&(this.type=t[1],this.activityID=t[2]),this.addTouchEvent(this.bgClose,this.onTap),this.gift.itemRenderer=ItemBase,3==this.type?this.initActivity():2==this.type?this.initHeirloom():this.initInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.initInfo=function(){var t=GlobalConfig.FuwenTreasureRewardConfig[this.index];if(t)if(this.gift.dataProvider=new eui.ArrayCollection(t.reward),this.num0.text=Rune.ins().runeCount.toString(),Rune.ins().boxs[this.index-1]==Rune.UNGET){var e=t.needTime-Rune.ins().runeCount;this.num1.text=e>0?e+"":"0",this.already.visible=!1}else this.num1.visible=this.num2.visible=this.num3.visible=!1,this.already.visible=!0},e.prototype.initHeirloom=function(){var t=GlobalConfig.HeirloomTreasureRewardConfig[this.index];if(t)if(this.gift.dataProvider=new eui.ArrayCollection(t.reward),this.num0.text=Heirloom.ins().huntTimes.toString(),Heirloom.ins().huntBoxInfo[this.index-1]==Heirloom.UNGET){var e=t.needTime-Heirloom.ins().huntTimes;this.num1.text=e>0?e+"":"0",this.already.visible=!1}else this.num1.visible=this.num2.visible=this.num3.visible=!1,this.already.visible=!0},e.prototype.initActivity=function(){var t=GlobalConfig.ActivityType18Config[this.activityID][this.index];this.gift.dataProvider=new eui.ArrayCollection(t.rewards);var e=Activity.ins().getActivityDataById(this.activityID);this.num0.text=e.num+"";var i=t.dbCount-e.num;this.num1.text=i>0?i+"":"0",1==e.getStateByIndex(this.index)?this.already.visible=!0:this.already.visible=!1},e.prototype.onTap=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(HuntBoxsTips.prototype,"HuntBoxsTips"),ViewManager.ins().reg(HuntBoxsTips,LayerManager.UI_Popup);var HuntListRenderer=function(t){function e(){var e=t.call(this)||this;return e.job=["","战士","法师","道士"],e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ItemConfig[t[1]];if(null!=e){var i,s=ItemConfig.getQualityColor(e),n=ItemConfig.getType(e);i=0==n?"<font color = '#12b2ff'>"+t[0]+"</font> 获得 <font color='"+s+"'>"+this.makeNameList(e)+"</font>":"<font color = '#12b2ff'>"+t[0]+"</font> 获得 <font color='"+s+"'>"+e.name+"</font>",this.showText.textFlow=TextFlowMaker.generateTextFlow(i)}},e.prototype.makeNameList=function(t){var e="";return e=t.name,e+=t.zsLevel>0?"("+t.zsLevel+"转 ":"("+t.level+"级 ",e+=this.job[ItemConfig.getJob(t)]+")"},e}(BaseItemRender);HuntListRenderer.QUALITY_COLOR=["#e2dfd4","#35e62d","#d242fb","#ff750f","#f3311e","#ffd93f"],__reflect(HuntListRenderer.prototype,"HuntListRenderer");var c_launchX=180,c_launchY=500,c_firstX=0,c_firstY=0,c_distantX=77,c_distantY=93,c_depotX=320,c_depotY=620,waitTime=50,HuntResultWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="HuntResult",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.buy),this.observe(Hunt.ins().postHuntResult,this.updateView),this.observe(Heirloom.ins().postHuntResult,this.updateView),this.observe(Activity.ins().postHuntResult,this.updateView),this.updateView([t[0],t[1],t[2],t[3]])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buyBtn,this.buy),this.removeObserve()},e.prototype.updateView=function(t){if(this.canClicck=!0,this.huntType=t[0],this.arr=t[1],this.type=t[2],this.activityID=t[3],3==this.type?this.currentState="noItem":this.currentState="normal",this.validateNow(),0==this.huntType){var e=0;0==this.type?e=GlobalConfig.TreasureHuntConfig.huntOnce:1==this.type?e=GlobalConfig.FuwenTreasureConfig.huntOnce:2==this.type?e=GlobalConfig.HeirloomTreasureConfig.huntOnce:3==this.type&&(e=GlobalConfig.ActivityType18Config[this.activityID][1].yb),this.yb=e,this.buyBtn.labelDisplay.text="购买1次"}else{var e=0;0==this.type?e=GlobalConfig.TreasureHuntConfig.huntTenth:1==this.type?e=GlobalConfig.FuwenTreasureConfig.huntTenth:2==this.type?e=GlobalConfig.HeirloomTreasureConfig.huntTenth:3==this.type&&(e=GlobalConfig.ActivityType18Config[this.activityID][2].yb),this.yb=e,this.buyBtn.labelDisplay.text="购买10次"}this.zwHunt.visible=!0;var i;0==this.type?i=GlobalConfig.TreasureHuntConfig.huntItem:1==this.type?i=GlobalConfig.FuwenTreasureConfig.huntItem:2==this.type?i=GlobalConfig.HeirloomTreasureConfig.huntItem:3==this.type&&(i=GlobalConfig.ActivityType18Config[this.activityID][1].item),this.zw.text=this.yb+"";var s=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,i),n=this.huntType?10:1,o=s?s.count:0;this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(o>=n?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+o+"</font> "),this.icon.source=GlobalConfig.ItemConfig[i].icon+"_png",this.zwNum2.text=0==this.huntType?"/1）":"/10）",this.playResult()},e.prototype.playResult=function(t){var e=this;this.releaseAllItem();for(var i=this.arr.length,s=0;i>s;s++){this.items[s]=this.createItem(this.arr[s]);var n=egret.Tween.get(this.items[s]);this.items[s].x=s%5*c_distantX+c_firstX,this.items[s].y=Math.floor(s/5)*c_distantY+c_firstY,this.items[s].alpha=0,n.wait(s*waitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.playGet=function(t){for(var e=this,i=this.arr.length,s=0;i>s;s++)if(this.items[s]){var n=egret.Tween.get(this.items[s]);n.to({y:c_depotY,x:c_depotX,scaleX:0,scaleY:0},300-50*Math.floor(s/5)).call(function(){i--,0==i&&(void 0!=t&&t(),e.releaseAllItem())})}},e.prototype.createItem=function(t){var e=new ItemBase;this.listCon.addChild(e);var i=GlobalConfig.ItemConfig[t[0]];return i?(e.num=t[1],e.data=t[0]):e.data={type:0,count:t[1],id:t[0]},e.x=c_launchX,e.y=c_launchY,e},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[]},e.prototype.closeCB=function(t){var e=this;if(this.canClicck){this.canClicck=!1;var i=function(){ViewManager.ins().close(e)};this.playGet(i)}},e.prototype.buy=function(t){var e=this;if(3==this.type&&UserBag.ins().getSurplusCount()<UserBag.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);if(this.canClicck){if(2==this.type&&0==this.huntType&&Heirloom.ins().huntFreeTimes>0)return void Heirloom.ins().sendHunt(this.huntType);var i=0;i=3==this.type?GlobalConfig.ActivityType18Config[this.activityID][1].item:2==this.type?GlobalConfig.HeirloomTreasureConfig.huntItem:1==this.type?GlobalConfig.FuwenTreasureConfig.huntItem:GlobalConfig.TreasureHuntConfig.huntItem;var s=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,i);if(s&&s.count){var n=function(){0==e.type?Hunt.ins().sendHunt(e.huntType):1==e.type?Rune.ins().sendHuntRune(e.huntType):2==e.type?Heirloom.ins().sendHunt(e.huntType):3==e.type&&Activity.ins().sendReward(e.activityID,0==e.huntType?1:2)};this.playGet(n),this.canClicck=!1}else{var o=this.huntType?10:1;HuntWarnBuyWin.showBuyWarn(this.getPanelNameByType(this.type)+"-HuntResultWin"+this.huntType,this.huntWarnFun.bind(this),"是否消耗"+this.yb+"元宝购买"+GlobalConfig.ItemConfig[i].name+"*"+o)}}},e.prototype.getPanelNameByType=function(t){return 3==this.type?"OSATarget18Panel1":2==this.type?"TreasureChuanshiPanel":1==this.type?"TreasureRunePanel":"TreasureHuntPanel"},e.prototype.huntWarnFun=function(){var t=this;if(Actor.yb>=this.yb){var e=function(){0==t.type?Hunt.ins().sendHunt(t.huntType):1==t.type?Rune.ins().sendHuntRune(t.huntType):2==t.type?Heirloom.ins().sendHunt(t.huntType):3==t.type&&Activity.ins().sendReward(t.activityID,0==t.huntType?1:2)};this.playGet(e),this.canClicck=!1}else UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(HuntResultWin.prototype,"HuntResultWin"),ViewManager.ins().reg(HuntResultWin,LayerManager.UI_Main);var HuntWarnBuyWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WarnBuySkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panel=t[0],this.callback=t[1],this.des=t[2],this.addTouchEndEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.panel=null,this.callback=null,this.removeTouchEvent(this,this.onTouch)},e.showBuyWarn=function(t,i,s){1==e.loginRecords[t]?i&&i():ViewManager.ins().open(e,t,i,s)},e.prototype.update=function(){this.tipsCheckbox.selected=!1,this.desTxt.textFlow=TextFlowMaker.generateTextFlow(this.des)},e.prototype.onTouch=function(t){switch(t.target){case this.noBtn:case this.BG:ViewManager.ins().close(this);break;case this.yesBtn:e.loginRecords[this.panel]=this.tipsCheckbox.selected,this.callback&&this.callback(),ViewManager.ins().close(this)}},e}(BaseEuiView);HuntWarnBuyWin.loginRecords={},__reflect(HuntWarnBuyWin.prototype,"HuntWarnBuyWin"),ViewManager.ins().reg(HuntWarnBuyWin,LayerManager.UI_Main);var LegendEquipPanel=function(t){function e(){var e=t.call(this)||this;return e._roleId=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.curIndex=0,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>"),this.getTreasureBtn.touchEnabled=!0,this.legendMc=new MovieClip,this.legendMc1=new MovieClip,this.legendMc2=new MovieClip,this.chargeEff1=new MovieClip,this.chargeEff1.x=this.getTreasureBtn.x+this.getTreasureBtn.width/2,this.chargeEff1.y=this.getTreasureBtn.y+this.getTreasureBtn.height/2,this.chargeEff1.touchEnabled=!1,this.chargeEff1.scaleY=.7,this.chargeEff1.scaleX=.9,this._weaponEffect=new MovieClip,this._bodyEffect=new MovieClip},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.legendMc.playFile(RES_DIR_EFF+"artifacteff",-1),this.addChild(this.legendMc),this.legendMc1.playFile(RES_DIR_EFF+"chuanqizbeff",-1),this.legendMc1.x=this.legend1.x+this.legend1.width/2,this.legendMc1.y=this.legend1.y+this.legend1.height/2,this.legendMc1.scaleX=this.legendMc1.scaleY=1.4,this.addChild(this.legendMc1),this.legendMc2.playFile(RES_DIR_EFF+"chuanqizbeff",-1),this.legendMc2.x=this.legend2.x+this.legend2.width/2,this.legendMc2.y=this.legend2.y+this.legend2.height/2,this.legendMc2.scaleX=this.legendMc2.scaleY=1.4,this.addChild(this.legendMc2),this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this),this.addTouchEvent(this.mixSwordBtn,this.onSelect),this.addTouchEvent(this.mixArmorBtn,this.onSelect),this.addTouchEvent(this.armorIcon,this.onSelect),this.addTouchEvent(this.swordIcon,this.onSelect),this.addTouchEvent(this.executeBtn,this.executeCB),this.observe(UserEquip.ins().postMixGodEquip,this.mixCB),this.observe(UserBag.ins().postItemAdd,this.updateView),this.observe(UserBag.ins().postItemDel,this.updateView),this.observe(UserBag.ins().postItemChange,this.updateView),this.observe(GameLogic.ins().postSubRoleChange,this.updateSubRoleChange),TimerManager.ins().doTimer(2e3,0,this.mcChange,this),this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.getTreasureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this),this.removeTouchEvent(this.mixSwordBtn,this.onSelect),this.removeTouchEvent(this.mixArmorBtn,this.onSelect),this.removeTouchEvent(this.armorIcon,this.onSelect),this.removeTouchEvent(this.swordIcon,this.onSelect),this.removeTouchEvent(this.executeBtn,this.executeCB),TimerManager.ins().remove(this.mcChange,this),this.removeObserve(),DisplayUtils.removeFromParent(this.legendMc),DisplayUtils.removeFromParent(this.legendMc1),DisplayUtils.removeFromParent(this.legendMc2),DisplayUtils.removeFromParent(this._weaponEffect),DisplayUtils.removeFromParent(this._bodyEffect)},e.prototype.mcChange=function(){egret.Tween.removeTweens(this.bgMc);var t=egret.Tween.get(this.bgMc);t.to({alpha:0},1e3).to({alpha:1},1e3)},e.prototype.executeCB=function(t){return parseInt(this.cur.text)<parseInt(this.need.text.substr(1))?void UserTips.ins().showTips("|C:0xf3311e&T:热血碎片不足|"):void(this.executeBtn.label==c_grewup?this.grewup():this.executeBtn.label==c_mix&&this.mix())},e.prototype.grewup=function(){var t=GlobalConfig.ItemConfig[this.curEquipConfigId+1];return t.level>Actor.level||t.zsLevel>UserZs.ins().lv?void UserTips.ins().showTips("|C:0xf3311e&T:升级后超过角色等级，无法升级|"):void UserEquip.ins().sendGrewupEquip(this._roleId,this.curIndex)},e.prototype.grewupCB=function(t,e,i){return 0==e?void UserTips.ins().showTips("|C:0xf3311e&T:升级失败|"):(UserTips.ins().showTips("升级成功"),void this.updateView())},e.prototype.mix=function(){var t=UserEquip.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,this.curIndex,5),e=GlobalConfig.ItemConfig[t];e.level<=Actor.level&&e.zsLevel<=UserZs.ins().lv?UserEquip.ins().sendMixEquip(this._roleId,this.curEquipConfigId,this.curIndex):UserTips.ins().showTips("|C:0xf3311e&T:等级不满足，无法合成|")},e.prototype.mixCB=function(t,e,i){return 0==e?void UserTips.ins().showTips("|C:0xf3311e&T:合成失败|"):(UserTips.ins().showTips("合成成功,已自动穿戴至角色身上"),void this.updateView())},e.prototype.openSmeltView=function(t){ViewManager.ins().open(BreakDownView,BreakDownView.type_legend,5)},e.prototype.onSelect=function(t){Actor.level;switch(t.currentTarget){case this.mixSwordBtn:case this.swordIcon:this.curIndex=0;break;case this.mixArmorBtn:case this.armorIcon:this.curIndex=2}this.updateView()},e.prototype.setRoleId=function(t){this._roleId=t;var e=SubRoles.ins().getSubRoleByIndex(this._roleId),i=e.getEquipByIndex(0),s=e.getEquipByIndex(2);i&&this.checkQuality(i)?this.curIndex=0:s&&this.checkQuality(s)&&(this.curIndex=2),this.updateView()},e.prototype.updateView=function(){this.updateAttrPanel(),this.updateIconAndDesc();var t=this.setRedPoint();t&&this.setEff()},e.prototype.setEff=function(){var t=UserBag.ins().getLegendOutEquips();t.length?(this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1),this.chargeEff1.parent||this.getTreasureBtn.parent.addChild(this.chargeEff1)):DisplayUtils.removeFromParent(this.chargeEff1)},e.prototype.updateSubRoleChange=function(){var t=this.setRedPoint();t&&this.setEff()},e.prototype.checkQuality=function(t){var e=!1;return t&&t.item&&t.item.itemConfig&&(e=5==ItemConfig.getQuality(t.item.itemConfig)),e},e.prototype.updateAttrPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=GlobalConfig.ItemConfig[t.item.configID+1],i=0,s=0,n=ItemConfig.getQuality(t.item.itemConfig);if(void 0==e&&0!=t.item.handle&&5==n)this.mixAttributes.visible=!0,this.grewupAttributes.visible=!1,this.curEquipConfigId=this.updateMixPanel(),this.topLevel.visible=!0,this.costGroup.visible=!1,this.executeBtn.visible=!1,this.need.text="",this.cur.text="";else{if(void 0!=e&&0!=t.item.handle&&5==n){this.mixAttributes.visible=!1,this.grewupAttributes.visible=!0,this.curEquipConfigId=this.updateGrewupPanel(),this.executeBtn.label=c_grewup;var o=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];i=o.count,s=o.itemId}else{if(this.mixAttributes.visible=!0,this.grewupAttributes.visible=!1,this.curEquipConfigId=this.updateMixPanel(),null==this.curEquipConfigId)return;this.executeBtn.label=c_mix;var a=GlobalConfig.LegendComposeConfig[this.curEquipConfigId];i=a.count,s=a.itemId}this.executeBtn.visible=!0,this.topLevel.visible=!1,this.costGroup.visible=!0;var r=UserBag.ins().getBagGoodsCountById(0,s);this.need.text="/"+i,this.cur.text=r+"",r>=i?this.cur.textColor=ColorUtil.GREEN_COLOR_N:this.cur.textColor=ColorUtil.RED_COLOR_N}},e.prototype.updateMixPanel=function(){var t=Actor.level;if(10>t)return void debug.log("error: 10级开启");var e=UserEquip.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,this.curIndex,5),i=GlobalConfig.EquipConfig[e];if(i){var s=[],n=[],o=[];for(var a in AttributeData.translate)!i[a]||i[a]<=0||(n.push(i[a]+""),s.push(AttributeData.getAttrStrByType(AttributeData.translate[a])),o.push(" +"+Math.floor(ItemBase.additionRange/100*i[a])));return this.mixAttributes.baseAttr.text=ItemData.getStringByNextList(n,o),this.mixAttributes.nameAttr.text=ItemData.getStringByList(s),this.mixAttributes.randAttr.text="",this.mixAttributes.score.text=ItemConfig.pointCalNumber(GlobalConfig.ItemConfig[e]),e}},e.prototype.updateGrewupPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=t.item.configID,i=GlobalConfig.ItemConfig[e],s=GlobalConfig.ItemConfig[e+1];if(void 0==s);else{for(var n=1;4>=n;n++)this.grewupAttributes["arrow"+n].visible=!1;var o=[],a=[],r=[],h=[],l=[],c=GlobalConfig.EquipConfig[e],u=GlobalConfig.EquipConfig[e+1],p=t.item,d=1;for(var g in AttributeData.translate)if(c[g]&&!(c[g]<=0)){if(void 0!=p)for(var f=p.att,v=0;v<f.length;v++)if(f[v].type==AttributeData.translate[g]){r.push(" +"+f[v].value);break}this.grewupAttributes["arrow"+d].visible=!0,d++,a.push(c[g]+""),h.push(u[g]+""),l.push(" +"+Math.floor(ItemBase.additionRange/100*u[g])),o.push(AttributeData.getAttrStrByType(AttributeData.translate[g]))}this.grewupAttributes.curBaseAttr.text=ItemData.getStringByNextList(a,r),this.grewupAttributes.nextBaseAttr.text=ItemData.getStringByNextList(h,l),this.grewupAttributes.nameAttr.text=ItemData.getStringByList(o),this.grewupAttributes.curScore.text="评分："+ItemConfig.pointCalNumber(i),this.grewupAttributes.nextScore.text="评分："+ItemConfig.pointCalNumber(s)}return e},e.prototype.updateIconAndDesc=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId),i=t.getEquipByIndex(0),s=t.getEquipByIndex(2);0==this.curIndex?(this.swordSelect.visible=!0,this.armorSelect.visible=!1,this.zhanshi.source=null,this.currentState="jian",this.setWeaponEffect(i.item.configID,"wPos",t.sex,this.weaponEffect,this._weaponEffect),this._bodyEffect.parent&&this._bodyEffect.parent.removeChild(this._bodyEffect)):(this.swordSelect.visible=!1,this.armorSelect.visible=!0,this.zhanshi.source=e.armorImg[0],this.currentState="jia",this.setWeaponEffect(s.item.configID,"bPos",t.sex,this.bodyEffect,this._bodyEffect,2),this._weaponEffect.parent&&this._weaponEffect.parent.removeChild(this._weaponEffect)),this.updateItem(i,this.swordIcon,this.swordLevel,this.mixSwordBtn),this.updateItem(s,this.armorIcon,this.armorLevel,this.mixArmorBtn,2)},e.prototype.updateItem=function(t,e,i,s,n){var o=n?n:this.curIndex,a=GlobalConfig.ItemConfig[UserEquip.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,o,5)].zsLevel;if(0!=t.item.handle&&5==ItemConfig.getQuality(t.item.itemConfig)){var r=GlobalConfig.ItemConfig[t.item.configID];s.visible=!1,i.text=r.zsLevel+"转";for(var h=void 0,l=this.curEquipConfigId;l%100!=99&&(h=GlobalConfig.ItemConfig[this.curEquipConfigId+1],void 0==h);l++);o==ItemConfig.getSubType(t.item.itemConfig)&&void 0!=h?i.x=s.x+15-i.width/2:i.x=s.x+15}else s.visible=!1,i.text=a+"转",i.x=s.x+15},e.prototype.setRedPoint=function(){for(var t=!1,e=!1,i=0;2>i;i++)if(e=UserEquip.ins().setLegendEquipItemUpState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(this._roleId)),e=UserEquip.ins().setLegendEquipItemState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(this._roleId))||e,this["redPoint"+i]&&(this["redPoint"+i].visible=e),t||(t=e),!t){var s=UserBag.ins().getLegendOutEquips();t=s.length>0}return t
},e.prototype.setWeaponEffect=function(t,i,s,n,o,a){void 0===a&&(a=0);var r=GlobalConfig.EquipWithEffConfig[t+"_"+s],h=!1;r||(r=GlobalConfig.EquipWithEffConfig[(0==a?e.swrodImg[1]:e.armorImg[1])+"_"+s],h=!0),o.scaleX=o.scaleY=r.scaling,o.x=this[i+s].x,o.y=this[i+s].y,o.parent||n.addChild(o),o.playFile(RES_DIR_EFF+(h?r.inShowEff:r.nextShowEff),-1)},e}(BaseView);LegendEquipPanel.swrodImg=["chuanqi_0_png","101501"],LegendEquipPanel.armorImg=["chuanqi_1_png","121501"],__reflect(LegendEquipPanel.prototype,"LegendEquipPanel");var c_grewup="升 级",c_mix="合 成",OrangeEquipPanel=function(t){function e(){var e=t.call(this)||this;return e._roleId=0,e.name="神装",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.curIndex=0,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>"),this.getTreasureBtn.touchEnabled=!0,this.chargeEff1=new MovieClip,this.chargeEff1.x=this.getTreasureBtn.x+this.getTreasureBtn.width/2,this.chargeEff1.y=this.getTreasureBtn.y+this.getTreasureBtn.height/2,this.chargeEff1.touchEnabled=!1,this.chargeEff1.scaleY=.7,this.chargeEff1.scaleX=.9},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);for(var i=0;8>i;i++){var s=this["equip"+i];this.addTouchEvent(s,this.onSelect),this.addTouchEvent(s.mixBtn,this.onSelect)}this.addTouchEvent(this.executeBtn,this.executeCB),this.observe(UserEquip.ins().postMixEquip,this.mixCB),this.observe(UserBag.ins().postItemAdd,this.updateView),this.observe(UserBag.ins().postItemDel,this.updateView),this.observe(UserBag.ins().postItemChange,this.updateView),this.curIndex=this.computerCurIndex(),this.updateView(),this.effArr=[]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.getTreasureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);for(var i=0;8>i;i++){var s=this["equip"+i];this.removeTouchEvent(s,this.onSelect),this.removeTouchEvent(s.mixBtn,this.onSelect)}DisplayUtils.removeFromParent(this.chargeEff1),this.removeTouchEvent(this.executeBtn,this.executeCB),this.removeObserve(),this.cleanEff()},e.prototype.onSelect=function(t){Actor.level;switch(t.currentTarget){case this.equip0:case this.equip0.mixBtn:this.curIndex=0;break;case this.equip1:case this.equip1.mixBtn:this.curIndex=1;break;case this.equip2:case this.equip2.mixBtn:this.curIndex=2;break;case this.equip3:case this.equip3.mixBtn:this.curIndex=3;break;case this.equip4:case this.equip4.mixBtn:this.curIndex=4;break;case this.equip5:case this.equip5.mixBtn:this.curIndex=5;break;case this.equip6:case this.equip6.mixBtn:this.curIndex=6;break;case this.equip7:case this.equip7.mixBtn:this.curIndex=7}this.updateView()},e.prototype.executeCB=function(t){var e=this;if(parseInt(this.cur.text)<parseInt(this.need.text.substr(1)))return void UserTips.ins().showTips("|C:0xf3311e&T:神装碎片不足|");if(this.executeBtn.label==c_grewup)this.grewup();else if(this.executeBtn.label==c_mix){var i=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),s=i.item.configID,n=GlobalConfig.ItemConfig[s];if(void 0!=n&&5==ItemConfig.getQuality(n)){var o=GlobalConfig.ItemConfig[i.item.configID],a=o.zsLevel>0?o.zsLevel+"转":o.level+"级",r=ItemConfig.getQualityColor(o).toString(16);WarnWin.show('当前部位上已穿着<font color="#'+r+'">'+a+"传奇装备</font>，是否继续合成红色装备？\n",function(){e.mix()},this)}else this.mix()}},e.prototype.grewup=function(){var t=GlobalConfig.ItemConfig[this.curEquipConfigId+1];return t.level>Actor.level||t.zsLevel>UserZs.ins().lv?void UserTips.ins().showTips("|C:0xf3311e&T:升级后超过角色等级，无法升级|"):void UserEquip.ins().sendGrewupEquip(this._roleId,this.curIndex)},e.prototype.grewupCB=function(t,e,i){return 0==e?void UserTips.ins().showTips("|C:0xf3311e&T:升级失败|"):(UserTips.ins().showTips("升级成功"),void this.updateView())},e.prototype.mix=function(){UserEquip.ins().sendMixEquip(this._roleId,this.curEquipConfigId,this.curIndex)},e.prototype.mixCB=function(t,e,i){return 0==e?void UserTips.ins().showTips("|C:0xf3311e&T:合成失败|"):(UserTips.ins().showTips("合成成功,已自动穿戴至角色身上"),void this.updateView())},e.prototype.openSmeltView=function(t){ViewManager.ins().open(BreakDownView,BreakDownView.type_legend,4)},e.prototype.updateView=function(){this.updateAllEquipItem(),this.updateDetailPanel(),UserBag.ins().getLegendHasResolve()?(this.chargeEff1.visible=!0,this.chargeEff1.playFile(RES_DIR_EFF+"chargeff1",-1),this.chargeEff1.parent||this.btnGroup.addChild(this.chargeEff1)):(this.chargeEff1.visible=!1,DisplayUtils.removeFromParent(this.chargeEff1)),this.setItemRedPoint()},e.prototype.updateDetailPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);if(null!=t){var e=GlobalConfig.ItemConfig[t.item.configID+1],i=0,s=0;this.costNum.visible=!0;var n=ItemConfig.getQuality(t.item.itemConfig);if(void 0==e&&0!=t.item.handle&&4==n)this.mixPanel.visible=!0,this.labelMax.visible=!0,this.grewupPanel.visible=!1,this.curEquipConfigId=this.updateMixPanel(),this.executeBtn.visible=!1,this.need.text="",this.cur.text="",this.costNum.visible=!1;else{if(void 0!=e&&0!=t.item.handle&&4==n&&1!=t.item.itemConfig.level&&-1==UserBag.fitleEquip.indexOf(t.item.configID)){this.mixPanel.visible=!1,this.grewupPanel.visible=!0,this.curEquipConfigId=this.updateGrewupPanel(),this.executeBtn.label=c_grewup;var o=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];i=o.count,s=o.itemId}else{this.mixPanel.visible=!0,this.grewupPanel.visible=!1,this.curEquipConfigId=this.updateMixPanel(),this.executeBtn.label=c_mix;var a=GlobalConfig.LegendComposeConfig[this.curEquipConfigId];i=a.count,s=a.itemId}var r=UserBag.ins().getBagGoodsCountById(0,s);this.need.text="/"+i,this.cur.text=r+"",r>=i?this.cur.textColor=ColorUtil.GREEN_COLOR_N:this.cur.textColor=ColorUtil.RED_COLOR_N,this.executeBtn.visible=!0,this.labelMax.visible=!1}}},e.prototype.updateMixPanel=function(){var t,e,i=Actor.level;if(i>=1){var s=this.curIndex,n=SubRoles.ins().getSubRoleByIndex(this._roleId);e=UserEquip.ins().getEquipConfigIDByPosAndQualityByGod(n,s,4,SubRoles.ins().getSubRoleByIndex(this._roleId).job),t=GlobalConfig.ItemConfig[e]}void 0!=t&&(t.zsLevel>0?this.mixPanel.level.text=t.zsLevel+"转":this.mixPanel.level.text=t.level?"Lv."+t.level:"Lv.1",this.mixPanel.equipName.text=t.name,this.mixPanel.itemIcon.imgJob.visible=!1,this.mixPanel.itemIcon.setData(t));var o=[],a=[],r=[],h=GlobalConfig.EquipConfig[e];for(var l in AttributeData.translate)!h[l]||h[l]<=0||(a.push(h[l]+""),o.push(AttributeData.getAttrStrByType(AttributeData.translate[l])),r.push(" +"+Math.floor(ItemBase.additionRange*h[l]/100)));return this.mixPanel.attributes.baseAttr.text=ItemData.getStringByNextList(a,r),this.mixPanel.attributes.randAttr.text="",this.mixPanel.attributes.nameAttr.text=ItemData.getStringByList(o),this.mixPanel.attributes.score.text=ItemConfig.pointCalNumber(t),e},e.prototype.updateGrewupPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=t.item.configID,i=GlobalConfig.ItemConfig[e],s=GlobalConfig.ItemConfig[e+1];if(void 0==s);else{this.grewupPanel.curName.text=i.name+"",this.grewupPanel.nextName.text=s.name+"",i.zsLevel>0?this.grewupPanel.curLevel.text=i.zsLevel+"转":this.grewupPanel.curLevel.text=i.level?"Lv."+i.level:"Lv.1",s.zsLevel>0?this.grewupPanel.nextLevel.text=s.zsLevel+"转":this.grewupPanel.nextLevel.text=s.level?"Lv."+s.level:"Lv.1",this.grewupPanel.curItemIcon.imgJob.visible=!1,this.grewupPanel.nextItemIcon.imgJob.visible=!1,this.grewupPanel.curItemIcon.setData(i),this.grewupPanel.nextItemIcon.setData(s);for(var n=1;4>=n;n++)this.grewupPanel.attributes["arrow"+n].visible=!1;var o=[],a=[],r=[],h=[],l=[],c=GlobalConfig.EquipConfig[e],u=GlobalConfig.EquipConfig[e+1],p=t.item,d=1;for(var g in AttributeData.translate)if(c[g]&&!(c[g]<=0)){if(void 0!=p)for(var f=p.att,v=0;v<f.length;v++)if(f[v].type==AttributeData.translate[g]){r.push(" +"+f[v].value);break}this.grewupPanel.attributes["arrow"+d].visible=!0,d++,a.push(c[g]+""),h.push(u[g]+""),l.push(" +"+Math.floor(ItemBase.additionRange*u[g]/100)),o.push(AttributeData.getAttrStrByType(AttributeData.translate[g]))}this.grewupPanel.attributes.curBaseAttr.text=ItemData.getStringByNextList(a,r),this.grewupPanel.attributes.nextBaseAttr.text=ItemData.getStringByNextList(h,l),this.grewupPanel.attributes.nameAttr.text=ItemData.getStringByList(o),this.grewupPanel.attributes.curScore.text="评分："+ItemConfig.pointCalNumber(i),this.grewupPanel.attributes.nextScore.text="评分："+ItemConfig.pointCalNumber(s)}return e},e.prototype.updateAllEquipItem=function(){for(var t=0;8>t;t++)this.updateEquipItem(t)},e.prototype.updateEquipItem=function(t){var i=this["equip"+t];if(null!=i){var s=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(t),n=i.itemIcon;n.imgJob.visible=!1,-1!=UserBag.fitleEquip.indexOf(s.item.configID)||0==s.item.handle||ItemConfig.getQuality(s.item.itemConfig)<4||1==s.item.itemConfig.level&&!s.item.itemConfig.zsLevel?(n.setData(null),n.imgIcon.source=e.defaultEquipIcon[t],i.level.text="",i.mixBtn.visible=!1,this.cleanEffOnly(t)):(i.mixBtn.visible=!1,s.item.itemConfig.zsLevel>0?i.level.text=s.item.itemConfig.zsLevel+"转":i.level.text=s.item.itemConfig.level?"Lv."+s.item.itemConfig.level:"Lv.1",n.setData(s.item.itemConfig),this.playEff(t)),this.curIndex==t?i.select.visible=!0:i.select.visible=!1}},e.prototype.playEff=function(t){if(!(0>t||t>7)){var e=t;this["effArr"+e]||(this["effArr"+e]=new MovieClip,this["effArr"+e].x+=this["equip"+e].width/2,this["effArr"+e].y+=this["equip"+e].height/2-15,this["equip"+e].addChild(this["effArr"+e]),this["effArr"+e].playFile(RES_DIR_EFF+"quality_05",-1))}},e.prototype.cleanEffOnly=function(t){if(!(0>t||t>7)){var e=t;this["effArr"+e]&&(DisplayUtils.removeFromParent(this["effArr"+e]),this["effArr"+e]=null)}},e.prototype.cleanEff=function(){for(var t=0;8>t;t++)this["effArr"+t]&&(DisplayUtils.removeFromParent(this["effArr"+t]),this["effArr"+t]=null)},e.prototype.setItemRedPoint=function(){for(var t=0;8>t;t++){var e=this["equip"+t],i=SubRoles.ins().getSubRoleByIndex(this._roleId);if(e.redPoint.visible=UserEquip.ins().setOrangeEquipItemState(t,i),e.redPoint.visible){var s=UserBag.ins().checkEqRedPoint(t,i,!0);e.redPoint.visible=null!=s?s:e.redPoint.visible}}},e.prototype.computerCurIndex=function(){return 0},e.prototype.setRoleId=function(t){this._roleId=t,this.updateView()},e}(BaseView);OrangeEquipPanel.defaultEquipIcon=["xb_10","xb_11","xb_12","xb_13","xb_14","xb_15","xb_16","xb_17"],__reflect(OrangeEquipPanel.prototype,"OrangeEquipPanel");var RuneExchangeShopWin=function(t){function e(){var e=t.call(this)||this;return e.curSelectIndex=0,e.skinName="RuneExchangeShop",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.panelArr=[this.runeShop],this.viewStack.selectedIndex=0,this.tab.dataProvider=this.viewStack},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.menulist1,this.onClick),this.addTouchEvent(this.tab,this.onTabTouch),this.runeShop.curRole=0,this.setSelectedIndex(0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.menulist1,this.onClick),this.tab.removeEventListener(egret.Event.CHANGE,this.onTabTouch,this),this.removeObserve(),this.panelArr[this.curSelectIndex].close()},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.runeShop.open()}},e.prototype.onClick=function(t){},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.panelArr[t].open(),this.viewStack.selectedIndex=t},e}(BaseEuiView);__reflect(RuneExchangeShopWin.prototype,"RuneExchangeShopWin"),ViewManager.ins().reg(RuneExchangeShopWin,LayerManager.UI_Main);var TreasureChuanshiGiftWin=function(t){function e(){var e=t.call(this)||this;return e.lastSelected=-1,e.maxNum=0,e.skinName="TreasureChuanshiGift",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.id=t[1],this.num=t[2],this.addTouchEvent(this,this.onTouch),this.observe(UserBag.ins().postGiftResult,this.otherClose),this.addTouchEndEvent(this.minBtn0,this.onTap),this.addTouchEndEvent(this.maxBtn0,this.onTap),this.addTouchEndEvent(this.sub1Btn0,this.onTap),this.addTouchEndEvent(this.add1Btn0,this.onTap),this.addChangeEvent(this.numLabel0,this.onTxtChange),this.numLabel0.restrict="0-9",this.numLabel0.text="0",this.add.touchEnabled=!1,this.add.touchChildren=!1,this.update()},e.prototype.update=function(){var t=GlobalConfig.OptionalGiftConfig[this.id];this.gift.itemRenderer=TreasureChuanshiItemRender,t.show[0].reward.length<=4?this.currentState="special":this.currentState="normal",this.validateNow(),this.gift.dataProvider=new eui.ArrayCollection(t.show[0].reward),this.gift.validateNow(),this.choose.textFlow=TextFlowMaker.generateTextFlow1(t.show[0].str),this.maxNum=this.num,this.useNum=0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTouch),this.lastSelected=-1},e.prototype.onTouch=function(t){if(t.target==this.get){if(this.gift.selectedIndex<0)return void UserTips.ins().showTips("请选择一个奖励");if(!this.useNum)return void UserTips.ins().showTips("请选择开启的数量");UserBag.ins().sendChoosableGift(this.id,this.useNum,this.gift.selectedIndex)}else t.target.parent==this.gift?(this.lastSelected>=0&&this.gift.getChildAt(this.lastSelected).checkSelcted(this.gift.selectedIndex),this.lastSelected=this.gift.selectedIndex,this.gift.dataProvider&&this.lastSelected>-1&&this.lastSelected<this.gift.dataProvider.length&&this.gift.getChildAt(this.lastSelected).checkSelcted(this.gift.selectedIndex),this.add.touchChildren=!0,this.useNum=this.num,this.numLabel0.text=this.useNum+""):t.target==this.bgClose&&this.otherClose()},e.prototype.otherClose=function(){ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.target){case this.minBtn0:this.useNum=1;break;case this.maxBtn0:this.useNum=this.maxNum;break;case this.sub1Btn0:this.useNum--,this.useNum<=0&&(this.useNum=1);break;case this.add1Btn0:this.useNum++,this.useNum>this.maxNum&&(this.useNum=this.maxNum)}this.numLabel0.text=this.useNum+""},e.prototype.onTxtChange=function(t){var e=Number(this.numLabel0.text);e>this.maxNum?e=this.maxNum:0>=e&&(e=1),this.useNum=e,this.numLabel0.text=this.useNum+""},e}(BaseEuiView);__reflect(TreasureChuanshiGiftWin.prototype,"TreasureChuanshiGiftWin"),ViewManager.ins().reg(TreasureChuanshiGiftWin,LayerManager.UI_Popup);var TreasureChuanshiItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="TreasureChuanshiItem",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.gift.data=this.data,this.select.visible=this.select2.visible=!1},e.prototype.checkSelcted=function(t){this.select.visible=this.select2.visible=this.itemIndex==t},e}(BaseItemRender);__reflect(TreasureChuanshiItemRender.prototype,"TreasureChuanshiItemRender");var TreasureChuanshiPanel=function(t){function e(){var e=t.call(this)||this;return e.addBoxEvent=!1,e.huntType=0,e.name="传世",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){for(var t,e=GlobalConfig.HeirloomTreasureConfig.boxes.length,i=0;e>i;i++)t=this["gift"+i],t.data=GlobalConfig.HeirloomTreasureConfig.boxes[i];this.eff=new MovieClip,this.eff.x=59,this.eff.y=23,this.eff.scaleX=.8,this.eff.scaleY=.8,this.eff.touchEnabled=!1,this.list.itemRenderer=HuntListRenderer,this.zb1.text=GlobalConfig.HeirloomTreasureConfig.huntOnce+"",this.zb10.text=GlobalConfig.HeirloomTreasureConfig.huntTenth+""},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.addTouchEvent(this.outBag,this.onBuy),this.observe(Heirloom.ins().postHuntRecord,this.listRefush),this.observe(UserBag.ins().postItemAdd,this.setRedStatu),this.observe(Heirloom.ins().postHuntBoxInfo,this.updateBox),this.observe(Heirloom.ins().postHuntResult,this.updateMaterial),this.listRefush(),Heirloom.ins().sendHuntRecord(),this.updateBox(),this.addBoxEvent=!0,this.updateMaterial(),this.setRedStatu();var i=DateUtils.calcWeekFirstDay();this.endedTime=i.getTime()/1e3,TimerManager.ins().remove(this.timeClock,this),TimerManager.ins().doTimer(1e3,0,this.timeClock,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buy1,this.onBuy),this.removeTouchEvent(this.buy10,this.onBuy),this.removeTouchEvent(this.outBag,this.onBuy),this.removeObserve(),DisplayUtils.removeFromParent(this.eff),TimerManager.ins().remove(this.timeClock,this),this.addBoxEvent=!1},e.prototype.timeClock=function(){if(this.endedTime-=1,this.endedTime<=0){var t=DateUtils.calcWeekFirstDay();this.endedTime=t.getTime()/1e3}this.leftTimeTxt.text=DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)},e.prototype.listRefush=function(){this.list.dataProvider=new eui.ArrayCollection(Heirloom.ins().huntRecords)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Heirloom)}},e.prototype.buyHunt=function(t){if(0==t&&Heirloom.ins().huntFreeTimes>0)return void Heirloom.ins().sendHunt(t);this.huntType=t;var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.HeirloomTreasureConfig.huntItem);if(e&&e.count)Heirloom.ins().sendHunt(t);else{var i=0==t?GlobalConfig.HeirloomTreasureConfig.huntOnce:GlobalConfig.HeirloomTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureChuanshiPanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.HeirloomTreasureConfig.huntItem].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.HeirloomTreasureConfig.huntOnce:GlobalConfig.HeirloomTreasureConfig.huntTenth;Actor.yb>=t?Heirloom.ins().sendHunt(this.huntType):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.setRedStatu=function(){var t=Boolean(UserBag.ins().getHuntGoods(2).length);t?(this.outBag.parent.addChildAt(this.eff,this.getChildIndex(this.outBag)),this.eff.playFile(RES_DIR_EFF+"chargeff1",-1)):DisplayUtils.removeFromParent(this.eff),this.redPoint2.visible=t},e.prototype.updateBox=function(){var t,e,i=Heirloom.ins().huntBoxInfo.length,s=0;for(var n in GlobalConfig.HeirloomTreasureRewardConfig)e=GlobalConfig.HeirloomTreasureRewardConfig[n],this["time"+s].text=e.needTime+"次",this["time"+s].visible=!0,this["done"+s].visible=!1,this["boxPoint"+s].visible=!1,this["bar"+s].value=0,this["box"+s].source="200116_0_png",this["box"+s].name="box"+(s+1),this.addBoxEvent||this.addTouchEvent(this["box"+s],this.onGetAward),i>s&&(t=Heirloom.ins().huntBoxInfo[s],t==Heirloom.CANGET?(this["box"+s].source="200116_png",this["bar"+s].value=100,this["boxPoint"+s].visible=!0):t==Heirloom.ISNGET&&(this["time"+s].visible=!1,this["done"+s].visible=!0,this["bar"+s].value=100)),s++;this.hopeValue0.text=Heirloom.ins().huntHope+"",this.times.text=Heirloom.ins().huntTimes+"",this.maskImage(),this.redPoint3.visible=Heirloom.ins().huntFreeTimes>0,this.buy1.label=Heirloom.ins().huntFreeTimes>0?"免费寻宝":"寻宝一次"},e.prototype.maskImage=function(){var t=Heirloom.ins().huntHope,e=GlobalConfig.HeirloomTreasureConfig.maxBlissVal,i=Math.floor(.01*Math.pow(t,.74)*e)/e;return i=1>i?i:1,i>=1?(this.maxHopeValue0.mask&&(this.maxHopeValue0.mask=null),void(this.maskShape&&(this.maskShape.graphics.clear(),this.maskShape=null))):(this.maxHopeValue0.mask||(this.maskShape=new egret.Shape,this.maskShape.graphics.beginFill(16776960),this.maskShape.graphics.drawRect(this.maxHopeValue0.x,this.maxHopeValue0.y,this.maxHopeValue0.width,this.maxHopeValue0.height),this.maxHopeValue0.parent.addChild(this.maskShape),this.maxHopeValue0.mask=this.maskShape),void(this.maskShape.y=this.maxHopeValue0.height*(1-i)))},e.prototype.onGetAward=function(t){var e=t.target.name.slice(3,4),i=Heirloom.ins().huntBoxInfo[e-1];i==Heirloom.CANGET?Heirloom.ins().sendHuntAward(e):ViewManager.ins().open(HuntBoxsTips,e,2)},e.prototype.updateMaterial=function(){var t=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.HeirloomTreasureConfig.huntItem),e=t?t.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|"),this.num10.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|")},e}(BaseView);__reflect(TreasureChuanshiPanel.prototype,"TreasureChuanshiPanel");var TreasureHuntPanel=function(t){function e(){var e=t.call(this)||this;return e.huntType=0,e.name="装备",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.updateDescEx();var t;Activity.ins().IsHefuXunBaoTimer()?(this.bdsz.visible=!1,t=GlobalConfig.TreasureHuntPoolHefuConfig):t=GlobalConfig.TreasureHuntPoolConfig,this.id1=t[1].reward[0].id,this.id2=t[2].reward[0].id,this.list1.itemRenderer=ItemBase,this.list2.itemRenderer=ItemBase,this.list1.dataProvider=new eui.ArrayCollection(t[3].reward),this.list2.dataProvider=new eui.ArrayCollection(t[4].reward);GlobalConfig.ItemConfig;this.mc1=new MovieClip,this.mc1.x=this.icon1.x+36,this.mc1.y=this.icon1.y+38,this.mc1.scaleX=this.mc1.scaleY=1.4,this.chuanqi.addChild(this.mc1),this.mc2=new MovieClip,this.mc2.x=this.icon2.x+36,this.mc2.y=this.icon2.y+38,this.mc2.scaleX=this.mc2.scaleY=1.4,this.chuanqi.addChild(this.mc2),this.list.itemRenderer=HuntListRenderer,this.listRefush([]),this.longZhuEff=new MovieClip,this.longZhuEff.x=75,this.longZhuEff.y=35,this.longZhuEff.touchEnabled=!1,this.eff=new MovieClip,this.eff.x=59,this.eff.y=23,this.eff.scaleX=.8,this.eff.scaleY=.8,this.eff.touchEnabled=!1,this.open()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.longZhuEff.playFile(RES_DIR_EFF+"longzubaozangeff",-1),this.titleMcGroup.addChild(this.longZhuEff),this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.addTouchEvent(this.outBag,this.onBuy),this.addTouchEvent(this.icon1,this.onClick),this.addTouchEvent(this.icon2,this.onClick),this.observe(Hunt.ins().postBestListInfo,this.listRefush),this.observe(UserBag.ins().postItemAdd,this.setRedStatu),this.observe(Hunt.ins().postHuntResult,this.callHuntResult),this.mc1.playFile(RES_DIR_EFF+"chuanqizbeff",-1),this.mc2.playFile(RES_DIR_EFF+"chuanqizbeff",-1),this.listRefush([]),Hunt.ins().sendHuntList(),this.setRedStatu()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buy1,this.onBuy),this.removeTouchEvent(this.buy10,this.onBuy),this.removeTouchEvent(this.icon1,this.onClick),this.removeTouchEvent(this.icon2,this.onClick),this.removeTouchEvent(this.outBag,this.onBuy),DisplayUtils.removeFromParent(this.eff),this.removeObserve()},e.prototype.setRedStatu=function(){var t=Boolean(UserBag.ins().getHuntGoods(0).length);t?(this.outBag.parent.addChildAt(this.eff,this.getChildIndex(this.outBag)),this.eff.playFile(RES_DIR_EFF+"chargeff1",-1)):DisplayUtils.removeFromParent(this.eff),this.redPoint2.visible=t},e.prototype.listRefush=function(t){this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Equip)}},e.prototype.buyHunt=function(t){this.huntType=t;var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem);if(e&&e.count)Hunt.ins().sendHunt(t);else{var i=0==t?GlobalConfig.TreasureHuntConfig.huntOnce:GlobalConfig.TreasureHuntConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureHuntPanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.TreasureHuntConfig.huntItem].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.TreasureHuntConfig.huntOnce:GlobalConfig.TreasureHuntConfig.huntTenth;Actor.yb>=t?Hunt.ins().sendHunt(this.huntType):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onClick=function(t){switch(t.target){case this.icon1:ViewManager.ins().open(EquipDetailedWin,1,void 0,this.id1);break;case this.icon2:ViewManager.ins().open(EquipDetailedWin,1,void 0,this.id2)}},e.prototype.callHuntResult=function(){this.updateDescEx()},e.prototype.updateDescEx=function(){var t=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem),e=t?t.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.num10.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e>=10?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.zb1.text=GlobalConfig.TreasureHuntConfig.huntOnce+"",this.zb10.text=GlobalConfig.TreasureHuntConfig.huntTenth+""},e}(BaseView);__reflect(TreasureHuntPanel.prototype,"TreasureHuntPanel");var TreasureHuntWin=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.curSelectIndex=0,e.skinName="TreasureHuntSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.panelArr=[this.treasureHuntPanel,this.treasureRune,this.treasureChuanshi],this.viewStack.selectedIndex=0,this.checkHeirloomOpen(),this.tab.dataProvider=this.viewStack},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0;this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.help,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen),this.observe(UserBag.ins().postItemChange,this.setRedPoint),this.observe(UserBag.ins().postItemAdd,this.setRedPoint),this.observe(UserBag.ins().postItemDel,this.setRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint),this.observe(Rune.ins().postRuneBoxGift,this.setRedPoint),this.observe(GameServer.ins().postServerOpenDay,this.checkHeirloomOpen),this.observe(UserZs.ins().postZsLv,this.checkHeirloomOpen),this.setSelectedIndex(i),this.setRedPoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panelArr[this.curSelectIndex].close()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:var e=void 0;0==this.tab.selectedIndex?e=39:1==this.tab.selectedIndex?e=13:2==this.tab.selectedIndex&&(e=40),e&&ViewManager.ins().open(ZsBossRuleSpeak,e)}},e.prototype.switchRole=function(){},e.prototype.checkIsOpen=function(t){var e=t.target,i=GlobalConfig.FuwenTreasureConfig.openlevel;return 1==e.selectedIndex&&Actor.level<i?(UserTips.ins().showTips(i+"级开启"),t.$cancelable=!0,void t.preventDefault()):void 0},e.prototype.onTabTouch=function(t){this.panelArr[this.curSelectIndex].close();var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e),this.setRedPoint(),ViewManager.ins().close(LimitTaskView)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.panelArr[t].open(),this.viewStack.selectedIndex=t},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[0])if(2==t[0]){if(!Heirloom.ins().isHeirloomHuntOpen())return UserTips.ins().showTips("开服第"+(GlobalConfig.HeirloomTreasureConfig.openDay+1)+"天达到"+GlobalConfig.HeirloomTreasureConfig.openZSlevel+"转后方可参与"),!1}else if(1==t[0]&&Actor.level<GlobalConfig.FuwenTreasureConfig.openlevel)return UserTips.ins().showTips(GlobalConfig.FuwenTreasureConfig.openlevel+"级开启"),!1;return OpenSystem.ins().checkSysOpen(SystemType.TREASURE)?(ViewManager.ins().close(LiLianWin),!0):(UserTips.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.TREASURE)),!1)},e.prototype.setRedPoint=function(){this.redPoint0.visible=Boolean(UserBag.ins().getHuntGoods(0).length),this.redPoint1.visible=Boolean(UserBag.ins().getHuntGoods(1).length)||Rune.ins().getIsGetBox()||RuneRedPointMgr.ins().checkCanExchange(),this.redPoint2.visible=Boolean(Heirloom.ins().isHeirloomHuntOpen()&&(UserBag.ins().getHuntGoods(2).length||Heirloom.ins().getIsGetBox()))},e.prototype.checkHeirloomOpen=function(){Heirloom.ins().isHeirloomHuntOpen()?this.viewStack.length<3&&(this.viewStack.addChild(this.treasureChuanshi),this.redGroup.addChild(this.redPoint2),this.tab.dataProvider=this.viewStack):this.viewStack.length>2&&(this.viewStack.removeChildAt(2),this.redGroup.removeChildAt(2),this.tab.dataProvider=this.viewStack)},e}(BaseEuiView);__reflect(TreasureHuntWin.prototype,"TreasureHuntWin"),ViewManager.ins().reg(TreasureHuntWin,LayerManager.UI_Main);var TreasureRunePanel=function(t){function e(){var e=t.call(this)||this;return e.huntType=0,e.name="战纹",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.updateDescEx();var t=GlobalConfig.FuwenTreasureLevelConfig,e=SkyLevelModel.ins().cruLevel,i=null;for(var s in t){var n=t[s];if(e>=n.level&&e<=n.levelend){i=n;break}}this.list1.itemRenderer=ItemBase,this.list1.dataProvider=new eui.ArrayCollection(i.showicon),this.eff=new MovieClip,this.eff.x=59,this.eff.y=23,this.eff.scaleX=.8,this.eff.scaleY=.8,this.eff.touchEnabled=!1,this.open()},e.prototype.sortFunc=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(i)],o=GlobalConfig.RuneNameConfig[ItemConfig.getSubType(s)];return n.type<o.type?-1:1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.addTouchEvent(this.outBag,this.onBuy),this.addTouchEvent(this.outBag0,this.onBuy),this.observe(Rune.ins().postHuntRuneInfo,this.callRuneResult);for(var i=0;i<Rune.BoxSum;i++)this.addTouchEvent(this["box"+i],this.onTab);this.observe(UserBag.ins().postHuntStore,this.setRedStatu),this.observe(Rune.ins().postRuneBoxGift,this.callback),Hunt.ins().sendHuntList(),this.setRedStatu(),this.setBoxData();for(var i=0;i<this.list1.numElements;i++){var s=this.list1.getElementAt(i);s&&(s.clearEffect(),s.HideImgBg())}var n=DateUtils.calcWeekFirstDay();this.endedTime=n.getTime()/1e3,TimerManager.ins().remove(this.timeClock,this),TimerManager.ins().doTimer(1e3,0,this.timeClock,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buy1,this.onBuy),this.removeTouchEvent(this.buy10,this.onBuy),this.removeTouchEvent(this.outBag,this.onBuy),DisplayUtils.removeFromParent(this.eff);for(var i=0;i<Rune.BoxSum;i++)this.removeTouchEvent(this["box"+i],this.onTab);this.removeObserve(),TimerManager.ins().remove(this.timeClock,this)},e.prototype.timeClock=function(){if(this.endedTime-=1,this.endedTime<=0){var t=DateUtils.calcWeekFirstDay();this.endedTime=t.getTime()/1e3}this.leftTime.text="累计重置剩余时间："+DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)},e.prototype.setRedStatu=function(){var t=Boolean(UserBag.ins().getHuntGoods(1).length);t?(this.outBag.parent.addChildAt(this.eff,this.getChildIndex(this.outBag)),this.eff.playFile(RES_DIR_EFF+"chargeff1",-1)):DisplayUtils.removeFromParent(this.eff),this.redPoint2.visible=t,this.redPoint0.visible=RuneRedPointMgr.ins().checkCanExchange()},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(0);
break;case this.buy10:this.buyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Rune);break;case this.outBag0:ViewManager.ins().open(RuneExchangeShopWin)}},e.prototype.onTab=function(t){for(var e=0;e<Rune.BoxSum;e++)if(t.target==this["box"+e]){if(Rune.ins().boxs[e]==Rune.UNGET){ViewManager.ins().open(HuntBoxsTips,e+1);break}if(Rune.ins().boxs[e]==Rune.ISNGET){ViewManager.ins().open(HuntBoxsTips,e+1);break}this.boxId=e+1,Rune.ins().sendRuneBoxGift(e+1);break}},e.prototype.buyHunt=function(t){this.huntType=t;var e=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem);if(e&&e.count)Rune.ins().sendHuntRune(t);else{var i=0==t?GlobalConfig.FuwenTreasureConfig.huntOnce:GlobalConfig.FuwenTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureRunePanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.FuwenTreasureConfig.huntItem].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.FuwenTreasureConfig.huntOnce:GlobalConfig.FuwenTreasureConfig.huntTenth;Actor.yb>=t?Rune.ins().sendHuntRune(this.huntType):UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.callback=function(){if(this.boxId){var t=GlobalConfig.FuwenTreasureRewardConfig[this.boxId];if(t)for(var e=0;e<t.reward.length;e++)UserTips.ins().showTips("|C:0xff00ff&T:获得战纹碎片X"+t.reward[e].count);this.boxId=0}this.setBoxData()},e.prototype.setBoxData=function(){this.times.text=Rune.ins().runeCount+"";for(var t=0;t<Rune.BoxSum;t++){var e=GlobalConfig.FuwenTreasureRewardConfig[t+1],i=e.needTime?e.needTime:0;switch(Rune.ins().boxs[t]){case Rune.UNGET:this["time"+t].text=i+"次",this["time"+t].visible=!0,this["done"+t].visible=!this["time"+t].visible,this["box"+t].source="200116_0_png",this["boxPoint"+t].visible=!1;break;case Rune.CANGET:this["time"+t].text=i+"次",this["time"+t].visible=!1,this["done"+t].visible=!this["time"+t].visible,this["done"+t].text="可领取",this["box"+t].source="200116_png",this["boxPoint"+t].visible=!0;break;case Rune.ISNGET:this["time"+t].text=i+"次",this["time"+t].visible=!1,this["done"+t].visible=!this["time"+t].visible,this["done"+t].text="已领取",this["box"+t].source="200116_0_png",this["boxPoint"+t].visible=!1}}},e.prototype.callRuneResult=function(){this.updateDescEx()},e.prototype.updateDescEx=function(){var t=UserBag.ins().getBagGoodsByTypeAndId(UserBag.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem),e=t?t.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.num10.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e>=10?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.zw1.text=GlobalConfig.FuwenTreasureConfig.huntOnce+"",this.zw10.text=GlobalConfig.FuwenTreasureConfig.huntTenth+"",this.hopeValue.text=Rune.ins().hope+"",this.maskImage()},e.prototype.maskImage=function(){var t=Rune.ins().hope,e=GlobalConfig.FuwenTreasureConfig.maxBlissVal,i=Math.floor(.0096*Math.pow(t,.6719)*e)/e;if(i=1>i?i:1,i>=1)return DisplayUtils.removeFromParent(this.masksp),void(this.masksp=null);var s=118;if(!this.masksp){this.masksp=new egret.Sprite;var n=new egret.Shape;n.graphics.beginFill(16776960),n.graphics.drawRect(this.maxHopeValue.x,this.maxHopeValue.y,90,s),n.graphics.endFill(),this.masksp.addChild(n),this.maxHopeValue.parent.addChild(this.masksp),this.maxHopeValue.mask=this.masksp}this.masksp.y=s*(1-i)},e}(BaseView);__reflect(TreasureRunePanel.prototype,"TreasureRunePanel");var ItemBaseStore=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onClick=function(){var t=this.data.handle;UserBag.ins().sendGetGoodsByStore(t)},e}(ItemBase);__reflect(ItemBaseStore.prototype,"ItemBaseStore");var TreasureStorePanel=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.skinName="TreasureStore",this.list.itemRenderer=ItemBaseStore,this.listScroller.viewport=this.list},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.addTouchEvent(this.get,this.getGoods),this.observe(UserBag.ins().postHuntStore,this.updateData),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.get,this.getGoods),this.removeObserve()},e.prototype.updateData=function(){var t=UserBag.ins().getHuntGoodsBySort(this.type);this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.getGoods=function(t){this.list.dataProvider.length>0&&UserBag.ins().sendGetGoodsByStore(this.type)},e}(BaseEuiView);__reflect(TreasureStorePanel.prototype,"TreasureStorePanel"),ViewManager.ins().reg(TreasureStorePanel,LayerManager.UI_Main);var UserVip=function(t){function e(){var e=t.call(this)||this;return e.weekState=0,e.vipGiftState=[],e.sysId=PackageID.Vip,e.regNetMsg(1,e.postUpdateVipData),e.regNetMsg(2,e.postUpdataExp),e.regNetMsg(3,e.postUpdateVipAwards),e.regNetMsg(4,e.postUpdateWeekAwards),e.regNetMsg(5,e.postVipGiftBuy),e.regNetMsg(6,e.postSuperVipInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){var t=window.getVipInfo();t&&(this.superVipData=t,this.postSuperVipData(this.superVipData))},e.prototype.postSuperVipData=function(t){return t},e.prototype.sendGetAwards=function(t){var e=this.getBytes(1);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetWeekAwards=function(){this.sendBaseProto(4)},e.prototype.sendGetVipGift=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.sendGetSuperVipInfo=function(){this.sendBaseProto(6)},e.prototype.postUpdateVipData=function(t){this.lv=t.readShort(),this.exp=t.readInt(),this.state=t.readInt(),this.weekState=t.readShort();var e=t.readShort();this.vipGiftState=[];for(var i=0;e>i;i++){var s=t.readUnsignedInt(),n=t.readByte(),o={id:s,state:n};this.vipGiftState.push(o)}},e.prototype.postUpdataExp=function(t){var e=t.readShort();this.exp=t.readInt(),this.weekState=t.readShort(),e>this.lv&&(this.lv=e)},e.prototype.postUpdateVipAwards=function(t){this.state=t.readInt()},e.prototype.postUpdateWeekAwards=function(t){var e=t.readBoolean();e&&(this.weekState=0)},e.prototype.postVipGiftBuy=function(t){for(var e=t.readShort(),i=0;e>i;i++)for(var s=t.readUnsignedInt(),n=t.readByte(),o=0;o<this.vipGiftState.length;o++)s==this.vipGiftState[o].id&&(this.vipGiftState[o].state=n)},e.prototype.postSuperVipInfo=function(t){this.superVip=this.superVip||[];for(var e=2,i=0;e>i;i++)this.superVip[i]=Math.floor(t.readInt()/100)},e.prototype.getSuperVipState=function(){if(this.superVip)for(var t in GlobalConfig.SuperVipConfig){var e=GlobalConfig.SuperVipConfig[t],i=+t-1;if(e.money<=(this.superVip[i]||0))return!0}return!1},e.prototype.getVipState=function(){for(var t=!1,e=0;e<this.lv;e++)if(void 0!=this.state&&0==(this.state>>e&1))return t=!0;return t},e.prototype.getVipGiftCanBuy=function(t){var e=GlobalConfig.VipGiftConfig[t];if(e.cond)for(var i=0,s=e.cond;i<s.length;i++){var n=s[i];if(0==(1&this.vipGiftState[+n-1].state))return!1}return!0},e.prototype.getVipGiftIsBuy=function(t){return 1==(1&this.vipGiftState[t-1].state)},e.prototype.getVipGiftRedPoint=function(t){var e=GlobalConfig.VipGiftConfig[t];return this.lv>=e.vipLv?this.getVipGiftCanBuy(t)&&!this.getVipGiftIsBuy(t)&&e.needYb<=Actor.yb:!1},e.prototype.getVipIndex=function(t){for(var e in GlobalConfig.VipGiftConfig){var i=GlobalConfig.VipGiftConfig[e].hfTimes;if(i=i?i:0,i==t)return GlobalConfig.VipGiftConfig[e]}return null},e.prototype.checkVipSuccess=function(t){var e=!0;for(var i in GlobalConfig.VipGiftConfig){var s=GlobalConfig.VipGiftConfig[i].hfTimes;if(s=s?s:0,s==t){var n=GlobalConfig.VipGiftConfig[i].id;if(!this.getVipGiftIsBuy(n)){e=!1;break}}}return e},e.prototype.getVipPage=function(){var t=[];for(var e in GlobalConfig.VipGiftConfig){var i=GlobalConfig.VipGiftConfig[e].hfTimes;i=i?i:0,GameServer._hefuCount>=i&&-1==t.indexOf(i)&&t.push(i)}return t},e}(BaseSystem);__reflect(UserVip.prototype,"UserVip");var GameSystem;!function(t){t.userVip=UserVip.ins.bind(UserVip)}(GameSystem||(GameSystem={}));var SuperVipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="gsvipSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.pey,this.onTap),this.addTouchEvent(this.copy,this.onTap),this.observe(UserVip.ins().postSuperVipInfo,this.initView),UserVip.ins().sendGetSuperVipInfo(),this.initView()},e.prototype.initView=function(){if(UserVip.ins().getSuperVipState()?(this.qqtxt.text=UserVip.ins().superVipData?""+UserVip.ins().superVipData.data.qq:"",this.nopay0.visible=!1,this.nopay1.visible=!1,this.copy.visible=!0,this.pay0.visible=!0):(this.qqtxt.text="??????",this.nopay0.visible=!0,this.nopay1.visible=!0,this.copy.visible=!1,this.pay0.visible=!1),UserVip.ins().superVip)for(var t in GlobalConfig.SuperVipConfig){var e=+t-1,i=GlobalConfig.SuperVipConfig[t];this["cond"+e].text="("+(UserVip.ins().superVip[e]||0)+"/"+i.money+")"}},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.pey:var i=Recharge.ins().getRechargeData(0);i&&2==i.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win),ViewManager.ins().close(this);break;case this.copy:window.prompt&&(DeviceUtils.IsMobile?window.prompt("请长按链接复制QQ：",UserVip.ins().superVipData.data.qq+""):window.prompt("请复制QQ：",UserVip.ins().superVipData.data.qq+""))}},e}(BaseEuiView);__reflect(SuperVipWin.prototype,"SuperVipWin"),ViewManager.ins().reg(SuperVipWin,LayerManager.UI_Popup);var Vip3MWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="Vip3Skin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.pay,this.onTouchBtn),this.addTouchEvent(this.closeBtn,this.onTouchBtn),this.addTouchEvent(this.closeBtn0,this.onTouchBtn);var i=t[0];this.init(i)},e.prototype.init=function(t){for(var e=GlobalConfig.VipConfig[t],i=0;3>i;i++){this["gift"+i].data=e.awards[i+1].id;var s=this.getPower(e.awards[i+1].id,i);this["power"+i].setPower(s)}this.pay.label=UserVip.ins().lv<3?"充值":"领取",this.setIconEff()},e.prototype.setIconEff=function(){this.mc||(this.mc=new MovieClip),this.mc.parent||this.mcGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"mabi",-1);var t=0,e=GlobalConfig.ExRing0Config[1];t=UserBag.getAttrPower(e.attrAward),t+=e.power,this.powerPanel.setPower(t)},e.prototype.getPower=function(t,e){var i=0,s=GlobalConfig.EquipConfig[t];if(!s)return i;var n=["hp","atk","def","res"],o=[],a=0;t:for(var r in s)for(var h in n)if(n[h]==r&&s[r]){var l=s[r];if(void 0==l||0==l)continue;var c=Role.getAttrTypeByName(r),u=new AttributeData,p="";if(p+=AttributeData.getAttrStrByType(c)+":",p+=s[r],u.type=c,u.value=s[r],o.push(u),a?1==a&&(this["att"+e].text=p):this["at"+e].text=p,a++,a>1)break t}return i=Math.floor(UserBag.getAttrPower(o))},e.prototype.onTouchBtn=function(t){switch(t.target){case this.pay:this.onBtn();break;case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onBtn=function(){if(UserVip.ins().lv<3){var t=Recharge.ins().getRechargeData(0);return t&&2==t.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win),void ViewManager.ins().close(this)}ViewManager.ins().open(VipWin,3),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(Vip3MWin.prototype,"Vip3MWin"),ViewManager.ins().reg(Vip3MWin,LayerManager.UI_Popup);var VipGiftBtnRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipGiftBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.source=t.img,this.viptxt.text="v"+t.vipLv;var e=UserVip.ins().getVipGiftRedPoint(t.id);e?(this.mc||(this.mc=new MovieClip,this.mc.x=40,this.mc.y=42),this.mc.playFile(RES_DIR_EFF+"actIconCircle",-1),this.addChild(this.mc)):(DisplayUtils.removeFromParent(this.mc),this.mc=null),this.redPoint.visible=e},e}(BaseItemRender);__reflect(VipGiftBtnRender.prototype,"VipGiftBtnRender");var VipGiftItemView=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipGiftItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curId=t[0]||1,this.updateData(),this.close(),this.addTouchEvent(this.getBtn,this.onGet),this.observe(UserVip.ins().postVipGiftBuy,this.updateData)},e.prototype.close=function(){this.removeTouchEvent(this,this.onGet),this.removeObserve()},e.prototype.onGet=function(){var t=GlobalConfig.VipGiftConfig[this.curId];return UserVip.ins().lv<t.vipLv?void UserTips.ins().showTips("VIP等级不足"):Actor.yb<t.needYb?void UserTips.ins().showTips("元宝不足"):UserBag.ins().getSurplusCount()<=0?void UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请先清理背包|"):void UserVip.ins().sendGetVipGift(this.curId)},e.prototype.updateData=function(){var t=GlobalConfig.VipGiftConfig[this.curId],e=t.awards;this.reward.dataProvider=new eui.ArrayCollection(e.concat()),this.ggtxt.source=t.adImg,this.txt.source=t.nameImg,this.tu.source=t.bgImg,this.getBtn.visible=UserVip.ins().getVipGiftCanBuy(this.curId)&&!UserVip.ins().getVipGiftIsBuy(this.curId),this.getBtn.label=t.needYb+"元宝",this.redPoint.visible=UserVip.ins().getVipGiftRedPoint(this.curId),this.already.visible=UserVip.ins().getVipGiftIsBuy(this.curId)},e}(BaseView);__reflect(VipGiftItemView.prototype,"VipGiftItemView");var VipGiftPanel=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s.curIndex=e[0]?e[0]:0,s.skinName="VipGift"+s.curIndex+"Skin",s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curIndex=t[0]?t[0]:0,this.menuList.itemRenderer=VipGiftBtnRender,this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.menuList,this.onTouchMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(UserVip.ins().postVipGiftBuy,this.onUpdate),this.roleSelect.hideRole(),this.updateMenu(),this.setDefault()},e.prototype.onTouchMenu=function(t){SoundUtil.ins().playEffect(SoundUtil.WINDOW),this.setGiftId(t.item.id)},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.menuList.dataProvider.length<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1)},e.prototype.updateMenu=function(){var t=GlobalConfig.VipGiftConfig,e=[];for(var i in t){var s=t[i].hfTimes?t[i].hfTimes:0;this.curIndex==s&&e.push(t[i])}e.sort(function(t,e){return t.id<e.id?-1:1}),this.menuList.dataProvider=new eui.ArrayCollection(e),this.menuList.validateNow()},e.prototype.setDefault=function(){var t=this,e=0,i=Object.keys(GlobalConfig.VipGiftConfig).length;for(var s in GlobalConfig.VipGiftConfig){var n=GlobalConfig.VipGiftConfig[s].hfTimes;n=n?n:0,n==this.curIndex&&(e||(e=GlobalConfig.VipGiftConfig[s].id),i=+s)}for(var o=UserVip.ins().vipGiftState,a=i,r=e?e:1;i>=r;r++)if(0==(1&o[r-1].state)){a=r;break}this.setGiftId(a),e=e?e:1;var h=a-e;this.menuList.selectedIndex=h,TimerManager.ins().doNext(function(){var e=92*h;e>t.menuList.contentWidth-t.menuScroller.width&&(e=t.menuList.contentWidth-t.menuScroller.width),t.menuList.scrollH=e,t.onChange()},this)},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.onUpdate=function(){for(var t=this.menuList.dataProvider,e=0;e<t.length;e++)t.itemUpdated(t.getItemAt(e));this.setDefault()},e.prototype.setGiftId=function(t){this.vipGiftItem.open(t)},e.prototype.close=function(){this.vipGiftItem.close(),this.menuList.dataProvider=new eui.ArrayCollection,this.removeObserve(),this.removeTouchEvent(this.leftBtn,this.onTouchBtn),this.removeTouchEvent(this.rightBtn,this.onTouchBtn)},e}(BaseView);__reflect(VipGiftPanel.prototype,"VipGiftPanel");var VipGiftWin=function(t){function e(){var e=t.call(this)||this;return e.VipPanelList=[],e.skinName="VipGiftMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addTouchEvent(this.closeBtn,this.onTouch),this.observe(UserVip.ins().postVipGiftBuy,this.updateRedPoint),this.curIndex=t[0]?t[0]:0,this.checkIndex(),this.create(),this.updateView()},e.prototype.checkIndex=function(){var t=UserVip.ins().getVipPage();if(UserVip.ins().checkVipSuccess(t[this.curIndex]))for(var e=0;e<t.length;e++)if(this.curIndex!=e){var i=t[e];if(!UserVip.ins().checkVipSuccess(i)){this.curIndex=e;break}}},e.prototype.updateView=function(){this.VipPanelList[this.curIndex].open(this.curIndex),this.tab.selectedIndex=this.viewStack.selectedIndex=this.curIndex,this.updateRedPoint();for(var t=UserVip.ins().getVipPage(),e=0;e<t.length;e++){var i=t[e],s=UserVip.ins().checkVipSuccess(i);s&&(DisplayUtils.removeFromParent(this.VipPanelList[e]),DisplayUtils.removeFromParent(this["redPoint"+e]))}},e.prototype.updateRedPoint=function(){for(var t=UserVip.ins().getVipPage(),e=0;e<t.length;e++){var i=t[e];this["redPoint"+e].visible=!1;for(var s in GlobalConfig.VipGiftConfig){var n=GlobalConfig.VipGiftConfig[s].hfTimes?GlobalConfig.VipGiftConfig[s].hfTimes:0;if(i==n&&(this["redPoint"+e].visible=UserVip.ins().getVipGiftRedPoint(GlobalConfig.VipGiftConfig[s].id),this["redPoint"+e].visible))break}}},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){this.VipPanelList[t].open(this.hfcount[t])},e.prototype.checkIsOpen=function(t){return t>GameServer._hefuCount?(UserTips.ins().showTips("本服未到"+t+"次合服"),!1):!0},e.prototype.close=function(){for(var t=0;t<this.VipPanelList.length;t++)this.VipPanelList[t].close()},e.prototype.create=function(){this.viewStack.removeChildren(),this.redPointGroup.removeChildren(),this.hfcount=UserVip.ins().getVipPage();for(var t=0;t<this.hfcount.length;t++){var e=new VipGiftPanel(this.hfcount[t]);if(e){e.top=0,e.left=0,e.bottom=0,e.right=0;var i=UserVip.ins().getVipIndex(this.hfcount[t]);i&&(e.name=i.pageName?i.pageName:""),this.VipPanelList[t]=e,this.viewStack.addChild(this.VipPanelList[t]),this.redPointGroup.addChild(this["redPoint"+t]),this["redPoint"+t].visible=!1}}},e.prototype.getVipPanel=function(t){for(var e=0;e<this.VipPanelList.length;e++)if(this.VipPanelList[e].curIndex==t)return this.VipPanelList[e];return null},e}(BaseEuiView);__reflect(VipGiftWin.prototype,"VipGiftWin"),ViewManager.ins().reg(VipGiftWin,LayerManager.UI_Main);var Vip3Win=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="Vip3Skin",this.artifactEff=new MovieClip,this.artifactEff.x=233,this.artifactEff.y=335;var e=.178,i=.556*this.height;this.qualityEff1=new MovieClip,this.qualityEff1.x=this.width*e,this.qualityEff1.y=i,this.qualityEff2=new MovieClip,this.qualityEff2.x=.5*this.width,this.qualityEff2.y=i,this.qualityEff3=new MovieClip,this.qualityEff3.x=this.width*(1-e),this.qualityEff3.y=i,this.closeBtn1Eff=new MovieClip,this.closeBtn1Eff.x=this.closeBtn1.x+this.closeBtn1.width/2-2,this.closeBtn1Eff.y=this.closeBtn1.y+this.closeBtn1.height/2+2,this.closeBtn1Eff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.qualityEff1.playFile(RES_DIR_EFF+"quality_05",-1),this.addChild(this.qualityEff1),this.qualityEff2.playFile(RES_DIR_EFF+"quality_05",-1),this.addChild(this.qualityEff2),this.qualityEff3.playFile(RES_DIR_EFF+"quality_05",-1),this.addChild(this.qualityEff3),this.closeBtn1Eff.playFile(RES_DIR_EFF+"chongzhi",-1),this.addChild(this.closeBtn1Eff),UserVip.ins().lv<3?this.sureBtn.visible=!1:(this.sureBtn.visible=!0,this.closeBtn1.visible=!1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.closeBtn1:ViewManager.ins().open(ChargeFirstWin);break;case this.sureBtn:ViewManager.ins().open(VipWin),ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(Vip3Win.prototype,"Vip3Win"),ViewManager.ins().reg(Vip3Win,LayerManager.UI_Main);var VipWin=function(t){function e(){var e=t.call(this)||this;return e.barbc=new ProgressBarEff,e._curLv=0,e.skinName="VipSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.barbc.setWidth(320),this.barbc.x=88,this.barbc.y=10,this.topGroup.addChild(this.barbc),this.list.itemRenderer=ItemBase,this.list0.itemRenderer=ItemBase,this.vipValue=BitmapNumber.ins().createNumPic(0,"vip_v",5),this.vipValue.x=36,this.vipValue.y=39,this.vipGroup.addChild(this.vipValue)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.topUpBtn,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.suerBtn,this.onTap),this.addTouchEvent(this.suerBtn0,this.onTap),this.observe(UserVip.ins().postUpdataExp,this.changeExpBar),this.observe(UserVip.ins().postUpdateVipAwards,this.changeAwards),this.observe(UserVip.ins().postUpdateVipData,this.changeAwards),this.observe(UserVip.ins().postUpdateWeekAwards,this.changeAwards),this.barbc.reset(),this.changeExpBar(),this.changeAwards(),this._curLv=t[0]?t[0]:this.getVipLevel();var i=ViewManager.ins().getView(PlayFunView);if(i&&(i.vip.visible&&(this._curLv=3),i.preVip=i.vip.visible=!1),this._curLv){var s=GlobalConfig.VipConfig[this._curLv];this.showVipInfo(s)}},e.prototype.getVipLevel=function(){if(UserVip.ins().lv)for(var t=0;t<UserVip.ins().lv;t++)if(!(UserVip.ins().state>>t&1))return t+1;var e=Object.keys(GlobalConfig.VipConfig).length;return UserVip.ins().lv>=e-1?e:UserVip.ins().lv+1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.topUpBtn,this.onTap),this.removeTouchEvent(this.leftBtn,this.onTap),this.removeTouchEvent(this.rightBtn,this.onTap),this.removeTouchEvent(this.suerBtn,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){var i;switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.topUpBtn:ViewManager.ins().close(e);var s=Recharge.ins().getRechargeData(0);s&&2==s.num?ViewManager.ins().open(ChargeFirstWin):ViewManager.ins().open(Recharge1Win);break;case this.leftBtn:i=GlobalConfig.VipConfig[--this._curLv],this.showVipInfo(i);break;case this.rightBtn:i=GlobalConfig.VipConfig[++this._curLv],this.showVipInfo(i);break;case this.suerBtn:i=GlobalConfig.VipConfig[this._curLv];for(var n=0,o=i.awards,a=o.length,r=0;a>r;r++)1==o[r].type&&o[r].id<2e5&&n++;UserBag.ins().getSurplusCount()>=n?UserVip.ins().sendGetAwards(this._curLv):UserTips.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");break;case this.suerBtn0:UserVip.ins().sendGetWeekAwards()}},e.prototype.showVipInfo=function(t){t?this.setAwards(t):this._curLv=UserVip.ins().lv,this.changeBtn()},e.prototype.changeExpBar=function(){var t=UserVip.ins(),e=GlobalConfig.VipConfig[t.lv],i=0,s=t.exp;e&&(i=t.lv);var n=GlobalConfig.VipConfig[i+1],o=0,a="";if(n){o=n.needYb-s;a="再充值|C:0xFFAA24&T:"+o+"元宝|成为VIP"+(t.lv+1),this.barbc.setData(s,n.needYb)}else a="VIP等级已满",this.barbc.setData(s,e.needYb),this.barbc.setLbValueText(s+"/"+e.needYb);this.titleLabel.textFlow=TextFlowMaker.generateTextFlow(a),e=GlobalConfig.VipConfig[this._curLv],this.showVipInfo(e)},e.prototype.changeAwards=function(){var t;if(this._curLv=UserVip.ins().lv,this._curLv>=0){for(var e=0;e<this._curLv;e++)if(!this.getRemindByIndex(e)||this.checkWeekReward(e))return t=GlobalConfig.VipConfig[e+1],this._curLv=e+1,this.setAwards(t?t:t=GlobalConfig.VipConfig[--this._curLv]),void this.changeBtn();t=GlobalConfig.VipConfig[++this._curLv],this.setAwards(t?t:t=GlobalConfig.VipConfig[--this._curLv]),this.changeBtn()}},e.prototype.setAwards=function(t){this.depictLabel.textFlow=TextFlowMaker.generateTextFlow(t.description),this.list.dataProvider=new eui.ArrayCollection(t.awards),this.list0.dataProvider=new eui.ArrayCollection(t.weekReward),this.vipImg.source=t.vipImg;var e=UserVip.ins().exp,i=t.needYb-e,s="";s=i>0?"再充值|C:0xFFAA24&T:"+i+"元宝|成为VIP"+t.id:"",this.more.textFlow=TextFlowMaker.generateTextFlow1(s);var n="充值|C:0xFFAA24&T:"+t.needYb+"元宝|成为VIP"+t.id;this.show.textFlow=TextFlowMaker.generateTextFlow1(n),BitmapNumber.ins().changeNum(this.vipValue,UserVip.ins().lv,"vip_v",3),UserVip.ins().lv<10?(this.vipValue.x=36,this.vipValue.y=39):(this.vipValue.x=26,this.vipValue.y=39),this.titleText.text="VIP"+this._curLv+"特权",this.suerBtn.visible=!1,this.suerBtn.enabled=!1,this.mc&&DisplayUtils.removeFromParent(this.mc),this.mc1&&DisplayUtils.removeFromParent(this.mc1),this.getRemindByIndex(t.id-1)?(this.suerBtn.visible=!0,this.suerBtn.label="已领取"):UserVip.ins().lv>=t.id&&(this.suerBtn.visible=!0,this.suerBtn.enabled=!0,this.suerBtn.label="领取",this.mc=this.mc||new MovieClip,this.mc.x=49,this.mc.y=22,this.mc.scaleX=.6,this.mc.scaleY=.85,this.mc.playFile(RES_DIR_EFF+"chargeff1",-1),this.suerBtn.addChild(this.mc)),UserVip.ins().lv==t.id?(this.suerBtn0.visible=!0,0==UserVip.ins().weekState?(this.suerBtn0.enabled=!1,this.suerBtn0.label="已领取"):(this.suerBtn0.enabled=!0,this.suerBtn0.label="领取",this.mc1=this.mc1||new MovieClip,this.mc1.x=49,this.mc1.y=22,this.mc1.scaleX=.6,this.mc1.scaleY=.85,this.mc1.playFile(RES_DIR_EFF+"chargeff1",-1),this.suerBtn0.addChild(this.mc1))):(this.suerBtn0.visible=!1,this.suerBtn0.label="领取")},e.prototype.getRemindByIndex=function(t){var e=UserVip.ins(),i=e.state;return e.lv<=0?!1:1==(i>>t&1)},e.prototype.checkWeekReward=function(t){return UserVip.ins().lv<=0?!1:t+1==UserVip.ins().lv&&1==UserVip.ins().weekState},e.prototype.changeBtn=function(){this._curLv>1?(this.leftBtn.visible=!0,this.rightBtn.visible=!0,this._curLv>=CommonUtils.getObjectLength(GlobalConfig.VipConfig)&&(this.rightBtn.visible=!1)):this._curLv<=1&&(this.leftBtn.visible=!1,this.rightBtn.visible=!0)},e}(BaseEuiView);__reflect(VipWin.prototype,"VipWin"),ViewManager.ins().reg(VipWin,LayerManager.UI_Popup);var UserWarn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.setWarnLabel=function(t,e,i,s,n){void 0===s&&(s="normal"),void 0===n&&(n="left");var o=ViewManager.ins().open(WarnWin);return o.setWarnLabel(t,e,i,s,n),o},e.prototype.setBuyGoodsWarn=function(t,e){void 0===e&&(e=1);var i=ViewManager.ins().open(ShopGoodsWarn);return i.setData(t,e),i},e}(BaseSystem);__reflect(UserWarn.prototype,"UserWarn");var GameSystem;!function(t){t.userWarn=UserWarn.ins.bind(UserWarn)}(GameSystem||(GameSystem={}));var BagAddItemWarn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="OpenCellSkin",this.price.setType(MoneyConst.yuanbao)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.decBtn,this.onTap),this.addTouchEvent(this.addBtn,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.cancelBtn,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.setCount(5)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.decBtn,this.onTap),this.removeTouchEvent(this.addBtn,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap),this.removeTouchEvent(this.cancelBtn,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.decBtn:this.setCount(Number(this.count.text)-5);break;case this.addBtn:this.setCount(Number(this.count.text)+5);break;case this.sureBtn:if(!(Actor.yb>=this.price.getPrice())){UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),ViewManager.ins().close(this);break}UserBag.ins().sendAddBagGrid(Number(this.count.text)/5);case this.cancelBtn:case this.closeBtn:ViewManager.ins().close(e);break;case this.bgClose:ViewManager.ins().close(e)}},e.prototype.setCount=function(t){var e=GlobalConfig.BagBaseConfig,i=GlobalConfig.BagExpandConfig,s=CommonUtils.getObjectLength(i),n=(UserBag.ins().bagNum-e.baseSize)/e.rowSize,o=(s-n)*e.rowSize;5>t?(t=5,UserTips.ins().showTips("|C:0xf3311e&T:已经是最小扩张数|")):t>o&&(t=o,UserTips.ins().showTips("|C:0xf3311e&T:已经是最大扩张数|")),this.count.text=""+t;for(var a=0,r=t/e.rowSize,h=1;r>=h;h++)a+=i[n+h].cost;this.price.setPrice(a)},e}(BaseEuiView);__reflect(BagAddItemWarn.prototype,"BagAddItemWarn"),ViewManager.ins().reg(BagAddItemWarn,LayerManager.UI_Popup);var BagFullTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FullBagSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap);var i=20;t[0]&&(i=t[0]),this.numText.text=""+i},e.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sureBtn:ViewManager.ins().close(this),ViewManager.ins().open(SmeltEquipTotalWin)}},e}(BaseEuiView);__reflect(BagFullTipsWin.prototype,"BagFullTipsWin"),ViewManager.ins().reg(BagFullTipsWin,LayerManager.UI_Popup);var GainGoodsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GainGoodsItemSkin",e.graycolor=7239022,e}return __extends(e,t),e.prototype.dataChanged=function(){this.greencolor=this.desc.textColor,this.norcolor=this.desc2.textColor,this.desc.text=this.data[0]},e.prototype.gainData=function(t,e,i){if(this.stars.visible=!0,t)for(var s=1;5>=s;s++)this["star"+s].visible=e>=s;else{if(this.desc.textColor=this.graycolor,this.desc2.textColor=this.graycolor,i){var n="";i.needZs&&(n+=i.needZs+"转生开启"),i.needLv&&(n+=i.needLv+"级开启"),i.guanka&&(n+=i.guanka+"关卡开启"),this.desc2.text=n
}this.dir.visible=!1;for(var s=1;5>=s;s++)this["star"+s].visible=!1}},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(GainGoodsItem.prototype,"GainGoodsItem");var GainGoodsItem1=function(t){function e(){var e=t.call(this)||this;return e.skinName="GainGoodsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.desc.text=t.str},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(GainGoodsItem1.prototype,"GainGoodsItem1");var GainGoodsNoSkinItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.desc.text=this.data[0]},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(GainGoodsNoSkinItem.prototype,"GainGoodsNoSkinItem");var ShopGoodsWarn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GainGoodsSkin",this.gainList.itemRenderer=GainGoodsItem,this.countTxt.restrict="0-9",this.price.setType(MoneyConst.yuanbao),this.totalPrice.setType(MoneyConst.yuanbao),this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.decBtn,this.onTap),this.addTouchEvent(this.addBtn,this.onTap),this.addTouchEvent(this.dec10Btn,this.onTap),this.addTouchEvent(this.add10Btn,this.onTap),this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this.topUpBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.addChangeEvent(this.countTxt,this.onTxtChange),this.observe(Shop.ins().postBuyResult,this.buyCallBack)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.removeTouchEvent(this.decBtn,this.onTap),this.removeTouchEvent(this.addBtn,this.onTap),this.removeTouchEvent(this.dec10Btn,this.onTap),this.removeTouchEvent(this.add10Btn,this.onTap),this.removeTouchEvent(this.buyBtn,this.onTap),this.removeTouchEvent(this.topUpBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.countTxt.removeEventListener(egret.TouchEvent.CHANGE,this.onTxtChange,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.decBtn:this.setTotalPrice(this._totalNum-1);break;case this.addBtn:this.setTotalPrice(this._totalNum+1);break;case this.dec10Btn:this.setTotalPrice(this._totalNum-10);break;case this.add10Btn:this.setTotalPrice(this._totalNum+10);break;case this.buyBtn:Actor.yb>=this.totalPrice.getPrice()?Shop.ins().sendBuy(1,[[this._goodsId,this._totalNum]]):(UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),ViewManager.ins().close(this));break;case this.topUpBtn:var i=Recharge.ins().getRechargeData(0);i&&2==i.num?ViewManager.ins().open(ChargeFirstWin):(ViewManager.ins().close(e),ViewManager.ins().open(Recharge1Win));break;case this.bgClose:ViewManager.ins().close(e)}},e.prototype.onTouchList=function(t){var i=t.item;if(null!=t.item){var s=ViewManager.ins().viewOpenCheck(i[1],i[2]);if(s){var n=!0;if("Recharge2Win"==i[1]){var o=Recharge.ins().getRechargeData(0);o&&o.num||(n=!1,ViewManager.ins().open(Recharge1Win))}n&&""!=i[1]&&GameGuider.guidance(i[1],i[2],i[3]),ViewManager.ins().close(e),ViewManager.ins().close(BookUpWin),ViewManager.ins().close(WeaponPanel),ViewManager.ins().close(WeaponSoulBreakWin),"HeirloomCom"!=i[1]&&ViewManager.ins().close(HeirloomCom),"LadderWin"==i[1]&&ViewManager.ins().close(ForgeWin),"PlayFunView"==i[1]&&ViewManager.ins().close(ShopWin)}}},e.prototype.buyCallBack=function(t){t>0?ViewManager.ins().close(e):(UserTips.ins().showTips("|C:0xf3311e&T:元宝不足|"),ViewManager.ins().close(this))},e.prototype.onTxtChange=function(t){var e=Number(this.countTxt.text);this.setTotalPrice(e)},e.prototype.setData=function(t,e){var i;if(t>2e4){var s=GlobalConfig.ItemConfig[t];this.itemIcon.setData(s),this.nameTxt.text=""+s.name,this.nameTxt.textColor=ItemConfig.getQualityColor(s),i=ItemStoreConfig.getStoreByItemID(t),this.titleTxt.text="材料不足，通过以下方式获得"}else{switch(this.itemIcon.setData(null),t){case MoneyConst.gold:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="货币不足，通过以下方式获得";break;case MoneyConst.soul:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="精华不足，通过以下方式获得";break;case 7:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="功勋不足，通过以下方式获得";break;case 8:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="成就积分不足，通过以下方式获得";break;case MoneyConst.weiWang:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="威望不足，通过以下方式获得"}this.nameTxt.textColor=16758826}var n=GlobalConfig.GainItemConfig[t],o=0;n?(this.gainList.dataProvider=new eui.ArrayCollection(n.gainWay),o=60*n.gainWay.length):this.gainList.dataProvider=new eui.ArrayCollection([]),i?(this.goodsGroup.visible=!0,this.nameTxt.x=225,this.nameTxt.y=170,this.nameTxt.textAlign="center",this.itemIcon.x=145,this.frame.height=410+o,this.gainListGroup.y=352,this._goodsId=i.id,this.price.setPrice(i.price),this.setTotalPrice(e)):(this.goodsGroup.visible=!1,this.nameTxt.x=182,this.nameTxt.y=200,this.nameTxt.textAlign="center",this.itemIcon.x=172,this.frame.height=340+o,this.gainListGroup.y=280),this.tipGroup.y=this.gainListGroup.height+this.gainListGroup.y+3},e.prototype.setTotalPrice=function(t){0>=t?this._totalNum=1:t>=1e4?this._totalNum=9999:this._totalNum=t,this.countTxt.text=this._totalNum+"",this.totalPrice.setPrice(this._totalNum*this.price.getPrice())},e}(BaseEuiView);__reflect(ShopGoodsWarn.prototype,"ShopGoodsWarn"),ViewManager.ins().reg(ShopGoodsWarn,LayerManager.UI_Popup);var WarnWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.show=function(t,e,i,s,n,o,a){void 0===s&&(s=null),void 0===n&&(n=null),void 0===o&&(o="normal"),void 0===a&&(a="center");var r=UserWarn.ins().setWarnLabel(t,{func:e,thisObj:i},{func2:s,thisObj2:n},o,a);return r},e.prototype.showUI=function(t,e,i,s){this.leftGroup.visible=!1,this.icon1.visible=!1,this.label1.visible=!1,this.rightGroup.visible=!1,this.icon2.visible=!1,this.label2.visible=!1,(t||e)&&(this.leftGroup.visible=!0,t&&(this.icon1.visible=!0,this.icon1.source=t),e&&(this.label1.visible=!0,this.label1.text=e)),(i||s)&&(this.rightGroup.visible=!0,i&&(this.icon2.visible=!0,this.icon2.source=i),s&&(this.label2.visible=!0,this.label2.text=s))},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="warnFrameSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.notBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.cbx,this.onTap),this.cbx.selected=SysSetting.ins().getBool(SysSetting.DICE)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sureBtn,this.onTap),this.removeTouchEvent(this.notBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.cbx,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sureBtn:null!=this.callBack.func&&this.callBack.func.call(this.callBack.thisObj);break;case this.notBtn:case this.bgClose:this.calback2.func2&&this.calback2.func2.call(this.calback2.thisObj2);break;case this.cbx:SysSetting.ins().setBool(SysSetting.DICE,t.currentTarget.selected)}t.currentTarget!=this.cbx&&ViewManager.ins().close(e)},Object.defineProperty(e.prototype,"isShowWin",{get:function(){return this._isShowWin},set:function(t){this._isShowWin!=t&&(this._isShowWin=t)},enumerable:!0,configurable:!0}),e.prototype.setWarnLabel=function(t,e,i,s,n){void 0===i&&(i=null),void 0===s&&(s="normal"),void 0===n&&(n="left"),this.warnLabel.textFlow=TextFlowMaker.generateTextFlow(t),this.callBack=e,this.calback2=i,this.currentState=s,this.warnLabel.textAlign=n},e.prototype.setBtnLabel=function(t,e){t&&(this.sureBtn.label=t),e&&(this.notBtn.label=e)},e}(BaseEuiView);__reflect(WarnWin.prototype,"WarnWin"),ViewManager.ins().reg(WarnWin,LayerManager.UI_Popup);var WelcomeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="welcomePanelSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this);var e=LocationProperty.appid;""!=e&&GlobalConfig.TerraceDescConfig[e]?this.slogon.text=GlobalConfig.TerraceDescConfig[e].desc:this.slogon.text=""},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.validateNow()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.playEff()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),egret.Tween.removeTweens(this.pic)},e.prototype.onTap=function(t){this.sureBtn.visible=!1;var i=egret.Tween.get(this.pic),s=ViewManager.ins().getView(PlayFunView);if(s&&s.location){var n=s.location;if(n){var o=n.localToGlobal();this.sureGroup.globalToLocal(o.x,o.y,o),i.to({scaleX:0,scaleY:0,x:o.x,y:o.y},500).call(function(){ViewManager.ins().close(e)})}this.eff&&(DisplayUtils.removeFromParent(this.eff),this.eff=null),Hint.ins().postWelcome()}},e.prototype.playEff=function(){this.eff||(this.eff=new MovieClip,this.eff.x=this.sureGroup.width/2,this.eff.y=this.sureGroup.height/2-5,this.eff.scaleX=this.effgroup.scaleX,this.eff.scaleY=this.effgroup.scaleY,this.sureGroup.addChild(this.eff)),this.eff.playFile(RES_DIR_EFF+"achieveCom",-1)},e}(BaseEuiView);__reflect(WelcomeWin.prototype,"WelcomeWin"),ViewManager.ins().reg(WelcomeWin,LayerManager.UI_Popup);var WeaponsData=function(){function t(){var t=Object.keys(GlobalConfig.WeaponSoulConfig);this.WeaponsSoulInfoData={};for(var e=0;e<t.length;e++){var i=t[e],s=new WeaponsSoulInfo;this.WeaponsSoulInfoData[i]=s}t=Object.keys(GlobalConfig.WeaponSoulPosConfig),this.WeaponsInfoData={};for(var e=0;e<t.length;e++){var i=t[e];this.WeaponsInfoData[i]||(this.WeaponsInfoData[i]={})}this.WeaponsFlexibleInfoData=[],this.weaponsId=0,this.flexibleCount=0}return t.prototype.getSuitConfig=function(t){for(var e=this.getInfoData(),i=0,s=!1,n=GlobalConfig.WeaponSoulConfig[t],o=0;o<n.actcond.length;o++){var a=n.actcond[o];if(s=!0,Object.keys(e[a]).length)for(var r in e[a]){var h=e[a][r];if(0==o&&(i=h.level),!h.level){s=!1;break}h.level<=i&&(i=h.level)}else s=!1;if(!s)break}var l;if(s){var c="";for(var u in GlobalConfig.WeaponSoulSuit[t]){if(!(i>=Number(u)))break;c=u}c&&(l=GlobalConfig.WeaponSoulSuit[t][c])}return l},t.prototype.getNextSuitConfig=function(t){var e,i=this.getSuitConfig(t);i||(i=GlobalConfig.WeaponSoulSuit[t][0]);for(var s in GlobalConfig.WeaponSoulSuit[t])if(GlobalConfig.WeaponSoulSuit[t][s].level>i.level){e=GlobalConfig.WeaponSoulSuit[t][s];break}return e},t.prototype.parser=function(t){this.parserInfo(t),this.parserSoulInfo(t),this.parserWeaponFlexibleInfo(t)},t.prototype.parserInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readShort(),n=t.readInt();this.WeaponsInfoData[s]={};var o=new WeaponsInfo;o.setInfo(s,n),this.WeaponsInfoData[s][n]=o}},t.prototype.parserSoulInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readShort();this.WeaponsSoulInfoData[s].setSoulInfo(s)}},t.prototype.parserWeaponFlexibleInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readShort();this.WeaponsFlexibleInfoData.push(s)}this.flexibleCount=t.readShort(),this.flexibleCount&&this.flexibleCount++},t.prototype.parserInfoOnly=function(t){var e=t.readShort(),i=t.readInt();this.WeaponsInfoData[e]={};var s=new WeaponsInfo;s.setInfo(e,i),this.WeaponsInfoData[e][i]=s},t.prototype.parserSoulInfoOnly=function(t,e){var i=t.readShort();if(i>0){this.WeaponsSoulInfoData[i].setSoulInfo(i);var s=SubRoles.ins().getSubRoleByIndex(e);if(s){var n=this.WeaponsSoulInfoData[i].inside[s.job-1];n&&(ViewManager.ins().close(WeaponPanel),Activationtongyong.show(0,this.WeaponsSoulInfoData[i].name,"weapsdao_png",!0,function(){var t=ViewManager.ins().getView(ForgeWin);t&&t.weaponsoul&&ViewManager.ins().open(WeaponPanel,t.weaponsoul.roleId,t.weaponsoul.weaponId)},n))}}},t.prototype.getRedPointBySuit=function(t){var e=GlobalConfig.WeaponSoulConfig[t];if(!e)return!1;if(!this.WeaponsSoulInfoData[t].id&&this.IsActivityWeapon(t))return!0;for(var i in e.actcond){var s=e.actcond[i],n=this.getInfoLevel(s),o=GlobalConfig.WeaponSoulPosConfig[s][n],a=o.costNum,r=GlobalConfig.WeaponSoulPosConfig[s][n+1];if(a&&r){var h=UserBag.ins().getBagItemById(o.costItem),l=h?h.count:0;if(l>=a)return!0}}return this.IsHaveAndNotWear(t)},t.prototype.IsHaveAndNotWear=function(t){if(!this.weaponsId)for(var e in this.WeaponsSoulInfoData){var i=this.WeaponsSoulInfoData[e];if(t){if(t==i.id)return!0}else if(i.id)return!0}return!1},t.prototype.getInfoLevel=function(t){var e=0;if(!this.WeaponsInfoData[t])return 0;for(var i in this.WeaponsInfoData[t]){e=this.WeaponsInfoData[t][i].level;break}return e},t.prototype.getSlotByInfo=function(t){var e;if(!this.WeaponsInfoData[t])return e;for(var i in this.WeaponsInfoData[t]){e=this.WeaponsInfoData[t][i];break}return e},t.prototype.getWeapsInfoBySoulId=function(t){var e=this.WeaponsSoulInfoData[t];return e},t.prototype.IsActivityWeapon=function(t){var e=GlobalConfig.WeaponSoulConfig[t];if(e){for(var i=0;i<e.actcond.length;i++){var s=e.actcond[i];if(!CommonUtils.getObjectLength(this.WeaponsInfoData[s]))return!1}return!0}return!1},t.prototype.getInfoData=function(){return this.WeaponsInfoData},t.prototype.getSoulInfoData=function(){return this.WeaponsSoulInfoData},t.prototype.getFlexibleData=function(){return this.WeaponsFlexibleInfoData},t}();__reflect(WeaponsData.prototype,"WeaponsData");var WeaponsInfo=function(){function t(){this.id=0,this.level=0,this.costItem=0,this.costNum=0,this.showlv=0,this.assault=0,this.icon="",this.name="",this.attr=[],this.ex_attr=[]}return t.prototype.setInfo=function(t,e){if(t>0&&e>0){var i=GlobalConfig.WeaponSoulPosConfig[t][e];if(!i)return;this.id=i.id,this.level=i.level,this.costItem=i.costItem,this.costNum=i.costNum,this.showlv=i.showlv,this.assault=i.assault,this.icon=i.icon,this.name=i.name,this.attr=i.attr,this.ex_attr=i.ex_attr}},t}();__reflect(WeaponsInfo.prototype,"WeaponsInfo");var WeaponsSoulInfo=function(){function t(){this.icon="",this.id=0,this.name="",this.actcond=[],this.inside=[],this.outside=[],this.pic=[],this.icon=""}return t.prototype.setSoulInfo=function(t){if(t>0){var e=GlobalConfig.WeaponSoulConfig[t];if(!e)return;this.id=e.id,this.name=e.name,this.actcond=e.actcond,this.inside=e.inside,this.outside=e.outside,this.pic=e.pic,this.icon=e.icon}},t}();__reflect(WeaponsSoulInfo.prototype,"WeaponsSoulInfo");var WeaponsSuitInfo=function(){function t(){this.id=0,this.level=0,this.attr={},this.ex_attr={}}return t.prototype.setInfo=function(t){},t}();__reflect(WeaponsSuitInfo.prototype,"WeaponsSuitInfo");var MovieClipEvent=egret.MovieClipEvent,WeaponListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="soulItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data&&this.data.showId){var t=this.data.id,e=this.data.isuse,i=this.data.isRedPoint,s=this.data.level,n=(this.data.isSelect,GlobalConfig.WeaponSoulConfig[t]),o=this.data.showId,a=this.data.job;if(!n){n=GlobalConfig.WeaponSoulConfig[o],this.setEff(n,a);var r=GlobalConfig.WeaponSoulSuit[n.id],h=void 0;for(var l in r){h=r[l];break}return this.timelabel.text=n.name,this.huanhuaImage.visible=!1,this.redPoint0.visible=i,this.levellabel.text=h.level+"阶",void this.setGray(this.mc)}this.setEff(n,a),this.timelabel.text=n.name,this.huanhuaImage.visible=e,this.redPoint0.visible=i,this.levellabel.text=s+"阶"}},e.prototype.setEff=function(t,e){if(t){this.mc||(this.mc=new MovieClip),this.mc.parent||(this.effpos.parent.addChild(this.mc),this.mc.x=this.effpos.x,this.mc.y=this.effpos.y,this.mc.rotation=this.effpos.rotation);var i=t.inside[e-1];this.mc.playFile(RES_DIR_EFF+i,-1),this.touchEnabled=!1,this.mc.touchEnabled=!1,this.effpos.parent.touchEnabled=!1,this.cleanFilters(this.mc)}},e.prototype.setGray=function(t){if(this.mc&&this.cleanFilters(this.mc),t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)]}},e.prototype.cleanFilters=function(t){t&&(t.filters=[])},e.prototype.clear=function(){this.cleanFilters(this.mc)},e.prototype.destruct=function(){this.clear()},e}(BaseItemRender);__reflect(WeaponListItem.prototype,"WeaponListItem");var JieSuo="解 锁",WeaponPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulSkin2",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.skillicon,this.onEvent),this.addTouchEvent(this.upGradeBtn0,this.onEvent),this.addTouchEvent(this.turnTxt,this.onEvent),this.addTouchEvent(this.closeBtn,this.onEvent),this.observe(Weapons.ins().postWeaponsAct,this.callback),this.observe(Weapons.ins().postWeaponsUse,this.callback),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.weaponShowPanel.open(),this.roleId=t[0],this.weaponId=t[1],this.init(this.weaponId)},e.prototype.init=function(t){this.updateUI(t)},e.prototype.updateUI=function(t){var e=GlobalConfig.WeaponSoulConfig[t];if(!e)for(var i in GlobalConfig.WeaponSoulConfig){e=GlobalConfig.WeaponSoulConfig[i];break}var s=SubRoles.ins().getSubRoleByIndex(this.roleId);this.ringname.text=e.name;var n=s.weapons.getSoulInfoData()[t],o=s.weapons.getSuitConfig(t),a="|C:0x00ff00&T:(已激活)",r="|C:0xffd93f&T:";if(!n||!n.id){r="";for(var i in GlobalConfig.WeaponSoulSuit[t]){o=GlobalConfig.WeaponSoulSuit[t][i];break}}-1==s.weapons.getFlexibleData().indexOf(t)&&(a=""),this.levellabel.text=o.level+"阶",this.skillicon.data={icon:o.skillicon},this.skillname.text=o.skillname,this.powerPanel.setPower(s.getWeaponTotalPower(t));for(var h=[4,2,6,5],l=[0,0,0,0],c=0;c<e.actcond.length;c++){var u=e.actcond[c],p=s.weapons.getSlotByInfo(u);if(p)for(var d=0;d<p.attr.length;d++){var g=p.attr[d];if(-1!=h.indexOf(g.type))for(var f=0;f<h.length;f++)h[f]==g.type&&(l[f]+=g.value)}}for(var c=0;4>c;c++)if(this["attr"+c]){var v=AttributeData.getAttrStrByType(h[c]);this["attr"+c].text=v+"+"+l[c]}this.skill.textFlow=TextFlowMaker.generateTextFlow1(""+r+o.skilldesc+a);var y=s.weapons.getWeapsInfoBySoulId(t);this.turnTxt.parent&&(this.turnTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:兵魂之灵")),this.descGroup.visible=!0,s.weapons.flexibleCount?(this.desc.text="使用后只会改变外观,变更技能效果请前往",this.turnTxt.parent||this.desc.parent.addChild(this.turnTxt)):(this.desc.text="使用后将激活兵魂的技能效果以及外观显示",DisplayUtils.removeFromParent(this.turnTxt)),y&&y.id?s.weapons.weaponsId==y.id?(this.upGradeBtn0.label="取 消",this.huanhuaImage.visible=!0,this.redPoint.visible=!1):s.weapons.weaponsId?(this.upGradeBtn0.label="替 换",this.huanhuaImage.visible=!1,this.redPoint.visible=!1):(this.upGradeBtn0.label="使 用",this.huanhuaImage.visible=!1,this.redPoint.visible=!0):(this.upGradeBtn0.label=JieSuo,this.huanhuaImage.visible=!1,this.redPoint.visible=s.weapons.IsActivityWeapon(t),this.descGroup.visible=!1),this.weaponShowPanel.init(t,this.roleId)},e.prototype.onEvent=function(t){switch(t.currentTarget){case this.skillicon:ViewManager.ins().open(WeaponSoulSkillTips,this.roleId,this.weaponId);break;case this.upGradeBtn0:var e=SubRoles.ins().getSubRoleByIndex(this.roleId);if(this.upGradeBtn0.label==JieSuo){var i=e.weapons.getSuitConfig(this.weaponId);if(!i)return void UserTips.ins().showTips("还有部位未激活");Weapons.ins().sendWeaponsAct(this.roleId,this.weaponId)}else"使 用"==this.upGradeBtn0.label?Weapons.ins().sendWeaponsUse(this.roleId,this.weaponId):"取 消"==this.upGradeBtn0.label?Weapons.ins().sendWeaponsUse(this.roleId,0):"替 换"==this.upGradeBtn0.label&&Weapons.ins().sendWeaponsUse(this.roleId,this.weaponId);break;case this.closeBtn:ViewManager.ins().close(this);break;case this.turnTxt:var s=ViewManager.ins().getView(ForgeWin);s&&s.weaponsoul.open(this.roleId,!1),ViewManager.ins().close(this)}},e.prototype.callback=function(){this.updateUI(this.weaponId)},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e}(BaseEuiView);__reflect(WeaponPanel.prototype,"WeaponPanel"),ViewManager.ins().reg(WeaponPanel,LayerManager.UI_Popup);var WeaponShowPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulSkinState",e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.roleId=0,this.weaponId=0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.releaseEvent(),this.removeObserve()},e.prototype.releaseEvent=function(){if(this.currentState){DisplayUtils.removeFromParent(this.mc),this.mc=null,DisplayUtils.removeFromParent(this.masksp),this.masksp=null;for(var t=0;t<Number(this.currentState);t++)this.removeTouchEvent(this["item"+t],this.onClick)}},e.prototype.init=function(t,e){var i=t?t:this.weaponId,s=isNaN(e)?this.roleId:e;this.weaponId=i,this.roleId=s;var n=GlobalConfig.WeaponSoulConfig[i];if(n){var o=n.actcond.length;this.releaseEvent();var a=SubRoles.ins().getSubRoleByIndex(s);this.currentState=o+"";for(var r=a.weapons.getWeapsInfoBySoulId(n.id),h=0,l=0;l<n.actcond.length;l++)if(this.addTouchEvent(this["item"+l],this.onClick),r.id)h++,this["lianjiexian"+l]&&this.setLight(this["lianjiexian"+l]),this["item"+l]&&(this["item"+l].data=a.weapons.getSlotByInfo(n.actcond[l]));else{var c=a.weapons.getSlotByInfo(n.actcond[l]);c?(h++,this["lianjiexian"+l]&&this.setLight(this["lianjiexian"+l]),this["item"+l]&&(this["item"+l].data=a.weapons.getSlotByInfo(n.actcond[l]))):(this["lianjiexian"+l]&&this.setGray(this["lianjiexian"+l]),this["item"+l]&&(this["item"+l].data=GlobalConfig.WeaponSoulPosConfig[n.actcond[l]][0]))}this.setEff(h,n.actcond.length,n,a)}},e.prototype.setEff=function(t,e,i,s){if(i){var n=i.inside[s.job-1];this.mc||(this.mc=new MovieClip),this.mc.parent||this.effgroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+n,-1),this.mc.x=this.effpos.x,this.mc.y=this.effpos.y,this.mc.rotation=this.effpos.rotation}},e.prototype.setWeaponsModel=function(){this.weaponImg.source="";var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.getEquipByIndex(0),i=e.item.configID;if(i>0){var s=GlobalConfig.EquipConfig[i].appearance;s&&s.indexOf("[job]")>-1&&(s=s.replace("[job]",t.job+"")),this.weaponImg.source=s+"_"+t.sex+"_c_png"}},e.prototype.onClick=function(t){for(var e=0;e<Number(this.currentState);e++)if(t.currentTarget==this["item"+e]){var i=this["item"+e].slot,s=SubRoles.ins().getSubRoleByIndex(this.roleId),n=s.weapons.getSlotByInfo(i);n&&n.level?n.assault?ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.TUPO,s.index,i):ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.SHENGJI,s.index,i):ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.JIHUO,s.index,i);break}},e.prototype.getJobSkinName=function(t){switch(t){case 1:return"zhan";case 2:return"fa";case 3:return"dao"}return""},e.prototype.callback=function(){this.init()},e.prototype.setGray=function(t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)]},e.prototype.setLight=function(t){t.filters=[]},e.prototype.cleanFilters=function(t,e){this["zhan"+t+e].filters=[],this["fa"+t+e].filters=[],this["dao"+t+e].filters=[]},e.prototype.destructor=function(){},e}(BaseView);__reflect(WeaponShowPanel.prototype,"WeaponShowPanel");var WeaponSkillItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSkillItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&(this.skillIcon.source=this.data.icon+"_png")},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);__reflect(WeaponSkillItem.prototype,"WeaponSkillItem");var WeaponSoulbreakItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulbreakitem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t,e=this.data.sum,i=this.data.costNum,s=this.data.costItem;t=e>=i?ColorUtil.GREEN:ColorUtil.RED,this.lv.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+e+"/"+i),this.itemIcon.imgJob.visible=!1;var n=GlobalConfig.ItemConfig[s];this.nameTxt.text=n.name,this.itemIcon.imgIcon.source=n.icon+"_png"}},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);__reflect(WeaponSoulbreakItem.prototype,"WeaponSoulbreakItem");var WeaponSoulBreakWin=function(t){function e(){var e=t.call(this)||this;return e.calldesc="",e.skinName="weaponSoulBreak",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.btnjihuo,this.onClick),this.removeTouchEvent(this.btntupo,this.onClick),this.removeTouchEvent(this.btnlianhua,this.onClick),this.removeTouchEvent(this.bgClose,this.onClick),TimerManager.ins().remove(this.timeClock,this),this.removeObserve(),DisplayUtils.removeFromParent(this.upLvEff),DisplayUtils.removeFromParent(this.finisheff);for(var i=0;i<this.effs.length;i++)DisplayUtils.removeFromParent(this.effs[i])},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnjihuo,this.onClick),this.addTouchEvent(this.btntupo,this.onClick),this.addTouchEvent(this.btnlianhua,this.onClick),this.addTouchEvent(this.bgClose,this.onClick),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.tipsType=t[0],this.roleId=t[1],this.slot=t[2],this.effs=[],this.flys=[],this.update()},e.prototype.callback=function(){UserTips.ins().showTips(this.calldesc+"成功"),"激活"==this.calldesc?(this.star.visible=!0,this.lock.visible=!1,this.tipsType=e.SHENGJI,this.callbackToUpdate()):"升级"==this.calldesc?this.playUpLvEff():"突破"==this.calldesc&&this.playflyEff()},e.prototype.callbackToUpdate=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleId),i=t.weapons.getSlotByInfo(this.slot);Assert(i,"WeaponSoulBreakWin slot:"+this.slot+", roleId:"+this.roleId),i.assault?this.tipsType=e.TUPO:"突破"==this.calldesc&&(this.btntupo.touchEnabled=!0,this.tipsType=e.SHENGJI),this.update()},e.prototype.update=function(){var t=GlobalConfig.WeaponSoulPosConfig[this.slot];if(this.tipsType==e.JIHUO){this.title.text="激活",this.star.visible=!1,this.lock.visible=!0,this.jihuo.visible=!0,this.tupo.visible=!1,this.lianhua.visible=!1,this.item1.imgIcon.source="b_"+t[0].icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.name1.text=t[0].name;var i=UserBag.ins().getBagItemById(t[0].costItem),s=i?i.count:0;if(this.material1.data={costItem:t[0].costItem,costNum:t[0].costNum,sum:s},t[1].attr){var n=AttributeData.getAttrStrByType(t[1].attr[0].type);this.jhattr0.text=n+"+"+t[1].attr[0].value,this.jhattr1.visible=!0,t[1].attr[1]?(n=AttributeData.getAttrStrByType(t[1].attr[1].type),this.jhattr1.text=n+"+"+t[1].attr[1].value):this.jhattr1.visible=!1}this.needItemId=t[0].costItem,this.curSum=s,this.maxSum=t[0].costNum}else if(this.tipsType==e.TUPO){this.title.text="突破",this.star.visible=!0,this.lock.visible=!1;var o=SubRoles.ins().getSubRoleByIndex(this.roleId),a=o.weapons.getSlotByInfo(this.slot);if(this.jihuo.visible=!1,this.tupo.visible=!0,this.lianhua.visible=!1,this.item1.imgIcon.source="b_"+t[0].icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.name3.text=t[0].name,this.tpattr1.text=a.showlv+"",this.tpattr2.text=a.assault+"",this.tpright0.x=this.tpattr1.x+this.tpattr1.width,this.tpattr2.x=this.tpright0.x+this.tpright0.width,a.attr){this.tpattr0.text=AttributeData.getAttrStrByType(a.attr[0].type),this.tpattr3.text=a.attr[0].value+"";var r=GlobalConfig.WeaponSoulPosConfig[a.id][a.level+1];this.tpattr4.text=r.attr[0].value+"",this.tpright1.x=this.tpattr3.x+this.tpattr3.width,this.tpattr4.x=this.tpright1.x+this.tpright1.width,a.attr[1]&&r.attr[1]?(this.g2.visible=!0,this.tpattr5.text=AttributeData.getAttrStrByType(a.attr[1].type),this.tpattr6.text=a.attr[1].value+"",this.tpattr7.text=r.attr[1].value+"",this.tpright2.x=this.tpattr6.x+this.tpattr6.width,this.tpattr7.x=this.tpright2.x+this.tpright2.width):this.g2.visible=!1}var i=UserBag.ins().getBagItemById(a.costItem),s=i?i.count:0;this.material.data={costItem:a.costItem,costNum:a.costNum,sum:s},this.needItemId=a.costItem,this.curSum=s,this.maxSum=a.costNum}else if(this.tipsType==e.SHENGJI){this.title.text="炼化",this.star.visible=!0,this.lock.visible=!1,this.lianhua.visible=!0,this.jihuo.visible=!1,this.tupo.visible=!1;var o=SubRoles.ins().getSubRoleByIndex(this.roleId),a=o.weapons.getSlotByInfo(this.slot),h=GlobalConfig.WeaponSoulPosConfig[a.id][0],r=GlobalConfig.WeaponSoulPosConfig[a.id][a.level+1];if(!r)return this.costgroup0.visible=!1,this.btnlianhua.visible=this.costgroup0.visible,this.lhright1.visible=this.costgroup0.visible,this.lhright0.visible=this.costgroup0.visible,this.lhattr4.visible=this.costgroup0.visible,this.lhattr6.visible=this.costgroup0.visible,this.maxdesc0.visible=!this.costgroup0.visible,this.lhright2.visible=this.costgroup0.visible,this.lhattr8.visible=this.costgroup0.visible,a.attr&&(this.lhattr3.text=a.showlv+"",this.lhattr1.text=AttributeData.getAttrStrByType(a.attr[0].type),this.lhattr5.text=a.attr[0].value+"",a.attr[1]?(this.attr2.visible=!0,this.lhattr2.text=AttributeData.getAttrStrByType(a.attr[1].type),this.lhattr7.text=a.attr[1].value+""):this.attr2.visible=!1),this.name2.text=h.name,this.item1.imgIcon.source="b_"+h.icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.updateEff(),void this.addCheckEff();if(this.item1.imgIcon.source="b_"+h.icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.name2.text=h.name,a.attr){this.lhattr3.text=a.showlv+"",this.lhattr4.text=r.showlv+"",this.lhright1.x=this.lhattr3.x+this.lhattr3.width+this.lhright1.width,this.lhattr4.x=this.lhright1.x,this.lhattr1.text=AttributeData.getAttrStrByType(a.attr[0].type),this.lhattr5.text=a.attr[0].value+"",this.lhattr6.text=r.attr[0].value+"",this.lhright0.x=this.lhattr5.x+this.lhattr5.width+this.lhright0.width,this.lhattr6.x=this.lhright0.x,a.attr[1]&&r.attr[1]?(this.attr2.visible=!0,this.lhattr2.text=AttributeData.getAttrStrByType(a.attr[1].type),this.lhattr7.text=a.attr[1].value+"",this.lhattr8.text=r.attr[1].value+"",this.lhright2.x=this.lhattr7.x+this.lhattr7.width+this.lhright2.width,this.lhattr8.x=this.lhright2.x):this.attr2.visible=!1;var i=UserBag.ins().getBagItemById(a.costItem),s=i?i.count:0,l=GlobalConfig.ItemConfig[a.costItem];this.micon0.source=l.icon+"_png";var c=void 0;c=s>=a.costNum?ColorUtil.GREEN:ColorUtil.RED,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+c+"&T:"+s+"|/|C:0xD1C28F&T:"+a.costNum),this.needItemId=a.costItem,this.curSum=s,this.maxSum=a.costNum}}this.updateEff(),this.addCheckEff()},e.prototype.updateEff=function(){if(this.star.visible){var t=SubRoles.ins().getSubRoleByIndex(this.roleId),i=t.weapons.getSlotByInfo(this.slot);if(!i)return void UserTips.ins().showTips("显示异常");if(this.cirimg.visible=!0,!i.level){for(var s=0;s<e.maxCir;s++)this["s"+s].visible=!1;return void(this.cirimg.visible=!1)
}if(this.maxdesc0.visible||this.tipsType==e.TUPO){for(var s=0;s<e.maxCir;s++)this["s"+s].visible=!0;return void DisplayUtils.drawCir(this._shap,this.star.width>>1,360)}for(var n=i.level%10,s=0;s<e.maxCir;s++)n?this["s"+s].visible=n>s:this["s"+s].visible=!1,this._shap||(this._shap=new egret.Shape),this._shap.parent||(this.star.addChild(this._shap),this.cirimg.mask=this._shap,this._shap.x=this._shap.y=this.star.width>>1,this._shap.rotation=-90),s>0&&n>0?DisplayUtils.drawCir(this._shap,this.star.width>>1,360*(n-1)/e.maxCir):this._shap.graphics.clear()}},e.prototype.addCheckEff=function(){for(var t=0;t<e.maxCir;t++)if(this["s"+t].visible){if(!this.effs[t]){var i=new MovieClip;this.effs[t]=i}this.effs[t].parent||this["star"+t].addChild(this.effs[t]),this.effs[t].x=21,this.effs[t].y=21,this.effs[t].playFile(RES_DIR_EFF+"bally2",-1)}else this.effs[t]&&this.effs[t].parent&&DisplayUtils.removeFromParent(this.effs[t])},e.prototype.playUpLvEff=function(){this.upLvEff||(this.upLvEff=new MovieClip),this.upLvEff.parent||this.star.addChild(this.upLvEff),this.upLvEff.x=145,this.upLvEff.y=140;var t=this;this.upLvEff.playFile(RES_DIR_EFF+"forgeSuccess",1,function(){DisplayUtils.removeFromParent(t.upLvEff)}),t.callbackToUpdate()},e.prototype.playflyEff=function(){for(var t=this,e=function(e){if(i.effs[e]&&i.effs[e].parent){i.flys[e]=!0;var s=i.item1.localToGlobal();i["star"+e].globalToLocal(s.x+38,s.y+38,s),egret.Tween.get(i.effs[e]).to({x:s.x,y:s.y},500).call(function(){t.flys[e]=!1,egret.Tween.removeTweens(t.effs[e]),DisplayUtils.removeFromParent(t.effs[e])})}},i=this,s=0;s<this.effs.length;s++)e(s);TimerManager.ins().remove(this.timeClock,this),TimerManager.ins().doTimer(100,0,this.timeClock,this)},e.prototype.timeClock=function(){for(var t=0;t<this.flys.length;t++)if(this.flys[t])return;TimerManager.ins().remove(this.timeClock,this),this.finisheff||(this.finisheff=new MovieClip),this.finisheff.parent||this.star.addChild(this.finisheff),this.finisheff.x=145,this.finisheff.y=140;var e=this;this.finisheff.playFile(RES_DIR_EFF+"spirittupo",1,function(){e.callbackToUpdate(),DisplayUtils.removeFromParent(e.finisheff)})},e.prototype.onClick=function(t){switch(t.target){case this.btnjihuo:case this.btntupo:if(t.target==this.btnjihuo?this.calldesc="激活":(this.calldesc="突破",this.btntupo.touchEnabled=!1),this.curSum<this.maxSum)return UserTips.ins().showTips("材料不足"),void UserWarn.ins().setBuyGoodsWarn(this.needItemId);Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot),SoundUtil.ins().playEffect(SoundUtil.FORGE);break;case this.btnlianhua:if(this.curSum<this.maxSum)return UserTips.ins().showTips("材料不足"),void UserWarn.ins().setBuyGoodsWarn(this.needItemId);this.calldesc="升级",Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot),SoundUtil.ins().playEffect(SoundUtil.FORGE);break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);WeaponSoulBreakWin.TUPO=1,WeaponSoulBreakWin.JIHUO=2,WeaponSoulBreakWin.SHENGJI=3,WeaponSoulBreakWin.maxCir=9,__reflect(WeaponSoulBreakWin.prototype,"WeaponSoulBreakWin"),ViewManager.ins().reg(WeaponSoulBreakWin,LayerManager.UI_Popup);var WeaponSoulItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulitem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.slot=0},e.prototype.dataChanged=function(){if(this.data){var t;this.black.visible=!1,this.data instanceof WeaponsInfo?(t=this.data,this.itemIcon.setActived(!0)):(t=this.data,this.black.visible=!0),this.slot=t.id;var e=GlobalConfig.WeaponSoulPosConfig[t.id][0];this.itemIcon.imgIcon.source=e.icon+"_png",this.lv.text=(isNaN(t.level)?e.level:t.level)+"",this.nameTxt.text=e.name;var i=GlobalConfig.WeaponSoulPosConfig[t.id][Number(this.lv.text)+1];if(t.costNum&&i){var s=UserBag.ins().getBagItemById(t.costItem),n=s?s.count:0;this.redPoint.visible=n>=t.costNum?!0:!1}else this.redPoint.visible=!1}},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);__reflect(WeaponSoulItem.prototype,"WeaponSoulItem");var WeaponSoulSkillTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulSkilltips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.roleId=t[0],this.weaponId=t[1];var i=SubRoles.ins().getSubRoleByIndex(this.roleId);this.head(i),this.curSkill(i),this.nextSkill(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.head=function(t){var e=t.weapons.getSuitConfig(this.weaponId);e||(e=GlobalConfig.WeaponSoulSuit[this.weaponId][0]),this.skillicon.data={icon:e.skillicon},this.skillname.text=e.skillname},e.prototype.curSkill=function(t){var e=t.weapons.getSuitConfig(this.weaponId);e||(e=GlobalConfig.WeaponSoulSuit[this.weaponId][0]);for(var i=GlobalConfig.WeaponSoulConfig[this.weaponId],s="",n=0,o=0;o<i.actcond.length;o++){var a=i.actcond[o],r=t.weapons.getInfoLevel(a),h=GlobalConfig.WeaponSoulPosConfig[a][0].name;r&&r>=e.level?(s+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+h+"| ",n++):s+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"| "}this.num0.text="（"+n+"/"+i.actcond.length+"）",this.informationname0.textFlow=TextFlowMaker.generateTextFlow1(s),this.desc0.text=this.ShowSkillDesc(e)},e.prototype.nextSkill=function(t){var e=t.weapons.getNextSuitConfig(this.weaponId);if(!e)return this.name1.text="已满级",this.num1.visible=!1,this.nextdesc1.visible=!1,this.informationname1.visible=!1,void(this.ndesc0.visible=!1);for(var i=GlobalConfig.WeaponSoulConfig[this.weaponId],s="",n=0,o=0;o<i.actcond.length;o++){var a=i.actcond[o],r=t.weapons.getInfoLevel(a),h=GlobalConfig.WeaponSoulPosConfig[a][0].name;r>=e.level?(s+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+h+"| ",n++):s+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"| "}this.num1.text="（"+n+"/"+i.actcond.length+"）",this.informationname1.textFlow=TextFlowMaker.generateTextFlow1(s),this.ndesc0.text=this.ShowSkillDesc(e);var l=this.nextdesc1.text,c=l.split("X"),u=c[0],p=c[1],d=u+(""+e.level)+p;this.nextdesc1.text=d},e.prototype.ShowSkillDesc=function(t){return t.skilldesc},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WeaponSoulSkillTips.prototype,"WeaponSoulSkillTips"),ViewManager.ins().reg(WeaponSoulSkillTips,LayerManager.UI_Popup);var WeaponSoulUplvWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulUplv",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn1,this.onClick),this.addTouchEvent(this.bgClose,this.onClick),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.roleId=t[0],this.slot=t[1],this.update()},e.prototype.callback=function(){UserTips.ins().showTips("升级成功"),this.update()},e.prototype.update=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.weapons.getSlotByInfo(this.slot),i=GlobalConfig.WeaponSoulPosConfig[e.id][0],s=GlobalConfig.WeaponSoulPosConfig[e.id][e.level+1];if(!s)return this.costgroup.visible=!1,this.btn1.visible=this.costgroup.visible,this.rightIcon0.visible=this.costgroup.visible,this.rightIcon1.visible=this.costgroup.visible,this.attr6.visible=this.costgroup.visible,this.attr4.visible=this.costgroup.visible,this.maxdesc.visible=!this.costgroup.visible,e.attr&&(this.attr5.text=e.attr[0].value+"",this.attr2.text=AttributeData.getAttrStrByType(e.attr[0].type)),this.name0.text=i.name,this.item0.imgIcon.source=i.icon+"_png",void(this.item0.imgJob.visible=!1);if(this.item0.imgIcon.source=i.icon+"_png",this.item0.imgJob.visible=!1,this.name0.text=i.name,e.attr){this.attr5.text=e.attr[0].value+"",this.attr6.text=s.attr[0].value+"",this.rightIcon0.x=this.attr5.x+this.attr5.width+this.rightIcon0.width,this.attr6.x=this.rightIcon0.x,this.attr2.text=AttributeData.getAttrStrByType(e.attr[0].type),this.attr3.text=e.attr[0].value+"",this.attr4.text=s.attr[0].value+"",this.rightIcon1.x=this.attr3.x+this.attr3.width+this.rightIcon1.width,this.attr4.x=this.rightIcon1.x;var n=UserBag.ins().getBagItemById(e.costItem),o=n?n.count:0,a=GlobalConfig.ItemConfig[e.costItem];this.micon.source=a.icon+"",this.countLabel0.text=o+"/"+e.costNum,this.curSum=o,this.maxSum=e.costNum}},e.prototype.onClick=function(t){switch(t.target){case this.btn1:if(this.curSum<this.maxSum)return void UserTips.ins().showTips("材料不足");Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot);break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.btn1,this.onClick),this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e}(BaseEuiView);__reflect(WeaponSoulUplvWin.prototype,"WeaponSoulUplvWin"),ViewManager.ins().reg(WeaponSoulUplvWin,LayerManager.UI_Popup);var WeaponWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.closeSoulCondition=function(t){this.normal.visible=t,this.soul.visible=!t},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.leftbtn,this.onEvent),this.removeTouchEvent(this.rightbtn,this.onEvent),this.removeTouchEvent(this.active,this.onEvent),this.removeTouchEvent(this.turnBtn,this.onEvent),this.removeTouchEvent(this.backBtn,this.onEvent),this.removeTouchEvent(this.leftbtn0,this.onEvent),this.removeTouchEvent(this.rightbtn0,this.onEvent),this.removeTouchEvent(this.list1,this.onClick),this.list0.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this),this.removeObserve(),ViewManager.ins().getView(ForgeWin).isNotMove=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().getView(ForgeWin).isNotMove=!0,this.roleId=t[0],this.addTouchEvent(this.leftbtn,this.onEvent),this.addTouchEvent(this.rightbtn,this.onEvent),this.addTouchEvent(this.active,this.onEvent),this.addTouchEvent(this.turnBtn,this.onEvent),this.addTouchEvent(this.backBtn,this.onEvent),this.addTouchEvent(this.leftbtn0,this.onEvent),this.addTouchEvent(this.rightbtn0,this.onEvent),this.addTouchEvent(this.list1,this.onClick),this.addEvent(eui.UIEvent.CHANGE_END,this.list1Scroll,this.onChange),this.addEvent(eui.UIEvent.CHANGE_END,this.list0Scroll,this.onChangeFlex),this.list0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this),this.observe(Weapons.ins().postWeaponsAct,this.callback),this.observe(Weapons.ins().postWeaponsUse,this.callback),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.observe(Weapons.ins().postWeaponsFlexibleAct,this.callback),this.observe(Weapons.ins().postWeaponsFlexibleCount,this.callback),this.list1.itemRenderer=WeaponListItem,this.list0.itemRenderer=WeaponListItem,this.leftbtn.parent.touchEnabled=!1,this.weaponId=1,this.weaponFlexible=0,this.closeSoulCondition(t[1]),this.updateBtn(),this.init(this.weaponId)},e.prototype.updateBtn=function(){this.turnBtn.visible=!0},e.prototype.init=function(t){this.soulArr=[],this.listdata=[],this.dataArr=new eui.ArrayCollection(this.listdata);var e=SubRoles.ins().getSubRoleByIndex(this.roleId);for(var i in GlobalConfig.WeaponSoulConfig){var s=GlobalConfig.WeaponSoulConfig[i],n=e.weapons.getSoulInfoData()[s.id],o=e.weapons.getSuitConfig(s.id),a={isuse:e.weapons.weaponsId==s.id?!0:!1,id:n&&n.id&&o?o.id:0,isRedPoint:e.weapons.getRedPointBySuit(s.id),level:n&&n.id&&o?o.level:0,isSelect:i==t.toString()?!0:!1,showId:s.id,job:e.job};this.listdata.push(a),n&&n.id&&o&&this.soulArr.push(a)}this.updateUI(),this.list1.dataProvider=this.dataArr,this.list1.scrollH=0,this.onChange(),this.updateSoul(this.soulArr,!0),this.updateRedPoint(),this.onChangeFlex()},e.prototype.setSelectId=function(t){for(var e=0;e<this.listdata.length;e++){var i=this.listdata[e];i.isSelect=e==t?!0:!1}this.dataArr.replaceAll(this.listdata),this.list1.dataProvider=this.dataArr},e.prototype.onSoulClick=function(t){if(t&&t.itemRenderer&&t.item){var e=t.item,i=SubRoles.ins().getSubRoleByIndex(this.roleId),s=i.weapons.getFlexibleData(),n=i.weapons.getSuitConfig(e.id);if(n){var o="";e.isuse?(o="|C:0xffd93f&T:",this.active.visible=!0):this.active.visible=i.weapons.flexibleCount<=s.length?!1:!0,this.weaponFlexible=n.id,this.skillicon0.data={icon:n.skillicon},this.skill.textFlow=TextFlowMaker.generateTextFlow1(o+n.skilldesc),this.skillname0.textFlow=TextFlowMaker.generateTextFlow1(n.skillname)}else this.weaponFlexible=0;e.isuse?(this.active.label="取  消",this.redPoint.visible=!1):(this.active.label="激  活",this.redPoint.visible=i.weapons.flexibleCount<=s.length?!1:!0)}},e.prototype.onClick=function(t){var e=t.currentTarget.selectedIndex;e=e>0?e:0,this.listdata[e]&&(this.weaponId=this.listdata[e].showId,this.setSelectId(e),ViewManager.ins().open(WeaponPanel,this.roleId,this.weaponId)),this.onChange()},e.prototype.onChange=function(){this.list1.scrollH<150?(this.leftbtn.visible=!1,this.rightbtn.visible=!0):this.list1.scrollH>=150*(this.list1.dataProvider.length-3)?(this.leftbtn.visible=!0,this.rightbtn.visible=!1):(this.leftbtn.visible=!0,this.rightbtn.visible=!0)},e.prototype.onChangeFlex=function(){if(this.nothingTips.visible)return this.leftbtn0.visible=!1,void(this.rightbtn0.visible=!1);var t=SubRoles.ins().getSubRoleByIndex(this.roleId);return t&&this.soulArr.length<=3?(this.leftbtn0.visible=!1,void(this.rightbtn0.visible=!1)):void(this.list0.scrollH<150?(this.leftbtn0.visible=!1,this.rightbtn0.visible=!0):this.list0.scrollH>=150*(this.list0.dataProvider.length-3)?(this.leftbtn0.visible=!0,this.rightbtn0.visible=!1):(this.leftbtn0.visible=!0,this.rightbtn0.visible=!0))},e.prototype.onEvent=function(t){var e=450;switch(t.currentTarget){case this.leftbtn:this.list1.scrollH<=e?this.list1.scrollH=0:this.list1.scrollH-=e;break;case this.rightbtn:this.list1.scrollH>=150*(this.list1.dataProvider.length-3)?this.list1.scrollH=150*(this.list1.dataProvider.length-3):this.list1.scrollH+=e;break;case this.leftbtn0:this.list0.scrollH<=e?this.list0.scrollH=0:this.list0.scrollH-=e;break;case this.rightbtn0:this.list0.scrollH>=150*(this.list0.dataProvider.length-3)?this.list0.scrollH=150*(this.list0.dataProvider.length-3):this.list0.scrollH+=e;break;case this.active:if("激  活"==this.active.label){var i=SubRoles.ins().getSubRoleByIndex(this.roleId),s=i.weapons.getFlexibleData();if(i.weapons.flexibleCount<=s.length)return void UserTips.ins().showCenterTips("当前已激活"+i.weapons.flexibleCount+"个兵魂技能，请先取消任意一个");if(!this.weaponFlexible)return void UserTips.ins().showCenterTips("兵魂之灵激活数据异常");this.isSendActFlex=!0,Weapons.ins().sendWeaponsFlexibleAct(this.roleId,WeaponFlex.act,this.weaponFlexible)}else if("取  消"==this.active.label){if(!this.weaponFlexible)return void UserTips.ins().showCenterTips("兵魂之灵取消数据异常");this.isSendActFlex=!0,Weapons.ins().sendWeaponsFlexibleAct(this.roleId,WeaponFlex.cancel,this.weaponFlexible)}break;case this.turnBtn:this.close(),this.open(this.roleId,!1);var n=ViewManager.ins().getView(ForgeWin);n&&n.redPointEx();var o=UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid),a=SubRoles.ins().getSubRoleByIndex(this.roleId);o&&a.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum&&ViewManager.ins().open(RoleChooseItemWin,this.roleId);break;case this.backBtn:if(!UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid))return void UserTips.ins().showTips("背包内没有兵魂之灵");ViewManager.ins().open(RoleChooseItemWin,this.roleId)}this.onChange(),this.onChangeFlex()},e.prototype.updateUI=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleId);this.powerPanel.setPower(t.getWeaponTotalPower());var e=[4,2,6,5],i=[0,0,0,0],s=!1,n=t.weapons.getInfoData();for(var o in n){var a=n[o];for(var r in a)for(var h=a[r],l=0;l<h.attr.length;l++){var c=h.attr[l];if(-1!=e.indexOf(c.type))for(var u=0;u<e.length;u++)e[u]==c.type&&(i[u]+=c.value,s=!0)}}var p=t.weapons.flexibleCount?t.weapons.flexibleCount-1:0,d=GlobalConfig.WeaponSoulItemAttr[p];if(s&&d)for(var g=0;g<d.attr.length;g++)if(-1!=e.indexOf(d.attr[g].type))for(var u=0;u<e.length;u++)e[u]==d.attr[g].type&&(i[u]+=d.attr[g].value);for(var g=0;4>g;g++)if(this["attr"+g]){var f=AttributeData.getAttrStrByType(e[g]);this["attr"+g].text=f+"+"+i[g]}},e.prototype.callback=function(){this.soulArr=[];var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.weapons.getSuitConfig(this.weaponId);for(var i in this.listdata){var s=t.weapons.getSoulInfoData()[this.listdata[i].showId],n=this.listdata[i];n.showId==this.weaponId?(n.isuse=t.weapons.weaponsId==this.weaponId?!0:!1,n.id=s&&s.id&&e?e.id:0,n.isRedPoint=t.weapons.getRedPointBySuit(n.showId),n.level=s&&s.id&&e?e.level:0,n.isSelect=!0,n.showId=n.showId):(n.isRedPoint=t.weapons.getRedPointBySuit(n.showId),n.isSelect=!1,n.isuse=n.showId==t.weapons.weaponsId),s&&s.id&&e&&this.soulArr.push(n)}this.updateUI(),this.dataArr.replaceAll(this.listdata),this.list1.dataProvider=this.dataArr,this.updateSoul(this.soulArr),this.updateActLabel(),this.updateRedPoint()},e.prototype.updateSoul=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(this.roleId);if(this.soulArr=[],i.weapons.flexibleCount)for(var s=0;s<t.length;s++){var n={isuse:Weapons.ins().checkIsUseFlexible(i.index,t[s].id),id:t[s].id,isRedPoint:ForgeRedPoint.ins().getFlexibleRedPointOnly(i.index,t[s].showId),level:t[s].level,isSelect:t[s].isSelect,showId:t[s].showId,job:t[s].job};this.soulArr.push(n)}this.list0.dataProvider=new eui.ArrayCollection(this.soulArr);var o=i.weapons.flexibleCount?i.weapons.flexibleCount-1:0;if(this.desc.textFlow=TextFlowMaker.generateTextFlow1("|C:0xF8B141&T:当前已使用|C:0x00ff00&T:"+o+"|C:0xF8B141&T:个兵魂之灵，最多可以同时激活|C:0x00ff00&T:"+(o+1)+"|C:0xF8B141&T:把兵魂技能效果"),e){if(this.soulArr.length>0&&i.weapons.flexibleCount){this.active.visible=this.skillicon0.visible=this.skill.visible=this.skillname0.visible=!0;var a=i.weapons.getSuitConfig(this.soulArr[0].id);if(a){var r="";this.soulArr[0].isuse&&(r="|C:0xffd93f&T:"),this.skillicon0.data={icon:a.skillicon},this.skill.textFlow=TextFlowMaker.generateTextFlow1(r+a.skilldesc),this.skillname0.textFlow=TextFlowMaker.generateTextFlow1(a.skillname)}if(this.leftbtn0.visible=this.rightbtn0.visible=!1,this.soulArr.length>3&&(this.rightbtn0.visible=!0),this.soulArr[0].isuse)this.active.label="取  消",this.redPoint.visible=!1;else{this.active.label="激  活";var h=i.weapons.getFlexibleData();this.active.visible=this.redPoint.visible=i.weapons.flexibleCount<=h.length?!1:!0}this.weaponFlexible=this.soulArr[0].showId}else this.redPoint.visible=!1,this.leftbtn0.visible=this.rightbtn0.visible=!1,this.active.visible=this.skillicon0.visible=this.skill.visible=this.skillname0.visible=!1;this.nothingTips.visible=!this.skillicon0.visible,this.nothingTips.visible&&(i.weapons.flexibleCount?this.nothingTips.text="目前尚未激活任何兵魂":this.nothingTips.text="该角色尚未使用兵魂之灵")}},e.prototype.updateActLabel=function(){if(!this.isSendActFlex)return void(this.isSendActFlex=!1);var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.weapons.getFlexibleData();this.isSendActFlex=!1;var i=this.skill.text;"激  活"==this.active.label?(this.active.label="取  消",this.redPoint.visible=!1,this.skill.textFlow=TextFlowMaker.generateTextFlow1("|C:0xffd93f&T:"+i)):"取  消"==this.active.label&&(this.active.label="激  活",this.active.visible=this.redPoint.visible=t.weapons.flexibleCount<=e.length?!1:!0,this.skill.textFlow=TextFlowMaker.generateTextFlow1("|C:0x898989&T:"+i))},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.isShowSoul=function(){return this.soul?this.soul.visible:!1},e.prototype.updateRedPoint=function(){var t=UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid),e=SubRoles.ins().getSubRoleByIndex(this.roleId);this.redPoint0.visible=ForgeRedPoint.ins().getFlexibleRedPoint(this.roleId)||t&&e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?!0:!1,this.backBtn.visible=this.redPoint1.visible=t&&e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?!0:!1},e}(BaseEuiView);__reflect(WeaponWin.prototype,"WeaponWin");var Weapons=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Weapons,e.regNetMsg(0,e.postWeaponsInfo),e.regNetMsg(1,e.postWeaponsUpLevel),e.regNetMsg(2,e.postWeaponsAct),e.regNetMsg(3,e.postWeaponsUse),e.regNetMsg(4,e.postWeaponsFlexibleAct),e.regNetMsg(5,e.postWeaponsFlexibleCount),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkRedPoint=function(t){if(!OpenSystem.ins().checkSysOpen(SystemType.WEAPONS))return!1;var e=SubRoles.ins().getSubRoleByIndex(t);for(var i in GlobalConfig.WeaponSoulConfig){var s=GlobalConfig.WeaponSoulConfig[i];if(e.weapons.getRedPointBySuit(s.id))return!0}var n=ForgeRedPoint.ins().getFlexibleRedPoint(t);if(n)return!0;var o=UserBag.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid);return o&&e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?!0:!1},e.prototype.checkIsUseFlexible=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t);return-1!=i.weapons.getFlexibleData().indexOf(e)?!0:!1},e.prototype.sendWeaponsUpLevel=function(t,e){var i=this.getBytes(1);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendWeaponsAct=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendWeaponsUse=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendWeaponsFlexibleAct=function(t,e,i){var s=this.getBytes(4);s.writeByte(t),s.writeByte(e),s.writeShort(i),this.sendToServer(s)},e.prototype.sendWeaponsFlexibleCount=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.postWeaponsInfo=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.parser(t)},e.prototype.postWeaponsUpLevel=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.parserInfoOnly(t)},e.prototype.postWeaponsAct=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.parserSoulInfoOnly(t,e)},e.prototype.postWeaponsUse=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.weaponsId=t.readShort();var s=EntityManager.ins().getEntityByHandle(i.handle);s&&s.updateModel()},e.prototype.postWeaponsFlexibleAct=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(e),o=n.weapons.getFlexibleData();if(i==WeaponFlex.act)-1==o.indexOf(s)&&o.push(s);else for(var a=0;a<o.length;a++)if(o[a]==s){o.splice(a,1);break}},e.prototype.postWeaponsFlexibleCount=function(t){var e=t.readByte(),i=t.readShort(),s=SubRoles.ins().getSubRoleByIndex(e);s&&(s.weapons.flexibleCount=i?i+1:0)},e}(BaseSystem);__reflect(Weapons.prototype,"Weapons");var WeaponFlex;!function(t){t[t.act=0]="act",t[t.cancel=1]="cancel"}(WeaponFlex||(WeaponFlex={}));var GameSystem;!function(t){t.weapons=Weapons.ins.bind(Weapons)}(GameSystem||(GameSystem={}));var WingFeishengTipsWin=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.skinName="wingFeishengTips",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._curRole=t[0],this.observe(UserBag.ins().postItemAdd,this.itemChange),this.observe(UserBag.ins().postItemChange,this.itemChange),this.observe(UserBag.ins().postItemDel,this.itemChange),this.observe(Wing.ins().postUseDanSuccess,this.update),this.observe(Wing.ins().postWingUpgrade,this.update),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole),e=GlobalConfig.WingLevelConfig[t.wingsData.lv];this.wingName.text=e.name,this.feishengLv.text=t.wingsData.flyUpDan+"级",this.career.text=Role.getJobNameByJob(t.job);var i=e.flyPill;if(t.wingsData.flyUpDan>=i)this.currentState="maxLv";else{var s=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId),n=s?s.count:0;n?this.currentState="normal":this.currentState="noitem"}this.updateAttrs()},e.prototype.updateAttrs=function(){for(var t,e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=GlobalConfig.WingLevelConfig[e.wingsData.lv],s=i.attr.length,n=GlobalConfig.WingCommonConfig.flyPillAttr,o=n.length,a=[],r=1;4>=r;r++)this["attr"+r].text="",this["attr"+r+"NextLv"].text="",s>=r&&(t=i.attr[r-1],this["attr"+r].text=AttributeData.getAttrStrByType(t.type)+": +"+Math.floor(GlobalConfig.WingCommonConfig.flyPill/100)*e.wingsData.flyUpDan+"%","normal"==this.currentState&&(this["attr"+r+"NextLv"].text="+"+Math.floor(GlobalConfig.WingCommonConfig.flyPill/100)*(e.wingsData.flyUpDan+1)+"%"),a.push(new AttributeData(t.type,Math.floor(t.value*GlobalConfig.WingCommonConfig.flyPill/1e4*e.wingsData.flyUpDan)))),this["attr"+(r+4)].text="",this["attr"+(r+4)+"NextLv"].text="",o>=r&&(t=n[r-1],this["attr"+(r+4)].text=AttributeData.getAttrStrByType(t.type)+": +"+t.value*e.wingsData.flyUpDan,"normal"==this.currentState&&(this["attr"+(r+4)+"NextLv"].text="+"+t.value*(e.wingsData.flyUpDan+1)),a.push(new AttributeData(t.type,t.value*e.wingsData.flyUpDan)));this.powerPanel.setPower(UserBag.getAttrPower(a))},e.prototype.itemChange=function(){if("maxLv"!=this.currentState){var t,e=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId),i=e?e.count:0;i?(t="normal"!=this.currentState,this.currentState="normal"):(t="noitem"!=this.currentState,this.currentState="noitem"),t&&this.updateAttrs()}},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.updateBtn:Wing.ins().sendUseDan(this._curRole,1)}},e}(BaseEuiView);__reflect(WingFeishengTipsWin.prototype,"WingFeishengTipsWin"),ViewManager.ins().reg(WingFeishengTipsWin,LayerManager.UI_Main);var WingZizhiTipsWin=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.skinName="wingZizhiTips",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._curRole=t[0],this.observe(UserBag.ins().postItemAdd,this.itemChange),this.observe(UserBag.ins().postItemChange,this.itemChange),this.observe(UserBag.ins().postItemDel,this.itemChange),this.observe(Wing.ins().postUseDanSuccess,this.update),this.observe(Wing.ins().postWingUpgrade,this.update),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole),e=GlobalConfig.WingLevelConfig[t.wingsData.lv];this.wingName.text=e.name,this.zizhiLv.text=t.wingsData.aptitudeDan+"级",this.career.text=Role.getJobNameByJob(t.job);var i=e.attrPill;if(t.wingsData.aptitudeDan>=i)this.currentState="maxLv";else{var s=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId),n=s?s.count:0;n?this.currentState="normal":this.currentState="noitem"}this.updateAttrs()},e.prototype.updateAttrs=function(){for(var t,e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=GlobalConfig.WingCommonConfig.attrPill,s=i.length,n=[],o=1;4>=o;o++)this["attr"+o].text="",this["attr"+o+"NextLv"].text="",s>=o&&(t=i[o-1],this["attr"+o].text=AttributeData.getAttrStrByType(t.type)+": +"+t.value*e.wingsData.aptitudeDan,n.push(new AttributeData(t.type,t.value*e.wingsData.aptitudeDan)),"normal"==this.currentState&&(this["attr"+o+"NextLv"].text="+"+i[o-1].value*(e.wingsData.aptitudeDan+1)));this.powerPanel.setPower(UserBag.getAttrPower(n))},e.prototype.itemChange=function(){if("maxLv"!=this.currentState){var t,e=UserBag.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId),i=e?e.count:0;i?(t="normal"!=this.currentState,this.currentState="normal"):(t="noitem"!=this.currentState,this.currentState="noitem"),t&&this.updateAttrs()}},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.updateBtn:Wing.ins().sendUseDan(this._curRole,0)}},e}(BaseEuiView);__reflect(WingZizhiTipsWin.prototype,"WingZizhiTipsWin"),ViewManager.ins().reg(WingZizhiTipsWin,LayerManager.UI_Main);var ZhanLingData=function(){function t(t){this._id=t?t:0,this._level=0,this._exp=0,this._items=[];for(var e=0;e<GlobalConfig.ZhanLingConfig.equipPosCount;e++)this._items.push(0);this._talentLv=0,this._drugs=[];for(var e in GlobalConfig.ZhanLingConfig.upgradeInfo)this._drugs.push({itemId:Number(e),count:0})}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exp",{get:function(){return this._exp},set:function(t){this._exp=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},set:function(t){this._items=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"talentLv",{get:function(){return this._talentLv},set:function(t){this._talentLv=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drugs",{get:function(){return this._drugs},set:function(t){this._drugs=t},enumerable:!0,configurable:!0}),t}();__reflect(ZhanLingData.prototype,"ZhanLingData");var ZLPOS;!function(t){t[t.ITEM1=1]="ITEM1",t[t.ITEM2=2]="ITEM2",t[t.ITEM3=3]="ITEM3",t[t.ITEM4=4]="ITEM4"}(ZLPOS||(ZLPOS={}));var ZhanLingModel=function(t){function e(){var e=t.call(this)||this;return e._ZhanLingData={},e._ZhanLingSkinId=0,e._showZLlist=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"ZhanLingData",{get:function(){return this._ZhanLingData},enumerable:!0,configurable:!0}),e.prototype.getZhanLingDataById=function(t){return this._ZhanLingData[t]},e.prototype.setZhanLingData=function(t){t&&(this._ZhanLingData[t.id]=t)},Object.defineProperty(e.prototype,"ZhanLingSkinId",{get:function(){return this._ZhanLingSkinId},set:function(t){this._ZhanLingSkinId=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showZLlist",{get:function(){return this._showZLlist},set:function(t){this._showZLlist=t},enumerable:!0,configurable:!0}),e.prototype.ZhanLingOpen=function(){return UserZs.ins().lv>=GlobalConfig.ZhanLingConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.ZhanLingConfig.openserverday},e.prototype.getZhanLingDataByLevel=function(t){return this._ZhanLingData[t]?this._ZhanLingData[t].level:0},e.prototype.getZhanLingDataByStage=function(t){if(!this._ZhanLingData[t].level)return 1;var e=Math.floor(this._ZhanLingData[t].level/10),i=Math.floor(this._ZhanLingData[t].level%10);return e+=1,i||(e-=1),e||(e=1),e},e.prototype.getZhanLingDataByNextStage=function(t){var e=0;this._ZhanLingData[t]&&(e=this._ZhanLingData[t].talentLv);var i,s=GlobalConfig.ZhanLingLevel[t];for(var n in s){var o=s[n];if(o.talentLevel>e){i=o;break}}return i?this.getStageLv(i.level):null},e.prototype.getZhanLingDataByStar=function(t){if(!this._ZhanLingData[t]||!this._ZhanLingData[t].level)return 0;var e=Math.floor(this._ZhanLingData[t].level%10);return e||(e=10),e},e.prototype.getZhanLingDataByTalentLv=function(t){if(!this._ZhanLingData[t])return 0;var e=this.getZhanLingDataByLevel(t),i=GlobalConfig.ZhanLingLevel[t][e].talentLevel;return i&&(this._ZhanLingData[t].talentLv=i),this._ZhanLingData[t].talentLv},e.prototype.getZhanLingDataByExp=function(t){return this._ZhanLingData[t]?this._ZhanLingData[t].exp:0},e.prototype.getZhanLingDataByItem=function(t,e){return this._ZhanLingData[t]?this._ZhanLingData[t].items[e-1]:0},e.prototype.getZhanLingDataByDrugUse=function(t,e){if(!this._ZhanLingData[t])return!1;var i=0,s=UserBag.ins().getBagItemById(e);if(i=s?s.count:0,!i)return!1;
var n=this._ZhanLingData[t].level,o=GlobalConfig.ZhanLingLevel[t][n];t&&!o.maxCount;var a=!1;if(o.maxCount&&o.maxCount[e])for(var r=0;r<this._ZhanLingData[t].drugs.length;r++)if(this._ZhanLingData[t].drugs[r].itemId==e&&this._ZhanLingData[t].drugs[r].count>=o.maxCount[e]){a=!0;break}return a?!1:!0},e.prototype.getZhanLingDataByTalentId=function(t){var e=GlobalConfig.ZhanLingBase[t];return e?e.talent:0},e.prototype.getZhanLingDataBySkill=function(t){var e=[];return this._ZhanLingData[t]?GlobalConfig.ZhanLingBase[t].skill:e},e.prototype.getZhanLingDataByDrug=function(t,e){if(!this._ZhanLingData[t])return 0;for(var i=0;i<this._ZhanLingData[t].drugs.length;i++)if(this._ZhanLingData[t].drugs[i].itemId==e)return this._ZhanLingData[t].drugs[i].count;return 0},e.prototype.getZhanLingDataBySuit=function(t){if(!this._ZhanLingData[t])return 0;for(var e=0,i=0;i<this._ZhanLingData[t].items.length;i++){var s=this._ZhanLingData[t].items[i],n=GlobalConfig.ZhanLingEquip[s];if(!n)return 0;e||(e=n.level),e>n.level&&(e=n.level)}return e},e.prototype.getZhanLingDataBySuitCount=function(t,e){if(!this._ZhanLingData[t])return 0;for(var i=0,s=0;s<this._ZhanLingData[t].items.length;s++){var n=this._ZhanLingData[t].items[s],o=GlobalConfig.ZhanLingEquip[n];o.level>=e&&i++}return i},e.prototype.getZhanLingDataByMat=function(t,e){if(!e&&!this._ZhanLingData[t])return 0;var i=GlobalConfig.ZhanLingBase[t],s=i.talent,n=0;if(e)n=1;else{if(!this._ZhanLingData[t].talentLv)return 0;n=this._ZhanLingData[t].talentLv+1}var o=GlobalConfig.ZhanLingTalent[s][n];return o?o.costCount:0},e.prototype.getZhanLingPower=function(t){var i=0,s=e.ins().getZhanLingDataByLevel(t),n=GlobalConfig.ZhanLingLevel[t][s];if(!n)return[i,[],[]];var o=e.ins().getZhanLingDataById(t);if(!o)return[i,[],[]];var a=GlobalConfig.ZhanLingLevel[t][s+1],r=0,h=[],l=[],c=0,u=0,p=[],d=[],g=0,f=[],v=[],y=0,m=0;r+=UserBag.getAttrPower(n.attrs)*SubRoles.ins().subRolesLen;for(var T=0;T<SubRoles.ins().subRolesLen;T++){var b=SubRoles.ins().getSubRoleByIndex(T);for(var C in n.attrs)r+=ItemConfig.relatePower(n.attrs[C],b)}r+=(n.expower?n.expower:0)*SubRoles.ins().subRolesLen,h=this.addAttrs(h,n.attrs),a&&(l=this.addAttrs(l,a.attrs));var I=e.ins().getZhanLingDataBySuit(t);if(I){var w=GlobalConfig.ZhanLingSuit[I];if(w&&w.attrs){u+=UserBag.getAttrPower(w.attrs)*SubRoles.ins().subRolesLen;for(var C=0;C<w.attrs.length;C++)for(var T=0;T<SubRoles.ins().subRolesLen;T++){var b=SubRoles.ins().getSubRoleByIndex(T);u+=ItemConfig.relatePower(w.attrs[C],b)}p=AttributeData.getPercentAttr(h,w.precent/1e4),a&&(d=AttributeData.getPercentAttr(l,w.precent/1e4))}}for(var C=0;C<o.drugs.length;C++){for(var _=[],S=[],B=GlobalConfig.ZhanLingConfig.upgradeInfo[o.drugs[C].itemId],E=[],x=0;x<B.attr.length;x++){var R=new AttributeData;R.type=B.attr[x].type,R.value=B.attr[x].value*o.drugs[C].count,E.push(R)}var M={attr:E,precent:B.precent?B.precent*o.drugs[C].count:0,sort:B.sort};g+=UserBag.getAttrPower(M.attr)*SubRoles.ins().subRolesLen,f=this.addAttrs(f,M.attr),v=this.addAttrs(v,M.attr),M.precent&&(g+=Math.floor(r*M.precent/1e4),I&&(g+=Math.floor(r*M.precent/1e4)),_=AttributeData.getPercentAttr(h,M.precent/1e4),f=this.addAttrs(f,_),a&&(S=AttributeData.getPercentAttr(l,M.precent/1e4),v=this.addAttrs(v,S)));for(var T=0;T<SubRoles.ins().subRolesLen;T++){var b=SubRoles.ins().getSubRoleByIndex(T);g+=ItemConfig.relatePower(M.attr[C],b)}}for(var C=1;C<=GlobalConfig.ZhanLingConfig.equipPosCount;C++){var D=e.ins().getZhanLingDataByItem(t,C);c+=this.getZhanLingItemPower(D,1)}var A=this.getZhanLingDataByTalentId(t),k=this.getZhanLingDataByTalentLv(t),P=GlobalConfig.ZhanLingTalent[A][k];if(P){var L=P.expower;y+=(L?L:0)*SubRoles.ins().subRolesLen,P.attrs&&(y+=UserBag.getAttrPower(P.attrs)*SubRoles.ins().subRolesLen)}for(var G=GlobalConfig.ZhanLingBase[t],C=0;C<G.skill.length;C++){var U=GlobalConfig.ZhanLingSkill[G.skill[C].id];if(U.attrs){m+=UserBag.getAttrPower(U.attrs)*SubRoles.ins().subRolesLen;for(var T=0;T<SubRoles.ins().subRolesLen;T++)for(var b=SubRoles.ins().getSubRoleByIndex(T),F=0;F<U.attrs.length;F++)m+=ItemConfig.relatePower(U.attrs[F],b);U.expower&&(m+=U.expower)}}return i=r+c+u+g+y+m,h=this.addAttrs(h,p),h=this.addAttrs(h,f),a&&(l=this.addAttrs(l,d),l=this.addAttrs(l,v)),[i,h,l]},e.prototype.addAttrs=function(t,i,s){void 0===s&&(s=!0);var n=s?[]:t;if(s)for(var o=0;o<t.length;o++)-1!=e.showTypeList.indexOf(t[o].type)&&n.push(new AttributeData(t[o].type,t[o].value));for(var a=0;a<i.length;a++){var r=!1;if(-1!=e.showTypeList.indexOf(i[a].type)){for(var h=0;h<t.length;h++)if(t[h].type==i[a].type){n[h].value+=i[a].value,r=!0;break}r||n.push(new AttributeData(i[a].type,i[a].value))}}return n},e.prototype.getZhanLingItemPower=function(t,e){void 0===e&&(e=0);var i=0,s=GlobalConfig.ZhanLingEquip[t];if(!s)return i;var n=e?SubRoles.ins().subRolesLen:3;if(i+=UserBag.getAttrPower(s.attrs)*n,e)for(var o=0;n>o;o++)for(var a=SubRoles.ins().getSubRoleByIndex(o),r=0;r<s.attrs.length;r++)i+=ItemConfig.relatePower(s.attrs[r],a);return i},e.prototype.isUpGradeByStar=function(t){if(!this.getZhanLingDataById(t))return this.isUpGradeByTalent(t,!0);var i=e.ins().getZhanLingDataByLevel(t),s=GlobalConfig.ZhanLingLevel[t][i];if(!s||!s.exp)return!1;var n=e.ins().getZhanLingDataByExp(t),o=s.exp-n;o=o>0?o:0;var a=Math.ceil(o/GlobalConfig.ZhanLingConfig.stageitemexp),r=UserBag.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid),h=r?r.count:0;return h>=a},e.prototype.isHintNum=function(t){var i=e.ins().getZhanLingDataById(t);if(!i)return!1;var s=GlobalConfig.ZhanLingLevel[t][i.level];if(!s||!s.exp)return!1;var n=UserBag.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid),o=n?n.count:0;return o>=GlobalConfig.ZhanLingConfig.hintNum},e.prototype.isUpGradeByTalent=function(t,i){void 0===i&&(i=!1);var s=e.ins().getZhanLingDataById(t);if(!i&&!s)return!1;var n=GlobalConfig.ZhanLingBase[t];if(!n.mat)return!1;var o=UserBag.ins().getBagItemById(n.mat),a=o?o.count:0,r=this.getZhanLingDataByMat(t,i);return r?a>=r:!1},e.prototype.updateShowZLlist=function(){var t=[];for(var i in GlobalConfig.ZhanLingBase)GlobalConfig.ZhanLingBase[i].sort&&t.push(GlobalConfig.ZhanLingBase[i]);t.sort(function(t,e){return t.sort<e.sort?-1:1}),this.showZLlist=[];for(var s=0;s<t.length;s++)if(t[s].show){var n=e.ins().getZhanLingDataById(t[s].id);if(n)this.showZLlist.push(t[s]);else{var o=UserBag.ins().getBagItemById(t[s].mat);o&&o.count&&this.showZLlist.push(t[s])}}else this.showZLlist.push(t[s])},e.prototype.getZhanLingItemRedPoint=function(t){var e=this.getZhanLingDataById(t);if(!e)return!1;var i=UserBag.ins().getBagGoodsByType(ItemType.TYPE_21);i&&i.sort(function(t,e){var i=GlobalConfig.ZhanLingEquip[t.configID],s=GlobalConfig.ZhanLingEquip[e.configID];return i.level>s.level?-1:1});for(var s=0;s<e.items.length;s++){var n=s+1,o=e.items[s],a=void 0;o&&(a=GlobalConfig.ZhanLingEquip[o]);for(var r=0;r<i.length;r++){var h=i[r].configID,l=GlobalConfig.ItemConfig[h];if(l){var c=GlobalConfig.ZhanLingEquip[h];if(c&&n==c.pos){var u=l.level?l.level:0,p=l.zsLevel?l.zsLevel:0;if(UserZs.ins().lv>=p&&Actor.level>=u){if(a){if(c.level>a.level)return!0;break}return!0}}}}}return!1},e.prototype.getStageLv=function(t){var e=Math.floor(t/10),i=Math.floor(t%10);return i?e+=1:t&&t%10==0?i=10:e+=1,[e,i]},e}(BaseClass);ZhanLingModel.showTypeList=[AttributeType.atAttack,AttributeType.atMaxHp,AttributeType.atDef,AttributeType.atRes],__reflect(ZhanLingModel.prototype,"ZhanLingModel");var ZhanLingItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingEquipSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.id;if(this.equips=this.data.equips,this.bg.source=this.getPosImg(Number(this.name)),this.bg.visible=!0,this.equip.visible=!this.bg.visible,this.redPoint.visible=this.getRedPoint(),this.data.id){var e=GlobalConfig.ItemConfig[t];e&&(this.quality.source="quality"+ItemConfig.getQuality(e),this.equip.source=e.icon+"_png",this.bg.visible=!1,this.equip.visible=!this.bg.visible)}}},e.prototype.getRedPoint=function(){var t;this.data.id&&(t=GlobalConfig.ZhanLingEquip[this.data.id]);for(var e=0;e<this.equips.length;e++){var i=this.equips[e].configID,s=GlobalConfig.ItemConfig[i];if(s){var n=GlobalConfig.ZhanLingEquip[i];if(n&&Number(this.name)==n.pos){var o=s.level?s.level:0,a=s.zsLevel?s.zsLevel:0;if(UserZs.ins().lv>=a&&Actor.level>=o)return t?n.level>t.level?(this.bestId=n.id,!0):!1:(this.bestId=n.id,!0)}}}return!1},e.prototype.getPosImg=function(t){var e="zl_equip_bg_"+t;return e},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){return this.data?this.data.id||this.redPoint.visible?this.data.id&&!this.redPoint.visible?void ZhanLing.ins().ZhanLingItemTips(this.data.id,0,!0):isNaN(this.data.zlId)?void UserTips.ins().showTips("战灵id异常"):this.bestId?!this.data.id&&this.redPoint.visible?void ZhanLing.ins().sendZhanLingWear(this.data.zlId,this.bestId):void ZhanLing.ins().sendZhanLingWear(this.data.zlId,this.bestId):void UserTips.ins().showTips("穿戴装备异常"):void UserTips.ins().showTips("没有可穿戴的战灵装备"):void 0},e}(BaseItemRender);__reflect(ZhanLingItemRender.prototype,"ZhanLingItemRender");var ZhanLingItemTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanglingUpTipsSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.bgClose,this.otherClose),this.id=t[0],this.itemid=t[1];var i=GlobalConfig.ItemConfig[this.itemid];this.itemIcon.setData(i),this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(i.name);var s=ZhanLingModel.ins().getZhanLingDataByDrug(this.id,this.itemid),n=ZhanLingModel.ins().getZhanLingDataByLevel(this.id),o=GlobalConfig.ZhanLingLevel[this.id][n],a=o.maxCount[this.itemid],r=s>=a?65280:16711680;this.use.textFlow=TextFlowMaker.generateTextFlow1("|C:"+r+"&T:"+s+"|/"+a);var h=UserBag.ins().getBagItemById(this.itemid);this.num.text=h?""+h.count:"0";var l=ZhanLingModel.ins().getZhanLingDataByStage(this.id)+1;10*l>CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[this.id])?DisplayUtils.removeFromParent(this.info):this.num0.text=l+"阶1星";var c=GlobalConfig.ZhanLingConfig.upgradeInfo[this.itemid],u=AttributeData.getAttStr(c.attr,0,1,"+");c.precent&&(u+="\n战灵基础属性+"+c.precent/100+"%"),this.attr.text=u},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZhanLingItemTips.prototype,"ZhanLingItemTips"),ViewManager.ins().reg(ZhanLingItemTips,LayerManager.UI_Popup);var BitStorer=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),this._length=t,this._storer=[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){this._storer.length=t>>5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numDirtyBits",{get:function(){var t,e,i=this._length;for(e=0;i>e;e++)this._storer[e>>5]&1<<e%32&&t++;return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dirtyBits",{get:function(){var t,e=[];for(t=this._length-1;t>-1;t--)this._storer[t>>5]&1<<t%32&&(e[e.length]=t);return e},enumerable:!0,configurable:!0}),t.prototype.store=function(t){var e,i,s;for(s=this._length>>3,s>t.bytesAvailable&&(s=t.bytesAvailable),e=0;s>e;e++)e&&e%4==0&&(this._storer[(e>>2)-1]=i,i=0),i|=(255&t.readByte())<<(e%4<<3);s%4&&(this._storer[s>>2]=i)},t.prototype.toByteArray=function(t,e){void 0===t&&(t=null),void 0===e&&(e=0),t||(t=new egret.ByteArray),t.position=e;for(var i,s=this._storer.length,n=0;s>n;n++){i=this._storer[n];for(var o=0;32>o;o+=8)t.writeByte(i>>o&255)}return t},t.prototype.setBit=function(t,e){1&e?this._storer[t>>5]|=1<<t%32:this._storer[t>>5]&=~(1<<t%32)},t.prototype.getBit=function(t){return this._storer[t%this._length>>5]>>t%32&1},t}();__reflect(BitStorer.prototype,"BitStorer");var ZhanLingPanelEx=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.openView(t)},e}(ZhanLingPanel);__reflect(ZhanLingPanelEx.prototype,"ZhanLingPanelEx"),ViewManager.ins().reg(ZhanLingPanelEx,LayerManager.UI_Main);var ZhanLingSkinItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingZBItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.id,e=GlobalConfig.ZhanLingBase[t];if(e){var i=ZhanLingModel.ins().getZhanLingDataByLevel(t);this.icon.source=e.icon,this.state.visible=ZhanLingModel.ins().getZhanLingDataById(t)?!1:!0,this.select.visible=!1,this.label.text=i+"",this.label.visible=!this.state.visible;var s=ZhanLingModel.ins().isUpGradeByStar(t)||ZhanLingModel.ins().isHintNum(t);s||(s=ZhanLingModel.ins().isUpGradeByTalent(t)),this.redPoint.visible=s}}},e.prototype.destruct=function(){},e.prototype.setSelect=function(t){this.select.visible=t},e}(BaseItemRender);__reflect(ZhanLingSkinItem.prototype,"ZhanLingSkinItem");var ZhanLingSuitTip=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingSuitTipsSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.bgClose,this.otherClose),this.id=t[0];var i=ZhanLingModel.ins().getZhanLingDataBySuit(this.id),s=CommonUtils.getObjectLength(GlobalConfig.ZhanLingSuit),n=GlobalConfig.ZhanLingConfig.equipPosCount,o=0;i?(o=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,i),i>=s&&o>=n?this.currentState="max":this.currentState="active"):(this.currentState="unactive",i=1),this.validateNow();var a=GlobalConfig.ZhanLingSuit[i],r=StringUtils.replace(a.suitCondition,""+o,""+n);"unactive"==this.currentState&&(this.content0.textFlow=TextFlowMaker.generateTextFlow1(r));var h=AttributeData.getAttStr(a.attrs,0,1,"+");if(h+="\n战灵基础属性+"+a.precent/100+"%",this.attr0.text=h,this.name0.text=a.suitTname,"active"==this.currentState){var l=GlobalConfig.ZhanLingSuit[i+1];o=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,i+1),r=StringUtils.replace(l.suitCondition,""+o,""+n),this.content1.textFlow=TextFlowMaker.generateTextFlow1(r);var c=AttributeData.getAttStr(l.attrs,0,1,"+");c+="\n战灵基础属性+"+l.precent/100+"%",this.attr1.text=c,this.name1.text=l.suitTname}},e}(BaseEuiView);__reflect(ZhanLingSuitTip.prototype,"ZhanLingSuitTip"),ViewManager.ins().reg(ZhanLingSuitTip,LayerManager.UI_Popup);var ZhanLingTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingSkillTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.bgClose,this.otherClose),this.id=t[0]||0,this.skillid=t[1];var i={name:"",desc:"",lock:""},s={name:"",desc:"",lock:""},n="";if(this.skillid){n="unactive";for(var o=ZhanLingModel.ins().getZhanLingDataById(this.id),a=(ZhanLingModel.ins().getZhanLingDataBySkill(this.id),GlobalConfig.ZhanLingBase[this.id]),r=ZhanLingModel.ins().getZhanLingDataByLevel(this.id),h=0;h<a.skill.length;h++)if(a.skill[h].id==this.skillid){var l=GlobalConfig.ZhanLingSkill[a.skill[h].id],c=GlobalConfig.SkillsConfig[l.passive],u=c?c.desc:0,p=GlobalConfig.SkillsDescConfig[u];if(!o||r<a.skill[h].open){var d=Math.floor(a.skill[h].open/10),g=Math.floor(a.skill[h].open%10);g?d+=1:a.skill[h].open&&a.skill[h].open%10==0?g=10:d+=1,p&&(i.name=p.name,i.desc=p.desc),i.lock=d+"阶"+g+"星"}else n="max",p&&(i.name=p.name,i.desc=p.desc);c&&p&&i.desc&&(i.desc=StringUtils.replace(i.desc,""+c.desc_ex[0])),l.desc&&l.desc.name&&(i.name=l.desc.name),l.desc&&l.desc.desc&&(i.desc=l.desc.desc),l.attrs&&(i.desc&&(i.desc+="\n"),i.desc+="|C:0xff00ff&T:"+AttributeData.getAttStr(l.attrs,0,1,"：")+"|");break}}else{var f=ZhanLingModel.ins().getZhanLingDataByTalentId(this.id),v=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.id),y=CommonUtils.getObjectLength(GlobalConfig.ZhanLingTalent[this.id]),m=GlobalConfig.ZhanLingTalent[f][v];if(m)if(v>=y)n="max";else{n="active";var T=GlobalConfig.ZhanLingBase[this.id],b=GlobalConfig.ItemConfig[T.mat],C=GlobalConfig.ZhanLingTalent[f][v+1];if(C.talentDesc)if(s.name=C.talentDesc.name,s.desc=StringUtils.replace(C.talentDesc.desc,""+C.rate/100),C.costCount)s.lock="|C:0xFFFFCC&T:升级条件:|C:0xff0000&T:"+b.name+"皮肤*"+C.costCount,DisplayUtils.removeFromParent(this.lock1);else{var I=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);I&&(s.lock=I[0]+"阶"+I[1]+"星")}else{var w=C.passive[0].id,_=GlobalConfig.SkillsConfig[w],u=_.desc,p=GlobalConfig.SkillsDescConfig[u];if(s.name=p.name,s.desc=StringUtils.replace(p.desc,""+_.desc_ex[0]),C.costCount)s.lock="|C:0xFFFFCC&T:升级条件:|C:0xff0000&T:"+b.name+"皮肤*"+C.costCount,DisplayUtils.removeFromParent(this.lock1);else{var I=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);I&&(s.lock=I[0]+"阶"+I[1]+"星")}}}else if(n="unactive",m=GlobalConfig.ZhanLingTalent[f][1],m.costCount)i.lock="激活皮肤后";else{var I=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);I&&(i.lock=I[0]+"阶"+I[1]+"星")}if(m.talentDesc)i.name=m.talentDesc.name,i.desc=StringUtils.replace(m.talentDesc.desc,""+m.rate/100);else{var w=m.passive[0].id,u=GlobalConfig.SkillsConfig[w].desc,p=GlobalConfig.SkillsDescConfig[u];i.name=p.name,i.desc=p.desc,i.desc=StringUtils.replace(i.desc,""+GlobalConfig.SkillsConfig[w].desc_ex[0])}}this.currentState=n,this.validateNow(),this.skillName0.textFlow=TextFlowMaker.generateTextFlow1(i.name),this.skillDesc0.textFlow=TextFlowMaker.generateTextFlow1(i.desc),i.lock?this.condition0.textFlow=TextFlowMaker.generateTextFlow1(i.lock):DisplayUtils.removeFromParent(this.condition0.parent),s.name&&("active"==n?(this.skillName1.textFlow=TextFlowMaker.generateTextFlow1(s.name),this.skillDesc1.textFlow=TextFlowMaker.generateTextFlow1(s.desc),s.lock?this.condition1.textFlow=TextFlowMaker.generateTextFlow1(s.lock):DisplayUtils.removeFromParent(this.condition1.parent)):DisplayUtils.removeFromParent(this.nextGroup))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZhanLingTips.prototype,"ZhanLingTips"),ViewManager.ins().reg(ZhanLingTips,LayerManager.UI_Popup);var ZhanlingZBTipItemsRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingZBTipItemsSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChanged=function(){if(this.data){var t=this.data.zlId,e=this.data.id,i=GlobalConfig.ZhanLingSkill[e];i.desc&&i.desc.icon?this.skillIcon1.source=i.desc.icon:this.skillIcon1.source=1e3*Math.floor(i.passive/1e3)+"_png";for(var s=GlobalConfig.ZhanLingBase[t],n=0,o=0;o<s.skill.length;o++)if(s.skill[o].id==e){n=s.skill[o].open;break}var a=GlobalConfig.SkillsConfig[i.passive],r=a?a.desc:0,h=GlobalConfig.SkillsDescConfig[r],l={name:"",desc:""};h&&(l.name=h.name,l.desc=h.desc),a&&h&&l.desc&&(l.desc=StringUtils.replace(l.desc,""+a.desc_ex[0])),i.desc&&i.desc.name&&(l.name=i.desc.name),i.desc&&i.desc.desc&&(l.desc=i.desc.desc),i.attrs&&(l.desc&&(l.desc+="\n"),l.desc+="|C:0xff00ff&T:"+AttributeData.getAttStr(i.attrs,0,1,"：")+"|");var c=ZhanLingModel.ins().getStageLv(n);this.desc.textFlow=TextFlowMaker.generateTextFlow1(c[0]+"阶习得技能|C:0xff00ff&T:【"+l.name+"】\n"+l.desc)}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){},e}(BaseItemRender);__reflect(ZhanlingZBTipItemsRender.prototype,"ZhanlingZBTipItemsRender");var ZhanlingZBTipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingZBTipsSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.gainList.itemRenderer=GainGoodsItem,this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.skillList.itemRenderer=ZhanlingZBTipItemsRender,this.itemid=t[0];for(var i in GlobalConfig.ZhanLingBase){var s=GlobalConfig.ZhanLingBase[i];if(s.mat==this.itemid){this.zlId=s.id;break}}var n=GlobalConfig.ZhanLingLevel[this.zlId][0];this.zhanlingName.source=n.zlName,this.model||(this.model=new MovieClip),this.model.parent||this.zhanling.addChild(this.model),this.model.name!=RES_DIR_EFF+n.innerAppearance&&this.model.playFile(RES_DIR_EFF+n.innerAppearance,-1),this.bottomMc||(this.bottomMc=new MovieClip),this.bottomMc.parent||this.bottomD.addChild(this.bottomMc),this.bottomMc.isPlaying||this.bottomMc.playFile(RES_DIR_EFF+"zhanlingbottom",-1);var o=GlobalConfig.ItemConfig[this.itemid];this.itemname.textFlow=TextFlowMaker.generateTextFlow1("|C:"+ItemConfig.getQualityColor(o)+"&T:"+o.name);var a=ItemConfig.getQuality(o);this.quali.source=a>0?"quali"+a:"";var r=GlobalConfig.ZhanLingBase[this.zlId],h=GlobalConfig.ZhanLingTalent[r.talent][1];h||(h=GlobalConfig.ZhanLingTalent[r.talent][1]);var l="激活后获得强力天赋:";if(h.talentDesc&&h.talentDesc.icon)this.skillIcon0.source=h.talentDesc.icon,h.talentDesc.desc&&(l+=h.talentDesc.desc);else{h.passive&&(this.skillIcon0.source=1e3*Math.floor(h.passive[0].id/1e3)+"_png");var c=GlobalConfig.SkillsConfig[h.passive[0].id],u=GlobalConfig.SkillsDescConfig[c.desc];l+=StringUtils.replace(u.desc,c.desc_ex)}this.desc.textFlow=TextFlowMaker.generateTextFlow1(l);for(var p=3,d=GlobalConfig.ZhanLingLevel[this.zlId][0],g=UserBag.getAttrPower(d.attrs)*p,f=(h.expower+UserBag.getAttrPower(h.attrs?h.attrs:[]))*p,v=0,y=[],m=0;m<r.skill.length;m++){var T=r.skill[m].id,b=GlobalConfig.ZhanLingSkill[T];b.attrs&&(v+=UserBag.getAttrPower(b.attrs)*p,y.push({id:T,zlId:r.id}))}this.skillList.dataProvider=new ArrayCollection(y),g=g+f+v,this.powerPanel.setPower(g);var C=GlobalConfig.GainItemConfig[this.itemid];C&&(this.gainList.dataProvider=new eui.ArrayCollection(C.gainWay))},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.onTouchList=function(t){var e=t.item;null!=t.item&&e[1]&&ViewManager.ins().open(e[1],e[2])},e}(BaseEuiView);__reflect(ZhanlingZBTipWin.prototype,"ZhanlingZBTipWin"),ViewManager.ins().reg(ZhanlingZBTipWin,LayerManager.UI_Popup);var ZhanLing=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.WarSpirit,e.regNetMsg(1,e.postZhanLingInfo),e.regNetMsg(2,e.postZhanLingUpExp),e.regNetMsg(3,e.postZhanLingDrug),e.regNetMsg(4,e.postZhanLingWear),e.regNetMsg(6,e.postZhanLingComposeItem),e.regNetMsg(7,e.postZhanLingBubble),e.regNetMsg(8,e.doZhanLingSkill),e.regNetMsg(11,e.postZhanLingSkinUpGrade),e.regNetMsg(12,e.postZhangLingSkinChange),e.observe(UserZs.ins().postZsLv,e.initZhanLing),e.observe(UserBag.ins().postItemAdd,ZhanLingModel.ins().updateShowZLlist),e.observe(UserBag.ins().postItemDel,ZhanLingModel.ins().updateShowZLlist),e.observe(UserBag.ins().postItemCountChange,ZhanLingModel.ins().updateShowZLlist),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){ZhanLingModel.ins().updateShowZLlist()},e.prototype.initZero=function(){!ZhanLingModel.ins().getZhanLingDataById(0)&&ZhanLingModel.ins().ZhanLingOpen()&&ZhanLingModel.ins().setZhanLingData(new ZhanLingData)},e.prototype.initZhanLing=function(){!ZhanLingModel.ins().getZhanLingDataById(0)&&ZhanLingModel.ins().ZhanLingOpen()&&ZhanLingModel.ins().setZhanLingData(new ZhanLingData)},e.prototype.checkRedPoint=function(){if(!ZhanLingModel.ins().ZhanLingOpen())return!1;var t=0,e=ZhanLingModel.ins().isUpGradeByStar(t)||ZhanLingModel.ins().isHintNum(t);if(e)return!0;if(e=ZhanLingModel.ins().isUpGradeByTalent(t))return!0;var i=GlobalConfig.ZhanLingConfig;for(var s in i.upgradeInfo)if(e=ZhanLingModel.ins().getZhanLingDataByDrugUse(t,Number(s)))return!0;for(var n=0;n<ZhanLingModel.ins().showZLlist.length;n++){var o=ZhanLingModel.ins().showZLlist[n];if(t=o.id){if(e=ZhanLingModel.ins().isUpGradeByStar(t)||ZhanLingModel.ins().isHintNum(t))return!0;if(e=ZhanLingModel.ins().isUpGradeByTalent(t))return!0}}return t=0,e=ZhanLingModel.ins().getZhanLingItemRedPoint(t),e?!0:!1},e.prototype.ZhanLingItemTips=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1);var s=t,n=GlobalConfig.ItemConfig[s],o=i?1:0,a=ZhanLingModel.ins().getZhanLingItemPower(s,o),r=a,h=n.level?n.level+"级":"无级别",l=GlobalConfig.ZhanLingEquip[s],c={left:"部位:\n等级:",right:GlobalConfig.ZhanLingConfig.zlEquipName[l.pos-1]+"\n"+h},u=[];u.push({title:"基础属性:",attr:l.attrs});var p="",d="",g=GlobalConfig.ZhanLingEquip[s].level;g=g?g:1;for(var f=GlobalConfig.ZhanLingSuit[g],v=65280,y=ZhanLingModel.ins().getZhanLingDataById(e),m="",T=16711935,b=16711935,C=0,I="",w=0;w<GlobalConfig.ZhanLingConfig.equipPosCount;w++){var _=65280,S=y?GlobalConfig.ZhanLingEquip[y.items[w]]:null;!y||!y.items[w]||!S||S.level<g?(_=v=16711680,T=b=6710886):C++,i||w+1==GlobalConfig.ZhanLingEquip[s].pos&&(_=65280);var B="|C:"+_+"&T:"+GlobalConfig.ZhanLingConfig.zlEquipName[w];w+1<GlobalConfig.ZhanLingConfig.equipPosCount&&(B+="|C:"+_+"&T:、"),I+=B}i||(C=1),d="战灵基础属性增加+"+f.precent/100+"%",m="|C:"+v+"&T:("+C+"/"+GlobalConfig.ZhanLingConfig.equipPosCount+")",p=I,u.push({title:"|C:0xff00ff&T:"+f.suitWithName+"|"+m,attr:f.attrs,colorName:T,colorValue:b,others:{suitdesc:p,exdesc:d}}),ViewManager.ins().open(EquipTipsBase,UserBag.BAG_TYPE_OTHTER,s,r,a,c,u)},e.prototype.sendZhanLingUpExp=function(t,e){void 0===e&&(e=0);var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendZhanLingDrug=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendZhanLingWear=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendZhanLingComposeItem=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.sendZhanLingSkinUpGrade=function(t){var e=this.getBytes(11);e.writeByte(t),this.sendToServer(e)},e.prototype.sendZhangLingSkinChange=function(t){var e=this.getBytes(12);e.writeByte(t),this.sendToServer(e)},e.prototype.postZhanLingInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var s=new ZhanLingData;s.id=t.readInt(),s.talentLv=t.readByte(),s.level=t.readShort(),s.exp=t.readInt(),s.drugs=[];for(var n=t.readByte(),o=0;n>o;o++){var a=t.readInt(),r=t.readShort();s.drugs.push({itemId:a,count:r})}var h=t.readByte();if(h){s.items=[];for(var l=0;h>l;l++)s.items.push(t.readInt())}ZhanLingModel.ins().setZhanLingData(s)}var c=t.readByte();ZhanLingModel.ins().ZhanLingSkinId=c},e.prototype.postZhanLingUpExp=function(t){var e=t.readByte(),i=t.readShort(),s=t.readInt(),n=ZhanLingModel.ins().getZhanLingDataById(e);if(n){var o=n.level;n.level=i,n.exp=s,i>o&&this.postZhanLingUpgrade()}},e.prototype.postZhanLingUpgrade=function(){},e.prototype.postZhanLingDrug=function(t){var e=t.readByte(),i=t.readInt(),s=t.readShort(),n=ZhanLingModel.ins().getZhanLingDataById(e);if(n){for(var o=!1,a=0;a<n.drugs.length;a++)if(n.drugs[a].itemId==i){n.drugs[a].count=s,o=!0;break}o||n.drugs.push({itemId:i,count:s})}},e.prototype.postZhanLingWear=function(t){var e=t.readByte(),i=t.readInt(),s=ZhanLingModel.ins().getZhanLingDataById(e);if(s){var n=GlobalConfig.ZhanLingEquip[i];n&&(s.items[n.pos-1]=i)}},e.prototype.postZhanLingComposeItem=function(t){var e=t.readByte(),i=t.readByte(),s=ZhanLingModel.ins().getZhanLingDataById(e);if(s)for(var n=0;i>n;n++)s.items[n]=t.readInt()},e.prototype.postZhanLingBubble=function(t){var e=t.readDouble(),i=t.readInt(),s=t.readByte(),n=EntityManager.ins().getEntityByHandle(e);n&&n.showZhanling(s,i)},e.prototype.doZhanLingSkill=function(t){var e=0,i=ZhanLingModel.ins().getZhanLingDataById(e),s=GlobalConfig.ZhanLingLevel[e][i.level].talentLevel,n=GlobalConfig.ZhanLingTalent[e][s];UserSkill.ins().postShowSkillWord(n.showWords)},e.prototype.postZhanLingSkinUpGrade=function(t){var e=t.readByte(),i=t.readShort(),s=ZhanLingModel.ins().getZhanLingDataById(e),n=0;s?n=s.talentLv:(s=new ZhanLingData,s.id=e,ZhanLingModel.ins().setZhanLingData(s)),i!=n&&this.postZhanLingTalentLvUpGrade(),s.talentLv=i},e.prototype.postZhanLingTalentLvUpGrade=function(){},e.prototype.postZhangLingSkinChange=function(t){var e=t.readByte();ZhanLingModel.ins().ZhanLingSkinId=e},e}(BaseSystem);__reflect(ZhanLing.prototype,"ZhanLing");var GameSystem;!function(t){t.zhanling=ZhanLing.ins.bind(ZhanLing)}(GameSystem||(GameSystem={}));var ZhuzaiEquipDecomWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZhuzaiEquipDecomSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onClick),this.removeTouchEvent(this.closeBtn0,this.onClick)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ZhuzaiEquipDecomWin.prototype,"ZhuzaiEquipDecomWin"),ViewManager.ins().reg(ZhuzaiEquipDecomWin,LayerManager.UI_Main);var ZhuZaiEquipWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZhuzaiEquipSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick),this.selectRole=t[1],this.select=t[2],this.tab.selectedIndex=t?t[0]:0,this.viewStack.selectedIndex=this.tab.selectedIndex,this.onTabChange(),this.addChangeEvent(this.tab,this.onTabChange),this.observe(ZhuzaiEquip.ins().postZhuZaiData,this.updateRedPoint),this.observe(ZhuzaiEquip.ins().postShengjie,this.playEff),this.updateRedPoint()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onClick),this.removeTouchEvent(this.closeBtn0,this.onClick),this.growPanel.close(),this.advancePanel.close(),this.fenjiePanel.close(),this.removeObserve()},e.prototype.onTabChange=function(t){this.viewStack.selectedChild.open(this.selectRole,this.select)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.updateRedPoint=function(){var t=ZhuzaiEquip.ins();this.redPoint0.visible=t.canAllLevelup(),this.redPoint1.visible=t.canAllAdvance(),this.redPoint2.visible=!1},e.prototype.playEff=function(t){var e=ObjectPool.pop("MovieClip");e.scaleX=e.scaleY=1,e.rotation=0,e.x=250,e.y=330,e.playFile(RES_DIR_EFF+(t?"successeff":"faileff"),1,function(){ObjectPool.push(e)}),this.addChild(e)},e}(BaseEuiView);__reflect(ZhuZaiEquipWin.prototype,"ZhuZaiEquipWin"),ViewManager.ins().reg(ZhuZaiEquipWin,LayerManager.UI_Main);var ZhuZaiData=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.rank=t.readShort(),this.growupID=t.readInt()},Object.defineProperty(t.prototype,"lv",{get:function(){return this.rank*GlobalConfig.EquipPointConstConfig.rankGrowUp+this.growupID},enumerable:!0,configurable:!0}),t.prototype.isMaxLevel=function(){var t=GlobalConfig.EquipPointGrowUpConfig[this.id][this.lv+1];
return t?!1:!0},t.prototype.canLevelup=function(){var t=GlobalConfig.EquipPointGrowUpConfig[this.id][this.lv],e=t.growUpItem.id,i=t.needLevel/1e3>>0,s=t.needLevel%1e3;return this.isMaxLevel()||i&&UserZs.ins().lv<i||Actor.level<s?!1:UserBag.ins().getBagGoodsCountById(0,e)<t.growUpItem.count?!1:!0},t.prototype.canAdvance=function(){var t=GlobalConfig.EquipPointRankConfig[this.id][this.rank];if(!this.lv||!t)return!1;var e=t.rankUpItem.id;return UserBag.ins().getBagGoodsCountById(0,e)<t.rankUpItem.count?!1:!0},t}();__reflect(ZhuZaiData.prototype,"ZhuZaiData");var ZhuzaiEquip=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.ZhuZaiEquip,e.regNetMsg(1,e.postZhuZaiData),e.regNetMsg(3,e.postShengjie),e.regNetMsg(4,e.postShengjie),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postZhuZaiData=function(t){for(var e,i=t.readShort(),s=0;i>s;s++){e=t.readByte();for(var n=t.readShort(),o=0;n>o;o++){var a=new ZhuZaiData;a.parser(t),SubRoles.ins().getSubRoleByIndex(e).setZhuZaiData(a.id-1,a)}}},e.prototype.sendShengjie=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postShengjie=function(t){return t.readBoolean()},e.prototype.sendGrow=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendFenjie=function(){this.sendBaseProto(5)},e.prototype.canFengjie=function(){return!1},e.prototype.canAllLevelup=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.canLevelup(e))return!0;return!1},e.prototype.canLevelup=function(t){var e=GlobalConfig.EquipPointBasicConfig,i=!1;for(var s in e){var n=SubRoles.ins().getSubRoleByIndex(t),o=n.getZhuZaiDataByIndex(parseInt(s)-1);if(i=o&&o.canLevelup())return!0}return!1},e.prototype.canAllAdvance=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.canAdvance(e))return!0;return!1},e.prototype.canAdvance=function(t){var e=GlobalConfig.EquipPointBasicConfig,i=!1;for(var s in e){var n=SubRoles.ins().getSubRoleByIndex(t),o=n.getZhuZaiDataByIndex(parseInt(s)-1);if(i=o&&o.canAdvance())return!0}return!1},e}(BaseSystem);__reflect(ZhuzaiEquip.prototype,"ZhuzaiEquip");var GameSystem;!function(t){t.zhuzaiEquip=ZhuzaiEquip.ins.bind(ZhuzaiEquip)}(GameSystem||(GameSystem={}));var MijiData=function(){function t(){}return t}();__reflect(MijiData.prototype,"MijiData");var UserMiji=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Miji,e.regNetMsg(1,e.postMijiData),e.regNetMsg(2,e.postMijiUpDate),e.regNetMsg(3,e.postMijiChange),e.regNetMsg(6,e.postMijiLockInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postMijiData=function(t){this.grid=t.readShort();var e=SubRoles.ins().subRolesLen;this.miji=[];for(var i=0;e>i;i++){this.miji[i]=[];for(var s=0;s<this.grid;s++){var n=new MijiData;n.id=t.readInt(),n.isLocked=t.readInt(),this.miji[i][s]=n}}},e.prototype.sendMijiLearn=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postMijiUpDate=function(t){var e=t.readShort(),i=t.readShort()-1,s=t.readInt(),n=t.readByte(),o=this.miji[e][i].id;return this.miji[e][i].id=s,[i,s,o,n]},e.prototype.sendMijiChange=function(t,e,i){var s=this.getBytes(3);s.writeInt(t),s.writeInt(e),s.writeInt(i),this.sendToServer(s)},e.prototype.sendMijiwancheng=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.sendMijiAddLock=function(t,e){var i=this.getBytes(5);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendMijiDelLock=function(t,e){var i=this.getBytes(6);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getSkillListOfRole=function(t){return this.miji&&this.miji[t]?this.miji[t]:null},e.prototype.getMijiData=function(t,e){var i=this.getSkillListOfRole(t);return i&&i[e]?i[e].id:null},e.prototype.hasSpecificSkillOfRole=function(t,e){var i=!1,s=this.getSkillListOfRole(t);if(null!=s){for(var n=!1,o=0;o<s.length;o++)s[o].id==e&&(n=!0);n&&(i=!0)}return i},e.prototype.mijiIsLock=function(t,e){var i=!1,s=this.getSkillListOfRole(t);if(null!=s){for(var n=!1,o=0;o<s.length;o++)Math.floor(s[o].id/10)==Math.floor(e/10)&&s[o].isLocked&&(n=!0);n&&(i=!0)}return i},e.prototype.hasNewSkillOfRole=function(t){var e=!1,i=this.getSkillListOfRole(t);return null!=i&&i.every(function(t){return t.id>0?(e=!0,!1):!0}),e},e.prototype.postMijiChange=function(t){var e=t.readInt();return e},e.prototype.postMijiLockInfo=function(t){for(var e=this.miji[t.readInt()],i=t.readInt(),s=0;s<e.length;s++)if(e[s].id==i){var n=t.readInt();e[s].isLocked=n;break}},e.prototype.getPowerByRole=function(t){for(var e=0,i=this.miji[t],s=0;s<i.length;s++)i[s].id&&(e+=GlobalConfig.MiJiSkillConfig[i[s].id].power);return e},e.prototype.postSelectedMiji=function(t,e){return[t,e]},e.prototype.postBagUseMiji=function(t){return t},e.prototype.hasEquipMiji=function(t,e){void 0===e&&(e=0);var i=this.miji[e];if(!i)return!1;for(var s=0;s<i.length;s++)if(i[s]&&0!=i[s].id){var n=GlobalConfig.MiJiSkillConfig[i[s].id];if(n.item==t)return!0}return!1},e.prototype.isMjiSum=function(){if(UserZs.ins().lv<e.ZsLv)return!1;if(!this.miji)return!1;var t=UserBag.ins().getBagGoodsByType(2),i=t.length>0?!0:!1;if(!i)return!1;var s=Setting.ins().getValue(ClientSet.mijiRedPoint);if(s)return!1;for(var n=SubRoles.ins().subRolesLen,o=0;n>o;o++)for(var a=this.miji[o],r=0;r<a.length;r++)if(a[r].id)for(var h=GlobalConfig.MiJiSkillConfig[a[r].id],l=0;l<t.length;l++)if(h.item==t[l]._configID)return Setting.ins().setValue(ClientSet.mijiRedPoint,1),!1;return!0},e}(BaseSystem);UserMiji.ZsLv=1,UserMiji.BAGOPEN=5,__reflect(UserMiji.prototype,"UserMiji");var GameSystem;!function(t){t.userMiji=UserMiji.ins.bind(UserMiji)}(GameSystem||(GameSystem={}));var UserZs=function(t){function e(){var e=t.call(this)||this;return e.isSendXW=[],e.sysId=PackageID.Zs,e.regNetMsg(1,e.postZsData),e.exchange=!1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postZsData=function(t){this.lv=t.readInt();var e=this.exp;this.exp=t.readInt(),this.upgradeCount=[t.readShort(),t.readShort(),t.readShort()],e&&Actor.ins().postZsExpChange(this.exp-e),this.postZsLv()},e.prototype.postZsLv=function(){},e.prototype.sendGetXiuWei=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendZsUpgrade=function(){this.sendBaseProto(2)},e.prototype.canUpgrade=function(){var t=GlobalConfig.ZhuanShengLevelConfig[this.lv+1];return t?this.exp>=t.exp:!1},e.prototype.isMaxLv=function(){return GlobalConfig.ZhuanShengLevelConfig[this.lv+1]?!1:!0},e.prototype.canGet=function(){var t=0;if(!this.upgradeCount)return t;for(var i=GlobalConfig.ZhuanShengConfig,s=[i.conversionCount,i.normalCount,i.advanceCount],n=[0,i.normalItem,i.advanceItem],o=0;o<s.length;o++)s[o]-this.upgradeCount[o]&&(!n[o]&&Actor.level>80||UserBag.ins().getBagGoodsCountById(0,n[o]))&&(0==o?e.ins().exchange||(t|=1<<o):t|=1<<o);return t},e.prototype.canOpenZSWin=function(){var t=Actor.level,e=null!=this.lv?this.lv:0;return 0>=e&&80>t?!1:!0},e}(BaseSystem);__reflect(UserZs.prototype,"UserZs");var GameSystem;!function(t){t.userZs=UserZs.ins.bind(UserZs)}(GameSystem||(GameSystem={}));var GainZsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GainZsSkin",this.infoTxts=[this.infoTxt0,this.infoTxt1,this.infoTxt2],this.toDays=[this.toDay0,this.toDay1,this.toDay2],this.items=[this.item0,this.item1,this.item2],this.btns=[this.btn0,this.btn1,this.btn2];for(var e=0;e<this.items.length;e++)this.items[e].isShowName(!1);this.priceIcon1.setType(MoneyConst.yuanbao),this.priceIcon2.setType(MoneyConst.yuanbao);var i=new RewardData;i.type=0,i.id=0,i.count=0,this.items[0].data=i,this.isTopLevel=!0,this.tipsExp=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(UserZs.ins().postZsData,this.setData),this.observe(Actor.ins().postLevelChange,this.setData),this.observe(Shop.ins().postBuyResult,this.setData),this.observe(Shop.ins().postBuyCount,this.setData),this.setData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),this.removeObserve()},e.prototype.setData=function(){var t,e=GlobalConfig.ZhuanShengConfig,i=e.level+1,s=Math.max(Actor.level,i),n=(GlobalConfig.ZhuanShengLevelConfig[s],GlobalConfig.ZhuanShengExpConfig[s]),o=UserZs.ins();this.toDays[0].textColor=Actor.level<i?15937822:11050120,this.infoTxts[0].textFlow=(new egret.HtmlTextParser).parser('增加<font color="#9de242">'+n.exp+"</font>修为\n\n等级兑换：降1级"),t=e.conversionCount-o.upgradeCount[0],this.toDays[0].textFlow=(new egret.HtmlTextParser).parser(Actor.level<=80?"大于"+(i-1)+"级才能兑换":'今天还可兑换<font color="#9de242">'+t+"</font>次"),this.btns[0].enabled=t>0;var a=e.normalItem,r=GlobalConfig.ItemConfig[a],h=UserBag.ins().getBagGoodsCountById(0,a),l=ItemStoreConfig.getStoreByItemID(a);this.items[1].data=a,this.btns[1].label=h?"立即使用":"购买",this.btns[1].name=e.normalExp+"",this.priceIcon1.visible=0==h,this.priceIcon1.setPrice(l.price),this.priceIcon1.name=r.name,this.infoTxts[1].textFlow=(new egret.HtmlTextParser).parser('增加<font color="#9de242">'+e.normalExp+"</font>修为\n\n"+r.name+"："+(h?"剩余"+h+"个":"")),t=e.normalCount-o.upgradeCount[1],this.toDays[1].textFlow=(new egret.HtmlTextParser).parser('今天还可兑换<font color="#9de242">'+t+"</font>次"),this.btns[1].enabled=t>0,l.viplv&&UserVip.ins().lv<l.viplv?(this.vipLb1.visible=!0,this.vipLb1.text="VIP"+l.viplv+"可购买"):this.vipLb1.visible=!1,a=e.advanceItem,r=GlobalConfig.ItemConfig[a],h=UserBag.ins().getBagGoodsCountById(0,a),l=ItemStoreConfig.getStoreByItemID(a),this.items[2].data=a,this.btns[2].label=h?"立即使用":"购买",this.btns[2].name=e.advanceExp+"",this.priceIcon2.visible=0==h,this.priceIcon2.setPrice(ItemStoreConfig.getStoreByItemID(a).price),this.priceIcon2.name=r.name,this.infoTxts[2].textFlow=(new egret.HtmlTextParser).parser('增加<font color="#cb5ac4">'+e.advanceExp+"</font>修为\n\n"+r.name+"："+(h?"剩余"+h+"个":"")),t=e.advanceCount-o.upgradeCount[2],this.toDays[2].textFlow=(new egret.HtmlTextParser).parser('今天还可兑换<font color="#9de242">'+t+"</font>次"),this.btns[2].enabled=t>0,l.viplv&&UserVip.ins().lv<l.viplv?(this.vipLb2.visible=!0,this.vipLb2.text="VIP"+l.viplv+"可购买"):this.vipLb2.visible=!1;for(var c=o.canGet(),u=0;3>u;u++)this["redPoint"+u].visible=c>>u&1,this["redPointRule"+u]&&this["redPointRule"+u]();s=Math.max(Actor.level+1,i),n=GlobalConfig.ZhuanShengExpConfig[s],UserZs.ins().isSendXW[0]?UserZs.ins().isSendXW[0]=!1:UserZs.ins().isSendXW[1]?UserZs.ins().isSendXW[1]=!1:UserZs.ins().isSendXW[2]&&(UserZs.ins().isSendXW[2]=!1)},e.prototype.redPointRule0=function(){UserZs.ins().exchange||(UserZs.ins().exchange=!0)},e.prototype.onTap=function(t){switch(t.target){case this.colorCanvas:case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:var e=this.btns.indexOf(t.target);if(e>-1)if(0==e)UserZs.ins().isSendXW[e]=!0,UserZs.ins().sendGetXiuWei(e+1);else if("立即使用"==this.btns[e].label)UserZs.ins().isSendXW[e]=!0,UserZs.ins().sendGetXiuWei(e+1);else{var i=this["priceIcon"+e].getPrice();if(Actor.yb<i)return UserTips.ins().showTips("元宝不足"),void ViewManager.ins().close(this);if(1==e){var s=GlobalConfig.ItemStoreConfig;for(var n in s)if(200009==s[n].itemId)return void this.buyGoodsId(s[n].id)}else if(2==e){var s=GlobalConfig.ItemStoreConfig;for(var n in s)if(200010==s[n].itemId)return void this.buyGoodsId(s[n].id)}}}},e.prototype.buyGoodsId=function(t){Shop.ins().shopData.checkBuyGoodsId(t)&&ViewManager.ins().open(BuyWin,t)},e}(BaseEuiView);__reflect(GainZsWin.prototype,"GainZsWin"),ViewManager.ins().reg(GainZsWin,LayerManager.UI_Popup);var MijiLearnItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiLearnItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.data=t.item,t.isLock?(this.label.visible=!0,this.label.text="已锁"):t.islearn?(this.label.visible=!0,this.label.text="已学"):this.label.visible=!1},e}(BaseItemRender);__reflect(MijiLearnItemRenderer.prototype,"MijiLearnItemRenderer");var MijiLearnWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiLearnSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemList.itemRenderer=MijiLearnItemRenderer,this.itemScroller.viewport=this.itemList,this.isTopLevel=!0,this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获得途径</u>")},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleIndex=t[0],this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.link,this.onTap),this.observe(UserBag.ins().postItemAdd,this.updateItem),this.observe(UserBag.ins().postItemDel,this.updateItem),this.observe(UserBag.ins().postItemChange,this.updateItem),this.clearData(),this.updateItem(!0)},e.prototype.sortFun=function(t,e){var i=UserMiji.ins(),s=MiJiSkillConfig.getSkillIDByItem(t.configID),n=MiJiSkillConfig.getSkillIDByItem(e.configID);return 1==i.hasSpecificSkillOfRole(this.roleIndex,s)?1:1==i.hasSpecificSkillOfRole(this.roleIndex,n)?-1:t.configID<e.configID?-1:t.configID>e.configID?1:0},e.prototype.updateItem=function(t){void 0===t&&(t=!1);var e=UserBag.ins().getBagGoodsByType(2);e.sort(this.sortFun.bind(this));for(var i=[],s=0;s<e.length;s++){var n=MiJiSkillConfig.getSkillIDByItem(e[s].configID),o=new Object;o.islearn=UserMiji.ins().hasSpecificSkillOfRole(this.roleIndex,n),o.isLock=UserMiji.ins().mijiIsLock(this.roleIndex,n),o.item=e[s],i.push(o)}this.itemList.dataProvider=new eui.ArrayCollection(i),t&&e.length&&(this.setData(e[0]),this.itemList.selectedIndex=0)},e.prototype.setData=function(t){this.mijiLearnIcon.data=MiJiSkillConfig.getSkillIDByItem(t.configID);var e=ItemConfig.getQualityColor(t.itemConfig).toString(16);this.mijiName.textFlow=(new egret.HtmlTextParser).parser("<font color='#"+e+"'>"+t.itemConfig.name+"</font>"),this.info.textFlow=TextFlowMaker.generateTextFlow1(t.itemConfig.desc),this.mijiLearnIcon.visible=!0;var i=MiJiSkillConfig.getSkillIDByItem(t.configID),s=UserMiji.ins().hasSpecificSkillOfRole(this.roleIndex,i);this.smeltBtn.enabled=!s,UserMiji.ins().mijiIsLock(this.roleIndex,i)?(this.smeltBtn.label="已加锁",this.smeltBtn.enabled=!1):this.smeltBtn.label=s?"已学习":"放 入",this.curName=t.itemConfig.name},e.prototype.clearData=function(){this.itemList.selectedIndex=-1,this.mijiLearnIcon.visible=!1,this.mijiLearnIcon.data=null,this.info.text="",this.curName="",this.mijiName.text=""},e.prototype.onItemTap=function(t){var e=this.itemList.dataProvider.getItemAt(t.itemIndex);this.setData(e.item)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.smeltBtn:if(this.mijiLearnIcon.data<=0)return void UserTips.ins().showTips("请选择技能！");var e=this.mijiLearnIcon.data+1;e=this.mijiLearnIcon.data-1;GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[this.mijiLearnIcon.data].item].name;UserMiji.ins().postSelectedMiji(this.mijiLearnIcon.data,this.curName),this.clearData(),ViewManager.ins().close(this);break;case this.link:ViewManager.ins().close(this),UserWarn.ins().setBuyGoodsWarn(200099,1)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.removeTouchEvent(this.smeltBtn,this.onTap),this.removeTouchEvent(this.link,this.onTap),this.removeObserve()},e}(BaseEuiView);__reflect(MijiLearnWin.prototype,"MijiLearnWin"),ViewManager.ins().reg(MijiLearnWin,LayerManager.UI_Main);var MijiLockWin=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.selItem=0,e.isFirst=!0,e.skinName="MijiLockSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.mijiBtns=[this.mijiBtn0,this.mijiBtn1,this.mijiBtn2,this.mijiBtn3,this.mijiBtn4,this.mijiBtn5,this.mijiBtn6,this.mijiBtn7],this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获得道具</u>"),this.roleSelect.hideTop()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isFirst=!0,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.link,this.onTap),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEndEvent(this.otherRect,this.otherClose);for(var i in this.mijiBtns)this.addTouchEvent(this.mijiBtns[i],this.onTap);this.observe(UserMiji.ins().postMijiLockInfo,this.setData),t[0]==UserMiji.BAGOPEN?this.bagSelectIndex():(this.roleSelect.setCurRole(isNaN(t[0])?0:t[0]),this.selItem=this.getindex(isNaN(t[0])?0:t[0])),this.setCurRole(this.roleSelect.getCurRole())},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onChange=function(t){var e=this.roleSelect.getCurRole();this.isFirst||(this.selItem=this.getindex(e)),this.isFirst=!1,this.setCurRole(e)},e.prototype.setCurRole=function(t){this.curRole=t,this.setData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.smeltBtn:var e=this.mijiBtns[this.selItem].data;if(e.isLocked)return void UserMiji.ins().sendMijiDelLock(this.curRole,e.id);UserMiji.ins().sendMijiAddLock(this.curRole,e.id);break;case this.link:UserWarn.ins().setBuyGoodsWarn(GlobalConfig.MijiBaseConfig.lockId,1);break;default:var i=this.mijiBtns.indexOf(t.target.parent),s=this.mijiBtns[i].data;if(!this.mijiBtns[i]||!s)return;if(0==s.id)return void UserTips.ins().showCenterTips("未学习秘籍的孔位无法加锁");this.selItem=i;var n=UserMiji.ins();if(!n.grid||this.selItem>=n.grid)return void UserTips.ins().showTips("未开启");this.updateBtnState()}},e.prototype.updateBtnState=function(){for(var t=0;t<this.mijiBtns.length;t++)this.mijiBtns[t].setSelected(!1);this.labCount.text="",this.link.visible=!1;var e=UserBag.ins().getBagGoodsCountById(UserBag.BAG_TYPE_OTHTER,GlobalConfig.MijiBaseConfig.lockId),i=e>0;if(i&&(this.labCount.text="剩余道具： "+e),this.link.visible=!i,this.selItem<0)return this.smeltBtn.label="孔位加锁",void(this.smeltBtn.enabled=!1);this.mijiBtns[this.selItem].setSelected(!0);var s=this.mijiBtns[this.selItem].data;s.isLocked?(this.smeltBtn.label="孔位解锁",this.smeltBtn.enabled=!0):(this.smeltBtn.label="孔位加锁",this.smeltBtn.enabled=i)},e.prototype.setData=function(){for(var t=UserMiji.ins(),e=!0,i=0;8>i;i++)if(ErrorLog.Assert(t.miji,"MijiPanel   data.miji is null"))this.mijiBtns[i].data=null;else{var s=t.miji[this.curRole];ErrorLog.Assert(s,"MijiPanel   numList is null  roleId = "+this.curRole)?this.mijiBtns[i].data=null:(this.mijiBtns[i].data=s[i]?s[i]:null,s[i]&&0==s[i].id?this.mijiBtns[i].setUnlearn(!0):this.mijiBtns[i].setUnlearn(!1),s[i]||e&&(this.mijiBtns[i].setCountLabel(i),e=!1))}this.updateBtnState()},e.prototype.getindex=function(t){for(var e=UserMiji.ins().miji[t],i=0;i<e.length;i++)if(0!=e[i].id)return i;return-1},e.prototype.bagSelectIndex=function(){var t=0,e=!1;this.selItem=0;for(var i=SubRoles.ins().subRolesLen,s=0;i>s;s++){for(var n=UserMiji.ins().miji[s],o=0;o<n.length;o++)if(0!=n[o].id&&0==n[o].isLocked){t=s,this.selItem=o,e=!0;break}if(e)break}this.roleSelect.setCurRole(t)},e}(BaseEuiView);__reflect(MijiLockWin.prototype,"MijiLockWin"),ViewManager.ins().reg(MijiLockWin,LayerManager.UI_Popup);var MijiTipWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MijiTipSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.item.data=t[0].id;var i=GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[t[0].id].item];this.info.textFlow=TextFlowMaker.generateTextFlow1(i.name+"\n\n"+i.desc),this.power.text="评分："+GlobalConfig.MiJiSkillConfig[t[0].id].power,this.addTouchEvent(this,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onClose)},e}(BaseEuiView);__reflect(MijiTipWin.prototype,"MijiTipWin"),ViewManager.ins().reg(MijiTipWin,LayerManager.UI_Main);var MiJiTujianWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MijiPhotoSkin",this.mijiList.itemRenderer=ItemBaseNoTap,this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.mijiList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.addTouchEvent(this.mijiOpen,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.mijiList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.removeTouchEvent(this.mijiOpen,this.onTap)},e.prototype.updateData=function(){this.mijiOpen.textFlow=(new egret.HtmlTextParser).parser("<font><u>通过王者争霸玩法获得</u></font>");for(var t=[],e=0,i=GlobalConfig.ItemConfig;e<i.length;e++){var s=i[e];2==ItemConfig.getType(s)&&t.push(s.id)}this.mijiList.dataProvider=new eui.ArrayCollection(t),t.length&&(this.setData(t[0]),this.mijiList.selectedIndex=0)},e.prototype.onItemTap=function(t){var e=this.mijiList.dataProvider.getItemAt(t.itemIndex);this.setData(e)},e.prototype.setData=function(t){var e=GlobalConfig.ItemConfig[t];this.mijiIcon.setData(e);var i=ItemConfig.getQualityColor(e).toString(16);this.info.textFlow=(new egret.HtmlTextParser).parser("<font color='#"+i+"'>"+e.name+"</font>\n"+e.desc),this.mijiIcon.visible=!0;for(var s=10,n=0,o=GlobalConfig.MiJiSkillConfig;n<o.length;n++){var a=o[n];a.item==t&&(s=a.id)}this.power.text="评分："+GlobalConfig.MiJiSkillConfig[s].power},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.mijiOpen:ViewManager.ins().close(this),UserWarn.ins().setBuyGoodsWarn(200099,1)}},e}(BaseEuiView);__reflect(MiJiTujianWin.prototype,"MiJiTujianWin"),ViewManager.ins().reg(MiJiTujianWin,LayerManager.UI_Main);var MijiZhWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MijiZhSkin",this.itemList.itemRenderer=ItemBaseNoTap,this.itemScroller.viewport=this.itemList,this.touchChildren=!0,this.mijiItem0.touchEnabled=!0,this.mijiItem0.touchChildren=!0,this.mijiItem1.touchEnabled=!0,this.mijiItem1.touchChildren=!0,this.mijiItem2.touchEnabled=!0,this.mijiItem2.touchChildren=!0,this.mcEff1=new MovieClip,this.mcEff1.x=63,this.mcEff1.y=99,this.mcEff2=new MovieClip,this.mcEff2.x=153,this.mcEff2.y=99,this.mcEff3=new MovieClip,this.mcEff3.x=243,this.mcEff3.y=99,this.nameArr=[],this.isTopLevel=!0},e.prototype.onItemTap=function(t){if(!(this.mijiItem0.data&&this.mijiItem1.data&&this.mijiItem2.data)){var e=t.item.count,i=MiJiSkillConfig.getSkillIDByItem(t.item.configID);this.mijiItem0.data==i&&e--,this.mijiItem1.data==i&&e--,this.mijiItem2.data==i&&e--;var s="秘籍不足";if(!e)return void UserTips.ins().showTips(s);this.mijiItem0.data?this.mijiItem1.data?this.mijiItem2.data||(this.mijiItem2.data=i,this.nameArr[2]=t.item.itemConfig.name):(this.mijiItem1.data=i,this.nameArr[1]=t.item.itemConfig.name):(this.mijiItem0.data=i,this.nameArr[0]=t.item.itemConfig.name),this.mijiItem3.data=""}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.mijiItem0,this.onTap),this.addTouchEvent(this.mijiItem1,this.onTap),this.addTouchEvent(this.mijiItem2,this.onTap),this.addTouchEvent(this.mijiItem3,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.observe(UserBag.ins().postItemAdd,this.updateItem),this.observe(UserBag.ins().postItemDel,this.updateItem),this.observe(UserBag.ins().postItemChange,this.updateItem),this.observe(UserMiji.ins().postMijiChange,this.showResult),this.clearData(),this.updateItem()},e.prototype.sortFun=function(t,e){return t.configID<e.configID?-1:t.configID>e.configID?1:0},e.prototype.updateItem=function(){var t=UserBag.ins().getBagGoodsByType(2);t.sort(this.sortFun),this.itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.clearData=function(){this.itemList.selectedIndex=-1,this.mijiItem0.data="",this.mijiItem1.data="",this.mijiItem2.data="",this.mijiItem3.data=""},e.prototype.playEffect=function(){this.mcEff1.playFile(RES_DIR_EFF+"forgeSuccess",1),this.anigroup.addChild(this.mcEff1),this.mcEff2.playFile(RES_DIR_EFF+"forgeSuccess",1),this.anigroup.addChild(this.mcEff2),this.mcEff3.playFile(RES_DIR_EFF+"forgeSuccess",1),this.anigroup.addChild(this.mcEff3)},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.smeltBtn:if(!this.mijiItem0.data||!this.mijiItem1.data||!this.mijiItem2.data)return void UserTips.ins().showTips("请先放入3本秘籍");WarnWin.show("是否消耗《"+this.nameArr[0]+"》、《"+this.nameArr[1]+"》、《"+this.nameArr[2]+"》随机置换一本新的秘籍？",function(){var t=e.mijiItem0.data,i=e.mijiItem1.data,s=e.mijiItem2.data;UserMiji.ins().sendMijiChange(t,i,s),e.clearData(),e.playEffect()},this);break;case this.closeBtn:case this.closeBtn0:case this.bgClose:ViewManager.ins().close(this);break;case this.mijiItem0:case this.mijiItem1:case this.mijiItem2:t.currentTarget.data="";break;case this.mijiItem3:if(this.mijiItem3&&this.mijiItem3.data){var i=GlobalConfig.MiJiSkillConfig[this.mijiItem3.data];if(i){var s=UserBag.ins().getBagItemById(i.item);s&&ViewManager.ins().open(ItemDetailedWin,0,s.itemConfig.id,s.count)}}}},e.prototype.showResult=function(t){this.mijiItem3.data=MiJiSkillConfig.getSkillIDByItem(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.smeltBtn,this.onTap),this.itemList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.removeTouchEvent(this.mijiItem0,this.onTap),this.removeTouchEvent(this.mijiItem1,this.onTap),this.removeTouchEvent(this.mijiItem2,this.onTap),this.removeObserve(),DisplayUtils.removeFromParent(this.mcEff1),DisplayUtils.removeFromParent(this.mcEff2),DisplayUtils.removeFromParent(this.mcEff3)},e}(BaseEuiView);__reflect(MijiZhWin.prototype,"MijiZhWin"),ViewManager.ins().reg(MijiZhWin,LayerManager.UI_Popup);var ZSBossCDWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZSBossCDSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.check.selected=t[0],this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.addChangeEvent(this.check,this.selectChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.giveUp,this.onTap),this.check.removeEventListener(egret.Event.CHANGE,this.selectChange,this)},e.prototype.selectChange=function(t){this.check.selected&&UserTips.ins().showTips("已开启挑战中自动复活")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sure:ZsBoss.ins().checkIsMoreMoney()&&(UserBoss.ins().sendClearCD(),ViewManager.ins().close(this));break;case this.giveUp:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ZSBossCDWin.prototype,"ZSBossCDWin"),ViewManager.ins().reg(ZSBossCDWin,LayerManager.UI_Popup);var ZSBossLotteryWin=function(t){function e(){var e=t.call(this)||this;return e.configTimes=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZSBossLotterySkin",this.bar.labelFunction=function(){return""},this.isTopLevel=!0,this.pointImg=BitmapNumber.ins().createNumPic(0,"1",10),this.pointImg.x=this.point.x,this.pointImg.y=this.point.y,DisplayUtils.removeFromParent(this.point)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.play,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.observe(UserBoss.ins().postLotteryRan,this.getMyPoint),this.observe(UserBoss.ins().postLotteryResult,this.getMaxPoint),this.observe(GuildWar.ins().postLotteryPoint,this.getMyPoint),this.observe(GuildWar.ins().postLotteryMaxPost,this.getMaxPoint),this.statu=0,t[0]?this.statu=t[0]:this.statu=0,ZsBoss.ins().isZsBossFb(GameMap.fubenID)?this.configTimes=GlobalConfig.WorldBossBaseConfig.lotteryTime:this.configTimes=10,this.bar.maximum=10*this.configTimes,this.refushInfo(),this.play.enabled=!0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.play,this.onTap),this.removeTouchEvent(this.giveUp,this.onTap),TimerManager.ins().remove(this.refushBar,this),this.removeObserve()},e.prototype.refushInfo=function(){this.times=0,this.item0.data=UserBoss.ins().worldPrize,TimerManager.ins().doTimer(100,10*this.configTimes,this.refushBar,this,this.TimeOver,this),this.timeLabel.text=this.configTimes+"秒"},e.prototype.refushBar=function(){this.times++;var t=10*this.configTimes-this.times;this.bar.value=t,this.timeLabel.text=Math.floor(this.configTimes-this.times/10)+"秒"},e.prototype.TimeOver=function(){ViewManager.ins().close(e)},e.prototype.getMyPoint=function(t){this.play.enabled=!1,BitmapNumber.ins().changeNum(this.pointImg,t,"7",2),this.addChild(this.pointImg)},e.prototype.getMaxPoint=function(t){this.maxPoint.textFlow=(new egret.HtmlTextParser).parser("<font color = '#FFB82A'>"+t[0]+"</font>投出了<font color = '#FFB82A'>"+t[1]+"</font>点")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.play:0==this.statu?UserBoss.ins().sendJoinLottery():1==this.statu&&GuildWar.ins().sendPlayLotteryInfo();break;case this.giveUp:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(ZSBossLotteryWin.prototype,"ZSBossLotteryWin"),ViewManager.ins().reg(ZSBossLotteryWin,LayerManager.UI_Popup);var ZsBossPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.initData=function(){for(var t,e=1;5>e;e++)t=GlobalConfig.OtherBoss1Config[e],this["head"+e].source="monhead"+GlobalConfig.MonstersConfig[t.bossId].head+"_png",this["bossName"+e].text=GlobalConfig.MonstersConfig[t.bossId].name+"("+t.llimit+"-"+t.hlimit+"转)",this["rewardList"+e].itemRenderer=ItemBase,this["rewardList"+e].dataProvider=new eui.ArrayCollection(t.showReward);this.seeReward.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("<u>查看奖励</u>","#23C42A"))},e.prototype.open=function(){ZsBoss.ins().sendGetBossList();for(var t=ZsBoss.ins().acIsOpen?"查看排名":"上次排名",e=1;5>e;e++)this["rank"+e].textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("<u>"+t+"</u>","#23C42A")),this.addTouchEvent(this["head"+e],this.onTouch),this.addTouchEvent(this["rank"+e],this.onTouch);this.addTouchEvent(this.seeReward,this.onTouch),this.addTouchEvent(this.enterGame,this.onTouch),this.addTouchEvent(this.clearBtn,this.onTouch),this.observe(ZsBoss.ins().postRrmainTime,this.reliveInfoChange),this.observe(ZsBoss.ins().postBossList,this.refushBtn),this.reliveInfoChange(),this.refushBtn(),this.initData()
},e.prototype.close=function(){for(var t=1;5>t;t++)this.removeTouchEvent(this["head"+t],this.onTouch),this.removeTouchEvent(this["rank"+t],this.onTouch);this.removeTouchEvent(this.seeReward,this.onTouch),this.removeTouchEvent(this.enterGame,this.onTouch),this.removeTouchEvent(this.clearBtn,this.onTouch),this.removeObserve()},e.prototype.cleanWarnWin=function(){this.warnWin&&ViewManager.ins().close(WarnWin)},e.prototype.refushBtn=function(){var t=!1,e=ZsBoss.ins();if(e.acIsOpen){for(var i=e.getBossListLength(),s=void 0,n=0;i>n;n++){if(s=e.getBossInfoByIndex(n),s.challengeIn){this["bossBg"+(n+1)].source="zsboss_04",s.kill?(this.sign.source="zsboss_03",e.reliveTime=0,this.reliveInfoChange()):this.sign.source="zsboss_07",this.setSignPoint(n),t=!0;break}this["bossBg"+(n+1)].source="zsboss_01"}if(!t){var o=e.canPlayBossIndex();o>0&&(this["bossBg"+o].source="zsboss_04",s=e.getBossInfoByIndex(o-1),s&&(s.kill?(this.sign.source="zsboss_03",e.reliveTime=0,this.reliveInfoChange()):this.sign.source="",this.setSignPoint(o-1)))}}else{this.sign.source="";var o=e.canPlayBossIndex();o>0&&(this["bossBg"+o].source="zsboss_04")}for(var a=2;5>a;a++)a>e.aliveBossNum?this["sign"+a].source="zsboss_17":this["sign"+a].source=""},e.prototype.setSignPoint=function(t){this.sign.x=t%2*210+133,this.sign.y=230*Math.floor(t/2)+25},e.prototype.reliveInfoChange=function(){var t=ZsBoss.ins();this.timeLable.text="CD："+t.reliveTime+"秒",TimerManager.ins().remove(this.refushLabel,this),this.cd.visible&&(this.remainM=t.reliveTime,TimerManager.ins().doTimer(1e3,this.remainM,this.refushLabel,this,this.overTime,this))},e.prototype.overTime=function(){this.cd.visible=!1,this.cleanWarnWin()},e.prototype.refushLabel=function(){this.remainM--,this.timeLable.text="CD："+this.remainM+"秒"},e.prototype.onTouch=function(t){switch(t.target){case this.head1:case this.rank1:this.openRankWin(1);break;case this.head2:case this.rank2:this.openRankWin(2);break;case this.head3:case this.rank3:this.openRankWin(3);break;case this.head4:case this.rank4:this.openRankWin(4);break;case this.seeReward:ViewManager.ins().open(ZsBossRewardShowWin);break;case this.enterGame:ZsBoss.ins().checkIsShowNoticeWin()?this.warnWin=WarnWin.show("每天只能参加<font color='#FFB82A'>1次</font>转生BOSS,确定要进入挑战吗？",function(){ZsBoss.ins().sendRequstChallenge(),ZsBoss.ins().firstShowWin=!0},this):ZsBoss.ins().sendRequstChallenge();break;case this.clearBtn:ZsBoss.ins().checkIsMoreMoney()?this.warnWin=WarnWin.show("确定要消耗<font color='#FFB82A'>300元宝</font>清除CD吗？",function(){ZsBoss.ins().sendBuyCd()},this):UserTips.ins().showTips("元宝不足")}},e.prototype.openRankWin=function(t){ZsBoss.ins().sendRequstBossRank(t),ViewManager.ins().open(ZsBossRankWin)},e}(BaseComponent);__reflect(ZsBossPanel.prototype,"ZsBossPanel");var ZsBossRankRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bg.visible=this.itemIndex%2==0,this.txt0.text=this.data.rank+"",this.txt1.text=this.data.names,this.txt2.text=this.data.shanghai},e}(BaseItemRender);__reflect(ZsBossRankRenderer.prototype,"ZsBossRankRenderer");var ZsBossRankWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZSBossJoinSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.observe(ZsBoss.ins().postRankInfo,this.refushListInfo),this.refushListInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeObserve()},e.prototype.refushListInfo=function(){this.list.dataProvider=new eui.ArrayCollection(ZsBoss.ins().bossRankList)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ZsBossRankWin.prototype,"ZsBossRankWin"),ViewManager.ins().reg(ZsBossRankWin,LayerManager.UI_Main);var ZsBossResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZsBossResultSkin",this.closeBtn.name="领取奖励",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t;this.first.text=i[0][0],this.kill.text=i[0][1],this.myrank.text="我的排名："+i[0][2],this.list.dataProvider=new eui.ArrayCollection(i[1]),this.s=10,this.updateCloseBtnLabel(),TimerManager.ins().doTimer(1e3,10,this.updateCloseBtnLabel,this),this.addTouchEvent(this.closeBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];TimerManager.ins().remove(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&UserFb.ins().sendExitFb()},e.prototype.onTap=function(){ViewManager.ins().close(this)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e}(BaseEuiView);__reflect(ZsBossResultWin.prototype,"ZsBossResultWin"),ViewManager.ins().reg(ZsBossResultWin,LayerManager.UI_Popup);var ZsBossRewardShowWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZSBossRewardSkin",this.tab.dataProvider=new eui.ArrayCollection(ZsBoss.ins().getBarList()),this.itemList1.itemRenderer=ItemBase,this.itemList2.itemRenderer=ItemBase,this.itemList3.itemRenderer=ItemBase,this.itemList4.itemRenderer=ItemBase,this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.tab,this.selectIndexChange),this.selectIndexChange(null)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap)},e.prototype.selectIndexChange=function(t){var e=this.tab.selectedIndex,i=GlobalConfig.OtherBoss1Config[e+1];this.bossName.text=GlobalConfig.MonstersConfig[i.bossId].name+"("+i.llimit+"-"+i.hlimit+"转)",this.ranklabel1.text=i.rankname[0],this.ranklabel2.text=i.rankname[1],this.ranklabel3.text=i.rankname[2],this.ranklabel4.text=i.rankname[3],this.ranklabel5.text=i.rankname[4],this.ranklabel6.text=i.rankname[5],this.itemList1.dataProvider=new eui.ArrayCollection(i.rank1),this.itemList2.dataProvider=new eui.ArrayCollection(i.rank2),this.itemList3.dataProvider=new eui.ArrayCollection(i.rank3),this.itemList4.dataProvider=new eui.ArrayCollection(i.rank4),this.itemList5.data=i.killReward,this.itemList6.data=i.shield[0].reward},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ZsBossRewardShowWin.prototype,"ZsBossRewardShowWin"),ViewManager.ins().reg(ZsBossRewardShowWin,LayerManager.UI_Popup);var ZsBossRuleSpeak=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="HelpTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose);var i=t[0],s=GlobalConfig.HelpInfoConfig[i];Assert(s,"HelpInfoConfig do not have index:"+i)||(this.textInfo.textFlow=TextFlowMaker.generateTextFlow(GlobalConfig.HelpInfoConfig[i].text),this.textInfo.height=this.textInfo.textHeight,this.background.height=this.textInfo.textHeight+60,this.anigroup.y=(StageUtils.ins().getHeight()-this.background.height)/2)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZsBossRuleSpeak.prototype,"ZsBossRuleSpeak"),ViewManager.ins().reg(ZsBossRuleSpeak,LayerManager.UI_Popup);var ZsBoss=function(t){function e(){var e=t.call(this)||this;return e.promptList=["","你今天已经参加过1次活动了，请明天再来","挑战CD中","转生BOSS已经被击杀","没有符合条件的boss","活动未开启","在副本中"],e.firstShowWin=!1,e._clearOther=!1,e.canChange=!0,e.sysId=PackageID.ZsBoss,e.regNetMsg(1,e.postBossList),e.regNetMsg(2,e.postBossOpen),e.regNetMsg(3,e.postRrmainTime),e.regNetMsg(4,e.postRankInfo),e.regNetMsg(5,e.postLotteryInfo),e.regNetMsg(7,e.postChallengeResult),e.regNetMsg(8,e.postHudunPoint),e.regNetMsg(9,e.postWinResult),e.regNetMsg(11,e.doGetMyPoint),e.regNetMsg(12,e.doTalkMaxPoint),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendGetBossList=function(){this.sendBaseProto(1)},e.prototype.sendRequstChallenge=function(){this.sendBaseProto(3)},e.prototype.sendRequstBossRank=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.sendJoinChoujiang=function(){this.sendBaseProto(5)},e.prototype.sendBuyCd=function(){this.sendBaseProto(6)},e.prototype.postBossList=function(t){var e=t.readShort();this.bossInfoList=[];for(var i=0;e>i;i++)this.bossInfoList.push(new BossInfoData(t));this.aliveBossNum=t.readShort()},e.prototype.getBossListLength=function(){var t=0;return null!=this.bossInfoList&&(t=this.bossInfoList.length),t},e.prototype.getBossInfoByIndex=function(t){var e=null;return null!=this.bossInfoList&&t>=0&&t<this.bossInfoList.length&&(e=this.bossInfoList[t]),e},e.prototype.postBossOpen=function(t){this.acIsOpen=t.readBoolean(),this.acIsOpen?UserZs.ins().lv>0&&UserBoss.ins().worldBossLeftTime[UserBoss.BOSS_SUBTYPE_WORLDBOSS]&&UserBoss.ins().postBossData(!0,this.canPlayBossName()):this.reliveTime=0},e.prototype.postRrmainTime=function(t){this.remainTime=t.readShort(),this.reliveTime=t.readShort()},e.prototype.postRankInfo=function(t){this.parseBossRankList(t)},e.prototype.postLotteryInfo=function(t){this.lotteryItemId=t.readInt(),ViewManager.ins().open(ZSBossLotteryWin)},e.prototype.postChallengeResult=function(t){var i=t.readByte();i>0?UserTips.ins().showTips(e.ins().promptList[i]):0==i&&ViewManager.ins().close(BossWin)},e.prototype.postHudunPoint=function(t){this.hudun=t.readInt()},e.prototype.postWinResult=function(t){for(var e,i=[t.readString(),t.readString(),t.readShort()],s=t.readShort(),n=[],o=0;s>o;o++)e=new RewardData,e.parser(t),n.push(e);ViewManager.ins().open(ZsBossResultWin,i,n)},Object.defineProperty(e.prototype,"reliveTime",{get:function(){return this._reliveTime},set:function(t){this._reliveTime!=t&&(this._reliveTime=t,TimerManager.ins().remove(this.timeClock,this),TimerManager.ins().doTimer(1e3,this._reliveTime,this.timeClock,this))},enumerable:!0,configurable:!0}),e.prototype.timeClock=function(){this._reliveTime--,this._reliveTime<=0&&TimerManager.ins().remove(this.timeClock,this)},e.prototype.parseBossRankList=function(t){this.bossRankList=[];for(var e=(t.readInt(),t.readShort()),i=0;e>i;i++)this.bossRankList.push(new BossRankInfo(t,i+1))},e.prototype.getBarList=function(){if(this.barList&&this.barList.length>0)return this.barList;this.barList||(this.barList=[]);for(var t,e=1;5>e;e++)t=GlobalConfig.OtherBoss1Config[e],this.barList.push(t.llimit+"-"+t.hlimit+"转");return this.barList},e.prototype.isZsBossFb=function(t){for(var e,i=1;5>i;i++)if(e=GlobalConfig.OtherBoss1Config[i],t==e.fbid)return!0;return!1},e.prototype.checkIsMoreMoney=function(){return Actor.yb>=GlobalConfig.WorldBossBaseConfig.clearCdCost[UserBoss.ins().currBossSubType-1]},e.prototype.checkIsShowNoticeWin=function(){return!1},e.prototype.canPlayBossIndex=function(){for(var t,e=UserZs.ins().lv,i=4;i>=1;i--)if(t=GlobalConfig.OtherBoss1Config[i],e>=t.llimit&&e<=t.hlimit&&this.aliveBossNum>=i)return i;return 0},e.prototype.canPlayBossName=function(){var t=this.canPlayBossIndex();if(t>0){var e=GlobalConfig.OtherBoss1Config[t];return GlobalConfig.MonstersConfig[e.bossId].name}return"转生boss "},Object.defineProperty(e.prototype,"clearOther",{get:function(){return this._clearOther},set:function(t){this._clearOther!=t&&(this._clearOther=t,this.canChange=!1,TimerManager.ins().doTimer(1e3,10,this.overDealy,this,this.dealyOver,this))},enumerable:!0,configurable:!0}),e.prototype.dealyOver=function(){TimerManager.ins().remove(this.overDealy,this),this.canChange=!0},e.prototype.overDealy=function(){},e.prototype.doGetMyPoint=function(t){this.postLotteryPoint(t.readShort())},e.prototype.postLotteryPoint=function(t){return t},e.prototype.doTalkMaxPoint=function(t){this.postLotteryMaxPost(t.readString(),t.readShort())},e.prototype.postLotteryMaxPost=function(t,e){return[t,e]},e}(BaseSystem);__reflect(ZsBoss.prototype,"ZsBoss");var BossInfoData=function(){function t(t){this.bossId=t.readInt(),this.kill=t.readBoolean(),this.challengeIn=t.readBoolean()}return t}();__reflect(BossInfoData.prototype,"BossInfoData");var BossRankInfo=function(){function t(t,e){this.id=t.readInt(),this.names=t.readString(),this.shanghai=t.readDouble(),this.rank=e}return t}();__reflect(BossRankInfo.prototype,"BossRankInfo");var GameSystem;!function(t){t.zsBoss=ZsBoss.ins.bind(ZsBoss)}(GameSystem||(GameSystem={}));var CreateRoleScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onEnter=function(){t.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Tips),ViewManager.ins().open(CreateRoleView),ReportData.getIns().report("entercreaterole",ReportData.LOAD)},e.prototype.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);__reflect(CreateRoleScene.prototype,"CreateRoleScene");var CreateRoleView=function(t){function e(){var e=t.call(this)||this;e._selectJob=0,e.isAutoEnter=!1,e.skinName="CreateRolSkin",e.jobImage=[e.j0,e.j1,e.j2,e.j3,e.j4,e.j5],e.enterGroup.visible=!1,e.groupSpark=new eui.Group,e.addChild(e.groupSpark),e.groupSpark.touchChildren=!1,e.groupSpark.touchEnabled=!1,e.list.itemRenderer=CreateRoleViewItem;for(var i=["","","",""],s=["紫廖渔歌","半瓶矿泉水","暖风","繁华过后","念迩成习","逆丶美丽","握不住的美","隔岸觀火","残喘的笑","何时苏醒","湮丶燃尽了","年少无知≈","卸不掉的盔甲","″温瞳渐远≈","男人/吥乖","走遍四方","我已无力说爱","繁华沧桑","卡尺","往事随风","剑胆琴心","心如止水","风伤依旧","一直很低调","遥忘而立","忧郁的萨克斯","哥比彩钻还炫","烈日追风","本人、已昏","全橙相伴","残月孤生"],n=0;3>n;n++)i=i.concat(s);return e.list.dataProvider=new eui.ArrayCollection(i),e.scroller.touchChildren=!1,e.scroller.touchEnabled=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.selectJob=0;for(var i=0;i<this.jobImage.length;i++)this.jobImage[i].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.diceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var s=LocationProperty.nickName;"null"==s||""==s?RoleMgr.ins().sendRandomName(this._selectJob%2):this.setName(s),this.sparkTween(),this.listH=this.list.height-200,this.scroller.viewport.scrollV=0;var n=egret.Tween.get(this.scroller.viewport);n.to({scrollV:this.listH},40*this.listH).call(this.loopT,this),this.observe(GameApp.ins().postPerLoadProgress,this.perloadProgress),this.observe(RoleMgr.ins().postCreateRole,this.createRuselt),this.openTime=egret.getTimer()+15e3,this.timeLab.text="",this.nameInput.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.setBtnEff()},e.prototype.setBtnEff=function(){this.btnMc||(this.btnMc=new MovieClip,this.btnMc.x=this.createBtn.x+this.createBtn.width/2+15,this.btnMc.y=this.createBtn.y+this.createBtn.height/2-2,this.createBtn.parent.addChild(this.btnMc)),this.btnMc.playFile(RES_DIR_EFF+"chuangjuebtn",-1)},e.prototype.updateTiem=function(){var t=Math.ceil((this.openTime-egret.getTimer())/1e3);this.timeLab.text="剩余"+Math.max(t,0)+"秒",0>=t&&(this.isAutoEnter=!0,this.sendCreateRole())},e.prototype.createRuselt=function(t){this.enterGroup.visible=!1,6==Math.abs(t)&&RoleMgr.ins().sendRandomName(this._selectJob%2)},e.prototype.perloadProgress=function(t){var e=t[0],i=t[1];this.loadText.text="正在进入游戏（"+Math.ceil(e/i*100)+"%）"},e.prototype.loopT=function(){this.scroller.viewport.scrollV=200;var t=egret.Tween.get(this.scroller.viewport);t.to({scrollV:this.listH},40*this.listH).call(this.loopT,this)},e.prototype.loopT2=function(){var t=egret.Tween.get(this.imgA);t.to({horizontalCenter:-100},1e3).to({horizontalCenter:-115},1e3).call(this.loopT2,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.jobImage.length;i++)this.jobImage[i].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);this.createBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.diceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.closeTween(),TimerManager.ins().removeAll(this),DisplayUtils.removeFromParent(this.btnMc),this.btnMc=null},e.prototype.sendCreateRole=function(){RoleMgr.ins().sendCreateRole(this.nameInput.text,this.curSex(),this.curJob(),0,0,""),TimerManager.ins().removeAll(this)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.createBtn:ReportData.getIns().report("clickstart",ReportData.LOAD),this.sendCreateRole(),this.enterGroup.visible=!0;break;case this.diceBtn:RoleMgr.ins().sendRandomName(this._selectJob%2);case this.nameInput:TimerManager.ins().remove(this.updateTiem,this),this.timeLab.text="";break;default:var e=this.jobImage.indexOf(t.currentTarget);e>=0&&(this.selectJob=e)}SoundManager.ins().touchBg()},Object.defineProperty(e.prototype,"selectJob",{set:function(t){this._selectJob=t,this.currentState=""+t},enumerable:!0,configurable:!0}),e.prototype.setName=function(t){this.nameInput.text=t,this.isAutoEnter&&this.sendCreateRole()},e.prototype.curJob=function(){return Math.floor(this._selectJob/2)+1},e.prototype.curSex=function(){return this._selectJob%2},e.prototype.sparkTween=function(){for(var t=this,e=0;15>e;e++)TimerManager.ins().doTimer(1e3*Math.random()+1500,1,function(){t.randomSpark()},this);TimerManager.ins().doTimer(1500,1,function(){t.sparkTween()},this)},e.prototype.randomSpark=function(){var t=ObjectPool.pop("eui.Image");t.source="cr_3",t.x=300*Math.random()+500,t.rotation=180*Math.random(),t.touchEnabled=!1,this.groupSpark.addChild(t);var e=MathUtils.limit(.7,1);t.scaleX=t.scaleY=e,t.y=MathUtils.limit(-50,250)+700;var i=egret.Tween.get(t);i.to({x:480*Math.random(),y:500*Math.random()},3500).call(function(){t.parent.removeChild(t),egret.Tween.removeTweens(t),ObjectPool.push(t)})},e.prototype.closeTween=function(){for(var t=this.groupSpark.numChildren,e=0;t>e;e++){var i=this.groupSpark.getChildAt(e);egret.Tween.removeTweens(i)}egret.Tween.removeTweens(this.imgA),egret.Tween.removeTweens(this.scroller.viewport)},e}(BaseEuiView);__reflect(CreateRoleView.prototype,"CreateRoleView"),ViewManager.ins().reg(CreateRoleView,LayerManager.UI_Main);var CreateRoleView1=function(t){function e(){var e=t.call(this)||this;e._selectJob=0,e._selectSex=0,e.isAutoEnter=!1,e.skinName="CreateRole1Skin",e.enterGroup.visible=!1,e.groupSpark=new eui.Group,e.addChild(e.groupSpark),e.groupSpark.touchChildren=!1,e.groupSpark.touchEnabled=!1,e.list.itemRenderer=CreateRoleViewItem;for(var i=["","","",""],s=["紫廖渔歌","半瓶矿泉水","暖风","繁华过后","念迩成习","逆丶美丽","握不住的美","隔岸觀火","残喘的笑","何时苏醒","湮丶燃尽了","年少无知≈","卸不掉的盔甲","″温瞳渐远≈","男人/吥乖","走遍四方","我已无力说爱","繁华沧桑","卡尺","往事随风","剑胆琴心","心如止水","风伤依旧","一直很低调","遥忘而立","忧郁的萨克斯","哥比彩钻还炫","烈日追风","本人、已昏","全橙相伴","残月孤生"],n=0;3>n;n++)i=i.concat(s);return e.list.dataProvider=new eui.ArrayCollection(i),e.scroller.touchChildren=!1,e.scroller.touchEnabled=!1,e.job1.selected.source="createrole_selected_1",e.job2.selected.source="createrole_selected_1",e.job3.selected.source="createrole_selected_1",e.boy.selected.source="createrole_selected_0",e.girl.selected.source="createrole_selected_0",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.selectJob=1,this.selectSex=Math.floor(2*Math.random()),this.job1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.job2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.job3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.boy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.girl.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.createBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.diceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this);var i=LocationProperty.nickName;"null"==i||""==i?RoleMgr.ins().sendRandomName(this._selectSex):this.setName(i),this.sparkTween(),this.listH=this.list.height-200,this.scroller.viewport.scrollV=0;var s=egret.Tween.get(this.scroller.viewport);s.to({scrollV:this.listH},40*this.listH).call(this.loopT,this),this.observe(GameApp.ins().postPerLoadProgress,this.perloadProgress),this.observe(RoleMgr.ins().postCreateRole,this.createRuselt),this.openTime=egret.getTimer()+15e3,TimerManager.ins().doTimer(1e3,0,this.updateTiem,this),this.nameInput.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.setBtnEff=function(){this.btnMc||(this.btnMc=new MovieClip,this.btnMc.x=this.createBtn.x+this.createBtn.width/2+15,this.btnMc.y=this.createBtn.y+this.createBtn.height/2-2,this.createBtn.parent.addChild(this.btnMc)),this.btnMc.playFile(RES_DIR_EFF+"chuangjuebtn",-1)},e.prototype.updateTiem=function(){var t=Math.ceil((this.openTime-egret.getTimer())/1e3);this.timeLab.text="剩余"+Math.max(t,0)+"秒",0>=t&&(this.isAutoEnter=!0,this.sendCreateRole())},e.prototype.createRuselt=function(t){this.enterGroup.visible=!1,6==Math.abs(t)&&RoleMgr.ins().sendRandomName(this._selectSex)},e.prototype.perloadProgress=function(t){var e=t[0],i=t[1];this.loadText.text="正在进入游戏（"+Math.ceil(e/i*100)+"%）"},e.prototype.loopT=function(){this.scroller.viewport.scrollV=200;var t=egret.Tween.get(this.scroller.viewport);t.to({scrollV:this.listH},40*this.listH).call(this.loopT,this)},e.prototype.loopT2=function(){var t=egret.Tween.get(this.imgA);t.to({horizontalCenter:-100},1e3).to({horizontalCenter:-115},1e3).call(this.loopT2,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.job1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.job2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.job3.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.boy.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.girl.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.createBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.diceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.nameInput.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.closeTween(),TimerManager.ins().removeAll(this)},e.prototype.sendCreateRole=function(){RoleMgr.ins().sendCreateRole(this.nameInput.text,this.curSex(),this.curJob(),0,0,""),TimerManager.ins().removeAll(this)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.createBtn:ReportData.getIns().report("clickstart",ReportData.LOAD),this.sendCreateRole(),this.enterGroup.visible=!0;break;case this.diceBtn:RoleMgr.ins().sendRandomName(this._selectSex);case this.nameInput:TimerManager.ins().remove(this.updateTiem,this),this.timeLab.text="";break;case this.boy:this.selectSex=0;break;case this.girl:this.selectSex=1;break;case this.job1:this.selectJob=1;break;case this.job2:this.selectJob=2;break;case this.job3:this.selectJob=3}SoundManager.ins().touchBg()},Object.defineProperty(e.prototype,"selectJob",{set:function(t){this._selectJob=t,this.updateRole()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectSex",{set:function(t){this._selectSex=t,this.updateRole()},enumerable:!0,configurable:!0}),e.prototype.updateRole=function(){var t=this.curJob(),e=this.curSex();this.role.source="cr_"+t+"_"+e+"_png";for(var i=1;3>=i;i++)this["job"+i].currentState="up";this["job"+t].currentState="selected",0==e?(this.boy.currentState="selected",this.girl.currentState="up"):(this.girl.currentState="selected",this.boy.currentState="up")},e.prototype.setName=function(t){this.nameInput.text=t,this.isAutoEnter&&this.sendCreateRole()},e.prototype.curJob=function(){return this._selectJob},e.prototype.curSex=function(){return this._selectSex},e.prototype.sparkTween=function(){for(var t=this,e=0;15>e;e++)TimerManager.ins().doTimer(1e3*Math.random()+1500,1,function(){t.randomSpark()},this);TimerManager.ins().doTimer(1500,1,function(){t.sparkTween()},this)},e.prototype.randomSpark=function(){var t=ObjectPool.pop("eui.Image");t.source="cr_3",t.x=300*Math.random()+500,t.rotation=180*Math.random(),t.touchEnabled=!1,this.groupSpark.addChild(t);var e=MathUtils.limit(.7,1);t.scaleX=t.scaleY=e,t.y=MathUtils.limit(-50,250)+700;var i=egret.Tween.get(t);i.to({x:480*Math.random(),y:500*Math.random()},3500).call(function(){t.parent.removeChild(t),egret.Tween.removeTweens(t),ObjectPool.push(t)})},e.prototype.closeTween=function(){for(var t=this.groupSpark.numChildren,e=0;t>e;e++){var i=this.groupSpark.getChildAt(e);egret.Tween.removeTweens(i)}egret.Tween.removeTweens(this.imgA),egret.Tween.removeTweens(this.scroller.viewport)},e}(BaseEuiView);__reflect(CreateRoleView1.prototype,"CreateRoleView1"),ViewManager.ins().reg(CreateRoleView1,LayerManager.UI_Main);var CreateRoleViewItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(""==this.data)return void(this.labelInfo.text="");var t="玩家  |C:0x3EADFF&T:"+this.data+"|  正在进入游戏";this.labelInfo.textFlow=TextFlowMaker.generateTextFlow1(t)},e}(eui.ItemRenderer);__reflect(CreateRoleViewItem.prototype,"CreateRoleViewItem");var SelectRoleData=function(){function t(t){this.id=t.readInt(),this.name=t.readString(),this.roleClass=t.readInt(),this.zsLevel=t.readInt(),this.level=t.readInt(),this.power=t.readDouble(),this.vipLevel=t.readInt(),this.sex=t.readInt()}return t}();__reflect(SelectRoleData.prototype,"SelectRoleData");var RoleMgr=function(t){function e(){var e=t.call(this)||this;return e.errorCode=["","sql错误","用户没登陆","游戏服务没准备好","角色上一次保存数据是否出现异常","客户端选择角色的常规错误","角色名称重复","角色不存在","错误的性别","随机生成的名字已经分配完","客户端上传的角色阵营参数错误","客户端上传的角色职业参数错误","名称无效，名称中包含非法字符或长度不合法","如果玩家是帮主，不能删除该角色，需要玩家退帮","已经登陆到其他服务器","已经超过最大可建角色数量"],e.canEnter=!1,e.enterID=-1,e.isFirstEnter=!0,e.lastRoleID=-1,e.sysId=PackageID.Login,e.regNetMsg(1,e.doCheckAccount),e.regNetMsg(2,e.postCreateRole),e.regNetMsg(4,e.doRoleList),e.regNetMsg(5,e.doEnterGame),e.regNetMsg(6,e.doRandom),e.observe(GameApp.ins().postPerLoadComplete,e.perCom),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.perCom=function(){this.canEnter=!0,-1!=this.enterID&&this.sendEnterGame(this.enterID)},e.prototype.connectServer=function(){this.startBtnEnable(!1),GameSocket.ins().login(LocationProperty.openID,LocationProperty.password,LocationProperty.srvid,LocationProperty.serverIP,LocationProperty.serverPort)},e.prototype.doCheckAccount=function(t){var i=t.readByte();if(0==i){var s=this.getBytes(4);this.sendToServer(s)}else this.startBtnEnable(!0),alert("Connect failed:"+e.LONGIN_ERROR_CODE[i]),3==i&&window.connectError()},e.prototype.doRoleList=function(t){var e=(t.readInt(),t.readByte());switch(e){case 0:SceneManager.ins().runScene(CreateRoleScene),window.showGame();break;case 1:for(var i=t.readInt(),s=[],n=0;i>n;n++){var o=new SelectRoleData(t);s.push(o)}1==i?(this.enterID=s[0].id,this.sendEnterGame(s[0].id)):this.isFirstEnter||-1==this.lastRoleID?(SceneManager.ins().runScene(SelectRoleScene),ViewManager.ins().open(SelectRoleWin,s),window.showGame()):this.sendEnterGame(this.lastRoleID)}},e.prototype.sendEnterGame=function(t){var e=this.getBytes(5);e.writeInt(t),e.writeString(LocationProperty.pf),e.writeString(LocationProperty.pfid),e.writeString(LocationProperty.appid),this.sendToServer(e),this.lastRoleID=t},e.prototype.doEnterGame=function(t){var e=t.readByte();switch(e){case 0:break;case 1:GameLoadingUI.GetInstance().close(),debug.log("进入游戏成功"),KFServerSys.ins().linkingKFState(!1),SceneManager.ins().runScene(MainScene),EntityManager.ins().removeAll(),Encounter.ins().clearEncounterModel(),Chat.ins().initData(),Guild.ins().initData(),this.isFirstEnter&&(this.isFirstEnter=!1,ReportData.getIns().report("entergame",ReportData.LOAD));break;default:alert("错误码:"+e)}},e.prototype.sendCreateRole=function(t,e,i,s,n,o){var a=this.getBytes(2);a.writeString(t),a.writeByte(e),a.writeByte(i),a.writeByte(s),a.writeString(LocationProperty.pf),a.writeString(LocationProperty.pfid),a.writeString(LocationProperty.appid),this.sendToServer(a)},e.prototype.postCreateRole=function(t){var e=t.readInt(),i=t.readByte();return 0!=i?(this.showErrorTips(i),i):(ReportData.getIns().report("createRole",ReportData.LOAD),ReportData.getIns().createRole(e),SoundUtil.ins().playEffect(SoundUtil.CREATE_ROLE),SoundUtil.ins().delayTime(3e3),!LocationProperty.isFirstLoad||this.canEnter?(this.sendEnterGame(e),!1):(this.enterID=e,!1))},e.prototype.sendRandomName=function(t){var e=this.getBytes(6);e.writeByte(t),this.sendToServer(e)},e.prototype.doRandom=function(t){var e=t.readByte();if(0==e){var i=(t.readByte(),t.readUTF());this.setName(i)}},e.prototype.startBtnEnable=function(t){this.startGameView&&(this.startGameView.start.enabled=t)},Object.defineProperty(e.prototype,"startGameView",{get:function(){return ViewManager.ins().getView(StartGameView)},enumerable:!0,configurable:!0}),e.prototype.setName=function(t){this.createRoleView.setName(t)},Object.defineProperty(e.prototype,"createRoleView",{get:function(){return ViewManager.ins().getView(CreateRoleView)},enumerable:!0,configurable:!0}),e.prototype.showErrorTips=function(t){0!=t&&UserTips.ins().showTips(this.errorCode[Math.abs(t)])},e}(BaseSystem);RoleMgr.LONGIN_ERROR_CODE=["","密码错误","没有这个账号","账号已登录，请刷新页面，最长需等待3分钟后重新登录","服务器忙","服务器维护中","Session服务器出错，可能数据库没连接好","不存在这个服务器","账号已纳入防沉迷系统，是否需要进行身份证信息填写？"],__reflect(RoleMgr.prototype,"RoleMgr");var GameSystem;!function(t){t.roleMgr=RoleMgr.ins.bind(RoleMgr)}(GameSystem||(GameSystem={}));var SelectRoleItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="SelectRoleItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(this.labelName.text=t.name,0==t.zsLevel?this.labelLevel.text="等级："+t.level:this.labelLevel.text="等级："+t.zsLevel+"转"+t.level+"级",t.power<=1e5)this.labelPower.text="战力："+t.power;else{var e=Math.floor(t.power/1e3);e/=10,this.labelPower.text="战力："+e+"万"}0==t.vipLevel?this.groupVip.visible=!1:(this.vipLabel.text=t.vipLevel+"",this.groupVip.visible=!0),this.imgRole.source="head_"+t.roleClass+t.sex,this.select.visible=this.selected},e}(BaseItemRender);__reflect(SelectRoleItem.prototype,"SelectRoleItem");var SelectRoleWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SelectRoleSkin",this.list.itemRenderer=SelectRoleItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnStart,this.onStartGame),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this);var i=t[0];i.sort(function(t,e){return t.power<e.power?1:-1}),this.list.dataProvider=new eui.ArrayCollection(i),this.list.selectedIndex=0},e.prototype.onTap=function(t){this.list.selectedIndex=t.itemIndex;var e=this.list.dataProvider;e.source.forEach(function(t,i){e.itemUpdated(t)})},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.btnStart,this.onStartGame),this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this)},e.prototype.onStartGame=function(){var t=this.list.getVirtualElementAt(this.list.selectedIndex);
RoleMgr.ins().sendEnterGame(t.data.id)},e}(BaseEuiView);__reflect(SelectRoleWin.prototype,"SelectRoleWin"),ViewManager.ins().reg(SelectRoleWin,LayerManager.UI_Main);var SelectRoleScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onEnter=function(){t.prototype.onEnter.call(this),this.addLayer(LayerManager.UI_Main),this.addLayer(LayerManager.UI_Tips)},e.prototype.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);__reflect(SelectRoleScene.prototype,"SelectRoleScene");var SelectServerView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SelectServerSkin"},e}(BaseEuiView);__reflect(SelectServerView.prototype,"SelectServerView"),ViewManager.ins().reg(SelectServerView,LayerManager.UI_Main);var StartGameScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onEnter=function(){RoleMgr.ins();t.prototype.onEnter.call(this),LocationProperty.isCanLogin()?RoleMgr.ins().connectServer():this.addLayer(LayerManager.UI_Main),RES.loadGroup("gamePer")},e.prototype.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);__reflect(StartGameScene.prototype,"StartGameScene");var StartGameView=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),ResourceUtils.ins().addConfig("startgame/default.res.json","startgame/"),ResourceUtils.ins().loadConfig(this.onConfigComplete,this)},e.prototype.onConfigComplete=function(){EXML.load("startgame/StartGameSkin.exml",this.onLoaded,this)},e.prototype.onLoaded=function(t,e){this.skinName=t,this.selectServer.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.curServer.text+"</u>"),this.account.text=egret.localStorage.getItem("account"),this.curServer.text="版署服务器",this.selectServer.visible=!1,this.start.skinName='<?xml version=\'1.0\' encoding=\'utf-8\'?>\n								<e:Skin class="Btn0Skin" states="up,down,disabled" minHeight="25" minWidth="25" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing">\n								<w:Config id="1586b67282f"/>\n								<e:Image id="iconDisplay" width="100%" height="100%" alpha.disabled="0.5"\n								source="" x.down="0" y.down="0"  scaleX.down="0.95" scaleY.down="0.95" pixelHitTest="true"/>\n								</e:Skin>',this.showIPListView(),this.open()},e.prototype.showIPListView=function(){this.select=new euiextension.DropDownList;var t=window.serverList;this.select.setDataIP(t);var e=window.resList;this.select.setDataRES(e),this.addChild(this.select)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.start,this.onClick),this.addTouchEvent(this.selectServer,this.onClick)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.start,this.onClick),this.removeTouchEvent(this.selectServer,this.onClick),this.select.destructor()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.start:this.callbackFun();break;case this.selectServer:ViewManager.ins().open(SelectServerView)}},e.prototype.gameResComplete=function(){LocationProperty.openID=this.account.text,egret.localStorage.setItem("account",this.account.text)},e}(BaseEuiView);__reflect(StartGameView.prototype,"StartGameView"),ViewManager.ins().reg(StartGameView,LayerManager.UI_Main);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var GameLoadingUI=function(t){function e(){var e=t.call(this)||this;return e.progressMaxWidth=574,e.bgPicW=600,e.bgPicH=948,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddStage,e),e}return __extends(e,t),e.GetInstance=function(){return null==e.Instance&&(e.Instance=new e),e.Instance},e.prototype.OnAddStage=function(){var t="";this.bg=new eui.Image,this.addChild(this.bg);var e=new egret.ImageLoader;e.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var e=new egret.Texture;e.bitmapData=t.currentTarget.data,this.bg.source=e}},this),e.once(egret.IOErrorEvent.IO_ERROR,function(t){e.load(cdnurl+"resource/eui/loading/loading.jpg")},this),""!=t?e.load("resourceagentAssets/"+t+"/loading.jpg"):e.load(cdnurl+"resource/eui/loading/loading.jpg"),this.progressPane=new egret.DisplayObjectContainer,this.addChild(this.progressPane),this.progressBg=new eui.Image,this.progressBg.source=cdnurl+"resource/eui/loading/loadingbg.png",this.progressBg.x=0,this.progressBg.y=0,this.progressPane.addChild(this.progressBg),this.progressBg1=new eui.Image,this.progressBg1.source=cdnurl+"resource/eui/loading/bar3.png",this.progressBg1.x=4,this.progressBg1.y=72,this.progressPane.addChild(this.progressBg1),this.progressBg2=new eui.Image,this.progressBg2.source=cdnurl+"resource/eui/loading/bar2.png",this.progressBg2.scale9Grid=new egret.Rectangle(12,8,5,5),this.progressBg2.width=571,this.progressBg2.x=14,this.progressBg2.y=this.progressBg1.y,this.progressPane.addChild(this.progressBg2),this.progressBg3=new eui.Image,this.progressBg3.source=cdnurl+"resource/eui/loading/bar4.png",this.progressBg3.x=this.progressBg2.x+this.progressBg2.width,this.progressBg3.y=this.progressBg1.y,this.progressPane.addChild(this.progressBg3),this.progress=new eui.Image,this.progress.source=cdnurl+"resource/eui/loading/bar5.png",this.progress.scale9Grid=new egret.Rectangle(11,2,4,5),this.progress.width=0,this.progress.height=8,this.progress.x=12,this.progress.y=this.progressBg1.y+2,this.progressPane.addChild(this.progress),this.posImage=new eui.Image,this.posImage.source=cdnurl+"resource/eui/loading/bar1.png",this.posImage.y=60,this.posImage.x=-18,this.progressPane.addChild(this.posImage),this.messageText=new eui.Label,this.messageText.width=600,this.messageText.height=20,this.messageText.textAlign=egret.HorizontalAlign.CENTER,this.messageText.x=0,this.messageText.y=40,this.messageText.size=22,this.progressPane.addChild(this.messageText),this.progressText=new eui.Label,this.progressText.width=this.messageText.width,this.progressText.height=20,this.progressText.textAlign=egret.HorizontalAlign.CENTER,this.progressText.x=0,this.progressText.y=this.progressBg1.y,this.progressText.size=12,this.progressPane.addChild(this.progressText),this.progressPane.x=0,this.progressPane.y=845,this.progressPane.width=600,this.progressPane.height=103,this.stage.addEventListener(egret.Event.RESIZE,this.OnSetWin,this),this.OnSetWin(null)},e.prototype.OnSetWin=function(t){this.x=this.stage.stageWidth/2-this.bgPicW/2,this.y=this.stage.stageHeight/2-this.bgPicH/2},e.prototype.show=function(t){t.addChild(this)},e.prototype.close=function(){egret.Tween.removeTweens(this.progress),egret.Tween.removeTweens(this.posImage),this.removeEventListener(egret.Event.RESIZE,this.OnSetWin,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.OnAddStage,this),this.parent&&(this.stage.removeEventListener(egret.Event.RESIZE,this.OnSetWin,this),this.parent.removeChild(this),ResourceMgr.ins().destroyWin())},e.prototype.setProgress=function(t,e){var i=this.progressMaxWidth*t/100;egret.Tween.removeTweens(this.progress),egret.Tween.removeTweens(this.posImage),egret.Tween.get(this.progress).to({width:i},500).call(this.timeEnd,this,[t]),egret.Tween.get(this.posImage).to({x:-18+i},500),this.progressText.text=Math.floor(t)+"%",this.messageText.text=e,this.messageText.textColor=16777215},e.prototype.timeEnd=function(t){90==t&&null==LocationProperty.openID&&(window.ARGS?GameSelectServeUI.GetInstance().show(this.parent):GameLoginPaneUi.GetInstance().show(this.parent))},e}(egret.DisplayObjectContainer);__reflect(GameLoadingUI.prototype,"GameLoadingUI");var GameLoginPaneUi=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddStage,e),e}return __extends(e,t),e.GetInstance=function(){return null==e.Instance&&(e.Instance=new e),e.Instance},e.prototype.OnAddStage=function(){this.BackGround(),this.BackGround(),this.LoginUser(),this.PasswordLogin(),this.LonginBtn()},e.prototype.BackGround=function(){this.background=new egret.Shape,this.background.graphics.beginFill(0),this.background.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.background.graphics.endFill(),this.addChild(this.background)},e.prototype.LoginUser=function(){this.user=new egret.TextField,this.user.border=!0,this.user.borderColor=16777215,this.user.width=275,this.user.height=40,this.user.textAlign=egret.HorizontalAlign.LEFT,this.user.type=egret.TextFieldType.INPUT,this.user.inputType=egret.TextFieldInputType.TEXT,this.user.fontFamily="黑体",this.user.size=40,this.user.anchorOffsetX=this.user.width/2,this.user.anchorOffsetY=this.user.height/2,this.user.x=this.stage.stageWidth/2+40,this.user.y=this.stage.stageHeight/2-100,this.user.textColor=16777215;var t=egret.localStorage.getItem("Login_h5_User_Name");t?this.user.text=t:this.user.text="client200",this.addChild(this.user),this.userText=new egret.TextField,this.userText.text="账号:",this.userText.fontFamily="黑体",this.userText.size=35,this.userText.textColor=16777215,this.userText.anchorOffsetX=this.userText.width/2,this.userText.anchorOffsetY=this.userText.height/2,this.userText.x=this.stage.stageWidth/2-160,this.userText.y=this.stage.stageHeight/2-100,this.addChild(this.userText)},e.prototype.PasswordLogin=function(){this.password=new egret.TextField,this.password.border=!0,this.password.borderColor=16777215,this.password.width=275,this.password.height=40,this.password.textAlign=egret.HorizontalAlign.LEFT,this.password.type=egret.TextFieldType.INPUT,this.password.inputType=egret.TextFieldInputType.PASSWORD,this.password.fontFamily="黑体",this.password.size=30,this.password.anchorOffsetX=this.password.width/2,this.password.anchorOffsetY=this.password.height/2,this.password.x=this.stage.stageWidth/2+40,this.password.y=this.stage.stageHeight/2,this.password.textColor=16777215,this.addChild(this.password),this.passwordText=new egret.TextField,this.passwordText.text="密码:",this.passwordText.fontFamily="黑体",this.passwordText.size=35,this.passwordText.textColor=16777215,this.passwordText.anchorOffsetX=this.passwordText.width/2,this.passwordText.anchorOffsetY=this.passwordText.height/2,this.passwordText.x=this.stage.stageWidth/2-160,this.passwordText.y=this.stage.stageHeight/2,this.addChild(this.passwordText)},e.prototype.LonginBtn=function(){this.login=new egret.TextField,this.login.width=80,this.login.height=40,this.login.text="登录",this.login.textAlign=egret.HorizontalAlign.CENTER,this.login.fontFamily="黑体",this.login.size=30,this.login.x=this.stage.stageWidth/2+this.login.width/2-40,this.login.y=this.stage.stageHeight/2+80,this.login.textColor=16777215,this.login.touchEnabled=!0,this.login.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.UserLogin,this),this.shape=new egret.Shape,this.shape.graphics.beginFill(26367),this.shape.graphics.drawRect(this.login.x,this.login.y,this.login.width,this.login.height),this.shape.graphics.endFill(),this.addChild(this.shape),this.addChild(this.login)},e.prototype.show=function(t){t.addChild(this)},e.prototype.UserLogin=function(){""==this.user.text||(LocationProperty.openID=this.user.text,egret.localStorage.setItem("Login_h5_User_Name",this.user.text),RoleMgr.ins().connectServer(),this.login.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.UserLogin,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.OnAddStage,this),this.parent&&this.parent.removeChild(this),LocationProperty.setLoadProgress(100,"(登录游戏中)"))},e}(egret.DisplayObjectContainer);__reflect(GameLoginPaneUi.prototype,"GameLoginPaneUi");var GameSelectServeUI=function(t){function e(){var e=t.call(this)||this;return e.teamItemArr=[],e.itemArr=[],e.bgPicW=480,e.bgPicH=800,e.serveTeamPaneMoveY=98,e.serveTeamPaneShowHight=520,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.OnAddStage,e),e}return __extends(e,t),e.GetInstance=function(){return null==e.Instance&&(e.Instance=new e),e.Instance},e.prototype.OnAddStage=function(){this.bg=new eui.Image,this.bg.source="resourceeui/loading/sverBg.jpg",this.addChild(this.bg),this.itemServeTeamPane=new egret.DisplayObjectContainer,this.itemServeTeamPane.x=25,this.itemServeTeamPane.y=this.serveTeamPaneMoveY,this.addChild(this.itemServeTeamPane);var t=new egret.Shape;t.graphics.clear(),t.graphics.drawRect(0,0,140,this.serveTeamPaneShowHight),t.graphics.beginFill(255,.8),t.graphics.endFill(),t.x=this.itemServeTeamPane.x,t.y=this.itemServeTeamPane.y,t.touchEnabled=!1,this.addChild(t),this.itemServeTeamPane.mask=t,this.itemServePane=new egret.DisplayObjectContainer,this.itemServePane.x=174,this.itemServePane.y=this.itemServeTeamPane.y,this.addChild(this.itemServePane),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.addEventListener(egret.Event.RESIZE,this.OnSetWin,this),this.OnSetWin(null)},e.prototype.OnSetWin=function(t){this.x=this.stage.stageWidth/2-this.bgPicW/2,this.y=this.stage.stageHeight/2-this.bgPicH/2},e.prototype.show=function(t){if(t.addChild(this),!(this.server_list_data.length<=0)){for(var e=this.server_list_data.length,i=[],s=0,n=10;e>0;){var o=[];o=e>=n?[s*n+1,(s+1)*n]:[s*n+1,s*n+e],i.unshift({data:o,name:o[0]+"-"+o[1]+"区"}),s+=1,e-=n}var a=0,r=new egret.Rectangle(30,18,100,21);for(a=0;a<i.length;a++)a>=this.teamItemArr.length&&(this.teamItemArr[a]=new ServeItemPane("resourceeui/loading/xuanzhong_btn1.png","resourceeui/loading/xuanzhong_btn0.png",r,140,58)),this.teamItemArr[a].x=0,this.teamItemArr[a].y=60*a,this.teamItemArr[a].setText(i[a],a),this.teamItemArr[a].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickSeverTeam,this),this.itemServeTeamPane.addChild(this.teamItemArr[a]);for(r=new egret.Rectangle(20,20,30,15),a=0;10>a;a++)a>=this.itemArr.length&&(this.itemArr[a]=new ServeItemPane("resourceeui/loading/qufu_beijinkuang.png","resourceeui/loading/qufu_beijinkuang1.png",r,280,45)),this.itemArr[a].x=0,this.itemArr[a].y=45*a,this.itemArr[a].visible=!1,this.itemArr[a].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickSever,this),this.itemServePane.addChild(this.itemArr[a]);this.setSelectByIndex(0)}},e.prototype.onClickSeverTeam=function(t){var e=t.currentTarget;e&&this.setSelectByIndex(e.index)},e.prototype.setSelectByIndex=function(t){this.nowSelectTeamItem&&this.nowSelectTeamItem.setSlect(!1),this.nowSelectTeamItem=this.teamItemArr[t],this.nowSelectTeamItem.setSlect(!0),this.setSeverItem()},e.prototype.setSeverItem=function(){this.nowSelectTeamItem.index;if(this.server_list_data){var t=this.nowSelectTeamItem.serverData.data;if(0==t.length);else{var e=this.server_list_data.length-t[1],i=this.server_list_data.length-t[0]+1,s=this.server_list_data.slice(e,i);this.updataServer(s)}}},e.prototype.updataServer=function(t){var e=0;for(e=0;e<this.itemArr.length;e++)this.itemArr[e].visible=!1;for(e=0;e<t.length;e++)this.itemArr[e].visible=!0,this.itemArr[e].setText(t[e],e)},e.prototype.onClickSever=function(t){t.currentTarget},e.prototype.callBack=function(){RoleMgr.ins().connectServer(),LocationProperty.setLoadProgress(100,"(登录游戏中)"),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.OnAddStage,this),this.parent&&(this.parent.removeChild(this),ResourceMgr.ins().destroyWin());var t=0;for(t=0;t<this.teamItemArr.length;t++)this.teamItemArr[t].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickSeverTeam,this);for(t=0;t<this.itemArr.length;t++)this.itemArr[t].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onClickSever,this);this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.removeEventListener(egret.Event.RESIZE,this.OnSetWin,this)},e.prototype.onTouchBegin=function(t){this.beginPos=new egret.Point(t.localX,t.localY);var e=new egret.Point(t.stageX,t.stageY);if(e=this.itemServeTeamPane.globalToLocal(e.x,e.y,e),e.x>=this.itemServeTeamPane.x&&e.x<=this.itemServeTeamPane.x+this.itemServeTeamPane.height&&e.y>=this.serveTeamPaneMoveY-this.itemServeTeamPane.y&&e.y<=this.serveTeamPaneMoveY-this.itemServeTeamPane.y+this.serveTeamPaneShowHight){var i=Math.floor(e.y/60);this.setSelectByIndex(i)}},e.prototype.onTouchMove=function(t){this.endPos=new egret.Point(t.localX,t.localY);var e=this.itemServeTeamPane.y+(this.endPos.y-this.beginPos.y);e<=this.serveTeamPaneMoveY-this.itemServeTeamPane.height+this.serveTeamPaneShowHight&&(e=this.serveTeamPaneMoveY-this.itemServeTeamPane.height+this.serveTeamPaneShowHight),e>=this.serveTeamPaneMoveY&&(e=this.serveTeamPaneMoveY),egret.Tween.removeTweens(this.itemServeTeamPane),egret.Tween.get(this.itemServeTeamPane).to({y:e},200)},e.prototype.DecodeUnicode=function(t){return t=t.replace(/\\/g,"%")},e.prototype.ServerFilter=function(t){return 4!=t.state},e}(egret.DisplayObjectContainer);__reflect(GameSelectServeUI.prototype,"GameSelectServeUI");var LoginData=function(){function t(){this.user_vo=new LoginUserVo}return t.GetInstance=function(){return null==t.Instance&&(t.Instance=new t),t.Instance},t.prototype.GetUserVo=function(){return this.user_vo},t}();LoginData.Instance=null,__reflect(LoginData.prototype,"LoginData");var LoginUserVo=function(){function t(){this.uid="",this.user_name="",this.password="c6f057b86584942e415435ffb1fa93d4",this.game_server_name="",this.game_server_id=1,this.game_server_span_id=1,this.verity_sign="ab6e03537c22c1b7f6763178a5882df7",this.verity_time="1445486107",this.identity="000000198010100000",this.account=0}return t}();__reflect(LoginUserVo.prototype,"LoginUserVo");var ServeItemPane=function(t){function e(e,i,s,n,o){var a=t.call(this)||this;return a.bg=new eui.Image,a.bg.source=e,a.bg.scale9Grid=s,a.bg.width=n,a.bg.height=o,a.addChild(a.bg),a.selectBg=new eui.Image,a.selectBg.source=i,a.selectBg.scale9Grid=s,a.selectBg.width=n,a.selectBg.height=o,a.addChild(a.selectBg),a.text=new eui.Label,a.text.width=n,a.text.height=25,a.text.size=20,a.text.textAlign=egret.HorizontalAlign.CENTER,a.text.y=Math.floor(o/2-a.text.height/2),a.addChild(a.text),a.setSlect(!1),a}return __extends(e,t),e.prototype.setText=function(t,e){this.serverData=t,this.text.text=this.serverData.name,this.index=e},e.prototype.setSlect=function(t){1==t?(this.selectBg.visible=!0,this.bg.visible=!1):(this.bg.visible=!0,this.selectBg.visible=!1)},e}(BaseItemRender);__reflect(ServeItemPane.prototype,"ServeItemPane");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.setMaxLoadingThread(4),DeviceUtils.IsPC&&(StageUtils.ins().setScaleMode(egret.StageScaleMode.SHOW_ALL),StageUtils.ins().getStage().orientation=egret.OrientationMode.AUTO),-1!=navigator.userAgent.indexOf("iPad")&&(StageUtils.ins().getStage().orientation=egret.OrientationMode.AUTO),SoundManager.ins().setEffectOn(SysSetting.ins().getBool(SysSetting.SOUND_EFFECT)),LocationProperty.init(),GameLoadingUI.GetInstance().show(this),FixUtil.fixAll(),egret.ImageLoader.crossOrigin="anonymous",this.loadResVersionComplete(),LocationProperty.setLoadProgress(30,"(加载游戏配置)")},e.prototype.loadResVersionComplete=function(){ResourceUtils.ins().addConfig(cdnurl+RES_RESOURCE+"default.res.json",""+RES_RESOURCE),ResourceUtils.ins().loadConfig(this.onConfigComplete,this)},e.prototype.onConfigComplete=function(){LocationProperty.setLoadProgress(40,"(加载游戏主题文件)");var t=new eui.Theme(cdnurl+RES_RESOURCE+"default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},e.prototype.onThemeLoadComplete=function(){GameApp.ins().load()},e.closesocket=function(){GameSocket.ins().close()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Version;!function(t){t.BUILD_NUMBER="V1.14.3.17. 004-KDSJFHG-PC"}(Version||(Version={}));